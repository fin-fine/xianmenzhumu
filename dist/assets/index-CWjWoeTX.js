var nb=Object.defineProperty;var rb=(e,t,n)=>t in e?nb(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n;var Zf=(e,t,n)=>rb(e,typeof t!="symbol"?t+"":t,n);import{g as kl,a as rp,i as sb,c as ob,d as ib,b as Ch,e as ab}from"./saveSystem-5fq0Y45f.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))s(o);new MutationObserver(o=>{for(const i of o)if(i.type==="childList")for(const a of i.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&s(a)}).observe(document,{childList:!0,subtree:!0});function n(o){const i={};return o.integrity&&(i.integrity=o.integrity),o.referrerPolicy&&(i.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?i.credentials="include":o.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function s(o){if(o.ep)return;o.ep=!0;const i=n(o);fetch(o.href,i)}})();function lb(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var Th={exports:{}},oc={},Ih={exports:{}},qe={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Zi=Symbol.for("react.element"),cb=Symbol.for("react.portal"),db=Symbol.for("react.fragment"),ub=Symbol.for("react.strict_mode"),pb=Symbol.for("react.profiler"),fb=Symbol.for("react.provider"),mb=Symbol.for("react.context"),hb=Symbol.for("react.forward_ref"),gb=Symbol.for("react.suspense"),xb=Symbol.for("react.memo"),yb=Symbol.for("react.lazy"),e0=Symbol.iterator;function bb(e){return e===null||typeof e!="object"?null:(e=e0&&e[e0]||e["@@iterator"],typeof e=="function"?e:null)}var _h={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},Rh=Object.assign,Mh={};function jo(e,t,n){this.props=e,this.context=t,this.refs=Mh,this.updater=n||_h}jo.prototype.isReactComponent={};jo.prototype.setState=function(e,t){if(typeof e!="object"&&typeof e!="function"&&e!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,e,t,"setState")};jo.prototype.forceUpdate=function(e){this.updater.enqueueForceUpdate(this,e,"forceUpdate")};function Ah(){}Ah.prototype=jo.prototype;function sp(e,t,n){this.props=e,this.context=t,this.refs=Mh,this.updater=n||_h}var op=sp.prototype=new Ah;op.constructor=sp;Rh(op,jo.prototype);op.isPureReactComponent=!0;var t0=Array.isArray,Nh=Object.prototype.hasOwnProperty,ip={current:null},Lh={key:!0,ref:!0,__self:!0,__source:!0};function $h(e,t,n){var s,o={},i=null,a=null;if(t!=null)for(s in t.ref!==void 0&&(a=t.ref),t.key!==void 0&&(i=""+t.key),t)Nh.call(t,s)&&!Lh.hasOwnProperty(s)&&(o[s]=t[s]);var l=arguments.length-2;if(l===1)o.children=n;else if(1<l){for(var d=Array(l),p=0;p<l;p++)d[p]=arguments[p+2];o.children=d}if(e&&e.defaultProps)for(s in l=e.defaultProps,l)o[s]===void 0&&(o[s]=l[s]);return{$$typeof:Zi,type:e,key:i,ref:a,props:o,_owner:ip.current}}function vb(e,t){return{$$typeof:Zi,type:e.type,key:t,ref:e.ref,props:e.props,_owner:e._owner}}function ap(e){return typeof e=="object"&&e!==null&&e.$$typeof===Zi}function Sb(e){var t={"=":"=0",":":"=2"};return"$"+e.replace(/[=:]/g,function(n){return t[n]})}var n0=/\/+/g;function od(e,t){return typeof e=="object"&&e!==null&&e.key!=null?Sb(""+e.key):t.toString(36)}function rl(e,t,n,s,o){var i=typeof e;(i==="undefined"||i==="boolean")&&(e=null);var a=!1;if(e===null)a=!0;else switch(i){case"string":case"number":a=!0;break;case"object":switch(e.$$typeof){case Zi:case cb:a=!0}}if(a)return a=e,o=o(a),e=s===""?"."+od(a,0):s,t0(o)?(n="",e!=null&&(n=e.replace(n0,"$&/")+"/"),rl(o,t,n,"",function(p){return p})):o!=null&&(ap(o)&&(o=vb(o,n+(!o.key||a&&a.key===o.key?"":(""+o.key).replace(n0,"$&/")+"/")+e)),t.push(o)),1;if(a=0,s=s===""?".":s+":",t0(e))for(var l=0;l<e.length;l++){i=e[l];var d=s+od(i,l);a+=rl(i,t,n,d,o)}else if(d=bb(e),typeof d=="function")for(e=d.call(e),l=0;!(i=e.next()).done;)i=i.value,d=s+od(i,l++),a+=rl(i,t,n,d,o);else if(i==="object")throw t=String(e),Error("Objects are not valid as a React child (found: "+(t==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":t)+"). If you meant to render a collection of children, use an array instead.");return a}function Ra(e,t,n){if(e==null)return e;var s=[],o=0;return rl(e,s,"","",function(i){return t.call(n,i,o++)}),s}function wb(e){if(e._status===-1){var t=e._result;t=t(),t.then(function(n){(e._status===0||e._status===-1)&&(e._status=1,e._result=n)},function(n){(e._status===0||e._status===-1)&&(e._status=2,e._result=n)}),e._status===-1&&(e._status=0,e._result=t)}if(e._status===1)return e._result.default;throw e._result}var an={current:null},sl={transition:null},Eb={ReactCurrentDispatcher:an,ReactCurrentBatchConfig:sl,ReactCurrentOwner:ip};function Bh(){throw Error("act(...) is not supported in production builds of React.")}qe.Children={map:Ra,forEach:function(e,t,n){Ra(e,function(){t.apply(this,arguments)},n)},count:function(e){var t=0;return Ra(e,function(){t++}),t},toArray:function(e){return Ra(e,function(t){return t})||[]},only:function(e){if(!ap(e))throw Error("React.Children.only expected to receive a single React element child.");return e}};qe.Component=jo;qe.Fragment=db;qe.Profiler=pb;qe.PureComponent=sp;qe.StrictMode=ub;qe.Suspense=gb;qe.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=Eb;qe.act=Bh;qe.cloneElement=function(e,t,n){if(e==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+e+".");var s=Rh({},e.props),o=e.key,i=e.ref,a=e._owner;if(t!=null){if(t.ref!==void 0&&(i=t.ref,a=ip.current),t.key!==void 0&&(o=""+t.key),e.type&&e.type.defaultProps)var l=e.type.defaultProps;for(d in t)Nh.call(t,d)&&!Lh.hasOwnProperty(d)&&(s[d]=t[d]===void 0&&l!==void 0?l[d]:t[d])}var d=arguments.length-2;if(d===1)s.children=n;else if(1<d){l=Array(d);for(var p=0;p<d;p++)l[p]=arguments[p+2];s.children=l}return{$$typeof:Zi,type:e.type,key:o,ref:i,props:s,_owner:a}};qe.createContext=function(e){return e={$$typeof:mb,_currentValue:e,_currentValue2:e,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},e.Provider={$$typeof:fb,_context:e},e.Consumer=e};qe.createElement=$h;qe.createFactory=function(e){var t=$h.bind(null,e);return t.type=e,t};qe.createRef=function(){return{current:null}};qe.forwardRef=function(e){return{$$typeof:hb,render:e}};qe.isValidElement=ap;qe.lazy=function(e){return{$$typeof:yb,_payload:{_status:-1,_result:e},_init:wb}};qe.memo=function(e,t){return{$$typeof:xb,type:e,compare:t===void 0?null:t}};qe.startTransition=function(e){var t=sl.transition;sl.transition={};try{e()}finally{sl.transition=t}};qe.unstable_act=Bh;qe.useCallback=function(e,t){return an.current.useCallback(e,t)};qe.useContext=function(e){return an.current.useContext(e)};qe.useDebugValue=function(){};qe.useDeferredValue=function(e){return an.current.useDeferredValue(e)};qe.useEffect=function(e,t){return an.current.useEffect(e,t)};qe.useId=function(){return an.current.useId()};qe.useImperativeHandle=function(e,t,n){return an.current.useImperativeHandle(e,t,n)};qe.useInsertionEffect=function(e,t){return an.current.useInsertionEffect(e,t)};qe.useLayoutEffect=function(e,t){return an.current.useLayoutEffect(e,t)};qe.useMemo=function(e,t){return an.current.useMemo(e,t)};qe.useReducer=function(e,t,n){return an.current.useReducer(e,t,n)};qe.useRef=function(e){return an.current.useRef(e)};qe.useState=function(e){return an.current.useState(e)};qe.useSyncExternalStore=function(e,t,n){return an.current.useSyncExternalStore(e,t,n)};qe.useTransition=function(){return an.current.useTransition()};qe.version="18.3.1";Ih.exports=qe;var y=Ih.exports;const ic=lb(y);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var kb=y,jb=Symbol.for("react.element"),Cb=Symbol.for("react.fragment"),Tb=Object.prototype.hasOwnProperty,Ib=kb.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,_b={key:!0,ref:!0,__self:!0,__source:!0};function Oh(e,t,n){var s,o={},i=null,a=null;n!==void 0&&(i=""+n),t.key!==void 0&&(i=""+t.key),t.ref!==void 0&&(a=t.ref);for(s in t)Tb.call(t,s)&&!_b.hasOwnProperty(s)&&(o[s]=t[s]);if(e&&e.defaultProps)for(s in t=e.defaultProps,t)o[s]===void 0&&(o[s]=t[s]);return{$$typeof:jb,type:e,key:i,ref:a,props:o,_owner:Ib.current}}oc.Fragment=Cb;oc.jsx=Oh;oc.jsxs=Oh;Th.exports=oc;var r=Th.exports,Jd={},Ph={exports:{}},Tn={},zh={exports:{}},Dh={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(e){function t(Y,q){var ie=Y.length;Y.push(q);e:for(;0<ie;){var Z=ie-1>>>1,ve=Y[Z];if(0<o(ve,q))Y[Z]=q,Y[ie]=ve,ie=Z;else break e}}function n(Y){return Y.length===0?null:Y[0]}function s(Y){if(Y.length===0)return null;var q=Y[0],ie=Y.pop();if(ie!==q){Y[0]=ie;e:for(var Z=0,ve=Y.length,V=ve>>>1;Z<V;){var ee=2*(Z+1)-1,he=Y[ee],ge=ee+1,me=Y[ge];if(0>o(he,ie))ge<ve&&0>o(me,he)?(Y[Z]=me,Y[ge]=ie,Z=ge):(Y[Z]=he,Y[ee]=ie,Z=ee);else if(ge<ve&&0>o(me,ie))Y[Z]=me,Y[ge]=ie,Z=ge;else break e}}return q}function o(Y,q){var ie=Y.sortIndex-q.sortIndex;return ie!==0?ie:Y.id-q.id}if(typeof performance=="object"&&typeof performance.now=="function"){var i=performance;e.unstable_now=function(){return i.now()}}else{var a=Date,l=a.now();e.unstable_now=function(){return a.now()-l}}var d=[],p=[],f=1,c=null,u=3,x=!1,S=!1,w=!1,C=typeof setTimeout=="function"?setTimeout:null,h=typeof clearTimeout=="function"?clearTimeout:null,g=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function b(Y){for(var q=n(p);q!==null;){if(q.callback===null)s(p);else if(q.startTime<=Y)s(p),q.sortIndex=q.expirationTime,t(d,q);else break;q=n(p)}}function E(Y){if(w=!1,b(Y),!S)if(n(d)!==null)S=!0,ne(I);else{var q=n(p);q!==null&&ae(E,q.startTime-Y)}}function I(Y,q){S=!1,w&&(w=!1,h(T),T=-1),x=!0;var ie=u;try{for(b(q),c=n(d);c!==null&&(!(c.expirationTime>q)||Y&&!$());){var Z=c.callback;if(typeof Z=="function"){c.callback=null,u=c.priorityLevel;var ve=Z(c.expirationTime<=q);q=e.unstable_now(),typeof ve=="function"?c.callback=ve:c===n(d)&&s(d),b(q)}else s(d);c=n(d)}if(c!==null)var V=!0;else{var ee=n(p);ee!==null&&ae(E,ee.startTime-q),V=!1}return V}finally{c=null,u=ie,x=!1}}var v=!1,k=null,T=-1,A=5,R=-1;function $(){return!(e.unstable_now()-R<A)}function O(){if(k!==null){var Y=e.unstable_now();R=Y;var q=!0;try{q=k(!0,Y)}finally{q?Q():(v=!1,k=null)}}else v=!1}var Q;if(typeof g=="function")Q=function(){g(O)};else if(typeof MessageChannel<"u"){var L=new MessageChannel,G=L.port2;L.port1.onmessage=O,Q=function(){G.postMessage(null)}}else Q=function(){C(O,0)};function ne(Y){k=Y,v||(v=!0,Q())}function ae(Y,q){T=C(function(){Y(e.unstable_now())},q)}e.unstable_IdlePriority=5,e.unstable_ImmediatePriority=1,e.unstable_LowPriority=4,e.unstable_NormalPriority=3,e.unstable_Profiling=null,e.unstable_UserBlockingPriority=2,e.unstable_cancelCallback=function(Y){Y.callback=null},e.unstable_continueExecution=function(){S||x||(S=!0,ne(I))},e.unstable_forceFrameRate=function(Y){0>Y||125<Y?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):A=0<Y?Math.floor(1e3/Y):5},e.unstable_getCurrentPriorityLevel=function(){return u},e.unstable_getFirstCallbackNode=function(){return n(d)},e.unstable_next=function(Y){switch(u){case 1:case 2:case 3:var q=3;break;default:q=u}var ie=u;u=q;try{return Y()}finally{u=ie}},e.unstable_pauseExecution=function(){},e.unstable_requestPaint=function(){},e.unstable_runWithPriority=function(Y,q){switch(Y){case 1:case 2:case 3:case 4:case 5:break;default:Y=3}var ie=u;u=Y;try{return q()}finally{u=ie}},e.unstable_scheduleCallback=function(Y,q,ie){var Z=e.unstable_now();switch(typeof ie=="object"&&ie!==null?(ie=ie.delay,ie=typeof ie=="number"&&0<ie?Z+ie:Z):ie=Z,Y){case 1:var ve=-1;break;case 2:ve=250;break;case 5:ve=1073741823;break;case 4:ve=1e4;break;default:ve=5e3}return ve=ie+ve,Y={id:f++,callback:q,priorityLevel:Y,startTime:ie,expirationTime:ve,sortIndex:-1},ie>Z?(Y.sortIndex=ie,t(p,Y),n(d)===null&&Y===n(p)&&(w?(h(T),T=-1):w=!0,ae(E,ie-Z))):(Y.sortIndex=ve,t(d,Y),S||x||(S=!0,ne(I))),Y},e.unstable_shouldYield=$,e.unstable_wrapCallback=function(Y){var q=u;return function(){var ie=u;u=q;try{return Y.apply(this,arguments)}finally{u=ie}}}})(Dh);zh.exports=Dh;var Rb=zh.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Mb=y,Cn=Rb;function le(e){for(var t="https://reactjs.org/docs/error-decoder.html?invariant="+e,n=1;n<arguments.length;n++)t+="&args[]="+encodeURIComponent(arguments[n]);return"Minified React error #"+e+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var Fh=new Set,Li={};function Ts(e,t){go(e,t),go(e+"Capture",t)}function go(e,t){for(Li[e]=t,e=0;e<t.length;e++)Fh.add(t[e])}var wr=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),Xd=Object.prototype.hasOwnProperty,Ab=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,r0={},s0={};function Nb(e){return Xd.call(s0,e)?!0:Xd.call(r0,e)?!1:Ab.test(e)?s0[e]=!0:(r0[e]=!0,!1)}function Lb(e,t,n,s){if(n!==null&&n.type===0)return!1;switch(typeof t){case"function":case"symbol":return!0;case"boolean":return s?!1:n!==null?!n.acceptsBooleans:(e=e.toLowerCase().slice(0,5),e!=="data-"&&e!=="aria-");default:return!1}}function $b(e,t,n,s){if(t===null||typeof t>"u"||Lb(e,t,n,s))return!0;if(s)return!1;if(n!==null)switch(n.type){case 3:return!t;case 4:return t===!1;case 5:return isNaN(t);case 6:return isNaN(t)||1>t}return!1}function ln(e,t,n,s,o,i,a){this.acceptsBooleans=t===2||t===3||t===4,this.attributeName=s,this.attributeNamespace=o,this.mustUseProperty=n,this.propertyName=e,this.type=t,this.sanitizeURL=i,this.removeEmptyString=a}var Yt={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(e){Yt[e]=new ln(e,0,!1,e,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(e){var t=e[0];Yt[t]=new ln(t,1,!1,e[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(e){Yt[e]=new ln(e,2,!1,e.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(e){Yt[e]=new ln(e,2,!1,e,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(e){Yt[e]=new ln(e,3,!1,e.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(e){Yt[e]=new ln(e,3,!0,e,null,!1,!1)});["capture","download"].forEach(function(e){Yt[e]=new ln(e,4,!1,e,null,!1,!1)});["cols","rows","size","span"].forEach(function(e){Yt[e]=new ln(e,6,!1,e,null,!1,!1)});["rowSpan","start"].forEach(function(e){Yt[e]=new ln(e,5,!1,e.toLowerCase(),null,!1,!1)});var lp=/[\-:]([a-z])/g;function cp(e){return e[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(e){var t=e.replace(lp,cp);Yt[t]=new ln(t,1,!1,e,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(e){var t=e.replace(lp,cp);Yt[t]=new ln(t,1,!1,e,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(e){var t=e.replace(lp,cp);Yt[t]=new ln(t,1,!1,e,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(e){Yt[e]=new ln(e,1,!1,e.toLowerCase(),null,!1,!1)});Yt.xlinkHref=new ln("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(e){Yt[e]=new ln(e,1,!1,e.toLowerCase(),null,!0,!0)});function dp(e,t,n,s){var o=Yt.hasOwnProperty(t)?Yt[t]:null;(o!==null?o.type!==0:s||!(2<t.length)||t[0]!=="o"&&t[0]!=="O"||t[1]!=="n"&&t[1]!=="N")&&($b(t,n,o,s)&&(n=null),s||o===null?Nb(t)&&(n===null?e.removeAttribute(t):e.setAttribute(t,""+n)):o.mustUseProperty?e[o.propertyName]=n===null?o.type===3?!1:"":n:(t=o.attributeName,s=o.attributeNamespace,n===null?e.removeAttribute(t):(o=o.type,n=o===3||o===4&&n===!0?"":""+n,s?e.setAttributeNS(s,t,n):e.setAttribute(t,n))))}var Tr=Mb.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,Ma=Symbol.for("react.element"),Ys=Symbol.for("react.portal"),qs=Symbol.for("react.fragment"),up=Symbol.for("react.strict_mode"),Zd=Symbol.for("react.profiler"),Hh=Symbol.for("react.provider"),Wh=Symbol.for("react.context"),pp=Symbol.for("react.forward_ref"),eu=Symbol.for("react.suspense"),tu=Symbol.for("react.suspense_list"),fp=Symbol.for("react.memo"),Ar=Symbol.for("react.lazy"),Uh=Symbol.for("react.offscreen"),o0=Symbol.iterator;function ri(e){return e===null||typeof e!="object"?null:(e=o0&&e[o0]||e["@@iterator"],typeof e=="function"?e:null)}var jt=Object.assign,id;function yi(e){if(id===void 0)try{throw Error()}catch(n){var t=n.stack.trim().match(/\n( *(at )?)/);id=t&&t[1]||""}return`
`+id+e}var ad=!1;function ld(e,t){if(!e||ad)return"";ad=!0;var n=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(t)if(t=function(){throw Error()},Object.defineProperty(t.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(t,[])}catch(p){var s=p}Reflect.construct(e,[],t)}else{try{t.call()}catch(p){s=p}e.call(t.prototype)}else{try{throw Error()}catch(p){s=p}e()}}catch(p){if(p&&s&&typeof p.stack=="string"){for(var o=p.stack.split(`
`),i=s.stack.split(`
`),a=o.length-1,l=i.length-1;1<=a&&0<=l&&o[a]!==i[l];)l--;for(;1<=a&&0<=l;a--,l--)if(o[a]!==i[l]){if(a!==1||l!==1)do if(a--,l--,0>l||o[a]!==i[l]){var d=`
`+o[a].replace(" at new "," at ");return e.displayName&&d.includes("<anonymous>")&&(d=d.replace("<anonymous>",e.displayName)),d}while(1<=a&&0<=l);break}}}finally{ad=!1,Error.prepareStackTrace=n}return(e=e?e.displayName||e.name:"")?yi(e):""}function Bb(e){switch(e.tag){case 5:return yi(e.type);case 16:return yi("Lazy");case 13:return yi("Suspense");case 19:return yi("SuspenseList");case 0:case 2:case 15:return e=ld(e.type,!1),e;case 11:return e=ld(e.type.render,!1),e;case 1:return e=ld(e.type,!0),e;default:return""}}function nu(e){if(e==null)return null;if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e;switch(e){case qs:return"Fragment";case Ys:return"Portal";case Zd:return"Profiler";case up:return"StrictMode";case eu:return"Suspense";case tu:return"SuspenseList"}if(typeof e=="object")switch(e.$$typeof){case Wh:return(e.displayName||"Context")+".Consumer";case Hh:return(e._context.displayName||"Context")+".Provider";case pp:var t=e.render;return e=e.displayName,e||(e=t.displayName||t.name||"",e=e!==""?"ForwardRef("+e+")":"ForwardRef"),e;case fp:return t=e.displayName||null,t!==null?t:nu(e.type)||"Memo";case Ar:t=e._payload,e=e._init;try{return nu(e(t))}catch{}}return null}function Ob(e){var t=e.type;switch(e.tag){case 24:return"Cache";case 9:return(t.displayName||"Context")+".Consumer";case 10:return(t._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return e=t.render,e=e.displayName||e.name||"",t.displayName||(e!==""?"ForwardRef("+e+")":"ForwardRef");case 7:return"Fragment";case 5:return t;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return nu(t);case 8:return t===up?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof t=="function")return t.displayName||t.name||null;if(typeof t=="string")return t}return null}function Kr(e){switch(typeof e){case"boolean":case"number":case"string":case"undefined":return e;case"object":return e;default:return""}}function Gh(e){var t=e.type;return(e=e.nodeName)&&e.toLowerCase()==="input"&&(t==="checkbox"||t==="radio")}function Pb(e){var t=Gh(e)?"checked":"value",n=Object.getOwnPropertyDescriptor(e.constructor.prototype,t),s=""+e[t];if(!e.hasOwnProperty(t)&&typeof n<"u"&&typeof n.get=="function"&&typeof n.set=="function"){var o=n.get,i=n.set;return Object.defineProperty(e,t,{configurable:!0,get:function(){return o.call(this)},set:function(a){s=""+a,i.call(this,a)}}),Object.defineProperty(e,t,{enumerable:n.enumerable}),{getValue:function(){return s},setValue:function(a){s=""+a},stopTracking:function(){e._valueTracker=null,delete e[t]}}}}function Aa(e){e._valueTracker||(e._valueTracker=Pb(e))}function Vh(e){if(!e)return!1;var t=e._valueTracker;if(!t)return!0;var n=t.getValue(),s="";return e&&(s=Gh(e)?e.checked?"true":"false":e.value),e=s,e!==n?(t.setValue(e),!0):!1}function jl(e){if(e=e||(typeof document<"u"?document:void 0),typeof e>"u")return null;try{return e.activeElement||e.body}catch{return e.body}}function ru(e,t){var n=t.checked;return jt({},t,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:n??e._wrapperState.initialChecked})}function i0(e,t){var n=t.defaultValue==null?"":t.defaultValue,s=t.checked!=null?t.checked:t.defaultChecked;n=Kr(t.value!=null?t.value:n),e._wrapperState={initialChecked:s,initialValue:n,controlled:t.type==="checkbox"||t.type==="radio"?t.checked!=null:t.value!=null}}function Yh(e,t){t=t.checked,t!=null&&dp(e,"checked",t,!1)}function su(e,t){Yh(e,t);var n=Kr(t.value),s=t.type;if(n!=null)s==="number"?(n===0&&e.value===""||e.value!=n)&&(e.value=""+n):e.value!==""+n&&(e.value=""+n);else if(s==="submit"||s==="reset"){e.removeAttribute("value");return}t.hasOwnProperty("value")?ou(e,t.type,n):t.hasOwnProperty("defaultValue")&&ou(e,t.type,Kr(t.defaultValue)),t.checked==null&&t.defaultChecked!=null&&(e.defaultChecked=!!t.defaultChecked)}function a0(e,t,n){if(t.hasOwnProperty("value")||t.hasOwnProperty("defaultValue")){var s=t.type;if(!(s!=="submit"&&s!=="reset"||t.value!==void 0&&t.value!==null))return;t=""+e._wrapperState.initialValue,n||t===e.value||(e.value=t),e.defaultValue=t}n=e.name,n!==""&&(e.name=""),e.defaultChecked=!!e._wrapperState.initialChecked,n!==""&&(e.name=n)}function ou(e,t,n){(t!=="number"||jl(e.ownerDocument)!==e)&&(n==null?e.defaultValue=""+e._wrapperState.initialValue:e.defaultValue!==""+n&&(e.defaultValue=""+n))}var bi=Array.isArray;function io(e,t,n,s){if(e=e.options,t){t={};for(var o=0;o<n.length;o++)t["$"+n[o]]=!0;for(n=0;n<e.length;n++)o=t.hasOwnProperty("$"+e[n].value),e[n].selected!==o&&(e[n].selected=o),o&&s&&(e[n].defaultSelected=!0)}else{for(n=""+Kr(n),t=null,o=0;o<e.length;o++){if(e[o].value===n){e[o].selected=!0,s&&(e[o].defaultSelected=!0);return}t!==null||e[o].disabled||(t=e[o])}t!==null&&(t.selected=!0)}}function iu(e,t){if(t.dangerouslySetInnerHTML!=null)throw Error(le(91));return jt({},t,{value:void 0,defaultValue:void 0,children:""+e._wrapperState.initialValue})}function l0(e,t){var n=t.value;if(n==null){if(n=t.children,t=t.defaultValue,n!=null){if(t!=null)throw Error(le(92));if(bi(n)){if(1<n.length)throw Error(le(93));n=n[0]}t=n}t==null&&(t=""),n=t}e._wrapperState={initialValue:Kr(n)}}function qh(e,t){var n=Kr(t.value),s=Kr(t.defaultValue);n!=null&&(n=""+n,n!==e.value&&(e.value=n),t.defaultValue==null&&e.defaultValue!==n&&(e.defaultValue=n)),s!=null&&(e.defaultValue=""+s)}function c0(e){var t=e.textContent;t===e._wrapperState.initialValue&&t!==""&&t!==null&&(e.value=t)}function Kh(e){switch(e){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function au(e,t){return e==null||e==="http://www.w3.org/1999/xhtml"?Kh(t):e==="http://www.w3.org/2000/svg"&&t==="foreignObject"?"http://www.w3.org/1999/xhtml":e}var Na,Qh=function(e){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(t,n,s,o){MSApp.execUnsafeLocalFunction(function(){return e(t,n,s,o)})}:e}(function(e,t){if(e.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in e)e.innerHTML=t;else{for(Na=Na||document.createElement("div"),Na.innerHTML="<svg>"+t.valueOf().toString()+"</svg>",t=Na.firstChild;e.firstChild;)e.removeChild(e.firstChild);for(;t.firstChild;)e.appendChild(t.firstChild)}});function $i(e,t){if(t){var n=e.firstChild;if(n&&n===e.lastChild&&n.nodeType===3){n.nodeValue=t;return}}e.textContent=t}var ki={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},zb=["Webkit","ms","Moz","O"];Object.keys(ki).forEach(function(e){zb.forEach(function(t){t=t+e.charAt(0).toUpperCase()+e.substring(1),ki[t]=ki[e]})});function Jh(e,t,n){return t==null||typeof t=="boolean"||t===""?"":n||typeof t!="number"||t===0||ki.hasOwnProperty(e)&&ki[e]?(""+t).trim():t+"px"}function Xh(e,t){e=e.style;for(var n in t)if(t.hasOwnProperty(n)){var s=n.indexOf("--")===0,o=Jh(n,t[n],s);n==="float"&&(n="cssFloat"),s?e.setProperty(n,o):e[n]=o}}var Db=jt({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function lu(e,t){if(t){if(Db[e]&&(t.children!=null||t.dangerouslySetInnerHTML!=null))throw Error(le(137,e));if(t.dangerouslySetInnerHTML!=null){if(t.children!=null)throw Error(le(60));if(typeof t.dangerouslySetInnerHTML!="object"||!("__html"in t.dangerouslySetInnerHTML))throw Error(le(61))}if(t.style!=null&&typeof t.style!="object")throw Error(le(62))}}function cu(e,t){if(e.indexOf("-")===-1)return typeof t.is=="string";switch(e){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var du=null;function mp(e){return e=e.target||e.srcElement||window,e.correspondingUseElement&&(e=e.correspondingUseElement),e.nodeType===3?e.parentNode:e}var uu=null,ao=null,lo=null;function d0(e){if(e=na(e)){if(typeof uu!="function")throw Error(le(280));var t=e.stateNode;t&&(t=uc(t),uu(e.stateNode,e.type,t))}}function Zh(e){ao?lo?lo.push(e):lo=[e]:ao=e}function eg(){if(ao){var e=ao,t=lo;if(lo=ao=null,d0(e),t)for(e=0;e<t.length;e++)d0(t[e])}}function tg(e,t){return e(t)}function ng(){}var cd=!1;function rg(e,t,n){if(cd)return e(t,n);cd=!0;try{return tg(e,t,n)}finally{cd=!1,(ao!==null||lo!==null)&&(ng(),eg())}}function Bi(e,t){var n=e.stateNode;if(n===null)return null;var s=uc(n);if(s===null)return null;n=s[t];e:switch(t){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(s=!s.disabled)||(e=e.type,s=!(e==="button"||e==="input"||e==="select"||e==="textarea")),e=!s;break e;default:e=!1}if(e)return null;if(n&&typeof n!="function")throw Error(le(231,t,typeof n));return n}var pu=!1;if(wr)try{var si={};Object.defineProperty(si,"passive",{get:function(){pu=!0}}),window.addEventListener("test",si,si),window.removeEventListener("test",si,si)}catch{pu=!1}function Fb(e,t,n,s,o,i,a,l,d){var p=Array.prototype.slice.call(arguments,3);try{t.apply(n,p)}catch(f){this.onError(f)}}var ji=!1,Cl=null,Tl=!1,fu=null,Hb={onError:function(e){ji=!0,Cl=e}};function Wb(e,t,n,s,o,i,a,l,d){ji=!1,Cl=null,Fb.apply(Hb,arguments)}function Ub(e,t,n,s,o,i,a,l,d){if(Wb.apply(this,arguments),ji){if(ji){var p=Cl;ji=!1,Cl=null}else throw Error(le(198));Tl||(Tl=!0,fu=p)}}function Is(e){var t=e,n=e;if(e.alternate)for(;t.return;)t=t.return;else{e=t;do t=e,t.flags&4098&&(n=t.return),e=t.return;while(e)}return t.tag===3?n:null}function sg(e){if(e.tag===13){var t=e.memoizedState;if(t===null&&(e=e.alternate,e!==null&&(t=e.memoizedState)),t!==null)return t.dehydrated}return null}function u0(e){if(Is(e)!==e)throw Error(le(188))}function Gb(e){var t=e.alternate;if(!t){if(t=Is(e),t===null)throw Error(le(188));return t!==e?null:e}for(var n=e,s=t;;){var o=n.return;if(o===null)break;var i=o.alternate;if(i===null){if(s=o.return,s!==null){n=s;continue}break}if(o.child===i.child){for(i=o.child;i;){if(i===n)return u0(o),e;if(i===s)return u0(o),t;i=i.sibling}throw Error(le(188))}if(n.return!==s.return)n=o,s=i;else{for(var a=!1,l=o.child;l;){if(l===n){a=!0,n=o,s=i;break}if(l===s){a=!0,s=o,n=i;break}l=l.sibling}if(!a){for(l=i.child;l;){if(l===n){a=!0,n=i,s=o;break}if(l===s){a=!0,s=i,n=o;break}l=l.sibling}if(!a)throw Error(le(189))}}if(n.alternate!==s)throw Error(le(190))}if(n.tag!==3)throw Error(le(188));return n.stateNode.current===n?e:t}function og(e){return e=Gb(e),e!==null?ig(e):null}function ig(e){if(e.tag===5||e.tag===6)return e;for(e=e.child;e!==null;){var t=ig(e);if(t!==null)return t;e=e.sibling}return null}var ag=Cn.unstable_scheduleCallback,p0=Cn.unstable_cancelCallback,Vb=Cn.unstable_shouldYield,Yb=Cn.unstable_requestPaint,_t=Cn.unstable_now,qb=Cn.unstable_getCurrentPriorityLevel,hp=Cn.unstable_ImmediatePriority,lg=Cn.unstable_UserBlockingPriority,Il=Cn.unstable_NormalPriority,Kb=Cn.unstable_LowPriority,cg=Cn.unstable_IdlePriority,ac=null,cr=null;function Qb(e){if(cr&&typeof cr.onCommitFiberRoot=="function")try{cr.onCommitFiberRoot(ac,e,void 0,(e.current.flags&128)===128)}catch{}}var Xn=Math.clz32?Math.clz32:Zb,Jb=Math.log,Xb=Math.LN2;function Zb(e){return e>>>=0,e===0?32:31-(Jb(e)/Xb|0)|0}var La=64,$a=4194304;function vi(e){switch(e&-e){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return e&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return e}}function _l(e,t){var n=e.pendingLanes;if(n===0)return 0;var s=0,o=e.suspendedLanes,i=e.pingedLanes,a=n&268435455;if(a!==0){var l=a&~o;l!==0?s=vi(l):(i&=a,i!==0&&(s=vi(i)))}else a=n&~o,a!==0?s=vi(a):i!==0&&(s=vi(i));if(s===0)return 0;if(t!==0&&t!==s&&!(t&o)&&(o=s&-s,i=t&-t,o>=i||o===16&&(i&4194240)!==0))return t;if(s&4&&(s|=n&16),t=e.entangledLanes,t!==0)for(e=e.entanglements,t&=s;0<t;)n=31-Xn(t),o=1<<n,s|=e[n],t&=~o;return s}function ev(e,t){switch(e){case 1:case 2:case 4:return t+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function tv(e,t){for(var n=e.suspendedLanes,s=e.pingedLanes,o=e.expirationTimes,i=e.pendingLanes;0<i;){var a=31-Xn(i),l=1<<a,d=o[a];d===-1?(!(l&n)||l&s)&&(o[a]=ev(l,t)):d<=t&&(e.expiredLanes|=l),i&=~l}}function mu(e){return e=e.pendingLanes&-1073741825,e!==0?e:e&1073741824?1073741824:0}function dg(){var e=La;return La<<=1,!(La&4194240)&&(La=64),e}function dd(e){for(var t=[],n=0;31>n;n++)t.push(e);return t}function ea(e,t,n){e.pendingLanes|=t,t!==536870912&&(e.suspendedLanes=0,e.pingedLanes=0),e=e.eventTimes,t=31-Xn(t),e[t]=n}function nv(e,t){var n=e.pendingLanes&~t;e.pendingLanes=t,e.suspendedLanes=0,e.pingedLanes=0,e.expiredLanes&=t,e.mutableReadLanes&=t,e.entangledLanes&=t,t=e.entanglements;var s=e.eventTimes;for(e=e.expirationTimes;0<n;){var o=31-Xn(n),i=1<<o;t[o]=0,s[o]=-1,e[o]=-1,n&=~i}}function gp(e,t){var n=e.entangledLanes|=t;for(e=e.entanglements;n;){var s=31-Xn(n),o=1<<s;o&t|e[s]&t&&(e[s]|=t),n&=~o}}var at=0;function ug(e){return e&=-e,1<e?4<e?e&268435455?16:536870912:4:1}var pg,xp,fg,mg,hg,hu=!1,Ba=[],Dr=null,Fr=null,Hr=null,Oi=new Map,Pi=new Map,$r=[],rv="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function f0(e,t){switch(e){case"focusin":case"focusout":Dr=null;break;case"dragenter":case"dragleave":Fr=null;break;case"mouseover":case"mouseout":Hr=null;break;case"pointerover":case"pointerout":Oi.delete(t.pointerId);break;case"gotpointercapture":case"lostpointercapture":Pi.delete(t.pointerId)}}function oi(e,t,n,s,o,i){return e===null||e.nativeEvent!==i?(e={blockedOn:t,domEventName:n,eventSystemFlags:s,nativeEvent:i,targetContainers:[o]},t!==null&&(t=na(t),t!==null&&xp(t)),e):(e.eventSystemFlags|=s,t=e.targetContainers,o!==null&&t.indexOf(o)===-1&&t.push(o),e)}function sv(e,t,n,s,o){switch(t){case"focusin":return Dr=oi(Dr,e,t,n,s,o),!0;case"dragenter":return Fr=oi(Fr,e,t,n,s,o),!0;case"mouseover":return Hr=oi(Hr,e,t,n,s,o),!0;case"pointerover":var i=o.pointerId;return Oi.set(i,oi(Oi.get(i)||null,e,t,n,s,o)),!0;case"gotpointercapture":return i=o.pointerId,Pi.set(i,oi(Pi.get(i)||null,e,t,n,s,o)),!0}return!1}function gg(e){var t=ps(e.target);if(t!==null){var n=Is(t);if(n!==null){if(t=n.tag,t===13){if(t=sg(n),t!==null){e.blockedOn=t,hg(e.priority,function(){fg(n)});return}}else if(t===3&&n.stateNode.current.memoizedState.isDehydrated){e.blockedOn=n.tag===3?n.stateNode.containerInfo:null;return}}}e.blockedOn=null}function ol(e){if(e.blockedOn!==null)return!1;for(var t=e.targetContainers;0<t.length;){var n=gu(e.domEventName,e.eventSystemFlags,t[0],e.nativeEvent);if(n===null){n=e.nativeEvent;var s=new n.constructor(n.type,n);du=s,n.target.dispatchEvent(s),du=null}else return t=na(n),t!==null&&xp(t),e.blockedOn=n,!1;t.shift()}return!0}function m0(e,t,n){ol(e)&&n.delete(t)}function ov(){hu=!1,Dr!==null&&ol(Dr)&&(Dr=null),Fr!==null&&ol(Fr)&&(Fr=null),Hr!==null&&ol(Hr)&&(Hr=null),Oi.forEach(m0),Pi.forEach(m0)}function ii(e,t){e.blockedOn===t&&(e.blockedOn=null,hu||(hu=!0,Cn.unstable_scheduleCallback(Cn.unstable_NormalPriority,ov)))}function zi(e){function t(o){return ii(o,e)}if(0<Ba.length){ii(Ba[0],e);for(var n=1;n<Ba.length;n++){var s=Ba[n];s.blockedOn===e&&(s.blockedOn=null)}}for(Dr!==null&&ii(Dr,e),Fr!==null&&ii(Fr,e),Hr!==null&&ii(Hr,e),Oi.forEach(t),Pi.forEach(t),n=0;n<$r.length;n++)s=$r[n],s.blockedOn===e&&(s.blockedOn=null);for(;0<$r.length&&(n=$r[0],n.blockedOn===null);)gg(n),n.blockedOn===null&&$r.shift()}var co=Tr.ReactCurrentBatchConfig,Rl=!0;function iv(e,t,n,s){var o=at,i=co.transition;co.transition=null;try{at=1,yp(e,t,n,s)}finally{at=o,co.transition=i}}function av(e,t,n,s){var o=at,i=co.transition;co.transition=null;try{at=4,yp(e,t,n,s)}finally{at=o,co.transition=i}}function yp(e,t,n,s){if(Rl){var o=gu(e,t,n,s);if(o===null)vd(e,t,s,Ml,n),f0(e,s);else if(sv(o,e,t,n,s))s.stopPropagation();else if(f0(e,s),t&4&&-1<rv.indexOf(e)){for(;o!==null;){var i=na(o);if(i!==null&&pg(i),i=gu(e,t,n,s),i===null&&vd(e,t,s,Ml,n),i===o)break;o=i}o!==null&&s.stopPropagation()}else vd(e,t,s,null,n)}}var Ml=null;function gu(e,t,n,s){if(Ml=null,e=mp(s),e=ps(e),e!==null)if(t=Is(e),t===null)e=null;else if(n=t.tag,n===13){if(e=sg(t),e!==null)return e;e=null}else if(n===3){if(t.stateNode.current.memoizedState.isDehydrated)return t.tag===3?t.stateNode.containerInfo:null;e=null}else t!==e&&(e=null);return Ml=e,null}function xg(e){switch(e){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(qb()){case hp:return 1;case lg:return 4;case Il:case Kb:return 16;case cg:return 536870912;default:return 16}default:return 16}}var Or=null,bp=null,il=null;function yg(){if(il)return il;var e,t=bp,n=t.length,s,o="value"in Or?Or.value:Or.textContent,i=o.length;for(e=0;e<n&&t[e]===o[e];e++);var a=n-e;for(s=1;s<=a&&t[n-s]===o[i-s];s++);return il=o.slice(e,1<s?1-s:void 0)}function al(e){var t=e.keyCode;return"charCode"in e?(e=e.charCode,e===0&&t===13&&(e=13)):e=t,e===10&&(e=13),32<=e||e===13?e:0}function Oa(){return!0}function h0(){return!1}function In(e){function t(n,s,o,i,a){this._reactName=n,this._targetInst=o,this.type=s,this.nativeEvent=i,this.target=a,this.currentTarget=null;for(var l in e)e.hasOwnProperty(l)&&(n=e[l],this[l]=n?n(i):i[l]);return this.isDefaultPrevented=(i.defaultPrevented!=null?i.defaultPrevented:i.returnValue===!1)?Oa:h0,this.isPropagationStopped=h0,this}return jt(t.prototype,{preventDefault:function(){this.defaultPrevented=!0;var n=this.nativeEvent;n&&(n.preventDefault?n.preventDefault():typeof n.returnValue!="unknown"&&(n.returnValue=!1),this.isDefaultPrevented=Oa)},stopPropagation:function(){var n=this.nativeEvent;n&&(n.stopPropagation?n.stopPropagation():typeof n.cancelBubble!="unknown"&&(n.cancelBubble=!0),this.isPropagationStopped=Oa)},persist:function(){},isPersistent:Oa}),t}var Co={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(e){return e.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},vp=In(Co),ta=jt({},Co,{view:0,detail:0}),lv=In(ta),ud,pd,ai,lc=jt({},ta,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Sp,button:0,buttons:0,relatedTarget:function(e){return e.relatedTarget===void 0?e.fromElement===e.srcElement?e.toElement:e.fromElement:e.relatedTarget},movementX:function(e){return"movementX"in e?e.movementX:(e!==ai&&(ai&&e.type==="mousemove"?(ud=e.screenX-ai.screenX,pd=e.screenY-ai.screenY):pd=ud=0,ai=e),ud)},movementY:function(e){return"movementY"in e?e.movementY:pd}}),g0=In(lc),cv=jt({},lc,{dataTransfer:0}),dv=In(cv),uv=jt({},ta,{relatedTarget:0}),fd=In(uv),pv=jt({},Co,{animationName:0,elapsedTime:0,pseudoElement:0}),fv=In(pv),mv=jt({},Co,{clipboardData:function(e){return"clipboardData"in e?e.clipboardData:window.clipboardData}}),hv=In(mv),gv=jt({},Co,{data:0}),x0=In(gv),xv={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},yv={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},bv={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function vv(e){var t=this.nativeEvent;return t.getModifierState?t.getModifierState(e):(e=bv[e])?!!t[e]:!1}function Sp(){return vv}var Sv=jt({},ta,{key:function(e){if(e.key){var t=xv[e.key]||e.key;if(t!=="Unidentified")return t}return e.type==="keypress"?(e=al(e),e===13?"Enter":String.fromCharCode(e)):e.type==="keydown"||e.type==="keyup"?yv[e.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Sp,charCode:function(e){return e.type==="keypress"?al(e):0},keyCode:function(e){return e.type==="keydown"||e.type==="keyup"?e.keyCode:0},which:function(e){return e.type==="keypress"?al(e):e.type==="keydown"||e.type==="keyup"?e.keyCode:0}}),wv=In(Sv),Ev=jt({},lc,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),y0=In(Ev),kv=jt({},ta,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Sp}),jv=In(kv),Cv=jt({},Co,{propertyName:0,elapsedTime:0,pseudoElement:0}),Tv=In(Cv),Iv=jt({},lc,{deltaX:function(e){return"deltaX"in e?e.deltaX:"wheelDeltaX"in e?-e.wheelDeltaX:0},deltaY:function(e){return"deltaY"in e?e.deltaY:"wheelDeltaY"in e?-e.wheelDeltaY:"wheelDelta"in e?-e.wheelDelta:0},deltaZ:0,deltaMode:0}),_v=In(Iv),Rv=[9,13,27,32],wp=wr&&"CompositionEvent"in window,Ci=null;wr&&"documentMode"in document&&(Ci=document.documentMode);var Mv=wr&&"TextEvent"in window&&!Ci,bg=wr&&(!wp||Ci&&8<Ci&&11>=Ci),b0=" ",v0=!1;function vg(e,t){switch(e){case"keyup":return Rv.indexOf(t.keyCode)!==-1;case"keydown":return t.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Sg(e){return e=e.detail,typeof e=="object"&&"data"in e?e.data:null}var Ks=!1;function Av(e,t){switch(e){case"compositionend":return Sg(t);case"keypress":return t.which!==32?null:(v0=!0,b0);case"textInput":return e=t.data,e===b0&&v0?null:e;default:return null}}function Nv(e,t){if(Ks)return e==="compositionend"||!wp&&vg(e,t)?(e=yg(),il=bp=Or=null,Ks=!1,e):null;switch(e){case"paste":return null;case"keypress":if(!(t.ctrlKey||t.altKey||t.metaKey)||t.ctrlKey&&t.altKey){if(t.char&&1<t.char.length)return t.char;if(t.which)return String.fromCharCode(t.which)}return null;case"compositionend":return bg&&t.locale!=="ko"?null:t.data;default:return null}}var Lv={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function S0(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t==="input"?!!Lv[e.type]:t==="textarea"}function wg(e,t,n,s){Zh(s),t=Al(t,"onChange"),0<t.length&&(n=new vp("onChange","change",null,n,s),e.push({event:n,listeners:t}))}var Ti=null,Di=null;function $v(e){Ng(e,0)}function cc(e){var t=Xs(e);if(Vh(t))return e}function Bv(e,t){if(e==="change")return t}var Eg=!1;if(wr){var md;if(wr){var hd="oninput"in document;if(!hd){var w0=document.createElement("div");w0.setAttribute("oninput","return;"),hd=typeof w0.oninput=="function"}md=hd}else md=!1;Eg=md&&(!document.documentMode||9<document.documentMode)}function E0(){Ti&&(Ti.detachEvent("onpropertychange",kg),Di=Ti=null)}function kg(e){if(e.propertyName==="value"&&cc(Di)){var t=[];wg(t,Di,e,mp(e)),rg($v,t)}}function Ov(e,t,n){e==="focusin"?(E0(),Ti=t,Di=n,Ti.attachEvent("onpropertychange",kg)):e==="focusout"&&E0()}function Pv(e){if(e==="selectionchange"||e==="keyup"||e==="keydown")return cc(Di)}function zv(e,t){if(e==="click")return cc(t)}function Dv(e,t){if(e==="input"||e==="change")return cc(t)}function Fv(e,t){return e===t&&(e!==0||1/e===1/t)||e!==e&&t!==t}var er=typeof Object.is=="function"?Object.is:Fv;function Fi(e,t){if(er(e,t))return!0;if(typeof e!="object"||e===null||typeof t!="object"||t===null)return!1;var n=Object.keys(e),s=Object.keys(t);if(n.length!==s.length)return!1;for(s=0;s<n.length;s++){var o=n[s];if(!Xd.call(t,o)||!er(e[o],t[o]))return!1}return!0}function k0(e){for(;e&&e.firstChild;)e=e.firstChild;return e}function j0(e,t){var n=k0(e);e=0;for(var s;n;){if(n.nodeType===3){if(s=e+n.textContent.length,e<=t&&s>=t)return{node:n,offset:t-e};e=s}e:{for(;n;){if(n.nextSibling){n=n.nextSibling;break e}n=n.parentNode}n=void 0}n=k0(n)}}function jg(e,t){return e&&t?e===t?!0:e&&e.nodeType===3?!1:t&&t.nodeType===3?jg(e,t.parentNode):"contains"in e?e.contains(t):e.compareDocumentPosition?!!(e.compareDocumentPosition(t)&16):!1:!1}function Cg(){for(var e=window,t=jl();t instanceof e.HTMLIFrameElement;){try{var n=typeof t.contentWindow.location.href=="string"}catch{n=!1}if(n)e=t.contentWindow;else break;t=jl(e.document)}return t}function Ep(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t&&(t==="input"&&(e.type==="text"||e.type==="search"||e.type==="tel"||e.type==="url"||e.type==="password")||t==="textarea"||e.contentEditable==="true")}function Hv(e){var t=Cg(),n=e.focusedElem,s=e.selectionRange;if(t!==n&&n&&n.ownerDocument&&jg(n.ownerDocument.documentElement,n)){if(s!==null&&Ep(n)){if(t=s.start,e=s.end,e===void 0&&(e=t),"selectionStart"in n)n.selectionStart=t,n.selectionEnd=Math.min(e,n.value.length);else if(e=(t=n.ownerDocument||document)&&t.defaultView||window,e.getSelection){e=e.getSelection();var o=n.textContent.length,i=Math.min(s.start,o);s=s.end===void 0?i:Math.min(s.end,o),!e.extend&&i>s&&(o=s,s=i,i=o),o=j0(n,i);var a=j0(n,s);o&&a&&(e.rangeCount!==1||e.anchorNode!==o.node||e.anchorOffset!==o.offset||e.focusNode!==a.node||e.focusOffset!==a.offset)&&(t=t.createRange(),t.setStart(o.node,o.offset),e.removeAllRanges(),i>s?(e.addRange(t),e.extend(a.node,a.offset)):(t.setEnd(a.node,a.offset),e.addRange(t)))}}for(t=[],e=n;e=e.parentNode;)e.nodeType===1&&t.push({element:e,left:e.scrollLeft,top:e.scrollTop});for(typeof n.focus=="function"&&n.focus(),n=0;n<t.length;n++)e=t[n],e.element.scrollLeft=e.left,e.element.scrollTop=e.top}}var Wv=wr&&"documentMode"in document&&11>=document.documentMode,Qs=null,xu=null,Ii=null,yu=!1;function C0(e,t,n){var s=n.window===n?n.document:n.nodeType===9?n:n.ownerDocument;yu||Qs==null||Qs!==jl(s)||(s=Qs,"selectionStart"in s&&Ep(s)?s={start:s.selectionStart,end:s.selectionEnd}:(s=(s.ownerDocument&&s.ownerDocument.defaultView||window).getSelection(),s={anchorNode:s.anchorNode,anchorOffset:s.anchorOffset,focusNode:s.focusNode,focusOffset:s.focusOffset}),Ii&&Fi(Ii,s)||(Ii=s,s=Al(xu,"onSelect"),0<s.length&&(t=new vp("onSelect","select",null,t,n),e.push({event:t,listeners:s}),t.target=Qs)))}function Pa(e,t){var n={};return n[e.toLowerCase()]=t.toLowerCase(),n["Webkit"+e]="webkit"+t,n["Moz"+e]="moz"+t,n}var Js={animationend:Pa("Animation","AnimationEnd"),animationiteration:Pa("Animation","AnimationIteration"),animationstart:Pa("Animation","AnimationStart"),transitionend:Pa("Transition","TransitionEnd")},gd={},Tg={};wr&&(Tg=document.createElement("div").style,"AnimationEvent"in window||(delete Js.animationend.animation,delete Js.animationiteration.animation,delete Js.animationstart.animation),"TransitionEvent"in window||delete Js.transitionend.transition);function dc(e){if(gd[e])return gd[e];if(!Js[e])return e;var t=Js[e],n;for(n in t)if(t.hasOwnProperty(n)&&n in Tg)return gd[e]=t[n];return e}var Ig=dc("animationend"),_g=dc("animationiteration"),Rg=dc("animationstart"),Mg=dc("transitionend"),Ag=new Map,T0="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function Xr(e,t){Ag.set(e,t),Ts(t,[e])}for(var xd=0;xd<T0.length;xd++){var yd=T0[xd],Uv=yd.toLowerCase(),Gv=yd[0].toUpperCase()+yd.slice(1);Xr(Uv,"on"+Gv)}Xr(Ig,"onAnimationEnd");Xr(_g,"onAnimationIteration");Xr(Rg,"onAnimationStart");Xr("dblclick","onDoubleClick");Xr("focusin","onFocus");Xr("focusout","onBlur");Xr(Mg,"onTransitionEnd");go("onMouseEnter",["mouseout","mouseover"]);go("onMouseLeave",["mouseout","mouseover"]);go("onPointerEnter",["pointerout","pointerover"]);go("onPointerLeave",["pointerout","pointerover"]);Ts("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));Ts("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));Ts("onBeforeInput",["compositionend","keypress","textInput","paste"]);Ts("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));Ts("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));Ts("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Si="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),Vv=new Set("cancel close invalid load scroll toggle".split(" ").concat(Si));function I0(e,t,n){var s=e.type||"unknown-event";e.currentTarget=n,Ub(s,t,void 0,e),e.currentTarget=null}function Ng(e,t){t=(t&4)!==0;for(var n=0;n<e.length;n++){var s=e[n],o=s.event;s=s.listeners;e:{var i=void 0;if(t)for(var a=s.length-1;0<=a;a--){var l=s[a],d=l.instance,p=l.currentTarget;if(l=l.listener,d!==i&&o.isPropagationStopped())break e;I0(o,l,p),i=d}else for(a=0;a<s.length;a++){if(l=s[a],d=l.instance,p=l.currentTarget,l=l.listener,d!==i&&o.isPropagationStopped())break e;I0(o,l,p),i=d}}}if(Tl)throw e=fu,Tl=!1,fu=null,e}function ht(e,t){var n=t[Eu];n===void 0&&(n=t[Eu]=new Set);var s=e+"__bubble";n.has(s)||(Lg(t,e,2,!1),n.add(s))}function bd(e,t,n){var s=0;t&&(s|=4),Lg(n,e,s,t)}var za="_reactListening"+Math.random().toString(36).slice(2);function Hi(e){if(!e[za]){e[za]=!0,Fh.forEach(function(n){n!=="selectionchange"&&(Vv.has(n)||bd(n,!1,e),bd(n,!0,e))});var t=e.nodeType===9?e:e.ownerDocument;t===null||t[za]||(t[za]=!0,bd("selectionchange",!1,t))}}function Lg(e,t,n,s){switch(xg(t)){case 1:var o=iv;break;case 4:o=av;break;default:o=yp}n=o.bind(null,t,n,e),o=void 0,!pu||t!=="touchstart"&&t!=="touchmove"&&t!=="wheel"||(o=!0),s?o!==void 0?e.addEventListener(t,n,{capture:!0,passive:o}):e.addEventListener(t,n,!0):o!==void 0?e.addEventListener(t,n,{passive:o}):e.addEventListener(t,n,!1)}function vd(e,t,n,s,o){var i=s;if(!(t&1)&&!(t&2)&&s!==null)e:for(;;){if(s===null)return;var a=s.tag;if(a===3||a===4){var l=s.stateNode.containerInfo;if(l===o||l.nodeType===8&&l.parentNode===o)break;if(a===4)for(a=s.return;a!==null;){var d=a.tag;if((d===3||d===4)&&(d=a.stateNode.containerInfo,d===o||d.nodeType===8&&d.parentNode===o))return;a=a.return}for(;l!==null;){if(a=ps(l),a===null)return;if(d=a.tag,d===5||d===6){s=i=a;continue e}l=l.parentNode}}s=s.return}rg(function(){var p=i,f=mp(n),c=[];e:{var u=Ag.get(e);if(u!==void 0){var x=vp,S=e;switch(e){case"keypress":if(al(n)===0)break e;case"keydown":case"keyup":x=wv;break;case"focusin":S="focus",x=fd;break;case"focusout":S="blur",x=fd;break;case"beforeblur":case"afterblur":x=fd;break;case"click":if(n.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":x=g0;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":x=dv;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":x=jv;break;case Ig:case _g:case Rg:x=fv;break;case Mg:x=Tv;break;case"scroll":x=lv;break;case"wheel":x=_v;break;case"copy":case"cut":case"paste":x=hv;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":x=y0}var w=(t&4)!==0,C=!w&&e==="scroll",h=w?u!==null?u+"Capture":null:u;w=[];for(var g=p,b;g!==null;){b=g;var E=b.stateNode;if(b.tag===5&&E!==null&&(b=E,h!==null&&(E=Bi(g,h),E!=null&&w.push(Wi(g,E,b)))),C)break;g=g.return}0<w.length&&(u=new x(u,S,null,n,f),c.push({event:u,listeners:w}))}}if(!(t&7)){e:{if(u=e==="mouseover"||e==="pointerover",x=e==="mouseout"||e==="pointerout",u&&n!==du&&(S=n.relatedTarget||n.fromElement)&&(ps(S)||S[Er]))break e;if((x||u)&&(u=f.window===f?f:(u=f.ownerDocument)?u.defaultView||u.parentWindow:window,x?(S=n.relatedTarget||n.toElement,x=p,S=S?ps(S):null,S!==null&&(C=Is(S),S!==C||S.tag!==5&&S.tag!==6)&&(S=null)):(x=null,S=p),x!==S)){if(w=g0,E="onMouseLeave",h="onMouseEnter",g="mouse",(e==="pointerout"||e==="pointerover")&&(w=y0,E="onPointerLeave",h="onPointerEnter",g="pointer"),C=x==null?u:Xs(x),b=S==null?u:Xs(S),u=new w(E,g+"leave",x,n,f),u.target=C,u.relatedTarget=b,E=null,ps(f)===p&&(w=new w(h,g+"enter",S,n,f),w.target=b,w.relatedTarget=C,E=w),C=E,x&&S)t:{for(w=x,h=S,g=0,b=w;b;b=Ps(b))g++;for(b=0,E=h;E;E=Ps(E))b++;for(;0<g-b;)w=Ps(w),g--;for(;0<b-g;)h=Ps(h),b--;for(;g--;){if(w===h||h!==null&&w===h.alternate)break t;w=Ps(w),h=Ps(h)}w=null}else w=null;x!==null&&_0(c,u,x,w,!1),S!==null&&C!==null&&_0(c,C,S,w,!0)}}e:{if(u=p?Xs(p):window,x=u.nodeName&&u.nodeName.toLowerCase(),x==="select"||x==="input"&&u.type==="file")var I=Bv;else if(S0(u))if(Eg)I=Dv;else{I=Pv;var v=Ov}else(x=u.nodeName)&&x.toLowerCase()==="input"&&(u.type==="checkbox"||u.type==="radio")&&(I=zv);if(I&&(I=I(e,p))){wg(c,I,n,f);break e}v&&v(e,u,p),e==="focusout"&&(v=u._wrapperState)&&v.controlled&&u.type==="number"&&ou(u,"number",u.value)}switch(v=p?Xs(p):window,e){case"focusin":(S0(v)||v.contentEditable==="true")&&(Qs=v,xu=p,Ii=null);break;case"focusout":Ii=xu=Qs=null;break;case"mousedown":yu=!0;break;case"contextmenu":case"mouseup":case"dragend":yu=!1,C0(c,n,f);break;case"selectionchange":if(Wv)break;case"keydown":case"keyup":C0(c,n,f)}var k;if(wp)e:{switch(e){case"compositionstart":var T="onCompositionStart";break e;case"compositionend":T="onCompositionEnd";break e;case"compositionupdate":T="onCompositionUpdate";break e}T=void 0}else Ks?vg(e,n)&&(T="onCompositionEnd"):e==="keydown"&&n.keyCode===229&&(T="onCompositionStart");T&&(bg&&n.locale!=="ko"&&(Ks||T!=="onCompositionStart"?T==="onCompositionEnd"&&Ks&&(k=yg()):(Or=f,bp="value"in Or?Or.value:Or.textContent,Ks=!0)),v=Al(p,T),0<v.length&&(T=new x0(T,e,null,n,f),c.push({event:T,listeners:v}),k?T.data=k:(k=Sg(n),k!==null&&(T.data=k)))),(k=Mv?Av(e,n):Nv(e,n))&&(p=Al(p,"onBeforeInput"),0<p.length&&(f=new x0("onBeforeInput","beforeinput",null,n,f),c.push({event:f,listeners:p}),f.data=k))}Ng(c,t)})}function Wi(e,t,n){return{instance:e,listener:t,currentTarget:n}}function Al(e,t){for(var n=t+"Capture",s=[];e!==null;){var o=e,i=o.stateNode;o.tag===5&&i!==null&&(o=i,i=Bi(e,n),i!=null&&s.unshift(Wi(e,i,o)),i=Bi(e,t),i!=null&&s.push(Wi(e,i,o))),e=e.return}return s}function Ps(e){if(e===null)return null;do e=e.return;while(e&&e.tag!==5);return e||null}function _0(e,t,n,s,o){for(var i=t._reactName,a=[];n!==null&&n!==s;){var l=n,d=l.alternate,p=l.stateNode;if(d!==null&&d===s)break;l.tag===5&&p!==null&&(l=p,o?(d=Bi(n,i),d!=null&&a.unshift(Wi(n,d,l))):o||(d=Bi(n,i),d!=null&&a.push(Wi(n,d,l)))),n=n.return}a.length!==0&&e.push({event:t,listeners:a})}var Yv=/\r\n?/g,qv=/\u0000|\uFFFD/g;function R0(e){return(typeof e=="string"?e:""+e).replace(Yv,`
`).replace(qv,"")}function Da(e,t,n){if(t=R0(t),R0(e)!==t&&n)throw Error(le(425))}function Nl(){}var bu=null,vu=null;function Su(e,t){return e==="textarea"||e==="noscript"||typeof t.children=="string"||typeof t.children=="number"||typeof t.dangerouslySetInnerHTML=="object"&&t.dangerouslySetInnerHTML!==null&&t.dangerouslySetInnerHTML.__html!=null}var wu=typeof setTimeout=="function"?setTimeout:void 0,Kv=typeof clearTimeout=="function"?clearTimeout:void 0,M0=typeof Promise=="function"?Promise:void 0,Qv=typeof queueMicrotask=="function"?queueMicrotask:typeof M0<"u"?function(e){return M0.resolve(null).then(e).catch(Jv)}:wu;function Jv(e){setTimeout(function(){throw e})}function Sd(e,t){var n=t,s=0;do{var o=n.nextSibling;if(e.removeChild(n),o&&o.nodeType===8)if(n=o.data,n==="/$"){if(s===0){e.removeChild(o),zi(t);return}s--}else n!=="$"&&n!=="$?"&&n!=="$!"||s++;n=o}while(n);zi(t)}function Wr(e){for(;e!=null;e=e.nextSibling){var t=e.nodeType;if(t===1||t===3)break;if(t===8){if(t=e.data,t==="$"||t==="$!"||t==="$?")break;if(t==="/$")return null}}return e}function A0(e){e=e.previousSibling;for(var t=0;e;){if(e.nodeType===8){var n=e.data;if(n==="$"||n==="$!"||n==="$?"){if(t===0)return e;t--}else n==="/$"&&t++}e=e.previousSibling}return null}var To=Math.random().toString(36).slice(2),lr="__reactFiber$"+To,Ui="__reactProps$"+To,Er="__reactContainer$"+To,Eu="__reactEvents$"+To,Xv="__reactListeners$"+To,Zv="__reactHandles$"+To;function ps(e){var t=e[lr];if(t)return t;for(var n=e.parentNode;n;){if(t=n[Er]||n[lr]){if(n=t.alternate,t.child!==null||n!==null&&n.child!==null)for(e=A0(e);e!==null;){if(n=e[lr])return n;e=A0(e)}return t}e=n,n=e.parentNode}return null}function na(e){return e=e[lr]||e[Er],!e||e.tag!==5&&e.tag!==6&&e.tag!==13&&e.tag!==3?null:e}function Xs(e){if(e.tag===5||e.tag===6)return e.stateNode;throw Error(le(33))}function uc(e){return e[Ui]||null}var ku=[],Zs=-1;function Zr(e){return{current:e}}function gt(e){0>Zs||(e.current=ku[Zs],ku[Zs]=null,Zs--)}function ft(e,t){Zs++,ku[Zs]=e.current,e.current=t}var Qr={},en=Zr(Qr),gn=Zr(!1),vs=Qr;function xo(e,t){var n=e.type.contextTypes;if(!n)return Qr;var s=e.stateNode;if(s&&s.__reactInternalMemoizedUnmaskedChildContext===t)return s.__reactInternalMemoizedMaskedChildContext;var o={},i;for(i in n)o[i]=t[i];return s&&(e=e.stateNode,e.__reactInternalMemoizedUnmaskedChildContext=t,e.__reactInternalMemoizedMaskedChildContext=o),o}function xn(e){return e=e.childContextTypes,e!=null}function Ll(){gt(gn),gt(en)}function N0(e,t,n){if(en.current!==Qr)throw Error(le(168));ft(en,t),ft(gn,n)}function $g(e,t,n){var s=e.stateNode;if(t=t.childContextTypes,typeof s.getChildContext!="function")return n;s=s.getChildContext();for(var o in s)if(!(o in t))throw Error(le(108,Ob(e)||"Unknown",o));return jt({},n,s)}function $l(e){return e=(e=e.stateNode)&&e.__reactInternalMemoizedMergedChildContext||Qr,vs=en.current,ft(en,e),ft(gn,gn.current),!0}function L0(e,t,n){var s=e.stateNode;if(!s)throw Error(le(169));n?(e=$g(e,t,vs),s.__reactInternalMemoizedMergedChildContext=e,gt(gn),gt(en),ft(en,e)):gt(gn),ft(gn,n)}var gr=null,pc=!1,wd=!1;function Bg(e){gr===null?gr=[e]:gr.push(e)}function eS(e){pc=!0,Bg(e)}function es(){if(!wd&&gr!==null){wd=!0;var e=0,t=at;try{var n=gr;for(at=1;e<n.length;e++){var s=n[e];do s=s(!0);while(s!==null)}gr=null,pc=!1}catch(o){throw gr!==null&&(gr=gr.slice(e+1)),ag(hp,es),o}finally{at=t,wd=!1}}return null}var eo=[],to=0,Bl=null,Ol=0,Bn=[],On=0,Ss=null,yr=1,br="";function ds(e,t){eo[to++]=Ol,eo[to++]=Bl,Bl=e,Ol=t}function Og(e,t,n){Bn[On++]=yr,Bn[On++]=br,Bn[On++]=Ss,Ss=e;var s=yr;e=br;var o=32-Xn(s)-1;s&=~(1<<o),n+=1;var i=32-Xn(t)+o;if(30<i){var a=o-o%5;i=(s&(1<<a)-1).toString(32),s>>=a,o-=a,yr=1<<32-Xn(t)+o|n<<o|s,br=i+e}else yr=1<<i|n<<o|s,br=e}function kp(e){e.return!==null&&(ds(e,1),Og(e,1,0))}function jp(e){for(;e===Bl;)Bl=eo[--to],eo[to]=null,Ol=eo[--to],eo[to]=null;for(;e===Ss;)Ss=Bn[--On],Bn[On]=null,br=Bn[--On],Bn[On]=null,yr=Bn[--On],Bn[On]=null}var jn=null,kn=null,bt=!1,Jn=null;function Pg(e,t){var n=Dn(5,null,null,0);n.elementType="DELETED",n.stateNode=t,n.return=e,t=e.deletions,t===null?(e.deletions=[n],e.flags|=16):t.push(n)}function $0(e,t){switch(e.tag){case 5:var n=e.type;return t=t.nodeType!==1||n.toLowerCase()!==t.nodeName.toLowerCase()?null:t,t!==null?(e.stateNode=t,jn=e,kn=Wr(t.firstChild),!0):!1;case 6:return t=e.pendingProps===""||t.nodeType!==3?null:t,t!==null?(e.stateNode=t,jn=e,kn=null,!0):!1;case 13:return t=t.nodeType!==8?null:t,t!==null?(n=Ss!==null?{id:yr,overflow:br}:null,e.memoizedState={dehydrated:t,treeContext:n,retryLane:1073741824},n=Dn(18,null,null,0),n.stateNode=t,n.return=e,e.child=n,jn=e,kn=null,!0):!1;default:return!1}}function ju(e){return(e.mode&1)!==0&&(e.flags&128)===0}function Cu(e){if(bt){var t=kn;if(t){var n=t;if(!$0(e,t)){if(ju(e))throw Error(le(418));t=Wr(n.nextSibling);var s=jn;t&&$0(e,t)?Pg(s,n):(e.flags=e.flags&-4097|2,bt=!1,jn=e)}}else{if(ju(e))throw Error(le(418));e.flags=e.flags&-4097|2,bt=!1,jn=e}}}function B0(e){for(e=e.return;e!==null&&e.tag!==5&&e.tag!==3&&e.tag!==13;)e=e.return;jn=e}function Fa(e){if(e!==jn)return!1;if(!bt)return B0(e),bt=!0,!1;var t;if((t=e.tag!==3)&&!(t=e.tag!==5)&&(t=e.type,t=t!=="head"&&t!=="body"&&!Su(e.type,e.memoizedProps)),t&&(t=kn)){if(ju(e))throw zg(),Error(le(418));for(;t;)Pg(e,t),t=Wr(t.nextSibling)}if(B0(e),e.tag===13){if(e=e.memoizedState,e=e!==null?e.dehydrated:null,!e)throw Error(le(317));e:{for(e=e.nextSibling,t=0;e;){if(e.nodeType===8){var n=e.data;if(n==="/$"){if(t===0){kn=Wr(e.nextSibling);break e}t--}else n!=="$"&&n!=="$!"&&n!=="$?"||t++}e=e.nextSibling}kn=null}}else kn=jn?Wr(e.stateNode.nextSibling):null;return!0}function zg(){for(var e=kn;e;)e=Wr(e.nextSibling)}function yo(){kn=jn=null,bt=!1}function Cp(e){Jn===null?Jn=[e]:Jn.push(e)}var tS=Tr.ReactCurrentBatchConfig;function li(e,t,n){if(e=n.ref,e!==null&&typeof e!="function"&&typeof e!="object"){if(n._owner){if(n=n._owner,n){if(n.tag!==1)throw Error(le(309));var s=n.stateNode}if(!s)throw Error(le(147,e));var o=s,i=""+e;return t!==null&&t.ref!==null&&typeof t.ref=="function"&&t.ref._stringRef===i?t.ref:(t=function(a){var l=o.refs;a===null?delete l[i]:l[i]=a},t._stringRef=i,t)}if(typeof e!="string")throw Error(le(284));if(!n._owner)throw Error(le(290,e))}return e}function Ha(e,t){throw e=Object.prototype.toString.call(t),Error(le(31,e==="[object Object]"?"object with keys {"+Object.keys(t).join(", ")+"}":e))}function O0(e){var t=e._init;return t(e._payload)}function Dg(e){function t(h,g){if(e){var b=h.deletions;b===null?(h.deletions=[g],h.flags|=16):b.push(g)}}function n(h,g){if(!e)return null;for(;g!==null;)t(h,g),g=g.sibling;return null}function s(h,g){for(h=new Map;g!==null;)g.key!==null?h.set(g.key,g):h.set(g.index,g),g=g.sibling;return h}function o(h,g){return h=Yr(h,g),h.index=0,h.sibling=null,h}function i(h,g,b){return h.index=b,e?(b=h.alternate,b!==null?(b=b.index,b<g?(h.flags|=2,g):b):(h.flags|=2,g)):(h.flags|=1048576,g)}function a(h){return e&&h.alternate===null&&(h.flags|=2),h}function l(h,g,b,E){return g===null||g.tag!==6?(g=_d(b,h.mode,E),g.return=h,g):(g=o(g,b),g.return=h,g)}function d(h,g,b,E){var I=b.type;return I===qs?f(h,g,b.props.children,E,b.key):g!==null&&(g.elementType===I||typeof I=="object"&&I!==null&&I.$$typeof===Ar&&O0(I)===g.type)?(E=o(g,b.props),E.ref=li(h,g,b),E.return=h,E):(E=ml(b.type,b.key,b.props,null,h.mode,E),E.ref=li(h,g,b),E.return=h,E)}function p(h,g,b,E){return g===null||g.tag!==4||g.stateNode.containerInfo!==b.containerInfo||g.stateNode.implementation!==b.implementation?(g=Rd(b,h.mode,E),g.return=h,g):(g=o(g,b.children||[]),g.return=h,g)}function f(h,g,b,E,I){return g===null||g.tag!==7?(g=gs(b,h.mode,E,I),g.return=h,g):(g=o(g,b),g.return=h,g)}function c(h,g,b){if(typeof g=="string"&&g!==""||typeof g=="number")return g=_d(""+g,h.mode,b),g.return=h,g;if(typeof g=="object"&&g!==null){switch(g.$$typeof){case Ma:return b=ml(g.type,g.key,g.props,null,h.mode,b),b.ref=li(h,null,g),b.return=h,b;case Ys:return g=Rd(g,h.mode,b),g.return=h,g;case Ar:var E=g._init;return c(h,E(g._payload),b)}if(bi(g)||ri(g))return g=gs(g,h.mode,b,null),g.return=h,g;Ha(h,g)}return null}function u(h,g,b,E){var I=g!==null?g.key:null;if(typeof b=="string"&&b!==""||typeof b=="number")return I!==null?null:l(h,g,""+b,E);if(typeof b=="object"&&b!==null){switch(b.$$typeof){case Ma:return b.key===I?d(h,g,b,E):null;case Ys:return b.key===I?p(h,g,b,E):null;case Ar:return I=b._init,u(h,g,I(b._payload),E)}if(bi(b)||ri(b))return I!==null?null:f(h,g,b,E,null);Ha(h,b)}return null}function x(h,g,b,E,I){if(typeof E=="string"&&E!==""||typeof E=="number")return h=h.get(b)||null,l(g,h,""+E,I);if(typeof E=="object"&&E!==null){switch(E.$$typeof){case Ma:return h=h.get(E.key===null?b:E.key)||null,d(g,h,E,I);case Ys:return h=h.get(E.key===null?b:E.key)||null,p(g,h,E,I);case Ar:var v=E._init;return x(h,g,b,v(E._payload),I)}if(bi(E)||ri(E))return h=h.get(b)||null,f(g,h,E,I,null);Ha(g,E)}return null}function S(h,g,b,E){for(var I=null,v=null,k=g,T=g=0,A=null;k!==null&&T<b.length;T++){k.index>T?(A=k,k=null):A=k.sibling;var R=u(h,k,b[T],E);if(R===null){k===null&&(k=A);break}e&&k&&R.alternate===null&&t(h,k),g=i(R,g,T),v===null?I=R:v.sibling=R,v=R,k=A}if(T===b.length)return n(h,k),bt&&ds(h,T),I;if(k===null){for(;T<b.length;T++)k=c(h,b[T],E),k!==null&&(g=i(k,g,T),v===null?I=k:v.sibling=k,v=k);return bt&&ds(h,T),I}for(k=s(h,k);T<b.length;T++)A=x(k,h,T,b[T],E),A!==null&&(e&&A.alternate!==null&&k.delete(A.key===null?T:A.key),g=i(A,g,T),v===null?I=A:v.sibling=A,v=A);return e&&k.forEach(function($){return t(h,$)}),bt&&ds(h,T),I}function w(h,g,b,E){var I=ri(b);if(typeof I!="function")throw Error(le(150));if(b=I.call(b),b==null)throw Error(le(151));for(var v=I=null,k=g,T=g=0,A=null,R=b.next();k!==null&&!R.done;T++,R=b.next()){k.index>T?(A=k,k=null):A=k.sibling;var $=u(h,k,R.value,E);if($===null){k===null&&(k=A);break}e&&k&&$.alternate===null&&t(h,k),g=i($,g,T),v===null?I=$:v.sibling=$,v=$,k=A}if(R.done)return n(h,k),bt&&ds(h,T),I;if(k===null){for(;!R.done;T++,R=b.next())R=c(h,R.value,E),R!==null&&(g=i(R,g,T),v===null?I=R:v.sibling=R,v=R);return bt&&ds(h,T),I}for(k=s(h,k);!R.done;T++,R=b.next())R=x(k,h,T,R.value,E),R!==null&&(e&&R.alternate!==null&&k.delete(R.key===null?T:R.key),g=i(R,g,T),v===null?I=R:v.sibling=R,v=R);return e&&k.forEach(function(O){return t(h,O)}),bt&&ds(h,T),I}function C(h,g,b,E){if(typeof b=="object"&&b!==null&&b.type===qs&&b.key===null&&(b=b.props.children),typeof b=="object"&&b!==null){switch(b.$$typeof){case Ma:e:{for(var I=b.key,v=g;v!==null;){if(v.key===I){if(I=b.type,I===qs){if(v.tag===7){n(h,v.sibling),g=o(v,b.props.children),g.return=h,h=g;break e}}else if(v.elementType===I||typeof I=="object"&&I!==null&&I.$$typeof===Ar&&O0(I)===v.type){n(h,v.sibling),g=o(v,b.props),g.ref=li(h,v,b),g.return=h,h=g;break e}n(h,v);break}else t(h,v);v=v.sibling}b.type===qs?(g=gs(b.props.children,h.mode,E,b.key),g.return=h,h=g):(E=ml(b.type,b.key,b.props,null,h.mode,E),E.ref=li(h,g,b),E.return=h,h=E)}return a(h);case Ys:e:{for(v=b.key;g!==null;){if(g.key===v)if(g.tag===4&&g.stateNode.containerInfo===b.containerInfo&&g.stateNode.implementation===b.implementation){n(h,g.sibling),g=o(g,b.children||[]),g.return=h,h=g;break e}else{n(h,g);break}else t(h,g);g=g.sibling}g=Rd(b,h.mode,E),g.return=h,h=g}return a(h);case Ar:return v=b._init,C(h,g,v(b._payload),E)}if(bi(b))return S(h,g,b,E);if(ri(b))return w(h,g,b,E);Ha(h,b)}return typeof b=="string"&&b!==""||typeof b=="number"?(b=""+b,g!==null&&g.tag===6?(n(h,g.sibling),g=o(g,b),g.return=h,h=g):(n(h,g),g=_d(b,h.mode,E),g.return=h,h=g),a(h)):n(h,g)}return C}var bo=Dg(!0),Fg=Dg(!1),Pl=Zr(null),zl=null,no=null,Tp=null;function Ip(){Tp=no=zl=null}function _p(e){var t=Pl.current;gt(Pl),e._currentValue=t}function Tu(e,t,n){for(;e!==null;){var s=e.alternate;if((e.childLanes&t)!==t?(e.childLanes|=t,s!==null&&(s.childLanes|=t)):s!==null&&(s.childLanes&t)!==t&&(s.childLanes|=t),e===n)break;e=e.return}}function uo(e,t){zl=e,Tp=no=null,e=e.dependencies,e!==null&&e.firstContext!==null&&(e.lanes&t&&(hn=!0),e.firstContext=null)}function Hn(e){var t=e._currentValue;if(Tp!==e)if(e={context:e,memoizedValue:t,next:null},no===null){if(zl===null)throw Error(le(308));no=e,zl.dependencies={lanes:0,firstContext:e}}else no=no.next=e;return t}var fs=null;function Rp(e){fs===null?fs=[e]:fs.push(e)}function Hg(e,t,n,s){var o=t.interleaved;return o===null?(n.next=n,Rp(t)):(n.next=o.next,o.next=n),t.interleaved=n,kr(e,s)}function kr(e,t){e.lanes|=t;var n=e.alternate;for(n!==null&&(n.lanes|=t),n=e,e=e.return;e!==null;)e.childLanes|=t,n=e.alternate,n!==null&&(n.childLanes|=t),n=e,e=e.return;return n.tag===3?n.stateNode:null}var Nr=!1;function Mp(e){e.updateQueue={baseState:e.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function Wg(e,t){e=e.updateQueue,t.updateQueue===e&&(t.updateQueue={baseState:e.baseState,firstBaseUpdate:e.firstBaseUpdate,lastBaseUpdate:e.lastBaseUpdate,shared:e.shared,effects:e.effects})}function Sr(e,t){return{eventTime:e,lane:t,tag:0,payload:null,callback:null,next:null}}function Ur(e,t,n){var s=e.updateQueue;if(s===null)return null;if(s=s.shared,tt&2){var o=s.pending;return o===null?t.next=t:(t.next=o.next,o.next=t),s.pending=t,kr(e,n)}return o=s.interleaved,o===null?(t.next=t,Rp(s)):(t.next=o.next,o.next=t),s.interleaved=t,kr(e,n)}function ll(e,t,n){if(t=t.updateQueue,t!==null&&(t=t.shared,(n&4194240)!==0)){var s=t.lanes;s&=e.pendingLanes,n|=s,t.lanes=n,gp(e,n)}}function P0(e,t){var n=e.updateQueue,s=e.alternate;if(s!==null&&(s=s.updateQueue,n===s)){var o=null,i=null;if(n=n.firstBaseUpdate,n!==null){do{var a={eventTime:n.eventTime,lane:n.lane,tag:n.tag,payload:n.payload,callback:n.callback,next:null};i===null?o=i=a:i=i.next=a,n=n.next}while(n!==null);i===null?o=i=t:i=i.next=t}else o=i=t;n={baseState:s.baseState,firstBaseUpdate:o,lastBaseUpdate:i,shared:s.shared,effects:s.effects},e.updateQueue=n;return}e=n.lastBaseUpdate,e===null?n.firstBaseUpdate=t:e.next=t,n.lastBaseUpdate=t}function Dl(e,t,n,s){var o=e.updateQueue;Nr=!1;var i=o.firstBaseUpdate,a=o.lastBaseUpdate,l=o.shared.pending;if(l!==null){o.shared.pending=null;var d=l,p=d.next;d.next=null,a===null?i=p:a.next=p,a=d;var f=e.alternate;f!==null&&(f=f.updateQueue,l=f.lastBaseUpdate,l!==a&&(l===null?f.firstBaseUpdate=p:l.next=p,f.lastBaseUpdate=d))}if(i!==null){var c=o.baseState;a=0,f=p=d=null,l=i;do{var u=l.lane,x=l.eventTime;if((s&u)===u){f!==null&&(f=f.next={eventTime:x,lane:0,tag:l.tag,payload:l.payload,callback:l.callback,next:null});e:{var S=e,w=l;switch(u=t,x=n,w.tag){case 1:if(S=w.payload,typeof S=="function"){c=S.call(x,c,u);break e}c=S;break e;case 3:S.flags=S.flags&-65537|128;case 0:if(S=w.payload,u=typeof S=="function"?S.call(x,c,u):S,u==null)break e;c=jt({},c,u);break e;case 2:Nr=!0}}l.callback!==null&&l.lane!==0&&(e.flags|=64,u=o.effects,u===null?o.effects=[l]:u.push(l))}else x={eventTime:x,lane:u,tag:l.tag,payload:l.payload,callback:l.callback,next:null},f===null?(p=f=x,d=c):f=f.next=x,a|=u;if(l=l.next,l===null){if(l=o.shared.pending,l===null)break;u=l,l=u.next,u.next=null,o.lastBaseUpdate=u,o.shared.pending=null}}while(!0);if(f===null&&(d=c),o.baseState=d,o.firstBaseUpdate=p,o.lastBaseUpdate=f,t=o.shared.interleaved,t!==null){o=t;do a|=o.lane,o=o.next;while(o!==t)}else i===null&&(o.shared.lanes=0);Es|=a,e.lanes=a,e.memoizedState=c}}function z0(e,t,n){if(e=t.effects,t.effects=null,e!==null)for(t=0;t<e.length;t++){var s=e[t],o=s.callback;if(o!==null){if(s.callback=null,s=n,typeof o!="function")throw Error(le(191,o));o.call(s)}}}var ra={},dr=Zr(ra),Gi=Zr(ra),Vi=Zr(ra);function ms(e){if(e===ra)throw Error(le(174));return e}function Ap(e,t){switch(ft(Vi,t),ft(Gi,e),ft(dr,ra),e=t.nodeType,e){case 9:case 11:t=(t=t.documentElement)?t.namespaceURI:au(null,"");break;default:e=e===8?t.parentNode:t,t=e.namespaceURI||null,e=e.tagName,t=au(t,e)}gt(dr),ft(dr,t)}function vo(){gt(dr),gt(Gi),gt(Vi)}function Ug(e){ms(Vi.current);var t=ms(dr.current),n=au(t,e.type);t!==n&&(ft(Gi,e),ft(dr,n))}function Np(e){Gi.current===e&&(gt(dr),gt(Gi))}var Et=Zr(0);function Fl(e){for(var t=e;t!==null;){if(t.tag===13){var n=t.memoizedState;if(n!==null&&(n=n.dehydrated,n===null||n.data==="$?"||n.data==="$!"))return t}else if(t.tag===19&&t.memoizedProps.revealOrder!==void 0){if(t.flags&128)return t}else if(t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break;for(;t.sibling===null;){if(t.return===null||t.return===e)return null;t=t.return}t.sibling.return=t.return,t=t.sibling}return null}var Ed=[];function Lp(){for(var e=0;e<Ed.length;e++)Ed[e]._workInProgressVersionPrimary=null;Ed.length=0}var cl=Tr.ReactCurrentDispatcher,kd=Tr.ReactCurrentBatchConfig,ws=0,kt=null,Nt=null,zt=null,Hl=!1,_i=!1,Yi=0,nS=0;function Qt(){throw Error(le(321))}function $p(e,t){if(t===null)return!1;for(var n=0;n<t.length&&n<e.length;n++)if(!er(e[n],t[n]))return!1;return!0}function Bp(e,t,n,s,o,i){if(ws=i,kt=t,t.memoizedState=null,t.updateQueue=null,t.lanes=0,cl.current=e===null||e.memoizedState===null?iS:aS,e=n(s,o),_i){i=0;do{if(_i=!1,Yi=0,25<=i)throw Error(le(301));i+=1,zt=Nt=null,t.updateQueue=null,cl.current=lS,e=n(s,o)}while(_i)}if(cl.current=Wl,t=Nt!==null&&Nt.next!==null,ws=0,zt=Nt=kt=null,Hl=!1,t)throw Error(le(300));return e}function Op(){var e=Yi!==0;return Yi=0,e}function ar(){var e={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return zt===null?kt.memoizedState=zt=e:zt=zt.next=e,zt}function Wn(){if(Nt===null){var e=kt.alternate;e=e!==null?e.memoizedState:null}else e=Nt.next;var t=zt===null?kt.memoizedState:zt.next;if(t!==null)zt=t,Nt=e;else{if(e===null)throw Error(le(310));Nt=e,e={memoizedState:Nt.memoizedState,baseState:Nt.baseState,baseQueue:Nt.baseQueue,queue:Nt.queue,next:null},zt===null?kt.memoizedState=zt=e:zt=zt.next=e}return zt}function qi(e,t){return typeof t=="function"?t(e):t}function jd(e){var t=Wn(),n=t.queue;if(n===null)throw Error(le(311));n.lastRenderedReducer=e;var s=Nt,o=s.baseQueue,i=n.pending;if(i!==null){if(o!==null){var a=o.next;o.next=i.next,i.next=a}s.baseQueue=o=i,n.pending=null}if(o!==null){i=o.next,s=s.baseState;var l=a=null,d=null,p=i;do{var f=p.lane;if((ws&f)===f)d!==null&&(d=d.next={lane:0,action:p.action,hasEagerState:p.hasEagerState,eagerState:p.eagerState,next:null}),s=p.hasEagerState?p.eagerState:e(s,p.action);else{var c={lane:f,action:p.action,hasEagerState:p.hasEagerState,eagerState:p.eagerState,next:null};d===null?(l=d=c,a=s):d=d.next=c,kt.lanes|=f,Es|=f}p=p.next}while(p!==null&&p!==i);d===null?a=s:d.next=l,er(s,t.memoizedState)||(hn=!0),t.memoizedState=s,t.baseState=a,t.baseQueue=d,n.lastRenderedState=s}if(e=n.interleaved,e!==null){o=e;do i=o.lane,kt.lanes|=i,Es|=i,o=o.next;while(o!==e)}else o===null&&(n.lanes=0);return[t.memoizedState,n.dispatch]}function Cd(e){var t=Wn(),n=t.queue;if(n===null)throw Error(le(311));n.lastRenderedReducer=e;var s=n.dispatch,o=n.pending,i=t.memoizedState;if(o!==null){n.pending=null;var a=o=o.next;do i=e(i,a.action),a=a.next;while(a!==o);er(i,t.memoizedState)||(hn=!0),t.memoizedState=i,t.baseQueue===null&&(t.baseState=i),n.lastRenderedState=i}return[i,s]}function Gg(){}function Vg(e,t){var n=kt,s=Wn(),o=t(),i=!er(s.memoizedState,o);if(i&&(s.memoizedState=o,hn=!0),s=s.queue,Pp(Kg.bind(null,n,s,e),[e]),s.getSnapshot!==t||i||zt!==null&&zt.memoizedState.tag&1){if(n.flags|=2048,Ki(9,qg.bind(null,n,s,o,t),void 0,null),Dt===null)throw Error(le(349));ws&30||Yg(n,t,o)}return o}function Yg(e,t,n){e.flags|=16384,e={getSnapshot:t,value:n},t=kt.updateQueue,t===null?(t={lastEffect:null,stores:null},kt.updateQueue=t,t.stores=[e]):(n=t.stores,n===null?t.stores=[e]:n.push(e))}function qg(e,t,n,s){t.value=n,t.getSnapshot=s,Qg(t)&&Jg(e)}function Kg(e,t,n){return n(function(){Qg(t)&&Jg(e)})}function Qg(e){var t=e.getSnapshot;e=e.value;try{var n=t();return!er(e,n)}catch{return!0}}function Jg(e){var t=kr(e,1);t!==null&&Zn(t,e,1,-1)}function D0(e){var t=ar();return typeof e=="function"&&(e=e()),t.memoizedState=t.baseState=e,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:qi,lastRenderedState:e},t.queue=e,e=e.dispatch=oS.bind(null,kt,e),[t.memoizedState,e]}function Ki(e,t,n,s){return e={tag:e,create:t,destroy:n,deps:s,next:null},t=kt.updateQueue,t===null?(t={lastEffect:null,stores:null},kt.updateQueue=t,t.lastEffect=e.next=e):(n=t.lastEffect,n===null?t.lastEffect=e.next=e:(s=n.next,n.next=e,e.next=s,t.lastEffect=e)),e}function Xg(){return Wn().memoizedState}function dl(e,t,n,s){var o=ar();kt.flags|=e,o.memoizedState=Ki(1|t,n,void 0,s===void 0?null:s)}function fc(e,t,n,s){var o=Wn();s=s===void 0?null:s;var i=void 0;if(Nt!==null){var a=Nt.memoizedState;if(i=a.destroy,s!==null&&$p(s,a.deps)){o.memoizedState=Ki(t,n,i,s);return}}kt.flags|=e,o.memoizedState=Ki(1|t,n,i,s)}function F0(e,t){return dl(8390656,8,e,t)}function Pp(e,t){return fc(2048,8,e,t)}function Zg(e,t){return fc(4,2,e,t)}function ex(e,t){return fc(4,4,e,t)}function tx(e,t){if(typeof t=="function")return e=e(),t(e),function(){t(null)};if(t!=null)return e=e(),t.current=e,function(){t.current=null}}function nx(e,t,n){return n=n!=null?n.concat([e]):null,fc(4,4,tx.bind(null,t,e),n)}function zp(){}function rx(e,t){var n=Wn();t=t===void 0?null:t;var s=n.memoizedState;return s!==null&&t!==null&&$p(t,s[1])?s[0]:(n.memoizedState=[e,t],e)}function sx(e,t){var n=Wn();t=t===void 0?null:t;var s=n.memoizedState;return s!==null&&t!==null&&$p(t,s[1])?s[0]:(e=e(),n.memoizedState=[e,t],e)}function ox(e,t,n){return ws&21?(er(n,t)||(n=dg(),kt.lanes|=n,Es|=n,e.baseState=!0),t):(e.baseState&&(e.baseState=!1,hn=!0),e.memoizedState=n)}function rS(e,t){var n=at;at=n!==0&&4>n?n:4,e(!0);var s=kd.transition;kd.transition={};try{e(!1),t()}finally{at=n,kd.transition=s}}function ix(){return Wn().memoizedState}function sS(e,t,n){var s=Vr(e);if(n={lane:s,action:n,hasEagerState:!1,eagerState:null,next:null},ax(e))lx(t,n);else if(n=Hg(e,t,n,s),n!==null){var o=sn();Zn(n,e,s,o),cx(n,t,s)}}function oS(e,t,n){var s=Vr(e),o={lane:s,action:n,hasEagerState:!1,eagerState:null,next:null};if(ax(e))lx(t,o);else{var i=e.alternate;if(e.lanes===0&&(i===null||i.lanes===0)&&(i=t.lastRenderedReducer,i!==null))try{var a=t.lastRenderedState,l=i(a,n);if(o.hasEagerState=!0,o.eagerState=l,er(l,a)){var d=t.interleaved;d===null?(o.next=o,Rp(t)):(o.next=d.next,d.next=o),t.interleaved=o;return}}catch{}finally{}n=Hg(e,t,o,s),n!==null&&(o=sn(),Zn(n,e,s,o),cx(n,t,s))}}function ax(e){var t=e.alternate;return e===kt||t!==null&&t===kt}function lx(e,t){_i=Hl=!0;var n=e.pending;n===null?t.next=t:(t.next=n.next,n.next=t),e.pending=t}function cx(e,t,n){if(n&4194240){var s=t.lanes;s&=e.pendingLanes,n|=s,t.lanes=n,gp(e,n)}}var Wl={readContext:Hn,useCallback:Qt,useContext:Qt,useEffect:Qt,useImperativeHandle:Qt,useInsertionEffect:Qt,useLayoutEffect:Qt,useMemo:Qt,useReducer:Qt,useRef:Qt,useState:Qt,useDebugValue:Qt,useDeferredValue:Qt,useTransition:Qt,useMutableSource:Qt,useSyncExternalStore:Qt,useId:Qt,unstable_isNewReconciler:!1},iS={readContext:Hn,useCallback:function(e,t){return ar().memoizedState=[e,t===void 0?null:t],e},useContext:Hn,useEffect:F0,useImperativeHandle:function(e,t,n){return n=n!=null?n.concat([e]):null,dl(4194308,4,tx.bind(null,t,e),n)},useLayoutEffect:function(e,t){return dl(4194308,4,e,t)},useInsertionEffect:function(e,t){return dl(4,2,e,t)},useMemo:function(e,t){var n=ar();return t=t===void 0?null:t,e=e(),n.memoizedState=[e,t],e},useReducer:function(e,t,n){var s=ar();return t=n!==void 0?n(t):t,s.memoizedState=s.baseState=t,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:e,lastRenderedState:t},s.queue=e,e=e.dispatch=sS.bind(null,kt,e),[s.memoizedState,e]},useRef:function(e){var t=ar();return e={current:e},t.memoizedState=e},useState:D0,useDebugValue:zp,useDeferredValue:function(e){return ar().memoizedState=e},useTransition:function(){var e=D0(!1),t=e[0];return e=rS.bind(null,e[1]),ar().memoizedState=e,[t,e]},useMutableSource:function(){},useSyncExternalStore:function(e,t,n){var s=kt,o=ar();if(bt){if(n===void 0)throw Error(le(407));n=n()}else{if(n=t(),Dt===null)throw Error(le(349));ws&30||Yg(s,t,n)}o.memoizedState=n;var i={value:n,getSnapshot:t};return o.queue=i,F0(Kg.bind(null,s,i,e),[e]),s.flags|=2048,Ki(9,qg.bind(null,s,i,n,t),void 0,null),n},useId:function(){var e=ar(),t=Dt.identifierPrefix;if(bt){var n=br,s=yr;n=(s&~(1<<32-Xn(s)-1)).toString(32)+n,t=":"+t+"R"+n,n=Yi++,0<n&&(t+="H"+n.toString(32)),t+=":"}else n=nS++,t=":"+t+"r"+n.toString(32)+":";return e.memoizedState=t},unstable_isNewReconciler:!1},aS={readContext:Hn,useCallback:rx,useContext:Hn,useEffect:Pp,useImperativeHandle:nx,useInsertionEffect:Zg,useLayoutEffect:ex,useMemo:sx,useReducer:jd,useRef:Xg,useState:function(){return jd(qi)},useDebugValue:zp,useDeferredValue:function(e){var t=Wn();return ox(t,Nt.memoizedState,e)},useTransition:function(){var e=jd(qi)[0],t=Wn().memoizedState;return[e,t]},useMutableSource:Gg,useSyncExternalStore:Vg,useId:ix,unstable_isNewReconciler:!1},lS={readContext:Hn,useCallback:rx,useContext:Hn,useEffect:Pp,useImperativeHandle:nx,useInsertionEffect:Zg,useLayoutEffect:ex,useMemo:sx,useReducer:Cd,useRef:Xg,useState:function(){return Cd(qi)},useDebugValue:zp,useDeferredValue:function(e){var t=Wn();return Nt===null?t.memoizedState=e:ox(t,Nt.memoizedState,e)},useTransition:function(){var e=Cd(qi)[0],t=Wn().memoizedState;return[e,t]},useMutableSource:Gg,useSyncExternalStore:Vg,useId:ix,unstable_isNewReconciler:!1};function Kn(e,t){if(e&&e.defaultProps){t=jt({},t),e=e.defaultProps;for(var n in e)t[n]===void 0&&(t[n]=e[n]);return t}return t}function Iu(e,t,n,s){t=e.memoizedState,n=n(s,t),n=n==null?t:jt({},t,n),e.memoizedState=n,e.lanes===0&&(e.updateQueue.baseState=n)}var mc={isMounted:function(e){return(e=e._reactInternals)?Is(e)===e:!1},enqueueSetState:function(e,t,n){e=e._reactInternals;var s=sn(),o=Vr(e),i=Sr(s,o);i.payload=t,n!=null&&(i.callback=n),t=Ur(e,i,o),t!==null&&(Zn(t,e,o,s),ll(t,e,o))},enqueueReplaceState:function(e,t,n){e=e._reactInternals;var s=sn(),o=Vr(e),i=Sr(s,o);i.tag=1,i.payload=t,n!=null&&(i.callback=n),t=Ur(e,i,o),t!==null&&(Zn(t,e,o,s),ll(t,e,o))},enqueueForceUpdate:function(e,t){e=e._reactInternals;var n=sn(),s=Vr(e),o=Sr(n,s);o.tag=2,t!=null&&(o.callback=t),t=Ur(e,o,s),t!==null&&(Zn(t,e,s,n),ll(t,e,s))}};function H0(e,t,n,s,o,i,a){return e=e.stateNode,typeof e.shouldComponentUpdate=="function"?e.shouldComponentUpdate(s,i,a):t.prototype&&t.prototype.isPureReactComponent?!Fi(n,s)||!Fi(o,i):!0}function dx(e,t,n){var s=!1,o=Qr,i=t.contextType;return typeof i=="object"&&i!==null?i=Hn(i):(o=xn(t)?vs:en.current,s=t.contextTypes,i=(s=s!=null)?xo(e,o):Qr),t=new t(n,i),e.memoizedState=t.state!==null&&t.state!==void 0?t.state:null,t.updater=mc,e.stateNode=t,t._reactInternals=e,s&&(e=e.stateNode,e.__reactInternalMemoizedUnmaskedChildContext=o,e.__reactInternalMemoizedMaskedChildContext=i),t}function W0(e,t,n,s){e=t.state,typeof t.componentWillReceiveProps=="function"&&t.componentWillReceiveProps(n,s),typeof t.UNSAFE_componentWillReceiveProps=="function"&&t.UNSAFE_componentWillReceiveProps(n,s),t.state!==e&&mc.enqueueReplaceState(t,t.state,null)}function _u(e,t,n,s){var o=e.stateNode;o.props=n,o.state=e.memoizedState,o.refs={},Mp(e);var i=t.contextType;typeof i=="object"&&i!==null?o.context=Hn(i):(i=xn(t)?vs:en.current,o.context=xo(e,i)),o.state=e.memoizedState,i=t.getDerivedStateFromProps,typeof i=="function"&&(Iu(e,t,i,n),o.state=e.memoizedState),typeof t.getDerivedStateFromProps=="function"||typeof o.getSnapshotBeforeUpdate=="function"||typeof o.UNSAFE_componentWillMount!="function"&&typeof o.componentWillMount!="function"||(t=o.state,typeof o.componentWillMount=="function"&&o.componentWillMount(),typeof o.UNSAFE_componentWillMount=="function"&&o.UNSAFE_componentWillMount(),t!==o.state&&mc.enqueueReplaceState(o,o.state,null),Dl(e,n,o,s),o.state=e.memoizedState),typeof o.componentDidMount=="function"&&(e.flags|=4194308)}function So(e,t){try{var n="",s=t;do n+=Bb(s),s=s.return;while(s);var o=n}catch(i){o=`
Error generating stack: `+i.message+`
`+i.stack}return{value:e,source:t,stack:o,digest:null}}function Td(e,t,n){return{value:e,source:null,stack:n??null,digest:t??null}}function Ru(e,t){try{console.error(t.value)}catch(n){setTimeout(function(){throw n})}}var cS=typeof WeakMap=="function"?WeakMap:Map;function ux(e,t,n){n=Sr(-1,n),n.tag=3,n.payload={element:null};var s=t.value;return n.callback=function(){Gl||(Gl=!0,Du=s),Ru(e,t)},n}function px(e,t,n){n=Sr(-1,n),n.tag=3;var s=e.type.getDerivedStateFromError;if(typeof s=="function"){var o=t.value;n.payload=function(){return s(o)},n.callback=function(){Ru(e,t)}}var i=e.stateNode;return i!==null&&typeof i.componentDidCatch=="function"&&(n.callback=function(){Ru(e,t),typeof s!="function"&&(Gr===null?Gr=new Set([this]):Gr.add(this));var a=t.stack;this.componentDidCatch(t.value,{componentStack:a!==null?a:""})}),n}function U0(e,t,n){var s=e.pingCache;if(s===null){s=e.pingCache=new cS;var o=new Set;s.set(t,o)}else o=s.get(t),o===void 0&&(o=new Set,s.set(t,o));o.has(n)||(o.add(n),e=ES.bind(null,e,t,n),t.then(e,e))}function G0(e){do{var t;if((t=e.tag===13)&&(t=e.memoizedState,t=t!==null?t.dehydrated!==null:!0),t)return e;e=e.return}while(e!==null);return null}function V0(e,t,n,s,o){return e.mode&1?(e.flags|=65536,e.lanes=o,e):(e===t?e.flags|=65536:(e.flags|=128,n.flags|=131072,n.flags&=-52805,n.tag===1&&(n.alternate===null?n.tag=17:(t=Sr(-1,1),t.tag=2,Ur(n,t,1))),n.lanes|=1),e)}var dS=Tr.ReactCurrentOwner,hn=!1;function rn(e,t,n,s){t.child=e===null?Fg(t,null,n,s):bo(t,e.child,n,s)}function Y0(e,t,n,s,o){n=n.render;var i=t.ref;return uo(t,o),s=Bp(e,t,n,s,i,o),n=Op(),e!==null&&!hn?(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~o,jr(e,t,o)):(bt&&n&&kp(t),t.flags|=1,rn(e,t,s,o),t.child)}function q0(e,t,n,s,o){if(e===null){var i=n.type;return typeof i=="function"&&!Yp(i)&&i.defaultProps===void 0&&n.compare===null&&n.defaultProps===void 0?(t.tag=15,t.type=i,fx(e,t,i,s,o)):(e=ml(n.type,null,s,t,t.mode,o),e.ref=t.ref,e.return=t,t.child=e)}if(i=e.child,!(e.lanes&o)){var a=i.memoizedProps;if(n=n.compare,n=n!==null?n:Fi,n(a,s)&&e.ref===t.ref)return jr(e,t,o)}return t.flags|=1,e=Yr(i,s),e.ref=t.ref,e.return=t,t.child=e}function fx(e,t,n,s,o){if(e!==null){var i=e.memoizedProps;if(Fi(i,s)&&e.ref===t.ref)if(hn=!1,t.pendingProps=s=i,(e.lanes&o)!==0)e.flags&131072&&(hn=!0);else return t.lanes=e.lanes,jr(e,t,o)}return Mu(e,t,n,s,o)}function mx(e,t,n){var s=t.pendingProps,o=s.children,i=e!==null?e.memoizedState:null;if(s.mode==="hidden")if(!(t.mode&1))t.memoizedState={baseLanes:0,cachePool:null,transitions:null},ft(so,En),En|=n;else{if(!(n&1073741824))return e=i!==null?i.baseLanes|n:n,t.lanes=t.childLanes=1073741824,t.memoizedState={baseLanes:e,cachePool:null,transitions:null},t.updateQueue=null,ft(so,En),En|=e,null;t.memoizedState={baseLanes:0,cachePool:null,transitions:null},s=i!==null?i.baseLanes:n,ft(so,En),En|=s}else i!==null?(s=i.baseLanes|n,t.memoizedState=null):s=n,ft(so,En),En|=s;return rn(e,t,o,n),t.child}function hx(e,t){var n=t.ref;(e===null&&n!==null||e!==null&&e.ref!==n)&&(t.flags|=512,t.flags|=2097152)}function Mu(e,t,n,s,o){var i=xn(n)?vs:en.current;return i=xo(t,i),uo(t,o),n=Bp(e,t,n,s,i,o),s=Op(),e!==null&&!hn?(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~o,jr(e,t,o)):(bt&&s&&kp(t),t.flags|=1,rn(e,t,n,o),t.child)}function K0(e,t,n,s,o){if(xn(n)){var i=!0;$l(t)}else i=!1;if(uo(t,o),t.stateNode===null)ul(e,t),dx(t,n,s),_u(t,n,s,o),s=!0;else if(e===null){var a=t.stateNode,l=t.memoizedProps;a.props=l;var d=a.context,p=n.contextType;typeof p=="object"&&p!==null?p=Hn(p):(p=xn(n)?vs:en.current,p=xo(t,p));var f=n.getDerivedStateFromProps,c=typeof f=="function"||typeof a.getSnapshotBeforeUpdate=="function";c||typeof a.UNSAFE_componentWillReceiveProps!="function"&&typeof a.componentWillReceiveProps!="function"||(l!==s||d!==p)&&W0(t,a,s,p),Nr=!1;var u=t.memoizedState;a.state=u,Dl(t,s,a,o),d=t.memoizedState,l!==s||u!==d||gn.current||Nr?(typeof f=="function"&&(Iu(t,n,f,s),d=t.memoizedState),(l=Nr||H0(t,n,l,s,u,d,p))?(c||typeof a.UNSAFE_componentWillMount!="function"&&typeof a.componentWillMount!="function"||(typeof a.componentWillMount=="function"&&a.componentWillMount(),typeof a.UNSAFE_componentWillMount=="function"&&a.UNSAFE_componentWillMount()),typeof a.componentDidMount=="function"&&(t.flags|=4194308)):(typeof a.componentDidMount=="function"&&(t.flags|=4194308),t.memoizedProps=s,t.memoizedState=d),a.props=s,a.state=d,a.context=p,s=l):(typeof a.componentDidMount=="function"&&(t.flags|=4194308),s=!1)}else{a=t.stateNode,Wg(e,t),l=t.memoizedProps,p=t.type===t.elementType?l:Kn(t.type,l),a.props=p,c=t.pendingProps,u=a.context,d=n.contextType,typeof d=="object"&&d!==null?d=Hn(d):(d=xn(n)?vs:en.current,d=xo(t,d));var x=n.getDerivedStateFromProps;(f=typeof x=="function"||typeof a.getSnapshotBeforeUpdate=="function")||typeof a.UNSAFE_componentWillReceiveProps!="function"&&typeof a.componentWillReceiveProps!="function"||(l!==c||u!==d)&&W0(t,a,s,d),Nr=!1,u=t.memoizedState,a.state=u,Dl(t,s,a,o);var S=t.memoizedState;l!==c||u!==S||gn.current||Nr?(typeof x=="function"&&(Iu(t,n,x,s),S=t.memoizedState),(p=Nr||H0(t,n,p,s,u,S,d)||!1)?(f||typeof a.UNSAFE_componentWillUpdate!="function"&&typeof a.componentWillUpdate!="function"||(typeof a.componentWillUpdate=="function"&&a.componentWillUpdate(s,S,d),typeof a.UNSAFE_componentWillUpdate=="function"&&a.UNSAFE_componentWillUpdate(s,S,d)),typeof a.componentDidUpdate=="function"&&(t.flags|=4),typeof a.getSnapshotBeforeUpdate=="function"&&(t.flags|=1024)):(typeof a.componentDidUpdate!="function"||l===e.memoizedProps&&u===e.memoizedState||(t.flags|=4),typeof a.getSnapshotBeforeUpdate!="function"||l===e.memoizedProps&&u===e.memoizedState||(t.flags|=1024),t.memoizedProps=s,t.memoizedState=S),a.props=s,a.state=S,a.context=d,s=p):(typeof a.componentDidUpdate!="function"||l===e.memoizedProps&&u===e.memoizedState||(t.flags|=4),typeof a.getSnapshotBeforeUpdate!="function"||l===e.memoizedProps&&u===e.memoizedState||(t.flags|=1024),s=!1)}return Au(e,t,n,s,i,o)}function Au(e,t,n,s,o,i){hx(e,t);var a=(t.flags&128)!==0;if(!s&&!a)return o&&L0(t,n,!1),jr(e,t,i);s=t.stateNode,dS.current=t;var l=a&&typeof n.getDerivedStateFromError!="function"?null:s.render();return t.flags|=1,e!==null&&a?(t.child=bo(t,e.child,null,i),t.child=bo(t,null,l,i)):rn(e,t,l,i),t.memoizedState=s.state,o&&L0(t,n,!0),t.child}function gx(e){var t=e.stateNode;t.pendingContext?N0(e,t.pendingContext,t.pendingContext!==t.context):t.context&&N0(e,t.context,!1),Ap(e,t.containerInfo)}function Q0(e,t,n,s,o){return yo(),Cp(o),t.flags|=256,rn(e,t,n,s),t.child}var Nu={dehydrated:null,treeContext:null,retryLane:0};function Lu(e){return{baseLanes:e,cachePool:null,transitions:null}}function xx(e,t,n){var s=t.pendingProps,o=Et.current,i=!1,a=(t.flags&128)!==0,l;if((l=a)||(l=e!==null&&e.memoizedState===null?!1:(o&2)!==0),l?(i=!0,t.flags&=-129):(e===null||e.memoizedState!==null)&&(o|=1),ft(Et,o&1),e===null)return Cu(t),e=t.memoizedState,e!==null&&(e=e.dehydrated,e!==null)?(t.mode&1?e.data==="$!"?t.lanes=8:t.lanes=1073741824:t.lanes=1,null):(a=s.children,e=s.fallback,i?(s=t.mode,i=t.child,a={mode:"hidden",children:a},!(s&1)&&i!==null?(i.childLanes=0,i.pendingProps=a):i=xc(a,s,0,null),e=gs(e,s,n,null),i.return=t,e.return=t,i.sibling=e,t.child=i,t.child.memoizedState=Lu(n),t.memoizedState=Nu,e):Dp(t,a));if(o=e.memoizedState,o!==null&&(l=o.dehydrated,l!==null))return uS(e,t,a,s,l,o,n);if(i){i=s.fallback,a=t.mode,o=e.child,l=o.sibling;var d={mode:"hidden",children:s.children};return!(a&1)&&t.child!==o?(s=t.child,s.childLanes=0,s.pendingProps=d,t.deletions=null):(s=Yr(o,d),s.subtreeFlags=o.subtreeFlags&14680064),l!==null?i=Yr(l,i):(i=gs(i,a,n,null),i.flags|=2),i.return=t,s.return=t,s.sibling=i,t.child=s,s=i,i=t.child,a=e.child.memoizedState,a=a===null?Lu(n):{baseLanes:a.baseLanes|n,cachePool:null,transitions:a.transitions},i.memoizedState=a,i.childLanes=e.childLanes&~n,t.memoizedState=Nu,s}return i=e.child,e=i.sibling,s=Yr(i,{mode:"visible",children:s.children}),!(t.mode&1)&&(s.lanes=n),s.return=t,s.sibling=null,e!==null&&(n=t.deletions,n===null?(t.deletions=[e],t.flags|=16):n.push(e)),t.child=s,t.memoizedState=null,s}function Dp(e,t){return t=xc({mode:"visible",children:t},e.mode,0,null),t.return=e,e.child=t}function Wa(e,t,n,s){return s!==null&&Cp(s),bo(t,e.child,null,n),e=Dp(t,t.pendingProps.children),e.flags|=2,t.memoizedState=null,e}function uS(e,t,n,s,o,i,a){if(n)return t.flags&256?(t.flags&=-257,s=Td(Error(le(422))),Wa(e,t,a,s)):t.memoizedState!==null?(t.child=e.child,t.flags|=128,null):(i=s.fallback,o=t.mode,s=xc({mode:"visible",children:s.children},o,0,null),i=gs(i,o,a,null),i.flags|=2,s.return=t,i.return=t,s.sibling=i,t.child=s,t.mode&1&&bo(t,e.child,null,a),t.child.memoizedState=Lu(a),t.memoizedState=Nu,i);if(!(t.mode&1))return Wa(e,t,a,null);if(o.data==="$!"){if(s=o.nextSibling&&o.nextSibling.dataset,s)var l=s.dgst;return s=l,i=Error(le(419)),s=Td(i,s,void 0),Wa(e,t,a,s)}if(l=(a&e.childLanes)!==0,hn||l){if(s=Dt,s!==null){switch(a&-a){case 4:o=2;break;case 16:o=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:o=32;break;case 536870912:o=268435456;break;default:o=0}o=o&(s.suspendedLanes|a)?0:o,o!==0&&o!==i.retryLane&&(i.retryLane=o,kr(e,o),Zn(s,e,o,-1))}return Vp(),s=Td(Error(le(421))),Wa(e,t,a,s)}return o.data==="$?"?(t.flags|=128,t.child=e.child,t=kS.bind(null,e),o._reactRetry=t,null):(e=i.treeContext,kn=Wr(o.nextSibling),jn=t,bt=!0,Jn=null,e!==null&&(Bn[On++]=yr,Bn[On++]=br,Bn[On++]=Ss,yr=e.id,br=e.overflow,Ss=t),t=Dp(t,s.children),t.flags|=4096,t)}function J0(e,t,n){e.lanes|=t;var s=e.alternate;s!==null&&(s.lanes|=t),Tu(e.return,t,n)}function Id(e,t,n,s,o){var i=e.memoizedState;i===null?e.memoizedState={isBackwards:t,rendering:null,renderingStartTime:0,last:s,tail:n,tailMode:o}:(i.isBackwards=t,i.rendering=null,i.renderingStartTime=0,i.last=s,i.tail=n,i.tailMode=o)}function yx(e,t,n){var s=t.pendingProps,o=s.revealOrder,i=s.tail;if(rn(e,t,s.children,n),s=Et.current,s&2)s=s&1|2,t.flags|=128;else{if(e!==null&&e.flags&128)e:for(e=t.child;e!==null;){if(e.tag===13)e.memoizedState!==null&&J0(e,n,t);else if(e.tag===19)J0(e,n,t);else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===t)break e;for(;e.sibling===null;){if(e.return===null||e.return===t)break e;e=e.return}e.sibling.return=e.return,e=e.sibling}s&=1}if(ft(Et,s),!(t.mode&1))t.memoizedState=null;else switch(o){case"forwards":for(n=t.child,o=null;n!==null;)e=n.alternate,e!==null&&Fl(e)===null&&(o=n),n=n.sibling;n=o,n===null?(o=t.child,t.child=null):(o=n.sibling,n.sibling=null),Id(t,!1,o,n,i);break;case"backwards":for(n=null,o=t.child,t.child=null;o!==null;){if(e=o.alternate,e!==null&&Fl(e)===null){t.child=o;break}e=o.sibling,o.sibling=n,n=o,o=e}Id(t,!0,n,null,i);break;case"together":Id(t,!1,null,null,void 0);break;default:t.memoizedState=null}return t.child}function ul(e,t){!(t.mode&1)&&e!==null&&(e.alternate=null,t.alternate=null,t.flags|=2)}function jr(e,t,n){if(e!==null&&(t.dependencies=e.dependencies),Es|=t.lanes,!(n&t.childLanes))return null;if(e!==null&&t.child!==e.child)throw Error(le(153));if(t.child!==null){for(e=t.child,n=Yr(e,e.pendingProps),t.child=n,n.return=t;e.sibling!==null;)e=e.sibling,n=n.sibling=Yr(e,e.pendingProps),n.return=t;n.sibling=null}return t.child}function pS(e,t,n){switch(t.tag){case 3:gx(t),yo();break;case 5:Ug(t);break;case 1:xn(t.type)&&$l(t);break;case 4:Ap(t,t.stateNode.containerInfo);break;case 10:var s=t.type._context,o=t.memoizedProps.value;ft(Pl,s._currentValue),s._currentValue=o;break;case 13:if(s=t.memoizedState,s!==null)return s.dehydrated!==null?(ft(Et,Et.current&1),t.flags|=128,null):n&t.child.childLanes?xx(e,t,n):(ft(Et,Et.current&1),e=jr(e,t,n),e!==null?e.sibling:null);ft(Et,Et.current&1);break;case 19:if(s=(n&t.childLanes)!==0,e.flags&128){if(s)return yx(e,t,n);t.flags|=128}if(o=t.memoizedState,o!==null&&(o.rendering=null,o.tail=null,o.lastEffect=null),ft(Et,Et.current),s)break;return null;case 22:case 23:return t.lanes=0,mx(e,t,n)}return jr(e,t,n)}var bx,$u,vx,Sx;bx=function(e,t){for(var n=t.child;n!==null;){if(n.tag===5||n.tag===6)e.appendChild(n.stateNode);else if(n.tag!==4&&n.child!==null){n.child.return=n,n=n.child;continue}if(n===t)break;for(;n.sibling===null;){if(n.return===null||n.return===t)return;n=n.return}n.sibling.return=n.return,n=n.sibling}};$u=function(){};vx=function(e,t,n,s){var o=e.memoizedProps;if(o!==s){e=t.stateNode,ms(dr.current);var i=null;switch(n){case"input":o=ru(e,o),s=ru(e,s),i=[];break;case"select":o=jt({},o,{value:void 0}),s=jt({},s,{value:void 0}),i=[];break;case"textarea":o=iu(e,o),s=iu(e,s),i=[];break;default:typeof o.onClick!="function"&&typeof s.onClick=="function"&&(e.onclick=Nl)}lu(n,s);var a;n=null;for(p in o)if(!s.hasOwnProperty(p)&&o.hasOwnProperty(p)&&o[p]!=null)if(p==="style"){var l=o[p];for(a in l)l.hasOwnProperty(a)&&(n||(n={}),n[a]="")}else p!=="dangerouslySetInnerHTML"&&p!=="children"&&p!=="suppressContentEditableWarning"&&p!=="suppressHydrationWarning"&&p!=="autoFocus"&&(Li.hasOwnProperty(p)?i||(i=[]):(i=i||[]).push(p,null));for(p in s){var d=s[p];if(l=o!=null?o[p]:void 0,s.hasOwnProperty(p)&&d!==l&&(d!=null||l!=null))if(p==="style")if(l){for(a in l)!l.hasOwnProperty(a)||d&&d.hasOwnProperty(a)||(n||(n={}),n[a]="");for(a in d)d.hasOwnProperty(a)&&l[a]!==d[a]&&(n||(n={}),n[a]=d[a])}else n||(i||(i=[]),i.push(p,n)),n=d;else p==="dangerouslySetInnerHTML"?(d=d?d.__html:void 0,l=l?l.__html:void 0,d!=null&&l!==d&&(i=i||[]).push(p,d)):p==="children"?typeof d!="string"&&typeof d!="number"||(i=i||[]).push(p,""+d):p!=="suppressContentEditableWarning"&&p!=="suppressHydrationWarning"&&(Li.hasOwnProperty(p)?(d!=null&&p==="onScroll"&&ht("scroll",e),i||l===d||(i=[])):(i=i||[]).push(p,d))}n&&(i=i||[]).push("style",n);var p=i;(t.updateQueue=p)&&(t.flags|=4)}};Sx=function(e,t,n,s){n!==s&&(t.flags|=4)};function ci(e,t){if(!bt)switch(e.tailMode){case"hidden":t=e.tail;for(var n=null;t!==null;)t.alternate!==null&&(n=t),t=t.sibling;n===null?e.tail=null:n.sibling=null;break;case"collapsed":n=e.tail;for(var s=null;n!==null;)n.alternate!==null&&(s=n),n=n.sibling;s===null?t||e.tail===null?e.tail=null:e.tail.sibling=null:s.sibling=null}}function Jt(e){var t=e.alternate!==null&&e.alternate.child===e.child,n=0,s=0;if(t)for(var o=e.child;o!==null;)n|=o.lanes|o.childLanes,s|=o.subtreeFlags&14680064,s|=o.flags&14680064,o.return=e,o=o.sibling;else for(o=e.child;o!==null;)n|=o.lanes|o.childLanes,s|=o.subtreeFlags,s|=o.flags,o.return=e,o=o.sibling;return e.subtreeFlags|=s,e.childLanes=n,t}function fS(e,t,n){var s=t.pendingProps;switch(jp(t),t.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Jt(t),null;case 1:return xn(t.type)&&Ll(),Jt(t),null;case 3:return s=t.stateNode,vo(),gt(gn),gt(en),Lp(),s.pendingContext&&(s.context=s.pendingContext,s.pendingContext=null),(e===null||e.child===null)&&(Fa(t)?t.flags|=4:e===null||e.memoizedState.isDehydrated&&!(t.flags&256)||(t.flags|=1024,Jn!==null&&(Wu(Jn),Jn=null))),$u(e,t),Jt(t),null;case 5:Np(t);var o=ms(Vi.current);if(n=t.type,e!==null&&t.stateNode!=null)vx(e,t,n,s,o),e.ref!==t.ref&&(t.flags|=512,t.flags|=2097152);else{if(!s){if(t.stateNode===null)throw Error(le(166));return Jt(t),null}if(e=ms(dr.current),Fa(t)){s=t.stateNode,n=t.type;var i=t.memoizedProps;switch(s[lr]=t,s[Ui]=i,e=(t.mode&1)!==0,n){case"dialog":ht("cancel",s),ht("close",s);break;case"iframe":case"object":case"embed":ht("load",s);break;case"video":case"audio":for(o=0;o<Si.length;o++)ht(Si[o],s);break;case"source":ht("error",s);break;case"img":case"image":case"link":ht("error",s),ht("load",s);break;case"details":ht("toggle",s);break;case"input":i0(s,i),ht("invalid",s);break;case"select":s._wrapperState={wasMultiple:!!i.multiple},ht("invalid",s);break;case"textarea":l0(s,i),ht("invalid",s)}lu(n,i),o=null;for(var a in i)if(i.hasOwnProperty(a)){var l=i[a];a==="children"?typeof l=="string"?s.textContent!==l&&(i.suppressHydrationWarning!==!0&&Da(s.textContent,l,e),o=["children",l]):typeof l=="number"&&s.textContent!==""+l&&(i.suppressHydrationWarning!==!0&&Da(s.textContent,l,e),o=["children",""+l]):Li.hasOwnProperty(a)&&l!=null&&a==="onScroll"&&ht("scroll",s)}switch(n){case"input":Aa(s),a0(s,i,!0);break;case"textarea":Aa(s),c0(s);break;case"select":case"option":break;default:typeof i.onClick=="function"&&(s.onclick=Nl)}s=o,t.updateQueue=s,s!==null&&(t.flags|=4)}else{a=o.nodeType===9?o:o.ownerDocument,e==="http://www.w3.org/1999/xhtml"&&(e=Kh(n)),e==="http://www.w3.org/1999/xhtml"?n==="script"?(e=a.createElement("div"),e.innerHTML="<script><\/script>",e=e.removeChild(e.firstChild)):typeof s.is=="string"?e=a.createElement(n,{is:s.is}):(e=a.createElement(n),n==="select"&&(a=e,s.multiple?a.multiple=!0:s.size&&(a.size=s.size))):e=a.createElementNS(e,n),e[lr]=t,e[Ui]=s,bx(e,t,!1,!1),t.stateNode=e;e:{switch(a=cu(n,s),n){case"dialog":ht("cancel",e),ht("close",e),o=s;break;case"iframe":case"object":case"embed":ht("load",e),o=s;break;case"video":case"audio":for(o=0;o<Si.length;o++)ht(Si[o],e);o=s;break;case"source":ht("error",e),o=s;break;case"img":case"image":case"link":ht("error",e),ht("load",e),o=s;break;case"details":ht("toggle",e),o=s;break;case"input":i0(e,s),o=ru(e,s),ht("invalid",e);break;case"option":o=s;break;case"select":e._wrapperState={wasMultiple:!!s.multiple},o=jt({},s,{value:void 0}),ht("invalid",e);break;case"textarea":l0(e,s),o=iu(e,s),ht("invalid",e);break;default:o=s}lu(n,o),l=o;for(i in l)if(l.hasOwnProperty(i)){var d=l[i];i==="style"?Xh(e,d):i==="dangerouslySetInnerHTML"?(d=d?d.__html:void 0,d!=null&&Qh(e,d)):i==="children"?typeof d=="string"?(n!=="textarea"||d!=="")&&$i(e,d):typeof d=="number"&&$i(e,""+d):i!=="suppressContentEditableWarning"&&i!=="suppressHydrationWarning"&&i!=="autoFocus"&&(Li.hasOwnProperty(i)?d!=null&&i==="onScroll"&&ht("scroll",e):d!=null&&dp(e,i,d,a))}switch(n){case"input":Aa(e),a0(e,s,!1);break;case"textarea":Aa(e),c0(e);break;case"option":s.value!=null&&e.setAttribute("value",""+Kr(s.value));break;case"select":e.multiple=!!s.multiple,i=s.value,i!=null?io(e,!!s.multiple,i,!1):s.defaultValue!=null&&io(e,!!s.multiple,s.defaultValue,!0);break;default:typeof o.onClick=="function"&&(e.onclick=Nl)}switch(n){case"button":case"input":case"select":case"textarea":s=!!s.autoFocus;break e;case"img":s=!0;break e;default:s=!1}}s&&(t.flags|=4)}t.ref!==null&&(t.flags|=512,t.flags|=2097152)}return Jt(t),null;case 6:if(e&&t.stateNode!=null)Sx(e,t,e.memoizedProps,s);else{if(typeof s!="string"&&t.stateNode===null)throw Error(le(166));if(n=ms(Vi.current),ms(dr.current),Fa(t)){if(s=t.stateNode,n=t.memoizedProps,s[lr]=t,(i=s.nodeValue!==n)&&(e=jn,e!==null))switch(e.tag){case 3:Da(s.nodeValue,n,(e.mode&1)!==0);break;case 5:e.memoizedProps.suppressHydrationWarning!==!0&&Da(s.nodeValue,n,(e.mode&1)!==0)}i&&(t.flags|=4)}else s=(n.nodeType===9?n:n.ownerDocument).createTextNode(s),s[lr]=t,t.stateNode=s}return Jt(t),null;case 13:if(gt(Et),s=t.memoizedState,e===null||e.memoizedState!==null&&e.memoizedState.dehydrated!==null){if(bt&&kn!==null&&t.mode&1&&!(t.flags&128))zg(),yo(),t.flags|=98560,i=!1;else if(i=Fa(t),s!==null&&s.dehydrated!==null){if(e===null){if(!i)throw Error(le(318));if(i=t.memoizedState,i=i!==null?i.dehydrated:null,!i)throw Error(le(317));i[lr]=t}else yo(),!(t.flags&128)&&(t.memoizedState=null),t.flags|=4;Jt(t),i=!1}else Jn!==null&&(Wu(Jn),Jn=null),i=!0;if(!i)return t.flags&65536?t:null}return t.flags&128?(t.lanes=n,t):(s=s!==null,s!==(e!==null&&e.memoizedState!==null)&&s&&(t.child.flags|=8192,t.mode&1&&(e===null||Et.current&1?$t===0&&($t=3):Vp())),t.updateQueue!==null&&(t.flags|=4),Jt(t),null);case 4:return vo(),$u(e,t),e===null&&Hi(t.stateNode.containerInfo),Jt(t),null;case 10:return _p(t.type._context),Jt(t),null;case 17:return xn(t.type)&&Ll(),Jt(t),null;case 19:if(gt(Et),i=t.memoizedState,i===null)return Jt(t),null;if(s=(t.flags&128)!==0,a=i.rendering,a===null)if(s)ci(i,!1);else{if($t!==0||e!==null&&e.flags&128)for(e=t.child;e!==null;){if(a=Fl(e),a!==null){for(t.flags|=128,ci(i,!1),s=a.updateQueue,s!==null&&(t.updateQueue=s,t.flags|=4),t.subtreeFlags=0,s=n,n=t.child;n!==null;)i=n,e=s,i.flags&=14680066,a=i.alternate,a===null?(i.childLanes=0,i.lanes=e,i.child=null,i.subtreeFlags=0,i.memoizedProps=null,i.memoizedState=null,i.updateQueue=null,i.dependencies=null,i.stateNode=null):(i.childLanes=a.childLanes,i.lanes=a.lanes,i.child=a.child,i.subtreeFlags=0,i.deletions=null,i.memoizedProps=a.memoizedProps,i.memoizedState=a.memoizedState,i.updateQueue=a.updateQueue,i.type=a.type,e=a.dependencies,i.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext}),n=n.sibling;return ft(Et,Et.current&1|2),t.child}e=e.sibling}i.tail!==null&&_t()>wo&&(t.flags|=128,s=!0,ci(i,!1),t.lanes=4194304)}else{if(!s)if(e=Fl(a),e!==null){if(t.flags|=128,s=!0,n=e.updateQueue,n!==null&&(t.updateQueue=n,t.flags|=4),ci(i,!0),i.tail===null&&i.tailMode==="hidden"&&!a.alternate&&!bt)return Jt(t),null}else 2*_t()-i.renderingStartTime>wo&&n!==1073741824&&(t.flags|=128,s=!0,ci(i,!1),t.lanes=4194304);i.isBackwards?(a.sibling=t.child,t.child=a):(n=i.last,n!==null?n.sibling=a:t.child=a,i.last=a)}return i.tail!==null?(t=i.tail,i.rendering=t,i.tail=t.sibling,i.renderingStartTime=_t(),t.sibling=null,n=Et.current,ft(Et,s?n&1|2:n&1),t):(Jt(t),null);case 22:case 23:return Gp(),s=t.memoizedState!==null,e!==null&&e.memoizedState!==null!==s&&(t.flags|=8192),s&&t.mode&1?En&1073741824&&(Jt(t),t.subtreeFlags&6&&(t.flags|=8192)):Jt(t),null;case 24:return null;case 25:return null}throw Error(le(156,t.tag))}function mS(e,t){switch(jp(t),t.tag){case 1:return xn(t.type)&&Ll(),e=t.flags,e&65536?(t.flags=e&-65537|128,t):null;case 3:return vo(),gt(gn),gt(en),Lp(),e=t.flags,e&65536&&!(e&128)?(t.flags=e&-65537|128,t):null;case 5:return Np(t),null;case 13:if(gt(Et),e=t.memoizedState,e!==null&&e.dehydrated!==null){if(t.alternate===null)throw Error(le(340));yo()}return e=t.flags,e&65536?(t.flags=e&-65537|128,t):null;case 19:return gt(Et),null;case 4:return vo(),null;case 10:return _p(t.type._context),null;case 22:case 23:return Gp(),null;case 24:return null;default:return null}}var Ua=!1,Zt=!1,hS=typeof WeakSet=="function"?WeakSet:Set,Ce=null;function ro(e,t){var n=e.ref;if(n!==null)if(typeof n=="function")try{n(null)}catch(s){Ct(e,t,s)}else n.current=null}function Bu(e,t,n){try{n()}catch(s){Ct(e,t,s)}}var X0=!1;function gS(e,t){if(bu=Rl,e=Cg(),Ep(e)){if("selectionStart"in e)var n={start:e.selectionStart,end:e.selectionEnd};else e:{n=(n=e.ownerDocument)&&n.defaultView||window;var s=n.getSelection&&n.getSelection();if(s&&s.rangeCount!==0){n=s.anchorNode;var o=s.anchorOffset,i=s.focusNode;s=s.focusOffset;try{n.nodeType,i.nodeType}catch{n=null;break e}var a=0,l=-1,d=-1,p=0,f=0,c=e,u=null;t:for(;;){for(var x;c!==n||o!==0&&c.nodeType!==3||(l=a+o),c!==i||s!==0&&c.nodeType!==3||(d=a+s),c.nodeType===3&&(a+=c.nodeValue.length),(x=c.firstChild)!==null;)u=c,c=x;for(;;){if(c===e)break t;if(u===n&&++p===o&&(l=a),u===i&&++f===s&&(d=a),(x=c.nextSibling)!==null)break;c=u,u=c.parentNode}c=x}n=l===-1||d===-1?null:{start:l,end:d}}else n=null}n=n||{start:0,end:0}}else n=null;for(vu={focusedElem:e,selectionRange:n},Rl=!1,Ce=t;Ce!==null;)if(t=Ce,e=t.child,(t.subtreeFlags&1028)!==0&&e!==null)e.return=t,Ce=e;else for(;Ce!==null;){t=Ce;try{var S=t.alternate;if(t.flags&1024)switch(t.tag){case 0:case 11:case 15:break;case 1:if(S!==null){var w=S.memoizedProps,C=S.memoizedState,h=t.stateNode,g=h.getSnapshotBeforeUpdate(t.elementType===t.type?w:Kn(t.type,w),C);h.__reactInternalSnapshotBeforeUpdate=g}break;case 3:var b=t.stateNode.containerInfo;b.nodeType===1?b.textContent="":b.nodeType===9&&b.documentElement&&b.removeChild(b.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(le(163))}}catch(E){Ct(t,t.return,E)}if(e=t.sibling,e!==null){e.return=t.return,Ce=e;break}Ce=t.return}return S=X0,X0=!1,S}function Ri(e,t,n){var s=t.updateQueue;if(s=s!==null?s.lastEffect:null,s!==null){var o=s=s.next;do{if((o.tag&e)===e){var i=o.destroy;o.destroy=void 0,i!==void 0&&Bu(t,n,i)}o=o.next}while(o!==s)}}function hc(e,t){if(t=t.updateQueue,t=t!==null?t.lastEffect:null,t!==null){var n=t=t.next;do{if((n.tag&e)===e){var s=n.create;n.destroy=s()}n=n.next}while(n!==t)}}function Ou(e){var t=e.ref;if(t!==null){var n=e.stateNode;switch(e.tag){case 5:e=n;break;default:e=n}typeof t=="function"?t(e):t.current=e}}function wx(e){var t=e.alternate;t!==null&&(e.alternate=null,wx(t)),e.child=null,e.deletions=null,e.sibling=null,e.tag===5&&(t=e.stateNode,t!==null&&(delete t[lr],delete t[Ui],delete t[Eu],delete t[Xv],delete t[Zv])),e.stateNode=null,e.return=null,e.dependencies=null,e.memoizedProps=null,e.memoizedState=null,e.pendingProps=null,e.stateNode=null,e.updateQueue=null}function Ex(e){return e.tag===5||e.tag===3||e.tag===4}function Z0(e){e:for(;;){for(;e.sibling===null;){if(e.return===null||Ex(e.return))return null;e=e.return}for(e.sibling.return=e.return,e=e.sibling;e.tag!==5&&e.tag!==6&&e.tag!==18;){if(e.flags&2||e.child===null||e.tag===4)continue e;e.child.return=e,e=e.child}if(!(e.flags&2))return e.stateNode}}function Pu(e,t,n){var s=e.tag;if(s===5||s===6)e=e.stateNode,t?n.nodeType===8?n.parentNode.insertBefore(e,t):n.insertBefore(e,t):(n.nodeType===8?(t=n.parentNode,t.insertBefore(e,n)):(t=n,t.appendChild(e)),n=n._reactRootContainer,n!=null||t.onclick!==null||(t.onclick=Nl));else if(s!==4&&(e=e.child,e!==null))for(Pu(e,t,n),e=e.sibling;e!==null;)Pu(e,t,n),e=e.sibling}function zu(e,t,n){var s=e.tag;if(s===5||s===6)e=e.stateNode,t?n.insertBefore(e,t):n.appendChild(e);else if(s!==4&&(e=e.child,e!==null))for(zu(e,t,n),e=e.sibling;e!==null;)zu(e,t,n),e=e.sibling}var Gt=null,Qn=!1;function Rr(e,t,n){for(n=n.child;n!==null;)kx(e,t,n),n=n.sibling}function kx(e,t,n){if(cr&&typeof cr.onCommitFiberUnmount=="function")try{cr.onCommitFiberUnmount(ac,n)}catch{}switch(n.tag){case 5:Zt||ro(n,t);case 6:var s=Gt,o=Qn;Gt=null,Rr(e,t,n),Gt=s,Qn=o,Gt!==null&&(Qn?(e=Gt,n=n.stateNode,e.nodeType===8?e.parentNode.removeChild(n):e.removeChild(n)):Gt.removeChild(n.stateNode));break;case 18:Gt!==null&&(Qn?(e=Gt,n=n.stateNode,e.nodeType===8?Sd(e.parentNode,n):e.nodeType===1&&Sd(e,n),zi(e)):Sd(Gt,n.stateNode));break;case 4:s=Gt,o=Qn,Gt=n.stateNode.containerInfo,Qn=!0,Rr(e,t,n),Gt=s,Qn=o;break;case 0:case 11:case 14:case 15:if(!Zt&&(s=n.updateQueue,s!==null&&(s=s.lastEffect,s!==null))){o=s=s.next;do{var i=o,a=i.destroy;i=i.tag,a!==void 0&&(i&2||i&4)&&Bu(n,t,a),o=o.next}while(o!==s)}Rr(e,t,n);break;case 1:if(!Zt&&(ro(n,t),s=n.stateNode,typeof s.componentWillUnmount=="function"))try{s.props=n.memoizedProps,s.state=n.memoizedState,s.componentWillUnmount()}catch(l){Ct(n,t,l)}Rr(e,t,n);break;case 21:Rr(e,t,n);break;case 22:n.mode&1?(Zt=(s=Zt)||n.memoizedState!==null,Rr(e,t,n),Zt=s):Rr(e,t,n);break;default:Rr(e,t,n)}}function em(e){var t=e.updateQueue;if(t!==null){e.updateQueue=null;var n=e.stateNode;n===null&&(n=e.stateNode=new hS),t.forEach(function(s){var o=jS.bind(null,e,s);n.has(s)||(n.add(s),s.then(o,o))})}}function Yn(e,t){var n=t.deletions;if(n!==null)for(var s=0;s<n.length;s++){var o=n[s];try{var i=e,a=t,l=a;e:for(;l!==null;){switch(l.tag){case 5:Gt=l.stateNode,Qn=!1;break e;case 3:Gt=l.stateNode.containerInfo,Qn=!0;break e;case 4:Gt=l.stateNode.containerInfo,Qn=!0;break e}l=l.return}if(Gt===null)throw Error(le(160));kx(i,a,o),Gt=null,Qn=!1;var d=o.alternate;d!==null&&(d.return=null),o.return=null}catch(p){Ct(o,t,p)}}if(t.subtreeFlags&12854)for(t=t.child;t!==null;)jx(t,e),t=t.sibling}function jx(e,t){var n=e.alternate,s=e.flags;switch(e.tag){case 0:case 11:case 14:case 15:if(Yn(t,e),nr(e),s&4){try{Ri(3,e,e.return),hc(3,e)}catch(w){Ct(e,e.return,w)}try{Ri(5,e,e.return)}catch(w){Ct(e,e.return,w)}}break;case 1:Yn(t,e),nr(e),s&512&&n!==null&&ro(n,n.return);break;case 5:if(Yn(t,e),nr(e),s&512&&n!==null&&ro(n,n.return),e.flags&32){var o=e.stateNode;try{$i(o,"")}catch(w){Ct(e,e.return,w)}}if(s&4&&(o=e.stateNode,o!=null)){var i=e.memoizedProps,a=n!==null?n.memoizedProps:i,l=e.type,d=e.updateQueue;if(e.updateQueue=null,d!==null)try{l==="input"&&i.type==="radio"&&i.name!=null&&Yh(o,i),cu(l,a);var p=cu(l,i);for(a=0;a<d.length;a+=2){var f=d[a],c=d[a+1];f==="style"?Xh(o,c):f==="dangerouslySetInnerHTML"?Qh(o,c):f==="children"?$i(o,c):dp(o,f,c,p)}switch(l){case"input":su(o,i);break;case"textarea":qh(o,i);break;case"select":var u=o._wrapperState.wasMultiple;o._wrapperState.wasMultiple=!!i.multiple;var x=i.value;x!=null?io(o,!!i.multiple,x,!1):u!==!!i.multiple&&(i.defaultValue!=null?io(o,!!i.multiple,i.defaultValue,!0):io(o,!!i.multiple,i.multiple?[]:"",!1))}o[Ui]=i}catch(w){Ct(e,e.return,w)}}break;case 6:if(Yn(t,e),nr(e),s&4){if(e.stateNode===null)throw Error(le(162));o=e.stateNode,i=e.memoizedProps;try{o.nodeValue=i}catch(w){Ct(e,e.return,w)}}break;case 3:if(Yn(t,e),nr(e),s&4&&n!==null&&n.memoizedState.isDehydrated)try{zi(t.containerInfo)}catch(w){Ct(e,e.return,w)}break;case 4:Yn(t,e),nr(e);break;case 13:Yn(t,e),nr(e),o=e.child,o.flags&8192&&(i=o.memoizedState!==null,o.stateNode.isHidden=i,!i||o.alternate!==null&&o.alternate.memoizedState!==null||(Wp=_t())),s&4&&em(e);break;case 22:if(f=n!==null&&n.memoizedState!==null,e.mode&1?(Zt=(p=Zt)||f,Yn(t,e),Zt=p):Yn(t,e),nr(e),s&8192){if(p=e.memoizedState!==null,(e.stateNode.isHidden=p)&&!f&&e.mode&1)for(Ce=e,f=e.child;f!==null;){for(c=Ce=f;Ce!==null;){switch(u=Ce,x=u.child,u.tag){case 0:case 11:case 14:case 15:Ri(4,u,u.return);break;case 1:ro(u,u.return);var S=u.stateNode;if(typeof S.componentWillUnmount=="function"){s=u,n=u.return;try{t=s,S.props=t.memoizedProps,S.state=t.memoizedState,S.componentWillUnmount()}catch(w){Ct(s,n,w)}}break;case 5:ro(u,u.return);break;case 22:if(u.memoizedState!==null){nm(c);continue}}x!==null?(x.return=u,Ce=x):nm(c)}f=f.sibling}e:for(f=null,c=e;;){if(c.tag===5){if(f===null){f=c;try{o=c.stateNode,p?(i=o.style,typeof i.setProperty=="function"?i.setProperty("display","none","important"):i.display="none"):(l=c.stateNode,d=c.memoizedProps.style,a=d!=null&&d.hasOwnProperty("display")?d.display:null,l.style.display=Jh("display",a))}catch(w){Ct(e,e.return,w)}}}else if(c.tag===6){if(f===null)try{c.stateNode.nodeValue=p?"":c.memoizedProps}catch(w){Ct(e,e.return,w)}}else if((c.tag!==22&&c.tag!==23||c.memoizedState===null||c===e)&&c.child!==null){c.child.return=c,c=c.child;continue}if(c===e)break e;for(;c.sibling===null;){if(c.return===null||c.return===e)break e;f===c&&(f=null),c=c.return}f===c&&(f=null),c.sibling.return=c.return,c=c.sibling}}break;case 19:Yn(t,e),nr(e),s&4&&em(e);break;case 21:break;default:Yn(t,e),nr(e)}}function nr(e){var t=e.flags;if(t&2){try{e:{for(var n=e.return;n!==null;){if(Ex(n)){var s=n;break e}n=n.return}throw Error(le(160))}switch(s.tag){case 5:var o=s.stateNode;s.flags&32&&($i(o,""),s.flags&=-33);var i=Z0(e);zu(e,i,o);break;case 3:case 4:var a=s.stateNode.containerInfo,l=Z0(e);Pu(e,l,a);break;default:throw Error(le(161))}}catch(d){Ct(e,e.return,d)}e.flags&=-3}t&4096&&(e.flags&=-4097)}function xS(e,t,n){Ce=e,Cx(e)}function Cx(e,t,n){for(var s=(e.mode&1)!==0;Ce!==null;){var o=Ce,i=o.child;if(o.tag===22&&s){var a=o.memoizedState!==null||Ua;if(!a){var l=o.alternate,d=l!==null&&l.memoizedState!==null||Zt;l=Ua;var p=Zt;if(Ua=a,(Zt=d)&&!p)for(Ce=o;Ce!==null;)a=Ce,d=a.child,a.tag===22&&a.memoizedState!==null?rm(o):d!==null?(d.return=a,Ce=d):rm(o);for(;i!==null;)Ce=i,Cx(i),i=i.sibling;Ce=o,Ua=l,Zt=p}tm(e)}else o.subtreeFlags&8772&&i!==null?(i.return=o,Ce=i):tm(e)}}function tm(e){for(;Ce!==null;){var t=Ce;if(t.flags&8772){var n=t.alternate;try{if(t.flags&8772)switch(t.tag){case 0:case 11:case 15:Zt||hc(5,t);break;case 1:var s=t.stateNode;if(t.flags&4&&!Zt)if(n===null)s.componentDidMount();else{var o=t.elementType===t.type?n.memoizedProps:Kn(t.type,n.memoizedProps);s.componentDidUpdate(o,n.memoizedState,s.__reactInternalSnapshotBeforeUpdate)}var i=t.updateQueue;i!==null&&z0(t,i,s);break;case 3:var a=t.updateQueue;if(a!==null){if(n=null,t.child!==null)switch(t.child.tag){case 5:n=t.child.stateNode;break;case 1:n=t.child.stateNode}z0(t,a,n)}break;case 5:var l=t.stateNode;if(n===null&&t.flags&4){n=l;var d=t.memoizedProps;switch(t.type){case"button":case"input":case"select":case"textarea":d.autoFocus&&n.focus();break;case"img":d.src&&(n.src=d.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(t.memoizedState===null){var p=t.alternate;if(p!==null){var f=p.memoizedState;if(f!==null){var c=f.dehydrated;c!==null&&zi(c)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(le(163))}Zt||t.flags&512&&Ou(t)}catch(u){Ct(t,t.return,u)}}if(t===e){Ce=null;break}if(n=t.sibling,n!==null){n.return=t.return,Ce=n;break}Ce=t.return}}function nm(e){for(;Ce!==null;){var t=Ce;if(t===e){Ce=null;break}var n=t.sibling;if(n!==null){n.return=t.return,Ce=n;break}Ce=t.return}}function rm(e){for(;Ce!==null;){var t=Ce;try{switch(t.tag){case 0:case 11:case 15:var n=t.return;try{hc(4,t)}catch(d){Ct(t,n,d)}break;case 1:var s=t.stateNode;if(typeof s.componentDidMount=="function"){var o=t.return;try{s.componentDidMount()}catch(d){Ct(t,o,d)}}var i=t.return;try{Ou(t)}catch(d){Ct(t,i,d)}break;case 5:var a=t.return;try{Ou(t)}catch(d){Ct(t,a,d)}}}catch(d){Ct(t,t.return,d)}if(t===e){Ce=null;break}var l=t.sibling;if(l!==null){l.return=t.return,Ce=l;break}Ce=t.return}}var yS=Math.ceil,Ul=Tr.ReactCurrentDispatcher,Fp=Tr.ReactCurrentOwner,Fn=Tr.ReactCurrentBatchConfig,tt=0,Dt=null,Mt=null,Vt=0,En=0,so=Zr(0),$t=0,Qi=null,Es=0,gc=0,Hp=0,Mi=null,mn=null,Wp=0,wo=1/0,hr=null,Gl=!1,Du=null,Gr=null,Ga=!1,Pr=null,Vl=0,Ai=0,Fu=null,pl=-1,fl=0;function sn(){return tt&6?_t():pl!==-1?pl:pl=_t()}function Vr(e){return e.mode&1?tt&2&&Vt!==0?Vt&-Vt:tS.transition!==null?(fl===0&&(fl=dg()),fl):(e=at,e!==0||(e=window.event,e=e===void 0?16:xg(e.type)),e):1}function Zn(e,t,n,s){if(50<Ai)throw Ai=0,Fu=null,Error(le(185));ea(e,n,s),(!(tt&2)||e!==Dt)&&(e===Dt&&(!(tt&2)&&(gc|=n),$t===4&&Br(e,Vt)),yn(e,s),n===1&&tt===0&&!(t.mode&1)&&(wo=_t()+500,pc&&es()))}function yn(e,t){var n=e.callbackNode;tv(e,t);var s=_l(e,e===Dt?Vt:0);if(s===0)n!==null&&p0(n),e.callbackNode=null,e.callbackPriority=0;else if(t=s&-s,e.callbackPriority!==t){if(n!=null&&p0(n),t===1)e.tag===0?eS(sm.bind(null,e)):Bg(sm.bind(null,e)),Qv(function(){!(tt&6)&&es()}),n=null;else{switch(ug(s)){case 1:n=hp;break;case 4:n=lg;break;case 16:n=Il;break;case 536870912:n=cg;break;default:n=Il}n=Lx(n,Tx.bind(null,e))}e.callbackPriority=t,e.callbackNode=n}}function Tx(e,t){if(pl=-1,fl=0,tt&6)throw Error(le(327));var n=e.callbackNode;if(po()&&e.callbackNode!==n)return null;var s=_l(e,e===Dt?Vt:0);if(s===0)return null;if(s&30||s&e.expiredLanes||t)t=Yl(e,s);else{t=s;var o=tt;tt|=2;var i=_x();(Dt!==e||Vt!==t)&&(hr=null,wo=_t()+500,hs(e,t));do try{SS();break}catch(l){Ix(e,l)}while(!0);Ip(),Ul.current=i,tt=o,Mt!==null?t=0:(Dt=null,Vt=0,t=$t)}if(t!==0){if(t===2&&(o=mu(e),o!==0&&(s=o,t=Hu(e,o))),t===1)throw n=Qi,hs(e,0),Br(e,s),yn(e,_t()),n;if(t===6)Br(e,s);else{if(o=e.current.alternate,!(s&30)&&!bS(o)&&(t=Yl(e,s),t===2&&(i=mu(e),i!==0&&(s=i,t=Hu(e,i))),t===1))throw n=Qi,hs(e,0),Br(e,s),yn(e,_t()),n;switch(e.finishedWork=o,e.finishedLanes=s,t){case 0:case 1:throw Error(le(345));case 2:us(e,mn,hr);break;case 3:if(Br(e,s),(s&130023424)===s&&(t=Wp+500-_t(),10<t)){if(_l(e,0)!==0)break;if(o=e.suspendedLanes,(o&s)!==s){sn(),e.pingedLanes|=e.suspendedLanes&o;break}e.timeoutHandle=wu(us.bind(null,e,mn,hr),t);break}us(e,mn,hr);break;case 4:if(Br(e,s),(s&4194240)===s)break;for(t=e.eventTimes,o=-1;0<s;){var a=31-Xn(s);i=1<<a,a=t[a],a>o&&(o=a),s&=~i}if(s=o,s=_t()-s,s=(120>s?120:480>s?480:1080>s?1080:1920>s?1920:3e3>s?3e3:4320>s?4320:1960*yS(s/1960))-s,10<s){e.timeoutHandle=wu(us.bind(null,e,mn,hr),s);break}us(e,mn,hr);break;case 5:us(e,mn,hr);break;default:throw Error(le(329))}}}return yn(e,_t()),e.callbackNode===n?Tx.bind(null,e):null}function Hu(e,t){var n=Mi;return e.current.memoizedState.isDehydrated&&(hs(e,t).flags|=256),e=Yl(e,t),e!==2&&(t=mn,mn=n,t!==null&&Wu(t)),e}function Wu(e){mn===null?mn=e:mn.push.apply(mn,e)}function bS(e){for(var t=e;;){if(t.flags&16384){var n=t.updateQueue;if(n!==null&&(n=n.stores,n!==null))for(var s=0;s<n.length;s++){var o=n[s],i=o.getSnapshot;o=o.value;try{if(!er(i(),o))return!1}catch{return!1}}}if(n=t.child,t.subtreeFlags&16384&&n!==null)n.return=t,t=n;else{if(t===e)break;for(;t.sibling===null;){if(t.return===null||t.return===e)return!0;t=t.return}t.sibling.return=t.return,t=t.sibling}}return!0}function Br(e,t){for(t&=~Hp,t&=~gc,e.suspendedLanes|=t,e.pingedLanes&=~t,e=e.expirationTimes;0<t;){var n=31-Xn(t),s=1<<n;e[n]=-1,t&=~s}}function sm(e){if(tt&6)throw Error(le(327));po();var t=_l(e,0);if(!(t&1))return yn(e,_t()),null;var n=Yl(e,t);if(e.tag!==0&&n===2){var s=mu(e);s!==0&&(t=s,n=Hu(e,s))}if(n===1)throw n=Qi,hs(e,0),Br(e,t),yn(e,_t()),n;if(n===6)throw Error(le(345));return e.finishedWork=e.current.alternate,e.finishedLanes=t,us(e,mn,hr),yn(e,_t()),null}function Up(e,t){var n=tt;tt|=1;try{return e(t)}finally{tt=n,tt===0&&(wo=_t()+500,pc&&es())}}function ks(e){Pr!==null&&Pr.tag===0&&!(tt&6)&&po();var t=tt;tt|=1;var n=Fn.transition,s=at;try{if(Fn.transition=null,at=1,e)return e()}finally{at=s,Fn.transition=n,tt=t,!(tt&6)&&es()}}function Gp(){En=so.current,gt(so)}function hs(e,t){e.finishedWork=null,e.finishedLanes=0;var n=e.timeoutHandle;if(n!==-1&&(e.timeoutHandle=-1,Kv(n)),Mt!==null)for(n=Mt.return;n!==null;){var s=n;switch(jp(s),s.tag){case 1:s=s.type.childContextTypes,s!=null&&Ll();break;case 3:vo(),gt(gn),gt(en),Lp();break;case 5:Np(s);break;case 4:vo();break;case 13:gt(Et);break;case 19:gt(Et);break;case 10:_p(s.type._context);break;case 22:case 23:Gp()}n=n.return}if(Dt=e,Mt=e=Yr(e.current,null),Vt=En=t,$t=0,Qi=null,Hp=gc=Es=0,mn=Mi=null,fs!==null){for(t=0;t<fs.length;t++)if(n=fs[t],s=n.interleaved,s!==null){n.interleaved=null;var o=s.next,i=n.pending;if(i!==null){var a=i.next;i.next=o,s.next=a}n.pending=s}fs=null}return e}function Ix(e,t){do{var n=Mt;try{if(Ip(),cl.current=Wl,Hl){for(var s=kt.memoizedState;s!==null;){var o=s.queue;o!==null&&(o.pending=null),s=s.next}Hl=!1}if(ws=0,zt=Nt=kt=null,_i=!1,Yi=0,Fp.current=null,n===null||n.return===null){$t=1,Qi=t,Mt=null;break}e:{var i=e,a=n.return,l=n,d=t;if(t=Vt,l.flags|=32768,d!==null&&typeof d=="object"&&typeof d.then=="function"){var p=d,f=l,c=f.tag;if(!(f.mode&1)&&(c===0||c===11||c===15)){var u=f.alternate;u?(f.updateQueue=u.updateQueue,f.memoizedState=u.memoizedState,f.lanes=u.lanes):(f.updateQueue=null,f.memoizedState=null)}var x=G0(a);if(x!==null){x.flags&=-257,V0(x,a,l,i,t),x.mode&1&&U0(i,p,t),t=x,d=p;var S=t.updateQueue;if(S===null){var w=new Set;w.add(d),t.updateQueue=w}else S.add(d);break e}else{if(!(t&1)){U0(i,p,t),Vp();break e}d=Error(le(426))}}else if(bt&&l.mode&1){var C=G0(a);if(C!==null){!(C.flags&65536)&&(C.flags|=256),V0(C,a,l,i,t),Cp(So(d,l));break e}}i=d=So(d,l),$t!==4&&($t=2),Mi===null?Mi=[i]:Mi.push(i),i=a;do{switch(i.tag){case 3:i.flags|=65536,t&=-t,i.lanes|=t;var h=ux(i,d,t);P0(i,h);break e;case 1:l=d;var g=i.type,b=i.stateNode;if(!(i.flags&128)&&(typeof g.getDerivedStateFromError=="function"||b!==null&&typeof b.componentDidCatch=="function"&&(Gr===null||!Gr.has(b)))){i.flags|=65536,t&=-t,i.lanes|=t;var E=px(i,l,t);P0(i,E);break e}}i=i.return}while(i!==null)}Mx(n)}catch(I){t=I,Mt===n&&n!==null&&(Mt=n=n.return);continue}break}while(!0)}function _x(){var e=Ul.current;return Ul.current=Wl,e===null?Wl:e}function Vp(){($t===0||$t===3||$t===2)&&($t=4),Dt===null||!(Es&268435455)&&!(gc&268435455)||Br(Dt,Vt)}function Yl(e,t){var n=tt;tt|=2;var s=_x();(Dt!==e||Vt!==t)&&(hr=null,hs(e,t));do try{vS();break}catch(o){Ix(e,o)}while(!0);if(Ip(),tt=n,Ul.current=s,Mt!==null)throw Error(le(261));return Dt=null,Vt=0,$t}function vS(){for(;Mt!==null;)Rx(Mt)}function SS(){for(;Mt!==null&&!Vb();)Rx(Mt)}function Rx(e){var t=Nx(e.alternate,e,En);e.memoizedProps=e.pendingProps,t===null?Mx(e):Mt=t,Fp.current=null}function Mx(e){var t=e;do{var n=t.alternate;if(e=t.return,t.flags&32768){if(n=mS(n,t),n!==null){n.flags&=32767,Mt=n;return}if(e!==null)e.flags|=32768,e.subtreeFlags=0,e.deletions=null;else{$t=6,Mt=null;return}}else if(n=fS(n,t,En),n!==null){Mt=n;return}if(t=t.sibling,t!==null){Mt=t;return}Mt=t=e}while(t!==null);$t===0&&($t=5)}function us(e,t,n){var s=at,o=Fn.transition;try{Fn.transition=null,at=1,wS(e,t,n,s)}finally{Fn.transition=o,at=s}return null}function wS(e,t,n,s){do po();while(Pr!==null);if(tt&6)throw Error(le(327));n=e.finishedWork;var o=e.finishedLanes;if(n===null)return null;if(e.finishedWork=null,e.finishedLanes=0,n===e.current)throw Error(le(177));e.callbackNode=null,e.callbackPriority=0;var i=n.lanes|n.childLanes;if(nv(e,i),e===Dt&&(Mt=Dt=null,Vt=0),!(n.subtreeFlags&2064)&&!(n.flags&2064)||Ga||(Ga=!0,Lx(Il,function(){return po(),null})),i=(n.flags&15990)!==0,n.subtreeFlags&15990||i){i=Fn.transition,Fn.transition=null;var a=at;at=1;var l=tt;tt|=4,Fp.current=null,gS(e,n),jx(n,e),Hv(vu),Rl=!!bu,vu=bu=null,e.current=n,xS(n),Yb(),tt=l,at=a,Fn.transition=i}else e.current=n;if(Ga&&(Ga=!1,Pr=e,Vl=o),i=e.pendingLanes,i===0&&(Gr=null),Qb(n.stateNode),yn(e,_t()),t!==null)for(s=e.onRecoverableError,n=0;n<t.length;n++)o=t[n],s(o.value,{componentStack:o.stack,digest:o.digest});if(Gl)throw Gl=!1,e=Du,Du=null,e;return Vl&1&&e.tag!==0&&po(),i=e.pendingLanes,i&1?e===Fu?Ai++:(Ai=0,Fu=e):Ai=0,es(),null}function po(){if(Pr!==null){var e=ug(Vl),t=Fn.transition,n=at;try{if(Fn.transition=null,at=16>e?16:e,Pr===null)var s=!1;else{if(e=Pr,Pr=null,Vl=0,tt&6)throw Error(le(331));var o=tt;for(tt|=4,Ce=e.current;Ce!==null;){var i=Ce,a=i.child;if(Ce.flags&16){var l=i.deletions;if(l!==null){for(var d=0;d<l.length;d++){var p=l[d];for(Ce=p;Ce!==null;){var f=Ce;switch(f.tag){case 0:case 11:case 15:Ri(8,f,i)}var c=f.child;if(c!==null)c.return=f,Ce=c;else for(;Ce!==null;){f=Ce;var u=f.sibling,x=f.return;if(wx(f),f===p){Ce=null;break}if(u!==null){u.return=x,Ce=u;break}Ce=x}}}var S=i.alternate;if(S!==null){var w=S.child;if(w!==null){S.child=null;do{var C=w.sibling;w.sibling=null,w=C}while(w!==null)}}Ce=i}}if(i.subtreeFlags&2064&&a!==null)a.return=i,Ce=a;else e:for(;Ce!==null;){if(i=Ce,i.flags&2048)switch(i.tag){case 0:case 11:case 15:Ri(9,i,i.return)}var h=i.sibling;if(h!==null){h.return=i.return,Ce=h;break e}Ce=i.return}}var g=e.current;for(Ce=g;Ce!==null;){a=Ce;var b=a.child;if(a.subtreeFlags&2064&&b!==null)b.return=a,Ce=b;else e:for(a=g;Ce!==null;){if(l=Ce,l.flags&2048)try{switch(l.tag){case 0:case 11:case 15:hc(9,l)}}catch(I){Ct(l,l.return,I)}if(l===a){Ce=null;break e}var E=l.sibling;if(E!==null){E.return=l.return,Ce=E;break e}Ce=l.return}}if(tt=o,es(),cr&&typeof cr.onPostCommitFiberRoot=="function")try{cr.onPostCommitFiberRoot(ac,e)}catch{}s=!0}return s}finally{at=n,Fn.transition=t}}return!1}function om(e,t,n){t=So(n,t),t=ux(e,t,1),e=Ur(e,t,1),t=sn(),e!==null&&(ea(e,1,t),yn(e,t))}function Ct(e,t,n){if(e.tag===3)om(e,e,n);else for(;t!==null;){if(t.tag===3){om(t,e,n);break}else if(t.tag===1){var s=t.stateNode;if(typeof t.type.getDerivedStateFromError=="function"||typeof s.componentDidCatch=="function"&&(Gr===null||!Gr.has(s))){e=So(n,e),e=px(t,e,1),t=Ur(t,e,1),e=sn(),t!==null&&(ea(t,1,e),yn(t,e));break}}t=t.return}}function ES(e,t,n){var s=e.pingCache;s!==null&&s.delete(t),t=sn(),e.pingedLanes|=e.suspendedLanes&n,Dt===e&&(Vt&n)===n&&($t===4||$t===3&&(Vt&130023424)===Vt&&500>_t()-Wp?hs(e,0):Hp|=n),yn(e,t)}function Ax(e,t){t===0&&(e.mode&1?(t=$a,$a<<=1,!($a&130023424)&&($a=4194304)):t=1);var n=sn();e=kr(e,t),e!==null&&(ea(e,t,n),yn(e,n))}function kS(e){var t=e.memoizedState,n=0;t!==null&&(n=t.retryLane),Ax(e,n)}function jS(e,t){var n=0;switch(e.tag){case 13:var s=e.stateNode,o=e.memoizedState;o!==null&&(n=o.retryLane);break;case 19:s=e.stateNode;break;default:throw Error(le(314))}s!==null&&s.delete(t),Ax(e,n)}var Nx;Nx=function(e,t,n){if(e!==null)if(e.memoizedProps!==t.pendingProps||gn.current)hn=!0;else{if(!(e.lanes&n)&&!(t.flags&128))return hn=!1,pS(e,t,n);hn=!!(e.flags&131072)}else hn=!1,bt&&t.flags&1048576&&Og(t,Ol,t.index);switch(t.lanes=0,t.tag){case 2:var s=t.type;ul(e,t),e=t.pendingProps;var o=xo(t,en.current);uo(t,n),o=Bp(null,t,s,e,o,n);var i=Op();return t.flags|=1,typeof o=="object"&&o!==null&&typeof o.render=="function"&&o.$$typeof===void 0?(t.tag=1,t.memoizedState=null,t.updateQueue=null,xn(s)?(i=!0,$l(t)):i=!1,t.memoizedState=o.state!==null&&o.state!==void 0?o.state:null,Mp(t),o.updater=mc,t.stateNode=o,o._reactInternals=t,_u(t,s,e,n),t=Au(null,t,s,!0,i,n)):(t.tag=0,bt&&i&&kp(t),rn(null,t,o,n),t=t.child),t;case 16:s=t.elementType;e:{switch(ul(e,t),e=t.pendingProps,o=s._init,s=o(s._payload),t.type=s,o=t.tag=TS(s),e=Kn(s,e),o){case 0:t=Mu(null,t,s,e,n);break e;case 1:t=K0(null,t,s,e,n);break e;case 11:t=Y0(null,t,s,e,n);break e;case 14:t=q0(null,t,s,Kn(s.type,e),n);break e}throw Error(le(306,s,""))}return t;case 0:return s=t.type,o=t.pendingProps,o=t.elementType===s?o:Kn(s,o),Mu(e,t,s,o,n);case 1:return s=t.type,o=t.pendingProps,o=t.elementType===s?o:Kn(s,o),K0(e,t,s,o,n);case 3:e:{if(gx(t),e===null)throw Error(le(387));s=t.pendingProps,i=t.memoizedState,o=i.element,Wg(e,t),Dl(t,s,null,n);var a=t.memoizedState;if(s=a.element,i.isDehydrated)if(i={element:s,isDehydrated:!1,cache:a.cache,pendingSuspenseBoundaries:a.pendingSuspenseBoundaries,transitions:a.transitions},t.updateQueue.baseState=i,t.memoizedState=i,t.flags&256){o=So(Error(le(423)),t),t=Q0(e,t,s,n,o);break e}else if(s!==o){o=So(Error(le(424)),t),t=Q0(e,t,s,n,o);break e}else for(kn=Wr(t.stateNode.containerInfo.firstChild),jn=t,bt=!0,Jn=null,n=Fg(t,null,s,n),t.child=n;n;)n.flags=n.flags&-3|4096,n=n.sibling;else{if(yo(),s===o){t=jr(e,t,n);break e}rn(e,t,s,n)}t=t.child}return t;case 5:return Ug(t),e===null&&Cu(t),s=t.type,o=t.pendingProps,i=e!==null?e.memoizedProps:null,a=o.children,Su(s,o)?a=null:i!==null&&Su(s,i)&&(t.flags|=32),hx(e,t),rn(e,t,a,n),t.child;case 6:return e===null&&Cu(t),null;case 13:return xx(e,t,n);case 4:return Ap(t,t.stateNode.containerInfo),s=t.pendingProps,e===null?t.child=bo(t,null,s,n):rn(e,t,s,n),t.child;case 11:return s=t.type,o=t.pendingProps,o=t.elementType===s?o:Kn(s,o),Y0(e,t,s,o,n);case 7:return rn(e,t,t.pendingProps,n),t.child;case 8:return rn(e,t,t.pendingProps.children,n),t.child;case 12:return rn(e,t,t.pendingProps.children,n),t.child;case 10:e:{if(s=t.type._context,o=t.pendingProps,i=t.memoizedProps,a=o.value,ft(Pl,s._currentValue),s._currentValue=a,i!==null)if(er(i.value,a)){if(i.children===o.children&&!gn.current){t=jr(e,t,n);break e}}else for(i=t.child,i!==null&&(i.return=t);i!==null;){var l=i.dependencies;if(l!==null){a=i.child;for(var d=l.firstContext;d!==null;){if(d.context===s){if(i.tag===1){d=Sr(-1,n&-n),d.tag=2;var p=i.updateQueue;if(p!==null){p=p.shared;var f=p.pending;f===null?d.next=d:(d.next=f.next,f.next=d),p.pending=d}}i.lanes|=n,d=i.alternate,d!==null&&(d.lanes|=n),Tu(i.return,n,t),l.lanes|=n;break}d=d.next}}else if(i.tag===10)a=i.type===t.type?null:i.child;else if(i.tag===18){if(a=i.return,a===null)throw Error(le(341));a.lanes|=n,l=a.alternate,l!==null&&(l.lanes|=n),Tu(a,n,t),a=i.sibling}else a=i.child;if(a!==null)a.return=i;else for(a=i;a!==null;){if(a===t){a=null;break}if(i=a.sibling,i!==null){i.return=a.return,a=i;break}a=a.return}i=a}rn(e,t,o.children,n),t=t.child}return t;case 9:return o=t.type,s=t.pendingProps.children,uo(t,n),o=Hn(o),s=s(o),t.flags|=1,rn(e,t,s,n),t.child;case 14:return s=t.type,o=Kn(s,t.pendingProps),o=Kn(s.type,o),q0(e,t,s,o,n);case 15:return fx(e,t,t.type,t.pendingProps,n);case 17:return s=t.type,o=t.pendingProps,o=t.elementType===s?o:Kn(s,o),ul(e,t),t.tag=1,xn(s)?(e=!0,$l(t)):e=!1,uo(t,n),dx(t,s,o),_u(t,s,o,n),Au(null,t,s,!0,e,n);case 19:return yx(e,t,n);case 22:return mx(e,t,n)}throw Error(le(156,t.tag))};function Lx(e,t){return ag(e,t)}function CS(e,t,n,s){this.tag=e,this.key=n,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=t,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=s,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Dn(e,t,n,s){return new CS(e,t,n,s)}function Yp(e){return e=e.prototype,!(!e||!e.isReactComponent)}function TS(e){if(typeof e=="function")return Yp(e)?1:0;if(e!=null){if(e=e.$$typeof,e===pp)return 11;if(e===fp)return 14}return 2}function Yr(e,t){var n=e.alternate;return n===null?(n=Dn(e.tag,t,e.key,e.mode),n.elementType=e.elementType,n.type=e.type,n.stateNode=e.stateNode,n.alternate=e,e.alternate=n):(n.pendingProps=t,n.type=e.type,n.flags=0,n.subtreeFlags=0,n.deletions=null),n.flags=e.flags&14680064,n.childLanes=e.childLanes,n.lanes=e.lanes,n.child=e.child,n.memoizedProps=e.memoizedProps,n.memoizedState=e.memoizedState,n.updateQueue=e.updateQueue,t=e.dependencies,n.dependencies=t===null?null:{lanes:t.lanes,firstContext:t.firstContext},n.sibling=e.sibling,n.index=e.index,n.ref=e.ref,n}function ml(e,t,n,s,o,i){var a=2;if(s=e,typeof e=="function")Yp(e)&&(a=1);else if(typeof e=="string")a=5;else e:switch(e){case qs:return gs(n.children,o,i,t);case up:a=8,o|=8;break;case Zd:return e=Dn(12,n,t,o|2),e.elementType=Zd,e.lanes=i,e;case eu:return e=Dn(13,n,t,o),e.elementType=eu,e.lanes=i,e;case tu:return e=Dn(19,n,t,o),e.elementType=tu,e.lanes=i,e;case Uh:return xc(n,o,i,t);default:if(typeof e=="object"&&e!==null)switch(e.$$typeof){case Hh:a=10;break e;case Wh:a=9;break e;case pp:a=11;break e;case fp:a=14;break e;case Ar:a=16,s=null;break e}throw Error(le(130,e==null?e:typeof e,""))}return t=Dn(a,n,t,o),t.elementType=e,t.type=s,t.lanes=i,t}function gs(e,t,n,s){return e=Dn(7,e,s,t),e.lanes=n,e}function xc(e,t,n,s){return e=Dn(22,e,s,t),e.elementType=Uh,e.lanes=n,e.stateNode={isHidden:!1},e}function _d(e,t,n){return e=Dn(6,e,null,t),e.lanes=n,e}function Rd(e,t,n){return t=Dn(4,e.children!==null?e.children:[],e.key,t),t.lanes=n,t.stateNode={containerInfo:e.containerInfo,pendingChildren:null,implementation:e.implementation},t}function IS(e,t,n,s,o){this.tag=t,this.containerInfo=e,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=dd(0),this.expirationTimes=dd(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=dd(0),this.identifierPrefix=s,this.onRecoverableError=o,this.mutableSourceEagerHydrationData=null}function qp(e,t,n,s,o,i,a,l,d){return e=new IS(e,t,n,l,d),t===1?(t=1,i===!0&&(t|=8)):t=0,i=Dn(3,null,null,t),e.current=i,i.stateNode=e,i.memoizedState={element:s,isDehydrated:n,cache:null,transitions:null,pendingSuspenseBoundaries:null},Mp(i),e}function _S(e,t,n){var s=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:Ys,key:s==null?null:""+s,children:e,containerInfo:t,implementation:n}}function $x(e){if(!e)return Qr;e=e._reactInternals;e:{if(Is(e)!==e||e.tag!==1)throw Error(le(170));var t=e;do{switch(t.tag){case 3:t=t.stateNode.context;break e;case 1:if(xn(t.type)){t=t.stateNode.__reactInternalMemoizedMergedChildContext;break e}}t=t.return}while(t!==null);throw Error(le(171))}if(e.tag===1){var n=e.type;if(xn(n))return $g(e,n,t)}return t}function Bx(e,t,n,s,o,i,a,l,d){return e=qp(n,s,!0,e,o,i,a,l,d),e.context=$x(null),n=e.current,s=sn(),o=Vr(n),i=Sr(s,o),i.callback=t??null,Ur(n,i,o),e.current.lanes=o,ea(e,o,s),yn(e,s),e}function yc(e,t,n,s){var o=t.current,i=sn(),a=Vr(o);return n=$x(n),t.context===null?t.context=n:t.pendingContext=n,t=Sr(i,a),t.payload={element:e},s=s===void 0?null:s,s!==null&&(t.callback=s),e=Ur(o,t,a),e!==null&&(Zn(e,o,a,i),ll(e,o,a)),a}function ql(e){if(e=e.current,!e.child)return null;switch(e.child.tag){case 5:return e.child.stateNode;default:return e.child.stateNode}}function im(e,t){if(e=e.memoizedState,e!==null&&e.dehydrated!==null){var n=e.retryLane;e.retryLane=n!==0&&n<t?n:t}}function Kp(e,t){im(e,t),(e=e.alternate)&&im(e,t)}function RS(){return null}var Ox=typeof reportError=="function"?reportError:function(e){console.error(e)};function Qp(e){this._internalRoot=e}bc.prototype.render=Qp.prototype.render=function(e){var t=this._internalRoot;if(t===null)throw Error(le(409));yc(e,t,null,null)};bc.prototype.unmount=Qp.prototype.unmount=function(){var e=this._internalRoot;if(e!==null){this._internalRoot=null;var t=e.containerInfo;ks(function(){yc(null,e,null,null)}),t[Er]=null}};function bc(e){this._internalRoot=e}bc.prototype.unstable_scheduleHydration=function(e){if(e){var t=mg();e={blockedOn:null,target:e,priority:t};for(var n=0;n<$r.length&&t!==0&&t<$r[n].priority;n++);$r.splice(n,0,e),n===0&&gg(e)}};function Jp(e){return!(!e||e.nodeType!==1&&e.nodeType!==9&&e.nodeType!==11)}function vc(e){return!(!e||e.nodeType!==1&&e.nodeType!==9&&e.nodeType!==11&&(e.nodeType!==8||e.nodeValue!==" react-mount-point-unstable "))}function am(){}function MS(e,t,n,s,o){if(o){if(typeof s=="function"){var i=s;s=function(){var p=ql(a);i.call(p)}}var a=Bx(t,s,e,0,null,!1,!1,"",am);return e._reactRootContainer=a,e[Er]=a.current,Hi(e.nodeType===8?e.parentNode:e),ks(),a}for(;o=e.lastChild;)e.removeChild(o);if(typeof s=="function"){var l=s;s=function(){var p=ql(d);l.call(p)}}var d=qp(e,0,!1,null,null,!1,!1,"",am);return e._reactRootContainer=d,e[Er]=d.current,Hi(e.nodeType===8?e.parentNode:e),ks(function(){yc(t,d,n,s)}),d}function Sc(e,t,n,s,o){var i=n._reactRootContainer;if(i){var a=i;if(typeof o=="function"){var l=o;o=function(){var d=ql(a);l.call(d)}}yc(t,a,e,o)}else a=MS(n,t,e,o,s);return ql(a)}pg=function(e){switch(e.tag){case 3:var t=e.stateNode;if(t.current.memoizedState.isDehydrated){var n=vi(t.pendingLanes);n!==0&&(gp(t,n|1),yn(t,_t()),!(tt&6)&&(wo=_t()+500,es()))}break;case 13:ks(function(){var s=kr(e,1);if(s!==null){var o=sn();Zn(s,e,1,o)}}),Kp(e,1)}};xp=function(e){if(e.tag===13){var t=kr(e,134217728);if(t!==null){var n=sn();Zn(t,e,134217728,n)}Kp(e,134217728)}};fg=function(e){if(e.tag===13){var t=Vr(e),n=kr(e,t);if(n!==null){var s=sn();Zn(n,e,t,s)}Kp(e,t)}};mg=function(){return at};hg=function(e,t){var n=at;try{return at=e,t()}finally{at=n}};uu=function(e,t,n){switch(t){case"input":if(su(e,n),t=n.name,n.type==="radio"&&t!=null){for(n=e;n.parentNode;)n=n.parentNode;for(n=n.querySelectorAll("input[name="+JSON.stringify(""+t)+'][type="radio"]'),t=0;t<n.length;t++){var s=n[t];if(s!==e&&s.form===e.form){var o=uc(s);if(!o)throw Error(le(90));Vh(s),su(s,o)}}}break;case"textarea":qh(e,n);break;case"select":t=n.value,t!=null&&io(e,!!n.multiple,t,!1)}};tg=Up;ng=ks;var AS={usingClientEntryPoint:!1,Events:[na,Xs,uc,Zh,eg,Up]},di={findFiberByHostInstance:ps,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},NS={bundleType:di.bundleType,version:di.version,rendererPackageName:di.rendererPackageName,rendererConfig:di.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:Tr.ReactCurrentDispatcher,findHostInstanceByFiber:function(e){return e=og(e),e===null?null:e.stateNode},findFiberByHostInstance:di.findFiberByHostInstance||RS,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var Va=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Va.isDisabled&&Va.supportsFiber)try{ac=Va.inject(NS),cr=Va}catch{}}Tn.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=AS;Tn.createPortal=function(e,t){var n=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!Jp(t))throw Error(le(200));return _S(e,t,null,n)};Tn.createRoot=function(e,t){if(!Jp(e))throw Error(le(299));var n=!1,s="",o=Ox;return t!=null&&(t.unstable_strictMode===!0&&(n=!0),t.identifierPrefix!==void 0&&(s=t.identifierPrefix),t.onRecoverableError!==void 0&&(o=t.onRecoverableError)),t=qp(e,1,!1,null,null,n,!1,s,o),e[Er]=t.current,Hi(e.nodeType===8?e.parentNode:e),new Qp(t)};Tn.findDOMNode=function(e){if(e==null)return null;if(e.nodeType===1)return e;var t=e._reactInternals;if(t===void 0)throw typeof e.render=="function"?Error(le(188)):(e=Object.keys(e).join(","),Error(le(268,e)));return e=og(t),e=e===null?null:e.stateNode,e};Tn.flushSync=function(e){return ks(e)};Tn.hydrate=function(e,t,n){if(!vc(t))throw Error(le(200));return Sc(null,e,t,!0,n)};Tn.hydrateRoot=function(e,t,n){if(!Jp(e))throw Error(le(405));var s=n!=null&&n.hydratedSources||null,o=!1,i="",a=Ox;if(n!=null&&(n.unstable_strictMode===!0&&(o=!0),n.identifierPrefix!==void 0&&(i=n.identifierPrefix),n.onRecoverableError!==void 0&&(a=n.onRecoverableError)),t=Bx(t,null,e,1,n??null,o,!1,i,a),e[Er]=t.current,Hi(e),s)for(e=0;e<s.length;e++)n=s[e],o=n._getVersion,o=o(n._source),t.mutableSourceEagerHydrationData==null?t.mutableSourceEagerHydrationData=[n,o]:t.mutableSourceEagerHydrationData.push(n,o);return new bc(t)};Tn.render=function(e,t,n){if(!vc(t))throw Error(le(200));return Sc(null,e,t,!1,n)};Tn.unmountComponentAtNode=function(e){if(!vc(e))throw Error(le(40));return e._reactRootContainer?(ks(function(){Sc(null,null,e,!1,function(){e._reactRootContainer=null,e[Er]=null})}),!0):!1};Tn.unstable_batchedUpdates=Up;Tn.unstable_renderSubtreeIntoContainer=function(e,t,n,s){if(!vc(n))throw Error(le(200));if(e==null||e._reactInternals===void 0)throw Error(le(38));return Sc(e,t,n,!1,s)};Tn.version="18.3.1-next-f1338f8080-20240426";function Px(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(Px)}catch(e){console.error(e)}}Px(),Ph.exports=Tn;var LS=Ph.exports,lm=LS;Jd.createRoot=lm.createRoot,Jd.hydrateRoot=lm.hydrateRoot;const $S="modulepreload",BS=function(e,t){return new URL(e,t).href},cm={},OS=function(t,n,s){let o=Promise.resolve();if(n&&n.length>0){const a=document.getElementsByTagName("link"),l=document.querySelector("meta[property=csp-nonce]"),d=(l==null?void 0:l.nonce)||(l==null?void 0:l.getAttribute("nonce"));o=Promise.allSettled(n.map(p=>{if(p=BS(p,s),p in cm)return;cm[p]=!0;const f=p.endsWith(".css"),c=f?'[rel="stylesheet"]':"";if(!!s)for(let S=a.length-1;S>=0;S--){const w=a[S];if(w.href===p&&(!f||w.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${p}"]${c}`))return;const x=document.createElement("link");if(x.rel=f?"stylesheet":$S,f||(x.as="script"),x.crossOrigin="",x.href=p,d&&x.setAttribute("nonce",d),document.head.appendChild(x),f)return new Promise((S,w)=>{x.addEventListener("load",S),x.addEventListener("error",()=>w(new Error(`Unable to preload CSS for ${p}`)))})}))}function i(a){const l=new Event("vite:preloadError",{cancelable:!0});if(l.payload=a,window.dispatchEvent(l),!l.defaultPrevented)throw a}return o.then(a=>{for(const l of a||[])l.status==="rejected"&&i(l.reason);return t().catch(i)})},ye={colors:{background:"#F8F3EE",paper:"#F4EEE6",ink:"#2E2B26",primary:"#6B513A",accent:"#7AA893",muted:"#A59786",parchment:"#EDE3D6",border:"#B8A895",shadow:"rgba(34,28,22,0.12)"},gradients:{subtle:"linear-gradient(135deg, rgba(255,255,255,0.6), rgba(240,235,230,0.6))",warm:"linear-gradient(135deg, #EDE3D6 0%, #F4EEE6 100%)"},sizes:{navHeight:"56px"}},dm={appContainer:{display:"flex",flexDirection:"column",height:"100vh",fontFamily:"'Noto Serif SC', serif",backgroundColor:ye.colors.background,backgroundImage:"linear-gradient(rgba(245, 240, 232, 0.6), rgba(245, 240, 232, 0.6))",backgroundSize:"100% 100%"},mainContent:{flex:1,padding:"15px",paddingBottom:"70px",overflowY:"auto"}};function PS(){const[e,t]=y.useState({type:null,data:null}),[n,s]=y.useState(!1),[o,i]=y.useState(!1),[a,l]=y.useState(!1),[d,p]=y.useState(!1),[f,c]=y.useState(!1),[u,x]=y.useState(!1),[S,w]=y.useState({open:!1,npc:null}),[C,h]=y.useState({open:!1,mode:"VIEW",slot:null,childId:null}),[g,b]=y.useState(!1),[E,I]=y.useState(!1),[v,k]=y.useState(!1),[T,A]=y.useState(!1),R=y.useCallback((Ie,Be=null)=>{t({type:Ie,data:Be})},[]),$=y.useCallback(()=>{t({type:null,data:null})},[]),O=y.useCallback(()=>s(!0),[]),Q=y.useCallback(()=>s(!1),[]),L=y.useCallback(()=>i(!0),[]),G=y.useCallback(()=>i(!1),[]),ne=y.useCallback(()=>l(!0),[]),ae=y.useCallback(()=>l(!1),[]),Y=y.useCallback(()=>p(!0),[]),q=y.useCallback(()=>p(!1),[]),ie=y.useCallback(()=>c(!0),[]),Z=y.useCallback(()=>c(!1),[]),ve=y.useCallback(()=>x(!0),[]),V=y.useCallback(()=>x(!1),[]),ee=y.useCallback(Ie=>{w({open:!0,npc:Ie})},[]),he=y.useCallback(()=>{w({open:!1,npc:null})},[]),ge=y.useCallback((Ie="VIEW",Be=null,dt=null)=>{h({open:!0,mode:Ie,slot:Be,childId:dt})},[]),me=y.useCallback(()=>{h({open:!1,mode:"VIEW",slot:null,childId:null})},[]),Me=y.useCallback(()=>b(!0),[]),$e=y.useCallback(()=>b(!1),[]),je=y.useCallback(()=>I(!0),[]),ct=y.useCallback(()=>I(!1),[]),vt=y.useCallback(()=>k(!0),[]),De=y.useCallback(()=>k(!1),[]),D=y.useCallback(()=>A(!0),[]),Se=y.useCallback(()=>A(!1),[]),de=y.useCallback(()=>{$(),s(!1),i(!1),l(!1),p(!1),c(!1),x(!1),w({open:!1,npc:null}),h({open:!1,mode:"VIEW",slot:null,childId:null}),b(!1),I(!1),k(!1),A(!1)},[$]);return y.useMemo(()=>({modalState:e,openModal:R,closeModal:$,showGazette:n,setShowGazette:s,openGazette:O,closeGazette:Q,showMessageCenter:o,setShowMessageCenter:i,openMessageCenter:L,closeMessageCenter:G,showGuide:a,setShowGuide:l,openGuide:ne,closeGuide:ae,showTutorial:d,setShowTutorial:p,openTutorial:Y,closeTutorial:q,showBizPanel:f,setShowBizPanel:c,openBizPanel:ie,closeBizPanel:Z,showChallengePanel:u,setShowChallengePanel:x,openChallengePanel:ve,closeChallengePanel:V,npcLogModal:S,setNpcLogModal:w,openNpcLog:ee,closeNpcLog:he,inventoryModal:C,showBatchGiftModal:g,setShowBatchGiftModal:b,openBatchGiftModal:Me,closeBatchGiftModal:$e,showBatchPromotionModal:E,setShowBatchPromotionModal:I,openBatchPromotionModal:je,closeBatchPromotionModal:ct,showBatchMarriageModal:v,setShowBatchMarriageModal:k,openBatchMarriageModal:vt,closeBatchMarriageModal:De,showBatchManualModal:T,setShowBatchManualModal:A,openBatchManualModal:D,closeBatchManualModal:Se,openInventory:ge,closeInventory:me,closeAllModals:de}),[e,n,o,a,d,f,u,S,C,g,E,v,T])}const pt={PLAYER:"player",CHILD:"child",NPC:"npc"},zx=[pt.PLAYER,pt.CHILD,pt.NPC],K={MORTAL:{key:"MORTAL",label:"",color:"#8d6e63",order:1,desc:""},SPIRIT:{key:"SPIRIT",label:"",color:"#26a69a",order:2,desc:""},EARTH:{key:"EARTH",label:"",color:"#8bc34a",order:3,desc:""},HEAVEN:{key:"HEAVEN",label:"",color:"#7e57c2",order:4,desc:""},DIVINE:{key:"DIVINE",label:"",color:"#ffb300",order:5,desc:""}},Ee={GENERAL:{id:"GENERAL"},ELEMENTAL:{id:"ELEMENTAL"},VARIANT:{id:"VARIANT"},DUAL:{id:"DUAL"},DEVIL:{id:"DEVIL"}},Ya={SABER:{id:"SABER"},SPEAR:{id:"SPEAR"},RELIC:{id:"RELIC"}},lt={BODY:{id:"BODY"},FOUNDATION:{id:"FOUNDATION"},CORE:{id:"CORE"},NASCENT:{id:"NASCENT"},ASCENSION:{id:"ASCENSION"}},zS={[pt.PLAYER]:"",[pt.CHILD]:"",[pt.NPC]:""},qa=()=>[...zx],ce=()=>[pt.PLAYER,pt.CHILD],DS=()=>[pt.CHILD],wc={herb_bandage:{id:"herb_bandage",name:"",type:"consumable",rarity:"common",desc:"",effect:{kind:"heal",amount:100},resourceCategory:"PILL",resourceLevel:K.MORTAL.key,pillTier:lt.BODY.id,usageTargets:qa(),tags:["",""]},rice_ball:{id:"rice_ball",name:"",type:"consumable",rarity:"common",desc:"",effect:{kind:"heal",amount:60},resourceCategory:"PILL",resourceLevel:K.MORTAL.key,pillTier:lt.BODY.id,usageTargets:qa(),tags:["",""]},iron_sword:{id:"iron_sword",name:"",type:"weapon",slot:"weapon",rarity:"common",desc:"",stats:{atk:25},resourceCategory:"WEAPON",resourceLevel:K.MORTAL.key,weaponClass:Ya.SABER.id,usageTargets:ce(),tags:["",""]},beast_fang:{id:"beast_fang",name:"",type:"accessory",slot:"accessory",rarity:"uncommon",desc:"",stats:{atk:35},resourceCategory:"ACCESSORY",resourceLevel:K.SPIRIT.key,usageTargets:ce(),tags:["",""]},beast_core:{id:"beast_core",name:"",type:"consumable",rarity:"uncommon",desc:"",effect:{kind:"exp",amount:1200},resourceCategory:"PILL",resourceLevel:K.MORTAL.key,pillTier:lt.BODY.id,usageTargets:qa(),tags:["",""]},foundation_pill:{id:"foundation_pill",name:"",type:"consumable",rarity:"rare",desc:"",effect:{kind:"exp",amount:4e3},resourceCategory:"PILL",resourceLevel:K.SPIRIT.key,pillTier:lt.FOUNDATION.id,usageTargets:ce(),tags:["",""]},thunder_wood:{id:"thunder_wood",name:"",type:"accessory",slot:"accessory",rarity:"rare",desc:"",stats:{atk:60,mp:200},resourceCategory:"ACCESSORY",resourceLevel:K.SPIRIT.key,usageTargets:ce(),tags:["",""]},iron_armor:{id:"iron_armor",name:"",type:"armor",slot:"armor",rarity:"rare",desc:"",stats:{hp:600},resourceCategory:"ARMOR",resourceLevel:K.SPIRIT.key,usageTargets:ce(),tags:["",""]},core_pill:{id:"core_pill",name:"",type:"consumable",rarity:"epic",desc:"",effect:{kind:"exp",amount:9e3},resourceCategory:"PILL",resourceLevel:K.EARTH.key,pillTier:lt.CORE.id,usageTargets:ce(),tags:["",""]},artifact_supreme:{id:"artifact_supreme",name:"",type:"weapon",slot:"weapon",rarity:"epic",desc:"",stats:{atk:180,hp:300},resourceCategory:"WEAPON",resourceLevel:K.HEAVEN.key,weaponClass:Ya.RELIC.id,usageTargets:ce(),tags:["",""]},milk_millennium:{id:"milk_millennium",name:"",type:"consumable",rarity:"epic",desc:"",effect:{kind:"heal",amount:500},resourceCategory:"PILL",resourceLevel:K.EARTH.key,pillTier:lt.FOUNDATION.id,usageTargets:qa(),tags:["",""]},marrow_wash:{id:"marrow_wash",name:"",type:"consumable",rarity:"epic",desc:"",effect:{kind:"aptitude",amount:2},resourceCategory:"PILL",resourceLevel:K.EARTH.key,pillTier:lt.FOUNDATION.id,usageTargets:ce(),tags:["",""]},nascent_fruit:{id:"nascent_fruit",name:"",type:"consumable",rarity:"legendary",desc:"",effect:{kind:"exp",amount:2e4},resourceCategory:"PILL",resourceLevel:K.HEAVEN.key,pillTier:lt.NASCENT.id,usageTargets:ce(),tags:["",""]},heaven_manual:{id:"heaven_manual",name:"",type:"accessory",slot:"accessory",rarity:"legendary",desc:"",stats:{mp:800,atk:120},resourceCategory:"ACCESSORY",resourceLevel:K.HEAVEN.key,usageTargets:ce(),tags:["",""]},divine_egg:{id:"divine_egg",name:"",type:"armor",slot:"armor",rarity:"legendary",desc:"",stats:{hp:1200},resourceCategory:"ARMOR",resourceLevel:K.HEAVEN.key,usageTargets:ce(),tags:["",""]},moonshadow_saber:{id:"moonshadow_saber",name:"",type:"weapon",slot:"weapon",rarity:"epic",desc:"",stats:{atk:160,mp:60},resourceCategory:"WEAPON",resourceLevel:K.EARTH.key,weaponClass:Ya.SABER.id,usageTargets:ce(),tags:["",""]},storm_piercer:{id:"storm_piercer",name:"",type:"weapon",slot:"weapon",rarity:"legendary",desc:"",stats:{atk:190,mp:120,hp:200},resourceCategory:"WEAPON",resourceLevel:K.HEAVEN.key,weaponClass:Ya.SPEAR.id,usageTargets:ce(),tags:["",""]},meridian_pill:{id:"meridian_pill",name:"",type:"consumable",rarity:"uncommon",desc:"",effect:{kind:"exp",amount:1500},resourceCategory:"PILL",resourceLevel:K.MORTAL.key,pillTier:lt.BODY.id,usageTargets:DS(),tags:["",""]},dragon_heart_pill:{id:"dragon_heart_pill",name:"",type:"consumable",rarity:"epic",desc:"",effect:{kind:"exp",amount:12e3},resourceCategory:"PILL",resourceLevel:K.EARTH.key,pillTier:lt.CORE.id,usageTargets:ce(),tags:["",""]},starlight_pill:{id:"starlight_pill",name:"",type:"consumable",rarity:"legendary",desc:"",effect:{kind:"aptitude",amount:4},resourceCategory:"PILL",resourceLevel:K.HEAVEN.key,pillTier:lt.ASCENSION.id,usageTargets:ce(),tags:["",""]},god_transformation_pill:{id:"god_transformation_pill",name:"",type:"consumable",rarity:"mythic",desc:"",effect:{kind:"exp",amount:3e5},resourceCategory:"PILL",resourceLevel:K.DIVINE.key,pillTier:lt.ASCENSION.id,usageTargets:ce(),tags:["","",""]},divine_soul_pill:{id:"divine_soul_pill",name:"",type:"consumable",rarity:"mythic",desc:"",effect:{kind:"exp",amount:5e5},resourceCategory:"PILL",resourceLevel:K.DIVINE.key,pillTier:lt.ASCENSION.id,usageTargets:ce(),tags:["","",""]},void_condensing_pill:{id:"void_condensing_pill",name:"",type:"consumable",rarity:"mythic",desc:"",effect:{kind:"exp",amount:8e5},resourceCategory:"PILL",resourceLevel:K.DIVINE.key,pillTier:lt.ASCENSION.id,usageTargets:ce(),tags:["","",""]},immortal_marrow_pill:{id:"immortal_marrow_pill",name:"",type:"consumable",rarity:"mythic",desc:"",effect:{kind:"aptitude",amount:8},resourceCategory:"PILL",resourceLevel:K.DIVINE.key,pillTier:lt.ASCENSION.id,usageTargets:ce(),tags:["","",""]},heaven_defying_pill:{id:"heaven_defying_pill",name:"",type:"consumable",rarity:"mythic",desc:"",effect:{kind:"exp",amount:1e6},resourceCategory:"PILL",resourceLevel:K.DIVINE.key,pillTier:lt.ASCENSION.id,usageTargets:ce(),tags:["","",""]},void_refining_pill:{id:"void_refining_pill",name:"",type:"consumable",rarity:"mythic",desc:"",effect:{kind:"exp",amount:2e6},resourceCategory:"PILL",resourceLevel:K.DIVINE.key,pillTier:lt.ASCENSION.id,usageTargets:ce(),tags:["","",""]},space_law_pill:{id:"space_law_pill",name:"",type:"consumable",rarity:"mythic",desc:"",effect:{kind:"exp",amount:3e6},resourceCategory:"PILL",resourceLevel:K.DIVINE.key,pillTier:lt.ASCENSION.id,usageTargets:ce(),tags:["","",""]},void_stabilization_pill:{id:"void_stabilization_pill",name:"",type:"consumable",rarity:"mythic",desc:"",effect:{kind:"exp",amount:5e6},resourceCategory:"PILL",resourceLevel:K.DIVINE.key,pillTier:lt.ASCENSION.id,usageTargets:ce(),tags:["","",""]},unity_pill:{id:"unity_pill",name:"",type:"consumable",rarity:"mythic",desc:"",effect:{kind:"exp",amount:8e6},resourceCategory:"PILL",resourceLevel:K.DIVINE.key,pillTier:lt.ASCENSION.id,usageTargets:ce(),tags:["","",""]},dao_comprehension_pill:{id:"dao_comprehension_pill",name:"",type:"consumable",rarity:"mythic",desc:"",effect:{kind:"exp",amount:12e6},resourceCategory:"PILL",resourceLevel:K.DIVINE.key,pillTier:lt.ASCENSION.id,usageTargets:ce(),tags:["","",""]},harmony_pill:{id:"harmony_pill",name:"",type:"consumable",rarity:"mythic",desc:"",effect:{kind:"exp",amount:18e6},resourceCategory:"PILL",resourceLevel:K.DIVINE.key,pillTier:lt.ASCENSION.id,usageTargets:ce(),tags:["","",""]},mahayana_pill:{id:"mahayana_pill",name:"",type:"consumable",rarity:"mythic",desc:"",effect:{kind:"exp",amount:3e7},resourceCategory:"PILL",resourceLevel:K.DIVINE.key,pillTier:lt.ASCENSION.id,usageTargets:ce(),tags:["","",""]},immortal_foundation_pill:{id:"immortal_foundation_pill",name:"",type:"consumable",rarity:"mythic",desc:"",effect:{kind:"exp",amount:5e7},resourceCategory:"PILL",resourceLevel:K.DIVINE.key,pillTier:lt.ASCENSION.id,usageTargets:ce(),tags:["","",""]},semi_immortal_pill:{id:"semi_immortal_pill",name:"",type:"consumable",rarity:"mythic",desc:"",effect:{kind:"exp",amount:8e7},resourceCategory:"PILL",resourceLevel:K.DIVINE.key,pillTier:lt.ASCENSION.id,usageTargets:ce(),tags:["","",""]},tribulation_pill:{id:"tribulation_pill",name:"",type:"consumable",rarity:"mythic",desc:"",effect:{kind:"exp",amount:1e8},resourceCategory:"PILL",resourceLevel:K.DIVINE.key,pillTier:lt.ASCENSION.id,usageTargets:ce(),tags:["","",""]},anti_tribulation_pill:{id:"anti_tribulation_pill",name:"",type:"consumable",rarity:"mythic",desc:"",effect:{kind:"heal",amount:5e4},resourceCategory:"PILL",resourceLevel:K.DIVINE.key,pillTier:lt.ASCENSION.id,usageTargets:ce(),tags:["","",""]},ascension_pill:{id:"ascension_pill",name:"",type:"consumable",rarity:"mythic",desc:"",effect:{kind:"exp",amount:2e8},resourceCategory:"PILL",resourceLevel:K.DIVINE.key,pillTier:lt.ASCENSION.id,usageTargets:ce(),tags:["","",""]},basic_manual:{id:"basic_manual",name:"",type:"manual",rarity:"common",tier:"",tierColor:"#D4AF37",element:"",baseBonus:"+20%",desc:"",manualIds:["basic_breath","cloud_breath"],resourceCategory:"MANUAL",resourceLevel:K.MORTAL.key,manualSchool:Ee.GENERAL.id,usageTargets:ce(),tags:["",""]},advanced_manual:{id:"advanced_manual",name:"",type:"manual",rarity:"rare",tier:"",tierColor:"#4A4A4A",element:"",baseBonus:"+50%",desc:"",manualIds:["azure_sword_art","water_flow","fire_control","mountain_body"],resourceCategory:"MANUAL",resourceLevel:K.SPIRIT.key,manualSchool:Ee.ELEMENTAL.id,usageTargets:ce(),tags:["",""]},expert_manual:{id:"expert_manual",name:"",type:"manual",rarity:"epic",tier:"",tierColor:"#8B4513",element:"",baseBonus:"+100%",desc:"",manualIds:["yin_yang_harmony","five_elements_supreme"],resourceCategory:"MANUAL",resourceLevel:K.EARTH.key,manualSchool:Ee.DUAL.id,usageTargets:ce(),tags:["",""]},gold_manual_1:{id:"gold_manual_1",name:"",type:"manual",rarity:"common",tier:"",tierColor:"#FFD700",element:"",baseBonus:"+20%",desc:"",manualIds:["golden_light"],resourceCategory:"MANUAL",resourceLevel:K.MORTAL.key,manualSchool:Ee.ELEMENTAL.id,usageTargets:ce(),tags:["",""]},gold_manual_2:{id:"gold_manual_2",name:"",type:"manual",rarity:"uncommon",tier:"",tierColor:"#FFD700",element:"",baseBonus:"+50%",desc:"",manualIds:["azure_sword_art"],resourceCategory:"MANUAL",resourceLevel:K.SPIRIT.key,manualSchool:Ee.ELEMENTAL.id,usageTargets:ce(),tags:["",""]},gold_manual_3:{id:"gold_manual_3",name:"",type:"manual",rarity:"rare",tier:"",tierColor:"#FFD700",element:"",baseBonus:"+100%",desc:"",manualIds:["golden_light","azure_sword_art"],resourceCategory:"MANUAL",resourceLevel:K.EARTH.key,manualSchool:Ee.ELEMENTAL.id,usageTargets:ce(),tags:["",""]},gold_manual_4:{id:"gold_manual_4",name:"",type:"manual",rarity:"epic",tier:"",tierColor:"#FFD700",element:"",baseBonus:"+100%",desc:"",manualIds:["azure_sword_art"],resourceCategory:"MANUAL",resourceLevel:K.EARTH.key,manualSchool:Ee.ELEMENTAL.id,usageTargets:ce(),tags:["",""]},gold_manual_5:{id:"gold_manual_5",name:"",type:"manual",rarity:"legendary",tier:"",tierColor:"#FFD700",element:"",baseBonus:"+200%",desc:"",manualIds:["azure_sword_art"],resourceCategory:"MANUAL",resourceLevel:K.HEAVEN.key,manualSchool:Ee.ELEMENTAL.id,usageTargets:ce(),tags:["",""]},wood_manual_1:{id:"wood_manual_1",name:"",type:"manual",rarity:"common",tier:"",tierColor:"#228B22",element:"",baseBonus:"+20%",desc:"",manualIds:["evergreen_art"],resourceCategory:"MANUAL",resourceLevel:K.MORTAL.key,manualSchool:Ee.ELEMENTAL.id,usageTargets:ce(),tags:["",""]},wood_manual_2:{id:"wood_manual_2",name:"",type:"manual",rarity:"uncommon",tier:"",tierColor:"#228B22",element:"",baseBonus:"+50%",desc:"",manualIds:["spring_birth"],resourceCategory:"MANUAL",resourceLevel:K.SPIRIT.key,manualSchool:Ee.ELEMENTAL.id,usageTargets:ce(),tags:["",""]},wood_manual_3:{id:"wood_manual_3",name:"",type:"manual",rarity:"rare",tier:"",tierColor:"#228B22",element:"",baseBonus:"+100%",desc:"",manualIds:["evergreen_art","spring_birth"],resourceCategory:"MANUAL",resourceLevel:K.EARTH.key,manualSchool:Ee.ELEMENTAL.id,usageTargets:ce(),tags:["",""]},wood_manual_4:{id:"wood_manual_4",name:"",type:"manual",rarity:"epic",tier:"",tierColor:"#228B22",element:"",baseBonus:"+100%",desc:"",manualIds:["spring_birth"],resourceCategory:"MANUAL",resourceLevel:K.EARTH.key,manualSchool:Ee.ELEMENTAL.id,usageTargets:ce(),tags:["",""]},wood_manual_5:{id:"wood_manual_5",name:"",type:"manual",rarity:"legendary",tier:"",tierColor:"#228B22",element:"",baseBonus:"+200%",desc:"",manualIds:["spring_birth"],resourceCategory:"MANUAL",resourceLevel:K.HEAVEN.key,manualSchool:Ee.ELEMENTAL.id,usageTargets:ce(),tags:["",""]},water_manual_1:{id:"water_manual_1",name:"",type:"manual",rarity:"common",tier:"",tierColor:"#4169E1",element:"",baseBonus:"+20%",desc:"",manualIds:["water_flow"],resourceCategory:"MANUAL",resourceLevel:K.MORTAL.key,manualSchool:Ee.ELEMENTAL.id,usageTargets:ce(),tags:["",""]},water_manual_2:{id:"water_manual_2",name:"",type:"manual",rarity:"uncommon",tier:"",tierColor:"#4169E1",element:"",baseBonus:"+50%",desc:"",manualIds:["ocean_heart"],resourceCategory:"MANUAL",resourceLevel:K.SPIRIT.key,manualSchool:Ee.ELEMENTAL.id,usageTargets:ce(),tags:["",""]},water_manual_3:{id:"water_manual_3",name:"",type:"manual",rarity:"rare",tier:"",tierColor:"#4169E1",element:"",baseBonus:"+100%",desc:"",manualIds:["water_flow","ocean_heart"],resourceCategory:"MANUAL",resourceLevel:K.EARTH.key,manualSchool:Ee.ELEMENTAL.id,usageTargets:ce(),tags:["",""]},water_manual_4:{id:"water_manual_4",name:"",type:"manual",rarity:"epic",tier:"",tierColor:"#4169E1",element:"",baseBonus:"+100%",desc:"",manualIds:["ocean_heart"],resourceCategory:"MANUAL",resourceLevel:K.EARTH.key,manualSchool:Ee.ELEMENTAL.id,usageTargets:ce(),tags:["",""]},water_manual_5:{id:"water_manual_5",name:"",type:"manual",rarity:"legendary",tier:"",tierColor:"#4169E1",element:"",baseBonus:"+200%",desc:"",manualIds:["ocean_heart"],resourceCategory:"MANUAL",resourceLevel:K.HEAVEN.key,manualSchool:Ee.ELEMENTAL.id,usageTargets:ce(),tags:["",""]},fire_manual_1:{id:"fire_manual_1",name:"",type:"manual",rarity:"common",tier:"",tierColor:"#FF6347",element:"",baseBonus:"+20%",desc:"",manualIds:["basic_breath"],resourceCategory:"MANUAL",resourceLevel:K.MORTAL.key,manualSchool:Ee.ELEMENTAL.id,usageTargets:ce(),tags:["",""]},fire_manual_2:{id:"fire_manual_2",name:"",type:"manual",rarity:"uncommon",tier:"",tierColor:"#FF6347",element:"",baseBonus:"+50%",desc:"",manualIds:["fire_control"],resourceCategory:"MANUAL",resourceLevel:K.SPIRIT.key,manualSchool:Ee.ELEMENTAL.id,usageTargets:ce(),tags:["",""]},fire_manual_3:{id:"fire_manual_3",name:"",type:"manual",rarity:"rare",tier:"",tierColor:"#FF6347",element:"",baseBonus:"+100%",desc:"",manualIds:["nine_turns_fire"],resourceCategory:"MANUAL",resourceLevel:K.EARTH.key,manualSchool:Ee.ELEMENTAL.id,usageTargets:ce(),tags:["",""]},fire_manual_4:{id:"fire_manual_4",name:"",type:"manual",rarity:"epic",tier:"",tierColor:"#FF6347",element:"",baseBonus:"+100%",desc:"",manualIds:["vermillion_bird"],resourceCategory:"MANUAL",resourceLevel:K.EARTH.key,manualSchool:Ee.ELEMENTAL.id,usageTargets:ce(),tags:["",""]},fire_manual_5:{id:"fire_manual_5",name:"",type:"manual",rarity:"legendary",tier:"",tierColor:"#FF6347",element:"",baseBonus:"+200%",desc:"",manualIds:["nine_turns_fire","vermillion_bird"],resourceCategory:"MANUAL",resourceLevel:K.HEAVEN.key,manualSchool:Ee.ELEMENTAL.id,usageTargets:ce(),tags:["",""]},earth_manual_1:{id:"earth_manual_1",name:"",type:"manual",rarity:"common",tier:"",tierColor:"#8B4513",element:"",baseBonus:"+20%",desc:"",manualIds:["earth_shield"],resourceCategory:"MANUAL",resourceLevel:K.MORTAL.key,manualSchool:Ee.ELEMENTAL.id,usageTargets:ce(),tags:["",""]},earth_manual_2:{id:"earth_manual_2",name:"",type:"manual",rarity:"uncommon",tier:"",tierColor:"#8B4513",element:"",baseBonus:"+50%",desc:"",manualIds:["mountain_body"],resourceCategory:"MANUAL",resourceLevel:K.SPIRIT.key,manualSchool:Ee.ELEMENTAL.id,usageTargets:ce(),tags:["",""]},earth_manual_3:{id:"earth_manual_3",name:"",type:"manual",rarity:"rare",tier:"",tierColor:"#8B4513",element:"",baseBonus:"+100%",desc:"",manualIds:["earth_shield","mountain_body"],resourceCategory:"MANUAL",resourceLevel:K.EARTH.key,manualSchool:Ee.ELEMENTAL.id,usageTargets:ce(),tags:["",""]},earth_manual_4:{id:"earth_manual_4",name:"",type:"manual",rarity:"epic",tier:"",tierColor:"#8B4513",element:"",baseBonus:"+100%",desc:"",manualIds:["mountain_body"],resourceCategory:"MANUAL",resourceLevel:K.EARTH.key,manualSchool:Ee.ELEMENTAL.id,usageTargets:ce(),tags:["",""]},earth_manual_5:{id:"earth_manual_5",name:"",type:"manual",rarity:"legendary",tier:"",tierColor:"#8B4513",element:"",baseBonus:"+200%",desc:"",manualIds:["mountain_body"],resourceCategory:"MANUAL",resourceLevel:K.HEAVEN.key,manualSchool:Ee.ELEMENTAL.id,usageTargets:ce(),tags:["",""]},thunder_manual_1:{id:"thunder_manual_1",name:"",type:"manual",rarity:"uncommon",tier:"",tierColor:"#9B30FF",element:"",baseBonus:"+50%",desc:"",manualIds:["basic_breath"],resourceCategory:"MANUAL",resourceLevel:K.SPIRIT.key,manualSchool:Ee.VARIANT.id,usageTargets:ce(),tags:["",""]},thunder_manual_2:{id:"thunder_manual_2",name:"",type:"manual",rarity:"rare",tier:"",tierColor:"#9B30FF",element:"",baseBonus:"+100%",desc:"",manualIds:["basic_breath"],resourceCategory:"MANUAL",resourceLevel:K.EARTH.key,manualSchool:Ee.VARIANT.id,usageTargets:ce(),tags:["",""]},thunder_manual_3:{id:"thunder_manual_3",name:"",type:"manual",rarity:"epic",tier:"",tierColor:"#9B30FF",element:"",baseBonus:"+100%",desc:"",manualIds:["basic_breath"],resourceCategory:"MANUAL",resourceLevel:K.EARTH.key,manualSchool:Ee.VARIANT.id,usageTargets:ce(),tags:["",""]},thunder_manual_4:{id:"thunder_manual_4",name:"",type:"manual",rarity:"epic",tier:"",tierColor:"#9B30FF",element:"",baseBonus:"+200%",desc:"",manualIds:["thunder_guide"],resourceCategory:"MANUAL",resourceLevel:K.EARTH.key,manualSchool:Ee.VARIANT.id,usageTargets:ce(),tags:["",""]},thunder_manual_5:{id:"thunder_manual_5",name:"",type:"manual",rarity:"legendary",tier:"",tierColor:"#9B30FF",element:"",baseBonus:"+200%",desc:"",manualIds:["thunder_guide","heavenly_demon"],resourceCategory:"MANUAL",resourceLevel:K.HEAVEN.key,manualSchool:Ee.VARIANT.id,usageTargets:ce(),tags:["",""]},ice_manual_1:{id:"ice_manual_1",name:"",type:"manual",rarity:"uncommon",tier:"",tierColor:"#87CEEB",element:"",baseBonus:"+20%",desc:"",manualIds:["water_flow"],resourceCategory:"MANUAL",resourceLevel:K.SPIRIT.key,manualSchool:Ee.VARIANT.id,usageTargets:ce(),tags:["",""]},ice_manual_2:{id:"ice_manual_2",name:"",type:"manual",rarity:"rare",tier:"",tierColor:"#87CEEB",element:"",baseBonus:"+50%",desc:"",manualIds:["ice_heart"],resourceCategory:"MANUAL",resourceLevel:K.SPIRIT.key,manualSchool:Ee.VARIANT.id,usageTargets:ce(),tags:["",""]},ice_manual_3:{id:"ice_manual_3",name:"",type:"manual",rarity:"rare",tier:"",tierColor:"#87CEEB",element:"",baseBonus:"+100%",desc:"",manualIds:["ice_heart"],resourceCategory:"MANUAL",resourceLevel:K.EARTH.key,manualSchool:Ee.VARIANT.id,usageTargets:ce(),tags:["",""]},ice_manual_4:{id:"ice_manual_4",name:"",type:"manual",rarity:"epic",tier:"",tierColor:"#87CEEB",element:"",baseBonus:"+100%",desc:"",manualIds:["ice_heart"],resourceCategory:"MANUAL",resourceLevel:K.EARTH.key,manualSchool:Ee.VARIANT.id,usageTargets:ce(),tags:["",""]},ice_manual_5:{id:"ice_manual_5",name:"",type:"manual",rarity:"legendary",tier:"",tierColor:"#87CEEB",element:"",baseBonus:"+200%",desc:"",manualIds:["ice_heart"],resourceCategory:"MANUAL",resourceLevel:K.HEAVEN.key,manualSchool:Ee.VARIANT.id,usageTargets:ce(),tags:["",""]},wind_manual_1:{id:"wind_manual_1",name:"",type:"manual",rarity:"uncommon",tier:"",tierColor:"#E0E0E0",element:"",baseBonus:"+20%",desc:"",manualIds:["cloud_breath"],resourceCategory:"MANUAL",resourceLevel:K.SPIRIT.key,manualSchool:Ee.VARIANT.id,usageTargets:ce(),tags:["",""]},wind_manual_2:{id:"wind_manual_2",name:"",type:"manual",rarity:"rare",tier:"",tierColor:"#E0E0E0",element:"",baseBonus:"+50%",desc:"",manualIds:["wind_freedom"],resourceCategory:"MANUAL",resourceLevel:K.SPIRIT.key,manualSchool:Ee.VARIANT.id,usageTargets:ce(),tags:["",""]},wind_manual_3:{id:"wind_manual_3",name:"",type:"manual",rarity:"rare",tier:"",tierColor:"#E0E0E0",element:"",baseBonus:"+100%",desc:"",manualIds:["wind_freedom"],resourceCategory:"MANUAL",resourceLevel:K.EARTH.key,manualSchool:Ee.VARIANT.id,usageTargets:ce(),tags:["",""]},wind_manual_4:{id:"wind_manual_4",name:"",type:"manual",rarity:"epic",tier:"",tierColor:"#E0E0E0",element:"",baseBonus:"+100%",desc:"",manualIds:["wind_freedom"],resourceCategory:"MANUAL",resourceLevel:K.EARTH.key,manualSchool:Ee.VARIANT.id,usageTargets:ce(),tags:["",""]},wind_manual_5:{id:"wind_manual_5",name:"",type:"manual",rarity:"legendary",tier:"",tierColor:"#E0E0E0",element:"",baseBonus:"+200%",desc:"",manualIds:["wind_freedom"],resourceCategory:"MANUAL",resourceLevel:K.HEAVEN.key,manualSchool:Ee.VARIANT.id,usageTargets:ce(),tags:["",""]},cosmic_crystal:{id:"cosmic_crystal",name:"",type:"consumable",rarity:"legendary",desc:"",effect:{kind:"exp",amount:5e4},resourceCategory:"PILL",resourceLevel:K.HEAVEN.key,usageTargets:ce(),tags:["",""]},void_silk:{id:"void_silk",name:"",type:"consumable",rarity:"legendary",desc:"",effect:{kind:"exp",amount:4e4},resourceCategory:"PILL",resourceLevel:K.HEAVEN.key,usageTargets:ce(),tags:["",""]},heavenly_jade:{id:"heavenly_jade",name:"",type:"consumable",rarity:"mythic",desc:"",effect:{kind:"exp",amount:2e5},resourceCategory:"PILL",resourceLevel:K.DIVINE.key,usageTargets:ce(),tags:["",""]},soul_essence_crystal:{id:"soul_essence_crystal",name:"",type:"consumable",rarity:"mythic",desc:"",effect:{kind:"exp",amount:18e4},resourceCategory:"PILL",resourceLevel:K.DIVINE.key,usageTargets:ce(),tags:["",""]},star_core_fragment:{id:"star_core_fragment",name:"",type:"consumable",rarity:"mythic",desc:"",effect:{kind:"exp",amount:35e4},resourceCategory:"PILL",resourceLevel:K.DIVINE.key,usageTargets:ce(),tags:["",""]},celestial_silk_cloth:{id:"celestial_silk_cloth",name:"",type:"consumable",rarity:"mythic",desc:"",effect:{kind:"exp",amount:3e5},resourceCategory:"PILL",resourceLevel:K.DIVINE.key,usageTargets:ce(),tags:["",""]},abyss_stone:{id:"abyss_stone",name:"",type:"consumable",rarity:"mythic",desc:"",effect:{kind:"exp",amount:5e5},resourceCategory:"PILL",resourceLevel:K.DIVINE.key,usageTargets:ce(),tags:["",""]},abyssal_essence:{id:"abyssal_essence",name:"",type:"consumable",rarity:"mythic",desc:"",effect:{kind:"exp",amount:55e4},resourceCategory:"PILL",resourceLevel:K.DIVINE.key,usageTargets:ce(),tags:["",""]},divine_tribulation_stone:{id:"divine_tribulation_stone",name:"",type:"consumable",rarity:"mythic",desc:"",effect:{kind:"exp",amount:6e5},resourceCategory:"PILL",resourceLevel:K.DIVINE.key,usageTargets:ce(),tags:["",""]},god_marrow:{id:"god_marrow",name:"",type:"consumable",rarity:"mythic",desc:"",effect:{kind:"exp",amount:65e4},resourceCategory:"PILL",resourceLevel:K.DIVINE.key,usageTargets:ce(),tags:["",""]},divine_essence_core:{id:"divine_essence_core",name:"",type:"consumable",rarity:"mythic",desc:"",effect:{kind:"exp",amount:8e5},resourceCategory:"PILL",resourceLevel:K.DIVINE.key,usageTargets:ce(),tags:["",""]},soul_tempering_stone:{id:"soul_tempering_stone",name:"",type:"consumable",rarity:"mythic",desc:"",effect:{kind:"exp",amount:75e4},resourceCategory:"PILL",resourceLevel:K.DIVINE.key,usageTargets:ce(),tags:["",""]},void_manifold_crystal:{id:"void_manifold_crystal",name:"",type:"consumable",rarity:"mythic",desc:"",effect:{kind:"exp",amount:1e6},resourceCategory:"PILL",resourceLevel:K.DIVINE.key,usageTargets:ce(),tags:["",""]},condensed_void_essence:{id:"condensed_void_essence",name:"",type:"consumable",rarity:"mythic",desc:"",effect:{kind:"exp",amount:105e4},resourceCategory:"PILL",resourceLevel:K.DIVINE.key,usageTargets:ce(),tags:["",""]},celestial_ascension_token:{id:"celestial_ascension_token",name:"",type:"consumable",rarity:"mythic",desc:"",effect:{kind:"exp",amount:2e6},resourceCategory:"PILL",resourceLevel:K.DIVINE.key,usageTargets:ce(),tags:["",""]},immortal_transformation_essence:{id:"immortal_transformation_essence",name:"",type:"consumable",rarity:"mythic",desc:"",effect:{kind:"exp",amount:22e5},resourceCategory:"PILL",resourceLevel:K.DIVINE.key,usageTargets:ce(),tags:["",""]}},ir=e=>{const t=wc[e];return t?{...t,id:e,instanceId:`${e}_${Date.now()}_${Math.floor(Math.random()*1e4)}`,quantity:1,stackable:t.type==="consumable"||t.type==="manual",maxStack:t.type==="consumable"||t.type==="manual"?99:1}:null},Xp=e=>wc[e];function FS(){const[e,t]=y.useState([]),n=y.useCallback((d=[])=>{const p=d.map(f=>f?typeof f=="string"?ir(f):typeof f=="object"?{...f,instanceId:f.instanceId||(f.id||"item")+"_"+Date.now()+"_"+Math.floor(Math.random()*1e4),quantity:f.quantity||f.quantity===0?f.quantity:1,stackable:f.stackable??(f.type==="consumable"||f.type==="manual"),maxStack:f.maxStack||(f.type==="consumable"||f.type==="manual"?99:1)}:null:null).filter(Boolean);return p.length===0?[]:(t(f=>{const c=[...f];return p.forEach(u=>{if(u.stackable){let x=u.quantity||1;const S=u.maxStack||99,w=c.find(C=>C.id===u.id&&C.name===u.name&&C.rarity===u.rarity&&C.stackable===!0&&(C.quantity||1)<S);if(w){const C=w.quantity||1,h=S-C;if(x<=h){w.quantity=C+x;return}else w.quantity=S,x-=h}for(;x>0;){const C=Math.min(x,S);c.unshift({...u,quantity:C}),x-=C}return}c.unshift(u)}),c}),p)},[]),s=y.useCallback((d,p)=>{let f=[];return t(c=>{let u=typeof p=="number"?p:void 0,x=[...c];for(let S=0;S<x.length;){const w=x[S];if(w.instanceId!==d&&w.instanceId!==d.toString()){S++;continue}const C=w.quantity||1;if(u===void 0||u>=C){if(f.push({...w}),u=u===void 0?void 0:u-C,x.splice(S,1),u===0)break}else{f.push({...w,quantity:u}),x[S]={...w,quantity:C-u},u=0;break}}return x}),f.length===0?null:f.length===1?f[0]:f.reduce((c,u)=>c?(c.quantity=(c.quantity||1)+(u.quantity||1),c):{...u},null)},[]),o=y.useCallback(()=>{t([])},[]),i=y.useCallback(d=>e.find(d),[e]),a=y.useCallback(d=>e.filter(d),[e]),l=y.useCallback(d=>e.filter(p=>p.templateId===d).length,[e]);return{inventory:e,setInventory:t,addItemsToInventory:n,removeItemFromInventory:s,clearInventory:o,findItem:i,filterItems:a,getItemCount:l}}const Ji=[{id:"stage_chu_qingyao",name:"",title:"",role:"",tier:"",baseThreat:25,baseExp:7200,powerMultiplier:1,flavor:"",defeatLog:"",unlockNextLog:"",combatStats:{hp:800,maxHp:800,atk:85,def:40},storyBeats:[{delay:1,type:"RIVAL_RISE",tier:"",exp:9e3,detail:"",description:""},{delay:1,type:"RIVAL_ENGAGED",target:"",detail:"",description:""},{delay:1,type:"RIVAL_MARRIAGE",target:"",tier:"",exp:15e3,detail:"",description:""},{delay:1,type:"RIVAL_HEIR",target:"",tier:"",exp:2e4,detail:"",description:""},{delay:1,type:"RIVAL_STAGE_EVENT",tier:"",exp:23e3,detail:"",description:""},{delay:1,type:"RIVAL_STAGE_EVENT",tier:"",exp:25e3,detail:"",description:""}]},{id:"stage_fiance",name:"",title:"",role:"",tier:"",baseThreat:40,baseExp:2e5,powerMultiplier:2.2,flavor:"",defeatLog:"",unlockNextLog:"",combatStats:{hp:1e5,maxHp:1e5,atk:1e4,def:4e3},storyBeats:[{delay:1,type:"RIVAL_STAGE_EVENT",tier:"",exp:5e5,detail:"",description:""},{delay:1,type:"RIVAL_STAGE_EVENT",tier:"",exp:8e5,detail:"",description:""},{delay:1,type:"RIVAL_STAGE_EVENT",tier:"",exp:2e6,detail:"",description:""}]},{id:"stage_family_elder",name:"",title:"",role:"",tier:"",baseThreat:55,baseExp:2e6,powerMultiplier:3.5,flavor:"",defeatLog:"",unlockNextLog:"",combatStats:{hp:1e6,maxHp:1e6,atk:1e5,def:4e4},storyBeats:[{delay:1,type:"RIVAL_STAGE_EVENT",tier:"",exp:5e6,detail:"",description:""},{delay:1,type:"RIVAL_STAGE_EVENT",tier:"",exp:1e7,detail:"",description:""},{delay:1,type:"RIVAL_STAGE_EVENT",tier:"",exp:2e7,detail:"",description:""}]},{id:"stage_sect_elder",name:"",title:"",role:"",tier:"",baseThreat:70,baseExp:1e8,powerMultiplier:6,flavor:"",defeatLog:"",unlockNextLog:"",combatStats:{hp:4e7,maxHp:4e7,atk:4e6,def:16e5},storyBeats:[{delay:1,type:"RIVAL_STAGE_EVENT",tier:"",exp:2e8,detail:"",description:""},{delay:1,type:"RIVAL_STAGE_EVENT",tier:"",exp:5e8,detail:"",description:""},{delay:1,type:"RIVAL_STAGE_EVENT",tier:"",exp:2e9,detail:"",description:""}]}],hl=Ji.length-1,Kl=(e=0)=>Ji[Math.max(0,Math.min(e,hl))],it=[pt.PLAYER,pt.CHILD],Ec={YELLOW:{name:"",baseBuff:.2,color:"#D4AF37"},BLACK:{name:"",baseBuff:.5,color:"#4A4A4A"},EARTH:{name:"",baseBuff:1,color:"#8B4513"},HEAVEN:{name:"",baseBuff:2,color:"#9B30FF"}},um={:"",:"",:"",:"",:"",:"",:"",:"",ALL:"",NONE:"",OMNI:"","":""},HS=e=>!e||e==="NONE"?"OMNI":e,WS=(e,t)=>`${e}_${HS(t)}`,on={basic_breath:{id:"basic_breath",name:"",tier:"YELLOW",element:"NONE",desc:"",rarity:"common",source:""},cloud_breath:{id:"cloud_breath",name:"",tier:"YELLOW",element:"NONE",desc:"",rarity:"common",source:""},golden_light:{id:"golden_light",name:"",tier:"YELLOW",element:"",desc:"",rarity:"common",source:""},azure_sword_art:{id:"azure_sword_art",name:"",tier:"BLACK",element:"",desc:"",rarity:"rare",source:""},evergreen_art:{id:"evergreen_art",name:"",tier:"YELLOW",element:"",desc:"",rarity:"common",source:""},spring_birth:{id:"spring_birth",name:"",tier:"BLACK",element:"",desc:"",rarity:"rare",source:""},water_flow:{id:"water_flow",name:"",tier:"YELLOW",element:"",desc:"",rarity:"common",source:""},ocean_heart:{id:"ocean_heart",name:"",tier:"BLACK",element:"",desc:"",rarity:"rare",source:""},fire_control:{id:"fire_control",name:"",tier:"BLACK",element:"",desc:"",rarity:"rare",source:""},nine_turns_fire:{id:"nine_turns_fire",name:"",tier:"EARTH",element:"",desc:"",rarity:"epic",source:""},vermillion_bird:{id:"vermillion_bird",name:"",tier:"EARTH",element:"",desc:"",rarity:"epic",source:""},earth_shield:{id:"earth_shield",name:"",tier:"YELLOW",element:"",desc:"",rarity:"common",source:""},mountain_body:{id:"mountain_body",name:"",tier:"BLACK",element:"",desc:"",rarity:"rare",source:""},thunder_guide:{id:"thunder_guide",name:"",tier:"HEAVEN",element:"",desc:"",rarity:"legendary",source:""},heavenly_demon:{id:"heavenly_demon",name:"",tier:"HEAVEN",element:"",desc:"",rarity:"legendary",source:""},ice_heart:{id:"ice_heart",name:"",tier:"BLACK",element:"",desc:"",rarity:"rare",source:""},wind_freedom:{id:"wind_freedom",name:"",tier:"BLACK",element:"",desc:"",rarity:"rare",source:""},yin_yang_harmony:{id:"yin_yang_harmony",name:"",tier:"BLACK",element:"NONE",desc:"",rarity:"rare",source:""},blood_demon:{id:"blood_demon",name:"",tier:"EARTH",element:"NONE",desc:"",rarity:"epic",source:""},chaos_origin:{id:"chaos_origin",name:"",tier:"HEAVEN",element:"NONE",desc:"",rarity:"legendary",source:""},five_elements_supreme:{id:"five_elements_supreme",name:"",tier:"HEAVEN",element:"ALL",desc:"",rarity:"legendary",source:""},emperor_scripture:{id:"emperor_scripture",name:"",tier:"HEAVEN",element:"NONE",desc:"",rarity:"legendary",source:""},deep_ocean_scripture:{id:"deep_ocean_scripture",name:"",tier:"EARTH",element:"",desc:"",rarity:"epic",source:""},nine_star_formation:{id:"nine_star_formation",name:"",tier:"BLACK",element:"",desc:"",rarity:"rare",source:""},grass_valley_healing:{id:"grass_valley_healing",name:"",tier:"YELLOW",element:"",desc:"",rarity:"common",source:""},stone_refining:{id:"stone_refining",name:"",tier:"YELLOW",element:"",desc:"",rarity:"common",source:""},ghost_cultivation:{id:"ghost_cultivation",name:"",tier:"EARTH",element:"",desc:"",rarity:"epic",source:""},blood_river:{id:"blood_river",name:"",tier:"BLACK",element:"NONE",desc:"",rarity:"rare",source:""}},US={basic_breath:{resourceLevel:K.MORTAL.key,school:Ee.GENERAL.id,stage:"",focus:["",""],usageTargets:it},cloud_breath:{resourceLevel:K.MORTAL.key,school:Ee.GENERAL.id,stage:"",focus:["",""],usageTargets:it},golden_light:{resourceLevel:K.MORTAL.key,school:Ee.ELEMENTAL.id,stage:"",focus:["",""],usageTargets:it},azure_sword_art:{resourceLevel:K.SPIRIT.key,school:Ee.ELEMENTAL.id,stage:"",focus:["",""],usageTargets:it},evergreen_art:{resourceLevel:K.MORTAL.key,school:Ee.ELEMENTAL.id,stage:"",focus:["",""],usageTargets:it},spring_birth:{resourceLevel:K.SPIRIT.key,school:Ee.ELEMENTAL.id,stage:"",focus:["",""],usageTargets:it},water_flow:{resourceLevel:K.MORTAL.key,school:Ee.ELEMENTAL.id,stage:"",focus:["",""],usageTargets:it},ocean_heart:{resourceLevel:K.SPIRIT.key,school:Ee.ELEMENTAL.id,stage:"",focus:["",""],usageTargets:it},fire_control:{resourceLevel:K.SPIRIT.key,school:Ee.ELEMENTAL.id,stage:"",focus:["",""],usageTargets:it},nine_turns_fire:{resourceLevel:K.EARTH.key,school:Ee.ELEMENTAL.id,stage:"",focus:["",""],usageTargets:it},vermillion_bird:{resourceLevel:K.HEAVEN.key,school:Ee.ELEMENTAL.id,stage:"",focus:["",""],usageTargets:it},earth_shield:{resourceLevel:K.MORTAL.key,school:Ee.ELEMENTAL.id,stage:"",focus:["",""],usageTargets:it},mountain_body:{resourceLevel:K.SPIRIT.key,school:Ee.ELEMENTAL.id,stage:"",focus:["",""],usageTargets:it},thunder_guide:{resourceLevel:K.HEAVEN.key,school:Ee.VARIANT.id,stage:"",focus:["",""],usageTargets:it},heavenly_demon:{resourceLevel:K.DIVINE.key,school:Ee.VARIANT.id,stage:"",focus:["",""],usageTargets:it},ice_heart:{resourceLevel:K.SPIRIT.key,school:Ee.VARIANT.id,stage:"",focus:["",""],usageTargets:it},wind_freedom:{resourceLevel:K.SPIRIT.key,school:Ee.VARIANT.id,stage:"",focus:["",""],usageTargets:it},yin_yang_harmony:{resourceLevel:K.SPIRIT.key,school:Ee.DUAL.id,stage:"",focus:["",""],usageTargets:it},blood_demon:{resourceLevel:K.EARTH.key,school:Ee.DEVIL.id,stage:"",focus:["",""],usageTargets:it},chaos_origin:{resourceLevel:K.DIVINE.key,school:Ee.GENERAL.id,stage:"",focus:["",""],usageTargets:it},five_elements_supreme:{resourceLevel:K.DIVINE.key,school:Ee.ELEMENTAL.id,stage:"",focus:["",""],usageTargets:it},emperor_scripture:{resourceLevel:K.DIVINE.key,school:Ee.GENERAL.id,stage:"",focus:["",""],usageTargets:it},deep_ocean_scripture:{resourceLevel:K.EARTH.key,school:Ee.ELEMENTAL.id,stage:"",focus:["",""],usageTargets:it},nine_star_formation:{resourceLevel:K.SPIRIT.key,school:Ee.ELEMENTAL.id,stage:"",focus:["",""],usageTargets:it},grass_valley_healing:{resourceLevel:K.MORTAL.key,school:Ee.ELEMENTAL.id,stage:"",focus:["",""],usageTargets:it},stone_refining:{resourceLevel:K.MORTAL.key,school:Ee.ELEMENTAL.id,stage:"",focus:["",""],usageTargets:it},ghost_cultivation:{resourceLevel:K.EARTH.key,school:Ee.DEVIL.id,stage:"",focus:["",""],usageTargets:it},blood_river:{resourceLevel:K.SPIRIT.key,school:Ee.DEVIL.id,stage:"",focus:["",""],usageTargets:it}};Object.entries(US).forEach(([e,t])=>{on[e]&&(on[e]={...on[e],resourceCategory:"MANUAL",...t,usageTargets:t.usageTargets?[...t.usageTargets]:[...it]})});const gl={};Object.entries(on).forEach(([e,t])=>{var s;const n=WS(t.tier,t.element);if(!gl[n]){const o=((s=Ec[t.tier])==null?void 0:s.name)||t.tier,i=um[t.element]||t.element||um.NONE;gl[n]={key:n,tier:t.tier,element:t.element,label:`${o}${i}`,manualIds:[]}}gl[n].manualIds.push(e),on[e].categoryKey=n});const GS=gl,pm={:"azure_sword_art",:"emperor_scripture",:"fire_control",:"deep_ocean_scripture",:"thunder_guide",:"spring_birth",:"nine_star_formation",:"wind_freedom",:"yin_yang_harmony",:"mountain_body",:"grass_valley_healing",:"stone_refining",:"heavenly_demon",:"ghost_cultivation",:"blood_river"};function Zp(e,t){const n=on[e];if(!n)return{compatibility:.5,level:"poor",desc:""};if(!t||!t.elements)return{compatibility:.8,level:"neutral",desc:"",color:"#999"};const{element:s}=n,{elements:o,type:i}=t;return s==="NONE"?{compatibility:.8,level:"neutral",desc:"",color:"#FFFFFF"}:n.id==="five_elements_supreme"?o.length===5?{compatibility:1.5,level:"perfect",desc:"",color:"#FFD700"}:{compatibility:.1,level:"impossible",desc:"",color:"#FF0000"}:o.includes(s)?o.length===1&&o[0]===s?{compatibility:1.5,level:"perfect",desc:"",color:"#4CAF50"}:{compatibility:1,level:"good",desc:"",color:"#2196F3"}:{compatibility:.5,level:"poor",desc:"",color:"#FF6B6B"}}function ef(e,t){const n=on[e];if(!n)return 1;const s=Ec[n.tier],{compatibility:o}=Zp(e,t);return 1+s.baseBuff*o}function VS(e){const t=on[e];if(!t)return null;const n=Ec[t.tier];return{...t,tierName:n.name,tierColor:n.color,baseBuff:n.baseBuff}}const tf=e=>e?JSON.parse(JSON.stringify(e)):null,Uu=[{name:"",key:"pure_yang",rarity:"SR",desc:"",effects:{statBonus:{aptitude:5},speedMultiplier:1.1,feedbackBonus:.05,preferredRoots:["",""],sectAffinity:{ids:["HEAVEN_EMPEROR","THUNDER"],bonus:25}}},{name:"",key:"innate_dao",rarity:"SSR",desc:"",effects:{statBonus:{looks:12,intelligence:5},speedMultiplier:1.15,feedbackBonus:.08,sectAffinity:{levels:["TOP","HIGH"],bonus:20}}},{name:"",key:"ancient_sage",rarity:"UR",desc:"",effects:{statBonus:{aptitude:8,health:25},speedMultiplier:1.2,feedbackBonus:.1,sectAffinity:{ids:["SWORD","HEAVEN_EMPEROR"],bonus:30}}},{name:"",key:"lunar_meridian",rarity:"SSR",desc:"",effects:{statBonus:{aptitude:4,intelligence:4},speedMultiplier:1.08,preferredRoots:["",""],sectAffinity:{ids:["GHOST","FLOWER"],bonus:20}}},{name:"",key:"stellar_bone",rarity:"SSR",desc:"",effects:{statBonus:{aptitude:6},speedMultiplier:1.12,preferredRoots:["",""],feedbackBonus:.06,sectAffinity:{ids:["NINE_STAR","STONE"],bonus:22}}},{name:"",key:"wood_spirit",rarity:"SR",desc:"",effects:{statBonus:{intelligence:6},speedMultiplier:1.05,preferredRoots:["",""],businessBonus:.25,feedbackBonus:.04,sectAffinity:{ids:["GRASS","FLOWER","DAN"],bonus:18}}},{name:"",key:"dragon_blood",rarity:"SR",desc:"",effects:{statBonus:{aptitude:5,health:18},speedMultiplier:1.1,feedbackBonus:.06,sectAffinity:{ids:["SWORD","IRON","BLOOD"],bonus:20}}},{name:"",key:"nether_core",rarity:"UR",desc:"",effects:{statBonus:{aptitude:7},speedMultiplier:1.18,preferredRoots:["",""],feedbackBonus:.09,sectAffinity:{ids:["GHOST","BLOOD"],bonus:28}}},{name:"",key:"fumo_frost_thunder_body",rarity:"UR",desc:"",effects:{statBonus:{aptitude:9,health:12},speedMultiplier:1.22,feedbackBonus:.12,preferredRoots:["",""],sectAffinity:{ids:["SWORD","HEAVEN_EMPEROR"],bonus:35}}},{name:"",key:"fumo_abyssal_flame_core",rarity:"UR",desc:"",effects:{statBonus:{aptitude:7,looks:8},speedMultiplier:1.18,feedbackBonus:.11,preferredRoots:["",""],sectAffinity:{ids:["BLOOD","GHOST"],bonus:30}}}],YS=()=>{const e=Uu[Math.floor(Math.random()*Uu.length)];return tf(e)},Dx=e=>{if(!e)return null;const t=Uu.find(n=>n.key===e);return tf(t)},xl=e=>tf(e),nf=(e={},t)=>{var a;if(!((a=t==null?void 0:t.effects)!=null&&a.statBonus))return e;const{aptitude:n=0,looks:s=0,intelligence:o=0,health:i=0}=t.effects.statBonus;return{...e,aptitude:Math.max(1,Math.min(120,(e.aptitude||0)+n)),looks:Math.max(1,Math.min(120,(e.looks||0)+s)),intelligence:Math.max(1,Math.min(120,(e.intelligence||0)+o)),health:Math.max(1,Math.min(150,(e.health||0)+i))}},qS=e=>{var t;return((t=e==null?void 0:e.effects)==null?void 0:t.speedMultiplier)||1},KS=e=>{var t;return((t=e==null?void 0:e.effects)==null?void 0:t.feedbackBonus)||0},QS=e=>{var t;return((t=e==null?void 0:e.effects)==null?void 0:t.businessBonus)||0},JS=e=>{var t;return((t=e==null?void 0:e.effects)==null?void 0:t.sectAffinity)||null},XS=e=>{var t;return((t=e==null?void 0:e.effects)==null?void 0:t.preferredRoots)||null},Fx=[{id:0,name:"",level:"JUNIOR",isManagement:!1,description:"",powerScore:4,permissions:[]},{id:1,name:"",level:"JUNIOR",isManagement:!1,description:"",powerScore:8,permissions:[]},{id:2,name:"",level:"MID",isManagement:!1,description:"",powerScore:16,permissions:["access_advanced_techniques"]},{id:3,name:"",level:"HIGH",isManagement:!1,description:"",powerScore:28,permissions:["access_secret_techniques","participate_selection"]},{id:4,name:"",level:"MANAGEMENT",isManagement:!0,description:"",powerScore:36,permissions:["manage_disciples","resource_distribution"]},{id:5,name:"",level:"ELDER",isManagement:!0,description:"",powerScore:48,permissions:["manage_disciples","resource_distribution","recruitment","policy_making"]},{id:6,name:"",level:"SUPREME",isManagement:!0,description:"",powerScore:65,permissions:["manage_all","final_decision","sect_succession"]},{id:100,name:"",level:"SPECIAL",isManagement:!1,description:"",powerScore:32,permissions:["religious_authority"]},{id:101,name:"",level:"ROGUE",isManagement:!1,description:"",powerScore:12,permissions:[]},{id:102,name:"",level:"SOVEREIGN",isManagement:!0,description:"",powerScore:85,permissions:["manage_all","final_decision","sect_succession","declare_war"]}],ZS=e=>Fx.find(t=>t.name===e)||null,e2=e=>{const t=ZS(e);return t?t.powerScore:0},t2={:["meridian_pill","herb_bandage","rice_ball"],:["meridian_pill","beast_core","iron_armor"],:["foundation_pill","thunder_wood","iron_armor","milk_millennium"],:["core_pill","artifact_supreme","marrow_wash","dragon_heart_pill"],:["dragon_heart_pill","moonshadow_saber","thunder_wood","nascent_fruit"],:["nascent_fruit","heaven_manual","divine_egg","starlight_pill","god_transformation_pill"],:["starlight_pill","storm_piercer","heaven_manual","divine_soul_pill","void_condensing_pill","immortal_marrow_pill"],:["heaven_manual","divine_egg","starlight_pill","heaven_defying_pill","void_refining_pill","space_law_pill","void_stabilization_pill"],:["unity_pill","dao_comprehension_pill","harmony_pill","void_stabilization_pill"],:["mahayana_pill","immortal_foundation_pill","semi_immortal_pill"],:["temple_relic","buddhist_scripture"],:["meridian_pill","herb_bandage"]},n2=e=>t2[e]||null,r2=e=>{const t=n2(e);return!t||t.length===0?null:t[Math.floor(Math.random()*t.length)]},s2=()=>Fx.map(e=>e.name),xr={HEAVEN:{id:"HEAVEN",name:"",color:"#FFD700",min:90,max:100,elementCount:1,multiplier:2.5,desc:""},MUTANT:{id:"MUTANT",name:"",color:"#00BCD4",min:80,max:89,elementCount:1,multiplier:2,desc:"(//)"},SINGLE:{id:"SINGLE",name:"",color:"#9C27B0",min:80,max:89,elementCount:1,multiplier:1.8,desc:""},DOUBLE:{id:"DOUBLE",name:"",color:"#2196F3",min:60,max:79,elementCount:2,multiplier:1.5,desc:""},TRIPLE:{id:"TRIPLE",name:"",color:"#4CAF50",min:40,max:59,elementCount:3,multiplier:1,desc:""},QUAD:{id:"QUAD",name:"",color:"#FF9800",min:20,max:39,elementCount:4,multiplier:.8,desc:""},WASTE:{id:"WASTE",name:"",color:"#9E9E9E",min:1,max:19,elementCount:5,multiplier:.5,desc:""},NONE:{id:"NONE",name:"",color:"#000000",min:0,max:0,elementCount:0,multiplier:0,desc:""}},o2=["","","","",""],fm=["","",""],rf=e=>e<=0?xr.NONE:e>=80&&e<90?Math.random()<.2?xr.MUTANT:xr.SINGLE:Object.values(xr).find(t=>e>=t.min&&e<=t.max)||xr.WASTE,Ze=[{name:"",maxExp:100,feedback:0,chance:1,desc:""},{name:"",maxExp:500,feedback:1,chance:.95,desc:""},{name:"",maxExp:1e3,feedback:2,chance:.9,desc:""},{name:"",maxExp:2e3,feedback:3,chance:.85,desc:""},{name:"",maxExp:5e3,feedback:5,chance:.8,desc:""},{name:"",maxExp:2e4,feedback:20,chance:.6,desc:""},{name:"",maxExp:5e4,feedback:30,chance:.5,desc:""},{name:"",maxExp:8e4,feedback:40,chance:.4,desc:""},{name:"",maxExp:2e5,feedback:100,chance:.3,desc:""},{name:"",maxExp:5e5,feedback:150,chance:.25,desc:""},{name:"",maxExp:1e6,feedback:200,chance:.2,desc:""},{name:"",maxExp:2e6,feedback:500,chance:.1,desc:""},{name:"",maxExp:5e6,feedback:800,chance:.08,desc:""},{name:"",maxExp:1e7,feedback:1200,chance:.06,desc:""},{name:"",maxExp:2e7,feedback:2e3,chance:.05,desc:""},{name:"",maxExp:5e7,feedback:3500,chance:.04,desc:""},{name:"",maxExp:1e8,feedback:5e3,chance:.03,desc:""},{name:"",maxExp:2e8,feedback:8e3,chance:.025,desc:""},{name:"",maxExp:5e8,feedback:12e3,chance:.02,desc:""},{name:"",maxExp:1e9,feedback:18e3,chance:.015,desc:""},{name:"",maxExp:2e9,feedback:25e3,chance:.012,desc:""},{name:"",maxExp:5e9,feedback:4e4,chance:.01,desc:""},{name:"",maxExp:1e10,feedback:6e4,chance:.008,desc:""},{name:"",maxExp:2e10,feedback:1e5,chance:.006,desc:""},{name:"",maxExp:5e10,feedback:15e4,chance:.005,desc:""},{name:"",maxExp:1e11,feedback:25e4,chance:.004,desc:""},{name:"",maxExp:2e11,feedback:4e5,chance:.003,desc:""},{name:"",maxExp:5e11,feedback:6e5,chance:.002,desc:""},{name:"",maxExp:1e12,feedback:1e6,chance:.001,desc:""}],sf=e=>{const t=Ze.findIndex(n=>n.name===e);return t===-1||t===Ze.length-1?null:Ze[t+1]},bn=e=>Ze.find(t=>t.name===e)||Ze[0],i2=e=>{const t=Ze.findIndex(n=>n.name===e);return t>=0?t:0},Eo=(e,t,n,s=null,o=0,i=1)=>{const a={:{hp:100,atk:5,mp:0,def:2},:{hp:500,atk:50,mp:200,def:20},:{hp:800,atk:80,mp:400,def:35},:{hp:1200,atk:120,mp:600,def:50},:{hp:2e3,atk:200,mp:1e3,def:80},:{hp:1e4,atk:1e3,mp:5e3,def:400},:{hp:15e3,atk:1500,mp:8e3,def:600},:{hp:2e4,atk:2e3,mp:12e3,def:800},:{hp:1e5,atk:1e4,mp:5e4,def:4e3},:{hp:2e5,atk:2e4,mp:1e5,def:8e3},:{hp:4e5,atk:4e4,mp:2e5,def:16e3},:{hp:1e6,atk:1e5,mp:5e5,def:4e4},:{hp:2e6,atk:2e5,mp:1e6,def:8e4},:{hp:4e6,atk:4e5,mp:2e6,def:16e4},:{hp:1e7,atk:1e6,mp:5e6,def:4e5},:{hp:2e7,atk:2e6,mp:1e7,def:8e5},:{hp:4e7,atk:4e6,mp:2e7,def:16e5},:{hp:1e8,atk:1e7,mp:5e7,def:4e6},:{hp:2e8,atk:2e7,mp:1e8,def:8e6},:{hp:4e8,atk:4e7,mp:2e8,def:16e6},:{hp:1e9,atk:1e8,mp:5e8,def:4e7},:{hp:2e9,atk:2e8,mp:1e9,def:8e7},:{hp:4e9,atk:4e8,mp:2e9,def:16e7},:{hp:1e10,atk:1e9,mp:5e9,def:4e8},:{hp:2e10,atk:2e9,mp:1e10,def:8e8},:{hp:4e10,atk:4e9,mp:2e10,def:16e8},:{hp:1e11,atk:1e10,mp:5e10,def:4e9},:{hp:2e11,atk:2e10,mp:1e11,def:8e9},:{hp:4e11,atk:4e10,mp:2e11,def:16e9}},l=a[e]||a.;let d=1;Object.values(xr).forEach(h=>{h.name===n&&(d=h.multiplier)});const p=1+t/100,c=1+(i>0?Math.min(1,o/i):0)*.3;let u=Math.floor(l.hp*d*p*c),x=Math.floor(l.atk*d*p*c),S=Math.floor((l.def||0)*d*p*c),w=Math.floor(l.mp*d*p*c);return(s?Object.values(s).filter(Boolean):[]).forEach(h=>{const g=h.stats||{};u+=g.hp||0,x+=g.atk||0,S+=g.def||0,w+=g.mp||0}),{hp:u,maxHp:u,atk:x,def:S||Math.floor(x*.4),mp:w,maxMp:w}},Pn=e=>{var l,d;if(!e)return{hp:100,maxHp:100,atk:10,def:5,mp:50,maxMp:50};const t=e.tier||e.tierTitle||"",n=((l=e.stats)==null?void 0:l.aptitude)||50,s=((d=e.spiritRoot)==null?void 0:d.type)||"",o=e.equipment||null,i=e.currentExp||e.cultivation||0,a=e.maxExp||1;return Eo(t,n,s,o,i,a)},mm=[{name:"",rarity:"RED",effect:3,desc:"+200%",cost:0,bonuses:{speedMultiplier:3,feedbackMultiplier:1.5,sectAffinity:{levels:["TOP"],bonus:35}}},{name:"",rarity:"RED",effect:2.5,desc:"",cost:0,bonuses:{speedMultiplier:2.5,feedbackMultiplier:1.3,flatFeedbackBonus:5}},{name:"",rarity:"RED",effect:2.2,desc:"",cost:0,bonuses:{speedMultiplier:2.2,feedbackMultiplier:1.2,sectAffinity:{ids:["NINE_STAR","HEAVEN_EMPEROR"],bonus:30}}},{name:"",rarity:"ORANGE",effect:2,desc:"+100%",cost:0,bonuses:{speedMultiplier:2,sectAffinity:{ids:["NINE_STAR"],bonus:18}}},{name:"",rarity:"ORANGE",effect:1.8,desc:"100%",cost:0,bonuses:{speedMultiplier:1.8,sectAffinity:{ids:["SWORD"],bonus:28}}},{name:"",rarity:"ORANGE",effect:1.4,desc:"+40%",cost:0,bonuses:{speedMultiplier:1.4,businessBonus:.4,feedbackMultiplier:1.15}},{name:"",rarity:"ORANGE",effect:1.6,desc:"",cost:0,bonuses:{speedMultiplier:1.6,feedbackMultiplier:1.1,sectAffinity:{ids:["HEAVEN_EMPEROR","THUNDER"],bonus:22}}},{name:"",rarity:"PURPLE",effect:1.5,desc:"+50%",cost:0,bonuses:{speedMultiplier:1.5,sectAffinity:{ids:["IRON","STONE"],bonus:15}}},{name:"",rarity:"PURPLE",effect:1.5,desc:"",cost:0,bonuses:{speedMultiplier:1.5,feedbackMultiplier:1.05}},{name:"",rarity:"PURPLE",effect:1.3,desc:"",cost:0,bonuses:{speedMultiplier:1.3,businessBonus:.25,sectAffinity:{ids:["GRASS","DAN"],bonus:16}}},{name:"",rarity:"PURPLE",effect:1.4,desc:"",cost:0,bonuses:{speedMultiplier:1.4,sectAffinity:{ids:["THUNDER","DEMON"],bonus:18}}},{name:"",rarity:"BLUE",effect:1.2,desc:"+20%",cost:0,bonuses:{speedMultiplier:1.2}},{name:"",rarity:"BLUE",effect:1.2,desc:"",cost:0,bonuses:{speedMultiplier:1.2,feedbackMultiplier:1.05}},{name:"",rarity:"BLUE",effect:1.15,desc:"",cost:0,bonuses:{speedMultiplier:1.15,sectAffinity:{ids:["IRON"],bonus:12}}},{name:"",rarity:"GREEN",effect:1.1,desc:"",cost:0,bonuses:{speedMultiplier:1.1}},{name:"",rarity:"GREEN",effect:1.1,desc:"",cost:0,bonuses:{speedMultiplier:1.1,sectAffinity:{levels:["MID"],bonus:8}}},{name:"",rarity:"GREEN",effect:1.08,desc:"",cost:0,bonuses:{speedMultiplier:1.08,feedbackMultiplier:1.05}},{name:"",rarity:"WHITE",effect:.9,desc:"",cost:5,bonuses:{speedMultiplier:.9,feedbackMultiplier:.9}},{name:"",rarity:"WHITE",effect:.8,desc:"-20%",cost:0,bonuses:{speedMultiplier:.8}},{name:"",rarity:"WHITE",effect:.85,desc:"",cost:0,bonuses:{speedMultiplier:.85,feedbackMultiplier:.9}}],zr=[{id:"SWORD",name:"",level:"TOP",minApt:80,tuition:500,prefElements:[""],buff:1.5,risk:.02,resourceTypes:["",""],initialRankProb:{:.15,:.35,:.5},desc:"",scale:"",promotionEase:.85,requirements:{minApt:80,requiredElements:[""],allowedRootTypes:["","",""],notes:""}},{id:"HEAVEN_EMPEROR",name:"",level:"TOP",minApt:85,tuition:600,prefElements:["",""],buff:1.6,risk:.03,resourceTypes:["",""],initialRankProb:{:.2,:.4,:.4},desc:"",scale:"",promotionEase:.75,requirements:{minApt:85,allowedRootTypes:["",""],notes:""}},{id:"STAR_PALACE",name:"",level:"TOP",minApt:82,tuition:520,prefElements:["",""],buff:1.55,risk:.025,resourceTypes:["",""],initialRankProb:{:.18,:.37,:.45},desc:"",scale:"",promotionEase:.82,requirements:{minApt:82,allowedRootTypes:["","",""],notes:""}},{id:"VOID_TEMPLE",name:"",level:"TOP",minApt:83,tuition:480,prefElements:["",""],buff:1.52,risk:.028,resourceTypes:["",""],initialRankProb:{:.17,:.33,:.5},desc:"",scale:"",promotionEase:.8,requirements:{minApt:83,requiredElements:["",""],allowedRootTypes:["","",""],notes:""}},{id:"DAN",name:"",level:"HIGH",minApt:60,tuition:300,prefElements:["",""],buff:1.25,risk:.03,resourceTypes:["",""],initialRankProb:{:.1,:.4,:.5},desc:"",scale:"",promotionEase:1,requirements:{minApt:60,requiredElements:["",""],notes:""}},{id:"OCEAN_PALACE",name:"",level:"HIGH",minApt:65,tuition:350,prefElements:[""],buff:1.3,risk:.02,resourceTypes:["",""],initialRankProb:{:.12,:.38,:.5},desc:"",scale:"",promotionEase:.95,requirements:{minApt:65,requiredElements:[""],notes:""}},{id:"THUNDER",name:"",level:"HIGH",minApt:70,tuition:400,prefElements:[""],buff:1.4,risk:.04,resourceTypes:["",""],initialRankProb:{:.15,:.35,:.5},desc:"",scale:"",promotionEase:.9,requirements:{minApt:70,requiredElements:[""],notes:""}},{id:"GLACIER",name:"",level:"HIGH",minApt:68,tuition:320,prefElements:["",""],buff:1.28,risk:.03,resourceTypes:["",""],initialRankProb:{:.13,:.34,:.53},desc:"",scale:"",promotionEase:.97,requirements:{minApt:68,requiredElements:["",""],notes:""}},{id:"FLOWER",name:"",level:"MID",minApt:40,tuition:100,prefElements:["",""],buff:1.15,risk:.01,resourceTypes:["",""],initialRankProb:{:.05,:.25,:.7},desc:"",scale:"",promotionEase:1.05,requirements:{minApt:40,minLooks:75,requiredElements:["",""],notes:""}},{id:"NINE_STAR",name:"",level:"MID",minApt:45,tuition:120,prefElements:["",""],buff:1.18,risk:.02,resourceTypes:["",""],initialRankProb:{:.06,:.24,:.7},desc:"",scale:"",promotionEase:1,requirements:{minApt:45,requiredElements:["",""],notes:""}},{id:"WIND",name:"",level:"MID",minApt:50,tuition:150,prefElements:[""],buff:1.2,risk:.015,resourceTypes:["",""],initialRankProb:{:.08,:.27,:.65},desc:"",scale:"",promotionEase:1.1,requirements:{minApt:50,requiredElements:[""],notes:""}},{id:"HARMONY",name:"",level:"MID",minApt:35,tuition:80,prefElements:["",""],buff:1.12,risk:.01,resourceTypes:["",""],initialRankProb:{:.04,:.21,:.75},desc:"",scale:"",promotionEase:1.08,requirements:{minApt:35,minLooks:70,notes:""}},{id:"IRON",name:"",level:"LOW",minApt:20,tuition:50,prefElements:[""],buff:1.1,risk:.005,resourceTypes:["",""],initialRankProb:{:.02,:.15,:.83},desc:"",scale:"",promotionEase:1.2,requirements:{minApt:20,notes:""}},{id:"GRASS",name:"",level:"LOW",minApt:25,tuition:60,prefElements:[""],buff:1.08,risk:.005,resourceTypes:["",""],initialRankProb:{:.03,:.17,:.8},desc:"",scale:"",promotionEase:1.25,requirements:{minApt:25,requiredElements:[""],notes:""}},{id:"STONE",name:"",level:"LOW",minApt:20,tuition:40,prefElements:["",""],buff:1.05,risk:.003,resourceTypes:["",""],initialRankProb:{:.01,:.12,:.87},desc:"",scale:"",promotionEase:1.18,requirements:{minApt:20,requiredElements:["",""],notes:""}},{id:"EMBER",name:"",level:"LOW",minApt:18,tuition:30,prefElements:[""],buff:1.02,risk:.004,resourceTypes:["",""],initialRankProb:{:.01,:.1,:.89},desc:"",scale:"",promotionEase:1.3,requirements:{minApt:18,requiredElements:["",""],notes:""}},{id:"DEMON",name:"",level:"RECKLESS",minApt:30,tuition:0,prefElements:["",""],buff:2,risk:.1,resourceTypes:["",""],initialRankProb:{:.08,:.22,:.7},desc:"",scale:"",promotionEase:1.2,requirements:{minApt:30,allowedRootTypes:["","",""],notes:""}},{id:"GHOST",name:"",level:"RECKLESS",minApt:35,tuition:0,prefElements:[""],buff:1.8,risk:.08,resourceTypes:["",""],initialRankProb:{:.1,:.25,:.65},desc:"",scale:"",promotionEase:1.1,requirements:{minApt:35,requiredElements:["",""],notes:""}},{id:"BLOOD",name:"",level:"RECKLESS",minApt:25,tuition:0,prefElements:["",""],buff:1.7,risk:.12,resourceTypes:["",""],initialRankProb:{:.05,:.2,:.75},desc:"",scale:"",promotionEase:1.15,requirements:{minApt:25,requiredElements:["",""],notes:""}},{id:"SHADOW_PAVILION",name:"",level:"RECKLESS",minApt:28,tuition:0,prefElements:["",""],buff:1.65,risk:.09,resourceTypes:["",""],initialRankProb:{:.07,:.23,:.7},desc:"",scale:"",promotionEase:1.18,requirements:{minApt:28,requiredElements:["",""],notes:""}},{id:"NONE",name:"",level:"NONE",minApt:0,tuition:0,prefElements:[],buff:.8,risk:0,resourceTypes:[""],initialRankProb:{:1},desc:"",scale:"",promotionEase:1,requirements:{minApt:0,notes:""}}],Hx=e=>zr.find(t=>t.id===e)||zr.find(t=>t.id==="NONE"),Ni=(e,t)=>{var p,f;if(!t||!t.initialRankProb)return"";const n={...t.initialRankProb};if((((p=e.stats)==null?void 0:p.aptitude)||50)>=(t.minApt||0)+20&&n.!==void 0){const c=Math.min(n.,.3);n.-=c,n.=(n.||0)+c*.6,n.=(n.||0)+c*.4}Array.isArray((f=e.spiritRoot)==null?void 0:f.elements)&&Array.isArray(t.prefElements)&&e.spiritRoot.elements.forEach(c=>{t.prefElements.includes(c)&&(n.=(n.||0)+.05,n.=(n.||0)+.03,n.&&(n.=Math.max(0,n.-.08)))});const o=t.promotionEase??1;if(o!==1){const c=Math.max(.3,Math.min(2,o));n.&&(n.*=c),n.&&(n.*=c),n.&&(n./=c),n.&&(n./=c)}const i=Object.keys(n);let a=i.reduce((c,u)=>c+(n[u]||0),0);if(a<=0)return"";i.forEach(c=>n[c]=(n[c]||0)/a);const l=Math.random();let d=0;for(const c of i)if(d+=n[c],l<=d)return c;return i[i.length-1]},a2=e=>e?e.resourceTypes||[]:[],hm=s2(),Wx=(e,t)=>{var l,d,p,f,c;if(!e||!t)return 0;let n=0;Array.isArray((l=e.spiritRoot)==null?void 0:l.elements)&&(e.spiritRoot.elements.forEach(u=>{t.prefElements&&t.prefElements.includes(u)&&(n+=50,e.spiritRoot.elements.length===1&&(n+=30))}),e.spiritRoot.type===""&&t.level==="TOP"&&(n+=50),e.spiritRoot.type===""&&(t.id==="DEMON"&&(n+=60),t.id==="THUNDER"&&(n+=50),t.id==="GHOST"&&e.spiritRoot.elements.includes("")&&(n+=50),t.id==="WIND"&&e.spiritRoot.elements.includes("")&&(n+=50),t.id==="HEAVEN_EMPEROR"&&(n+=40)));const s=((d=e.stats)==null?void 0:d.aptitude)||0,o=(t.minApt||0)-s;if(o<=0){const u=s-(t.minApt||0);n+=Math.min(40,u),u>=20&&t.level==="TOP"&&(n+=20)}else n-=o*2;if(t.level==="TOP"?n-=5:t.level==="RECKLESS"?n+=15:t.level==="LOW"&&(n-=10),t.id==="FLOWER"||t.id==="HARMONY"){const u=((p=e.stats)==null?void 0:p.looks)||50;u>=80?n+=30:u>=60&&(n+=15)}const i=JS(e.constitution);if(i){const u=i.bonus||15;i.ids&&i.ids.includes(t.id)?n+=u:i.levels&&i.levels.includes(t.level)&&(n+=Math.max(8,u*.6))}const a=(c=(f=e.trait)==null?void 0:f.bonuses)==null?void 0:c.sectAffinity;if(a){const u=a.bonus||12;a.ids&&a.ids.includes(t.id)?n+=u:a.levels&&a.levels.includes(t.level)&&(n+=Math.max(6,u*.5))}return Math.round(n)},Ux=(e,t)=>{var f,c,u,x,S,w,C,h;if(!e||!t)return{qualified:!1,reasons:[""],summary:"",notes:""};const n=t.requirements||{},s=((f=e.stats)==null?void 0:f.aptitude)??0,o=((c=e.stats)==null?void 0:c.looks)??0,i=(u=e.spiritRoot)==null?void 0:u.type,a=((x=e.spiritRoot)==null?void 0:x.elements)||[],l=n.minApt??t.minApt??0,d=[],p=[];return l>0&&d.push(`${l}`),(S=n.requiredElements)!=null&&S.length&&d.push(`${n.requiredElements.join("")}`),(w=n.allowedRootTypes)!=null&&w.length&&d.push(`${n.allowedRootTypes.join("")}`),n.minLooks&&d.push(`${n.minLooks}`),n.customText&&d.push(n.customText),s<l&&p.push(`${l}`),n.minLooks&&o<n.minLooks&&p.push(`${n.minLooks}`),(C=n.allowedRootTypes)!=null&&C.length&&i&&(n.allowedRootTypes.includes(i)||p.push(`${n.allowedRootTypes.join("")}`)),(h=n.requiredElements)!=null&&h.length&&(a.some(b=>n.requiredElements.includes(b))||p.push(`${n.requiredElements.join("")}`)),{qualified:p.length===0,reasons:p,summary:d.join(""),notes:n.notes||""}},kc=(e,t=!1)=>{var d,p,f,c,u,x,S,w;let n=t?10:120;const s=((d=e.stats)==null?void 0:d.aptitude)||50;n*=s/50;const i=.5+(((p=e.stats)==null?void 0:p.intelligence)||50)/100;if(n*=i,(f=e.spiritRoot)!=null&&f.multiplier&&(n*=e.spiritRoot.multiplier),e.cultivationMethod&&e.spiritRoot){const C=ef(e.cultivationMethod,e.spiritRoot);n*=C}const a=((u=(c=e.trait)==null?void 0:c.bonuses)==null?void 0:u.speedMultiplier)??((x=e.trait)==null?void 0:x.effect)??1;n*=a,(w=(S=e.trait)==null?void 0:S.bonuses)!=null&&w.flatSpeedBonus&&(n+=e.trait.bonuses.flatSpeedBonus);const l=qS(e.constitution);return n*=l,e.sect&&e.sect.level!=="NONE"&&(n*=1.5),Math.floor(n)},Gu=(e,t={})=>{var x,S,w,C,h;if(e.age<6)return 0;const n=e.tierTitle||e.tier||"";if(n==="")return 0;const s=bn(n);if(!s)return 0;let o=s.feedback||0;if(o===0)return 0;let i=0;n.includes("")?i=e.age<16?1:2:n.includes("")?i=o*.7:n.includes("")||n.includes("")?i=o*1:i=o*.5,e.age<16&&!n.includes("")&&(i*=.5);const a=((S=(x=e.trait)==null?void 0:x.bonuses)==null?void 0:S.feedbackMultiplier)??1,l=((C=(w=e.trait)==null?void 0:w.bonuses)==null?void 0:C.flatFeedbackBonus)||0,d=1+KS(e.constitution);i=i*a*d+l;const p=(((h=e.stats)==null?void 0:h.aptitude)||50)/50;i*=p;let f=1;e.rank===""&&(f=1.2),e.rank===""&&(f=1.5),e.rank===""&&(f=2),i*=f;let c=1;e.cultivationMethod&&e.spiritRoot&&(c=ef(e.cultivationMethod,e.spiritRoot)),i*=c;const u=t.familyRatingMultiplier??1;return i*=u,Math.max(0,Math.floor(i))},l2={:4,:8,:16,:28,:36,:48,:65,:85},c2={TOP:32,HIGH:22,MID:14,LOW:9,RECKLESS:18,NONE:0},ur=[{id:"SEED",label:"",minScore:0,color:"#9e9e9e",tagline:""},{id:"BACKBONE",label:"",minScore:80,color:"#4caf50",tagline:""},{id:"ELITE",label:"",minScore:140,color:"#2196f3",tagline:""},{id:"ELDER",label:"",minScore:200,color:"#ff9800",tagline:""},{id:"SOVEREIGN",label:"",minScore:280,color:"#e91e63",tagline:""}],js=[{id:"CLAN_SEED",name:"",desc:"",requirements:{minMembers:1,minPower:0,minStones:0},feedbackMultiplier:1,feedbackDesc:"1.0 ()"},{id:"LOCAL_CLAN",name:"",desc:"",requirements:{minMembers:5,minPower:120,minStones:500},feedbackMultiplier:1.5,feedbackDesc:"1.5 (+50%)"},{id:"CITY_NOBLE",name:"",desc:"",requirements:{minMembers:10,minPower:320,minStones:2e3},feedbackMultiplier:3,feedbackDesc:"3.0 (+200%)"},{id:"REGION_PILLAR",name:"",desc:"",requirements:{minMembers:15,minPower:600,minStones:8e3,minElders:1},feedbackMultiplier:6,feedbackDesc:"6.0 (+500%)"},{id:"SECT_ALLY",name:"",desc:"",requirements:{minMembers:20,minPower:950,minStones:15e3,minElders:2,minSovereigns:1},feedbackMultiplier:12,feedbackDesc:"12.0 (+1100%)"},{id:"IMMORTAL_DYNASTY",name:"",desc:"",requirements:{minMembers:25,minPower:1400,minStones:3e4,minElders:3,minSovereigns:2},feedbackMultiplier:25,feedbackDesc:"25.0 (+2400%)"},{id:"HEAVENLY_HEGEMONY",name:"",desc:"",requirements:{minMembers:30,minPower:2e3,minStones:6e4,minSovereigns:3},feedbackMultiplier:100,feedbackDesc:"100.0 (+9900%)"}],d2=e=>{const t=js.find(n=>n.id===e);return(t==null?void 0:t.feedbackMultiplier)??1},u2=e=>{const t=Ze.findIndex(n=>n.name===e);return Math.max(0,t)*8},p2=(e,t)=>{if(!e)return t?6:0;const n=e2(e);return n>0?n:l2[e]??(t?6:0)},f2=e=>e?c2[e.level]??10:0,m2=e=>e?e.includes("")?18:e===""?8:e===""?40:0:0,Gx=e=>Math.max(0,Math.min(1,e)),Vx=(e={})=>{if(!e)return{score:0,tierId:ur[0].id,label:ur[0].label,color:ur[0].color,progress:0,tagline:ur[0].tagline,tierStart:0,nextThreshold:ur[1].minScore,isElder:!1,isSovereign:!1};const t=e.tierTitle||e.tier||"",n=u2(t),s=p2(e.rank,!!e.sect),o=f2(e.sect),i=m2(e.rank),a=e.cultivationManual?8:0,l=e.spouse?5:0,d=Math.round(n+s+o+i+a+l),p=[...ur].reverse().find(S=>d>=S.minScore)||ur[0],f=ur.findIndex(S=>S.id===p.id),c=ur[f+1]||null,u=c?Math.max(1,c.minScore-p.minScore):1,x=c?Gx((d-p.minScore)/u):1;return{score:d,tierId:p.id,label:p.label,color:p.color,tagline:p.tagline,tierStart:p.minScore,nextThreshold:(c==null?void 0:c.minScore)??d,progress:x,nextLabel:(c==null?void 0:c.label)||"",isElder:p.id==="ELDER"||p.id==="SOVEREIGN",isSovereign:p.id==="SOVEREIGN"}},Yx=js[0],h2=e=>{const t=js.findIndex(n=>n.id===e);return t>=0?{tier:js[t],index:t}:{tier:Yx,index:0}},ui=(e,t,n)=>({label:e,current:t,required:n,met:t>=n}),g2=(e=[],t={})=>{var g,b,E,I;const n=((g=t.familyRating)==null?void 0:g.currentId)||Yx.id,{tier:s,index:o}=h2(n),i=js[o+1]||null,a=e.map(v=>({id:v.id,name:v.name,generation:v.generation,influence:Vx(v)})),l=a.reduce((v,k)=>v+k.influence.score,0),d=a.filter(v=>v.influence.isElder).length,p=a.filter(v=>v.influence.isSovereign).length,f=e.length+1,c=((b=t.resources)==null?void 0:b.spiritStones)||0,u=Math.round(l+f*5+c/200),x=((E=s.requirements)==null?void 0:E.minPower)??0,S=((I=i==null?void 0:i.requirements)==null?void 0:I.minPower)??u,w=i?Gx((u-x)/Math.max(1,S-x)):1,C=[];if(i){const v=i.requirements||{};v.minMembers!==void 0&&C.push(ui("",f,v.minMembers)),v.minPower!==void 0&&C.push(ui("",u,v.minPower)),v.minStones!==void 0&&C.push(ui("",c,v.minStones)),v.minElders!==void 0&&C.push(ui("",d,v.minElders)),v.minSovereigns!==void 0&&C.push(ui("",p,v.minSovereigns))}const h=i?C.every(v=>v.met):!1;return{enrichedChildren:a,childInfluenceMap:a.reduce((v,k)=>(v[k.id]=k.influence,v),{}),totals:{population:f,stones:c,totalPower:l,elderCount:d,sovereignCount:p,ratingScore:u,powerProgress:w},currentTier:s,currentIndex:o,nextTier:i,requirements:C,canUpgrade:h}},pr=Ji[0],yl=kl(),x2={...yl.spiritRoot},oo={name:"",age:16,gender:"",avatar:{base:0,skinColor:0,hair:1,hairColor:0,eye:0,eyeColor:1,mouth:0},tier:yl.tier,currentExp:yl.currentExp,maxExp:yl.maxExp,resources:{spiritStones:100,money:50},stats:{looks:80,cunning:60,aptitude:15,intelligence:60,health:80},familyRating:{currentId:js[0].id,history:[]},skillPoints:0,usedRedeemCodes:[],breakthroughBonus:0,breakthroughFailCount:0,newsBuffer:[],gazetteHistory:[],gazetteIssue:0,hasUnreadGazette:!1,worldNpcs:[],specialCollections:{fumoSwords:[]},specialFlags:{fumoDuoUnlocked:!1,fumoDuoMet:!1},rival:{name:pr.name,stageId:pr.id,state:"NORMAL",lifeStage:0,storyTimer:0,threatLevel:pr.baseThreat??0,rumorCount:0,hiddenTurns:0,isDead:!1,relationValue:-100,tier:pr.tier,currentExp:pr.baseExp,stats:{aptitude:95,looks:80,intelligence:90,health:80},combatStats:{hp:pr.combatStats.hp,maxHp:pr.combatStats.maxHp,atk:pr.combatStats.atk,def:pr.combatStats.def}},revengeProgress:{currentStageIndex:0,completedStages:[],sagaComplete:!1},revengeActions:{lastRumorMonth:0,totalRumors:0,assassinationAttempts:0,hidingMonths:0},spiritRoot:x2,cultivationMethod:"basic_breath",combatStats:{hp:300,maxHp:300,atk:25,def:8,mp:120,maxMp:120},time:{year:3572,month:9,season:""},status:["",""]},y2={aptitude:{name:"",desc:"",trainable:!0,howToIncrease:"",howToRestore:"",effect:""},luck:{name:"",desc:"",trainable:!0,howToIncrease:"NPC",howToRestore:"",effect:""},lifespan:{name:"",desc:"",trainable:!1,howToIncrease:"",effect:""},looks:{name:"",desc:"",trainable:!0,howToIncrease:"",howToRestore:"",effect:""},cunning:{name:"",desc:"",trainable:!0,howToIncrease:"",howToRestore:"/",effect:""},health:{name:"",desc:"0-100",trainable:!1,howToIncrease:"NPC",howToRestore:"5-10",effect:"4020",energyLimitFormula:"max(5, 20 - (100 - health) * 0.15)  // "},intelligence:{name:"",desc:"",trainable:!0,howToIncrease:"",howToRestore:"",effect:""}};function b2(e){return y2[e]||{name:e,desc:"",trainable:!1,howToIncrease:"",howToRestore:"",effect:""}}function Lt(e,t=20){if(e==null)return t;const s=(100-Math.max(0,Math.min(100,e)))*.15;return Math.max(5,t-s)}function v2(e,t){const n=Math.max(0,e-t),s=e-n;let o="";return s>30?o="":s>15&&(o=""),{newHealth:n,healthLost:s,severity:o,damageDisplay:`${o} ${s} ${e}  ${n}`}}const gm={EXPLORATION:{name:"",icon:"",minDamage:5,maxDamage:20,severity:""},ASSASSINATION:{name:"",icon:"",minDamage:15,maxDamage:40,severity:""},DUEL:{name:"",icon:"",minDamage:20,maxDamage:50,severity:""},ROMANCE:{name:"",icon:"",minDamage:3,maxDamage:10,severity:""},DISASTER:{name:"",icon:"",minDamage:10,maxDamage:30,severity:""}};function ko(e,t,n="EXPLORATION"){var f;const s=((f=e.stats)==null?void 0:f.health)||50,o=gm[n]||gm.EXPLORATION,i=v2(s,t),a=Lt(s),l=Lt(i.newHealth),d=a-l,p=`
${o.icon} ${o.name}
${i.damageDisplay}

${i.newHealth<20?" ":""}
${d>0?`  ${d.toFixed(1)}  ${a.toFixed(1)}  ${l.toFixed(1)}`:""}
  `.trim();return{newHealth:i.newHealth,healthLost:i.healthLost,severity:i.severity,message:p,energyPenalty:Math.max(0,d),isSerious:i.newHealth<20}}function S2(e,t,n="REST"){var u;const s=((u=e.stats)==null?void 0:u.health)||50,o=Lt(s),i=Math.min(100,s+t),a=i-s,l=Lt(i),d=l-o;let p="",f="";n==="MEDICINE"?(p="",f=""):n==="HEALER"&&(p="",f="");const c=`
${p} ${f}
 ${a} ${s}  ${i}

${d>0?`  ${d.toFixed(1)}  ${o.toFixed(1)}  ${l.toFixed(1)}`:""}
${i===100?" ":""}
  `.trim();return{newHealth:i,recovered:a,message:c,energyBonus:Math.max(0,d)}}function w2(e){var d;const t=((d=e.stats)==null?void 0:d.health)||50,n=5+Math.floor(Math.random()*6),s=e.currentExp||0,o=Math.floor(s/1e3*.5),i=n+o,a=Math.min(100,t+i),l=a-t;return{newHealth:a,recovered:l,message:l>0?` +${l}${t}  ${a}`:null}}function of(e){var n;const t=((n=e.stats)==null?void 0:n.health)||50;return{canExplore:t>=20,canDuel:t>=30,canAssassinate:t>=25,health:t,reason:t<20?"":t<30?"":""}}function E2(){const[e,t]=y.useState({...oo,businesses:[],gazetteHistory:[],gazetteIssue:0,hasUnreadGazette:!1,newsBuffer:[],lastAuctionYear:null,currentAuction:null,auctionWindowStart:null,auctionWindowEnd:null,energy:oo.energy??20,soldAuctionItems:[]}),n=y.useCallback(T=>{t(A=>({...A,...T}))},[]),s=y.useCallback(T=>{t(A=>{const R={...A.stats,...T};let $=A.energy;if(typeof T.health=="number"){const O=Lt(T.health);$=Math.min(A.energy,O)}return{...A,stats:R,energy:$}})},[]),o=y.useCallback(T=>{t(A=>({...A,time:{...A.time,...T}}))},[]),i=y.useCallback(T=>{t(A=>({...A,cultivation:typeof T=="function"?T(A.cultivation):T}))},[]),a=y.useCallback(T=>{t(A=>{const R={...A.resources};return T.spirit&&(R.spirit=(A.resources.spirit||0)+T.spirit),T.spirit2&&(R.spirit2=(A.resources.spirit2||0)+T.spirit2),T.spiritStones!==void 0&&(R.spiritStones=(A.resources.spiritStones||0)+T.spiritStones),{...A,resources:R}})},[]),l=y.useCallback(T=>{t(A=>{const R={...A.resources};return T.spirit&&(R.spirit=Math.max(0,(A.resources.spirit||0)-T.spirit)),T.spirit2&&(R.spirit2=Math.max(0,(A.resources.spirit2||0)-T.spirit2)),T.spiritStones!==void 0&&(R.spiritStones=Math.max(0,(A.resources.spiritStones||0)-T.spiritStones)),{...A,resources:R}})},[]),d=y.useCallback(T=>{t(A=>({...A,energy:typeof T=="function"?T(A.energy||0):Math.max(0,(A.energy||0)+T)}))},[]),p=y.useCallback((T=1)=>{t(A=>({...A,energy:Math.max(0,(A.energy||0)-T)}))},[]),f=y.useCallback(T=>{t(A=>({...A,resources:{...A.resources,spiritStones:Math.max(0,A.resources.spiritStones-T.cost)},businesses:[...A.businesses,T]}))},[]),c=y.useCallback(({won:T,expGain:A=0,spiritStones:R=0,health:$,healthDamage:O,injurySource:Q,onNotify:L})=>{t(G=>{const ne={...G};if(A&&(ne.currentExp=(G.currentExp||0)+A),R!==0&&(ne.resources={...G.resources,spiritStones:R>0?G.resources.spiritStones+R:Math.max(0,G.resources.spiritStones+R)}),$!==void 0){ne.stats={...G.stats,health:$};const ae=Lt($);ne.energy=Math.min(G.energy||20,ae)}else if(O&&O>0){const ae=ko(G,O,Q||"EXPLORATION");if(ne.stats={...G.stats,health:ae.newHealth},ae.energyPenalty>0){const Y=Lt(ae.newHealth);ne.energy=Math.min(G.energy||20,Y)}L&&L({type:"health_damage",message:ae.message,severity:ae.severity,isSerious:ae.isSerious})}return ne})},[]),u=y.useCallback((T,A="EXPLORATION",R)=>{t($=>{const O=ko($,T,A);R&&R({type:"health_damage",message:O.message,severity:O.severity,isSerious:O.isSerious,energyPenalty:O.energyPenalty});let Q=$.energy||20;if(O.energyPenalty>0){const L=Lt(O.newHealth);Q=Math.min(Q,L)}return{...$,stats:{...$.stats,health:O.newHealth},energy:Q}})},[]),x=y.useCallback((T,A="REST",R)=>{t($=>{const O=S2($,T,A);return R&&O.message&&R({type:"health_recovery",message:O.message,energyBonus:O.energyBonus}),{...$,stats:{...$.stats,health:O.newHealth}}})},[]),S=y.useCallback((T="explore")=>of(e),[e]),w=y.useCallback(()=>{var T;return Lt(((T=e.stats)==null?void 0:T.health)||50)},[e]),C=y.useCallback((T,A)=>{t(R=>({...R,worldNpcs:(R.worldNpcs||[]).map($=>$.id===T?{...$,...A}:$)}))},[]),h=y.useCallback(T=>{t(A=>({...A,worldNpcs:T(A.worldNpcs||[])}))},[]),g=y.useCallback(T=>{t(A=>({...A,newsBuffer:[...A.newsBuffer||[],T]}))},[]),b=y.useCallback(()=>{t(T=>({...T,newsBuffer:[]}))},[]),E=y.useCallback((T,A)=>{t(R=>{var O;const $=Array.isArray((O=R.specialCollections)==null?void 0:O[T])?R.specialCollections[T]:[];return $.includes(A)?R:{...R,specialCollections:{...R.specialCollections||{},[T]:[...$,A]}}})},[]),I=y.useCallback(()=>{t(T=>{const R=Lt(10);return{...T,currentExp:0,stats:{...T.stats,health:10},energy:Math.min(T.energy||20,R),resources:{...T.resources,spiritStones:Math.floor(T.resources.spiritStones*.5)}}})},[]),v=y.useCallback(T=>{t(A=>({...A,inventory:[...A.inventory||[],T]}))},[]),k=y.useCallback(T=>{t(A=>({...A,inventory:(A.inventory||[]).filter(R=>R.id!==T)}))},[]);return{player:e,setPlayer:t,updatePlayer:n,updatePlayerStats:s,updatePlayerTime:o,updatePlayerCultivation:i,addResources:a,consumeResources:l,updateEnergy:d,consumeEnergy:p,purchaseBusiness:f,applyCombatResult:c,applyHealthDamageWithNotify:u,applyHealthRecovery:x,checkHealthStatus:S,getEnergyLimit:w,updateWorldNpc:C,updateWorldNpcs:h,addNewsToBuffer:g,clearNewsBuffer:b,addToSpecialCollection:E,applyDefeatPenalty:I,addInventoryItem:v,removeInventoryItem:k}}const k2={aptitude:85,looks:90,intelligence:80},qx=[{id:1,name:"",gender:"",age:25,identity:"",desc:"",avatar:{base:0,skinColor:1,hair:0,hairColor:0,eye:0,eyeColor:0,mouth:1},...(()=>{const e=kl();return{tier:e.tier,currentExp:e.currentExp,maxExp:e.maxExp,spiritRoot:e.spiritRoot}})(),stats:k2,combatStats:{hp:2e3,maxHp:2e3,atk:180,mp:800},sect:Hx("SWORD"),sectId:"SWORD",sectRank:"",sectStatus:"defected",appearance:"...",personality:{label:"",tag:"",desc:""},relationship:{stage:1,affection:10,trust:20,jealousy:0},likes:["",""],dislikes:[""],isPregnant:!1},{id:2,name:"",gender:"",age:38,identity:"",desc:"",avatar:{base:0,skinColor:2,hair:-1,hairColor:null,eye:0,eyeColor:0,mouth:1},...(()=>{const e=kl();return{tier:e.tier,currentExp:e.currentExp,maxExp:e.maxExp,spiritRoot:e.spiritRoot}})(),stats:{aptitude:95,looks:40,intelligence:95},combatStats:{hp:1800,maxHp:1800,atk:200,mp:1200},sect:null,sectId:null,sectRank:"",sectStatus:"mysterious",personality:{label:"",tag:"",desc:""},relationship:{stage:1,affection:5,trust:10,jealousy:0},likes:[""],dislikes:[],isPregnant:!1}];function Jr(e={}){var h,g,b,E;const t=e.currentExp||e.cultivation||0,n=e.combatStats||{},s=n.atk||Math.floor((((h=e.stats)==null?void 0:h.aptitude)||50)*.8),o=n.def||Math.floor((((g=e.stats)==null?void 0:g.aptitude)||50)*.4),i=n.maxHp||Math.floor(t+(((b=e.stats)==null?void 0:b.health)||50)*10),a=45,l=1,d=22,p=.08,f=18,c=Math.floor(s*a),u=Math.floor(i*l),x=Math.floor(o*d),S=Math.floor(t*p),w=Math.floor((((E=e.stats)==null?void 0:E.aptitude)||50)*f);return{total:Math.max(1,c+u+x+S+w),breakdown:{atk:c,hp:u,def:x,exp:S,aptitude:w},details:{atk:s,def:o,maxHp:i}}}function j2(e={},t={}){var C,h,g,b,E,I;const n=e.combatStats||{},s=t.combatStats||{},o=n.atk||Math.max(1,Math.floor((((C=e.stats)==null?void 0:C.aptitude)||50)*.8)),i=n.def||Math.max(0,Math.floor((((h=e.stats)==null?void 0:h.aptitude)||50)*.4)),a=n.maxHp||Math.max(1,Math.floor((e.currentExp||e.cultivation||0)+(((g=e.stats)==null?void 0:g.health)||50)*10)),l=s.atk||Math.max(1,Math.floor((((b=t.stats)==null?void 0:b.aptitude)||50)*.8)),d=s.def||Math.max(0,Math.floor((((E=t.stats)==null?void 0:E.aptitude)||50)*.4)),p=s.maxHp||Math.max(1,Math.floor((t.currentExp||t.cultivation||0)+(((I=t.stats)==null?void 0:I.health)||50)*10)),f=Math.max(1,o-Math.floor(d/2)),c=Math.max(1,l-Math.floor(i/2)),u=Math.ceil(p/f),x=Math.ceil(a/c),S=x-u;let w;return S>=3?w=.98:S===2?w=.92:S===1?w=.78:S===0?w=.55:S===-1?w=.28:S===-2?w=.12:w=.03,{prob:w,roundsToKillEnemy:u,roundsToDie:x,pDpr:f,eDpr:c}}const C2=[{id:"farm",name:"",cost:500,baseIncome:50,desc:"",minTier:""},{id:"mine",name:"",cost:2e3,baseIncome:200,desc:"",minTier:""},{id:"auction",name:"",cost:1e4,baseIncome:1500,desc:"",minTier:""},{id:"sect_branch",name:"",cost:5e4,baseIncome:8e3,desc:"",minTier:""}],Kx=[{id:"peach_island",name:"",reqTier:"",recommendCP:300,cost:10,drops:["herb_bandage","iron_sword","rice_ball"],risk:.05,desc:"",resourceLevel:"MORTAL",dropTable:[{item:"herb_bandage",weight:.3},{item:"iron_sword",weight:.3},{item:"rice_ball",weight:.4}]},{id:"snake_valley",name:"",reqTier:"",recommendCP:5e3,cost:50,drops:["foundation_pill","beast_core","beast_fang"],risk:.15,desc:"",resourceLevel:"MORTAL",dropTable:[{item:"foundation_pill",weight:.2},{item:"beast_core",weight:.4},{item:"beast_fang",weight:.4}]},{id:"thunder_peak",name:"",reqTier:"",recommendCP:8e4,cost:300,drops:["thunder_wood","core_pill","iron_armor"],risk:.25,desc:"",resourceLevel:"SPIRIT",dropTable:[{item:"thunder_wood",weight:.3},{item:"core_pill",weight:.35},{item:"iron_armor",weight:.35}]},{id:"ancient_tomb",name:"",reqTier:"",recommendCP:15e4,cost:500,drops:["artifact_supreme","milk_millennium","marrow_wash"],risk:.4,desc:"",resourceLevel:"EARTH",dropTable:[{item:"artifact_supreme",weight:.25},{item:"milk_millennium",weight:.35},{item:"marrow_wash",weight:.4}]},{id:"demon_domain",name:"",reqTier:"",recommendCP:8e5,cost:2e3,drops:["nascent_fruit","heaven_manual","divine_egg"],risk:.6,desc:"",resourceLevel:"HEAVEN",dropTable:[{item:"nascent_fruit",weight:.3},{item:"heaven_manual",weight:.35},{item:"divine_egg",weight:.35}]},{id:"star_sea_realm",name:"",reqTier:"",recommendCP:16e5,cost:5e3,drops:["starlight_pill","cosmic_crystal","void_silk"],risk:.7,desc:"",resourceLevel:"HEAVEN",dropTable:[{item:"starlight_pill",weight:.3},{item:"cosmic_crystal",weight:.35},{item:"void_silk",weight:.35}]},{id:"immortal_cave",name:"",reqTier:"",recommendCP:8e6,cost:2e4,drops:["primordial_spirit_pill","heavenly_jade","soul_essence_crystal"],risk:.75,desc:"",resourceLevel:"DIVINE",dropTable:[{item:"primordial_spirit_pill",weight:.3},{item:"heavenly_jade",weight:.35},{item:"soul_essence_crystal",weight:.35}]},{id:"celestial_pagoda",name:"",reqTier:"",recommendCP:16e6,cost:5e4,drops:["nine_heaven_pill","star_core_fragment","celestial_silk_cloth"],risk:.8,desc:"",resourceLevel:"DIVINE",dropTable:[{item:"nine_heaven_pill",weight:.25},{item:"star_core_fragment",weight:.35},{item:"celestial_silk_cloth",weight:.4}]},{id:"abyss_deeps",name:"",reqTier:"",recommendCP:32e6,cost:1e5,drops:["soul_splitting_pill","abyss_stone","abyssal_essence"],risk:.85,desc:"",resourceLevel:"DIVINE",dropTable:[{item:"soul_splitting_pill",weight:.2},{item:"abyss_stone",weight:.4},{item:"abyssal_essence",weight:.4}]},{id:"divine_transformation_realm",name:"",reqTier:"",recommendCP:8e7,cost:3e5,drops:["god_transformation_pill","divine_tribulation_stone","god_marrow"],risk:.8,desc:"",resourceLevel:"DIVINE",dropTable:[{item:"god_transformation_pill",weight:.2},{item:"divine_tribulation_stone",weight:.4},{item:"god_marrow",weight:.4}]},{id:"soul_refining_abyss",name:"",reqTier:"",recommendCP:16e7,cost:5e5,drops:["divine_soul_pill","divine_essence_core","soul_tempering_stone"],risk:.82,desc:"",resourceLevel:"DIVINE",dropTable:[{item:"divine_soul_pill",weight:.2},{item:"divine_essence_core",weight:.4},{item:"soul_tempering_stone",weight:.4}]},{id:"void_condensing_heaven",name:"",reqTier:"",recommendCP:32e7,cost:8e5,drops:["void_condensing_pill","void_manifold_crystal","condensed_void_essence"],risk:.85,desc:"",resourceLevel:"DIVINE",dropTable:[{item:"void_condensing_pill",weight:.15},{item:"void_manifold_crystal",weight:.42},{item:"condensed_void_essence",weight:.43}]},{id:"immortal_ascension_peak",name:"",reqTier:"",recommendCP:4e8,cost:15e5,drops:["heaven_defying_pill","celestial_ascension_token","immortal_transformation_essence"],risk:.9,desc:"",resourceLevel:"DIVINE",dropTable:[{item:"heaven_defying_pill",weight:.15},{item:"celestial_ascension_token",weight:.42},{item:"immortal_transformation_essence",weight:.43}]}],bl=e=>Jr(e).total||0,Ql=(e=[])=>e[Math.floor(Math.random()*e.length)],Qx=["","","","","","","","","","","","","","","","",""],T2=["","","","","","","","","","","","","","","","","","","","","","","","","","","","","",""],Md={male:["","","","","","","","","","","","","","","","","","","",""],female:["","","","","","","","","","","","","","","","","","","",""],neutral:["","","","","","","","","","","","","","","","","","","",""]},I2=["","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","",""],_2=new Set(Qx);function R2(){return Ql(I2)}function xm(e=""){const t=(e||"").replace(/\s+/g,"");if(!t)return"";const n=t.slice(0,2);return _2.has(n)?n:t.charAt(0)}const M2=()=>Math.random()<.15?Ql(Qx):Ql(T2),A2=(e="")=>{const t=e===""?Md.female:Md.male,n=[...Md.neutral,...t];return Ql(n)};function af(e="",t={}){const{motherName:n="",fatherName:s="",preferSurname:o=""}=t,i=o||xm(n)||xm(s)||M2(),a=A2(e);return`${i}${a}`}const N2={MORTAL:100,EXPONENTIAL_BASE:1.8},rr={WASTE:.8,FIVE:.95,FOUR:1,THREE:1.15,DOUBLE:1.35,SINGLE:1.6,MUTANT:1.75,HEAVEN:2},Jx=(e=50)=>1+Math.max(-.5,(e-50)*.012),fo={longevity_body:1.3,immortal_marrow:1.5,void_spirit_body:1.25,ancient_bloodline:1.2,cursed_body:.75,demonic_enhancement:.85,phoenix_reborn:1.1,common_body:1},Vu={BASE_PROBABILITY:.01,DIFFICULTY_MULTIPLIER:{:10,:5,:4,:3.5,:2.5,:2,:1.8,:1.5,:1.2,:.8,:.6,:.5,:.4,:.3,:.25,:.2,:.15,:.1,:.08,:.06,:.04,:.02,:.015,:.01,:.008,:.006,:.004,:.002,:.0015,:.001,:5e-4,:3e-4,:1e-4},FACTORS:{aptitudeBonus:e=>1+Math.max(-.5,(e-50)*.015),spiritRootBonus:e=>({WASTE:.5,FIVE:.7,FOUR:.85,THREE:1,DOUBLE:1.2,SINGLE:1.5,MUTANT:1.8,HEAVEN:2.2})[e]||1,ageBonus:(e,t)=>{if(!t)return 1;const n=Math.abs(e-t);return n<=10?1+(10-n)*.05:Math.max(.3,1-(n-10)/20)},expProgress:(e,t)=>.5+Math.max(0,Math.min(1,e/t))*1.5,healthBonus:e=>.8+e*.004},LIFESPAN_GAIN_MULTIPLIER:.7};function Jl(e=0,t=1,n=1,s=1){const{MORTAL:o,EXPONENTIAL_BASE:i}=N2,a=Math.pow(i,e/5),d=o*a*t*n*s;return Math.floor(d)}function L2(e,t=1){var d,p,f;const n=Vu;let s=n.BASE_PROBABILITY/t;const o=n.FACTORS.aptitudeBonus(((d=e.stats)==null?void 0:d.aptitude)||50);s*=o;const i=n.FACTORS.spiritRootBonus(((p=e.spiritRoot)==null?void 0:p.id)||"FOUR");s*=i;const a=n.FACTORS.expProgress(e.currentExp||0,e.maxExp||100);s*=a;const l=n.FACTORS.healthBonus(((f=e.stats)==null?void 0:f.health)||50);return s*=l,Math.min(.5,s)}const $2=e=>{const t=r2(e);if(!t)return null;const n=Xp(t);return n?{giftItemId:t,giftName:n.name}:null},zs=(e,t)=>Math.random()>.5?e:t,B2=(e={},t=null)=>{const s=Jx(e.aptitude||50);let o=fo.common_body;t!=null&&t.key&&fo[t.key]&&(o=fo[t.key]);const a=Jl(0,1,s,o);return Math.floor(a)},Io=(e,t={})=>{const n=rf(e);let s=[],o=n.name,i=n.desc;n.id==="NONE"?s=[]:n.id==="MUTANT"?s=[fm[Math.floor(Math.random()*fm.length)]]:s=[...o2].sort(()=>.5-Math.random()).slice(0,n.elementCount);const a=XS(t.constitution);if(a&&a.length>0){const l=a[Math.floor(Math.random()*a.length)];n.id==="MUTANT"?s=[l]:s.length>0?s[0]=l:s=[l]}return{type:o,elements:s,desc:i,color:n.color,multiplier:n.multiplier}},qn=(e,t,n,s={})=>Io(e,s),Yu=e=>{if(!e)return{recommended:[],others:[]};const t=zr.map(l=>({sect:l,score:Wx(e,l),admission:Ux(e,l)})),n=[...t].sort((l,d)=>d.score-l.score),s=[];if(n.forEach(l=>{l.sect.id!=="NONE"&&(s.length>=3||l.admission.qualified&&s.push(l))}),s.length<3&&n.forEach(l=>{l.sect.id!=="NONE"&&(s.includes(l)||s.length<3&&s.push(l))}),s.length===0&&n.length){const l=n.find(d=>d.sect.id!=="NONE")||n[0];l&&s.push(l)}const o=l=>({sect:l.sect,predictedRank:l.admission.qualified?Ni(e,l.sect):null,resources:a2(l.sect),compatibility:l.score,admission:l.admission}),i=s.map(o),a=t.filter(l=>!s.includes(l)).sort((l,d)=>d.score-l.score).map(o);return{recommended:i,others:a}},O2=(e,t,n)=>{var I,v,k,T;const s=e.avatar||{base:0,skinColor:0,eye:2,eyeColor:0,mouth:0,hairColor:0},o=t.avatar,i=Math.random()>.5?"":"",a={base:zs(s.base,o.base),skinColor:zs(s.skinColor,o.skinColor),eye:zs(s.eye,o.eye),eyeColor:zs(s.eyeColor,o.eyeColor),mouth:zs(s.mouth,o.mouth),hair:Math.floor(i===""?Math.random()*2:Math.random()*4),hairColor:zs(s.hairColor,o.hairColor)};let l=((((I=e.stats)==null?void 0:I.aptitude)||50)+(((v=t.stats)==null?void 0:v.aptitude)||50))/2,d=Math.floor(Math.random()*31)-15;Math.random()<.05&&(d+=Math.random()>.5?20:-20),t.constitution&&(d+=5);const p=((k=e.spiritRoot)==null?void 0:k.type)==="",f=((T=t.spiritRoot)==null?void 0:T.type)==="";(p&&Math.random()<.2||f&&Math.random()<.2)&&(d+=30);const c=Math.max(1,Math.min(100,Math.floor(l+d))),u=Math.floor((e.stats.looks+t.stats.looks)/2+(Math.random()*10-5));let x=null;const S=Math.random(),w=e.constitution&&e.constitution.name,C=t.constitution&&t.constitution.name;if(w&&C){if(S<.8){const A=Math.random()>.5?t.constitution:e.constitution;x=xl(A)}}else C?S<.6&&(x=xl(t.constitution)):w&&S<.6&&(x=xl(e.constitution));!x&&Math.random()<.01&&(x=Dx("innate_dao")||{name:"",desc:"",rarity:"UR"});const h={weapon:null,armor:null,accessory:null};let g={aptitude:c,looks:u,intelligence:Math.floor((e.stats.cunning+t.stats.intelligence)/2)};g=nf(g,x);const b=Eo("",g.aptitude,null,h),E=af(i,{motherName:e==null?void 0:e.name,fatherName:t==null?void 0:t.name,preferSurname:""});return rp({id:`child_${Date.now()}_${Math.floor(Math.random()*1e5)}`,name:E,fatherName:t.name,birthYear:n,generation:1,age:0,gender:i,stats:{...g,lifespan:B2(g,x)},constitution:x,cultivationMethod:"basic_breath",equipment:h,combatStats:b,avatar:a,isTested:!1,cultivation:0,isAdult:!1})},Xx=e=>{for(let t=0;t<Ze.length;t++)if(e<Ze[t].maxExp)return Ze[t];return Ze[Ze.length-1]},P2=(e,t,n={})=>{let s=0,o=0,i=[],a=[];const l=n.familyRatingMultiplier??1,d=[];return{newChildren:[...e.map(c=>{var x,S,w,C,h,g,b,E,I,v,k,T,A,R;let u={...c};if(u.age+=1/12,u.stats||(u.stats={}),!u.stats.lifespan){const $=((x=u.spiritRoot)==null?void 0:x.multiplier)||1,O=100;u.stats.lifespan=Math.floor(O*(1+$))}if(Math.floor(u.age*12)===12&&!u.trait){const $=Math.random()*100;let O="WHITE";$>99?O="RED":$>95?O="ORANGE":$>85?O="PURPLE":$>65?O="BLUE":$>35&&(O="GREEN");const Q=mm.filter(ne=>ne.rarity===O),L=Q[Math.floor(Math.random()*Q.length)]||mm[0];u.trait=L;const G=` ${u.name} ${L.name}(${L.desc})`;i.push(G),a.push({type:"ZHAOZHOU",title:"",message:G,child:u,trait:L,showModal:!0})}if(Math.floor(u.age*12)===144&&u.isTested&&!u.sect){const{recommended:$,others:O}=Yu(u),Q=` ${u.name} 12`;i.push(Q),a.push({type:"JOIN_SECT",title:"",message:Q,child:u,selectableSects:$,otherSectOptions:O,showModal:!0})}if(u.age>6){const $=kc(u,!0);u.cultivation=Math.floor(u.cultivation+$);const O=Xx(u.cultivation),Q=u.tierTitle;u.tierTitle=O.name;const L=Ze.findIndex(ne=>ne.name===O.name),G=L>0?Ze[L-1].maxExp:0;if(u.currentExp=u.cultivation-G,u.maxExp=O.maxExp-G,Q&&Q!==u.tierTitle){const ae={:30,:30,:30,:30,:50,:50,:50,:50,:200,:200,:200,:200,:300,:300,:300,:300,:500,:500,:500,:500}[u.tierTitle]||50;u.stats||(u.stats={}),typeof u.stats.lifespan!="number"&&(u.stats.lifespan=100),u.stats.lifespan+=ae,i.push(` ${u.name} ${u.tierTitle} ${ae} `)}if(s+=Gu(u,{familyRatingMultiplier:l})/12,Math.floor(u.age*12)%36===0&&u.sect&&u.sect.level!=="NONE"){const ne=hm.indexOf(u.rank),ae=Math.max(.3,Math.min(2,((S=u.sect)==null?void 0:S.promotionEase)||1)),Y=ie=>ie/ae;let q=0;if(u.cultivation>Y(500)&&(q=1),u.cultivation>Y(2e3)&&(((w=u.stats)==null?void 0:w.aptitude)||0)>50&&(q=2),u.cultivation>Y(2e4)&&(((C=u.stats)==null?void 0:C.aptitude)||0)>80&&(q=3),u.cultivation>Y(1e5)&&(q=5),q>ne){u.rank=hm[q];let ie=` ${u.name} ${u.sect.name}  ${u.rank}`;const Z=$2(u.rank);Z&&(ie+=` ${Z.giftName}${u.name} `,a.push({type:"CHILD_PROMOTION_GIFT",title:"",message:ie,child:u,rank:u.rank,sect:u.sect,giftItemId:Z.giftItemId,giftName:Z.giftName,showModal:!0})),i.push(ie)}}}if(Math.floor(u.age*12)===216&&(i.push(` ${u.name} `),u.isAdult=!0),u.isAdult&&u.spouse&&u.age<60&&Math.random()<.1&&e.filter(O=>O.parentId===u.id).length<3){const O=((h=u.stats)==null?void 0:h.aptitude)||50,Q=((b=(g=u.spouse)==null?void 0:g.stats)==null?void 0:b.aptitude)||((E=u.spouse)==null?void 0:E.aptitude)||50,L=(O+Q)/2;let G=Math.floor(Math.random()*31)-15;const ne=((I=u.spiritRoot)==null?void 0:I.type)==="",ae=((k=(v=u.spouse)==null?void 0:v.spiritRoot)==null?void 0:k.type)==="";(ne&&Math.random()<.2||ae&&Math.random()<.2)&&(G+=30);const Y=Math.max(1,Math.min(100,Math.floor(L+G))),q=u.stats.looks||50,ie=((T=u.spouse.stats)==null?void 0:T.looks)||u.spouse.looks||50,Z=Math.max(1,Math.min(100,Math.floor((q+ie)/2+(Math.random()*10-5)))),ve=u.stats.intelligence||50,V=((A=u.spouse.stats)==null?void 0:A.intelligence)||u.spouse.intelligence||50,ee=Math.max(1,Math.min(100,Math.floor((ve+V)/2+(Math.random()*10-5))));let he=null;const ge=Math.random(),me=u.constitution&&u.constitution.name,Me=((R=u.spouse)==null?void 0:R.constitution)&&u.spouse.constitution.name;me&&Me?ge<.8&&(he=Math.random()>.5?u.constitution:u.spouse.constitution):me?ge<.6&&(he=u.constitution):Me&&ge<.6&&(he=u.spouse.constitution),!he&&Math.random()<.01&&(he={name:"",desc:"",rarity:"UR"});const $e={weapon:null,armor:null,accessory:null};let je={aptitude:Y,looks:Z,intelligence:ee};je=nf(je,he);const ct=Eo("",je.aptitude,null,$e),vt=Math.random()>.5?"":"",De=rp({id:Date.now()+Math.random().toString().slice(2,10),name:af(vt,{preferSurname:""}),fatherName:u.name,motherName:u.spouse.name,parentId:u.id,birthYear:Math.floor(u.age*12/12),generation:(u.generation||1)+1,age:0,gender:vt,stats:je,constitution:he,cultivationMethod:"basic_breath",equipment:$e,combatStats:ct,avatar:{base:Math.floor(Math.random()*3),skinColor:Math.floor(Math.random()*5),eye:Math.floor(Math.random()*3),eyeColor:Math.floor(Math.random()*5),mouth:Math.floor(Math.random()*3),hair:Math.floor(vt===""?Math.random()*2:Math.random()*4),hairColor:Math.floor(Math.random()*5)},isTested:!1,cultivation:0,isAdult:!1});d.push(De);const D=` ${u.name}  ${u.spouse.name} /${De.name}`;i.push(D),a.push({type:"GRANDCHILD_BIRTH",title:"",message:D,child:u,grandchildCount:1})}return u}),...d],totalFeedback:s,totalCost:o,logs:i,events:a}},vl=(e,t,n="random")=>{const s=t===""?"":"",o=af(s);let i,a,l,d=null;switch(n){case"talented":i=75+Math.floor(Math.random()*20),a=40+Math.floor(Math.random()*30),l=60+Math.floor(Math.random()*30);break;case"beautiful":i=50+Math.floor(Math.random()*30),a=80+Math.floor(Math.random()*20),l=50+Math.floor(Math.random()*30);break;case"wise":i=60+Math.floor(Math.random()*25),a=55+Math.floor(Math.random()*30),l=80+Math.floor(Math.random()*20);break;case"buddha":i=90+Math.floor(Math.random()*10),a=30+Math.floor(Math.random()*30),l=80+Math.floor(Math.random()*20),d="";break;default:i=40+Math.floor(Math.random()*50),a=50+Math.floor(Math.random()*40),l=40+Math.floor(Math.random()*40)}const p=Io(i),f={weapon:null,armor:null,accessory:null},c=Eo("",i,p.type,f),u=500+Math.floor(Math.random()*1500),x=Xx(u).name,S=n==="buddha"?{base:0,skinColor:2,hair:-1,hairColor:null,eye:0,eyeColor:0,mouth:1}:{base:Math.floor(Math.random()*3),skinColor:Math.floor(Math.random()*5),eye:Math.floor(Math.random()*3),eyeColor:Math.floor(Math.random()*5),mouth:Math.floor(Math.random()*3),hair:Math.floor(Math.random()*3),hairColor:Math.floor(Math.random()*5)},w=n==="buddha"?"":s;return{id:Date.now()+Math.random().toString().slice(2,8),name:o,gender:w,identity:d,aptitude:i,looks:a,intelligence:l,spiritRoot:p,cultivationMethod:"basic_breath",equipment:f,combatStats:c,cultivation:u,tierTitle:x,isTested:!0,isAdult:!0,avatar:S,stats:{aptitude:i,looks:a,intelligence:l},relationship:n==="buddha"?{stage:1,affection:0,trust:0}:void 0,likes:n==="buddha"?[""]:void 0,isSpouse:!0,archetype:n}},ym=(e,t)=>[vl(e,t,"talented"),vl(e,t,"beautiful"),vl(e,t,"wise")],z2=(e,t)=>vl(e,t,"random"),D2=e=>{const t=bn(e.tier),n=sf(e.tier);if(!n)return{success:!1,msg:""};const s=t.chance,o=(e.breakthroughBonus||0)/100,i=Math.min(.95,s+o);if(Math.random()<i)return{success:!0,newTier:n.name,newMaxExp:n.maxExp,baseChance:s,finalChance:i,resetFailCount:!0,msg:`${n.name}()`};{const d=Math.floor(t.maxExp*.2);return{success:!1,penalty:d,baseChance:s,finalChance:i,addFailBonus:!0,msg:` ${d} 5%`}}},bm=(e,t)=>{let n=0,s=[];return e.forEach(o=>{var f,c;const i=t.find(u=>u.id===o.managerId);if(!i){s.push(` ${o.name}`);return}const a=Math.floor(o.baseIncome*(1+i.stats.intelligence/100)),l=((c=(f=i.trait)==null?void 0:f.bonuses)==null?void 0:c.businessBonus)||0,d=QS(i.constitution),p=Math.floor(a*(1+l+d));n+=p}),{income:n,logs:s}};function F2(){const e=y.useMemo(()=>qx.map(E=>{var v;const I=(v=E.stats)==null?void 0:v.aptitude;return typeof I=="number"?{...E,spiritRoot:Io(I)}:E}),[]),[t,n]=y.useState(e),[s,o]=y.useState([]),[i,a]=y.useState(null),[l,d]=y.useState(null),p=y.useMemo(()=>t.filter(E=>{var I;return!((I=E.relationship)!=null&&I.cutTies)}),[t]),f=y.useCallback((E,I)=>{n(v=>v.map(k=>k.id===E?{...k,relationship:{...k.relationship,...I}}:k))},[]),c=y.useCallback((E,I)=>{n(v=>v.map(k=>k.id===E?{...k,...I}:k))},[]),u=y.useCallback(E=>{n(I=>[...I,E])},[]),x=y.useCallback(E=>{n(I=>{const v=I.find(k=>k.id===E);return v&&o(k=>[...k,v]),I.filter(k=>k.id!==E)})},[]),S=y.useCallback(E=>{n(I=>I.map(v=>v.id===E?{...v,isFollowed:!v.isFollowed}:v))},[]),w=y.useCallback(E=>{n(I=>I.map(E))},[]),C=y.useCallback(E=>{n(E)},[]),h=y.useCallback(E=>{n(I=>I.map(v=>E.get(v.id)||v))},[]),g=y.useCallback(E=>{const I=t.find(v=>v.id===E);I&&(o(v=>[...v,I]),n(v=>v.filter(k=>k.id!==E)))},[t]),b=y.useCallback(E=>{n(I=>I.map(v=>v.id===E?{...v,relationship:{...v.relationship||{},affection:0,trust:0,cutTies:!0}}:v))},[]);return{activeNpcs:t,deadNpcs:s,selectedNpc:i,selectedWorldNpc:l,visibleNpcs:p,setActiveNpcs:n,setDeadNpcs:o,setSelectedNpc:a,setSelectedWorldNpc:d,updateNpcRelationship:f,updateNpc:c,addNpc:u,removeNpc:x,toggleNpcFollow:S,batchUpdateNpcs:w,replaceAllNpcs:C,batchUpdateNpcsByMap:h,killNpc:g,cutTiesWithNpc:b}}function H2(){const[e,t]=y.useState([]),[n,s]=y.useState([]),[o,i]=y.useState(null),a=y.useCallback(h=>h?{...h,influenceProfile:Vx(h)}:null,[]),l=y.useMemo(()=>e.map(a),[e,a]),d=y.useCallback(h=>{const g=((h==null?void 0:h.exiledChildren)||[]).map(b=>b.id);return l.filter(b=>!g.includes(b.id))},[l]),p=y.useCallback(h=>{i(typeof h=="function"?g=>a(h(g)):a(h))},[a]),f=y.useCallback((h,g)=>{t(b=>b.map(E=>E.id===h?{...E,...g}:E)),i(b=>!b||b.id!==h?b:a({...b,...g}))},[a]),c=y.useCallback(h=>{t(g=>[...g,h])},[]),u=y.useCallback(h=>{t(g=>{const b=g.find(E=>E.id===h);return b&&s(E=>[...E,b]),g.filter(E=>E.id!==h)})},[]),x=y.useCallback(h=>{t(g=>g.map(b=>b.id===h?{...b,isFavorite:!b.isFavorite}:b)),i(g=>{if(!g||g.id!==h)return g;const b={...g,isFavorite:!g.isFavorite};return a(b)})},[a]),S=y.useCallback(h=>{t(g=>g.map(h).filter(b=>b!==null))},[]),w=y.useCallback(h=>{t(h)},[]),C=y.useCallback((h,g)=>{t(b=>b.map(E=>h(E)?g(E):E))},[]);return{children:e,fallenChildren:n,selectedChild:o,enhancedChildren:l,setChildren:t,setFallenChildren:s,setSelectedChild:p,enhanceChild:a,visibleChildren:d,updateChild:f,addChild:c,removeChild:u,toggleChildFavorite:x,batchUpdateChildren:S,replaceAllChildren:w,batchUpdateChildrenIf:C}}const W2=[{base:"#FFDFC4",shadow:"#F0D5B1"},{base:"#F0D5B1",shadow:"#E0B87E"},{base:"#E0B87E",shadow:"#C59D74"},{base:"#A16E4B",shadow:"#815336"}],qu=["#2C2C2C","#5C3A21","#A88B45","#8D2323","#F2F2F2"],U2=["#333333","#4A90E2","#50E3C2","#F5A623","#D0021B"],G2=[{skinPixels:[[4,2],[5,2],[6,2],[7,2],[8,2],[9,2],[10,2],[11,2],[3,3],[4,3],[5,3],[6,3],[7,3],[8,3],[9,3],[10,3],[11,3],[12,3],[3,4],[4,4],[5,4],[6,4],[7,4],[8,4],[9,4],[10,4],[11,4],[12,4],[3,5],[4,5],[5,5],[6,5],[7,5],[8,5],[9,5],[10,5],[11,5],[12,5],[3,6],[4,6],[5,6],[6,6],[7,6],[8,6],[9,6],[10,6],[11,6],[12,6],[3,7],[4,7],[5,7],[6,7],[7,7],[8,7],[9,7],[10,7],[11,7],[12,7],[3,8],[4,8],[5,8],[6,8],[7,8],[8,8],[9,8],[10,8],[11,8],[12,8],[3,9],[4,9],[5,9],[6,9],[7,9],[8,9],[9,9],[10,9],[11,9],[12,9],[4,10],[5,10],[6,10],[7,10],[8,10],[9,10],[10,10],[11,10],[5,11],[6,11],[7,11],[8,11],[9,11],[10,11],[6,12],[7,12],[8,12],[9,12]],shadowPixels:[[3,4],[3,5],[3,6],[3,7],[3,8],[3,9],[12,4],[12,5],[12,6],[12,7],[12,8],[12,9],[4,10],[11,10],[5,11],[10,11],[6,12],[9,12],[7,9],[8,9]]}],V2=[{whitePixels:[[5,7],[6,7],[9,7],[10,7]],pupilPixels:[[6,7],[9,7]],browPixels:[[5,6],[6,6],[9,6],[10,6]]},{whitePixels:[[4,7],[5,7],[6,7],[9,7],[10,7],[11,7]],pupilPixels:[[5,7],[10,7]],browPixels:[[4,6],[5,6],[10,6],[11,6]]},{whitePixels:[[5,7],[6,7],[5,8],[9,7],[10,7],[10,8]],pupilPixels:[[6,7],[6,8],[9,7],[9,8]],browPixels:[[5,6],[6,6],[9,6],[10,6]]}],Y2=[[[6,11],[9,11],[7,12],[8,12]],[[6,11],[7,11],[8,11],[9,11]],[[7,11],[8,11],[9,11],[10,10]]],q2=[[[6,0],[7,0],[8,0],[9,0],[5,1],[6,1],[7,1],[8,1],[9,1],[10,1],[4,2],[5,2],[6,2],[7,2],[8,2],[9,2],[10,2],[11,2],[3,3],[4,3],[11,3],[12,3],[3,4],[12,4],[2,5],[3,5],[12,5],[13,5],[2,6],[13,6],[2,7],[13,7],[1,8],[2,8],[13,8],[14,8],[7,3],[8,3],[7,4],[8,4]],[[5,1],[6,1],[7,1],[8,1],[9,1],[10,1],[4,2],[5,2],[6,2],[7,2],[8,2],[9,2],[10,2],[11,2],[3,3],[4,3],[5,3],[6,3],[7,3],[8,3],[9,3],[10,3],[11,3],[12,3],[2,4],[3,4],[4,4],[11,4],[12,4],[13,4],[2,5],[3,5],[12,5],[13,5],[1,6],[2,6],[3,6],[12,6],[13,6],[14,6],[1,7],[2,7],[13,7],[14,7],[1,8],[2,8],[13,8],[14,8],[2,9],[3,9],[12,9],[13,9],[2,10],[3,10],[12,10],[13,10]],[[6,0],[7,0],[8,0],[9,0],[5,1],[6,1],[9,1],[10,1],[6,2],[7,2],[8,2],[9,2],[5,3],[6,3],[7,3],[8,3],[9,3],[10,3],[4,4],[5,4],[10,4],[11,4],[4,5],[5,5],[10,5],[11,5],[3,6],[4,6],[11,6],[12,6],[7,1],[8,1]]],K2={},Ka="./",Q2=-.04,J2=0,X2=e=>typeof e=="string"&&e.startsWith("#")?e:typeof e=="number"?qu[e]||qu[0]:"#2C2C2C",Z2=e=>{const t=e.replace("#",""),n=parseInt(t.substring(0,2),16)/255,s=parseInt(t.substring(2,4),16)/255,o=parseInt(t.substring(4,6),16)/255,i=Math.max(n,s,o),a=Math.min(n,s,o);let l=0,d=0,p=(i+a)/2;if(i!==a){const f=i-a;switch(d=p>.5?f/(2-i-a):f/(i+a),i){case n:l=(s-o)/f+(s<o?6:0);break;case s:l=(o-n)/f+2;break;case o:l=(n-s)/f+4;break}l/=6}return d=Math.max(0,Math.min(1,d*.9)),p=Math.max(0,Math.min(1,p*1.05)),`hsl(${Math.round(l*360)} ${Math.round(d*100)}% ${Math.round(p*100)}%)`},ew=e=>new Promise((t,n)=>{if(!e){n(new Error("Missing asset source"));return}const s=new Image;s.crossOrigin="anonymous",s.onload=()=>t(s),s.onerror=o=>n(o),s.src=e}),tw=(e,t,n)=>{const s=Math.min(t/e.width,n/e.height);let o=e.width*s,i=e.height*s,a=(t-o)/2,l=(n-i)/2;return o=Math.round(o),i=Math.round(i),a=Math.round(a),l=Math.round(l),{offsetX:a,offsetY:l,drawWidth:o,drawHeight:i}},nw=(e,t,n,s)=>{const o=e.canvas.width,i=e.canvas.height,a=document.createElement("canvas");a.width=o,a.height=i;const l=a.getContext("2d");l.imageSmoothingEnabled=!0,l.imageSmoothingQuality="high",l.drawImage(t,n.offsetX,n.offsetY,n.drawWidth,n.drawHeight);const d=document.createElement("canvas");d.width=o,d.height=i;const p=d.getContext("2d");p.imageSmoothingEnabled=!0,p.imageSmoothingQuality="high",p.fillStyle=Z2(s),p.fillRect(n.offsetX,n.offsetY,n.drawWidth,n.drawHeight),p.globalCompositeOperation="destination-in",p.drawImage(a,0,0),e.drawImage(a,0,0),e.globalCompositeOperation="multiply",e.drawImage(d,0,0),e.globalCompositeOperation="source-over"},Cr=({dna:e,size:t=64,gender:n})=>{const s=y.useRef(null),o=e||{eye:0,mouth:0,hair:0,hairColor:0},i=o.hair??o.hairId??0,a=o.tZoneId??o.eye??0,l=o.mouth??o.mouthId??0,d=n||o.gender,p=d==="female"||d===""||d==="F",f=X2(o.hairColor),c=typeof o.centerBiasX=="number"?o.centerBiasX:Q2*t,u=typeof o.centerBiasY=="number"?o.centerBiasY:J2*t,x={width:t,height:t,borderRadius:"8px",border:"3px solid #3e2723",background:"#8d6e63",position:"relative",overflow:"hidden",boxSizing:"border-box"},S={width:"100%",height:"100%",display:"block"},w=(h,g)=>{if(h==="base")return`${Ka}assets/male/base_face.png`;if(g==null||g<0)return null;const b=String((g||0)+1).padStart(2,"0");return`${Ka}assets/male/${h}/${h}_${b}.png`},C=(h,g)=>{if(h==="base")return`${Ka}assets/female/base_face.png`;if(g==null||g<0)return null;const b=String((g||0)+1).padStart(2,"0");return`${Ka}assets/female/${h}/${h}${b}.png`};return y.useEffect(()=>{let h=!1;const g=s.current;if(!g)return()=>{h=!0};const b=g.getContext("2d");if(!b)return()=>{h=!0};const E=Math.round(t),I=typeof window<"u"&&window.devicePixelRatio?window.devicePixelRatio:1,v=Math.max(1,Math.round(E*I)),k=Math.round(c*I),T=Math.round(u*I);g.width=v,g.height=v,g.style.width=`${E}px`,g.style.height=`${E}px`,b.imageSmoothingEnabled=!0,b.imageSmoothingQuality="high",b.clearRect(0,0,g.width,g.height);const A=C("hair",i),R=w("hair",i),$=p?[{src:C("base")},{src:C("tzone",a)},{src:C("mouth",l)},A?{src:A,tint:f}:null].filter(Boolean):[{src:w("base")},{src:w("tzone",a)},{src:w("mouth",l)},R?{src:R,tint:f}:null].filter(Boolean);return(async()=>{for(const Q of $)try{const L=await ew(Q.src);if(h)return;const G=tw(L,g.width,g.height);G.offsetX+=k,G.offsetY+=T,Q.tint?nw(b,L,G,Q.tint):b.drawImage(L,G.offsetX,G.offsetY,G.drawWidth,G.drawHeight)}catch(L){console.warn("Avatar asset failed to load:",Q.src,L)}})(),()=>{h=!0}},[t,p,i,l,a,f,c,u]),r.jsx("div",{style:x,children:r.jsx("canvas",{ref:s,style:S})})},rw=({player:e,isAuto:t,onBreakthrough:n,auctionBanner:s})=>{const[o,i]=y.useState(!1),a=Math.floor(e.currentExp||0),l=Math.max(1,Math.floor(e.maxExp||1)),d=a/l,p=Math.min(100,Math.round(d*100)),f=a>=l,c=(e==null?void 0:e.avatar)||{base:0,skinColor:0,hair:0,hairColor:0,eye:0,eyeColor:1,mouth:0};return r.jsxs("div",{style:Ft.container,children:[r.jsxs("div",{style:Ft.left,children:[r.jsx("div",{style:Ft.avatarColumn,children:r.jsx("div",{style:{...Ft.avatar,border:t?"2px solid #76ff03":"none",animation:t?"pulse 1.5s infinite":"none"},children:t?r.jsx("div",{style:{fontSize:"24px"},children:""}):r.jsx(Cr,{dna:c,gender:e.gender,size:44})})}),r.jsxs("div",{style:Ft.info,children:[r.jsx("div",{style:Ft.name,children:e.name}),r.jsx("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:r.jsxs("div",{style:Ft.tier,children:[e.tier,t&&r.jsx("span",{style:Ft.meditateStatus,children:" "})]})})]})]}),r.jsx("div",{style:Ft.expBarContainer,children:r.jsxs("div",{style:Ft.expBarWrapper,children:[r.jsx("div",{style:{...Ft.expBarFill,width:`${p}%`,background:f?"linear-gradient(90deg, #FFD700, #FFA500)":"linear-gradient(90deg, #4CAF50, #81C784)"}}),r.jsxs("div",{style:Ft.expText,children:[a,"/",l]})]})}),r.jsx("div",{style:{flex:1}}),r.jsx("div",{style:Ft.right,children:r.jsxs("div",{style:Ft.statusColumn,children:[r.jsx("div",{style:Ft.timeIcon,children:""}),r.jsxs("div",{style:Ft.timeValue,children:[" ",e.time.year," ",e.time.month,""]})]})}),s&&r.jsx("div",{style:Ft.auctionBanner,className:"auction-alert-chip",children:s.message})]})},Ft={container:{height:"calc(60px + env(safe-area-inset-top, 0px))",paddingTop:"env(safe-area-inset-top, 0px)",background:"linear-gradient(135deg, #3e2723 0%, #2c1810 100%)",color:"#fff",display:"flex",alignItems:"center",justifyContent:"space-between",padding:"0 10px",position:"relative",boxShadow:"0 4px 15px rgba(0,0,0,0.3)",borderRadius:"0 0 16px 16px",paddingBottom:"12px"},left:{display:"flex",alignItems:"center",gap:"12px"},avatarColumn:{display:"flex",flexDirection:"column",alignItems:"center",gap:"4px"},avatar:{width:"44px",height:"44px",borderRadius:"50%",background:"linear-gradient(135deg, #a1887f 0%, #8d6e63 100%)",display:"flex",alignItems:"center",justifyContent:"center",overflow:"hidden",imageRendering:"pixelated",boxShadow:"0 2px 8px rgba(0,0,0,0.2)"},info:{display:"flex",flexDirection:"column",justifyContent:"center"},name:{fontSize:"15px",fontWeight:"bold",textShadow:"1px 1px 2px rgba(0,0,0,0.3)"},tier:{fontSize:"12px",color:"#ffecb3",textShadow:"1px 1px 2px rgba(0,0,0,0.3)"},meditateStatus:{color:"#76ff03",marginLeft:"5px",fontSize:"10px"},right:{display:"flex",gap:"8px",alignItems:"center",flexShrink:0},timeIcon:{fontSize:"16px"},timeValue:{fontSize:"13px",fontWeight:"bold",color:"#fff"},expBarContainer:{flex:1,maxWidth:"300px",marginLeft:"20px",marginRight:"20px"},expBarWrapper:{position:"relative",height:"24px",backgroundColor:"rgba(0,0,0,0.3)",borderRadius:"12px",overflow:"hidden",border:"1px solid rgba(255,255,255,0.1)"},expBarFill:{position:"absolute",left:0,top:0,height:"100%",transition:"width 0.3s ease",borderRadius:"12px"},expText:{position:"absolute",left:"50%",top:"50%",transform:"translate(-50%, -50%)",fontSize:"11px",fontWeight:"bold",color:"#fff",textShadow:"1px 1px 2px rgba(0,0,0,0.5)",zIndex:1},statusColumn:{display:"flex",flexDirection:"column",alignItems:"center",gap:"2px",backgroundColor:"rgba(255,255,255,0.06)",padding:"4px 8px",borderRadius:"12px"},auctionBanner:{position:"absolute",left:"50%",bottom:"-14px",transform:"translateX(-50%)",background:"rgba(255, 255, 255, 0.16)",padding:"4px 16px",borderRadius:"20px",color:"#ff5252",fontWeight:"bold",fontSize:"12px",letterSpacing:"0.5px",boxShadow:"0 6px 18px rgba(0,0,0,0.35)",animation:"auctionFlash 0.8s ease-in-out 3"}},sw=()=>{if(typeof document>"u"||document.getElementById("top-status-animations"))return;const e=document.createElement("style");e.id="top-status-animations",e.innerHTML=`
    @keyframes pulse {
      0% { transform: scale(1); box-shadow: 0 0 0 0 rgba(118, 255, 3, 0.4); }
      70% { transform: scale(1.05); box-shadow: 0 0 0 8px rgba(118, 255, 3, 0); }
      100% { transform: scale(1); box-shadow: 0 0 0 0 rgba(118, 255, 3, 0); }
    }
    @keyframes auctionFlash {
      0% { opacity: 0; transform: translate(-50%, 8px) scale(0.95); }
      30% { opacity: 1; transform: translate(-50%, 0) scale(1); }
      70% { opacity: 1; }
      100% { opacity: 0; transform: translate(-50%, -6px) scale(0.96); }
    }
  `,document.head.appendChild(e)};typeof window<"u"&&typeof document<"u"&&sw();const ow=({activeTab:e,onTabChange:t})=>{const n=[{id:"FAMILY",label:"",icon:""},{id:"NPC",label:"",icon:""},{id:"ACTION",label:"",icon:""},{id:"REVENGE",label:"",icon:""},{id:"PLAYER",label:"",icon:""},{id:"SYSTEM",label:"",icon:""},{id:"LOG",label:"",icon:""}];return r.jsx("div",{style:Qa.container,children:n.map(s=>r.jsxs("button",{onClick:()=>t(s.id),style:{...Qa.btn,backgroundColor:e===s.id?"rgba(255,193,7,0.2)":"transparent",fontWeight:e===s.id?"bold":"normal"},children:[r.jsx("div",{style:Qa.icon,children:s.icon}),r.jsx("div",{style:Qa.label,children:s.label})]},s.id))})},Qa={container:{height:ye.sizes.navHeight,background:ye.gradients.warm,borderTop:`2px solid ${ye.colors.border}`,display:"flex",justifyContent:"space-around",alignItems:"center",position:"fixed",bottom:0,left:0,right:0,zIndex:100,boxShadow:`0 -6px 18px ${ye.colors.shadow}`,borderRadius:"16px 16px 0 0"},btn:{background:"none",border:"none",display:"flex",flexDirection:"column",alignItems:"center",cursor:"pointer",padding:"6px 3px",borderRadius:"10px",transition:"all 0.2s ease"},icon:{fontSize:"16px",marginBottom:"2px",color:ye.colors.ink},label:{fontSize:"10px",color:ye.colors.muted,fontFamily:"Microsoft YaHei, SimSun, serif"}},iw=e=>Math.max(0,Math.min(100,Number(e)||0)),vm=({npc:e,onInteract:t,actions:n})=>{var l;const s=((l=e.relationship)==null?void 0:l.affection)??0,o=iw(s),a=(()=>{const d=o;return d>=80?"#b03a3a":d>=40?ye.colors.accent:ye.colors.muted})();return r.jsxs("div",{style:Ht.card,children:[t&&r.jsx("button",{onClick:()=>t(e.id,"TOGGLE_FOLLOW"),style:{...Ht.followBtn,background:e.isFollowed?"#ffd54f":Ht.followBtn.background},title:e.isFollowed?"":"",children:e.isFollowed?"":""}),r.jsxs("div",{style:Ht.header,children:[r.jsx(Cr,{dna:e.avatar,gender:e.gender,size:60}),r.jsxs("div",{style:{flex:1},children:[r.jsxs("h3",{style:{margin:0},children:[e.name,r.jsx("span",{style:Ht.tag,children:e.identity})]}),r.jsx("small",{style:{color:ye.colors.muted},children:e.cultivation}),e.sect&&e.sectStatus!=="mysterious"&&e.sectStatus!=="rogue"&&r.jsx("div",{style:{marginTop:"2px"},children:r.jsx("span",{style:{fontSize:"9px",padding:"2px 6px",borderRadius:"8px",color:"white",background:e.sectStatus==="defected"?"#a65a5a":e.sectStatus==="hidden"?ye.colors.primary:e.sect.level==="TOP"?"#c9a84a":e.sect.level==="HIGH"?ye.colors.accent:e.sect.level==="RECKLESS"?"#a65a5a":ye.colors.muted,fontWeight:"bold"},children:e.sect.name})}),e.sectStatus==="mysterious"&&r.jsx("div",{style:{marginTop:"2px"},children:r.jsx("span",{style:{fontSize:"9px",padding:"2px 6px",borderRadius:"8px",color:"white",background:ye.colors.muted,fontWeight:"bold"},children:""})}),e.sectStatus==="rogue"&&r.jsx("div",{style:{marginTop:"2px"},children:r.jsx("span",{style:{fontSize:"9px",padding:"2px 6px",borderRadius:"8px",color:"white",background:ye.colors.primary,fontWeight:"bold"},children:""})})]})]}),r.jsxs("p",{style:Ht.desc,children:["",e.desc,""]}),r.jsxs("div",{style:Ht.statRow,children:[r.jsx("span",{children:":"}),r.jsx("div",{style:Ht.progressBar,children:r.jsx("div",{style:{...Ht.progressFill,width:`${o}%`,backgroundColor:a}})}),r.jsxs("span",{style:{color:a},children:[" ",o]})]}),n?r.jsx("div",{style:Ht.actions,children:n}):t?r.jsxs("div",{style:Ht.actions,children:[r.jsx("button",{onClick:()=>t(e.id,"DETAIL"),style:Ht.btn,children:" "}),r.jsx("button",{onClick:()=>t(e.id,"CHAT"),style:Ht.btn,children:" "}),r.jsx("button",{onClick:()=>t(e.id,"GIFT"),style:Ht.btn,children:" "}),r.jsx("button",{onClick:()=>t(e.id,"SPAR"),disabled:s<0,style:{...Ht.btn,opacity:s<0?.5:1,backgroundColor:ye.colors.primary,color:"white"},title:"",children:" "}),!e.isChild&&r.jsx("button",{onClick:()=>t(e.id,"DUAL_CULTIVATION"),style:{...Ht.btn,opacity:s<80?.5:1,backgroundColor:ye.colors.accent,color:"white"},title:"80+",children:" "}),!e.isChild&&r.jsx("button",{onClick:()=>t(e.id,"PROPOSE"),disabled:s<80,style:{...Ht.btn,opacity:s<80?.5:1,backgroundColor:ye.colors.primary,color:"white",cursor:s<80?"not-allowed":"pointer"},title:"80+",children:" "})]}):null]})},Ht={card:{border:`1px solid ${ye.colors.border}`,borderRadius:"8px",padding:"15px",backgroundColor:ye.colors.paper,boxShadow:`0 2px 6px ${ye.colors.shadow}`,marginBottom:"10px",position:"relative"},header:{display:"flex",gap:"10px",alignItems:"center",marginBottom:"10px"},tag:{fontSize:"12px",background:ye.colors.parchment,padding:"2px 6px",borderRadius:"4px",color:ye.colors.ink},desc:{fontStyle:"italic",color:ye.colors.ink,fontSize:"14px",margin:"5px 0 15px 0"},statRow:{display:"flex",alignItems:"center",gap:"10px",marginBottom:"15px",fontSize:"14px"},progressBar:{flex:1,height:"10px",background:ye.colors.parchment,borderRadius:"5px",overflow:"hidden"},progressFill:{height:"100%",transition:"width 0.3s ease"},actions:{display:"grid",gridTemplateColumns:"1fr 1fr 1fr",gap:"8px"},btn:{padding:"8px",border:`1px solid ${ye.colors.border}`,borderRadius:"4px",background:ye.colors.parchment,cursor:"pointer",fontSize:"12px",color:ye.colors.ink},followBtn:{position:"absolute",top:8,right:8,padding:"6px 8px",borderRadius:"6px",border:`1px solid ${ye.colors.border}`,background:ye.colors.parchment,cursor:"pointer",fontSize:"13px",lineHeight:"1"}},aw=[{id:"meet_normal_1",stage:0,text:"{name} ",options:[{label:"",result:"neutral",msg:"(+5)",change:{affection:5}},{label:"",result:"neutral",msg:"",change:{}}]},{id:"meet_normal_2",stage:0,text:"{name} ",options:[{label:"",check:e=>e.stats.intelligence>60,success:{msg:"(+8)",change:{affection:8}},fail:{msg:"(+2)",change:{affection:2}}},{label:"",result:"neutral",msg:"",change:{}}]},{id:"meet_normal_3",stage:0,text:"{name} ",options:[{label:"",check:e=>e.combatStats.atk>50,success:{msg:"(+10)",change:{affection:10}},fail:{msg:"(+3)",change:{affection:3}}},{label:"",result:"neutral",msg:"",change:{}}]},{id:"meet_normal_4",stage:0,text:"{name} ",options:[{label:"",result:"neutral",msg:"(+6)",change:{affection:6}},{label:"",result:"neutral",msg:"",change:{}}]},{id:"meet_normal_5",stage:0,text:"{name} ",options:[{label:"",result:"neutral",msg:"(+7)",change:{affection:7}},{label:"",result:"neutral",msg:"",change:{}}]},{id:"meet_normal_6",stage:0,text:"{name} ",options:[{label:"",result:"neutral",msg:"(+4)",change:{affection:4}},{label:"",result:"neutral",msg:"",change:{}}]},{id:"meet_cold_1",stage:0,reqTrait:"",text:"{name} ",options:[{label:"",result:"neutral",msg:"(+1)",change:{affection:1}},{label:"",result:"neutral",msg:"",change:{}}]},{id:"meet_cold_2",stage:0,reqTrait:"",text:"{name} ",options:[{label:"",check:e=>e.stats.luck>50,success:{msg:"(+5)",change:{affection:5}},fail:{msg:"",change:{}}},{label:"",result:"neutral",msg:"",change:{}}]},{id:"meet_cold_3",stage:0,reqTrait:"",text:"{name} ",options:[{label:"",result:"neutral",msg:"(+3)",change:{affection:3}},{label:"",result:"neutral",msg:"",change:{}}]},{id:"meet_cold_4",stage:0,reqTrait:"",text:"{name} ",options:[{label:"",result:"neutral",msg:"(+2)",change:{affection:2}},{label:"",result:"neutral",msg:"",change:{}}]},{id:"meet_cold_5",stage:0,reqTrait:"",text:"{name} ",options:[{label:"",check:e=>e.combatStats.atk>60,success:{msg:"(+7)",change:{affection:7}},fail:{msg:"(+1)",change:{affection:1}}},{label:"",result:"neutral",msg:"",change:{}}]},{id:"meet_cold_6",stage:0,reqTrait:"",text:"{name} ",options:[{label:"",check:e=>e.stats.intelligence>70,success:{msg:"(+8)",change:{affection:8}},fail:{msg:"(+0)",change:{affection:0}}},{label:"",result:"neutral",msg:"",change:{}}]},{id:"meet_gentle_1",stage:0,reqTrait:"",text:"{name} ",options:[{label:"",result:"neutral",msg:"(+7)",change:{affection:7}},{label:"",result:"neutral",msg:"(+3)",change:{affection:3}}]},{id:"meet_gentle_2",stage:0,reqTrait:"",text:"{name} ",options:[{label:"",result:"neutral",msg:"(+6)",change:{affection:6}},{label:"",result:"neutral",msg:"",change:{}}]},{id:"meet_gentle_3",stage:0,reqTrait:"",text:"{name} ",options:[{label:"",result:"neutral",msg:"(+9)",change:{affection:9}},{label:"",result:"neutral",msg:"(+2)",change:{affection:2}}]},{id:"meet_gentle_4",stage:0,reqTrait:"",text:"{name} ",options:[{label:"",result:"neutral",msg:"(+5)",change:{affection:5}},{label:"",result:"neutral",msg:"",change:{}}]},{id:"meet_gentle_5",stage:0,reqTrait:"",text:"{name} ",options:[{label:"",result:"neutral",msg:"(+8)",change:{affection:8}},{label:"",result:"neutral",msg:"",change:{}}]},{id:"meet_gentle_6",stage:0,reqTrait:"",text:"{name} ",options:[{label:"",result:"neutral",msg:"(+6)",change:{affection:6}},{label:"",result:"neutral",msg:"(+3)",change:{affection:3}}]},{id:"phase1_normal_1",stage:1,text:"{name} ",options:[{label:"",result:"good",msg:"(+10+5)",change:{affection:10,trust:5}},{label:"",result:"neutral",msg:"(+2)",change:{affection:2}}]},{id:"phase1_normal_2",stage:1,text:"{name} ",options:[{label:"",check:e=>e.stats.intelligence>65,success:{msg:"(+8+8)",change:{affection:8,trust:8}},fail:{msg:"(+4+3)",change:{affection:4,trust:3}}},{label:"",result:"neutral",msg:"(+1)",change:{affection:1}}]},{id:"phase1_normal_3",stage:1,text:"{name} ",options:[{label:"",result:"good",msg:"(+12+10)",change:{affection:12,trust:10}},{label:"",result:"neutral",msg:"(-1)",change:{affection:-1}}]},{id:"phase1_normal_4",stage:1,text:"{name} ",options:[{label:"",result:"good",msg:"(+7+4)",change:{affection:7,trust:4}},{label:"",result:"neutral",msg:"(+1)",change:{affection:1}}]},{id:"phase1_normal_5",stage:1,text:"{name} ",options:[{label:"",check:e=>e.combatStats.atk>70,success:{msg:"(+15+12)",change:{affection:15,trust:12}},fail:{msg:"(+8+6)",change:{affection:8,trust:6}}},{label:"",result:"bad",msg:"(-2)",change:{affection:-2}}]},{id:"phase1_normal_6",stage:1,text:"{name} ",options:[{label:"",result:"good",msg:"(+9+7)",change:{affection:9,trust:7}},{label:"",result:"neutral",msg:"(+0)",change:{affection:0}}]},{id:"phase1_tsundere_1",stage:1,reqTrait:"",text:'{name} ""',options:[{label:"",result:"good",msg:"(+10+5)",change:{affection:10,trust:5}},{label:"",result:"neutral",msg:"(+8)",change:{affection:8}}]},{id:"phase1_tsundere_2",stage:1,reqTrait:"",text:"{name} ",options:[{label:"",result:"good",msg:"(+9+4)",change:{affection:9,trust:4}},{label:"",result:"neutral",msg:"(+5)",change:{affection:5}}]},{id:"phase1_tsundere_3",stage:1,reqTrait:"",text:"{name} ",options:[{label:"",result:"good",msg:"(+12+6)",change:{affection:12,trust:6}},{label:"",result:"neutral",msg:"(+7)",change:{affection:7}}]},{id:"phase1_tsundere_4",stage:1,reqTrait:"",text:"{name} ",options:[{label:"",result:"good",msg:"(+11+8)",change:{affection:11,trust:8}},{label:"",result:"neutral",msg:"(+6)",change:{affection:6}}]},{id:"phase1_tsundere_5",stage:1,reqTrait:"",text:"{name} ",options:[{label:"",check:e=>e.combatStats.atk>75,success:{msg:"(+15+10)",change:{affection:15,trust:10}},fail:{msg:"(+8+5)",change:{affection:8,trust:5}}},{label:"",result:"bad",msg:"(-3)",change:{affection:-3}}]},{id:"phase1_tsundere_6",stage:1,reqTrait:"",text:"{name} ",options:[{label:"",result:"good",msg:"(+10+7)",change:{affection:10,trust:7}},{label:"",result:"neutral",msg:"(+9)",change:{affection:9}}]},{id:"phase1_greedy_1",stage:1,reqTrait:"",text:"{name} ",options:[{label:"",result:"good",msg:"(+12+3)",change:{affection:12,trust:3}},{label:"",result:"neutral",msg:"(+2)",change:{affection:2}}]},{id:"phase1_greedy_2",stage:1,reqTrait:"",text:"{name} ",options:[{label:"",check:e=>e.resources.spiritStones>500,success:{msg:"(+15+5)",change:{affection:15,trust:5}},fail:{msg:"(+1)",change:{affection:1}}},{label:"",result:"neutral",msg:"(+0)",change:{affection:0}}]},{id:"phase1_greedy_3",stage:1,reqTrait:"",text:"{name} ",options:[{label:"",check:e=>e.resources.spiritStones>300,success:{msg:"(+10+8)",change:{affection:10,trust:8}},fail:{msg:"(+1)",change:{affection:1}}},{label:"",result:"bad",msg:"(-2)",change:{affection:-2}}]},{id:"phase1_greedy_4",stage:1,reqTrait:"",text:"{name} ",options:[{label:"",result:"good",msg:"(+12+6)",change:{affection:12,trust:6}},{label:"",result:"neutral",msg:"(+5)",change:{affection:5}}]},{id:"phase1_greedy_5",stage:1,reqTrait:"",text:"{name} ",options:[{label:"",result:"good",msg:"(+15+4)",change:{affection:15,trust:4}},{label:"",result:"neutral",msg:"(+2)",change:{affection:2}}]},{id:"phase1_greedy_6",stage:1,reqTrait:"",text:"{name} ",options:[{label:"",result:"good",msg:"(+10+5)",change:{affection:10,trust:5}},{label:"",result:"neutral",msg:"(+0)",change:{affection:0}}]},{id:"phase2_normal_1",stage:2,text:"{name} ",options:[{label:"",result:"good",msg:"(+15+10)",change:{affection:15,trust:10}},{label:"",result:"neutral",msg:"(+8)",change:{affection:8}}]},{id:"phase2_normal_2",stage:2,text:"{name} ",options:[{label:"",result:"good",msg:"(+20+15)",change:{affection:20,trust:15}},{label:"",result:"neutral",msg:"(+10+5)",change:{affection:10,trust:5}}]},{id:"phase2_normal_3",stage:2,text:"{name} ",options:[{label:"",result:"good",msg:"(+25+20)",change:{affection:25,trust:20}},{label:"",result:"neutral",msg:"(+10)",change:{affection:10}}]},{id:"phase2_normal_4",stage:2,text:"{name} ",options:[{label:"",result:"good",msg:"(+30+25)",change:{affection:30,trust:25}},{label:"",result:"neutral",msg:"(+15+10)",change:{affection:15,trust:10}}]},{id:"phase2_normal_5",stage:2,text:"{name} ",options:[{label:"",result:"good",msg:"(+20+15)",change:{affection:20,trust:15}},{label:"",result:"neutral",msg:"(+5)",change:{affection:5}}]},{id:"phase2_normal_6",stage:2,text:"{name} ",options:[{label:"",result:"good",msg:"(+18+12)",change:{affection:18,trust:12}},{label:"",result:"bad",msg:"(-5)",change:{affection:-5}}]},{id:"phase2_yandere_1",stage:2,reqTrait:"",text:'{name} ""',options:[{label:"",result:"good",msg:"(+20+15)",change:{affection:20,trust:15}},{label:"",result:"bad",msg:"(-10-5)",change:{affection:-10,trust:-5}}]},{id:"phase2_yandere_2",stage:2,reqTrait:"",text:'{name} ""',options:[{label:"",result:"good",msg:"(+25+20)",change:{affection:25,trust:20}},{label:"",result:"neutral",msg:"(+10+5)",change:{affection:10,trust:5}}]},{id:"phase2_yandere_3",stage:2,reqTrait:"",text:'{name} ""',options:[{label:"",result:"good",msg:"(+15+10)",change:{affection:15,trust:10}},{label:"",result:"bad",msg:"(-15-10)",change:{affection:-15,trust:-10}}]},{id:"phase2_yandere_4",stage:2,reqTrait:"",text:'{name} ""',options:[{label:"",result:"good",msg:"(+30+25)",change:{affection:30,trust:25}},{label:"",result:"bad",msg:"(-5+10)",change:{affection:-5,trust:10}}]},{id:"phase2_yandere_5",stage:2,reqTrait:"",text:"{name} ",options:[{label:"",result:"good",msg:"(+35+30)",change:{affection:35,trust:30}},{label:"",result:"neutral",msg:"(+10+5)",change:{affection:10,trust:5}}]},{id:"phase2_yandere_6",stage:2,reqTrait:"",text:'{name} ""',options:[{label:"",result:"good",msg:"(+25+20)",change:{affection:25,trust:20}},{label:"",result:"neutral",msg:"(+15+10)",change:{affection:15,trust:10}}]},{id:"phase2_justice_1",stage:2,reqTrait:"",text:"{name} ",options:[{label:"",result:"good",msg:"(+25+20)",change:{affection:25,trust:20}},{label:"",result:"neutral",msg:"(+15+15)",change:{affection:15,trust:15}}]},{id:"phase2_justice_2",stage:2,reqTrait:"",text:"{name} ",options:[{label:"",result:"good",msg:"(+30+25)",change:{affection:30,trust:25}},{label:"",result:"neutral",msg:"(+10+5)",change:{affection:10,trust:5}}]},{id:"phase2_justice_3",stage:2,reqTrait:"",text:"{name} ",options:[{label:"",result:"good",msg:"(+20+18)",change:{affection:20,trust:18}},{label:"",result:"neutral",msg:"(+12+10)",change:{affection:12,trust:10}}]},{id:"phase2_justice_4",stage:2,reqTrait:"",text:"{name} ",options:[{label:"",result:"good",msg:"(+22+20)",change:{affection:22,trust:20}},{label:"",result:"neutral",msg:"(+15+15)",change:{affection:15,trust:15}}]},{id:"phase2_justice_5",stage:2,reqTrait:"",text:"{name} ",options:[{label:"",result:"good",msg:"(+28+25)",change:{affection:28,trust:25}},{label:"",result:"neutral",msg:"(+10+8)",change:{affection:10,trust:8}}]},{id:"phase2_justice_6",stage:2,reqTrait:"",text:"{name} ",options:[{label:"",result:"good",msg:"(+30+30)",change:{affection:30,trust:30}},{label:"",result:"neutral",msg:"(+15+12)",change:{affection:15,trust:12}}]}],lw=(e,t)=>{const n=aw.filter(o=>{var l;let i=0;const a=((l=e.relationship)==null?void 0:l.affection)||0;return a>=20&&(i=1),a>=60&&(i=2),!(o.stage!==i||o.reqTrait&&!(typeof e.personality=="object"&&e.personality!==null&&"label"in e.personality?[e.personality.label]:Array.isArray(e.personality)?e.personality:[]).includes(o.reqTrait)||o.condition&&!o.condition(e))});if(n.length===0)return null;const s=n[Math.floor(Math.random()*n.length)];return{...s,text:s.text.replace(/{name}/g,e.name)}},cw={GRAY:{color:"#9e9e9e",bg:"#eeeeee",border:"#bdbdbd",label:""},WHITE:{color:"#616161",bg:"#f5f5f5",border:"#e0e0e0",label:""},GREEN:{color:"#2e7d32",bg:"#e8f5e9",border:"#a5d6a7",label:""},BLUE:{color:"#1565c0",bg:"#e3f2fd",border:"#90caf9",label:""},PURPLE:{color:"#7b1fa2",bg:"#f3e5f5",border:"#ce93d8",label:""},ORANGE:{color:"#ef6c00",bg:"#fff3e0",border:"#ffcc80",label:""},RED:{color:"#c62828",bg:"#ffebee",border:"#ef9a9a",label:"",shadow:"0 0 5px rgba(198, 40, 40, 0.5)"}},dw=[{min:0,max:20,text:"",rarity:"GRAY"},{min:21,max:40,text:"",rarity:"WHITE"},{min:41,max:60,text:"",rarity:"GREEN"},{min:61,max:79,text:"",rarity:"BLUE"},{min:80,max:89,text:"",rarity:"PURPLE"},{min:90,max:99,text:"",rarity:"ORANGE"},{min:100,max:999,text:"",rarity:"RED"}],uw=[{min:0,max:20,text:"",rarity:"GRAY"},{min:21,max:40,text:"",rarity:"WHITE"},{min:41,max:60,text:"",rarity:"GREEN"},{min:61,max:79,text:"",rarity:"BLUE"},{min:80,max:89,text:"",rarity:"PURPLE"},{min:90,max:99,text:"",rarity:"ORANGE"},{min:100,max:999,text:"",rarity:"RED"}],Xl=(e,t,n="")=>{let s=t==="INT"?uw:dw,o=s.find(a=>e>=a.min&&e<=a.max)||s[0],i=o.text;return t==="LOOKS"&&n===""&&(i===""&&(i=""),i===""&&(i="")),{text:i,rarity:o.rarity,value:e,style:cw[o.rarity]}},Zl=({trait:e,showValue:t=!1})=>{const{style:n,text:s,value:o}=e;return r.jsxs("div",{style:{display:"inline-flex",alignItems:"center",padding:"2px 8px",borderRadius:"12px",backgroundColor:n.bg,border:`1px solid ${n.border}`,color:n.color,fontSize:"12px",fontWeight:"bold",boxShadow:n.shadow||"none",marginRight:"5px"},children:[r.jsx("span",{children:s}),t&&r.jsx("span",{style:{marginLeft:"5px",fontSize:"10px",opacity:.7,borderLeft:`1px solid ${n.color}`,paddingLeft:"5px"},children:o})]})},pw=e=>{if(!e)return e;try{const t=new URL(e),n=t.pathname.replace(/\/+$|^\/+/g,"");return!n||n==="v1"?(t.pathname="/v1/chat/completions",t.toString()):n.includes("v1/chat")||n.includes("v1/completions")?t.toString():e}catch{return e}},jc=async(e,t,n,s={})=>{var d;if(!t)throw new Error(" API Key");if(!n)throw new Error(" API URL");const{model:o="deepseek-chat",temperature:i=.85,maxTokens:a=200}=s,l=pw(n);l!==n&&console.info(`[AI]  API URL : ${l}`);try{const p=await fetch(l,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${t}`},body:JSON.stringify({model:o,messages:e,temperature:i,max_tokens:a,stream:!1})});if(!p.ok){const c=await p.text().catch(()=>"");let u={};try{u=c?JSON.parse(c):{}}catch{u={raw:c}}const x=((d=u.error)==null?void 0:d.message)||u.message||u.raw||p.statusText;throw p.status===401?new Error("API  (401):  API Key Key"):p.status===404?new Error(`API  (404): Invalid URL (POST ${l}) API URL  https://api.gemai.cc/v1/chat/completions`):p.status===503?new Error(`API  (503): ${x||""}`):new Error(`API  (${p.status}): ${x}`)}const f=await p.json().catch(()=>null);if(!f||!f.choices||!f.choices[0]||!f.choices[0].message)throw new Error("API ");return f.choices[0].message.content}catch(p){throw console.error("AI :",p),p.message&&p.message.includes("Failed to fetch")?new Error(" API URL  CORS "):p}},fw=async(e,t)=>{try{return await jc([{role:"system",content:""},{role:"user",content:""}],e,t,{maxTokens:10}),!0}catch(n){return console.error("API :",n),!1}},xs={UNFORGETTABLE:"",PROFOUND:"",SIGNIFICANT:""},pn=e=>{var t;return e.memories||(e.memories={profile:{name:e.name,personality:((t=e.personality)==null?void 0:t.label)||"",identity:e.identity||"",firstMeet:new Date().toISOString()},milestones:[],recentEvents:[],longTermSummary:"",meta:{totalEvents:0,lastSummaryTime:null,needsSummary:!1}}),e},mo=(e,t)=>{pn(e);const n={id:Date.now(),event:t.event,time:t.time||hw(),detail:t.detail,emotionalImpact:t.emotionalImpact||xs.SIGNIFICANT,category:t.category||"other",tags:t.tags||[],createdAt:new Date().toISOString()};return e.memories.milestones.push(n),console.log(`[] ${e.name} : ${t.event}`),n},Ds=(e,t)=>{pn(e);const n={id:Date.now(),description:t.description,time:new Date().toISOString(),affectionChange:t.affectionChange||0,context:t.context||""};return e.memories.recentEvents.push(n),e.memories.meta.totalEvents++,e.memories.recentEvents.length>20&&e.memories.recentEvents.shift(),e.memories.meta.totalEvents%50===0&&(e.memories.meta.needsSummary=!0),n},Zx=(e,t={})=>{const{includeMilestones:n=!0,includeRecent:s=!0,maxRecent:o=5,contextKeywords:i=[]}=t;pn(e);let a="";if(n&&e.memories.milestones.length>0&&(a+=`


`,[...e.memories.milestones].sort((d,p)=>{const f={:4,:3,:2,:1};return(f[p.emotionalImpact]||0)-(f[d.emotionalImpact]||0)}).forEach((d,p)=>{a+=`${p+1}. **${d.event}**${d.time}
   ${d.detail}
   ${d.emotionalImpact}
`})),s&&e.memories.recentEvents.length>0&&(a+=`

`,e.memories.recentEvents.slice(-o).forEach(d=>{const p=xw(d.time);a+=`- ${p}: ${d.description}`,d.affectionChange!==0&&(a+=` (${d.affectionChange>0?"+":""}${d.affectionChange})`),a+=`
`})),i.length>0){const l=e.memories.milestones.filter(d=>i.some(p=>d.event.includes(p)||d.detail.includes(p)||d.tags.includes(p)));l.length>0&&(a+=`

`,l.forEach(d=>{a+=`${d.time}${d.event}...${d.detail}
`}))}return e.memories.longTermSummary&&(a+=`

${e.memories.longTermSummary}
`),a},mw=e=>{const t={family:["","","","","","","","","","",""],relationship:["","","","","","","",""],cultivation:["","","","","","",""],combat:["","","","","","",""],emotion:["","","","","","","",""]},n=[];for(const[s,o]of Object.entries(t))o.some(i=>e.includes(i))&&n.push(...o.filter(i=>e.includes(i)));return[...new Set(n)]},hw=()=>`5${["","","",""][Math.floor(Math.random()*4)]}`,gw=e=>new Date(e).toLocaleDateString("zh-CN",{year:"numeric",month:"long",day:"numeric"}),xw=e=>{const t=new Date,n=new Date(e),s=t-n,o=Math.floor(s/6e4),i=Math.floor(s/36e5),a=Math.floor(s/864e5);return o<1?"":o<60?`${o}`:i<24?`${i}`:a<7?`${a}`:gw(e)},Sm=(e,t,n={})=>{const{difficulty:s="",sacrifice:o=!1}=n;let i=`${t.name}`;return s===""?(i+="",o&&(i+="")):i+="",i+=`${o?"":""}`,mo(e,{event:"",detail:i,emotionalImpact:xs.UNFORGETTABLE,category:"family",tags:["","",t.name,o?"":""]})},yw=(e,t="")=>mo(e,{event:"",detail:`${t}`,emotionalImpact:xs.UNFORGETTABLE,category:"relationship",tags:["","","",""]}),bw=(e,t)=>mo(e,{event:"",detail:t,emotionalImpact:xs.UNFORGETTABLE,category:"combat",tags:["","",""]}),wm=(e,t,n={},s="")=>{var g,b,E,I,v,k,T;const o=((g=e.relationship)==null?void 0:g.affection)||0;let i="";o>=80?i="":o>=60?i="":o>=40?i="":o>=20&&(i="");const a=((b=e.relationship)==null?void 0:b.jealousy)||e.jealousy||0;let l="",d="";a>=81?(l="",d=""):a>=61?(l="",d=""):a>=41?(l="",d=""):a>=21&&(l="",d="");const p=((E=e.personality)==null?void 0:E.label)||"",f=((I=e.personality)==null?void 0:I.desc)||e.desc||"",c=e.identity||"",u=e.tierTitle||"";let x="";(((v=n.npcs)==null?void 0:v.some(A=>{var R;return A.id===e.id&&((R=A.relationship)==null?void 0:R.stage)>=3}))||o>=90)&&(x+=`
`);const w=((k=n.children)==null?void 0:k.filter(A=>A.parentId===e.id||A.fatherId===e.id||A.motherId===e.id||A.fatherName===e.name||A.motherName===e.name))||[];if(w.length>0){const A=w.map($=>`${$.name}${$.age}${$.tierTitle||""}`).join("");e.gender===""?x+=`
${w.length}${A}
${e.name}`:x+=`
${w.length}${A}
${t.name}`;const R=w.map($=>{let O=`${$.name}`;return $.sect&&(O+=`${$.sect.name}`),$.spouse&&(O+=`${$.spouse.name}`),$.trait&&(O+=`${$.trait.name}`),O}).join("");R&&(x+=`
${R}`)}const C=((T=e.relationship)==null?void 0:T.stage)||1;if(C>=2&&C<3&&(x+=`
`),e.isPregnant){const A=e.pregnancyProgress||0;x+=`
${A}`}if(n.eventHistory&&n.eventHistory.length>0){const A=n.eventHistory.filter(R=>R.npcId===e.id).slice(-3).map(R=>R.description).join("");A&&(x+=`


${A}`)}let h="";if(e.memories){const A=s?mw(s):[];h=Zx(e,{includeMilestones:!0,includeRecent:!0,maxRecent:5,contextKeywords:A}),A.some(R=>["","","",""].includes(R))&&(h+=`

 `),A.some(R=>["","","",""].includes(R))&&(h+=`

 `),A.some(R=>["",""].includes(R))&&(h+=`

 `)}return`
  

  /

  
  ${e.name}
  ${c}
  ${e.gender||""}
  ${u}
  ${e.age||""}
  ${p}${f}

  
  ${t.name}
  ${t.gender||""}
  ${t.tierTitle||""}
  ${i}${o}/100
  ${a>0?`${l}${a}/100- ${d}`:""}
  ${x?`
`+x:""}
  ${h?`
`+h:""}

  
  1. "${p}"
    - 
    - 
    - 
    - 
    - 

  2. /
    - 
    - 
    - 

  3. 
    - 30-50
    - 80
    - 

  4. 
    - <30
    - 30-60
    - 60-80
    - >80
    ${w.length>0?"- ":""}
    ${a>=21?`
    ${l}${d.replace("","").replace("","").replace("","")}`:""}

  5. 
    - 
    - "AI"""
    - 
    - 

  
  ${w.length>0?"":""}`},vw=({npc:e,player:t,apiKey:n,apiUrl:s,gameState:o={}})=>{const[i,a]=y.useState([]),[l,d]=y.useState(""),[p,f]=y.useState(!1),[c,u]=y.useState(null),x=y.useRef(null),[S,w]=y.useState(typeof window<"u"?window.innerHeight:600);y.useEffect(()=>{const E={role:"system",content:wm(e,t,o)},I=ww(e.id);I&&I.length>0?a([E,...I.filter(v=>v.role!=="system")]):a([E])},[e.id,e,t,o]),y.useEffect(()=>{x.current&&(x.current.scrollTop=x.current.scrollHeight)},[i]),y.useEffect(()=>{const E=()=>{typeof window<"u"&&window.innerHeight&&w(window.innerHeight)};return E(),window.addEventListener("resize",E),window.addEventListener("orientationchange",E),()=>{window.removeEventListener("resize",E),window.removeEventListener("orientationchange",E)}},[]),y.useEffect(()=>{i.length>1&&Sw(e.id,i.filter(E=>E.role!=="system"))},[i,e.id]);const C=async()=>{if(!l.trim()||p)return;const E={role:"user",content:l.trim()},I=l.trim(),v={role:"system",content:wm(e,t,o,I)},k=i.filter(A=>A.role!=="system"),T=[v,...k,E];a(T),d(""),f(!0),u(null);try{const R={role:"assistant",content:await jc(T,n,s)};a($=>[...$,R])}catch(A){u(A.message);const R={role:"system",content:`${A.message}`};a($=>[...$,R])}finally{f(!1)}},h=()=>{const E=i[0];a([E]),Ew(e.id)},g=S?Math.max(360,S-120):null,b={...cn.container,height:"100%",minHeight:"320px",maxHeight:g?`${g}px`:"100%"};return r.jsxs("div",{style:b,children:[r.jsxs("div",{style:cn.toolbar,children:[r.jsxs("div",{style:cn.npcName,children:[" ",e.name," "]}),r.jsx("button",{onClick:h,style:cn.clearBtn,title:"",children:""})]}),r.jsxs("div",{style:cn.chatBox,ref:x,children:[i.filter(E=>E.role!=="system").map((E,I)=>{const v=E.role==="user";return E.role==="system"?r.jsx("div",{style:cn.systemMsg,children:E.content},I):r.jsxs("div",{style:{...cn.bubbleRow,justifyContent:v?"flex-end":"flex-start"},children:[!v&&r.jsx("div",{style:cn.avatar,title:e.name,children:e.name[0]}),r.jsx("div",{style:{...cn.bubble,background:v?"linear-gradient(135deg, #d4af37 0%, #c5a028 100%)":"#fff",color:v?"#fff":"#333",border:v?"none":"2px solid #d4af37",boxShadow:v?"0 2px 8px rgba(212, 175, 55, 0.3)":"0 2px 8px rgba(0, 0, 0, 0.1)"},children:E.content}),v&&r.jsx("div",{style:{...cn.avatar,background:"#4e6a5d"},title:"",children:t.name[0]})]},I)}),p&&r.jsx("div",{style:cn.loading,children:r.jsx("span",{className:"loading-dots",children:""})})]}),r.jsxs("div",{style:cn.inputArea,children:[r.jsx("input",{style:cn.input,value:l,onChange:E=>d(E.target.value),onKeyDown:E=>{E.key==="Enter"&&!E.shiftKey&&(E.preventDefault(),C())},placeholder:" Enter ...",disabled:p}),r.jsx("button",{onClick:C,style:{...cn.sendBtn,opacity:p||!l.trim()?.5:1,cursor:p||!l.trim()?"not-allowed":"pointer"},disabled:p||!l.trim(),children:p?"...":""})]})]})},ec="npc_chat_history_",Ad=50,Sw=(e,t)=>{try{const n=t.slice(-Ad);localStorage.setItem(`${ec}${e}`,JSON.stringify(n)),t.length>Ad&&console.log(`${t.length} -> ${Ad} `)}catch(n){if(console.error(":",n),n.name==="QuotaExceededError"){console.warn("...");try{const s=t.slice(-20);localStorage.setItem(`${ec}${e}`,JSON.stringify(s))}catch(s){console.error(":",s)}}}},ww=e=>{try{const t=localStorage.getItem(`${ec}${e}`);return t?JSON.parse(t):[]}catch(t){return console.error(":",t),[]}},Ew=e=>{try{localStorage.removeItem(`${ec}${e}`)}catch(t){console.error(":",t)}},cn={container:{display:"flex",flexDirection:"column",background:"rgba(255, 250, 240, 0.95)",borderRadius:"12px",border:"2px solid #d4af37",overflow:"hidden",boxShadow:"0 4px 12px rgba(0, 0, 0, 0.15)",position:"relative"},toolbar:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"12px 16px",background:"linear-gradient(135deg, #4e6a5d 0%, #3d5549 100%)",borderBottom:"2px solid #d4af37"},npcName:{fontSize:"16px",fontWeight:"bold",color:"#d4af37",textShadow:"0 1px 2px rgba(0, 0, 0, 0.3)"},clearBtn:{padding:"6px 12px",background:"rgba(255, 255, 255, 0.1)",border:"1px solid rgba(255, 255, 255, 0.3)",borderRadius:"6px",color:"#fff",fontSize:"12px",cursor:"pointer",transition:"all 0.2s"},chatBox:{flex:1,overflowY:"auto",padding:"20px",paddingBottom:"28px",display:"flex",flexDirection:"column",gap:"16px",background:`url("data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none' fill-rule='evenodd'%3E%3Cg fill='%23d4af37' fill-opacity='0.05'%3E%3Cpath d='M36 34v-4h-2v4h-4v2h4v4h2v-4h4v-2h-4zm0-30V0h-2v4h-4v2h4v4h2V6h4V4h-4zM6 34v-4H4v4H0v2h4v4h2v-4h4v-2H6zM6 4V0H4v4H0v2h4v4h2V6h4V4H6z'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E")`},bubbleRow:{display:"flex",gap:"10px",alignItems:"flex-start",animation:"fadeIn 0.3s ease-in"},avatar:{minWidth:"36px",width:"36px",height:"36px",borderRadius:"50%",background:"linear-gradient(135deg, #d4af37 0%, #c5a028 100%)",color:"#fff",display:"flex",alignItems:"center",justifyContent:"center",fontSize:"14px",fontWeight:"bold",boxShadow:"0 2px 6px rgba(0, 0, 0, 0.2)",border:"2px solid rgba(255, 255, 255, 0.5)"},bubble:{maxWidth:"70%",padding:"12px 16px",borderRadius:"16px",fontSize:"14px",lineHeight:"1.6",wordWrap:"break-word",whiteSpace:"pre-wrap"},systemMsg:{textAlign:"center",fontSize:"12px",color:"#999",padding:"8px 16px",background:"rgba(0, 0, 0, 0.05)",borderRadius:"8px",fontStyle:"italic"},loading:{fontSize:"13px",color:"#666",textAlign:"center",padding:"12px",fontStyle:"italic"},inputArea:{padding:"16px",paddingBottom:"calc(16px + env(safe-area-inset-bottom, 0px))",borderTop:"2px solid #d4af37",display:"flex",gap:"12px",background:"linear-gradient(180deg, rgba(255, 250, 240, 0.95) 0%, rgba(245, 240, 230, 0.95) 100%)",flexShrink:0},input:{flex:1,padding:"12px 16px",borderRadius:"24px",border:"2px solid #d4af37",outline:"none",fontSize:"14px",background:"#fff",transition:"all 0.2s"},sendBtn:{padding:"10px 24px",borderRadius:"24px",background:"linear-gradient(135deg, #4e6a5d 0%, #3d5549 100%)",color:"#fff",border:"none",fontWeight:"bold",fontSize:"14px",transition:"all 0.2s",boxShadow:"0 2px 6px rgba(0, 0, 0, 0.2)"}},ze=e=>!e||e.length===0?null:e[Math.floor(Math.random()*e.length)],kw={low:["{playerName}","{playerName}","{playerName}{gender_ta}","{playerName}"],medium:["{playerName}{gender_ta}","{playerName}","{playerName}","{playerName}{gender_ta}"],high:["{playerName}","{playerName}{gender_ta}","{playerName}","{playerName}{gender_ta}{gender_ta}..."]},Em={:{low:["{playerName}","{playerName}...","{playerName}"],medium:["{playerName}{gender_ta}","{playerName}","{playerName}{gender_ta}"],high:["{playerName}{gender_ta}","{playerName}...","{playerName}"]},:{low:["{playerName}","{playerName}{gender_ta}","{playerName}{gender_ta}"],medium:["{playerName}{gender_ta}","{playerName}{gender_ta}","{playerName}"],high:["{playerName}{gender_ta}{gender_ta}","{playerName}","{playerName}{gender_ta}{gender_ta}"]},:{low:["{playerName}{gender_ta}...","{playerName}{gender_ta}","{playerName}"],medium:["{playerName}......","{playerName}{gender_ta}","{playerName}"],high:["{playerName}.........{gender_ta}...","{playerName}{gender_ta}","{playerName}{gender_ta}"]},:{low:["{playerName}...{gender_ta}","{playerName}{gender_ta}...","{playerName}...{gender_ta}"],medium:["{playerName}{gender_ta}...","{playerName}...","{playerName}{gender_ta}..."],high:["{playerName}...{gender_ta}{gender_ta}...","{playerName}{gender_ta}...","{playerName}..."]},:{low:["{playerName}","{playerName}","{playerName}{gender_ta}"],medium:["{playerName}{gender_ta}","{playerName}","{playerName}{gender_ta}"],high:["{playerName}","{playerName}{gender_ta}","{playerName}{gender_ta}"]},:{low:["{playerName}","{playerName}","{playerName}{gender_ta}"],medium:["{playerName}{gender_ta}","{playerName}","{playerName}{gender_ta}"],high:["{playerName}","{playerName}{gender_ta}","{playerName}...~"]},:{low:["{playerName}{gender_ta}","{playerName}{gender_ta}","{playerName}"],medium:["{playerName}{gender_ta}","{playerName}{gender_ta}","{playerName}{gender_ta}"],high:["{playerName}{gender_ta}","{playerName}{gender_ta}","{playerName}{gender_ta}"]},:{low:["{playerName}","{playerName}","{playerName}"],medium:["{playerName}{gender_ta}","{playerName}{gender_ta}","{playerName}{gender_ta}"],high:["{playerName}","{playerName}","{playerName}{gender_ta}"]}},jw=["{playerName}{giftName}{gender_ta}","{playerName}{giftName}{gender_ta}","{playerName}{giftName}{gender_ta}","{giftName}{playerName}{gender_ta}"],km={:["{playerName}{giftName}......{gender_ta}","{giftName}{playerName}","{playerName}{giftName}...{gender_ta}"],:["{playerName}{giftName}...{gender_ta}","{playerName}{giftName}{gender_ta}","{giftName}{playerName}..."],:["{playerName}{giftName}......","{giftName}...{playerName}","{playerName}{giftName}{gender_ta}"],:["{playerName}{giftName}...{gender_ta}...","{playerName}{giftName}{gender_ta}...","{giftName}...{playerName}{gender_ta}..."],:["{playerName}{giftName}","{playerName}{giftName}{gender_ta}","{giftName}{playerName}"],:["{playerName}{giftName}{gender_ta}","{giftName}{playerName}","{playerName}{giftName}"],:["{playerName}{giftName}{gender_ta}","{playerName}{giftName}{gender_ta}","{giftName}...{playerName}"],:["{playerName}{giftName}","{playerName}{giftName}","{giftName}...{playerName}"]},Cw=["{playerName},{gender_ta},","{playerName},{gender_ta},,","{playerName},,",",{playerName}{gender_ta}"],jm={:["{playerName},","{playerName},,",",{playerName},"],:["{playerName},...{gender_ta},","{playerName},{gender_ta}","{playerName},{gender_ta}"],:["!{playerName}!!()","{playerName}~{gender_ta}!!()","~,{playerName}!{gender_ta}!"],:["{playerName}...{gender_ta},{gender_ta}...","{playerName}{gender_ta}?...{gender_ta},{gender_ta}...","{playerName},{gender_ta},..."],:["{playerName},!!","{playerName},!",",{playerName}!!"],:["!{playerName}!!!","!{playerName}!,{gender_ta}!","{playerName}!,!!"],:["{playerName},","{playerName},",",{playerName}"],:["{playerName},,","{playerName},,",",{playerName},,"]},Tw=["{playerName},...{gender_ta}!","{playerName},,...!{gender_ta},","{playerName},,{gender_ta}","{playerName},{gender_ta},..."],Cm={:["{playerName}...,","{playerName}...,","{playerName},,"],:["{playerName}...{gender_ta},","{playerName},,{gender_ta}","{playerName},{gender_ta}{gender_ta}..."],:["{playerName}...!()","{playerName}!!!!()","!!{playerName}!!"],:["{playerName}...{gender_ta}{gender_ta}...,{gender_ta}...","{playerName},{gender_ta}...{gender_ta}...","...{playerName},{gender_ta}......"],:["{playerName},{gender_ta}!","{playerName},!!",",{playerName},,{gender_ta}!"],:["!{playerName}!!{gender_ta}!","!{playerName}!!!!","{playerName}!{gender_ta}!!"],:["{playerName},,","{playerName},","!{playerName},!"],:["{playerName},,","{playerName},",",{playerName},"]},Iw=["{playerName},,{gender_ta}...",",{playerName},","{playerName},{gender_ta},",",{playerName},..."],Tm={:["{playerName},,{gender_ta}",",{playerName}...{gender_ta}","{playerName},{gender_ta},"],:["{playerName},...{gender_ta},",",{playerName},,...","{playerName},{gender_ta}..."],:["{playerName}!{gender_ta}!!","!,!{playerName}...()","{playerName}!{gender_ta}!...(){gender_ta}..."],:["{playerName}...,{gender_ta},...",",{playerName}......","{playerName},{gender_ta},......"],:["{playerName},,{gender_ta},",",{playerName},","{playerName},,"],:["!{playerName}!!","{playerName}!{gender_ta}!!","{playerName}!!!"],:["{playerName},,{gender_ta}",",{playerName},","{playerName},"],:["{playerName},,",",{playerName},","{playerName},,,"]},_w=["{playerName}...","{playerName}...","...{playerName}","{playerName}...","{playerName}"],Nd={early:["...","","{playerName}","...''",""],mid:["...{playerName}","...","{playerName}","","","..."],late:["...","{playerName}","...","...","{playerName}","''..."]},Rw=["...{childName}","{childName}","...{playerName}","{gender_ta}{childName}{playerName}","{childName}"],Mw=["{newTier}","{newTier}","{newTier}","{newTier}","{newTier}"],Im={:["{newTier}","{newTier}","{newTier}"],:["{newTier}...{playerName}","{newTier}","{newTier}"],:["{newTier}","{newTier}...","{newTier}{playerName}"],:["{newTier}...{playerName}...","{newTier}{playerName}...","...{playerName}{gender_ta}..."],:["{newTier}","{newTier}","{newTier}"],:["{newTier}","{newTier}","{newTier}"],:["...{newTier}","{newTier}","{newTier}"],:["{newTier}","{newTier}","{newTier}"]},Aw=["...","","...","{targetTier}"],_m={:["...","",""],:["...","...","..."],:["","...","......"],:["...{playerName}...","...{playerName}...","...{playerName}..."],:["","...",""],:["","~","......"],:["...","...",""],:["","",""]},Nw=["{spouseName}","{spouseName}{gender_ta}","{spouseName}","{spouseName}{gender_ta}"],Lw=["...","","...","","{playerName}..."],Ld={:["''","","",""],:["{playerName}","","",""],:["","",""],:["","",""],:["","","...",""],:["...","","","..."],:["","","",""],:["","","",""],:["","","",""],:["","","","{gender_ta}"]},$w={:["","","","''"],:["","","",""],:["","{playerName}...{gender_ta}","{playerName}{gender_ta}","{playerName}..."],:["{playerName}{gender_ta}...","{playerName}{gender_ta}{gender_ta}","{playerName}...","{playerName}...{gender_ta}"],:["","","",""],:["","...","","{gender_ta}"]},$d={stranger:["","","",""],crush:["{playerName}","{playerName}{gender_ta}","{playerName}...","{playerName}{gender_ta}{gender_ta}...","{playerName}{gender_ta}"],spouse:["{playerName}{gender_ta}...","{playerName}{gender_ta}","{playerName}","{playerName}{gender_ta}{gender_ta}"]},Bw=["","","",""],Ow=["","","...",""],Pw=["...","","",""],zw=["","","{gender_ta}",""],Dw=["","","",""],lf=["","","","",""],Rm={:["",""],:["",""],:["{playerName}{playerName}","",""],:["{playerName}","",""]},Mm={:{low:["",""],medium:["","{gender_ta}"],high:["",""]},:{low:["",""],medium:["",""],high:["","{gender_ta}"]},:{low:["","",""],medium:["...","",""],high:["","",""]},:{low:["","",""],medium:["","",""],high:["","",""]}},Am={:["",""]},Nm={:[""]},Lm={:[""]},$m={:[""],:["{playerName}",""],:["",""]},Bm={:[""]},Om={:[""]},Pm={:[""]},zm={:[""]};function Fw(e){if(!e)return null;const t=Object.keys(Rm).find(n=>e.includes(n));return t?ze(Rm[t]):null}function Hw(e,t){if(!e)return null;const n=Object.keys(Mm).find(i=>e.includes(i));if(!n)return null;let s="low";t<30?s="low":t<70?s="medium":s="high";const o=Mm[n][s];return o?ze(o):null}function Ww(e){if(!e)return null;const t=Object.keys(Am).find(n=>e.includes(n));return t?ze(Am[t]):null}function Uw(e){if(!e)return null;const t=Object.keys(Nm).find(n=>e.includes(n));return t?ze(Nm[t]):null}function Gw(e){if(!e)return null;const t=Object.keys(Lm).find(n=>e.includes(n));return t?ze(Lm[t]):null}function Vw(e){if(!e)return null;const t=Object.keys($m).find(n=>e.includes(n));return t?ze($m[t]):null}function Yw(e){if(!e)return null;const t=Object.keys(Bm).find(n=>e.includes(n));return t?ze(Bm[t]):null}function qw(e){if(!e)return null;const t=Object.keys(Om).find(n=>e.includes(n));return t?ze(Om[t]):null}function Kw(e){if(!e)return null;const t=Object.keys(Pm).find(n=>e.includes(n));return t?ze(Pm[t]):null}function Qw(e){if(!e)return null;const t=Object.keys(zm).find(n=>e.includes(n));return t?ze(zm[t]):null}function Jw(e,t=null){let n="low";if(e<30?n="low":e<70?n="medium":n="high",t&&Em[t]){const s=Em[t][n];if(s&&s.length>0)return ze(s)}return ze(kw[n])}function Xw(e=null){if(e&&km[e]){const t=km[e];if(t&&t.length>0)return ze(t)}return ze(jw)}function Zw(e=null){if(e&&jm[e]){const t=jm[e];if(t&&t.length>0)return ze(t)}return ze(Cw)}function eE(e=null){if(e&&Cm[e]){const t=Cm[e];if(t&&t.length>0)return ze(t)}return ze(Tw)}function tE(e=null){if(e&&Tm[e]){const t=Tm[e];if(t&&t.length>0)return ze(t)}return ze(Iw)}function nE(e=null){if(e&&Im[e]){const t=Im[e];if(t&&t.length>0)return ze(t)}return ze(Mw)}function rE(e=null){if(e&&_m[e]){const t=_m[e];if(t&&t.length>0)return ze(t)}return ze(Aw)}function sE(e){let t=Ld[e];return t||(e.includes("")||e.includes(""))&&(t=Ld.||Ld.),!t||t.length===0?ze(lf):ze(t)}function oE(e){const t=$w[e];return ze(t||lf)}function iE(e,t,n){return n?ze($d.spouse):t<20?ze($d.stranger):t>=80?ze($d.crush):null}const Dm={LOW:{:["{playerName}{targetName}...{playerName}{gender_ta}","{playerName}{targetName}...{gender_ta}{gender_ta}"],:["{playerName}{targetName}...{gender_ta}...","{targetName}{playerName}......"],:["{playerName}{targetName}","{playerName}{targetName}..."],:["{playerName}{targetName}...","{playerName}{targetName}...{gender_ta}"],:["{playerName}{targetName}",""],:["{targetName}{playerName}","{playerName}{targetName}"],:["{targetName}...","{targetName}..."],:["{playerName}{targetName}","{playerName}{targetName}"]},MEDIUM:{:["{playerName}{targetName}...{gender_ta}...","{playerName}{targetName}...","{targetName}...{playerName}{playerName}"],:["{playerName}{gender_ta}{targetName}","{playerName}{targetName}...","{playerName}...{gender_ta}"],:["{playerName}{targetName}...","{playerName}...{gender_ta}{targetName}"],:["{playerName}{targetName}...{gender_ta}...","{playerName}{targetName}...{playerName}","{playerName}{gender_ta}..."],:["{playerName}","{playerName}"],:["{playerName}{gender_ta}","{playerName}"],:["{targetName}''...","{targetName}...","..."],:["{playerName}{targetName}","{playerName}{gender_ta}..."]},HIGH:{:["...{playerName}{gender_ta}{targetName}.........","{targetName}{playerName}","...{targetName}{playerName}..."],:["{playerName}{gender_ta}.........","{playerName}{targetName}............","......{playerName}..."],:["{playerName}","{playerName}","..."],:["{playerName}{targetName}...{gender_ta}...","{playerName}......","......"],:["{playerName}{targetName}{gender_ta}","{playerName}{gender_ta}","{playerName}"],:["{playerName}{gender_ta}{gender_ta}","",""],:["...{targetName}.........","...","......"],:["{playerName}{targetName}{gender_ta}","{playerName}..."]},EXTREME:{:["{targetName}{playerName}...{playerName}......","{playerName}...{targetName}","{playerName}{gender_ta}..."],:["{playerName}{targetName}","{playerName}","{playerName}{gender_ta}{targetName}......{gender_ta}"],:["{playerName}{targetName}","{playerName}","{playerName}..."],:["{playerName}.........","{playerName}......","{playerName}{targetName}......{gender_ta}..."],:["{playerName}{gender_ta}{gender_ta}","{playerName}{gender_ta}"],:["{playerName}","{playerName}{targetName}{gender_ta}{gender_ta}"],:["......","...","{gender_ta}..."],:["{playerName}{targetName}","{playerName}"]}},Fm={:["{playerName}{favoriteItem}{gender_ta}...","{playerName}{gender_ta}..."],:["{playerName}...{gender_ta}","{playerName}......{gender_ta}"],:["{playerName}...{gender_ta}","{playerName}..."],:["{playerName}{gender_ta}...","{playerName}{gender_ta}..."],:["...","{gender_ta}"],:["{playerName}{gender_ta}","{playerName}"]};class ey{constructor(t=50){this.maxSize=t,this.cache=new Map}get(t){if(!this.cache.has(t))return null;const n=this.cache.get(t);return this.cache.delete(t),this.cache.set(t,n),n}set(t,n){if(this.cache.has(t)&&this.cache.delete(t),this.cache.set(t,n),this.cache.size>this.maxSize){const s=this.cache.keys().next().value;this.cache.delete(s)}}clear(){this.cache.clear()}has(t){return this.cache.has(t)}size(){return this.cache.size}}function aE(e,t={}){const{maxSize:n=100,keyGenerator:s=(...l)=>JSON.stringify(l),ttl:o=null}=t,i=new ey(n),a=new Map;return function(...d){const p=s(...d);o&&a.has(p)&&Date.now()-a.get(p)>o&&(i.set(p,null),a.delete(p));const f=i.get(p);if(f!==null)return f;const c=e(...d);return i.set(p,c),o&&a.set(p,Date.now()),c}}class lE{constructor(){this.caches=new Map,this.stats={hits:0,misses:0,sets:0}}createCache(t,n=100){const s=new ey(n);return this.caches.set(t,s),s}getCache(t){return this.caches.get(t)}get(t,n){const s=this.caches.get(t);if(!s)return this.stats.misses++,null;const o=s.get(n);return o!==null?this.stats.hits++:this.stats.misses++,o}set(t,n,s){const o=this.caches.get(t);if(!o){console.warn(` ${t} `);return}o.set(n,s),this.stats.sets++}clearCache(t){const n=this.caches.get(t);n&&n.clear()}clearAll(){this.caches.forEach(t=>t.clear()),this.stats={hits:0,misses:0,sets:0}}getStats(){const t=this.stats.hits+this.stats.misses>0?(this.stats.hits/(this.stats.hits+this.stats.misses)*100).toFixed(2):0;return{...this.stats,hitRate:`${t}%`,totalCaches:this.caches.size}}}const sa=new lE;sa.createCache("npcLifecycle",200);sa.createCache("combatStats",200);sa.createCache("cultivationProgress",100);sa.createCache("monthlyLogs",50);sa.createCache("sortedLists",20);const ut={INTERACTION:"INTERACTION",STATE_CHANGE:"STATE_CHANGE",DAILY:"DAILY"},cE=50;aE((e,t,n,s)=>null,{maxSize:200,ttl:6e4});function vn(e,t,n,s,o=ut.DAILY,i=!1){if(!e)return e;const a=e.logs||[],p=[{year:t,month:n,content:s,type:o,isSecret:i,timestamp:Date.now()},...a].slice(0,cE);return{...e,logs:p}}function Sn(e,t,n,s={}){if(!e)return"";let o=e;o=o.replace(/{playerName}/g,(n==null?void 0:n.name)||""),o=o.replace(/{npcName}/g,(t==null?void 0:t.name)||"");const i=(n==null?void 0:n.gender)||"";return t!=null&&t.gender,o=o.replace(/{gender_ta}/g,i===""?"":""),o=o.replace(/{gender_Ta}/g,i===""?"":""),Object.keys(s).forEach(a=>{const l=new RegExp(`{${a}}`,"g");o=o.replace(l,s[a])}),o}function Hm(e,t,n,s){const o=e.identity||"",i=Fw(o);let a="";return i?a=Sn(i,e,t):e.name===""?a=`${t.name}${t.gender===""?"":""}...`:e.name===""?a=`${t.name}`:a=`${t.name}${t.gender===""?"":""}`,vn(e,n,s,a,ut.INTERACTION)}function Wm(e,t,n,s){var f,c;const o=((f=e.relationship)==null?void 0:f.affection)||0,i=((c=e.personality)==null?void 0:c.label)||null,a=e.identity||"",d=Hw(a,o)||Jw(o,i),p=Sn(d,e,t);return vn(e,n,s,p,ut.INTERACTION)}function dE(e,t,n,s,o,i){var f;const a=((f=e.personality)==null?void 0:f.label)||null,l=e.identity||"";let d=null;d=Ww(l)||Xw(a);const p=Sn(d,e,t,{giftName:o});return vn(e,n,s,p,ut.INTERACTION)}function uE(e,t,n,s,o){var f;const i=((f=e.personality)==null?void 0:f.label)||null,a=e.identity||"",d=(o?Uw(a):Gw(a))||(o?Zw(i):eE(i)),p=Sn(d,e,t);return vn(e,n,s,p,ut.INTERACTION)}function pE(e,t,n,s){var p;const o=((p=e.personality)==null?void 0:p.label)||null,i=e.identity||"",l=Vw(i)||tE(o),d=Sn(l,e,t);return vn(e,n,s,d,ut.INTERACTION,!0)}function Um(e,t,n,s,o,i){var c,u;let a="LOW";if(i>=81)a="EXTREME";else if(i>=61)a="HIGH";else if(i>=41)a="MEDIUM";else if(i>=21)a="LOW";else return e;const l=typeof e.personality=="object"&&e.personality!==null&&"label"in e.personality?e.personality.label:Array.isArray(e.personality)?e.personality[0]:"",d=((c=Dm[a])==null?void 0:c[l])||((u=Dm[a])==null?void 0:u.);if(!d||d.length===0)return e;const p=ze(d),f=Sn(p,e,t,{targetName:(o==null?void 0:o.name)||""});return vn(e,n,s,f,ut.DAILY,!0)}function fE(e,t,n,s){var p;const o=typeof e.personality=="object"&&e.personality!==null&&"label"in e.personality?e.personality.label:Array.isArray(e.personality)?e.personality[0]:"",i=Fm[o]||Fm.;if(!i||i.length===0)return e;const a=ze(i),l=((p=e.likes)==null?void 0:p[0])||"",d=Sn(a,e,t,{favoriteItem:l});return vn(e,n,s,d,ut.DAILY,!0)}function mE(e,t,n,s){const o=ze(_w),i=Sn(o,e,t);return vn(e,n,s,i,ut.STATE_CHANGE,!0)}function hE(e,t,n,s,o){let i;o<=3?i=Nd.early:o<=6?i=Nd.mid:i=Nd.late;const a=ze(i),l=Sn(a,e,t);return vn(e,n,s,l,ut.STATE_CHANGE,!0)}function gE(e,t,n,s,o){const i=ze(Rw),a=Sn(i,e,t,{childName:o});return vn(e,n,s,a,ut.STATE_CHANGE,!0)}function Ku(e,t,n,s,o,i){var c;const a=((c=e.personality)==null?void 0:c.label)||null,l=e.identity||"",p=(o?Yw(l):qw(l))||(o?nE(a):rE(a)),f=Sn(p,e,t,{newTier:i||"",targetTier:i||""});return vn(e,n,s,f,ut.STATE_CHANGE)}function Gm(e,t,n,s,o){const i=e.identity||"",l=Kw(i)||ze(Nw),d=o===(t==null?void 0:t.name),p=Sn(l,e,t,{spouseName:o||""});return vn(e,n,s,p,ut.STATE_CHANGE,d)}function xE(e,t,n,s){const o=e.identity||"",a=Qw(o)||ze(Lw),l=Sn(a,e,t);return vn(e,n,s,l,ut.STATE_CHANGE,!0)}function yE(e,t,n,s){var w,C,h,g;if(!e)return e;if(e.isPregnant&&e.pregnancyProgress>0)return hE(e,t,n,s,e.pregnancyProgress);const o=((w=e.relationship)==null?void 0:w.affection)||0,i=e.identity||"",a=((C=e.personality)==null?void 0:C.label)||"",l=((h=e.relationship)==null?void 0:h.stage)>=3,d={relationship:0,identity:20,personality:35,event:10,scenery:35};l?(d.relationship=60,d.scenery=10):o>=80?d.relationship=40:o>=50?d.relationship=20:o<20&&(d.relationship=0);const p=Math.random()*100;let f=0,c="scenery";for(const[b,E]of Object.entries(d))if(f+=E,p<=f){c=b;break}let u=null,x=!1;switch(c){case"relationship":u=iE((g=e.relationship)==null?void 0:g.stage,o,l),x=o>=80;break;case"identity":u=sE(i);break;case"personality":u=oE(a),x=a==="";break;case"event":u=ze(ze([Bw,Ow,Pw,zw,Dw]));break;case"scenery":default:u=ze(lf);break}u||(u="");const S=Sn(u,e,t);return vn(e,n,s,S,ut.DAILY,x)}function bE(e,t,n,s){return!e||!Array.isArray(e)?e:e.map(o=>{if(o._hasLogThisMonth){const{_hasLogThisMonth:i,...a}=o;return a}return yE(o,t,n,s)})}function wi(e){return{...e,_hasLogThisMonth:!0}}function vE(e,t=0){return!e||!e.logs?[]:t<30?[]:e.logs.filter(n=>n.isSecret?t>=80:!0)}const SE=Object.values(K).reduce((e,t)=>(e[t.key]=t.order,e),{}),wE=["","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","",""],EE=120,kE=20,jE=5,CE=8,TE=50,Qu=(e="")=>bn(e)?Ze.findIndex(n=>n.name===e):0,IE=(e="")=>{if(!e)return 0;const t=wE.indexOf(e);return t>=0?t:0},tc=(e,t=kE)=>{var p,f,c;if(!e)return EE+t;const n=Qu(e.tier||"");let s=rr.FOUR;(p=e.spiritRoot)!=null&&p.id&&(s={HEAVEN:rr.HEAVEN,MUTANT:rr.MUTANT,SINGLE:rr.SINGLE,DOUBLE:rr.DOUBLE,THREE:rr.THREE,FOUR:rr.FOUR,FIVE:rr.FIVE,WASTE:rr.WASTE}[e.spiritRoot.id]||rr.FOUR);const o=Jx(((f=e.stats)==null?void 0:f.aptitude)||50);let i=fo.common_body;(c=e.constitution)!=null&&c.key&&fo[e.constitution.key]&&(i=fo[e.constitution.key]);const a=Jl(n,s,o,i),l=e.age||18,d=Math.max(a,l+t);return Math.round(d)},ty=(e,t)=>{if(!t)return 0;const n=Qu(e.name||""),s=Qu(t.name||""),o=Jl(n),a=Jl(s)-o,l=Math.pow(t.maxExp,.2),d=a*(1+l/1e3);return Math.round(Math.max(50,d))},ny=e=>{if(!e)return e;const t=e.stats||{},n=tc(e);return t.lifespan&&t.lifespan>=n?e:{...e,stats:{...t,lifespan:n}}},_E=["herb_bandage","beast_fang","beast_core","foundation_pill","thunder_wood","core_pill","artifact_supreme","dragon_heart_pill","marrow_wash","milk_millennium","nascent_fruit","starlight_pill","heaven_manual","god_transformation_pill","divine_soul_pill","void_condensing_pill","immortal_marrow_pill","heaven_defying_pill","void_refining_pill","space_law_pill","void_stabilization_pill","unity_pill","dao_comprehension_pill","harmony_pill","mahayana_pill","immortal_foundation_pill","semi_immortal_pill","tribulation_pill","ascension_pill"].map(e=>{const t=wc[e];if(!t)return null;const n=SE[t.resourceLevel]||1,s=n>=5?80:55;return{itemId:e,affectionRequirement:s+n*5,tierRequirement:Math.max(0,n-1),rarity:t.rarity,resourceOrder:n}}).filter(Boolean);function vr(e){if(!e||!e.stats)return 0;const t=e.stats.lifespan||100,n=e.age||18,s=t-n;return Math.max(0,s)}function RE(e,t,n,s){if(!e)return e;const o=(e.age||18)+1;let i=ny({...e,age:o});const a=vr(i);return a<=0?i={...i,isDead:!0,deathReason:""}:a<10&&!e._nearDeathLogged&&(i=xE(i,t,n,s),i._nearDeathLogged=!0),i}function ME(e,t,n,s){var S,w,C;if(!e||e.isDead)return{npc:e,events:[]};const o=[];let i={...e};i.currentExp||(i.currentExp=0),i.tier||(i.tier="");const a=bn(i.tier);if(!a)return{npc:i,events:o};let l=10;const d=((S=i.stats)==null?void 0:S.aptitude)||50,p=Math.max(20,d)/100,f=.35+Math.pow(p,2)*3;l*=f;const c=((w=i.spiritRoot)==null?void 0:w.multiplier)||.5;l*=c,i.sect&&i.sect.level!=="NONE"&&i.sectStatus==="active"&&(l*=1.5);const u=((C=i.relationship)==null?void 0:C.affection)||0;u>=20&&(u<40?l*=1.1:u<60?l*=1.2:u<80?l*=1.3:l*=1.5),l=Math.max(2,l);const x=Math.floor(l);if(i.currentExp=(i.currentExp||0)+x,i.combatStats=Pn(i),i.cultivationSpeed=l,i.currentExp>=a.maxExp){const h=AE(i,t,n,s);if(i=h.npc,o.push(...h.events),i.currentExp>=a.maxExp){const g=ry(i,t,n,s);i=g.npc,o.push(...g.events)}}return{npc:i,events:o}}function ry(e,t,n,s){var u,x;const o=[];let i={...e};const a=bn(i.tier),l=sf(i.tier);if(!a||!l)return{npc:i,events:o};const d=((u=i.stats)==null?void 0:u.aptitude)||50,p=((x=i.spiritRoot)==null?void 0:x.multiplier)||.5;let f=a.chance||.3;if(f+=d/10*.03,f+=p*.2,f=Math.max(.05,Math.min(.95,f)),Math.random()<f){if(i.tier=l.name,i.tierTitle=l.name,i.currentExp=0,i.maxExp=l.maxExp,i.stats){const S=ty(a,l);i.stats={...i.stats,lifespan:(i.stats.lifespan||100)+S},i._lastBreakthroughLifespanGain=S,i._lastBreakthroughType="normal"}if(i.combatStats){const S=Math.floor(i.combatStats.maxHp*.5),w=Math.floor(i.combatStats.atk*.3),C=Math.floor((i.combatStats.def||0)*.2);i.combatStats={...i.combatStats,maxHp:i.combatStats.maxHp+S,hp:i.combatStats.maxHp+S,atk:i.combatStats.atk+w,def:(i.combatStats.def||0)+C}}i=Ku(i,t,n,s,!0,l.name),o.push({type:"NPC_BREAKTHROUGH",npcName:i.name,newTier:l.name,message:`${i.name}  ${l.name} ${i._lastBreakthroughLifespanGain||0} `})}else i.currentExp=0,i=Ku(i,t,n,s,!1,l.name),o.push({type:"NPC_BREAKTHROUGH_FAIL",npcName:i.name,tier:i.tier,message:`${i.name} `});return{npc:i,events:o}}function AE(e,t,n,s){const o=[];let i={...e};if(!i.tier||!i.stats)return{npc:i,events:o};const a=i.currentExp/(i.maxExp||100);if(a<.75||a>=1)return{npc:i,events:o};const l=bn(i.tier),d=Vu.DIFFICULTY_MULTIPLIER[i.tier]||1,p=L2(i,d);if(Math.random()<p){const c=sf(i.tier);if(!c)return{npc:i,events:o};if(i.tier=c.name,i.tierTitle=c.name,i.currentExp=0,i.maxExp=c.maxExp,i.stats){const x=ty(l,c),S=Math.floor(x*Vu.LIFESPAN_GAIN_MULTIPLIER);i.stats={...i.stats,lifespan:(i.stats.lifespan||100)+S},i._lastBreakthroughLifespanGain=S,i._lastBreakthroughType="natural"}if(i.combatStats){const x=Math.floor(i.combatStats.maxHp*.4),S=Math.floor(i.combatStats.atk*.25);i.combatStats={...i.combatStats,maxHp:i.combatStats.maxHp+x,hp:i.combatStats.maxHp+x,atk:i.combatStats.atk+S}}i=Ku(i,t,n,s,!0,c.name);const u=i._lastBreakthroughLifespanGain||0;o.push({type:"NPC_NATURAL_BREAKTHROUGH",npcName:i.name,newTier:c.name,message:`${i.name}  ${c.name} ${u} `})}return{npc:i,events:o}}function NE(e,t,n,s){if(!e||!Array.isArray(e))return{npcs:e||[],events:[]};const o=[],i=s===1;return{npcs:e.map(l=>{var f,c,u;let d=ny(l);if(d.isDead)return d;if(i&&(d=RE(d,t,n,s),d.isDead))return o.push({type:"NPC_DEATH",npcName:d.name,reason:d.deathReason,message:`${d.name} ${d.deathReason}`}),d;if(!d.isDead){const x=vr(d);(((f=d.relationship)==null?void 0:f.affection)||0)>=TE&&x>0&&x<=jE&&!d._lifespanAlerted?(d={...d,_lifespanAlerted:!0},o.push({type:"NPC_LIFESPAN_ALERT",npcId:d.id,npcName:d.name,remainingYears:x})):d._lifespanAlerted&&x>CE&&(d={...d,_lifespanAlerted:!1})}if(s%6===0){const x=((c=d.relationship)==null?void 0:c.affection)||0,S=((u=d.relationship)==null?void 0:u.stage)||0;if(x>=60&&S>=1&&Math.random()<.2){const w=LE(d);w&&o.push(w)}}const p=ME(d,t,n,s);return d=p.npc,o.push(...p.events),d}),events:o}}const zn={HOSTILE:"HOSTILE",NEUTRAL:"NEUTRAL",FRIENDLY:"FRIENDLY",INTIMATE:"INTIMATE"};function LE(e,t){var u,x,S;const n=((u=e.relationship)==null?void 0:u.affection)||0,s=e.tier||"",o=IE(s);if((((x=e.relationship)==null?void 0:x.stage)||0)<1)return null;const a=_E.filter(w=>{const C=n>=w.affectionRequirement,h=o>=w.tierRequirement;return C&&h});if(!a.length)return null;const l=a.map(w=>({option:w,weight:Math.max(1,8-w.resourceOrder*2)})),d=l.reduce((w,C)=>w+C.weight,0);if(d===0||!l.length)return null;let p=Math.random()*d,f=(S=l[0])==null?void 0:S.option;if(!f)return null;for(const{option:w,weight:C}of l)if(p-=C,p<=0){f=w;break}if(!f||!f.itemId)return null;const c=[`${e.name}""`,`${e.name}`,`${e.name}""`,`${e.name}Ta`];return{type:"NPC_GIFT",npcName:e.name,npcId:e.id,giftItemId:f.itemId,message:c[Math.floor(Math.random()*c.length)]}}function sy(e=0){return e<0?zn.HOSTILE:e<50?zn.NEUTRAL:e<80?zn.FRIENDLY:zn.INTIMATE}function $E(e){const t={[zn.HOSTILE]:{text:"",color:"#f44336",icon:""},[zn.NEUTRAL]:{text:"",color:"#9e9e9e",icon:""},[zn.FRIENDLY]:{text:"",color:"#4caf50",icon:""},[zn.INTIMATE]:{text:"",color:"#e91e63",icon:""}};return t[e]||t[zn.NEUTRAL]}function Bd(e,t){var o;const n=((o=e.relationship)==null?void 0:o.affection)||0,s=sy(n);switch(t){case"DUAL_CULTIVATION":if(s!==zn.INTIMATE)return{allowed:!1,reason:" >= 80"};if(e.identity===""&&(e.dualCultivationCount||0)===0)return{allowed:!0,requiresCheck:!0,checkRate:.05};break;case"GIFT":if(s===zn.HOSTILE)return{allowed:!1,reason:""};break;case"SPAR":if(s===zn.HOSTILE)return{allowed:!1,reason:""};break}return{allowed:!0}}const BE=({npc:e,onClose:t,onOptionSelect:n,player:s,children:o=[],npcs:i=[],onViewLog:a,onCutTies:l,onToggleLetterAcceptance:d})=>{var C,h,g,b,E;const[p,f]=y.useState(null),[c,u]=y.useState("INFO"),x=e.acceptsLetters!==!1;y.useEffect(()=>{const I=v=>{v.key==="Escape"&&t&&t()};return window.addEventListener("keydown",I),()=>window.removeEventListener("keydown",I)},[t]);const S={children:o,npcs:i},w=({label:I,value:v,max:k=100,color:T})=>{const A=Number(k)||100,R=Number(v)||0,$=Math.max(0,Math.min(A,R)),O=A===0?0:Math.min(100,Math.round($/A*100));return r.jsxs("div",{style:{display:"flex",alignItems:"center",marginBottom:"5px",fontSize:"12px"},children:[r.jsx("span",{style:{width:"30px",color:"#666"},children:I}),r.jsx("div",{style:{flex:1,height:"6px",background:"#eee",borderRadius:"3px",margin:"0 8px"},children:r.jsx("div",{style:{width:`${O}%`,background:T,height:"100%",borderRadius:"3px"}})}),r.jsx("span",{style:{width:"25px",textAlign:"right",fontWeight:"bold"},children:Math.floor($)})]})};return r.jsx("div",{style:rt.overlay,children:r.jsxs("div",{style:rt.modalWrapper,children:[r.jsx("button",{onClick:t,style:rt.closeBtn,"aria-label":"",children:""}),r.jsxs("div",{style:rt.modal,children:[r.jsxs("div",{style:rt.tabBar,children:[r.jsx("button",{onClick:()=>u("INFO"),style:{...rt.tab,background:c==="INFO"?"linear-gradient(135deg, #4e6a5d 0%, #3d5549 100%)":"#f5f5f5",color:c==="INFO"?"#fff":"#333",fontWeight:c==="INFO"?"bold":"normal"},children:" "}),r.jsx("button",{onClick:()=>u("CHAT"),style:{...rt.tab,background:c==="CHAT"?"linear-gradient(135deg, #4e6a5d 0%, #3d5549 100%)":"#f5f5f5",color:c==="CHAT"?"#fff":"#333",fontWeight:c==="CHAT"?"bold":"normal"},children:" "})]}),r.jsx("div",{style:rt.content,children:c==="INFO"?r.jsxs("div",{style:rt.leftCol,children:[r.jsx("div",{style:{marginBottom:"15px"},children:r.jsx(Cr,{dna:e.avatar,gender:e.gender,size:120})}),r.jsxs("div",{style:rt.nameBlock,children:[r.jsx("h2",{style:{margin:"10px 0 5px"},children:e.name}),r.jsx("span",{style:rt.identityTag,children:e.identity}),e.constitution&&r.jsx("span",{style:rt.rareTag,children:e.constitution.name}),e.sect&&e.sectStatus!=="mysterious"&&e.sectStatus!=="rogue"&&r.jsx("div",{style:{marginTop:"8px",display:"flex",flexDirection:"column",gap:"4px"},children:r.jsxs("span",{style:{...rt.identityTag,background:e.sectStatus==="defected"?"linear-gradient(135deg, #e53935 0%, #c62828 100%)":e.sectStatus==="hidden"?"linear-gradient(135deg, #9c27b0 0%, #7b1fa2 100%)":e.sect.level==="TOP"?"linear-gradient(135deg, #ffd700 0%, #ffb300 100%)":e.sect.level==="HIGH"?"linear-gradient(135deg, #00bcd4 0%, #0097a7 100%)":e.sect.level==="RECKLESS"?"linear-gradient(135deg, #d32f2f 0%, #b71c1c 100%)":"linear-gradient(135deg, #66bb6a 0%, #43a047 100%)",fontSize:"11px"},children:[e.sectStatus==="defected"?" ":e.sectStatus==="hidden"?" ":"","",e.sect.name,"",e.sectRank]})}),e.sectStatus==="mysterious"&&r.jsx("span",{style:{...rt.identityTag,background:"linear-gradient(135deg, #616161 0%, #424242 100%)",fontSize:"11px"},children:" "}),e.sectStatus==="rogue"&&r.jsx("span",{style:{...rt.identityTag,background:"linear-gradient(135deg, #8d6e63 0%, #6d4c41 100%)",fontSize:"11px"},children:" "})]}),r.jsxs("p",{style:rt.desc,children:['"',e.desc||e.appearance||"",'"']}),r.jsxs("div",{style:rt.attrBox,children:[r.jsx("h4",{children:" "}),r.jsxs("div",{style:{marginBottom:"8px",display:"flex",alignItems:"center"},children:[r.jsx("span",{style:{fontSize:"12px",width:"40px"},children:":"}),r.jsx(Zl,{trait:Xl(e.stats.looks,"LOOKS","")})]}),r.jsxs("div",{style:{marginBottom:"8px",display:"flex",alignItems:"center"},children:[r.jsx("span",{style:{fontSize:"12px",width:"40px"},children:":"}),r.jsx(Zl,{trait:Xl(e.stats.intelligence,"INT")})]}),e.spiritRoot&&r.jsxs("div",{style:{marginBottom:"8px"},children:[r.jsxs("div",{style:{display:"flex",alignItems:"center",marginBottom:"4px"},children:[r.jsx("span",{style:{fontSize:"12px",width:"40px"},children:":"}),r.jsx("span",{style:{fontSize:"12px",fontWeight:"bold",color:e.spiritRoot.color||"#d81b60"},children:e.spiritRoot.type})]}),e.spiritRoot.elements&&r.jsx("div",{style:{display:"flex",alignItems:"center",marginLeft:"40px"},children:r.jsx("div",{style:{display:"flex",gap:"4px"},children:e.spiritRoot.elements.map(I=>{const v=k=>({:"#FFD700",:"#4CAF50",:"#2196F3",:"#F44336",:"#795548",:"#673AB7",:"#00BCD4",:"#009688"})[k]||"#ccc";return r.jsx("span",{style:{padding:"2px 6px",borderRadius:"10px",color:"white",fontWeight:"bold",fontSize:"10px",background:v(I)},children:I},I)})})}),r.jsx("div",{style:{display:"flex",alignItems:"center",marginLeft:"40px",marginTop:"4px"},children:r.jsxs("span",{style:{fontSize:"11px",color:"#666"},children:[": ",(C=e.stats)==null?void 0:C.aptitude," (",((h=e.stats)==null?void 0:h.aptitude)>=80?"":"",")"]})}),e.spiritRoot.desc&&r.jsx("div",{style:{marginLeft:"40px",marginTop:"2px"},children:r.jsx("span",{style:{fontSize:"11px",color:"#666"},children:e.spiritRoot.desc})})]})]}),r.jsxs("div",{style:rt.attrBox,children:[r.jsx("h4",{children:" "}),r.jsx(w,{label:"",value:((g=e.relationship)==null?void 0:g.affection)||0,max:100,color:"#f50057"}),r.jsx(w,{label:"",value:((b=e.relationship)==null?void 0:b.trust)||0,max:100,color:"#00e5ff"}),(()=>{var T;const I=((T=e.relationship)==null?void 0:T.affection)||0,v=sy(I),k=$E(v);return r.jsxs("div",{style:{marginTop:"8px",display:"flex",alignItems:"center",gap:"8px"},children:[r.jsx("span",{style:{fontSize:"12px",color:"#666"},children:":"}),r.jsxs("span",{style:{padding:"4px 12px",borderRadius:"12px",fontSize:"12px",fontWeight:"bold",color:"white",backgroundColor:k.color},children:[k.icon," ",k.text]})]})})(),(()=>{var T;const I=((T=e.relationship)==null?void 0:T.jealousy)??e.jealousy??0,v=A=>A>=81?"#d32f2f":A>=61?"#f44336":A>=41?"#ff9800":A>=21?"#ffc107":"#4caf50",k=A=>A>=81?"":A>=61?"":A>=41?"":A>=21?"":"";return r.jsxs("div",{style:{marginTop:"8px"},children:[r.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",marginBottom:"4px"},children:[r.jsx("span",{style:{fontSize:"12px",color:"#666"},children:":"}),r.jsxs("span",{style:{fontSize:"11px",fontWeight:"bold",color:v(I)},children:[k(I)," (",I,")"]})]}),r.jsx("div",{style:{width:"100%",height:"8px",background:"#e0e0e0",borderRadius:"4px",overflow:"hidden"},children:r.jsx("div",{style:{width:`${I}%`,height:"100%",background:`linear-gradient(90deg, ${v(I)}, ${v(I)}dd)`,borderRadius:"4px",transition:"width 0.3s ease, background 0.3s ease"}})})]})})(),r.jsxs("div",{style:rt.letterToggleRow,children:[r.jsxs("div",{children:[r.jsx("span",{style:{fontSize:"12px",color:"#666"},children:""}),r.jsx("span",{style:{fontSize:"12px",fontWeight:"bold",color:x?"#2e7d32":"#b71c1c"},children:x?"":""})]}),r.jsx("button",{type:"button",style:{...rt.letterToggleBtn,background:x?"linear-gradient(135deg, #4caf50 0%, #2e7d32 100%)":"linear-gradient(135deg, #b0bec5 0%, #90a4ae 100%)"},onClick:()=>d&&d(e.id,!x),children:x?"":""})]}),r.jsx("p",{style:rt.letterToggleHint,children:x?"Ta":"Ta"})]}),r.jsxs("div",{style:rt.attrBox,children:[r.jsx("h4",{children:" "}),r.jsxs("div",{style:{fontSize:"12px",color:"#666",lineHeight:"1.6"},children:[r.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:"4px"},children:[r.jsx("span",{children:":"}),r.jsxs("span",{style:{fontWeight:"bold"},children:[Math.floor(e.age||18)," "]})]}),r.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:"4px"},children:[r.jsx("span",{children:":"}),r.jsxs("span",{style:{fontWeight:"bold"},children:[((E=e.stats)==null?void 0:E.lifespan)||100," "]})]}),r.jsxs("div",{style:{display:"flex",justifyContent:"space-between"},children:[r.jsx("span",{children:":"}),r.jsxs("span",{style:{fontWeight:"bold",color:(()=>{const I=vr(e);return I<10?"#f44336":I<30?"#ff9800":"#4caf50"})()},children:[vr(e)," "]})]}),vr(e)<10&&r.jsx("div",{style:{marginTop:"8px",padding:"8px",background:"rgba(244, 67, 54, 0.1)",borderRadius:"4px",color:"#f44336",fontSize:"11px"},children:" "})]})]}),e.tier&&r.jsxs("div",{style:rt.attrBox,children:[r.jsx("h4",{children:" "}),r.jsxs("div",{style:{fontSize:"12px",marginBottom:"8px"},children:[r.jsx("span",{style:{color:"#666"},children:": "}),r.jsx("span",{style:{fontWeight:"bold",color:"#9c27b0"},children:e.tier||""})]}),e.currentExp!==void 0&&e.maxExp&&r.jsxs("div",{children:[r.jsxs("div",{style:{marginBottom:"4px"},children:[r.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",marginBottom:"4px"},children:[r.jsx("span",{style:{fontSize:"11px",color:"#666"},children:""}),r.jsxs("span",{style:{fontSize:"11px",color:"#666",fontWeight:"bold"},children:[Math.round(Math.floor(e.currentExp||0)/Math.max(1,Math.floor(e.maxExp||1))*100),"%"]})]}),r.jsx("div",{style:{width:"100%",height:"14px",background:"linear-gradient(to right, #f0f0f0, #e0e0e0)",borderRadius:"7px",overflow:"hidden",position:"relative",boxShadow:"inset 0 2px 4px rgba(0,0,0,0.1)"},children:r.jsx("div",{style:{width:`${Math.min(100,Math.round(Math.floor(e.currentExp||0)/Math.max(1,Math.floor(e.maxExp||1))*100))}%`,height:"100%",background:"linear-gradient(90deg, #9c27b0 0%, #d05ce3 100%)",borderRadius:"7px",transition:"width 0.3s ease",boxShadow:"0 0 10px rgba(156, 39, 176, 0.5)",position:"relative",overflow:"hidden"},children:r.jsx("div",{style:{position:"absolute",top:0,left:"-100%",width:"100%",height:"100%",background:"linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent)",animation:"shimmer 2s infinite"}})})})]}),r.jsxs("div",{style:{fontSize:"11px",color:"#666",textAlign:"right",marginTop:"2px"},children:[Math.floor(e.currentExp||0)," / ",Math.floor(e.maxExp||100)]}),e.cultivationSpeed&&r.jsxs("div",{style:{marginTop:"8px",padding:"6px 10px",background:"rgba(156, 39, 176, 0.05)",borderRadius:"6px",border:"1px solid rgba(156, 39, 176, 0.1)"},children:[r.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"4px"},children:[r.jsx("span",{style:{fontSize:"11px",color:"#666"},children:":"}),r.jsxs("span",{style:{fontSize:"11px",fontWeight:"bold",color:"#9c27b0"},children:[Math.floor(e.cultivationSpeed)," /"]})]}),(()=>{const I=e.maxExp-e.currentExp,v=Math.ceil(I/e.cultivationSpeed);return r.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[r.jsx("span",{style:{fontSize:"11px",color:"#666"},children:":"}),r.jsx("span",{style:{fontSize:"11px",fontWeight:"bold",color:v>12?"#ff9800":"#4caf50"},children:v>12?`${Math.floor(v/12)}`:`${v}`})]})})()]}),(()=>{var T;const I=((T=e.relationship)==null?void 0:T.affection)||0;let v=0,k="";return I>=80?(v=50,k=""):I>=60?(v=30,k=""):I>=40?(v=20,k=""):I>=20&&(v=10,k=""),v>0?r.jsxs("div",{style:{marginTop:"8px",padding:"6px 10px",background:"linear-gradient(135deg, rgba(244, 81, 108, 0.1), rgba(240, 98, 146, 0.1))",borderRadius:"6px",border:"1px solid rgba(244, 81, 108, 0.2)",fontSize:"11px",color:"#f4516c",display:"flex",alignItems:"center",justifyContent:"space-between"},children:[r.jsxs("span",{children:[" ",k,""]}),r.jsxs("span",{style:{fontWeight:"bold"},children:["+",v,"% "]})]}):null})()]})]}),r.jsxs("div",{style:rt.personalityBox,children:[r.jsx("span",{children:""}),typeof e.personality=="object"&&e.personality!==null&&"label"in e.personality?r.jsxs("span",{style:rt.tag,children:[e.personality.label," (",e.personality.desc,")"]}):Array.isArray(e.personality)?r.jsx("div",{style:{display:"flex",gap:"5px",marginTop:"5px"},children:e.personality.map((I,v)=>r.jsx("span",{style:rt.tag,children:I},v))}):r.jsx("span",{style:rt.tag,children:""})]}),a&&r.jsxs("button",{onClick:()=>a(e),style:{width:"100%",padding:"12px",marginTop:"15px",background:"linear-gradient(135deg, #667eea 0%, #764ba2 100%)",color:"white",border:"none",borderRadius:"8px",fontSize:"14px",fontWeight:"bold",cursor:"pointer",transition:"all 0.3s",boxShadow:"0 4px 12px rgba(102, 126, 234, 0.3)"},onMouseOver:I=>{I.currentTarget.style.transform="translateY(-2px)",I.currentTarget.style.boxShadow="0 6px 16px rgba(102, 126, 234, 0.4)"},onMouseOut:I=>{I.currentTarget.style.transform="translateY(0)",I.currentTarget.style.boxShadow="0 4px 12px rgba(102, 126, 234, 0.3)"},children:[" ",e.name,""]}),r.jsx("div",{style:{marginTop:"10px"},children:r.jsx("button",{onClick:()=>{l&&window.showConfirm&&window.showConfirm(` ${e.name} `,()=>l(e.id))},style:{width:"100%",padding:"12px",marginTop:"10px",background:"linear-gradient(135deg, #e53935 0%, #c62828 100%)",color:"white",border:"none",borderRadius:"8px",fontSize:"14px",cursor:"pointer"},children:" "})})]}):c==="CHAT"?r.jsx("div",{style:rt.chatWrapper,children:(()=>{const I=localStorage.getItem("game_api_key"),v=localStorage.getItem("game_api_url");return!I||!v?r.jsxs("div",{style:rt.noApiHint,children:[r.jsx("div",{style:{fontSize:"48px",marginBottom:"20px"},children:""}),r.jsx("h3",{children:""}),r.jsxs("p",{children:[" AI API  ",e.name," "]}),r.jsxs("div",{style:{marginTop:"20px",padding:"15px",background:"rgba(255, 255, 255, 0.7)",borderRadius:"8px",fontSize:"13px",lineHeight:"1.6"},children:[r.jsx("strong",{children:""}),r.jsx("br",{}),"1. ",r.jsx("br",{}),"2. AI  API Key  URL",r.jsx("br",{}),"3.  DeepSeek",r.jsx("br",{}),"4. ",r.jsx("br",{}),"5.  NPC "]})]}):r.jsx(vw,{npc:e,player:s,apiKey:I,apiUrl:v,gameState:S})})()}):null})]})]})})},rt={overlay:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0,0,0,0.5)",display:"flex",justifyContent:"center",alignItems:"center",zIndex:1e3,backdropFilter:"blur(2px)"},modalWrapper:{position:"relative",width:"min(600px, calc(100vw - 32px))"},modal:{width:"100%",maxWidth:"600px",height:"80vh",backgroundColor:"#f5f0e8",borderRadius:"16px",overflow:"hidden",display:"flex",flexDirection:"column",position:"relative",boxShadow:"0 8px 30px rgba(0,0,0,0.2)",border:"2px solid #d7ccc8"},closeBtn:{position:"absolute",top:"-18px",left:"-18px",border:"none",background:"#ffffff",fontSize:"24px",cursor:"pointer",color:"#8d6e63",width:"44px",height:"44px",borderRadius:"50%",display:"flex",alignItems:"center",justifyContent:"center",boxShadow:"0 12px 30px rgba(0,0,0,0.25)",zIndex:5},content:{display:"flex",flex:1,height:"calc(100% - 40px)",overflow:"hidden"},leftCol:{width:"100%",backgroundColor:"#faf8f5",padding:"25px",display:"flex",flexDirection:"column",overflowY:"auto"},desc:{fontSize:"14px",color:"#5d4037",fontStyle:"italic",marginBottom:"20px",lineHeight:"1.8",padding:"15px",background:"#f5f0e8",borderRadius:"10px",border:"1px solid #e0e0e0",fontFamily:"Microsoft YaHei, SimSun, serif"},tag:{fontSize:"13px",background:"linear-gradient(135deg, #d7ccc8 0%, #bcaaa4 100%)",padding:"4px 12px",borderRadius:"15px",color:"#3e2723",boxShadow:"0 2px 4px rgba(0,0,0,0.05)"},identityTag:{background:"linear-gradient(135deg, #795548 0%, #5d4037 100%)",color:"white",padding:"4px 10px",borderRadius:"8px",fontSize:"11px",marginRight:"8px",boxShadow:"0 2px 4px rgba(0,0,0,0.1)"},rareTag:{background:"linear-gradient(45deg, #FFD700, #FFA500)",color:"white",padding:"4px 10px",borderRadius:"8px",fontSize:"11px",marginLeft:"5px",fontWeight:"bold",boxShadow:"0 2px 4px rgba(0,0,0,0.1)"},attrBox:{background:"linear-gradient(135deg, #ffffff 0%, #f5f0e8 100%)",padding:"18px",borderRadius:"12px",marginBottom:"20px",border:"1px solid #e0e0e0",boxShadow:"0 2px 8px rgba(0,0,0,0.05)"},letterToggleRow:{marginTop:"14px",padding:"10px 0",borderTop:"1px dashed rgba(0,0,0,0.08)",display:"flex",alignItems:"center",justifyContent:"space-between",gap:"12px"},letterToggleBtn:{border:"none",color:"#fff",padding:"6px 14px",borderRadius:"999px",fontSize:"12px",fontWeight:"bold",cursor:"pointer",transition:"transform 0.2s ease",boxShadow:"0 2px 6px rgba(0,0,0,0.15)"},letterToggleHint:{fontSize:"11px",color:"#8d6e63",marginTop:"4px"},personalityBox:{marginTop:"auto",padding:"15px",background:"linear-gradient(135deg, #ffffff 0%, #f5f0e8 100%)",borderRadius:"12px",fontSize:"13px",border:"1px solid #e0e0e0",boxShadow:"0 2px 8px rgba(0,0,0,0.05)"},tabBar:{display:"flex",borderBottom:"2px solid #d7ccc8",background:"linear-gradient(180deg, #f5f0e8 0%, #ebe6dd 100%)"},tab:{flex:1,padding:"15px",border:"none",cursor:"pointer",fontSize:"14px",transition:"all 0.3s",borderRadius:"0"},chatWrapper:{width:"100%",height:"100%",display:"flex",flexDirection:"column",padding:"20px",boxSizing:"border-box"},noApiHint:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",height:"100%",textAlign:"center",padding:"40px",color:"#5d4037"}},OE=e=>e>=90?"#FFD700":e>=80?"#9C27B0":e>=60?"#2196F3":"#4CAF50",PE=e=>({:"#FFD700",:"#9C27B0",:"#2196F3",:"#4CAF50",:"#9E9E9E",:"#00BCD4"})[e]||"#9E9E9E",oy=({node:e,allChildren:t,onNodeClick:n})=>{var o;const s=t.filter(i=>i.parentId===e.id);return r.jsxs("div",{style:fn.nodeWrapper,children:[r.jsxs("div",{style:{...fn.card,borderColor:e.id==="PLAYER"||((o=e.stats)==null?void 0:o.aptitude)>=80?"#d4af37":"#dcd6cc",cursor:e.isPregnant?"default":"pointer"},onClick:()=>{e.isPregnant||n(e)},children:[r.jsx("div",{style:fn.avatar,children:e.gender===""?"":""}),r.jsx("div",{style:fn.name,children:e.name}),e.id!=="PLAYER"&&r.jsxs(r.Fragment,{children:[r.jsx("div",{style:fn.tier,children:e.tierTitle||""}),e.spouse&&r.jsx("div",{style:fn.spouseTag,children:" "}),e.isPregnant&&r.jsxs("div",{style:fn.pregnantTag,children:[" ",e.gender===""&&r.jsx("span",{style:{fontSize:"9px"},children:"()"})]})]})]}),s.length>0&&r.jsx("div",{style:fn.lineDown}),s.length>0&&r.jsx("div",{style:fn.childrenContainer,children:s.map((i,a)=>r.jsxs("div",{style:fn.childWrapper,children:[r.jsx("div",{style:{...fn.lineTop,left:a===0?"50%":"0",width:a===0||a===s.length-1?"50%":"100%",display:s.length===1?"none":"block"}}),r.jsx(oy,{node:i,allChildren:t,onNodeClick:n})]},i.id))})]})},zE=({player:e,children:t,pregnantNpcs:n=[],onChildClick:s})=>{const[o,i]=y.useState(1),[a,l]=y.useState({x:0,y:0}),[d,p]=y.useState(!1),[f,c]=y.useState({x:0,y:0}),[u,x]=y.useState(null),[S,w]=y.useState(null),C=y.useRef(null),h=O=>{O.cancelable&&O.preventDefault();const Q=O.deltaY*-.001,L=Math.min(Math.max(.2,o+Q),3);i(L)},g=O=>{p(!0),c({x:O.clientX-a.x,y:O.clientY-a.y})},b=O=>{d&&l({x:O.clientX-f.x,y:O.clientY-f.y})},E=()=>{p(!1)},I=O=>{const Q=O[0].clientX-O[1].clientX,L=O[0].clientY-O[1].clientY;return Math.sqrt(Q*Q+L*L)},v=O=>{O.touches.length===1?(p(!0),x({x:O.touches[0].clientX-a.x,y:O.touches[0].clientY-a.y})):O.touches.length===2&&w(I(O.touches))},k=O=>{if(O.cancelable&&O.preventDefault(),O.touches.length===1&&d&&u)l({x:O.touches[0].clientX-u.x,y:O.touches[0].clientY-u.y});else if(O.touches.length===2&&S){const Q=I(O.touches),L=Q/S,G=Math.min(Math.max(.2,o*L),3);i(G),w(Q)}},T=()=>{p(!1),x(null),w(null)},A={id:"PLAYER",name:e.name+" ()",gender:e.gender,parentId:null},R=n.map((O,Q)=>({id:`embryo-${O.id||Q}`,name:`${O.name}`,gender:O.gender||"",parentId:"PLAYER",generation:1,tierTitle:"",isPregnant:!0})),$=[...t,...R].map(O=>({...O,parentId:O.parentId||"PLAYER"}));return r.jsxs("div",{ref:C,style:fn.viewport,onWheel:h,onMouseDown:g,onMouseMove:b,onMouseUp:E,onMouseLeave:E,onTouchStart:v,onTouchMove:k,onTouchEnd:T,onTouchCancel:T,children:[r.jsxs("div",{style:fn.controls,children:[r.jsx("button",{onClick:()=>i(Math.min(3,o+.1)),children:""}),r.jsx("button",{onClick:()=>i(Math.max(.2,o-.1)),children:""}),r.jsx("button",{onClick:()=>{i(1),l({x:0,y:0})},children:""})]}),r.jsx("div",{style:{transform:`translate(${a.x}px, ${a.y}px) scale(${o})`,transformOrigin:"top center",transition:d?"none":"transform 0.1s ease-out",...fn.treeCanvas},children:r.jsx(oy,{node:A,allChildren:$,onNodeClick:O=>O.id!=="PLAYER"&&s(O)})})]})},fn={viewport:{width:"100%",height:"500px",overflow:"hidden",background:"#f0f4f8",position:"relative",border:"3px double #dcd6cc",borderRadius:"12px",cursor:"grab"},controls:{position:"absolute",top:10,right:10,zIndex:10,display:"flex",gap:"5px"},treeCanvas:{display:"flex",justifyContent:"center",paddingTop:"50px",width:"max-content",minWidth:"100%"},nodeWrapper:{display:"flex",flexDirection:"column",alignItems:"center"},card:{width:"100px",padding:"8px",background:"#fff",border:"2px solid #ccc",borderRadius:"8px",textAlign:"center",cursor:"pointer",boxShadow:"0 2px 5px rgba(0,0,0,0.1)",position:"relative",zIndex:2},childrenContainer:{display:"flex",paddingTop:"20px"},childWrapper:{display:"flex",flexDirection:"column",alignItems:"center",position:"relative",padding:"0 10px"},lineDown:{width:"2px",height:"20px",background:"#ccc"},lineTop:{position:"absolute",top:0,height:"20px",borderTop:"2px solid #ccc",zIndex:1},avatar:{fontSize:"24px"},name:{fontSize:"12px",fontWeight:"bold",margin:"2px 0"},tier:{fontSize:"10px",color:"#666"},spouseTag:{fontSize:"10px",color:"#e91e63",marginTop:"2px"},pregnantTag:{fontSize:"10px",color:"#ff9800",marginTop:"2px"}},DE=[{value:"age",label:""},{value:"aptitude",label:""},{value:"cultivation",label:""},{value:"name",label:""}],Ja=10,FE=["","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","",""],Vm=(e="")=>{if(!e)return 0;const t=FE.indexOf(e);return t>=0?t:0},HE=({children:e,pregnantNpcs:t=[],onChildClick:n,onToggleFavorite:s})=>{const[o,i]=y.useState("age"),[a,l]=y.useState("all"),[d,p]=y.useState("all"),[f,c]=y.useState("all"),[u,x]=y.useState(!1),[S,w]=y.useState(1),[C,h]=y.useTransition(),g=y.useCallback(R=>{h(()=>i(R))},[h]);y.useEffect(()=>{w(1)},[o,a,d,f,u,e.length]);const b=y.useMemo(()=>new Set(t.map(R=>R.id)),[t]),E=y.useMemo(()=>{const R=new Map,$=new Map(e.map(Q=>[Q.id,Q])),O=Q=>{if(!Q)return 1;if(R.has(Q.id))return R.get(Q.id);if(!Q.parentId||Q.parentId==="PLAYER")return R.set(Q.id,1),1;const L=$.get(Q.parentId),G=L?O(L):0,ne=Math.max(1,G+1);return R.set(Q.id,ne),ne};return e.forEach(Q=>O(Q)),R},[e]),I=y.useCallback(R=>R&&E.get(R.id)||1,[E]),v=y.useMemo(()=>{let R=[...e];return u&&(R=R.filter($=>$.isFavorite)),a!=="all"&&(R=R.filter($=>$.gender===a)),d!=="all"&&(R=R.filter($=>{const O=I($);return d==="3+"?O>=3:O===parseInt(d)})),f!=="all"&&(R=R.filter($=>f==="married"?$.spouse:f==="single"?!$.spouse:f==="pregnant"?b.has($.id):f==="cultivating"?$.sect:!0)),R.sort(($,O)=>{var Q,L;switch(o){case"age":return $.age-O.age;case"aptitude":return(((Q=O.stats)==null?void 0:Q.aptitude)||0)-(((L=$.stats)==null?void 0:L.aptitude)||0);case"cultivation":const G=Vm($.tier||""),ne=Vm(O.tier||"");if(G!==ne)return ne-G;const ae=$.currentExp||0;return(O.currentExp||0)-ae;case"name":return $.name.localeCompare(O.name,"zh-CN");default:return 0}}),R},[e,o,a,d,f,b,u,E]),k=y.useMemo(()=>Math.max(1,Math.ceil(v.length/Ja)),[v.length]);y.useEffect(()=>{w(R=>Math.min(R,k))},[k]);const T=y.useMemo(()=>{const R=(S-1)*Ja;return v.slice(R,R+Ja)},[v,S]),A=y.useMemo(()=>({total:e.length,male:e.filter(R=>R.gender==="").length,female:e.filter(R=>R.gender==="").length,married:e.filter(R=>R.spouse).length,pregnant:b.size,cultivating:e.filter(R=>R.sect).length,genius:e.filter(R=>{var $;return((($=R.stats)==null?void 0:$.aptitude)||0)>=80}).length,favorite:e.filter(R=>R.isFavorite).length}),[e,b]);return r.jsxs("div",{style:xe.container,children:[r.jsxs("div",{style:xe.header,children:[r.jsxs("h3",{style:xe.title,children:[" (",v.length,"/",A.total,")"]}),r.jsxs("div",{style:xe.statsBar,children:[r.jsxs("span",{style:xe.statItem,children:[" ",A.male]}),r.jsxs("span",{style:xe.statItem,children:[" ",A.female]}),r.jsxs("span",{style:xe.statItem,children:[" ",A.married]}),r.jsxs("span",{style:xe.statItem,children:[" ",A.pregnant]}),r.jsxs("span",{style:xe.statItem,children:[" ",A.cultivating]}),r.jsxs("span",{style:xe.statItem,children:[" ",A.genius]}),r.jsxs("span",{style:xe.statItem,children:[" ",A.favorite]})]})]}),r.jsxs("div",{style:xe.controls,children:[r.jsxs("div",{style:xe.sortRow,children:[r.jsx("span",{style:xe.label,children:":"}),r.jsx("div",{style:xe.segmentedRow,children:DE.map(R=>r.jsx("button",{type:"button",onClick:()=>g(R.value),style:{...xe.segmentButton,...o===R.value?xe.segmentButtonActive:{}},children:R.label},R.value))}),C&&r.jsx("span",{style:xe.pendingHint,children:"..."}),r.jsx("button",{type:"button",onClick:()=>x(R=>!R),style:{...xe.favoriteToggle,...u?xe.favoriteToggleActive:{}},children:u?" ":" "})]}),r.jsxs("div",{style:xe.filterRow,children:[r.jsxs("div",{style:xe.controlGroup,children:[r.jsx("label",{style:xe.label,children:":"}),r.jsxs("select",{value:a,onChange:R=>l(R.target.value),style:xe.select,children:[r.jsx("option",{value:"all",children:""}),r.jsx("option",{value:"",children:""}),r.jsx("option",{value:"",children:""})]})]}),r.jsxs("div",{style:xe.controlGroup,children:[r.jsx("label",{style:xe.label,children:":"}),r.jsxs("select",{value:d,onChange:R=>p(R.target.value),style:xe.select,children:[r.jsx("option",{value:"all",children:""}),r.jsx("option",{value:"1",children:""}),r.jsx("option",{value:"2",children:""}),r.jsx("option",{value:"3+",children:"+"})]})]}),r.jsxs("div",{style:xe.controlGroup,children:[r.jsx("label",{style:xe.label,children:":"}),r.jsxs("select",{value:f,onChange:R=>c(R.target.value),style:xe.select,children:[r.jsx("option",{value:"all",children:""}),r.jsx("option",{value:"married",children:""}),r.jsx("option",{value:"single",children:""}),r.jsx("option",{value:"pregnant",children:""}),r.jsx("option",{value:"cultivating",children:""})]})]})]})]}),t.length>0&&f!=="single"&&f!=="cultivating"&&r.jsxs("div",{style:xe.section,children:[r.jsxs("h4",{style:xe.sectionTitle,children:["  (",t.length,")"]}),r.jsx("div",{style:xe.embryoList,children:t.map(R=>r.jsxs("div",{style:xe.embryoCard,children:[r.jsx("div",{style:xe.embryoIcon,children:""}),r.jsxs("div",{style:xe.embryoInfo,children:[r.jsx("div",{style:xe.embryoName,children:"..."}),r.jsxs("div",{style:xe.embryoDetail,children:[": ",R.name," ",R.gender===""&&r.jsx("span",{style:{fontSize:"10px",color:"#ff6b6b"},children:"()"})]}),r.jsx("div",{style:xe.progressBar,children:r.jsx("div",{style:{...xe.progressFill,width:`${(R.pregnancyProgress||0)*10}%`}})}),r.jsxs("div",{style:xe.embryoProgress,children:[R.pregnancyProgress||0,"/9"]})]})]},`embryo-${R.id}`))})]}),r.jsx("div",{style:xe.listContainer,children:v.length===0?r.jsxs("div",{style:xe.emptyState,children:[r.jsx("div",{style:xe.emptyIcon,children:""}),r.jsx("div",{style:xe.emptyText,children:""})]}):T.map(R=>{var L,G,ne;const $=I(R),O=b.has(R.id),Q=R.influenceProfile;return r.jsxs("div",{style:xe.childCard,onClick:()=>n(R),children:[s&&r.jsx("button",{type:"button",title:R.isFavorite?"":"",style:{...xe.favoriteButton,...R.isFavorite?xe.favoriteButtonActive:{}},onClick:ae=>{ae.stopPropagation(),s(R.id)},children:R.isFavorite?"":""}),r.jsxs("div",{style:xe.avatarSection,children:[R.age===0?r.jsx("div",{style:xe.babyIcon,children:""}):R.age<15?r.jsx("div",{style:xe.babyIcon,children:""}):r.jsx(Cr,{dna:R.avatar,gender:R.gender,size:60}),r.jsx("div",{style:xe.genderBadge,"data-gender":R.gender,children:R.gender===""?"":""})]}),r.jsxs("div",{style:xe.infoSection,children:[r.jsxs("div",{style:xe.childName,children:[r.jsx("span",{style:{color:OE(((L=R.stats)==null?void 0:L.aptitude)||0)},children:R.name}),r.jsxs("span",{style:xe.generationBadge,children:["",$,""]}),(((G=R.stats)==null?void 0:G.aptitude)||0)>=80&&r.jsx("span",{style:xe.geniusBadge,children:""}),R.isFavorite&&r.jsx("span",{style:xe.favoriteBadge,children:" "})]}),r.jsxs("div",{style:xe.infoRow,children:[r.jsxs("span",{style:xe.infoItem,children:[": ",Math.floor(R.age),""]}),r.jsx("span",{style:xe.infoItem,children:R.tierTitle||""}),R.isTested&&r.jsx("span",{style:{...xe.infoItem,color:PE(R.spiritRoot.type)},children:R.spiritRoot.type})]}),r.jsxs("div",{style:xe.infoRow,children:[r.jsxs("span",{style:xe.infoItem,children:[": ",Math.floor(((ne=R.stats)==null?void 0:ne.aptitude)||0)]}),R.sect&&r.jsxs("span",{style:xe.sectBadge,children:[" ",R.sect.name]}),R.spouse&&r.jsxs("span",{style:xe.spouseBadge,children:[" ",R.spouse.name]}),O&&r.jsx("span",{style:xe.pregnantBadge,children:" "})]}),Q&&r.jsxs("div",{style:xe.influenceRow,children:[r.jsx("span",{style:{...xe.influenceBadge,borderColor:Q.color},children:Q.label}),r.jsx("div",{style:xe.influenceMeter,children:r.jsx("div",{style:{...xe.influenceMeterFill,width:`${Math.min(100,Math.round((Q.progress||0)*100))}%`,background:Q.color}})}),r.jsx("span",{style:xe.influenceScore,children:Math.floor(Q.score)})]}),R.cultivationManual&&r.jsxs("div",{style:xe.manualInfo,children:[" ",R.cultivationManual.name]})]}),r.jsx("div",{style:xe.arrowSection,children:""})]},R.id)})}),v.length>Ja&&r.jsxs("div",{style:xe.pagination,children:[r.jsx("button",{style:{...xe.pageBtn,opacity:S===1?.6:1},onClick:()=>w(R=>Math.max(1,R-1)),disabled:S===1,children:""}),r.jsxs("span",{style:xe.pageInfo,children:[" ",S," / ",k," "]}),r.jsx("button",{style:{...xe.pageBtn,opacity:S>=k?.6:1},onClick:()=>w(R=>Math.min(k,R+1)),disabled:S>=k,children:""})]})]})},xe={container:{padding:"15px",backgroundColor:"#f5f0e8",borderRadius:"12px",border:"2px solid #8d6e63",maxHeight:"600px",height:"100%",display:"flex",flexDirection:"column",overflow:"hidden"},header:{marginBottom:"15px"},title:{margin:"0 0 10px 0",fontSize:"18px",fontWeight:"bold",color:"#5d4037"},statsBar:{display:"flex",gap:"12px",flexWrap:"wrap"},controls:{display:"flex",flexDirection:"column",gap:"12px",marginBottom:"15px",padding:"10px",backgroundColor:"rgba(255,255,255,0.5)",borderRadius:"8px"},sortRow:{display:"flex",flexWrap:"wrap",alignItems:"center",gap:"10px"},segmentedRow:{display:"flex",flexWrap:"wrap",gap:"6px"},pendingHint:{fontSize:"11px",color:"#5d4037",fontStyle:"italic"},segmentButton:{border:"1px solid #8d6e63",borderRadius:"16px",padding:"4px 10px",fontSize:"12px",backgroundColor:"white",color:"#5d4037",cursor:"pointer",transition:"all 0.2s ease"},segmentButtonActive:{backgroundColor:"#8d6e63",color:"white",boxShadow:"0 2px 6px rgba(0,0,0,0.2)"},favoriteToggle:{border:"1px dashed #c2185b",borderRadius:"16px",padding:"4px 12px",fontSize:"12px",cursor:"pointer",backgroundColor:"white",color:"#c2185b",fontWeight:"bold"},favoriteToggleActive:{backgroundColor:"#c2185b",color:"white"},filterRow:{display:"flex",flexWrap:"wrap",gap:"10px"},controlGroup:{display:"flex",alignItems:"center",gap:"5px"},label:{fontSize:"12px",fontWeight:"bold",color:"#5d4037"},select:{padding:"4px 8px",borderRadius:"4px",border:"1px solid #8d6e63",backgroundColor:"white",fontSize:"12px",cursor:"pointer"},influenceRow:{display:"flex",alignItems:"center",gap:"8px",marginTop:"6px"},influenceBadge:{borderRadius:"999px",border:"1px solid #ccc",padding:"2px 8px",fontSize:"11px",fontWeight:600},influenceMeter:{flex:1,height:"6px",backgroundColor:"#e0e0e0",borderRadius:"999px",overflow:"hidden"},influenceMeterFill:{height:"100%"},influenceScore:{fontSize:"12px",fontWeight:700,color:"#37474f"},section:{marginBottom:"15px"},sectionTitle:{margin:"0 0 10px 0",fontSize:"14px",fontWeight:"bold",color:"#d81b60"},embryoList:{display:"flex",gap:"10px",flexWrap:"wrap",marginBottom:"10px"},embryoCard:{display:"flex",alignItems:"center",gap:"10px",padding:"10px",backgroundColor:"white",borderRadius:"8px",border:"2px dashed #d81b60",minWidth:"200px"},embryoIcon:{fontSize:"32px"},embryoInfo:{flex:1},embryoName:{fontWeight:"bold",color:"#d81b60",marginBottom:"4px"},embryoDetail:{fontSize:"11px",color:"#666",marginBottom:"4px"},progressBar:{height:"6px",backgroundColor:"#e0e0e0",borderRadius:"3px",overflow:"hidden",marginBottom:"4px"},progressFill:{height:"100%",backgroundColor:"#d81b60",transition:"width 0.3s ease"},embryoProgress:{fontSize:"10px",color:"#666"},listContainer:{flex:1,overflowY:"auto",WebkitOverflowScrolling:"touch",display:"flex",flexDirection:"column",gap:"10px",minHeight:0},childCard:{display:"flex",gap:"12px",padding:"12px",backgroundColor:"white",borderRadius:"10px",border:"2px solid #e0e0e0",cursor:"pointer",transition:"all 0.2s ease",boxShadow:"0 2px 4px rgba(0,0,0,0.05)",position:"relative"},favoriteButton:{position:"absolute",top:"10px",right:"10px",border:"none",background:"transparent",fontSize:"18px",cursor:"pointer",color:"#d7ccc8",transition:"transform 0.2s ease, color 0.2s ease"},favoriteButtonActive:{color:"#ffb300",textShadow:"0 0 6px rgba(255,179,0,0.6)"},avatarSection:{position:"relative",flexShrink:0},babyIcon:{width:"60px",height:"60px",display:"flex",alignItems:"center",justifyContent:"center",fontSize:"40px",backgroundColor:"#f5f5f5",borderRadius:"50%"},genderBadge:{position:"absolute",bottom:"-4px",right:"-4px",width:"20px",height:"20px",borderRadius:"50%",display:"flex",alignItems:"center",justifyContent:"center",fontSize:"12px",fontWeight:"bold",color:"white",backgroundColor:"#4285F4",border:"2px solid white"},infoSection:{flex:1,display:"flex",flexDirection:"column",gap:"6px",minWidth:0},childName:{display:"flex",alignItems:"center",gap:"6px",fontSize:"14px",fontWeight:"bold",flexWrap:"wrap"},generationBadge:{fontSize:"10px",padding:"2px 6px",backgroundColor:"#e3f2fd",color:"#1976d2",borderRadius:"10px",fontWeight:"normal"},geniusBadge:{fontSize:"10px",padding:"2px 6px",backgroundColor:"#fff3e0",color:"#f57c00",borderRadius:"10px",fontWeight:"normal"},favoriteBadge:{fontSize:"10px",padding:"2px 6px",backgroundColor:"#fff8e1",color:"#ff8f00",borderRadius:"10px",fontWeight:"bold"},infoRow:{display:"flex",gap:"8px",flexWrap:"wrap",alignItems:"center"},infoItem:{fontSize:"11px",color:"#666"},sectBadge:{fontSize:"10px",padding:"2px 6px",backgroundColor:"#e8f5e9",color:"#2e7d32",borderRadius:"10px",fontWeight:"bold"},spouseBadge:{fontSize:"10px",padding:"2px 6px",backgroundColor:"#fce4ec",color:"#c2185b",borderRadius:"10px",fontWeight:"bold"},pregnantBadge:{fontSize:"10px",padding:"2px 6px",backgroundColor:"#fff3e0",color:"#f57c00",borderRadius:"10px",fontWeight:"bold"},manualInfo:{fontSize:"11px",color:"#7b1fa2",fontWeight:"bold"},arrowSection:{display:"flex",alignItems:"center",fontSize:"20px",color:"#bbb",flexShrink:0},emptyState:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",padding:"40px",color:"#999"},emptyIcon:{fontSize:"48px",marginBottom:"10px"},emptyText:{fontSize:"14px"}},iy=document.createElement("style");iy.textContent=`
  [data-gender=""] {
    background-color: #4285F4 !important;
  }
  [data-gender=""] {
    background-color: #EA4335 !important;
  }
  .childCard:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(0,0,0,0.15);
    border-color: #8d6e63;
  }
  
  /*  */
  @media (max-width: 768px) {
    /*  */
    .listContainer {
      max-height: calc(100vh - 300px) !important;
      -webkit-overflow-scrolling: touch;
    }
  }
`;document.head.appendChild(iy);const WE=({records:e=[],onMemorialClick:t})=>{const n=y.useMemo(()=>{if(!e.length)return{avgAge:0,maxGeneration:0};const s=e.reduce((i,a)=>i+(a.ageAtDeath||0),0),o=Math.max(...e.map(i=>i.generation||1));return{avgAge:Math.round(s/e.length*10)/10,maxGeneration:o}},[e]);return r.jsxs("div",{style:Xt.container,children:[r.jsxs("div",{style:Xt.banner,children:[r.jsxs("div",{children:["   ",e.length," "]}),e.length>0&&r.jsxs("div",{style:Xt.bannerStats,children:[r.jsxs("span",{children:[" ",n.avgAge||""," "]}),r.jsxs("span",{children:[" ",n.maxGeneration||1,""]})]})]}),e.length===0?r.jsx("div",{style:Xt.empty,children:""}):r.jsx("div",{style:Xt.grid,children:e.map(s=>{var o;return r.jsxs("button",{type:"button",style:{...Xt.tomb,...s.isExiled?Xt.tombExiled:{}},onClick:()=>t&&t(s),children:[r.jsxs("div",{style:Xt.tombHeader,children:[r.jsx("span",{style:Xt.icon,children:s.isExiled?"":""}),r.jsxs("div",{children:[r.jsx("div",{style:Xt.name,children:s.name}),r.jsxs("div",{style:Xt.meta,children:[s.isExiled?"":`${s.generation||1}`,"  ",s.tierTitle||""]})]})]}),!s.isExiled&&r.jsxs("div",{style:Xt.detail,children:[" ",s.deathYear||""," ",s.deathMonth||1,"   ",s.ageAtDeath??""," "]}),s.deathReason&&r.jsxs("div",{style:Xt.detail,children:[s.isExiled?"":"",s.deathReason]}),((o=s.sect)==null?void 0:o.name)&&!s.isExiled&&r.jsxs("div",{style:Xt.detail,children:[s.sect.name,s.rank?`  ${s.rank}`:""]}),r.jsx("p",{style:Xt.epitaph,children:s.epitaph||""}),typeof s.descendants=="number"&&!s.isExiled&&r.jsxs("div",{style:Xt.descendants,children:["",s.descendants]})]},s.id)})})]})},Xt={container:{width:"100%",height:"100%",background:"#fdf7f2",borderRadius:"12px",border:"2px solid #8d6e63",padding:"15px",display:"flex",flexDirection:"column",gap:"12px"},banner:{background:"linear-gradient(90deg, #efebe9, #f5f0e8)",borderRadius:"10px",padding:"12px 16px",fontWeight:"bold",display:"flex",justifyContent:"space-between",alignItems:"center",color:"#5d4037"},bannerStats:{display:"flex",gap:"16px",fontSize:"12px",color:"#6d4c41"},empty:{flex:1,display:"flex",alignItems:"center",justifyContent:"center",color:"#9e9e9e",fontStyle:"italic"},grid:{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(220px, 1fr))",gap:"12px",overflowY:"auto"},tomb:{display:"flex",flexDirection:"column",alignItems:"stretch",padding:"12px",borderRadius:"10px",border:"1px solid #d7ccc8",background:"#fffefd",textAlign:"left",cursor:"pointer",transition:"transform 0.2s ease, box-shadow 0.2s ease",outline:"none"},tombExiled:{background:"#f5f5f5",border:"1px solid #ccc",opacity:.8},tombHeader:{display:"flex",alignItems:"center",gap:"10px",marginBottom:"8px"},icon:{fontSize:"24px"},name:{fontWeight:"bold",color:"#4e342e"},meta:{fontSize:"12px",color:"#8d6e63"},detail:{fontSize:"12px",color:"#5d4037",marginTop:"4px"},epitaph:{marginTop:"10px",fontSize:"12px",color:"#4e342e",lineHeight:1.5},descendants:{marginTop:"8px",fontSize:"11px",color:"#6d4c41"}},UE=({player:e,children:t,fallenChildren:n=[],exiledChildren:s=[],pregnantNpcs:o=[],onChildClick:i,onToggleFavorite:a,onMemorialClick:l})=>{const[d,p]=y.useState("tree"),f=[...n,...s.map(c=>({...c,isExiled:!0,deathReason:"",epitaph:""}))];return r.jsxs("div",{style:An.container,children:[r.jsxs("div",{style:An.viewSwitcher,children:[r.jsx("button",{style:{...An.viewButton,...d==="tree"?An.viewButtonActive:{}},onClick:()=>p("tree"),children:" "}),r.jsx("button",{style:{...An.viewButton,...d==="list"?An.viewButtonActive:{}},onClick:()=>p("list"),children:" "}),r.jsx("button",{style:{...An.viewButton,...d==="cemetery"?An.viewButtonActive:{}},onClick:()=>p("cemetery"),children:" "})]}),r.jsxs("div",{style:{...An.viewContent,position:"relative"},children:[d==="tree"&&r.jsx(zE,{player:e,children:t,pregnantNpcs:o,onChildClick:i}),d==="list"&&r.jsx(HE,{children:t,pregnantNpcs:o,onChildClick:i,onToggleFavorite:a}),d==="cemetery"&&r.jsx(WE,{records:f,onMemorialClick:l})]}),d==="tree"&&r.jsx("div",{style:An.hint,children:" : ,/,/"}),d==="list"&&r.jsx("div",{style:An.hint,children:" : "}),d==="cemetery"&&r.jsx("div",{style:An.hint,children:" : "})]})},An={container:{display:"flex",flexDirection:"column",gap:"15px"},viewSwitcher:{display:"flex",gap:"10px",justifyContent:"center",padding:"10px",backgroundColor:"rgba(255,255,255,0.5)",borderRadius:"12px",border:"2px solid #8d6e63"},viewButton:{padding:"10px 20px",fontSize:"14px",fontWeight:"bold",border:"2px solid #8d6e63",borderRadius:"20px",backgroundColor:"white",color:"#5d4037",cursor:"pointer",transition:"all 0.3s ease",outline:"none",boxShadow:"0 2px 4px rgba(0,0,0,0.1)"},viewButtonActive:{backgroundColor:"#8d6e63",color:"white",transform:"scale(1.05)",boxShadow:"0 4px 8px rgba(0,0,0,0.2)"},viewContent:{flex:1},hint:{textAlign:"center",fontSize:"12px",color:"#666",padding:"8px",backgroundColor:"rgba(255,255,255,0.7)",borderRadius:"8px",border:"1px solid #e0e0e0"}},Ju=document.createElement("style");Ju.textContent=`
  button:hover {
    transform: translateY(-2px);
  }
  button:active {
    transform: translateY(0);
  }
`;document.querySelector("#family-view-wrapper-styles")||(Ju.id="family-view-wrapper-styles",document.head.appendChild(Ju));const GE=e=>{if(!e||!e.sect||!e.sectId||e.sectId==="NONE")return null;const t=e.sect.name,n=e.name,s=e.sectRank||"",o=e.sectStatus||"active",i=[];return o==="active"?(i.push(`${t}${s}${n}`,`${t}${n}`,`${t}${n}`,`${t}${n}`,`${t}${n}`,`${t}${n}`,`${t}${n}`,`${t}${n}`,`${t}${n}`,`${t}${n}`),(s===""||s==="")&&i.push(`${t}${n}`,`${t}${n}`,`${t}${n}`,`${t}${n}`),(t.includes("")||t.includes("")||t.includes(""))&&i.push(`${t}${n}`,`${t}${n}`,`${n}(${t})`)):o==="defected"?i.push(`${t}${n}`,`${t}${s}${n}`,`${t}${n}`,`${n}`,`${t}${n}`,`${n}${t}`):o==="hidden"&&i.push(`${t}${n}`,`${t}${n}`),i.length>0?i[Math.floor(Math.random()*i.length)]:null},VE=e=>{if(!e||e.length<2)return null;const t=e.filter(a=>a.sect&&a.sectId&&a.sectId!=="NONE"&&a.sectStatus==="active");if(t.length<2)return null;const n=t[Math.floor(Math.random()*t.length)];let s=t[Math.floor(Math.random()*t.length)],o=0;for(;s.sectId===n.sectId&&o<10;)s=t[Math.floor(Math.random()*t.length)],o++;if(n.sectId===s.sectId)return null;const i=[`${n.sect.name}${n.name}${s.sect.name}${s.name}`,`${n.name}(${n.sect.name})${s.name}(${s.sect.name})`,`${n.sect.name}${n.name}${s.sect.name}${s.name}`];return i[Math.floor(Math.random()*i.length)]},YE=[{type:"SECT",title:"",templates:["","","","","","","","","",""],probability:.15},{type:"SECT",title:"",templates:["","","","","","","",""],probability:.1},{type:"SECT",title:"",templates:["","","","","","","",""],probability:.12},{type:"SECT",title:"",templates:["","","","","","",""],probability:.08}],qE=[{type:"GENIUS",title:"",templates:["''","''","","''","","","''"],probability:.1},{type:"GENIUS",title:"",templates:["''","","","","",""],probability:.08},{type:"GENIUS",title:"",templates:["''''","''","","","",""],probability:.07},{type:"GENIUS",title:"",templates:["''","","","''","''",""],probability:.05}],KE=[{type:"TREASURE",title:"",templates:["","","","","","","","",""],probability:.12}],QE=[{type:"REALM",title:"",templates:["","","","","","","",""],probability:.1}],JE=[{type:"DISASTER",title:"",templates:["","","","","","","","",""],probability:.08}],XE=[{type:"POLITICS",title:"",templates:["","","","","","","",""],probability:.07}],ZE=[{type:"DAILY",title:"",templates:["","","","","","",""],probability:.15}],ek=[{type:"FAMOUS",title:"",templates:["''","","","","''","","",""],probability:.06}],tk=()=>[...YE,...qE,...KE,...QE,...JE,...XE,...ZE,...ek],nk=(e,t,n=null,s=[])=>{const o=[],i=ik(e,t);for(let a=0;a<i;a++){const l=sk(e,t);l&&o.push(l)}if(s&&s.length>0&&Math.random()<.3){const a=rk(e,t,s);a&&o.push(a)}return o},rk=(e,t,n)=>{const s=Math.random();let o=null,i=null;if(s<.7){const a=n[Math.floor(Math.random()*n.length)];o=GE(a),i=[a.id]}else o=VE(n);return o?{type:"NPC_RELATED",category:"",title:"",message:o,year:e,month:t,importance:"MEDIUM",timestamp:Date.now(),npcIds:i}:null},sk=(e,t,n)=>{const s=tk(),o=ok(s);if(!o||!o.templates||o.templates.length===0)return null;const i=ze(o.templates);return i?{type:o.type,category:"",title:o.title,message:i,year:e,month:t,importance:ak(o.type),timestamp:Date.now()}:null},ok=e=>{const t=e.reduce((s,o)=>s+(o.probability||0),0);let n=Math.random()*t;for(const s of e)if(n-=s.probability||0,n<=0)return s;return e[0]},ik=(e,t)=>{if(t===1||t===7){const s=Math.random();return s<.3?3:s<.7?2:1}const n=Math.random();return n<.5?1:n<.8?2:0},ak=e=>({DISASTER:5,POLITICS:4,GENIUS:4,SECT:3,REALM:3,TREASURE:3,FAMOUS:2,DAILY:1})[e]||2,lk=(e,t,n,s)=>{const o=t.filter(i=>i.sect&&["TOP","HIGH"].includes(i.sect.level));if(o.length>0&&Math.random()<.2){const i=ze(o),a=i.sect.name,l=[`${a}${i.name}`,`${a}${i.name}`,`${a}${i.name}`];return{type:"SECT",category:"",title:"",message:ze(l),year:n,month:s,importance:3,relatedChild:i.id,timestamp:Date.now()}}return null},ck=e=>({SECT:"",GENIUS:"",TREASURE:"",REALM:"",DISASTER:"",POLITICS:"",DAILY:"",FAMOUS:""})[e]||"",dk=e=>({SECT:"#4A90E2",GENIUS:"#E74C3C",TREASURE:"#F39C12",REALM:"#9B59B6",DISASTER:"#E67E22",POLITICS:"#16A085",DAILY:"#95A5A6",FAMOUS:"#D4AF37"})[e]||"#7F8C8D",Ym={ready:"#43a047",pending:"#fb8c00"},uk=({summary:e,onUpgrade:t})=>{if(!e)return null;const{currentTier:n,nextTier:s,requirements:o,totals:i,canUpgrade:a,enrichedChildren:l}=e,d=Math.round((i.powerProgress||0)*100),p=[...l].sort((f,c)=>{var u,x;return(((u=c.influence)==null?void 0:u.score)||0)-(((x=f.influence)==null?void 0:x.score)||0)}).slice(0,3);return r.jsxs("div",{style:et.wrapper,children:[r.jsxs("div",{style:et.headerRow,children:[r.jsxs("div",{children:[r.jsx("div",{style:et.label,children:""}),r.jsx("div",{style:et.currentTier,children:(n==null?void 0:n.name)||""}),r.jsx("div",{style:et.desc,children:n==null?void 0:n.desc})]}),r.jsxs("div",{style:et.metricsBox,children:[r.jsxs("div",{style:et.metricItem,children:[r.jsx("span",{style:et.metricLabel,children:""}),r.jsx("strong",{style:et.metricValue,children:i.population})]}),r.jsxs("div",{style:et.metricItem,children:[r.jsx("span",{style:et.metricLabel,children:""}),r.jsx("strong",{style:et.metricValue,children:i.ratingScore})]}),r.jsxs("div",{style:et.metricItem,children:[r.jsx("span",{style:et.metricLabel,children:""}),r.jsx("strong",{style:et.metricValue,children:i.sovereignCount})]})]})]}),s?r.jsxs("div",{style:et.progressSection,children:[r.jsxs("div",{style:et.progressHeader,children:[r.jsxs("div",{children:[r.jsxs("div",{style:et.nextLabel,children:["",s.name]}),r.jsx("small",{style:{color:"#cfd8dc"},children:s.desc})]}),r.jsxs("span",{style:{fontWeight:"bold",color:"#fff"},children:[d,"%"]})]}),r.jsx("div",{style:et.progressBarBg,children:r.jsx("div",{style:{...et.progressBarFill,width:`${Math.min(100,d)}%`}})})]}):r.jsx("div",{style:et.progressSection,children:r.jsx("div",{style:et.nextLabel,children:""})}),(o==null?void 0:o.length)>0&&r.jsx("div",{style:et.requirementsGrid,children:o.map(f=>{const c=f.met;return r.jsxs("div",{style:et.requirementCard,children:[r.jsx("div",{style:{...et.requirementBadge,backgroundColor:c?Ym.ready:Ym.pending},children:c?"":""}),r.jsxs("div",{children:[r.jsx("div",{style:et.requirementLabel,children:f.label}),r.jsxs("div",{style:et.requirementValue,children:[f.current," / ",f.required]})]})]},f.label)})}),p.length>0&&r.jsxs("div",{children:[r.jsx("div",{style:et.label,children:""}),r.jsx("div",{style:et.contributorRow,children:p.map(f=>{var c,u,x;return r.jsxs("div",{style:et.contributorCard,children:[r.jsx("div",{style:{...et.contributorBadge,color:((c=f.influence)==null?void 0:c.color)||"#fff"},children:(u=f.influence)==null?void 0:u.label}),r.jsx("div",{style:et.contributorName,children:f.name}),r.jsx("div",{style:et.contributorScore,children:((x=f.influence)==null?void 0:x.score)||0})]},f.id)})})]}),r.jsx("button",{onClick:t,disabled:!a,style:{...et.actionBtn,background:a?"linear-gradient(120deg, #ffb300, #ff7043)":"#455a64"},children:s?a?` ${s.name}`:"":""})]})},et={wrapper:{background:"linear-gradient(135deg, #1f1f2b 0%, #2f2f44 100%)",borderRadius:16,padding:20,color:"#eceff1",marginBottom:20,border:"1px solid rgba(255,255,255,0.1)"},headerRow:{display:"flex",justifyContent:"space-between",gap:20,flexWrap:"wrap"},label:{fontSize:12,letterSpacing:1,textTransform:"uppercase",color:"#90a4ae"},currentTier:{fontSize:24,fontWeight:700},desc:{marginTop:4,fontSize:13,color:"#b0bec5"},metricsBox:{display:"flex",gap:12,flexWrap:"wrap",justifyContent:"flex-end"},metricItem:{minWidth:90,padding:"8px 12px",borderRadius:10,background:"rgba(255,255,255,0.08)",textAlign:"center",fontSize:12,display:"flex",flexDirection:"column",gap:4},metricLabel:{color:"#cfd8dc",fontSize:11,letterSpacing:1},metricValue:{fontSize:20,fontWeight:700,color:"#fff"},progressSection:{marginTop:16},nextLabel:{fontSize:14,fontWeight:600},progressHeader:{display:"flex",justifyContent:"space-between",marginBottom:6},progressBarBg:{width:"100%",height:10,borderRadius:999,background:"rgba(255,255,255,0.15)",overflow:"hidden"},progressBarFill:{height:"100%",background:"linear-gradient(90deg, #42a5f5, #7e57c2)"},requirementsGrid:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(150px, 1fr))",gap:12,marginTop:16},requirementCard:{display:"flex",gap:10,alignItems:"center",padding:"10px 12px",borderRadius:12,background:"rgba(255,255,255,0.08)"},requirementBadge:{width:32,height:32,borderRadius:10,display:"flex",alignItems:"center",justifyContent:"center",fontWeight:700,color:"#fff"},requirementLabel:{fontSize:12,color:"#cfd8dc"},requirementValue:{fontSize:14,fontWeight:600},contributorRow:{display:"flex",gap:12,marginTop:8,flexWrap:"wrap"},contributorCard:{flex:"1 1 120px",minWidth:120,background:"rgba(0,0,0,0.25)",borderRadius:12,padding:12},contributorBadge:{fontSize:12,fontWeight:700},contributorName:{marginTop:4,fontSize:16,fontWeight:600},contributorScore:{fontSize:13,color:"#b0bec5"},actionBtn:{width:"100%",marginTop:16,border:"none",borderRadius:999,padding:"12px 0",fontSize:14,fontWeight:600,color:"#1f1f2b",cursor:"pointer"}},pk=["","","",""],fk=["","","","","","","","","","","","","",""],mk=["","","","","","","","","","","","","","","",""],hk=["","","","","",""],gk="init-log",Xa=10,Za=(e="",t=[])=>{if(!e)return!1;const n=String(e);return t.some(s=>s&&n.includes(s))},Od=e=>{if(!e)return"DAILY";const t=e.category||"",n=`${e.title||""}${e.message||""}`;return Za(t,pk)?"WORLD":e.type==="DAILY"||Za(n,hk)?"DAILY":e.id&&e.id.startsWith(gk)||e.turn===0||Za(t,fk)||Za(n,mk)||e.type&&e.type!=="DAILY"?"MAJOR":"DAILY"},xk=({logs:e,ratingSummary:t,onUpgradeRating:n})=>{const[s,o]=y.useState("ALL"),[i,a]=y.useState(()=>new Set),[l,d]=y.useState(0),p=y.useMemo(()=>s==="ALL"?e:e.filter(x=>Od(x)===s),[e,s]),f=y.useMemo(()=>Math.max(1,Math.ceil(p.length/Xa)),[p.length]),c=y.useMemo(()=>{const x=l*Xa;return p.slice(x,x+Xa)},[p,l]),u=y.useMemo(()=>{const x={all:e.length,daily:0,major:0,world:0};return e.forEach(S=>{const w=Od(S);w==="WORLD"?x.world+=1:w==="MAJOR"?x.major+=1:x.daily+=1}),x},[e]);return y.useEffect(()=>{d(0)},[s,e.length]),r.jsxs("div",{style:st.container,children:[t&&r.jsx("div",{style:st.ratingSection,children:r.jsx(uk,{summary:t,onUpgrade:n})}),r.jsx("h3",{style:st.title,children:" "}),r.jsxs("div",{style:st.filterBar,children:[r.jsxs("button",{style:{...st.filterBtn,...s==="ALL"?st.filterBtnActive:{}},onClick:()=>o("ALL"),children:["  (",u.all,")"]}),r.jsxs("button",{style:{...st.filterBtn,...s==="DAILY"?st.filterBtnActive:{}},onClick:()=>o("DAILY"),children:["  (",u.daily,")"]}),r.jsxs("button",{style:{...st.filterBtn,...s==="MAJOR"?st.filterBtnActive:{}},onClick:()=>o("MAJOR"),children:["  (",u.major,")"]}),r.jsxs("button",{style:{...st.filterBtn,...s==="WORLD"?st.filterBtnActive:{}},onClick:()=>o("WORLD"),children:["  (",u.world,")"]})]}),r.jsxs("div",{style:st.logWindow,children:[p.length===0?r.jsx("p",{style:{color:"#999"},children:"..."}):null,c.map((x,S)=>{const w=Od(x),C=w==="WORLD",h=w==="MAJOR";let g="",b="#8B4513";C?(g=ck(x.type),b=dk(x.type)):h&&(g="",b="#b45309");const E=x.id||`${x.turn}-${S+l*Xa}`,I=!!x.details,v=I&&i.has(E),k=x.title||x.message||"",T=()=>{I&&a(Q=>{const L=new Set(Q);return L.has(E)?L.delete(E):L.add(E),L})},A=3572,R=x.turn||0,$=A+Math.floor(R/12),O=R%12||12;return r.jsxs("div",{style:st.logItem,children:[r.jsxs("div",{style:st.logHeader,children:[r.jsxs("span",{style:{...st.turn,color:b},children:[g," [ ",$," ",O,"]"]}),(C||h)&&x.title&&r.jsx("span",{style:st.eventTag,children:x.title})]}),I?r.jsxs(r.Fragment,{children:[r.jsxs("div",{style:st.summaryRow,children:[r.jsx("span",{style:st.summaryText,children:k}),r.jsx("button",{style:st.toggleBtn,onClick:T,children:v?"":""})]}),v&&r.jsx("div",{style:st.detailContent,children:x.details})]}):r.jsx("div",{style:st.logContent,children:x.message})]},E)})]}),r.jsxs("div",{style:st.footer,children:[r.jsxs("div",{style:st.paginationBar,children:[r.jsx("button",{style:{...st.pageBtn,...l<=0?st.pageBtnDisabled:{}},onClick:()=>d(x=>Math.max(0,x-1)),disabled:l<=0,children:""}),r.jsxs("span",{style:st.pageInfo,children:[" ",l+1," / ",f," "]}),r.jsx("button",{style:{...st.pageBtn,...l>=f-1?st.pageBtnDisabled:{}},onClick:()=>d(x=>Math.min(f-1,x+1)),disabled:l>=f-1,children:""})]}),r.jsxs("span",{style:{fontSize:"11px",color:"#666"},children:[" ",p.length," "]})]})]})},st={container:{width:"calc(100% - 30px)",maxWidth:"800px",margin:"20px auto 150px auto",border:"1px solid #ccc",borderRadius:"8px",backgroundColor:"#fff",fontFamily:'"KaiTi", serif',display:"flex",flexDirection:"column",minHeight:"500px",pointerEvents:"auto"},ratingSection:{padding:"12px",borderBottom:"1px solid rgba(0,0,0,0.05)"},title:{margin:"0",padding:"10px",backgroundColor:"#f5f5f5",borderBottom:"1px solid #eee",fontSize:"16px"},filterBar:{display:"flex",gap:"5px",padding:"8px",backgroundColor:"#fafafa",borderBottom:"1px solid #eee",pointerEvents:"auto"},filterBtn:{flex:1,padding:"6px 8px",fontSize:"12px",border:"1px solid #ddd",borderRadius:"4px",backgroundColor:"#fff",cursor:"pointer",transition:"all 0.2s",fontFamily:"inherit",pointerEvents:"auto"},filterBtnActive:{backgroundColor:"#4A90E2",color:"#fff",border:"1px solid #4A90E2",fontWeight:"bold"},logWindow:{flex:1,minHeight:"300px",maxHeight:"500px",overflowY:"auto",padding:"10px",fontSize:"13px",pointerEvents:"auto"},logItem:{marginBottom:"10px",borderBottom:"1px dashed #eee",paddingBottom:"6px",pointerEvents:"auto"},logHeader:{display:"flex",alignItems:"center",gap:"6px",marginBottom:"3px",pointerEvents:"auto"},turn:{fontWeight:"bold",fontSize:"12px"},eventTag:{fontSize:"10px",padding:"2px 6px",backgroundColor:"#f0f0f0",borderRadius:"3px",color:"#666"},logContent:{lineHeight:"1.5",color:"#333",whiteSpace:"pre-wrap"},summaryRow:{display:"flex",justifyContent:"space-between",alignItems:"center",gap:"8px",padding:"4px 0",pointerEvents:"auto"},summaryText:{fontWeight:600,fontSize:"13px",flex:1,color:"#333",pointerEvents:"auto"},toggleBtn:{border:"1px solid #ccc",borderRadius:"999px",padding:"2px 10px",backgroundColor:"#fff",fontSize:"11px",cursor:"pointer",pointerEvents:"auto"},detailContent:{lineHeight:"1.6",color:"#444",backgroundColor:"#fafafa",borderRadius:"6px",padding:"8px 10px",border:"1px solid rgba(0,0,0,0.05)",whiteSpace:"pre-wrap",pointerEvents:"auto"},footer:{padding:"12px 10px",backgroundColor:"#f5f5f5",borderTop:"2px solid #d32f2f",textAlign:"center",pointerEvents:"auto",flexShrink:0,minHeight:"60px",display:"flex",flexDirection:"column",justifyContent:"center",gap:"6px"},paginationBar:{display:"flex",justifyContent:"center",alignItems:"center",gap:"10px",marginBottom:"6px"},pageBtn:{padding:"6px 14px",border:"2px solid #d32f2f",borderRadius:"6px",backgroundColor:"#fff",cursor:"pointer",fontSize:"13px",fontWeight:"bold",color:"#d32f2f",transition:"all 0.2s",pointerEvents:"auto"},pageBtnDisabled:{backgroundColor:"#f0f0f0",cursor:"not-allowed",color:"#999",borderColor:"#ccc"},pageInfo:{fontSize:"12px",color:"#666"}};class Lr{static onChildBirth(t,n,s={}){pn(t);const o=Sm(t,n,s);return Ds(t,{description:`${n.name}`,affectionChange:0,context:`${s.difficulty===""?"":""}`}),console.log(`[] ${t.name} : ${n.name}`),o}static onMarriage(t,n=""){pn(t);const s=yw(t,n);return Ds(t,{description:"",affectionChange:30,context:""}),console.log(`[] ${t.name} `),s}static onReceiveGift(t,n,s){pn(t);const o=Ds(t,{description:`${n.name}`,affectionChange:s,context:n.tier>=3?"":""});return Math.abs(s)>=20&&mo(t,{event:`${n.name}`,detail:`${n.name}`,emotionalImpact:xs.SIGNIFICANT,category:"relationship",tags:["",n.name,""]}),o}static onCombatTogether(t,n,s=!1){return pn(t),s?bw(t,`${n}`):Ds(t,{description:`${n}`,affectionChange:5,context:""})}static onBreakthrough(t,n){return pn(t),mo(t,{event:`${n}`,detail:`${n}`,emotionalImpact:xs.PROFOUND,category:"cultivation",tags:["","",n]})}static onPregnancyStart(t){return pn(t),Ds(t,{description:"",affectionChange:15,context:""})}static onChildJoinSect(t,n,s){return pn(t),Ds(t,{description:`${n.name}${s}`,affectionChange:0,context:""})}static onChildMarriage(t,n,s){return pn(t),mo(t,{event:`${n.name}`,detail:`${n.name}${s}`,emotionalImpact:xs.SIGNIFICANT,category:"family",tags:["","",n.name]})}static initializeAllNpcs(t){t.forEach(n=>{pn(n)}),console.log(`[]  ${t.length}  NPC `)}static backfillChildrenMemories(t,n){pn(t),n.forEach(s=>{t.memories.milestones.some(i=>i.tags.includes(s.name))||(Sm(t,s,{difficulty:"",sacrifice:!1}),console.log(`[]  ${t.name}  ${s.name} `))})}static getMemorySummary(t){return t.memories||pn(t),{milestoneCount:t.memories.milestones.length,milestones:t.memories.milestones,recentEventCount:t.memories.recentEvents.length,recentEvents:t.memories.recentEvents,longTermSummary:t.memories.longTermSummary,totalEvents:t.memories.meta.totalEvents}}static clearAllMemories(t){t.memories&&(t.memories.milestones=[],t.memories.recentEvents=[],t.memories.longTermSummary="",t.memories.meta.totalEvents=0,console.log(`[]  ${t.name} `))}}const yk=e=>{const{identity:t,personality:n,stats:s,relationship:o}=e,i=typeof n=="object"&&n!==null&&"label"in n?n.label:Array.isArray(n)?n[0]:"",a=s.aptitude&&s.aptitude>=90,l=(o==null?void 0:o.jealousy)||0;if(l>=60)return Dd(e,l,i);if(l>=40&&Math.random()<.5)return Dd(e,l,i);if(l>=20&&Math.random()<.2)return Dd(e,l,i);if(a){const f=["","",""];return f[Math.floor(Math.random()*f.length)]}const d={:["","","",""],:["","","",""],:["","","",""],:["","","",""],:["","","",""],:["","","",""],:["","","",""],:["","","",""],:["","","",""],:["","","",""],:["","","",""],:["","","",""],:["","","",""],:["","","",""],:["","","",""],:["","","",""],:["","","",""],:["","","",""],:["","","",""],:["","","",""]};if(Math.random()>.5||!d[t])switch(i){case"":return"";case"":return"";case"":return"";case"":return"";case"":return"";case"":return"";default:return""}const p=d[t]||[""];return p[Math.floor(Math.random()*p.length)]},bk=(e,t)=>{const n=typeof e.personality=="object"&&e.personality!==null&&"label"in e.personality?e.personality.label:Array.isArray(e.personality)?e.personality[0]:"",s=e.likes&&e.likes.includes(t.name);let o=t.value,i="";if(e.identity==="")return t.name&&/|||/i.test(t.name)||t.tags&&t.tags.includes("scripture")?(o=Math.floor(t.value*3),i=`${e.name} `,{msg:i,change:o}):{msg:`${e.name} `,change:0};if(t.value<10&&(["","",""].includes(n)||[""].includes(e.identity)))return{msg:`${e.name} ${t.name}`,change:-5};if(s)o*=2,i=`${e.name} ${t.name}`;else if(n===""&&t.cost>=300)o*=1.5,i=`${e.name} ${t.name}`;else switch(n){case"":i=`${e.name} `;break;case"":i=`${e.name} `;break;case"":i=`${e.name} `;break;default:i=`${e.name} ${t.name}`}return{msg:i,change:Math.floor(o)}},vk=[{title:"",text:e=>`${e}${e}""`,affectionBonus:5},{title:"",text:e=>`${e}${e}""`,affectionBonus:5},{title:"",text:e=>`${e}${e}""`,affectionBonus:8},{title:"",text:e=>`${e}${e}""`,affectionBonus:6},{title:"",text:e=>`${e}${e}${e}""`,affectionBonus:10},{title:"",text:e=>`${e}"......"${e}""`,affectionBonus:12,requirePregnant:!0},{title:"",text:e=>`${e}${e}"..."${e}"..."`,affectionBonus:13,requirePregnant:!0}],Sk=[{title:"",text:e=>`${e}${e}""`,affectionBonus:6},{title:"",text:e=>`${e}${e}${e}""`,affectionBonus:7},{title:"",text:e=>`""${e}""`,affectionBonus:8},{title:"",text:e=>`${e}${e}""`,affectionBonus:7},{title:"",text:e=>`${e}""${e}""`,affectionBonus:5},{title:"",text:e=>`${e}"......"`,affectionBonus:10,requirePregnant:!0},{title:"",text:e=>`${e}"..."${e}"..."`,affectionBonus:11,requirePregnant:!0}],qm=[{title:"",text:e=>`${e}${e}""`,affectionBonus:6},{title:"",text:e=>`${e}""`,affectionBonus:7},{title:"",text:e=>`${e}""`,affectionBonus:8},{title:"",text:e=>`${e}""`,affectionBonus:5},{title:"",text:e=>`${e}${e}""`,affectionBonus:9},{title:"",text:e=>`${e}"..."`,affectionBonus:12,requirePregnant:!0},{title:"",text:e=>`${e}"..."${e}"..."`,affectionBonus:14,requirePregnant:!0}],wk=[{title:"",text:e=>`${e}${e}""`,affectionBonus:6},{title:"",text:e=>`${e}""`,affectionBonus:7},{title:"",text:e=>`${e}""${e}`,affectionBonus:6},{title:"",text:e=>`${e}${e}""`,affectionBonus:5},{title:"",text:e=>`${e}${e}""`,affectionBonus:8},{title:"",text:e=>`${e}"......"`,affectionBonus:13,requirePregnant:!0},{title:"",text:e=>`${e}"...""..."`,affectionBonus:12,requirePregnant:!0}],Km=[{title:"",text:(e,t)=>`${e}""`,affectionBonus:8},{title:"",text:(e,t)=>`${e}""`,affectionBonus:10},{title:"",text:(e,t)=>`${e}${e}""`,affectionBonus:7},{title:"",text:(e,t)=>`${e}""`,affectionBonus:6},{title:"",text:(e,t)=>`${e}${e}""`,affectionBonus:9}],Ek=[{title:"",text:(e,t)=>`${e}${e}""`,affectionBonus:8},{title:"",text:(e,t)=>`${e}${e}"${t===""?"":""}"`,affectionBonus:6},{title:"",text:(e,t)=>`${e}""`,affectionBonus:10},{title:"",text:(e,t)=>`${e}""${e}`,affectionBonus:4},{title:"",text:(e,t)=>`${e}""`,affectionBonus:9}],kk=[{title:"",text:(e,t)=>`${e}${e}""`,affectionBonus:10},{title:"",text:(e,t)=>`${e}""`,affectionBonus:12},{title:"",text:(e,t)=>`${e}${e}${e}""`,affectionBonus:15},{title:"",text:(e,t)=>`${e}""`,affectionBonus:11},{title:"",text:(e,t)=>`${e}""`,affectionBonus:10}],Qm=(e,t)=>{let n=qm;switch(e){case"COLD":n=vk;break;case"YANDERE":n=Sk;break;case"GENTLE":n=qm;break;case"FLIRTY":n=wk;break}const s=n.filter(i=>!(i.requirePregnant&&!t.isPregnant));if(s.length===0)return null;const o=s[Math.floor(Math.random()*s.length)];return{title:o.title,text:o.text(t.name),affectionBonus:o.affectionBonus}},jk=(e,t,n="")=>{let s=Km;switch(e){case"TODDLER":s=Km;break;case"TEEN":s=Ek;break;case"ADULT":s=kk;break}const o=s[Math.floor(Math.random()*s.length)];return{title:o.title,text:o.text(t.name,n),affectionBonus:o.affectionBonus}},Ck=[{title:"",text:e=>`${e}""`,affectionBonus:5},{title:"",text:e=>`${e}""`,affectionBonus:7},{title:"",text:e=>`${e}${e}${e}""`,affectionBonus:10}],Tk=[{title:"",text:e=>`${e}${e}""`,affectionBonus:4},{title:"",text:e=>`${e}""`,affectionBonus:8},{title:"",text:e=>`${e}${e}${e}""`,affectionBonus:9}],Ik=[{title:"",text:e=>`${e}${e}${e}""`,affectionBonus:10},{title:"",text:e=>`${e}""`,affectionBonus:12},{title:"",text:e=>`${e}${e}""`,affectionBonus:8}],_k=[{title:"",text:e=>`${e}${e}""`,affectionBonus:6},{title:"",text:e=>`${e}${e}"..."`,affectionBonus:5,minAffection:40},{title:"",text:e=>`${e}""`,affectionBonus:10,minAffection:60},{title:"",text:e=>`${e}${e}"..."`,affectionBonus:8,minAffection:70},{title:"",text:e=>`${e}""${e}""`,affectionBonus:15,minAffection:80},{title:"",text:e=>`${e}"..."${e}`,affectionBonus:12,minAffection:85},{title:"",text:e=>`${e}${e}"......"${e}`,affectionBonus:20,minAffection:90},{title:"",text:e=>`${e}"..."${e}`,affectionBonus:15,minAffection:95}],Rk=[{title:"",text:e=>`${e}${e}${e}""`,affectionBonus:10},{title:"",text:e=>`${e}${e}${e}${e}""`,affectionBonus:8},{title:"",text:e=>`${e}""${e}`,affectionBonus:15}],Mk=[{title:"",text:e=>`${e}${e}""`,affectionBonus:5},{title:"",text:e=>`${e}${e}${e}""`,affectionBonus:9},{title:"",text:e=>`${e}${e}""`,affectionBonus:11}],Ak=[{title:"",text:e=>`${e}${e}""`,affectionBonus:12},{title:"",text:e=>`${e}${e}""`,affectionBonus:10},{title:"",text:e=>`${e}${e}${e}${e}""`,affectionBonus:8}],Pd=(e,t)=>{var a;let n=[];switch(e){case"":n=Ck;break;case"":n=Tk;break;case"":case"":n=Ik;break;case"":n=_k;break;case"":n=Rk;break;case"":n=Mk;break;case"":n=Ak;break;default:return null}if(n.length===0)return null;const s=((a=t.relationship)==null?void 0:a.affection)||0,o=n.filter(l=>!(l.minAffection&&s<l.minAffection));if(o.length===0)return null;const i=o[Math.floor(Math.random()*o.length)];return{title:i.title,text:i.text(t.name),affectionBonus:i.affectionBonus}},zd=(e,t)=>{var a;if(e.isChild){if(Math.random()<.25){let l="TODDLER";return e.age>=18?l="ADULT":e.age>=11&&(l="TEEN"),jk(l,e,(t==null?void 0:t.gender)||"")}return null}if(Math.random()>=.3)return null;const s=((a=e.relationship)==null?void 0:a.affection)||0,o=typeof e.personality=="object"&&e.personality!==null&&"label"in e.personality?e.personality.label:Array.isArray(e.personality)?e.personality[0]:"";if(s>=80){if(Math.random()<.7){let d="GENTLE";return["","","",""].includes(o)?d="COLD":["","","",""].includes(o)?d="YANDERE":["","","",""].includes(o)?d="FLIRTY":["","","","",""].includes(o)&&(d="GENTLE"),Qm(d,e)}const l=Pd(e.identity,e);return l||null}if(s>=60){if(Math.random()<.5){let d="GENTLE";return["","","",""].includes(o)?d="COLD":["","","",""].includes(o)?d="YANDERE":["","","",""].includes(o)?d="FLIRTY":["","","","",""].includes(o)&&(d="GENTLE"),Qm(d,e)}const l=Pd(e.identity,e);return l||null}const i=Pd(e.identity,e);return i||null};function Dd(e,t,n){if(e.name,t>=61){const i={:["...","...","..."],:["","...",""],:["...","",""],:["......","...","......"],:["...","...","..."],:["...","","..."]},a=i[n]||i.;return a[Math.floor(Math.random()*a.length)]}if(t>=41){const i={:["...","...","..."],:["","","..."],:["...","","..."],:["...","","......"],:["...","...","..."],:["","...","..."]},a=i[n]||i.;return a[Math.floor(Math.random()*a.length)]}const s={:["...","...","..."],:["","","..."],:["...","","..."],:["...","......","..."],:["","","..."],:["","","..."]},o=s[n]||s.;return o[Math.floor(Math.random()*o.length)]}const Nk=(e,t,n)=>{const s=typeof e.personality=="object"&&e.personality!==null&&"label"in e.personality?e.personality.label:Array.isArray(e.personality)?e.personality[0]:"",o=e.identity||"",i=e.name;return n?Lk(i,s,o,t):$k(i,s,o,t)};function Lk(e,t,n,s){var d;const o=`${t}_${n}_${s.id}`,i=Fs[o];if(i)return i(e);const a=Fs[`${t}_${s.id}`];if(a)return a(e);const l=Fs[`${n}_${s.id}`];return l?l(e):((d=Fs[`default_${s.id}`])==null?void 0:d.call(Fs,e))||`${e} ""`}const Fs={_PROFIT:e=>`${e} ""`,__PROFIT:e=>`${e} ""`,__PROFIT:e=>`${e} ""`,__PROFIT:e=>`${e} ""`,_PROFIT:e=>`${e} ""`,__PROFIT:e=>`${e} ""`,__PROFIT:e=>`${e} ""`,__PROFIT:e=>`${e} ""`,_PROFIT:e=>`${e} ""`,__PROFIT:e=>`${e} ""`,__PROFIT:e=>`${e} ""`,_PROFIT:e=>`${e} ""`,__PROFIT:e=>`${e} ""`,_PROFIT:e=>`${e} ""`,__PROFIT:e=>`${e} "~"`,_PROFIT:e=>`${e} ""`,__PROFIT:e=>`${e} ""`,_PROFIT:e=>`${e} ""`,__PROFIT:e=>`${e} ""`,_PROFIT:e=>`${e} "''"`,__PROFIT:e=>`${e} ""`,_PROFIT:e=>`${e} ""`,__PROFIT:e=>`${e} ""`,_PROFIT:e=>`${e} ""`,_PROFIT:e=>`${e} "~"`,_PROFIT:e=>`${e} ""`,_PROFIT:e=>`${e} "~"`,_PROFIT:e=>`${e} ""`,_PROFIT:e=>`${e} ""`,_PROFIT:e=>`${e} ""`,_PROFIT:e=>`${e} "~"`,_EMOTION:e=>`${e} """"`,__EMOTION:e=>`${e} ""`,__EMOTION:e=>`${e} ""`,_EMOTION:e=>`${e} ""`,__EMOTION:e=>`${e} ""`,__EMOTION:e=>`${e} ""`,_EMOTION:e=>`${e} ""`,__EMOTION:e=>`${e} ""`,_EMOTION:e=>`${e} ""`,__EMOTION:e=>`${e} ""`,_EMOTION:e=>`${e} ""`,__EMOTION:e=>`${e} ""`,_EMOTION:e=>`${e} ""`,__EMOTION:e=>`${e} ""`,_EMOTION:e=>`${e} ""`,__EMOTION:e=>`${e} ""`,_EMOTION:e=>`${e} ""`,_EMOTION:e=>`${e} ""`,_EMOTION:e=>`${e} ""`,_EMOTION:e=>`${e} "~"`,_EMOTION:e=>`${e} ""`,_EMOTION:e=>`${e} "~"`,_EMOTION:e=>`${e} ""`,_EMOTION:e=>`${e} ""`,_EMOTION:e=>`${e} ""`,_REASON:e=>`${e} ""`,__REASON:e=>`${e} ""`,_REASON:e=>`${e} ""`,__REASON:e=>`${e} ""`,__REASON:e=>`${e} ""`,_REASON:e=>`${e} ""`,__REASON:e=>`${e} ""`,_REASON:e=>`${e} ""`,_REASON:e=>`${e} ""`,_REASON:e=>`${e} ""`,_REASON:e=>`${e} "~"`,_REASON:e=>`${e} ""`,_REASON:e=>`${e} ""`,_REASON:e=>`${e} ""`,_REASON:e=>`${e} "~"`,_REASON:e=>`${e} ""`,_REASON:e=>`${e} ""`,_REASON:e=>`${e} ""`,_REASON:e=>`${e} ""`,_EMOTION:e=>`${e} ""`,_REASON:e=>`${e} ""`,_EMOTION:e=>`${e} ""`,_REASON:e=>`${e} ""`,_EMOTION:e=>`${e} ""`,_REASON:e=>`${e} ""`,_EMOTION:e=>`${e} ""`,_REASON:e=>`${e} ""`,_EMOTION:e=>`${e} ""`,_PROFIT:e=>`${e} ""`,_EMOTION:e=>`${e} ""`,_REASON:e=>`${e} ""`,_EMOTION:e=>`${e} ""`,_REASON:e=>`${e} ""`,_EMOTION:e=>`${e} ""`,_EMOTION:e=>`${e} ""`,_REASON:e=>`${e} ""`,_REASON:e=>`${e} ""`,_EMOTION:e=>`${e} ""`,default_PROFIT:e=>`${e} ""`,default_EMOTION:e=>`${e} ""`,default_REASON:e=>`${e} ""`};function $k(e,t,n,s){var d;const o=`${t}_${n}_${s.id}`,i=Hs[o];if(i)return i(e);const a=Hs[`${t}_${s.id}`];if(a)return a(e);const l=Hs[`${n}_${s.id}`];return l?l(e):((d=Hs[`default_${s.id}`])==null?void 0:d.call(Hs,e))||`${e} ""`}const Hs={_PROFIT:e=>`${e} ""`,__PROFIT:e=>`${e} ""`,__PROFIT:e=>`${e} ""`,_PROFIT:e=>`${e} ""`,__PROFIT:e=>`${e} ""`,_PROFIT:e=>`${e} ""`,__PROFIT:e=>`${e} ""`,_PROFIT:e=>`${e} ""`,__PROFIT:e=>`${e} ""`,_PROFIT:e=>`${e} ""`,_REASON:e=>`${e} ""`,_PROFIT:e=>`${e} ""`,_PROFIT:e=>`${e} ""`,_PROFIT:e=>`${e} ""`,_PROFIT:e=>`${e} "~~"`,_PROFIT:e=>`${e} ""`,_PROFIT:e=>`${e} ""`,_PROFIT:e=>`${e} ""`,_PROFIT:e=>`${e} ""`,_PROFIT:e=>`${e} ""`,_PROFIT:e=>`${e} :""`,_PROFIT:e=>`${e} :""`,_PROFIT:e=>`${e} :"~"`,_EMOTION:e=>`${e} ""`,__EMOTION:e=>`${e} ""`,__EMOTION:e=>`${e} ""`,_EMOTION:e=>`${e} ""`,__EMOTION:e=>`${e} ""`,_EMOTION:e=>`${e} ""`,__EMOTION:e=>`${e} ""`,_EMOTION:e=>`${e} ""`,__EMOTION:e=>`${e} ""`,_EMOTION:e=>`${e} ""`,__EMOTION:e=>`${e} ""`,_EMOTION:e=>`${e} ""`,__EMOTION:e=>`${e} ""`,_EMOTION:e=>`${e} ""`,_EMOTION:e=>`${e} ""`,_EMOTION:e=>`${e} ""`,_EMOTION:e=>`${e} "~"`,_EMOTION:e=>`${e} ""`,_EMOTION:e=>`${e} ""`,_EMOTION:e=>`${e} ""`,_EMOTION:e=>`${e} ""`,_EMOTION:e=>`${e} ""`,_EMOTION:e=>`${e} ""`,_EMOTION:e=>`${e} "~"`,_REASON:e=>`${e} ""`,__REASON:e=>`${e} ""`,_REASON:e=>`${e} ""`,__REASON:e=>`${e} ""`,_REASON:e=>`${e} ""`,_REASON:e=>`${e} ""`,_REASON:e=>`${e} ""`,_REASON:e=>`${e} ""`,_REASON:e=>`${e} ""`,_EMOTION:e=>`${e} ""`,_REASON:e=>`${e} ""`,_REASON:e=>`${e} "~"`,_REASON:e=>`${e} ""`,_REASON:e=>`${e} ""`,_REASON:e=>`${e} ""`,_REASON:e=>`${e} ""`,_REASON:e=>`${e} ""`,_REASON:e=>`${e} :""`,_REASON:e=>`${e} "~"`,_PROFIT:e=>`${e} ""`,_REASON:e=>`${e} ""`,_PROFIT:e=>`${e} ""`,_REASON:e=>`${e} ""`,_EMOTION:e=>`${e} ""`,_REASON:e=>`${e} ""`,_PROFIT:e=>`${e} ""`,_EMOTION:e=>`${e} ""`,_EMOTION:e=>`${e} ""`,_PROFIT:e=>`${e} ""`,default_PROFIT:e=>`${e} ""`,default_EMOTION:e=>`${e} ""`,default_REASON:e=>`${e} ""`},pi={NONE:{min:0,max:20,label:"",color:"#4caf50"},LOW:{min:21,max:40,label:"",color:"#8bc34a"},MEDIUM:{min:41,max:60,label:"",color:"#ff9800"},HIGH:{min:61,max:80,label:"",color:"#ff5722"},EXTREME:{min:81,max:100,label:"",color:"#f44336"}};function Bk(e=0){return e<=20?pi.NONE:e<=40?pi.LOW:e<=60?pi.MEDIUM:e<=80?pi.HIGH:pi.EXTREME}function Ok(e,t,n){var p,f;const s=((p=e.relationship)==null?void 0:p.affection)||0;if(s<50)return 0;let i={CHAT:5,GIFT:10,SPAR:8,DUAL_CULTIVATION:30}[n]||5;s>=80?i*=2:s>=70?i*=1.5:s>=60&&(i*=1.2);const a=typeof e.personality=="object"&&e.personality!==null&&"label"in e.personality?e.personality.label:Array.isArray(e.personality)?e.personality[0]:"";return i*={:1.8,:1.6,:1.3,:.8,:1.1,:1.2}[a]||1,(((f=e.relationship)==null?void 0:f.jealousy)||0)>=60&&(i*=1.3),Math.floor(i)}function Pk(e,t,n,s){const o=[],a={CHAT:.12,GIFT:.18,SPAR:.15,DUAL_CULTIVATION:.08}[s]||.05;return n.forEach(l=>{var c;if(l.id===t.id||l.isDead)return;const d=((c=l.relationship)==null?void 0:c.affection)||0;if(d<50)return;let p=a;d>=80?p*=2:d>=70?p*=1.6:d>=60&&(p*=1.3);const f=typeof l.personality=="object"&&l.personality!==null&&"label"in l.personality?l.personality.label:Array.isArray(l.personality)?l.personality[0]:"";(f===""||f==="")&&(p*=1.3),Math.random()<p&&o.push(l)}),o}function zk(e,t){var i,a;const n=((i=e.relationship)==null?void 0:i.affection)||0;if(n<70)return 0;const s=((a=e.relationship)==null?void 0:a.lastInteraction)||0;if(t-s>=3){let l=5;return n>=90?l=10:n>=80&&(l=8),l}return 0}function Dk(e,t){var l;const n=((l=e.relationship)==null?void 0:l.jealousy)||0;if(n===0)return 0;const s=2,o=typeof e.personality=="object"&&e.personality!==null&&"label"in e.personality?e.personality.label:Array.isArray(e.personality)?e.personality[0]:"",a=Math.floor(s*({:.5,:.6,:1.2,:1.5,:.8}[o]||1));return Math.min(a,n)}function Fk(e){const t=e.filter(a=>{var p,f;if(a.isDead)return!1;const l=((p=a.relationship)==null?void 0:p.jealousy)||0,d=((f=a.relationship)==null?void 0:f.affection)||0;return l>=60&&d>=70});if(t.length<2)return null;const i=Math.min(.2,.05+t.length*.05);return Math.random()<i?{type:"SHURA_FIELD",participants:t,triggerChance:i}:null}function Hk(e,t){const n=t.name;t.gender;const s=[...e].sort((u,x)=>{var C,h;const S=((C=u.relationship)==null?void 0:C.jealousy)||0;return(((h=x.relationship)==null?void 0:h.jealousy)||0)-S}),o=s[0],i=s[1],a=s.slice(2),l=typeof o.personality=="object"&&o.personality!==null&&"label"in o.personality?o.personality.label:Array.isArray(o.personality)?o.personality[0]:"",d=typeof i.personality=="object"&&i.personality!==null&&"label"in i.personality?i.personality.label:Array.isArray(i.personality)?i.personality[0]:"";let p="";e.length===2?p=`

${o.name}${i.name}...`:p=`

${o.name}${i.name}${a.length>0?""+a.map(u=>u.name).join(""):""}...`;const f=[];l===""?f.push({speaker:o.name,text:`${n}...`}):l===""?f.push({speaker:o.name,text:`${n}`}):l===""?f.push({speaker:o.name,text:`${n}`}):f.push({speaker:o.name,text:`${n}${i.name}...`}),d===""?f.push({speaker:i.name,text:`${o.name}${n}...`}):d===""?f.push({speaker:i.name,text:`${o.name}${n}`}):d===""?f.push({speaker:i.name,text:`.........${n}...`}):f.push({speaker:i.name,text:`${n}`}),a.length>0&&f.push({speaker:a[0].name,text:`${n}`});const c=[{label:`${o.name}`,hint:`${o.name}`,effect:"FAVOR_NPC1"},{label:`${i.name}`,hint:`${i.name}`,effect:"FAVOR_NPC2"},{label:"",hint:"",effect:"MEDIATE"},{label:"",hint:"",effect:"HONEST"},{label:"",hint:"",effect:"AVOID"}];return{type:"SHURA_FIELD",participants:s,description:p,dialogues:f,options:c}}function fr(e,t,n,s={}){const o=typeof e.personality=="object"&&e.personality!==null&&"label"in e.personality?e.personality.label:Array.isArray(e.personality)?e.personality[0]:"";e.identity;const i=t.name,a=t.gender===""?"":"",l={:`...${i}${i}`,:`...${i}${a}${a}`,:`${i}...`,:`${i}.........`,:`${i}${a}...`,:`${i}...`,:`...${i}""...`,:`${i}......`,:`${i}${a}...`,:`...${i}${a}...`},d={:`${i}...${a}`,:`...${i}...`,:`${i}...${a}`,:`${i}.........`,:`${i}${a}${a}`,:`${i}...`,:`${i}...`,:`${i}...${a}`,:`...${i}...`},p={:`${i}${s.favoredName}...${a}...`,:`${i}${s.favoredName}`,:`${i}${a}...${a}`,:`${i}${s.favoredName}......`,:`${i}${s.favoredName}`,:`${i}......`,:`${i}${s.favoredName}...`,:`${i}...${a}${a}...`,:`${i}${a}${a}`,:`...${i}${s.favoredName}${a}${s.favoredGender===""?"":""}`},f={:`${i}...${a}`,:`${i}...${a}`,:`${i}...`,:`${i}...${a}...`,:`${i}${a}`,:`${i}...`,:`${i}...${a}...`,:`${i}...`},c={:`${i}${a}...${a}`,:`${i}...${a}`,:`${i}...${a}`,:`${i}${a}`,:`${i}${a}...${a}`},u={:`${i}${a}${a}...`,:`${i}${a}`,:`${i}...${a}`,:`${i}${a}${a}`,:`${i}...`,:`${i}...${a}${a}...`},x={:`${i}${a}...${a}`,:`${i}...`,:`${i}...${a}`,:`${i}...${a}...`,:`${i}${a}`,:`${i}......`,:`${i}...${a}...`,:`${i}...${a}...`,:`${i}${a}`,:`${i}...${a}`,:`${i}...${a}${a}...`};let S="";switch(n){case"trigger":S=l[o]||l.;break;case"favored":S=d[o]||d.;break;case"neglected":S=p[o]||p.;break;case"mediate":S=f[o]||f.;break;case"honest_understand":S=c[o]||c.;break;case"honest_angry":S=u[o]||u.;break;case"avoid":S=x[o]||x.;break}return S}function Wk(e,t,n){const s={changes:[],message:"",npcLogs:[]};switch(t.effect){case"FAVOR_NPC1":s.changes.push({npcId:e.participants[0].id,jealousyChange:-20,affectionChange:5}),s.changes.push({npcId:e.participants[1].id,jealousyChange:10,affectionChange:-5}),e.participants.slice(2).forEach(o=>{s.changes.push({npcId:o.id,jealousyChange:10,affectionChange:-3})}),s.message=`${e.participants[0].name}${e.participants[0].gender===""?"":""}...`,s.npcLogs.push({npcId:e.participants[0].id,content:fr(e.participants[0],n,"favored"),type:"DAILY",isSecret:!0}),s.npcLogs.push({npcId:e.participants[1].id,content:fr(e.participants[1],n,"neglected",{favoredName:e.participants[0].name,favoredGender:e.participants[0].gender}),type:"DAILY",isSecret:!0}),e.participants.slice(2).forEach(o=>{s.npcLogs.push({npcId:o.id,content:fr(o,n,"neglected",{favoredName:e.participants[0].name,favoredGender:e.participants[0].gender}),type:"DAILY",isSecret:!0})});break;case"FAVOR_NPC2":s.changes.push({npcId:e.participants[1].id,jealousyChange:-20,affectionChange:5}),s.changes.push({npcId:e.participants[0].id,jealousyChange:10,affectionChange:-5}),e.participants.slice(2).forEach(o=>{s.changes.push({npcId:o.id,jealousyChange:10,affectionChange:-3})}),s.message=`${e.participants[1].name}${e.participants[1].gender===""?"":""}...`,s.npcLogs.push({npcId:e.participants[1].id,content:fr(e.participants[1],n,"favored"),type:"DAILY",isSecret:!0}),s.npcLogs.push({npcId:e.participants[0].id,content:fr(e.participants[0],n,"neglected",{favoredName:e.participants[1].name,favoredGender:e.participants[1].gender}),type:"DAILY",isSecret:!0}),e.participants.slice(2).forEach(o=>{s.npcLogs.push({npcId:o.id,content:fr(o,n,"neglected",{favoredName:e.participants[1].name,favoredGender:e.participants[1].gender}),type:"DAILY",isSecret:!0})});break;case"MEDIATE":e.participants.forEach(o=>{s.changes.push({npcId:o.id,jealousyChange:-10,affectionChange:0})}),s.message="...",e.participants.forEach(o=>{s.npcLogs.push({npcId:o.id,content:fr(o,n,"mediate"),type:"DAILY",isSecret:!0})});break;case"HONEST":e.participants.forEach(o=>{var a;(((a=o.relationship)==null?void 0:a.jealousy)||0)>=80?s.changes.push({npcId:o.id,jealousyChange:5,affectionChange:-3}):s.changes.push({npcId:o.id,jealousyChange:-15,affectionChange:3})}),s.message="...",e.participants.forEach(o=>{var l;const a=(((l=o.relationship)==null?void 0:l.jealousy)||0)>=80?"honest_angry":"honest_understand";s.npcLogs.push({npcId:o.id,content:fr(o,n,a),type:"DAILY",isSecret:!0})});break;case"AVOID":e.participants.forEach(o=>{s.changes.push({npcId:o.id,jealousyChange:5,affectionChange:-8})}),s.message="...",e.participants.forEach(o=>{s.npcLogs.push({npcId:o.id,content:fr(o,n,"avoid"),type:"DAILY",isSecret:!0})});break}return s}const Jm={1:{relation:"",address:""},2:{relation:"",address:""},3:{relation:"",address:""},default:{relation:"",address:""}},ay=(e={},t={})=>{const n=Math.max(1,(e==null?void 0:e.generation)||1);return{...Jm[n]||Jm.default,gender:"female",generation:n}},It={LETTER:"LETTER",OBITUARY:"OBITUARY",DEPARTURE:"DEPARTURE",ACHIEVEMENT:"ACHIEVEMENT"},Cs={PENDING:"PENDING",READY:"READY",READ:"READ"};function ly({type:e,senderId:t,senderName:n,title:s,content:o="",timestamp:i,extras:a={},status:l=Cs.READY,replies:d=[]}){return{id:`msg_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,type:e,senderId:t,senderName:n,title:s,content:o,isRead:l===Cs.READ,status:l,timestamp:i,extras:a,createdAt:Date.now(),replies:d,lastRepliedAt:null}}class Uk{constructor(t=100,n=50){this.messages=[],this.maxMessages=t,this.maxLetters=n,this.recentContents=new Map}addMessage(t){if(t.type===It.LETTER&&t.senderId){if(this.recentContents.get(t.senderId)===t.content)return console.log(`[MessageManager] : ${t.senderName}`),!1;this.recentContents.set(t.senderId,t.content)}return this.messages.unshift(t),this.cleanup(),!0}addReplyToMessage(t,n){const s=this.messages.find(i=>i.id===t);if(!s)return null;const o={id:`reply_${Date.now()}_${Math.random().toString(36).substr(2,6)}`,content:n.content,tone:n.tone||"warm",toneLabel:n.toneLabel||"",sentiment:n.sentiment||"",timestamp:n.timestamp,from:n.from||"",affectionDelta:n.affectionDelta||0,createdAt:Date.now()};return Array.isArray(s.replies)||(s.replies=[]),s.replies.push(o),s.lastRepliedAt=o.timestamp,s.extras&&(s.extras.hasNpcRespondedToReply=!1),{message:s,reply:o}}markAsRead(t){const n=this.messages.find(s=>s.id===t);n&&(n.isRead=!0,n.status=Cs.READ)}getUnreadCount(){return this.messages.filter(t=>!t.isRead&&t.status===Cs.READY).length}getRecentRepliesForNpc(t,n=3){if(!t)return[];const s=[];return this.messages.forEach(o=>{o.senderId===t&&(!Array.isArray(o.replies)||o.replies.length===0||o.replies.forEach(i=>{s.push({messageId:o.id,messageTitle:o.title,content:i.content||"",tone:i.tone,toneLabel:i.toneLabel,timestamp:i.timestamp,createdAt:i.createdAt||0})}))}),s.sort((o,i)=>(i.createdAt||0)-(o.createdAt||0)),s.slice(0,n)}getMessagesByType(t){return this.messages.filter(n=>n.type===t)}getAllMessages(){return[...this.messages]}cleanup(){const t=this.messages.filter(s=>s.type===It.OBITUARY),n=this.messages.filter(s=>s.type!==It.OBITUARY);if(n.length>this.maxLetters){const s=n.slice(0,this.maxLetters);this.messages=[...t,...s]}this.messages.length>this.maxMessages&&(this.messages=this.messages.slice(0,this.maxMessages))}deleteMessage(t){this.messages=this.messages.filter(n=>n.id!==t)}loadFromData(t){this.messages=t||[]}toJSON(){return this.messages}}const Xm={child:(e,t,n)=>{const s=e.age||0,o=Math.floor(s*12),i=e.sect&&e.sect.name,a=e.spouse!==null&&e.spouse!==void 0,l=e.tierTitle||"",{address:d}=ay(e,t),p=d||t.name||"";let f="";if(o<216)i?f=`${e.sect.name}${l}`:f=`${l}`;else if(a&&i){const u=e.sect.name,x=e.spouse.name;f=`${u}${x}${l}`}else if(a){const u=e.spouse.name;f=`${u}${u}`}else i?f=`${e.sect.name}${l}`:f=`${l}`;const c=o<216?"":"";return`${p}

${f}

${e.name} ${c}
 ${n.year} ${n.month}`},spouse:(e,t,n)=>{var p,f,c,u,x;const s=((p=e.relationship)==null?void 0:p.affection)||60,o=((f=e.relationship)==null?void 0:f.jealousy)||0,i=((c=e.trait)==null?void 0:c.name)||"";let a=e.gender==="male"?"":"",l="";o>=60?i.includes("")||i.includes("")?l="...":i.includes("")?l="......":l="":s>=80?i.includes("")||i.includes("")?l="":i.includes("")||i.includes("")?l="...":i.includes("")?l="":l=`${e.tier||""}`:s>=50?l="":l="",(u=e.identity)!=null&&u.includes("")?l+=`

`:(x=e.identity)!=null&&x.includes("")&&(l+=`

`);const d=s>=70?"":"";return`${a}

${l}

${e.name} ${d}
 ${n.year} ${n.month}`},friend:(e,t,n)=>{var l,d;const s=((l=e.relationship)==null?void 0:l.affection)||50,o=((d=e.trait)==null?void 0:d.name)||"";let i="";s>=70?o.includes("")||o.includes("")?i="":o.includes("")||o.includes("")?i="":i="":i="";const a=s>=60?"":"";return`${t.name}

${i}

${e.name} ${a}
 ${n.year} ${n.month}`},default:(e,t,n)=>{var R,$,O,Q,L;const s=typeof((R=e.relationship)==null?void 0:R.affection)=="number"?e.relationship.affection:typeof e.affection=="number"?e.affection:50,o=(($=e.trait)==null?void 0:$.name)||"",i=e.identity||"",a=e.tier||"",l=((O=e.sect)==null?void 0:O.name)||e.sect||"",d=(t==null?void 0:t.name)||"",p=((Q=e.travelLog)==null?void 0:Q.currentPlace)||((L=e.activity)==null?void 0:L.location)||e.currentResidence||l||"",f=s>=60?d:`${d}`,c=s>=85?"":s>=65?"":s>=45?"":"",x=`${p===""?"":`${p}`}${a}`,S=(()=>{const ne=[{keywords:[""],text:""},{keywords:["",""],text:""},{keywords:[""],text:""},{keywords:["",""],text:""},{keywords:[""],text:""},{keywords:[""],text:""},{keywords:["",""],text:""},{keywords:[""],text:""}].find(ae=>ae.keywords.some(Y=>i.includes(Y)));return ne?ne.text:""})(),w=(()=>{var ae;const G=(ae=e.memories)==null?void 0:ae.recentEvents;if(!Array.isArray(G)||G.length===0)return"";const ne=G.slice(-2).map(Y=>((Y==null?void 0:Y.description)||"").trim()).filter(Boolean);return ne.length===0?"":`${ne.join("")}`})(),C=(()=>{var ae;const G=(ae=e.memories)==null?void 0:ae.milestones;if(!Array.isArray(G)||G.length===0)return"";const ne=G[G.length-1];return ne!=null&&ne.event?`${ne.event}`:""})(),h=s>=85?"":s>=65?"":s>=45?"":"",g=o.includes("")?"":o.includes("")||o.includes("")?"":o.includes("")||o.includes("")?"":o.includes("")?"":o.includes("")?"":o.includes("")||o.includes("")?"":o.includes("")?"":"",b=s>=70?"":s>=50?"":"",E=[c,x,S,w,C].filter(Boolean).join(""),I=[h,g,b].filter(Boolean).join(""),v=[E,I].filter(G=>G&&G.trim().length>0).join(`

`),k=s>=80?"":s>=60?"":s>=45?"":"",T=(n==null?void 0:n.year)??"",A=(n==null?void 0:n.month)??"";return`${f}

${v}

${e.name} ${k}
 ${T} ${A}`}},Zm={child:(e,t,n)=>{const s=e.age||0,o=Math.floor(s*12),i=e.sect&&e.sect.name,a=e.spouse!==null&&e.spouse!==void 0,l=e.gender===""?e.motherName?"":"":e.fatherName?"":"";let d="";return o<216?d="......":a?d=`${e.spouse.name}/...`:i?d=`${e.sect.name}...`:d="...",`${l}

${d}

${e.name} 
 ${n.year} ${n.month}`},spouse:(e,t,n)=>{var l,d;const s=((l=e.trait)==null?void 0:l.name)||"",o=((d=e.relationship)==null?void 0:d.affection)||80,i=e.gender==="male"?"":"";let a="";return o>=90?s.includes("")||s.includes("")?a="......":s.includes("")||s.includes("")?a=".........":s.includes("")?a="......":a="...":o>=60?a="...":a="",`${i}

${a}

${e.name} 
 ${n.year} ${n.month}`},friend:(e,t,n)=>{var a,l;const s=((a=e.trait)==null?void 0:a.name)||"",o=((l=e.relationship)==null?void 0:l.affection)||60;let i="";return o>=70?s.includes("")||s.includes("")?i="":s.includes("")||s.includes("")?i="":i="":o>=40?i="":i="",`${t.name}

${i}

${e.name} 
 ${n.year} ${n.month}`},default:(e,t,n)=>{var i;const s=e.affection||((i=e.relationship)==null?void 0:i.affection)||50;let o="";return s>=60?o="":o="",`${t.name}

${o}

${e.name} 
 ${n.year} ${n.month}`}};async function Gk(e,t,n,s="default",o,i={}){var a,l,d,p,f,c,u,x,S,w;try{console.log(" []",{:e.name,ID:e.id,:s,:{fatherName:e.fatherName||"",motherName:e.motherName||"",generation:e.generation||""},children:((a=i.children)==null?void 0:a.some(me=>me.id===e.id))||!1,:t.name});let C="",h="",g="";const b=e.relationship||{},E=b.affection||0,I=b.jealousy||0,v=b.stage||0,k=b.cutTies||!1,T=((l=i.exiledChildren)==null?void 0:l.some(me=>me.id===e.id))||!1;let A="";if((p=(d=e.memories)==null?void 0:d.profile)!=null&&p.firstMeet){const me=new Date(e.memories.profile.firstMeet),$e=Math.floor((new Date-me)/(365.25*24*60*60*1e3));$e>0?A=`
${$e}`:A=`
`}let R="",$="";E>=90?(R="",$=""):E>=70?(R="",$=""):E>=50?(R="",$=""):E>=30?(R="",$=""):(R="",$="");let O="";if(s!=="child"&&e.memories)try{const me=Zx(e,{includeMilestones:!0,includeRecent:!0,maxRecent:5});me&&me.trim().length>0&&(O=`
`+me)}catch(me){console.warn(":",me)}let Q="";const L=Array.isArray(i.replyHistory)?i.replyHistory:[];L.length>0&&(Q=`

${L.map((Me,$e)=>{const je=Me.timestamp,ct=je&&je.year?` ${je.year} ${je.month}`:"",vt=Me.toneLabel||"",De=(Me.content||"").replace(/\s+/g," ").trim(),D=De.length>60?`${De.slice(0,60)}`:De||"";return`${$e+1}. ${ct}  ${vt}${D}`}).join(`
`)}
`);let G="";const ne=((f=e.trait)==null?void 0:f.name)||"";ne.includes("")?G="":ne.includes("")?G="":ne.includes("")?G="":ne.includes("")?G="":ne.includes("")?G="":ne.includes("")?G="":ne.includes("")?G="":ne.includes("")?G="":ne.includes("")?G="":ne.includes("")?G="":ne.includes("")?G="":ne.includes("")?G="":ne.includes("")?G="":ne.includes("")?G="":ne.includes("")?G="":ne.includes("")?G="":ne.includes("")?G="":ne.includes("")?G="":ne.includes("")?G="":ne.includes("")||ne.includes("")?G="":ne.includes("")?G="":G="";let ae="";const Y=e.identity||"";Y.includes("")?ae=`
`:Y.includes("")?ae=`
`:Y.includes("")||Y.includes("")?ae=`
`:Y.includes("")?ae=`
`:Y.includes("")?ae=`
`:Y.includes("")?ae=`
`:Y.includes("")?ae=`
`:Y.includes("")?ae=`
`:Y.includes("")?ae=`
`:Y.includes("")?ae=`
`:Y.includes("")||Y.includes("")?ae=`
`:Y.includes("")?ae=`
`:Y.includes("")||Y.includes("")?ae=`
`:Y.includes("")?ae=`
`:Y.includes("")?ae=`
`:Y.includes("")?ae=`
`:Y.includes("")?ae=`
`:Y.includes("")?ae=`
`:Y.includes("")?ae=`
`:Y.includes("")&&(ae=`
`);let q="normal",ie="";switch(k||T?(q="farewell",g=`

`,k&&(g+=`${t.name}`),T&&(g+="")):I>=80&&s!=="child"?(q="jealous",g=`

${I}${t.name}

""""""""`):I>=60&&s!=="child"?(q="normal",ie="slight_jealous",g=`

${I}`):E>=70&&s==="spouse"?(q="missing",ie="longing",g=`

${E>=90?"":""}`):s==="spouse"&&ve?(q="normal",ie="family"):s==="friend"?(q="normal",ie="sharing"):(q="normal",ie="general"),s){case"child":const me=Math.floor((e.age||0)*12),Me=((c=e.sect)==null?void 0:c.name)||e.sect||"",$e=e.tierTitle||e.tier||"",je=e.spouse!==null&&e.spouse!==void 0,ct=((u=e.spouse)==null?void 0:u.name)||"",vt=Math.max(1,e.generation||1),{relation:De}=ay(e,t),D=e.fatherName||e.motherName||"",Se=!!e.fatherName;let de=`${e.name}${Math.floor(e.age||0)}${$e}
${t.name}${De}`;D&&D!==""&&(de+=`
${D}${Se?"":""}`),Me&&(de+=`
${Me}`),je&&(de+=`
${ct}`),C=de,T?h=`${De}`:me<216?h=`${De}`:h=`${De}`;break;case"spouse":C=`${t.name}${e.name}${e.tier||""}`,k?h="":q==="jealous"?h="":h="";break;case"friend":if(e.fatherName||e.motherName||e.generation||e.parent||e.parentId||((x=t.children)==null?void 0:x.some(Be=>Be.id===e.id))){const Be=(n.year-(e.birthYear||0))*12+(n.month-(e.birthMonth||1)),dt=t.gender===""?"":"";C=`${t.name}${Math.floor(Be/12)}`,Be<216?h=""+dt+"":h=""}else C=`${t.name}${e.name}${e.tier||""}`,k?h="":h="";break;default:C=`${e.name}${e.tier||""}${t.name}`,h=""}let Z="",ve=!1,V="";if(v>=3&&s==="spouse"&&(Z+=`
`),i.dualCultivationCount>0&&s==="spouse"&&(Z+=`
${i.dualCultivationCount}`),i.children&&i.children.length>0){const me=i.children.filter(Me=>Me.fatherName===e.name||Me.motherName===e.name||s==="child"&&Me.parentId===e.id);if(me.length>0){ve=!0;const Me=me.map($e=>$e.name).join("");if(s==="spouse")V=`
${me.length}${Me}`,e.gender===""&&(V+=`
${E>=80?"":E>=60?"":""}`);else if(s==="child"){const $e=me.filter(je=>je.id!==e.id);$e.length>0&&(V=`
${$e.length}${$e.map(je=>je.name).join("")}`)}Z+=V}}let ee="";if(s==="child")ee=`${e.name}${t.name}${q==="farewell"?"":""}


${C}

${h?`
${h}`:""}

${Q?`${Q}
`:""}


- 
- ${e.name}
- ${t.name}${playerRelation}
- ${generation===1?"":generation===2?"":""}
- ${q==="farewell"?"":""}
- 250
- """"""""""
- ${e.name} ${childAge<216?"":""}
 ${n.year} ${n.month}`;else{let me="";ve&&e.gender===""&&(me=""),ee=`${e.name}${t.name}${q==="farewell"?"":""}


${me}${t.name}


${C}
${e.identity||""}
${e.tier||""}
${e.sect?`${e.sect}`:""}


${((S=e.trait)==null?void 0:S.name)||""}${((w=e.trait)==null?void 0:w.description)||""}
${G}


${ae||""}


${E}${R}
${A}${Z}

${Q}${O}${g}


1. 1-2""""
2. ${$}${h}
3. 120-180
4. 
   ${q==="farewell"?"- //":q==="jealous"?'- """"':q==="missing"?"- ":ie==="slight_jealous"?`- 
   - `:ie==="family"?"- ":ie==="sharing"?"- ":`- 
   - `}
   ${ve&&q!=="jealous"?"- ":""}
   ${q!=="jealous"&&q!=="farewell"?`- 
   - `:""}
5. 
6. "${e.name}\\n ${n.year} ${n.month}"`}const he=[{role:"system",content:ee},{role:"user",content:s==="child"?`${e.name}${t.name}${q==="farewell"?"":""} ${n.year} ${n.month}
          

1. """"""""
2. 
3. `:`${e.name}${t.name}${q==="farewell"?"":q==="jealous"?"":q==="missing"?"":""} ${n.year} ${n.month}`}];return await jc(he,o.apiKey,o.apiUrl||"https://api.deepseek.com/chat/completions",{model:o.apiModel||"deepseek-chat",temperature:.9,maxTokens:350})}catch(C){return console.error("AI:",C),Xu(e,t,n,s)}}function Xu(e,t,n,s="default"){var i;return s==="friend"&&(e.fatherName||e.motherName||e.generation||e.parent||e.parentId||(i=t.children)!=null&&i.some(l=>l.id===e.id))&&(s="child"),(Xm[s]||Xm.default)(e,t,n)}function Vk(e,t,n,s="default"){var i;return s==="friend"&&(e.fatherName||e.motherName||e.generation||e.parent||e.parentId||(i=t.children)!=null&&i.some(l=>l.id===e.id))&&(s="child"),(Zm[s]||Zm.default)(e,t,n)}function Yk(e,t=3,n=null){var l,d,p,f,c,u;if(!e||e.acceptsLetters===!1)return!1;const s=typeof((l=e.relationship)==null?void 0:l.affection)=="number"?e.relationship.affection:void 0,o=typeof e.affection=="number"?e.affection:s;if(!e.isChild&&typeof o=="number"&&o<100||n&&((d=n.extras)==null?void 0:d.hasNpcRespondedToReply)===!0&&(!(n.replies&&n.replies.length>0)||n.extras.hasNpcRespondedToReply===!0)||t<3)return!1;let i=.3;const a=typeof o=="number"?o:0;return a>80?i+=.3:a>60?i+=.2:a>40&&(i+=.1),((p=e.traits)!=null&&p.includes("")||(f=e.traits)!=null&&f.includes(""))&&(i+=.2),((c=e.traits)!=null&&c.includes("")||(u=e.traits)!=null&&u.includes(""))&&(i-=.2),Math.random()<Math.max(.1,Math.min(.9,i))}function cy(e,t){var n,s;return e.id===((n=t.spouse)==null?void 0:n.id)?"spouse":(s=t.children)!=null&&s.some(o=>o.id===e.id)||e.isChild===!0||e.fatherName||e.motherName||e.generation||e.parent||e.parentId?"child":e.affection>60?"friend":"default"}function qk(e,t,n){const s=cy(e,t),o=Vk(e,t,n,s);let i="";return s==="child"?i=`${e.name}`:s==="spouse"?i=`${e.name}`:s==="friend"&&(i=`${e.name}`),ly({type:It.OBITUARY,senderId:e.id,senderName:e.name,title:i,content:o,timestamp:{...n},extras:{npcId:e.id,relation:s,deathCause:e.deathCause||""},status:Cs.READY})}async function eh(e,t,n,s=!0,o={},i={}){const a=cy(e,t),l=Array.isArray(i.replyHistory)?i.replyHistory:[],d=l[0],p=l.length>0,f=p&&((d==null?void 0:d.content)||"").replace(/\s+/g," ").trim().slice(0,40)||"";let c="";a==="child"?c="":a==="spouse"?c="":a==="friend"&&(c="");let u="";if(s)if(o.useAIForLetter&&o.apiKey&&o.apiKey.trim().length>0)try{u=await Gk(e,t,n,a,o,i)}catch(w){console.error("AI:",w),u=Xu(e,t,n,a)}else u=Xu(e,t,n,a);return ly({type:It.LETTER,senderId:e.id,senderName:e.name,title:`${e.name}${c}`,content:u,timestamp:{...n},extras:{npcId:e.id,relation:a,...p?{isReplyToPlayer:!0,replySourceCount:l.length,replySourceTone:(d==null?void 0:d.toneLabel)||"",replySourceSnippet:f,replySourceTimestamp:(d==null?void 0:d.timestamp)||null,hasNpcRespondedToReply:!0}:{}},status:s?Cs.READY:Cs.PENDING})}const fi=[{id:"warm",label:"",desc:"",affectionDelta:5},{id:"calm",label:"",desc:"",affectionDelta:3},{id:"firm",label:"",desc:"",affectionDelta:-2}],Kk=({isOpen:e,onClose:t,messages:n,onMarkAsRead:s,onDeleteMessage:o,onSendReply:i})=>{var $,O,Q;const[a,l]=y.useState(null),[d,p]=y.useState("all"),[f,c]=y.useState(""),[u,x]=y.useState(fi[0].id),[S,w]=y.useState(!1),[C,h]=y.useState(null),g=y.useMemo(()=>d==="all"?n:d==="letter"?n.filter(L=>L.type===It.LETTER||L.type===It.DEPARTURE||L.type===It.ACHIEVEMENT):d==="obituary"?n.filter(L=>L.type===It.OBITUARY):n,[n,d]),b=y.useMemo(()=>g.find(L=>L.id===a),[g,a]);y.useEffect(()=>{c(""),x(fi[0].id),h(null)},[a]);const E=L=>{l(L.id),L.isRead||s(L.id)},I=()=>{l(null),t()};y.useEffect(()=>{const L=G=>{G.key==="Escape"&&I()};return window.addEventListener("keydown",L),()=>window.removeEventListener("keydown",L)},[I]);const v=L=>{if(!L)return"";if(typeof L=="object"&&L.year)return` ${Math.floor(L.year)}${L.month}`;const G=new Date(L);return Number.isNaN(G.getTime())?"":`${G.getFullYear()}${G.getMonth()+1}${G.getDate()}`},k=b&&b.type!==It.OBITUARY&&typeof i=="function",T=async()=>{var ne;if(!k)return;const L=f.trim();if(!L){h("");return}const G=fi.find(ae=>ae.id===u)||fi[0];w(!0);try{const ae=await Promise.resolve(i({messageId:b.id,targetNpcId:b.senderId,relation:(ne=b.extras)==null?void 0:ne.relation,content:L,tone:G}));ae&&ae.success?(c(""),h(""),setTimeout(()=>h(null),1800)):h((ae==null?void 0:ae.error)||"")}finally{w(!1)}},A=L=>{switch(L){case It.OBITUARY:return"";case It.LETTER:return"";case It.DEPARTURE:return"";case It.ACHIEVEMENT:return"";default:return""}},R=L=>L===It.OBITUARY?"message-background-obituary":"message-background-letter";return e?r.jsx("div",{className:"message-center-overlay",onClick:I,children:r.jsxs("div",{className:"message-center-modal",onClick:L=>L.stopPropagation(),children:[r.jsxs("div",{className:"message-center-header",children:[r.jsx("h2",{children:" "}),r.jsx("button",{className:"close-btn",onClick:I,children:""})]}),r.jsxs("div",{className:"message-filters",children:[r.jsxs("button",{className:`filter-btn ${d==="all"?"active":""}`,onClick:()=>p("all"),children:[" (",n.length,")"]}),r.jsxs("button",{className:`filter-btn ${d==="letter"?"active":""}`,onClick:()=>p("letter"),children:[" (",n.filter(L=>L.type!==It.OBITUARY).length,")"]}),r.jsxs("button",{className:`filter-btn ${d==="obituary"?"active":""}`,onClick:()=>p("obituary"),children:[" (",n.filter(L=>L.type===It.OBITUARY).length,")"]}),n.some(L=>!L.isRead)&&r.jsx("button",{className:"filter-btn mark-all-read-btn",onClick:()=>{n.forEach(L=>{L.isRead||s(L.id)})},style:{marginLeft:"auto",background:"#7AA893",color:"white"},children:" "})]}),r.jsxs("div",{className:"message-center-content",children:[r.jsx("div",{className:"message-list",children:g.length===0?r.jsxs("div",{className:"empty-message",children:[r.jsx("p",{children:""}),r.jsx("p",{children:""})]}):g.map(L=>{var G,ne;return r.jsxs("div",{className:`message-item ${a===L.id?"selected":""} ${L.isRead?"":"unread"} ${L.type===It.OBITUARY?"obituary":""}`,onClick:()=>E(L),children:[!L.isRead&&r.jsx("span",{className:"unread-dot"}),r.jsx("div",{className:"message-avatar",children:L.type===It.OBITUARY?"":""}),r.jsxs("div",{className:"message-info",children:[r.jsxs("div",{className:"message-sender",children:[L.senderName,r.jsx("span",{className:"message-type-label",children:A(L.type)}),((G=L.extras)==null?void 0:G.isReplyToPlayer)&&r.jsx("span",{className:"message-reply-badge",children:""}),((ne=L.replies)==null?void 0:ne.length)>0&&r.jsxs("span",{className:"message-replied-flag",children:["",L.replies.length]})]}),r.jsx("div",{className:"message-title",children:L.title}),r.jsxs("div",{className:"message-time",children:[" ",L.timestamp.year," ",L.timestamp.month,""]})]})]},L.id)})}),r.jsx("div",{className:`message-reader ${b?R(b.type):""}`,children:b?r.jsxs("div",{className:"reader-content",children:[r.jsxs("div",{className:"reader-header",children:[r.jsx("h3",{children:b.title}),r.jsxs("div",{className:"reader-meta",children:[r.jsx("span",{children:b.senderName}),r.jsx("span",{children:""}),r.jsxs("span",{children:[" ",b.timestamp.year," ",b.timestamp.month,""]})]})]}),r.jsx("div",{className:"reader-body",children:b.content?r.jsx("pre",{className:"message-content",children:b.content}):r.jsx("p",{className:"content-loading",children:"..."})}),(($=b.extras)==null?void 0:$.isReplyToPlayer)&&r.jsxs("div",{className:"reply-context-banner",children:[r.jsxs("div",{children:[" ",((O=b.extras)==null?void 0:O.replySourceTimestamp)&&r.jsx("span",{className:"reply-context-time",children:v(b.extras.replySourceTimestamp)})]}),((Q=b.extras)==null?void 0:Q.replySourceSnippet)&&r.jsxs("div",{className:"reply-context-snippet",children:["",b.extras.replySourceSnippet,""]})]}),b.replies&&b.replies.length>0&&r.jsxs("div",{className:"reply-thread",children:[r.jsx("h4",{children:" "}),r.jsx("div",{className:"reply-list",children:b.replies.map(L=>r.jsxs("div",{className:"reply-entry",children:[r.jsxs("div",{className:"reply-meta",children:[r.jsx("span",{children:L.from||""}),L.toneLabel&&r.jsx("span",{className:"reply-tone-label",children:L.toneLabel}),r.jsx("span",{children:v(L.timestamp)})]}),r.jsx("pre",{className:"reply-content",children:L.content})]},L.id))})]}),r.jsx("div",{className:"reader-actions",children:b.type===It.OBITUARY?r.jsxs(r.Fragment,{children:[r.jsx("button",{className:"action-btn secondary",children:" "}),r.jsx("button",{className:"action-btn danger",onClick:()=>{window.showConfirm&&window.showConfirm("",()=>{o(b.id),l(null)})},children:""})]}):r.jsx(r.Fragment,{children:r.jsx("button",{className:"action-btn",onClick:()=>{o(b.id),l(null)},children:""})})}),k&&r.jsxs("div",{className:"reply-composer",children:[r.jsxs("h4",{children:["  ",b.senderName]}),r.jsx("div",{className:"reply-tone-options",children:fi.map(L=>r.jsxs("button",{type:"button",className:`tone-btn ${u===L.id?"active":""}`,onClick:()=>x(L.id),children:[r.jsx("div",{className:"tone-header",children:r.jsx("span",{children:L.label})}),r.jsx("p",{children:L.desc})]},L.id))}),r.jsx("textarea",{className:"reply-input",placeholder:"120",maxLength:120,value:f,onChange:L=>c(L.target.value)}),r.jsxs("div",{className:"reply-actions",children:[C&&r.jsx("span",{className:"reply-feedback",children:C}),r.jsx("button",{type:"button",className:"action-btn primary",onClick:T,disabled:S,children:S?"...":""})]})]})]}):r.jsxs("div",{className:"reader-placeholder",children:[r.jsx("p",{children:""}),r.jsx("p",{children:""})]})})]})]})}):null},Qk="cultivation_save_v1_slot_",Jk="cultivation_autosave_",Sl=3,Cc=3,Fd=100,th=20;let qr=!1,Ei=!1;const Tc=()=>{try{const e="__localStorage_test__";return localStorage.setItem(e,"test"),localStorage.removeItem(e),!0}catch(e){return console.error("localStorage :",e),!1}},dy=()=>(qr=sb(),console.log(qr?" TapTap ":"  TapTap "),qr),ys=e=>`${Jk}${e}`,_o=(e=1)=>`${Qk}${e}`,uy=e=>new Blob([JSON.stringify(e)]).size/1024,py=()=>{let e=0;for(let t in localStorage)localStorage.hasOwnProperty(t)&&(e+=localStorage[t].length+t.length);return{used:(e/1024).toFixed(2),usedMB:(e/1024/1024).toFixed(2)}},Zu=e=>!e||typeof e!="object"?e:rp(e),wl=e=>Array.isArray(e)?e.map(t=>Zu(t)):e,Xk=e=>{if(!e||typeof e!="object")return e;const t=Zu(e);return Array.isArray(e.worldNpcs)&&(t.worldNpcs=wl(e.worldNpcs)),e.rival&&(t.rival=Zu(e.rival)),Array.isArray(e.spouses)&&(t.spouses=wl(e.spouses)),Array.isArray(e.followers)&&(t.followers=wl(e.followers)),t},nc=e=>{if(!e||typeof e!="object")return e;const t={...e};return t.player=Xk(e.player),["activeNpcs","children","deadNpcs","worldNpcs"].forEach(n=>{Array.isArray(e[n])&&(t[n]=wl(e[n]))}),t},fy=e=>{const t={...e};return t.logs&&t.logs.length>Fd&&(console.log(`${t.logs.length} -> ${Fd}`),t.logs=t.logs.slice(0,Fd)),t.activeNpcs&&(t.activeNpcs=t.activeNpcs.map(n=>n.logs&&n.logs.length>th?{...n,logs:n.logs.slice(-th)}:n)),t.deadNpcs&&(t.deadNpcs=t.deadNpcs.map(n=>({id:n.id,name:n.name,deathYear:n.deathYear,deathReason:n.deathReason}))),t.messages&&Object.keys(t.messages).forEach(n=>{const s=t.messages[n];s&&s.length>30&&(t.messages[n]=s.slice(-30))}),t},my=(e,t=1)=>{var n,s,o,i,a,l;if(!Tc())return{success:!1,error:"STORAGE_UNAVAILABLE",message:"localStorage "};try{const d=fy(e),p=((s=(n=d.player)==null?void 0:n.time)==null?void 0:s.year)||((o=d.player)==null?void 0:o.age)||3572,f=((a=(i=d.player)==null?void 0:i.time)==null?void 0:a.month)||((l=d.player)==null?void 0:l.month)||1,c={...d,timestamp:Date.now(),saveDate:new Date().toLocaleString(),slotNumber:t,gameTime:` ${p} ${f}`,year:p,month:f},u=JSON.stringify(c),x=uy(c);return console.log(`: ${x.toFixed(2)} KB`),x>4096?(console.warn(""),{success:!1,error:"STORAGE_TOO_LARGE",size:x.toFixed(2)}):(localStorage.setItem(_o(t),u),qr&&!Ei&&(Ei=!0,Ch(t,c).then(S=>{console.log(`  [${t}]:`,S.action),Ei=!1}).catch(S=>{console.warn(`  [${t}]:`,S.message),Ei=!1})),{success:!0,time:c.saveDate,slot:t,size:x.toFixed(2)})}catch(d){return console.error("Save failed:",d),d.name==="QuotaExceededError"||d.code===22?{success:!1,error:"QUOTA_EXCEEDED",message:""}:{success:!1,error:d.name||"UNKNOWN_ERROR",message:d.message}}},ho=(e=1)=>{try{const t=localStorage.getItem(_o(e));if(!t)return null;const n=JSON.parse(t);return nc(n)}catch(t){return console.error("Load failed:",t),null}},cf=async(e=1)=>{if(!qr)return console.log(""),ho(e);try{const t=ho(e),n=(t==null?void 0:t.timestamp)||0,s=await ob(e,n);if(!s)return console.log(` [${e}]`),t;console.log(` [${e}]...`);const o=await ib(s.uuid,s.fileId,e);if(o){const i=nc(o);return localStorage.setItem(_o(e),JSON.stringify(i)),console.log(`  [${e}]`),i}return nc(o)}catch(t){return console.error(` [${e}]:`,t),console.log(""),ho(e)}},df=()=>{var t,n;const e=[];if(!Tc()){console.warn("localStorage ");for(let s=1;s<=Sl;s++)e.push({slot:s,exists:!1,error:"localStorage"});return e}try{for(let s=1;s<=Sl;s++){const o=_o(s),i=localStorage.getItem(o);if(i)try{const a=JSON.parse(i);e.push({slot:s,exists:!0,saveDate:a.saveDate||"",playerName:((t=a.player)==null?void 0:t.name)||"",cultivation:((n=a.player)==null?void 0:n.cultivation)||0,timestamp:a.timestamp||0})}catch(a){console.error(` ${s} :`,a),e.push({slot:s,exists:!1})}else e.push({slot:s,exists:!1})}}catch(s){console.error(":",s);for(let o=1;o<=Sl;o++)e.push({slot:o,exists:!1})}return e},hy=(e=1)=>{localStorage.removeItem(_o(e))},Zk=()=>{for(let e=1;e<=Sl;e++)localStorage.removeItem(_o(e));for(let e=1;e<=Cc;e++)localStorage.removeItem(ys(e))},gy=e=>{var t,n,s,o,i,a;if(!Tc())return console.warn("localStorage "),{success:!1,error:"STORAGE_UNAVAILABLE"};try{const l=fy(e),d=((n=(t=l.player)==null?void 0:t.time)==null?void 0:n.year)||Math.floor(((s=l.player)==null?void 0:s.age)||0)||3572,p=((i=(o=l.player)==null?void 0:o.time)==null?void 0:i.month)||1,f=Math.floor(((a=l.player)==null?void 0:a.age)||0),c={...l,player:{...l.player,age:f},timestamp:Date.now(),saveDate:new Date().toLocaleString(),isAutoSave:!0,gameTime:` ${d} ${p}`,year:d,month:p},u=JSON.stringify(c),x=uy(c);if(x>4096)return console.warn(""),{success:!1,error:"STORAGE_TOO_LARGE"};for(let S=Cc;S>1;S--){const w=ys(S-1),C=localStorage.getItem(w);C&&localStorage.setItem(ys(S),C)}return localStorage.setItem(ys(1),u),console.log(`  [ ${d} ${p}] : ${x.toFixed(2)} KB`),{success:!0,time:c.saveDate,gameTime:c.gameTime,size:x.toFixed(2)}}catch(l){return console.error(":",l),{success:!1,error:l.message}}},xy=()=>{var t,n,s,o;const e=[];if(!Tc())return console.warn("localStorage "),e;try{for(let i=1;i<=Cc;i++){const a=ys(i),l=localStorage.getItem(a);if(l)try{const d=JSON.parse(l);e.push({slot:i,exists:!0,saveDate:d.saveDate||"",gameTime:d.gameTime||"",year:d.year||0,month:d.month||0,playerName:((t=d.player)==null?void 0:t.name)||"",cultivation:((n=d.player)==null?void 0:n.cultivation)||0,age:Math.floor(((s=d.player)==null?void 0:s.age)||0),tier:((o=d.player)==null?void 0:o.tierTitle)||""})}catch(d){console.error(` ${i} :`,d),e.push({slot:i,exists:!1,error:""})}else e.push({slot:i,exists:!1})}}catch(i){console.error(":",i)}return e},yy=(e=1)=>{try{const t=localStorage.getItem(ys(e));if(!t)return null;const n=JSON.parse(t);return console.log(` [${e}]: ${n.gameTime}`),nc(n)}catch(t){return console.error(` ${e} :`,t),null}},by=()=>{for(let e=1;e<=Cc;e++)localStorage.removeItem(ys(e));console.log("")},vy=async(e=1)=>{if(!qr)throw new Error("");const t=ho(e);if(!t)throw new Error(` ${e} `);return await Ch(e,t)},Sy=async(e=1)=>{if(!qr)throw new Error("");const t=await cf(e);if(!t)throw new Error("");return t},wy=()=>({enabled:qr,syncing:Ei}),ej=Object.freeze(Object.defineProperty({__proto__:null,autoSaveGame:gy,clearAllAutoSaves:by,clearAllSaves:Zk,clearSave:hy,getAllAutoSaves:xy,getAllSaveSlots:df,getCloudSaveStatus:wy,getStorageInfo:py,initCloudSaveSystem:dy,loadAutoSave:yy,loadGameFromCloud:cf,loadGameFromStorage:ho,manualDownloadFromCloud:Sy,manualUploadToCloud:vy,saveGameToStorage:my},Symbol.toStringTag,{value:"Module"})),tj=({onFinish:e,onLoadGame:t})=>{const[n,s]=y.useState(0),[o,i]=y.useState([]),[a,l]=y.useState(!1);y.useEffect(()=>{const f=df();i(f)},[]);const d=[{text:"",sub:""},{text:"",sub:""},{text:"",sub:""},{text:"",sub:"..."},{text:"",sub:`

`}],p=o.some(f=>f.exists);return a?r.jsxs(r.Fragment,{children:[r.jsx("div",{style:Bt.overlay}),r.jsxs("div",{style:Bt.container,children:[r.jsx("h2",{style:{color:"#d4af37",marginBottom:"clamp(15px, 4vw, 30px)",fontSize:"clamp(18px, 5vw, 24px)"},children:""}),r.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"clamp(10px, 2vw, 15px)",width:"100%",maxWidth:"500px",marginBottom:"10px"},children:o.map(f=>r.jsxs("div",{style:{...Bt.slotCard,opacity:f.exists?1:.5,cursor:f.exists?"pointer":"not-allowed"},onClick:()=>{f.exists&&t(f.slot)},children:[r.jsxs("div",{style:Bt.slotHeader,children:[r.jsxs("span",{style:Bt.slotTitle,children:[" ",f.slot]}),f.exists&&r.jsx("span",{style:Bt.slotBadge,children:""})]}),f.exists?r.jsxs("div",{style:{fontSize:"clamp(11px, 2.8vw, 13px)",color:"#ccc",marginTop:"8px",lineHeight:"1.5"},children:[r.jsxs("div",{children:[": ",f.playerName]}),f.cultivation>0&&r.jsxs("div",{children:[": ",f.cultivation," "]}),r.jsxs("div",{style:{fontSize:"clamp(10px, 2.5vw, 12px)",marginTop:"4px",opacity:.8},children:[": ",f.saveDate]})]}):r.jsx("div",{style:{fontSize:"clamp(12px, 3vw, 13px)",color:"#999",marginTop:"8px"},children:""})]},f.slot))}),r.jsx("button",{onClick:()=>l(!1),style:{...Bt.btn,background:"#666",marginTop:"clamp(10px, 2vw, 20px)",width:"clamp(150px, 40vw, 200px)",padding:"clamp(10px, 2.5vw, 12px)",minHeight:"auto"},children:" "})]})]}):n<d.length?r.jsxs(r.Fragment,{children:[r.jsx("div",{style:Bt.overlay,onClick:()=>s(n+1)}),r.jsxs("div",{style:Bt.container,children:[r.jsx("h1",{style:Bt.title,children:d[n].text}),r.jsx("p",{style:Bt.sub,children:d[n].sub}),p&&n===0&&r.jsx("button",{onClick:f=>{f.stopPropagation(),l(!0)},style:{...Bt.btn,background:"#4caf50",marginBottom:"clamp(15px, 3vw, 20px)",width:"clamp(160px, 45vw, 200px)",textAlign:"center",border:"2px solid #45a049",minHeight:"auto",padding:"clamp(10px, 2.5vw, 12px)"},children:" "}),r.jsx("div",{style:Bt.tip,children:"[  ]"}),r.jsx("button",{onClick:()=>s(n+1),style:Bt.continueBtn,children:" "})]})]}):r.jsxs(r.Fragment,{children:[r.jsx("div",{style:Bt.overlay}),r.jsxs("div",{style:Bt.container,children:[r.jsx("h2",{style:{color:"#d4af37",marginBottom:"clamp(20px, 5vw, 30px)",fontSize:"clamp(20px, 5vw, 28px)"},children:""}),r.jsx("p",{style:Bt.sub,children:"..."}),r.jsx("button",{style:{...Bt.continueBtn,background:"#d4af37",fontSize:"clamp(15px, 4vw, 18px)",padding:"clamp(12px, 3vw, 15px) clamp(30px, 8vw, 40px)",marginTop:"clamp(15px, 4vw, 25px)"},onClick:()=>e(),children:" "})]})]})},Bt={overlay:{position:"fixed",top:0,left:0,width:"100%",height:"100%",background:"rgba(0, 0, 0, 0.85)",zIndex:2499,backdropFilter:"blur(8px)"},container:{position:"fixed",top:"50%",left:"50%",transform:"translate(-50%, -50%)",width:"90%",maxWidth:"600px",maxHeight:"90vh",background:"linear-gradient(135deg, #1a1a1a 0%, #2d2d2d 100%)",color:"white",display:"flex",flexDirection:"column",justifyContent:"flex-start",alignItems:"center",zIndex:2500,padding:"clamp(15px, 4vw, 30px)",textAlign:"center",overflowY:"auto",overflowX:"hidden",borderRadius:"clamp(8px, 2vw, 16px)",boxShadow:"0 20px 60px rgba(0, 0, 0, 0.8)",border:"2px solid rgba(211, 47, 47, 0.5)",WebkitOverflowScrolling:"touch"},title:{fontSize:"clamp(18px, 5vw, 32px)",marginBottom:"clamp(12px, 3vw, 20px)",animation:"fadeIn 1s",lineHeight:"1.3",wordBreak:"break-word"},sub:{fontSize:"clamp(13px, 3.5vw, 16px)",color:"#ccc",lineHeight:"1.6",maxWidth:"100%",animation:"slideUp 1s",padding:"0 5px",wordBreak:"break-word",marginBottom:"clamp(10px, 2vw, 15px)"},tip:{fontSize:"clamp(10px, 2.5vw, 12px)",color:"#888",marginTop:"clamp(8px, 2vw, 10px)",marginBottom:"5px"},continueBtn:{padding:"clamp(8px, 2vw, 10px) clamp(20px, 5vw, 30px)",background:"#d32f2f",border:"none",color:"#fff",borderRadius:"clamp(6px, 1.5vw, 8px)",cursor:"pointer",fontSize:"clamp(13px, 3vw, 14px)",fontWeight:"bold",transition:"all 0.3s",marginTop:"clamp(10px, 2vw, 15px)",minHeight:"40px",width:"auto"},btn:{padding:"clamp(12px, 3vw, 15px) clamp(10px, 2vw, 12px)",background:"#1a1a1a",border:"2px solid #666",color:"#fff",borderRadius:"clamp(8px, 2vw, 12px)",cursor:"pointer",textAlign:"center",transition:"all 0.3s",fontSize:"clamp(12px, 3vw, 15px)",lineHeight:"1.5",whiteSpace:"normal",wordWrap:"break-word",minHeight:"clamp(50px, 12vw, 70px)",display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",gap:"6px",width:"100%"},slotCard:{background:"rgba(255, 255, 255, 0.05)",padding:"clamp(12px, 3vw, 15px)",borderRadius:"clamp(6px, 1.5vw, 8px)",border:"2px solid rgba(255, 255, 255, 0.1)",transition:"all 0.3s",marginBottom:"8px"},slotHeader:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"8px",flexWrap:"wrap",gap:"5px"},slotTitle:{fontSize:"clamp(14px, 3.5vw, 16px)",fontWeight:"bold",color:"#d4af37"},slotBadge:{fontSize:"clamp(16px, 4vw, 18px)",color:"#4caf50"}},nj=({onConfirm:e,onExit:t})=>{const[n,s]=y.useState("warning"),[o,i]=y.useState(!1),a=()=>{const d=` 


 bug


 
/

 
1. ""
2. " "
3. " "
4. 

 
1. ""
2. " "
3. 
   -  
   -  
   -  
4. 

 
- 
- 50000 10 10 

 
1. 
2. Base64
3. 
4. 

`;navigator.clipboard.writeText(d).then(()=>{i(!0),setTimeout(()=>i(!1),2e3)}).catch(()=>{const p=document.createElement("textarea");p.value=d,document.body.appendChild(p),p.select(),document.execCommand("copy"),document.body.removeChild(p),i(!0),setTimeout(()=>i(!1),2e3)})},l={overlay:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0, 0, 0, 0.7)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:9999,padding:"20px"},container:{background:"linear-gradient(135deg, #f5ecd5 0%, #e0c9a6 100%)",borderRadius:"28px 28px 22px 22px/36px 36px 18px 18px",border:"2.5px solid #bfa76a",color:"#5b4322",boxShadow:"0 12px 48px rgba(191, 167, 106, 0.18)",maxWidth:"600px",width:"100%",maxHeight:"80vh",display:"flex",flexDirection:"column",overflow:"hidden"},header:{padding:"20px",borderBottom:"1px solid #d4af37",background:"linear-gradient(90deg, #f5ecd5 60%, #e0c9a6 100%)",textAlign:"center"},title:{fontSize:"24px",fontWeight:"bold",color:"#a67c2d",margin:0,marginBottom:"5px"},subtitle:{fontSize:"14px",color:"#8c6b3b",margin:0},tabs:{display:"flex",borderBottom:"1px solid #d4af37",padding:"0 20px",gap:"20px",backgroundColor:"#f5ecd5",justifyContent:"center"},tab:{padding:"10px 28px",cursor:"pointer",fontSize:"15px",color:"#8c6b3b",border:"none",borderRadius:"18px 18px 0 0/22px 22px 0 0",background:"linear-gradient(90deg, #f5ecd5 60%, #e0c9a6 100%)",marginBottom:"-1px",boxShadow:"0 2px 8px rgba(191,167,106,0.08)",transition:"all 0.3s",outline:"none",fontWeight:500,borderBottom:"2.5px solid transparent"},tabActive:{color:"#a67c2d",background:"linear-gradient(90deg, #f9f5e6 60%, #f3e2c2 100%)",borderBottom:"2.5px solid #a67c2d",boxShadow:"0 4px 16px rgba(191,167,106,0.13)",fontWeight:700},content:{flex:1,overflowY:"auto",padding:"28px 24px",fontSize:"15px",lineHeight:"1.7",background:"linear-gradient(135deg, #fffbe9 0%, #f5ecd5 100%)",color:"#181818",borderRadius:"18px",boxShadow:"0 2px 12px rgba(191,167,106,0.10)",border:"1.5px solid #e0c9a6",margin:"18px 0 0 0"},section:{marginBottom:"15px"},sectionTitle:{color:"#d4af37",fontWeight:"bold",marginBottom:"8px",fontSize:"16px"},warningBox:{backgroundColor:"rgba(191, 167, 106, 0.13)",borderLeft:"4px solid #bfa76a",padding:"14px",borderRadius:"10px",marginBottom:"14px",color:"#7c5c2a",fontWeight:500},infoBox:{backgroundColor:"rgba(191, 167, 106, 0.09)",borderLeft:"4px solid #a67c2d",padding:"14px",borderRadius:"10px",marginBottom:"14px",color:"#5b4322",fontWeight:500},list:{marginLeft:"20px",marginTop:"8px"},listItem:{marginBottom:"6px",color:"#181818"},guide:{backgroundColor:"#fffbe9",border:"1px solid #e0c9a6",borderRadius:"10px",padding:"14px",fontSize:"14px",lineHeight:"1.7",color:"#181818",maxHeight:"300px",overflowY:"auto",marginBottom:"14px",whiteSpace:"pre-wrap",wordBreak:"break-word"},footer:{display:"flex",gap:"12px",padding:"20px",borderTop:"1px solid #333",justifyContent:"flex-end"},button:{padding:"10px 20px",borderRadius:"4px",border:"none",fontSize:"14px",fontWeight:"bold",cursor:"pointer",transition:"all 0.3s"},buttonPrimary:{backgroundColor:"#a67c2d",color:"#fff",minWidth:"120px"},buttonSecondary:{backgroundColor:"#e0c9a6",color:"#7c5c2a",border:"1px solid #d4af37"},buttonWarning:{backgroundColor:"#bfa76a",color:"#fff"},buttonCopy:{backgroundColor:o?"#bfa76a":"#e0c9a6",color:o?"#fff":"#7c5c2a",border:`1.5px solid ${o?"#bfa76a":"#a67c2d"}`,width:"100%"}};return r.jsx("div",{style:l.overlay,children:r.jsxs("div",{style:l.container,children:[r.jsxs("div",{style:l.header,children:[r.jsx("h1",{style:l.title,children:" "}),r.jsx("p",{style:l.subtitle,children:""})]}),r.jsxs("div",{style:l.tabs,children:[r.jsx("button",{style:{...l.tab,...n==="warning"?l.tabActive:{}},onClick:()=>s("warning"),children:""}),r.jsx("button",{style:{...l.tab,...n==="guide"?l.tabActive:{}},onClick:()=>s("guide"),children:""})]}),r.jsxs("div",{style:l.content,children:[n==="warning"&&r.jsxs(r.Fragment,{children:[r.jsxs("div",{style:l.warningBox,children:[r.jsx("div",{style:l.sectionTitle,children:" "}),r.jsxs("p",{children:["",r.jsx("strong",{children:""})," "]})]}),r.jsxs("div",{style:l.section,children:[r.jsx("div",{style:l.sectionTitle,children:" "}),r.jsxs("ul",{style:l.list,children:[r.jsx("li",{style:l.listItem,children:""}),r.jsx("li",{style:l.listItem,children:""}),r.jsx("li",{style:l.listItem,children:""}),r.jsx("li",{style:l.listItem,children:""}),r.jsx("li",{style:l.listItem,children:""})]})]}),r.jsxs("div",{style:l.section,children:[r.jsx("div",{style:l.sectionTitle,children:" "}),r.jsxs("p",{children:["",r.jsx("strong",{children:'""'}),""]}),r.jsxs("p",{children:["",r.jsx("strong",{children:'""'}),""]})]}),r.jsxs("div",{style:l.infoBox,children:[r.jsx("div",{style:l.sectionTitle,children:" "}),r.jsxs("p",{children:["",r.jsx("strong",{children:""}),""]}),r.jsx("p",{children:'""'}),r.jsxs("p",{children:["  ",r.jsx("b",{children:"100000 "}),""]}),r.jsx("p",{style:{color:"#a67c2d",fontWeight:"bold"},children:""})]})]}),n==="guide"&&r.jsxs(r.Fragment,{children:[r.jsxs("div",{style:l.section,children:[r.jsx("div",{style:l.sectionTitle,children:" "}),r.jsx("p",{children:""})]}),r.jsx("div",{style:l.guide,children:'    bug    ""   1. "" 2. " " 3. " " 4.    1. "" 2. " " 3.  -   -   -   4.    -  - 100000    1.  2. Base64 3.  4.  '}),r.jsx("button",{style:{...l.button,...l.buttonCopy},onClick:a,children:o?" ":" "}),r.jsxs("div",{style:{...l.infoBox,marginTop:"15px"},children:[r.jsxs("p",{children:[" ",r.jsx("strong",{children:""})]}),r.jsxs("ul",{style:l.list,children:[r.jsx("li",{style:l.listItem,children:""}),r.jsx("li",{style:l.listItem,children:""}),r.jsx("li",{style:l.listItem,children:""}),r.jsx("li",{style:l.listItem,children:""})]})]})]})]}),r.jsxs("div",{style:l.footer,children:[r.jsx("button",{style:{...l.button,...l.buttonSecondary,...l.buttonWarning},onClick:t,children:""}),r.jsx("button",{style:{...l.button,...l.buttonPrimary},onClick:e,children:""})]})]})})},rj=({onComplete:e})=>{const[t,n]=y.useState(0),[s,o]=y.useState(!1);y.useEffect(()=>{const a=setInterval(()=>{n(l=>l>=100?(clearInterval(a),setTimeout(()=>{o(!0)},300),100):l+2)},30);return()=>clearInterval(a)},[]);const i=()=>{e()};return s?r.jsx("div",{style:Ot.overlay,children:r.jsxs("div",{style:Ot.warningContainer,children:[r.jsx("h2",{style:Ot.warningTitle,children:""}),r.jsxs("div",{style:Ot.warningContent,children:[r.jsx("p",{style:Ot.warningText,children:""}),r.jsx("p",{style:Ot.warningText,children:""}),r.jsx("p",{style:Ot.warningText,children:""}),r.jsx("p",{style:Ot.warningText,children:""})]}),r.jsx("button",{onClick:i,style:Ot.continueBtn,children:" "})]})}):r.jsx("div",{style:Ot.overlay,children:r.jsxs("div",{style:Ot.container,children:[r.jsx("h1",{style:Ot.title,children:""}),r.jsx("p",{style:Ot.subtitle,children:""}),r.jsxs("div",{style:Ot.progressContainer,children:[r.jsx("div",{style:Ot.progressBar,children:r.jsx("div",{style:{...Ot.progressFill,width:`${t}%`}})}),r.jsxs("p",{style:Ot.progressText,children:[t,"%"]})]}),r.jsx("p",{style:Ot.loadingText,children:"..."})]})})},Ot={overlay:{position:"fixed",top:0,left:0,width:"100%",height:"100%",background:"linear-gradient(135deg, #1a1a2e 0%, #16213e 100%)",zIndex:9999,display:"flex",justifyContent:"center",alignItems:"center"},container:{textAlign:"center",color:"white",padding:"40px",maxWidth:"600px",width:"90%"},title:{fontSize:"clamp(32px, 8vw, 48px)",marginBottom:"10px",color:"#d4af37",textShadow:"0 0 20px rgba(212, 175, 55, 0.5)",fontWeight:"bold",letterSpacing:"4px"},subtitle:{fontSize:"clamp(14px, 3vw, 18px)",color:"#ccc",marginBottom:"60px",letterSpacing:"2px"},progressContainer:{marginBottom:"30px"},progressBar:{width:"100%",height:"8px",background:"rgba(255, 255, 255, 0.1)",borderRadius:"4px",overflow:"hidden",marginBottom:"10px"},progressFill:{height:"100%",background:"linear-gradient(90deg, #d4af37 0%, #ffd700 100%)",transition:"width 0.3s ease",boxShadow:"0 0 10px rgba(212, 175, 55, 0.5)"},progressText:{fontSize:"14px",color:"#d4af37",fontWeight:"bold"},loadingText:{fontSize:"14px",color:"#888",animation:"pulse 1.5s ease-in-out infinite"},warningContainer:{background:"linear-gradient(135deg, #2d2d2d 0%, #1a1a1a 100%)",padding:"clamp(30px, 6vw, 50px)",borderRadius:"16px",maxWidth:"600px",width:"90%",border:"2px solid #d4af37",boxShadow:"0 20px 60px rgba(0, 0, 0, 0.8)"},warningTitle:{fontSize:"clamp(24px, 5vw, 32px)",color:"#d4af37",marginBottom:"30px",textAlign:"center",fontWeight:"bold"},warningContent:{marginBottom:"30px"},warningText:{fontSize:"clamp(14px, 3vw, 16px)",color:"#fff",lineHeight:"2",marginBottom:"10px",textAlign:"center"},continueBtn:{width:"100%",padding:"clamp(12px, 3vw, 15px)",background:"#d4af37",border:"none",borderRadius:"8px",color:"#1a1a1a",fontSize:"clamp(14px, 3vw, 16px)",fontWeight:"bold",cursor:"pointer",transition:"all 0.3s",boxShadow:"0 4px 15px rgba(212, 175, 55, 0.3)"}},sj=e=>{if(!e||!e.player)return e;const{player:t,children:n=[],activeNpcs:s=[],deadNpcs:o=[]}=e;return oj(t)?(console.warn(" ..."),ij(e)):e};function oj(e){const t=[];return(!e.combatStats||typeof e.combatStats!="object")&&t.push("combatStats"),(!e.manuals||typeof e.manuals!="object")&&t.push("manuals"),e.spouseSelection||t.push("spouseSelection"),e.rival||t.push("rival"),t.length>=3}function ij(e){var f,c;const{player:t,children:n=[],activeNpcs:s=[],deadNpcs:o=[]}=e,i={name:t.name,age:t.age,gender:t.gender,avatar:t.avatar,tier:t.tier,currentExp:t.currentExp,maxExp:t.maxExp,time:t.time},a={spiritStones:((f=t.resources)==null?void 0:f.spiritStones)||0,money:((c=t.resources)==null?void 0:c.money)||0},l=t.affectionRecords||{},d={...i,resources:a,affectionRecords:l,compensationApplied:!0,compensationTime:new Date().toISOString()};let p=[];return d.resources.spiritStones=(d.resources.spiritStones||0)+1e5,console.log(" "),console.log(" 100000 "),{...e,player:d,children:n||[],activeNpcs:nh(s),deadNpcs:nh(o),inventory:p,logs:[]}}function nh(e){return Array.isArray(e)?e.map(t=>({id:t.id,name:t.name,personality:t.personality,identity:t.identity,affection:t.affection||0,favorabilityLevel:t.favorabilityLevel||0,...t})):[]}const aj=e=>e.compensationApplied?`

 100000 `:null,mi=20,Hd=100,lj=({open:e,options:t=[],defaultSelectedId:n=null,onSelect:s,onClose:o})=>{const[i,a]=y.useState(""),[l,d]=y.useState(""),[p,f]=y.useState(0);y.useEffect(()=>{const h=setTimeout(()=>{d(i.trim().toLowerCase())},300);return()=>clearTimeout(h)},[i]),y.useEffect(()=>{e||(a(""),d(""),f(0))},[e]);const c=y.useMemo(()=>t.slice(0,Hd),[t]),u=y.useMemo(()=>l?c.filter(h=>{var E;const g=(E=h.name)==null?void 0:E.toLowerCase().includes(l),b=String(h.intelligence??"").includes(l);return g||b}):c,[l,c]);y.useEffect(()=>{const h=Math.max(0,Math.ceil(u.length/mi)-1);p>h&&f(0)},[u.length,p]);const x=y.useCallback(h=>{h&&(s==null||s(h))},[s]);if(!e)return null;const S=Math.max(1,Math.ceil(u.length/mi)),w=p*mi,C=u.slice(w,w+mi);return r.jsx("div",{style:At.overlay,children:r.jsxs("div",{style:At.modal,children:[r.jsxs("div",{style:At.header,children:[r.jsx("h3",{style:{margin:0},children:""}),r.jsx("button",{style:At.closeBtn,onClick:o,children:""})]}),r.jsxs("div",{style:At.filterBar,children:[r.jsx("input",{style:At.searchInput,placeholder:"",value:i,onChange:h=>{a(h.target.value),f(0)}}),r.jsxs("span",{style:At.countText,children:[" ",u.length," ",t.length>Hd&&r.jsxs("span",{style:{color:"#ff6600",marginLeft:"5px"},children:["(",Hd,")"]})]})]}),r.jsx("div",{style:At.list,children:u.length===0?r.jsx("div",{style:At.empty,children:""}):C.map(h=>{const g=h.id===n;return r.jsxs("button",{style:{...At.row,...g?At.rowSelected:{}},onClick:()=>x(h.id),children:[r.jsxs("div",{style:At.rowMain,children:[r.jsx("div",{style:At.rowName,children:h.name}),r.jsxs("div",{style:At.rowMeta,children:[r.jsxs("span",{children:[" ",h.intelligence]}),h.tierTitle&&r.jsx("span",{children:h.tierTitle}),typeof h.age=="number"&&r.jsxs("span",{children:[h.age," "]})]})]}),r.jsx("div",{style:At.rowAction,children:g?"":""})]},h.id)})}),u.length>mi&&r.jsxs("div",{style:At.pagination,children:[r.jsx("button",{style:{...At.pageBtn,opacity:p===0?.5:1},onClick:()=>f(h=>Math.max(0,h-1)),disabled:p===0,children:""}),r.jsxs("span",{style:At.pageInfo,children:[" ",p+1," / ",S," "]}),r.jsx("button",{style:{...At.pageBtn,opacity:p>=S-1?.5:1},onClick:()=>f(h=>Math.min(S-1,h+1)),disabled:p>=S-1,children:""})]})]})})},At={overlay:{position:"fixed",inset:0,background:"rgba(0,0,0,0.55)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:2200},modal:{width:"420px",maxHeight:"80vh",background:"#fff",borderRadius:"14px",boxShadow:"0 12px 30px rgba(0,0,0,0.25)",display:"flex",flexDirection:"column"},header:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"14px 18px",borderBottom:"1px solid #eee"},closeBtn:{border:"none",background:"transparent",fontSize:"22px",cursor:"pointer",color:"#777"},filterBar:{display:"flex",alignItems:"center",gap:"10px",padding:"12px 18px",borderBottom:"1px solid #f0f0f0",background:"#fafafa"},searchInput:{flex:1,border:"1px solid #ccc",borderRadius:"8px",padding:"6px 10px",fontSize:"13px"},countText:{fontSize:"12px",color:"#666"},list:{flex:1,overflowY:"auto",padding:"12px 18px"},empty:{textAlign:"center",color:"#999",padding:"40px 0"},row:{width:"100%",border:"1px solid #e0e0e0",borderRadius:"10px",padding:"10px 14px",marginBottom:"10px",display:"flex",justifyContent:"space-between",alignItems:"center",background:"#fff",cursor:"pointer",transition:"border-color 0.2s, box-shadow 0.2s"},rowSelected:{borderColor:"#ff9800",boxShadow:"0 0 0 2px rgba(255,152,0,0.15)"},rowMain:{textAlign:"left"},rowName:{fontWeight:"bold",fontSize:"14px",marginBottom:"4px"},rowMeta:{display:"flex",gap:"10px",fontSize:"12px",color:"#666"},rowAction:{fontSize:"12px",color:"#ff9800",fontWeight:"bold"},pagination:{padding:"10px 18px 16px",display:"flex",justifyContent:"space-between",alignItems:"center",borderTop:"1px solid #eee"},pageBtn:{border:"none",background:"#ffe0b2",color:"#bf360c",padding:"6px 12px",borderRadius:"6px",cursor:"pointer",fontWeight:"bold"},pageInfo:{fontSize:"12px",color:"#555"}},cj=({player:e,children:t,managerOptions:n=[],onBuy:s,onAssign:o})=>{var w,C;const[i,a]=y.useState({}),[l,d]=y.useState({open:!1,bizId:null}),p=y.useMemo(()=>{const h={};return n.forEach(g=>{h[g.id]=g}),h},[n]),f=n.length;y.useEffect(()=>{if(!f){a({});return}a(h=>{const g=new Set(n.map(I=>I.id));let b=!1;const E={};return Object.entries(h).forEach(([I,v])=>{v&&g.has(v)?E[I]=v:v&&(b=!0)}),b?E:h})},[f,n]);const c=y.useCallback(h=>{f&&d({open:!0,bizId:h})},[f]),u=y.useCallback(()=>{d({open:!1,bizId:null})},[]),x=y.useCallback(h=>{l.bizId&&(a(g=>({...g,[l.bizId]:h})),d({open:!1,bizId:null}))},[l.bizId]),S=y.useCallback(h=>{const g=i[h.id];if(!g){window.showResult&&window.showResult("","",!1,null,!1);return}s(h,g)},[i,s]);return r.jsxs("div",{style:{padding:"10px"},children:[r.jsx("h3",{children:" "}),r.jsxs("p",{style:{fontSize:"12px",color:"#666"},children:["",r.jsx("br",{}),": ",((w=e.businesses)==null?void 0:w.reduce((h,g)=>h+g.income,0))||0," "]}),r.jsx("div",{style:{marginBottom:"20px"},children:(C=e.businesses)==null?void 0:C.map((h,g)=>{const b=t.find(E=>E.id===h.managerId);return r.jsxs("div",{style:as.bizCard,children:[r.jsx("div",{style:{fontWeight:"bold"},children:h.name}),r.jsxs("div",{style:{fontSize:"12px"},children:[": ",b?b.name:r.jsx("span",{style:{color:"red"},children:""}),b&&` (:${b.stats.intelligence})`]}),r.jsxs("div",{style:{color:"#2e7d32"},children:[": ",h.income]})]},g)})}),r.jsx("h4",{children:" "}),r.jsx("div",{style:as.grid,children:C2.map(h=>r.jsxs("div",{style:as.card,children:[r.jsx("div",{style:{fontWeight:"bold"},children:h.name}),r.jsx("div",{style:{fontSize:"10px",color:"#555",height:"30px"},children:h.desc}),r.jsxs("div",{style:{fontSize:"12px",margin:"5px 0"},children:[": ",h.minTier," | : ",h.cost]}),r.jsx("button",{style:{...as.selectBtn,...i[h.id]?as.selectBtnActive:{},...n.length?{}:as.selectBtnDisabled},onClick:()=>c(h.id),disabled:!n.length,children:(()=>{if(!n.length)return"";const g=i[h.id];if(!g)return"";const b=p[g];return b?`${b.name} (${b.intelligence})`:""})()}),r.jsx("button",{style:{...as.buyBtn,opacity:i[h.id]?1:.6,cursor:i[h.id]?"pointer":"not-allowed"},disabled:!i[h.id],onClick:()=>S(h),children:""})]},h.id))}),r.jsx(lj,{open:l.open,options:n,defaultSelectedId:l.bizId?i[l.bizId]:null,onSelect:x,onClose:u})]})},as={grid:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"10px"},card:{border:"1px solid #ddd",padding:"10px",borderRadius:"8px",background:"white"},bizCard:{border:"1px solid #81c784",background:"#e8f5e9",padding:"10px",borderRadius:"8px",marginBottom:"5px"},buyBtn:{width:"100%",background:"#ff9800",color:"white",border:"none",padding:"5px",borderRadius:"4px",marginTop:"5px"},selectBtn:{width:"100%",padding:"6px",borderRadius:"4px",border:"1px solid #ccc",background:"#fafafa",marginTop:"5px",cursor:"pointer"},selectBtnActive:{borderColor:"#ff9800",color:"#bf360c",background:"#fff3e0"},selectBtnDisabled:{cursor:"not-allowed",opacity:.6}},dj=ic.memo(cj),uj=({player:e,children:t,onChallenge:n})=>{const[s,o]=y.useState(null),[i,a]=y.useState([]),l=t.filter(f=>f.age>=16),d=f=>{if(i.includes(f))a(c=>c.filter(u=>u!==f));else{if(i.length>=3){window.showResult&&window.showResult("","3",!1,null,!1);return}a(c=>[...c,f])}},p=bl(e)+i.reduce((f,c)=>{const u=l.find(x=>x.id===c);return f+(u?bl(u):0)},0);return r.jsx("div",{style:{padding:"10px"},children:s?r.jsxs("div",{children:[r.jsx("button",{onClick:()=>o(null),children:" "}),r.jsxs("h3",{children:[" ",s.name]}),r.jsx("p",{children:s.desc}),r.jsxs("div",{style:Ws.statBox,children:[r.jsxs("div",{children:[": ",s.recommendCP]}),r.jsxs("div",{children:[": ",r.jsx("span",{style:{color:p>=s.recommendCP?"green":"red"},children:p})]}),r.jsxs("div",{children:[": ",(s.risk*100).toFixed(0),"%"]})]}),r.jsx("h4",{children:" (3)"}),r.jsx("div",{style:Ws.list,children:l.map(f=>r.jsxs("div",{onClick:()=>d(f.id),style:{...Ws.fighterRow,background:i.includes(f.id)?"#ffe0b2":"white"},children:[r.jsxs("span",{children:[f.name," (",f.tierTitle,")"]}),r.jsxs("span",{children:["CP: ",bl(f)]})]},f.id))}),r.jsxs("button",{style:Ws.startBtn,onClick:()=>n(s,i),children:[" ( ",s.cost," )"]})]}):r.jsxs("div",{children:[r.jsx("h3",{children:" "}),r.jsx("p",{style:{fontSize:"12px",color:"#666"},children:""}),r.jsx("div",{style:Ws.list,children:Kx.map(f=>r.jsxs("div",{onClick:()=>o(f),style:Ws.realmCard,children:[r.jsx("div",{style:{fontWeight:"bold"},children:f.name}),r.jsxs("div",{style:{fontSize:"12px",color:"#d81b60"},children:[": ",f.reqTier]}),r.jsxs("div",{style:{fontSize:"12px"},children:[": ",f.cost]})]},f.id))})]})})},Ws={list:{display:"flex",flexDirection:"column",gap:"8px",maxHeight:"300px",overflowY:"auto"},realmCard:{border:"1px solid #ddd",padding:"15px",borderRadius:"8px",cursor:"pointer",background:"white",display:"flex",justifyContent:"space-between",alignItems:"center"},fighterRow:{padding:"10px",borderBottom:"1px solid #eee",display:"flex",justifyContent:"space-between",cursor:"pointer"},statBox:{background:"#eee",padding:"10px",borderRadius:"5px",margin:"10px 0",fontSize:"14px"},startBtn:{width:"100%",padding:"15px",background:"#d32f2f",color:"white",border:"none",borderRadius:"8px",fontSize:"16px",marginTop:"20px",cursor:"pointer"}},pj={LEVEL_UP:[" {actor} {detail}","{actor} {detail}","{actor} {detail}","{actor} {detail}"],NPC_BREAKTHROUGH:[" {actor} {detail}"," {actor} {detail}","{actor} {detail}"],BREAKTHROUGH_FAIL:["{actor} {detail}","{actor} {detail}","{actor} {detail}"],MARRIAGE:["{actor}  {target} ","{actor}  {target} ","{actor}  {target} ","{actor}  {target} ","{actor}{target}/","{target}{actor}","{actor}{target}","{actor}{target}"],BIRTH:["{actor}  {target}","{actor}  {target}","{actor}  {target} "],DEATH:["{actor}  {location} ","{actor}  {detail} ","{actor} "],COMBAT:["{actor}  {location}  {target}","{actor}  {target}  {actor} "," {actor}  {location}  {target}","{location}{actor}{target}{actor}","{actor}{target}","{actor}{target}{location}"],JOIN_SECT:["{actor}  {target}  {detail} ","{target}  {detail}","{target}  {detail} "],GRANDCHILD:["{actor} ","{actor} {detail}"],EXPLORATION:["{actor}  {location}  {detail}"," {actor}  {location}"],FILLER:["","","","","","","","","","","","30%","","","","''","''","","","''","","","",""],RIVAL_RISE:["{actor}","{actor}{detail}''"],RIVAL_BREAKTHROUGH:["{actor}{tier}","{actor}{tier}","{actor}{tier}"],RIVAL_ENGAGED:["{actor}{target}","{target}{actor}"],RIVAL_MARRIAGE:["{target}{actor}","{actor}{target}{target}"],RIVAL_HEIR:["{actor}{target}","{actor}"],RIVAL_STAGE_EVENT:["{actor}{stageTitle}{description}","{actor}{stageTier}{description}","{actor}{stageRole}{description}"],REVENGE_STAGE_ADVANCE:["{actor}{clearedStage}{nextStage}","{actor}{clearedStage}","{actor}{clearedStage}"],REVENGE_SAGA_COMPLETE:["{actor}{finalTarget}","{actor}{finalTarget}","{actor}{finalTarget}"],REVENGE_DUEL_FAILED:["{actor}{rival}","{actor}{rival}","{stageTitle}{actor}"],RIVAL_LIGHT_RUMOR:["{actor}","{actor}''","{actor}"],RIVAL_HEAVY_RUMOR:["{actor}","{actor}","{actor}"],RIVAL_THREAT_MEDIUM:["{playerName}","{actor}..."],RIVAL_THREAT_HIGH:["{actor}''","{actor}"],RIVAL_THREAT_CRITICAL:["","{actor}","..."],RIVAL_HIDE_SUCCESS:["{actor}","{actor}{months}","{actor}"],ASSASSINATION_SURVIVED:["{actor}","{actor}","{actor}"],ASSASSINATION_INJURED:["{actor}","{actor}","{actor}"],RIVAL_DEFEATED:["{target}{actor}","{actor}{target}","{target}...{actor}"],RIVAL_VICTORY:["{target}{actor}","{target}{actor}"],NPC_AFFECTION_HIGH:["{actor}{target}","{target}{actor}","{actor}{target}"],NPC_JEALOUSY:["{actor}{target}{rival}","{actor}{target}","{actor}{target}'{rival}'","{actor}{rival}{target}"],SHURA_FIELD:["{actor}{participants}","{dominant}{rival}{actor}","{actor}{count}"],DUAL_CULTIVATION:["{actor}{target}","{actor}{target}","{actor}{target}"],NPC_PURSUIT:["{actor}{target}{target}","{actor}{target}","{target}{actor}","{actor}{target}"],NPC_ANGRY:["{actor}{target}{target}''","{actor}{target}","{target}{actor}''{actor}"],CHILD_TALENT:["{actor}{target}","{target}{actor}","{actor}{target}"],SECT_PROMOTION:["{actor}","{actor}{detail}","{actor}"],TREASURE_FIND:["{actor}{detail}","{actor}","{actor}{detail}"],RETREAT:["{actor}{detail}","{actor}","{actor}"],TOURNAMENT:["{actor}","{actor}''","{target}{actor}"],INJURED:["{actor}{target}","{actor}{target}","{actor}"],APPRENTICE:["{actor}{target}","{target}{actor}","{actor}{detail}"]};function Us(e,t){const n=pj[e];if(!n||n.length===0)return null;let o=n[Math.floor(Math.random()*n.length)];return Object.keys(t).forEach(i=>{const a=`{${i}}`;o=o.replace(new RegExp(a,"g"),t[i])}),o}function fj(e,t){const n=[],s=new Set,o=i=>i?typeof i.status=="string"?i.status!=="DEAD":typeof i.isDead=="boolean"?!i.isDead:!0:!1;return n.push({name:t.name,cultivation:t.currentExp||0,tier:t.tier||"",isPlayer:!0}),s.add(t.name),t.worldNpcs&&t.worldNpcs.length>0&&t.worldNpcs.filter(o).forEach(i=>{s.has(i.name)||(n.push({name:i.name,title:i.title,cultivation:i.currentExp||0,tier:i.tier||"",isPlayer:!1,worldNpcData:i}),s.add(i.name))}),e&&e.length>0&&e.filter(o).forEach(i=>{s.has(i.name)||(n.push({name:i.name,cultivation:i.currentExp||0,tier:i.tier||"",isPlayer:!1}),s.add(i.name))}),n.sort((i,a)=>{if(a.cultivation!==i.cultivation)return a.cultivation-i.cultivation;const l=["","","","","","","","","",""];return l.indexOf(i.tier)-l.indexOf(a.tier)}),n.slice(0,3).map((i,a)=>{const l=["","",""],d=i.isPlayer?"":"",p=i.title?`${i.title}`:"";return{displayText:`${l[a]} ${d}${p}${i.name} - ${i.tier}`,name:i.name,title:i.title,tier:i.tier,isPlayer:i.isPlayer,worldNpcData:i.worldNpcData}})}const Xi=50,Wd=(e=[])=>Array.isArray(e)?e.length<=Xi?e:e.slice(-Xi):[];function mj(e){if(!Array.isArray(e)||e.length===0)return e;const t=e.filter(o=>o.type==="MARRIAGE"||o.type==="RIVAL_MARRIAGE"),n=e.filter(o=>o.type==="BIRTH"||o.type==="GRANDCHILD"||o.type==="RIVAL_HEIR");return t.length===0||n.length===0?e:e.filter(o=>{var i;if(o.type==="BIRTH"||o.type==="GRANDCHILD"||o.type==="RIVAL_HEIR"){const a=(i=o.data)==null?void 0:i.actor,l=o.timestamp||Date.now();if(a){const d=t.filter(p=>{var f,c;return((f=p.data)==null?void 0:f.actor)===a||((c=p.data)==null?void 0:c.target)===a});for(const p of d){const f=p.timestamp||Date.now(),c=(l-f)/(1e3*60*60*24*30);if(c>=0&&c<12)return!1}}}return!0})}function hj(e,t,n,s){var b,E;const o=[],i=[],a=Ij(t.rival);if(a){const I=Us(a.type,a.data);I&&o.unshift(I)}e.filter(I=>I.type==="RIVAL_BREAKTHROUGH").forEach(I=>{const v=Us(I.type,I.data);v&&o.unshift(v)});const d=[];let p=[];e.forEach(I=>{I.type.startsWith("RIVAL_")?d.push(I):p.push(I)}),p=mj(p),d.forEach(I=>{const v=Us(I.type,I.data);v&&o.push(v)});const f=[],c=[];p.forEach(I=>{I.data.actor===t.name||I.data.target===t.name||I.type==="LEVEL_UP"||I.type==="MARRIAGE"||I.type==="BIRTH"||I.type==="COMBAT"?f.push(I):c.push(I)});const u=8,x=Math.ceil(u*.25),S=Math.ceil(u*.75);let w=0;f.forEach(I=>{if(w<x){const v=Us(I.type,I.data);v&&(o.push(v),w++)}}),c.forEach(I=>{const v=Us(I.type,I.data);v&&(o.length<5?o.push(v):i.push(v))});const C=o.length+i.length,h=Math.max(0,S-(C-w));for(let I=0;I<h;I++){const v=Us("FILLER",{});o.length<5?o.push(v):i.push(v)}const g=fj(n,t);return{issue:s,year:((b=t.time)==null?void 0:b.year)||t.age||0,month:((E=t.time)==null?void 0:E.month)||t.month||1,headlines:o,rumors:i,powerRanking:g,timestamp:Date.now()}}function gj(e,t,n,s,o){return hj(e,t,n,s)}function Pt(e,t,n){Array.isArray(e)&&(e.push({type:t,data:n,timestamp:Date.now()}),e.length>Xi&&e.splice(0,e.length-Xi))}let bs=1.3;const Ey={aptitude:92,looks:95,intelligence:90,health:85,cunning:88};var jh;const Ud={type:"",name:"",multiplier:((jh=xr==null?void 0:xr.SINGLE)==null?void 0:jh.multiplier)||1.8,elements:[""]},xj={id:"CHU_CLAN",name:"",level:"HIGH"},yj={name:"",bonuses:{speedMultiplier:1.15}},uf=e=>{if(!e)return e;e.stats={...Ey,...e.stats||{}};const t=e.spiritRoot||Ud;e.spiritRoot={...Ud,...t,elements:Array.isArray(t.elements)?[...t.elements]:[...Ud.elements]},e.sect=e.sect?{...e.sect}:{...xj};const n=e.trait||yj;return e.trait={...n,bonuses:n.bonuses?{...n.bonuses}:void 0},e},rc=(e,t=e==null?void 0:e.tier)=>{if(!e)return;const n=bn(t||(e==null?void 0:e.tier));n!=null&&n.maxExp&&(e.maxExp=n.maxExp)},bj=e=>{const t=Math.min(.8,((e==null?void 0:e.baseThreat)||0)/100),n=(e==null?void 0:e.powerMultiplier)||1;return 1+t+(n-1)*.5},vj=(e,t,n=!1)=>{if(!e)return 0;uf(e),rc(e);const s=kc({...e,stats:e.stats,spiritRoot:e.spiritRoot,trait:e.trait,sect:e.sect},n)||0,o=n?1.8:1,i=bj(t),a=Math.max(n?10:120,Math.floor(s*i*o*bs));return e.currentExp=Math.max(0,(e.currentExp||0)+a),a},pf=e=>(e.revengeProgress||(e.revengeProgress={currentStageIndex:0,completedStages:[],sagaComplete:!1}),Array.isArray(e.revengeProgress.completedStages)||(e.revengeProgress.completedStages=[]),e.revengeProgress),Sj=e=>(Array.isArray(e.newsBuffer)||(e.newsBuffer=[]),e.newsBuffer),ky=(e,t,{resetProgress:n=!0}={})=>{const s=e.rival||{},o=typeof t.baseThreat=="number"?t.baseThreat:0,i=bn(t.tier);return e.rival={...s,name:t.name,stageId:t.id,tier:t.tier,maxExp:(i==null?void 0:i.maxExp)||s.maxExp||t.baseExp,state:n?"NORMAL":s.state||"NORMAL",lifeStage:n?0:s.lifeStage||0,storyTimer:n?0:s.storyTimer||0,isDead:n?!1:s.isDead||!1,rumorCount:n?0:s.rumorCount||0,threatLevel:n?o:s.threatLevel??o,hiddenTurns:0,currentExp:t.baseExp,stats:{...Ey,...s.stats||{}},combatStats:{...s.combatStats||{},hp:t.combatStats.hp,maxHp:t.combatStats.maxHp,atk:t.combatStats.atk,def:t.combatStats.def}},uf(e.rival),rc(e.rival,t.tier),e.rival},Ro=e=>{const t=pf(e),n=Kl(t.currentStageIndex||0);return!e.rival||e.rival.stageId!==n.id?ky(e,n,{resetProgress:!0}):e.rival};function wj(e,t=50){const n=Ro(e);if(e.resources.spiritStones<t)return{success:!1,message:""};const s=e.time.year*12+e.time.month;if(e.revengeActions.lastRumorMonth===s)return{success:!1,message:""};e.resources.spiritStones=Math.max(0,e.resources.spiritStones-t);const o=Math.min(.9,.6+t/200);if(!(Math.random()<o))return n.threatLevel=Math.min(100,n.threatLevel+15),e.revengeActions.lastRumorMonth=s,{success:!0,effectType:"FAILED",message:`${n.name}...`,threatIncrease:15};let a="",l=0;return t>=100?(a="HEAVY",l=200,n.state="FURIOUS",n.threatLevel=Math.min(100,n.threatLevel+25),n.currentExp=Math.max(0,n.currentExp-l),n.rumorCount+=2):(a="LIGHT",l=100,n.state="ANXIOUS",n.threatLevel=Math.min(100,n.threatLevel+10),n.currentExp=Math.max(0,n.currentExp-l),n.rumorCount+=1),e.revengeActions.lastRumorMonth=s,e.revengeActions.totalRumors+=1,{success:!0,effectType:a,message:a==="HEAVY"?`${n.name}`:`${n.name}...`,damage:l,threatIncrease:a==="HEAVY"?25:10,newsEvent:{type:a==="HEAVY"?"RIVAL_HEAVY_RUMOR":"RIVAL_LIGHT_RUMOR",data:{actor:n.name,rumorCount:n.rumorCount}}}}function Ej(e,t=1,n=30){const s=Ro(e),o=t*n;if(e.resources.spiritStones<o)return{success:!1,message:`${t}${o}`};e.resources.spiritStones=Math.max(0,e.resources.spiritStones-o);const i=40*t;return s.threatLevel=Math.max(0,s.threatLevel-i),s.threatLevel<30&&(s.state="NORMAL"),s.hiddenTurns=t,e.revengeActions.hidingMonths+=t,{success:!0,message:`${t}${s.name}`,threatReduction:i,months:t,newsEvent:{type:"RIVAL_HIDE_SUCCESS",data:{actor:s.name,months:t}}}}function kj(e){const t=Ro(e),n=pf(e),s=Kl(n.currentStageIndex||0),o=Sj(e);if(e.tier==="")return{success:!1,message:`${t.name}`};const a=Jr(e).total,l=Jr(t),d=(s==null?void 0:s.powerMultiplier)??1,p=Math.floor(l.total*bs*d),f=1-t.rumorCount*.05,c=p*Math.max(.5,f),u=a/(a+c),x=Math.random()<u;if(console.log(":",{:s==null?void 0:s.name,:a,:l.total,:Math.floor(c),:d,:`${t.rumorCount} (-${t.rumorCount*5}%)`,:`${(u*100).toFixed(1)}%`,:x?"":""}),x){const S=n.currentStageIndex>=hl;if(t.isDead=!0,t.state="DEAD",t.threatLevel=0,n.completedStages.includes(s.id)||n.completedStages.push(s.id),S)return n.sagaComplete=!0,n.currentStageIndex=hl,console.log("[] REVENGE_SAGA_COMPLETE"),Pt(o,"REVENGE_SAGA_COMPLETE",{actor:e.name,finalTarget:t.name}),{success:!0,victory:!0,sagaComplete:!0,message:(s==null?void 0:s.defeatLog)||`${t.name}...`,playerPower:a,rivalPower:Math.floor(c),newsEvent:{type:"RIVAL_DEFEATED",data:{actor:e.name,target:t.name}}};const w=Math.min(n.currentStageIndex+1,hl);n.currentStageIndex=w;const C=Kl(w);return ky(e,C,{resetProgress:!0}),console.log("[] REVENGE_STAGE_ADVANCERIVAL_DEFEATED"),Pt(o,"REVENGE_STAGE_ADVANCE",{actor:e.name,clearedStage:s.name,nextStage:C.name}),Pt(o,"RIVAL_DEFEATED",{actor:e.name,target:t.name}),{success:!0,victory:!0,stageCleared:s.id,nextStageUnlocked:!0,nextStage:C,message:(s==null?void 0:s.defeatLog)||`${t.name}`,transitionLog:s==null?void 0:s.unlockNextLog,playerPower:a,rivalPower:Math.floor(c),newsEvent:{type:"RIVAL_DEFEATED",data:{actor:e.name,target:t.name}}}}else return e.combatStats.hp=Math.max(1,e.combatStats.hp*.3),e.currentExp=0,e.resources.spiritStones=Math.floor(e.resources.spiritStones*.5),e.stats.health=Math.max(10,e.stats.health*.2),Pt(o,"REVENGE_DUEL_FAILED",{actor:e.name,rival:t.name,stageTitle:s==null?void 0:s.title}),{success:!0,victory:!1,message:`${t.name}...`,playerPower:a,rivalPower:Math.floor(c),newsEvent:{type:"RIVAL_VICTORY",data:{actor:t.name,target:e.name}}}}function jj(e){const t=Ro(e);if(t.hiddenTurns>0)return t.hiddenTurns-=1,null;if(t.threatLevel>=100){const n="",s=e.combatStats=e.combatStats||{},o=s.hp??s.maxHp??100,i=s.maxHp||Math.max(100,o),a=.3+e.stats.cunning/200,l=Math.random()<a,d=Math.floor(i*.4),p=Math.floor(i*.75);return e.revengeActions=e.revengeActions||{},e.revengeActions.assassinationAttempts=(e.revengeActions.assassinationAttempts||0)+1,l?(e.combatStats.hp=Math.max(10,o-d),t.threatLevel=Math.max(35,t.threatLevel-35),{type:"ASSASSINATION_SURVIVED",survived:!0,message:`${n}`,hpLoss:d}):(e.combatStats.hp=Math.max(5,o-p),e.currentExp=Math.max(0,Math.floor(e.currentExp*.6)),t.threatLevel=Math.max(40,t.threatLevel-45),{type:"ASSASSINATION_INJURED",survived:!1,message:`${n}`,hpLoss:p})}return null}function Cj(e){const t=Ro(e),n=pf(e),s=Kl(n.currentStageIndex||0);if(uf(t),rc(t),t.isDead)return null;vj(t,s),t.storyTimer=(t.storyTimer||0)+1;const o=(s==null?void 0:s.storyBeats)||[],i=t.lifeStage||0,a=o[i];if(!a)return null;const l=Math.max(1,a.delay||1);if(t.storyTimer<l||!(!(typeof a.exp=="number")||(t.currentExp||0)>=a.exp*.95))return null;if(t.lifeStage=i+1,t.storyTimer=0,a.tier&&(t.tier=a.tier,rc(t,a.tier)),typeof a.exp=="number"){const c=Math.floor(a.exp*bs);t.currentExp=Math.max(t.currentExp,c)}const f={actor:t.name,detail:a.detail||a.tier||(s==null?void 0:s.title),target:a.target,stageTitle:s==null?void 0:s.title,stageRole:s==null?void 0:s.role,stageTier:a.tier||(s==null?void 0:s.tier),description:a.description};return Object.keys(f).forEach(c=>{(f[c]===void 0||f[c]===null)&&delete f[c]}),{type:a.type||"RIVAL_STAGE_EVENT",data:f}}function Tj(e){const t=Ro(e);if(t.isDead||t.hiddenTurns>0)return 0;const n=Math.ceil(2*bs);let s=1;return t.threatLevel>=60?s=1.5*bs:t.threatLevel>=30&&(s=1.2*bs),Math.ceil(n*s)}function Ij(e){return e.isDead?null:e.threatLevel>=80?{type:"RIVAL_THREAT_CRITICAL",data:{actor:e.name}}:e.threatLevel>=60?{type:"RIVAL_THREAT_HIGH",data:{actor:e.name}}:e.threatLevel>=30?{type:"RIVAL_THREAT_MEDIUM",data:{actor:e.name,playerName:""}}:null}const _j={currentStageIndex:0,completedStages:[],sagaComplete:!1},Rj={lastRumorMonth:0,totalRumors:0,assassinationAttempts:0,hidingMonths:0},Mj=e=>e&&{...e,resources:{...e.resources||{}},rival:e.rival?{...e.rival,stats:{...e.rival.stats||{}},combatStats:{...e.rival.combatStats||{}},revengeProgress:e.rival.revengeProgress?{...e.rival.revengeProgress}:void 0}:e.rival,revengeActions:{...Rj,...e.revengeActions||{}},revengeProgress:e.revengeProgress?{...e.revengeProgress,completedStages:Array.isArray(e.revengeProgress.completedStages)?[...e.revengeProgress.completedStages]:[]}:{..._j},newsBuffer:Array.isArray(e.newsBuffer)?[...e.newsBuffer]:[],combatStats:e.combatStats?{...e.combatStats}:e.combatStats},Aj=({player:e,setPlayer:t,addLog:n})=>{var Y,q,ie;const[s,o]=y.useState(50),[i,a]=y.useState(1),[l,d]=y.useState(null),[p,f]=y.useState(null),[c,u]=y.useState(!1),x=y.useCallback((Z,...ve)=>{const V=Mj(e),ee=Z(V,...ve);return console.log(" [executeRevengeAction] :",ee),ee!=null&&ee.success&&t(V),ee},[e,t]),S=y.useCallback((Z,ve=5e3)=>{Z&&(d(Z),setTimeout(()=>d(null),ve))},[]),w=e.rival||{name:"",state:"NORMAL",lifeStage:0,threatLevel:0,rumorCount:0,isDead:!1,tier:"",currentExp:300},C=e.revengeProgress||{currentStageIndex:0,sagaComplete:!1},h=Math.min(C.currentStageIndex||0,Ji.length-1),g=Ji[h],b=!!C.sagaComplete,E=b?"":"",I=Jr(e).total,v=Jr(w).total,k=Math.max(.5,1-w.rumorCount*.05),T=bs*((g==null?void 0:g.powerMultiplier)||1),A=Math.floor(v*T*k),R=(Z,ve=50)=>Math.floor((Z??ve)*k*T),$=Z=>Z>=80?"#ff4444":Z>=60?"#ff8800":Z>=30?"#ffbb00":"#44ff44",O=Z=>Z>=80?"":Z>=60?"":Z>=30?"":"",Q=Z=>({NORMAL:"",ANXIOUS:"",FURIOUS:"",DEAD:""})[Z]||"",L=y.useCallback(()=>{if(c)return;u(!0);const Z=Math.floor(v*T*k),ve=x(wj,s);if(ve!=null&&ve.success&&ve.effectType!=="FAILED"){const V=Math.max(.5,1-(w.rumorCount+(s>=100?2:1))*.05),ee=Math.floor(v*T*V),he=Z-ee;ve.actualPowerLoss=he}S(ve),u(!1)},[x,S,c,s,v,T,k,w.rumorCount]),G=y.useCallback(()=>{if(c)return;u(!0);const Z=x(Ej,i,30);S(Z),u(!1)},[x,i,S,c]),ne=()=>{var ve,V;if(console.log("handleDuel:",e.tier),console.log(":",e),!of(e).canDuel){if(((ve=e.stats)==null?void 0:ve.health)<20){window.showResult?window.showResult(" ",`${Math.floor(e.stats.health)}/100`,!1,null,!1):f({title:" ",message:`${Math.floor(e.stats.health)}/100`});return}else if(((V=e.stats)==null?void 0:V.health)<30&&window.showConfirm){window.showConfirm(` 30${Math.floor(e.stats.health)}/100`,()=>{ae()});return}}ae()},ae=()=>{const Z=w.name,ve=(g==null?void 0:g.title)||"";window.showConfirm&&window.showConfirm(`${ve}${Z}`,()=>{const V=x(kj);if(console.log(" [RevengePanel] :",V),V!=null&&V.success)if(console.log("  - :",V.victory),V.victory){const ee=V.sagaComplete?" ":` ${Z}`,he=V.message||`${Z}`;if(console.log(" :",ee),S({success:!0,message:he,transitionLog:V.transitionLog,nextStage:V.nextStage,sagaComplete:V.sagaComplete},V.sagaComplete?8e3:6e3),f({title:ee,message:he,type:"victory"}),window.showResult&&typeof window.showResult=="function"?window.showResult(ee,he,!0,null,!1):(console.warn(" window.showResult "),f({title:ee,message:he,type:"victory"})),n){const ge=V.sagaComplete?` ${Z}`:` ${Z}${g==null?void 0:g.title}`;n(ge,"","")}}else{const ee=V.message||`${Z}...`;if(console.log(" :"," ",ee),console.log(" window.showResult :",{exists:!!window.showResult,isFunction:typeof window.showResult=="function"}),S({success:!1,message:ee,damage:"",newsEvent:V.newsEvent},6e3),f({title:" ",message:ee,type:"defeat"}),window.showResult&&typeof window.showResult=="function")try{console.log("  window.showResult"),window.showResult(" ",ee,!1,null,!1)}catch(he){console.error(" window.showResult :",he),f({title:" ",message:ee,type:"defeat"})}else console.warn(" window.showResult "+typeof window.showResult+""),f({title:" ",message:ee,type:"defeat"});n&&n(` ${Z}`,"","")}else{console.error(" :",V);const ee=V&&V.message||`${Z}`;window.showResult&&typeof window.showResult=="function"?window.showResult(" ",ee,!1,null,!1):f({title:" ",message:ee})}})};return w.isDead&&b?r.jsx("div",{style:ke.panel,children:r.jsxs("div",{style:ke.completed,children:[r.jsx("h2",{children:"  "}),r.jsxs("p",{children:[w.name,""]}),r.jsx("p",{children:"..."})]})}):r.jsxs("div",{style:ke.panel,children:[r.jsxs("div",{style:ke.header,children:[r.jsx("h2",{style:ke.title,children:" "}),r.jsxs("p",{style:ke.subtitle,children:["",w.name]})]}),r.jsxs("div",{style:ke.stageNarrative,children:[r.jsxs("div",{style:ke.stageFocusHeader,children:[r.jsxs("span",{style:ke.stageBadge,children:["",h+1,""]}),r.jsx("span",{style:ke.stageStatus,children:E})]}),r.jsx("div",{style:ke.stageFocusName,children:w.name}),r.jsx("div",{style:ke.stageFocusTitle,children:(g==null?void 0:g.title)||""}),r.jsx("p",{style:ke.stageNarrativeText,children:(g==null?void 0:g.flavor)||""}),b&&r.jsx("p",{style:ke.stageNarrativeNext,children:""})]}),r.jsxs("div",{style:ke.rivalStatus,children:[r.jsx("h3",{style:ke.sectionTitle,children:""}),r.jsxs("div",{style:ke.statusGrid,children:[r.jsxs("div",{style:ke.statusItem,children:[r.jsx("span",{style:ke.statusLabel,children:""}),r.jsx("span",{style:ke.statusValue,children:w.tier})]}),r.jsxs("div",{style:ke.statusItem,children:[r.jsx("span",{style:ke.statusLabel,children:""}),r.jsx("span",{style:ke.statusValue,children:Q(w.state)})]}),r.jsxs("div",{style:ke.statusItem,children:[r.jsx("span",{style:ke.statusLabel,children:""}),r.jsxs("span",{style:{...ke.statusValue,color:$(w.threatLevel)},children:[O(w.threatLevel)," ",w.threatLevel,"%"]})]}),r.jsxs("div",{style:ke.statusItem,children:[r.jsx("span",{style:ke.statusLabel,children:""}),r.jsxs("span",{style:ke.statusValue,children:[" ",w.rumorCount*5,"%"]})]})]}),r.jsx("div",{style:ke.threatBar,children:r.jsx("div",{style:{...ke.threatFill,width:`${w.threatLevel}%`,backgroundColor:$(w.threatLevel)}})}),w.threatLevel>=80&&r.jsx("div",{style:ke.dangerWarning,children:" "})]}),r.jsxs("div",{style:ke.actions,children:[r.jsx("h3",{style:ke.sectionTitle,children:""}),r.jsxs("div",{style:ke.actionCard,children:[r.jsxs("div",{style:ke.actionHeader,children:[r.jsx("h4",{style:ke.actionTitle,children:" "}),r.jsxs("span",{style:ke.actionCost,children:["",i*30," "]})]}),r.jsxs("p",{style:ke.actionDesc,children:["",w.name,"80%"]}),r.jsxs("div",{style:ke.actionControlsVertical,children:[r.jsxs("select",{value:i,onChange:Z=>a(Number(Z.target.value)),style:ke.select,children:[r.jsx("option",{value:"1",children:"1-40%"}),r.jsx("option",{value:"2",children:"2-80%"}),r.jsx("option",{value:"3",children:"3-100%"})]}),r.jsxs("button",{style:ke.hideBtn,onClick:G,disabled:c||!(e!=null&&e.resources)||e.resources.spiritStones<i*30,children:[" (",i*30,")"]})]})]}),r.jsxs("div",{style:ke.actionCard,children:[r.jsxs("div",{style:ke.actionHeader,children:[r.jsx("h4",{style:ke.actionTitle,children:" "}),r.jsxs("span",{style:ke.actionCost,children:["",s," "]})]}),r.jsxs("p",{style:ke.actionDesc,children:["",w.name,"",r.jsx("br",{}),""]}),r.jsx("div",{style:ke.actionControls,children:r.jsx("input",{type:"range",min:"50",max:"150",step:"10",value:s,onChange:Z=>o(Number(Z.target.value)),style:ke.slider})}),r.jsxs("button",{style:ke.rumorBtn,onClick:L,disabled:c||!(e!=null&&e.resources)||e.resources.spiritStones<s,children:[" (",s,")"]}),r.jsxs("div",{style:ke.actionInfo,children:["",Math.min(90,60+s/2),"% | +",s>=100?25:10]})]}),r.jsxs("div",{style:{...ke.actionCard,...ke.finalDuelCard},children:[r.jsxs("div",{style:ke.actionHeader,children:[r.jsx("h4",{style:ke.actionTitle,children:" "}),r.jsx("span",{style:ke.actionWarning,children:""})]}),r.jsxs("p",{style:ke.actionDesc,children:["",w.name,"",r.jsx("br",{}),r.jsx("strong",{children:""}),""]}),r.jsxs("div",{style:ke.powerComparison,children:[r.jsxs("div",{style:ke.powerItem,children:[r.jsx("span",{children:""}),r.jsx("span",{children:I})]}),r.jsxs("div",{style:ke.powerItem,children:[r.jsx("span",{children:""}),r.jsx("span",{children:A})]})]}),r.jsxs("div",{style:{fontSize:"13px",color:"#444",marginTop:8},children:[": ",Math.round(j2(e,{...w,combatStats:{...w.combatStats||{},atk:R((Y=w.combatStats)==null?void 0:Y.atk,50),def:R((q=w.combatStats)==null?void 0:q.def,20),maxHp:R((ie=w.combatStats)==null?void 0:ie.maxHp,500)}}).prob*100),"%"]}),r.jsx("div",{style:{fontSize:"12px",color:"#666",marginTop:"8px"},children:""}),r.jsx("button",{style:ke.duelBtn,onClick:ne,disabled:e.tier==="",children:""}),e.tier===""&&r.jsx("div",{style:ke.actionWarningText,children:" "})]})]}),l&&r.jsxs("div",{style:{...ke.resultToast,backgroundColor:l.success?"#4caf50":"#f44336"},children:[r.jsx("p",{children:l.message}),l.damage&&r.jsxs("p",{children:["",l.damage]}),l.actualPowerLoss&&r.jsxs("p",{children:["-",l.actualPowerLoss," (-",Math.round(l.actualPowerLoss/A*100),"%)"]}),l.threatIncrease&&r.jsxs("p",{children:["+",l.threatIncrease,"%"]}),l.threatReduction&&r.jsxs("p",{children:["-",l.threatReduction,"%"]}),l.transitionLog&&r.jsx("p",{children:l.transitionLog}),l.nextStage&&r.jsxs("p",{children:["",l.nextStage.name,"",l.nextStage.title,""]})]}),p&&r.jsx("div",{style:ke.modalOverlay,children:r.jsxs("div",{style:ke.modalCard,children:[r.jsx("div",{style:ke.modalIcon,children:p.type==="victory"?"":p.type==="defeat"?"":""}),r.jsx("h3",{style:{marginBottom:10},children:p.title}),r.jsx("p",{style:ke.modalText,children:p.message}),r.jsx("button",{style:ke.modalButton,onClick:()=>f(null),children:p.type==="victory"?"":""})]})})]})},ke={panel:{padding:"20px",maxWidth:"900px",margin:"0 auto",color:"#e0d5c7"},header:{textAlign:"center",marginBottom:"30px",borderBottom:"2px solid #8b4513",paddingBottom:"15px"},stageFocusHeader:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"10px"},stageBadge:{fontSize:"12px",letterSpacing:"2px",padding:"4px 10px",borderRadius:"999px",border:"1px solid #ffd700",color:"#ffd700"},stageStatus:{fontSize:"12px",padding:"4px 12px",borderRadius:"999px",background:"rgba(255,255,255,0.08)",color:"#fff"},stageFocusName:{fontSize:"22px",fontWeight:"bold",color:"#ffe4c4"},stageFocusTitle:{fontSize:"14px",color:"#ffcc80",marginTop:"4px"},stageNarrative:{border:"1px solid rgba(255,255,255,0.1)",borderRadius:"10px",padding:"16px",marginBottom:"20px",background:"rgba(0,0,0,0.25)"},stageNarrativeText:{fontSize:"14px",color:"#f0e1c3",marginTop:"6px"},stageNarrativeNext:{fontSize:"13px",color:"#ffd700",marginTop:"8px"},title:{color:"#ff6b6b",fontSize:"28px",marginBottom:"8px",textShadow:"2px 2px 4px rgba(0,0,0,0.5)"},subtitle:{color:"#ffd700",fontSize:"18px",fontStyle:"italic"},rivalStatus:{background:"linear-gradient(135deg, rgba(40, 20, 20, 0.8), rgba(60, 30, 30, 0.8))",border:"2px solid #8b4513",borderRadius:"12px",padding:"20px",marginBottom:"25px",boxShadow:"0 4px 12px rgba(0,0,0,0.4)"},sectionTitle:{color:"#ffd700",marginBottom:"15px",fontSize:"20px"},statusGrid:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(140px, 1fr))",gap:"12px",marginBottom:"15px"},statusItem:{display:"flex",justifyContent:"space-between",padding:"8px 12px",background:"rgba(0,0,0,0.3)",borderRadius:"6px"},statusLabel:{color:"#bbb",fontWeight:"500"},statusValue:{color:"#fff",fontWeight:"bold"},threatBar:{width:"100%",height:"30px",background:"rgba(0,0,0,0.5)",borderRadius:"15px",overflow:"hidden",border:"2px solid #666",marginTop:"15px",position:"relative"},threatFill:{height:"100%",transition:"width 0.5s ease, background-color 0.5s ease",display:"flex",alignItems:"center",justifyContent:"center",fontWeight:"bold",color:"white",textShadow:"1px 1px 2px rgba(0,0,0,0.8)"},dangerWarning:{marginTop:"15px",padding:"12px",background:"linear-gradient(90deg, #ff4444, #ff6b6b)",border:"2px solid #ff0000",borderRadius:"8px",color:"white",fontWeight:"bold",textAlign:"center",boxShadow:"0 0 20px rgba(255, 68, 68, 0.6)"},actions:{marginTop:"30px"},actionCard:{background:"linear-gradient(135deg, rgba(30, 30, 40, 0.9), rgba(50, 40, 60, 0.9))",border:"2px solid #8b4513",borderRadius:"12px",padding:"20px",marginBottom:"20px",boxShadow:"0 4px 12px rgba(0,0,0,0.4)"},finalDuelCard:{background:"linear-gradient(135deg, rgba(60, 20, 20, 0.9), rgba(80, 30, 30, 0.9))",borderColor:"#ff4444"},actionHeader:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"12px",borderBottom:"1px solid rgba(255, 255, 255, 0.2)",paddingBottom:"10px"},actionTitle:{color:"#ffd700",fontSize:"18px",margin:0},actionCost:{color:"#66ff66",fontWeight:"bold",fontSize:"14px"},actionWarning:{color:"#ff6b6b",fontWeight:"bold",fontSize:"14px"},actionDesc:{color:"#ccc",lineHeight:"1.6",marginBottom:"15px",fontSize:"14px"},actionControls:{display:"flex",flexDirection:"column",gap:"12px",marginBottom:"12px"},actionControlsVertical:{display:"flex",flexDirection:"column",gap:"12px"},slider:{width:"100%",height:"8px"},select:{width:"100%",padding:"12px",background:"rgba(0, 0, 0, 0.5)",color:"#fff",border:"2px solid #8b4513",borderRadius:"6px",fontSize:"14px",cursor:"pointer"},rumorBtn:{width:"100%",padding:"14px 24px",border:"none",borderRadius:"8px",background:"linear-gradient(135deg, #6a5acd, #8b7ad8)",color:"white",fontWeight:"bold",fontSize:"15px",cursor:"pointer",boxShadow:"0 4px 8px rgba(0,0,0,0.3)",transition:"transform 0.2s"},hideBtn:{width:"100%",padding:"14px 24px",border:"none",borderRadius:"8px",background:"linear-gradient(135deg, #4a90e2, #5ba3f5)",color:"white",fontWeight:"bold",fontSize:"15px",cursor:"pointer",boxShadow:"0 4px 8px rgba(0,0,0,0.3)",transition:"transform 0.2s"},duelBtn:{width:"100%",background:"linear-gradient(135deg, #ff4444, #ff6b6b)",color:"white",fontSize:"16px",padding:"14px",border:"none",borderRadius:"8px",fontWeight:"bold",cursor:"pointer",boxShadow:"0 4px 8px rgba(0,0,0,0.3)"},actionInfo:{color:"#aaa",fontSize:"12px",marginTop:"5px"},actionWarningText:{color:"#ff6b6b",fontSize:"13px",textAlign:"center",marginTop:"10px",fontWeight:"bold"},powerComparison:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"15px",margin:"15px 0",padding:"15px",background:"rgba(0, 0, 0, 0.3)",borderRadius:"8px"},powerItem:{display:"flex",flexDirection:"column",alignItems:"center",gap:"5px",color:"#bbb",fontSize:"13px"},completed:{textAlign:"center",padding:"60px 40px",background:"linear-gradient(135deg, rgba(40, 80, 40, 0.8), rgba(60, 100, 60, 0.8))",border:"3px solid #4caf50",borderRadius:"16px",boxShadow:"0 8px 24px rgba(0,0,0,0.5)"},resultToast:{position:"fixed",bottom:"30px",left:"50%",transform:"translateX(-50%)",padding:"20px 30px",borderRadius:"12px",boxShadow:"0 8px 24px rgba(0,0,0,0.5)",zIndex:9999,minWidth:"300px",maxWidth:"500px",color:"white"},modalOverlay:{position:"fixed",inset:0,background:"rgba(0,0,0,0.65)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:99999},modalCard:{width:"90%",maxWidth:420,background:"rgba(24,17,13,0.95)",border:"1px solid rgba(255,255,255,0.2)",borderRadius:18,padding:"24px 24px 28px",textAlign:"center",boxShadow:"0 20px 45px rgba(0,0,0,0.45)"},modalIcon:{fontSize:42,marginBottom:12},modalText:{lineHeight:1.7,fontSize:15,color:"#f7d8b4",marginBottom:18},modalButton:{padding:"10px 20px",borderRadius:999,border:"none",background:"linear-gradient(120deg, #f06292, #f7b733)",color:"#fff",fontWeight:"bold",cursor:"pointer",boxShadow:"0 6px 18px rgba(240,98,146,0.45)"}},Nj=(e,t="")=>{var n,s,o,i,a,l,d,p,f,c,u,x,S,w,C,h,g;try{const b={player:{name:(n=e.player)==null?void 0:n.name,age:(s=e.player)==null?void 0:s.age,hp:(o=e.player)==null?void 0:o.hp,maxHp:(i=e.player)==null?void 0:i.maxHp,cultivation:(a=e.player)==null?void 0:a.cultivation,tier:(l=e.player)==null?void 0:l.tier,tierTitle:(d=e.player)==null?void 0:d.tierTitle,wealth:(p=e.player)==null?void 0:p.wealth,mood:(f=e.player)==null?void 0:f.mood,time:(c=e.player)==null?void 0:c.time,avatar:(u=e.player)==null?void 0:u.avatar,personality:(x=e.player)==null?void 0:x.personality,appearance:(S=e.player)==null?void 0:S.appearance,worldEvents:(w=e.player)==null?void 0:w.worldEvents,newsBuffer:(C=e.player)==null?void 0:C.newsBuffer,familyRatingSummary:(h=e.player)==null?void 0:h.familyRatingSummary,businesses:((g=e.player)==null?void 0:g.businesses)||[]},children:e.children||[],fallenChildren:e.fallenChildren||[],activeNpcs:e.activeNpcs||[],deadNpcs:e.deadNpcs||[],inventory:e.inventory||[],gameStage:e.gameStage,messages:e.messages||{},lastMessageCheck:e.lastMessageCheck||{},pendingSectChoices:e.pendingSectChoices,testQueue:e.testQueue},E=JSON.stringify(b),I=btoa(unescape(encodeURIComponent(E))),v=(I.length/1024).toFixed(2);return console.log(` : ${v} KB ()`),I}catch(b){return console.error(" :",b),null}},Lj=e=>{try{const t=e.trim();if(!t)return console.error(" "),null;let n;try{n=decodeURIComponent(escape(atob(t)))}catch(o){return console.error(" Base64 :",o.message),null}let s;try{s=JSON.parse(n)}catch(o){return console.error(" JSON :",o.message),null}if(!s.player)return console.error("  player "),null;if(s.player.cultivation!==void 0){const o=Number(s.player.cultivation);s.player.cultivation=isNaN(o)?0:o}return console.log(" "),console.log(` : ${s.player.name}, : ${s.player.cultivation}`),s}catch(t){return console.error(" :",t),null}},$j=(e,t="save.txt")=>{try{const n=new Blob([e],{type:"text/plain;charset=utf-8"}),s=URL.createObjectURL(n),o=document.createElement("a");o.href=s,o.download=t,document.body.appendChild(o),o.click(),document.body.removeChild(o),URL.revokeObjectURL(s)}catch(n){console.error(":",n)}},Bj=e=>new Promise((t,n)=>{const s=new FileReader;s.onload=o=>t(o.target.result),s.onerror=o=>n(o),s.readAsText(e)}),Oj=({gameState:e,onLoadGame:t,playerName:n=""})=>{const[s,o]=y.useState("export"),[i,a]=y.useState(""),[l,d]=y.useState(""),[p,f]=y.useState(""),[c,u]=y.useState("info"),x=(v,k="info")=>{f(v),u(k),setTimeout(()=>f(""),5e3)},S=()=>{if(!e){x("","error");return}try{const v=Nj(e,n);if(!v){x("","error");return}a(v);const k=(v.length/1024).toFixed(2);x(` : ${k} KB`,"success")}catch(v){console.error(":",v),x(": "+v.message,"error")}},w=()=>{if(!i){x("","error");return}navigator.clipboard.writeText(i).then(()=>{x(" ","success")}).catch(()=>{x("","error")})},C=()=>{if(!i){x("","error");return}const v=new Date().toISOString().replace(/[:.]/g,"-"),k=`save_${n}_${v}.txt`;$j(i,k),x(" ","success")},h=async v=>{var T;const k=(T=v.target.files)==null?void 0:T[0];if(k)try{const A=await Bj(k);d(A),x(" ","success")}catch(A){console.error(":",A),x("","error")}},g=async()=>{try{const v=await navigator.clipboard.readText();d(v),x(" ","success")}catch(v){console.error(":",v),x("","error")}},b=()=>{var v,k;if(!l.trim()){x("","error");return}try{console.log(" ..."),console.log(":",l.trim().length),console.log(":",l.trim().substring(0,30));const T=Lj(l.trim());if(!T){console.error(" "),x(` 

 
  (F12) 
 
 `,"error");return}const A=`
${((v=T.player)==null?void 0:v.name)||""}
${((k=T.player)==null?void 0:k.cultivation)||0}`;window.showConfirm&&window.showConfirm(A,()=>{t&&t(null,T),x(" ","success"),d("")})}catch(T){console.error(":",T),x(" : "+T.message,"error")}},E={container:{padding:"20px",background:"linear-gradient(135deg, rgba(76, 175, 80, 0.1) 0%, rgba(76, 175, 80, 0.05) 100%)",borderRadius:"8px",border:"1px solid rgba(76, 175, 80, 0.3)"},tabButtons:{display:"flex",gap:"10px",marginBottom:"20px"},tabButton:v=>({padding:"8px 16px",border:"none",borderRadius:"4px",background:v?"#4caf50":"#ddd",color:v?"white":"#333",cursor:"pointer",fontWeight:"bold",fontSize:"14px",transition:"all 0.3s"}),section:{marginBottom:"20px"},label:{display:"block",marginBottom:"8px",fontWeight:"bold",color:"#333"},input:{width:"100%",padding:"8px 12px",border:"1px solid #ccc",borderRadius:"4px",fontSize:"14px",fontFamily:"monospace",boxSizing:"border-box"},textarea:{width:"100%",minHeight:"150px",padding:"12px",border:"1px solid #ccc",borderRadius:"4px",fontSize:"12px",fontFamily:"monospace",boxSizing:"border-box",background:"#f9f9f9",color:"#333"},button:{padding:"8px 16px",margin:"5px 5px 5px 0",border:"none",borderRadius:"4px",background:"#4caf50",color:"white",cursor:"pointer",fontSize:"14px",fontWeight:"bold",transition:"background 0.3s"},buttonSecondary:{background:"#2196F3"},buttonDanger:{background:"#ff9800"},buttonDisabled:{background:"#ccc",cursor:"not-allowed"},message:{padding:"12px",borderRadius:"4px",marginBottom:"15px",fontSize:"14px",fontWeight:"bold"},messageSuccess:{background:"#c8e6c9",color:"#2e7d32",border:"1px solid #81c784"},messageError:{background:"#ffcdd2",color:"#c62828",border:"1px solid #ef5350"},messageInfo:{background:"#bbdefb",color:"#1565c0",border:"1px solid #64b5f6"},passwordContainer:{display:"flex",gap:"10px",alignItems:"center"},passwordInput:{flex:1},checkbox:{width:"18px",height:"18px",cursor:"pointer"},info:{fontSize:"12px",color:"#666",marginTop:"8px",padding:"8px",background:"#f0f0f0",borderRadius:"4px",borderLeft:"3px solid #2196F3"},fileInput:{display:"none"},fileInputLabel:{padding:"8px 16px",background:"#2196F3",color:"white",borderRadius:"4px",cursor:"pointer",fontSize:"14px",fontWeight:"bold",display:"inline-block",transition:"background 0.3s"}},I=()=>{const v=E.message;return c==="success"?{...v,...E.messageSuccess}:c==="error"?{...v,...E.messageError}:{...v,...E.messageInfo}};return r.jsxs("div",{style:E.container,children:[r.jsx("h3",{style:{marginTop:0,color:"#2e7d32"},children:" /"}),r.jsxs("div",{style:E.tabButtons,children:[r.jsx("button",{style:E.tabButton(s==="export"),onClick:()=>o("export"),children:" "}),r.jsx("button",{style:E.tabButton(s==="import"),onClick:()=>o("import"),children:" "})]}),p&&r.jsx("div",{style:I(),children:p}),s==="export"&&r.jsxs("div",{children:[r.jsx("div",{style:E.section,children:r.jsx("button",{style:E.button,onClick:S,children:" "})}),i&&r.jsxs("div",{style:E.section,children:[r.jsx("label",{style:E.label,children:" "}),r.jsx("textarea",{value:i,readOnly:!0,style:E.textarea}),r.jsxs("div",{style:{marginTop:"10px"},children:[r.jsx("button",{style:E.button,onClick:w,children:" "}),r.jsx("button",{style:{...E.button,...E.buttonSecondary},onClick:C,children:" "})]}),r.jsx("div",{style:E.info,children:" "})]})]}),s==="import"&&r.jsxs("div",{children:[r.jsxs("div",{style:E.section,children:[r.jsx("label",{style:E.label,children:" "}),r.jsx("input",{type:"file",accept:".txt,.json",onChange:h,style:E.fileInput,id:"saveFileInput"}),r.jsx("label",{htmlFor:"saveFileInput",style:E.fileInputLabel,children:" "}),r.jsx("button",{style:{...E.button,...E.buttonSecondary,marginLeft:"10px"},onClick:g,children:" "})]}),r.jsxs("div",{style:E.section,children:[r.jsx("label",{style:E.label,children:" "}),r.jsx("textarea",{value:l,onChange:v=>d(v.target.value),placeholder:"...",style:E.textarea})]}),r.jsxs("div",{style:E.section,children:[r.jsx("button",{style:E.button,onClick:b,children:" "}),r.jsx("button",{style:{...E.button,...E.buttonDanger},onClick:()=>{d("")},children:" "})]}),r.jsx("div",{style:E.info,children:" "})]})]})},Pj=({player:e,onSave:t,onLoad:n,onReset:s,onOpenGuide:o,autoAssignEnabled:i=!1,onToggleAutoAssign:a,autoSkipSpiritTest:l=!1,onToggleAutoSkip:d,skipChildGiftPopups:p=!1,onToggleSkipChildGiftPopups:f,skipShuraFieldEvents:c=!1,onToggleSkipShuraFieldEvents:u,skipRomanceGiftPopups:x=!1,onToggleSkipRomanceGiftPopups:S,skipJealousyPopups:w=!1,onToggleSkipJealousyPopups:C,isPortraitViewport:h=!0,isOrientationFixApplied:g=!1,onRequestPortraitFix:b=()=>{},onReleasePortraitFix:E=()=>{},onAutoAssignSpouses:I=()=>{},onRedeemCode:v=null,gameState:k=null})=>{const[T,A]=y.useState([]),[R,$]=y.useState([]),[O,Q]=y.useState({used:"0",usedMB:"0"}),[L,G]=y.useState({enabled:!1,syncing:!1}),[ne,ae]=y.useState([]),[Y,q]=y.useState(!1),[ie,Z]=y.useState(""),[ve,V]=y.useState(""),[ee,he]=y.useState(""),[ge,me]=y.useState(!1),[Me,$e]=y.useState(null),[je,ct]=y.useState(!0),[vt,De]=y.useState(!0),[D,Se]=y.useState(!0),[de,Ie]=y.useState(!1),[Be,dt]=y.useState(null),[_n,wn]=y.useState(!1),[Mo,Ic]=y.useState(!1),[oa,_s]=y.useState(!1),[Ao,Rn]=y.useState(!1),[qt,_c]=y.useState(!1),[tr,ia]=y.useState(!1),[aa,ts]=y.useState(!1),[No,Ae]=y.useState(!1),[Un,Rc]=y.useState(!1),[tn,Mn]=y.useState(!1),[ns,Mc]=y.useState(null),[rs,la]=y.useState(""),[Rs,Ac]=y.useState(null),Ms=[{key:"autoAssign",label:"",brief:"12",detail:["","1)  12 ","2) ","3) "].join(`
`),checked:!!i,onChange:a},{key:"autoSpirit",label:"",brief:"",detail:["","1) ","2) ","3) "].join(`
`),checked:!!l,onChange:d},{key:"skipGiftModal",label:"",brief:"",detail:["","1) ","2) ","3) "].join(`
`),checked:!!p,onChange:f}],Nc=[i?"":"",l?"":"",p?"":""].join("  "),Lo=[{key:"skipShura",label:"",brief:"",detail:["","1) ","2) ","3) "].join(`
`),checked:!!c,onChange:u},{key:"skipRomanceGift",label:"",brief:"NPC ",detail:["","1) ","2) ","3) "].join(`
`),checked:!!x,onChange:S},{key:"skipJealousy",label:"",brief:"",detail:["","1) ","2) ","3) "].join(`
`),checked:!!w,onChange:C}],As=[c?"":"",x?"":"",w?"":""].join("  "),Ir=F=>{dt(He=>He===F?null:F)},Ns=F=>{Mc(He=>He===F?null:F)},Lc=()=>{if(typeof v!="function"){Ac({success:!1,message:""});return}const F=v(rs);F!=null&&F.success&&la(""),Ac(F||{success:!1,message:""})},$c=T.filter(F=>F.exists).length,Bc=R.filter(F=>F.exists).length,Oc=`${ie?"API Key ":"API Key "}   ${ee||""}`,ca=je?"":"",$o=vt?"AI ":"",Bo=D?"AI ":"",Oo=` ${$c}    ${Bc}   ${O.usedMB} MB`,Pc="",Po=`${h?"":""}  ${g?"":""}`;y.useEffect(()=>{_r(),Do(),pa(),Ls(),ua(),zo();try{const F="__test__";localStorage.setItem(F,"test"),localStorage.removeItem(F)}catch(F){console.error("localStorage :",F),window.showResult&&window.showResult("",` 


1. 
2. 
3. 

`,!1,null,!1)}},[]);const zo=()=>{const F=wy();G(F),F.enabled&&da()},da=async()=>{try{q(!0);const F=await ab();ae(F)}catch(F){console.error(":",F)}finally{q(!1)}},_r=()=>{try{const F=df();console.log(":",F),A(F),ua()}catch(F){console.error(":",F),A([{slot:1,exists:!1},{slot:2,exists:!1},{slot:3,exists:!1}])}},Do=()=>{try{const F=xy();console.log(":",F),$(F)}catch(F){console.error(":",F),$([])}},ua=()=>{const F=py();Q(F)},Ls=()=>{const F=localStorage.getItem("enableGazette"),He=localStorage.getItem("useAIForLetter"),Gn=localStorage.getItem("useAIForTianjiProfile");ct(F!=="false"),De(He!=="false"),Se(Gn!=="false")},Fo=()=>{localStorage.setItem("enableGazette",je.toString()),localStorage.setItem("useAIForLetter",vt.toString()),localStorage.setItem("useAIForTianjiProfile",D.toString()),window.showResult&&window.showResult("","",!0,null,!1)},pa=()=>{const F=localStorage.getItem("game_api_key")||"",He=localStorage.getItem("game_api_url")||"https://api.deepseek.com/chat/completions",Gn=localStorage.getItem("game_api_model")||"deepseek-chat";Z(F),V(He),he(Gn)},zc=()=>{localStorage.setItem("game_api_key",ie),localStorage.setItem("game_api_url",ve),localStorage.setItem("game_api_model",ee),window.showResult&&window.showResult("AI ","AI ",!0,null,!1),$e(null)},Dc=async()=>{if(!ie||!ve){window.showResult&&window.showResult(""," API Key  URL",!1,null,!1);return}me(!0),$e(null);try{const F=await fw(ie,ve);$e(F?{success:!0,message:" API "}:{success:!1,message:" "})}catch(F){$e({success:!1,message:` : ${F.message}`})}finally{me(!1)}},fa=F=>{const He=t(F);window.showResult&&(He.success?(window.showResult("",` : ${F}
: ${He.time}
: ${He.size} KB`,!0,null,!1),_r()):He.error==="QUOTA_EXCEEDED"?window.showResult("",` 


1. 
2. 
3. 

: ${He.size||""} KB`,!1,null,!1):He.error==="STORAGE_TOO_LARGE"?window.showResult("",` ${He.size} KB



`,!1,null,!1):window.showResult("",` 

: ${He.error||""}
: ${He.message||""}


1. 
2. 
3. `,!1,null,!1))},Fc=F=>{window.showConfirm&&window.showConfirm(` ${F} `,()=>n(F))},ma=F=>{window.showConfirm&&window.showConfirm(` ${F} `,()=>{hy(F),_r(),window.showResult&&window.showResult("",` ${F} `,!0,null,!1)})},Hc=F=>{window.showConfirm&&window.showConfirm(` ${F} `,()=>{try{const He=yy(F);He?(n(null,He),window.showResult&&window.showResult("",`  ${F} 
: ${He.gameTime||""}`,!0,null,!1)):window.showResult&&window.showResult(""," ",!1,null,!1)}catch(He){console.error(":",He),window.showResult&&window.showResult(""," "+He.message,!1,null,!1)}})},ha=()=>{window.showConfirm&&window.showConfirm(`

`,()=>{by(),Do(),window.showResult&&window.showResult(""," ",!0,null,!1)})},Wc=()=>{window.showConfirm&&window.showConfirm(" ",()=>{s(),_r()})},$s=async F=>{if(!L.enabled){window.showResult&&window.showResult("",` 
 TapTap `,!1,null,!1);return}window.showConfirm&&window.showConfirm(` ${F} `,async()=>{try{q(!0);const He=await vy(F);window.showResult&&window.showResult("",` 

: ${He.action==="create"?"":""}
UUID: ${He.uuid}`,!0,null,!1),await da()}catch(He){window.showResult&&window.showResult("",` 

${He.message}


 65
 
 10MB`,!1,null,!1)}finally{q(!1)}})},ga=async F=>{if(!L.enabled){window.showResult&&window.showResult("",` 
 TapTap `,!1,null,!1);return}window.showConfirm&&window.showConfirm(` ${F} `,async()=>{var He,Gn;try{q(!0);const Bs=await Sy(F);window.showResult&&window.showResult("",` 

: ${((He=Bs.player)==null?void 0:He.name)||""}
: ${((Gn=Bs.player)==null?void 0:Gn.cultivation)||0} `,!0,null,!1),_r()}catch(Bs){window.showResult&&window.showResult("",` 

${Bs.message}`,!1,null,!1)}finally{q(!1)}})};return r.jsxs("div",{style:{padding:"20px"},children:[r.jsx("h3",{style:{borderBottom:"1px solid #ccc",paddingBottom:"10px"},children:" "}),r.jsxs("div",{style:W.collapsibleCard,children:[r.jsxs("button",{type:"button",style:W.collapsibleHeader,onClick:()=>Ie(F=>!F),children:[r.jsxs("div",{style:W.collapsibleTitleRow,children:[r.jsx("span",{children:" "}),r.jsx("span",{style:W.collapsibleHint,children:de?"":""})]}),r.jsxs("div",{style:W.collapsibleSummary,children:["",Nc]})]}),de&&r.jsxs("div",{style:W.collapseBody,children:[r.jsx("p",{style:{...W.info,marginBottom:"10px"},children:""}),r.jsx("div",{style:W.optionGroup,children:Ms.map(F=>r.jsxs("div",{style:W.optionCard,children:[r.jsxs("div",{style:W.optionRow,children:[r.jsxs("label",{style:W.optionToggle,children:[r.jsx("input",{type:"checkbox",checked:F.checked,onChange:He=>F.onChange&&F.onChange(He.target.checked)}),r.jsx("span",{children:F.checked?"":""})]}),r.jsxs("button",{type:"button",style:W.optionText,onClick:()=>Ir(F.key),children:[r.jsxs("div",{style:W.optionTitleRow,children:[r.jsx("span",{children:F.label}),r.jsx("span",{style:W.detailHint,children:Be===F.key?"":""})]}),r.jsx("div",{style:W.optionBrief,children:F.brief})]})]}),Be===F.key&&r.jsx("div",{style:W.optionDetail,children:F.detail})]},F.key))}),r.jsxs("div",{style:W.familyActionCard,children:[r.jsxs("div",{style:W.familyActionHeader,children:[r.jsx("span",{children:" "}),r.jsx("span",{style:{fontSize:"11px",color:"#8d6e63"},children:""})]}),r.jsx("p",{style:W.familyActionDesc,children:" 500 "}),r.jsx("button",{type:"button",style:W.familyActionBtn,onClick:()=>I&&I(),children:" "}),r.jsx("small",{style:W.hint,children:""})]})]})]}),r.jsxs("div",{style:W.collapsibleCard,children:[r.jsxs("button",{type:"button",style:W.collapsibleHeader,onClick:()=>Mn(F=>!F),children:[r.jsxs("div",{style:W.collapsibleTitleRow,children:[r.jsx("span",{children:" "}),r.jsx("span",{style:W.collapsibleHint,children:tn?"":""})]}),r.jsxs("div",{style:W.collapsibleSummary,children:["",As]})]}),tn&&r.jsxs("div",{style:W.collapseBody,children:[r.jsx("p",{style:{...W.info,marginBottom:"10px"},children:""}),r.jsx("div",{style:W.optionGroup,children:Lo.map(F=>r.jsxs("div",{style:W.optionCard,children:[r.jsxs("div",{style:W.optionRow,children:[r.jsxs("label",{style:W.optionToggle,children:[r.jsx("input",{type:"checkbox",checked:F.checked,onChange:He=>F.onChange&&F.onChange(He.target.checked)}),r.jsx("span",{children:F.checked?"":""})]}),r.jsxs("button",{type:"button",style:W.optionText,onClick:()=>Ns(F.key),children:[r.jsxs("div",{style:W.optionTitleRow,children:[r.jsx("span",{children:F.label}),r.jsx("span",{style:W.detailHint,children:ns===F.key?"":""})]}),r.jsx("div",{style:W.optionBrief,children:F.brief})]})]}),ns===F.key&&r.jsx("div",{style:W.optionDetail,children:F.detail})]},F.key))})]})]}),r.jsxs("div",{style:W.collapsibleCard,children:[r.jsxs("button",{type:"button",style:W.collapsibleHeader,onClick:()=>Rc(F=>!F),children:[r.jsxs("div",{style:W.collapsibleTitleRow,children:[r.jsx("span",{children:" "}),r.jsx("span",{style:W.collapsibleHint,children:Un?"":""})]}),r.jsx("div",{style:W.collapsibleSummary,children:Po})]}),Un&&r.jsxs("div",{style:W.collapseBody,children:[r.jsx("p",{style:W.info,children:" UI "}),r.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"10px"},children:[r.jsx("button",{onClick:b,style:{...W.saveBtn,width:"100%"},children:" "}),r.jsx("button",{onClick:E,style:{...W.btn,width:"100%",border:"1px solid #d32f2f",color:"#d32f2f"},disabled:!g,children:" "})]}),r.jsx("small",{style:W.hint,children:""})]})]}),r.jsxs("div",{style:W.collapsibleCard,children:[r.jsxs("button",{type:"button",style:W.collapsibleHeader,onClick:()=>wn(F=>!F),children:[r.jsxs("div",{style:W.collapsibleTitleRow,children:[r.jsx("span",{children:" AI "}),r.jsx("span",{style:W.collapsibleHint,children:_n?"":""})]}),r.jsx("div",{style:W.collapsibleSummary,children:Oc})]}),_n&&r.jsxs("div",{style:W.collapseBody,children:[r.jsxs("p",{style:W.info,children:[" API NPC ",r.jsx("br",{}),r.jsx("small",{style:{color:"#999"},children:" DeepSeek "})]}),r.jsxs("div",{style:W.formGroup,children:[r.jsx("label",{style:W.label,children:":"}),r.jsxs("select",{onChange:F=>{F.target.value==="deepseek"&&(V("https://api.deepseek.com/chat/completions"),he("deepseek-chat")),F.target.value=""},style:W.select,children:[r.jsx("option",{value:"",children:"..."}),r.jsx("option",{value:"deepseek",children:" DeepSeek"})]}),r.jsx("small",{style:W.hint,children:" URL  API Key"})]}),r.jsxs("div",{style:W.formGroup,children:[r.jsx("label",{style:W.label,children:"API Key:"}),r.jsx("input",{type:"password",value:ie,onChange:F=>Z(F.target.value),placeholder:"sk-xxxxxxxxxxxxxxxx",style:W.input}),r.jsxs("small",{style:W.hint,children:[" Key:",r.jsx("a",{href:"https://platform.deepseek.com/",target:"_blank",rel:"noopener",children:" DeepSeek"})]})]}),r.jsxs("div",{style:W.formGroup,children:[r.jsx("label",{style:W.label,children:"API URL:"}),r.jsx("input",{type:"text",value:ve,onChange:F=>V(F.target.value),placeholder:"https://api.deepseek.com/chat/completions",style:W.input}),r.jsx("small",{style:W.hint,children:"DeepSeek: https://api.deepseek.com/chat/completions"})]}),r.jsxs("div",{style:W.formGroup,children:[r.jsx("label",{style:W.label,children:":"}),r.jsx("input",{type:"text",value:ee,onChange:F=>he(F.target.value),placeholder:"deepseek-chat",style:W.input}),r.jsx("small",{style:W.hint,children:"DeepSeek: deepseek-chat"})]}),Me&&r.jsx("div",{style:{...W.statusBox,background:Me.success?"#e8f5e9":"#ffebee",color:Me.success?"#2e7d32":"#c62828"},children:Me.message}),r.jsxs("div",{style:W.btnGroup,children:[r.jsx("button",{onClick:zc,style:W.saveBtn,children:" "}),r.jsx("button",{onClick:Dc,style:{...W.btn,background:"#2196f3",color:"white",border:"none"},disabled:ge,children:ge?"...":" "})]})]})]}),r.jsxs("div",{style:W.collapsibleCard,children:[r.jsxs("button",{type:"button",style:W.collapsibleHeader,onClick:()=>Ic(F=>!F),children:[r.jsxs("div",{style:W.collapsibleTitleRow,children:[r.jsx("span",{children:" "}),r.jsx("span",{style:W.collapsibleHint,children:Mo?"":""})]}),r.jsx("div",{style:W.collapsibleSummary,children:ca})]}),Mo&&r.jsxs("div",{style:W.collapseBody,children:[r.jsxs("p",{style:W.info,children:["NPC",r.jsx("br",{}),r.jsx("small",{style:{color:"#999"},children:""})]}),r.jsxs("div",{style:W.formGroup,children:[r.jsxs("label",{style:W.checkboxLabel,children:[r.jsx("input",{type:"checkbox",checked:je,onChange:F=>ct(F.target.checked),style:W.checkbox}),r.jsx("span",{children:""})]}),r.jsx("small",{style:W.hint,children:""})]}),r.jsx("button",{onClick:Fo,style:W.saveBtn,children:" "})]})]}),r.jsxs("div",{style:W.collapsibleCard,children:[r.jsxs("button",{type:"button",style:W.collapsibleHeader,onClick:()=>_s(F=>!F),children:[r.jsxs("div",{style:W.collapsibleTitleRow,children:[r.jsx("span",{children:" "}),r.jsx("span",{style:W.collapsibleHint,children:oa?"":""})]}),r.jsx("div",{style:W.collapsibleSummary,children:$o})]}),oa&&r.jsxs("div",{style:W.collapseBody,children:[r.jsxs("p",{style:W.info,children:["NPC",r.jsx("br",{}),r.jsx("small",{style:{color:"#999"},children:"AI"})]}),r.jsxs("div",{style:W.formGroup,children:[r.jsxs("label",{style:W.checkboxLabel,children:[r.jsx("input",{type:"checkbox",checked:vt,onChange:F=>De(F.target.checked),style:W.checkbox}),r.jsx("span",{children:"AI"})]}),r.jsx("small",{style:W.hint,children:"API Key"})]}),r.jsx("button",{onClick:Fo,style:W.saveBtn,children:" "})]})]}),r.jsxs("div",{style:W.collapsibleCard,children:[r.jsxs("button",{type:"button",style:W.collapsibleHeader,onClick:()=>Rn(F=>!F),children:[r.jsxs("div",{style:W.collapsibleTitleRow,children:[r.jsx("span",{children:" "}),r.jsx("span",{style:W.collapsibleHint,children:Ao?"":""})]}),r.jsx("div",{style:W.collapsibleSummary,children:Bo})]}),Ao&&r.jsxs("div",{style:W.collapseBody,children:[r.jsxs("p",{style:W.info,children:[" AI ",r.jsx("br",{}),r.jsx("small",{style:{color:"#999"},children:""})]}),r.jsxs("div",{style:W.formGroup,children:[r.jsxs("label",{style:W.checkboxLabel,children:[r.jsx("input",{type:"checkbox",checked:D,onChange:F=>Se(F.target.checked),style:W.checkbox}),r.jsx("span",{children:" AI "})]}),r.jsx("small",{style:W.hint,children:" API Key"})]}),r.jsx("button",{onClick:Fo,style:W.saveBtn,children:" "})]})]}),r.jsxs("div",{style:W.collapsibleCard,children:[r.jsxs("button",{type:"button",style:W.collapsibleHeader,onClick:()=>_c(F=>!F),children:[r.jsxs("div",{style:W.collapsibleTitleRow,children:[r.jsx("span",{children:" "}),r.jsx("span",{style:W.collapsibleHint,children:qt?"":""})]}),r.jsx("div",{style:W.collapsibleSummary,children:Oo})]}),qt&&r.jsxs("div",{style:W.collapseBody,children:[r.jsxs("p",{style:W.info,children:["",L.enabled&&r.jsx("span",{style:{color:"#4caf50",fontWeight:"bold"},children:"  "})]}),r.jsxs("div",{style:{background:"linear-gradient(135deg, #667eea 0%, #764ba2 100%)",borderRadius:"8px",padding:"15px",marginBottom:"20px",color:"white"},children:[r.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"10px"},children:[r.jsx("h5",{style:{margin:0,fontSize:"16px"},children:" 3"}),R.some(F=>F.exists)&&r.jsx("button",{onClick:ha,style:{background:"rgba(255,255,255,0.2)",border:"1px solid rgba(255,255,255,0.3)",color:"white",padding:"4px 10px",borderRadius:"4px",fontSize:"11px",cursor:"pointer"},children:" "})]}),r.jsx("p",{style:{fontSize:"12px",margin:"0 0 15px 0",opacity:.9},children:" 3"}),R.length===0?r.jsx("div",{style:{background:"rgba(255,255,255,0.1)",borderRadius:"5px",padding:"15px",textAlign:"center",fontSize:"13px"},children:""}):r.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"10px"},children:[R.filter(F=>F.exists).map(F=>r.jsxs("div",{style:{background:"rgba(255,255,255,0.15)",borderRadius:"6px",padding:"12px",backdropFilter:"blur(10px)"},children:[r.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"8px"},children:[r.jsxs("div",{style:{fontSize:"13px",fontWeight:"bold"},children:["#",F.slot," - ",F.gameTime||""]}),r.jsx("div",{style:{background:"rgba(76, 175, 80, 0.8)",padding:"2px 8px",borderRadius:"10px",fontSize:"11px"},children:F.tier||""})]}),r.jsxs("div",{style:{fontSize:"11px",opacity:.9,marginBottom:"8px"},children:[r.jsxs("div",{children:[": ",F.playerName||""," | : ",F.cultivation||0," | : ",F.age||0,""]}),r.jsxs("div",{children:[": ",F.saveDate||""]})]}),r.jsx("button",{onClick:()=>Hc(F.slot),style:{background:"rgba(33, 150, 243, 0.9)",border:"none",color:"white",padding:"6px 15px",borderRadius:"4px",fontSize:"12px",cursor:"pointer",width:"100%",fontWeight:"bold"},children:" "})]},F.slot)),R.filter(F=>F.exists).length===0&&r.jsx("div",{style:{background:"rgba(255,255,255,0.1)",borderRadius:"5px",padding:"15px",textAlign:"center",fontSize:"13px"},children:""})]})]}),L.enabled&&r.jsxs("div",{style:{background:"#e8f5e9",border:"1px solid #4caf50",borderRadius:"5px",padding:"10px",marginBottom:"15px",fontSize:"12px"},children:[r.jsx("div",{style:{fontWeight:"bold",marginBottom:"5px",color:"#2e7d32"},children:" TapTap "}),r.jsxs("div",{style:{color:"#555"},children:[" ",r.jsx("br",{})," ",r.jsx("br",{})," ",r.jsx("br",{})," 1/"]}),L.syncing&&r.jsx("div",{style:{marginTop:"8px",color:"#ff9800"},children:" ..."})]}),r.jsxs("div",{style:{background:"#f5f5f5",padding:"10px",borderRadius:"5px",marginBottom:"15px",fontSize:"12px"},children:[r.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:"5px"},children:[r.jsx("span",{children:" :"}),r.jsxs("span",{children:[r.jsxs("strong",{children:[O.usedMB," MB"]})," / ~5 MB"]})]}),r.jsx("div",{style:{height:"8px",background:"#ddd",borderRadius:"4px",overflow:"hidden"},children:r.jsx("div",{style:{height:"100%",background:O.usedMB>4?"#f44336":O.usedMB>3?"#ff9800":"#4caf50",width:`${Math.min(O.usedMB/5*100,100)}%`,transition:"width 0.3s"}})}),O.usedMB>3&&r.jsx("div",{style:{color:"#f44336",marginTop:"5px",fontSize:"11px"},children:" "})]}),r.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"15px"},children:T.length===0?r.jsx("div",{style:{padding:"20px",textAlign:"center",color:"#999",background:"#f5f5f5",borderRadius:"5px"},children:"..."}):T.map(F=>r.jsxs("div",{style:W.slotCard,children:[r.jsxs("div",{style:W.slotHeader,children:[r.jsxs("span",{style:W.slotTitle,children:[" ",F.slot]}),F.exists&&r.jsx("span",{style:W.slotBadge,children:""})]}),F.exists?r.jsxs("div",{style:W.slotInfo,children:[r.jsxs("div",{style:{fontSize:"12px",color:"#666",marginBottom:"8px"},children:[r.jsxs("div",{children:[": ",F.playerName]}),F.cultivation>0&&r.jsxs("div",{children:[": ",F.cultivation," "]}),r.jsxs("div",{children:[": ",F.saveDate]})]}),r.jsxs("div",{style:{...W.btnGroup,gap:"8px",flexWrap:"wrap"},children:[r.jsx("button",{onClick:()=>fa(F.slot),style:{...W.slotBtn,background:"#4caf50",color:"white"},children:" "}),r.jsx("button",{onClick:()=>Fc(F.slot),style:{...W.slotBtn,background:"#2196f3",color:"white"},children:" "}),r.jsx("button",{onClick:()=>ma(F.slot),style:{...W.slotBtn,background:"#f44336",color:"white"},children:" "}),L.enabled&&r.jsxs(r.Fragment,{children:[r.jsx("button",{onClick:()=>$s(F.slot),style:{...W.slotBtn,background:"#ff9800",color:"white"},disabled:Y,children:" "}),r.jsx("button",{onClick:()=>ga(F.slot),style:{...W.slotBtn,background:"#9c27b0",color:"white"},disabled:Y,children:" "})]})]})]}):r.jsxs("div",{style:W.slotInfo,children:[r.jsx("div",{style:{fontSize:"13px",color:"#999",marginBottom:"10px"},children:""}),r.jsxs("div",{style:{...W.btnGroup,gap:"8px"},children:[r.jsx("button",{onClick:()=>fa(F.slot),style:{...W.slotBtn,background:"#4caf50",color:"white",flex:1},children:" "}),L.enabled&&r.jsx("button",{onClick:()=>ga(F.slot),style:{...W.slotBtn,background:"#9c27b0",color:"white",flex:1},disabled:Y,children:" "})]})]})]},F.slot))})]})]}),r.jsxs("div",{style:W.collapsibleCard,children:[r.jsxs("button",{type:"button",style:W.collapsibleHeader,onClick:()=>ia(F=>!F),children:[r.jsxs("div",{style:W.collapsibleTitleRow,children:[r.jsx("span",{children:" /"}),r.jsx("span",{style:W.collapsibleHint,children:tr?"":""})]}),r.jsx("div",{style:W.collapsibleSummary,children:""})]}),tr&&r.jsx("div",{style:W.collapseBody,children:r.jsx(Oj,{gameState:k||{player:e,children:[],fallenChildren:[],activeNpcs:[],deadNpcs:[],inventory:[],logs:[],messages:{},lastMessageCheck:{},gameStage:"MAIN",pendingSectChoices:null,testQueue:[],worldEvents:[],newsBuffer:[]},onLoadGame:n,playerName:(e==null?void 0:e.name)||""})})]}),r.jsxs("div",{style:W.collapsibleCard,children:[r.jsxs("button",{type:"button",style:W.collapsibleHeader,onClick:()=>ts(F=>!F),children:[r.jsxs("div",{style:W.collapsibleTitleRow,children:[r.jsx("span",{children:" "}),r.jsx("span",{style:W.collapsibleHint,children:aa?"":""})]}),r.jsx("div",{style:W.collapsibleSummary,children:""})]}),aa&&r.jsxs("div",{style:W.collapseBody,children:[r.jsxs("div",{style:W.formGroup,children:[r.jsx("label",{style:W.label,children:""}),r.jsx("input",{type:"text",value:rs,onChange:F=>la(F.target.value),placeholder:"",style:W.input}),r.jsx("span",{style:W.hint,children:""})]}),r.jsx("button",{onClick:Lc,style:{...W.btn,background:"#ffb74d",color:"#4e342e",border:"none",width:"100%"},children:" "}),Rs&&r.jsx("div",{style:{...W.statusBox,background:Rs.success?"#e8f5e9":"#ffebee",color:Rs.success?"#2e7d32":"#c62828",marginTop:"12px"},children:Rs.message})]})]}),r.jsxs("div",{style:W.collapsibleCard,children:[r.jsxs("button",{type:"button",style:W.collapsibleHeader,onClick:()=>Ae(F=>!F),children:[r.jsxs("div",{style:W.collapsibleTitleRow,children:[r.jsx("span",{children:" "}),r.jsx("span",{style:W.collapsibleHint,children:No?"":""})]}),r.jsx("div",{style:W.collapsibleSummary,children:Pc})]}),No&&r.jsxs("div",{style:W.collapseBody,children:[r.jsx("p",{style:W.info,children:""}),r.jsx("button",{onClick:o,style:{...W.btn,background:"#2196f3",color:"white",border:"none",width:"100%"},children:" "})]})]}),r.jsxs("div",{style:{...W.card,borderColor:"#d32f2f",background:"#ffebee"},children:[r.jsx("h4",{style:{color:"#d32f2f"},children:" "}),r.jsx("p",{style:{fontSize:"12px",color:"#666"},children:"Bug"}),r.jsx("button",{onClick:Wc,style:W.resetBtn,children:" "})]}),r.jsxs("div",{style:{textAlign:"center",marginTop:"30px",color:"#999",fontSize:"12px"},children:[r.jsx("p",{children:": v1.2.0 Alpha"}),r.jsxs("p",{children:["5MB",r.jsx("br",{}),L.enabled?" ":"  TapTap "]}),r.jsxs("p",{style:{marginTop:"8px",fontSize:"11px"},children:[" ",r.jsx("br",{}),"100"]})]})]})},W={card:{background:"white",padding:"15px",borderRadius:"8px",border:"1px solid #ddd",marginBottom:"20px"},info:{marginBottom:"15px",fontSize:"14px",color:"#555"},btnGroup:{display:"flex",gap:"10px"},btn:{flex:1,padding:"10px",cursor:"pointer",borderRadius:"5px",border:"1px solid #ccc",background:"#f5f5f5"},saveBtn:{flex:1,padding:"10px",cursor:"pointer",borderRadius:"5px",border:"none",background:"#4caf50",color:"white",fontWeight:"bold"},resetBtn:{width:"100%",padding:"10px",cursor:"pointer",borderRadius:"5px",border:"none",background:"#d32f2f",color:"white"},formGroup:{marginBottom:"15px"},label:{display:"block",marginBottom:"5px",fontSize:"13px",fontWeight:"bold",color:"#333"},checkboxLabel:{display:"flex",alignItems:"center",gap:"8px",fontSize:"14px",color:"#333",cursor:"pointer"},checkbox:{width:"18px",height:"18px",cursor:"pointer"},input:{width:"100%",padding:"10px",borderRadius:"5px",border:"1px solid #ddd",fontSize:"14px",boxSizing:"border-box"},select:{width:"100%",padding:"10px",borderRadius:"5px",border:"1px solid #ddd",fontSize:"14px",boxSizing:"border-box",cursor:"pointer",background:"white"},hint:{display:"block",marginTop:"5px",fontSize:"11px",color:"#999",lineHeight:"1.4"},statusBox:{padding:"10px",borderRadius:"5px",marginBottom:"15px",fontSize:"13px",fontWeight:"bold"},slotCard:{background:"#f9f9f9",padding:"12px",borderRadius:"6px",border:"1px solid #e0e0e0"},slotHeader:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"10px"},slotTitle:{fontSize:"14px",fontWeight:"bold",color:"#333"},slotBadge:{fontSize:"11px",padding:"3px 8px",borderRadius:"10px",background:"#4caf50",color:"white"},slotInfo:{marginTop:"8px"},slotBtn:{flex:1,padding:"8px",cursor:"pointer",borderRadius:"4px",border:"none",fontSize:"12px",fontWeight:"bold"},collapsibleCard:{background:"white",border:"1px solid #ddd",borderRadius:"10px",marginBottom:"20px",overflow:"hidden",boxShadow:"0 4px 12px rgba(0,0,0,0.04)"},collapsibleHeader:{width:"100%",background:"linear-gradient(120deg, #f5efe6, #fff)",border:"none",padding:"14px",textAlign:"left",cursor:"pointer"},collapsibleTitleRow:{display:"flex",justifyContent:"space-between",alignItems:"center",fontWeight:"bold",color:"#4e342e"},collapsibleHint:{fontSize:"12px",color:"#8d6e63"},collapsibleSummary:{marginTop:"6px",fontSize:"12px",color:"#6d4c41"},collapseBody:{padding:"14px",borderTop:"1px solid #f0e0d6",background:"#fff"},optionGroup:{display:"flex",flexDirection:"column",gap:"8px"},optionCard:{background:"rgba(249, 246, 243, 0.9)",borderRadius:"8px",border:"1px solid #efe0d4",padding:"8px"},optionRow:{display:"flex",gap:"10px",alignItems:"center"},optionToggle:{display:"flex",alignItems:"center",gap:"6px",fontSize:"12px",color:"#5d4037"},optionText:{flex:1,border:"none",background:"transparent",textAlign:"left",padding:0,cursor:"pointer",color:"#4e342e"},optionTitleRow:{display:"flex",justifyContent:"space-between",alignItems:"center",fontSize:"13px",fontWeight:600},detailHint:{fontSize:"12px",color:"#8d6e63"},optionBrief:{fontSize:"11px",color:"#6d4c41",marginTop:"2px"},optionDetail:{marginTop:"6px",padding:"8px",borderRadius:"6px",background:"#fff",border:"1px dashed #e0c5b4",fontSize:"11px",color:"#5d4037",lineHeight:1.5,whiteSpace:"pre-line"},familyActionCard:{marginTop:"12px",padding:"14px",borderRadius:"10px",border:"1px solid #e0c5b4",background:"linear-gradient(135deg, #fff7ec 0%, #fde2cf 100%)"},familyActionHeader:{display:"flex",justifyContent:"space-between",alignItems:"center",fontSize:"13px",fontWeight:600,color:"#4e342e",marginBottom:"6px"},familyActionDesc:{fontSize:"12px",color:"#6d4c41",lineHeight:1.5,margin:"8px 0 12px 0"},familyActionBtn:{width:"100%",padding:"10px",border:"none",borderRadius:"999px",cursor:"pointer",background:"linear-gradient(120deg, #ff9a62, #ff6f3c)",color:"#fff",fontWeight:"bold",fontSize:"14px",boxShadow:"0 4px 10px rgba(255, 111, 60, 0.3)"}},zj=(e,t)=>{var n;if(pm[t]){const s=pm[t];e.cultivationMethod=s;const o=((n=on[s])==null?void 0:n.name)||s;return`${e.name}  ${t}${o}`}return null},rh=(e,t)=>{const n=on[t];if(!n)return{success:!1,message:""};const s=e.cultivationMethod,o=on[s];e.cultivationMethod=t;const i=Zp(t,e.spiritRoot);return{success:!0,message:`${e.name} ${(o==null?void 0:o.name)||""}${n.name}`,compatibility:i}},sc=(e,t)=>{const n=VS(e);if(!n)return{manual:null,compatibility:null};const s=Zp(e,t);return{manual:n,compatibility:s,speedBonus:`${(s.compatibility*n.baseBuff*100).toFixed(0)}%`}},Dj=({player:e,childFeedback:t=0,onOpenInventory:n,onAllocateSkillPoint:s})=>{var A,R,$,O;const[o,i]=y.useState(!1),a=rf(e.stats.aptitude),l=kc(e,!0),d=l+t,p=bn(e.tier),f=(p==null?void 0:p.chance)??0,c=(e.breakthroughBonus||0)/100,u=Math.min(.95,f+c);e.currentExp>=e.maxExp&&!p&&console.warn(` "${e.tier}" `);const S=((e.stats.aptitude||50)/50).toFixed(2),w=((A=e.spiritRoot)==null?void 0:A.multiplier)||1,C=(($=(R=e.trait)==null?void 0:R.bonuses)==null?void 0:$.speedMultiplier)??((O=e.trait)==null?void 0:O.effect)??1,h=e.sect&&e.sect.level!=="NONE"?1.5:1,g=e.cultivationMethod&&e.spiritRoot?ef(e.cultivationMethod,e.spiritRoot):1,b=e.cultivationMethod||"basic_breath",E=e.spiritRoot?sc(b,e.spiritRoot):null,I=Jr(e||{}),v=Math.floor(e.currentExp||0),k=Math.max(1,Math.floor(e.maxExp||1)),T=Math.min(100,Math.round(v/k*100));return r.jsxs("div",{style:pe.container,children:[r.jsx("h3",{style:pe.title,children:" "}),r.jsxs("div",{style:pe.content,children:[r.jsxs("div",{style:pe.topSection,children:[r.jsx("div",{style:pe.avatarContainer,children:r.jsx(Cr,{dna:e.avatar,gender:e.gender,size:80})}),r.jsxs("div",{style:pe.basicInfo,children:[r.jsx("h2",{style:pe.playerName,children:e.name}),r.jsx("div",{style:pe.tierBadge,children:e.tier}),r.jsx("div",{style:{display:"flex",gap:"8px",alignItems:"center"},children:r.jsxs("div",{style:pe.ageText,children:[Math.floor(e.age),""]})})]})]}),r.jsxs("div",{style:pe.resourceStatsBox,children:[r.jsxs("div",{style:pe.resourceRow,children:[r.jsxs("div",{style:pe.resourceStatItem,children:[r.jsx("span",{style:pe.resourceIcon,children:""}),r.jsxs("div",{style:pe.resourceInfo,children:[r.jsx("div",{style:pe.resourceLabel,children:""}),r.jsx("div",{style:pe.resourceValue,children:e.resources.spiritStones})]})]}),r.jsxs("div",{style:pe.resourceStatItem,children:[r.jsx("span",{style:pe.resourceIcon,children:""}),r.jsxs("div",{style:pe.resourceInfo,children:[r.jsx("div",{style:pe.resourceLabel,children:""}),r.jsx("div",{style:pe.resourceValue,children:I.total})]})]})]}),r.jsxs("div",{style:pe.expSection,children:[r.jsx("div",{style:pe.expLabel,children:""}),r.jsxs("div",{style:pe.expBarWrapper,children:[r.jsx("div",{style:{...pe.expBarFill,width:`${T}%`}}),r.jsxs("div",{style:pe.expText,children:[v,"/",k]})]})]})]}),r.jsxs("div",{style:pe.mainSection,children:[r.jsxs("div",{style:pe.section,children:[r.jsx("h4",{children:" "}),r.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"10px",marginBottom:"10px"},children:[r.jsx("strong",{style:{color:a.color,fontSize:"16px"},children:e.spiritRoot.type}),r.jsx("div",{style:{display:"flex",gap:"4px"},children:e.spiritRoot.elements.map(Q=>{const L=G=>({:"#FFD700",:"#4CAF50",:"#2196F3",:"#F44336",:"#795548",:"#673AB7",:"#00BCD4",:"#009688"})[G]||"#9e9e9e";return r.jsx("span",{style:{padding:"2px 6px",borderRadius:"10px",color:"white",fontWeight:"bold",fontSize:"10px",background:L(Q)},children:Q},Q)})})]}),r.jsxs("div",{style:pe.barContainer,children:[r.jsxs("span",{children:[" (",e.stats.aptitude,")"]}),r.jsx("div",{style:pe.barBg,children:r.jsx("div",{style:{...pe.barFill,width:`${e.stats.aptitude}%`,background:a.color}})})]}),r.jsx("p",{style:{fontSize:"12px",color:"#666",marginTop:"5px"},children:e.spiritRoot.desc})]}),r.jsxs("div",{style:pe.section,children:[r.jsx("h4",{children:" "}),e.spiritRoot?E!=null&&E.manual?r.jsxs("div",{style:pe.manualCard,children:[r.jsxs("div",{style:pe.manualHeader,children:[r.jsxs("div",{style:pe.manualName,children:[E.manual.name,r.jsx("span",{style:{...pe.manualTierBadge,background:E.manual.tierColor},children:E.manual.tierName})]}),E.manual.element!=="NONE"&&r.jsx("span",{style:pe.manualElementBadge,children:E.manual.element})]}),r.jsx("p",{style:pe.manualDesc,children:E.manual.desc}),E.compatibility&&r.jsxs("div",{style:pe.manualMetaRow,children:[r.jsxs("span",{children:["",r.jsx("strong",{style:{color:E.compatibility.color},children:E.compatibility.desc})]}),r.jsxs("span",{children:["",r.jsxs("strong",{style:{color:"#64ffda"},children:["+",E.speedBonus]})]})]}),r.jsxs("div",{style:pe.manualMetaRow,children:[r.jsxs("span",{children:["",E.manual.source||""]}),r.jsxs("span",{children:["",E.manual.element==="NONE"?"":E.manual.element]})]})]}):r.jsx("div",{style:pe.manualPlaceholder,children:""}):r.jsx("div",{style:pe.manualPlaceholder,children:""})]}),r.jsxs("div",{style:pe.section,children:[r.jsx("h4",{children:" "}),r.jsxs("div",{style:pe.barContainer,children:[r.jsxs("span",{children:[" (",v,"/",k,")"]}),r.jsx("div",{style:pe.barBg,children:r.jsx("div",{style:{...pe.barFill,width:`${T}%`,background:"#4CAF50"}})})]}),e.currentExp>=e.maxExp&&r.jsx("div",{style:{marginTop:"10px",padding:"10px",background:"rgba(255,193,7,0.15)",borderRadius:"8px",border:"1px solid #FFC107"},children:p?r.jsxs(r.Fragment,{children:[r.jsxs("div",{style:{fontSize:"13px",color:"#F57C00",fontWeight:"bold",marginBottom:"4px"},children:[" : ",(u*100).toFixed(1),"%"]}),r.jsxs("div",{style:{fontSize:"11px",color:"rgba(245,124,0,0.8)"},children:[": ",(f*100).toFixed(1),"%",c>0&&` | : +${(c*100).toFixed(1)}%`]})]}):r.jsx("div",{style:{fontSize:"12px",color:"#f44336"},children:" "})}),r.jsxs("div",{style:pe.speedInfo,children:[r.jsxs("div",{style:pe.speedHeader,children:[r.jsxs("span",{style:{fontWeight:"bold",color:"#4CAF50"},children:[" : ",d,"/"]}),t>0&&r.jsxs("span",{style:{fontSize:"12px",color:"#666",marginLeft:"8px"},children:["( ",l," +  ",t,")"]})]}),r.jsxs("div",{style:pe.speedFormula,children:[r.jsx("div",{style:{fontSize:"11px",color:"#666",marginBottom:"4px"},children:": (10/)          "}),r.jsxs("div",{style:pe.speedBreakdown,children:[r.jsxs("span",{style:pe.speedItem,children:[r.jsx("span",{style:{color:"#888"},children:":"})," ",S]}),r.jsxs("span",{style:pe.speedItem,children:[r.jsx("span",{style:{color:"#888"},children:":"})," ",w]}),r.jsxs("span",{style:pe.speedItem,children:[r.jsx("span",{style:{color:"#888"},children:":"})," ",g.toFixed(2)]}),r.jsxs("span",{style:pe.speedItem,children:[r.jsx("span",{style:{color:"#888"},children:":"})," ",C]}),r.jsxs("span",{style:pe.speedItem,children:[r.jsx("span",{style:{color:"#888"},children:":"})," ",h]})]}),r.jsxs("div",{style:{fontSize:"10px",color:"#999",marginTop:"4px",fontStyle:"italic"},children:["= 10  ",S,"  ",w,"  ",g.toFixed(2),"  ",C,"  ",h," = ",l]}),t>0&&r.jsxs("div",{style:{fontSize:"11px",color:"#4CAF50",marginTop:"6px",paddingTop:"6px",borderTop:"1px dashed #ddd"},children:[" : +",t,"/"]})]})]})]}),r.jsxs("div",{style:pe.section,children:[r.jsx("h4",{children:" "}),r.jsxs("div",{style:pe.statsGrid,children:[r.jsxs("div",{style:pe.statItem,children:[r.jsx("div",{style:pe.statLabel,children:""}),r.jsx("div",{style:pe.statValue,children:e.stats.looks}),r.jsx("div",{style:pe.statBar,children:r.jsx("div",{style:{...pe.statBarFill,width:`${e.stats.looks}%`,background:"#FF6B6B"}})})]}),r.jsxs("div",{style:pe.statItem,children:[r.jsx("div",{style:pe.statLabel,children:""}),r.jsx("div",{style:pe.statValue,children:e.stats.cunning}),r.jsx("div",{style:pe.statBar,children:r.jsx("div",{style:{...pe.statBarFill,width:`${e.stats.cunning}%`,background:"#4ECDC4"}})})]}),r.jsxs("div",{style:pe.statItem,children:[r.jsx("div",{style:pe.statLabel,children:""}),r.jsx("div",{style:pe.statValue,children:e.stats.health}),r.jsx("div",{style:pe.statBar,children:r.jsx("div",{style:{...pe.statBarFill,width:`${e.stats.health}%`,background:e.stats.health<30?"#F44336":e.stats.health<60?"#FFC107":"#45B7D1"}})}),r.jsxs("div",{style:{fontSize:"10px",color:"#ccc",marginTop:"4px",opacity:.8},children:[": ",Lt(e.stats.health).toFixed(1),"/20"]})]}),r.jsxs("div",{style:pe.statItem,children:[r.jsx("div",{style:pe.statLabel,children:""}),r.jsx("div",{style:pe.statValue,children:e.stats.intelligence}),r.jsx("div",{style:pe.statBar,children:r.jsx("div",{style:{...pe.statBarFill,width:`${e.stats.intelligence}%`,background:"#96CEB4"}})})]})]}),r.jsx("div",{style:{display:"flex",justifyContent:"center",marginTop:"12px"},children:r.jsx("button",{onClick:()=>i(Q=>!Q),style:pe.detailsBtn,children:o?" ":" "})}),o&&r.jsx("div",{style:{marginTop:"15px",padding:"12px",background:"rgba(0,0,0,0.3)",borderRadius:"8px",border:"1px solid rgba(255,255,255,0.1)"},children:r.jsxs("div",{style:{fontSize:"12px",color:"#eee",lineHeight:1.8},children:[["looks","cunning","health","intelligence"].map(Q=>{const L=b2(Q),G=e.stats[Q];let ne=`${L.desc}`;if(Q==="health"){const ae=Lt(G);ne+=` (: ${ae.toFixed(1)}/20)`}return r.jsxs("div",{style:{marginBottom:"8px",padding:"8px",background:"rgba(255,255,255,0.05)",borderRadius:"6px"},children:[r.jsxs("div",{style:{fontWeight:"bold",color:"#64ffda",marginBottom:"4px"},children:[L.name," (",G,"/100)"]}),r.jsx("div",{style:{opacity:.85,fontSize:"11px"},children:ne}),L.trainable&&r.jsxs("div",{style:{opacity:.7,fontSize:"10px",marginTop:"4px",color:"#4CAF50"},children:[" ",L.howToIncrease]})]},Q)}),r.jsx("div",{style:{marginTop:"12px",paddingTop:"12px",borderTop:"1px dashed rgba(255,255,255,0.2)",opacity:.75,fontSize:"11px"},children:r.jsxs("div",{style:{marginBottom:"4px"},children:["  ",e.stats.aptitude," ",e.stats.luck," ",e.stats.lifespan]})})]})})]}),r.jsxs("div",{style:pe.section,children:[r.jsx("h4",{children:" "}),r.jsxs("div",{style:pe.resourcesGrid,children:[r.jsxs("div",{style:pe.resourceItem,children:[r.jsx("span",{children:":"})," ",r.jsx("span",{style:{fontWeight:"bold"},children:e.resources.spiritStones})]}),r.jsxs("div",{style:pe.resourceItem,children:[r.jsx("span",{children:":"}),r.jsx("span",{style:{fontWeight:"bold",color:"#FF9800"},children:e.skillPoints||0})]})]}),(e.skillPoints||0)>0&&r.jsxs("div",{style:{marginTop:"10px",padding:"10px",background:"#FFF3E0",borderRadius:"8px",border:"1px solid #FFB74D"},children:[r.jsxs("div",{style:{fontSize:"12px",color:"#E65100",marginBottom:"8px"},children:[" : ",e.skillPoints]}),r.jsxs("div",{style:{display:"flex",gap:"8px"},children:[r.jsx("button",{onClick:()=>s&&s("aptitude"),style:{...pe.allocateBtn,background:"#9C27B0"},children:"+"}),r.jsx("button",{onClick:()=>s&&s("combatPower"),style:{...pe.allocateBtn,background:"#F44336"},children:"+"}),r.jsx("button",{onClick:()=>s&&s("breakthrough"),style:{...pe.allocateBtn,background:"#FF9800"},children:"+"})]})]}),e.breakthroughBonus>0&&r.jsx("div",{style:{marginTop:"10px",padding:"8px",background:"rgba(255,152,0,0.1)",borderRadius:"8px",border:"1px solid #FF9800"},children:r.jsxs("div",{style:{fontSize:"12px",color:"#F57C00"},children:[" : +",e.breakthroughBonus,"%",e.breakthroughFailCount>0&&r.jsxs("span",{style:{marginLeft:"8px",opacity:.8},children:["(: ",e.breakthroughFailCount,")"]})]})})]}),r.jsxs("div",{style:pe.section,children:[r.jsx("h4",{children:" "}),r.jsx("button",{onClick:n,style:pe.inventoryBtn,children:""})]})]})]})]})},pe={container:{background:"linear-gradient(135deg, #667eea 0%, #764ba2 100%)",borderRadius:"16px",padding:"20px",color:"white",boxShadow:"0 8px 32px rgba(0,0,0,0.3)",marginBottom:"20px"},title:{margin:"0 0 20px 0",fontSize:"24px",textAlign:"center",textShadow:"2px 2px 4px rgba(0,0,0,0.3)"},content:{display:"flex",flexDirection:"column",gap:"16px"},topSection:{display:"flex",alignItems:"center",gap:"16px",padding:"16px",background:"rgba(255,255,255,0.1)",borderRadius:"12px",backdropFilter:"blur(10px)"},mainSection:{display:"flex",flexDirection:"column",gap:"15px"},avatarContainer:{background:"rgba(255,255,255,0.15)",borderRadius:"50%",padding:"8px",boxShadow:"0 4px 12px rgba(0,0,0,0.3)",flexShrink:0},basicInfo:{flex:1,display:"flex",flexDirection:"column",gap:"6px"},playerName:{margin:0,fontSize:"20px",fontWeight:"bold"},tierBadge:{background:"rgba(255,255,255,0.25)",padding:"4px 12px",borderRadius:"16px",fontSize:"13px",display:"inline-block",border:"1px solid rgba(255,255,255,0.3)",fontWeight:"600"},ageText:{fontSize:"14px",opacity:.9},section:{background:"rgba(255,255,255,0.1)",borderRadius:"12px",padding:"15px",backdropFilter:"blur(10px)"},barContainer:{marginBottom:"10px"},barBg:{background:"rgba(0,0,0,0.3)",borderRadius:"10px",height:"20px",marginTop:"5px",overflow:"hidden",position:"relative"},barFill:{height:"100%",borderRadius:"10px",transition:"width 0.5s ease",position:"relative",overflow:"hidden"},speedInfo:{marginTop:"10px",padding:"10px",background:"rgba(255,255,255,0.1)",borderRadius:"8px",fontSize:"12px"},speedHeader:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"8px"},statsGrid:{display:"grid",gridTemplateColumns:"1fr",gap:"12px"},statItem:{display:"grid",gridTemplateColumns:"60px 40px 1fr",gap:"8px",alignItems:"center"},statLabel:{fontSize:"14px"},statValue:{fontWeight:"bold",fontSize:"14px"},statBar:{background:"rgba(0,0,0,0.3)",borderRadius:"10px",height:"16px",overflow:"hidden"},statBarFill:{height:"100%",borderRadius:"10px",transition:"width 0.5s ease"},resourcesGrid:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"10px"},resourceItem:{display:"flex",justifyContent:"space-between",padding:"8px",background:"rgba(255,255,255,0.1)",borderRadius:"8px"},allocateBtn:{flex:1,padding:"8px 16px",border:"none",borderRadius:"8px",color:"white",fontWeight:"bold",cursor:"pointer",fontSize:"14px",transition:"transform 0.2s, box-shadow 0.2s",boxShadow:"0 2px 8px rgba(0,0,0,0.2)"},inventoryBtn:{width:"100%",padding:"10px",background:"rgba(255,255,255,0.2)",border:"1px solid rgba(255,255,255,0.3)",borderRadius:"8px",color:"white",cursor:"pointer",fontWeight:"bold",transition:"all 0.3s"},speedFormula:{fontSize:"12px"},speedBreakdown:{display:"flex",flexWrap:"wrap",gap:"8px",marginTop:"6px",marginBottom:"4px"},speedItem:{fontSize:"11px",padding:"2px 6px",backgroundColor:"rgba(255,255,255,0.1)",borderRadius:"3px",border:"1px solid rgba(255,255,255,0.2)"},detailsBtn:{padding:"8px 16px",borderRadius:"8px",border:"1px solid rgba(255,255,255,0.3)",background:"rgba(100,255,218,0.1)",color:"#64ffda",cursor:"pointer",fontSize:"13px",fontWeight:"500",transition:"all 0.3s ease",hover:{background:"rgba(100,255,218,0.2)"}},resourceStatsBox:{background:"linear-gradient(135deg, rgba(76,175,80,0.15) 0%, rgba(129,199,132,0.1) 100%)",borderRadius:"12px",padding:"15px",marginBottom:"15px",border:"1px solid rgba(255,255,255,0.2)",backdropFilter:"blur(10px)"},resourceRow:{display:"flex",gap:"15px",marginBottom:"12px"},resourceStatItem:{flex:1,display:"flex",alignItems:"center",padding:"10px",background:"rgba(255,255,255,0.1)",borderRadius:"8px"},resourceInfo:{display:"flex",flexDirection:"column",gap:"2px"},resourceLabel:{fontSize:"11px",color:"rgba(255,255,255,0.7)",fontWeight:"500"},resourceIcon:{fontSize:"24px",marginRight:"8px"},expSection:{marginTop:"8px"},expLabel:{fontSize:"12px",color:"rgba(255,255,255,0.8)",marginBottom:"6px",fontWeight:"500"},expBarWrapper:{position:"relative",height:"24px",backgroundColor:"rgba(0,0,0,0.3)",borderRadius:"12px",overflow:"hidden",border:"1px solid rgba(255,255,255,0.1)"},expBarFill:{position:"absolute",left:0,top:0,height:"100%",background:"linear-gradient(90deg, #4CAF50, #81C784)",transition:"width 0.3s ease",borderRadius:"12px"},expText:{position:"absolute",left:"50%",top:"50%",transform:"translate(-50%, -50%)",fontSize:"11px",fontWeight:"bold",color:"#fff",textShadow:"1px 1px 2px rgba(0,0,0,0.5)",zIndex:1},manualCard:{background:"rgba(255,255,255,0.08)",borderRadius:"12px",padding:"12px 14px",border:"1px solid rgba(255,255,255,0.2)",display:"flex",flexDirection:"column",gap:"8px"},manualHeader:{display:"flex",justifyContent:"space-between",alignItems:"center",gap:"16px"},manualName:{fontSize:"18px",fontWeight:"bold",display:"flex",alignItems:"center",gap:"8px"},manualTierBadge:{padding:"2px 8px",borderRadius:"999px",fontSize:"11px",color:"#fff",fontWeight:"bold"},manualElementBadge:{padding:"4px 12px",background:"rgba(255,255,255,0.2)",borderRadius:"999px",fontSize:"12px",fontWeight:"bold"},manualDesc:{fontSize:"13px",color:"rgba(255,255,255,0.85)",lineHeight:1.6},manualMetaRow:{display:"flex",justifyContent:"space-between",fontSize:"13px",color:"rgba(255,255,255,0.9)"},manualPlaceholder:{padding:"10px 14px",borderRadius:"10px",background:"rgba(0,0,0,0.2)",fontSize:"13px",color:"rgba(255,255,255,0.75)"}},Fj={common:"#9e9e9e",uncommon:"#4caf50",rare:"#2196f3",epic:"#9c27b0",legendary:"#ff9800"},Hj=e=>!e||!Array.isArray(e.usageTargets)||e.usageTargets.length===0?!0:e.usageTargets.includes(pt.NPC),Wj=({npc:e,inventory:t=[],onClose:n,onGift:s})=>{const o=t.filter(a=>["consumable","weapon","armor","accessory"].includes(a.type)&&Hj(a)),i={consumable:"",weapon:"",armor:"",accessory:""};return r.jsx("div",{style:dn.overlay,children:r.jsxs("div",{style:dn.modal,children:[r.jsxs("div",{style:dn.header,children:[r.jsxs("h3",{children:["  ",e.name," "]}),r.jsx("button",{onClick:n,style:dn.closeIcon,children:""})]}),r.jsx("p",{style:{fontSize:"12px",color:"#666",marginBottom:"10px",padding:"0 10px"},children:""}),r.jsx("div",{style:dn.itemList,children:o.length===0?r.jsx("div",{style:dn.empty,children:""}):o.map(a=>r.jsxs("div",{style:dn.itemCard,onClick:()=>s(a),children:[r.jsxs("div",{style:dn.itemHeader,children:[r.jsx("span",{style:{...dn.itemName,color:Fj[a.rarity]||"#333"},children:a.name}),r.jsx("span",{style:dn.itemType,children:i[a.type]||a.type})]}),r.jsx("div",{style:dn.itemDesc,children:a.desc}),a.stats&&r.jsxs("div",{style:dn.itemStats,children:[a.stats.atk&&r.jsxs("span",{children:["+",a.stats.atk]}),a.stats.hp&&r.jsxs("span",{children:["+",a.stats.hp]}),a.stats.def&&r.jsxs("span",{children:["+",a.stats.def]}),a.stats.mp&&r.jsxs("span",{children:["+",a.stats.mp]})]}),a.effect&&r.jsxs("div",{style:dn.itemEffect,children:[a.effect.kind==="heal"&&`${a.effect.amount}`,a.effect.kind==="exp"&&`+${a.effect.amount}`,a.effect.kind==="aptitude"&&`+${a.effect.amount}`]})]},a.instanceId))}),r.jsx("button",{onClick:n,style:dn.closeBtn,children:""})]})})},dn={overlay:{position:"fixed",top:0,left:0,right:0,bottom:0,background:"rgba(0,0,0,0.6)",display:"flex",justifyContent:"center",alignItems:"center",zIndex:200},modal:{width:"450px",maxHeight:"80vh",background:"#fff",borderRadius:"12px",padding:"20px",boxShadow:"0 8px 30px rgba(0,0,0,0.3)",display:"flex",flexDirection:"column"},header:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"15px"},closeIcon:{border:"none",background:"transparent",fontSize:"24px",cursor:"pointer",color:"#666",lineHeight:1},itemList:{flex:1,overflowY:"auto",maxHeight:"400px",marginBottom:"15px"},empty:{textAlign:"center",padding:"40px 20px",color:"#999",fontSize:"14px"},itemCard:{padding:"12px",marginBottom:"8px",background:"#fafafa",borderRadius:"8px",cursor:"pointer",border:"1px solid #eee",transition:"all 0.2s",":hover":{background:"#f5f5f5",borderColor:"#8d6e63"}},itemHeader:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"6px"},itemName:{fontWeight:"bold",fontSize:"14px"},itemType:{fontSize:"11px",padding:"2px 8px",background:"#e0e0e0",borderRadius:"10px",color:"#666"},itemDesc:{fontSize:"12px",color:"#666",marginBottom:"6px"},itemStats:{fontSize:"11px",color:"#1976d2",display:"flex",gap:"8px",flexWrap:"wrap"},itemEffect:{fontSize:"11px",color:"#388e3c",marginTop:"4px"},closeBtn:{width:"100%",padding:"10px",background:"#e0e0e0",border:"none",borderRadius:"8px",cursor:"pointer",fontSize:"14px"}},Uj=[{id:"EMOTION",label:"",desc:"",strongAgainst:["",""],weakAgainst:["",""]},{id:"PROFIT",label:"",desc:"",strongAgainst:["",""],weakAgainst:["",""]},{id:"REASON",label:"",desc:"",strongAgainst:["",""],weakAgainst:["",""]}],Gj=({npc:e,onClose:t,onNegotiate:n})=>{var s;return r.jsx("div",{style:hi.overlay,children:r.jsxs("div",{style:hi.modal,children:[r.jsx("h3",{children:" "}),r.jsxs("p",{style:{color:"#555",fontSize:"14px"},children:[" ",r.jsx("strong",{style:{color:"#d81b60"},children:(s=e.personality)==null?void 0:s.label}),"  ",e.name,"",r.jsx("br",{}),""]}),r.jsx("div",{style:hi.list,children:Uj.map(o=>r.jsxs("button",{onClick:()=>n(o),style:hi.btn,children:[r.jsx("div",{style:{fontWeight:"bold"},children:o.label}),r.jsx("small",{style:{color:"#666"},children:o.desc})]},o.id))}),r.jsx("button",{onClick:t,style:hi.cancel,children:""})]})})},hi={overlay:{position:"fixed",top:0,left:0,right:0,bottom:0,background:"rgba(0,0,0,0.7)",display:"flex",justifyContent:"center",alignItems:"center",zIndex:200},modal:{width:"300px",background:"#fff8e1",borderRadius:"12px",padding:"20px",border:"2px solid #8d6e63"},list:{display:"flex",flexDirection:"column",gap:"10px",margin:"20px 0"},btn:{padding:"15px",background:"#fff",border:"1px solid #d7ccc8",borderRadius:"8px",cursor:"pointer",textAlign:"left",":hover":{background:"#efebe9"}},cancel:{width:"100%",padding:"10px",background:"transparent",border:"none",color:"#888",cursor:"pointer"}},Vj=({items:e,playerSpiritStones:t,onPurchase:n,onClose:s})=>{const[o,i]=y.useState({}),[a,l]=y.useState(null),d=(f,c)=>{const u=f.price*c;if(t<u){l(` ${f.name} x${c}  ${u} `),setTimeout(()=>l(null),2e3);return}n(f,c,u),l(` ${f.name} x${c}`),setTimeout(()=>l(null),2e3)},p={common:"#9e9e9e",uncommon:"#4caf50",rare:"#2196f3",epic:"#9c27b0",legendary:"#ff9800"};return r.jsx("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0,0,0,0.5)",display:"flex",justifyContent:"center",alignItems:"center",zIndex:1e3},children:r.jsxs("div",{style:{backgroundColor:"#fff",padding:"25px",borderRadius:"16px",maxWidth:"600px",maxHeight:"80vh",width:"90%",boxShadow:"0 8px 30px rgba(0,0,0,0.3)",border:"2px solid #8d6e63",display:"flex",flexDirection:"column"},children:[r.jsx("h2",{style:{marginTop:0,color:"#5d4037",textAlign:"center",marginBottom:"10px"},children:" "}),r.jsx("p",{style:{color:"#666",textAlign:"center",fontSize:"13px",marginBottom:"15px"},children:""}),r.jsx("div",{style:{flex:1,overflowY:"auto",marginBottom:"15px"},children:e.length===0?r.jsx("div",{style:{textAlign:"center",padding:"40px",color:"#999"},children:""}):r.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"10px"},children:e.map(f=>{const c=o[f.instanceId]||1,u=f.price*c,x=t>=u;return r.jsxs("div",{style:{padding:"12px",border:`2px solid ${p[f.rarity]||"#ddd"}`,borderRadius:"10px",backgroundColor:x?"#fafafa":"#f5f5f5",opacity:x?1:.6,transition:"all 0.2s"},children:[r.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"6px"},children:[r.jsx("span",{style:{fontSize:"15px",fontWeight:"bold",color:p[f.rarity]},children:f.name}),r.jsxs("span",{style:{fontSize:"14px",color:"#f57c00",fontWeight:"bold"},children:[" ",f.price," "]})]}),r.jsx("div",{style:{fontSize:"12px",color:"#666",marginBottom:"8px"},children:f.desc}),f.stats&&r.jsxs("div",{style:{fontSize:"11px",color:"#1976d2",display:"flex",gap:"8px",flexWrap:"wrap",marginBottom:"8px"},children:[f.stats.atk&&r.jsxs("span",{children:["+",f.stats.atk]}),f.stats.hp&&r.jsxs("span",{children:["+",f.stats.hp]}),f.stats.def&&r.jsxs("span",{children:["+",f.stats.def]}),f.stats.mp&&r.jsxs("span",{children:["+",f.stats.mp]})]}),f.effect&&r.jsxs("div",{style:{fontSize:"11px",color:"#388e3c",marginBottom:"8px"},children:[f.effect.kind==="heal"&&`${f.effect.amount}`,f.effect.kind==="exp"&&`+${f.effect.amount}`,f.effect.kind==="aptitude"&&`+${f.effect.amount}`]}),r.jsxs("div",{style:{display:"flex",gap:"8px",alignItems:"center",marginBottom:"8px"},children:[r.jsxs("div",{style:{display:"flex",alignItems:"center",gap:6},children:[r.jsx("label",{style:{fontSize:12,color:"#555"},children:""}),r.jsx("input",{type:"number",min:1,value:c,onChange:S=>{const w=Math.max(1,parseInt(S.target.value||"1",10));i(C=>({...C,[f.instanceId]:w}))},style:{width:60,padding:6,borderRadius:6,border:"1px solid #ddd"}})]}),r.jsx("div",{style:{flex:1}})]}),r.jsxs("button",{onClick:()=>d(f,c),disabled:!x,style:{width:"100%",padding:"8px",border:"none",borderRadius:"6px",backgroundColor:x?"#8d6e63":"#ccc",color:"white",cursor:x?"pointer":"not-allowed",fontSize:"13px",fontWeight:"bold"},children:[" x",c,"  ",u,""]})]},f.instanceId)})})}),a&&r.jsx("div",{style:{marginTop:8,textAlign:"center",color:"#2e7d32",fontWeight:"bold"},children:a}),r.jsxs("div",{style:{marginTop:"10px",padding:"10px",backgroundColor:"#fff3e0",borderRadius:"8px",fontSize:"12px",color:"#666",textAlign:"center"},children:[" "," ",r.jsx("span",{style:{fontWeight:"bold",color:"#f57c00"},children:t})," ",""]}),r.jsx("button",{onClick:s,style:{marginTop:"15px",padding:"10px",border:"1px solid #ccc",borderRadius:"8px",backgroundColor:"white",cursor:"pointer",fontSize:"14px"},children:""})]})})},Yj=({result:e,onClose:t})=>{if(y.useEffect(()=>{if(e&&e.autoClose!==!1){const s=setTimeout(t,3e3);return()=>clearTimeout(s)}},[t,e]),!e)return null;const n=()=>{e.autoClose!==!1&&t()};return r.jsx("div",{style:Mr.overlay,onClick:n,children:r.jsxs("div",{style:Mr.card,onClick:s=>s.stopPropagation(),children:[r.jsx("div",{style:Mr.icon,children:e.success?"":""}),r.jsx("h3",{style:{margin:"10px 0"},children:e.title}),r.jsx("div",{style:Mr.scrollText,children:e.msg}),e.changes&&r.jsx("div",{style:Mr.changes,children:Object.entries(e.changes).map(([s,o])=>r.jsxs("span",{style:Mr.badge,children:[s,": ",o>0?"+":"",o]},s))}),e.autoClose===!1?r.jsx("button",{onClick:t,style:Mr.confirmBtn,children:""}):r.jsx("div",{style:Mr.tip,children:"[  ]"})]})})},Mr={overlay:{position:"fixed",top:0,left:0,right:0,bottom:0,background:"rgba(0,0,0,0.5)",display:"flex",justifyContent:"center",alignItems:"center",zIndex:2200,animation:"fadeIn 0.2s",backdropFilter:"blur(2px)"},card:{width:"85%",maxWidth:"500px",background:"#f5f0e8",padding:"25px",borderRadius:"16px",textAlign:"center",boxShadow:"0 8px 30px rgba(0,0,0,0.2)",animation:"fadeIn 0.3s ease-out",maxHeight:"80vh",display:"flex",flexDirection:"column",border:"2px solid #d7ccc8"},scrollText:{maxHeight:"250px",overflowY:"auto",lineHeight:"1.8",color:"#5d4037",textAlign:"left",background:"#faf8f5",padding:"20px",borderRadius:"12px",margin:"15px 0",border:"1px solid #e0e0e0",boxShadow:"0 2px 8px rgba(0,0,0,0.05)",fontFamily:"Microsoft YaHei, SimSun, serif"},confirmBtn:{marginTop:"20px",padding:"12px 25px",background:"linear-gradient(135deg, #8d6e63 0%, #6d4c41 100%)",color:"white",border:"none",borderRadius:"25px",cursor:"pointer",fontSize:"15px",transition:"all 0.3s ease",boxShadow:"0 2px 8px rgba(0,0,0,0.15)",":hover":{background:"linear-gradient(135deg, #6d4c41 0%, #5d4037 100%)",transform:"translateY(-2px)",boxShadow:"0 4px 12px rgba(0,0,0,0.2)"}},icon:{fontSize:"48px",marginBottom:"15px"},changes:{marginTop:"20px",display:"flex",gap:"8px",justifyContent:"center",flexWrap:"wrap"},badge:{background:"linear-gradient(135deg, #f1f8e9 0%, #e8f5e8 100%)",color:"#5d4037",padding:"4px 12px",borderRadius:"15px",fontSize:"13px",border:"1px solid #d7ccc8",boxShadow:"0 2px 4px rgba(0,0,0,0.05)"},tip:{marginTop:"15px",fontSize:"12px",color:"#8d6e63",fontStyle:"italic"}},qj=({message:e,onConfirm:t,onCancel:n})=>r.jsx("div",{style:ls.overlay,onClick:n,children:r.jsxs("div",{style:ls.card,onClick:s=>s.stopPropagation(),children:[r.jsx("div",{style:ls.icon,children:""}),r.jsx("h3",{style:{margin:"10px 0"},children:""}),r.jsx("div",{style:ls.message,children:e}),r.jsxs("div",{style:ls.buttons,children:[r.jsx("button",{onClick:n,style:ls.cancelBtn,children:""}),r.jsx("button",{onClick:t,style:ls.confirmBtn,children:""})]})]})}),ls={overlay:{position:"fixed",top:0,left:0,right:0,bottom:0,background:"rgba(0, 0, 0, 0.5)",display:"flex",justifyContent:"center",alignItems:"center",zIndex:2200,animation:"fadeIn 0.2s",backdropFilter:"blur(2px)"},card:{width:"85%",maxWidth:"400px",background:"linear-gradient(135deg, #F4EEE6 0%, #EFE6D8 100%)",borderRadius:"12px",padding:"30px",textAlign:"center",boxShadow:"0 20px 60px rgba(0, 0, 0, 0.3)",border:"2px solid #D4AF37"},icon:{fontSize:"48px",marginBottom:"10px"},message:{margin:"20px 0",lineHeight:"1.6",whiteSpace:"pre-wrap"},buttons:{display:"flex",gap:"15px",justifyContent:"center",marginTop:"20px"},cancelBtn:{padding:"10px 20px",background:"#666",color:"white",border:"none",borderRadius:"8px",cursor:"pointer",fontSize:"16px"},confirmBtn:{padding:"10px 20px",background:"#4CAF50",color:"white",border:"none",borderRadius:"8px",cursor:"pointer",fontSize:"16px"}},Kj=({event:e,npc:t,onClose:n,onOptionSelect:s})=>{const o=l=>{try{s((t==null?void 0:t.id)||null,l)}catch(d){console.error("EventModal option select error",d)}},i=(e==null?void 0:e.title)||(t?`${t.name} - `:""),a=(e==null?void 0:e.text)||(e==null?void 0:e.desc)||(e==null?void 0:e.description)||"";return r.jsx("div",{style:mr.overlay,children:r.jsxs("div",{style:mr.modalWrapper,children:[r.jsx("button",{onClick:n,style:mr.closeBtn,"aria-label":"",children:""}),r.jsxs("div",{style:mr.modal,children:[r.jsx("h2",{style:mr.title,children:i}),r.jsxs("div",{style:mr.content,children:[r.jsx("p",{style:mr.eventText,children:a}),r.jsx("div",{style:mr.options,children:((e==null?void 0:e.options)||[]).map((l,d)=>r.jsx("button",{style:mr.optionBtn,onClick:()=>o(l),children:l.label},d))})]})]})]})})},mr={overlay:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0, 0, 0, 0.5)",display:"flex",justifyContent:"center",alignItems:"center",zIndex:1e3,backdropFilter:"blur(2px)"},modalWrapper:{position:"relative",width:"min(600px, calc(100vw - 32px))"},modal:{width:"90%",maxWidth:"600px",backgroundColor:"#f5f0e8",borderRadius:"16px",padding:"25px",position:"relative",boxShadow:"0 8px 30px rgba(0, 0, 0, 0.2)",border:"2px solid #d7ccc8",animation:"fadeIn 0.3s ease-out"},closeBtn:{position:"absolute",top:"-18px",left:"-18px",border:"none",background:"#fff",fontSize:"22px",cursor:"pointer",color:"#8d6e63",width:"42px",height:"42px",borderRadius:"50%",display:"flex",alignItems:"center",justifyContent:"center",boxShadow:"0 10px 24px rgba(0,0,0,0.2)"},title:{fontSize:"20px",marginBottom:"25px",color:"#5d4037",textAlign:"center",fontWeight:"bold",paddingBottom:"15px",borderBottom:"2px solid #d7ccc8",fontFamily:"Microsoft YaHei, SimSun, serif"},content:{maxHeight:"70vh",overflowY:"auto",paddingRight:"10px"},eventText:{fontSize:"16px",lineHeight:"1.8",marginBottom:"35px",color:"#5d4037",padding:"20px",background:"#faf8f5",borderRadius:"12px",border:"1px solid #e0e0e0",boxShadow:"0 2px 8px rgba(0, 0, 0, 0.05)",fontFamily:"Microsoft YaHei, SimSun, serif"},options:{display:"flex",flexDirection:"column",gap:"12px"},optionBtn:{padding:"18px",border:"2px solid #d7ccc8",borderRadius:"12px",background:"linear-gradient(135deg, #ffffff 0%, #f5f0e8 100%)",cursor:"pointer",textAlign:"left",transition:"all 0.3s ease",fontSize:"15px",color:"#5d4037",boxShadow:"0 2px 8px rgba(0, 0, 0, 0.05)",":hover":{background:"linear-gradient(135deg, #f5f0e8 0%, #e8e0d8 100%)",transform:"translateY(-2px)",boxShadow:"0 4px 12px rgba(0, 0, 0, 0.1)",borderColor:"#bcaaa4"},":active":{transform:"translateY(0)",boxShadow:"0 2px 6px rgba(0, 0, 0, 0.05)"}}},sh=e=>Math.max(0,Math.min(100,Number(e)||0)),Qj=({event:e,player:t,onClose:n,onOptionSelect:s})=>{const[o,i]=y.useState(null),a=d=>{i(d),setTimeout(()=>{s(d),n()},300)},l=()=>e.participants.map((d,p)=>{var S,w;const f=((S=d.relationship)==null?void 0:S.jealousy)||0,c=((w=d.relationship)==null?void 0:w.affection)||0,u=sh(c),x=sh(f);return r.jsxs("div",{style:Ge.npcCard,children:[r.jsxs("div",{style:Ge.npcHeader,children:[r.jsx("span",{style:Ge.npcName,children:d.name}),r.jsx("span",{style:Ge.npcRealm,children:d.tierTitle||""})]}),r.jsxs("div",{style:Ge.npcStats,children:[r.jsxs("div",{style:Ge.statBar,children:[r.jsx("span",{style:Ge.statLabel,children:""}),r.jsx("div",{style:Ge.barContainer,children:r.jsx("div",{style:{...Ge.barFill,width:`${u}%`,background:"#ff6b9d"}})}),r.jsx("span",{style:Ge.statValue,children:u})]}),r.jsxs("div",{style:Ge.statBar,children:[r.jsx("span",{style:Ge.statLabel,children:""}),r.jsx("div",{style:Ge.barContainer,children:r.jsx("div",{style:{...Ge.barFill,width:`${x}%`,background:x>=80?"#d32f2f":x>=60?"#f44336":"#ff9800"}})}),r.jsx("span",{style:Ge.statValue,children:x})]})]})]},d.id)});return r.jsx("div",{style:Ge.overlay,children:r.jsxs("div",{style:Ge.modalWrapper,children:[r.jsx("button",{onClick:n,style:Ge.closeBtn,"aria-label":"",children:""}),r.jsxs("div",{style:Ge.modal,children:[r.jsxs("h2",{style:Ge.title,children:[r.jsx("span",{style:Ge.titleIcon,children:""}),"",r.jsx("span",{style:Ge.titleIcon,children:""})]}),r.jsxs("div",{style:Ge.content,children:[r.jsx("div",{style:Ge.sceneDescription,children:r.jsx("p",{style:Ge.mainText,children:e.description})}),r.jsxs("div",{style:Ge.participants,children:[r.jsx("h3",{style:Ge.sectionTitle,children:""}),r.jsx("div",{style:Ge.npcList,children:l()})]}),e.dialogues&&e.dialogues.length>0&&r.jsx("div",{style:Ge.dialogues,children:e.dialogues.map((d,p)=>r.jsxs("div",{style:Ge.dialogueItem,children:[r.jsxs("span",{style:Ge.dialogueSpeaker,children:[d.speaker,""]}),r.jsxs("span",{style:Ge.dialogueText,children:['"',d.text,'"']})]},p))}),r.jsx("div",{style:Ge.options,children:e.options.map((d,p)=>r.jsxs("button",{style:{...Ge.optionBtn,...o===d?Ge.optionBtnSelected:{}},onClick:()=>a(d),children:[r.jsx("div",{style:Ge.optionLabel,children:d.label}),d.hint&&r.jsx("div",{style:Ge.optionHint,children:d.hint})]},p))})]})]})]})})},Ge={overlay:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0, 0, 0, 0.7)",display:"flex",justifyContent:"center",alignItems:"center",zIndex:1100,backdropFilter:"blur(3px)",animation:"fadeIn 0.3s ease-out"},modalWrapper:{position:"relative",width:"min(700px, calc(100vw - 32px))"},modal:{width:"90%",maxWidth:"700px",maxHeight:"90vh",backgroundColor:"#fff5f5",borderRadius:"20px",padding:"30px",position:"relative",boxShadow:"0 10px 40px rgba(211, 47, 47, 0.3)",border:"3px solid #ffcdd2",overflowY:"auto",animation:"slideIn 0.4s ease-out"},closeBtn:{position:"absolute",top:"-20px",left:"-20px",border:"none",background:"#fff5f5",fontSize:"26px",cursor:"pointer",color:"#d32f2f",width:"48px",height:"48px",borderRadius:"50%",display:"flex",alignItems:"center",justifyContent:"center",boxShadow:"0 12px 30px rgba(211,47,47,0.25)"},title:{fontSize:"28px",marginBottom:"25px",color:"#d32f2f",textAlign:"center",fontWeight:"bold",paddingBottom:"15px",borderBottom:"3px solid #ffcdd2",fontFamily:"Microsoft YaHei, serif",textShadow:"2px 2px 4px rgba(211, 47, 47, 0.2)",display:"flex",alignItems:"center",justifyContent:"center",gap:"15px"},titleIcon:{fontSize:"24px",animation:"pulse 2s infinite"},content:{maxHeight:"calc(90vh - 120px)",overflowY:"auto",paddingRight:"10px"},sceneDescription:{marginBottom:"25px",padding:"20px",background:"linear-gradient(135deg, #fff 0%, #ffebee 100%)",borderRadius:"15px",border:"2px solid #ffcdd2",boxShadow:"0 4px 12px rgba(211, 47, 47, 0.1)"},mainText:{fontSize:"17px",lineHeight:"1.9",color:"#5d4037",margin:0,fontFamily:"Microsoft YaHei, serif",textAlign:"justify"},participants:{marginBottom:"25px"},sectionTitle:{fontSize:"18px",color:"#d32f2f",marginBottom:"15px",fontWeight:"bold",paddingLeft:"10px",borderLeft:"4px solid #d32f2f"},npcList:{display:"flex",flexDirection:"column",gap:"12px"},npcCard:{padding:"15px",background:"#fff",borderRadius:"12px",border:"2px solid #ffcdd2",boxShadow:"0 2px 8px rgba(211, 47, 47, 0.1)"},npcHeader:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"10px"},npcName:{fontSize:"16px",fontWeight:"bold",color:"#d32f2f"},npcRealm:{fontSize:"13px",color:"#666",background:"#f5f5f5",padding:"4px 10px",borderRadius:"8px"},npcStats:{display:"flex",flexDirection:"column",gap:"8px"},statBar:{display:"flex",alignItems:"center",gap:"10px"},statLabel:{fontSize:"13px",color:"#666",minWidth:"40px"},barContainer:{flex:1,height:"8px",background:"#e0e0e0",borderRadius:"4px",overflow:"hidden"},barFill:{height:"100%",transition:"width 0.5s ease"},statValue:{fontSize:"13px",color:"#666",minWidth:"30px",textAlign:"right"},dialogues:{marginBottom:"25px",padding:"20px",background:"#fafafa",borderRadius:"12px",border:"1px solid #e0e0e0"},dialogueItem:{marginBottom:"12px",fontSize:"15px",lineHeight:"1.8",color:"#5d4037"},dialogueSpeaker:{fontWeight:"bold",color:"#d32f2f"},dialogueText:{color:"#5d4037",fontStyle:"italic"},options:{display:"flex",flexDirection:"column",gap:"12px",marginTop:"20px"},optionBtn:{padding:"18px 20px",border:"2px solid #ffcdd2",borderRadius:"12px",background:"linear-gradient(135deg, #ffffff 0%, #fff5f5 100%)",cursor:"pointer",textAlign:"left",transition:"all 0.3s ease",fontSize:"15px",color:"#5d4037",boxShadow:"0 2px 8px rgba(211, 47, 47, 0.1)"},optionBtnSelected:{background:"linear-gradient(135deg, #ffebee 0%, #ffcdd2 100%)",borderColor:"#d32f2f",transform:"translateY(-2px)",boxShadow:"0 4px 12px rgba(211, 47, 47, 0.2)"},optionLabel:{fontSize:"15px",fontWeight:"bold",marginBottom:"5px"},optionHint:{fontSize:"13px",color:"#999",marginTop:"5px"}},Jj=(e="")=>{switch(e){case"":return"#c62828";case"":return"#ef6c00";case"":return"#fb8c00";case"":return"#fdd835";default:return"#8d6e63"}},Xj=({event:e,onClose:t})=>{if(!e)return null;const{alerts:n=[],summary:s,actionLabel:o,timestamp:i={},targetName:a}=e,l=`${i.year||"???"}${i.month||"??"}  ${o||""}`;return r.jsx("div",{style:Wt.overlay,children:r.jsxs("div",{style:Wt.modal,children:[r.jsx("button",{type:"button","aria-label":"",onClick:t,style:Wt.closeBtn,children:""}),r.jsx("h2",{style:Wt.title,children:" "}),r.jsx("p",{style:Wt.subtitle,children:l}),r.jsx("div",{style:Wt.summaryBox,children:r.jsx("p",{style:Wt.summaryText,children:s})}),r.jsx("div",{style:Wt.alertList,children:n.map(d=>r.jsxs("div",{style:Wt.alertCard,children:[r.jsxs("div",{style:Wt.alertHeader,children:[r.jsxs("div",{style:Wt.alertNameRow,children:[r.jsx("span",{style:Wt.alertName,children:d.witnessName}),r.jsx("span",{style:{...Wt.levelBadge,backgroundColor:Jj(d.level)},children:d.level})]}),r.jsxs("span",{style:Wt.targetTip,children:["",d.targetName||a]})]}),r.jsxs("div",{style:Wt.alertMeta,children:["",o]}),r.jsxs("div",{style:Wt.alertMeta,children:["+",d.increase,"  ",d.newJealousy]})]},`${d.witnessName}-${d.targetName}-${d.newJealousy}`))}),r.jsx("button",{type:"button",onClick:t,style:Wt.primaryBtn,children:""})]})})},Wt={overlay:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0,0,0,0.65)",display:"flex",justifyContent:"center",alignItems:"center",zIndex:2300,padding:"16px"},modal:{width:"min(640px, 100%)",background:"#fffdf7",borderRadius:"18px",padding:"28px 26px 32px",position:"relative",boxShadow:"0 18px 40px rgba(93,64,55,0.3)",border:"2px solid #ffe0b2",maxHeight:"92vh",overflowY:"auto"},closeBtn:{position:"absolute",top:"14px",right:"14px",border:"none",background:"transparent",fontSize:"26px",cursor:"pointer",color:"#8d6e63"},title:{margin:0,fontSize:"26px",color:"#c62828",textAlign:"center"},subtitle:{textAlign:"center",margin:"6px 0 18px",color:"#795548",fontSize:"14px"},summaryBox:{background:"#fff8e1",borderRadius:"12px",border:"1px solid #ffe0b2",padding:"16px",marginBottom:"18px"},summaryText:{margin:0,fontSize:"15px",lineHeight:1.7,color:"#5d4037",whiteSpace:"pre-line"},alertList:{display:"flex",flexDirection:"column",gap:"12px",marginBottom:"24px"},alertCard:{border:"1px solid #ffe0b2",borderRadius:"12px",padding:"14px 16px",background:"#fff"},alertHeader:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"8px"},alertNameRow:{display:"flex",alignItems:"center",gap:"8px"},alertName:{fontWeight:"bold",fontSize:"16px",color:"#5d4037"},levelBadge:{padding:"2px 10px",borderRadius:"999px",color:"#fff",fontSize:"12px"},targetTip:{fontSize:"13px",color:"#8d6e63"},alertMeta:{fontSize:"14px",color:"#6d4c41"},primaryBtn:{width:"100%",padding:"12px",borderRadius:"10px",border:"none",background:"linear-gradient(120deg, #ffb300, #ff7043)",color:"#fff",fontSize:"16px",fontWeight:"bold",cursor:"pointer"}},Zj=["","","","","",""],oh={COMMON:"",UNCOMMON:"",RARE:"",EPIC:"",LEGENDARY:"",MYTHIC:"",UNIQUE:"",SPECIAL:""},e5=e=>{var n;if(!e)return"";const t=e.toString().trim().toUpperCase();return(n=K[t])!=null&&n.label?K[t].label:oh[t]?oh[t]:/^[A-Z]+$/.test(t)?"":e},ih=(e=[])=>{const t={};return e.forEach(n=>{n!=null&&n.id&&(t[n.id]=[{bidder:"",amount:Math.max(1,n.basePrice||0),time:Date.now()}])}),t},t5=({auction:e,playerResources:t,onClose:n,onBuy:s,onShowPlot:o})=>{if(!e)return null;const i=y.useMemo(()=>e.items||[],[e]),a=()=>typeof window>"u"?!1:window.innerWidth<=768,[l,d]=y.useState(a),[p,f]=y.useState(()=>ih(i)),[c,u]=y.useState(null),[x,S]=y.useState(i[0]||null),[w,C]=y.useState({}),[h,g]=y.useState(null),[b,E]=y.useState({}),I=y.useRef(p),v=(V,ee)=>l?ee:V;y.useEffect(()=>{I.current=p},[p]),y.useEffect(()=>{if(typeof window>"u")return;const V=()=>d(a());return window.addEventListener("resize",V),()=>window.removeEventListener("resize",V)},[]),y.useEffect(()=>{const V=ih(i);f(V),I.current=V,u(null),S(i[0]||null),C({}),g(null),E({})},[i]);const k=V=>{V&&g({...V,id:Date.now()})},T=V=>I.current[V]||[],A=V=>{const ee=T(V);return ee.length===0?0:ee[ee.length-1].amount},R=V=>{const ee=T(V);return ee.length===0?null:ee[ee.length-1].bidder},$=(V,ee,he)=>{f(ge=>{const me=ge[V]?[...ge[V]]:[];me.push({bidder:ee,amount:he,time:Date.now()});const Me={...ge,[V]:me};return I.current=Me,Me})},O=(V,ee)=>{f(he=>{const ge=[...he[V]||[]];for(let Me=ge.length-1;Me>=0;Me-=1)if(ge[Me].bidder===""&&(!ee||ge[Me].amount===ee)){ge.splice(Me,1);break}const me={...he,[V]:ge};return I.current=me,me})},Q=V=>Math.max(1,Math.floor(((V==null?void 0:V.basePrice)||0)*.05)),L=V=>Math.max(1,Math.floor((V==null?void 0:V.basePrice)||0))*2,G=(V,ee)=>{E(he=>({...he,[V]:{enabled:!1,ceiling:"",...he[V]||{},...ee}}))},ne=V=>{const ee=b[V.id];if(!(ee!=null&&ee.enabled))return;const he=Number(ee.ceiling)||0,ge=A(V.id);if(R(V.id)===""||he<=0||ge>=he)return;const Me=Math.min(he,ge+Q(V));if(((t==null?void 0:t.spiritStones)||0)<Me){k({type:"error",title:"",message:`${V.name} `}),G(V.id,{enabled:!1});return}$(V.id,"",Me)},ae=V=>{for(let ee=0;ee<2;ee+=1)Zj.forEach(he=>{if(Math.random()<.35){const ge=A(V.id),me=(V==null?void 0:V.basePrice)||0,Me=Math.max(1,Math.floor(me*(.02+Math.random()*.12))||1),$e=L(V),je=Math.min(ge+Me,$e);je>ge&&($(V.id,he,je),ne(V))}})},Y=(V,ee,he)=>{he!=null&&he.success?(C(ge=>({...ge,[V.id]:{status:"won",price:ee,bidder:""}})),G(V.id,{enabled:!1}),k({type:"success",title:he.title||"",message:he.message||`${V.name} `})):(O(V.id,ee),k({type:"error",title:(he==null?void 0:he.title)||"",message:(he==null?void 0:he.message)||""}))},q=V=>{if(!V||w[V.id])return;const ee=A(V.id);try{const he=s(V,ee);he&&typeof he.then=="function"?he.then(ge=>Y(V,ee,ge)).catch(()=>{Y(V,ee,{success:!1,title:"",message:""})}):Y(V,ee,he)}catch{Y(V,ee,{success:!1,title:"",message:""})}},ie=(V,ee,he)=>{if(!V||w[V.id]){k({type:"error",title:"",message:""});return}const ge=A(V.id)+Q(V),me=Math.max(Number(ee)||0,ge);if(((t==null?void 0:t.spiritStones)||0)<me){k({type:"error",title:"",message:""});return}$(V.id,"",me),he(""),ae(V),setTimeout(()=>{R(V.id)===""&&q(V)},60)},Z=V=>{u(V)},ve=()=>g(null);return r.jsxs("div",{style:{...Pe.overlay,alignItems:l?"flex-start":"center",padding:l?"12px":"20px"},children:[r.jsx("div",{style:{...Pe.modalWrapper,width:l?"100%":Pe.modalWrapper.width,maxHeight:l?"none":Pe.modalWrapper.maxHeight},children:r.jsxs("div",{style:{...Pe.modalShell,borderRadius:l?16:Pe.modalShell.borderRadius,padding:l?"18px":Pe.modalShell.padding,maxHeight:l?"none":Pe.modalShell.maxHeight},children:[r.jsxs("header",{style:{...Pe.header,paddingTop:l?"40px":"30px"},children:[r.jsx("button",{onClick:n,style:{...Pe.closeBtn,fontSize:v("14px","12px"),padding:v("6px 16px","4px 12px"),position:"absolute",top:l?"12px":"16px",left:l?"12px":"16px"},"aria-label":"",children:""}),r.jsxs("div",{style:{flex:1},children:[r.jsx("h2",{style:{...Pe.title,fontSize:v("24px","18px")},children:e.title}),r.jsx("p",{style:{...Pe.message,fontSize:v("14px","12px")},children:e.message})]}),r.jsx("div",{style:Pe.headerActions,children:r.jsxs("div",{style:{...Pe.resourceChip,fontSize:v("14px","12px"),padding:v("6px 14px","4px 10px")},children:["  ",(t==null?void 0:t.spiritStones)||0]})})]}),r.jsx("div",{style:{...Pe.body,flexDirection:"column",gap:"16px"},children:c?r.jsxs("div",{style:{...Pe.plotCard,padding:v("20px","16px")},children:[r.jsx("h3",{style:{...Pe.plotTitle,fontSize:v("18px","16px")},children:c.name}),r.jsx("div",{style:{...Pe.plotContent,fontSize:v("14px","13px")},children:o(c)}),r.jsx("button",{style:{...Pe.backBtn,fontSize:v("13px","12px"),padding:v("10px","8px")},onClick:()=>u(null),children:""})]}):r.jsx("section",{style:{...Pe.catalogPanel,gridTemplateColumns:l?"1fr":Pe.catalogPanel.gridTemplateColumns,maxHeight:l?"none":Pe.catalogPanel.maxHeight,paddingRight:l?0:Pe.catalogPanel.paddingRight,gap:v(Pe.catalogPanel.gap,"12px")},children:i.map(V=>r.jsx(n5,{item:V,bids:T(V.id),currentHighest:A(V.id),highestBidder:R(V.id),onPlayerBid:ie,onShowPlot:()=>Z(V),sold:w[V.id],autoBidConfig:b[V.id],onAutoBidConfigChange:G,isMobile:l},V.id))})})]})}),h&&r.jsx("div",{style:Pe.feedbackOverlay,children:r.jsxs("div",{style:{...Pe.feedbackCard,borderColor:h.type==="success"?"#66bb6a":"#ef5350"},children:[r.jsx("h3",{style:{marginTop:0,color:h.type==="success"?"#1b5e20":"#b71c1c"},children:h.title}),r.jsx("p",{style:{whiteSpace:"pre-wrap",color:"#333"},children:h.message}),r.jsx("button",{style:Pe.feedbackBtn,onClick:ve,children:""})]})})]})},n5=({item:e,bids:t,currentHighest:n,highestBidder:s,onPlayerBid:o,onShowPlot:i,sold:a,autoBidConfig:l,onAutoBidConfigChange:d,isMobile:p})=>{const[f,c]=y.useState("");y.useEffect(()=>c(""),[e.id]);const u=(v,k)=>p?k:v,x=y.useMemo(()=>e5(e.rarity),[e.rarity]),S=y.useMemo(()=>[{label:"+5%",value:Math.max(1,Math.floor((e.basePrice||0)*.05))},{label:"+10%",value:Math.max(1,Math.floor((e.basePrice||0)*.1))},{label:"+50",value:50}],[e.basePrice]),w=n+Math.max(1,Math.floor((e.basePrice||0)*.05)),C=l||{enabled:!1,ceiling:""},h=v=>{const k=Number(f)||n;c(String(k+v))},g=()=>{o(e,f,c)},b=()=>{d(e.id,{enabled:!C.enabled})},E=v=>{const k=Number(v.replace(/[^0-9]/g,""));d(e.id,{ceiling:Number.isNaN(k)?"":k})},I=t.slice(-3).reverse();return r.jsxs("div",{style:{...Pe.item,borderColor:a?"#66bb6a":"#f5deb3",opacity:a?.6:1,padding:u("14px","12px"),gap:u("8px","6px")},children:[r.jsxs("div",{style:{...Pe.itemHeader,flexDirection:p?"column":"row",gap:p?"4px":"0"},children:[r.jsx("div",{style:{fontWeight:"bold",color:"#4e342e",fontSize:u("14px","13px")},children:e.name}),r.jsxs("div",{style:{color:"#ffb300",fontWeight:"bold",fontSize:u("14px","13px")},children:[n," "]})]}),r.jsx("div",{style:{...Pe.desc,fontSize:u("13px","12px")},children:e.description}),r.jsxs("div",{style:{...Pe.chipRow,gap:u("6px","4px")},children:[r.jsx("span",{style:{...Pe.chip,fontSize:u("11px","10px")},children:x}),r.jsxs("span",{style:{...Pe.chip,fontSize:u("11px","10px")},children:[" ",Math.max(1,Math.floor((e.basePrice||0)*.05))]}),a&&r.jsx("span",{style:{...Pe.chip,background:"#66bb6a",color:"#fff",fontSize:u("11px","10px")},children:""})]}),r.jsxs("div",{style:{...Pe.bidRow,flexDirection:p?"column":"row",gap:p?"4px":"0"},children:[r.jsxs("div",{style:{...Pe.bidMeta,fontSize:u("12px","11px")},children:["",s||""]}),r.jsxs("div",{style:{...Pe.bidMeta,fontSize:u("12px","11px")},children:["",w]})]}),r.jsxs("div",{style:{...Pe.inputRow,flexDirection:p?"column":"row"},children:[r.jsx("input",{value:f,onChange:v=>c(v.target.value),placeholder:` ${w}`,style:{...Pe.input,fontSize:u("13px","12px"),padding:u("8px","6px")},disabled:!!a}),r.jsx("button",{style:{...Pe.bidBtn,fontSize:u("13px","12px"),padding:u("8px 14px","6px 12px")},onClick:g,disabled:!!a,children:""}),r.jsx("button",{style:{...Pe.plotBtn,fontSize:u("13px","12px"),padding:u("8px 12px","6px 10px")},onClick:i,children:""})]}),r.jsx("div",{style:{...Pe.quickRow,flexWrap:p?"wrap":"nowrap"},children:S.map(v=>r.jsx("button",{style:{...Pe.quickBtn,flex:p?"1 1 30%":"1",fontSize:u("12px","11px")},disabled:!!a,onClick:()=>h(v.value),children:v.label},v.label))}),r.jsxs("div",{style:{...Pe.autoBidRow,flexDirection:p?"column":"row",alignItems:p?"flex-start":"center"},children:[r.jsxs("label",{style:{display:"flex",alignItems:"center",gap:8,fontSize:u("12px","11px")},children:[r.jsx("input",{type:"checkbox",checked:!!C.enabled,onChange:b,disabled:!!a}),r.jsx("span",{children:""})]}),r.jsx("input",{value:C.ceiling,onChange:v=>E(v.target.value),placeholder:"",style:{...Pe.input,width:u("120px","100%"),fontSize:u("13px","12px"),padding:u("8px","6px")},disabled:!C.enabled||a})]}),r.jsx("div",{style:{...Pe.history,fontSize:u("12px","11px")},children:I.map((v,k)=>r.jsxs("div",{style:{...Pe.historyRow,fontSize:u("12px","11px")},children:[r.jsx("span",{children:v.bidder}),r.jsxs("span",{children:[v.amount," "]})]},`${v.bidder}-${k}`))})]})},Pe={overlay:{position:"fixed",inset:0,backgroundColor:"rgba(0,0,0,0.7)",display:"flex",justifyContent:"center",alignItems:"center",zIndex:1200,padding:"20px",overflowY:"auto"},modalWrapper:{position:"relative",width:"min(1080px, 96vw)",maxHeight:"92vh"},modalShell:{position:"relative",background:"linear-gradient(160deg, rgba(29,24,18,0.95), rgba(36,28,22,0.92))",borderRadius:"24px",border:"1px solid rgba(255,255,255,0.08)",boxShadow:"0 25px 80px rgba(0,0,0,0.55)",padding:"24px",color:"#fcefdc",maxHeight:"92vh",overflow:"hidden",display:"flex",flexDirection:"column"},header:{position:"relative",display:"flex",justifyContent:"space-between",gap:"16px",borderBottom:"1px solid rgba(255,255,255,0.08)",paddingBottom:"16px"},headerActions:{display:"flex",alignItems:"center",gap:"12px"},title:{margin:0,fontSize:"24px",letterSpacing:"1px"},message:{margin:"6px 0 0",color:"#f5d7a0"},resourceChip:{background:"rgba(0,0,0,0.35)",padding:"6px 14px",borderRadius:"999px",fontWeight:"bold",border:"1px solid rgba(255,255,255,0.15)"},closeBtn:{border:"1px solid rgba(255,255,255,0.35)",background:"transparent",color:"#fff",borderRadius:"999px",padding:"6px 16px",cursor:"pointer"},body:{marginTop:"20px",overflow:"hidden"},catalogPanel:{flex:1,maxHeight:"60vh",overflowY:"auto",display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(260px, 1fr))",gap:"14px",paddingRight:"6px"},plotCard:{borderRadius:"18px",padding:"20px",background:"rgba(0,0,0,0.35)",border:"1px solid rgba(255,255,255,0.06)",flex:1,display:"flex",flexDirection:"column"},plotTitle:{margin:0,color:"#ffe0b2"},plotContent:{marginTop:"12px",whiteSpace:"pre-wrap",lineHeight:1.6,color:"#f8f0dd",overflowY:"auto"},backBtn:{marginTop:"auto",border:"1px solid rgba(255,255,255,0.4)",borderRadius:"12px",padding:"10px",background:"transparent",color:"#fff",cursor:"pointer"},item:{borderRadius:"16px",border:"1px solid #f5deb3",background:"rgba(255,252,247,0.9)",padding:"14px",display:"flex",flexDirection:"column",gap:"8px"},itemHeader:{display:"flex",justifyContent:"space-between"},desc:{fontSize:"13px",color:"#654321"},chipRow:{display:"flex",gap:"6px",flexWrap:"wrap"},chip:{padding:"2px 10px",borderRadius:"999px",background:"rgba(255,193,7,0.15)",border:"1px solid rgba(255,193,7,0.3)",fontSize:"11px",color:"#a15c00"},bidRow:{display:"flex",justifyContent:"space-between",fontSize:"12px",color:"#775c44"},bidMeta:{fontSize:"12px"},inputRow:{display:"flex",gap:"8px"},input:{flex:1,borderRadius:"10px",border:"1px solid #d7ccc8",padding:"8px"},bidBtn:{padding:"8px 14px",borderRadius:"10px",border:"none",background:"#8d6e63",color:"#fff",cursor:"pointer"},plotBtn:{padding:"8px 12px",borderRadius:"10px",border:"1px solid #d7ccc8",background:"transparent",cursor:"pointer"},quickRow:{display:"flex",gap:"8px"},quickBtn:{flex:1,padding:"6px 0",borderRadius:"8px",border:"1px dashed #c7b8a3",background:"transparent",cursor:"pointer"},autoBidRow:{display:"flex",alignItems:"center",justifyContent:"space-between",gap:"10px"},history:{marginTop:"8px",borderTop:"1px dashed #d7ccc8",paddingTop:"8px"},historyRow:{display:"flex",justifyContent:"space-between",fontSize:"12px"},feedbackOverlay:{position:"fixed",inset:0,background:"rgba(0,0,0,0.55)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1300,padding:"20px"},feedbackCard:{background:"#fffef8",borderRadius:"18px",padding:"24px",maxWidth:"420px",width:"100%",border:"2px solid",boxShadow:"0 18px 45px rgba(0,0,0,0.3)"},feedbackBtn:{marginTop:"16px",width:"100%",padding:"10px 12px",borderRadius:"12px",border:"none",background:"#6d4c41",color:"#fff",cursor:"pointer"}},Gd={common:"#9e9e9e",uncommon:"#4caf50",rare:"#2196f3",epic:"#9c27b0",legendary:"#ff9800"},ah=[{id:"ALL",label:"",matcher:()=>!0},{id:"CONSUMABLE",label:"",matcher:e=>e.type==="consumable"},{id:"EQUIPMENT",label:"",matcher:e=>["weapon","armor","accessory"].includes(e.type)},{id:"MANUAL",label:"",matcher:e=>e.type==="manual"},{id:"OTHER",label:"",matcher:e=>!["consumable","manual","weapon","armor","accessory"].includes(e.type)}],r5=({items:e=[],mode:t="VIEW",slot:n=null,childId:s=null,children:o=[],batchUseItems:i=[],onClose:a,onEquip:l,onUse:d,onBatchUse:p,onGiveToChild:f,onBatchGive:c,onSell:u,onDiscard:x,onAutoAssignManual:S,getMarketPrice:w})=>{const[C,h]=y.useState([]),[g,b]=y.useState(!1),[E,I]=y.useState("grid"),[v,k]=y.useState("ALL"),[T,A]=y.useState(!1),[R,$]=y.useState({}),[O,Q]=y.useState(!1),[L,G]=y.useState({}),ne=t==="VIEW",ae=e.some(D=>D.type==="manual");y.useEffect(()=>{t!=="VIEW"&&v!=="ALL"&&k("ALL")},[t,v]);const Y=D=>D.type!=="manual"?null:r.jsxs("div",{style:Re.manualInfo,children:[D.tier&&r.jsx("span",{style:{...Re.manualBadge,background:D.tierColor||"#999",marginRight:"8px"},children:D.tier}),D.element&&r.jsxs("span",{style:{...Re.manualBadge,background:"#e3f2fd",color:"#1976d2",marginRight:"8px"},children:[": ",D.element]}),D.baseBonus&&r.jsxs("span",{style:{...Re.manualBadge,background:"#e8f5e9",color:"#2e7d32"},children:[": ",D.baseBonus]})]}),q=t==="SELECT"&&n?e.filter(D=>D.slot===n):t==="MANUAL_SELECT"?e.filter(D=>D.type==="manual"):e,Z=(D=>{if(!ne||v==="ALL")return D;const Se=ah.find(de=>de.id===v);return Se?D.filter(Se.matcher):D})(q),ve={legendary:5,epic:4,rare:3,uncommon:2,common:1},V=[...Z].sort((D,Se)=>{const de=ve[D.rarity]||0,Ie=ve[Se.rarity]||0;return Ie!==de?Ie-de:(Se.name||"")!==(D.name||"")?(D.name||"").localeCompare(Se.name||""):(Se.quantity||0)-(D.quantity||0)}),ee=D=>!D||!Array.isArray(D.usageTargets)||D.usageTargets.length===0?!0:D.usageTargets.includes(pt.CHILD),he=D=>ee(D)?D.type==="manual"?{allowed:!1,reason:""}:D.type==="consumable"?{allowed:!0,reason:""}:D.type==="weapon"||D.type==="armor"||D.type==="accessory"?{allowed:!0,reason:""}:{allowed:!1,reason:""}:{allowed:!1,reason:""},ge=D=>{C.includes(D)?h(C.filter(Se=>Se!==D)):h([...C,D])},me=()=>{if(C.length===0){window.showResult&&window.showResult("","",!1,null,!1);return}const D=C.filter(de=>{const Ie=e.find(Be=>Be.instanceId===de);return Ie&&he(Ie).allowed});if(D.length===0){window.showResult&&window.showResult("","",!1,null,!1);return}Q(!0),b(!1);const Se={};D.forEach(de=>{e.find(Be=>Be.instanceId===de)&&(Se[de]=1)}),G(Se)},Me={consumable:"",weapon:"",armor:"",accessory:"",manual:""},$e={consumable:"",weapon:"",armor:"",accessory:"",manual:""},je={weapon:"",armor:"",accessory:""},ct=D=>D.icon||D.emoji||$e[D.type]||"",vt=D=>{if(D.type==="consumable"&&D.effect){const Ie=D.effect;if(Ie.kind==="exp")return` +${Ie.amount}`;if(Ie.kind==="aptitude")return` +${Ie.amount}`;if(Ie.kind==="heal")return` +${Ie.amount}`}if(D.type==="manual"&&D.manualIds)return` ${D.manualIds.length} `;const Se=D.stats||{},de=[];return Se.atk&&de.push(` +${Se.atk}`),Se.hp&&de.push(` +${Se.hp}`),Se.mp&&de.push(` +${Se.mp}`),de.join(" / ")},De=D=>{if(g)return null;const Se=[];return t==="SELECT"&&D.slot===n&&Se.push(r.jsx("button",{style:Re.btnPrimary,onClick:de=>{de.stopPropagation(),l&&l(D.instanceId)},children:""},"equip")),t==="MANUAL_SELECT"&&D.type==="manual"&&Se.push(r.jsx("button",{style:Re.btnPrimary,onClick:de=>{de.stopPropagation(),d&&d(D.instanceId)},children:""},"manual")),t==="VIEW"&&D.type==="consumable"&&Se.push(r.jsx("button",{style:Re.btnPrimary,onClick:de=>{de.stopPropagation(),d&&d(D.instanceId)},children:s?"":""},"use")),t==="VIEW"&&D.type==="manual"&&Se.push(r.jsx("button",{style:Re.btnPrimary,onClick:de=>{de.stopPropagation(),d&&d(D.instanceId)},children:s?"":""},"study")),t==="VIEW"&&!s&&Se.push(r.jsx("button",{style:{...Re.btnSecondary,background:"#e53935"},onClick:de=>{de.stopPropagation(),window.showConfirm?window.showConfirm(` ${D.name}${D.quantity&&D.quantity>1?" () ":""}`,()=>{x&&x(D.instanceId)}):x&&x(D.instanceId)},children:""},"discard")),t==="VIEW"&&!s&&o&&o.length>0&&Se.push(r.jsx("button",{style:Re.btnSecondary,onClick:de=>{de.stopPropagation(),f&&f(D.instanceId)},children:""},"give")),t==="SELL"&&Se.push(r.jsx("button",{style:{...Re.btnPrimary,background:"#f57c00"},onClick:de=>{de.stopPropagation(),u&&(D.quantity&&D.quantity>1&&window.showConfirm?window.showConfirm(` ${D.quantity}`,Ie=>{const Be=parseInt(Ie||`${D.quantity}`,10);!Be||Be<=0||u(D.instanceId,Math.min(Be,D.quantity||1))}):u(D.instanceId,1))},children:""},"sell")),Se.length?Se:null};return r.jsx("div",{style:Re.overlay,children:r.jsxs("div",{style:Re.modal,children:[r.jsxs("div",{style:Re.header,children:[r.jsx("h3",{style:{margin:0},children:t==="SELECT"?"":""}),r.jsx("button",{style:Re.close,onClick:a,children:""})]}),r.jsx("div",{style:Re.tip,children:t==="SELECT"&&n?`${je[n]||n}`:t==="MANUAL_SELECT"?"":t==="SELL"?"":""}),r.jsxs("div",{style:Re.toolbar,children:[r.jsxs("span",{style:Re.toolbarMeta,children:[" ",V.length,"   ",E==="grid"?"":""]}),r.jsxs("div",{style:Re.viewSwitch,children:[r.jsx("button",{type:"button",style:E==="grid"?{...Re.viewBtn,...Re.viewBtnActive}:Re.viewBtn,onClick:()=>I("grid"),children:" "}),r.jsx("button",{type:"button",style:E==="list"?{...Re.viewBtn,...Re.viewBtnActive}:Re.viewBtn,onClick:()=>I("list"),children:" "})]})]}),ne&&r.jsxs("div",{style:Re.categoryBar,children:[r.jsx("div",{style:Re.categoryGroup,children:ah.map(D=>r.jsx("button",{type:"button",onClick:()=>k(D.id),style:v===D.id?{...Re.categoryBtn,...Re.categoryBtnActive}:Re.categoryBtn,children:D.label},D.id))}),S&&r.jsx("button",{type:"button",onClick:S,disabled:!ae||!(o&&o.length),style:{...Re.autoAssignBtn,opacity:!ae||!(o&&o.length)?.5:1,cursor:!ae||!(o&&o.length)?"not-allowed":"pointer"},children:" "})]}),t==="VIEW"&&!s&&o&&o.length>0&&r.jsxs("div",{style:{padding:"10px 16px",borderBottom:"1px solid #eee",background:g?"#e3f2fd":"#f5f5f5",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[r.jsx("button",{onClick:()=>{b(!g),h([])},style:{padding:"6px 12px",border:"none",borderRadius:"6px",background:g?"#1976d2":"#757575",color:"#fff",cursor:"pointer",fontSize:"12px"},children:g?" ":" "}),g&&r.jsxs("div",{style:{display:"flex",gap:"8px",alignItems:"center"},children:[r.jsxs("span",{style:{fontSize:"12px",color:"#666"},children:[" ",C.length," "]}),!s&&r.jsx("button",{onClick:()=>{if(C.length===0){window.showResult&&window.showResult("","",!1,null,!1);return}A(!0),b(!1);const D={};C.forEach(Se=>{const de=e.find(Ie=>Ie.instanceId===Se);de&&de.type==="consumable"&&(D[Se]=1)}),$(D)},disabled:C.length===0,style:{padding:"6px 12px",border:"none",borderRadius:"6px",background:C.length>0?"#4caf50":"#ccc",color:"#fff",cursor:C.length>0?"pointer":"not-allowed",fontSize:"12px"},children:""}),r.jsx("button",{onClick:me,disabled:C.length===0,style:{padding:"6px 12px",border:"none",borderRadius:"6px",background:C.length>0?"#7b1fa2":"#ccc",color:"#fff",cursor:C.length>0?"pointer":"not-allowed",fontSize:"12px"},children:""}),t==="SELL"&&r.jsx("button",{onClick:()=>{if(u){if(C.length===0){window.showResult&&window.showResult("","",!1,null,!1);return}C.forEach(D=>{const Se=e.find(Ie=>Ie.instanceId===D);if(!Se)return;const de=Se.quantity||1;u(D,de)}),h([]),b(!1)}},disabled:C.length===0,style:{padding:"6px 12px",border:"none",borderRadius:"6px",background:C.length>0?"#f57c00":"#ccc",color:"#fff",cursor:C.length>0?"pointer":"not-allowed",fontSize:"12px"},children:""}),r.jsx("button",{onClick:()=>{const D=Z.filter(Se=>he(Se).allowed).map(Se=>Se.instanceId);h(D)},style:{padding:"6px 12px",border:"none",borderRadius:"6px",background:"#00897b",color:"#fff",cursor:"pointer",fontSize:"12px"},children:""})]})]}),T&&r.jsxs("div",{style:{padding:"16px",background:"#e8f5e9",borderBottom:"1px solid #c8e6c9",borderRadius:"8px",margin:"8px"},children:[r.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"12px"},children:[r.jsx("h4",{style:{margin:0,color:"#2e7d32"},children:" "}),r.jsx("button",{onClick:()=>{A(!1),$({}),h([])},style:{padding:"4px 8px",border:"none",borderRadius:"4px",background:"#757575",color:"#fff",cursor:"pointer",fontSize:"11px"},children:""})]}),r.jsx("div",{style:{maxHeight:"200px",overflowY:"auto",marginBottom:"12px"},children:Object.keys(R).map(D=>{const Se=e.find(Be=>Be.instanceId===D);if(!Se)return null;const de=Se.quantity||1,Ie=R[D]||1;return r.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",padding:"8px",background:"#fff",borderRadius:"6px",marginBottom:"8px",border:"1px solid #c8e6c9"},children:[r.jsxs("span",{style:{fontSize:"13px",flex:1},children:[ct(Se)," ",Se.name,r.jsxs("span",{style:{color:"#999",marginLeft:"8px"},children:["(: ",de,")"]})]}),r.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[r.jsx("button",{onClick:()=>{const Be=Math.max(1,Ie-1);$(dt=>({...dt,[D]:Be}))},disabled:Ie<=1,style:{width:"24px",height:"24px",border:"none",borderRadius:"4px",background:Ie<=1?"#e0e0e0":"#4caf50",color:"#fff",cursor:Ie<=1?"not-allowed":"pointer",fontSize:"16px",lineHeight:"1"},children:"-"}),r.jsx("input",{type:"number",min:"1",max:de,value:Ie,onChange:Be=>{const dt=parseInt(Be.target.value)||1,_n=Math.max(1,Math.min(de,dt));$(wn=>({...wn,[D]:_n}))},style:{width:"50px",padding:"4px",textAlign:"center",border:"1px solid #c8e6c9",borderRadius:"4px",fontSize:"13px"}}),r.jsx("button",{onClick:()=>{const Be=Math.min(de,Ie+1);$(dt=>({...dt,[D]:Be}))},disabled:Ie>=de,style:{width:"24px",height:"24px",border:"none",borderRadius:"4px",background:Ie>=de?"#e0e0e0":"#4caf50",color:"#fff",cursor:Ie>=de?"not-allowed":"pointer",fontSize:"16px",lineHeight:"1"},children:"+"}),r.jsx("button",{onClick:()=>{const Be={...R};delete Be[D],$(Be),h(dt=>dt.filter(_n=>_n!==D))},style:{padding:"4px 8px",border:"none",borderRadius:"4px",background:"#f44336",color:"#fff",cursor:"pointer",fontSize:"11px"},children:""})]})]},D)})}),r.jsx("div",{style:{display:"flex",gap:"8px",justifyContent:"flex-end"},children:r.jsx("button",{onClick:()=>{const D=Object.keys(R).map(Se=>({instanceId:Se,quantity:R[Se]}));if(D.length===0){window.showResult&&window.showResult("","",!1,null,!1);return}p&&p(s||null,D),A(!1),$({}),h([])},style:{padding:"8px 16px",border:"none",borderRadius:"6px",background:"#4caf50",color:"#fff",cursor:"pointer",fontSize:"13px",fontWeight:"bold"},children:" "})})]}),O&&r.jsxs("div",{style:{padding:"16px",background:"#f3e5f5",borderBottom:"1px solid #e1bee7",borderRadius:"8px",margin:"8px"},children:[r.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"12px"},children:[r.jsx("h4",{style:{margin:0,color:"#7b1fa2"},children:" "}),r.jsx("button",{onClick:()=>{Q(!1),G({}),h([])},style:{padding:"4px 8px",border:"none",borderRadius:"4px",background:"#757575",color:"#fff",cursor:"pointer",fontSize:"11px"},children:""})]}),r.jsx("div",{style:{maxHeight:"200px",overflowY:"auto",marginBottom:"12px"},children:Object.keys(L).map(D=>{const Se=e.find(Be=>Be.instanceId===D);if(!Se)return null;const de=Se.quantity||1,Ie=L[D]||1;return r.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",padding:"8px",background:"#fff",borderRadius:"6px",marginBottom:"8px",border:"1px solid #e1bee7"},children:[r.jsxs("span",{style:{fontSize:"13px",flex:1},children:[ct(Se)," ",Se.name,r.jsxs("span",{style:{color:"#999",marginLeft:"8px"},children:["(: ",de,")"]})]}),r.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[r.jsx("button",{onClick:()=>{const Be=Math.max(1,Ie-1);G(dt=>({...dt,[D]:Be}))},disabled:Ie<=1,style:{width:"24px",height:"24px",border:"none",borderRadius:"4px",background:Ie<=1?"#e0e0e0":"#7b1fa2",color:"#fff",cursor:Ie<=1?"not-allowed":"pointer",fontSize:"16px",lineHeight:"1"},children:"-"}),r.jsx("input",{type:"number",min:"1",max:de,value:Ie,onChange:Be=>{const dt=parseInt(Be.target.value)||1,_n=Math.max(1,Math.min(de,dt));G(wn=>({...wn,[D]:_n}))},style:{width:"50px",padding:"4px",textAlign:"center",border:"1px solid #e1bee7",borderRadius:"4px",fontSize:"13px"}}),r.jsx("button",{onClick:()=>{const Be=Math.min(de,Ie+1);G(dt=>({...dt,[D]:Be}))},disabled:Ie>=de,style:{width:"24px",height:"24px",border:"none",borderRadius:"4px",background:Ie>=de?"#e0e0e0":"#7b1fa2",color:"#fff",cursor:Ie>=de?"not-allowed":"pointer",fontSize:"16px",lineHeight:"1"},children:"+"}),r.jsx("button",{onClick:()=>{const Be={...L};delete Be[D],G(Be),h(dt=>dt.filter(_n=>_n!==D))},style:{padding:"4px 8px",border:"none",borderRadius:"4px",background:"#f44336",color:"#fff",cursor:"pointer",fontSize:"11px"},children:""})]})]},D)})}),r.jsx("div",{style:{display:"flex",gap:"8px",justifyContent:"flex-end"},children:r.jsx("button",{onClick:()=>{const D=Object.keys(L).map(de=>({instanceId:de,quantity:L[de]}));if(D.length===0){window.showResult&&window.showResult("","",!1,null,!1);return}const Se=D.map(({instanceId:de,quantity:Ie})=>({instanceId:de,quantity:Ie}));c&&c(Se),Q(!1),G({}),h([])},style:{padding:"8px 16px",border:"none",borderRadius:"6px",background:"#7b1fa2",color:"#fff",cursor:"pointer",fontSize:"13px",fontWeight:"bold"},children:" "})})]}),r.jsxs("div",{style:Re.list,children:[V.length===0&&r.jsx("div",{style:Re.empty,children:""}),V.length>0&&r.jsx("div",{style:E==="grid"?Re.gridContainer:Re.listContainer,children:V.map(D=>{const Se=C.includes(D.instanceId),de=he(D),Ie=De(D),Be=t==="SELL"?Math.floor((w?w(D):D.sellPrice||D.price||0)*.7):null;return E==="grid"?r.jsxs("div",{style:{...Re.gridCard,borderColor:Se?"#1976d2":"rgba(0,0,0,0.05)",borderWidth:"2px",boxShadow:Se?"0 0 0 1px #1976d2":"0 6px 16px rgba(0,0,0,0.08)",cursor:g?"pointer":"default"},onClick:()=>{g&&de.allowed&&ge(D.instanceId)},children:[g&&r.jsx("input",{type:"checkbox",checked:Se,onChange:dt=>{dt.stopPropagation(),de.allowed&&ge(D.instanceId)},disabled:!de.allowed,style:Re.gridCheckbox}),r.jsxs("div",{style:Re.gridMain,children:[r.jsx("div",{style:{...Re.gridIcon,borderColor:Gd[D.rarity]||"#d7ccc8",borderWidth:"2px",borderStyle:"solid"},children:r.jsx("span",{children:ct(D)})}),r.jsxs("div",{style:Re.gridBody,children:[r.jsxs("div",{style:Re.gridTitleRow,children:[r.jsx("span",{style:{color:Gd[D.rarity]||"#333",fontWeight:"bold"},children:D.name}),D.quantity&&D.quantity>1&&r.jsxs("span",{style:Re.gridQty,children:["x",D.quantity]})]}),r.jsxs("div",{style:Re.gridMeta,children:[r.jsx("span",{style:Re.gridTag,children:Me[D.type]||D.type}),r.jsx("span",{style:{fontSize:"11px",color:"#5d4037"},children:vt(D)||""})]}),r.jsx("div",{style:Re.gridDesc,children:D.desc}),Y(D),Be!==null&&r.jsxs("div",{style:Re.gridPrice,children:[": ",Be," "]}),g&&!de.allowed&&r.jsxs("div",{style:Re.gridWarning,children:[" ",de.reason]})]})]}),Ie&&r.jsx("div",{style:Re.gridActions,children:Ie})]},D.instanceId):r.jsxs("div",{style:{...Re.card,borderColor:Se?"#1976d2":"#eee",borderWidth:Se?"2px":"1px",background:Se?"#e3f2fd":"#fafafa",cursor:g?"pointer":"default"},onClick:()=>{g&&de.allowed&&ge(D.instanceId)},children:[r.jsxs("div",{style:Re.rowBetween,children:[r.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[g&&r.jsx("input",{type:"checkbox",checked:Se,onChange:dt=>{dt.stopPropagation(),de.allowed&&ge(D.instanceId)},disabled:!de.allowed,style:{cursor:de.allowed?"pointer":"not-allowed"}}),r.jsx("span",{style:{color:Gd[D.rarity]||"#333",fontWeight:"bold"},children:D.name}),D.quantity&&D.quantity>1&&r.jsxs("span",{style:{fontSize:"12px",color:"#666",marginLeft:"6px"},children:["x",D.quantity]})]}),r.jsx("span",{style:Re.tag,children:Me[D.type]||D.type})]}),Y(D),r.jsx("div",{style:Re.desc,children:D.desc}),r.jsx("div",{style:Re.stats,children:vt(D)||""}),Be!==null&&r.jsxs("div",{style:{fontSize:"12px",color:"#f57c00",marginTop:6},children:[": ",Be," "]}),g&&!de.allowed&&r.jsxs("div",{style:{fontSize:"11px",color:"#f44336",marginTop:"4px",padding:"4px 8px",background:"rgba(244, 67, 54, 0.1)",borderRadius:"4px"},children:[" ",de.reason]}),Ie&&r.jsx("div",{style:Re.actions,children:Ie})]},D.instanceId)})})]})]})})},Re={overlay:{position:"fixed",inset:0,background:"rgba(0,0,0,0.5)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:2e3},modal:{width:"520px",maxHeight:"80vh",background:"#fff",borderRadius:"12px",boxShadow:"0 10px 25px rgba(0,0,0,0.2)",display:"flex",flexDirection:"column"},header:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"12px 16px",borderBottom:"1px solid #eee"},close:{border:"none",background:"transparent",fontSize:"20px",cursor:"pointer",color:"#888"},tip:{padding:"8px 16px",fontSize:"12px",color:"#666",borderBottom:"1px dashed #eee"},toolbar:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"10px 16px",borderBottom:"1px solid #f0e0d6",background:"#fffbe6"},toolbarMeta:{fontSize:"12px",color:"#8d6e63"},viewSwitch:{display:"flex",gap:"6px"},viewBtn:{fontSize:"12px",padding:"4px 10px",borderRadius:"999px",border:"1px solid #d7ccc8",background:"#fff",cursor:"pointer",color:"#6d4c41"},viewBtnActive:{background:"#6d4c41",color:"#fff",borderColor:"#6d4c41"},categoryBar:{display:"flex",justifyContent:"space-between",alignItems:"center",gap:"12px",padding:"8px 16px",borderBottom:"1px solid #f0f0f0",background:"#fff"},categoryGroup:{display:"flex",flexWrap:"wrap",gap:"8px"},categoryBtn:{fontSize:"12px",padding:"4px 12px",borderRadius:"12px",border:"1px solid #d7ccc8",background:"#fff",color:"#6d4c41",cursor:"pointer",transition:"all 0.2s"},categoryBtnActive:{background:"#6d4c41",color:"#fff",borderColor:"#6d4c41",boxShadow:"0 2px 6px rgba(0,0,0,0.1)"},autoAssignBtn:{fontSize:"12px",padding:"6px 14px",borderRadius:"16px",border:"none",background:"linear-gradient(120deg, #ff9800, #ff5722)",color:"#fff",fontWeight:"bold"},list:{padding:"12px",overflowY:"auto"},listContainer:{display:"flex",flexDirection:"column",gap:"10px"},gridContainer:{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(180px, 1fr))",gap:"12px"},empty:{textAlign:"center",color:"#999",padding:"20px"},card:{borderWidth:"1px",borderStyle:"solid",borderColor:"#eee",borderRadius:"8px",padding:"10px",marginBottom:"10px",background:"#fafafa"},gridCard:{position:"relative",borderRadius:"12px",padding:"14px",background:"#fff",display:"flex",flexDirection:"column",gap:"10px",borderStyle:"solid",borderColor:"rgba(0,0,0,0.05)"},gridMain:{display:"flex",gap:"10px",alignItems:"flex-start"},rowBetween:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"6px"},tag:{fontSize:"10px",padding:"2px 6px",borderRadius:"6px",background:"#e0e0e0",color:"#555",textTransform:"uppercase"},desc:{fontSize:"12px",color:"#555",marginBottom:"6px"},stats:{fontSize:"12px",color:"#333",marginBottom:"8px"},actions:{display:"flex",gap:"8px",flexWrap:"wrap"},gridIcon:{width:"54px",height:"54px",borderRadius:"12px",borderWidth:"2px",borderStyle:"solid",borderColor:"#d7ccc8",display:"flex",alignItems:"center",justifyContent:"center",fontSize:"24px",color:"#4e342e"},gridBody:{display:"flex",flexDirection:"column",gap:"6px"},gridTitleRow:{display:"flex",justifyContent:"space-between",alignItems:"center"},gridQty:{fontSize:"12px",color:"#6d4c41"},gridMeta:{display:"flex",flexDirection:"column",alignItems:"flex-start",gap:"4px"},gridTag:{fontSize:"10px",padding:"2px 6px",borderRadius:"999px",background:"#f3e5f5",color:"#6a1b9a"},gridDesc:{fontSize:"11px",color:"#5d4037",lineHeight:1.4,minHeight:"32px"},gridActions:{display:"flex",flexWrap:"wrap",gap:"6px"},gridCheckbox:{position:"absolute",top:"10px",left:"10px",cursor:"pointer"},gridWarning:{fontSize:"11px",color:"#c62828",background:"rgba(198,40,40,0.08)",padding:"4px 8px",borderRadius:"6px"},gridPrice:{fontSize:"11px",color:"#f57c00",fontWeight:"bold"},btnPrimary:{padding:"6px 12px",border:"none",borderRadius:"6px",background:"#1976d2",color:"#fff",cursor:"pointer"},btnSecondary:{padding:"6px 12px",border:"none",borderRadius:"6px",background:"#7b1fa2",color:"#fff",cursor:"pointer",fontSize:"12px"},manualInfo:{display:"flex",flexWrap:"wrap",gap:"6px",marginTop:"8px",marginBottom:"8px"},manualBadge:{fontSize:"11px",padding:"3px 8px",borderRadius:"12px",color:"#fff",fontWeight:"bold",whiteSpace:"nowrap"}},s5=({child:e,onClose:t,onFinish:n})=>{const[s,o]=y.useState("INIT"),i=()=>{o("ANIMATING"),setTimeout(()=>{o("REVEAL")},2e3)},a=()=>{n(e),t()},l=d=>({:"#FFD700",:"#4CAF50",:"#2196F3",:"#F44336",:"#795548",:"#673AB7",:"#00BCD4",:"#009688"})[d]||"#ccc";return r.jsx("div",{style:sr.overlay,children:r.jsxs("div",{style:sr.card,children:[r.jsx("h2",{style:{color:"#3e2723"},children:" "}),s==="INIT"&&r.jsxs("div",{style:{textAlign:"center"},children:[r.jsx("h3",{style:{margin:"0 0 15px 0",color:"#3e2723"},children:e.name}),r.jsx("p",{children:""}),r.jsxs("p",{children:["",e.gender===""?"":"",""]}),r.jsx("div",{style:sr.childIcon,children:e.gender===""?"":""}),r.jsx("button",{onClick:i,style:sr.btn,children:" "})]}),s==="ANIMATING"&&r.jsxs("div",{style:{textAlign:"center"},children:[r.jsx("h3",{style:{margin:"0 0 15px 0",color:"#3e2723"},children:e.name}),r.jsx("div",{style:sr.orb}),r.jsx("p",{children:"..."})]}),s==="REVEAL"&&r.jsxs("div",{style:{textAlign:"center",animation:"fadeIn 0.5s"},children:[r.jsx("h3",{style:{margin:"0 0 15px 0",color:"#3e2723"},children:e.name}),r.jsx("h3",{children:"  "}),r.jsxs("div",{style:sr.resultBox,children:[r.jsx("div",{style:{color:e.spiritRoot.color,fontSize:"24px",fontWeight:"bold"},children:e.spiritRoot.type}),r.jsx("div",{style:sr.elements,children:e.spiritRoot.elements.map(d=>r.jsx("span",{style:{...sr.elBadge,background:l(d)},children:d},d))}),r.jsxs("div",{style:{marginTop:"15px"},children:[r.jsx("span",{style:{fontSize:"12px",color:"#666"},children:""}),r.jsxs("div",{style:{fontSize:"40px",fontWeight:"bold",color:"#333"},children:[e.stats.aptitude,r.jsx("span",{style:{fontSize:"14px",color:"#999"},children:"/100"})]})]}),r.jsx("p",{style:{fontSize:"12px",color:"#666",marginTop:"10px"},children:e.spiritRoot.desc})]}),r.jsxs("div",{style:sr.stats,children:[r.jsxs("p",{children:[": ",r.jsx("strong",{children:e.stats.aptitude})]}),r.jsxs("p",{children:[": ",r.jsx("strong",{children:e.combatStats.mp})]})]}),r.jsx("button",{onClick:a,style:sr.confirmBtn,children:""})]})]})})},sr={overlay:{position:"fixed",top:0,left:0,right:0,bottom:0,background:"rgba(0,0,0,0.8)",display:"flex",justifyContent:"center",alignItems:"center",zIndex:400},card:{width:"320px",background:"#fff",borderRadius:"15px",padding:"30px",textAlign:"center",boxShadow:"0 0 20px rgba(255, 215, 0, 0.3)"},btn:{padding:"15px 30px",fontSize:"18px",background:"#3e2723",color:"white",border:"none",borderRadius:"25px",cursor:"pointer",marginTop:"20px"},confirmBtn:{padding:"10px 20px",background:"#4caf50",color:"white",border:"none",borderRadius:"5px",marginTop:"20px",cursor:"pointer"},orb:{width:"80px",height:"80px",borderRadius:"50%",background:"radial-gradient(circle, #fff, #2196f3, #000)",margin:"20px auto",animation:"pulse 1s infinite"},childIcon:{fontSize:"50px",margin:"20px 0"},resultBox:{background:"#f5f5f5",padding:"15px",borderRadius:"10px",margin:"20px 0"},elements:{display:"flex",justifyContent:"center",gap:"5px",marginBottom:"10px"},elBadge:{padding:"4px 8px",borderRadius:"50%",color:"white",fontWeight:"bold",width:"24px",height:"24px",lineHeight:"24px"},stats:{display:"flex",justifyContent:"space-around",fontSize:"14px",borderTop:"1px dashed #ccc",paddingTop:"15px"}},o5=["","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","",""],lh=(e="")=>{if(!e)return 0;const t=o5.indexOf(e);return t>=0?t:0},Vd=8,i5=({children:e,item:t,items:n,isBatch:s=!1,onSelect:o,onClose:i})=>{const[a,l]=y.useState(null),[d,p]=y.useState("age"),[f,c]=y.useState(1),u=y.useMemo(()=>{const w=[...e];return w.sort((C,h)=>{var g,b;switch(d){case"age":return C.age-h.age;case"aptitude":return(((g=h.stats)==null?void 0:g.aptitude)||0)-(((b=C.stats)==null?void 0:b.aptitude)||0);case"cultivation":const E=lh(C.tier||""),I=lh(h.tier||"");if(E!==I)return I-E;const v=C.currentExp||0;return(h.currentExp||0)-v;case"name":return C.name.localeCompare(h.name,"zh-CN");default:return 0}}),w},[e,d]),x=Math.max(1,Math.ceil(u.length/Vd)),S=y.useMemo(()=>{const w=(f-1)*Vd;return u.slice(w,w+Vd)},[u,f]);return ic.useEffect(()=>{c(1)},[d]),r.jsx("div",{style:ot.overlay,children:r.jsxs("div",{style:ot.modal,children:[r.jsxs("div",{style:ot.header,children:[r.jsx("h3",{style:{margin:0},children:""}),r.jsx("button",{style:ot.close,onClick:i,children:""})]}),r.jsx("div",{style:ot.tip,children:s?r.jsxs(r.Fragment,{children:[" ",r.jsx("strong",{style:{color:"#1976d2"},children:(n==null?void 0:n.length)||0})," ",r.jsxs("div",{style:{marginTop:"6px",fontSize:"11px",color:"#666"},children:[n==null?void 0:n.slice(0,3).map((w,C)=>r.jsxs("span",{style:{marginRight:"8px"},children:[" ",w.name]},C)),(n==null?void 0:n.length)>3&&`...${n.length}`]})]}):r.jsxs(r.Fragment,{children:[" ",r.jsx("strong",{style:{color:"#1976d2"},children:t==null?void 0:t.name})," "]})}),r.jsx("div",{style:ot.controlBar,children:r.jsxs("div",{style:ot.sortButtons,children:[r.jsx("button",{style:{...ot.sortBtn,...d==="age"?ot.sortBtnActive:{}},onClick:()=>p("age"),children:""}),r.jsx("button",{style:{...ot.sortBtn,...d==="cultivation"?ot.sortBtnActive:{}},onClick:()=>p("cultivation"),children:""}),r.jsx("button",{style:{...ot.sortBtn,...d==="aptitude"?ot.sortBtnActive:{}},onClick:()=>p("aptitude"),children:""}),r.jsx("button",{style:{...ot.sortBtn,...d==="name"?ot.sortBtnActive:{}},onClick:()=>p("name"),children:""})]})}),r.jsxs("div",{style:ot.list,children:[e.length===0&&r.jsx("div",{style:ot.empty,children:""}),S.map((w,C)=>{var h;return r.jsxs("div",{style:{...ot.childCard,...a===w.id?ot.childCardHover:{}},onClick:()=>o(w),onMouseEnter:()=>l(w.id),onMouseLeave:()=>l(null),children:[r.jsxs("div",{style:ot.childInfo,children:[r.jsxs("div",{style:ot.childHeader,children:[r.jsx("span",{style:ot.childName,children:w.name}),r.jsx("span",{style:ot.childTier,children:w.tierTitle||""})]}),r.jsxs("div",{style:ot.childStats,children:[r.jsxs("span",{children:[" ",Math.floor(w.age),""]}),r.jsxs("span",{children:[" ",w.gender]}),r.jsxs("span",{children:["  ",((h=w.stats)==null?void 0:h.aptitude)||50]})]})]}),r.jsx("div",{style:ot.arrow,children:""})]},w.id)})]}),x>1&&r.jsxs("div",{style:ot.pagination,children:[r.jsx("button",{style:{...ot.pageBtn,opacity:f===1?.5:1},disabled:f===1,onClick:()=>c(Math.max(1,f-1)),children:""}),r.jsxs("span",{style:ot.pageInfo,children:[" ",f," / ",x," "]}),r.jsx("button",{style:{...ot.pageBtn,opacity:f>=x?.5:1},disabled:f>=x,onClick:()=>c(Math.min(x,f+1)),children:""})]})]})})},ot={overlay:{position:"fixed",inset:0,background:"rgba(0,0,0,0.5)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:2100},modal:{width:"450px",maxHeight:"70vh",background:"#fff",borderRadius:"12px",boxShadow:"0 10px 25px rgba(0,0,0,0.2)",display:"flex",flexDirection:"column"},header:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"12px 16px",borderBottom:"1px solid #eee"},close:{border:"none",background:"transparent",fontSize:"20px",cursor:"pointer",color:"#888"},tip:{padding:"12px 16px",fontSize:"13px",color:"#555",background:"#f5f5f5",borderBottom:"1px solid #eee"},controlBar:{padding:"12px 12px",borderBottom:"1px solid #eee",backgroundColor:"#fafafa"},sortButtons:{display:"flex",gap:"6px",flexWrap:"wrap"},sortBtn:{padding:"6px 12px",fontSize:"11px",backgroundColor:"#f0f0f0",color:"#666",border:"1px solid #ddd",borderRadius:"4px",cursor:"pointer",transition:"all 0.2s"},sortBtnActive:{backgroundColor:"#1976d2",color:"#fff",borderColor:"#1976d2"},list:{padding:"12px",overflowY:"auto",flex:1},empty:{textAlign:"center",color:"#999",padding:"20px"},childCard:{borderWidth:"1px",borderStyle:"solid",borderColor:"#e0e0e0",borderRadius:"8px",padding:"12px",marginBottom:"10px",background:"#fafafa",cursor:"pointer",display:"flex",justifyContent:"space-between",alignItems:"center",transition:"all 0.2s"},childCardHover:{background:"#e3f2fd",borderColor:"#1976d2",borderWidth:"1px",borderStyle:"solid"},childInfo:{flex:1},childHeader:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"6px"},childName:{fontSize:"15px",fontWeight:"bold",color:"#333"},childTier:{fontSize:"11px",padding:"2px 8px",borderRadius:"10px",background:"#3e2723",color:"#fff"},childStats:{display:"flex",gap:"12px",fontSize:"12px",color:"#666"},arrow:{fontSize:"20px",color:"#1976d2",marginLeft:"10px"},pagination:{display:"flex",justifyContent:"center",alignItems:"center",gap:"8px",padding:"12px 16px",borderTop:"1px solid #eee",backgroundColor:"#fafafa"},pageBtn:{padding:"6px 12px",fontSize:"11px",backgroundColor:"#f0f0f0",color:"#666",border:"1px solid #ddd",borderRadius:"4px",cursor:"pointer",transition:"all 0.2s"},pageInfo:{color:"#666",fontSize:"12px",minWidth:"70px",textAlign:"center"}},a5=({child:e,onChangeManual:t})=>{if(!e.spiritRoot||!e.spiritRoot.elements)return r.jsxs("div",{style:Ut.section,children:[r.jsx("h4",{style:Ut.secTitle,children:" "}),r.jsx("p",{style:{color:"#999",fontSize:"12px"},children:"(6)"})]});const n=e.cultivationMethod||"basic_breath",s=sc(n,e.spiritRoot);if(!s.manual)return r.jsxs("div",{style:Ut.section,children:[r.jsx("h4",{style:Ut.secTitle,children:" "}),r.jsx("p",{style:{color:"#999",fontSize:"12px"},children:""})]});const{manual:o,compatibility:i,speedBonus:a}=s,l=i.color||"#999";return r.jsxs("div",{style:Ut.section,children:[r.jsx("h4",{style:Ut.secTitle,children:" "}),r.jsxs("div",{style:Ut.manualCard,children:[r.jsxs("div",{style:Ut.manualHeader,children:[r.jsxs("div",{style:Ut.manualName,children:[o.name,r.jsx("span",{style:{...Ut.tierBadge,background:o.tierColor,marginLeft:"8px"},children:o.tierName})]}),o.element!=="NONE"&&r.jsx("div",{style:Ut.elementBadge,children:o.element})]}),r.jsx("div",{style:Ut.manualDesc,children:o.desc}),r.jsxs("div",{style:{...Ut.compatibilityBox,borderColor:l},children:[r.jsxs("div",{style:Ut.compatibilityRow,children:[r.jsx("span",{children:""}),r.jsx("span",{style:{color:l,fontWeight:"bold"},children:i.desc})]}),r.jsxs("div",{style:Ut.compatibilityRow,children:[r.jsx("span",{children:""}),r.jsxs("span",{style:{color:"#2196F3",fontWeight:"bold"},children:["+",a]})]})]}),r.jsx("div",{style:Ut.actionRow,children:r.jsx("button",{style:Ut.changeBtn,onClick:()=>{t&&t(e)},children:" "})})]})]})},Ut={section:{marginBottom:"20px",paddingBottom:"15px",borderBottom:"1px dashed #e0e0e0"},secTitle:{fontSize:"14px",fontWeight:"bold",marginBottom:"10px",color:"#333"},manualCard:{background:"#f9f9f9",borderRadius:"8px",padding:"12px",border:"1px solid #e0e0e0"},manualHeader:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"8px"},manualName:{fontSize:"16px",fontWeight:"bold",color:"#333",display:"flex",alignItems:"center"},tierBadge:{display:"inline-block",padding:"2px 8px",borderRadius:"4px",fontSize:"11px",color:"white",fontWeight:"bold"},elementBadge:{padding:"4px 10px",background:"#FF6B6B",color:"white",borderRadius:"12px",fontSize:"12px",fontWeight:"bold"},manualDesc:{fontSize:"12px",color:"#666",marginBottom:"10px",lineHeight:"1.5"},compatibilityBox:{background:"white",borderLeft:"3px solid",padding:"8px 10px",marginBottom:"10px",borderRadius:"4px"},compatibilityRow:{display:"flex",justifyContent:"space-between",fontSize:"13px",marginBottom:"4px"},actionRow:{display:"flex",justifyContent:"flex-end"},changeBtn:{padding:"6px 16px",background:"#2196F3",color:"white",border:"none",borderRadius:"6px",cursor:"pointer",fontSize:"13px",fontWeight:"bold",transition:"background 0.2s"}},l5=({child:e,onClose:t,onAction:n,navigation:s,onNavigate:o})=>{var I,v,k,T,A,R,$,O,Q,L,G,ne,ae,Y;const[i,a]=y.useState(!1),[l,d]=y.useState(e.name);y.useEffect(()=>{d(e.name),a(!1)},[e.id,e.name]),y.useEffect(()=>{if(typeof window>"u"||!o)return;const q=ie=>{ie.key==="ArrowLeft"&&(s!=null&&s.hasPrev)&&(ie.preventDefault(),o("PREV")),ie.key==="ArrowRight"&&(s!=null&&s.hasNext)&&(ie.preventDefault(),o("NEXT"))};return window.addEventListener("keydown",q),()=>window.removeEventListener("keydown",q)},[s,o]);const p=q=>({:"#FFD700",:"#4CAF50",:"#2196F3",:"#F44336",:"#795548",:"#673AB7",:"#00BCD4",:"#009688"})[q]||"#9e9e9e",f=q=>({WHITE:"#9e9e9e",GREEN:"#4caf50",BLUE:"#2196f3",PURPLE:"#9c27b0",ORANGE:"#ff9800",RED:"#f44336"})[q]||"#333",c=()=>{n("RENAME",l),a(!1)},u=Math.floor(e.age*12),x=e.isTested&&u>=72&&!!e.spiritRoot,S=((I=e.stats)==null?void 0:I.aptitude)||0,w=rf(S),C=Math.min(100,S),h=Math.max(0,Math.floor(e.currentExp||0)),g=Math.max(1,Math.floor(e.maxExp||1)),b=Math.min(100,Math.round(h/g*100)),E=(q,ie,Z)=>r.jsxs("div",{style:be.fractionWrapper,"aria-label":`${Z} ${q}/${ie}`,children:[r.jsx("span",{style:be.fractionCaption,children:Z}),r.jsxs("div",{style:be.fractionBox,children:[r.jsx("span",{style:be.fractionNumerator,children:q}),r.jsx("span",{style:be.fractionDivider}),r.jsx("span",{style:be.fractionDenominator,children:ie})]})]});return r.jsx("div",{style:be.overlay,children:r.jsxs("div",{style:be.modalWrapper,children:[r.jsx("button",{onClick:t,style:be.closeBtn,"aria-label":"",children:""}),r.jsxs("div",{style:be.modal,children:[s&&r.jsxs("div",{style:be.navBar,children:[r.jsxs("button",{type:"button","aria-label":"",onClick:()=>s.hasPrev&&o&&o("PREV"),disabled:!s.hasPrev,style:{...be.navBtn,...s.hasPrev?{}:be.navBtnDisabled},children:[" ",s.prevName||""]}),r.jsx("span",{style:be.navLabel,children:s.label||"--/--"}),r.jsxs("button",{type:"button","aria-label":"",onClick:()=>s.hasNext&&o&&o("NEXT"),disabled:!s.hasNext,style:{...be.navBtn,...s.hasNext?{}:be.navBtnDisabled},children:[s.nextName||""," "]})]}),r.jsx("div",{style:be.content,children:r.jsxs("div",{style:be.singleCol,children:[r.jsxs("div",{style:{display:"flex",gap:"20px",alignItems:"center",marginBottom:"20px",paddingBottom:"15px",borderBottom:"1px dashed #e0e0e0"},children:[r.jsx("div",{style:{marginBottom:"15px"},children:e.age===0?r.jsx("div",{style:{fontSize:"48px"},children:""}):e.age<15?r.jsx("div",{style:{fontSize:"48px"},children:""}):r.jsx(Cr,{dna:e.avatar,gender:e.gender,size:100})}),r.jsxs("div",{style:be.nameBox,children:[i?r.jsxs("div",{style:{display:"flex",gap:"5px"},children:[r.jsx("input",{value:l,onChange:q=>d(q.target.value),style:be.input}),r.jsx("button",{onClick:c,style:be.smallBtn,children:""})]}):r.jsxs("h2",{style:{margin:0},children:[e.name,r.jsx("span",{onClick:()=>a(!0),style:be.editIcon,children:""})]}),r.jsx("div",{style:be.tierBadge,children:e.tierTitle||""}),r.jsxs("div",{style:{marginTop:"10px",fontSize:"13px",color:"#555"},children:[r.jsxs("div",{style:{display:"flex",gap:"15px",marginBottom:"5px",flexWrap:"wrap"},children:[r.jsxs("div",{children:[" ",Math.floor(e.age),"",Math.floor(e.age%1*12),""]}),r.jsxs("div",{children:[" ",e.fatherName]}),r.jsxs("div",{children:[" ",e.gender]}),((v=e.stats)==null?void 0:v.lifespan)&&r.jsxs("div",{children:["  ",Math.floor(Math.max(0,vr(e))),"/",Math.floor(e.stats.lifespan),""]})]}),e.trait&&r.jsxs("div",{style:{...be.traitBox,borderColor:f(e.trait.rarity),marginTop:"5px",display:"inline-block"},children:[r.jsx("span",{style:{color:f(e.trait.rarity),fontWeight:"bold"},children:e.trait.name}),r.jsx("p",{style:{margin:"5px 0 0",fontSize:"10px",color:"#666"},children:e.trait.desc})]}),e.influenceProfile&&r.jsxs("div",{style:be.influencePanel,children:[r.jsxs("div",{style:{...be.influenceHeader,color:e.influenceProfile.color},children:[e.influenceProfile.label,r.jsx("span",{style:be.influenceScore,children:e.influenceProfile.score})]}),r.jsx("p",{style:be.influenceTagline,children:e.influenceProfile.tagline}),r.jsx("div",{style:be.influenceProgress,children:r.jsx("div",{style:{...be.influenceProgressFill,width:`${Math.min(100,Math.round((e.influenceProfile.progress||0)*100))}%`,background:e.influenceProfile.color}})}),r.jsxs("div",{style:be.influenceFooter,children:["",e.influenceProfile.nextLabel]})]})]})]})]}),r.jsxs("div",{style:be.section,children:[r.jsx("h4",{style:be.secTitle,children:" "}),e.spouse?r.jsxs("div",{style:be.spouseCard,children:[r.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"10px"},children:[r.jsx("div",{style:be.miniAvatar,children:e.spouse.gender===""?"":""}),r.jsxs("div",{children:[r.jsx("div",{style:{fontWeight:"bold",color:"#e91e63"},children:e.spouse.name}),r.jsx("div",{style:{fontSize:"12px",color:"#666"},children:e.spouse.gender===""?" ":" "}),r.jsx("div",{style:{fontSize:"12px"},children:e.spouse.tierTitle||""})]})]}),r.jsxs("div",{style:{marginTop:"8px",fontSize:"13px",display:"grid",gridTemplateColumns:"1fr 1fr 1fr",gap:"8px"},children:[r.jsxs("div",{children:[": ",r.jsx("span",{style:{color:"purple"},children:((k=e.spouse.stats)==null?void 0:k.aptitude)||e.spouse.aptitude})]}),r.jsxs("div",{children:[": ",((T=e.spouse.stats)==null?void 0:T.looks)||e.spouse.looks]}),r.jsxs("div",{children:[": ",((A=e.spouse.stats)==null?void 0:A.intelligence)||e.spouse.intelligence]}),r.jsxs("div",{style:{gridColumn:"span 3",color:"#d81b60"},children:[(R=e.spouse.spiritRoot)==null?void 0:R.type," ",(O=($=e.spouse.spiritRoot)==null?void 0:$.elements)==null?void 0:O.join(", ")]})]})]}):r.jsxs("div",{style:{color:"#999",fontSize:"12px",textAlign:"center",padding:"15px",background:"#f5f5f5",borderRadius:"8px"},children:["",r.jsx("br",{}),r.jsx("button",{style:be.marryBtn,onClick:()=>{console.log("Marriage button clicked for child:",e.name,"id:",e.id),n("MARRY")},children:" "})]})]}),r.jsxs("div",{style:be.section,children:[r.jsx("h4",{style:be.secTitle,children:" "}),x?r.jsxs(r.Fragment,{children:[r.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"10px",marginBottom:"10px"},children:[r.jsx("strong",{style:{fontSize:"16px"},children:e.spiritRoot.type}),r.jsx("div",{style:{display:"flex",gap:"4px"},children:e.spiritRoot.elements.map(q=>r.jsx("span",{style:{...be.elBadge,background:p(q)},children:q},q))})]}),r.jsxs("div",{style:be.barContainer,children:[r.jsxs("span",{children:[" (",S,")"]}),r.jsx("div",{style:be.barBg,children:r.jsx("div",{style:{...be.barFill,width:`${C}%`,background:w.color}})})]}),r.jsx("p",{style:{fontSize:"12px",color:"#666",marginTop:"5px"},children:e.spiritRoot.desc})]}):r.jsx("p",{style:{color:"#999",fontStyle:"italic"},children:"6"})]}),r.jsxs("div",{style:be.section,children:[r.jsx("h4",{style:be.secTitle,children:" "}),r.jsx("div",{style:be.equipGrid,children:["weapon","armor","accessory"].map(q=>{var ve;const ie=(ve=e.equipment)==null?void 0:ve[q],Z={weapon:"",armor:"",accessory:""};return r.jsxs("div",{style:be.equipSlot,children:[r.jsx("div",{style:{fontWeight:"bold"},children:Z[q]}),r.jsx("div",{style:{fontSize:"12px",color:"#555",minHeight:"18px"},children:ie?ie.name:""}),r.jsxs("div",{style:{display:"flex",gap:"6px"},children:[r.jsx("button",{style:be.smallBtn,onClick:()=>n("OPEN_INVENTORY",{mode:"SELECT",slot:q}),children:""}),ie&&r.jsx("button",{style:be.smallBtn,onClick:()=>n("UNEQUIP",{slot:q}),children:""})]})]},q)})}),r.jsxs("div",{style:{marginTop:"8px",textAlign:"right"},children:[r.jsx("button",{style:be.smallBtn,onClick:()=>n("OPEN_INVENTORY",{mode:"VIEW"}),children:" "}),r.jsx(a5,{child:e,onChangeManual:q=>n("CHANGE_MANUAL",q)})]})]}),r.jsxs("div",{style:be.section,children:[r.jsx("h4",{style:be.secTitle,children:" "}),r.jsxs("div",{style:be.traitGrid,children:[r.jsxs("div",{style:be.traitRow,children:[r.jsx("span",{style:be.label,children:":"}),r.jsx(Zl,{trait:Xl(((Q=e.stats)==null?void 0:Q.looks)||50,"LOOKS",e.gender),showValue:!0})]}),r.jsxs("div",{style:be.traitRow,children:[r.jsx("span",{style:be.label,children:":"}),r.jsx(Zl,{trait:Xl(((L=e.stats)==null?void 0:L.intelligence)||50,"INT"),showValue:!0})]}),r.jsxs("div",{style:be.traitRow,children:[r.jsx("span",{style:be.label,children:":"}),r.jsx("div",{style:{flex:1,height:"8px",background:"#eee",borderRadius:"4px",overflow:"hidden"},children:r.jsx("div",{style:{height:"100%",width:`${S}%`,background:S>=90?"#d50000":S>=80?"#aa00ff":"#4caf50"}})}),r.jsx("span",{style:{fontSize:"12px",marginLeft:"5px"},children:S})]})]})]}),r.jsxs("div",{style:be.section,children:[r.jsx("h4",{style:be.secTitle,children:" "}),r.jsxs("div",{style:be.combatGrid,children:[r.jsxs("div",{style:be.statItem,children:[r.jsx("span",{style:{color:"#d32f2f"},children:""}),r.jsx("strong",{children:((G=e.combatStats)==null?void 0:G.hp)||100})]}),r.jsxs("div",{style:be.statItem,children:[r.jsx("span",{style:{color:"#1976d2"},children:""}),r.jsx("strong",{children:((ne=e.combatStats)==null?void 0:ne.mp)||0})]}),r.jsxs("div",{style:be.statItem,children:[r.jsx("span",{style:{color:"#f57c00"},children:""}),r.jsx("strong",{children:((ae=e.combatStats)==null?void 0:ae.atk)||5})]})]})]}),((Y=e.stats)==null?void 0:Y.lifespan)&&r.jsxs("div",{style:be.section,children:[r.jsx("h4",{style:be.secTitle,children:" "}),r.jsxs("div",{style:{fontSize:"12px",color:"#666",lineHeight:"1.6"},children:[r.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:"4px"},children:[r.jsx("span",{children:":"}),r.jsxs("span",{style:{fontWeight:"bold"},children:[Math.floor(e.age||0)," "]})]}),r.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:"4px"},children:[r.jsx("span",{children:":"}),r.jsxs("span",{style:{fontWeight:"bold"},children:[Math.floor(e.stats.lifespan)," "]})]}),r.jsxs("div",{style:{display:"flex",justifyContent:"space-between"},children:[r.jsx("span",{children:":"}),r.jsxs("span",{style:{fontWeight:"bold",color:(()=>{const q=vr(e);return q<10?"#f44336":q<30?"#ff9800":"#4caf50"})()},children:[Math.floor(vr(e))," "]})]}),vr(e)<10&&r.jsx("div",{style:{marginTop:"8px",padding:"8px",background:"rgba(244, 67, 54, 0.1)",borderRadius:"4px",color:"#f44336",fontSize:"11px"},children:" "})]})]}),e.tierTitle&&r.jsxs("div",{style:be.section,children:[r.jsx("h4",{style:be.secTitle,children:" "}),r.jsxs("div",{style:{fontSize:"12px",marginBottom:"8px"},children:[r.jsx("span",{style:{color:"#666"},children:": "}),r.jsx("span",{style:{fontWeight:"bold",color:"#9c27b0"},children:e.tierTitle||""})]}),e.currentExp!==void 0&&e.maxExp&&r.jsxs("div",{children:[r.jsxs("div",{style:{marginBottom:"4px"},children:[r.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",marginBottom:"4px"},children:[r.jsx("span",{style:{fontSize:"11px",color:"#666"},children:""}),r.jsxs("span",{style:{fontSize:"11px",color:"#666",fontWeight:"bold"},children:[b,"%"]})]}),r.jsx("div",{style:{width:"100%",height:"14px",background:"linear-gradient(to right, #f0f0f0, #e0e0e0)",borderRadius:"7px",overflow:"hidden",position:"relative",boxShadow:"inset 0 2px 4px rgba(0,0,0,0.1)"},children:r.jsx("div",{style:{width:`${b}%`,height:"100%",background:"linear-gradient(90deg, #9c27b0 0%, #d05ce3 100%)",borderRadius:"7px",transition:"width 0.3s ease",boxShadow:"0 0 10px rgba(156, 39, 176, 0.5)",position:"relative",overflow:"hidden"},children:r.jsx("div",{style:{position:"absolute",top:0,left:"-100%",width:"100%",height:"100%",background:"linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent)",animation:"shimmer 2s infinite"}})})})]}),E(h,g,""),e.cultivationSpeed&&r.jsxs("div",{style:{marginTop:"8px",padding:"6px 10px",background:"rgba(156, 39, 176, 0.05)",borderRadius:"6px",border:"1px solid rgba(156, 39, 176, 0.1)"},children:[r.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"4px"},children:[r.jsx("span",{style:{fontSize:"11px",color:"#666"},children:":"}),r.jsxs("span",{style:{fontSize:"11px",fontWeight:"bold",color:"#9c27b0"},children:[Math.floor(e.cultivationSpeed)," /"]})]}),(()=>{const q=Math.max(0,g-h),ie=Math.ceil(q/e.cultivationSpeed);return r.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[r.jsx("span",{style:{fontSize:"11px",color:"#666"},children:":"}),r.jsx("span",{style:{fontSize:"11px",fontWeight:"bold",color:ie>12?"#ff9800":"#4caf50"},children:ie>12?`${Math.floor(ie/12)}`:`${ie}`})]})})()]})]})]}),r.jsxs("div",{style:be.section,children:[r.jsx("h4",{style:be.secTitle,children:" "}),e.sect?r.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[r.jsxs("div",{children:[r.jsx("div",{style:{fontWeight:"bold",color:"#00695c"},children:e.sect.name}),r.jsx("div",{style:{fontSize:"12px"},children:e.rank})]}),r.jsx("div",{style:{textAlign:"right",fontSize:"12px"},children:r.jsxs("div",{children:[": ",Math.floor(e.age*12)>=192?"":""]})})]}):r.jsxs("div",{children:[r.jsx("p",{style:{color:"#666",fontSize:"12px",marginBottom:"8px"},children:" / "}),Math.floor(e.age*12)>=144&&e.isTested&&r.jsxs("div",{style:{display:"flex",gap:"8px",alignItems:"center"},children:[r.jsx("button",{style:be.smallBtn,onClick:()=>n("SELECT_SECT"),children:" "}),r.jsxs("label",{style:{display:"flex",alignItems:"center",gap:8,fontSize:12,color:"#555"},children:[r.jsx("input",{type:"checkbox",checked:!!e.autoJoinBestSect,onChange:q=>n("TOGGLE_AUTO_JOIN_SECT",q.target.checked)}),""]})]})]})]}),r.jsxs("div",{style:{...be.actionArea,gridTemplateColumns:"1fr 1fr 1fr"},children:[r.jsxs("button",{onClick:()=>n("CHAT"),style:{...be.actionBtn,background:"#7e57c2"},children:[" ",r.jsx("br",{}),r.jsx("small",{style:{fontSize:"10px",opacity:.8},children:""})]}),r.jsxs("button",{onClick:()=>{window.showConfirm&&window.showConfirm(` ${e.name} `,()=>n("EXPEL"))},style:{...be.actionBtn,background:"#d32f2f"},children:[" ",r.jsx("br",{}),r.jsx("small",{style:{fontSize:"10px",opacity:.9},children:""})]})]})]})})]})]})})},be={overlay:{position:"fixed",top:0,left:0,right:0,bottom:0,background:"rgba(0,0,0,0.6)",display:"flex",justifyContent:"center",alignItems:"center",zIndex:1e3},modalWrapper:{position:"relative",width:"min(600px, calc(100vw - 32px))"},modal:{width:"100%",height:"600px",background:"#fff",borderRadius:"12px",overflow:"hidden",position:"relative",boxShadow:"0 10px 25px rgba(0,0,0,0.2)",display:"flex",flexDirection:"column"},closeBtn:{position:"absolute",top:"-18px",left:"-18px",border:"none",background:"#ffffff",fontSize:"22px",cursor:"pointer",color:"#888",width:"44px",height:"44px",display:"flex",alignItems:"center",justifyContent:"center",borderRadius:"22px",boxShadow:"0 12px 30px rgba(0,0,0,0.25)"},content:{flex:1,height:"100%",overflow:"hidden"},navBar:{flex:"0 0 auto",padding:"12px 20px",borderBottom:"1px solid #f0f0f0",background:"#fafafa",display:"flex",alignItems:"center",justifyContent:"space-between"},navBtn:{border:"none",background:"transparent",cursor:"pointer",color:"#333",fontSize:"13px",display:"flex",alignItems:"center",gap:"6px",padding:"6px 10px",borderRadius:"6px"},navBtnDisabled:{color:"#bbb",cursor:"not-allowed"},navLabel:{fontSize:"12px",color:"#666",fontWeight:"bold"},singleCol:{width:"100%",padding:"25px 25px 90px 25px",overflowY:"auto",height:"100%",boxSizing:"border-box"},nameBox:{textAlign:"left"},editIcon:{fontSize:"12px",cursor:"pointer",marginLeft:"5px",opacity:.5},input:{width:"120px",padding:"5px",borderRadius:"4px",border:"1px solid #ccc"},smallBtn:{padding:"5px 10px",cursor:"pointer",borderRadius:"4px",border:"1px solid #ccc",backgroundColor:"#f5f5f5"},tierBadge:{fontSize:"12px",background:"#3e2723",color:"#fff",padding:"2px 8px",borderRadius:"10px",marginTop:"5px",display:"inline-block"},traitBox:{padding:"10px",background:"#fff",border:"1px solid",borderRadius:"8px",textAlign:"center",display:"inline-block"},influencePanel:{marginTop:"10px",padding:"12px",borderRadius:"10px",background:"linear-gradient(135deg, rgba(255,255,255,0.8), rgba(240,240,240,0.9))",border:"1px solid #e0e0e0"},influenceHeader:{fontWeight:"bold",fontSize:"16px",display:"flex",justifyContent:"space-between",alignItems:"center"},influenceScore:{fontSize:"18px"},influenceTagline:{fontSize:"11px",margin:"4px 0",color:"#666"},influenceProgress:{height:"8px",borderRadius:"999px",background:"#e0e0e0",overflow:"hidden"},influenceProgressFill:{height:"100%"},influenceFooter:{marginTop:"4px",fontSize:"11px",color:"#888"},spouseCard:{background:"#fff8e1",padding:"15px",borderRadius:"8px",border:"1px solid #ffecb3",boxShadow:"0 2px 4px rgba(0,0,0,0.05)"},miniAvatar:{fontSize:"24px",width:"40px",height:"40px",borderRadius:"50%",background:"#fff",display:"flex",alignItems:"center",justifyContent:"center",boxShadow:"0 1px 3px rgba(0,0,0,0.1)"},marryBtn:{marginTop:"10px",padding:"5px 15px",fontSize:"12px",cursor:"pointer",borderRadius:"15px",border:"1px solid #e91e63",backgroundColor:"#fff",color:"#e91e63",transition:"all 0.2s",":hover":{backgroundColor:"#fce4ec",transform:"translateY(-1px)"}},section:{marginBottom:"25px"},secTitle:{margin:"0 0 15px 0",fontSize:"14px",color:"#333",borderBottom:"1px dashed #ccc",paddingBottom:"8px"},elBadge:{padding:"2px 6px",borderRadius:"4px",color:"#fff",fontSize:"10px",fontWeight:"bold"},barContainer:{display:"flex",alignItems:"center",gap:"10px",fontSize:"12px",marginBottom:"10px"},barBg:{flex:1,height:"8px",background:"#eee",borderRadius:"4px"},barFill:{height:"100%",borderRadius:"4px"},combatGrid:{display:"grid",gridTemplateColumns:"1fr 1fr 1fr",gap:"10px",textAlign:"center"},statItem:{background:"#fafafa",padding:"10px",borderRadius:"8px",display:"flex",flexDirection:"column",gap:"5px"},actionArea:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"10px",marginTop:"20px"},actionBtn:{padding:"12px",border:"none",borderRadius:"8px",background:"#ff9800",color:"white",cursor:"pointer",textAlign:"center",fontSize:"14px",transition:"all 0.2s",":hover":{transform:"translateY(-1px)",boxShadow:"0 4px 8px rgba(0,0,0,0.15)"}},traitGrid:{display:"flex",flexDirection:"column",gap:"15px"},traitRow:{display:"flex",alignItems:"center",gap:"10px"},label:{width:"60px",fontSize:"13px",color:"#555",fontWeight:"bold"},equipGrid:{display:"grid",gridTemplateColumns:"1fr 1fr 1fr",gap:"10px"},equipSlot:{border:"1px dashed #ccc",borderRadius:"8px",padding:"10px",background:"#fafafa",textAlign:"center"},fractionWrapper:{display:"flex",flexDirection:"column",alignItems:"flex-end",marginTop:"6px",color:"#4a148c"},fractionCaption:{fontSize:"11px",color:"#777",marginBottom:"2px"},fractionBox:{display:"flex",flexDirection:"column",alignItems:"center",minWidth:"60px",lineHeight:1.2},fractionNumerator:{fontWeight:"bold",fontSize:"15px"},fractionDivider:{width:"100%",borderBottom:"1px solid rgba(0,0,0,0.2)",margin:"2px 0"},fractionDenominator:{fontWeight:"bold",fontSize:"13px"}},c5=({child:e,candidates:t,onSelect:n,onClose:s})=>{if(!t||t.length===0)return null;const o=a=>{switch(a){case"talented":return" ";case"beautiful":return" ";case"wise":return" ";case"buddha":return" ";default:return" "}},i=a=>{switch(a){case"talented":return"";case"beautiful":return"";case"wise":return"";case"buddha":return"";default:return""}};return r.jsx("div",{style:Ve.overlay,children:r.jsxs("div",{style:Ve.modalWrapper,children:[r.jsx("button",{style:Ve.closeBtn,onClick:s,"aria-label":"",children:""}),r.jsxs("div",{style:Ve.modal,children:[r.jsx("div",{style:Ve.header,children:r.jsxs("h2",{style:Ve.title,children:["  ",e.name," "]})}),r.jsxs("div",{style:Ve.subtitle,children:[" ",e.name," "]}),r.jsx("div",{style:Ve.candidatesContainer,children:t.map((a,l)=>{var d,p,f;return r.jsxs("div",{style:Ve.candidateCard,children:[r.jsx("div",{style:Ve.cardHeader,children:r.jsx("div",{style:Ve.archetypeBadge,children:o(a.archetype)})}),r.jsxs("div",{style:Ve.avatarSection,children:[r.jsx(Cr,{avatar:a.avatar,gender:a.gender,size:80}),r.jsxs("div",{style:Ve.nameSection,children:[r.jsx("div",{style:Ve.candidateName,children:a.name}),r.jsx("div",{style:Ve.candidateGender,children:a.gender===""?" ":" "}),a.identity&&r.jsx("div",{style:Ve.identity,children:a.identity})]})]}),r.jsx("div",{style:Ve.archetypeDesc,children:i(a.archetype)}),r.jsxs("div",{style:Ve.statsSection,children:[r.jsxs("div",{style:Ve.statRow,children:[r.jsx("span",{style:Ve.statLabel,children:""}),r.jsx("span",{style:{...Ve.statValue,color:a.stats.aptitude>=80?"#ff4081":a.stats.aptitude>=60?"#9c27b0":"#666"},children:a.stats.aptitude})]}),r.jsxs("div",{style:Ve.statRow,children:[r.jsx("span",{style:Ve.statLabel,children:""}),r.jsx("span",{style:{...Ve.statValue,color:a.stats.looks>=80?"#ff4081":a.stats.looks>=60?"#9c27b0":"#666"},children:a.stats.looks})]}),r.jsxs("div",{style:Ve.statRow,children:[r.jsx("span",{style:Ve.statLabel,children:""}),r.jsx("span",{style:{...Ve.statValue,color:a.stats.intelligence>=80?"#ff4081":a.stats.intelligence>=60?"#9c27b0":"#666"},children:a.stats.intelligence})]})]}),r.jsxs("div",{style:Ve.spiritRootSection,children:[r.jsx("div",{style:Ve.spiritRootLabel,children:""}),r.jsxs("div",{style:Ve.spiritRootValue,children:[(d=a.spiritRoot)==null?void 0:d.type,((f=(p=a.spiritRoot)==null?void 0:p.elements)==null?void 0:f.length)>0&&` (${a.spiritRoot.elements.join("")})`]})]}),r.jsxs("div",{style:Ve.cultivationSection,children:[r.jsx("div",{style:Ve.tierLabel,children:a.tierTitle}),r.jsxs("div",{style:Ve.cultivationValue,children:[": ",a.cultivation]})]}),r.jsxs("button",{style:Ve.selectBtn,onClick:()=>n(a),onMouseEnter:c=>c.target.style.background="#d81b60",onMouseLeave:c=>c.target.style.background="#e91e63",children:[" ",a.name]})]},a.id)})}),r.jsxs("div",{style:Ve.footer,children:[r.jsx("div",{style:Ve.costInfo,children:" 500 "}),r.jsx("button",{style:Ve.cancelBtn,onClick:s,children:""})]})]})]})})},Ve={overlay:{position:"fixed",top:0,left:0,right:0,bottom:0,background:"rgba(0, 0, 0, 0.7)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:2e3,padding:"20px"},modalWrapper:{position:"relative",width:"min(1100px, calc(100vw - 40px))"},modal:{background:"linear-gradient(135deg, #fff8e1 0%, #ffe0b2 100%)",borderRadius:"16px",maxWidth:"1100px",width:"100%",maxHeight:"90vh",overflow:"auto",boxShadow:"0 8px 32px rgba(0,0,0,0.3)",border:"2px solid #ffb74d",position:"relative"},header:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"20px 24px",borderBottom:"2px solid #ffb74d",background:"linear-gradient(90deg, #ffe0b2, #ffcc80)"},title:{margin:0,fontSize:"24px",color:"#d84315",fontWeight:"bold"},closeBtn:{position:"absolute",top:"-18px",left:"-18px",background:"#fff",border:"2px solid rgba(0,0,0,0.08)",fontSize:"20px",cursor:"pointer",color:"#bf360c",width:"44px",height:"44px",display:"flex",alignItems:"center",justifyContent:"center",borderRadius:"50%",boxShadow:"0 10px 24px rgba(0,0,0,0.2)",zIndex:5},subtitle:{padding:"16px 24px",fontSize:"16px",color:"#5d4037",textAlign:"center",background:"#fff3e0"},candidatesContainer:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(300px, 1fr))",gap:"20px",padding:"24px"},candidateCard:{background:"white",borderRadius:"12px",padding:"20px",border:"2px solid #ffb74d",boxShadow:"0 4px 12px rgba(0,0,0,0.1)",display:"flex",flexDirection:"column",transition:"transform 0.2s, box-shadow 0.2s",cursor:"pointer"},cardHeader:{marginBottom:"12px",display:"flex",justifyContent:"center"},archetypeBadge:{background:"linear-gradient(135deg, #e91e63, #f06292)",color:"white",padding:"6px 16px",borderRadius:"20px",fontSize:"14px",fontWeight:"bold",textAlign:"center"},avatarSection:{display:"flex",alignItems:"center",gap:"16px",marginBottom:"12px",paddingBottom:"12px",borderBottom:"1px solid #ffe0b2"},nameSection:{flex:1},candidateName:{fontSize:"20px",fontWeight:"bold",color:"#d84315",marginBottom:"4px"},candidateGender:{fontSize:"14px",color:"#666",marginBottom:"4px"},identity:{fontSize:"12px",color:"#ff6f00",fontWeight:"bold",background:"#fff3e0",padding:"2px 8px",borderRadius:"4px",display:"inline-block"},archetypeDesc:{fontSize:"13px",color:"#795548",fontStyle:"italic",marginBottom:"16px",textAlign:"center",padding:"8px",background:"#fff8e1",borderRadius:"6px"},statsSection:{display:"flex",flexDirection:"column",gap:"8px",marginBottom:"12px",padding:"12px",background:"#fafafa",borderRadius:"8px"},statRow:{display:"flex",justifyContent:"space-between",alignItems:"center"},statLabel:{fontSize:"14px",color:"#666",fontWeight:"500"},statValue:{fontSize:"16px",fontWeight:"bold"},spiritRootSection:{marginBottom:"12px",padding:"10px",background:"#e3f2fd",borderRadius:"6px",border:"1px solid #90caf9"},spiritRootLabel:{fontSize:"12px",color:"#1565c0",marginBottom:"4px"},spiritRootValue:{fontSize:"14px",color:"#0d47a1",fontWeight:"bold"},cultivationSection:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"16px",padding:"10px",background:"#f3e5f5",borderRadius:"6px"},tierLabel:{fontSize:"14px",color:"#6a1b9a",fontWeight:"bold"},cultivationValue:{fontSize:"13px",color:"#4a148c"},selectBtn:{background:"#e91e63",color:"white",border:"none",padding:"12px",borderRadius:"8px",fontSize:"16px",fontWeight:"bold",cursor:"pointer",transition:"background 0.2s",boxShadow:"0 2px 8px rgba(233, 30, 99, 0.3)"},footer:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"16px 24px",borderTop:"2px solid #ffb74d",background:"#fff3e0"},costInfo:{fontSize:"16px",color:"#d84315",fontWeight:"bold"},cancelBtn:{background:"#9e9e9e",color:"white",border:"none",padding:"10px 24px",borderRadius:"6px",fontSize:"14px",cursor:"pointer",transition:"background 0.2s"}},d5=({giftEvents:e,onConfirm:t,onClose:n})=>{const[s,o]=y.useState(new Set),i=f=>{const c=new Set(s);c.has(f)?c.delete(f):c.add(f),o(c)},a=()=>{s.size===e.length?o(new Set):o(new Set(e.map(f=>f.npcId)))},l=()=>{const f=e.filter(c=>s.has(c.npcId));t(f)},d=f=>Xp(f)||{name:"",rarity:"common"},p={common:"#9e9e9e",uncommon:"#4caf50",rare:"#2196f3",epic:"#9c27b0",legendary:"#ff9800"};return r.jsx("div",{style:yt.overlay,children:r.jsxs("div",{style:yt.modal,children:[r.jsxs("div",{style:yt.header,children:[r.jsxs("h3",{style:yt.title,children:[" ",e.length,""]}),r.jsx("button",{onClick:n,style:yt.closeIcon,children:""})]}),r.jsx("div",{style:yt.subtitle,children:""}),r.jsxs("div",{style:yt.toolbar,children:[r.jsx("button",{onClick:a,style:yt.selectAllBtn,children:s.size===e.length?" ":""}),r.jsxs("div",{style:yt.selectionInfo,children:[" ",s.size," / ",e.length]})]}),r.jsx("div",{style:yt.giftList,children:e.map((f,c)=>{const u=d(f.giftItemId),x=s.has(f.npcId);return r.jsxs("div",{style:{...yt.giftCard,borderColor:x?"#4caf50":"#e0e0e0",background:x?"#f1f8f4":"#fff"},onClick:()=>i(f.npcId),children:[r.jsx("div",{style:yt.checkbox,children:r.jsx("input",{type:"checkbox",checked:x,onChange:()=>i(f.npcId),style:yt.checkboxInput})}),r.jsxs("div",{style:yt.cardContent,children:[r.jsxs("div",{style:yt.giftHeader,children:[r.jsx("span",{style:yt.npcName,children:f.npcName}),r.jsx("span",{style:{...yt.itemName,color:p[u.rarity]||"#666"},children:u.name})]}),r.jsx("div",{style:yt.message,children:f.message}),u.desc&&r.jsxs("div",{style:yt.itemDesc,children:[" ",u.desc]}),u.stats&&r.jsxs("div",{style:yt.itemStats,children:[u.stats.atk&&r.jsxs("span",{children:["+",u.stats.atk]}),u.stats.hp&&r.jsxs("span",{children:["+",u.stats.hp]}),u.stats.def&&r.jsxs("span",{children:["+",u.stats.def]})]}),u.effect&&r.jsxs("div",{style:yt.itemEffect,children:[" ",typeof u.effect=="object"?`${u.effect.kind==="heal"?"":u.effect.kind==="exp"?"":u.effect.kind==="aptitude"?"":""} +${u.effect.amount}`:u.effect]})]})]},f.npcId||c)})}),r.jsxs("div",{style:yt.footer,children:[r.jsxs("button",{style:yt.confirmBtn,onClick:l,disabled:s.size===0,children:[" (",s.size,")"]}),r.jsx("button",{style:yt.cancelBtn,onClick:n,children:""})]})]})})},yt={overlay:{position:"fixed",top:0,left:0,right:0,bottom:0,background:"rgba(0, 0, 0, 0.75)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:3e3,padding:"20px"},modal:{background:"linear-gradient(135deg, #fff 0%, #f5f5f5 100%)",borderRadius:"16px",width:"90%",maxWidth:"800px",maxHeight:"85vh",display:"flex",flexDirection:"column",boxShadow:"0 10px 40px rgba(0,0,0,0.3)",overflow:"hidden"},header:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"20px 24px",borderBottom:"2px solid #e91e63",background:"linear-gradient(90deg, #fce4ec, #f8bbd0)",flexShrink:0},title:{margin:0,fontSize:"22px",color:"#c2185b",fontWeight:"bold"},closeIcon:{background:"none",border:"none",fontSize:"28px",cursor:"pointer",color:"#c2185b",padding:"0",lineHeight:"1"},subtitle:{padding:"16px 24px",fontSize:"14px",color:"#666",borderBottom:"1px solid #e0e0e0",flexShrink:0},toolbar:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"12px 24px",background:"#fafafa",borderBottom:"1px solid #e0e0e0",flexShrink:0},selectAllBtn:{padding:"6px 16px",background:"#e0e0e0",border:"none",borderRadius:"6px",cursor:"pointer",fontSize:"13px",transition:"all 0.2s"},selectionInfo:{fontSize:"13px",color:"#666"},giftList:{flex:1,overflowY:"auto",padding:"16px 24px",display:"flex",flexDirection:"column",gap:"12px"},giftCard:{display:"flex",gap:"12px",padding:"16px",border:"2px solid #e0e0e0",borderRadius:"12px",cursor:"pointer",transition:"all 0.2s",background:"#fff"},checkbox:{flexShrink:0,display:"flex",alignItems:"flex-start",paddingTop:"2px"},checkboxInput:{width:"18px",height:"18px",cursor:"pointer"},cardContent:{flex:1,display:"flex",flexDirection:"column",gap:"8px"},giftHeader:{display:"flex",justifyContent:"space-between",alignItems:"center",gap:"12px"},npcName:{fontSize:"16px",fontWeight:"bold",color:"#e91e63"},itemName:{fontSize:"15px",fontWeight:"600"},message:{fontSize:"14px",color:"#444",lineHeight:"1.5",background:"#fff8e1",padding:"8px 12px",borderRadius:"8px",border:"1px solid #fff176"},itemDesc:{fontSize:"12px",color:"#666",fontStyle:"italic"},itemStats:{display:"flex",gap:"12px",fontSize:"12px",color:"#2196f3",fontWeight:"500"},itemEffect:{fontSize:"12px",color:"#4caf50",fontStyle:"italic"},footer:{display:"flex",gap:"12px",padding:"16px 24px",borderTop:"2px solid #e0e0e0",background:"#fafafa",flexShrink:0},confirmBtn:{flex:1,padding:"12px",background:"#4caf50",color:"#fff",border:"none",borderRadius:"8px",cursor:"pointer",fontSize:"15px",fontWeight:"bold",transition:"all 0.2s"},cancelBtn:{padding:"12px 24px",background:"#e0e0e0",border:"none",borderRadius:"8px",cursor:"pointer",fontSize:"15px"}},u5=({promotionEvents:e,onConfirm:t,onClose:n})=>{const[s,o]=y.useState(new Set(e.map(c=>c.child.id))),i=c=>{const u=new Set(s);u.has(c)?u.delete(c):u.add(c),o(u)},a=()=>{s.size===e.length?o(new Set):o(new Set(e.map(c=>c.child.id)))},l=()=>{const c=e.filter(u=>s.has(u.child.id));t(c)},d=c=>Xp(c)||{name:"",rarity:"common"},p={common:"#9e9e9e",uncommon:"#4caf50",rare:"#2196f3",epic:"#9c27b0",legendary:"#ff9800"},f={:"#9e9e9e",:"#4caf50",:"#2196f3",:"#9c27b0",:"#ff9800"};return r.jsx("div",{style:Ue.overlay,children:r.jsxs("div",{style:Ue.modal,children:[r.jsxs("div",{style:Ue.header,children:[r.jsx("h3",{style:Ue.title,children:" "}),r.jsx("button",{onClick:n,style:Ue.closeIcon,children:""})]}),r.jsxs("div",{style:Ue.subtitle,children:["",e.length," "]}),r.jsxs("div",{style:Ue.toolbar,children:[r.jsx("button",{onClick:a,style:Ue.selectAllBtn,children:s.size===e.length?" ":""}),r.jsxs("div",{style:Ue.selectionInfo,children:[" ",s.size," / ",e.length]})]}),r.jsx("div",{style:Ue.eventList,children:e.map(c=>{var w;const u=c.child,x=d(c.giftItemId),S=s.has(u.id);return r.jsxs("div",{style:{...Ue.eventCard,borderColor:S?"#4caf50":"#e0e0e0",background:S?"#f1f8f4":"#fff"},onClick:()=>i(u.id),children:[r.jsx("div",{style:Ue.checkbox,children:r.jsx("input",{type:"checkbox",checked:S,onChange:()=>i(u.id),style:Ue.checkboxInput})}),r.jsxs("div",{style:Ue.cardContent,children:[r.jsxs("div",{style:Ue.promotionHeader,children:[r.jsxs("div",{style:Ue.childInfo,children:[r.jsx("span",{style:Ue.childName,children:u.name}),r.jsx("span",{style:Ue.childGender,children:u.gender===""?"":""})]}),r.jsxs("div",{style:Ue.promotionBadge,children:[r.jsx("span",{style:Ue.promotionLabel,children:""}),r.jsx("span",{style:{...Ue.rankBadge,background:f[c.rank]||"#666"},children:c.rank})]})]}),r.jsxs("div",{style:Ue.sectInfo,children:[r.jsx("span",{style:Ue.sectIcon,children:""}),r.jsx("span",{style:Ue.sectName,children:((w=c.sect)==null?void 0:w.name)||""})]}),r.jsxs("div",{style:Ue.giftSection,children:[r.jsxs("div",{style:Ue.giftHeader,children:[r.jsx("span",{style:Ue.giftLabel,children:""}),r.jsx("span",{style:{...Ue.giftName,color:p[x.rarity]||"#666"},children:x.name})]}),x.desc&&r.jsx("div",{style:Ue.giftDesc,children:x.desc}),x.stats&&r.jsxs("div",{style:Ue.giftStats,children:[x.stats.atk&&r.jsxs("span",{style:Ue.statBadge,children:[" +",x.stats.atk]}),x.stats.hp&&r.jsxs("span",{style:Ue.statBadge,children:[" +",x.stats.hp]}),x.stats.def&&r.jsxs("span",{style:Ue.statBadge,children:[" +",x.stats.def]})]}),x.effect&&r.jsxs("div",{style:Ue.giftEffect,children:[" ",x.effect]})]}),r.jsx("div",{style:Ue.message,children:c.message})]})]},u.id)})}),r.jsxs("div",{style:Ue.footer,children:[r.jsxs("button",{style:Ue.confirmBtn,onClick:l,disabled:s.size===0,children:[" (",s.size,")"]}),r.jsx("button",{style:Ue.cancelBtn,onClick:n,children:""})]})]})})},Ue={overlay:{position:"fixed",top:0,left:0,right:0,bottom:0,background:"rgba(0, 0, 0, 0.75)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:3e3,padding:"20px"},modal:{background:"linear-gradient(135deg, #fff9c4 0%, #fff59d 100%)",borderRadius:"16px",width:"90%",maxWidth:"850px",maxHeight:"85vh",display:"flex",flexDirection:"column",boxShadow:"0 10px 40px rgba(0,0,0,0.3)",overflow:"hidden",border:"2px solid #fdd835"},header:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"20px 24px",borderBottom:"2px solid #fdd835",background:"linear-gradient(90deg, #fff9c4, #fff176)",flexShrink:0},title:{margin:0,fontSize:"22px",color:"#f57f17",fontWeight:"bold"},closeIcon:{background:"none",border:"none",fontSize:"28px",cursor:"pointer",color:"#f57f17",padding:"0",lineHeight:"1"},subtitle:{padding:"16px 24px",fontSize:"14px",color:"#666",borderBottom:"1px solid #fdd835",flexShrink:0},toolbar:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"12px 24px",background:"#fffde7",borderBottom:"1px solid #e0e0e0",flexShrink:0},selectAllBtn:{padding:"6px 16px",background:"#fdd835",color:"#333",border:"none",borderRadius:"6px",cursor:"pointer",fontSize:"13px",fontWeight:"500"},selectionInfo:{fontSize:"13px",color:"#666"},eventList:{flex:1,overflowY:"auto",padding:"16px 24px",display:"flex",flexDirection:"column",gap:"16px"},eventCard:{display:"flex",gap:"12px",padding:"16px",border:"2px solid #e0e0e0",borderRadius:"12px",cursor:"pointer",transition:"all 0.2s",background:"#fff"},checkbox:{flexShrink:0,display:"flex",alignItems:"flex-start",paddingTop:"4px"},checkboxInput:{width:"18px",height:"18px",cursor:"pointer"},cardContent:{flex:1,display:"flex",flexDirection:"column",gap:"12px"},promotionHeader:{display:"flex",justifyContent:"space-between",alignItems:"center",paddingBottom:"12px",borderBottom:"1px dashed #e0e0e0"},childInfo:{display:"flex",alignItems:"center",gap:"8px"},childName:{fontSize:"18px",fontWeight:"bold",color:"#333"},childGender:{fontSize:"14px",color:"#999"},promotionBadge:{display:"flex",alignItems:"center",gap:"8px"},promotionLabel:{fontSize:"12px",color:"#666"},rankBadge:{padding:"4px 12px",borderRadius:"12px",color:"#fff",fontSize:"13px",fontWeight:"bold"},sectInfo:{display:"flex",alignItems:"center",gap:"8px",padding:"8px 12px",background:"#e3f2fd",borderRadius:"8px"},sectIcon:{fontSize:"16px"},sectName:{fontSize:"14px",color:"#1976d2",fontWeight:"600"},giftSection:{display:"flex",flexDirection:"column",gap:"8px",padding:"12px",background:"#f3e5f5",borderRadius:"8px",border:"1px solid #ce93d8"},giftHeader:{display:"flex",alignItems:"center",gap:"8px"},giftLabel:{fontSize:"13px",color:"#666",fontWeight:"500"},giftName:{fontSize:"15px",fontWeight:"bold"},giftDesc:{fontSize:"12px",color:"#666",fontStyle:"italic"},giftStats:{display:"flex",gap:"8px",flexWrap:"wrap"},statBadge:{padding:"3px 8px",background:"#fff",borderRadius:"8px",fontSize:"11px",color:"#666",fontWeight:"500",border:"1px solid #e0e0e0"},giftEffect:{fontSize:"12px",color:"#4caf50",fontWeight:"500"},message:{fontSize:"13px",color:"#555",lineHeight:"1.5",padding:"8px 12px",background:"#fff8e1",borderRadius:"8px",border:"1px solid #fff176"},footer:{display:"flex",gap:"12px",padding:"16px 24px",borderTop:"2px solid #fdd835",background:"#fffde7",flexShrink:0},confirmBtn:{flex:1,padding:"12px",background:"#4caf50",color:"#fff",border:"none",borderRadius:"8px",cursor:"pointer",fontSize:"15px",fontWeight:"bold",transition:"all 0.2s"},cancelBtn:{padding:"12px 24px",background:"#e0e0e0",border:"none",borderRadius:"8px",cursor:"pointer",fontSize:"15px"}},p5=({marriagePlans:e,onConfirm:t,onClose:n,onModify:s})=>{const[o,i]=y.useState(new Set(e.map(c=>c.childId))),a=c=>{const u=new Set(o);u.has(c)?u.delete(c):u.add(c),i(u)},l=()=>{o.size===e.length?i(new Set):i(new Set(e.map(c=>c.childId)))},d=()=>{const c=e.filter(u=>o.has(u.childId));t(c)},p=o.size*500,f=c=>{switch(c){case"talented":return" ";case"beautiful":return" ";case"wise":return" ";case"buddha":return" ";default:return" "}};return r.jsx("div",{style:Le.overlay,children:r.jsxs("div",{style:Le.modal,children:[r.jsxs("div",{style:Le.header,children:[r.jsx("h3",{style:Le.title,children:" "}),r.jsx("button",{onClick:n,style:Le.closeIcon,children:""})]}),r.jsxs("div",{style:Le.summary,children:[r.jsxs("div",{style:Le.summaryItem,children:[r.jsx("span",{style:Le.summaryLabel,children:""}),r.jsxs("span",{style:Le.summaryValue,children:[e.length," "]})]}),r.jsxs("div",{style:Le.summaryItem,children:[r.jsx("span",{style:Le.summaryLabel,children:""}),r.jsxs("span",{style:{...Le.summaryValue,color:"#4caf50"},children:[o.size," "]})]}),r.jsxs("div",{style:Le.summaryItem,children:[r.jsx("span",{style:Le.summaryLabel,children:""}),r.jsxs("span",{style:{...Le.summaryValue,color:"#ff9800"},children:[p," "]})]})]}),r.jsxs("div",{style:Le.toolbar,children:[r.jsx("button",{onClick:l,style:Le.selectAllBtn,children:o.size===e.length?" ":""}),r.jsx("div",{style:Le.hint,children:""})]}),r.jsx("div",{style:Le.planList,children:e.map(c=>{var w,C,h,g,b,E,I,v,k,T,A,R;const u=o.has(c.childId),x=c.childRef,S=c.spouse;return r.jsxs("div",{style:{...Le.planCard,borderColor:u?"#4caf50":"#e0e0e0",background:u?"#f1f8f4":"#fff",opacity:u?1:.6},onClick:()=>a(c.childId),children:[r.jsx("div",{style:Le.checkbox,children:r.jsx("input",{type:"checkbox",checked:u,onChange:()=>a(c.childId),style:Le.checkboxInput})}),r.jsxs("div",{style:Le.cardContent,children:[r.jsxs("div",{style:Le.personSection,children:[r.jsx("div",{style:Le.avatarWrapper,children:r.jsx(Cr,{avatar:x.avatar,gender:x.gender,size:60})}),r.jsxs("div",{style:Le.personInfo,children:[r.jsx("div",{style:Le.personName,children:x.name}),r.jsxs("div",{style:Le.personDetail,children:[x.gender===""?"":""," | ",x.tierTitle||""]}),r.jsxs("div",{style:Le.stats,children:[r.jsxs("span",{style:Le.statItem,children:[" ",((w=x.stats)==null?void 0:w.aptitude)||0]}),r.jsxs("span",{style:Le.statItem,children:[" ",((C=x.stats)==null?void 0:C.looks)||0]}),r.jsxs("span",{style:Le.statItem,children:[" ",((h=x.stats)==null?void 0:h.intelligence)||0]})]})]})]}),r.jsxs("div",{style:Le.arrow,children:[r.jsx("div",{style:Le.arrowIcon,children:""}),r.jsx("div",{style:Le.arrowLine})]}),r.jsxs("div",{style:Le.personSection,children:[r.jsx("div",{style:Le.avatarWrapper,children:r.jsx(Cr,{avatar:S.avatar,gender:S.gender,size:60})}),r.jsxs("div",{style:Le.personInfo,children:[r.jsxs("div",{style:Le.personName,children:[S.name,r.jsx("span",{style:Le.archetypeBadge,children:f(S.archetype)})]}),r.jsxs("div",{style:Le.personDetail,children:[S.gender===""?"":""," | ",S.tierTitle||""]}),r.jsxs("div",{style:Le.stats,children:[r.jsxs("span",{style:{...Le.statItem,color:((g=S.stats)==null?void 0:g.aptitude)>=80?"#e91e63":"#666"},children:[" ",((b=S.stats)==null?void 0:b.aptitude)||0]}),r.jsxs("span",{style:{...Le.statItem,color:((E=S.stats)==null?void 0:E.looks)>=80?"#e91e63":"#666"},children:[" ",((I=S.stats)==null?void 0:I.looks)||0]}),r.jsxs("span",{style:{...Le.statItem,color:((v=S.stats)==null?void 0:v.intelligence)>=80?"#e91e63":"#666"},children:[" ",((k=S.stats)==null?void 0:k.intelligence)||0]})]})]})]}),r.jsx("div",{style:Le.spiritRootSection,children:r.jsxs("div",{style:Le.spiritRoot,children:["",((T=S.spiritRoot)==null?void 0:T.type)||"",((R=(A=S.spiritRoot)==null?void 0:A.elements)==null?void 0:R.length)>0&&` (${S.spiritRoot.elements.join("")})`]})})]})]},c.childId)})}),r.jsxs("div",{style:Le.footer,children:[r.jsxs("button",{style:Le.confirmBtn,onClick:d,disabled:o.size===0,children:[" (",o.size,"   ",p," )"]}),r.jsx("button",{style:Le.cancelBtn,onClick:n,children:""})]})]})})},Le={overlay:{position:"fixed",top:0,left:0,right:0,bottom:0,background:"rgba(0, 0, 0, 0.75)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:3e3,padding:"20px"},modal:{background:"linear-gradient(135deg, #fff8e1 0%, #ffe0b2 100%)",borderRadius:"16px",width:"90%",maxWidth:"1000px",maxHeight:"85vh",display:"flex",flexDirection:"column",boxShadow:"0 10px 40px rgba(0,0,0,0.3)",overflow:"hidden",border:"2px solid #ffb74d"},header:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"20px 24px",borderBottom:"2px solid #ffb74d",background:"linear-gradient(90deg, #ffe0b2, #ffcc80)",flexShrink:0},title:{margin:0,fontSize:"22px",color:"#d84315",fontWeight:"bold"},closeIcon:{background:"none",border:"none",fontSize:"28px",cursor:"pointer",color:"#d84315",padding:"0",lineHeight:"1"},summary:{display:"flex",justifyContent:"space-around",padding:"16px 24px",background:"#fff8e1",borderBottom:"1px solid #ffb74d",flexShrink:0},summaryItem:{display:"flex",flexDirection:"column",alignItems:"center",gap:"4px"},summaryLabel:{fontSize:"12px",color:"#666"},summaryValue:{fontSize:"16px",fontWeight:"bold",color:"#d84315"},toolbar:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"12px 24px",background:"#fafafa",borderBottom:"1px solid #e0e0e0",flexShrink:0},selectAllBtn:{padding:"6px 16px",background:"#ff9800",color:"#fff",border:"none",borderRadius:"6px",cursor:"pointer",fontSize:"13px",fontWeight:"500"},hint:{fontSize:"12px",color:"#999",fontStyle:"italic"},planList:{flex:1,overflowY:"auto",padding:"16px 24px",display:"flex",flexDirection:"column",gap:"16px"},planCard:{display:"flex",gap:"12px",padding:"16px",border:"2px solid #e0e0e0",borderRadius:"16px",cursor:"pointer",transition:"all 0.2s",background:"#fff"},checkbox:{flexShrink:0,display:"flex",alignItems:"center"},checkboxInput:{width:"20px",height:"20px",cursor:"pointer"},cardContent:{flex:1,display:"flex",alignItems:"center",gap:"20px"},personSection:{flex:1,display:"flex",gap:"12px",alignItems:"center"},avatarWrapper:{flexShrink:0},personInfo:{flex:1,display:"flex",flexDirection:"column",gap:"6px"},personName:{fontSize:"16px",fontWeight:"bold",color:"#333",display:"flex",alignItems:"center",gap:"8px"},archetypeBadge:{fontSize:"11px",padding:"2px 8px",background:"#e91e63",color:"#fff",borderRadius:"10px",fontWeight:"500"},personDetail:{fontSize:"13px",color:"#666"},stats:{display:"flex",gap:"12px",fontSize:"12px"},statItem:{color:"#666"},arrow:{display:"flex",flexDirection:"column",alignItems:"center",gap:"4px",flexShrink:0},arrowIcon:{fontSize:"20px"},arrowLine:{width:"2px",height:"40px",background:"linear-gradient(to bottom, #e91e63, #f06292)",borderRadius:"1px"},spiritRootSection:{width:"100%",padding:"8px 12px",background:"#fff3e0",borderRadius:"8px",fontSize:"12px",color:"#e65100",marginTop:"8px"},spiritRoot:{fontWeight:"500"},footer:{display:"flex",gap:"12px",padding:"16px 24px",borderTop:"2px solid #ffb74d",background:"#fff8e1",flexShrink:0},confirmBtn:{flex:1,padding:"12px",background:"#4caf50",color:"#fff",border:"none",borderRadius:"8px",cursor:"pointer",fontSize:"15px",fontWeight:"bold",transition:"all 0.2s"},cancelBtn:{padding:"12px 24px",background:"#e0e0e0",border:"none",borderRadius:"8px",cursor:"pointer",fontSize:"15px"}},f5=({manualItems:e,children:t,onAssign:n,onClose:s})=>{const[o,i]=y.useState([]),[a,l]=y.useState("AUTO"),p=(()=>{const C=[];return e.forEach(h=>{(h.manualIds&&h.manualIds.length?h.manualIds:h.manualId?[h.manualId]:[]).forEach(b=>{const E=on[b];E&&t.forEach(I=>{var A,R,$;if(!I||!I.spiritRoot||I.cultivationMethod===b)return;const v=sc(b,I.spiritRoot);if(!(v!=null&&v.compatibility))return;const T=(v.compatibility.compatibility||0)+(((A=I.stats)==null?void 0:A.aptitude)||0)/200;C.push({manualId:b,manualName:E.name,childId:I.id,childName:I.name,childTier:I.tierTitle||"",childAptitude:((R=I.stats)==null?void 0:R.aptitude)||0,currentManual:I.cultivationMethod,currentManualName:(($=on[I.cultivationMethod])==null?void 0:$.name)||"",compatibility:v.compatibility,score:T,itemInstanceId:h.instanceId})})})}),C.sort((h,g)=>g.score-h.score)})(),c=(()=>{const C=new Map;return p.forEach(h=>{const g=C.get(h.childId);(!g||h.score>g.score)&&C.set(h.childId,h)}),Array.from(C.values()).filter(h=>{var b,E,I;const g=((I=(E=sc(h.currentManual,(b=t.find(v=>v.id===h.childId))==null?void 0:b.spiritRoot))==null?void 0:E.compatibility)==null?void 0:I.compatibility)||0;return h.compatibility.compatibility>g}).slice(0,10)})(),u=C=>{const h=`${C.childId}-${C.manualId}`,g=o.findIndex(b=>`${b.childId}-${b.manualId}`===h);g>=0?i(b=>b.filter((E,I)=>I!==g)):i(b=>[...b.filter(E=>E.childId!==C.childId),C])},x=()=>{i(c)},S=()=>{n(o)},w=C=>{switch(C){case"":return"#4caf50";case"":return"#8bc34a";case"":return"#ffc107";case"":return"#ff9800";case"":return"#f44336";default:return"#9e9e9e"}};return r.jsx("div",{style:Oe.overlay,children:r.jsxs("div",{style:Oe.modal,children:[r.jsxs("div",{style:Oe.header,children:[r.jsx("h3",{style:Oe.title,children:" "}),r.jsx("button",{onClick:s,style:Oe.closeIcon,children:""})]}),r.jsxs("div",{style:Oe.modeSwitch,children:[r.jsx("button",{style:{...Oe.modeBtn,...a==="AUTO"?Oe.modeBtnActive:{}},onClick:()=>l("AUTO"),children:" "}),r.jsx("button",{style:{...Oe.modeBtn,...a==="MANUAL"?Oe.modeBtnActive:{}},onClick:()=>l("MANUAL"),children:" "})]}),a==="AUTO"?r.jsxs("div",{style:Oe.content,children:[r.jsxs("div",{style:Oe.recommendHeader,children:[r.jsxs("div",{style:Oe.recommendTitle,children:[" ",c.length," "]}),c.length>0&&r.jsx("button",{onClick:x,style:Oe.quickSelectBtn,children:" "})]}),c.length===0?r.jsx("div",{style:Oe.empty,children:" "}):r.jsx("div",{style:Oe.optionList,children:c.map((C,h)=>{const g=o.some(b=>b.childId===C.childId&&b.manualId===C.manualId);return r.jsxs("div",{style:{...Oe.optionCard,borderColor:g?"#4caf50":"#e0e0e0",background:g?"#f1f8f4":"#fff"},onClick:()=>u(C),children:[r.jsxs("div",{style:Oe.optionHeader,children:[r.jsx("input",{type:"checkbox",checked:g,onChange:()=>u(C),style:Oe.checkbox}),r.jsxs("div",{style:Oe.optionInfo,children:[r.jsxs("div",{style:Oe.childInfo,children:[C.childName," (",C.childTier,")"]}),r.jsxs("div",{style:Oe.manualChange,children:[r.jsx("span",{style:Oe.oldManual,children:C.currentManualName}),r.jsx("span",{style:Oe.arrow,children:""}),r.jsx("span",{style:Oe.newManual,children:C.manualName})]})]})]}),r.jsxs("div",{style:Oe.compatibilityRow,children:[r.jsx("span",{style:Oe.compatibilityLabel,children:""}),r.jsxs("span",{style:{...Oe.compatibilityValue,color:w(C.compatibility.level)},children:[C.compatibility.level," (",C.compatibility.compatibility,"%)"]}),r.jsxs("span",{style:Oe.speedBonus,children:[" ",C.compatibility.speedMultiplier]})]}),C.compatibility.desc&&r.jsxs("div",{style:Oe.compatibilityDesc,children:[" ",C.compatibility.desc]})]},`${C.childId}-${C.manualId}`)})})]}):r.jsxs("div",{style:Oe.content,children:[r.jsxs("div",{style:Oe.allOptionsHeader,children:[" ",p.length," "]}),p.length===0?r.jsx("div",{style:Oe.empty,children:""}):r.jsx("div",{style:Oe.optionList,children:p.slice(0,50).map(C=>{const h=o.some(g=>g.childId===C.childId&&g.manualId===C.manualId);return r.jsxs("div",{style:{...Oe.optionCard,borderColor:h?"#4caf50":"#e0e0e0",background:h?"#f1f8f4":"#fff"},onClick:()=>u(C),children:[r.jsxs("div",{style:Oe.optionHeader,children:[r.jsx("input",{type:"checkbox",checked:h,onChange:()=>u(C),style:Oe.checkbox}),r.jsxs("div",{style:Oe.optionInfo,children:[r.jsxs("div",{style:Oe.childInfo,children:[C.childName," (",C.childTier,", ",C.childAptitude,")"]}),r.jsx("div",{style:Oe.manualName,children:C.manualName})]})]}),r.jsxs("div",{style:Oe.compatibilityRow,children:[r.jsx("span",{style:{...Oe.compatibilityBadge,background:w(C.compatibility.level)},children:C.compatibility.level}),r.jsxs("span",{style:Oe.speedBonus,children:["",C.compatibility.speedMultiplier]})]})]},`${C.childId}-${C.manualId}`)})})]}),r.jsxs("div",{style:Oe.footer,children:[r.jsxs("div",{style:Oe.selectionInfo,children:[" ",o.length," "]}),r.jsxs("div",{style:Oe.footerActions,children:[r.jsxs("button",{style:Oe.confirmBtn,onClick:S,disabled:o.length===0,children:[" (",o.length,")"]}),r.jsx("button",{style:Oe.cancelBtn,onClick:s,children:""})]})]})]})})},Oe={overlay:{position:"fixed",top:0,left:0,right:0,bottom:0,background:"rgba(0, 0, 0, 0.75)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:3e3,padding:"20px"},modal:{background:"#fff",borderRadius:"16px",width:"90%",maxWidth:"900px",maxHeight:"85vh",display:"flex",flexDirection:"column",boxShadow:"0 10px 40px rgba(0,0,0,0.3)",overflow:"hidden"},header:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"20px 24px",borderBottom:"2px solid #7e57c2",background:"linear-gradient(90deg, #ede7f6, #d1c4e9)",flexShrink:0},title:{margin:0,fontSize:"22px",color:"#5e35b1",fontWeight:"bold"},closeIcon:{background:"none",border:"none",fontSize:"28px",cursor:"pointer",color:"#5e35b1",padding:"0",lineHeight:"1"},modeSwitch:{display:"flex",gap:"8px",padding:"16px 24px",background:"#f5f5f5",borderBottom:"1px solid #e0e0e0",flexShrink:0},modeBtn:{flex:1,padding:"10px",background:"#fff",border:"2px solid #e0e0e0",borderRadius:"8px",cursor:"pointer",fontSize:"14px",fontWeight:"500",transition:"all 0.2s"},modeBtnActive:{background:"#7e57c2",color:"#fff",borderColor:"#7e57c2"},content:{flex:1,overflowY:"auto",display:"flex",flexDirection:"column"},recommendHeader:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"16px 24px",background:"#f5f5f5",borderBottom:"1px solid #e0e0e0"},recommendTitle:{fontSize:"14px",color:"#666",fontWeight:"500"},quickSelectBtn:{padding:"6px 16px",background:"#4caf50",color:"#fff",border:"none",borderRadius:"6px",cursor:"pointer",fontSize:"13px"},allOptionsHeader:{padding:"16px 24px",fontSize:"14px",color:"#666",background:"#f5f5f5",borderBottom:"1px solid #e0e0e0"},empty:{padding:"60px 24px",textAlign:"center",fontSize:"15px",color:"#999"},optionList:{padding:"16px 24px",display:"flex",flexDirection:"column",gap:"12px"},optionCard:{padding:"16px",border:"2px solid #e0e0e0",borderRadius:"12px",cursor:"pointer",transition:"all 0.2s",display:"flex",flexDirection:"column",gap:"12px"},optionHeader:{display:"flex",gap:"12px",alignItems:"flex-start"},checkbox:{width:"18px",height:"18px",cursor:"pointer",marginTop:"2px",flexShrink:0},optionInfo:{flex:1,display:"flex",flexDirection:"column",gap:"6px"},childInfo:{fontSize:"15px",fontWeight:"bold",color:"#333"},manualChange:{display:"flex",alignItems:"center",gap:"8px",fontSize:"14px"},oldManual:{color:"#999",textDecoration:"line-through"},arrow:{color:"#666"},newManual:{color:"#7e57c2",fontWeight:"600"},manualName:{fontSize:"14px",color:"#7e57c2",fontWeight:"600"},compatibilityRow:{display:"flex",gap:"12px",alignItems:"center",fontSize:"13px"},compatibilityLabel:{color:"#666"},compatibilityValue:{fontWeight:"600"},compatibilityBadge:{padding:"4px 10px",borderRadius:"12px",color:"#fff",fontSize:"12px",fontWeight:"bold"},speedBonus:{color:"#2196f3",fontWeight:"500"},compatibilityDesc:{fontSize:"12px",color:"#666",fontStyle:"italic",paddingLeft:"30px"},footer:{padding:"16px 24px",borderTop:"2px solid #e0e0e0",background:"#f5f5f5",display:"flex",justifyContent:"space-between",alignItems:"center",flexShrink:0},selectionInfo:{fontSize:"14px",color:"#666"},footerActions:{display:"flex",gap:"12px"},confirmBtn:{padding:"10px 24px",background:"#7e57c2",color:"#fff",border:"none",borderRadius:"8px",cursor:"pointer",fontSize:"15px",fontWeight:"bold",transition:"all 0.2s"},cancelBtn:{padding:"10px 24px",background:"#e0e0e0",border:"none",borderRadius:"8px",cursor:"pointer",fontSize:"15px"}},m5=({modalState:e,closeModal:t,player:n,inventory:s,handleGiftConfirm:o,handleNegotiateConfirm:i,handleShopPurchase:a,handleOptionSelect:l,handleShuraFieldSelect:d,handleBuyAuctionItem:p,handleShowAuctionPlot:f,modalMgr:c,allChildren:u,visibleChildren:x,handleEquipToChild:S,handleUseConsumable:w,handleBatchUseConsumables:C,handleDiscardFromInventory:h,handleGiveToChild:g,handleBatchGiveToChildren:b,handleSell:E,handleAutoAssignManualToChild:I,getMarketPrice:v,testQueue:k,handleTestFinish:T,handleTestQueueClose:A,childSelectorModal:R,handleChildSelectorSelect:$,closeChildSelectorModal:O,selectedChild:Q,childNavigationMeta:L,handleNavigateChild:G,handleChildAction:ne,setSelectedChild:ae,showSpouseSelection:Y,marryingChild:q,spouseCandidates:ie,handleSpouseSelect:Z,resetSpouseSelection:ve,batchGiftEvents:V,handleBatchGiftConfirm:ee,handleBatchGiftClose:he,batchPromotionEvents:ge,handleBatchPromotionConfirm:me,handleBatchPromotionClose:Me,batchMarriagePlans:$e,handleBatchMarriageConfirm:je,handleBatchMarriageClose:ct,handleBatchManualAssign:vt})=>r.jsxs(r.Fragment,{children:[e.type==="GIFT"&&r.jsx(Wj,{npc:e.data,inventory:s,onGift:o,onClose:t}),e.type==="NEGOTIATE"&&r.jsx(Gj,{npc:e.data,onNegotiate:i,onClose:t}),e.type==="SHOP"&&r.jsx(Vj,{items:e.data.items,playerSpiritStones:n.resources.spiritStones||0,onPurchase:a,onClose:t}),e.type==="RESULT"&&r.jsx(Yj,{result:e.data,onClose:t}),e.type==="CONFIRM"&&r.jsx(qj,{message:e.data.message,onConfirm:()=>{e.data.onConfirm(),t()},onCancel:t}),e.type==="EVENT"&&r.jsx(Kj,{event:e.data.event,npc:e.data.npc,onClose:t,onOptionSelect:l}),e.type==="SHURA_FIELD"&&r.jsx(Qj,{event:e.data,player:n,onClose:t,onOptionSelect:d}),e.type==="JEALOUSY"&&r.jsx(Xj,{event:e.data,onClose:t}),e.type==="AUCTION"&&r.jsx(t5,{auction:e.data,playerResources:n.resources,onClose:t,onBuy:p,onShowPlot:f}),c.inventoryModal.open&&r.jsx(r5,{items:s,mode:c.inventoryModal.mode,slot:c.inventoryModal.slot,childId:c.inventoryModal.childId,children:u,batchUseItems:c.inventoryModal.batchUseItems||[],onClose:()=>c.closeInventory(),onEquip:De=>S(c.inventoryModal.childId,c.inventoryModal.slot,De),onUse:De=>w(c.inventoryModal.childId,De),onBatchUse:(De,D)=>C(De,D),onDiscard:De=>h(De),onGiveToChild:g,onBatchGive:b,onSell:(De,D)=>E(De,D),onAutoAssignManual:I,getMarketPrice:v}),k.length>0&&r.jsx(s5,{child:k[0],onFinish:T,onClose:A}),R.open&&r.jsx(i5,{children:x,item:R.item,items:R.items,isBatch:R.isBatch,onSelect:$,onClose:O}),Q&&r.jsx(l5,{child:Q,navigation:L,onNavigate:G,onClose:()=>ae(null),onAction:(De,D)=>ne(Q.id,De,D)}),Y&&q&&r.jsx(c5,{child:q,candidates:ie,onSelect:Z,onClose:ve}),c.showBatchGiftModal&&V.length>0&&r.jsx(d5,{giftEvents:V,onConfirm:ee,onClose:he}),c.showBatchPromotionModal&&ge.length>0&&r.jsx(u5,{promotionEvents:ge,onConfirm:me,onClose:Me}),c.showBatchMarriageModal&&$e.length>0&&r.jsx(p5,{marriagePlans:$e,onConfirm:je,onClose:ct}),c.showBatchManualModal&&r.jsx(f5,{manualItems:s.filter(De=>De.type==="manual"&&(De.manualIds&&De.manualIds.length||De.manualId)),children:x.length?x:u,onAssign:vt,onClose:()=>c.closeBatchManualModal()})]});function h5({npc:e,onClose:t,playerAffection:n=0}){var C,h;const[s,o]=y.useState("ALL"),[i,a]=y.useState(0),l=20;if(y.useEffect(()=>{const g=b=>{b.key==="Escape"&&t()};return window.addEventListener("keydown",g),()=>window.removeEventListener("keydown",g)},[t]),y.useEffect(()=>{a(0)},[s]),!e)return null;const d=Number(n)||0,p=Math.max(0,Math.min(100,d));if(d<30)return r.jsx("div",{className:"modal-overlay",onClick:t,children:r.jsxs("div",{className:"npc-log-modal",onClick:g=>g.stopPropagation(),children:[r.jsxs("div",{className:"log-modal-header",children:[r.jsx("div",{className:"log-modal-title",children:r.jsxs("h2",{children:[e.name," "]})}),r.jsx("button",{className:"close-btn",onClick:t,children:""})]}),r.jsxs("div",{className:"log-empty",style:{padding:"80px 20px"},children:[r.jsx("p",{style:{fontSize:"64px",margin:"0 0 20px 0"},children:""}),r.jsx("h3",{style:{color:"#ffd700",marginBottom:"12px"},children:""}),r.jsxs("p",{style:{color:"rgba(255,255,255,0.7)",fontSize:"16px"},children:[" ",e.name," ",r.jsx("br",{})," ",r.jsx("span",{style:{color:"#ffd700",fontWeight:"bold"},children:"30"})," ",e.gender===""?"":"",""]}),r.jsxs("p",{style:{color:"rgba(255,255,255,0.5)",fontSize:"14px",marginTop:"20px"},children:["",r.jsx("span",{style:{color:d<10?"#f44336":"#ff9800"},children:p})," / 30"]})]})]})});const f=vE(e,d),c=s==="ALL"?f:f.filter(g=>g.type===s),u=Math.max(1,Math.ceil(c.length/l)),x=c.slice(i*l,(i+1)*l),S={all:f.length,interaction:f.filter(g=>g.type===ut.INTERACTION).length,stateChange:f.filter(g=>g.type===ut.STATE_CHANGE).length,daily:f.filter(g=>g.type===ut.DAILY).length},w=g=>{switch(g){case ut.INTERACTION:return{icon:"",color:"#4CAF50",label:""};case ut.STATE_CHANGE:return{icon:"",color:"#FF5722",label:""};case ut.DAILY:return{icon:"",color:"#2196F3",label:""};default:return{icon:"",color:"#9E9E9E",label:""}}};return r.jsx("div",{className:"modal-overlay",onClick:t,children:r.jsxs("div",{className:"npc-log-modal",onClick:g=>g.stopPropagation(),children:[r.jsxs("div",{className:"log-modal-header",children:[r.jsxs("div",{className:"log-modal-title",children:[r.jsxs("h2",{children:[e.name," "]}),r.jsxs("p",{className:"log-modal-subtitle",children:[e.gender===""?"":"","..."]})]}),r.jsx("button",{className:"close-btn",onClick:t,children:""})]}),r.jsxs("div",{className:"log-filter-bar",children:[r.jsxs("button",{className:`filter-btn ${s==="ALL"?"active":""}`,onClick:()=>o("ALL"),children:["  (",S.all,")"]}),r.jsxs("button",{className:`filter-btn ${s===ut.INTERACTION?"active":""}`,onClick:()=>o(ut.INTERACTION),children:["  (",S.interaction,")"]}),r.jsxs("button",{className:`filter-btn ${s===ut.STATE_CHANGE?"active":""}`,onClick:()=>o(ut.STATE_CHANGE),children:["  (",S.stateChange,")"]}),r.jsxs("button",{className:`filter-btn ${s===ut.DAILY?"active":""}`,onClick:()=>o(ut.DAILY),children:["  (",S.daily,")"]})]}),r.jsx("div",{className:"log-content",children:c.length===0?r.jsxs("div",{className:"log-empty",children:[r.jsx("p",{children:""}),r.jsx("p",{children:""}),d<80&&f.length<((C=e.logs)==null?void 0:C.length)&&r.jsx("p",{className:"log-hint",children:" "})]}):r.jsx("div",{className:"log-list",children:x.map((g,b)=>{const E=w(g.type);return r.jsxs("div",{className:`log-entry ${g.isSecret?"secret":""}`,children:[r.jsxs("div",{className:"log-header",children:[r.jsxs("span",{className:"log-type-badge",style:{backgroundColor:E.color},children:[E.icon," ",E.label]}),r.jsxs("span",{className:"log-date",children:[" ",g.year,"  ",g.month," "]}),g.isSecret&&r.jsx("span",{className:"secret-badge",title:"",children:""})]}),r.jsx("div",{className:"log-text",children:g.content})]},`${g.timestamp}-${b}`)})})}),c.length>l&&r.jsxs("div",{className:"log-pagination",children:[r.jsx("button",{className:"page-btn",onClick:()=>a(g=>Math.max(0,g-1)),disabled:i<=0,children:""}),r.jsxs("span",{className:"page-info",children:[" ",i+1," / ",u," "]}),r.jsx("button",{className:"page-btn",onClick:()=>a(g=>Math.min(u-1,g+1)),disabled:i>=u-1,children:""})]}),r.jsxs("div",{className:"log-record-count",children:[" ",c.length," "]}),d<80&&((h=e.logs)==null?void 0:h.length)>f.length&&r.jsx("div",{className:"log-footer-hint",children:"  80+ "})]})})}const g5=({player:e,enemy:t,result:n,onClose:s})=>{var i,a;const o=y.useRef(null);return y.useEffect(()=>{o.current&&(o.current.scrollTop=o.current.scrollHeight)},[]),r.jsx("div",{style:nn.overlay,children:r.jsxs("div",{style:nn.window,children:[r.jsx("div",{style:nn.header,children:" "}),r.jsxs("div",{style:nn.statusBar,children:[r.jsxs("div",{style:nn.fighter,children:[r.jsx("div",{style:nn.avatar,children:""}),r.jsx("div",{children:e.name}),r.jsxs("div",{style:{color:"#d32f2f"},children:["HP: ",((i=e.combatStats)==null?void 0:i.hp)||0]}),r.jsxs("div",{style:{marginTop:6,fontSize:12,color:"#666"},children:[": ",Jr(e).total]})]}),r.jsx("div",{style:nn.vs,children:"VS"}),r.jsxs("div",{style:nn.fighter,children:[r.jsx("div",{style:{...nn.avatar,background:"#d32f2f"},children:""}),r.jsx("div",{children:t.name}),r.jsxs("div",{style:{color:"#d32f2f"},children:["HP: ",((a=t.combatStats)==null?void 0:a.hp)||0]}),r.jsxs("div",{style:{marginTop:6,fontSize:12,color:"#666"},children:[": ",Jr(t).total]})]})]}),r.jsx("div",{style:{padding:"10px 15px",fontSize:12,color:"#444",background:"#fff8",borderBottom:"1px solid #eee"},children:""}),r.jsx("div",{style:nn.logBox,ref:o,children:x5(n.logs,e).map((l,d)=>r.jsxs("div",{style:nn.entryRow,children:[r.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8},children:[r.jsx("div",{style:{fontSize:16},children:l.icon}),r.jsxs("div",{children:[r.jsx("div",{style:{fontSize:13,color:l.isDamage?l.byPlayer?"#2e7d32":"#d32f2f":"#444",fontWeight:600},children:l.text}),l.damage!=null&&r.jsxs("div",{style:{fontSize:12,color:"#666",marginTop:4},children:[": ",r.jsx("strong",{style:{color:l.byPlayer?"#2e7d32":"#d32f2f"},children:l.damage})]})]})]}),l.maxHp!=null&&r.jsxs("div",{style:nn.hpBarWrap,children:[r.jsx("div",{style:nn.hpBarBg,children:r.jsx("div",{style:{...nn.hpBarFill,width:`${Math.max(0,Math.min(100,Math.floor(l.remaining/l.maxHp*100)))}%`,background:l.byPlayer?"#2e7d32":"#d32f2f"}})}),r.jsxs("div",{style:{fontSize:12,color:"#333",marginLeft:8},children:[l.remaining,"/",l.maxHp," HP"]})]})]},d))}),r.jsx("button",{onClick:s,style:{...nn.btn,background:n.success?"#4caf50":"#d32f2f"},children:n.success?"":""})]})})},nn={overlay:{position:"fixed",top:0,left:0,right:0,bottom:0,background:"rgba(0,0,0,0.85)",zIndex:2200,display:"flex",alignItems:"center",justifyContent:"center"},window:{width:"90%",maxWidth:"400px",background:"#fff",borderRadius:"8px",overflow:"hidden",display:"flex",flexDirection:"column",boxShadow:"0 0 20px rgba(255,0,0,0.5)"},header:{background:"#212121",color:"#fff",padding:"15px",textAlign:"center",fontSize:"18px",fontWeight:"bold"},statusBar:{display:"flex",justifyContent:"space-between",padding:"15px",background:"#f5f5f5",borderBottom:"1px solid #ddd"},fighter:{textAlign:"center",fontSize:"12px"},avatar:{width:"40px",height:"40px",borderRadius:"50%",background:"#333",color:"white",display:"flex",alignItems:"center",justifyContent:"center",margin:"0 auto 5px"},vs:{fontSize:"24px",fontStyle:"italic",fontWeight:"bold",color:"#999",alignSelf:"center"},logBox:{padding:"15px",height:"250px",overflowY:"auto",background:"#fff",fontSize:"13px",lineHeight:"1.6"},entryRow:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"8px 0",borderBottom:"1px dashed #eee"},hpBarWrap:{display:"flex",alignItems:"center",gap:8},hpBarBg:{width:140,height:10,background:"#eee",borderRadius:6,overflow:"hidden"},hpBarFill:{height:"100%",borderRadius:6,transition:"width 0.3s ease"},btn:{padding:"15px",border:"none",color:"#fff",fontSize:"16px",cursor:"pointer",fontWeight:"bold"}};function x5(e=[],t,n){const s=[],o=/(.+)  (.+)  (\d+) /,i=/(.+)  (.+)  (\d+) /,a=/(.+)  HP: (\d+)\/(\d+)/;for(let l=0;l<e.length;l++){const d=e[l];let p=d.match(o)||d.match(i);if(p){const f=p[1],c=p[2],u=Number(p[3]);let x=null,S=null;if(l+1<e.length){const C=e[l+1].match(a);C&&C[1]===c&&(x=Number(C[2]),S=Number(C[3]),l++)}const w=f===t.name;s.push({icon:w?"":"",text:`${f}  ${c}`,damage:u,remaining:x,maxHp:S,isDamage:!0,byPlayer:w});continue}s.push({icon:"",text:d,isDamage:!1})}return s}const y5=({open:e,realmName:t,progress:n,total:s,event:o,log:i,optionContext:a,onSelectOption:l,onNext:d,onStartCombat:p,onClose:f})=>{const[c,u]=y.useState(null),[x,S]=y.useState(null),[w,C]=y.useState(!1),[h,g]=y.useState(!1),[b,E]=y.useState("");if(y.useEffect(()=>{e&&C(!0)},[e]),!e)return null;const I=()=>{if(!o)return"";switch(o.kind){case"COMBAT":return"";case"BOSS":return"";case"TREASURE":return"";case"MYSTERY":return"";default:return""}},v=()=>{if(!o)return"#4a5568";switch(o.kind){case"COMBAT":return"#d32f2f";case"BOSS":return"#7b1fa2";case"TREASURE":return"#f57c00";case"MYSTERY":return"#1976d2";default:return"#388e3c"}},k=(n/s*100).toFixed(0),T=$=>{E($.label),g(!0),l($)},A=()=>{g(!1),E(""),setTimeout(()=>{d()},300)},R=()=>{E(""),g(!0),p()};return r.jsxs("div",{style:Ye.overlay,children:[r.jsxs("div",{style:{...Ye.window,animation:w?"slideIn 0.3s ease-out":"none"},children:[r.jsxs("div",{style:{...Ye.header,background:`linear-gradient(135deg, ${v()}, ${v()}dd)`},children:[r.jsxs("div",{style:Ye.headerTop,children:[r.jsxs("span",{style:Ye.realmTitle,children:[I()," ",t]}),r.jsx("button",{style:Ye.closeIconBtn,onClick:f,onMouseEnter:()=>S("close"),onMouseLeave:()=>S(null),children:""})]}),r.jsxs("div",{style:Ye.progressContainer,children:[r.jsx("div",{style:{...Ye.progressBar,width:`${k}%`,background:"linear-gradient(90deg, #ffd54f, #ffb300)"}}),r.jsxs("span",{style:Ye.progressText,children:[n," / ",s]})]})]}),r.jsxs("div",{style:Ye.body,children:[r.jsxs("div",{style:{...Ye.eventCard,borderLeft:`4px solid ${v()}`},children:[r.jsxs("div",{style:Ye.eventHeader,children:[r.jsx("span",{style:{...Ye.eventBadge,background:v()},children:(o==null?void 0:o.kind)||""}),r.jsx("h3",{style:Ye.eventTitle,children:(o==null?void 0:o.title)||""})]}),r.jsx("p",{style:Ye.eventDesc,children:(o==null?void 0:o.desc)||""})]}),(o==null?void 0:o.options)&&o.options.length>0&&r.jsxs("div",{style:Ye.optionsContainer,children:[r.jsx("div",{style:Ye.optionsLabel,children:" "}),r.jsx("div",{style:Ye.options,children:o.options.map(($,O)=>{const Q=a||{},L=!$.condition||$.condition(Q);return r.jsxs("button",{style:{...Ye.optionBtn,...c===O&&L?Ye.optionBtnHover:{},...L?{}:Ye.optionBtnDisabled},onMouseEnter:()=>u(O),onMouseLeave:()=>u(null),onClick:()=>{L&&T($)},disabled:!L,"aria-disabled":!L,children:[r.jsx("span",{style:Ye.optionIcon,children:""}),r.jsx("span",{style:Ye.optionLabel,children:$.label})]},O)})})]}),((o==null?void 0:o.kind)==="COMBAT"||(o==null?void 0:o.kind)==="BOSS")&&r.jsxs("button",{style:{...Ye.fightBtn,...x==="fight"?Ye.fightBtnHover:{}},onMouseEnter:()=>S("fight"),onMouseLeave:()=>S(null),onClick:R,children:[r.jsx("span",{style:Ye.fightIcon,children:""}),r.jsx("span",{children:""})]})]}),r.jsx("div",{style:Ye.footer,children:r.jsx("button",{style:{...Ye.actionBtn,...Ye.exitBtn,...x==="exit"?Ye.exitBtnHover:{}},onMouseEnter:()=>S("exit"),onMouseLeave:()=>S(null),onClick:f,children:r.jsx("span",{children:""})})})]}),h&&r.jsx("div",{style:Ye.resultOverlay,children:r.jsxs("div",{style:Ye.resultBox,children:[r.jsx("div",{style:Ye.resultIcon,children:""}),r.jsx("div",{style:Ye.resultTitle,children:""}),r.jsx("div",{style:Ye.resultMessage,children:i&&i.length>0?i[i.length-1]:b}),r.jsx("button",{style:{...Ye.resultBtn,...x==="result"?Ye.resultBtnHover:{}},onMouseEnter:()=>S("result"),onMouseLeave:()=>S(null),onClick:A,children:""})]})}),r.jsx("style",{children:`
        @keyframes slideIn {
          from {
            opacity: 0;
            transform: translateY(-30px) scale(0.95);
          }
          to {
            opacity: 1;
            transform: translateY(0) scale(1);
          }
        }
        @keyframes fadeIn {
          from {
            opacity: 0;
            transform: translateX(-10px);
          }
          to {
            opacity: 1;
            transform: translateX(0);
          }
        }
        @keyframes popIn {
          0% {
            opacity: 0;
            transform: scale(0.8);
          }
          50% {
            transform: scale(1.05);
          }
          100% {
            opacity: 1;
            transform: scale(1);
          }
        }
        @keyframes bounce {
          0%, 100% {
            transform: translateY(0);
          }
          50% {
            transform: translateY(-10px);
          }
        }
      `})]})},Ye={overlay:{position:"fixed",top:0,left:0,right:0,bottom:0,background:"rgba(0, 0, 0, 0.75)",backdropFilter:"blur(4px)",zIndex:2100,display:"flex",alignItems:"center",justifyContent:"center",padding:"20px"},window:{width:"100%",maxWidth:"600px",background:"linear-gradient(to bottom, #ffffff, #f8f9fa)",borderRadius:"16px",boxShadow:"0 20px 60px rgba(0, 0, 0, 0.4)",overflow:"hidden",display:"flex",flexDirection:"column",maxHeight:"90vh"},header:{color:"#fff",padding:"16px 20px",position:"relative"},headerTop:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"12px"},realmTitle:{fontSize:"18px",fontWeight:"bold",textShadow:"0 2px 4px rgba(0,0,0,0.2)"},closeIconBtn:{background:"rgba(255,255,255,0.2)",border:"none",color:"#fff",width:"32px",height:"32px",borderRadius:"50%",cursor:"pointer",fontSize:"20px",display:"flex",alignItems:"center",justifyContent:"center",transition:"all 0.2s ease",":hover":{background:"rgba(255,255,255,0.3)"}},progressContainer:{position:"relative",background:"rgba(0,0,0,0.2)",height:"24px",borderRadius:"12px",overflow:"hidden"},progressBar:{height:"100%",transition:"width 0.5s ease",borderRadius:"12px",boxShadow:"inset 0 2px 4px rgba(0,0,0,0.1)"},progressText:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",fontSize:"13px",fontWeight:"bold",textShadow:"0 1px 2px rgba(0,0,0,0.3)"},body:{padding:"20px",flex:1,overflowY:"auto"},eventCard:{background:"#fff",borderRadius:"12px",padding:"16px",marginBottom:"16px",boxShadow:"0 2px 8px rgba(0,0,0,0.08)"},eventHeader:{display:"flex",alignItems:"center",gap:"10px",marginBottom:"10px"},eventBadge:{padding:"4px 12px",borderRadius:"12px",color:"#fff",fontSize:"11px",fontWeight:"bold",textTransform:"uppercase",letterSpacing:"0.5px"},eventTitle:{fontSize:"18px",fontWeight:"bold",color:"#1a202c",margin:0},eventDesc:{fontSize:"14px",color:"#4a5568",lineHeight:1.7,margin:0},optionsContainer:{marginBottom:"16px"},optionsLabel:{fontSize:"13px",fontWeight:"600",color:"#2d3748",marginBottom:"10px"},options:{display:"grid",gridTemplateColumns:"1fr",gap:"10px"},optionBtn:{display:"flex",alignItems:"center",gap:"10px",padding:"14px 16px",border:"2px solid #e2e8f0",borderRadius:"10px",background:"#fff",cursor:"pointer",fontSize:"14px",fontWeight:"500",color:"#2d3748",transition:"all 0.2s ease",textAlign:"left"},optionBtnHover:{border:"2px solid #4299e1",background:"#ebf8ff",transform:"translateX(4px)",boxShadow:"0 4px 12px rgba(66, 153, 225, 0.15)"},optionBtnDisabled:{borderColor:"#cbd5e1",background:"#f8fafc",color:"#94a3b8",cursor:"not-allowed",opacity:.7},optionIcon:{fontSize:"16px"},optionLabel:{flex:1},fightBtn:{width:"100%",display:"flex",alignItems:"center",justifyContent:"center",gap:"10px",padding:"16px",border:"none",borderRadius:"10px",background:"linear-gradient(135deg, #dc2626, #b91c1c)",color:"#fff",fontWeight:"bold",fontSize:"16px",cursor:"pointer",marginBottom:"16px",transition:"all 0.3s ease",boxShadow:"0 4px 12px rgba(220, 38, 38, 0.3)"},fightBtnHover:{transform:"translateY(-2px)",boxShadow:"0 6px 20px rgba(220, 38, 38, 0.4)"},fightIcon:{fontSize:"20px",animation:"pulse 1.5s ease-in-out infinite"},footer:{display:"flex",gap:"12px",padding:"16px 20px",background:"#fff",borderTop:"1px solid #e2e8f0"},actionBtn:{flex:1,display:"flex",alignItems:"center",justifyContent:"center",gap:"8px",padding:"14px 20px",border:"none",borderRadius:"10px",cursor:"pointer",fontWeight:"600",fontSize:"15px",transition:"all 0.2s ease"},exitBtn:{background:"#f1f5f9",color:"#475569",border:"1px solid #cbd5e1"},exitBtnHover:{background:"#e2e8f0",border:"1px solid #94a3b8"},resultOverlay:{position:"absolute",top:0,left:0,right:0,bottom:0,background:"rgba(0, 0, 0, 0.6)",backdropFilter:"blur(2px)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:10,borderRadius:"16px"},resultBox:{background:"linear-gradient(135deg, #ffffff, #f0f9ff)",borderRadius:"16px",padding:"32px",maxWidth:"400px",width:"90%",boxShadow:"0 20px 60px rgba(0, 0, 0, 0.3)",textAlign:"center",animation:"popIn 0.3s ease-out",border:"2px solid #3b82f6"},resultIcon:{fontSize:"48px",marginBottom:"16px",animation:"bounce 0.6s ease-in-out"},resultTitle:{fontSize:"20px",fontWeight:"bold",color:"#1e40af",marginBottom:"16px"},resultMessage:{fontSize:"15px",color:"#475569",lineHeight:1.8,marginBottom:"24px",padding:"16px",background:"rgba(59, 130, 246, 0.08)",borderRadius:"8px",border:"1px solid rgba(59, 130, 246, 0.2)"},resultBtn:{padding:"12px 32px",background:"linear-gradient(135deg, #3b82f6, #2563eb)",color:"#fff",border:"none",borderRadius:"8px",fontSize:"16px",fontWeight:"600",cursor:"pointer",transition:"all 0.2s ease",boxShadow:"0 4px 12px rgba(59, 130, 246, 0.3)"},resultBtnHover:{transform:"translateY(-2px)",boxShadow:"0 6px 20px rgba(59, 130, 246, 0.4)"}},b5=({event:e,onClose:t,onAssign:n})=>{var u,x,S,w;if(!e)return null;const{child:s,selectableSects:o=[],otherSectOptions:i=[],title:a,message:l}=e,[d,p]=y.useState(!1),f=C=>{if(typeof C.compatibility=="number")return C.compatibility;const h=C.sect||C;return Wx(s,h)},c=C=>{if(C.admission&&C.admission.qualified===!1)return;const h=C.sect||C,g=C.predictedRank||"";n(s.id,h.id,g)};return r.jsx("div",{style:Nn.overlay,children:r.jsxs("div",{style:Nn.card,children:[r.jsx("h2",{children:a||""}),r.jsx("p",{style:{color:"#444"},children:l}),r.jsxs("div",{style:Nn.content,children:[r.jsxs("div",{style:Nn.childBox,children:[r.jsxs("h3",{children:[s.name," (",s.gender,")"]}),r.jsxs("p",{children:[": ",((u=s.stats)==null?void 0:u.aptitude)||0]}),r.jsxs("p",{children:[": ",r.jsx("strong",{style:{color:((x=s.spiritRoot)==null?void 0:x.color)||"#666"},children:((S=s.spiritRoot)==null?void 0:S.type)||""})]}),r.jsx("div",{style:{display:"flex",gap:6},children:(((w=s.spiritRoot)==null?void 0:w.elements)||[]).map(C=>r.jsx("span",{style:{padding:"4px 8px",background:"#eee",borderRadius:6},children:C},C))})]}),r.jsx("div",{style:Nn.listBox,children:o.map(C=>{var T;const h=C.sect||C,g=C.predictedRank,b=C.resources||[],E=C.admission||{},I=E.qualified!==!1,v=E.summary||E.notes||"",k=I?E.notes||"":((T=E.reasons)==null?void 0:T.join(""))||"";return r.jsxs("div",{style:Nn.sectRow,children:[r.jsxs("div",{children:[r.jsx("div",{style:{fontWeight:"bold"},children:h.name}),r.jsx("div",{style:{fontSize:12,color:"#666"},children:h.desc}),r.jsxs("div",{style:{fontSize:12,color:"#444",marginTop:6},children:[": ",b.join(", ")||""]}),r.jsxs("div",{style:{fontSize:12,color:"#888",marginTop:4},children:[": ",v]}),r.jsx("div",{style:{fontSize:12,color:I?"#1b5e20":"#a00"},children:k})]}),r.jsxs("div",{style:{textAlign:"right"},children:[r.jsxs("div",{style:{marginBottom:6},children:[": ",f(C)]}),r.jsxs("div",{style:{fontSize:12,color:"#333",marginBottom:6},children:[": ",g||""]}),r.jsx("button",{disabled:!I,onClick:()=>c(C),style:{...Nn.btn,opacity:I?1:.4,cursor:I?"pointer":"not-allowed"},children:I?"":""})]})]},h.id)})}),i.length>0&&r.jsxs("div",{style:{marginTop:12},children:[r.jsx("button",{onClick:()=>p(C=>!C),style:Nn.secondaryBtn,children:d?"":""}),d&&r.jsx("div",{style:Nn.otherList,children:i.map(C=>{var I;const h=C.sect||C,g=C.admission||{},b=g.qualified!==!1,E=((I=g.reasons)==null?void 0:I.join(""))||"";return r.jsxs("div",{style:Nn.otherRow,children:[r.jsxs("div",{children:[r.jsx("div",{style:{fontWeight:"bold"},children:h.name}),r.jsx("div",{style:{fontSize:12,color:"#666"},children:g.summary||h.desc}),r.jsx("div",{style:{fontSize:12,color:b?"#1b5e20":"#a00"},children:b?` ${f(C)}  `:`${E}`})]}),r.jsx("button",{disabled:!b,onClick:()=>c(C),style:{...Nn.btn,opacity:b?1:.35,cursor:b?"pointer":"not-allowed"},children:b?"":""})]},h.id)})})]})]}),r.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginTop:12},children:[r.jsx("button",{onClick:t,style:Nn.cancel,children:""}),r.jsx("p",{style:{fontSize:"11px",color:"#999",marginTop:"6px",marginLeft:"10px"},children:""})]})]})})},Nn={overlay:{position:"fixed",inset:0,background:"rgba(0,0,0,0.7)",display:"flex",justifyContent:"center",alignItems:"center",zIndex:500,padding:"10px",overflowY:"auto"},card:{width:"100%",maxWidth:"640px",background:"#fff",borderRadius:12,padding:"16px",maxHeight:"90vh",overflowY:"auto",margin:"auto"},content:{display:"flex",gap:12,flexDirection:window.innerWidth<=768?"column":"row"},childBox:{width:window.innerWidth<=768?"100%":"220px",padding:12,background:"#fafafa",borderRadius:8},listBox:{flex:1,display:"flex",flexDirection:"column",gap:8},sectRow:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:10,borderRadius:8,background:"#fff",boxShadow:"0 1px 4px rgba(0,0,0,0.05)",flexDirection:window.innerWidth<=480?"column":"row",gap:window.innerWidth<=480?"10px":"0"},btn:{padding:"8px 12px",background:"#3e2723",color:"white",border:"none",borderRadius:6,cursor:"pointer",fontSize:"clamp(12px, 3vw, 14px)",whiteSpace:"nowrap"},cancel:{padding:"8px 12px",background:"#ddd",border:"none",borderRadius:6,cursor:"pointer",fontSize:"clamp(12px, 3vw, 14px)"},secondaryBtn:{marginTop:8,padding:"6px 10px",background:"#f5f5f5",border:"1px solid #ccc",borderRadius:6,cursor:"pointer",fontSize:"clamp(12px, 3vw, 13px)"},otherList:{marginTop:10,display:"flex",flexDirection:"column",gap:8},otherRow:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"8px 10px",borderRadius:8,background:"#fafafa"}},gi=[{id:1,title:"",content:`
      <p> </p>
      <p><strong></strong><strong></strong></p>
      <p><strong></strong></p>
      <br/>
      <p> <strong></strong></p>
      <ul>
        <li> </li>
        <li> </li>
        <li> </li>
        <li> </li>
      </ul>
    `},{id:2,title:"",content:`
      <p> <strong></strong></p>
      <br/>
      <p> <strong></strong></p>
      <ul>
        <li><strong> </strong>NPC</li>
        <li><strong> </strong></li>
        <li><strong> </strong></li>
        <li><strong> </strong></li>
        <li><strong> </strong></li>
        <li><strong> </strong></li>
      </ul>
    `},{id:3,title:"",content:`
      <p> <strong></strong></p>
      <br/>
      <p><strong></strong></p>
      <p><strong></strong>10%</p>
      <br/>
      <p> <strong></strong></p>
      <ul>
        <li> /10% </li>
        <li> 50% </li>
        <li> 100% </li>
      </ul>
      <br/>
      <p> <strong></strong></p>
      <ul>
        <li>></li>
        <li></li>
        <li></li>
      </ul>
    `},{id:4,title:"",content:`
      <p> <strong></strong></p>
      <br/>
      <p><strong></strong></p>
      <ul>
        <li></li>
        <li> <strong>100</strong> </li>
        <li><strong>""</strong></li>
      </ul>
      <br/>
      <p> <strong></strong></p>
      <ul>
        <li> HP()  ATK()</li>
        <li></li>
      </ul>
    `},{id:5,title:"",content:`
      <p> <strong></strong></p>
      <br/>
      <p> <strong></strong></p>
      <p></p>
      <br/>
      <p> <strong></strong></p>
      <ul>
        <li>NPC</li>
        <li> </li>
        <li>6</li>
        <li></li>
      </ul>
      <br/>
      <p style="text-align:center; color:#d32f2f; font-weight:bold;">
        
      </p>
    `}],v5=({onClose:e,onComplete:t})=>{const[n,s]=y.useState(0),o=()=>{n<gi.length-1?s(n+1):(t&&t(),e())},i=()=>{t&&t(),e()},a=gi[n],l=(n+1)/gi.length*100;return r.jsx("div",{style:un.overlay,children:r.jsxs("div",{style:un.modal,children:[r.jsxs("div",{style:un.header,children:[r.jsxs("div",{style:un.headerContent,children:[r.jsxs("span",{style:un.stepIndicator,children:[" ",n+1," / ",gi.length]}),r.jsx("h3",{style:un.title,children:a.title})]}),r.jsx("button",{onClick:i,style:un.skipBtn,children:""})]}),r.jsx("div",{style:un.progressBar,children:r.jsx("div",{style:{...un.progressFill,width:`${l}%`}})}),r.jsx("div",{style:un.content,children:r.jsx("div",{style:un.contentText,dangerouslySetInnerHTML:{__html:a.content}})}),r.jsxs("div",{style:un.footer,children:[n>0&&r.jsx("button",{onClick:()=>s(n-1),style:un.prevBtn,children:""}),r.jsx("div",{style:{flex:1}}),r.jsx("button",{onClick:o,style:un.nextBtn,children:n===gi.length-1?"":""})]})]})})},un={overlay:{position:"fixed",top:0,left:0,right:0,bottom:0,background:"rgba(0, 0, 0, 0.85)",zIndex:9999,display:"flex",alignItems:"center",justifyContent:"center",animation:"fadeIn 0.3s ease-in"},modal:{width:"90%",maxWidth:"550px",maxHeight:"85vh",background:"linear-gradient(135deg, #ffffff 0%, #f5f5f5 100%)",borderRadius:"16px",boxShadow:"0 20px 60px rgba(0,0,0,0.5)",display:"flex",flexDirection:"column",overflow:"hidden",border:"2px solid #d4af37"},header:{padding:"20px",background:"linear-gradient(135deg, #5d4037 0%, #3e2723 100%)",color:"#fff",display:"flex",justifyContent:"space-between",alignItems:"flex-start"},headerContent:{flex:1},stepIndicator:{display:"inline-block",background:"rgba(255, 255, 255, 0.2)",padding:"4px 12px",borderRadius:"12px",fontSize:"12px",marginBottom:"8px"},title:{margin:0,fontSize:"20px",fontWeight:"bold"},skipBtn:{background:"transparent",border:"1px solid rgba(255, 255, 255, 0.5)",color:"#fff",padding:"6px 12px",borderRadius:"4px",cursor:"pointer",fontSize:"13px",transition:"all 0.3s"},progressBar:{width:"100%",height:"4px",background:"#e0e0e0"},progressFill:{height:"100%",background:"linear-gradient(90deg, #d4af37 0%, #f4e4a6 100%)",transition:"width 0.3s ease"},content:{flex:1,padding:"30px",overflowY:"auto",fontSize:"14px",lineHeight:"1.8"},contentText:{color:"#333"},footer:{padding:"15px 20px",borderTop:"1px solid #e0e0e0",background:"#fff",display:"flex",justifyContent:"space-between",gap:"10px"},prevBtn:{padding:"10px 20px",background:"#9e9e9e",color:"#fff",border:"none",borderRadius:"6px",cursor:"pointer",fontSize:"14px",fontWeight:"bold",transition:"all 0.3s"},nextBtn:{padding:"10px 24px",background:"linear-gradient(135deg, #d4af37 0%, #f4e4a6 100%)",color:"#3e2723",border:"none",borderRadius:"6px",cursor:"pointer",fontSize:"14px",fontWeight:"bold",transition:"all 0.3s",boxShadow:"0 2px 8px rgba(212, 175, 55, 0.4)"}},el=[{id:"INTRO",title:"  ()",content:`
      <p><strong></strong><strong></strong></p>
      <p><strong></strong></p>
      <ul>
        <li><strong></strong></li>
        <li><strong></strong></li>
        <li><strong></strong><strong></strong></li>
        <li><strong></strong></li>
      </ul>
    `},{id:"FEEDBACK",title:"  ()",content:`
      <p><strong></strong></p>
      <div style="background:#eee; padding:10px; border-radius:5px; margin:10px 0;">
        <strong></strong><br/>
            <strong></strong>  <strong></strong>
      </div>
      <p><strong></strong></p>
      <ul>
        <li> <strong>/</strong> (10%)</li>
        <li> <strong></strong> (50%)</li>
        <li> <strong></strong> (100%)</li>
      </ul>
      
      <p><strong style="color:#D32F2F;"> ()</strong></p>
      <div style="background:#fff3e0; padding:12px; border-radius:5px; margin:10px 0; border-left: 4px solid #FF9800;">
        <p style="margin:0 0 8px 0;"><strong></strong></p>
        <ul style="margin:5px 0; padding-left:20px;">
          <li> <strong></strong>1.0 ()</li>
          <li> <strong></strong>1.5 (+50%)</li>
          <li> <strong></strong>3.0 (+200%)</li>
          <li> <strong></strong>6.0 (+500%)</li>
          <li> <strong></strong>12.0 (+1100%)</li>
          <li> <strong></strong>25.0 (+2400%)</li>
          <li> <strong></strong>100.0 (<strong style="color:#D32F2F;">+9900%</strong>)</li>
        </ul>
      </div>
      
      <p><strong></strong>""""100</p>
      <ol style="background:#f5f5f5; padding:12px; border-radius:5px;">
        <li></li>
        <li></li>
        <li><strong></strong></li>
        <li>""</li>
      </ol>
    `},{id:"COMBAT",title:" ",content:`
      <p><strong></strong><strong></strong></p>
      <ul>
        <li><strong></strong></li>
        <li><strong></strong> <strong>100</strong> </li>
        <li><strong></strong> <strong>HP()</strong>  <strong>ATK()</strong></li>
      </ul>
      <p><strong></strong><br/>1. <strong></strong><br/>2. </p>
    `},{id:"ROOTS",title:" ",content:`
      <p>6</p>
      <ul>
        <li><span style="color:#FFD700"> (90-100)</span></li>
        <li><span style="color:#00BCD4"> (80-89)</span>//</li>
        <li><span style="color:#9C27B0">/</span></li>
        <li><span style="color:#9E9E9E">/</span></li>
      </ul>
    `}],S5=({onClose:e,initialTab:t=0})=>{const[n,s]=y.useState(t);return r.jsx("div",{style:Ln.overlay,children:r.jsxs("div",{style:Ln.modalWrapper,children:[r.jsx("button",{onClick:e,style:Ln.closeBtn,"aria-label":"",children:""}),r.jsxs("div",{style:Ln.modal,children:[r.jsx("div",{style:Ln.header,children:r.jsx("h3",{children:" "})}),r.jsxs("div",{style:Ln.body,children:[r.jsx("div",{style:Ln.sidebar,children:el.map((o,i)=>r.jsx("div",{onClick:()=>s(i),style:{...Ln.menuItem,background:n===i?"#e0e0e0":"transparent",fontWeight:n===i?"bold":"normal",color:n===i?"#3e2723":"#666"},children:o.title},o.id))}),r.jsxs("div",{style:Ln.content,children:[r.jsx("h4",{style:{marginTop:0,borderBottom:"1px solid #eee",paddingBottom:"10px"},children:el[n].title}),r.jsx("div",{style:{lineHeight:"1.6",fontSize:"14px",color:"#444"},dangerouslySetInnerHTML:{__html:el[n].content}})]})]}),r.jsx("div",{style:Ln.footer,children:n<el.length-1?r.jsx("button",{onClick:()=>s(n+1),style:Ln.nextBtn,children:""}):r.jsx("button",{onClick:e,style:Ln.finishBtn,children:""})})]})]})})},Ln={overlay:{position:"fixed",top:0,left:0,right:0,bottom:0,background:"rgba(0,0,0,0.7)",zIndex:3e3,display:"flex",alignItems:"center",justifyContent:"center"},modalWrapper:{position:"relative",width:"min(600px, calc(100vw - 32px))"},modal:{width:"100%",height:"450px",background:"#fff",borderRadius:"12px",display:"flex",flexDirection:"column",overflow:"hidden",boxShadow:"0 10px 30px rgba(0,0,0,0.3)",position:"relative"},header:{padding:"15px 20px",background:"#3e2723",color:"#fff",display:"flex",justifyContent:"center",alignItems:"center"},closeBtn:{position:"absolute",top:"-18px",left:"-18px",background:"#3e2723",border:"none",color:"#fff",fontSize:"22px",cursor:"pointer",width:"44px",height:"44px",display:"flex",alignItems:"center",justifyContent:"center",borderRadius:"22px",boxShadow:"0 12px 30px rgba(0,0,0,0.25)"},body:{flex:1,display:"flex",overflow:"hidden"},sidebar:{width:"180px",background:"#f5f5f5",borderRight:"1px solid #ddd",overflowY:"auto"},menuItem:{padding:"15px",cursor:"pointer",borderBottom:"1px solid #eee",fontSize:"13px"},content:{flex:1,padding:"20px",overflowY:"auto"},footer:{padding:"10px 20px",borderTop:"1px solid #eee",display:"flex",justifyContent:"flex-end",background:"#fafafa"},nextBtn:{padding:"8px 20px",background:"#2196f3",color:"white",border:"none",borderRadius:"4px",cursor:"pointer"},finishBtn:{padding:"8px 20px",background:"#4caf50",color:"white",border:"none",borderRadius:"4px",cursor:"pointer"}},w5=({gazette:e,onClose:t,history:n=[],playerName:s="",onWorldNpcClick:o})=>{var x;const[i,a]=y.useState("current"),[l,d]=y.useState(null);console.log("GazetteModal props:",{gazette:e,history:n,hasGazette:!!e,historyLength:n.length});const p=S=>{if(!S||!s)return S;const w=new RegExp(`(${s})`,"g");return S.split(w).map((h,g)=>h===s?r.jsx("span",{style:{color:"#b33",fontWeight:"bold"},children:h},g):h)};y.useEffect(()=>{!e&&n.length>0&&a("history")},[e,n]);const c=(i==="current"?e:l)||{issue:"-",year:0,month:"-",headlines:[],powerRanking:[],rumors:[]},u=!e&&n.length===0;return r.jsx("div",{style:Ne.overlay,children:r.jsxs("div",{style:Ne.modalWrapper,children:[r.jsx("button",{onClick:t,style:Ne.closeBtn,"aria-label":"",children:""}),r.jsx("div",{style:Ne.modal,children:u?r.jsxs("div",{style:Ne.emptyState,children:[r.jsx("div",{style:Ne.emptyIcon,children:""}),r.jsx("h3",{style:Ne.emptyTitle,children:""}),r.jsx("p",{style:Ne.emptyText,children:"36912"}),r.jsx("button",{onClick:t,style:Ne.emptyBtn,children:""})]}):r.jsxs(r.Fragment,{children:[r.jsxs("div",{style:Ne.tabBar,children:[r.jsx("button",{onClick:()=>a("current"),style:{...Ne.tab,background:i==="current"?ye.colors.primary:ye.colors.parchment,color:i==="current"?"#fff":ye.colors.ink,opacity:e?1:.5,cursor:e?"pointer":"not-allowed"},disabled:!e,children:" "}),r.jsxs("button",{onClick:()=>a("history"),style:{...Ne.tab,background:i==="history"?ye.colors.primary:ye.colors.parchment,color:i==="history"?"#fff":ye.colors.ink},children:["  (",n.length,")"]})]}),r.jsx("div",{style:Ne.content,children:i==="current"?r.jsxs("div",{style:Ne.newspaper,children:[r.jsxs("div",{style:Ne.header,children:[r.jsx("h1",{style:Ne.title,children:""}),r.jsxs("div",{style:Ne.subtitle,children:["   ",c.issue," "]}),r.jsxs("div",{style:Ne.date,children:[" ",c.year," ",c.month,""]})]}),c.powerRanking&&c.powerRanking.length>0&&r.jsxs("div",{style:Ne.section,children:[r.jsx("h3",{style:Ne.sectionTitle,children:" - "}),r.jsx("div",{style:Ne.ranking,children:c.powerRanking.map((S,w)=>{const C=typeof S=="string"?S:S.displayText,h=typeof S=="object"&&S.worldNpcData&&!S.isPlayer;return r.jsx("div",{style:{...Ne.rankItem,...h?Ne.clickableRankItem:{}},onClick:()=>{h&&o&&o(S.worldNpcData)},children:C},w)})})]}),r.jsxs("div",{style:Ne.section,children:[r.jsx("h3",{style:Ne.sectionTitle,children:""}),r.jsx("div",{style:Ne.newsContent,children:c.headlines&&c.headlines.length>0?c.headlines.map((S,w)=>r.jsxs("p",{style:Ne.newsItem,children:[" ",p(S)]},w)):r.jsx("p",{style:Ne.placeholder,children:""})})]}),c.rumors&&c.rumors.length>0&&r.jsxs("div",{style:Ne.section,children:[r.jsx("h3",{style:Ne.sectionTitle,children:""}),r.jsx("div",{style:Ne.newsContent,children:c.rumors.map((S,w)=>r.jsxs("p",{style:Ne.newsItem,children:[" ",p(S)]},w))})]}),r.jsxs("div",{style:Ne.adSection,children:[r.jsx("div",{style:Ne.ad,children:" "}),r.jsx("div",{style:Ne.ad,children:" "})]})]}):r.jsx("div",{style:Ne.historyView,children:n.length===0?r.jsx("div",{style:Ne.emptyHistory,children:""}):l?r.jsxs("div",{children:[r.jsx("button",{onClick:()=>d(null),style:Ne.backBtn,children:" "}),r.jsxs("div",{style:Ne.newspaper,children:[r.jsxs("div",{style:Ne.header,children:[r.jsx("h1",{style:Ne.title,children:""}),r.jsxs("div",{style:Ne.subtitle,children:[" ",l.issue," "]}),r.jsxs("div",{style:Ne.date,children:[" ",l.year," ",l.month,""]})]}),r.jsxs("div",{style:Ne.section,children:[r.jsx("h3",{style:Ne.sectionTitle,children:""}),r.jsx("div",{style:Ne.newsContent,children:(x=l.headlines)==null?void 0:x.map((S,w)=>r.jsxs("p",{style:Ne.newsItem,children:[" ",S]},w))})]})]})]}):r.jsx("div",{style:Ne.historyList,children:n.map((S,w)=>r.jsxs("div",{style:Ne.historyItem,onClick:()=>d(S),children:[r.jsxs("div",{style:Ne.historyTitle,children:[" ",S.issue," "]}),r.jsxs("div",{style:Ne.historyDate,children:[Math.floor(S.year)," ",S.month,""]})]},w))})})})]})})]})})},Ne={overlay:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0, 0, 0, 0.7)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e3},modalWrapper:{position:"relative",width:"min(800px, calc(100vw - 32px))"},modal:{background:ye.gradients.warm,borderRadius:"16px",maxWidth:"800px",width:"100%",maxHeight:"85vh",overflow:"hidden",position:"relative",boxShadow:"0 8px 32px rgba(0,0,0,0.3)",border:`3px solid ${ye.colors.border}`},closeBtn:{position:"absolute",top:"-20px",left:"-20px",width:"48px",height:"48px",borderRadius:"50%",border:"none",background:"#b33",color:"white",fontSize:"24px",cursor:"pointer",boxShadow:"0 12px 32px rgba(0,0,0,0.25)",fontWeight:"bold"},tabBar:{display:"flex",gap:"10px",padding:"15px 20px",borderBottom:`2px solid ${ye.colors.border}`},tab:{padding:"10px 20px",border:"none",borderRadius:"8px",cursor:"pointer",fontWeight:"bold",fontSize:"14px",transition:"all 0.3s"},content:{padding:"20px",maxHeight:"calc(85vh - 100px)",overflowY:"auto"},newspaper:{background:ye.colors.paper,padding:"30px",borderRadius:"8px",boxShadow:`inset 0 0 20px ${ye.colors.shadow}`,fontFamily:'"Noto Serif SC", "KaiTi", serif'},header:{textAlign:"center",borderBottom:`3px double ${ye.colors.border}`,paddingBottom:"20px",marginBottom:"25px"},title:{fontSize:"36px",color:ye.colors.primary,margin:"0 0 10px 0",letterSpacing:"8px",textShadow:"2px 2px 4px rgba(0,0,0,0.1)"},subtitle:{fontSize:"14px",color:ye.colors.primary,marginBottom:"5px"},date:{fontSize:"12px",color:ye.colors.muted},section:{marginBottom:"25px",padding:"15px",background:ye.gradients.subtle,borderRadius:"8px",border:`1px solid ${ye.colors.border}`},sectionTitle:{fontSize:"20px",color:ye.colors.primary,marginBottom:"15px",borderBottom:`2px solid ${ye.colors.border}`,paddingBottom:"8px"},ranking:{display:"flex",flexDirection:"column",gap:"10px"},rankItem:{fontSize:"16px",padding:"8px",background:ye.colors.paper,borderRadius:"4px",border:`1px solid ${ye.colors.border}`},clickableRankItem:{cursor:"pointer",transition:"all 0.3s",":hover":{background:ye.gradients.subtle,transform:"translateX(5px)",borderColor:ye.colors.primary}},newsContent:{fontSize:"15px",lineHeight:"1.8",color:ye.colors.ink},newsItem:{margin:"10px 0",paddingLeft:"15px",textIndent:"0"},placeholder:{color:"#999",fontStyle:"italic",textAlign:"center"},adSection:{marginTop:"30px",padding:"15px",background:ye.gradients.subtle,borderRadius:"8px",border:`2px dashed ${ye.colors.border}`},ad:{fontSize:"12px",color:ye.colors.primary,marginBottom:"5px"},historyView:{minHeight:"400px"},historyList:{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(150px, 1fr))",gap:"15px"},historyItem:{padding:"20px",background:ye.colors.paper,borderRadius:"8px",border:`2px solid ${ye.colors.border}`,cursor:"pointer",textAlign:"center",transition:"all 0.3s",":hover":{transform:"translateY(-5px)",boxShadow:`0 4px 12px ${ye.colors.shadow}`}},historyTitle:{fontSize:"16px",fontWeight:"bold",color:ye.colors.primary,marginBottom:"8px"},historyDate:{fontSize:"12px",color:ye.colors.primary},emptyHistory:{textAlign:"center",padding:"50px",color:"#999",fontSize:"16px"},backBtn:{marginBottom:"15px",padding:"8px 16px",background:"#8d6e63",color:"white",border:"none",borderRadius:"8px",cursor:"pointer",fontWeight:"bold"},emptyState:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",padding:"80px 40px",minHeight:"400px"},emptyIcon:{fontSize:"80px",marginBottom:"20px",opacity:.5},emptyTitle:{fontSize:"24px",color:ye.colors.primary,marginBottom:"10px"},emptyText:{fontSize:"14px",color:ye.colors.muted,textAlign:"center",lineHeight:"1.6",marginBottom:"30px"},emptyBtn:{padding:"10px 30px",background:ye.colors.primary,color:"white",border:"none",borderRadius:"8px",cursor:"pointer",fontSize:"14px",fontWeight:"bold",transition:"all 0.3s"}},E5=({worldNpc:e,onClose:t,onInvite:n,player:s})=>{var E,I,v;if(!e)return null;const[o,i]=y.useState(""),[a,l]=y.useState(""),[d,p]=y.useState(!1),f=k=>k==="male"||k===""?"":k==="female"||k===""?"":k,c=k=>k?typeof k=="string"?k:typeof k=="object"&&k.name?k.name:"":"",u=()=>{var T;if((T=e.appearance)!=null&&T.description&&typeof e.appearance.description=="string")return e.appearance.description;if(e.gender==="female"||e.gender===""){const A=["","","","",""];return A[Math.floor(Math.random()*A.length)]}else{const A=["","","","",""];return A[Math.floor(Math.random()*A.length)]}},x=y.useMemo(()=>u(),[e==null?void 0:e.id]),S=k=>{if(!k)return"";if(typeof k=="string")return k;if(typeof k=="object"){const T=[k.temperament,k.alignment,k.attitude].filter(Boolean);return T.length>0?T.join(""):""}return""},w=k=>{if(!k)return"";const T=k.rootType||k.type;return T||(Array.isArray(k.elements)&&k.elements.length>0?k.elements.map(A=>typeof A=="object"?A.element:A).join("")+"":"")},C=(k,T)=>{if(typeof k!="number")return"";const A=T==="female"||T==="";return k>=90?A?"":"":k>=80?A?"":"":k>=70?A?"":"":k>=60?"":""},h=y.useMemo(()=>e!=null&&e.id?`tianji_profile_${e.id}`:"",[e==null?void 0:e.id]),g=()=>{var ae;const k=e.name||"",T=e.title||"",A=e.tier||"",R=c(e.sect),$=w(e.spiritRoot),O=S(e.personality);C((ae=e.stats)==null?void 0:ae.looks,e.gender);const Q=x,L=R===""?"":`${R}`,G=`${k}${A}${L}${T}${$}${Q}${O}${e.signature||""}`,ne=`${k}${T}${A}${L}${$}${R===""?"":R}${O}"${e.signature||""}"`;return{summary:G,bio:ne}},b=(k,T)=>{if(!k)return T;const A=k.match(/\{[\s\S]*\}/);if(A)try{const $=JSON.parse(A[0]);if($&&($.summary||$.bio))return{summary:$.summary||T.summary,bio:$.bio||T.bio}}catch{}const R=k.split(`
`).map($=>$.trim()).filter(Boolean);if(R.length>=2){const $=R[0].replace(/^[:]\s*/,""),O=R.slice(1).join(`
`).replace(/^[:]\s*/,"");return{summary:$||T.summary,bio:O||T.bio}}return{summary:k.trim().slice(0,80)||T.summary,bio:T.bio}};return y.useEffect(()=>{var Q;if(!e)return;const k=g();try{if(h){const L=localStorage.getItem(h);if(L){const G=JSON.parse(L);if(G!=null&&G.summary&&G.summary.includes(e.name)){i(G.summary||k.summary),l(G.bio||k.bio);return}}}}catch{}if(i(k.summary),l(k.bio),!(localStorage.getItem("useAIForTianjiProfile")!=="false")){try{h&&localStorage.setItem(h,JSON.stringify(k))}catch{}return}const A=localStorage.getItem("game_api_key")||"",R=localStorage.getItem("game_api_url")||"",$=localStorage.getItem("game_api_model")||"deepseek-chat";if(!A||!R)return;const O={name:e.name,title:e.title||"",tier:e.tier,sect:c(e.sect),spiritRoot:w(e.spiritRoot),personality:S(e.personality),appearance:x,looks:((Q=e.stats)==null?void 0:Q.looks)||0,signature:e.signature||""};p(!0),jc([{role:"system",content:`""""JSON{"summary":"...","bio":"..."}80160


1. nametitletier
2. name
3. """"
4. `},{role:"user",content:`
${O.name}
${O.title}
${O.tier}
${O.sect}
${O.spiritRoot}
${O.personality}
${O.appearance}
${O.signature}

"${O.name}${O.tier}""${O.title}"`}],A,R,{model:$,temperature:.7,maxTokens:260}).then(L=>{const G=b(L,k),ne=G.summary.includes(e.name)?G.summary:k.summary,ae=G.bio.includes(e.name)?G.bio:k.bio;i(ne),l(ae);try{h&&localStorage.setItem(h,JSON.stringify({summary:ne,bio:ae}))}catch{}}).catch(()=>{i(k.summary),l(k.bio)}).finally(()=>p(!1))},[e,h]),e.gender!==s.gender&&e.hasMetPlayer,r.jsx("div",{style:Fe.overlay,onClick:t,children:r.jsxs("div",{style:Fe.modalWrapper,onClick:k=>k.stopPropagation(),children:[r.jsx("button",{onClick:t,style:Fe.closeBtn,"aria-label":"",children:""}),r.jsxs("div",{style:Fe.modal,children:[r.jsxs("div",{style:Fe.header,children:[r.jsxs("h2",{style:Fe.title,children:[e.title&&`${e.title}`,e.name]}),r.jsxs("div",{style:Fe.subtitle,children:["  ",e.tier,"  ",f(e.gender)]})]}),r.jsxs("div",{style:Fe.content,children:[r.jsxs("div",{style:Fe.section,children:[r.jsx("h3",{style:Fe.sectionTitle,children:" "}),r.jsxs("div",{style:Fe.infoGrid,children:[r.jsx(Gs,{label:"",value:e.name}),r.jsx(Gs,{label:"",value:e.title||""}),r.jsx(Gs,{label:"",value:f(e.gender)}),r.jsx(Gs,{label:"",value:e.tier}),r.jsx(Gs,{label:"",value:c(e.sect)}),r.jsx(Gs,{label:"",value:((E=e.spiritRoot)==null?void 0:E.rootType)||((I=e.spiritRoot)==null?void 0:I.type)||""})]})]}),r.jsxs("div",{style:Fe.section,children:[r.jsx("h3",{style:Fe.sectionTitle,children:" "}),r.jsx("div",{style:Fe.statsGrid,children:e.stats&&Object.entries(e.stats).map(([k,T])=>r.jsxs("div",{style:Fe.statItem,children:[r.jsx("span",{style:Fe.statLabel,children:k5(k)}),r.jsx("span",{style:Fe.statValue,children:Math.floor(T)})]},k))})]}),r.jsxs("div",{style:Fe.section,children:[r.jsx("h3",{style:Fe.sectionTitle,children:" "}),r.jsx("p",{style:Fe.description,children:x})]}),r.jsxs("div",{style:Fe.section,children:[r.jsx("h3",{style:Fe.sectionTitle,children:" "}),r.jsx("p",{style:Fe.description,children:o||""}),d&&r.jsx("div",{style:Fe.hintText,children:"AI "})]}),r.jsxs("div",{style:Fe.section,children:[r.jsx("h3",{style:Fe.sectionTitle,children:" "}),r.jsx("p",{style:Fe.description,children:a||""})]}),e.personality&&typeof e.personality=="string"&&r.jsxs("div",{style:Fe.section,children:[r.jsx("h3",{style:Fe.sectionTitle,children:" "}),r.jsx("p",{style:Fe.description,children:e.personality})]}),((v=e.spiritRoot)==null?void 0:v.elements)&&Array.isArray(e.spiritRoot.elements)&&r.jsxs("div",{style:Fe.section,children:[r.jsx("h3",{style:Fe.sectionTitle,children:" "}),r.jsx("div",{style:Fe.elementsGrid,children:e.spiritRoot.elements.map((k,T)=>r.jsx("div",{style:Fe.elementTag,children:typeof k=="object"?`${k.element} ${k.value}`:k},T))})]}),e.gender!==s.gender&&!e.hasMetPlayer&&(e.gender==="male"||e.gender==="")&&r.jsxs("div",{style:Fe.hintBox,children:[r.jsx("div",{style:Fe.hintIcon,children:""}),r.jsx("p",{style:Fe.hintText,children:""})]}),e.hasMetPlayer&&r.jsx("div",{style:Fe.metHint,children:" "})]})]})]})})},Gs=({label:e,value:t})=>{const n=typeof t=="object"&&t!==null?JSON.stringify(t):t??"";return r.jsxs("div",{style:Fe.infoItem,children:[r.jsxs("span",{style:Fe.infoLabel,children:[e,""]}),r.jsx("span",{style:Fe.infoValue,children:n})]})},k5=e=>({attack:"",defense:"",speed:"",hp:"",cultivation:"",atk:"",def:"",spd:"",maxHp:"",aptitude:"",looks:"",intelligence:"",health:""})[e]||e,Fe={overlay:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0, 0, 0, 0.7)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:2e3},modalWrapper:{position:"relative",width:"min(600px, calc(100vw - 32px))",maxHeight:"85vh"},modal:{background:ye.gradients.warm,borderRadius:"16px",width:"100%",maxHeight:"85vh",overflow:"hidden",boxShadow:"0 8px 32px rgba(0,0,0,0.3)",border:`3px solid ${ye.colors.border}`},closeBtn:{position:"absolute",top:"-20px",right:"-20px",width:"48px",height:"48px",borderRadius:"50%",border:"none",background:"#b33",color:"white",fontSize:"24px",cursor:"pointer",boxShadow:"0 4px 12px rgba(0,0,0,0.3)",fontWeight:"bold",zIndex:1},header:{textAlign:"center",padding:"25px 20px",background:"linear-gradient(135deg, #8d6e63 0%, #6d4c41 100%)",color:"white",borderBottom:`3px solid ${ye.colors.border}`},title:{fontSize:"24px",margin:"0 0 8px 0",fontWeight:"bold",textShadow:"2px 2px 4px rgba(0,0,0,0.3)"},subtitle:{fontSize:"14px",opacity:.9},content:{padding:"20px",maxHeight:"calc(85vh - 120px)",overflowY:"auto"},section:{marginBottom:"20px",padding:"15px",background:ye.colors.paper,borderRadius:"8px",border:`1px solid ${ye.colors.border}`},sectionTitle:{fontSize:"16px",color:ye.colors.primary,marginBottom:"12px",paddingBottom:"8px",borderBottom:`2px solid ${ye.colors.border}`},infoGrid:{display:"grid",gridTemplateColumns:"repeat(2, 1fr)",gap:"10px"},infoItem:{fontSize:"14px",padding:"5px"},infoLabel:{color:"#666",marginRight:"5px"},infoValue:{color:ye.colors.ink,fontWeight:"bold"},statsGrid:{display:"grid",gridTemplateColumns:"repeat(3, 1fr)",gap:"10px"},statItem:{display:"flex",flexDirection:"column",alignItems:"center",padding:"10px",background:ye.gradients.subtle,borderRadius:"6px"},statLabel:{fontSize:"12px",color:"#666",marginBottom:"5px"},statValue:{fontSize:"18px",fontWeight:"bold",color:ye.colors.primary},description:{fontSize:"14px",lineHeight:"1.6",color:ye.colors.ink},elementsGrid:{display:"flex",flexWrap:"wrap",gap:"8px"},elementTag:{padding:"6px 12px",background:"linear-gradient(135deg, #fff9e6 0%, #ffe5b4 100%)",border:"1px solid #d4a574",borderRadius:"12px",fontSize:"13px",fontWeight:"bold",color:"#8d6e63"},hintBox:{textAlign:"center",padding:"20px",background:"linear-gradient(135deg, #fff9e6 0%, #ffe5b4 100%)",borderRadius:"12px",border:"2px dashed #d4a574"},hintIcon:{fontSize:"32px",marginBottom:"10px"},hintText:{fontSize:"14px",color:"#8d6e63",lineHeight:"1.6",margin:0},metHint:{textAlign:"center",padding:"15px",background:"#e8f5e9",border:"1px solid #81c784",borderRadius:"8px",color:"#2e7d32",fontSize:"14px",fontWeight:"bold"}},j5=({selectedNpc:e,setSelectedNpc:t,handleOptionSelect:n,player:s,visibleChildren:o,visibleNpcs:i,activeNpcs:a,modalMgr:l,addLog:d,showResult:p,cutTiesWithNpc:f,handleToggleNpcLetterAcceptance:c,messages:u,messageManager:x,setMessages:S,handleSendMessageReply:w,combatData:C,handleCombatClose:h,isExploring:g,exploreRealmState:b,exploreProgress:E,currentExploreEvent:I,exploreLog:v,inventory:k,setExploreLog:T,handleExplorationOption:A,handleStartCombat:R,setExploreProgress:$,setCurrentExploreEvent:O,setIsExploring:Q,getBossEvent:L,getRandomExplorationEvent:G,pendingSectChoices:ne,setPendingSectChoices:ae,handleAssignSect:Y,handleCloseTutorial:q,handleCompleteTutorial:ie,handleCloseGuide:Z,currentGazette:ve,setSelectedWorldNpc:V,selectedWorldNpc:ee,handleInviteWorldNpc:he})=>{var ge;return r.jsxs(r.Fragment,{children:[e&&r.jsx(BE,{npc:e,onClose:()=>t(null),onOptionSelect:n,player:s,children:o,npcs:i,onViewLog:me=>l.openNpcLog(me),onCutTies:me=>{const Me=a.find($e=>$e.id===me);Me&&(f(me),t(null),d(`  ${Me.name} `),p("",` ${Me.name} `,!0))},onToggleLetterAcceptance:c}),l.npcLogModal.open&&l.npcLogModal.npc&&r.jsx(h5,{npc:l.npcLogModal.npc,playerAffection:((ge=l.npcLogModal.npc.relationship)==null?void 0:ge.affection)||0,onClose:()=>l.closeNpcLog()}),r.jsx(Kk,{isOpen:l.showMessageCenter,onClose:()=>l.closeMessageCenter(),messages:u,onMarkAsRead:me=>{x.markAsRead(me),S(x.getAllMessages())},onDeleteMessage:me=>{x.deleteMessage(me),S(x.getAllMessages())},onSendReply:w}),C&&r.jsx(g5,{player:s,enemy:C.enemy,result:C.result,onClose:h}),g&&r.jsx(y5,{open:g,realmName:b.name,progress:E,total:b.total,event:I,log:v,optionContext:{player:s,inventory:k,realmId:b.id,progress:E},onSelectOption:A,onStartCombat:R,onNext:()=>{if(E>=b.total){T($e=>[...$e,""]),Q(!1),p("","",!0,null,!1);return}const me=E+1;$(me);const Me=me===b.total?L(b.id):G({realmId:b.id,progress:me});O(Me),T($e=>[...$e,` (${me}/${b.total})`])},onClose:()=>{Q(!1),T(me=>[...me,""])}}),ne.length>0&&r.jsx(b5,{event:ne[0],onClose:()=>ae(me=>me.slice(1)),onAssign:Y}),l.showTutorial&&r.jsx(v5,{onClose:q,onComplete:ie}),l.showGuide&&r.jsx(S5,{onClose:Z}),l.showGazette&&r.jsx(w5,{gazette:ve,history:s.gazetteHistory||[],playerName:s.name,onClose:()=>l.closeGazette(),onWorldNpcClick:me=>{V(me)}}),ee&&r.jsx(E5,{worldNpc:ee,player:s,onClose:()=>V(null),onInvite:he})]})};class C5 extends ic.Component{constructor(n){super(n);Zf(this,"handleReset",()=>{this.setState({hasError:!1,error:null,errorInfo:null})});this.state={hasError:!1,error:null,errorInfo:null}}static getDerivedStateFromError(n){return{hasError:!0}}componentDidCatch(n,s){console.error("[] :",n),console.error("[] :",s),this.setState({error:n,errorInfo:s})}render(){var n;return this.state.hasError?r.jsxs("div",{style:{padding:"20px",margin:"20px",backgroundColor:"#ffebee",border:"2px solid #f44336",borderRadius:"8px",textAlign:"center",fontFamily:"Arial, sans-serif"},children:[r.jsx("h2",{style:{color:"#c62828",margin:"0 0 12px 0"},children:" "}),r.jsx("p",{style:{color:"#d32f2f",margin:"8px 0",fontSize:"14px"},children:((n=this.state.error)==null?void 0:n.message)||""}),!1,r.jsx("button",{onClick:this.handleReset,style:{marginTop:"12px",padding:"8px 16px",backgroundColor:"#2196f3",color:"#fff",border:"none",borderRadius:"4px",cursor:"pointer",fontSize:"14px",fontWeight:"bold"},children:" "})]}):this.props.children}}const T5=({options:e,currentSort:t,onSortChange:n})=>{const s=o=>{typeof n=="function"?n(o):console.warn("SortBar: onSortChange is not a function",{onSortChange:n,value:o})};return r.jsxs("div",{style:xi.container,children:[r.jsx("span",{style:xi.label,children:" :"}),r.jsx("div",{style:xi.buttonGroup,children:e.map(o=>r.jsx("button",{type:"button",onClick:()=>s(o.value),style:{...xi.button,...t===o.value?xi.buttonActive:{}},children:o.label},o.value))})]})},xi={container:{display:"flex",alignItems:"center",justifyContent:"flex-end",padding:"5px 10px",marginBottom:"10px",background:"#f5f5f5",borderRadius:"4px",fontSize:"12px"},label:{color:"#666",marginRight:"8px",fontWeight:"bold"},buttonGroup:{display:"flex",gap:"6px",flexWrap:"wrap"},button:{border:"1px solid #ccc",borderRadius:"999px",padding:"4px 10px",fontSize:"12px",cursor:"pointer",backgroundColor:"white",color:"#333",transition:"all 0.2s ease"},buttonActive:{backgroundColor:"#1976d2",color:"#fff",borderColor:"#1976d2",boxShadow:"0 2px 6px rgba(25,118,210,0.4)"}};function I5({player:e,inventory:t,children:n,exploreRealmState:s,exploreProgress:o,exploreTeamIds:i,setPlayer:a,setExploreLog:l,setCombatData:d,addNpc:p,addItemsToInventory:f,inventoryMgr:c,calculateDynamicCombatStats:u,simulateCombat:x,generateRealmEnemy:S}){const w=y.useCallback(()=>{var k,T;const v=of(e);if(!v.canExplore){if(((k=e.stats)==null?void 0:k.health)<20)return l(A=>[...A,` ${Math.floor(e.stats.health)}/100`]),!1;((T=e.stats)==null?void 0:T.health)<30&&l(A=>[...A,` 30${Math.floor(e.stats.health)}/100`])}return v.canExplore},[e,l]),C=y.useCallback(v=>{if(!w())return;const k={player:e,inventory:t,realmId:s.id,progress:o};if(v.condition&&!v.condition(k)){l(A=>[...A,""]);return}const T=v.action?v.action(k):{type:"LOG",msg:""};switch(T.type){case"START_COMBAT":h();break;case"LOOT":g(T);break;case"NPC_JOIN":b(T);break;case"HP_CHANGE":E(T);break;case"EXP_GAIN":I(T);break;case"LOG":case"NONE":default:l(A=>[...A,T.msg||""]);break}},[e,t,s.id,o,l]),h=y.useCallback(()=>{const v=S(s.id,o),k={...e,combatStats:e.combatStats||{maxHp:100,maxMp:50,atk:10,def:5,hp:100,mp:50}},T=i.map(R=>n.find($=>$.id===R)).filter(Boolean).map(R=>({...R,combatStats:R.combatStats||{maxHp:100,maxMp:50,atk:10,def:5,hp:100,mp:50}})),A=x(k,v,T);d({enemy:v,result:A,context:"exploration"})},[e,n,i,s.id,o,S,x,d]),g=y.useCallback(v=>{const T=f(v.items||[]).map(R=>R.name).filter(Boolean).join(", "),A=[];v.msg&&A.push(v.msg),T&&A.push(`${T}`),A.length>0&&l(R=>[...R,...A])},[f,l]),b=y.useCallback(v=>{if(p(v.npc),v.removeItemId){const k=t.find(T=>T.id===v.removeItemId);k&&c.setInventory(T=>T.filter(A=>A.instanceId!==k.instanceId))}l(k=>[...k,v.msg||""])},[p,t,c,l]),E=y.useCallback(v=>{const k=v.hpDelta||0;if(k<0){const T=Math.abs(k),A=ko(e,T,"EXPLORATION");a($=>({...$,stats:{...$.stats,health:A.newHealth}}));const R=[];R.push(A.message),v.msg&&v.msg!==""&&R.push(v.msg),l($=>[...$,...R])}else a(T=>{var A,R;return{...T,stats:{...T.stats,health:Math.max(1,Math.min(100,(((A=T.stats)==null?void 0:A.health)||50)+Math.floor(k/(((R=T.combatStats)==null?void 0:R.maxHp)||100)*100)))}}}),l(T=>[...T,v.msg||(k<0?"":"")])},[e,a,l]),I=y.useCallback(v=>{a(k=>{const T={...k,currentExp:(k.currentExp||0)+(v.amount||0)};return{...T,combatStats:u(T)}}),l(k=>[...k,v.msg||""])},[a,u,l]);return{handleExplorationOption:C,handleStartCombat:h,checkExplorationHealth:w}}function _5({player:e,children:t,exploreRealmState:n,applyCombatResult:s,addLog:o,setCombatData:i,setExploreLog:a,batchUpdateChildren:l,archiveChildDeaths:d,addItemsToInventory:p,setIsExploring:f}){const c=y.useCallback(C=>{if(!C)return;const{success:h,remainingHp:g}=C.result;if((C.context||"rival")==="rival"){u(h,g),i(null);return}h?x(C):S(C),i(null)},[e,t,n]),u=y.useCallback((C,h)=>{var g;if(C){const b=Math.floor((1-h/(((g=e.combatStats)==null?void 0:g.maxHp)||100))*100),E=Math.max(5,Math.floor(b/5));s({won:!0,spiritStones:500,healthDamage:E,injurySource:"DUEL"}),o("  500 ")}else{const b=ko(e,40,"DUEL");s({won:!1,expGain:-e.currentExp,spiritStones:-Math.floor(e.resources.spiritStones*.5),health:b.newHealth}),o(` ...
`+b.message)}},[e,s,o]),x=y.useCallback(C=>{var I;const h=((I=C.enemy)==null?void 0:I.drops)||[],g=h.length?h[Math.floor(Math.random()*h.length)]:null,b=g?p([g]):[],E=b.length?`${b.map(v=>v.name).join(", ")}`:"";if(a(v=>[...v,`${E}`]),C.result.party&&Array.isArray(C.result.party)){const v=[];C.result.party.forEach(k=>{k.currentHp<=0&&v.push({id:k.id,name:k.name,deathReason:`${n.name}`})}),v.length>0&&w(v)}},[p,a,n.name]),S=y.useCallback(C=>{const h=ko(e,35,"EXPLORATION");if(a(g=>[...g,"",h.message," ..."]),s({won:!1,expGain:-e.currentExp,spiritStones:-Math.floor(e.resources.spiritStones*.5),health:h.newHealth}),C.result.party&&Array.isArray(C.result.party)){const g=[];C.result.party.forEach(b=>{var I;const E=b.currentHp/(((I=b.combatStats)==null?void 0:I.maxHp)||100);(E<=0||E<.3&&Math.random()<.5)&&g.push({id:b.id,name:b.name,deathReason:`${n.name}`})}),g.length>0&&w(g)}f(!1)},[e,a,n.name,f,s,l]),w=y.useCallback(C=>{const h=C.map(b=>b.id);l(b=>h.includes(b.id)?null:b),C.forEach(b=>{const E=t.find(I=>I.id===b.id);E&&(d([{...E,deathReason:b.deathReason}],t),o(` ${b.name} ${b.deathReason} ${Math.floor(E.age||0)} `))});const g=C.map(b=>b.name).join("");a(b=>[...b,` ${g} `])},[t,l,d,o,a]);return{handleCombatClose:c}}function ff(e,t){if(!e)return e;const n={...e,stats:{...e.stats||{},aptitude:t}};try{if(n.isTested||n.spiritRoot&&Array.isArray(n.spiritRoot.elements)){const s=qn(t,n.spiritRoot,null,{constitution:n.constitution});n.spiritRoot=s}}catch{}return n}function R5(e,t){return ff(e,t)}function M5({player:e,inventory:t,activeNpcs:n,modalState:s,setModalState:o,removeItemFromInventory:i,updateNpc:a,setActiveNpcs:l,batchUpdateNpcsByMap:d,setSelectedNpc:p,showResult:f,addLog:c,handleWitnessCheck:u,pushToNewsBuffer:x,isUsageAllowedForTarget:S,RESOURCE_USAGE:w,formatUsageTargets:C}){const h=y.useCallback(I=>{var he,ge,me,Me;const v=s.data;if(!v){console.warn("No NPC found in modalState.data");return}const k=t.find($e=>$e.instanceId===(I==null?void 0:I.instanceId));if(!k){f("","",!1,null,!1,{category:"",type:"GIFT",title:"",message:"",details:"",forceManual:!0});return}if(!S(k,w.NPC)){f("",`${k.name||""}  ${C(k)} `,!1,null,!1,{category:"",type:"GIFT",title:"",message:"",details:`${k.name||""} `,forceManual:!0});return}const T={...k};i(k.instanceId);let R={common:5,uncommon:10,rare:20,epic:35,legendary:50}[T.rarity]||5;T.type==="consumable"&&(R+=5),(T.type==="weapon"||T.type==="armor")&&(R+=3);const $=v.identity==="",O=v.identity==="",Q=v.identity==="";($||O||Q)&&(T.rarity==="common"||T.rarity==="uncommon")&&(R=0);const L=Math.min(R,50),G=v.gender===""?"":"",ne=L>15?"":L>8?"":"",ae=" "+T.name+"  "+v.name+""+G+ne+"",q=bk(v,T).description||ae,ie=v.relationship||{affection:0,trust:0};let Z={...v,relationship:{...ie,affection:Math.min(100,(ie.affection||0)+L)}},ve="",V=null;if(T.type==="consumable"&&T.effect){const $e=T.effect||{};if($e.kind==="exp"){const je=bn(Z.tier||""),ct=Z.maxExp||(je==null?void 0:je.maxExp)||0,vt=$e.amount||0;if(Z={...Z,currentExp:(Z.currentExp||0)+vt,maxExp:ct||Z.maxExp},Z.combatStats=Pn(Z),ve=`${v.name} +${vt}`,V={:vt},Z.maxExp&&Z.currentExp>=Z.maxExp){const De=ry(Z,e,e.time.year,e.time.month);Z=De.npc,Z.combatStats=Pn(Z),De.events&&De.events.length>0&&(ve+=`${De.events[0].message}`)}}else if($e.kind==="aptitude"){const je=$e.amount||0;try{Z=ff(Z,Math.min(100,(((he=Z.stats)==null?void 0:he.aptitude)||50)+je))}catch{Z={...Z,stats:{...Z.stats,aptitude:Math.min(100,(((ge=Z.stats)==null?void 0:ge.aptitude)||50)+je)}}}Z.combatStats=Pn(Z),ve=`${v.name} +${je}`,V={:je}}else if($e.kind==="heal"){const je=$e.amount||0,ct=Math.min(100,(((me=Z.stats)==null?void 0:me.health)||100)+je);Z={...Z,stats:{...Z.stats,health:ct}},ve=`${v.name} +${je}`,V={:je}}}Z=dE(Z,e,Math.floor(e.age),e.time.month,T.name),Z=wi(Z),Lr.onReceiveGift(Z,{name:T.name},L),a(v.id,Z);const ee=ve?`${q}

${ve}`:q;f("",ee,!0,{:L,...V||{}},!1,{category:"",type:"GIFT",title:`-${v.name}`,message:`${v.name}`,details:ee,forceManual:!0}),u(v,"GIFT"),((Me=v.relationship)==null?void 0:Me.affection)>=60&&Math.random()<.3&&x(e.newsBuffer,"NPC_PURSUIT",{actor:e.name,target:v.name}),o({type:null,data:null})},[s,t,e,i,a,f,u,x,o]),g=y.useCallback(I=>{var O,Q,L;const v=s.data;if(!v){console.warn("No NPC found in modalState.data");return}const k=v.identity==="",T=(v.dualCultivationCount||0)>0;if(k&&!T){const G=`${v.name}"..."`;f("",G,!1,null,!1);return}let A=((O=v.relationship)==null?void 0:O.affection)||0;I.strongAgainst.includes(((Q=v.personality)==null?void 0:Q.label)||"")?A+=30:I.weakAgainst.includes(((L=v.personality)==null?void 0:L.label)||"")&&(A-=20);const R=Math.random()*100<A,$=Nk(v,I,R);if(R){const G=mE(v,e,Math.floor(e.age),e.time.month);Lr.onPregnancyStart(G),l(ne=>ne.map(ae=>ae.id===v.id?{...G,isPregnant:!0,pregnancyProgress:0}:ae)),f("",$,!0,null,!1)}else f("",$,!1,null,!1)},[s,e,l,f]),b=y.useCallback((I,v)=>{let k=v;v.check&&(k=v.check(e)?v.success:v.fail);const T=(k==null?void 0:k.change)||{},A=(k==null?void 0:k.result)||v.result,R=n.find(O=>O.id===I);if(R){const O=R.relationship||{affection:0,trust:0,jealousy:0,stage:0},Q={...O};T.affection!==void 0&&(Q.affection=Math.min(100,Math.max(0,(Q.affection||0)+T.affection))),T.trust!==void 0&&(Q.trust=Math.min(100,Math.max(0,(Q.trust||0)+T.trust))),T.jealousy!==void 0&&(Q.jealousy=Math.min(100,Math.max(0,(Q.jealousy||0)+T.jealousy)));let L=O.stage||0;if(T.stageUp){const G=Q.affection||0;G>=80?L=3:G>=50?L=2:G>=20?L=1:L=0}a(I,{relationship:{...Q,stage:L}})}const $=(k==null?void 0:k.msg)||"";c(`${$}`),f("",$,A==="good",{:T.affection||0,:T.trust||0,:T.jealousy||0},!1),p(null)},[e,n,a,c,f,p]),E=y.useCallback(I=>{const v=s.data;if(!v)return;const k=Wk(v,I,e),T=new Map;k.changes.forEach(A=>{var ae,Y,q;const R=n.find(ie=>ie.id===A.npcId);if(!R)return;const $=((ae=R.relationship)==null?void 0:ae.jealousy)||0,O=((Y=R.relationship)==null?void 0:Y.affection)||0,Q=Math.min(100,Math.max(0,$+A.jealousyChange)),L=Math.min(100,Math.max(0,O+A.affectionChange)),G=(q=k.npcLogs)==null?void 0:q.find(ie=>ie.npcId===R.id);let ne={...R,relationship:{...R.relationship,jealousy:Q,affection:L}};if(G){const ie=ne.logs||[],Z={year:e.time.year,month:e.time.month,content:G.content,type:G.type||"DAILY",isSecret:G.isSecret||!1,timestamp:Date.now()};ne={...ne,logs:[Z,...ie].slice(0,50)}}T.set(A.npcId,ne)}),d(T),c(` ${k.message}`),f("",k.message,!0,{},!1),o({type:null,data:null})},[s,e,n,d,c,f,o]);return{handleGiftConfirm:h,handleNegotiateConfirm:g,handleOptionSelect:b,handleShuraFieldSelect:E}}function A5({player:e,onBreakthroughClick:t}){const n=Math.min(100,e.currentExp/e.maxExp*100),s=Math.min(100,(e.energy||0)/20*100),o=e.currentExp>=e.maxExp&&e.maxExp>0;return r.jsxs("div",{style:or.cultivationSection,children:[r.jsxs("div",{style:or.expContainer,children:[r.jsx("div",{style:or.expLabel,children:""}),r.jsxs("div",{style:or.expBar,children:[r.jsx("div",{style:{...or.expBarFill,width:`${n}%`,background:o?"linear-gradient(90deg, #ff6f00 0%, #ff8f00 100%)":"linear-gradient(90deg, #76ff03 0%, #64dd17 100%)"}}),r.jsxs("span",{style:or.expText,children:[e.currentExp," / ",e.maxExp]})]}),r.jsxs("div",{style:{marginTop:8},children:[r.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:6},children:[r.jsx("div",{style:{fontSize:12,color:"#666"},children:""}),r.jsxs("div",{style:or.energyText,children:[e.energy||0," / 20"]})]}),r.jsx("div",{style:or.energyBar,children:r.jsx("div",{style:{...or.energyFill,width:`${s}%`}})})]})]}),o&&r.jsx("button",{onClick:t,style:or.breakthroughBtn,children:" "})]})}const or={cultivationSection:{display:"flex",alignItems:"center",gap:"15px",padding:"15px 20px",background:"linear-gradient(135deg, #ffffff 0%, #f5f5f5 100%)",borderBottom:"2px solid #e0e0e0",boxShadow:"0 2px 4px rgba(0,0,0,0.05)"},expContainer:{flex:1,minWidth:0},expLabel:{fontSize:"13px",fontWeight:"600",color:"#555",marginBottom:"6px"},expBar:{position:"relative",height:"24px",background:"#e0e0e0",borderRadius:"12px",overflow:"hidden",boxShadow:"inset 0 2px 4px rgba(0,0,0,0.1)"},expBarFill:{position:"absolute",top:0,left:0,height:"100%",transition:"width 0.3s ease, background 0.3s ease",boxShadow:"0 0 8px rgba(118, 255, 3, 0.4)"},expText:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",fontSize:"11px",fontWeight:"700",color:"#333",textShadow:"0 1px 2px rgba(255,255,255,0.8)",zIndex:1},energyBar:{position:"relative",height:"14px",background:"#e0e0e0",borderRadius:"7px",overflow:"hidden",boxShadow:"inset 0 1px 3px rgba(0,0,0,0.1)"},energyFill:{height:"100%",background:"linear-gradient(90deg, #29b6f6 0%, #0288d1 100%)",borderRadius:"7px",transition:"width 0.3s ease",boxShadow:"0 0 6px rgba(41, 182, 246, 0.3)"},energyText:{fontSize:"11px",color:"#666",fontWeight:"500"},breakthroughBtn:{padding:"10px 20px",background:"linear-gradient(135deg, #ff6f00 0%, #ff8f00 100%)",color:"white",border:"none",borderRadius:"8px",fontSize:"14px",fontWeight:"600",cursor:"pointer",boxShadow:"0 4px 8px rgba(255, 111, 0, 0.3)",transition:"all 0.2s",animation:"pulse 2s infinite",whiteSpace:"nowrap"}};function N5({player:e,visibleChildren:t,pregnantNpcs:n,fallenChildren:s,exiledChildren:o=[],onChildClick:i,onToggleFavorite:a,onMemorialClick:l}){return r.jsxs("div",{style:ch.tabContent,children:[r.jsx(UE,{player:e,children:t,pregnantNpcs:n,fallenChildren:s,exiledChildren:o,onChildClick:i,onToggleFavorite:a,onMemorialClick:l}),r.jsxs("div",{style:ch.statsBar,children:[": ",t.length+1," | : ",t.filter(d=>d.generation>1).length]})]})}const ch={tabContent:{flex:1,overflow:"auto",background:"#fafafa"},statsBar:{padding:"15px",textAlign:"center",fontSize:"13px",color:"#555",borderTop:"1px dashed #e0e0e0",marginTop:"15px"}};function L5({isAuto:e,autoSpeed:t,player:n,messageUnreadCount:s,onToggleAuto:o,onSetAutoSpeed:i,onNextMonth:a,onOpenGazette:l,onOpenMessageCenter:d,onMarkGazetteRead:p}){return r.jsxs(r.Fragment,{children:[r.jsxs("div",{style:$n.fabContainer,children:[e&&r.jsxs("div",{style:$n.speedSelector,children:[r.jsx("button",{onClick:()=>i(.3),style:{...$n.speedBtn,backgroundColor:t===.3?"#4CAF50":"#e0e0e0",color:t===.3?"white":"#666"},children:"0.3"}),r.jsx("button",{onClick:()=>i(1),style:{...$n.speedBtn,backgroundColor:t===1?"#4CAF50":"#e0e0e0",color:t===1?"white":"#666"},children:"1"}),r.jsx("button",{onClick:()=>i(3),style:{...$n.speedBtn,backgroundColor:t===3?"#4CAF50":"#e0e0e0",color:t===3?"white":"#666"},children:"3"})]}),r.jsx("button",{onClick:o,style:{...$n.autoBtn,backgroundColor:e?"#76ff03":"#e0e0e0",color:e?"#33691e":"#757575"},children:e?" ":" "}),r.jsx("button",{onClick:()=>a(!1),style:{...$n.fabBtn,transform:e?"scale(0.9)":"scale(1)",opacity:e?.8:1},disabled:e,children:e?r.jsx("div",{style:$n.spinner,children:""}):r.jsxs(r.Fragment,{children:[r.jsx("span",{style:{fontSize:"18px"},children:""}),r.jsx("span",{style:{fontSize:"9px"},children:""})]})})]}),r.jsxs("button",{onClick:()=>{l(),p()},style:$n.gazetteBtn,title:"",children:["",n.hasUnreadGazette&&r.jsx("span",{style:$n.redDot})]}),r.jsxs("button",{onClick:d,style:$n.messageCenterBtn,title:" - ",children:["",s>0&&r.jsx("span",{style:$n.redDot,children:s})]})]})}const $n={fabContainer:{position:"fixed",bottom:"76px",right:"20px",display:"flex",flexDirection:"column",alignItems:"flex-end",gap:"12px",zIndex:99},speedSelector:{display:"flex",gap:"6px",padding:"8px",background:"rgba(255,255,255,0.95)",borderRadius:"20px",boxShadow:"0 4px 12px rgba(0,0,0,0.15)"},speedBtn:{padding:"6px 12px",border:"none",borderRadius:"12px",fontSize:"12px",fontWeight:"600",cursor:"pointer",transition:"all 0.2s",minWidth:"45px"},autoBtn:{padding:"10px 18px",border:"none",borderRadius:"20px",fontSize:"13px",fontWeight:"600",cursor:"pointer",boxShadow:"0 4px 12px rgba(0,0,0,0.15)",transition:"all 0.2s"},fabBtn:{width:"60px",height:"60px",borderRadius:"50%",border:"none",background:"linear-gradient(135deg, #8b7355 0%, #a0826d 100%)",color:"#fff",fontSize:"14px",fontWeight:"600",cursor:"pointer",boxShadow:"0 6px 20px rgba(139, 115, 85, 0.3)",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",gap:"2px",transition:"all 0.2s"},spinner:{fontSize:"24px",animation:"spin 2s linear infinite"},gazetteBtn:{position:"fixed",bottom:"76px",left:"20px",width:"50px",height:"50px",borderRadius:"50%",border:"none",background:"linear-gradient(135deg, #8b6f47 0%, #a0916f 100%)",color:"#fff",fontSize:"24px",cursor:"pointer",boxShadow:"0 4px 12px rgba(139, 111, 71, 0.3)",zIndex:99,transition:"all 0.2s"},messageCenterBtn:{position:"fixed",bottom:"136px",left:"20px",width:"50px",height:"50px",borderRadius:"50%",border:"none",background:"linear-gradient(135deg, #c9b5a0 0%, #d4c9c1 100%)",color:"#4a3728",fontSize:"24px",cursor:"pointer",boxShadow:"0 4px 12px rgba(201, 181, 160, 0.3)",zIndex:99,transition:"all 0.2s"},redDot:{position:"absolute",top:"0",right:"0",width:"18px",height:"18px",background:"#f44336",color:"white",borderRadius:"50%",fontSize:"10px",fontWeight:"700",display:"flex",alignItems:"center",justifyContent:"center",border:"2px solid white",boxShadow:"0 2px 4px rgba(0,0,0,0.2)"}},$5=[{value:"DEFAULT",label:" ()"},{value:"AFFECTION_DESC",label:" ()"},{value:"APTITUDE_DESC",label:" ()"},{value:"TRUST_DESC",label:" ()"}],B5=({sortedNpcs:e,pagedNpcs:t,deadNpcs:n,npcSort:s,npcPage:o,npcPageCount:i,hasNpcPagination:a,showFollowedOnly:l,onExplore:d,onSortChange:p,onToggleFollowedOnly:f,onPrevPage:c,onNextPage:u,onNpcInteract:x,onNpcAction:S})=>r.jsxs("div",{style:{padding:"15px",maxWidth:"800px",margin:"0 auto",paddingBottom:"80px"},children:[r.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"15px"},children:[r.jsxs("h2",{style:{margin:0,color:"#5d4037"},children:[" ",e.length,""]}),r.jsx("button",{onClick:d,style:{padding:"8px 16px",backgroundColor:"#8d6e63",color:"white",border:"none",borderRadius:"8px",cursor:"pointer",fontSize:"14px"},children:" "})]}),r.jsxs("div",{style:{marginBottom:"15px"},children:[r.jsx(T5,{options:$5,currentSort:s,onSortChange:p}),r.jsx("div",{style:{marginTop:"10px"},children:r.jsxs("label",{style:{fontSize:"14px",color:"#666",cursor:"pointer",userSelect:"none"},children:[r.jsx("input",{type:"checkbox",checked:l,onChange:w=>f(w.target.checked),style:{marginRight:"6px"}})," NPC"]})})]}),r.jsxs("div",{children:[t.length===0?r.jsx("div",{style:{textAlign:"center",padding:"40px",color:"#999",fontSize:"14px"},children:""}):r.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(280px, 1fr))",gap:"12px"},children:t.map(w=>r.jsx(vm,{npc:w,onInteract:(C,h)=>{S?S(C,h):h==="DETAIL"&&x(w)}},w.id))}),a&&r.jsxs("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",gap:"15px",marginTop:"20px"},children:[r.jsx("button",{onClick:c,disabled:o===0,style:{padding:"8px 16px",border:"1px solid #ccc",borderRadius:"8px",backgroundColor:o===0?"#f5f5f5":"white",cursor:o===0?"not-allowed":"pointer",fontSize:"14px"},children:""}),r.jsxs("span",{style:{fontSize:"14px",color:"#666"},children:[" ",o+1," / ",i," "]}),r.jsx("button",{onClick:u,disabled:o>=i-1,style:{padding:"8px 16px",border:"1px solid #ccc",borderRadius:"8px",backgroundColor:o>=i-1?"#f5f5f5":"white",cursor:o>=i-1?"not-allowed":"pointer",fontSize:"14px"},children:""})]})]}),n.length>0&&r.jsxs("div",{style:{marginTop:"30px"},children:[r.jsxs("h3",{style:{color:"#999",fontSize:"16px",marginBottom:"15px"},children:[" ",n.length,""]}),r.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(280px, 1fr))",gap:"12px",opacity:.6},children:n.map(w=>r.jsx(vm,{npc:w,actions:r.jsx("button",{onClick:()=>x(w),style:{width:"100%",padding:"8px",border:"1px solid #ccc",borderRadius:"6px",backgroundColor:"#f5f5f5",color:"#999",cursor:"pointer",fontSize:"14px"},children:""})},w.id))})]})]}),O5=({player:e,children:t,showBizPanel:n,showChallengePanel:s,idleManagerOptions:o,onDailyAction:i,onShopping:a,onOpenInventory:l,onBuyBusiness:d,onExploreRealm:p,onOpenAuction:f,onCloseBizPanel:c,onCloseChallengePanel:u,onOpenBizPanel:x,onOpenChallengePanel:S})=>{const w=((e.time.year-3572)*12+e.time.month)%36===0;return r.jsx("div",{style:{padding:"15px",maxWidth:"800px",margin:"0 auto",paddingBottom:"80px"},children:n?r.jsxs("div",{children:[r.jsx("button",{onClick:c,style:{padding:"8px 16px",marginBottom:"15px",border:"1px solid #ccc",borderRadius:"8px",backgroundColor:"white",cursor:"pointer",fontSize:"14px"},children:" "}),r.jsx(dj,{player:e,children:t,managerOptions:o,onBuy:d})]}):s?r.jsxs("div",{children:[r.jsx("button",{onClick:u,style:{padding:"8px 16px",marginBottom:"15px",border:"1px solid #ccc",borderRadius:"8px",backgroundColor:"white",cursor:"pointer",fontSize:"14px"},children:" "}),r.jsx(uj,{player:e,children:t,onChallenge:p})]}):r.jsxs("div",{children:[r.jsx("h2",{style:{margin:"0 0 20px 0",color:"#5d4037"},children:""}),r.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"10px",marginBottom:"30px"},children:[r.jsx("button",{onClick:()=>i("CULTIVATE"),style:{padding:"12px 20px",border:"none",borderRadius:"8px",backgroundColor:"#8d6e63",color:"white",cursor:"pointer",fontSize:"16px",fontWeight:"bold"},children:" (+10-15)"}),r.jsx("button",{onClick:()=>i("WORK"),style:{padding:"12px 20px",border:"none",borderRadius:"8px",backgroundColor:"#8d6e63",color:"white",cursor:"pointer",fontSize:"16px",fontWeight:"bold"},children:" (+15)"}),r.jsx("button",{onClick:a,style:{padding:"12px 20px",border:"none",borderRadius:"8px",backgroundColor:"#8d6e63",color:"white",cursor:"pointer",fontSize:"16px",fontWeight:"bold"},children:" (-10)"}),r.jsx("button",{onClick:()=>l("SELL"),style:{padding:"12px 20px",border:"none",borderRadius:"8px",backgroundColor:"#8d6e63",color:"white",cursor:"pointer",fontSize:"16px",fontWeight:"bold"},children:" ()"})]}),r.jsxs("div",{style:{marginTop:"30px",borderTop:"1px dashed #ccc",paddingTop:"20px"},children:[r.jsx("h3",{style:{margin:"0 0 15px 0",color:"#5d4037"},children:" "}),r.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(140px, 1fr))",gap:"15px"},children:[r.jsxs("button",{onClick:x,style:{padding:"20px",border:"2px solid #8d6e63",borderRadius:"12px",backgroundColor:"white",cursor:"pointer",display:"flex",flexDirection:"column",alignItems:"center",gap:"10px",transition:"all 0.2s"},children:[r.jsx("div",{style:{fontSize:"36px"},children:""}),r.jsx("div",{style:{fontSize:"14px",fontWeight:"bold",color:"#5d4037"},children:""})]}),r.jsxs("button",{onClick:S,style:{padding:"20px",border:"2px solid #8d6e63",borderRadius:"12px",backgroundColor:"white",cursor:"pointer",display:"flex",flexDirection:"column",alignItems:"center",gap:"10px",transition:"all 0.2s"},children:[r.jsx("div",{style:{fontSize:"36px"},children:""}),r.jsx("div",{style:{fontSize:"14px",fontWeight:"bold",color:"#5d4037"},children:""})]}),r.jsxs("button",{onClick:f,style:{padding:"20px",border:"2px solid #8d6e63",borderRadius:"12px",backgroundColor:"white",cursor:"pointer",display:"flex",flexDirection:"column",alignItems:"center",gap:"10px",transition:"all 0.2s",opacity:w?1:.6},children:[r.jsx("div",{style:{fontSize:"36px"},children:""}),r.jsx("div",{style:{fontSize:"14px",fontWeight:"bold",color:"#5d4037"},children:""}),r.jsx("div",{style:{fontSize:"10px",color:"#999"},children:""})]})]})]})]})})},dh=["","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","",""],P5=["","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","",""],z5=["","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","",""],uh=["","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","",""],ph=["","","","","","","","","","","","","","","","","","","",""];function jy(e){const t=dh[Math.floor(Math.random()*dh.length)],n=e==="male"?P5:z5;if(Math.random()>.3){const o=n[Math.floor(Math.random()*n.length)],i=n[Math.floor(Math.random()*n.length)];return t+o+i}else{const o=n[Math.floor(Math.random()*n.length)];return t+o}}function Cy(e){const t=uh[Math.floor(Math.random()*uh.length)],n=ph[Math.floor(Math.random()*ph.length)];if(e.includes("")||e.includes("")){const s=["","","","",""];return s[Math.floor(Math.random()*s.length)]+n}else if(e.includes("")||e.includes("")){const s=["","","","",""];return s[Math.floor(Math.random()*s.length)]+n}return t+n}function D5(e=30){const t=[],n=new Set,s={:Math.floor(e*.03),:Math.floor(e*.03),:Math.floor(e*.04),:Math.floor(e*.05),:Math.floor(e*.05),:Math.floor(e*.07),:Math.floor(e*.07),:Math.floor(e*.1),:Math.floor(e*.1),:Math.floor(e*.13),:Math.floor(e*.16),:Math.floor(e*.17)};let o=1;return["","","","","","","","","","","",""].forEach(a=>{const l=s[a]||1;for(let d=0;d<l;d++){const p=Math.random()>.7?"female":"male";let f,c=0;do f=jy(p),c++;while(n.has(f)&&c<100);n.has(f)&&(f=f+o),n.add(f);const u=Cy(a);let x=null;if(Math.random()>.3){const k=zr.filter(T=>T.id!=="SECT_NONE");x=k[Math.floor(Math.random()*k.length)]}const S=Ze.findIndex(k=>k.name===a);if(S===-1){console.error(`: ${a}`);return}const w=Ze[S],h=w.maxExp*2*(.8+Math.random()*.4),b=Math.random()<.8?90+Math.floor(Math.random()*11):80+Math.floor(Math.random()*10),E=Io(b),I=50+Math.floor(Math.random()*50),v={id:`world_npc_${o}`,name:f,title:u,gender:p,tier:a,tierIndex:S,sect:x?{id:x.id,name:x.name}:null,status:"ALIVE",location:"Unknown",hasMetPlayer:!1,firstMetYear:null,currentExp:Math.floor(Math.random()*w.maxExp*.8)+w.maxExp*.2,maxExp:w.maxExp,stats:{aptitude:b,looks:I,intelligence:60+Math.floor(Math.random()*40),health:80},spiritRoot:E,combatPower:Math.floor(h),age:30+(Ze.length-S)*50+Math.floor(Math.random()*100),personality:Ty(),signature:Iy(a),appearance:{description:_y(p,a,I)},relationships:{allies:[],enemies:[],disciples:[]},majorEvents:[`${u}`],lastActiveYear:3572};t.push(v),o++}}),F5(t),t}function Ty(){const e=[["","","","",""],["","","","",""],["","","","",""]];return{temperament:e[0][Math.floor(Math.random()*e[0].length)],alignment:e[1][Math.floor(Math.random()*e[1].length)],attitude:e[2][Math.floor(Math.random()*e[2].length)]}}function Iy(e){const t={:["","","",""],:["","","",""],:["","","",""],:["","","",""],:["","","",""],:["","","",""]},n=t[e]||t.;return n[Math.floor(Math.random()*n.length)]}function _y(e,t,n=60){const s=Number.isFinite(n)?n:60,o={high:["","",""],mid:["","",""],low:["","",""]},i={high:["","",""],mid:["","",""],low:["","",""]},a=s>=85?"high":s>=60?"mid":"low",l=e==="male"?o[a]:i[a];return l[Math.floor(Math.random()*l.length)]}function F5(e){const t=e.filter(s=>["","",""].includes(s.tier));e.filter(s=>["",""].includes(s.tier)).forEach(s=>{if(Math.random()>.5&&t.length>0){const o=t[Math.floor(Math.random()*t.length)];o.sect&&s.sect&&o.sect.id===s.sect.id&&(o.relationships.disciples.push(s.id),s.majorEvents.push(`${o.name}`))}});for(let s=0;s<Math.min(5,e.length/3);s++){const o=e[Math.floor(Math.random()*e.length)],i=e[Math.floor(Math.random()*e.length)];o.id!==i.id&&!o.relationships.enemies.includes(i.id)&&Math.abs(o.tierIndex-i.tierIndex)<=2&&(o.relationships.enemies.push(i.id),i.relationships.enemies.push(o.id),o.majorEvents.push(`${i.name}`),i.majorEvents.push(`${o.name}`))}}function fh(e,t){const n=e.map(i=>{if(i.status==="DEAD")return i;const a={...i};a.age=(i.age||100)+1;const l=Ze.findIndex(S=>S.name===i.tier);if(l===-1)return console.warn(`: ${i.tier}`),i;const d=1/Math.max(1,l*.5),p=Math.floor(i.maxExp*.05*d*(.8+Math.random()*.4));a.currentExp=Math.min(i.maxExp,i.currentExp+p);const f=a.currentExp>=a.maxExp,c=Math.max(.02,.1-l*.01);if(f&&Math.random()<c&&l<Ze.length-1){const S=l+1,w=Ze[S].name;a.tier=w,a.tierIndex=S,a.currentExp=0,a.maxExp=Ze[S].maxExp,a.combatPower=Math.floor(a.combatPower*1.5),a.majorEvents.push(`${t}${w}`)}const x=.005/Math.max(1,l*.3);if(Math.random()<x){a.status="DEAD",a.deathYear=t;const S=["","","","",""];a.deathReason=S[Math.floor(Math.random()*S.length)],a.majorEvents.push(`${t}${a.deathReason}`)}return a.lastActiveYear=t,a}),s=n.filter(i=>i.status==="DEAD"&&i.deathYear===t).length,o=[];for(let i=0;i<s;i++)if(Math.random()<.2){const a=Math.random()>.5?"male":"female",l=jy(a),d=Cy(""),p=Ze.findIndex(x=>x.name===""),f=Ze[p],c=55+Math.floor(Math.random()*40),u={id:`world_npc_new_${t}_${i}`,name:l,title:d,gender:a,tier:"",tierIndex:p,sect:null,status:"ALIVE",location:"Unknown",hasMetPlayer:!1,firstMetYear:null,currentExp:Math.floor(f.maxExp*.5),maxExp:f.maxExp,combatPower:Math.floor(f.maxExp*1.5),age:50+Math.floor(Math.random()*50),stats:{aptitude:80+Math.floor(Math.random()*16),looks:c,intelligence:60+Math.floor(Math.random()*30),health:80},personality:Ty(),signature:Iy(""),appearance:{description:_y(a,"",c)},relationships:{allies:[],enemies:[],disciples:[]},majorEvents:[`${t}`],lastActiveYear:t};o.push(u)}return[...n,...o]}const H5=["","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","",""],W5=["","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","",""],mh=["","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","",""],hh=["","","","","","","","","","","","","","","","","","","",""],gh=[{label:"",baseApt:20,desc:""},{label:"",baseApt:40,desc:""},{label:"",baseApt:80,desc:""},{label:"",baseApt:75,desc:""},{label:"",baseApt:70,desc:""},{label:"",baseApt:65,desc:""},{label:"",baseApt:60,desc:""},{label:"",baseApt:70,desc:""},{label:"",baseApt:70,desc:""},{label:"",baseApt:75,desc:""},{label:"",baseApt:65,desc:""},{label:"",baseApt:10,desc:""},{label:"",baseApt:80,desc:""},{label:"",baseApt:85,desc:""},{label:"",baseApt:70,desc:""},{label:"",baseApt:65,desc:""},{label:"",baseApt:60,desc:""},{label:"",baseApt:65,desc:""},{label:"",baseApt:55,desc:""}],xh=[{label:"",tag:"",desc:""},{label:"",tag:"",desc:""},{label:"",tag:"",desc:""},{label:"",tag:"",desc:""},{label:"",tag:"",desc:""},{label:"",tag:"",desc:""},{label:"",tag:"",desc:""},{label:"",tag:"",desc:""},{label:"",tag:"",desc:""},{label:"",tag:"",desc:""},{label:"",tag:"",desc:""},{label:"",tag:"",desc:""},{label:"",tag:"",desc:""},{label:"",tag:"",desc:""},{label:"",tag:"",desc:""},{label:"",tag:"",desc:""},{label:"",tag:"",desc:""}],U5=e=>{const{stats:t,spiritRoot:n,identity:s}=e,o=(t==null?void 0:t.aptitude)||50,i=(n==null?void 0:n.elements)||[];let l={:["SWORD","HEAVEN_EMPEROR","THUNDER"],:["SWORD"],:["DAN"],:["NINE_STAR"],:["NINE_STAR","FLOWER"],:null,:["DEMON"],:["BLOOD"],:["DEMON","GHOST"],:["GHOST"],:["STONE"],:["GRASS"],:["GHOST","BLOOD"],:["FLOWER"],:null,:null,:"NONE",:Math.random()<.3?"random":"NONE",:"random",:null}[s.label];if(l==="random"&&(l=zr.filter(u=>!(u.id==="NONE"||o<u.minApt||u.prefElements&&u.prefElements.length>0&&!i.some(S=>u.prefElements.includes(S))&&o<u.minApt+10)).map(u=>u.id),l.length===0&&(l="NONE")),l===null)return{sect:null,sectId:null,rank:null,status:"mysterious"};if(l==="NONE")return{sect:zr.find(u=>u.id==="NONE"),sectId:"NONE",rank:"",status:"rogue"};const d=Array.isArray(l)?l[Math.floor(Math.random()*l.length)]:l,p=zr.find(u=>u.id===d);if(!p)return{sect:zr.find(u=>u.id==="NONE"),sectId:"NONE",rank:"",status:"rogue"};const f=Ni(e,p);let c="active";return Math.random()<.1?c="defected":Math.random()<.05&&(p.level==="RECKLESS"||s.label.includes(""))&&(c="hidden"),{sect:p,sectId:p.id,rank:f,status:c}},G5=()=>({base:Math.floor(Math.random()*G2.length),skinColor:Math.floor(Math.random()*W2.length),eye:Math.floor(Math.random()*V2.length),eyeColor:Math.floor(Math.random()*U2.length),mouth:Math.floor(Math.random()*Y2.length),hair:Math.floor(Math.random()*q2.length),hairColor:Math.floor(Math.random()*qu.length)}),ep=(e,t="")=>{const n=Date.now()+Math.random().toString().slice(2,6),s=kl(),o=s.tier||e||"",i=Ze.find(O=>O.name===o)||Ze[1],a=s.maxExp??i.maxExp,l=Math.min(s.currentExp??0,a),d=18+Math.floor(Math.random()*100),f=Math.random()<.15?hh[Math.floor(Math.random()*hh.length)]:mh[Math.floor(Math.random()*mh.length)],c=t===""?W5:H5,u=c[Math.floor(Math.random()*c.length)];let x=Math.floor(Math.random()*80)+10;Math.random()<.05&&(x=90+Math.floor(Math.random()*10));let S={aptitude:x,looks:50+Math.floor(Math.random()*50),intelligence:40+Math.floor(Math.random()*60),health:80};const w=YS();S=nf(S,w);const C=G5();let h="";C.eye===1&&(h=""),C.eye===2&&(h="");const g=`${C.skin===0?"":""}${h}`,b=Io(x,{constitution:w}),I=Pn({tier:o,currentExp:l,maxExp:a,stats:S,spiritRoot:b,equipment:null}),v=gh[Math.floor(Math.random()*gh.length)],T=U5({stats:S,spiritRoot:b,identity:v});let A=v.desc;T.status==="mysterious"?A+=" ":T.status==="rogue"?A+=" ":T.status==="defected"?A+=` ${T.sect.name}${T.rank}`:T.status==="hidden"?A+=` ${T.rank}`:T.status==="active"&&T.sect&&(A+=` ${T.sect.name}${T.rank}`);const $=tc({age:d,stats:S,tier:o,spiritRoot:b});return S={...S,lifespan:$},{id:n,name:f+u,gender:t,age:d,identity:v.label,desc:A,avatar:C,appearance:g,tier:o,currentExp:l,maxExp:a,stats:S,constitution:w,spiritRoot:b,cultivationMethod:"basic_breath",combatStats:I,personality:xh[Math.floor(Math.random()*xh.length)],sect:T.sect,sectId:T.sectId,sectRank:T.rank,sectStatus:T.status,relationship:{stage:0,affection:0,trust:0,jealousy:0},acceptsLetters:!0,isPregnant:!1}},mf=[{id:"dawn_breaker",name:"",epithet:"",element:"",basePrice:2600,desc:"",auctionFlavor:"",blessing:""},{id:"dusk_ember",name:"",epithet:"",element:"",basePrice:2750,desc:"",auctionFlavor:"",blessing:""},{id:"frost_pulse",name:"",epithet:"",element:"",basePrice:2900,desc:"",auctionFlavor:"",blessing:""},{id:"abyssal_flare",name:"",epithet:"",element:"",basePrice:3100,desc:"",auctionFlavor:"",blessing:""}],V5=[{key:"sword_saint",name:"",alias:"",gender:"",identity:"",tier:"",expRatio:.86,age:230,stats:{aptitude:98,looks:92,intelligence:90,health:95},baseAffection:45,baseTrust:25,spiritRoot:{type:"",elements:["",""],color:"#8ad3ff",desc:""},constitutionKey:"fumo_frost_thunder_body",inheritance:{bloodline:"",desc:""},cultivationMethod:"wanjian_heart",personality:{label:"",tag:"",desc:""},appearance:"",desc:"",title:"",trait:{name:"",desc:""},likes:["",""],dislikes:[""],world:{rankHint:"",combatPower:36e4,location:""}},{key:"demon_sage",name:"",alias:"",gender:"",identity:"",tier:"",expRatio:.78,age:210,stats:{aptitude:96,looks:95,intelligence:93,health:90},baseAffection:50,baseTrust:28,spiritRoot:{type:"",elements:["",""],color:"#ff7c8a",desc:""},constitutionKey:"fumo_abyssal_flame_core",inheritance:{bloodline:"",desc:""},cultivationMethod:"wanmo_heart",personality:{label:"",tag:"",desc:""},appearance:"",desc:"",title:"",trait:{name:"",desc:""},likes:["",""],dislikes:[""],world:{rankHint:"",combatPower:345e3,location:""}}],Yd=mf.length,qd=V5,yh=e=>mf.find(t=>t.id===e),tp=(e=[])=>{const t=new Set(e||[]);return mf.filter(n=>!t.has(n.id))},Y5=e=>e?{id:`FUMO_${e.id}_${Date.now()}`,type:"FUMO_SWORD",swordId:e.id,name:e.name,basePrice:e.basePrice,description:`${e.epithet}  ${e.desc}`,rarity:"legendary",plot:e.auctionFlavor}:null,q5=e=>e?{instanceId:`fumo_sword_${e.id}_${Date.now()}`,name:e.name,type:"weapon",rarity:"legendary",desc:`${e.epithet}  ${e.desc}

${e.blessing}`,tags:["",""],bound:!0,effect:{kind:"artifact",stat:"atk",amount:800}}:null,K5=e=>{var i;if(!e)return null;const t=bn(e.tier)||{maxExp:12e4},n=Math.floor((e.expRatio||.8)*t.maxExp),s=e.constitution?xl(e.constitution):e.constitutionKey?Dx(e.constitutionKey):null,o={id:`legend_${e.key}`,name:e.name,alias:e.alias,gender:e.gender,identity:e.identity,title:e.title,tier:e.tier,currentExp:n,maxExp:t.maxExp,stats:{...e.stats},spiritRoot:e.spiritRoot?{...e.spiritRoot}:null,cultivationMethod:e.cultivationMethod,constitution:s,personality:e.personality,appearance:e.appearance,desc:e.desc,trait:e.trait,likes:e.likes,dislikes:e.dislikes,relationship:{stage:0,affection:e.baseAffection??40,trust:e.baseTrust??20,jealousy:10},logs:[],status:"AVAILABLE",customFlags:{isFumoLegend:!0,legendKey:e.key,inheritanceTag:(i=e.inheritance)==null?void 0:i.bloodline}};return o.combatStats=Pn(o),o},Q5=(e,t)=>{var o,i,a,l;if(!e)return null;const n=Ze.findIndex(d=>d.name===e.tier),s=bn(e.tier)||{maxExp:12e4};return{id:`world_${e.key}`,name:e.name,title:e.title||e.identity,gender:e.gender===""?"female":"male",tier:e.tier,tierIndex:n>=0?n:Ze.length-1,status:"ALIVE",location:((o=e.world)==null?void 0:o.location)||"",hasMetPlayer:!0,firstMetYear:t,currentExp:Math.floor((e.expRatio||.8)*s.maxExp),maxExp:s.maxExp,combatPower:((i=e.world)==null?void 0:i.combatPower)||s.maxExp*2,age:e.age||200,personality:e.personality,appearance:{description:e.appearance},relationships:{allies:[],enemies:[],disciples:[]},majorEvents:[`${t}${e.name} `],lastActiveYear:t,customFlags:{isFumoLegend:!0,legendKey:e.key,rankHint:(a=e.world)==null?void 0:a.rankHint,inheritanceTag:(l=e.inheritance)==null?void 0:l.bloodline}}},J5=["","",""],X5=e=>e[Math.floor(Math.random()*e.length)],np=Object.values(K).reduce((e,t)=>(e[t.key]=t.order,e),{}),Z5={common:80,uncommon:160,rare:420,epic:900,legendary:2200},eC=e=>{const t=np[e.resourceLevel]||1,n=Z5[e.rarity]||300;return Math.floor(n*(1+t*.55))},bh=Object.values(wc).filter(e=>e.resourceLevel&&np[e.resourceLevel]>=2).map(e=>{var t;return{itemId:e.id,name:e.name,description:e.desc,rarity:e.rarity,resourceLevel:e.resourceLevel,resourceOrder:np[e.resourceLevel]||1,basePrice:eC(e),type:e.type,plot:`${e.source||""}${((t=K[e.resourceLevel])==null?void 0:t.label)||""}`}}),vh=(e,t={})=>{const{ownedFumoSwords:n=[],soldAuctionItems:s=[]}=t,o=3+Math.floor(Math.random()*3),i=[],a=()=>{if(!bh.length)return null;const f=bh.map(x=>({entry:x,weight:Math.max(1,10-x.resourceOrder*2)})),c=f.reduce((x,{weight:S})=>x+S,0);let u=Math.random()*c;for(const{entry:x,weight:S}of f)if(u-=S,u<=0)return x;return f[f.length-1].entry};for(let f=0;f<o;f++){const c=a();c&&!s.includes(c.itemId)&&i.push({id:`ITEM_${Date.now()}_${f}`,type:"ITEM",itemId:c.itemId,name:c.name,basePrice:c.basePrice,description:c.description||`${c.name}`,resourceLevel:c.resourceLevel,rarity:c.rarity,plot:c.plot})}if(Math.random()<.5){const f=X5(J5)+R2(),c=150+Math.floor(Math.random()*300);i.push({id:`SLAVE_${Date.now()}_${Math.floor(Math.random()*999)}`,type:"SLAVE",name:f,basePrice:c,description:"",plot:""})}const l=tp(n);if(l.length>0){const f=Math.random()<.25?2:1;for(let c=0;c<f&&l.length>0;c++){const u=Math.floor(Math.random()*l.length),x=l.splice(u,1)[0];if(!s.includes(x.id)){const S=Y5(x);S&&i.push(S)}}}const d=` ${e} `,p=` ${i.length} `;return{title:d,message:p,items:i}},tC=(e,t,n=[])=>{const s=t.combatStats||{maxHp:100,maxMp:50},o=a=>{const l=a.combatStats||{maxHp:100,maxMp:50,atk:10,def:5};return{...a,combatStats:l,currentHp:l.maxHp,currentMp:l.maxMp,isDefending:!1}},i=[o(e),...n.map(o)];return{player:i[0],party:i,enemy:{...t,currentHp:s.maxHp,currentMp:s.maxMp,combatStats:s},turn:0,logs:[],result:null}},nC=(e,t,n=null)=>{const{party:s,enemy:o}=e,i=[...e.logs];let a=s.map(S=>({...S})),l={...o},d=null;const p=e.turn+1;i.push(`===  ${p}  ===`);for(let S=0;S<a.length;S++){const w=a[S];if(w.currentHp<=0)continue;const C=rC(w,l,t);if(a[S]=C.player,l=C.enemy,i.push(...C.logs),l.currentHp<=0)return i.push(`${l.name} `),d="win",{party:a,player:a[0],enemy:l,turn:p,logs:i,result:d}}if(a.filter(S=>S.currentHp>0).length===0)return i.push(""),d="lose",{party:a,player:a[0],enemy:l,turn:p,logs:i,result:d};const c=a.findIndex(S=>S.currentHp>0),u=sC(l,a[c]);return l=u.enemy,a[c]=u.player,i.push(...u.logs),a.some(S=>S.currentHp>0)?{party:a,player:a[0],enemy:l,turn:p,logs:i,result:d}:(i.push(""),d="lose",{party:a,player:a[0],enemy:l,turn:p,logs:i,result:d})},rC=(e,t,n,s)=>{var i,a,l;const o=[];switch(n){case"attack":const d=El(e,t);t.currentHp-=d,t.currentHp=Math.max(0,Math.floor(t.currentHp)),o.push(`${e.name}  ${t.name}  ${d} `),o.push(`${t.name}  HP: ${t.currentHp}/${((i=t.combatStats)==null?void 0:i.maxHp)||0}`);break;case"defend":e.isDefending=!0,o.push(`${e.name} `);break;case"skill":const p=Math.floor(El(e,t)*1.5);t.currentHp-=p,t.currentHp=Math.max(0,Math.floor(t.currentHp)),e.currentMp-=50,o.push(`${e.name}  ${t.name}  ${p} `),o.push(`${t.name}  HP: ${t.currentHp}/${((a=t.combatStats)==null?void 0:a.maxHp)||0}`);break;default:const f=El(e,t);t.currentHp-=f,t.currentHp=Math.max(0,Math.floor(t.currentHp)),o.push(`${e.name}  ${t.name}  ${f} `),o.push(`${t.name}  HP: ${t.currentHp}/${((l=t.combatStats)==null?void 0:l.maxHp)||0}`)}return{player:e,enemy:t,logs:o}},sC=(e,t)=>{var i;const n=[],s=El(e,t),o=t.isDefending?Math.floor(s*.5):s;return t.currentHp-=o,t.isDefending=!1,t.currentHp=Math.max(0,Math.floor(t.currentHp)),n.push(`${e.name}  ${t.name}  ${o} `),n.push(`${t.name}  HP: ${t.currentHp}/${((i=t.combatStats)==null?void 0:i.maxHp)||0}`),{enemy:e,player:t,logs:n}},El=(e,t)=>{var a,l;const n=((a=e.combatStats)==null?void 0:a.atk)||10,s=((l=t.combatStats)==null?void 0:l.def)||5,o=n-Math.floor(s/2);return Math.max(1,o)},Kd=(e,t,n=[])=>{let s=tC(e,t,n);for(;!s.result;)s=nC(s,"attack");return{success:s.result==="win",logs:s.logs,remainingHp:s.player.currentHp,party:s.party}},oC=e=>{const t=e.reduce((s,o)=>s+(o.weight||1),0);let n=Math.random()*t;for(const s of e)if(n-=s.weight||1,n<=0)return s;return e[e.length-1]},iC=[pt.PLAYER,pt.CHILD],aC={YELLOW:"common",BLACK:"uncommon",EARTH:"rare",HEAVEN:"epic",DIVINE:"legendary"},lC={YELLOW:K.MORTAL.key,BLACK:K.SPIRIT.key,EARTH:K.EARTH.key,HEAVEN:K.HEAVEN.key,DIVINE:K.DIVINE.key},cC={basic:["YELLOW","BLACK"],advanced:["EARTH"],apex:["HEAVEN","DIVINE"]},dC=(e=["YELLOW"],t)=>{var i,a;let n=Object.values(GS).filter(l=>e.includes(l.tier));if(!n.length)return null;const s=((a=(i=t==null?void 0:t.player)==null?void 0:i.spiritRoot)==null?void 0:a.elements)||[],o=n.filter(l=>s.includes(l.element));return o.length&&(n=o),n[Math.floor(Math.random()*n.length)]},uC=e=>{const t=on[e];if(!t)return null;const n=Ec[t.tier]||{};return{id:`manual_scroll_${e}`,name:`${t.name}`,type:"manual",rarity:aC[t.tier]||"rare",tier:n.name||t.tier,tierColor:n.color,element:t.element,baseBonus:`${Math.round((n.baseBuff||0)*100)}%`,desc:t.desc,manualIds:[e],resourceCategory:"MANUAL",resourceLevel:t.resourceLevel||lC[t.tier]||K.MORTAL.key,manualSchool:t.school,usageTargets:iC,tags:[t.element||"",t.tier]}},tl=(e,t)=>{const n=cC[e]||["YELLOW"],s=dC(n,t);if(!s)return null;const o=s.manualIds[Math.floor(Math.random()*s.manualIds.length)];return uC(o)},Ry=e=>Kx.find(t=>t.id===e),pC=(e,t=1)=>{const n=Ry(e)||{recommendCP:300,drops:["herb_bandage"]},s=n.recommendCP||300,o=Math.floor(s*(.6+t*.06));return{name:t>=10?"":"",combatStats:{hp:Math.floor(o*.3),atk:Math.floor(o*.012),def:Math.floor(o*.0073),mp:0,maxHp:Math.floor(o*.3),maxMp:0},drops:n.drops||["herb_bandage"]}},fC=(e,t)=>!!(e!=null&&e.find(n=>n.id===t)),mC=[{id:"combat_beast",kind:"COMBAT",realm:"ANY",weight:3,title:"",desc:"",options:[{label:"",action:e=>({type:"START_COMBAT"})},{label:"",action:()=>({type:"LOG",msg:""})}]},{id:"loot_array",kind:"LOOT",realm:"ANY",weight:2,title:"",desc:"",options:[{label:" ()",action:e=>{var n,s;return(((s=(n=e.player)==null?void 0:n.combatStats)==null?void 0:s.atk)||10)>80?{type:"LOOT",items:["beast_core"],msg:""}:{type:"HP_CHANGE",hpDelta:-150,msg:""}}},{label:" ()",action:e=>{var n,s;return(((s=(n=e.player)==null?void 0:n.stats)==null?void 0:s.intelligence)||40)>=70?{type:"LOOT",items:["foundation_pill"],msg:""}:{type:"LOG",msg:""}}}]},{id:"encounter_injured",kind:"ENCOUNTER",realm:"ANY",weight:1,title:"",desc:"",options:[{label:" (-1 )",condition:e=>fC(e.inventory,"herb_bandage"),action:e=>{let t=ep("");try{t=ff(t,Math.max(t.stats.aptitude||0,90))}catch{t.stats.aptitude=Math.max(t.stats.aptitude||0,90)}return{type:"NPC_JOIN",npc:t,removeItemId:"herb_bandage",msg:""}}},{label:"",action:()=>({type:"LOOT",items:["spirit_stones_500"],msg:""})},{label:"",action:()=>({type:"LOG",msg:""})}]},{id:"fruit_unknown",kind:"LOOT",realm:"ANY",weight:1,title:"",desc:"",options:[{label:"",action:()=>{const e=Math.random();return e<.4?{type:"EXP_GAIN",amount:1200,msg:""}:e<.8?{type:"HP_CHANGE",hpDelta:-120,msg:""}:{type:"LOG",msg:""}}},{label:"",action:()=>({type:"LOG",msg:""})}]},{id:"story_two_beasts",kind:"STORY",realm:"ANY",weight:1,title:"",desc:"",options:[{label:"",action:()=>({type:"LOOT",items:["beast_fang"],msg:""})},{label:"",action:()=>({type:"LOG",msg:""})}]},{id:"manual_cave",kind:"LOOT",realm:"ANY",weight:1,title:"",desc:"",options:[{label:"",action:e=>{const t=(Math.random()<.35?tl("apex",e):null)||tl("advanced",e)||tl("basic",e);return t?{type:"LOOT",items:[t],msg:""}:{type:"LOG",msg:""}}},{label:"",action:()=>({type:"LOG",msg:""})}]},{id:"manual_library",kind:"LOOT",realm:"ANY",weight:1,title:"",desc:"",options:[{label:"",action:e=>{const t=tl("basic",e);return t?{type:"LOOT",items:[t],msg:""}:{type:"LOG",msg:""}}},{label:"",action:()=>({type:"LOG",msg:""})}]}],hC=e=>{const t=Ry(e),n=t!=null&&t.name?`${t.name}  `:"";return{id:"boss_guard",kind:"BOSS",realm:e,weight:1,title:n,desc:"",options:[{label:"",action:()=>({type:"START_COMBAT"})},{label:"",action:()=>({type:"LOG",msg:""})}]}},Sh=e=>{const{realmId:t,progress:n}=e,o=mC.filter(i=>i.realm==="ANY"||i.realm===t).map(i=>{let a=i.weight||1;return n<=3&&(i.kind==="LOOT"||i.kind==="ENCOUNTER")&&(a*=1.5),n>=7&&i.kind==="COMBAT"&&(a*=1.5),{...i,weight:a}});return oC(o)},nl=10,wh=(e=3572,t=1)=>{const n=Math.max(1,Math.min(12,t||1));return(e-3572)*12+n},gC={[pt.PLAYER]:"",[pt.CHILD]:"",[pt.NPC]:""},My=e=>e&&Array.isArray(e.usageTargets)&&e.usageTargets.length>0?e.usageTargets:zx,Vs=e=>My(e).map(n=>gC[n]||zS[n]||n).join(""),cs=(e,t)=>e?My(e).includes(t):!1,xC=()=>`log-${Date.now()}-${Math.random().toString(16).slice(2)}`,yC=[{id:"init-log-1",turn:0,message:"",category:"",type:null,title:null,details:null},{id:"init-log-2",turn:0,message:"",category:"",type:null,title:null,details:null},{id:"init-log-3",turn:0,message:"",category:"",type:null,title:null,details:null}],bC=oo!=null&&oo.avatar?{...oo.avatar}:{base:0,skinColor:0,hair:1,hairColor:0,eye:0,eyeColor:1,mouth:0},Eh=e=>!e||typeof e!="object"?!1:["hair","hairId","faceId","eye","tZoneId"].some(t=>typeof e[t]<"u"&&e[t]!==null),vC=250,Qd="forcePortraitUI",kh=()=>typeof window>"u"?!0:window.innerHeight>=window.innerWidth,SC=e=>e?!!(e.status==="DEAD"||e.state==="DEAD"||e.isDeceased||e.deathYear||e.deathReason||typeof e.lifespan=="number"&&e.lifespan<=0||typeof e.health=="number"&&e.health<=0||typeof e.currentHp=="number"&&e.currentHp<=0):!1;function wC(){var Mf,Af,Nf,Lf,$f,Bf,Of,Pf,zf,Df,Ff;const e=PS(),{modalState:t,setModalState:n,openModal:s,closeModal:o}=e,i=y.useCallback(m=>{m.type===null?o():s(m.type,m.data)},[s,o]),a=FS(),{inventory:l,addItemsToInventory:d,removeItemFromInventory:p}=a,f=E2(),{player:c,setPlayer:u,updatePlayer:x,addResources:S,consumeResources:w,consumeEnergy:C,purchaseBusiness:h,applyCombatResult:g,updateWorldNpc:b,clearNewsBuffer:E,addToSpecialCollection:I}=f,v=F2(),{activeNpcs:k,deadNpcs:T,selectedNpc:A,selectedWorldNpc:R,visibleNpcs:$,setActiveNpcs:O,setDeadNpcs:Q,setSelectedNpc:L,setSelectedWorldNpc:G,updateNpc:ne,addNpc:ae,toggleNpcFollow:Y,batchUpdateNpcs:q,replaceAllNpcs:ie,batchUpdateNpcsByMap:Z,cutTiesWithNpc:ve}=v,V=H2(),{children:ee,fallenChildren:he,selectedChild:ge,enhancedChildren:me,setChildren:Me,setFallenChildren:$e,setSelectedChild:je,updateChild:ct,removeChild:vt,toggleChildFavorite:De,batchUpdateChildren:D,replaceAllChildren:Se,batchUpdateChildrenIf:de}=V,[Ie,Be]=y.useState(!0),[dt,_n]=y.useState(!0),[wn,Mo]=y.useState("PROLOGUE");y.useEffect(()=>{const m=dy();console.log(":",m?"":"")},[]),y.useMemo(()=>qx.map(m=>{var j;const M=(j=m.stats)==null?void 0:j.aptitude;return typeof M=="number"?{...m,spiritRoot:Io(M)}:m}),[]);const[Ic,oa]=y.useState(()=>kh()),[_s,Ao]=y.useState(()=>typeof window>"u"?!1:localStorage.getItem(Qd)==="true"),Rn=y.useMemo(()=>{const m=((c==null?void 0:c.exiledChildren)||[]).map(M=>M.id);return me.filter(M=>!m.includes(M.id))},[me,c==null?void 0:c.exiledChildren]),qt=y.useMemo(()=>[...Rn].sort((m,M)=>{var _,N;const j=m.age-M.age;if(j!==0)return j;const B=(((_=M.stats)==null?void 0:_.aptitude)||0)-(((N=m.stats)==null?void 0:N.aptitude)||0);return B!==0?B:m.name.localeCompare(M.name,"zh-CN")}),[Rn]),_c=y.useMemo(()=>Rn.filter(m=>m.age>=16&&!m.job).map(m=>{var M;return{id:m.id,name:m.name,age:Math.max(16,Math.floor(m.age||0)),gender:m.gender,tierTitle:m.tierTitle||"",intelligence:((M=m.stats)==null?void 0:M.intelligence)??0}}).sort((m,M)=>(M.intelligence??0)-(m.intelligence??0)),[Rn]),tr=y.useMemo(()=>{var m;return[...((m=c.specialCollections)==null?void 0:m.fumoSwords)||[]]},[(Mf=c.specialCollections)==null?void 0:Mf.fumoSwords]),ia=y.useMemo(()=>tp(tr),[tr]),aa=y.useMemo(()=>{var m,M;return(m=c.specialFlags)!=null&&m.fumoDuoMet?!1:(M=c.specialFlags)!=null&&M.fumoDuoUnlocked?!0:Yd>0&&ia.length===0},[(Af=c.specialFlags)==null?void 0:Af.fumoDuoMet,(Nf=c.specialFlags)==null?void 0:Nf.fumoDuoUnlocked,ia.length]);y.useEffect(()=>{if(typeof window>"u")return;const m=()=>{oa(kh())};return m(),window.addEventListener("resize",m),window.addEventListener("orientationchange",m),()=>{window.removeEventListener("resize",m),window.removeEventListener("orientationchange",m)}},[]),y.useEffect(()=>{typeof document<"u"&&document.body.classList.toggle("force-portrait-ui",_s),typeof window<"u"&&(_s?localStorage.setItem(Qd,"true"):localStorage.removeItem(Qd))},[_s]),y.useEffect(()=>()=>{typeof document<"u"&&document.body.classList.remove("force-portrait-ui")},[]);const[ts,No]=y.useState(yC),Ae=y.useCallback((m,M="",j=null,B=null,_=null)=>{var z,oe;const N=((z=c==null?void 0:c.time)==null?void 0:z.year)??3572,P=((oe=c==null?void 0:c.time)==null?void 0:oe.month)??1,H=(N-3572)*12+P,U={id:xC(),turn:H,message:m,category:M,type:j,title:B,details:_};No(re=>[U,...re])},[(Lf=c==null?void 0:c.time)==null?void 0:Lf.year,($f=c==null?void 0:c.time)==null?void 0:$f.month]),[Un,Rc]=y.useState("FAMILY"),[tn,Mn]=y.useState(!1),[ns,Mc]=y.useState(1),[rs,la]=y.useState(!1),[Rs,Ac]=y.useState("AGE_DESC"),[Ms,Nc]=y.useState("DEFAULT"),[Lo,As]=y.useState(1),Ir=y.useMemo(()=>{const m=k.filter(M=>{var j;return!((j=M.relationship)!=null&&j.cutTies)&&(!rs||M.isFollowed)});switch(Ms){case"AFFECTION_DESC":return m.sort((M,j)=>{var N,P;const B=((N=M.relationship)==null?void 0:N.affection)||0;return(((P=j.relationship)==null?void 0:P.affection)||0)-B});case"TRUST_DESC":return m.sort((M,j)=>{var N,P;const B=((N=M.relationship)==null?void 0:N.trust)||0;return(((P=j.relationship)==null?void 0:P.trust)||0)-B});case"APTITUDE_DESC":return m.sort((M,j)=>{var N,P;const B=((N=M.stats)==null?void 0:N.aptitude)||0;return(((P=j.stats)==null?void 0:P.aptitude)||0)-B});default:return m}},[k,Ms,rs]),Ns=y.useMemo(()=>Math.max(1,Math.ceil(Ir.length/nl)),[Ir.length]);y.useEffect(()=>{As(1)},[Ms,rs]),y.useEffect(()=>{As(m=>Math.min(m,Ns))},[Ns]);const Lc=y.useMemo(()=>{const m=(Lo-1)*nl;return Ir.slice(m,m+nl)},[Ir,Lo]),$c=Ir.length>nl,Bc=y.useMemo(()=>{if(!ge||qt.length===0)return null;const m=qt.findIndex(M=>M.id===ge.id);return m===-1?null:{hasPrev:m>0,hasNext:m<qt.length-1,prevName:m>0?qt[m-1].name:null,nextName:m<qt.length-1?qt[m+1].name:null,label:`${m+1}/${qt.length}`}},[qt,ge]),Oc=y.useCallback(m=>{if(!ge)return;const M=qt.findIndex(j=>j.id===ge.id);M!==-1&&(m==="PREV"&&M>0?je(qt[M-1]):m==="NEXT"&&M<qt.length-1&&je(qt[M+1]))},[qt,ge,je]),ca=y.useCallback((m,M={})=>{var N,P,H,U,z;if(!m)return"";const j=[],B=m.gender===""?"":"",_=((N=m.stats)==null?void 0:N.aptitude)??"--";return j.push(`${B} ${_} ${m.tierTitle||""}`),(P=m.sect)!=null&&P.name&&j.push(` ${m.sect.name}${m.rank?`  ${m.rank}`:""}`),(H=m.spouse)!=null&&H.name&&j.push(` ${m.spouse.name} `),(U=m.trait)!=null&&U.name&&j.push(`${m.trait.name}`),(z=m.influenceProfile)!=null&&z.label&&j.push(`${m.influenceProfile.label}`),typeof M.descendantCount=="number"&&M.descendantCount>0&&j.push(` ${M.descendantCount} `),`${j.join("")}`},[]),$o=y.useCallback((m,M=[])=>{var _,N;if(!Array.isArray(m)||m.length===0)return;const j=((_=c==null?void 0:c.time)==null?void 0:_.year)??0,B=((N=c==null?void 0:c.time)==null?void 0:N.month)??1;$e(P=>{const H=new Set(P.map(z=>z.id)),U=[];return m.forEach(z=>{var J;if(!z||H.has(z.id))return;const oe=M.filter(se=>se.parentId===z.id).length,re=z.deathReason||(typeof z.lifespan=="number"&&z.lifespan<=0?"":"");U.push({id:z.id,name:z.name,gender:z.gender,avatar:z.avatar,tierTitle:z.tierTitle,generation:z.generation||1,ageAtDeath:Math.max(0,Math.floor(z.age||0)),deathYear:j,deathMonth:B,deathReason:re,sect:z.sect?{...z.sect}:null,rank:z.rank||null,trait:z.trait||null,influenceLabel:((J=z.influenceProfile)==null?void 0:J.label)||null,descendants:oe,epitaph:ca(z,{descendantCount:oe})})}),U.length?[...U,...P]:P}),m.forEach(P=>{if(!P)return;const H=P.deathReason||(typeof P.lifespan=="number"&&P.lifespan<=0?"":"");Ae(` ${P.name} ${H} ${Math.max(0,Math.floor(P.age||0))} `)})},[(Bf=c==null?void 0:c.time)==null?void 0:Bf.year,(Of=c==null?void 0:c.time)==null?void 0:Of.month,ca,Ae]),[Bo,Oo]=y.useState(null),[Pc,Po]=y.useState(!1),[zo,da]=y.useState({id:null,name:"",total:0}),[_r,Do]=y.useState(0),[ua,Ls]=y.useState([]),[Fo,pa]=y.useState(null),[zc,Dc]=y.useState([]),{handleExplorationOption:fa,handleStartCombat:Fc}=I5({player:c,inventory:l,children:ee,exploreRealmState:zo,exploreProgress:_r,exploreTeamIds:zc,setPlayer:u,setExploreLog:Ls,setCombatData:Oo,addNpc:ae,addItemsToInventory:d,inventoryMgr:a,calculateDynamicCombatStats:Pn,simulateCombat:Kd,generateRealmEnemy:pC}),{handleCombatClose:ma}=_5({player:c,children:ee,exploreRealmState:zo,applyCombatResult:g,addLog:Ae,setCombatData:Oo,setExploreLog:Ls,batchUpdateChildren:D,archiveChildDeaths:$o,addItemsToInventory:d,setIsExploring:Po}),Hc=y.useCallback(()=>{ma(Bo)},[ma,Bo]),[ha,Wc]=y.useState(null),[$s,ga]=y.useState(!1),[F,He]=y.useState(!1),[Gn,Bs]=y.useState(!1),[Ho,Ay]=y.useState(!1),[xa,Ny]=y.useState(!1),[ya,Ly]=y.useState(!1),[St]=y.useState(()=>new Uk),[$y,ss]=y.useState([]),[Wo,hf]=y.useState({}),ba=y.useCallback(()=>{const m=Ko.current;m&&(m.type==="idle"&&typeof window<"u"&&typeof window.cancelIdleCallback=="function"?window.cancelIdleCallback(m.id):clearTimeout(m.id),Ko.current=null,wa.current=null)},[]),va=y.useCallback((m,M)=>{try{const j=gy(m);j.success&&(yf.current=M,console.log(` : ${j.gameTime}`))}catch(j){console.error(":",j)}finally{wa.current=null}},[]),gf=y.useCallback((m,M)=>{if(typeof window<"u"){if(typeof window.requestIdleCallback=="function"){window.requestIdleCallback(()=>va(m,M),{timeout:1e3});return}if(typeof window.requestAnimationFrame=="function"){window.requestAnimationFrame(()=>va(m,M));return}}setTimeout(()=>va(m,M),0)},[va]),xf=y.useCallback((m,M)=>{ba();const j=()=>{Ko.current=null,gf(m,M)};if(typeof window<"u"&&typeof window.requestIdleCallback=="function"){const B=window.requestIdleCallback(j,{timeout:1500});Ko.current={type:"idle",id:B}}else{const B=setTimeout(j,vC);Ko.current={type:"timeout",id:B}}wa.current=M},[ba,gf]);y.useEffect(()=>()=>{ba()},[ba]);const[os,Uc]=y.useState([]),[Uo,Go]=y.useState([]),[By,Gc]=y.useState(!1),[Oy,Vc]=y.useState([]),[Sa,Yc]=y.useState(null),[Py,Vo]=y.useState([]),[zy,Yo]=y.useState([]),[Dy,qo]=y.useState([]),Ko=y.useRef(null),yf=y.useRef(null),wa=y.useRef(null),bf=y.useMemo(()=>{if(typeof navigator>"u")return!1;const m=navigator.userAgent||"";return/Android|Adr|OPPO|VIVO|MIUI|HONOR|HUAWEI/i.test(m)},[]);y.useEffect(()=>{Array.isArray(c==null?void 0:c.newsBuffer)&&(c.newsBuffer.length<=Xi||u(m=>({...m,newsBuffer:Wd(m.newsBuffer)})))},[c==null?void 0:c.newsBuffer,u]),y.useEffect(()=>{var B;const m=!c.specialCollections||!Array.isArray(c.specialCollections.fumoSwords),M=!c.specialFlags||typeof c.specialFlags.fumoDuoUnlocked>"u"||typeof c.specialFlags.fumoDuoMet>"u";if(m||M){u(_=>{var H,U,z;const N=!_.specialCollections||!Array.isArray(_.specialCollections.fumoSwords),P=!_.specialFlags||typeof _.specialFlags.fumoDuoUnlocked>"u"||typeof _.specialFlags.fumoDuoMet>"u";return!N&&!P?_:{..._,specialCollections:N?{..._.specialCollections||{},fumoSwords:[...((H=_.specialCollections)==null?void 0:H.fumoSwords)||[]]}:_.specialCollections,specialFlags:P?{..._.specialFlags||{},fumoDuoUnlocked:((U=_.specialFlags)==null?void 0:U.fumoDuoUnlocked)||!1,fumoDuoMet:((z=_.specialFlags)==null?void 0:z.fumoDuoMet)||!1}:_.specialFlags}});return}if(c&&!c.familyRating&&u(_=>_.familyRating?_:{..._,familyRating:{currentId:js[0].id,history:[]}}),c&&!c.combatStats){console.log("...");const _=c.stats||{aptitude:50,luck:50,lifespan:100},N=((B=c.spiritRoot)==null?void 0:B.type)||"",P=Eo(c.tier||"",_.aptitude,N);u(H=>({...H,stats:H.stats||_,spiritRoot:H.spiritRoot||{type:"",elements:["","","","",""],color:"#9E9E9E",multiplier:.5},combatStats:P}))}if(c&&!Eh(c.avatar)&&u(_=>Eh(_.avatar)?_:{..._,avatar:{...bC,..._.gender?{gender:_.gender}:{}}}),k.some(_=>!_.relationship||_.currentExp===void 0)&&(console.log(" NPC ..."),q(_=>{const N={..._};if(N.relationship||(N.relationship={stage:0,affection:0,trust:0,jealousy:0}),N.currentExp===void 0){const P=N.tier||"",H=bn(P);N.tier=P,N.currentExp=Math.floor(Math.random()*H.maxExp*.3),N.maxExp=H.maxExp}return N})),k.some(_=>{var P;if(!_)return!1;const N=tc(_);return!((P=_.stats)!=null&&P.lifespan)||_.stats.lifespan<N})&&q(_=>{if(!_)return _;const N=_.stats||{},P=tc(_);return N.lifespan&&N.lifespan>=P?_:{..._,stats:{...N,lifespan:P}}}),k.some(_=>!_.memories)){console.log(" NPC ...");const _=k.map(N=>{Lr.initializeAllNpcs([N]);const P=ee.filter(H=>H.fatherName===N.name||H.motherName===N.name);return P.length>0&&Lr.backfillChildrenMemories(N,P),N});ie(_)}ee.some(_=>!_.equipment)&&D(_=>Zo(_)),ee.some(_=>_.spiritRoot&&!_.spiritRoot.elements)&&(console.log("..."),D(_=>_.spiritRoot&&!_.spiritRoot.elements?{..._,spiritRoot:{type:"",elements:["","","","",""],desc:"",color:"#9E9E9E",multiplier:.5}}:_))},[c,k,ee]),y.useEffect(()=>{if(!Array.isArray(c.worldNpcs)||c.worldNpcs.length===0){console.log("...");const m=D5(30);u(M=>({...M,worldNpcs:m}))}},[c.worldNpcs]),y.useEffect(()=>{const m=localStorage.getItem("has_read_tutorial_v2");wn==="MAIN"&&!m&&setTimeout(()=>{e.openTutorial()},1e3)},[wn,e]);const Fy=()=>{e.closeTutorial(),localStorage.setItem("has_read_tutorial_v2","true")};y.useEffect(()=>{if(!$s)return;const m=ee.filter(j=>Math.floor(j.age*12)>=144&&j.isTested&&!j.sect);if(m.length===0)return;let M=0;D(j=>{if(!m.some(N=>N.id===j.id))return j;const _=Xc(j);return _?(M++,{...j,sect:_,rank:Ni(j,_)}):j}),M>0&&X("",` ${M} `,!0)},[ee,$s]);const Hy=()=>{localStorage.setItem("has_read_tutorial_v2","true")},Wy=()=>{e.closeGuide()},vf=(Pf=t.data)==null?void 0:Pf.autoClose,[EC,kC]=y.useState(null),[jC,CC]=y.useState({}),[qc,Qo]=y.useState(null);y.useEffect(()=>{if(!qc)return;const m=setTimeout(()=>Qo(null),3200);return()=>clearTimeout(m)},[qc]);const[Os,Jo]=y.useState([]),[Ea,Kc]=y.useState([]),[is,Qc]=y.useState({open:!1,item:null}),Uy=y.useCallback(({messageId:m,targetNpcId:M,relation:j,content:B,tone:_})=>{var U;const N=(B||"").trim();if(!N)return{success:!1,error:""};const P={year:c.time.year,month:c.time.month},H=St.addReplyToMessage(m,{content:N,tone:_==null?void 0:_.id,toneLabel:_==null?void 0:_.label,sentiment:_==null?void 0:_.desc,timestamp:P,from:c.name,affectionDelta:(_==null?void 0:_.affectionDelta)||0});if(!H)return{success:!1,error:""};if(ss(St.getAllMessages()),Ae(`${H.message.senderName}`,""),_!=null&&_.affectionDelta&&j!=="child"){const z=k.find(oe=>oe.id===M);if(z){const oe=((U=z.relationship)==null?void 0:U.affection)||0,re=Math.max(0,Math.min(100,oe+_.affectionDelta));ne(M,{relationship:{...z.relationship||{},affection:re}})}}return{success:!0}},[St,c.time.year,c.time.month,c.name,Ae]),ka=y.useMemo(()=>{var m;return d2((m=c==null?void 0:c.familyRating)==null?void 0:m.currentId)},[(zf=c==null?void 0:c.familyRating)==null?void 0:zf.currentId]),Gy=y.useMemo(()=>{let m=0;return ee.forEach(M=>{m+=Gu(M,{familyRatingMultiplier:ka})}),m},[ee,ka]),Xo=y.useMemo(()=>g2(ee,c),[ee,c]),Vy=y.useCallback(()=>i({type:null,data:null}),[i]),X=y.useCallback((m,M,j=!0,B=null,_=!0,N=null)=>{const P=N||{},H=P.forceManual?!1:_;if(i({type:"RESULT",data:{title:m,msg:M,success:j,changes:B,autoClose:H}}),P.skipLog)return;const U=typeof M=="string"?M:"",z=m||"",oe=U.length>20,re=P.message||(oe?`${z}`:U||z),J=P.details!==void 0?P.details:oe?U:null,se=P.title??z,_e=P.category||"",ue=P.type??null;Ae(re,_e,ue,se,J)},[Ae]),Sf=y.useCallback((m,M)=>{i({type:"CONFIRM",data:{message:m,onConfirm:M}})},[]),Yy={"XMZM-TEST-2026":{spiritStones:1e5}},wf=y.useCallback(()=>new Set((c==null?void 0:c.usedRedeemCodes)||[]),[c==null?void 0:c.usedRedeemCodes]),Ef=y.useCallback(m=>{u(M=>({...M,usedRedeemCodes:[...m]}))},[u]),qy=y.useCallback(m=>{const M=(m||"").trim();if(!M)return{success:!1,message:""};const j=Yy[M];if(!j)return{success:!1,message:""};const B=wf();if(B.has(M))return{success:!1,message:""};B.add(M),Ef(B),j.spiritStones&&S({spiritStones:j.spiritStones});const _=`
 ${j.spiritStones} `;return X("",_,!0,{:j.spiritStones}),{success:!0,message:""}},[wf,Ef,S,X]),Ky=y.useCallback(async()=>{var M,j;let m=!1;if(typeof window<"u"&&((j=(M=window.screen)==null?void 0:M.orientation)!=null&&j.lock))try{await window.screen.orientation.lock("portrait"),m=!0}catch(B){console.warn(":",B)}Ao(!0),!m&&typeof window<"u"&&setTimeout(()=>window.dispatchEvent(new Event("resize")),80),X("",m?"":"",!0)},[X]),Qy=y.useCallback(()=>{var m,M;if(typeof window<"u"&&((M=(m=window.screen)==null?void 0:m.orientation)!=null&&M.unlock))try{window.screen.orientation.unlock()}catch(j){console.warn(":",j)}Ao(!1),X("","",!0)},[X]),Jy=y.useCallback(()=>{if(!Xo.nextTier){X("","",!0);return}if(!Xo.canUpgrade){X("","",!1);return}const m=Xo.nextTier;u(j=>{var B;return{...j,familyRating:{currentId:m.id,history:[...((B=j.familyRating)==null?void 0:B.history)||[],{id:m.id,name:m.name,year:j.time.year,month:j.time.month}]}}});const M=`${m.name}`;Ae(` ${M}`,""),X("",`${M}

${m.desc}`,!0)},[Xo,u,Ae,X]);y.useEffect(()=>{window.showResult=X,window.showConfirm=Sf},[X,Sf]),y.useEffect(()=>{if(!c.currentAuction||!c.auctionWindowStart||!c.auctionWindowEnd)return;wh(c.time.year,c.time.month)>=c.auctionWindowEnd&&x({currentAuction:null,auctionWindowStart:null,auctionWindowEnd:null})},[c.currentAuction,c.auctionWindowStart,c.auctionWindowEnd,c.time.year,c.time.month,x]);const Xy=(m,M)=>{if(!m)return{success:!1,title:"",message:""};const j=Math.max(0,M||m.basePrice||0);if((c.resources.spiritStones||0)<j)return{success:!1,title:"",message:""};w({spiritStones:j});let _="";if(m.type==="SLAVE"){const N=ep(c.tier);N.name=m.name,N.identity="",N.relationship=N.relationship||{},N.relationship.owner=c.name,N.relationship.affection=-20,N.relationship.trust=0,N.relationship.stage=0;const P=t1(m,N);N.slavePlot=P,ae(N),_=` ${j}  ${m.name}Ta 

${P.intro}`,Ae(" "+j+"  "+m.name)}else if(m.type==="ITEM"&&m.itemId){const N=ir(m.itemId);if(!N)return{success:!1,title:"",message:""};m.description&&(N.desc=m.description),d([N]),_=` ${j}  ${m.name}`,Ae(` ${j}  ${m.name}`)}else if(m.type==="FUMO_SWORD"){const N=yh(m.swordId)||{id:m.swordId,name:m.name},P=q5(N)||{instanceId:`fumo_${m.swordId||Date.now()}`,name:m.name,type:"weapon",rarity:"legendary",desc:m.description||m.plot||""};d([P]);const U=N.id&&tr.includes(N.id)?tr.length:tr.length+1,z=Math.max(0,Yd-U),oe=N.blessing||"",re=z===0?"":` ${z} `;_=` ${j}  ${m.name}
${oe}

${re}`,Ae(` ${m.name}`,""),s1(N.id||m.swordId)}else{const N={instanceId:"auction_"+Date.now()+"_"+Math.floor(Math.random()*1e4),name:m.name,type:"consumable",rarity:m.rarity||"rare",desc:m.description||m.plot||"",effect:{kind:"exp",amount:3e3}};d([N]),_=` ${j}  ${m.name}`,Ae(` ${j}  ${m.name}`)}return x({soldAuctionItems:[...c.soldAuctionItems||[],m.itemId||m.swordId||m.id]}),{success:!0,title:"",message:_}},Zy=m=>m.plot||m.description,e1=()=>{const m=wh(c.time.year,c.time.month),j=c.auctionWindowStart&&c.auctionWindowEnd&&m>=c.auctionWindowStart&&m<c.auctionWindowEnd;if(c.currentAuction){if(!j){x({currentAuction:null,auctionWindowStart:null,auctionWindowEnd:null}),Qo(null),X("","",!1);return}Qo(null),i({type:"AUCTION",data:c.currentAuction});return}if(m%36!==0){X("","",!1);return}const B=vh(c.time.year,{ownedFumoSwords:tr,soldAuctionItems:c.soldAuctionItems||[]});x({currentAuction:B,lastAuctionYear:c.time.year,auctionWindowStart:m,auctionWindowEnd:m+12}),Qo(null),i({type:"AUCTION",data:B})},t1=(m,M)=>{const j=[{intro:`${M.name}Ta`,trauma:"",hope:""},{intro:`${M.name}Ta`,trauma:"",hope:""},{intro:`${M.name}Ta`,trauma:"",hope:""},{intro:`${M.name}Ta`,trauma:"",hope:""}];return{...j[Math.floor(Math.random()*j.length)],unlockStage:2}},Zo=m=>{const M=m.equipment||{weapon:null,armor:null,accessory:null};return{...m,equipment:M}},mt=m=>{const M=Zo(m);return{...M,combatStats:Pn(M)}},n1={:30,:30,:30,:30,:50,:50,:50,:50,:200,:200,:200,:200,:300,:300,:300,:300,:500,:500,:500,:500},r1=(m=0)=>{for(let M=0;M<Ze.length;M++)if(m<Ze[M].maxExp)return Ze[M];return Ze[Ze.length-1]},Kt=(m,M=0)=>{var oe;const j=(m.cultivation||0)+M,B=m.tierTitle,_=r1(j),N=Ze.findIndex(re=>re.name===_.name),P=N>0?Ze[N-1].maxExp:0;let H={...m,cultivation:j,tierTitle:_.name,currentExp:j-P,maxExp:_.maxExp-P},U=0;const z=!!B&&B!==_.name;return z&&(U=n1[_.name]||50,H={...H,stats:{...H.stats,lifespan:(((oe=H.stats)==null?void 0:oe.lifespan)??100)+U}}),{updated:H,tierChanged:z,lifespanIncrease:U,newTier:_.name,prevTier:B}},s1=y.useCallback(m=>{var P,H;if(!m)return;const M=Array.isArray((P=c.specialCollections)==null?void 0:P.fumoSwords)?c.specialCollections.fumoSwords:[];if(M.includes(m))return;I("fumoSwords",m);const j=[...M,m];tp(j).length===0&&Yd>0&&!((H=c.specialFlags)!=null&&H.fumoDuoUnlocked)&&x({specialFlags:{...c.specialFlags||{},fumoDuoUnlocked:!0}});const N=yh(m);N&&Ae(` ${N.name} `,"")},[c.specialCollections,c.specialFlags,I,x,Ae]),kf=m=>{if(!m)return 0;const j={common:10,uncommon:50,rare:200,epic:800,legendary:3e3}[m.rarity]||10,B=m.type==="weapon"||m.type==="armor"||m.type==="accessory"?2:1;return Math.max(1,Math.floor(j*B))},o1=(m,M)=>{const j=l.find(z=>z.instanceId===m);if(!j){X("","",!1);return}const B=typeof M=="number"?Math.min(M,j.quantity||1):j.quantity||1,_=p(m,B);if(!_){X("","",!1);return}const N=kf(j),H=Math.floor(N*.7*(_.quantity||1)),U=_.quantity&&_.quantity>1?" x"+_.quantity:"";S({spiritStones:H}),X(""," "+H+"  "+_.name+U+"",!0,{:H}),Ae(""+_.name+U+" "+H+" ")},i1=m=>{if(!l.find(B=>B.instanceId===m)){X("","",!1);return}const j=p(m);if(!j){X("","",!1);return}X("",` ${j.name}${j.quantity&&j.quantity>1?` x${j.quantity}`:""}`,!0),Ae(`${j.name}${j.quantity&&j.quantity>1?` x${j.quantity}`:""}`)},jf=(m,M)=>{var B;const j=k.find(_=>_.id===m);if(M==="TOGGLE_FOLLOW"){Y(m);return}if(M==="GIFT"){i({type:"GIFT",data:j});return}if(M==="PROPOSE"){const _=Bd(j,"PERSUADE");if(!_.allowed){X("",_.reason,!1,null,!1,{category:"",type:"PERSUADE",title:"",message:"",details:_.reason,forceManual:!0});return}i({type:"NEGOTIATE",data:j});return}if(M==="SPAR"){const _=Bd(j,"SPAR");if(!_.allowed){X("",_.reason,!1,null,!1,{category:"",type:"SPAR",title:"",message:"",details:_.reason,forceManual:!0});return}if((c.energy||0)<=0){X("","",!1,null,!1,{category:"",type:"SPAR",title:"",message:"",details:"",forceManual:!0});return}C(1);const N={...c,combatStats:c.combatStats||{maxHp:100,maxMp:50,atk:10,def:5,hp:100,mp:50}},P={...j,combatStats:j.combatStats||{maxHp:100,maxMp:50,atk:10,def:5,hp:100,mp:50}},U=Kd(N,P).winner==="player";let z=0;const oe=j.identity==="",re=j.identity==="",J=j.identity==="";oe||re||J||Math.random()<.3&&(z=U?2:3);const _e=k.find(Je=>Je.id===m);if(_e){const Je=_e.relationship||{},xt=Je.affection||0;let Vn={..._e,relationship:{...Je,affection:Math.min(100,xt+z)}};Vn=uE(Vn,c,Math.floor(c.age),c.time.month,!U),Vn=wi(Vn),ne(m,Vn)}u(Je=>{const xt={...Je,currentExp:(Je.currentExp||0)+(U?3:5)};return{...xt,combatStats:Pn(xt)}});const ue=zd(j,c),Ke=(ue==null?void 0:ue.title)||(U?"":""),Qe=(ue==null?void 0:ue.description)||(U?` ${j.name}${j.gender===""?"":""}`:` ${j.name}`);X(Ke,Qe,!0,{:z,:U?3:5},!1,{category:"",type:"SPAR",title:Ke,message:`${Ke}`,details:Qe,forceManual:!0}),ja(j,"SPAR");return}if(M==="DUAL_CULTIVATION"){const _=Bd(j,"DUAL_CULTIVATION");if(!_.allowed){X("",_.reason,!1,null,!1,{category:"",type:"DUAL_CULTIVATION",title:"",message:"",details:_.reason,forceManual:!0});return}if((c.energy||0)<=0){X("","",!1,null,!1,{category:"",type:"DUAL_CULTIVATION",title:"",message:"",details:"",forceManual:!0});return}const N=_.requiresCheck;if(N&&!(Math.random()<_.checkRate)){X("",`${j.name}"..."${j.gender===""?"":""}`,!1,null,!1,{category:"",type:"DUAL_CULTIVATION",title:"",message:"",details:`${j.name}${j.gender===""?"":""}`,forceManual:!0});return}const P=50;if(c.resources.spiritStones<P){X("",` ${P} : ${c.resources.spiritStones}`,!1,null,!1,{category:"",type:"DUAL_CULTIVATION",title:"",message:"",details:` ${P}  ${c.resources.spiritStones??0}`,forceManual:!0});return}const H=((B=j.relationship)==null?void 0:B.affection)||0;let U=20,z=1;H>=80?(z=2,U=30):H>=60?(z=1.5,U=25):H>=40&&(z=1.2,U=22);const oe=Math.floor(U*z);u(ue=>{const Ke={...ue,resources:{...ue.resources,spiritStones:Math.max(0,ue.resources.spiritStones-P)},currentExp:(ue.currentExp||0)+U,energy:Math.max(0,(ue.energy||0)-1)};return{...Ke,combatStats:Pn(Ke)}});const re=k.find(ue=>ue.id===m);if(re){const ue=re.relationship||{},Ke=ue.affection||0;let Qe={...re,currentExp:(re.currentExp||0)+oe,relationship:{...ue,affection:Math.min(100,Ke+5)},dualCultivationCount:(re.dualCultivationCount||0)+1};Qe=pE(Qe,c,Math.floor(c.age),c.time.month),Qe=wi(Qe),ne(m,Qe)}let J;N?J=`${j.name}${j.gender===""?"":""}

${j.gender===""?"":""}

""${j.gender===""?"":""}""`:J=` ${j.name} ${H>=80?"":H>=60?"":""}`;const se=N?"":"",_e=N?"BUDDHA_FIRST_DUAL":"DUAL_CULTIVATION";X(se,J,!0,{:5,:U,[`${j.name}`]:oe,:-P,:-1},!1,{category:"",type:_e,title:se,message:`${se}`,details:J,forceManual:!0}),H>=70&&Math.random()<.3&&Pt(c.newsBuffer,"DUAL_CULTIVATION",{actor:c.name,target:j.name}),ja(j,"DUAL_CULTIVATION");return}if(M==="CHAT"){if((c.energy||0)<=0){X("","",!1,null,!1,{category:"",type:"CHAT",title:"",message:"",details:"",forceManual:!0});return}C(1);const _=j.identity==="",N=j.identity==="",P=j.identity==="",H=_||N||P,z=(H?Math.random()<.05:!0)?zd(j,c):null;if(z){const ue=j.relationship||{},Ke=ue.affection||0;ne(m,{relationship:{...ue,affection:Math.min(100,Ke+(z.affectionBonus||2))}});const Qe=(z==null?void 0:z.title)||"",Je=(z==null?void 0:z.text)||"";X(Qe,Je,!0,{:(z==null?void 0:z.affectionBonus)||2},!1,{category:"",type:"CHAT_EVENT",title:Qe,message:`${Qe}`,details:Je,forceManual:!0});return}const oe=H?.05:.15;if(Math.random()<oe){const ue=lw(j);if(ue){i({type:"EVENT",data:{npc:j,event:ue}});return}}const re=yk(j),se=j.identity===""||_||N||P;if(se){let ue=Wm(j,c,Math.floor(c.age),c.time.month);ue=wi(ue),ne(m,ue)}else{const ue=j.relationship||{},Ke=ue.affection||0;let Qe={...j,relationship:{...ue,affection:Ke+2}};Qe=Wm(Qe,c,Math.floor(c.age),c.time.month),Qe=wi(Qe),ne(m,Qe)}const _e=` ${j.name} ${j.gender===""?"":""}
"${re}"`;X("",_e,!0,se?{}:{:2},!1,{category:"",type:"CHAT",title:`${j.name}`,message:`${j.name}`,details:_e,forceManual:!0}),ja(j,"CHAT")}M==="DETAIL"&&L(j)},ja=(m,M)=>{const j=Pk(c,m,k,M);if(j.length>0){const B=new Set(j.map(H=>H.id)),_=[],N={CHAT:"",GIFT:"",SPAR:"",DUAL_CULTIVATION:""};if(O(H=>H.map(U=>{var _e,ue;if(!B.has(U.id))return U;const z=Ok(U,m,M);if(z===0)return U;const oe=((_e=U.relationship)==null?void 0:_e.jealousy)||0,re=Math.min(100,oe+z),J=new Set([...((ue=U.relationship)==null?void 0:ue.rivalNpcs)||[],m.id]);let se={...U,relationship:{...U.relationship||{},jealousy:re,rivalNpcs:Array.from(J),lastInteraction:c.time.month}};return _.push({witnessName:U.name,targetName:m.name,increase:z,newJealousy:re,level:Bk(re).label,actionLabel:N[M]||""}),se=Um(se,c,c.time.year,c.time.month,m,re),re>=41&&Math.random()<.3&&(se=fE(se,c,c.time.year,c.time.month)),re>=60&&Math.random()<.25&&Pt(c.newsBuffer,"NPC_JEALOUSY",{actor:U.name,target:c.name,rival:m.name}),se})),_.length>0){const H=_.map(U=>`${U.level}${U.witnessName}${U.targetName}${U.actionLabel} +${U.increase}  ${U.newJealousy}`).join(`

`);Ae(`${_[0].witnessName} ${_[0].newJealousy}`,"","JEALOUSY","",H),ya||Kc(U=>[...U,{id:`${c.time.year}-${c.time.month}-${Date.now()}`,alerts:_,summary:H,actionLabel:N[M]||"",timestamp:{year:c.time.year,month:c.time.month},targetName:m.name}])}j.find(H=>{var z;return(((z=H.relationship)==null?void 0:z.jealousy)||0)>=60})&&Ae("...")}},{handleGiftConfirm:a1,handleNegotiateConfirm:l1,handleOptionSelect:Cf,handleShuraFieldSelect:c1}=M5({player:c,inventory:l,activeNpcs:k,modalState:t,setModalState:i,removeItemFromInventory:p,updateNpc:ne,setActiveNpcs:O,batchUpdateNpcsByMap:Z,setSelectedNpc:L,showResult:X,addLog:Ae,handleWitnessCheck:ja,pushToNewsBuffer:Pt,isUsageAllowedForTarget:cs,RESOURCE_USAGE:pt,formatUsageTargets:Vs}),d1=m=>{if(m==="CULTIVATE"){if((c.energy||0)<=0){X("","",!1);return}const M=10+Math.floor(Math.random()*5);u(j=>{const B={...j,currentExp:j.currentExp+M,energy:Math.max(0,(j.energy||0)-1)};return{...B,combatStats:Pn(B)}}),X("","",!0,{:M})}if(m==="WORK"){if((c.energy||0)<=0){X("","",!1);return}const M=15;S({spiritStones:M}),C(1),X("","",!0,{:M})}},u1=()=>{if(c.resources.spiritStones<10){X("",` 10 : ${c.resources.spiritStones}`,!1);return}w({spiritStones:10});const M=3+Math.floor(Math.random()*3),j=[],B={common:[{id:"herb_bandage",basePrice:15},{id:"rice_ball",basePrice:10}],uncommon:[{id:"beast_fang",basePrice:80},{id:"beast_core",basePrice:120},{id:"iron_sword",basePrice:100}],rare:[{id:"foundation_pill",basePrice:350},{id:"thunder_wood",basePrice:400},{id:"iron_armor",basePrice:450}],epic:[{id:"core_pill",basePrice:800},{id:"artifact_supreme",basePrice:1200},{id:"marrow_wash",basePrice:900}],legendary:[{id:"nascent_fruit",basePrice:2500},{id:"heaven_manual",basePrice:3e3}]},_=i2(c.tier);let N={common:60,uncommon:25,rare:10,epic:4,legendary:1};_>=6&&_<20?N={common:50,uncommon:27,rare:14,epic:7,legendary:2}:_>=20&&(N={common:45,uncommon:25,rare:18,epic:9,legendary:3});for(let P=0;P<M;P++){const H=f1(N),U=B[H];if(U&&U.length>0){const z=U[Math.floor(Math.random()*U.length)],oe=ir(z.id);if(oe){const re=.8+Math.random()*.4;oe.price=Math.floor(z.basePrice*re),j.push(oe)}}}i({type:"SHOP",data:{items:j}})},p1=y.useCallback((m,M=1,j)=>{var H;if(!m)return;const B=Math.max(1,parseInt(M,10)||1),_=typeof j=="number"?j:(m.price||0)*B,N=((H=c==null?void 0:c.resources)==null?void 0:H.spiritStones)||0;if(N<_){X("",` ${m.name}  ${_}  ${N}`,!1);return}const P=[];if(m.stackable)P.push({...m,quantity:B,instanceId:`${m.id}_${Date.now()}_${Math.floor(Math.random()*1e4)}`});else for(let U=0;U<B;U++){const z=ir(m.id);z&&P.push(z)}if(P.length===0){X("","",!1);return}w({spiritStones:_}),d(P),X("",` ${m.name} x${B} ${_} `,!0,{:-_})},[(Df=c==null?void 0:c.resources)==null?void 0:Df.spiritStones,w,d,X]),f1=m=>{const M=Object.values(m).reduce((B,_)=>B+_,0);let j=Math.random()*M;for(const[B,_]of Object.entries(m)){if(j<_)return B;j-=_}return"common"},m1=y.useCallback(()=>{const m=qd.map(K5).filter(Boolean);if(m.length===0)return;const M=new Set(k.map(_=>_.id)),j=m.filter(_=>!M.has(_.id)).map(_=>Hm(_,c,c.time.year,c.time.month));j.length>0&&j.forEach(_=>ae(_)),u(_=>{const N=new Set((_.worldNpcs||[]).map(H=>H.id)),P=qd.map(H=>Q5(H,c.time.year)).filter(H=>H&&!N.has(H.id));return{..._,specialFlags:{..._.specialFlags||{},fumoDuoUnlocked:!0,fumoDuoMet:!0},worldNpcs:[..._.worldNpcs||[],...P]}}),qd.forEach(_=>{var N;Ae(` ${((N=_.world)==null?void 0:N.rankHint)||""}${_.name}`,"")});const B="";X("",B,!0,null,!1,{category:"",type:"FUMO_LEGEND",title:"",message:B})},[Ae,c,c.time.year,c.time.month,O,u,X]),h1=y.useCallback(m=>{if(k.some(B=>B.id===m.id)){Ae(`${m.name}`,"");return}const j=Tf(m);O(B=>[...B,j]),b(m.id,{hasMetPlayer:!0}),Ae(` ${m.name}`,"")},[k,Ae,O,b]),Tf=m=>{var j;return{id:m.id,name:m.name,gender:m.gender,identity:m.title||"",appearance:((j=m.appearance)==null?void 0:j.description)||"",desc:m.signature||"",tier:m.tier,currentExp:m.currentExp||0,maxExp:m.maxExp||500,stats:m.stats||{aptitude:85,looks:80,intelligence:85,health:90},spiritRoot:m.spiritRoot||{type:"",elements:[""],multiplier:1.8},relationship:{stage:0,affection:0,trust:0,jealousy:0},trait:{name:"",bonuses:{speedMultiplier:1.2}},sect:m.sect,sectId:m.sectId,sectRank:m.sectRank,sectStatus:m.sectStatus||"active",combatStats:m.combatStats||{hp:1e3,maxHp:1e3,atk:100,def:50,mp:500,maxMp:500},isTested:!0,isWorldElite:!0,isFollowed:!1,age:m.age||100,personality:m.personality,acceptsLetters:!0,isPregnant:!1,cultivationMethod:"basic_breath",constitution:m.constitution,avatar:m.avatar||{base:Math.floor(Math.random()*3),skinColor:Math.floor(Math.random()*5),eye:Math.floor(Math.random()*3),eyeColor:Math.floor(Math.random()*5),mouth:Math.floor(Math.random()*3),hair:Math.floor(Math.random()*3),hairColor:Math.floor(Math.random()*5)}}},g1=()=>{var B;if(c.resources.spiritStones<5){X("",` 5 : ${c.resources.spiritStones}`,!1);return}if(w({spiritStones:5}),aa){m1();return}const j=(c.worldNpcs||[]).filter(_=>_.status==="ALIVE"&&_.gender!==c.gender&&!_.hasMetPlayer);if(Math.random()<.05&&j.length>0){const _=j[Math.floor(Math.random()*j.length)],N=Tf(_);b(_.id,{hasMetPlayer:!0,firstMetYear:c.age}),k.find(U=>U.id===N.id)||ae(N);const H=`${_.gender===""?"":""}

${_.title} ${_.name}${_.gender===""?"":""}${_.tier}${_.gender===""?"":""}${((B=_.appearance)==null?void 0:B.description)||""}

${_.gender===""?"":""}...

 ${_.name}`;X(` ${_.name}`,H,!0,null,!1),Ae(` ${_.title} ${_.name}`,"");return}if(Math.random()<.4){const _=ep(c.tier);ae(_);let N="";_.identity===""?N=`${_.identity}${_.appearance}`:_.identity===""?N=`${_.identity}${_.appearance}`:_.identity===""?N=`${_.identity}${_.appearance}`:N=`${_.identity}${_.appearance}${_.desc.includes("")?"":""}`,X(`${_.name}`,N,!0,null,!1)}else X("","",!1,{:-5})},x1=y.useCallback((m,M)=>{var B;ne(m,{acceptsLetters:M}),L(_=>_&&_.id===m?{..._,acceptsLetters:M}:_);const j=((B=k.find(_=>_.id===m))==null?void 0:B.name)||"";Ae(M?`  ${j} `:`  ${j} `,"")},[k,Ae,ne]),y1=()=>{Ae("..."),q(m=>m.id===1||m.id===2?Hm(m,c,c.time.year,c.time.month):m),Mo("MAIN")},b1=(m=1)=>{const M=Wd(c.newsBuffer),j={player:c,children:ee,fallenChildren:he,activeNpcs:k,deadNpcs:T,gameStage:wn,logs:ts,inventory:l,messages:St.toJSON(),lastMessageCheck:Wo,pendingSectChoices:Uo,testQueue:os,worldEvents:c.worldEvents||[],newsBuffer:M};return my(j,m)},If=async(m=1,M=null)=>{try{let j;if(M)j=M;else try{j=await cf(m)}catch(_){console.warn(":",_),j=ho(m)}if(!j||!j.player)throw new Error("");j=sj(j);const B=aj(j.player);if(u(_=>{var N;return{...j.player,businesses:((N=j.player)==null?void 0:N.businesses)||[]}}),Me(j.children||[]),O(j.activeNpcs||[]),Q(j.deadNpcs||[]),a&&j.inventory&&a.setInventory(j.inventory),Mo(j.gameStage||"MAIN"),No(j.logs||[]),j.messages&&ss(j.messages),hf(j.lastMessageCheck||{}),j.pendingSectChoices&&Go(j.pendingSectChoices),j.testQueue&&Uc(j.testQueue),$e(j.fallenChildren||[]),Mn(!1),je(null),i({type:null,data:null}),M){let _=`
${j.gameTime||""}
${j.saveDate||""}`;B&&(_=B+`

`+_),X("",_,!0,null,!1)}else{let _=`
: ${m}
${j.saveDate||""}`;B&&(_=B+`

`+_),X("",_,!0,null,!1)}}catch(j){console.error(":",j),X("","",!1,null,!1)}},v1=()=>{OS(async()=>{const{clearAllSaves:m}=await Promise.resolve().then(()=>ej);return{clearAllSaves:m}},void 0,import.meta.url).then(({clearAllSaves:m})=>{m(),X("","",!0,null,!1)})},S1=(m,M)=>{if(c.resources.spiritStones<m.cost){X("","",!1);return}if(c.resources.spiritStones<m.cost){X("",`${m.name} ${m.cost} : ${c.resources.spiritStones}`,!1);return}const j=ee.find(_=>_.id===M),B=Math.floor(m.baseIncome*(1+j.stats.intelligence/100));h({id:`${m.id}-${Date.now()}`,name:m.name,managerId:M,baseIncome:m.baseIncome,income:B,type:m.id,cost:m.cost}),ct(M,{job:m.id}),X("",`${m.cost}${m.name}${j.name}: ${B}`,!0)},w1=(m,M)=>{if(c.resources.spiritStones<m.cost){X("",`${m.name} ${m.cost} : ${c.resources.spiritStones}`,!1);return}if((c.energy||0)<5){X("",`${m.name} 5 : ${c.energy||0}`,!1);return}w({spiritStones:m.cost}),C(5),da({id:m.id,name:m.name,total:10}),Dc(M),Do(1);const j=M.map(N=>{var P;return(P=ee.find(H=>H.id===N))==null?void 0:P.name}).filter(Boolean).join(""),B=`${m.name}${j||""}`;Ls([B,`${m.name}`,`${m.difficulty}${m.recommendCP}`]);const _=Sh({realmId:m.id,progress:1});pa(_),Po(!0),Ae(B,"exploration")},E1=y.useCallback(m=>{var j;if(!m)return;const M=[m.tierTitle?`${m.tierTitle}`:null,typeof m.ageAtDeath=="number"?`${m.ageAtDeath}`:null,m.deathYear?` ${m.deathYear} ${m.deathMonth||1}`:null,m.deathReason?`${m.deathReason}`:null,(j=m.sect)!=null&&j.name?`${m.sect.name}${m.rank?`  ${m.rank}`:""}`:null,typeof m.descendants=="number"?`${m.descendants}`:null,m.influenceLabel?`${m.influenceLabel}`:null].filter(Boolean).join(`
`);X(`  ${m.name}`,`${m.epitaph||""}

${M}`,!0,null,!1)},[X]),k1=m=>{de(M=>M.id===m.id,M=>{const j={...M,isTested:!0,spiritRoot:m.spiritRoot};return mt(j)})},Jc=y.useCallback((m=!1)=>{var Vf,Yf,qf,Kf,Qf,Jf;let M=[];const j=te=>m?!te.includes(""):!0;let B=[],_=0;const N=k.map(te=>{if(te.isPregnant){const we=te.pregnancyProgress+1;if(we>=9){const fe=O2(c,te,Math.floor(c.age));B.push(fe),M.push(`${te.name}${fe.name}${fe.gender}${fe.tier}`),Pt(c.newsBuffer||[],"BIRTH",{actor:c.name,target:fe.name,detail:fe.gender}),_+=1;let Te=gE(te,c,Math.floor(c.age),c.time.month,fe.name);const Xe=Math.random()>.7?"":"",We=Math.random()>.85;return Lr.onChildBirth(Te,fe,{difficulty:Xe,sacrifice:We}),{...Te,isPregnant:!1,pregnancyProgress:0}}return{...te,pregnancyProgress:we}}return te});ie(N);const P=((Vf=c.stats)==null?void 0:Vf.health)||50,H=Lt(P);x({energy:H});const{newChildren:U,totalCost:z,logs:oe,events:re}=P2(ee||[],c.resources,{familyRatingMultiplier:ka});let J=[...U];const se=new Set(((c==null?void 0:c.exiledChildren)||[]).map(te=>te.id)),_e=J.filter(te=>{const we=Math.floor(te.age*12);return we>=72&&we<78&&!te.isTested&&!se.has(te.id)});if(_e.length>0){const te=new Set(_e.map(fe=>fe.id));J=J.map(fe=>{var Te;if(te.has(fe.id)){const Xe=((Te=fe.stats)==null?void 0:Te.aptitude)||50,We=qn(Xe,fe.spiritRoot,null,{constitution:fe.constitution}),nt={...fe,spiritRoot:We,isTested:!0};if(F||(fe.generation||1)>1){const wt=mt(nt);return M.push({message:` ${fe.name} ${We.type}${Xe}`,category:""}),wt}return nt}return fe});const we=F?[]:J.filter(fe=>_e.some(Te=>Te.id===fe.id)&&(fe.generation||1)===1);we.length>0&&(Uc(fe=>[...fe,...we]),tn&&Mn(!1))}B.length>0&&(J=[...J,...B]);const ue=J.reduce((te,we)=>(SC(we)?te.casualties.push(we):te.survivors.push(we),te),{survivors:[],casualties:[]});ue.casualties.length>0&&($o(ue.casualties,J),ge&&ue.casualties.some(te=>te.id===ge.id)&&je(null)),Se(ue.survivors);const Ke=re.filter(te=>te.type==="GRANDCHILD_BIRTH");if(_+=Ke.length,_>0&&M.push(` ${_}${_}`),M=[...M,...oe],re.length>0){re.filter(fe=>fe.type==="ZHAOZHOU").forEach(fe=>{X(fe.title,fe.message,!0,null,!1)});const te=re.filter(fe=>fe.type==="CHILD_PROMOTION_GIFT");te.length>0&&(te.length>=2&&!Gn?(Yo(te),e.openBatchPromotionModal()):te.forEach(fe=>{const Te=fe.giftItemId?ir(fe.giftItemId):null;Te&&d([Te]);const Xe=fe.title||"";Gn||X(Xe,fe.message,!0,null,!1)}));const we=re.filter(fe=>{var Te;return fe.type==="JOIN_SECT"&&!se.has((Te=fe.child)==null?void 0:Te.id)});if(we.length>0)if($s){let fe=0;D(Te=>{if(!we.find(Rt=>{var wt;return((wt=Rt.child)==null?void 0:wt.id)===Te.id})||!(Math.floor(Te.age*12)>=144)||!Te.isTested||Te.sect||se.has(Te.id))return Te;const nt=Xc(Te);return nt?(fe++,{...Te,sect:nt,rank:Ni(Te,nt)}):Te}),fe>0&&X("",` ${fe} `,!0)}else Go(fe=>{const Te=[...fe,...we];return Te.sort((Xe,We)=>{var Rt,wt;return(((Rt=Xe.child)==null?void 0:Rt.name)||"").localeCompare(((wt=We.child)==null?void 0:wt.name)||"")}),Te}),tn&&Mn(!1)}if(c.businesses&&c.businesses.length>0&&J){const{income:te,logs:we}=bm(c.businesses,J);M=[...M,...we],te>0&&M.push(` : ${te} `)}let Qe=0;if(J.forEach(te=>{Qe+=Gu(te,{familyRatingMultiplier:ka})}),c.rival&&!c.rival.isDead){const te=Tj(c);c.rival.threatLevel=Math.min(100,(c.rival.threatLevel||0)+te);const we=jj(c);if(we){const{survived:fe,message:Te,type:Xe,hpLoss:We}=we,nt=fe?"":"";m&&Mn(!1),M.push(`${nt}${Te}`);let Rt="";if(We&&We>0){const wt=Math.max(10,Math.floor(We*.2+Math.random()*We*.2)),Tt=ko(c,wt,"ASSASSINATION");if(c.stats.health=Tt.newHealth,Tt.energyPenalty>0){const ni=Lt(Tt.newHealth);c.energy=Math.min(c.energy||20,ni)}Rt=Tt.message,Tt.isSerious&&M.push(" ")}Pt(c.newsBuffer||[],Xe||(fe?"ASSASSINATION_SURVIVED":"ASSASSINATION_INJURED"),{actor:c.name}),X("",Rt?`${Te}
${Rt}`:Te,fe,null,!1)}if(c.time.month===12){const fe=Cj(c);fe&&Pt(c.newsBuffer||[],fe.type,fe.data)}}if(!((Yf=c.rival)!=null&&Yf.isDead)&&(((qf=c.rival)==null?void 0:qf.threatLevel)||0)>=100){m&&Mn(!1);const we={currentExp:((Kf=c.rival)==null?void 0:Kf.currentExp)||300,stats:{aptitude:80}},fe=bl(we),Te={name:"",combatStats:{hp:Math.floor(fe*2.5),atk:Math.floor(fe*.4),def:Math.floor(fe*.2),mp:0,maxHp:Math.floor(fe*2.5),maxMp:0}},Xe={...c,combatStats:c.combatStats||{maxHp:100,maxMp:50,atk:10,def:5,hp:100,mp:50}},We=Kd(Xe,Te);Oo({enemy:Te,result:We,context:"rival"}),u(nt=>({...nt,rival:{...nt.rival,threatLevel:0}}))}u(te=>{var _a;const we={...te.time};we.month+=1,we.month>12&&(we.month=1,we.year+=1);const fe=(te.age||16)+1/12,Te=w2(te);let Xe=((_a=te.stats)==null?void 0:_a.health)||50,We=te.energy||20;if(Te&&Te.recovered>0){Xe=Te.newHealth,M.push(Te.message);const Xf=Lt(Xe);Xf>We&&(We=Xf)}const nt={...te,energy:We,stats:{...te.stats,health:Xe}},Rt=bn(nt.tier),wt=kc(nt,!0);let Tt=nt.currentExp+wt+Qe;Tt>=Rt.maxExp&&(Tt=Rt.maxExp);const{income:ni}=bm(nt.businesses||[],J),Ia={...nt,age:fe,skillPoints:(nt.skillPoints||0)+_,time:we,currentExp:Tt,maxExp:Rt.maxExp,resources:{...nt.resources,spiritStones:Math.max(0,nt.resources.spiritStones-z+10+ni)}};return{...Ia,combatStats:Pn(Ia)}}),M.length===0&&M.push("..."),M.forEach(te=>{j(te)&&Ae(te)});const Je=c.time.month===12?1:c.time.month+1,xt=c.time.month===12?c.time.year+1:c.time.year;try{const we=(c.time.year-3572)*12+c.time.month+1;if(we%36===0){const fe=c.time.year+(Je===1?1:0),Te=vh(fe,{ownedFumoSwords:tr,soldAuctionItems:c.soldAuctionItems||[]}),Xe=we,We=Xe+12;u(nt=>({...nt,lastAuctionYear:fe,currentAuction:Te,auctionWindowStart:Xe,auctionWindowEnd:We})),Qo({id:`${fe}-${Date.now()}`,message:""}),tn&&Mn(!1),Ae(" ")}}catch(te){console.warn("",te)}const Vn=NE(N,c,xt,Je),Hf=Vn.npcs,ed=Vn.events,Wf=ed.filter(te=>te.type==="NPC_LIFESPAN_ALERT");if(Wf.length>0){const te=Wf.map(we=>{const fe=Math.max(0,Math.floor(we.remainingYears));return`${we.npcName} ${fe} `});X("",te.join(`
`),!1,null,!1,{title:"",category:"",type:"WARNING"}),tn&&Mn(!1)}const Ta=ed.filter(te=>te.type==="NPC_GIFT");if(Ta.length>0)if(Ta.length>=2&&!xa)Vo(Ta),e.openBatchGiftModal();else{const te=[];if(Ta.forEach(we=>{const fe=ir(we.giftItemId);if(fe){d([fe]);const Te=`${we.message}${fe.name}`;Ae(Te),te.push(`${we.message}
${fe.name}`)}}),!xa&&te.length>0){const we=te.join(`

`);X("",we,!0,null,!1,{category:"",type:"NPC_GIFT",title:"",message:we,details:we,forceManual:!0})}}const ei=Hf.filter(te=>!te.isDead),td=Hf.filter(te=>te.isDead);td.length>0&&(Q(te=>[...te,...td]),td.forEach(te=>{const we=qk(te,c,{year:xt,month:Je});St.addMessage(we)}),ss(St.getAllMessages())),Je%3===0&&(ei.forEach(te=>{if(!(te.sect||te.status==="away"))return;const fe=Wo[te.id]||0,Te=xt*12+Je,Xe=Te-fe,nt=St.getAllMessages().find(Rt=>Rt.senderId===te.id&&Rt.type===It.LETTER);if(Yk(te,Xe,nt)){const Rt=St.getRecentRepliesForNpc(te.id,3);eh(te,c,{year:xt,month:Je},!0,{apiKey:localStorage.getItem("game_api_key")||"",apiUrl:localStorage.getItem("game_api_url")||"https://api.deepseek.com/chat/completions",apiModel:localStorage.getItem("game_api_model")||"deepseek-chat",useAIForLetter:localStorage.getItem("useAIForLetter")!=="false"},{children:ee,exiledChildren:c.exiledChildren||[],dualCultivationCount:te.dualCultivationCount||0,replyHistory:Rt}).then(wt=>{St.addMessage(wt),ss(St.getAllMessages())}).catch(wt=>{console.error(":",wt)}),hf(wt=>({...wt,[te.id]:Te}))}}),ss(St.getAllMessages())),ed.forEach(te=>{var we;if(te.type==="NPC_DEATH")M.push(` ${te.message}`),Pt(c.newsBuffer||[],"DEATH",{actor:te.npcName,detail:te.age||0,location:""});else if(te.type==="NPC_BREAKTHROUGH"){M.push(` ${te.message}`),Pt(c.newsBuffer||[],"NPC_BREAKTHROUGH",{actor:te.npcName,detail:te.newTier});const fe=ei.find(Te=>Te.name===te.npcName);fe&&((we=fe.relationship)==null?void 0:we.affection)>=70&&Math.random()<.4&&Pt(c.newsBuffer||[],"NPC_AFFECTION_HIGH",{actor:c.name,target:fe.name})}else te.type==="NPC_BREAKTHROUGH_FAIL"&&Pt(c.newsBuffer||[],"BREAKTHROUGH_FAIL",{actor:te.npcName,detail:te.tier})});const nd=bE(ei,c,xt,Je),J1=nd.map(te=>{te.jealousy||(te.jealousy=0),te.lastInteraction||(te.lastInteraction={year:xt,month:Je});const we=xt*12+Je,fe=te.lastInteraction.year*12+te.lastInteraction.month,Te=we-fe;if(Te>=3){const{jealousyGain:Xe,shouldLog:We}=zk(te,Te);if(Xe>0&&(te.jealousy=Math.min(100,(te.jealousy||0)+Xe),We)){const nt=Um(te,te.jealousy,{year:xt,month:Je},c.name,"neglect");nt&&(te.logs=[...te.logs||[],nt])}}if(te.jealousy>0){const Xe=Dk(te);te.jealousy=Math.max(0,te.jealousy-Xe)}return te});ie(J1);const Uf=nk(xt,Je,c,nd),Gf=lk(c,J,xt,Je);Gf&&Uf.push(Gf),Uf.forEach(te=>{Ae(te.message,te.category,te.type,te.title)});let ti=c.worldNpcs||[];if(Je%3===0&&ti.length>0&&(ti=fh(ti,xt),x({worldNpcs:ti})),Je%3===0)if(localStorage.getItem("enableGazette")!=="false"){const we=c.newsBuffer||[],fe=we.length>0?we:[{type:"FILLER",data:{},timestamp:Date.now()}];localStorage.getItem("game_api_key"),localStorage.getItem("game_api_url"),localStorage.getItem("game_api_model"),localStorage.getItem("useAIForGazette");const Te={...c,worldNpcs:ti};x({newsBuffer:[],hasUnreadGazette:!1}),Promise.resolve(gj(fe,Te,nd,(Te.gazetteIssue||0)+1)).then(Xe=>{Xe&&(x({gazetteHistory:[...Te.gazetteHistory||[],Xe],gazetteIssue:Xe.issue,hasUnreadGazette:!0}),Wc(Xe))}).catch(Xe=>{console.error(":",Xe),E()})}else x({newsBuffer:[]});if(Je===1&&Je!==3){const te=fh(c.worldNpcs||[],xt);x({worldNpcs:te}),evolvedWorldNpcs.forEach(we=>{we.status==="DEAD"&&we.deathYear===xt&&(Pt(c.newsBuffer||[],"DEATH",{actor:`${we.title} ${we.name}`,detail:we.age,location:we.deathReason||""}),Ae(` ${we.rank?`${we.rank}`:""}${we.title} ${we.name}${we.deathReason}`))})}if(Je%3===0)if(Ho)Os.length>0&&Jo([]);else{const te=Fk(ei);if(te){const we=Hk(te.participants,c),fe=we.participants.map(We=>We.name),Te=fe[0]||"",Xe=fe[1]||"";Pt(c.newsBuffer,"SHURA_FIELD",{actor:c.name,dominant:Te,rival:Xe,participants:fe.join(""),count:fe.length}),q(We=>{if(!we.participants.find(_a=>_a.id===We.id))return We;const Rt=typeof We.personality=="object"&&We.personality!==null&&"label"in We.personality?We.personality.label:Array.isArray(We.personality)?We.personality[0]:"",wt=c.gender===""?"":"";let Tt="";switch(Rt){case"":Tt=`...${c.name}${c.name}`;break;case"":Tt=`...${c.name}${wt}${wt}`;break;case"":Tt=`${c.name}...`;break;case"":Tt=`${c.name}.........`;break;case"":Tt=`${c.name}${wt}...`;break;case"":Tt=`${c.name}...`;break;case"":Tt=`...${c.name}""...`;break;case"":Tt=`${c.name}......`;break;case"":Tt=`${c.name}${wt}...`;break;default:Tt=`...${c.name}${wt}...`}const ni=We.logs||[],Ia={year:c.time.year,month:c.time.month,content:Tt,type:"DAILY",isSecret:!0,timestamp:Date.now()};return{...We,logs:[Ia,...ni].slice(0,50)}}),Jo(We=>[...We,we]),tn&&Mn(!1),Ae(" ...")}}const X1=((Qf=c==null?void 0:c.time)==null?void 0:Qf.year)??0,rd=((Jf=c==null?void 0:c.time)==null?void 0:Jf.month)??0,sd=`${X1}-${rd}`,Z1=yf.current===sd,eb=wa.current===sd,tb=bf&&rd%2===0;if(!Z1&&!eb&&rd>0&&!tb)try{const te=Wd(c.newsBuffer),we={player:c,children:ee,fallenChildren:he,activeNpcs:ei,deadNpcs:T,gameStage:wn,logs:ts,inventory:l,messages:St.toJSON(),lastMessageCheck:Wo,pendingSectChoices:Uo,testQueue:os,worldEvents:c.worldEvents||[],newsBuffer:te};xf(we,sd)}catch(te){console.error(":",te)}},[ee,c,k,os,Gn,Ho,xa,tn,Os,$o,ge,je,wn,ts,l,St,Wo,Uo,xf,bf]),j1=(m,M,j="")=>{var H,U;const B=Hx(M),_=ee.find(z=>z.id===m);if(!_)return;const N=Ux(_,B);if(!N.qualified){X("",((H=N.reasons)==null?void 0:H.join(""))||"",!1);return}de(z=>z.id===m,z=>{const oe={...z,sect:B,rank:j},re=k.find(se=>se.name===z.fatherName||se.name===z.motherName);re&&Lr.onChildJoinSect(re,z,B.name),eh({id:z.id,name:z.name,gender:z.gender,sect:B.name,tier:z.tierTitle,fatherName:z.fatherName,generation:z.generation,affection:100,relationship:{affection:100,stage:0}},c,{year:Math.floor(c.age),month:c.time.month},!0,{apiKey:localStorage.getItem("game_api_key")||"",apiUrl:localStorage.getItem("game_api_url")||"https://api.deepseek.com/chat/completions",apiModel:localStorage.getItem("game_api_model")||"deepseek-chat",useAIForLetter:localStorage.getItem("useAIForLetter")!=="false"},{children:ee,exiledChildren:c.exiledChildren||[],replyHistory:St.getRecentRepliesForNpc(z.id,3)}).then(se=>{St.addMessage(se),ss(St.getAllMessages())}).catch(se=>{console.error(":",se)}),Pt(c.newsBuffer||[],"JOIN_SECT",{actor:c.name,target:z.name,detail:B.name});const J=zj(oe,B.name);return J&&Ae(J,"cultivation"),mt(oe)}),Go(z=>z.filter(oe=>oe.child.id!==m));const P=((U=ee.find(z=>z.id===m))==null?void 0:U.name)||"";Ae(` ${P} ${B.name}`,"")};y.useEffect(()=>{let m;if(tn){const M=()=>{Jc(!0),m=setTimeout(M,1e3/ns)};m=setTimeout(M,1e3/ns)}return()=>clearTimeout(m)},[tn,ns,Jc]),y.useEffect(()=>{if(ya){Ea.length>0&&Kc([]);return}if(Ea.length>0&&!t.type){const m=Ea[0];i({type:"JEALOUSY",data:m}),Kc(M=>M.slice(1))}},[Ea,t.type,ya]),y.useEffect(()=>{if(Ho){Os.length>0&&Jo([]);return}if(Os.length!==0){if(t.type==="RESULT"&&vf!==!1){i({type:null,data:null});return}if(!t.type){const m=Os[0];i({type:"SHURA_FIELD",data:m}),Jo(M=>M.slice(1))}}},[Os,t.type,vf,Ho]),y.useEffect(()=>{var M,j,B,_;if(!ge)return;const m=me.find(N=>N.id===ge.id);m&&(m.name!==ge.name||m.cultivation!==ge.cultivation||((M=m.stats)==null?void 0:M.aptitude)!==((j=ge.stats)==null?void 0:j.aptitude)||((B=m.influenceProfile)==null?void 0:B.tierId)!==((_=ge.influenceProfile)==null?void 0:_.tierId)||m.isFavorite!==ge.isFavorite)&&je(m)},[Rs,me,ge,je]);const C1=m=>{const M=ee.find(B=>B.id===m);if(!M)return;if(Math.floor(M.age*12)<216){X("","18",!1,null,!1);return}if(c.resources.spiritStones<500){X("",` 500 : ${c.resources.spiritStones}`,!1);return}const j=ym(M.tierTitle||"",M.gender);Vc(j),Yc(M),Gc(!0)},T1=m=>{if(!Sa)return;de(j=>j.id===Sa.id,j=>{const B=k.find(_=>_.name===j.fatherName||_.name===j.motherName);if(B){Lr.onChildMarriage(B,j,m.name);const _=Gm(B,c,Math.floor(c.age),c.time.month,m.name);ne(B.id,_)}return{...j,spouse:m}}),w({spiritStones:500}),Ae(` 500 ${Sa.name}  ${m.name} `),Gc(!1),Vc([]),Yc(null)},I1=(m,M,j)=>{var B,_;if(M==="CHAT"){const N=ee.find(z=>z.id===m);if(!N)return;if((c.energy||0)<=0){X("","",!1);return}C(1);const P={...N,isChild:!0,relationship:{affection:100}},H=zd(P,c);if(H){X((H==null?void 0:H.title)||"",(H==null?void 0:H.text)||"",!0,null);return}const U=[`${N.name}`,`${N.name}`,`${N.name}${N.gender===""?"":""}`,`${N.name}"${c.gender===""?"":""}"`,`${N.name}`];X("",U[Math.floor(Math.random()*U.length)],!0,null);return}if(M==="MARRY"){C1(m);return}if(M==="RENAME"&&(ct(m,{name:j}),je(N=>N&&N.id===m?{...N,name:j}:N),X("","",!0)),M==="FEED_PILL"){if(c.resources.spiritStones<100){X("",` 100 : ${c.resources.spiritStones}`,!1);return}const P=ee.find(oe=>oe.id===m);if(!P)return;const H=500*(1+(((B=P.stats)==null?void 0:B.aptitude)||0)/100),U=Kt(P,H);w({spiritStones:100}),de(oe=>oe.id===m,oe=>{var se;const re=500*(1+(((se=oe.stats)==null?void 0:se.aptitude)||0)/100),J=Kt(oe,re);return mt(J.updated)}),je(oe=>{var re;if(oe&&oe.id===m){const J=500*(1+(((re=oe.stats)==null?void 0:re.aptitude)||0)/100),se=Kt(oe,J);return mt(se.updated)}return oe});const z=U.tierChanged?`

 ${P.name} ${U.newTier} ${U.lifespanIncrease} `:"";X("",`${z}`,!0)}if(M==="EDUCATE"){if(c.resources.spiritStones<50){X("",` 50 : ${c.resources.spiritStones}`,!1);return}w({spiritStones:50});const P=ee.find(z=>z.id===m),H=P?Kt(P,Math.floor((((_=P.stats)==null?void 0:_.aptitude)||50)*5)):null;de(z=>z.id===m,z=>{var J;const oe=Math.floor((((J=z.stats)==null?void 0:J.aptitude)||50)*5),re=Kt(z,oe);return mt(re.updated)}),je(z=>{var oe;if(z&&z.id===m){const re=Math.floor((((oe=z.stats)==null?void 0:oe.aptitude)||50)*5),J=Kt(z,re);return mt(J.updated)}return z});const U=H!=null&&H.tierChanged?`

 ${(P==null?void 0:P.name)||""} ${H.newTier} ${H.lifespanIncrease} `:"";X("",`${(ge==null?void 0:ge.name)||""} ${U}

 `,!0)}if(M==="OPEN_INVENTORY"&&e.openInventory((j==null?void 0:j.mode)||"VIEW",(j==null?void 0:j.slot)||null,m),M==="UNEQUIP"){const N=j==null?void 0:j.slot;if(!N)return;const P=ee.find(z=>z.id===m);if(!P)return;const H=Zo(P),U=H.equipment[N];if(!U)return;a.setInventory(z=>[U,...z]),de(z=>z.id===m,z=>{const oe={...H,equipment:{...H.equipment,[N]:null}};return mt(oe)}),je(z=>{if(z&&z.id===m){const oe={...H,equipment:{...H.equipment,[N]:null}};return mt(oe)}return z})}if(M==="CHANGE_MANUAL"){if(!ee.find(H=>H.id===m))return;if(l.filter(H=>H.type==="manual").length===0){X("","",!1);return}e.openInventory("MANUAL_SELECT",null,m)}if(M==="SELECT_SECT"){const N=ee.find(U=>U.id===m);if(!N)return;if(Math.floor(N.age*12)<144){X("","12",!1);return}if(!N.isTested){X("","",!1);return}const{recommended:P,others:H}=Yu(N);if(!P.length&&!H.length){X("","",!1);return}Go([{type:"JOIN_SECT",title:"",message:`${N.name} `,child:N,selectableSects:P,otherSectOptions:H,showModal:!0}]),tn&&Mn(!1)}if(M==="TOGGLE_AUTO_JOIN_SECT"){const N=!!j;ct(m,{autoJoinBestSect:N}),je(P=>P&&P.id===m?{...P,autoJoinBestSect:N}:P),X("",N?"":"",!0);return}if(M==="EXPEL"){const N=ee.find(P=>P.id===m);if(!N)return;vt(m),x({exiledChildren:[...c.exiledChildren||[],N]}),je(null),Ae(` ${N.name} `),X("",`${N.name} `,!0);return}},Xc=m=>{const{recommended:M,others:j}=Yu(m),B=[...M,...j],_=B.filter(N=>{var P;return(P=N.admission)==null?void 0:P.qualified});return _.length?_[0].sect:B.length?B[0].sect:null},_1=m=>{if(ga(!!m),!m){X("","",!0);return}let M=0;D(j=>{if(!(Math.floor(j.age*12)>=144)||!j.isTested||j.sect)return j;const _=Xc(j);return _?(M++,{...j,sect:_,rank:Ni(j,_)}):j}),X("",` ${M} `,!0)},R1=()=>{var P;const M=((P=c==null?void 0:c.resources)==null?void 0:P.spiritStones)||0,j=ee.filter(H=>!H.spouse&&Math.floor((H.age||0)*12)>=216).sort((H,U)=>{var z,oe;return(((z=U.stats)==null?void 0:z.aptitude)||0)-(((oe=H.stats)==null?void 0:oe.aptitude)||0)});if(!j.length){X("","18",!1);return}const B=Math.min(j.length,Math.floor(M/500));if(B<=0){X(""," 500 ",!1);return}const N=j.slice(0,B).map(H=>{const z=(ym(H.tierTitle||"",H.gender)||[]).reduce((oe,re)=>{var _e,ue,Ke,Qe;if(!oe)return re;const J=((_e=re.stats)==null?void 0:_e.aptitude)||0,se=((ue=oe.stats)==null?void 0:ue.aptitude)||0;return J===se?(((Ke=re.stats)==null?void 0:Ke.intelligence)||0)>(((Qe=oe.stats)==null?void 0:Qe.intelligence)||0)?re:oe:J>se?re:oe},null)||z2(H.tierTitle||"",H.gender);return{childId:H.id,childName:H.name,spouse:z,childRef:H}});if(!N.length){X("","",!1);return}qo(N),e.openBatchMarriageModal()},M1=m=>{var H;if(!m||m.length===0){e.closeBatchMarriageModal(),qo([]);return}const M=new Map(m.map(U=>[U.childId,U]));D(U=>{const z=M.get(U.id);return z?{...U,spouse:z.spouse}:U}),je(U=>U&&M.has(U.id)?{...U,spouse:M.get(U.id).spouse}:U);const j=Math.floor((c==null?void 0:c.age)||0),B=((H=c==null?void 0:c.time)==null?void 0:H.month)??1,_=new Map;m.forEach(U=>{var re,J;const z=U.childRef,oe=k.find(se=>se.name===z.fatherName||se.name===z.motherName);if(oe&&!_.has(oe.id)){Lr.onChildMarriage(oe,z,(re=U.spouse)==null?void 0:re.name);const se=Gm(oe,c,j,B,(J=U.spouse)==null?void 0:J.name);_.set(oe.id,se)}}),_.size&&Z(_);const N=m.length*500;w({spiritStones:N});const P=m.map(U=>{var z,oe,re;return` ${U.childName}  ${((z=U.spouse)==null?void 0:z.name)||""}${((re=(oe=U.spouse)==null?void 0:oe.stats)==null?void 0:re.aptitude)??"?"}`}).join(`
`);Ae(`  ${m.length} 
${P}`),X("",` ${N}  ${m.length} 
${P}`,!0),e.closeBatchMarriageModal(),qo([])},A1=m=>{He(!!m),X(m?"":"",m?"":"",!0)},N1=m=>{Bs(!!m),X(m?"":"",m?"":"",!0)},L1=m=>{Ay(!!m),m&&Jo([]),X(m?"":"",m?"":"",!0)},$1=m=>{Ny(!!m),X(m?"":"",m?"":"",!0)},B1=m=>{Ly(!!m),X(m?"":"",m?"":"",!0)},_f=(m,M,j)=>{const B=l.find(H=>H.instanceId===j);if(!B)return X("","",!1);if(B.slot!==M)return X("","",!1);const _=ee.find(H=>H.id===m);if(!_)return;const N=Zo(_),P=N.equipment[M];de(H=>H.id===m,H=>{const U={...N,equipment:{...N.equipment,[M]:B}};return mt(U)}),je(H=>{if(H&&H.id===m){const U={...N,equipment:{...N.equipment,[M]:B}};return mt(U)}return H}),a.setInventory(H=>{const U=H.filter(z=>z.instanceId!==j);return P?[P,...U]:U}),e.closeInventory(),X("",`${_.name}  ${B.name}`,!0)},Zc=(m,M)=>{var oe;const j=l.find(re=>re.instanceId===M);if(!j)return X("","",!1);const B=!m,_=B?null:ee.find(re=>re.id===m);if(!B&&!_)return X("","",!1);const N=B?pt.PLAYER:pt.CHILD;if(!cs(j,N)){X("",`${j.name||""}  ${Vs(j)} `,!1);return}if(j.type==="manual"){const re=j.manualIds||[];if(re.length===0)return X("","",!1);const J=re[Math.floor(Math.random()*re.length)],se=on[J];if(!se)return X("","",!1);if(B){u(ue=>{const Ke={...ue,cultivationMethod:J};return mt(Ke)}),e.closeInventory(),X("",` ${se.name||J}`,!0);return}const _e=rh(_,J);if(!_e.success)return X("",_e.message,!1);de(ue=>ue.id===m,ue=>{const Ke={...ue,cultivationMethod:J};return mt(Ke)}),je(ue=>{if(ue&&ue.id===m){const Ke={...ue,cultivationMethod:J};return mt(Ke)}return ue}),e.closeInventory(),Ae(_e.message),X("",_e.message+"",!0,{:((oe=_e.compatibility)==null?void 0:oe.desc)||""});return}if(["weapon","armor","accessory"].includes(j.type)){if(B){u(re=>{const J=Zo(re),se={...J,equipment:{...J.equipment,[j.slot]:j}};return mt(se)}),a.setInventory(re=>re.filter(J=>J.instanceId!==M)),e.closeInventory(),X("",` ${j.name}`,!0);return}_f(m,j.slot,M);return}if(j.type!=="consumable")return X("","",!1);const P=j.effect||{};if(B){u(J=>{var _e,ue;let se={...J};if(P.kind==="exp")se.currentExp=(se.currentExp||0)+(P.amount||0);else if(P.kind==="aptitude"){const Ke=Math.min(100,(((_e=se.stats)==null?void 0:_e.aptitude)||50)+(P.amount||0));se={...se,stats:{...se.stats,aptitude:Ke}};try{const Qe=qn(Ke,se.spiritRoot,null,{constitution:se.constitution});se={...se,spiritRoot:Qe}}catch{}}else if(P.kind==="heal"){const Ke=((ue=se.stats)==null?void 0:ue.health)||100,Qe=Math.min(100,Ke+(P.amount||0));se={...se,stats:{...se.stats,health:Qe}};const Je=Lt(Ke),xt=Lt(Qe),Vn=xt-Je;Vn>0&&(se.energy=Math.min(xt,(se.energy||0)+Vn))}return mt(se)}),p(M,j.stackable?1:void 0),e.closeInventory();let re=`  ${j.name}`;P.kind==="exp"&&(re+=` +${P.amount}`),P.kind==="aptitude"&&(re+=` +${P.amount}`),P.kind==="heal"&&(re+=""),X("",re,!0);return}const H=P.kind==="exp"?P.amount||0:P.kind==="heal"?Math.floor((P.amount||0)*2):0,U=H>0?Kt(_,H):null;de(re=>re.id===m,re=>{var se;let J={...re};if(P.kind==="exp"||P.kind==="heal")J=Kt(J,H).updated;else if(P.kind==="aptitude"){const _e=Math.min(100,(((se=J.stats)==null?void 0:se.aptitude)||50)+(P.amount||0));if(J={...J,stats:{...J.stats,aptitude:_e}},J.isTested||J.spiritRoot&&Array.isArray(J.spiritRoot.elements))try{const ue=qn(_e,J.spiritRoot,null,{constitution:J.constitution});J={...J,spiritRoot:ue}}catch{}}return mt(J)}),je(re=>{var J;if(re&&re.id===m){let se={...re};if(P.kind==="exp"||P.kind==="heal")se=Kt(se,H).updated;else if(P.kind==="aptitude"){const _e=Math.min(100,(((J=se.stats)==null?void 0:J.aptitude)||50)+(P.amount||0));if(se={...se,stats:{...se.stats,aptitude:_e}},se.isTested||se.spiritRoot&&Array.isArray(se.spiritRoot.elements))try{const ue=qn(_e,se.spiritRoot,null,{constitution:se.constitution});se={...se,spiritRoot:ue}}catch{}}return mt(se)}return re}),p(M,j.stackable?1:void 0),e.closeInventory();let z=`${_.name}  ${j.name}`;P.kind==="exp"&&(z+=`+${P.amount}`),P.kind==="aptitude"&&(z+=`+${P.amount}`),P.kind==="heal"&&(z+=""),U!=null&&U.tierChanged&&(z+=`

 ${_.name} ${U.newTier} ${U.lifespanIncrease} `),X("",z,!0)},O1=(m,M)=>{if(!M||M.length===0){X("","",!1);return}const j=!m,B=j?c:ee.find(re=>re.id===m);if(!j&&!B){X("","",!1);return}let _=0,N=0,P=0,H=[];M.forEach(re=>{const J=l.find(Je=>Je.instanceId===re.instanceId);if(!J||!J.effect)return;const se=Math.min(re.quantity||1,J.quantity||1);if(se<=0)return;const _e=j?pt.PLAYER:pt.CHILD;if(!cs(J,_e))return;const ue=J.effect,Qe=(ue.amount||0)*se;ue.kind==="exp"?_+=Qe:ue.kind==="aptitude"?N+=Qe:ue.kind==="heal"&&(P+=Qe),H.push({name:J.name,quantity:se,effect:ue.kind}),p(J.instanceId,se)});const U=j?0:_+Math.floor(P*2),z=!j&&U>0?Kt(B,U):null;j?u(re=>{var se,_e;let J={...re};if(_>0&&(J.currentExp=(J.currentExp||0)+_),N>0){const ue=Math.min(100,(((se=J.stats)==null?void 0:se.aptitude)||50)+N);J={...J,stats:{...J.stats,aptitude:ue}};try{const Ke=qn(ue,J.spiritRoot,null,{constitution:J.constitution});J={...J,spiritRoot:Ke}}catch{}}if(P>0){const ue=((_e=J.stats)==null?void 0:_e.health)||100,Ke=Math.min(100,ue+P);J={...J,stats:{...J.stats,health:Ke}};const Qe=Lt(ue),Je=Lt(Ke),xt=Je-Qe;xt>0&&(J.energy=Math.min(Je,(J.energy||0)+xt))}return mt(J)}):(de(re=>re.id===m,re=>{var se;let J={...re};if(U>0&&(J=Kt(J,U).updated),N>0){const _e=Math.min(100,(((se=J.stats)==null?void 0:se.aptitude)||50)+N);if(J={...J,stats:{...J.stats,aptitude:_e}},J.isTested||J.spiritRoot&&Array.isArray(J.spiritRoot.elements))try{const ue=qn(_e,J.spiritRoot,null,{constitution:J.constitution});J={...J,spiritRoot:ue}}catch{}}return mt(J)}),je(re=>{var J;if(re&&re.id===m){let se={...re};if(U>0&&(se=Kt(se,U).updated),N>0){const _e=Math.min(100,(((J=se.stats)==null?void 0:J.aptitude)||50)+N);if(se={...se,stats:{...se.stats,aptitude:_e}},se.isTested||se.spiritRoot&&Array.isArray(se.spiritRoot.elements))try{const ue=qn(_e,se.spiritRoot,null,{constitution:se.constitution});se={...se,spiritRoot:ue}}catch{}}return mt(se)}return re}));let oe=`${j?"":B.name}  ${H.length} 
`;H.forEach(re=>{oe+=`
 ${re.name} x${re.quantity}`}),_>0&&(oe+=`

+${_}`),N>0&&(oe+=`
+${N}`),P>0&&(oe+=`
+${P}`),z!=null&&z.tierChanged&&(oe+=`

 ${B.name} ${z.newTier} ${z.lifespanIncrease} `),X("",oe,!0),e.closeInventory()},Ca=y.useCallback(()=>{Qc({open:!1,item:null,items:null,isBatch:!1})},[]),P1=y.useCallback(()=>{Gc(!1),Vc([]),Yc(null)},[]),z1=y.useCallback(m=>{m.forEach(M=>{const j=ir(M.giftItemId);j&&(d([j]),Ae(`${M.message}${j.name}`))}),e.closeBatchGiftModal(),Vo([]),X("",` ${m.length} `,!0)},[ir,d,Ae,e,Vo,X]),D1=y.useCallback(()=>{e.closeBatchGiftModal(),Vo([])},[e,Vo]),F1=y.useCallback(m=>{m.forEach(M=>{const j=M.giftItemId?ir(M.giftItemId):null;j&&d([j])}),e.closeBatchPromotionModal(),Yo([]),X("",` ${m.length} `,!0)},[ir,d,e,Yo,X]),H1=y.useCallback(()=>{e.closeBatchPromotionModal(),Yo([])},[e,Yo]),W1=y.useCallback(()=>{e.closeBatchMarriageModal(),qo([])},[e,qo]),U1=y.useCallback(m=>{if(is.isBatch&&is.items){let M=0,j=0,B=0,_=0,N=[];is.items.forEach(U=>{const z=typeof U=="object"?U.instanceId:U,oe=typeof U=="object"&&U.quantity?U.quantity:1;for(let re=0;re<oe;re++){const J=l.find(_e=>_e.instanceId===z);if(!J)continue;const se=J.effect||{};if(se.kind==="exp"||se.kind==="heal"){const _e=se.kind==="exp"?se.amount||0:Math.floor((se.amount||0)*2);B+=_e;const ue=Kt(m,_e);ue!=null&&ue.tierChanged&&N.push({newTier:ue.newTier,lifespanIncrease:ue.lifespanIncrease})}else se.kind==="aptitude"&&(_+=se.amount||0);p(z,J.stackable?1:void 0),M++}j++}),de(U=>U.id===m.id,U=>{var oe;let z={...U};if(B>0&&(z=Kt(z,B).updated),_>0){const re=Math.min(100,(((oe=z.stats)==null?void 0:oe.aptitude)||50)+_);if(z={...z,stats:{...z.stats,aptitude:re}},z.isTested||z.spiritRoot&&Array.isArray(z.spiritRoot.elements))try{const J=qn(re,z.spiritRoot,null,{constitution:z.constitution});z={...z,spiritRoot:J}}catch{}}return mt(z)}),je(U=>{var z;if(U&&U.id===m.id){let oe={...U};if(B>0&&(oe=Kt(oe,B).updated),_>0){const re=Math.min(100,(((z=oe.stats)==null?void 0:z.aptitude)||50)+_);if(oe={...oe,stats:{...oe.stats,aptitude:re}},oe.isTested||oe.spiritRoot&&Array.isArray(oe.spiritRoot.elements))try{const J=qn(re,oe.spiritRoot,null,{constitution:oe.constitution});oe={...oe,spiritRoot:J}}catch{}}return mt(oe)}return U});let P=` ${j}  ${M}  ${m.name}`,H={};if(B>0&&(P+=`
 +${B}`,H.=`+${B}`),_>0&&(P+=`
 +${_}`,H.=`+${_}`),N.length>0){const U=N[N.length-1];P+=`

 ${m.name} ${U.newTier} ${U.lifespanIncrease} `}X("",P,!0,Object.keys(H).length>0?H:null),Ca(),e.closeInventory()}else is.item&&(Zc(m.id,is.item.instanceId),Ca(),e.closeInventory())},[is,Zc,X,Ca,e,l,p,de,je,Kt,mt,qn]),G1=y.useCallback(m=>{const M=l.find(j=>j.instanceId===m);if(M){if(!cs(M,pt.CHILD)){X("",`${M.name||""}  ${Vs(M)} `,!1);return}Qc({open:!0,item:M})}},[l,cs,pt,X,Vs]),V1=y.useCallback(m=>{if(m.length===0)return;const M=m.map(B=>{const _=typeof B=="object"?B.instanceId:B,N=typeof B=="object"&&B.quantity?B.quantity:1,P=l.find(H=>H.instanceId===_);return P?{...P,giveQuantity:N}:null}).filter(Boolean);if(M.length===0)return;const j=M.filter(B=>!cs(B,pt.CHILD));if(j.length>0){const B=j.slice(0,3).map(N=>N.name).join(""),_=j.length>3?" ":"";X("",`${B}${_}  ${Vs(j[0])} `,!1);return}Qc({open:!0,items:M.map(B=>({instanceId:B.instanceId,quantity:B.giveQuantity||1})),isBatch:!0})},[l,cs,pt,X,Vs]),Y1=y.useCallback(()=>{const m=os[0];m&&ct(m.id,{isTested:!0}),Uc(M=>M.slice(1))},[os,ct]),q1=()=>{if(l.filter(j=>j.type==="manual"&&(j.manualIds&&j.manualIds.length||j.manualId)).length===0){X("","",!1);return}if(!(Rn.length?Rn:ee).length){X("","",!1);return}e.openBatchManualModal()},K1=m=>{if(!m||m.length===0){e.closeBatchManualModal();return}let M=0;const j=[];m.forEach(B=>{const _=ee.find(H=>H.id===B.childId);if(!_)return;const N={..._},P=rh(N,B.manualId);if(P.success){const H=mt({...N});j.push(H),M++,Ae(P.message)}}),j.length>0&&(D(B=>j.find(N=>N.id===B.id)||B),je(B=>B&&(j.find(N=>N.id===B.id)||B))),X("",` ${M} `,!0),e.closeBatchManualModal()},Rf=()=>{const m=D2(c);m.success?(u(M=>{var N,P;const j=((N=M.stats)==null?void 0:N.aptitude)||50,B=((P=M.spiritRoot)==null?void 0:P.type)||"",_=Eo(m.newTier,j,B,M.equipment);return{...M,tier:m.newTier,currentExp:0,maxExp:m.newMaxExp,breakthroughBonus:0,breakthroughFailCount:0,combatStats:_}}),Pt(c.newsBuffer||[],"LEVEL_UP",{actor:c.name,detail:m.newTier}),X("",m.msg,!0,{:""},!1)):(u(M=>{const j=(M.breakthroughFailCount||0)+1,B=(M.breakthroughBonus||0)+5;return{...M,currentExp:Math.max(0,M.currentExp-m.penalty),breakthroughFailCount:j,breakthroughBonus:B}}),X("",m.msg,!1,{:-m.penalty},!1))},Q1=m=>{if((c.skillPoints||0)<=0){Ae(" ");return}u(M=>{const j={...M,skillPoints:M.skillPoints-1};if(m==="aptitude"){const B=Math.min(100,(j.stats.aptitude||20)+1),_=R5(j,B);return Ae(` 1 ${_.stats.aptitude}`),_}else m==="combatPower"?(j.combatStats={...j.combatStats,maxHp:j.combatStats.maxHp+50,hp:j.combatStats.maxHp+50,atk:j.combatStats.atk+5,def:(j.combatStats.def||0)+3},Ae(" 1+50+5+3")):m==="breakthrough"&&(j.breakthroughBonus=(j.breakthroughBonus||0)+5,Ae(` 15%: ${j.breakthroughBonus}%`));return j})};return r.jsxs("div",{style:dm.appContainer,children:[Ie&&r.jsx(rj,{onComplete:()=>Be(!1)}),dt&&r.jsx(nj,{onConfirm:()=>_n(!1),onExit:()=>{window.location.href="about:blank"}}),r.jsx(rw,{player:c,isAuto:tn,onBreakthrough:Rf,auctionBanner:qc}),wn==="PROLOGUE"?r.jsx(tj,{onFinish:y1,onLoadGame:If}):r.jsxs("div",{style:dm.mainContent,children:[r.jsx(A5,{player:c,onBreakthroughClick:Rf}),Un==="FAMILY"&&r.jsx(N5,{player:c,visibleChildren:Rn,pregnantNpcs:k.filter(m=>{var M;return m.isPregnant&&!((M=m.relationship)!=null&&M.cutTies)}),fallenChildren:he,exiledChildren:(c==null?void 0:c.exiledChildren)||[],onChildClick:m=>{m.isEmbryo?X("",`${m.npc.name} ...

 

: ${m.npc.pregnancyProgress||0}/9`,!0,null,!1):je(m)},onToggleFavorite:De,onMemorialClick:E1}),Un==="NPC"&&r.jsx(B5,{sortedNpcs:Ir,pagedNpcs:Lc,deadNpcs:T,npcSort:Ms,npcPage:Lo,npcPageCount:Ns,hasNpcPagination:$c,showFollowedOnly:rs,onExplore:g1,onSortChange:Nc,onToggleFollowedOnly:la,onPrevPage:()=>As(m=>Math.max(1,m-1)),onNextPage:()=>As(m=>Math.min(Ns,m+1)),onNpcInteract:m=>jf(m.id,"DETAIL"),onNpcAction:jf}),Un==="ACTION"&&r.jsx(O5,{player:c,children:Rn,showBizPanel:e.showBizPanel,showChallengePanel:e.showChallengePanel,idleManagerOptions:_c,onDailyAction:d1,onShopping:u1,onOpenInventory:e.openInventory,onBuyBusiness:S1,onExploreRealm:w1,onOpenAuction:e1,onCloseBizPanel:e.closeBizPanel,onCloseChallengePanel:e.closeChallengePanel,onOpenBizPanel:e.openBizPanel,onOpenChallengePanel:e.openChallengePanel}),Un==="REVENGE"&&r.jsx(C5,{children:r.jsx(Aj,{player:c,setPlayer:u,addLog:Ae})}),Un==="SYSTEM"&&r.jsx(Pj,{player:c,onSave:b1,onLoad:If,onReset:v1,onRedeemCode:qy,onOpenGuide:()=>e.openGuide(),autoAssignEnabled:$s,onToggleAutoAssign:_1,autoSkipSpiritTest:F,onToggleAutoSkip:A1,skipChildGiftPopups:Gn,onToggleSkipChildGiftPopups:N1,skipShuraFieldEvents:Ho,onToggleSkipShuraFieldEvents:L1,skipRomanceGiftPopups:xa,onToggleSkipRomanceGiftPopups:$1,skipJealousyPopups:ya,onToggleSkipJealousyPopups:B1,isPortraitViewport:Ic,isOrientationFixApplied:_s,onRequestPortraitFix:Ky,onReleasePortraitFix:Qy,onAutoAssignSpouses:R1,gameState:{player:c,children:ee,fallenChildren:he,activeNpcs:k,deadNpcs:T,gameStage:wn,logs:ts,inventory:l,messages:((Ff=St==null?void 0:St.toJSON)==null?void 0:Ff.call(St))||{},lastMessageCheck:Wo,pendingSectChoices:Uo,testQueue:os,worldEvents:(c==null?void 0:c.worldEvents)||[],newsBuffer:(c==null?void 0:c.newsBuffer)||[]}}),Un==="LOG"&&r.jsx(xk,{logs:ts,ratingSummary:Xo,onUpgradeRating:Jy}),Un==="PLAYER"&&r.jsx(Dj,{player:c,childFeedback:Gy,onOpenInventory:()=>e.openInventory("VIEW"),onAllocateSkillPoint:Q1})]}),r.jsx(m5,{modalState:t,closeModal:Vy,player:c,inventory:l,handleGiftConfirm:a1,handleNegotiateConfirm:l1,handleShopPurchase:p1,handleOptionSelect:Cf,handleShuraFieldSelect:c1,handleBuyAuctionItem:Xy,handleShowAuctionPlot:Zy,modalMgr:e,allChildren:ee,visibleChildren:Rn,handleEquipToChild:_f,handleUseConsumable:Zc,handleBatchUseConsumables:O1,handleDiscardFromInventory:i1,handleGiveToChild:G1,handleBatchGiveToChildren:V1,handleSell:o1,handleAutoAssignManualToChild:q1,getMarketPrice:kf,testQueue:os,handleTestFinish:k1,handleTestQueueClose:Y1,childSelectorModal:is,handleChildSelectorSelect:U1,closeChildSelectorModal:Ca,selectedChild:ge,childNavigationMeta:Bc,handleNavigateChild:Oc,handleChildAction:I1,setSelectedChild:je,showSpouseSelection:By,marryingChild:Sa,spouseCandidates:Oy,handleSpouseSelect:T1,resetSpouseSelection:P1,batchGiftEvents:Py,handleBatchGiftConfirm:z1,handleBatchGiftClose:D1,batchPromotionEvents:zy,handleBatchPromotionConfirm:F1,handleBatchPromotionClose:H1,batchMarriagePlans:Dy,handleBatchMarriageConfirm:M1,handleBatchMarriageClose:W1,handleBatchManualAssign:K1}),r.jsx(ow,{activeTab:Un,onTabChange:Rc}),r.jsx(L5,{isAuto:tn,autoSpeed:ns,player:c,messageUnreadCount:St.getUnreadCount(),onToggleAuto:()=>Mn(!tn),onSetAutoSpeed:Mc,onNextMonth:Jc,onOpenGazette:()=>{console.log(":",{currentGazette:ha,gazetteHistory:c.gazetteHistory,hasUnreadGazette:c.hasUnreadGazette}),e.openGazette()},onOpenMessageCenter:()=>e.openMessageCenter(),onMarkGazetteRead:()=>x({hasUnreadGazette:!1})}),r.jsx(j5,{selectedNpc:A,setSelectedNpc:L,handleOptionSelect:Cf,player:c,visibleChildren:Rn,visibleNpcs:$,activeNpcs:k,modalMgr:e,addLog:Ae,showResult:X,cutTiesWithNpc:ve,handleToggleNpcLetterAcceptance:x1,messages:$y,messageManager:St,setMessages:ss,handleSendMessageReply:Uy,combatData:Bo,handleCombatClose:Hc,isExploring:Pc,exploreRealmState:zo,exploreProgress:_r,currentExploreEvent:Fo,exploreLog:ua,inventory:l,setExploreLog:Ls,handleExplorationOption:fa,handleStartCombat:Fc,setExploreProgress:Do,setCurrentExploreEvent:pa,setIsExploring:Po,getBossEvent:hC,getRandomExplorationEvent:Sh,pendingSectChoices:Uo,setPendingSectChoices:Go,handleAssignSect:j1,handleCloseTutorial:Fy,handleCompleteTutorial:Hy,handleCloseGuide:Wy,currentGazette:ha,setSelectedWorldNpc:G,selectedWorldNpc:R,handleInviteWorldNpc:h1})]})}Jd.createRoot(document.getElementById("root")).render(r.jsx(ic.StrictMode,{children:r.jsx(wC,{})}));
