var $b=Object.defineProperty;var Bb=(e,t,n)=>t in e?$b(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n;var j0=(e,t,n)=>Bb(e,typeof t!="symbol"?t+"":t,n);import{g as zl,a as Ep,i as Ob,c as og,b as Pb,d as zb,e as ig,f as Db,h as Fb}from"./saveSystem-BXowruKX.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))s(o);new MutationObserver(o=>{for(const i of o)if(i.type==="childList")for(const a of i.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&s(a)}).observe(document,{childList:!0,subtree:!0});function n(o){const i={};return o.integrity&&(i.integrity=o.integrity),o.referrerPolicy&&(i.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?i.credentials="include":o.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function s(o){if(o.ep)return;o.ep=!0;const i=n(o);fetch(o.href,i)}})();function Hb(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var ag={exports:{}},Sc={},lg={exports:{}},et={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var ga=Symbol.for("react.element"),Wb=Symbol.for("react.portal"),Ub=Symbol.for("react.fragment"),Gb=Symbol.for("react.strict_mode"),Vb=Symbol.for("react.profiler"),Yb=Symbol.for("react.provider"),qb=Symbol.for("react.context"),Kb=Symbol.for("react.forward_ref"),Qb=Symbol.for("react.suspense"),Jb=Symbol.for("react.memo"),Xb=Symbol.for("react.lazy"),C0=Symbol.iterator;function Zb(e){return e===null||typeof e!="object"?null:(e=C0&&e[C0]||e["@@iterator"],typeof e=="function"?e:null)}var cg={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},dg=Object.assign,ug={};function Uo(e,t,n){this.props=e,this.context=t,this.refs=ug,this.updater=n||cg}Uo.prototype.isReactComponent={};Uo.prototype.setState=function(e,t){if(typeof e!="object"&&typeof e!="function"&&e!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,e,t,"setState")};Uo.prototype.forceUpdate=function(e){this.updater.enqueueForceUpdate(this,e,"forceUpdate")};function pg(){}pg.prototype=Uo.prototype;function jp(e,t,n){this.props=e,this.context=t,this.refs=ug,this.updater=n||cg}var Cp=jp.prototype=new pg;Cp.constructor=jp;dg(Cp,Uo.prototype);Cp.isPureReactComponent=!0;var T0=Array.isArray,fg=Object.prototype.hasOwnProperty,Tp={current:null},mg={key:!0,ref:!0,__self:!0,__source:!0};function hg(e,t,n){var s,o={},i=null,a=null;if(t!=null)for(s in t.ref!==void 0&&(a=t.ref),t.key!==void 0&&(i=""+t.key),t)fg.call(t,s)&&!mg.hasOwnProperty(s)&&(o[s]=t[s]);var l=arguments.length-2;if(l===1)o.children=n;else if(1<l){for(var d=Array(l),u=0;u<l;u++)d[u]=arguments[u+2];o.children=d}if(e&&e.defaultProps)for(s in l=e.defaultProps,l)o[s]===void 0&&(o[s]=l[s]);return{$$typeof:ga,type:e,key:i,ref:a,props:o,_owner:Tp.current}}function ev(e,t){return{$$typeof:ga,type:e.type,key:t,ref:e.ref,props:e.props,_owner:e._owner}}function Ip(e){return typeof e=="object"&&e!==null&&e.$$typeof===ga}function tv(e){var t={"=":"=0",":":"=2"};return"$"+e.replace(/[=:]/g,function(n){return t[n]})}var I0=/\/+/g;function jd(e,t){return typeof e=="object"&&e!==null&&e.key!=null?tv(""+e.key):t.toString(36)}function bl(e,t,n,s,o){var i=typeof e;(i==="undefined"||i==="boolean")&&(e=null);var a=!1;if(e===null)a=!0;else switch(i){case"string":case"number":a=!0;break;case"object":switch(e.$$typeof){case ga:case Wb:a=!0}}if(a)return a=e,o=o(a),e=s===""?"."+jd(a,0):s,T0(o)?(n="",e!=null&&(n=e.replace(I0,"$&/")+"/"),bl(o,t,n,"",function(u){return u})):o!=null&&(Ip(o)&&(o=ev(o,n+(!o.key||a&&a.key===o.key?"":(""+o.key).replace(I0,"$&/")+"/")+e)),t.push(o)),1;if(a=0,s=s===""?".":s+":",T0(e))for(var l=0;l<e.length;l++){i=e[l];var d=s+jd(i,l);a+=bl(i,t,n,d,o)}else if(d=Zb(e),typeof d=="function")for(e=d.call(e),l=0;!(i=e.next()).done;)i=i.value,d=s+jd(i,l++),a+=bl(i,t,n,d,o);else if(i==="object")throw t=String(e),Error("Objects are not valid as a React child (found: "+(t==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":t)+"). If you meant to render a collection of children, use an array instead.");return a}function Wa(e,t,n){if(e==null)return e;var s=[],o=0;return bl(e,s,"","",function(i){return t.call(n,i,o++)}),s}function nv(e){if(e._status===-1){var t=e._result;t=t(),t.then(function(n){(e._status===0||e._status===-1)&&(e._status=1,e._result=n)},function(n){(e._status===0||e._status===-1)&&(e._status=2,e._result=n)}),e._status===-1&&(e._status=0,e._result=t)}if(e._status===1)return e._result.default;throw e._result}var gn={current:null},vl={transition:null},rv={ReactCurrentDispatcher:gn,ReactCurrentBatchConfig:vl,ReactCurrentOwner:Tp};function gg(){throw Error("act(...) is not supported in production builds of React.")}et.Children={map:Wa,forEach:function(e,t,n){Wa(e,function(){t.apply(this,arguments)},n)},count:function(e){var t=0;return Wa(e,function(){t++}),t},toArray:function(e){return Wa(e,function(t){return t})||[]},only:function(e){if(!Ip(e))throw Error("React.Children.only expected to receive a single React element child.");return e}};et.Component=Uo;et.Fragment=Ub;et.Profiler=Vb;et.PureComponent=jp;et.StrictMode=Gb;et.Suspense=Qb;et.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=rv;et.act=gg;et.cloneElement=function(e,t,n){if(e==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+e+".");var s=dg({},e.props),o=e.key,i=e.ref,a=e._owner;if(t!=null){if(t.ref!==void 0&&(i=t.ref,a=Tp.current),t.key!==void 0&&(o=""+t.key),e.type&&e.type.defaultProps)var l=e.type.defaultProps;for(d in t)fg.call(t,d)&&!mg.hasOwnProperty(d)&&(s[d]=t[d]===void 0&&l!==void 0?l[d]:t[d])}var d=arguments.length-2;if(d===1)s.children=n;else if(1<d){l=Array(d);for(var u=0;u<d;u++)l[u]=arguments[u+2];s.children=l}return{$$typeof:ga,type:e.type,key:o,ref:i,props:s,_owner:a}};et.createContext=function(e){return e={$$typeof:qb,_currentValue:e,_currentValue2:e,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},e.Provider={$$typeof:Yb,_context:e},e.Consumer=e};et.createElement=hg;et.createFactory=function(e){var t=hg.bind(null,e);return t.type=e,t};et.createRef=function(){return{current:null}};et.forwardRef=function(e){return{$$typeof:Kb,render:e}};et.isValidElement=Ip;et.lazy=function(e){return{$$typeof:Xb,_payload:{_status:-1,_result:e},_init:nv}};et.memo=function(e,t){return{$$typeof:Jb,type:e,compare:t===void 0?null:t}};et.startTransition=function(e){var t=vl.transition;vl.transition={};try{e()}finally{vl.transition=t}};et.unstable_act=gg;et.useCallback=function(e,t){return gn.current.useCallback(e,t)};et.useContext=function(e){return gn.current.useContext(e)};et.useDebugValue=function(){};et.useDeferredValue=function(e){return gn.current.useDeferredValue(e)};et.useEffect=function(e,t){return gn.current.useEffect(e,t)};et.useId=function(){return gn.current.useId()};et.useImperativeHandle=function(e,t,n){return gn.current.useImperativeHandle(e,t,n)};et.useInsertionEffect=function(e,t){return gn.current.useInsertionEffect(e,t)};et.useLayoutEffect=function(e,t){return gn.current.useLayoutEffect(e,t)};et.useMemo=function(e,t){return gn.current.useMemo(e,t)};et.useReducer=function(e,t,n){return gn.current.useReducer(e,t,n)};et.useRef=function(e){return gn.current.useRef(e)};et.useState=function(e){return gn.current.useState(e)};et.useSyncExternalStore=function(e,t,n){return gn.current.useSyncExternalStore(e,t,n)};et.useTransition=function(){return gn.current.useTransition()};et.version="18.3.1";lg.exports=et;var y=lg.exports;const wc=Hb(y);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var sv=y,ov=Symbol.for("react.element"),iv=Symbol.for("react.fragment"),av=Object.prototype.hasOwnProperty,lv=sv.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,cv={key:!0,ref:!0,__self:!0,__source:!0};function xg(e,t,n){var s,o={},i=null,a=null;n!==void 0&&(i=""+n),t.key!==void 0&&(i=""+t.key),t.ref!==void 0&&(a=t.ref);for(s in t)av.call(t,s)&&!cv.hasOwnProperty(s)&&(o[s]=t[s]);if(e&&e.defaultProps)for(s in t=e.defaultProps,t)o[s]===void 0&&(o[s]=t[s]);return{$$typeof:ov,type:e,key:i,ref:a,props:o,_owner:lv.current}}Sc.Fragment=iv;Sc.jsx=xg;Sc.jsxs=xg;ag.exports=Sc;var r=ag.exports,bu={},yg={exports:{}},Bn={},bg={exports:{}},vg={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(e){function t(J,X){var re=J.length;J.push(X);e:for(;0<re;){var ye=re-1>>>1,Re=J[ye];if(0<o(Re,X))J[ye]=X,J[re]=Re,re=ye;else break e}}function n(J){return J.length===0?null:J[0]}function s(J){if(J.length===0)return null;var X=J[0],re=J.pop();if(re!==X){J[0]=re;e:for(var ye=0,Re=J.length,Fe=Re>>>1;ye<Fe;){var O=2*(ye+1)-1,ie=J[O],le=O+1,ee=J[le];if(0>o(ie,re))le<Re&&0>o(ee,ie)?(J[ye]=ee,J[le]=re,ye=le):(J[ye]=ie,J[O]=re,ye=O);else if(le<Re&&0>o(ee,re))J[ye]=ee,J[le]=re,ye=le;else break e}}return X}function o(J,X){var re=J.sortIndex-X.sortIndex;return re!==0?re:J.id-X.id}if(typeof performance=="object"&&typeof performance.now=="function"){var i=performance;e.unstable_now=function(){return i.now()}}else{var a=Date,l=a.now();e.unstable_now=function(){return a.now()-l}}var d=[],u=[],p=1,c=null,f=3,b=!1,S=!1,E=!1,j=typeof setTimeout=="function"?setTimeout:null,x=typeof clearTimeout=="function"?clearTimeout:null,h=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function v(J){for(var X=n(u);X!==null;){if(X.callback===null)s(u);else if(X.startTime<=J)s(u),X.sortIndex=X.expirationTime,t(d,X);else break;X=n(u)}}function g(J){if(E=!1,v(J),!S)if(n(d)!==null)S=!0,q(I);else{var X=n(u);X!==null&&se(g,X.startTime-J)}}function I(J,X){S=!1,E&&(E=!1,x(k),k=-1),b=!0;var re=f;try{for(v(X),c=n(d);c!==null&&(!(c.expirationTime>X)||J&&!N());){var ye=c.callback;if(typeof ye=="function"){c.callback=null,f=c.priorityLevel;var Re=ye(c.expirationTime<=X);X=e.unstable_now(),typeof Re=="function"?c.callback=Re:c===n(d)&&s(d),v(X)}else s(d);c=n(d)}if(c!==null)var Fe=!0;else{var O=n(u);O!==null&&se(g,O.startTime-X),Fe=!1}return Fe}finally{c=null,f=re,b=!1}}var _=!1,C=null,k=-1,R=5,T=-1;function N(){return!(e.unstable_now()-T<R)}function Y(){if(C!==null){var J=e.unstable_now();T=J;var X=!0;try{X=C(!0,J)}finally{X?H():(_=!1,C=null)}}else _=!1}var H;if(typeof h=="function")H=function(){h(Y)};else if(typeof MessageChannel<"u"){var B=new MessageChannel,$=B.port2;B.port1.onmessage=Y,H=function(){$.postMessage(null)}}else H=function(){j(Y,0)};function q(J){C=J,_||(_=!0,H())}function se(J,X){k=j(function(){J(e.unstable_now())},X)}e.unstable_IdlePriority=5,e.unstable_ImmediatePriority=1,e.unstable_LowPriority=4,e.unstable_NormalPriority=3,e.unstable_Profiling=null,e.unstable_UserBlockingPriority=2,e.unstable_cancelCallback=function(J){J.callback=null},e.unstable_continueExecution=function(){S||b||(S=!0,q(I))},e.unstable_forceFrameRate=function(J){0>J||125<J?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):R=0<J?Math.floor(1e3/J):5},e.unstable_getCurrentPriorityLevel=function(){return f},e.unstable_getFirstCallbackNode=function(){return n(d)},e.unstable_next=function(J){switch(f){case 1:case 2:case 3:var X=3;break;default:X=f}var re=f;f=X;try{return J()}finally{f=re}},e.unstable_pauseExecution=function(){},e.unstable_requestPaint=function(){},e.unstable_runWithPriority=function(J,X){switch(J){case 1:case 2:case 3:case 4:case 5:break;default:J=3}var re=f;f=J;try{return X()}finally{f=re}},e.unstable_scheduleCallback=function(J,X,re){var ye=e.unstable_now();switch(typeof re=="object"&&re!==null?(re=re.delay,re=typeof re=="number"&&0<re?ye+re:ye):re=ye,J){case 1:var Re=-1;break;case 2:Re=250;break;case 5:Re=1073741823;break;case 4:Re=1e4;break;default:Re=5e3}return Re=re+Re,J={id:p++,callback:X,priorityLevel:J,startTime:re,expirationTime:Re,sortIndex:-1},re>ye?(J.sortIndex=re,t(u,J),n(d)===null&&J===n(u)&&(E?(x(k),k=-1):E=!0,se(g,re-ye))):(J.sortIndex=Re,t(d,J),S||b||(S=!0,q(I))),J},e.unstable_shouldYield=N,e.unstable_wrapCallback=function(J){var X=f;return function(){var re=f;f=X;try{return J.apply(this,arguments)}finally{f=re}}}})(vg);bg.exports=vg;var dv=bg.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var uv=y,$n=dv;function ue(e){for(var t="https://reactjs.org/docs/error-decoder.html?invariant="+e,n=1;n<arguments.length;n++)t+="&args[]="+encodeURIComponent(arguments[n]);return"Minified React error #"+e+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var Sg=new Set,Qi={};function Ys(e,t){Lo(e,t),Lo(e+"Capture",t)}function Lo(e,t){for(Qi[e]=t,e=0;e<t.length;e++)Sg.add(t[e])}var Pr=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),vu=Object.prototype.hasOwnProperty,pv=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,_0={},R0={};function fv(e){return vu.call(R0,e)?!0:vu.call(_0,e)?!1:pv.test(e)?R0[e]=!0:(_0[e]=!0,!1)}function mv(e,t,n,s){if(n!==null&&n.type===0)return!1;switch(typeof t){case"function":case"symbol":return!0;case"boolean":return s?!1:n!==null?!n.acceptsBooleans:(e=e.toLowerCase().slice(0,5),e!=="data-"&&e!=="aria-");default:return!1}}function hv(e,t,n,s){if(t===null||typeof t>"u"||mv(e,t,n,s))return!0;if(s)return!1;if(n!==null)switch(n.type){case 3:return!t;case 4:return t===!1;case 5:return isNaN(t);case 6:return isNaN(t)||1>t}return!1}function xn(e,t,n,s,o,i,a){this.acceptsBooleans=t===2||t===3||t===4,this.attributeName=s,this.attributeNamespace=o,this.mustUseProperty=n,this.propertyName=e,this.type=t,this.sanitizeURL=i,this.removeEmptyString=a}var Qt={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(e){Qt[e]=new xn(e,0,!1,e,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(e){var t=e[0];Qt[t]=new xn(t,1,!1,e[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(e){Qt[e]=new xn(e,2,!1,e.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(e){Qt[e]=new xn(e,2,!1,e,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(e){Qt[e]=new xn(e,3,!1,e.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(e){Qt[e]=new xn(e,3,!0,e,null,!1,!1)});["capture","download"].forEach(function(e){Qt[e]=new xn(e,4,!1,e,null,!1,!1)});["cols","rows","size","span"].forEach(function(e){Qt[e]=new xn(e,6,!1,e,null,!1,!1)});["rowSpan","start"].forEach(function(e){Qt[e]=new xn(e,5,!1,e.toLowerCase(),null,!1,!1)});var _p=/[\-:]([a-z])/g;function Rp(e){return e[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(e){var t=e.replace(_p,Rp);Qt[t]=new xn(t,1,!1,e,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(e){var t=e.replace(_p,Rp);Qt[t]=new xn(t,1,!1,e,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(e){var t=e.replace(_p,Rp);Qt[t]=new xn(t,1,!1,e,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(e){Qt[e]=new xn(e,1,!1,e.toLowerCase(),null,!1,!1)});Qt.xlinkHref=new xn("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(e){Qt[e]=new xn(e,1,!1,e.toLowerCase(),null,!0,!0)});function Mp(e,t,n,s){var o=Qt.hasOwnProperty(t)?Qt[t]:null;(o!==null?o.type!==0:s||!(2<t.length)||t[0]!=="o"&&t[0]!=="O"||t[1]!=="n"&&t[1]!=="N")&&(hv(t,n,o,s)&&(n=null),s||o===null?fv(t)&&(n===null?e.removeAttribute(t):e.setAttribute(t,""+n)):o.mustUseProperty?e[o.propertyName]=n===null?o.type===3?!1:"":n:(t=o.attributeName,s=o.attributeNamespace,n===null?e.removeAttribute(t):(o=o.type,n=o===3||o===4&&n===!0?"":""+n,s?e.setAttributeNS(s,t,n):e.setAttribute(t,n))))}var Wr=uv.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,Ua=Symbol.for("react.element"),po=Symbol.for("react.portal"),fo=Symbol.for("react.fragment"),Ap=Symbol.for("react.strict_mode"),Su=Symbol.for("react.profiler"),wg=Symbol.for("react.provider"),kg=Symbol.for("react.context"),Np=Symbol.for("react.forward_ref"),wu=Symbol.for("react.suspense"),ku=Symbol.for("react.suspense_list"),Lp=Symbol.for("react.memo"),Kr=Symbol.for("react.lazy"),Eg=Symbol.for("react.offscreen"),M0=Symbol.iterator;function vi(e){return e===null||typeof e!="object"?null:(e=M0&&e[M0]||e["@@iterator"],typeof e=="function"?e:null)}var Ct=Object.assign,Cd;function Li(e){if(Cd===void 0)try{throw Error()}catch(n){var t=n.stack.trim().match(/\n( *(at )?)/);Cd=t&&t[1]||""}return`
`+Cd+e}var Td=!1;function Id(e,t){if(!e||Td)return"";Td=!0;var n=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(t)if(t=function(){throw Error()},Object.defineProperty(t.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(t,[])}catch(u){var s=u}Reflect.construct(e,[],t)}else{try{t.call()}catch(u){s=u}e.call(t.prototype)}else{try{throw Error()}catch(u){s=u}e()}}catch(u){if(u&&s&&typeof u.stack=="string"){for(var o=u.stack.split(`
`),i=s.stack.split(`
`),a=o.length-1,l=i.length-1;1<=a&&0<=l&&o[a]!==i[l];)l--;for(;1<=a&&0<=l;a--,l--)if(o[a]!==i[l]){if(a!==1||l!==1)do if(a--,l--,0>l||o[a]!==i[l]){var d=`
`+o[a].replace(" at new "," at ");return e.displayName&&d.includes("<anonymous>")&&(d=d.replace("<anonymous>",e.displayName)),d}while(1<=a&&0<=l);break}}}finally{Td=!1,Error.prepareStackTrace=n}return(e=e?e.displayName||e.name:"")?Li(e):""}function gv(e){switch(e.tag){case 5:return Li(e.type);case 16:return Li("Lazy");case 13:return Li("Suspense");case 19:return Li("SuspenseList");case 0:case 2:case 15:return e=Id(e.type,!1),e;case 11:return e=Id(e.type.render,!1),e;case 1:return e=Id(e.type,!0),e;default:return""}}function Eu(e){if(e==null)return null;if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e;switch(e){case fo:return"Fragment";case po:return"Portal";case Su:return"Profiler";case Ap:return"StrictMode";case wu:return"Suspense";case ku:return"SuspenseList"}if(typeof e=="object")switch(e.$$typeof){case kg:return(e.displayName||"Context")+".Consumer";case wg:return(e._context.displayName||"Context")+".Provider";case Np:var t=e.render;return e=e.displayName,e||(e=t.displayName||t.name||"",e=e!==""?"ForwardRef("+e+")":"ForwardRef"),e;case Lp:return t=e.displayName||null,t!==null?t:Eu(e.type)||"Memo";case Kr:t=e._payload,e=e._init;try{return Eu(e(t))}catch{}}return null}function xv(e){var t=e.type;switch(e.tag){case 24:return"Cache";case 9:return(t.displayName||"Context")+".Consumer";case 10:return(t._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return e=t.render,e=e.displayName||e.name||"",t.displayName||(e!==""?"ForwardRef("+e+")":"ForwardRef");case 7:return"Fragment";case 5:return t;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return Eu(t);case 8:return t===Ap?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof t=="function")return t.displayName||t.name||null;if(typeof t=="string")return t}return null}function ps(e){switch(typeof e){case"boolean":case"number":case"string":case"undefined":return e;case"object":return e;default:return""}}function jg(e){var t=e.type;return(e=e.nodeName)&&e.toLowerCase()==="input"&&(t==="checkbox"||t==="radio")}function yv(e){var t=jg(e)?"checked":"value",n=Object.getOwnPropertyDescriptor(e.constructor.prototype,t),s=""+e[t];if(!e.hasOwnProperty(t)&&typeof n<"u"&&typeof n.get=="function"&&typeof n.set=="function"){var o=n.get,i=n.set;return Object.defineProperty(e,t,{configurable:!0,get:function(){return o.call(this)},set:function(a){s=""+a,i.call(this,a)}}),Object.defineProperty(e,t,{enumerable:n.enumerable}),{getValue:function(){return s},setValue:function(a){s=""+a},stopTracking:function(){e._valueTracker=null,delete e[t]}}}}function Ga(e){e._valueTracker||(e._valueTracker=yv(e))}function Cg(e){if(!e)return!1;var t=e._valueTracker;if(!t)return!0;var n=t.getValue(),s="";return e&&(s=jg(e)?e.checked?"true":"false":e.value),e=s,e!==n?(t.setValue(e),!0):!1}function Dl(e){if(e=e||(typeof document<"u"?document:void 0),typeof e>"u")return null;try{return e.activeElement||e.body}catch{return e.body}}function ju(e,t){var n=t.checked;return Ct({},t,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:n??e._wrapperState.initialChecked})}function A0(e,t){var n=t.defaultValue==null?"":t.defaultValue,s=t.checked!=null?t.checked:t.defaultChecked;n=ps(t.value!=null?t.value:n),e._wrapperState={initialChecked:s,initialValue:n,controlled:t.type==="checkbox"||t.type==="radio"?t.checked!=null:t.value!=null}}function Tg(e,t){t=t.checked,t!=null&&Mp(e,"checked",t,!1)}function Cu(e,t){Tg(e,t);var n=ps(t.value),s=t.type;if(n!=null)s==="number"?(n===0&&e.value===""||e.value!=n)&&(e.value=""+n):e.value!==""+n&&(e.value=""+n);else if(s==="submit"||s==="reset"){e.removeAttribute("value");return}t.hasOwnProperty("value")?Tu(e,t.type,n):t.hasOwnProperty("defaultValue")&&Tu(e,t.type,ps(t.defaultValue)),t.checked==null&&t.defaultChecked!=null&&(e.defaultChecked=!!t.defaultChecked)}function N0(e,t,n){if(t.hasOwnProperty("value")||t.hasOwnProperty("defaultValue")){var s=t.type;if(!(s!=="submit"&&s!=="reset"||t.value!==void 0&&t.value!==null))return;t=""+e._wrapperState.initialValue,n||t===e.value||(e.value=t),e.defaultValue=t}n=e.name,n!==""&&(e.name=""),e.defaultChecked=!!e._wrapperState.initialChecked,n!==""&&(e.name=n)}function Tu(e,t,n){(t!=="number"||Dl(e.ownerDocument)!==e)&&(n==null?e.defaultValue=""+e._wrapperState.initialValue:e.defaultValue!==""+n&&(e.defaultValue=""+n))}var $i=Array.isArray;function jo(e,t,n,s){if(e=e.options,t){t={};for(var o=0;o<n.length;o++)t["$"+n[o]]=!0;for(n=0;n<e.length;n++)o=t.hasOwnProperty("$"+e[n].value),e[n].selected!==o&&(e[n].selected=o),o&&s&&(e[n].defaultSelected=!0)}else{for(n=""+ps(n),t=null,o=0;o<e.length;o++){if(e[o].value===n){e[o].selected=!0,s&&(e[o].defaultSelected=!0);return}t!==null||e[o].disabled||(t=e[o])}t!==null&&(t.selected=!0)}}function Iu(e,t){if(t.dangerouslySetInnerHTML!=null)throw Error(ue(91));return Ct({},t,{value:void 0,defaultValue:void 0,children:""+e._wrapperState.initialValue})}function L0(e,t){var n=t.value;if(n==null){if(n=t.children,t=t.defaultValue,n!=null){if(t!=null)throw Error(ue(92));if($i(n)){if(1<n.length)throw Error(ue(93));n=n[0]}t=n}t==null&&(t=""),n=t}e._wrapperState={initialValue:ps(n)}}function Ig(e,t){var n=ps(t.value),s=ps(t.defaultValue);n!=null&&(n=""+n,n!==e.value&&(e.value=n),t.defaultValue==null&&e.defaultValue!==n&&(e.defaultValue=n)),s!=null&&(e.defaultValue=""+s)}function $0(e){var t=e.textContent;t===e._wrapperState.initialValue&&t!==""&&t!==null&&(e.value=t)}function _g(e){switch(e){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function _u(e,t){return e==null||e==="http://www.w3.org/1999/xhtml"?_g(t):e==="http://www.w3.org/2000/svg"&&t==="foreignObject"?"http://www.w3.org/1999/xhtml":e}var Va,Rg=function(e){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(t,n,s,o){MSApp.execUnsafeLocalFunction(function(){return e(t,n,s,o)})}:e}(function(e,t){if(e.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in e)e.innerHTML=t;else{for(Va=Va||document.createElement("div"),Va.innerHTML="<svg>"+t.valueOf().toString()+"</svg>",t=Va.firstChild;e.firstChild;)e.removeChild(e.firstChild);for(;t.firstChild;)e.appendChild(t.firstChild)}});function Ji(e,t){if(t){var n=e.firstChild;if(n&&n===e.lastChild&&n.nodeType===3){n.nodeValue=t;return}}e.textContent=t}var Di={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},bv=["Webkit","ms","Moz","O"];Object.keys(Di).forEach(function(e){bv.forEach(function(t){t=t+e.charAt(0).toUpperCase()+e.substring(1),Di[t]=Di[e]})});function Mg(e,t,n){return t==null||typeof t=="boolean"||t===""?"":n||typeof t!="number"||t===0||Di.hasOwnProperty(e)&&Di[e]?(""+t).trim():t+"px"}function Ag(e,t){e=e.style;for(var n in t)if(t.hasOwnProperty(n)){var s=n.indexOf("--")===0,o=Mg(n,t[n],s);n==="float"&&(n="cssFloat"),s?e.setProperty(n,o):e[n]=o}}var vv=Ct({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function Ru(e,t){if(t){if(vv[e]&&(t.children!=null||t.dangerouslySetInnerHTML!=null))throw Error(ue(137,e));if(t.dangerouslySetInnerHTML!=null){if(t.children!=null)throw Error(ue(60));if(typeof t.dangerouslySetInnerHTML!="object"||!("__html"in t.dangerouslySetInnerHTML))throw Error(ue(61))}if(t.style!=null&&typeof t.style!="object")throw Error(ue(62))}}function Mu(e,t){if(e.indexOf("-")===-1)return typeof t.is=="string";switch(e){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var Au=null;function $p(e){return e=e.target||e.srcElement||window,e.correspondingUseElement&&(e=e.correspondingUseElement),e.nodeType===3?e.parentNode:e}var Nu=null,Co=null,To=null;function B0(e){if(e=ba(e)){if(typeof Nu!="function")throw Error(ue(280));var t=e.stateNode;t&&(t=Tc(t),Nu(e.stateNode,e.type,t))}}function Ng(e){Co?To?To.push(e):To=[e]:Co=e}function Lg(){if(Co){var e=Co,t=To;if(To=Co=null,B0(e),t)for(e=0;e<t.length;e++)B0(t[e])}}function $g(e,t){return e(t)}function Bg(){}var _d=!1;function Og(e,t,n){if(_d)return e(t,n);_d=!0;try{return $g(e,t,n)}finally{_d=!1,(Co!==null||To!==null)&&(Bg(),Lg())}}function Xi(e,t){var n=e.stateNode;if(n===null)return null;var s=Tc(n);if(s===null)return null;n=s[t];e:switch(t){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(s=!s.disabled)||(e=e.type,s=!(e==="button"||e==="input"||e==="select"||e==="textarea")),e=!s;break e;default:e=!1}if(e)return null;if(n&&typeof n!="function")throw Error(ue(231,t,typeof n));return n}var Lu=!1;if(Pr)try{var Si={};Object.defineProperty(Si,"passive",{get:function(){Lu=!0}}),window.addEventListener("test",Si,Si),window.removeEventListener("test",Si,Si)}catch{Lu=!1}function Sv(e,t,n,s,o,i,a,l,d){var u=Array.prototype.slice.call(arguments,3);try{t.apply(n,u)}catch(p){this.onError(p)}}var Fi=!1,Fl=null,Hl=!1,$u=null,wv={onError:function(e){Fi=!0,Fl=e}};function kv(e,t,n,s,o,i,a,l,d){Fi=!1,Fl=null,Sv.apply(wv,arguments)}function Ev(e,t,n,s,o,i,a,l,d){if(kv.apply(this,arguments),Fi){if(Fi){var u=Fl;Fi=!1,Fl=null}else throw Error(ue(198));Hl||(Hl=!0,$u=u)}}function qs(e){var t=e,n=e;if(e.alternate)for(;t.return;)t=t.return;else{e=t;do t=e,t.flags&4098&&(n=t.return),e=t.return;while(e)}return t.tag===3?n:null}function Pg(e){if(e.tag===13){var t=e.memoizedState;if(t===null&&(e=e.alternate,e!==null&&(t=e.memoizedState)),t!==null)return t.dehydrated}return null}function O0(e){if(qs(e)!==e)throw Error(ue(188))}function jv(e){var t=e.alternate;if(!t){if(t=qs(e),t===null)throw Error(ue(188));return t!==e?null:e}for(var n=e,s=t;;){var o=n.return;if(o===null)break;var i=o.alternate;if(i===null){if(s=o.return,s!==null){n=s;continue}break}if(o.child===i.child){for(i=o.child;i;){if(i===n)return O0(o),e;if(i===s)return O0(o),t;i=i.sibling}throw Error(ue(188))}if(n.return!==s.return)n=o,s=i;else{for(var a=!1,l=o.child;l;){if(l===n){a=!0,n=o,s=i;break}if(l===s){a=!0,s=o,n=i;break}l=l.sibling}if(!a){for(l=i.child;l;){if(l===n){a=!0,n=i,s=o;break}if(l===s){a=!0,s=i,n=o;break}l=l.sibling}if(!a)throw Error(ue(189))}}if(n.alternate!==s)throw Error(ue(190))}if(n.tag!==3)throw Error(ue(188));return n.stateNode.current===n?e:t}function zg(e){return e=jv(e),e!==null?Dg(e):null}function Dg(e){if(e.tag===5||e.tag===6)return e;for(e=e.child;e!==null;){var t=Dg(e);if(t!==null)return t;e=e.sibling}return null}var Fg=$n.unstable_scheduleCallback,P0=$n.unstable_cancelCallback,Cv=$n.unstable_shouldYield,Tv=$n.unstable_requestPaint,Mt=$n.unstable_now,Iv=$n.unstable_getCurrentPriorityLevel,Bp=$n.unstable_ImmediatePriority,Hg=$n.unstable_UserBlockingPriority,Wl=$n.unstable_NormalPriority,_v=$n.unstable_LowPriority,Wg=$n.unstable_IdlePriority,kc=null,wr=null;function Rv(e){if(wr&&typeof wr.onCommitFiberRoot=="function")try{wr.onCommitFiberRoot(kc,e,void 0,(e.current.flags&128)===128)}catch{}}var ar=Math.clz32?Math.clz32:Nv,Mv=Math.log,Av=Math.LN2;function Nv(e){return e>>>=0,e===0?32:31-(Mv(e)/Av|0)|0}var Ya=64,qa=4194304;function Bi(e){switch(e&-e){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return e&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return e}}function Ul(e,t){var n=e.pendingLanes;if(n===0)return 0;var s=0,o=e.suspendedLanes,i=e.pingedLanes,a=n&268435455;if(a!==0){var l=a&~o;l!==0?s=Bi(l):(i&=a,i!==0&&(s=Bi(i)))}else a=n&~o,a!==0?s=Bi(a):i!==0&&(s=Bi(i));if(s===0)return 0;if(t!==0&&t!==s&&!(t&o)&&(o=s&-s,i=t&-t,o>=i||o===16&&(i&4194240)!==0))return t;if(s&4&&(s|=n&16),t=e.entangledLanes,t!==0)for(e=e.entanglements,t&=s;0<t;)n=31-ar(t),o=1<<n,s|=e[n],t&=~o;return s}function Lv(e,t){switch(e){case 1:case 2:case 4:return t+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function $v(e,t){for(var n=e.suspendedLanes,s=e.pingedLanes,o=e.expirationTimes,i=e.pendingLanes;0<i;){var a=31-ar(i),l=1<<a,d=o[a];d===-1?(!(l&n)||l&s)&&(o[a]=Lv(l,t)):d<=t&&(e.expiredLanes|=l),i&=~l}}function Bu(e){return e=e.pendingLanes&-1073741825,e!==0?e:e&1073741824?1073741824:0}function Ug(){var e=Ya;return Ya<<=1,!(Ya&4194240)&&(Ya=64),e}function Rd(e){for(var t=[],n=0;31>n;n++)t.push(e);return t}function xa(e,t,n){e.pendingLanes|=t,t!==536870912&&(e.suspendedLanes=0,e.pingedLanes=0),e=e.eventTimes,t=31-ar(t),e[t]=n}function Bv(e,t){var n=e.pendingLanes&~t;e.pendingLanes=t,e.suspendedLanes=0,e.pingedLanes=0,e.expiredLanes&=t,e.mutableReadLanes&=t,e.entangledLanes&=t,t=e.entanglements;var s=e.eventTimes;for(e=e.expirationTimes;0<n;){var o=31-ar(n),i=1<<o;t[o]=0,s[o]=-1,e[o]=-1,n&=~i}}function Op(e,t){var n=e.entangledLanes|=t;for(e=e.entanglements;n;){var s=31-ar(n),o=1<<s;o&t|e[s]&t&&(e[s]|=t),n&=~o}}var dt=0;function Gg(e){return e&=-e,1<e?4<e?e&268435455?16:536870912:4:1}var Vg,Pp,Yg,qg,Kg,Ou=!1,Ka=[],rs=null,ss=null,os=null,Zi=new Map,ea=new Map,Xr=[],Ov="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function z0(e,t){switch(e){case"focusin":case"focusout":rs=null;break;case"dragenter":case"dragleave":ss=null;break;case"mouseover":case"mouseout":os=null;break;case"pointerover":case"pointerout":Zi.delete(t.pointerId);break;case"gotpointercapture":case"lostpointercapture":ea.delete(t.pointerId)}}function wi(e,t,n,s,o,i){return e===null||e.nativeEvent!==i?(e={blockedOn:t,domEventName:n,eventSystemFlags:s,nativeEvent:i,targetContainers:[o]},t!==null&&(t=ba(t),t!==null&&Pp(t)),e):(e.eventSystemFlags|=s,t=e.targetContainers,o!==null&&t.indexOf(o)===-1&&t.push(o),e)}function Pv(e,t,n,s,o){switch(t){case"focusin":return rs=wi(rs,e,t,n,s,o),!0;case"dragenter":return ss=wi(ss,e,t,n,s,o),!0;case"mouseover":return os=wi(os,e,t,n,s,o),!0;case"pointerover":var i=o.pointerId;return Zi.set(i,wi(Zi.get(i)||null,e,t,n,s,o)),!0;case"gotpointercapture":return i=o.pointerId,ea.set(i,wi(ea.get(i)||null,e,t,n,s,o)),!0}return!1}function Qg(e){var t=As(e.target);if(t!==null){var n=qs(t);if(n!==null){if(t=n.tag,t===13){if(t=Pg(n),t!==null){e.blockedOn=t,Kg(e.priority,function(){Yg(n)});return}}else if(t===3&&n.stateNode.current.memoizedState.isDehydrated){e.blockedOn=n.tag===3?n.stateNode.containerInfo:null;return}}}e.blockedOn=null}function Sl(e){if(e.blockedOn!==null)return!1;for(var t=e.targetContainers;0<t.length;){var n=Pu(e.domEventName,e.eventSystemFlags,t[0],e.nativeEvent);if(n===null){n=e.nativeEvent;var s=new n.constructor(n.type,n);Au=s,n.target.dispatchEvent(s),Au=null}else return t=ba(n),t!==null&&Pp(t),e.blockedOn=n,!1;t.shift()}return!0}function D0(e,t,n){Sl(e)&&n.delete(t)}function zv(){Ou=!1,rs!==null&&Sl(rs)&&(rs=null),ss!==null&&Sl(ss)&&(ss=null),os!==null&&Sl(os)&&(os=null),Zi.forEach(D0),ea.forEach(D0)}function ki(e,t){e.blockedOn===t&&(e.blockedOn=null,Ou||(Ou=!0,$n.unstable_scheduleCallback($n.unstable_NormalPriority,zv)))}function ta(e){function t(o){return ki(o,e)}if(0<Ka.length){ki(Ka[0],e);for(var n=1;n<Ka.length;n++){var s=Ka[n];s.blockedOn===e&&(s.blockedOn=null)}}for(rs!==null&&ki(rs,e),ss!==null&&ki(ss,e),os!==null&&ki(os,e),Zi.forEach(t),ea.forEach(t),n=0;n<Xr.length;n++)s=Xr[n],s.blockedOn===e&&(s.blockedOn=null);for(;0<Xr.length&&(n=Xr[0],n.blockedOn===null);)Qg(n),n.blockedOn===null&&Xr.shift()}var Io=Wr.ReactCurrentBatchConfig,Gl=!0;function Dv(e,t,n,s){var o=dt,i=Io.transition;Io.transition=null;try{dt=1,zp(e,t,n,s)}finally{dt=o,Io.transition=i}}function Fv(e,t,n,s){var o=dt,i=Io.transition;Io.transition=null;try{dt=4,zp(e,t,n,s)}finally{dt=o,Io.transition=i}}function zp(e,t,n,s){if(Gl){var o=Pu(e,t,n,s);if(o===null)Dd(e,t,s,Vl,n),z0(e,s);else if(Pv(o,e,t,n,s))s.stopPropagation();else if(z0(e,s),t&4&&-1<Ov.indexOf(e)){for(;o!==null;){var i=ba(o);if(i!==null&&Vg(i),i=Pu(e,t,n,s),i===null&&Dd(e,t,s,Vl,n),i===o)break;o=i}o!==null&&s.stopPropagation()}else Dd(e,t,s,null,n)}}var Vl=null;function Pu(e,t,n,s){if(Vl=null,e=$p(s),e=As(e),e!==null)if(t=qs(e),t===null)e=null;else if(n=t.tag,n===13){if(e=Pg(t),e!==null)return e;e=null}else if(n===3){if(t.stateNode.current.memoizedState.isDehydrated)return t.tag===3?t.stateNode.containerInfo:null;e=null}else t!==e&&(e=null);return Vl=e,null}function Jg(e){switch(e){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(Iv()){case Bp:return 1;case Hg:return 4;case Wl:case _v:return 16;case Wg:return 536870912;default:return 16}default:return 16}}var es=null,Dp=null,wl=null;function Xg(){if(wl)return wl;var e,t=Dp,n=t.length,s,o="value"in es?es.value:es.textContent,i=o.length;for(e=0;e<n&&t[e]===o[e];e++);var a=n-e;for(s=1;s<=a&&t[n-s]===o[i-s];s++);return wl=o.slice(e,1<s?1-s:void 0)}function kl(e){var t=e.keyCode;return"charCode"in e?(e=e.charCode,e===0&&t===13&&(e=13)):e=t,e===10&&(e=13),32<=e||e===13?e:0}function Qa(){return!0}function F0(){return!1}function On(e){function t(n,s,o,i,a){this._reactName=n,this._targetInst=o,this.type=s,this.nativeEvent=i,this.target=a,this.currentTarget=null;for(var l in e)e.hasOwnProperty(l)&&(n=e[l],this[l]=n?n(i):i[l]);return this.isDefaultPrevented=(i.defaultPrevented!=null?i.defaultPrevented:i.returnValue===!1)?Qa:F0,this.isPropagationStopped=F0,this}return Ct(t.prototype,{preventDefault:function(){this.defaultPrevented=!0;var n=this.nativeEvent;n&&(n.preventDefault?n.preventDefault():typeof n.returnValue!="unknown"&&(n.returnValue=!1),this.isDefaultPrevented=Qa)},stopPropagation:function(){var n=this.nativeEvent;n&&(n.stopPropagation?n.stopPropagation():typeof n.cancelBubble!="unknown"&&(n.cancelBubble=!0),this.isPropagationStopped=Qa)},persist:function(){},isPersistent:Qa}),t}var Go={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(e){return e.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},Fp=On(Go),ya=Ct({},Go,{view:0,detail:0}),Hv=On(ya),Md,Ad,Ei,Ec=Ct({},ya,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Hp,button:0,buttons:0,relatedTarget:function(e){return e.relatedTarget===void 0?e.fromElement===e.srcElement?e.toElement:e.fromElement:e.relatedTarget},movementX:function(e){return"movementX"in e?e.movementX:(e!==Ei&&(Ei&&e.type==="mousemove"?(Md=e.screenX-Ei.screenX,Ad=e.screenY-Ei.screenY):Ad=Md=0,Ei=e),Md)},movementY:function(e){return"movementY"in e?e.movementY:Ad}}),H0=On(Ec),Wv=Ct({},Ec,{dataTransfer:0}),Uv=On(Wv),Gv=Ct({},ya,{relatedTarget:0}),Nd=On(Gv),Vv=Ct({},Go,{animationName:0,elapsedTime:0,pseudoElement:0}),Yv=On(Vv),qv=Ct({},Go,{clipboardData:function(e){return"clipboardData"in e?e.clipboardData:window.clipboardData}}),Kv=On(qv),Qv=Ct({},Go,{data:0}),W0=On(Qv),Jv={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},Xv={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},Zv={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function eS(e){var t=this.nativeEvent;return t.getModifierState?t.getModifierState(e):(e=Zv[e])?!!t[e]:!1}function Hp(){return eS}var tS=Ct({},ya,{key:function(e){if(e.key){var t=Jv[e.key]||e.key;if(t!=="Unidentified")return t}return e.type==="keypress"?(e=kl(e),e===13?"Enter":String.fromCharCode(e)):e.type==="keydown"||e.type==="keyup"?Xv[e.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Hp,charCode:function(e){return e.type==="keypress"?kl(e):0},keyCode:function(e){return e.type==="keydown"||e.type==="keyup"?e.keyCode:0},which:function(e){return e.type==="keypress"?kl(e):e.type==="keydown"||e.type==="keyup"?e.keyCode:0}}),nS=On(tS),rS=Ct({},Ec,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),U0=On(rS),sS=Ct({},ya,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Hp}),oS=On(sS),iS=Ct({},Go,{propertyName:0,elapsedTime:0,pseudoElement:0}),aS=On(iS),lS=Ct({},Ec,{deltaX:function(e){return"deltaX"in e?e.deltaX:"wheelDeltaX"in e?-e.wheelDeltaX:0},deltaY:function(e){return"deltaY"in e?e.deltaY:"wheelDeltaY"in e?-e.wheelDeltaY:"wheelDelta"in e?-e.wheelDelta:0},deltaZ:0,deltaMode:0}),cS=On(lS),dS=[9,13,27,32],Wp=Pr&&"CompositionEvent"in window,Hi=null;Pr&&"documentMode"in document&&(Hi=document.documentMode);var uS=Pr&&"TextEvent"in window&&!Hi,Zg=Pr&&(!Wp||Hi&&8<Hi&&11>=Hi),G0=" ",V0=!1;function ex(e,t){switch(e){case"keyup":return dS.indexOf(t.keyCode)!==-1;case"keydown":return t.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function tx(e){return e=e.detail,typeof e=="object"&&"data"in e?e.data:null}var mo=!1;function pS(e,t){switch(e){case"compositionend":return tx(t);case"keypress":return t.which!==32?null:(V0=!0,G0);case"textInput":return e=t.data,e===G0&&V0?null:e;default:return null}}function fS(e,t){if(mo)return e==="compositionend"||!Wp&&ex(e,t)?(e=Xg(),wl=Dp=es=null,mo=!1,e):null;switch(e){case"paste":return null;case"keypress":if(!(t.ctrlKey||t.altKey||t.metaKey)||t.ctrlKey&&t.altKey){if(t.char&&1<t.char.length)return t.char;if(t.which)return String.fromCharCode(t.which)}return null;case"compositionend":return Zg&&t.locale!=="ko"?null:t.data;default:return null}}var mS={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Y0(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t==="input"?!!mS[e.type]:t==="textarea"}function nx(e,t,n,s){Ng(s),t=Yl(t,"onChange"),0<t.length&&(n=new Fp("onChange","change",null,n,s),e.push({event:n,listeners:t}))}var Wi=null,na=null;function hS(e){fx(e,0)}function jc(e){var t=xo(e);if(Cg(t))return e}function gS(e,t){if(e==="change")return t}var rx=!1;if(Pr){var Ld;if(Pr){var $d="oninput"in document;if(!$d){var q0=document.createElement("div");q0.setAttribute("oninput","return;"),$d=typeof q0.oninput=="function"}Ld=$d}else Ld=!1;rx=Ld&&(!document.documentMode||9<document.documentMode)}function K0(){Wi&&(Wi.detachEvent("onpropertychange",sx),na=Wi=null)}function sx(e){if(e.propertyName==="value"&&jc(na)){var t=[];nx(t,na,e,$p(e)),Og(hS,t)}}function xS(e,t,n){e==="focusin"?(K0(),Wi=t,na=n,Wi.attachEvent("onpropertychange",sx)):e==="focusout"&&K0()}function yS(e){if(e==="selectionchange"||e==="keyup"||e==="keydown")return jc(na)}function bS(e,t){if(e==="click")return jc(t)}function vS(e,t){if(e==="input"||e==="change")return jc(t)}function SS(e,t){return e===t&&(e!==0||1/e===1/t)||e!==e&&t!==t}var cr=typeof Object.is=="function"?Object.is:SS;function ra(e,t){if(cr(e,t))return!0;if(typeof e!="object"||e===null||typeof t!="object"||t===null)return!1;var n=Object.keys(e),s=Object.keys(t);if(n.length!==s.length)return!1;for(s=0;s<n.length;s++){var o=n[s];if(!vu.call(t,o)||!cr(e[o],t[o]))return!1}return!0}function Q0(e){for(;e&&e.firstChild;)e=e.firstChild;return e}function J0(e,t){var n=Q0(e);e=0;for(var s;n;){if(n.nodeType===3){if(s=e+n.textContent.length,e<=t&&s>=t)return{node:n,offset:t-e};e=s}e:{for(;n;){if(n.nextSibling){n=n.nextSibling;break e}n=n.parentNode}n=void 0}n=Q0(n)}}function ox(e,t){return e&&t?e===t?!0:e&&e.nodeType===3?!1:t&&t.nodeType===3?ox(e,t.parentNode):"contains"in e?e.contains(t):e.compareDocumentPosition?!!(e.compareDocumentPosition(t)&16):!1:!1}function ix(){for(var e=window,t=Dl();t instanceof e.HTMLIFrameElement;){try{var n=typeof t.contentWindow.location.href=="string"}catch{n=!1}if(n)e=t.contentWindow;else break;t=Dl(e.document)}return t}function Up(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t&&(t==="input"&&(e.type==="text"||e.type==="search"||e.type==="tel"||e.type==="url"||e.type==="password")||t==="textarea"||e.contentEditable==="true")}function wS(e){var t=ix(),n=e.focusedElem,s=e.selectionRange;if(t!==n&&n&&n.ownerDocument&&ox(n.ownerDocument.documentElement,n)){if(s!==null&&Up(n)){if(t=s.start,e=s.end,e===void 0&&(e=t),"selectionStart"in n)n.selectionStart=t,n.selectionEnd=Math.min(e,n.value.length);else if(e=(t=n.ownerDocument||document)&&t.defaultView||window,e.getSelection){e=e.getSelection();var o=n.textContent.length,i=Math.min(s.start,o);s=s.end===void 0?i:Math.min(s.end,o),!e.extend&&i>s&&(o=s,s=i,i=o),o=J0(n,i);var a=J0(n,s);o&&a&&(e.rangeCount!==1||e.anchorNode!==o.node||e.anchorOffset!==o.offset||e.focusNode!==a.node||e.focusOffset!==a.offset)&&(t=t.createRange(),t.setStart(o.node,o.offset),e.removeAllRanges(),i>s?(e.addRange(t),e.extend(a.node,a.offset)):(t.setEnd(a.node,a.offset),e.addRange(t)))}}for(t=[],e=n;e=e.parentNode;)e.nodeType===1&&t.push({element:e,left:e.scrollLeft,top:e.scrollTop});for(typeof n.focus=="function"&&n.focus(),n=0;n<t.length;n++)e=t[n],e.element.scrollLeft=e.left,e.element.scrollTop=e.top}}var kS=Pr&&"documentMode"in document&&11>=document.documentMode,ho=null,zu=null,Ui=null,Du=!1;function X0(e,t,n){var s=n.window===n?n.document:n.nodeType===9?n:n.ownerDocument;Du||ho==null||ho!==Dl(s)||(s=ho,"selectionStart"in s&&Up(s)?s={start:s.selectionStart,end:s.selectionEnd}:(s=(s.ownerDocument&&s.ownerDocument.defaultView||window).getSelection(),s={anchorNode:s.anchorNode,anchorOffset:s.anchorOffset,focusNode:s.focusNode,focusOffset:s.focusOffset}),Ui&&ra(Ui,s)||(Ui=s,s=Yl(zu,"onSelect"),0<s.length&&(t=new Fp("onSelect","select",null,t,n),e.push({event:t,listeners:s}),t.target=ho)))}function Ja(e,t){var n={};return n[e.toLowerCase()]=t.toLowerCase(),n["Webkit"+e]="webkit"+t,n["Moz"+e]="moz"+t,n}var go={animationend:Ja("Animation","AnimationEnd"),animationiteration:Ja("Animation","AnimationIteration"),animationstart:Ja("Animation","AnimationStart"),transitionend:Ja("Transition","TransitionEnd")},Bd={},ax={};Pr&&(ax=document.createElement("div").style,"AnimationEvent"in window||(delete go.animationend.animation,delete go.animationiteration.animation,delete go.animationstart.animation),"TransitionEvent"in window||delete go.transitionend.transition);function Cc(e){if(Bd[e])return Bd[e];if(!go[e])return e;var t=go[e],n;for(n in t)if(t.hasOwnProperty(n)&&n in ax)return Bd[e]=t[n];return e}var lx=Cc("animationend"),cx=Cc("animationiteration"),dx=Cc("animationstart"),ux=Cc("transitionend"),px=new Map,Z0="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function hs(e,t){px.set(e,t),Ys(t,[e])}for(var Od=0;Od<Z0.length;Od++){var Pd=Z0[Od],ES=Pd.toLowerCase(),jS=Pd[0].toUpperCase()+Pd.slice(1);hs(ES,"on"+jS)}hs(lx,"onAnimationEnd");hs(cx,"onAnimationIteration");hs(dx,"onAnimationStart");hs("dblclick","onDoubleClick");hs("focusin","onFocus");hs("focusout","onBlur");hs(ux,"onTransitionEnd");Lo("onMouseEnter",["mouseout","mouseover"]);Lo("onMouseLeave",["mouseout","mouseover"]);Lo("onPointerEnter",["pointerout","pointerover"]);Lo("onPointerLeave",["pointerout","pointerover"]);Ys("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));Ys("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));Ys("onBeforeInput",["compositionend","keypress","textInput","paste"]);Ys("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));Ys("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));Ys("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Oi="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),CS=new Set("cancel close invalid load scroll toggle".split(" ").concat(Oi));function em(e,t,n){var s=e.type||"unknown-event";e.currentTarget=n,Ev(s,t,void 0,e),e.currentTarget=null}function fx(e,t){t=(t&4)!==0;for(var n=0;n<e.length;n++){var s=e[n],o=s.event;s=s.listeners;e:{var i=void 0;if(t)for(var a=s.length-1;0<=a;a--){var l=s[a],d=l.instance,u=l.currentTarget;if(l=l.listener,d!==i&&o.isPropagationStopped())break e;em(o,l,u),i=d}else for(a=0;a<s.length;a++){if(l=s[a],d=l.instance,u=l.currentTarget,l=l.listener,d!==i&&o.isPropagationStopped())break e;em(o,l,u),i=d}}}if(Hl)throw e=$u,Hl=!1,$u=null,e}function bt(e,t){var n=t[Gu];n===void 0&&(n=t[Gu]=new Set);var s=e+"__bubble";n.has(s)||(mx(t,e,2,!1),n.add(s))}function zd(e,t,n){var s=0;t&&(s|=4),mx(n,e,s,t)}var Xa="_reactListening"+Math.random().toString(36).slice(2);function sa(e){if(!e[Xa]){e[Xa]=!0,Sg.forEach(function(n){n!=="selectionchange"&&(CS.has(n)||zd(n,!1,e),zd(n,!0,e))});var t=e.nodeType===9?e:e.ownerDocument;t===null||t[Xa]||(t[Xa]=!0,zd("selectionchange",!1,t))}}function mx(e,t,n,s){switch(Jg(t)){case 1:var o=Dv;break;case 4:o=Fv;break;default:o=zp}n=o.bind(null,t,n,e),o=void 0,!Lu||t!=="touchstart"&&t!=="touchmove"&&t!=="wheel"||(o=!0),s?o!==void 0?e.addEventListener(t,n,{capture:!0,passive:o}):e.addEventListener(t,n,!0):o!==void 0?e.addEventListener(t,n,{passive:o}):e.addEventListener(t,n,!1)}function Dd(e,t,n,s,o){var i=s;if(!(t&1)&&!(t&2)&&s!==null)e:for(;;){if(s===null)return;var a=s.tag;if(a===3||a===4){var l=s.stateNode.containerInfo;if(l===o||l.nodeType===8&&l.parentNode===o)break;if(a===4)for(a=s.return;a!==null;){var d=a.tag;if((d===3||d===4)&&(d=a.stateNode.containerInfo,d===o||d.nodeType===8&&d.parentNode===o))return;a=a.return}for(;l!==null;){if(a=As(l),a===null)return;if(d=a.tag,d===5||d===6){s=i=a;continue e}l=l.parentNode}}s=s.return}Og(function(){var u=i,p=$p(n),c=[];e:{var f=px.get(e);if(f!==void 0){var b=Fp,S=e;switch(e){case"keypress":if(kl(n)===0)break e;case"keydown":case"keyup":b=nS;break;case"focusin":S="focus",b=Nd;break;case"focusout":S="blur",b=Nd;break;case"beforeblur":case"afterblur":b=Nd;break;case"click":if(n.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":b=H0;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":b=Uv;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":b=oS;break;case lx:case cx:case dx:b=Yv;break;case ux:b=aS;break;case"scroll":b=Hv;break;case"wheel":b=cS;break;case"copy":case"cut":case"paste":b=Kv;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":b=U0}var E=(t&4)!==0,j=!E&&e==="scroll",x=E?f!==null?f+"Capture":null:f;E=[];for(var h=u,v;h!==null;){v=h;var g=v.stateNode;if(v.tag===5&&g!==null&&(v=g,x!==null&&(g=Xi(h,x),g!=null&&E.push(oa(h,g,v)))),j)break;h=h.return}0<E.length&&(f=new b(f,S,null,n,p),c.push({event:f,listeners:E}))}}if(!(t&7)){e:{if(f=e==="mouseover"||e==="pointerover",b=e==="mouseout"||e==="pointerout",f&&n!==Au&&(S=n.relatedTarget||n.fromElement)&&(As(S)||S[zr]))break e;if((b||f)&&(f=p.window===p?p:(f=p.ownerDocument)?f.defaultView||f.parentWindow:window,b?(S=n.relatedTarget||n.toElement,b=u,S=S?As(S):null,S!==null&&(j=qs(S),S!==j||S.tag!==5&&S.tag!==6)&&(S=null)):(b=null,S=u),b!==S)){if(E=H0,g="onMouseLeave",x="onMouseEnter",h="mouse",(e==="pointerout"||e==="pointerover")&&(E=U0,g="onPointerLeave",x="onPointerEnter",h="pointer"),j=b==null?f:xo(b),v=S==null?f:xo(S),f=new E(g,h+"leave",b,n,p),f.target=j,f.relatedTarget=v,g=null,As(p)===u&&(E=new E(x,h+"enter",S,n,p),E.target=v,E.relatedTarget=j,g=E),j=g,b&&S)t:{for(E=b,x=S,h=0,v=E;v;v=no(v))h++;for(v=0,g=x;g;g=no(g))v++;for(;0<h-v;)E=no(E),h--;for(;0<v-h;)x=no(x),v--;for(;h--;){if(E===x||x!==null&&E===x.alternate)break t;E=no(E),x=no(x)}E=null}else E=null;b!==null&&tm(c,f,b,E,!1),S!==null&&j!==null&&tm(c,j,S,E,!0)}}e:{if(f=u?xo(u):window,b=f.nodeName&&f.nodeName.toLowerCase(),b==="select"||b==="input"&&f.type==="file")var I=gS;else if(Y0(f))if(rx)I=vS;else{I=yS;var _=xS}else(b=f.nodeName)&&b.toLowerCase()==="input"&&(f.type==="checkbox"||f.type==="radio")&&(I=bS);if(I&&(I=I(e,u))){nx(c,I,n,p);break e}_&&_(e,f,u),e==="focusout"&&(_=f._wrapperState)&&_.controlled&&f.type==="number"&&Tu(f,"number",f.value)}switch(_=u?xo(u):window,e){case"focusin":(Y0(_)||_.contentEditable==="true")&&(ho=_,zu=u,Ui=null);break;case"focusout":Ui=zu=ho=null;break;case"mousedown":Du=!0;break;case"contextmenu":case"mouseup":case"dragend":Du=!1,X0(c,n,p);break;case"selectionchange":if(kS)break;case"keydown":case"keyup":X0(c,n,p)}var C;if(Wp)e:{switch(e){case"compositionstart":var k="onCompositionStart";break e;case"compositionend":k="onCompositionEnd";break e;case"compositionupdate":k="onCompositionUpdate";break e}k=void 0}else mo?ex(e,n)&&(k="onCompositionEnd"):e==="keydown"&&n.keyCode===229&&(k="onCompositionStart");k&&(Zg&&n.locale!=="ko"&&(mo||k!=="onCompositionStart"?k==="onCompositionEnd"&&mo&&(C=Xg()):(es=p,Dp="value"in es?es.value:es.textContent,mo=!0)),_=Yl(u,k),0<_.length&&(k=new W0(k,e,null,n,p),c.push({event:k,listeners:_}),C?k.data=C:(C=tx(n),C!==null&&(k.data=C)))),(C=uS?pS(e,n):fS(e,n))&&(u=Yl(u,"onBeforeInput"),0<u.length&&(p=new W0("onBeforeInput","beforeinput",null,n,p),c.push({event:p,listeners:u}),p.data=C))}fx(c,t)})}function oa(e,t,n){return{instance:e,listener:t,currentTarget:n}}function Yl(e,t){for(var n=t+"Capture",s=[];e!==null;){var o=e,i=o.stateNode;o.tag===5&&i!==null&&(o=i,i=Xi(e,n),i!=null&&s.unshift(oa(e,i,o)),i=Xi(e,t),i!=null&&s.push(oa(e,i,o))),e=e.return}return s}function no(e){if(e===null)return null;do e=e.return;while(e&&e.tag!==5);return e||null}function tm(e,t,n,s,o){for(var i=t._reactName,a=[];n!==null&&n!==s;){var l=n,d=l.alternate,u=l.stateNode;if(d!==null&&d===s)break;l.tag===5&&u!==null&&(l=u,o?(d=Xi(n,i),d!=null&&a.unshift(oa(n,d,l))):o||(d=Xi(n,i),d!=null&&a.push(oa(n,d,l)))),n=n.return}a.length!==0&&e.push({event:t,listeners:a})}var TS=/\r\n?/g,IS=/\u0000|\uFFFD/g;function nm(e){return(typeof e=="string"?e:""+e).replace(TS,`
`).replace(IS,"")}function Za(e,t,n){if(t=nm(t),nm(e)!==t&&n)throw Error(ue(425))}function ql(){}var Fu=null,Hu=null;function Wu(e,t){return e==="textarea"||e==="noscript"||typeof t.children=="string"||typeof t.children=="number"||typeof t.dangerouslySetInnerHTML=="object"&&t.dangerouslySetInnerHTML!==null&&t.dangerouslySetInnerHTML.__html!=null}var Uu=typeof setTimeout=="function"?setTimeout:void 0,_S=typeof clearTimeout=="function"?clearTimeout:void 0,rm=typeof Promise=="function"?Promise:void 0,RS=typeof queueMicrotask=="function"?queueMicrotask:typeof rm<"u"?function(e){return rm.resolve(null).then(e).catch(MS)}:Uu;function MS(e){setTimeout(function(){throw e})}function Fd(e,t){var n=t,s=0;do{var o=n.nextSibling;if(e.removeChild(n),o&&o.nodeType===8)if(n=o.data,n==="/$"){if(s===0){e.removeChild(o),ta(t);return}s--}else n!=="$"&&n!=="$?"&&n!=="$!"||s++;n=o}while(n);ta(t)}function is(e){for(;e!=null;e=e.nextSibling){var t=e.nodeType;if(t===1||t===3)break;if(t===8){if(t=e.data,t==="$"||t==="$!"||t==="$?")break;if(t==="/$")return null}}return e}function sm(e){e=e.previousSibling;for(var t=0;e;){if(e.nodeType===8){var n=e.data;if(n==="$"||n==="$!"||n==="$?"){if(t===0)return e;t--}else n==="/$"&&t++}e=e.previousSibling}return null}var Vo=Math.random().toString(36).slice(2),Sr="__reactFiber$"+Vo,ia="__reactProps$"+Vo,zr="__reactContainer$"+Vo,Gu="__reactEvents$"+Vo,AS="__reactListeners$"+Vo,NS="__reactHandles$"+Vo;function As(e){var t=e[Sr];if(t)return t;for(var n=e.parentNode;n;){if(t=n[zr]||n[Sr]){if(n=t.alternate,t.child!==null||n!==null&&n.child!==null)for(e=sm(e);e!==null;){if(n=e[Sr])return n;e=sm(e)}return t}e=n,n=e.parentNode}return null}function ba(e){return e=e[Sr]||e[zr],!e||e.tag!==5&&e.tag!==6&&e.tag!==13&&e.tag!==3?null:e}function xo(e){if(e.tag===5||e.tag===6)return e.stateNode;throw Error(ue(33))}function Tc(e){return e[ia]||null}var Vu=[],yo=-1;function gs(e){return{current:e}}function vt(e){0>yo||(e.current=Vu[yo],Vu[yo]=null,yo--)}function mt(e,t){yo++,Vu[yo]=e.current,e.current=t}var fs={},ln=gs(fs),kn=gs(!1),Ds=fs;function $o(e,t){var n=e.type.contextTypes;if(!n)return fs;var s=e.stateNode;if(s&&s.__reactInternalMemoizedUnmaskedChildContext===t)return s.__reactInternalMemoizedMaskedChildContext;var o={},i;for(i in n)o[i]=t[i];return s&&(e=e.stateNode,e.__reactInternalMemoizedUnmaskedChildContext=t,e.__reactInternalMemoizedMaskedChildContext=o),o}function En(e){return e=e.childContextTypes,e!=null}function Kl(){vt(kn),vt(ln)}function om(e,t,n){if(ln.current!==fs)throw Error(ue(168));mt(ln,t),mt(kn,n)}function hx(e,t,n){var s=e.stateNode;if(t=t.childContextTypes,typeof s.getChildContext!="function")return n;s=s.getChildContext();for(var o in s)if(!(o in t))throw Error(ue(108,xv(e)||"Unknown",o));return Ct({},n,s)}function Ql(e){return e=(e=e.stateNode)&&e.__reactInternalMemoizedMergedChildContext||fs,Ds=ln.current,mt(ln,e),mt(kn,kn.current),!0}function im(e,t,n){var s=e.stateNode;if(!s)throw Error(ue(169));n?(e=hx(e,t,Ds),s.__reactInternalMemoizedMergedChildContext=e,vt(kn),vt(ln),mt(ln,e)):vt(kn),mt(kn,n)}var Nr=null,Ic=!1,Hd=!1;function gx(e){Nr===null?Nr=[e]:Nr.push(e)}function LS(e){Ic=!0,gx(e)}function xs(){if(!Hd&&Nr!==null){Hd=!0;var e=0,t=dt;try{var n=Nr;for(dt=1;e<n.length;e++){var s=n[e];do s=s(!0);while(s!==null)}Nr=null,Ic=!1}catch(o){throw Nr!==null&&(Nr=Nr.slice(e+1)),Fg(Bp,xs),o}finally{dt=t,Hd=!1}}return null}var bo=[],vo=0,Jl=null,Xl=0,Un=[],Gn=0,Fs=null,Lr=1,$r="";function Rs(e,t){bo[vo++]=Xl,bo[vo++]=Jl,Jl=e,Xl=t}function xx(e,t,n){Un[Gn++]=Lr,Un[Gn++]=$r,Un[Gn++]=Fs,Fs=e;var s=Lr;e=$r;var o=32-ar(s)-1;s&=~(1<<o),n+=1;var i=32-ar(t)+o;if(30<i){var a=o-o%5;i=(s&(1<<a)-1).toString(32),s>>=a,o-=a,Lr=1<<32-ar(t)+o|n<<o|s,$r=i+e}else Lr=1<<i|n<<o|s,$r=e}function Gp(e){e.return!==null&&(Rs(e,1),xx(e,1,0))}function Vp(e){for(;e===Jl;)Jl=bo[--vo],bo[vo]=null,Xl=bo[--vo],bo[vo]=null;for(;e===Fs;)Fs=Un[--Gn],Un[Gn]=null,$r=Un[--Gn],Un[Gn]=null,Lr=Un[--Gn],Un[Gn]=null}var Ln=null,Nn=null,wt=!1,ir=null;function yx(e,t){var n=qn(5,null,null,0);n.elementType="DELETED",n.stateNode=t,n.return=e,t=e.deletions,t===null?(e.deletions=[n],e.flags|=16):t.push(n)}function am(e,t){switch(e.tag){case 5:var n=e.type;return t=t.nodeType!==1||n.toLowerCase()!==t.nodeName.toLowerCase()?null:t,t!==null?(e.stateNode=t,Ln=e,Nn=is(t.firstChild),!0):!1;case 6:return t=e.pendingProps===""||t.nodeType!==3?null:t,t!==null?(e.stateNode=t,Ln=e,Nn=null,!0):!1;case 13:return t=t.nodeType!==8?null:t,t!==null?(n=Fs!==null?{id:Lr,overflow:$r}:null,e.memoizedState={dehydrated:t,treeContext:n,retryLane:1073741824},n=qn(18,null,null,0),n.stateNode=t,n.return=e,e.child=n,Ln=e,Nn=null,!0):!1;default:return!1}}function Yu(e){return(e.mode&1)!==0&&(e.flags&128)===0}function qu(e){if(wt){var t=Nn;if(t){var n=t;if(!am(e,t)){if(Yu(e))throw Error(ue(418));t=is(n.nextSibling);var s=Ln;t&&am(e,t)?yx(s,n):(e.flags=e.flags&-4097|2,wt=!1,Ln=e)}}else{if(Yu(e))throw Error(ue(418));e.flags=e.flags&-4097|2,wt=!1,Ln=e}}}function lm(e){for(e=e.return;e!==null&&e.tag!==5&&e.tag!==3&&e.tag!==13;)e=e.return;Ln=e}function el(e){if(e!==Ln)return!1;if(!wt)return lm(e),wt=!0,!1;var t;if((t=e.tag!==3)&&!(t=e.tag!==5)&&(t=e.type,t=t!=="head"&&t!=="body"&&!Wu(e.type,e.memoizedProps)),t&&(t=Nn)){if(Yu(e))throw bx(),Error(ue(418));for(;t;)yx(e,t),t=is(t.nextSibling)}if(lm(e),e.tag===13){if(e=e.memoizedState,e=e!==null?e.dehydrated:null,!e)throw Error(ue(317));e:{for(e=e.nextSibling,t=0;e;){if(e.nodeType===8){var n=e.data;if(n==="/$"){if(t===0){Nn=is(e.nextSibling);break e}t--}else n!=="$"&&n!=="$!"&&n!=="$?"||t++}e=e.nextSibling}Nn=null}}else Nn=Ln?is(e.stateNode.nextSibling):null;return!0}function bx(){for(var e=Nn;e;)e=is(e.nextSibling)}function Bo(){Nn=Ln=null,wt=!1}function Yp(e){ir===null?ir=[e]:ir.push(e)}var $S=Wr.ReactCurrentBatchConfig;function ji(e,t,n){if(e=n.ref,e!==null&&typeof e!="function"&&typeof e!="object"){if(n._owner){if(n=n._owner,n){if(n.tag!==1)throw Error(ue(309));var s=n.stateNode}if(!s)throw Error(ue(147,e));var o=s,i=""+e;return t!==null&&t.ref!==null&&typeof t.ref=="function"&&t.ref._stringRef===i?t.ref:(t=function(a){var l=o.refs;a===null?delete l[i]:l[i]=a},t._stringRef=i,t)}if(typeof e!="string")throw Error(ue(284));if(!n._owner)throw Error(ue(290,e))}return e}function tl(e,t){throw e=Object.prototype.toString.call(t),Error(ue(31,e==="[object Object]"?"object with keys {"+Object.keys(t).join(", ")+"}":e))}function cm(e){var t=e._init;return t(e._payload)}function vx(e){function t(x,h){if(e){var v=x.deletions;v===null?(x.deletions=[h],x.flags|=16):v.push(h)}}function n(x,h){if(!e)return null;for(;h!==null;)t(x,h),h=h.sibling;return null}function s(x,h){for(x=new Map;h!==null;)h.key!==null?x.set(h.key,h):x.set(h.index,h),h=h.sibling;return x}function o(x,h){return x=ds(x,h),x.index=0,x.sibling=null,x}function i(x,h,v){return x.index=v,e?(v=x.alternate,v!==null?(v=v.index,v<h?(x.flags|=2,h):v):(x.flags|=2,h)):(x.flags|=1048576,h)}function a(x){return e&&x.alternate===null&&(x.flags|=2),x}function l(x,h,v,g){return h===null||h.tag!==6?(h=Kd(v,x.mode,g),h.return=x,h):(h=o(h,v),h.return=x,h)}function d(x,h,v,g){var I=v.type;return I===fo?p(x,h,v.props.children,g,v.key):h!==null&&(h.elementType===I||typeof I=="object"&&I!==null&&I.$$typeof===Kr&&cm(I)===h.type)?(g=o(h,v.props),g.ref=ji(x,h,v),g.return=x,g):(g=Rl(v.type,v.key,v.props,null,x.mode,g),g.ref=ji(x,h,v),g.return=x,g)}function u(x,h,v,g){return h===null||h.tag!==4||h.stateNode.containerInfo!==v.containerInfo||h.stateNode.implementation!==v.implementation?(h=Qd(v,x.mode,g),h.return=x,h):(h=o(h,v.children||[]),h.return=x,h)}function p(x,h,v,g,I){return h===null||h.tag!==7?(h=Bs(v,x.mode,g,I),h.return=x,h):(h=o(h,v),h.return=x,h)}function c(x,h,v){if(typeof h=="string"&&h!==""||typeof h=="number")return h=Kd(""+h,x.mode,v),h.return=x,h;if(typeof h=="object"&&h!==null){switch(h.$$typeof){case Ua:return v=Rl(h.type,h.key,h.props,null,x.mode,v),v.ref=ji(x,null,h),v.return=x,v;case po:return h=Qd(h,x.mode,v),h.return=x,h;case Kr:var g=h._init;return c(x,g(h._payload),v)}if($i(h)||vi(h))return h=Bs(h,x.mode,v,null),h.return=x,h;tl(x,h)}return null}function f(x,h,v,g){var I=h!==null?h.key:null;if(typeof v=="string"&&v!==""||typeof v=="number")return I!==null?null:l(x,h,""+v,g);if(typeof v=="object"&&v!==null){switch(v.$$typeof){case Ua:return v.key===I?d(x,h,v,g):null;case po:return v.key===I?u(x,h,v,g):null;case Kr:return I=v._init,f(x,h,I(v._payload),g)}if($i(v)||vi(v))return I!==null?null:p(x,h,v,g,null);tl(x,v)}return null}function b(x,h,v,g,I){if(typeof g=="string"&&g!==""||typeof g=="number")return x=x.get(v)||null,l(h,x,""+g,I);if(typeof g=="object"&&g!==null){switch(g.$$typeof){case Ua:return x=x.get(g.key===null?v:g.key)||null,d(h,x,g,I);case po:return x=x.get(g.key===null?v:g.key)||null,u(h,x,g,I);case Kr:var _=g._init;return b(x,h,v,_(g._payload),I)}if($i(g)||vi(g))return x=x.get(v)||null,p(h,x,g,I,null);tl(h,g)}return null}function S(x,h,v,g){for(var I=null,_=null,C=h,k=h=0,R=null;C!==null&&k<v.length;k++){C.index>k?(R=C,C=null):R=C.sibling;var T=f(x,C,v[k],g);if(T===null){C===null&&(C=R);break}e&&C&&T.alternate===null&&t(x,C),h=i(T,h,k),_===null?I=T:_.sibling=T,_=T,C=R}if(k===v.length)return n(x,C),wt&&Rs(x,k),I;if(C===null){for(;k<v.length;k++)C=c(x,v[k],g),C!==null&&(h=i(C,h,k),_===null?I=C:_.sibling=C,_=C);return wt&&Rs(x,k),I}for(C=s(x,C);k<v.length;k++)R=b(C,x,k,v[k],g),R!==null&&(e&&R.alternate!==null&&C.delete(R.key===null?k:R.key),h=i(R,h,k),_===null?I=R:_.sibling=R,_=R);return e&&C.forEach(function(N){return t(x,N)}),wt&&Rs(x,k),I}function E(x,h,v,g){var I=vi(v);if(typeof I!="function")throw Error(ue(150));if(v=I.call(v),v==null)throw Error(ue(151));for(var _=I=null,C=h,k=h=0,R=null,T=v.next();C!==null&&!T.done;k++,T=v.next()){C.index>k?(R=C,C=null):R=C.sibling;var N=f(x,C,T.value,g);if(N===null){C===null&&(C=R);break}e&&C&&N.alternate===null&&t(x,C),h=i(N,h,k),_===null?I=N:_.sibling=N,_=N,C=R}if(T.done)return n(x,C),wt&&Rs(x,k),I;if(C===null){for(;!T.done;k++,T=v.next())T=c(x,T.value,g),T!==null&&(h=i(T,h,k),_===null?I=T:_.sibling=T,_=T);return wt&&Rs(x,k),I}for(C=s(x,C);!T.done;k++,T=v.next())T=b(C,x,k,T.value,g),T!==null&&(e&&T.alternate!==null&&C.delete(T.key===null?k:T.key),h=i(T,h,k),_===null?I=T:_.sibling=T,_=T);return e&&C.forEach(function(Y){return t(x,Y)}),wt&&Rs(x,k),I}function j(x,h,v,g){if(typeof v=="object"&&v!==null&&v.type===fo&&v.key===null&&(v=v.props.children),typeof v=="object"&&v!==null){switch(v.$$typeof){case Ua:e:{for(var I=v.key,_=h;_!==null;){if(_.key===I){if(I=v.type,I===fo){if(_.tag===7){n(x,_.sibling),h=o(_,v.props.children),h.return=x,x=h;break e}}else if(_.elementType===I||typeof I=="object"&&I!==null&&I.$$typeof===Kr&&cm(I)===_.type){n(x,_.sibling),h=o(_,v.props),h.ref=ji(x,_,v),h.return=x,x=h;break e}n(x,_);break}else t(x,_);_=_.sibling}v.type===fo?(h=Bs(v.props.children,x.mode,g,v.key),h.return=x,x=h):(g=Rl(v.type,v.key,v.props,null,x.mode,g),g.ref=ji(x,h,v),g.return=x,x=g)}return a(x);case po:e:{for(_=v.key;h!==null;){if(h.key===_)if(h.tag===4&&h.stateNode.containerInfo===v.containerInfo&&h.stateNode.implementation===v.implementation){n(x,h.sibling),h=o(h,v.children||[]),h.return=x,x=h;break e}else{n(x,h);break}else t(x,h);h=h.sibling}h=Qd(v,x.mode,g),h.return=x,x=h}return a(x);case Kr:return _=v._init,j(x,h,_(v._payload),g)}if($i(v))return S(x,h,v,g);if(vi(v))return E(x,h,v,g);tl(x,v)}return typeof v=="string"&&v!==""||typeof v=="number"?(v=""+v,h!==null&&h.tag===6?(n(x,h.sibling),h=o(h,v),h.return=x,x=h):(n(x,h),h=Kd(v,x.mode,g),h.return=x,x=h),a(x)):n(x,h)}return j}var Oo=vx(!0),Sx=vx(!1),Zl=gs(null),ec=null,So=null,qp=null;function Kp(){qp=So=ec=null}function Qp(e){var t=Zl.current;vt(Zl),e._currentValue=t}function Ku(e,t,n){for(;e!==null;){var s=e.alternate;if((e.childLanes&t)!==t?(e.childLanes|=t,s!==null&&(s.childLanes|=t)):s!==null&&(s.childLanes&t)!==t&&(s.childLanes|=t),e===n)break;e=e.return}}function _o(e,t){ec=e,qp=So=null,e=e.dependencies,e!==null&&e.firstContext!==null&&(e.lanes&t&&(wn=!0),e.firstContext=null)}function Qn(e){var t=e._currentValue;if(qp!==e)if(e={context:e,memoizedValue:t,next:null},So===null){if(ec===null)throw Error(ue(308));So=e,ec.dependencies={lanes:0,firstContext:e}}else So=So.next=e;return t}var Ns=null;function Jp(e){Ns===null?Ns=[e]:Ns.push(e)}function wx(e,t,n,s){var o=t.interleaved;return o===null?(n.next=n,Jp(t)):(n.next=o.next,o.next=n),t.interleaved=n,Dr(e,s)}function Dr(e,t){e.lanes|=t;var n=e.alternate;for(n!==null&&(n.lanes|=t),n=e,e=e.return;e!==null;)e.childLanes|=t,n=e.alternate,n!==null&&(n.childLanes|=t),n=e,e=e.return;return n.tag===3?n.stateNode:null}var Qr=!1;function Xp(e){e.updateQueue={baseState:e.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function kx(e,t){e=e.updateQueue,t.updateQueue===e&&(t.updateQueue={baseState:e.baseState,firstBaseUpdate:e.firstBaseUpdate,lastBaseUpdate:e.lastBaseUpdate,shared:e.shared,effects:e.effects})}function Or(e,t){return{eventTime:e,lane:t,tag:0,payload:null,callback:null,next:null}}function as(e,t,n){var s=e.updateQueue;if(s===null)return null;if(s=s.shared,nt&2){var o=s.pending;return o===null?t.next=t:(t.next=o.next,o.next=t),s.pending=t,Dr(e,n)}return o=s.interleaved,o===null?(t.next=t,Jp(s)):(t.next=o.next,o.next=t),s.interleaved=t,Dr(e,n)}function El(e,t,n){if(t=t.updateQueue,t!==null&&(t=t.shared,(n&4194240)!==0)){var s=t.lanes;s&=e.pendingLanes,n|=s,t.lanes=n,Op(e,n)}}function dm(e,t){var n=e.updateQueue,s=e.alternate;if(s!==null&&(s=s.updateQueue,n===s)){var o=null,i=null;if(n=n.firstBaseUpdate,n!==null){do{var a={eventTime:n.eventTime,lane:n.lane,tag:n.tag,payload:n.payload,callback:n.callback,next:null};i===null?o=i=a:i=i.next=a,n=n.next}while(n!==null);i===null?o=i=t:i=i.next=t}else o=i=t;n={baseState:s.baseState,firstBaseUpdate:o,lastBaseUpdate:i,shared:s.shared,effects:s.effects},e.updateQueue=n;return}e=n.lastBaseUpdate,e===null?n.firstBaseUpdate=t:e.next=t,n.lastBaseUpdate=t}function tc(e,t,n,s){var o=e.updateQueue;Qr=!1;var i=o.firstBaseUpdate,a=o.lastBaseUpdate,l=o.shared.pending;if(l!==null){o.shared.pending=null;var d=l,u=d.next;d.next=null,a===null?i=u:a.next=u,a=d;var p=e.alternate;p!==null&&(p=p.updateQueue,l=p.lastBaseUpdate,l!==a&&(l===null?p.firstBaseUpdate=u:l.next=u,p.lastBaseUpdate=d))}if(i!==null){var c=o.baseState;a=0,p=u=d=null,l=i;do{var f=l.lane,b=l.eventTime;if((s&f)===f){p!==null&&(p=p.next={eventTime:b,lane:0,tag:l.tag,payload:l.payload,callback:l.callback,next:null});e:{var S=e,E=l;switch(f=t,b=n,E.tag){case 1:if(S=E.payload,typeof S=="function"){c=S.call(b,c,f);break e}c=S;break e;case 3:S.flags=S.flags&-65537|128;case 0:if(S=E.payload,f=typeof S=="function"?S.call(b,c,f):S,f==null)break e;c=Ct({},c,f);break e;case 2:Qr=!0}}l.callback!==null&&l.lane!==0&&(e.flags|=64,f=o.effects,f===null?o.effects=[l]:f.push(l))}else b={eventTime:b,lane:f,tag:l.tag,payload:l.payload,callback:l.callback,next:null},p===null?(u=p=b,d=c):p=p.next=b,a|=f;if(l=l.next,l===null){if(l=o.shared.pending,l===null)break;f=l,l=f.next,f.next=null,o.lastBaseUpdate=f,o.shared.pending=null}}while(!0);if(p===null&&(d=c),o.baseState=d,o.firstBaseUpdate=u,o.lastBaseUpdate=p,t=o.shared.interleaved,t!==null){o=t;do a|=o.lane,o=o.next;while(o!==t)}else i===null&&(o.shared.lanes=0);Ws|=a,e.lanes=a,e.memoizedState=c}}function um(e,t,n){if(e=t.effects,t.effects=null,e!==null)for(t=0;t<e.length;t++){var s=e[t],o=s.callback;if(o!==null){if(s.callback=null,s=n,typeof o!="function")throw Error(ue(191,o));o.call(s)}}}var va={},kr=gs(va),aa=gs(va),la=gs(va);function Ls(e){if(e===va)throw Error(ue(174));return e}function Zp(e,t){switch(mt(la,t),mt(aa,e),mt(kr,va),e=t.nodeType,e){case 9:case 11:t=(t=t.documentElement)?t.namespaceURI:_u(null,"");break;default:e=e===8?t.parentNode:t,t=e.namespaceURI||null,e=e.tagName,t=_u(t,e)}vt(kr),mt(kr,t)}function Po(){vt(kr),vt(aa),vt(la)}function Ex(e){Ls(la.current);var t=Ls(kr.current),n=_u(t,e.type);t!==n&&(mt(aa,e),mt(kr,n))}function ef(e){aa.current===e&&(vt(kr),vt(aa))}var Et=gs(0);function nc(e){for(var t=e;t!==null;){if(t.tag===13){var n=t.memoizedState;if(n!==null&&(n=n.dehydrated,n===null||n.data==="$?"||n.data==="$!"))return t}else if(t.tag===19&&t.memoizedProps.revealOrder!==void 0){if(t.flags&128)return t}else if(t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break;for(;t.sibling===null;){if(t.return===null||t.return===e)return null;t=t.return}t.sibling.return=t.return,t=t.sibling}return null}var Wd=[];function tf(){for(var e=0;e<Wd.length;e++)Wd[e]._workInProgressVersionPrimary=null;Wd.length=0}var jl=Wr.ReactCurrentDispatcher,Ud=Wr.ReactCurrentBatchConfig,Hs=0,jt=null,Lt=null,Dt=null,rc=!1,Gi=!1,ca=0,BS=0;function nn(){throw Error(ue(321))}function nf(e,t){if(t===null)return!1;for(var n=0;n<t.length&&n<e.length;n++)if(!cr(e[n],t[n]))return!1;return!0}function rf(e,t,n,s,o,i){if(Hs=i,jt=t,t.memoizedState=null,t.updateQueue=null,t.lanes=0,jl.current=e===null||e.memoizedState===null?DS:FS,e=n(s,o),Gi){i=0;do{if(Gi=!1,ca=0,25<=i)throw Error(ue(301));i+=1,Dt=Lt=null,t.updateQueue=null,jl.current=HS,e=n(s,o)}while(Gi)}if(jl.current=sc,t=Lt!==null&&Lt.next!==null,Hs=0,Dt=Lt=jt=null,rc=!1,t)throw Error(ue(300));return e}function sf(){var e=ca!==0;return ca=0,e}function vr(){var e={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Dt===null?jt.memoizedState=Dt=e:Dt=Dt.next=e,Dt}function Jn(){if(Lt===null){var e=jt.alternate;e=e!==null?e.memoizedState:null}else e=Lt.next;var t=Dt===null?jt.memoizedState:Dt.next;if(t!==null)Dt=t,Lt=e;else{if(e===null)throw Error(ue(310));Lt=e,e={memoizedState:Lt.memoizedState,baseState:Lt.baseState,baseQueue:Lt.baseQueue,queue:Lt.queue,next:null},Dt===null?jt.memoizedState=Dt=e:Dt=Dt.next=e}return Dt}function da(e,t){return typeof t=="function"?t(e):t}function Gd(e){var t=Jn(),n=t.queue;if(n===null)throw Error(ue(311));n.lastRenderedReducer=e;var s=Lt,o=s.baseQueue,i=n.pending;if(i!==null){if(o!==null){var a=o.next;o.next=i.next,i.next=a}s.baseQueue=o=i,n.pending=null}if(o!==null){i=o.next,s=s.baseState;var l=a=null,d=null,u=i;do{var p=u.lane;if((Hs&p)===p)d!==null&&(d=d.next={lane:0,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null}),s=u.hasEagerState?u.eagerState:e(s,u.action);else{var c={lane:p,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null};d===null?(l=d=c,a=s):d=d.next=c,jt.lanes|=p,Ws|=p}u=u.next}while(u!==null&&u!==i);d===null?a=s:d.next=l,cr(s,t.memoizedState)||(wn=!0),t.memoizedState=s,t.baseState=a,t.baseQueue=d,n.lastRenderedState=s}if(e=n.interleaved,e!==null){o=e;do i=o.lane,jt.lanes|=i,Ws|=i,o=o.next;while(o!==e)}else o===null&&(n.lanes=0);return[t.memoizedState,n.dispatch]}function Vd(e){var t=Jn(),n=t.queue;if(n===null)throw Error(ue(311));n.lastRenderedReducer=e;var s=n.dispatch,o=n.pending,i=t.memoizedState;if(o!==null){n.pending=null;var a=o=o.next;do i=e(i,a.action),a=a.next;while(a!==o);cr(i,t.memoizedState)||(wn=!0),t.memoizedState=i,t.baseQueue===null&&(t.baseState=i),n.lastRenderedState=i}return[i,s]}function jx(){}function Cx(e,t){var n=jt,s=Jn(),o=t(),i=!cr(s.memoizedState,o);if(i&&(s.memoizedState=o,wn=!0),s=s.queue,of(_x.bind(null,n,s,e),[e]),s.getSnapshot!==t||i||Dt!==null&&Dt.memoizedState.tag&1){if(n.flags|=2048,ua(9,Ix.bind(null,n,s,o,t),void 0,null),Ft===null)throw Error(ue(349));Hs&30||Tx(n,t,o)}return o}function Tx(e,t,n){e.flags|=16384,e={getSnapshot:t,value:n},t=jt.updateQueue,t===null?(t={lastEffect:null,stores:null},jt.updateQueue=t,t.stores=[e]):(n=t.stores,n===null?t.stores=[e]:n.push(e))}function Ix(e,t,n,s){t.value=n,t.getSnapshot=s,Rx(t)&&Mx(e)}function _x(e,t,n){return n(function(){Rx(t)&&Mx(e)})}function Rx(e){var t=e.getSnapshot;e=e.value;try{var n=t();return!cr(e,n)}catch{return!0}}function Mx(e){var t=Dr(e,1);t!==null&&lr(t,e,1,-1)}function pm(e){var t=vr();return typeof e=="function"&&(e=e()),t.memoizedState=t.baseState=e,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:da,lastRenderedState:e},t.queue=e,e=e.dispatch=zS.bind(null,jt,e),[t.memoizedState,e]}function ua(e,t,n,s){return e={tag:e,create:t,destroy:n,deps:s,next:null},t=jt.updateQueue,t===null?(t={lastEffect:null,stores:null},jt.updateQueue=t,t.lastEffect=e.next=e):(n=t.lastEffect,n===null?t.lastEffect=e.next=e:(s=n.next,n.next=e,e.next=s,t.lastEffect=e)),e}function Ax(){return Jn().memoizedState}function Cl(e,t,n,s){var o=vr();jt.flags|=e,o.memoizedState=ua(1|t,n,void 0,s===void 0?null:s)}function _c(e,t,n,s){var o=Jn();s=s===void 0?null:s;var i=void 0;if(Lt!==null){var a=Lt.memoizedState;if(i=a.destroy,s!==null&&nf(s,a.deps)){o.memoizedState=ua(t,n,i,s);return}}jt.flags|=e,o.memoizedState=ua(1|t,n,i,s)}function fm(e,t){return Cl(8390656,8,e,t)}function of(e,t){return _c(2048,8,e,t)}function Nx(e,t){return _c(4,2,e,t)}function Lx(e,t){return _c(4,4,e,t)}function $x(e,t){if(typeof t=="function")return e=e(),t(e),function(){t(null)};if(t!=null)return e=e(),t.current=e,function(){t.current=null}}function Bx(e,t,n){return n=n!=null?n.concat([e]):null,_c(4,4,$x.bind(null,t,e),n)}function af(){}function Ox(e,t){var n=Jn();t=t===void 0?null:t;var s=n.memoizedState;return s!==null&&t!==null&&nf(t,s[1])?s[0]:(n.memoizedState=[e,t],e)}function Px(e,t){var n=Jn();t=t===void 0?null:t;var s=n.memoizedState;return s!==null&&t!==null&&nf(t,s[1])?s[0]:(e=e(),n.memoizedState=[e,t],e)}function zx(e,t,n){return Hs&21?(cr(n,t)||(n=Ug(),jt.lanes|=n,Ws|=n,e.baseState=!0),t):(e.baseState&&(e.baseState=!1,wn=!0),e.memoizedState=n)}function OS(e,t){var n=dt;dt=n!==0&&4>n?n:4,e(!0);var s=Ud.transition;Ud.transition={};try{e(!1),t()}finally{dt=n,Ud.transition=s}}function Dx(){return Jn().memoizedState}function PS(e,t,n){var s=cs(e);if(n={lane:s,action:n,hasEagerState:!1,eagerState:null,next:null},Fx(e))Hx(t,n);else if(n=wx(e,t,n,s),n!==null){var o=mn();lr(n,e,s,o),Wx(n,t,s)}}function zS(e,t,n){var s=cs(e),o={lane:s,action:n,hasEagerState:!1,eagerState:null,next:null};if(Fx(e))Hx(t,o);else{var i=e.alternate;if(e.lanes===0&&(i===null||i.lanes===0)&&(i=t.lastRenderedReducer,i!==null))try{var a=t.lastRenderedState,l=i(a,n);if(o.hasEagerState=!0,o.eagerState=l,cr(l,a)){var d=t.interleaved;d===null?(o.next=o,Jp(t)):(o.next=d.next,d.next=o),t.interleaved=o;return}}catch{}finally{}n=wx(e,t,o,s),n!==null&&(o=mn(),lr(n,e,s,o),Wx(n,t,s))}}function Fx(e){var t=e.alternate;return e===jt||t!==null&&t===jt}function Hx(e,t){Gi=rc=!0;var n=e.pending;n===null?t.next=t:(t.next=n.next,n.next=t),e.pending=t}function Wx(e,t,n){if(n&4194240){var s=t.lanes;s&=e.pendingLanes,n|=s,t.lanes=n,Op(e,n)}}var sc={readContext:Qn,useCallback:nn,useContext:nn,useEffect:nn,useImperativeHandle:nn,useInsertionEffect:nn,useLayoutEffect:nn,useMemo:nn,useReducer:nn,useRef:nn,useState:nn,useDebugValue:nn,useDeferredValue:nn,useTransition:nn,useMutableSource:nn,useSyncExternalStore:nn,useId:nn,unstable_isNewReconciler:!1},DS={readContext:Qn,useCallback:function(e,t){return vr().memoizedState=[e,t===void 0?null:t],e},useContext:Qn,useEffect:fm,useImperativeHandle:function(e,t,n){return n=n!=null?n.concat([e]):null,Cl(4194308,4,$x.bind(null,t,e),n)},useLayoutEffect:function(e,t){return Cl(4194308,4,e,t)},useInsertionEffect:function(e,t){return Cl(4,2,e,t)},useMemo:function(e,t){var n=vr();return t=t===void 0?null:t,e=e(),n.memoizedState=[e,t],e},useReducer:function(e,t,n){var s=vr();return t=n!==void 0?n(t):t,s.memoizedState=s.baseState=t,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:e,lastRenderedState:t},s.queue=e,e=e.dispatch=PS.bind(null,jt,e),[s.memoizedState,e]},useRef:function(e){var t=vr();return e={current:e},t.memoizedState=e},useState:pm,useDebugValue:af,useDeferredValue:function(e){return vr().memoizedState=e},useTransition:function(){var e=pm(!1),t=e[0];return e=OS.bind(null,e[1]),vr().memoizedState=e,[t,e]},useMutableSource:function(){},useSyncExternalStore:function(e,t,n){var s=jt,o=vr();if(wt){if(n===void 0)throw Error(ue(407));n=n()}else{if(n=t(),Ft===null)throw Error(ue(349));Hs&30||Tx(s,t,n)}o.memoizedState=n;var i={value:n,getSnapshot:t};return o.queue=i,fm(_x.bind(null,s,i,e),[e]),s.flags|=2048,ua(9,Ix.bind(null,s,i,n,t),void 0,null),n},useId:function(){var e=vr(),t=Ft.identifierPrefix;if(wt){var n=$r,s=Lr;n=(s&~(1<<32-ar(s)-1)).toString(32)+n,t=":"+t+"R"+n,n=ca++,0<n&&(t+="H"+n.toString(32)),t+=":"}else n=BS++,t=":"+t+"r"+n.toString(32)+":";return e.memoizedState=t},unstable_isNewReconciler:!1},FS={readContext:Qn,useCallback:Ox,useContext:Qn,useEffect:of,useImperativeHandle:Bx,useInsertionEffect:Nx,useLayoutEffect:Lx,useMemo:Px,useReducer:Gd,useRef:Ax,useState:function(){return Gd(da)},useDebugValue:af,useDeferredValue:function(e){var t=Jn();return zx(t,Lt.memoizedState,e)},useTransition:function(){var e=Gd(da)[0],t=Jn().memoizedState;return[e,t]},useMutableSource:jx,useSyncExternalStore:Cx,useId:Dx,unstable_isNewReconciler:!1},HS={readContext:Qn,useCallback:Ox,useContext:Qn,useEffect:of,useImperativeHandle:Bx,useInsertionEffect:Nx,useLayoutEffect:Lx,useMemo:Px,useReducer:Vd,useRef:Ax,useState:function(){return Vd(da)},useDebugValue:af,useDeferredValue:function(e){var t=Jn();return Lt===null?t.memoizedState=e:zx(t,Lt.memoizedState,e)},useTransition:function(){var e=Vd(da)[0],t=Jn().memoizedState;return[e,t]},useMutableSource:jx,useSyncExternalStore:Cx,useId:Dx,unstable_isNewReconciler:!1};function sr(e,t){if(e&&e.defaultProps){t=Ct({},t),e=e.defaultProps;for(var n in e)t[n]===void 0&&(t[n]=e[n]);return t}return t}function Qu(e,t,n,s){t=e.memoizedState,n=n(s,t),n=n==null?t:Ct({},t,n),e.memoizedState=n,e.lanes===0&&(e.updateQueue.baseState=n)}var Rc={isMounted:function(e){return(e=e._reactInternals)?qs(e)===e:!1},enqueueSetState:function(e,t,n){e=e._reactInternals;var s=mn(),o=cs(e),i=Or(s,o);i.payload=t,n!=null&&(i.callback=n),t=as(e,i,o),t!==null&&(lr(t,e,o,s),El(t,e,o))},enqueueReplaceState:function(e,t,n){e=e._reactInternals;var s=mn(),o=cs(e),i=Or(s,o);i.tag=1,i.payload=t,n!=null&&(i.callback=n),t=as(e,i,o),t!==null&&(lr(t,e,o,s),El(t,e,o))},enqueueForceUpdate:function(e,t){e=e._reactInternals;var n=mn(),s=cs(e),o=Or(n,s);o.tag=2,t!=null&&(o.callback=t),t=as(e,o,s),t!==null&&(lr(t,e,s,n),El(t,e,s))}};function mm(e,t,n,s,o,i,a){return e=e.stateNode,typeof e.shouldComponentUpdate=="function"?e.shouldComponentUpdate(s,i,a):t.prototype&&t.prototype.isPureReactComponent?!ra(n,s)||!ra(o,i):!0}function Ux(e,t,n){var s=!1,o=fs,i=t.contextType;return typeof i=="object"&&i!==null?i=Qn(i):(o=En(t)?Ds:ln.current,s=t.contextTypes,i=(s=s!=null)?$o(e,o):fs),t=new t(n,i),e.memoizedState=t.state!==null&&t.state!==void 0?t.state:null,t.updater=Rc,e.stateNode=t,t._reactInternals=e,s&&(e=e.stateNode,e.__reactInternalMemoizedUnmaskedChildContext=o,e.__reactInternalMemoizedMaskedChildContext=i),t}function hm(e,t,n,s){e=t.state,typeof t.componentWillReceiveProps=="function"&&t.componentWillReceiveProps(n,s),typeof t.UNSAFE_componentWillReceiveProps=="function"&&t.UNSAFE_componentWillReceiveProps(n,s),t.state!==e&&Rc.enqueueReplaceState(t,t.state,null)}function Ju(e,t,n,s){var o=e.stateNode;o.props=n,o.state=e.memoizedState,o.refs={},Xp(e);var i=t.contextType;typeof i=="object"&&i!==null?o.context=Qn(i):(i=En(t)?Ds:ln.current,o.context=$o(e,i)),o.state=e.memoizedState,i=t.getDerivedStateFromProps,typeof i=="function"&&(Qu(e,t,i,n),o.state=e.memoizedState),typeof t.getDerivedStateFromProps=="function"||typeof o.getSnapshotBeforeUpdate=="function"||typeof o.UNSAFE_componentWillMount!="function"&&typeof o.componentWillMount!="function"||(t=o.state,typeof o.componentWillMount=="function"&&o.componentWillMount(),typeof o.UNSAFE_componentWillMount=="function"&&o.UNSAFE_componentWillMount(),t!==o.state&&Rc.enqueueReplaceState(o,o.state,null),tc(e,n,o,s),o.state=e.memoizedState),typeof o.componentDidMount=="function"&&(e.flags|=4194308)}function zo(e,t){try{var n="",s=t;do n+=gv(s),s=s.return;while(s);var o=n}catch(i){o=`
Error generating stack: `+i.message+`
`+i.stack}return{value:e,source:t,stack:o,digest:null}}function Yd(e,t,n){return{value:e,source:null,stack:n??null,digest:t??null}}function Xu(e,t){try{console.error(t.value)}catch(n){setTimeout(function(){throw n})}}var WS=typeof WeakMap=="function"?WeakMap:Map;function Gx(e,t,n){n=Or(-1,n),n.tag=3,n.payload={element:null};var s=t.value;return n.callback=function(){ic||(ic=!0,lp=s),Xu(e,t)},n}function Vx(e,t,n){n=Or(-1,n),n.tag=3;var s=e.type.getDerivedStateFromError;if(typeof s=="function"){var o=t.value;n.payload=function(){return s(o)},n.callback=function(){Xu(e,t)}}var i=e.stateNode;return i!==null&&typeof i.componentDidCatch=="function"&&(n.callback=function(){Xu(e,t),typeof s!="function"&&(ls===null?ls=new Set([this]):ls.add(this));var a=t.stack;this.componentDidCatch(t.value,{componentStack:a!==null?a:""})}),n}function gm(e,t,n){var s=e.pingCache;if(s===null){s=e.pingCache=new WS;var o=new Set;s.set(t,o)}else o=s.get(t),o===void 0&&(o=new Set,s.set(t,o));o.has(n)||(o.add(n),e=r2.bind(null,e,t,n),t.then(e,e))}function xm(e){do{var t;if((t=e.tag===13)&&(t=e.memoizedState,t=t!==null?t.dehydrated!==null:!0),t)return e;e=e.return}while(e!==null);return null}function ym(e,t,n,s,o){return e.mode&1?(e.flags|=65536,e.lanes=o,e):(e===t?e.flags|=65536:(e.flags|=128,n.flags|=131072,n.flags&=-52805,n.tag===1&&(n.alternate===null?n.tag=17:(t=Or(-1,1),t.tag=2,as(n,t,1))),n.lanes|=1),e)}var US=Wr.ReactCurrentOwner,wn=!1;function fn(e,t,n,s){t.child=e===null?Sx(t,null,n,s):Oo(t,e.child,n,s)}function bm(e,t,n,s,o){n=n.render;var i=t.ref;return _o(t,o),s=rf(e,t,n,s,i,o),n=sf(),e!==null&&!wn?(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~o,Fr(e,t,o)):(wt&&n&&Gp(t),t.flags|=1,fn(e,t,s,o),t.child)}function vm(e,t,n,s,o){if(e===null){var i=n.type;return typeof i=="function"&&!hf(i)&&i.defaultProps===void 0&&n.compare===null&&n.defaultProps===void 0?(t.tag=15,t.type=i,Yx(e,t,i,s,o)):(e=Rl(n.type,null,s,t,t.mode,o),e.ref=t.ref,e.return=t,t.child=e)}if(i=e.child,!(e.lanes&o)){var a=i.memoizedProps;if(n=n.compare,n=n!==null?n:ra,n(a,s)&&e.ref===t.ref)return Fr(e,t,o)}return t.flags|=1,e=ds(i,s),e.ref=t.ref,e.return=t,t.child=e}function Yx(e,t,n,s,o){if(e!==null){var i=e.memoizedProps;if(ra(i,s)&&e.ref===t.ref)if(wn=!1,t.pendingProps=s=i,(e.lanes&o)!==0)e.flags&131072&&(wn=!0);else return t.lanes=e.lanes,Fr(e,t,o)}return Zu(e,t,n,s,o)}function qx(e,t,n){var s=t.pendingProps,o=s.children,i=e!==null?e.memoizedState:null;if(s.mode==="hidden")if(!(t.mode&1))t.memoizedState={baseLanes:0,cachePool:null,transitions:null},mt(ko,An),An|=n;else{if(!(n&1073741824))return e=i!==null?i.baseLanes|n:n,t.lanes=t.childLanes=1073741824,t.memoizedState={baseLanes:e,cachePool:null,transitions:null},t.updateQueue=null,mt(ko,An),An|=e,null;t.memoizedState={baseLanes:0,cachePool:null,transitions:null},s=i!==null?i.baseLanes:n,mt(ko,An),An|=s}else i!==null?(s=i.baseLanes|n,t.memoizedState=null):s=n,mt(ko,An),An|=s;return fn(e,t,o,n),t.child}function Kx(e,t){var n=t.ref;(e===null&&n!==null||e!==null&&e.ref!==n)&&(t.flags|=512,t.flags|=2097152)}function Zu(e,t,n,s,o){var i=En(n)?Ds:ln.current;return i=$o(t,i),_o(t,o),n=rf(e,t,n,s,i,o),s=sf(),e!==null&&!wn?(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~o,Fr(e,t,o)):(wt&&s&&Gp(t),t.flags|=1,fn(e,t,n,o),t.child)}function Sm(e,t,n,s,o){if(En(n)){var i=!0;Ql(t)}else i=!1;if(_o(t,o),t.stateNode===null)Tl(e,t),Ux(t,n,s),Ju(t,n,s,o),s=!0;else if(e===null){var a=t.stateNode,l=t.memoizedProps;a.props=l;var d=a.context,u=n.contextType;typeof u=="object"&&u!==null?u=Qn(u):(u=En(n)?Ds:ln.current,u=$o(t,u));var p=n.getDerivedStateFromProps,c=typeof p=="function"||typeof a.getSnapshotBeforeUpdate=="function";c||typeof a.UNSAFE_componentWillReceiveProps!="function"&&typeof a.componentWillReceiveProps!="function"||(l!==s||d!==u)&&hm(t,a,s,u),Qr=!1;var f=t.memoizedState;a.state=f,tc(t,s,a,o),d=t.memoizedState,l!==s||f!==d||kn.current||Qr?(typeof p=="function"&&(Qu(t,n,p,s),d=t.memoizedState),(l=Qr||mm(t,n,l,s,f,d,u))?(c||typeof a.UNSAFE_componentWillMount!="function"&&typeof a.componentWillMount!="function"||(typeof a.componentWillMount=="function"&&a.componentWillMount(),typeof a.UNSAFE_componentWillMount=="function"&&a.UNSAFE_componentWillMount()),typeof a.componentDidMount=="function"&&(t.flags|=4194308)):(typeof a.componentDidMount=="function"&&(t.flags|=4194308),t.memoizedProps=s,t.memoizedState=d),a.props=s,a.state=d,a.context=u,s=l):(typeof a.componentDidMount=="function"&&(t.flags|=4194308),s=!1)}else{a=t.stateNode,kx(e,t),l=t.memoizedProps,u=t.type===t.elementType?l:sr(t.type,l),a.props=u,c=t.pendingProps,f=a.context,d=n.contextType,typeof d=="object"&&d!==null?d=Qn(d):(d=En(n)?Ds:ln.current,d=$o(t,d));var b=n.getDerivedStateFromProps;(p=typeof b=="function"||typeof a.getSnapshotBeforeUpdate=="function")||typeof a.UNSAFE_componentWillReceiveProps!="function"&&typeof a.componentWillReceiveProps!="function"||(l!==c||f!==d)&&hm(t,a,s,d),Qr=!1,f=t.memoizedState,a.state=f,tc(t,s,a,o);var S=t.memoizedState;l!==c||f!==S||kn.current||Qr?(typeof b=="function"&&(Qu(t,n,b,s),S=t.memoizedState),(u=Qr||mm(t,n,u,s,f,S,d)||!1)?(p||typeof a.UNSAFE_componentWillUpdate!="function"&&typeof a.componentWillUpdate!="function"||(typeof a.componentWillUpdate=="function"&&a.componentWillUpdate(s,S,d),typeof a.UNSAFE_componentWillUpdate=="function"&&a.UNSAFE_componentWillUpdate(s,S,d)),typeof a.componentDidUpdate=="function"&&(t.flags|=4),typeof a.getSnapshotBeforeUpdate=="function"&&(t.flags|=1024)):(typeof a.componentDidUpdate!="function"||l===e.memoizedProps&&f===e.memoizedState||(t.flags|=4),typeof a.getSnapshotBeforeUpdate!="function"||l===e.memoizedProps&&f===e.memoizedState||(t.flags|=1024),t.memoizedProps=s,t.memoizedState=S),a.props=s,a.state=S,a.context=d,s=u):(typeof a.componentDidUpdate!="function"||l===e.memoizedProps&&f===e.memoizedState||(t.flags|=4),typeof a.getSnapshotBeforeUpdate!="function"||l===e.memoizedProps&&f===e.memoizedState||(t.flags|=1024),s=!1)}return ep(e,t,n,s,i,o)}function ep(e,t,n,s,o,i){Kx(e,t);var a=(t.flags&128)!==0;if(!s&&!a)return o&&im(t,n,!1),Fr(e,t,i);s=t.stateNode,US.current=t;var l=a&&typeof n.getDerivedStateFromError!="function"?null:s.render();return t.flags|=1,e!==null&&a?(t.child=Oo(t,e.child,null,i),t.child=Oo(t,null,l,i)):fn(e,t,l,i),t.memoizedState=s.state,o&&im(t,n,!0),t.child}function Qx(e){var t=e.stateNode;t.pendingContext?om(e,t.pendingContext,t.pendingContext!==t.context):t.context&&om(e,t.context,!1),Zp(e,t.containerInfo)}function wm(e,t,n,s,o){return Bo(),Yp(o),t.flags|=256,fn(e,t,n,s),t.child}var tp={dehydrated:null,treeContext:null,retryLane:0};function np(e){return{baseLanes:e,cachePool:null,transitions:null}}function Jx(e,t,n){var s=t.pendingProps,o=Et.current,i=!1,a=(t.flags&128)!==0,l;if((l=a)||(l=e!==null&&e.memoizedState===null?!1:(o&2)!==0),l?(i=!0,t.flags&=-129):(e===null||e.memoizedState!==null)&&(o|=1),mt(Et,o&1),e===null)return qu(t),e=t.memoizedState,e!==null&&(e=e.dehydrated,e!==null)?(t.mode&1?e.data==="$!"?t.lanes=8:t.lanes=1073741824:t.lanes=1,null):(a=s.children,e=s.fallback,i?(s=t.mode,i=t.child,a={mode:"hidden",children:a},!(s&1)&&i!==null?(i.childLanes=0,i.pendingProps=a):i=Nc(a,s,0,null),e=Bs(e,s,n,null),i.return=t,e.return=t,i.sibling=e,t.child=i,t.child.memoizedState=np(n),t.memoizedState=tp,e):lf(t,a));if(o=e.memoizedState,o!==null&&(l=o.dehydrated,l!==null))return GS(e,t,a,s,l,o,n);if(i){i=s.fallback,a=t.mode,o=e.child,l=o.sibling;var d={mode:"hidden",children:s.children};return!(a&1)&&t.child!==o?(s=t.child,s.childLanes=0,s.pendingProps=d,t.deletions=null):(s=ds(o,d),s.subtreeFlags=o.subtreeFlags&14680064),l!==null?i=ds(l,i):(i=Bs(i,a,n,null),i.flags|=2),i.return=t,s.return=t,s.sibling=i,t.child=s,s=i,i=t.child,a=e.child.memoizedState,a=a===null?np(n):{baseLanes:a.baseLanes|n,cachePool:null,transitions:a.transitions},i.memoizedState=a,i.childLanes=e.childLanes&~n,t.memoizedState=tp,s}return i=e.child,e=i.sibling,s=ds(i,{mode:"visible",children:s.children}),!(t.mode&1)&&(s.lanes=n),s.return=t,s.sibling=null,e!==null&&(n=t.deletions,n===null?(t.deletions=[e],t.flags|=16):n.push(e)),t.child=s,t.memoizedState=null,s}function lf(e,t){return t=Nc({mode:"visible",children:t},e.mode,0,null),t.return=e,e.child=t}function nl(e,t,n,s){return s!==null&&Yp(s),Oo(t,e.child,null,n),e=lf(t,t.pendingProps.children),e.flags|=2,t.memoizedState=null,e}function GS(e,t,n,s,o,i,a){if(n)return t.flags&256?(t.flags&=-257,s=Yd(Error(ue(422))),nl(e,t,a,s)):t.memoizedState!==null?(t.child=e.child,t.flags|=128,null):(i=s.fallback,o=t.mode,s=Nc({mode:"visible",children:s.children},o,0,null),i=Bs(i,o,a,null),i.flags|=2,s.return=t,i.return=t,s.sibling=i,t.child=s,t.mode&1&&Oo(t,e.child,null,a),t.child.memoizedState=np(a),t.memoizedState=tp,i);if(!(t.mode&1))return nl(e,t,a,null);if(o.data==="$!"){if(s=o.nextSibling&&o.nextSibling.dataset,s)var l=s.dgst;return s=l,i=Error(ue(419)),s=Yd(i,s,void 0),nl(e,t,a,s)}if(l=(a&e.childLanes)!==0,wn||l){if(s=Ft,s!==null){switch(a&-a){case 4:o=2;break;case 16:o=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:o=32;break;case 536870912:o=268435456;break;default:o=0}o=o&(s.suspendedLanes|a)?0:o,o!==0&&o!==i.retryLane&&(i.retryLane=o,Dr(e,o),lr(s,e,o,-1))}return mf(),s=Yd(Error(ue(421))),nl(e,t,a,s)}return o.data==="$?"?(t.flags|=128,t.child=e.child,t=s2.bind(null,e),o._reactRetry=t,null):(e=i.treeContext,Nn=is(o.nextSibling),Ln=t,wt=!0,ir=null,e!==null&&(Un[Gn++]=Lr,Un[Gn++]=$r,Un[Gn++]=Fs,Lr=e.id,$r=e.overflow,Fs=t),t=lf(t,s.children),t.flags|=4096,t)}function km(e,t,n){e.lanes|=t;var s=e.alternate;s!==null&&(s.lanes|=t),Ku(e.return,t,n)}function qd(e,t,n,s,o){var i=e.memoizedState;i===null?e.memoizedState={isBackwards:t,rendering:null,renderingStartTime:0,last:s,tail:n,tailMode:o}:(i.isBackwards=t,i.rendering=null,i.renderingStartTime=0,i.last=s,i.tail=n,i.tailMode=o)}function Xx(e,t,n){var s=t.pendingProps,o=s.revealOrder,i=s.tail;if(fn(e,t,s.children,n),s=Et.current,s&2)s=s&1|2,t.flags|=128;else{if(e!==null&&e.flags&128)e:for(e=t.child;e!==null;){if(e.tag===13)e.memoizedState!==null&&km(e,n,t);else if(e.tag===19)km(e,n,t);else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===t)break e;for(;e.sibling===null;){if(e.return===null||e.return===t)break e;e=e.return}e.sibling.return=e.return,e=e.sibling}s&=1}if(mt(Et,s),!(t.mode&1))t.memoizedState=null;else switch(o){case"forwards":for(n=t.child,o=null;n!==null;)e=n.alternate,e!==null&&nc(e)===null&&(o=n),n=n.sibling;n=o,n===null?(o=t.child,t.child=null):(o=n.sibling,n.sibling=null),qd(t,!1,o,n,i);break;case"backwards":for(n=null,o=t.child,t.child=null;o!==null;){if(e=o.alternate,e!==null&&nc(e)===null){t.child=o;break}e=o.sibling,o.sibling=n,n=o,o=e}qd(t,!0,n,null,i);break;case"together":qd(t,!1,null,null,void 0);break;default:t.memoizedState=null}return t.child}function Tl(e,t){!(t.mode&1)&&e!==null&&(e.alternate=null,t.alternate=null,t.flags|=2)}function Fr(e,t,n){if(e!==null&&(t.dependencies=e.dependencies),Ws|=t.lanes,!(n&t.childLanes))return null;if(e!==null&&t.child!==e.child)throw Error(ue(153));if(t.child!==null){for(e=t.child,n=ds(e,e.pendingProps),t.child=n,n.return=t;e.sibling!==null;)e=e.sibling,n=n.sibling=ds(e,e.pendingProps),n.return=t;n.sibling=null}return t.child}function VS(e,t,n){switch(t.tag){case 3:Qx(t),Bo();break;case 5:Ex(t);break;case 1:En(t.type)&&Ql(t);break;case 4:Zp(t,t.stateNode.containerInfo);break;case 10:var s=t.type._context,o=t.memoizedProps.value;mt(Zl,s._currentValue),s._currentValue=o;break;case 13:if(s=t.memoizedState,s!==null)return s.dehydrated!==null?(mt(Et,Et.current&1),t.flags|=128,null):n&t.child.childLanes?Jx(e,t,n):(mt(Et,Et.current&1),e=Fr(e,t,n),e!==null?e.sibling:null);mt(Et,Et.current&1);break;case 19:if(s=(n&t.childLanes)!==0,e.flags&128){if(s)return Xx(e,t,n);t.flags|=128}if(o=t.memoizedState,o!==null&&(o.rendering=null,o.tail=null,o.lastEffect=null),mt(Et,Et.current),s)break;return null;case 22:case 23:return t.lanes=0,qx(e,t,n)}return Fr(e,t,n)}var Zx,rp,ey,ty;Zx=function(e,t){for(var n=t.child;n!==null;){if(n.tag===5||n.tag===6)e.appendChild(n.stateNode);else if(n.tag!==4&&n.child!==null){n.child.return=n,n=n.child;continue}if(n===t)break;for(;n.sibling===null;){if(n.return===null||n.return===t)return;n=n.return}n.sibling.return=n.return,n=n.sibling}};rp=function(){};ey=function(e,t,n,s){var o=e.memoizedProps;if(o!==s){e=t.stateNode,Ls(kr.current);var i=null;switch(n){case"input":o=ju(e,o),s=ju(e,s),i=[];break;case"select":o=Ct({},o,{value:void 0}),s=Ct({},s,{value:void 0}),i=[];break;case"textarea":o=Iu(e,o),s=Iu(e,s),i=[];break;default:typeof o.onClick!="function"&&typeof s.onClick=="function"&&(e.onclick=ql)}Ru(n,s);var a;n=null;for(u in o)if(!s.hasOwnProperty(u)&&o.hasOwnProperty(u)&&o[u]!=null)if(u==="style"){var l=o[u];for(a in l)l.hasOwnProperty(a)&&(n||(n={}),n[a]="")}else u!=="dangerouslySetInnerHTML"&&u!=="children"&&u!=="suppressContentEditableWarning"&&u!=="suppressHydrationWarning"&&u!=="autoFocus"&&(Qi.hasOwnProperty(u)?i||(i=[]):(i=i||[]).push(u,null));for(u in s){var d=s[u];if(l=o!=null?o[u]:void 0,s.hasOwnProperty(u)&&d!==l&&(d!=null||l!=null))if(u==="style")if(l){for(a in l)!l.hasOwnProperty(a)||d&&d.hasOwnProperty(a)||(n||(n={}),n[a]="");for(a in d)d.hasOwnProperty(a)&&l[a]!==d[a]&&(n||(n={}),n[a]=d[a])}else n||(i||(i=[]),i.push(u,n)),n=d;else u==="dangerouslySetInnerHTML"?(d=d?d.__html:void 0,l=l?l.__html:void 0,d!=null&&l!==d&&(i=i||[]).push(u,d)):u==="children"?typeof d!="string"&&typeof d!="number"||(i=i||[]).push(u,""+d):u!=="suppressContentEditableWarning"&&u!=="suppressHydrationWarning"&&(Qi.hasOwnProperty(u)?(d!=null&&u==="onScroll"&&bt("scroll",e),i||l===d||(i=[])):(i=i||[]).push(u,d))}n&&(i=i||[]).push("style",n);var u=i;(t.updateQueue=u)&&(t.flags|=4)}};ty=function(e,t,n,s){n!==s&&(t.flags|=4)};function Ci(e,t){if(!wt)switch(e.tailMode){case"hidden":t=e.tail;for(var n=null;t!==null;)t.alternate!==null&&(n=t),t=t.sibling;n===null?e.tail=null:n.sibling=null;break;case"collapsed":n=e.tail;for(var s=null;n!==null;)n.alternate!==null&&(s=n),n=n.sibling;s===null?t||e.tail===null?e.tail=null:e.tail.sibling=null:s.sibling=null}}function rn(e){var t=e.alternate!==null&&e.alternate.child===e.child,n=0,s=0;if(t)for(var o=e.child;o!==null;)n|=o.lanes|o.childLanes,s|=o.subtreeFlags&14680064,s|=o.flags&14680064,o.return=e,o=o.sibling;else for(o=e.child;o!==null;)n|=o.lanes|o.childLanes,s|=o.subtreeFlags,s|=o.flags,o.return=e,o=o.sibling;return e.subtreeFlags|=s,e.childLanes=n,t}function YS(e,t,n){var s=t.pendingProps;switch(Vp(t),t.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return rn(t),null;case 1:return En(t.type)&&Kl(),rn(t),null;case 3:return s=t.stateNode,Po(),vt(kn),vt(ln),tf(),s.pendingContext&&(s.context=s.pendingContext,s.pendingContext=null),(e===null||e.child===null)&&(el(t)?t.flags|=4:e===null||e.memoizedState.isDehydrated&&!(t.flags&256)||(t.flags|=1024,ir!==null&&(up(ir),ir=null))),rp(e,t),rn(t),null;case 5:ef(t);var o=Ls(la.current);if(n=t.type,e!==null&&t.stateNode!=null)ey(e,t,n,s,o),e.ref!==t.ref&&(t.flags|=512,t.flags|=2097152);else{if(!s){if(t.stateNode===null)throw Error(ue(166));return rn(t),null}if(e=Ls(kr.current),el(t)){s=t.stateNode,n=t.type;var i=t.memoizedProps;switch(s[Sr]=t,s[ia]=i,e=(t.mode&1)!==0,n){case"dialog":bt("cancel",s),bt("close",s);break;case"iframe":case"object":case"embed":bt("load",s);break;case"video":case"audio":for(o=0;o<Oi.length;o++)bt(Oi[o],s);break;case"source":bt("error",s);break;case"img":case"image":case"link":bt("error",s),bt("load",s);break;case"details":bt("toggle",s);break;case"input":A0(s,i),bt("invalid",s);break;case"select":s._wrapperState={wasMultiple:!!i.multiple},bt("invalid",s);break;case"textarea":L0(s,i),bt("invalid",s)}Ru(n,i),o=null;for(var a in i)if(i.hasOwnProperty(a)){var l=i[a];a==="children"?typeof l=="string"?s.textContent!==l&&(i.suppressHydrationWarning!==!0&&Za(s.textContent,l,e),o=["children",l]):typeof l=="number"&&s.textContent!==""+l&&(i.suppressHydrationWarning!==!0&&Za(s.textContent,l,e),o=["children",""+l]):Qi.hasOwnProperty(a)&&l!=null&&a==="onScroll"&&bt("scroll",s)}switch(n){case"input":Ga(s),N0(s,i,!0);break;case"textarea":Ga(s),$0(s);break;case"select":case"option":break;default:typeof i.onClick=="function"&&(s.onclick=ql)}s=o,t.updateQueue=s,s!==null&&(t.flags|=4)}else{a=o.nodeType===9?o:o.ownerDocument,e==="http://www.w3.org/1999/xhtml"&&(e=_g(n)),e==="http://www.w3.org/1999/xhtml"?n==="script"?(e=a.createElement("div"),e.innerHTML="<script><\/script>",e=e.removeChild(e.firstChild)):typeof s.is=="string"?e=a.createElement(n,{is:s.is}):(e=a.createElement(n),n==="select"&&(a=e,s.multiple?a.multiple=!0:s.size&&(a.size=s.size))):e=a.createElementNS(e,n),e[Sr]=t,e[ia]=s,Zx(e,t,!1,!1),t.stateNode=e;e:{switch(a=Mu(n,s),n){case"dialog":bt("cancel",e),bt("close",e),o=s;break;case"iframe":case"object":case"embed":bt("load",e),o=s;break;case"video":case"audio":for(o=0;o<Oi.length;o++)bt(Oi[o],e);o=s;break;case"source":bt("error",e),o=s;break;case"img":case"image":case"link":bt("error",e),bt("load",e),o=s;break;case"details":bt("toggle",e),o=s;break;case"input":A0(e,s),o=ju(e,s),bt("invalid",e);break;case"option":o=s;break;case"select":e._wrapperState={wasMultiple:!!s.multiple},o=Ct({},s,{value:void 0}),bt("invalid",e);break;case"textarea":L0(e,s),o=Iu(e,s),bt("invalid",e);break;default:o=s}Ru(n,o),l=o;for(i in l)if(l.hasOwnProperty(i)){var d=l[i];i==="style"?Ag(e,d):i==="dangerouslySetInnerHTML"?(d=d?d.__html:void 0,d!=null&&Rg(e,d)):i==="children"?typeof d=="string"?(n!=="textarea"||d!=="")&&Ji(e,d):typeof d=="number"&&Ji(e,""+d):i!=="suppressContentEditableWarning"&&i!=="suppressHydrationWarning"&&i!=="autoFocus"&&(Qi.hasOwnProperty(i)?d!=null&&i==="onScroll"&&bt("scroll",e):d!=null&&Mp(e,i,d,a))}switch(n){case"input":Ga(e),N0(e,s,!1);break;case"textarea":Ga(e),$0(e);break;case"option":s.value!=null&&e.setAttribute("value",""+ps(s.value));break;case"select":e.multiple=!!s.multiple,i=s.value,i!=null?jo(e,!!s.multiple,i,!1):s.defaultValue!=null&&jo(e,!!s.multiple,s.defaultValue,!0);break;default:typeof o.onClick=="function"&&(e.onclick=ql)}switch(n){case"button":case"input":case"select":case"textarea":s=!!s.autoFocus;break e;case"img":s=!0;break e;default:s=!1}}s&&(t.flags|=4)}t.ref!==null&&(t.flags|=512,t.flags|=2097152)}return rn(t),null;case 6:if(e&&t.stateNode!=null)ty(e,t,e.memoizedProps,s);else{if(typeof s!="string"&&t.stateNode===null)throw Error(ue(166));if(n=Ls(la.current),Ls(kr.current),el(t)){if(s=t.stateNode,n=t.memoizedProps,s[Sr]=t,(i=s.nodeValue!==n)&&(e=Ln,e!==null))switch(e.tag){case 3:Za(s.nodeValue,n,(e.mode&1)!==0);break;case 5:e.memoizedProps.suppressHydrationWarning!==!0&&Za(s.nodeValue,n,(e.mode&1)!==0)}i&&(t.flags|=4)}else s=(n.nodeType===9?n:n.ownerDocument).createTextNode(s),s[Sr]=t,t.stateNode=s}return rn(t),null;case 13:if(vt(Et),s=t.memoizedState,e===null||e.memoizedState!==null&&e.memoizedState.dehydrated!==null){if(wt&&Nn!==null&&t.mode&1&&!(t.flags&128))bx(),Bo(),t.flags|=98560,i=!1;else if(i=el(t),s!==null&&s.dehydrated!==null){if(e===null){if(!i)throw Error(ue(318));if(i=t.memoizedState,i=i!==null?i.dehydrated:null,!i)throw Error(ue(317));i[Sr]=t}else Bo(),!(t.flags&128)&&(t.memoizedState=null),t.flags|=4;rn(t),i=!1}else ir!==null&&(up(ir),ir=null),i=!0;if(!i)return t.flags&65536?t:null}return t.flags&128?(t.lanes=n,t):(s=s!==null,s!==(e!==null&&e.memoizedState!==null)&&s&&(t.child.flags|=8192,t.mode&1&&(e===null||Et.current&1?Bt===0&&(Bt=3):mf())),t.updateQueue!==null&&(t.flags|=4),rn(t),null);case 4:return Po(),rp(e,t),e===null&&sa(t.stateNode.containerInfo),rn(t),null;case 10:return Qp(t.type._context),rn(t),null;case 17:return En(t.type)&&Kl(),rn(t),null;case 19:if(vt(Et),i=t.memoizedState,i===null)return rn(t),null;if(s=(t.flags&128)!==0,a=i.rendering,a===null)if(s)Ci(i,!1);else{if(Bt!==0||e!==null&&e.flags&128)for(e=t.child;e!==null;){if(a=nc(e),a!==null){for(t.flags|=128,Ci(i,!1),s=a.updateQueue,s!==null&&(t.updateQueue=s,t.flags|=4),t.subtreeFlags=0,s=n,n=t.child;n!==null;)i=n,e=s,i.flags&=14680066,a=i.alternate,a===null?(i.childLanes=0,i.lanes=e,i.child=null,i.subtreeFlags=0,i.memoizedProps=null,i.memoizedState=null,i.updateQueue=null,i.dependencies=null,i.stateNode=null):(i.childLanes=a.childLanes,i.lanes=a.lanes,i.child=a.child,i.subtreeFlags=0,i.deletions=null,i.memoizedProps=a.memoizedProps,i.memoizedState=a.memoizedState,i.updateQueue=a.updateQueue,i.type=a.type,e=a.dependencies,i.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext}),n=n.sibling;return mt(Et,Et.current&1|2),t.child}e=e.sibling}i.tail!==null&&Mt()>Do&&(t.flags|=128,s=!0,Ci(i,!1),t.lanes=4194304)}else{if(!s)if(e=nc(a),e!==null){if(t.flags|=128,s=!0,n=e.updateQueue,n!==null&&(t.updateQueue=n,t.flags|=4),Ci(i,!0),i.tail===null&&i.tailMode==="hidden"&&!a.alternate&&!wt)return rn(t),null}else 2*Mt()-i.renderingStartTime>Do&&n!==1073741824&&(t.flags|=128,s=!0,Ci(i,!1),t.lanes=4194304);i.isBackwards?(a.sibling=t.child,t.child=a):(n=i.last,n!==null?n.sibling=a:t.child=a,i.last=a)}return i.tail!==null?(t=i.tail,i.rendering=t,i.tail=t.sibling,i.renderingStartTime=Mt(),t.sibling=null,n=Et.current,mt(Et,s?n&1|2:n&1),t):(rn(t),null);case 22:case 23:return ff(),s=t.memoizedState!==null,e!==null&&e.memoizedState!==null!==s&&(t.flags|=8192),s&&t.mode&1?An&1073741824&&(rn(t),t.subtreeFlags&6&&(t.flags|=8192)):rn(t),null;case 24:return null;case 25:return null}throw Error(ue(156,t.tag))}function qS(e,t){switch(Vp(t),t.tag){case 1:return En(t.type)&&Kl(),e=t.flags,e&65536?(t.flags=e&-65537|128,t):null;case 3:return Po(),vt(kn),vt(ln),tf(),e=t.flags,e&65536&&!(e&128)?(t.flags=e&-65537|128,t):null;case 5:return ef(t),null;case 13:if(vt(Et),e=t.memoizedState,e!==null&&e.dehydrated!==null){if(t.alternate===null)throw Error(ue(340));Bo()}return e=t.flags,e&65536?(t.flags=e&-65537|128,t):null;case 19:return vt(Et),null;case 4:return Po(),null;case 10:return Qp(t.type._context),null;case 22:case 23:return ff(),null;case 24:return null;default:return null}}var rl=!1,an=!1,KS=typeof WeakSet=="function"?WeakSet:Set,Te=null;function wo(e,t){var n=e.ref;if(n!==null)if(typeof n=="function")try{n(null)}catch(s){It(e,t,s)}else n.current=null}function sp(e,t,n){try{n()}catch(s){It(e,t,s)}}var Em=!1;function QS(e,t){if(Fu=Gl,e=ix(),Up(e)){if("selectionStart"in e)var n={start:e.selectionStart,end:e.selectionEnd};else e:{n=(n=e.ownerDocument)&&n.defaultView||window;var s=n.getSelection&&n.getSelection();if(s&&s.rangeCount!==0){n=s.anchorNode;var o=s.anchorOffset,i=s.focusNode;s=s.focusOffset;try{n.nodeType,i.nodeType}catch{n=null;break e}var a=0,l=-1,d=-1,u=0,p=0,c=e,f=null;t:for(;;){for(var b;c!==n||o!==0&&c.nodeType!==3||(l=a+o),c!==i||s!==0&&c.nodeType!==3||(d=a+s),c.nodeType===3&&(a+=c.nodeValue.length),(b=c.firstChild)!==null;)f=c,c=b;for(;;){if(c===e)break t;if(f===n&&++u===o&&(l=a),f===i&&++p===s&&(d=a),(b=c.nextSibling)!==null)break;c=f,f=c.parentNode}c=b}n=l===-1||d===-1?null:{start:l,end:d}}else n=null}n=n||{start:0,end:0}}else n=null;for(Hu={focusedElem:e,selectionRange:n},Gl=!1,Te=t;Te!==null;)if(t=Te,e=t.child,(t.subtreeFlags&1028)!==0&&e!==null)e.return=t,Te=e;else for(;Te!==null;){t=Te;try{var S=t.alternate;if(t.flags&1024)switch(t.tag){case 0:case 11:case 15:break;case 1:if(S!==null){var E=S.memoizedProps,j=S.memoizedState,x=t.stateNode,h=x.getSnapshotBeforeUpdate(t.elementType===t.type?E:sr(t.type,E),j);x.__reactInternalSnapshotBeforeUpdate=h}break;case 3:var v=t.stateNode.containerInfo;v.nodeType===1?v.textContent="":v.nodeType===9&&v.documentElement&&v.removeChild(v.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(ue(163))}}catch(g){It(t,t.return,g)}if(e=t.sibling,e!==null){e.return=t.return,Te=e;break}Te=t.return}return S=Em,Em=!1,S}function Vi(e,t,n){var s=t.updateQueue;if(s=s!==null?s.lastEffect:null,s!==null){var o=s=s.next;do{if((o.tag&e)===e){var i=o.destroy;o.destroy=void 0,i!==void 0&&sp(t,n,i)}o=o.next}while(o!==s)}}function Mc(e,t){if(t=t.updateQueue,t=t!==null?t.lastEffect:null,t!==null){var n=t=t.next;do{if((n.tag&e)===e){var s=n.create;n.destroy=s()}n=n.next}while(n!==t)}}function op(e){var t=e.ref;if(t!==null){var n=e.stateNode;switch(e.tag){case 5:e=n;break;default:e=n}typeof t=="function"?t(e):t.current=e}}function ny(e){var t=e.alternate;t!==null&&(e.alternate=null,ny(t)),e.child=null,e.deletions=null,e.sibling=null,e.tag===5&&(t=e.stateNode,t!==null&&(delete t[Sr],delete t[ia],delete t[Gu],delete t[AS],delete t[NS])),e.stateNode=null,e.return=null,e.dependencies=null,e.memoizedProps=null,e.memoizedState=null,e.pendingProps=null,e.stateNode=null,e.updateQueue=null}function ry(e){return e.tag===5||e.tag===3||e.tag===4}function jm(e){e:for(;;){for(;e.sibling===null;){if(e.return===null||ry(e.return))return null;e=e.return}for(e.sibling.return=e.return,e=e.sibling;e.tag!==5&&e.tag!==6&&e.tag!==18;){if(e.flags&2||e.child===null||e.tag===4)continue e;e.child.return=e,e=e.child}if(!(e.flags&2))return e.stateNode}}function ip(e,t,n){var s=e.tag;if(s===5||s===6)e=e.stateNode,t?n.nodeType===8?n.parentNode.insertBefore(e,t):n.insertBefore(e,t):(n.nodeType===8?(t=n.parentNode,t.insertBefore(e,n)):(t=n,t.appendChild(e)),n=n._reactRootContainer,n!=null||t.onclick!==null||(t.onclick=ql));else if(s!==4&&(e=e.child,e!==null))for(ip(e,t,n),e=e.sibling;e!==null;)ip(e,t,n),e=e.sibling}function ap(e,t,n){var s=e.tag;if(s===5||s===6)e=e.stateNode,t?n.insertBefore(e,t):n.appendChild(e);else if(s!==4&&(e=e.child,e!==null))for(ap(e,t,n),e=e.sibling;e!==null;)ap(e,t,n),e=e.sibling}var Yt=null,or=!1;function Vr(e,t,n){for(n=n.child;n!==null;)sy(e,t,n),n=n.sibling}function sy(e,t,n){if(wr&&typeof wr.onCommitFiberUnmount=="function")try{wr.onCommitFiberUnmount(kc,n)}catch{}switch(n.tag){case 5:an||wo(n,t);case 6:var s=Yt,o=or;Yt=null,Vr(e,t,n),Yt=s,or=o,Yt!==null&&(or?(e=Yt,n=n.stateNode,e.nodeType===8?e.parentNode.removeChild(n):e.removeChild(n)):Yt.removeChild(n.stateNode));break;case 18:Yt!==null&&(or?(e=Yt,n=n.stateNode,e.nodeType===8?Fd(e.parentNode,n):e.nodeType===1&&Fd(e,n),ta(e)):Fd(Yt,n.stateNode));break;case 4:s=Yt,o=or,Yt=n.stateNode.containerInfo,or=!0,Vr(e,t,n),Yt=s,or=o;break;case 0:case 11:case 14:case 15:if(!an&&(s=n.updateQueue,s!==null&&(s=s.lastEffect,s!==null))){o=s=s.next;do{var i=o,a=i.destroy;i=i.tag,a!==void 0&&(i&2||i&4)&&sp(n,t,a),o=o.next}while(o!==s)}Vr(e,t,n);break;case 1:if(!an&&(wo(n,t),s=n.stateNode,typeof s.componentWillUnmount=="function"))try{s.props=n.memoizedProps,s.state=n.memoizedState,s.componentWillUnmount()}catch(l){It(n,t,l)}Vr(e,t,n);break;case 21:Vr(e,t,n);break;case 22:n.mode&1?(an=(s=an)||n.memoizedState!==null,Vr(e,t,n),an=s):Vr(e,t,n);break;default:Vr(e,t,n)}}function Cm(e){var t=e.updateQueue;if(t!==null){e.updateQueue=null;var n=e.stateNode;n===null&&(n=e.stateNode=new KS),t.forEach(function(s){var o=o2.bind(null,e,s);n.has(s)||(n.add(s),s.then(o,o))})}}function nr(e,t){var n=t.deletions;if(n!==null)for(var s=0;s<n.length;s++){var o=n[s];try{var i=e,a=t,l=a;e:for(;l!==null;){switch(l.tag){case 5:Yt=l.stateNode,or=!1;break e;case 3:Yt=l.stateNode.containerInfo,or=!0;break e;case 4:Yt=l.stateNode.containerInfo,or=!0;break e}l=l.return}if(Yt===null)throw Error(ue(160));sy(i,a,o),Yt=null,or=!1;var d=o.alternate;d!==null&&(d.return=null),o.return=null}catch(u){It(o,t,u)}}if(t.subtreeFlags&12854)for(t=t.child;t!==null;)oy(t,e),t=t.sibling}function oy(e,t){var n=e.alternate,s=e.flags;switch(e.tag){case 0:case 11:case 14:case 15:if(nr(t,e),mr(e),s&4){try{Vi(3,e,e.return),Mc(3,e)}catch(E){It(e,e.return,E)}try{Vi(5,e,e.return)}catch(E){It(e,e.return,E)}}break;case 1:nr(t,e),mr(e),s&512&&n!==null&&wo(n,n.return);break;case 5:if(nr(t,e),mr(e),s&512&&n!==null&&wo(n,n.return),e.flags&32){var o=e.stateNode;try{Ji(o,"")}catch(E){It(e,e.return,E)}}if(s&4&&(o=e.stateNode,o!=null)){var i=e.memoizedProps,a=n!==null?n.memoizedProps:i,l=e.type,d=e.updateQueue;if(e.updateQueue=null,d!==null)try{l==="input"&&i.type==="radio"&&i.name!=null&&Tg(o,i),Mu(l,a);var u=Mu(l,i);for(a=0;a<d.length;a+=2){var p=d[a],c=d[a+1];p==="style"?Ag(o,c):p==="dangerouslySetInnerHTML"?Rg(o,c):p==="children"?Ji(o,c):Mp(o,p,c,u)}switch(l){case"input":Cu(o,i);break;case"textarea":Ig(o,i);break;case"select":var f=o._wrapperState.wasMultiple;o._wrapperState.wasMultiple=!!i.multiple;var b=i.value;b!=null?jo(o,!!i.multiple,b,!1):f!==!!i.multiple&&(i.defaultValue!=null?jo(o,!!i.multiple,i.defaultValue,!0):jo(o,!!i.multiple,i.multiple?[]:"",!1))}o[ia]=i}catch(E){It(e,e.return,E)}}break;case 6:if(nr(t,e),mr(e),s&4){if(e.stateNode===null)throw Error(ue(162));o=e.stateNode,i=e.memoizedProps;try{o.nodeValue=i}catch(E){It(e,e.return,E)}}break;case 3:if(nr(t,e),mr(e),s&4&&n!==null&&n.memoizedState.isDehydrated)try{ta(t.containerInfo)}catch(E){It(e,e.return,E)}break;case 4:nr(t,e),mr(e);break;case 13:nr(t,e),mr(e),o=e.child,o.flags&8192&&(i=o.memoizedState!==null,o.stateNode.isHidden=i,!i||o.alternate!==null&&o.alternate.memoizedState!==null||(uf=Mt())),s&4&&Cm(e);break;case 22:if(p=n!==null&&n.memoizedState!==null,e.mode&1?(an=(u=an)||p,nr(t,e),an=u):nr(t,e),mr(e),s&8192){if(u=e.memoizedState!==null,(e.stateNode.isHidden=u)&&!p&&e.mode&1)for(Te=e,p=e.child;p!==null;){for(c=Te=p;Te!==null;){switch(f=Te,b=f.child,f.tag){case 0:case 11:case 14:case 15:Vi(4,f,f.return);break;case 1:wo(f,f.return);var S=f.stateNode;if(typeof S.componentWillUnmount=="function"){s=f,n=f.return;try{t=s,S.props=t.memoizedProps,S.state=t.memoizedState,S.componentWillUnmount()}catch(E){It(s,n,E)}}break;case 5:wo(f,f.return);break;case 22:if(f.memoizedState!==null){Im(c);continue}}b!==null?(b.return=f,Te=b):Im(c)}p=p.sibling}e:for(p=null,c=e;;){if(c.tag===5){if(p===null){p=c;try{o=c.stateNode,u?(i=o.style,typeof i.setProperty=="function"?i.setProperty("display","none","important"):i.display="none"):(l=c.stateNode,d=c.memoizedProps.style,a=d!=null&&d.hasOwnProperty("display")?d.display:null,l.style.display=Mg("display",a))}catch(E){It(e,e.return,E)}}}else if(c.tag===6){if(p===null)try{c.stateNode.nodeValue=u?"":c.memoizedProps}catch(E){It(e,e.return,E)}}else if((c.tag!==22&&c.tag!==23||c.memoizedState===null||c===e)&&c.child!==null){c.child.return=c,c=c.child;continue}if(c===e)break e;for(;c.sibling===null;){if(c.return===null||c.return===e)break e;p===c&&(p=null),c=c.return}p===c&&(p=null),c.sibling.return=c.return,c=c.sibling}}break;case 19:nr(t,e),mr(e),s&4&&Cm(e);break;case 21:break;default:nr(t,e),mr(e)}}function mr(e){var t=e.flags;if(t&2){try{e:{for(var n=e.return;n!==null;){if(ry(n)){var s=n;break e}n=n.return}throw Error(ue(160))}switch(s.tag){case 5:var o=s.stateNode;s.flags&32&&(Ji(o,""),s.flags&=-33);var i=jm(e);ap(e,i,o);break;case 3:case 4:var a=s.stateNode.containerInfo,l=jm(e);ip(e,l,a);break;default:throw Error(ue(161))}}catch(d){It(e,e.return,d)}e.flags&=-3}t&4096&&(e.flags&=-4097)}function JS(e,t,n){Te=e,iy(e)}function iy(e,t,n){for(var s=(e.mode&1)!==0;Te!==null;){var o=Te,i=o.child;if(o.tag===22&&s){var a=o.memoizedState!==null||rl;if(!a){var l=o.alternate,d=l!==null&&l.memoizedState!==null||an;l=rl;var u=an;if(rl=a,(an=d)&&!u)for(Te=o;Te!==null;)a=Te,d=a.child,a.tag===22&&a.memoizedState!==null?_m(o):d!==null?(d.return=a,Te=d):_m(o);for(;i!==null;)Te=i,iy(i),i=i.sibling;Te=o,rl=l,an=u}Tm(e)}else o.subtreeFlags&8772&&i!==null?(i.return=o,Te=i):Tm(e)}}function Tm(e){for(;Te!==null;){var t=Te;if(t.flags&8772){var n=t.alternate;try{if(t.flags&8772)switch(t.tag){case 0:case 11:case 15:an||Mc(5,t);break;case 1:var s=t.stateNode;if(t.flags&4&&!an)if(n===null)s.componentDidMount();else{var o=t.elementType===t.type?n.memoizedProps:sr(t.type,n.memoizedProps);s.componentDidUpdate(o,n.memoizedState,s.__reactInternalSnapshotBeforeUpdate)}var i=t.updateQueue;i!==null&&um(t,i,s);break;case 3:var a=t.updateQueue;if(a!==null){if(n=null,t.child!==null)switch(t.child.tag){case 5:n=t.child.stateNode;break;case 1:n=t.child.stateNode}um(t,a,n)}break;case 5:var l=t.stateNode;if(n===null&&t.flags&4){n=l;var d=t.memoizedProps;switch(t.type){case"button":case"input":case"select":case"textarea":d.autoFocus&&n.focus();break;case"img":d.src&&(n.src=d.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(t.memoizedState===null){var u=t.alternate;if(u!==null){var p=u.memoizedState;if(p!==null){var c=p.dehydrated;c!==null&&ta(c)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(ue(163))}an||t.flags&512&&op(t)}catch(f){It(t,t.return,f)}}if(t===e){Te=null;break}if(n=t.sibling,n!==null){n.return=t.return,Te=n;break}Te=t.return}}function Im(e){for(;Te!==null;){var t=Te;if(t===e){Te=null;break}var n=t.sibling;if(n!==null){n.return=t.return,Te=n;break}Te=t.return}}function _m(e){for(;Te!==null;){var t=Te;try{switch(t.tag){case 0:case 11:case 15:var n=t.return;try{Mc(4,t)}catch(d){It(t,n,d)}break;case 1:var s=t.stateNode;if(typeof s.componentDidMount=="function"){var o=t.return;try{s.componentDidMount()}catch(d){It(t,o,d)}}var i=t.return;try{op(t)}catch(d){It(t,i,d)}break;case 5:var a=t.return;try{op(t)}catch(d){It(t,a,d)}}}catch(d){It(t,t.return,d)}if(t===e){Te=null;break}var l=t.sibling;if(l!==null){l.return=t.return,Te=l;break}Te=t.return}}var XS=Math.ceil,oc=Wr.ReactCurrentDispatcher,cf=Wr.ReactCurrentOwner,Kn=Wr.ReactCurrentBatchConfig,nt=0,Ft=null,Nt=null,Kt=0,An=0,ko=gs(0),Bt=0,pa=null,Ws=0,Ac=0,df=0,Yi=null,Sn=null,uf=0,Do=1/0,Ar=null,ic=!1,lp=null,ls=null,sl=!1,ts=null,ac=0,qi=0,cp=null,Il=-1,_l=0;function mn(){return nt&6?Mt():Il!==-1?Il:Il=Mt()}function cs(e){return e.mode&1?nt&2&&Kt!==0?Kt&-Kt:$S.transition!==null?(_l===0&&(_l=Ug()),_l):(e=dt,e!==0||(e=window.event,e=e===void 0?16:Jg(e.type)),e):1}function lr(e,t,n,s){if(50<qi)throw qi=0,cp=null,Error(ue(185));xa(e,n,s),(!(nt&2)||e!==Ft)&&(e===Ft&&(!(nt&2)&&(Ac|=n),Bt===4&&Zr(e,Kt)),jn(e,s),n===1&&nt===0&&!(t.mode&1)&&(Do=Mt()+500,Ic&&xs()))}function jn(e,t){var n=e.callbackNode;$v(e,t);var s=Ul(e,e===Ft?Kt:0);if(s===0)n!==null&&P0(n),e.callbackNode=null,e.callbackPriority=0;else if(t=s&-s,e.callbackPriority!==t){if(n!=null&&P0(n),t===1)e.tag===0?LS(Rm.bind(null,e)):gx(Rm.bind(null,e)),RS(function(){!(nt&6)&&xs()}),n=null;else{switch(Gg(s)){case 1:n=Bp;break;case 4:n=Hg;break;case 16:n=Wl;break;case 536870912:n=Wg;break;default:n=Wl}n=my(n,ay.bind(null,e))}e.callbackPriority=t,e.callbackNode=n}}function ay(e,t){if(Il=-1,_l=0,nt&6)throw Error(ue(327));var n=e.callbackNode;if(Ro()&&e.callbackNode!==n)return null;var s=Ul(e,e===Ft?Kt:0);if(s===0)return null;if(s&30||s&e.expiredLanes||t)t=lc(e,s);else{t=s;var o=nt;nt|=2;var i=cy();(Ft!==e||Kt!==t)&&(Ar=null,Do=Mt()+500,$s(e,t));do try{t2();break}catch(l){ly(e,l)}while(!0);Kp(),oc.current=i,nt=o,Nt!==null?t=0:(Ft=null,Kt=0,t=Bt)}if(t!==0){if(t===2&&(o=Bu(e),o!==0&&(s=o,t=dp(e,o))),t===1)throw n=pa,$s(e,0),Zr(e,s),jn(e,Mt()),n;if(t===6)Zr(e,s);else{if(o=e.current.alternate,!(s&30)&&!ZS(o)&&(t=lc(e,s),t===2&&(i=Bu(e),i!==0&&(s=i,t=dp(e,i))),t===1))throw n=pa,$s(e,0),Zr(e,s),jn(e,Mt()),n;switch(e.finishedWork=o,e.finishedLanes=s,t){case 0:case 1:throw Error(ue(345));case 2:Ms(e,Sn,Ar);break;case 3:if(Zr(e,s),(s&130023424)===s&&(t=uf+500-Mt(),10<t)){if(Ul(e,0)!==0)break;if(o=e.suspendedLanes,(o&s)!==s){mn(),e.pingedLanes|=e.suspendedLanes&o;break}e.timeoutHandle=Uu(Ms.bind(null,e,Sn,Ar),t);break}Ms(e,Sn,Ar);break;case 4:if(Zr(e,s),(s&4194240)===s)break;for(t=e.eventTimes,o=-1;0<s;){var a=31-ar(s);i=1<<a,a=t[a],a>o&&(o=a),s&=~i}if(s=o,s=Mt()-s,s=(120>s?120:480>s?480:1080>s?1080:1920>s?1920:3e3>s?3e3:4320>s?4320:1960*XS(s/1960))-s,10<s){e.timeoutHandle=Uu(Ms.bind(null,e,Sn,Ar),s);break}Ms(e,Sn,Ar);break;case 5:Ms(e,Sn,Ar);break;default:throw Error(ue(329))}}}return jn(e,Mt()),e.callbackNode===n?ay.bind(null,e):null}function dp(e,t){var n=Yi;return e.current.memoizedState.isDehydrated&&($s(e,t).flags|=256),e=lc(e,t),e!==2&&(t=Sn,Sn=n,t!==null&&up(t)),e}function up(e){Sn===null?Sn=e:Sn.push.apply(Sn,e)}function ZS(e){for(var t=e;;){if(t.flags&16384){var n=t.updateQueue;if(n!==null&&(n=n.stores,n!==null))for(var s=0;s<n.length;s++){var o=n[s],i=o.getSnapshot;o=o.value;try{if(!cr(i(),o))return!1}catch{return!1}}}if(n=t.child,t.subtreeFlags&16384&&n!==null)n.return=t,t=n;else{if(t===e)break;for(;t.sibling===null;){if(t.return===null||t.return===e)return!0;t=t.return}t.sibling.return=t.return,t=t.sibling}}return!0}function Zr(e,t){for(t&=~df,t&=~Ac,e.suspendedLanes|=t,e.pingedLanes&=~t,e=e.expirationTimes;0<t;){var n=31-ar(t),s=1<<n;e[n]=-1,t&=~s}}function Rm(e){if(nt&6)throw Error(ue(327));Ro();var t=Ul(e,0);if(!(t&1))return jn(e,Mt()),null;var n=lc(e,t);if(e.tag!==0&&n===2){var s=Bu(e);s!==0&&(t=s,n=dp(e,s))}if(n===1)throw n=pa,$s(e,0),Zr(e,t),jn(e,Mt()),n;if(n===6)throw Error(ue(345));return e.finishedWork=e.current.alternate,e.finishedLanes=t,Ms(e,Sn,Ar),jn(e,Mt()),null}function pf(e,t){var n=nt;nt|=1;try{return e(t)}finally{nt=n,nt===0&&(Do=Mt()+500,Ic&&xs())}}function Us(e){ts!==null&&ts.tag===0&&!(nt&6)&&Ro();var t=nt;nt|=1;var n=Kn.transition,s=dt;try{if(Kn.transition=null,dt=1,e)return e()}finally{dt=s,Kn.transition=n,nt=t,!(nt&6)&&xs()}}function ff(){An=ko.current,vt(ko)}function $s(e,t){e.finishedWork=null,e.finishedLanes=0;var n=e.timeoutHandle;if(n!==-1&&(e.timeoutHandle=-1,_S(n)),Nt!==null)for(n=Nt.return;n!==null;){var s=n;switch(Vp(s),s.tag){case 1:s=s.type.childContextTypes,s!=null&&Kl();break;case 3:Po(),vt(kn),vt(ln),tf();break;case 5:ef(s);break;case 4:Po();break;case 13:vt(Et);break;case 19:vt(Et);break;case 10:Qp(s.type._context);break;case 22:case 23:ff()}n=n.return}if(Ft=e,Nt=e=ds(e.current,null),Kt=An=t,Bt=0,pa=null,df=Ac=Ws=0,Sn=Yi=null,Ns!==null){for(t=0;t<Ns.length;t++)if(n=Ns[t],s=n.interleaved,s!==null){n.interleaved=null;var o=s.next,i=n.pending;if(i!==null){var a=i.next;i.next=o,s.next=a}n.pending=s}Ns=null}return e}function ly(e,t){do{var n=Nt;try{if(Kp(),jl.current=sc,rc){for(var s=jt.memoizedState;s!==null;){var o=s.queue;o!==null&&(o.pending=null),s=s.next}rc=!1}if(Hs=0,Dt=Lt=jt=null,Gi=!1,ca=0,cf.current=null,n===null||n.return===null){Bt=1,pa=t,Nt=null;break}e:{var i=e,a=n.return,l=n,d=t;if(t=Kt,l.flags|=32768,d!==null&&typeof d=="object"&&typeof d.then=="function"){var u=d,p=l,c=p.tag;if(!(p.mode&1)&&(c===0||c===11||c===15)){var f=p.alternate;f?(p.updateQueue=f.updateQueue,p.memoizedState=f.memoizedState,p.lanes=f.lanes):(p.updateQueue=null,p.memoizedState=null)}var b=xm(a);if(b!==null){b.flags&=-257,ym(b,a,l,i,t),b.mode&1&&gm(i,u,t),t=b,d=u;var S=t.updateQueue;if(S===null){var E=new Set;E.add(d),t.updateQueue=E}else S.add(d);break e}else{if(!(t&1)){gm(i,u,t),mf();break e}d=Error(ue(426))}}else if(wt&&l.mode&1){var j=xm(a);if(j!==null){!(j.flags&65536)&&(j.flags|=256),ym(j,a,l,i,t),Yp(zo(d,l));break e}}i=d=zo(d,l),Bt!==4&&(Bt=2),Yi===null?Yi=[i]:Yi.push(i),i=a;do{switch(i.tag){case 3:i.flags|=65536,t&=-t,i.lanes|=t;var x=Gx(i,d,t);dm(i,x);break e;case 1:l=d;var h=i.type,v=i.stateNode;if(!(i.flags&128)&&(typeof h.getDerivedStateFromError=="function"||v!==null&&typeof v.componentDidCatch=="function"&&(ls===null||!ls.has(v)))){i.flags|=65536,t&=-t,i.lanes|=t;var g=Vx(i,l,t);dm(i,g);break e}}i=i.return}while(i!==null)}uy(n)}catch(I){t=I,Nt===n&&n!==null&&(Nt=n=n.return);continue}break}while(!0)}function cy(){var e=oc.current;return oc.current=sc,e===null?sc:e}function mf(){(Bt===0||Bt===3||Bt===2)&&(Bt=4),Ft===null||!(Ws&268435455)&&!(Ac&268435455)||Zr(Ft,Kt)}function lc(e,t){var n=nt;nt|=2;var s=cy();(Ft!==e||Kt!==t)&&(Ar=null,$s(e,t));do try{e2();break}catch(o){ly(e,o)}while(!0);if(Kp(),nt=n,oc.current=s,Nt!==null)throw Error(ue(261));return Ft=null,Kt=0,Bt}function e2(){for(;Nt!==null;)dy(Nt)}function t2(){for(;Nt!==null&&!Cv();)dy(Nt)}function dy(e){var t=fy(e.alternate,e,An);e.memoizedProps=e.pendingProps,t===null?uy(e):Nt=t,cf.current=null}function uy(e){var t=e;do{var n=t.alternate;if(e=t.return,t.flags&32768){if(n=qS(n,t),n!==null){n.flags&=32767,Nt=n;return}if(e!==null)e.flags|=32768,e.subtreeFlags=0,e.deletions=null;else{Bt=6,Nt=null;return}}else if(n=YS(n,t,An),n!==null){Nt=n;return}if(t=t.sibling,t!==null){Nt=t;return}Nt=t=e}while(t!==null);Bt===0&&(Bt=5)}function Ms(e,t,n){var s=dt,o=Kn.transition;try{Kn.transition=null,dt=1,n2(e,t,n,s)}finally{Kn.transition=o,dt=s}return null}function n2(e,t,n,s){do Ro();while(ts!==null);if(nt&6)throw Error(ue(327));n=e.finishedWork;var o=e.finishedLanes;if(n===null)return null;if(e.finishedWork=null,e.finishedLanes=0,n===e.current)throw Error(ue(177));e.callbackNode=null,e.callbackPriority=0;var i=n.lanes|n.childLanes;if(Bv(e,i),e===Ft&&(Nt=Ft=null,Kt=0),!(n.subtreeFlags&2064)&&!(n.flags&2064)||sl||(sl=!0,my(Wl,function(){return Ro(),null})),i=(n.flags&15990)!==0,n.subtreeFlags&15990||i){i=Kn.transition,Kn.transition=null;var a=dt;dt=1;var l=nt;nt|=4,cf.current=null,QS(e,n),oy(n,e),wS(Hu),Gl=!!Fu,Hu=Fu=null,e.current=n,JS(n),Tv(),nt=l,dt=a,Kn.transition=i}else e.current=n;if(sl&&(sl=!1,ts=e,ac=o),i=e.pendingLanes,i===0&&(ls=null),Rv(n.stateNode),jn(e,Mt()),t!==null)for(s=e.onRecoverableError,n=0;n<t.length;n++)o=t[n],s(o.value,{componentStack:o.stack,digest:o.digest});if(ic)throw ic=!1,e=lp,lp=null,e;return ac&1&&e.tag!==0&&Ro(),i=e.pendingLanes,i&1?e===cp?qi++:(qi=0,cp=e):qi=0,xs(),null}function Ro(){if(ts!==null){var e=Gg(ac),t=Kn.transition,n=dt;try{if(Kn.transition=null,dt=16>e?16:e,ts===null)var s=!1;else{if(e=ts,ts=null,ac=0,nt&6)throw Error(ue(331));var o=nt;for(nt|=4,Te=e.current;Te!==null;){var i=Te,a=i.child;if(Te.flags&16){var l=i.deletions;if(l!==null){for(var d=0;d<l.length;d++){var u=l[d];for(Te=u;Te!==null;){var p=Te;switch(p.tag){case 0:case 11:case 15:Vi(8,p,i)}var c=p.child;if(c!==null)c.return=p,Te=c;else for(;Te!==null;){p=Te;var f=p.sibling,b=p.return;if(ny(p),p===u){Te=null;break}if(f!==null){f.return=b,Te=f;break}Te=b}}}var S=i.alternate;if(S!==null){var E=S.child;if(E!==null){S.child=null;do{var j=E.sibling;E.sibling=null,E=j}while(E!==null)}}Te=i}}if(i.subtreeFlags&2064&&a!==null)a.return=i,Te=a;else e:for(;Te!==null;){if(i=Te,i.flags&2048)switch(i.tag){case 0:case 11:case 15:Vi(9,i,i.return)}var x=i.sibling;if(x!==null){x.return=i.return,Te=x;break e}Te=i.return}}var h=e.current;for(Te=h;Te!==null;){a=Te;var v=a.child;if(a.subtreeFlags&2064&&v!==null)v.return=a,Te=v;else e:for(a=h;Te!==null;){if(l=Te,l.flags&2048)try{switch(l.tag){case 0:case 11:case 15:Mc(9,l)}}catch(I){It(l,l.return,I)}if(l===a){Te=null;break e}var g=l.sibling;if(g!==null){g.return=l.return,Te=g;break e}Te=l.return}}if(nt=o,xs(),wr&&typeof wr.onPostCommitFiberRoot=="function")try{wr.onPostCommitFiberRoot(kc,e)}catch{}s=!0}return s}finally{dt=n,Kn.transition=t}}return!1}function Mm(e,t,n){t=zo(n,t),t=Gx(e,t,1),e=as(e,t,1),t=mn(),e!==null&&(xa(e,1,t),jn(e,t))}function It(e,t,n){if(e.tag===3)Mm(e,e,n);else for(;t!==null;){if(t.tag===3){Mm(t,e,n);break}else if(t.tag===1){var s=t.stateNode;if(typeof t.type.getDerivedStateFromError=="function"||typeof s.componentDidCatch=="function"&&(ls===null||!ls.has(s))){e=zo(n,e),e=Vx(t,e,1),t=as(t,e,1),e=mn(),t!==null&&(xa(t,1,e),jn(t,e));break}}t=t.return}}function r2(e,t,n){var s=e.pingCache;s!==null&&s.delete(t),t=mn(),e.pingedLanes|=e.suspendedLanes&n,Ft===e&&(Kt&n)===n&&(Bt===4||Bt===3&&(Kt&130023424)===Kt&&500>Mt()-uf?$s(e,0):df|=n),jn(e,t)}function py(e,t){t===0&&(e.mode&1?(t=qa,qa<<=1,!(qa&130023424)&&(qa=4194304)):t=1);var n=mn();e=Dr(e,t),e!==null&&(xa(e,t,n),jn(e,n))}function s2(e){var t=e.memoizedState,n=0;t!==null&&(n=t.retryLane),py(e,n)}function o2(e,t){var n=0;switch(e.tag){case 13:var s=e.stateNode,o=e.memoizedState;o!==null&&(n=o.retryLane);break;case 19:s=e.stateNode;break;default:throw Error(ue(314))}s!==null&&s.delete(t),py(e,n)}var fy;fy=function(e,t,n){if(e!==null)if(e.memoizedProps!==t.pendingProps||kn.current)wn=!0;else{if(!(e.lanes&n)&&!(t.flags&128))return wn=!1,VS(e,t,n);wn=!!(e.flags&131072)}else wn=!1,wt&&t.flags&1048576&&xx(t,Xl,t.index);switch(t.lanes=0,t.tag){case 2:var s=t.type;Tl(e,t),e=t.pendingProps;var o=$o(t,ln.current);_o(t,n),o=rf(null,t,s,e,o,n);var i=sf();return t.flags|=1,typeof o=="object"&&o!==null&&typeof o.render=="function"&&o.$$typeof===void 0?(t.tag=1,t.memoizedState=null,t.updateQueue=null,En(s)?(i=!0,Ql(t)):i=!1,t.memoizedState=o.state!==null&&o.state!==void 0?o.state:null,Xp(t),o.updater=Rc,t.stateNode=o,o._reactInternals=t,Ju(t,s,e,n),t=ep(null,t,s,!0,i,n)):(t.tag=0,wt&&i&&Gp(t),fn(null,t,o,n),t=t.child),t;case 16:s=t.elementType;e:{switch(Tl(e,t),e=t.pendingProps,o=s._init,s=o(s._payload),t.type=s,o=t.tag=a2(s),e=sr(s,e),o){case 0:t=Zu(null,t,s,e,n);break e;case 1:t=Sm(null,t,s,e,n);break e;case 11:t=bm(null,t,s,e,n);break e;case 14:t=vm(null,t,s,sr(s.type,e),n);break e}throw Error(ue(306,s,""))}return t;case 0:return s=t.type,o=t.pendingProps,o=t.elementType===s?o:sr(s,o),Zu(e,t,s,o,n);case 1:return s=t.type,o=t.pendingProps,o=t.elementType===s?o:sr(s,o),Sm(e,t,s,o,n);case 3:e:{if(Qx(t),e===null)throw Error(ue(387));s=t.pendingProps,i=t.memoizedState,o=i.element,kx(e,t),tc(t,s,null,n);var a=t.memoizedState;if(s=a.element,i.isDehydrated)if(i={element:s,isDehydrated:!1,cache:a.cache,pendingSuspenseBoundaries:a.pendingSuspenseBoundaries,transitions:a.transitions},t.updateQueue.baseState=i,t.memoizedState=i,t.flags&256){o=zo(Error(ue(423)),t),t=wm(e,t,s,n,o);break e}else if(s!==o){o=zo(Error(ue(424)),t),t=wm(e,t,s,n,o);break e}else for(Nn=is(t.stateNode.containerInfo.firstChild),Ln=t,wt=!0,ir=null,n=Sx(t,null,s,n),t.child=n;n;)n.flags=n.flags&-3|4096,n=n.sibling;else{if(Bo(),s===o){t=Fr(e,t,n);break e}fn(e,t,s,n)}t=t.child}return t;case 5:return Ex(t),e===null&&qu(t),s=t.type,o=t.pendingProps,i=e!==null?e.memoizedProps:null,a=o.children,Wu(s,o)?a=null:i!==null&&Wu(s,i)&&(t.flags|=32),Kx(e,t),fn(e,t,a,n),t.child;case 6:return e===null&&qu(t),null;case 13:return Jx(e,t,n);case 4:return Zp(t,t.stateNode.containerInfo),s=t.pendingProps,e===null?t.child=Oo(t,null,s,n):fn(e,t,s,n),t.child;case 11:return s=t.type,o=t.pendingProps,o=t.elementType===s?o:sr(s,o),bm(e,t,s,o,n);case 7:return fn(e,t,t.pendingProps,n),t.child;case 8:return fn(e,t,t.pendingProps.children,n),t.child;case 12:return fn(e,t,t.pendingProps.children,n),t.child;case 10:e:{if(s=t.type._context,o=t.pendingProps,i=t.memoizedProps,a=o.value,mt(Zl,s._currentValue),s._currentValue=a,i!==null)if(cr(i.value,a)){if(i.children===o.children&&!kn.current){t=Fr(e,t,n);break e}}else for(i=t.child,i!==null&&(i.return=t);i!==null;){var l=i.dependencies;if(l!==null){a=i.child;for(var d=l.firstContext;d!==null;){if(d.context===s){if(i.tag===1){d=Or(-1,n&-n),d.tag=2;var u=i.updateQueue;if(u!==null){u=u.shared;var p=u.pending;p===null?d.next=d:(d.next=p.next,p.next=d),u.pending=d}}i.lanes|=n,d=i.alternate,d!==null&&(d.lanes|=n),Ku(i.return,n,t),l.lanes|=n;break}d=d.next}}else if(i.tag===10)a=i.type===t.type?null:i.child;else if(i.tag===18){if(a=i.return,a===null)throw Error(ue(341));a.lanes|=n,l=a.alternate,l!==null&&(l.lanes|=n),Ku(a,n,t),a=i.sibling}else a=i.child;if(a!==null)a.return=i;else for(a=i;a!==null;){if(a===t){a=null;break}if(i=a.sibling,i!==null){i.return=a.return,a=i;break}a=a.return}i=a}fn(e,t,o.children,n),t=t.child}return t;case 9:return o=t.type,s=t.pendingProps.children,_o(t,n),o=Qn(o),s=s(o),t.flags|=1,fn(e,t,s,n),t.child;case 14:return s=t.type,o=sr(s,t.pendingProps),o=sr(s.type,o),vm(e,t,s,o,n);case 15:return Yx(e,t,t.type,t.pendingProps,n);case 17:return s=t.type,o=t.pendingProps,o=t.elementType===s?o:sr(s,o),Tl(e,t),t.tag=1,En(s)?(e=!0,Ql(t)):e=!1,_o(t,n),Ux(t,s,o),Ju(t,s,o,n),ep(null,t,s,!0,e,n);case 19:return Xx(e,t,n);case 22:return qx(e,t,n)}throw Error(ue(156,t.tag))};function my(e,t){return Fg(e,t)}function i2(e,t,n,s){this.tag=e,this.key=n,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=t,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=s,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function qn(e,t,n,s){return new i2(e,t,n,s)}function hf(e){return e=e.prototype,!(!e||!e.isReactComponent)}function a2(e){if(typeof e=="function")return hf(e)?1:0;if(e!=null){if(e=e.$$typeof,e===Np)return 11;if(e===Lp)return 14}return 2}function ds(e,t){var n=e.alternate;return n===null?(n=qn(e.tag,t,e.key,e.mode),n.elementType=e.elementType,n.type=e.type,n.stateNode=e.stateNode,n.alternate=e,e.alternate=n):(n.pendingProps=t,n.type=e.type,n.flags=0,n.subtreeFlags=0,n.deletions=null),n.flags=e.flags&14680064,n.childLanes=e.childLanes,n.lanes=e.lanes,n.child=e.child,n.memoizedProps=e.memoizedProps,n.memoizedState=e.memoizedState,n.updateQueue=e.updateQueue,t=e.dependencies,n.dependencies=t===null?null:{lanes:t.lanes,firstContext:t.firstContext},n.sibling=e.sibling,n.index=e.index,n.ref=e.ref,n}function Rl(e,t,n,s,o,i){var a=2;if(s=e,typeof e=="function")hf(e)&&(a=1);else if(typeof e=="string")a=5;else e:switch(e){case fo:return Bs(n.children,o,i,t);case Ap:a=8,o|=8;break;case Su:return e=qn(12,n,t,o|2),e.elementType=Su,e.lanes=i,e;case wu:return e=qn(13,n,t,o),e.elementType=wu,e.lanes=i,e;case ku:return e=qn(19,n,t,o),e.elementType=ku,e.lanes=i,e;case Eg:return Nc(n,o,i,t);default:if(typeof e=="object"&&e!==null)switch(e.$$typeof){case wg:a=10;break e;case kg:a=9;break e;case Np:a=11;break e;case Lp:a=14;break e;case Kr:a=16,s=null;break e}throw Error(ue(130,e==null?e:typeof e,""))}return t=qn(a,n,t,o),t.elementType=e,t.type=s,t.lanes=i,t}function Bs(e,t,n,s){return e=qn(7,e,s,t),e.lanes=n,e}function Nc(e,t,n,s){return e=qn(22,e,s,t),e.elementType=Eg,e.lanes=n,e.stateNode={isHidden:!1},e}function Kd(e,t,n){return e=qn(6,e,null,t),e.lanes=n,e}function Qd(e,t,n){return t=qn(4,e.children!==null?e.children:[],e.key,t),t.lanes=n,t.stateNode={containerInfo:e.containerInfo,pendingChildren:null,implementation:e.implementation},t}function l2(e,t,n,s,o){this.tag=t,this.containerInfo=e,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=Rd(0),this.expirationTimes=Rd(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Rd(0),this.identifierPrefix=s,this.onRecoverableError=o,this.mutableSourceEagerHydrationData=null}function gf(e,t,n,s,o,i,a,l,d){return e=new l2(e,t,n,l,d),t===1?(t=1,i===!0&&(t|=8)):t=0,i=qn(3,null,null,t),e.current=i,i.stateNode=e,i.memoizedState={element:s,isDehydrated:n,cache:null,transitions:null,pendingSuspenseBoundaries:null},Xp(i),e}function c2(e,t,n){var s=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:po,key:s==null?null:""+s,children:e,containerInfo:t,implementation:n}}function hy(e){if(!e)return fs;e=e._reactInternals;e:{if(qs(e)!==e||e.tag!==1)throw Error(ue(170));var t=e;do{switch(t.tag){case 3:t=t.stateNode.context;break e;case 1:if(En(t.type)){t=t.stateNode.__reactInternalMemoizedMergedChildContext;break e}}t=t.return}while(t!==null);throw Error(ue(171))}if(e.tag===1){var n=e.type;if(En(n))return hx(e,n,t)}return t}function gy(e,t,n,s,o,i,a,l,d){return e=gf(n,s,!0,e,o,i,a,l,d),e.context=hy(null),n=e.current,s=mn(),o=cs(n),i=Or(s,o),i.callback=t??null,as(n,i,o),e.current.lanes=o,xa(e,o,s),jn(e,s),e}function Lc(e,t,n,s){var o=t.current,i=mn(),a=cs(o);return n=hy(n),t.context===null?t.context=n:t.pendingContext=n,t=Or(i,a),t.payload={element:e},s=s===void 0?null:s,s!==null&&(t.callback=s),e=as(o,t,a),e!==null&&(lr(e,o,a,i),El(e,o,a)),a}function cc(e){if(e=e.current,!e.child)return null;switch(e.child.tag){case 5:return e.child.stateNode;default:return e.child.stateNode}}function Am(e,t){if(e=e.memoizedState,e!==null&&e.dehydrated!==null){var n=e.retryLane;e.retryLane=n!==0&&n<t?n:t}}function xf(e,t){Am(e,t),(e=e.alternate)&&Am(e,t)}function d2(){return null}var xy=typeof reportError=="function"?reportError:function(e){console.error(e)};function yf(e){this._internalRoot=e}$c.prototype.render=yf.prototype.render=function(e){var t=this._internalRoot;if(t===null)throw Error(ue(409));Lc(e,t,null,null)};$c.prototype.unmount=yf.prototype.unmount=function(){var e=this._internalRoot;if(e!==null){this._internalRoot=null;var t=e.containerInfo;Us(function(){Lc(null,e,null,null)}),t[zr]=null}};function $c(e){this._internalRoot=e}$c.prototype.unstable_scheduleHydration=function(e){if(e){var t=qg();e={blockedOn:null,target:e,priority:t};for(var n=0;n<Xr.length&&t!==0&&t<Xr[n].priority;n++);Xr.splice(n,0,e),n===0&&Qg(e)}};function bf(e){return!(!e||e.nodeType!==1&&e.nodeType!==9&&e.nodeType!==11)}function Bc(e){return!(!e||e.nodeType!==1&&e.nodeType!==9&&e.nodeType!==11&&(e.nodeType!==8||e.nodeValue!==" react-mount-point-unstable "))}function Nm(){}function u2(e,t,n,s,o){if(o){if(typeof s=="function"){var i=s;s=function(){var u=cc(a);i.call(u)}}var a=gy(t,s,e,0,null,!1,!1,"",Nm);return e._reactRootContainer=a,e[zr]=a.current,sa(e.nodeType===8?e.parentNode:e),Us(),a}for(;o=e.lastChild;)e.removeChild(o);if(typeof s=="function"){var l=s;s=function(){var u=cc(d);l.call(u)}}var d=gf(e,0,!1,null,null,!1,!1,"",Nm);return e._reactRootContainer=d,e[zr]=d.current,sa(e.nodeType===8?e.parentNode:e),Us(function(){Lc(t,d,n,s)}),d}function Oc(e,t,n,s,o){var i=n._reactRootContainer;if(i){var a=i;if(typeof o=="function"){var l=o;o=function(){var d=cc(a);l.call(d)}}Lc(t,a,e,o)}else a=u2(n,t,e,o,s);return cc(a)}Vg=function(e){switch(e.tag){case 3:var t=e.stateNode;if(t.current.memoizedState.isDehydrated){var n=Bi(t.pendingLanes);n!==0&&(Op(t,n|1),jn(t,Mt()),!(nt&6)&&(Do=Mt()+500,xs()))}break;case 13:Us(function(){var s=Dr(e,1);if(s!==null){var o=mn();lr(s,e,1,o)}}),xf(e,1)}};Pp=function(e){if(e.tag===13){var t=Dr(e,134217728);if(t!==null){var n=mn();lr(t,e,134217728,n)}xf(e,134217728)}};Yg=function(e){if(e.tag===13){var t=cs(e),n=Dr(e,t);if(n!==null){var s=mn();lr(n,e,t,s)}xf(e,t)}};qg=function(){return dt};Kg=function(e,t){var n=dt;try{return dt=e,t()}finally{dt=n}};Nu=function(e,t,n){switch(t){case"input":if(Cu(e,n),t=n.name,n.type==="radio"&&t!=null){for(n=e;n.parentNode;)n=n.parentNode;for(n=n.querySelectorAll("input[name="+JSON.stringify(""+t)+'][type="radio"]'),t=0;t<n.length;t++){var s=n[t];if(s!==e&&s.form===e.form){var o=Tc(s);if(!o)throw Error(ue(90));Cg(s),Cu(s,o)}}}break;case"textarea":Ig(e,n);break;case"select":t=n.value,t!=null&&jo(e,!!n.multiple,t,!1)}};$g=pf;Bg=Us;var p2={usingClientEntryPoint:!1,Events:[ba,xo,Tc,Ng,Lg,pf]},Ti={findFiberByHostInstance:As,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},f2={bundleType:Ti.bundleType,version:Ti.version,rendererPackageName:Ti.rendererPackageName,rendererConfig:Ti.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:Wr.ReactCurrentDispatcher,findHostInstanceByFiber:function(e){return e=zg(e),e===null?null:e.stateNode},findFiberByHostInstance:Ti.findFiberByHostInstance||d2,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var ol=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!ol.isDisabled&&ol.supportsFiber)try{kc=ol.inject(f2),wr=ol}catch{}}Bn.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=p2;Bn.createPortal=function(e,t){var n=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!bf(t))throw Error(ue(200));return c2(e,t,null,n)};Bn.createRoot=function(e,t){if(!bf(e))throw Error(ue(299));var n=!1,s="",o=xy;return t!=null&&(t.unstable_strictMode===!0&&(n=!0),t.identifierPrefix!==void 0&&(s=t.identifierPrefix),t.onRecoverableError!==void 0&&(o=t.onRecoverableError)),t=gf(e,1,!1,null,null,n,!1,s,o),e[zr]=t.current,sa(e.nodeType===8?e.parentNode:e),new yf(t)};Bn.findDOMNode=function(e){if(e==null)return null;if(e.nodeType===1)return e;var t=e._reactInternals;if(t===void 0)throw typeof e.render=="function"?Error(ue(188)):(e=Object.keys(e).join(","),Error(ue(268,e)));return e=zg(t),e=e===null?null:e.stateNode,e};Bn.flushSync=function(e){return Us(e)};Bn.hydrate=function(e,t,n){if(!Bc(t))throw Error(ue(200));return Oc(null,e,t,!0,n)};Bn.hydrateRoot=function(e,t,n){if(!bf(e))throw Error(ue(405));var s=n!=null&&n.hydratedSources||null,o=!1,i="",a=xy;if(n!=null&&(n.unstable_strictMode===!0&&(o=!0),n.identifierPrefix!==void 0&&(i=n.identifierPrefix),n.onRecoverableError!==void 0&&(a=n.onRecoverableError)),t=gy(t,null,e,1,n??null,o,!1,i,a),e[zr]=t.current,sa(e),s)for(e=0;e<s.length;e++)n=s[e],o=n._getVersion,o=o(n._source),t.mutableSourceEagerHydrationData==null?t.mutableSourceEagerHydrationData=[n,o]:t.mutableSourceEagerHydrationData.push(n,o);return new $c(t)};Bn.render=function(e,t,n){if(!Bc(t))throw Error(ue(200));return Oc(null,e,t,!1,n)};Bn.unmountComponentAtNode=function(e){if(!Bc(e))throw Error(ue(40));return e._reactRootContainer?(Us(function(){Oc(null,null,e,!1,function(){e._reactRootContainer=null,e[zr]=null})}),!0):!1};Bn.unstable_batchedUpdates=pf;Bn.unstable_renderSubtreeIntoContainer=function(e,t,n,s){if(!Bc(n))throw Error(ue(200));if(e==null||e._reactInternals===void 0)throw Error(ue(38));return Oc(e,t,n,!1,s)};Bn.version="18.3.1-next-f1338f8080-20240426";function yy(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(yy)}catch(e){console.error(e)}}yy(),yg.exports=Bn;var m2=yg.exports,Lm=m2;bu.createRoot=Lm.createRoot,bu.hydrateRoot=Lm.hydrateRoot;const h2="modulepreload",g2=function(e,t){return new URL(e,t).href},$m={},x2=function(t,n,s){let o=Promise.resolve();if(n&&n.length>0){const a=document.getElementsByTagName("link"),l=document.querySelector("meta[property=csp-nonce]"),d=(l==null?void 0:l.nonce)||(l==null?void 0:l.getAttribute("nonce"));o=Promise.allSettled(n.map(u=>{if(u=g2(u,s),u in $m)return;$m[u]=!0;const p=u.endsWith(".css"),c=p?'[rel="stylesheet"]':"";if(!!s)for(let S=a.length-1;S>=0;S--){const E=a[S];if(E.href===u&&(!p||E.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${u}"]${c}`))return;const b=document.createElement("link");if(b.rel=p?"stylesheet":h2,p||(b.as="script"),b.crossOrigin="",b.href=u,d&&b.setAttribute("nonce",d),document.head.appendChild(b),p)return new Promise((S,E)=>{b.addEventListener("load",S),b.addEventListener("error",()=>E(new Error(`Unable to preload CSS for ${u}`)))})}))}function i(a){const l=new Event("vite:preloadError",{cancelable:!0});if(l.payload=a,window.dispatchEvent(l),!l.defaultPrevented)throw a}return o.then(a=>{for(const l of a||[])l.status==="rejected"&&i(l.reason);return t().catch(i)})},Se={colors:{background:"#F8F3EE",paper:"#F4EEE6",ink:"#2E2B26",primary:"#6B513A",accent:"#7AA893",muted:"#A59786",parchment:"#EDE3D6",border:"#B8A895",shadow:"rgba(34,28,22,0.12)"},gradients:{subtle:"linear-gradient(135deg, rgba(255,255,255,0.6), rgba(240,235,230,0.6))",warm:"linear-gradient(135deg, #EDE3D6 0%, #F4EEE6 100%)"},sizes:{navHeight:"56px"}},Bm={appContainer:{display:"flex",flexDirection:"column",height:"100vh",fontFamily:"'Noto Serif SC', serif",backgroundColor:Se.colors.background,backgroundImage:"linear-gradient(rgba(245, 240, 232, 0.6), rgba(245, 240, 232, 0.6))",backgroundSize:"100% 100%"},mainContent:{flex:1,padding:"15px",paddingBottom:"70px",overflowY:"auto"}};function y2(){const[e,t]=y.useState({type:null,data:null}),[n,s]=y.useState(!1),[o,i]=y.useState(!1),[a,l]=y.useState(!1),[d,u]=y.useState(!1),[p,c]=y.useState(!1),[f,b]=y.useState(!1),[S,E]=y.useState({open:!1,npc:null}),[j,x]=y.useState({open:!1,mode:"VIEW",slot:null,childId:null}),[h,v]=y.useState(!1),[g,I]=y.useState(!1),[_,C]=y.useState(!1),[k,R]=y.useState(!1),T=y.useCallback((ke,je=null)=>{t({type:ke,data:je})},[]),N=y.useCallback(()=>{t({type:null,data:null})},[]),Y=y.useCallback(()=>s(!0),[]),H=y.useCallback(()=>s(!1),[]),B=y.useCallback(()=>i(!0),[]),$=y.useCallback(()=>i(!1),[]),q=y.useCallback(()=>l(!0),[]),se=y.useCallback(()=>l(!1),[]),J=y.useCallback(()=>u(!0),[]),X=y.useCallback(()=>u(!1),[]),re=y.useCallback(()=>c(!0),[]),ye=y.useCallback(()=>c(!1),[]),Re=y.useCallback(()=>b(!0),[]),Fe=y.useCallback(()=>b(!1),[]),O=y.useCallback(ke=>{E({open:!0,npc:ke})},[]),ie=y.useCallback(()=>{E({open:!1,npc:null})},[]),le=y.useCallback((ke="VIEW",je=null,Ge=null)=>{x({open:!0,mode:ke,slot:je,childId:Ge})},[]),ee=y.useCallback(()=>{x({open:!1,mode:"VIEW",slot:null,childId:null})},[]),he=y.useCallback(()=>v(!0),[]),Ee=y.useCallback(()=>v(!1),[]),_e=y.useCallback(()=>I(!0),[]),rt=y.useCallback(()=>I(!1),[]),At=y.useCallback(()=>C(!0),[]),Oe=y.useCallback(()=>C(!1),[]),P=y.useCallback(()=>R(!0),[]),pe=y.useCallback(()=>R(!1),[]),fe=y.useCallback(()=>{N(),s(!1),i(!1),l(!1),u(!1),c(!1),b(!1),E({open:!1,npc:null}),x({open:!1,mode:"VIEW",slot:null,childId:null}),v(!1),I(!1),C(!1),R(!1)},[N]);return y.useMemo(()=>({modalState:e,openModal:T,closeModal:N,showGazette:n,setShowGazette:s,openGazette:Y,closeGazette:H,showMessageCenter:o,setShowMessageCenter:i,openMessageCenter:B,closeMessageCenter:$,showGuide:a,setShowGuide:l,openGuide:q,closeGuide:se,showTutorial:d,setShowTutorial:u,openTutorial:J,closeTutorial:X,showBizPanel:p,setShowBizPanel:c,openBizPanel:re,closeBizPanel:ye,showChallengePanel:f,setShowChallengePanel:b,openChallengePanel:Re,closeChallengePanel:Fe,npcLogModal:S,setNpcLogModal:E,openNpcLog:O,closeNpcLog:ie,inventoryModal:j,showBatchGiftModal:h,setShowBatchGiftModal:v,openBatchGiftModal:he,closeBatchGiftModal:Ee,showBatchPromotionModal:g,setShowBatchPromotionModal:I,openBatchPromotionModal:_e,closeBatchPromotionModal:rt,showBatchMarriageModal:_,setShowBatchMarriageModal:C,openBatchMarriageModal:At,closeBatchMarriageModal:Oe,showBatchManualModal:k,setShowBatchManualModal:R,openBatchManualModal:P,closeBatchManualModal:pe,openInventory:le,closeInventory:ee,closeAllModals:fe}),[e,n,o,a,d,p,f,S,j,h,g,_,k])}const ft={PLAYER:"player",CHILD:"child",NPC:"npc"},by=[ft.PLAYER,ft.CHILD,ft.NPC],Q={MORTAL:{key:"MORTAL",label:"",color:"#a1887f",order:1,desc:""},SPIRIT:{key:"SPIRIT",label:"",color:"#00897b",order:2,desc:""},EARTH:{key:"EARTH",label:"",color:"#7cb342",order:3,desc:""},HEAVEN:{key:"HEAVEN",label:"",color:"#5e35b1",order:4,desc:""},DIVINE:{key:"DIVINE",label:"",color:"#ffa000",order:5,desc:""}},ve={GENERAL:{id:"GENERAL"},ELEMENTAL:{id:"ELEMENTAL"},VARIANT:{id:"VARIANT"},DUAL:{id:"DUAL"},DEVIL:{id:"DEVIL"}},il={SABER:{id:"SABER"},SPEAR:{id:"SPEAR"},RELIC:{id:"RELIC"}},st={BODY:{id:"BODY"},FOUNDATION:{id:"FOUNDATION"},CORE:{id:"CORE"},NASCENT:{id:"NASCENT"},ASCENSION:{id:"ASCENSION"}},b2={[ft.PLAYER]:"",[ft.CHILD]:"",[ft.NPC]:""},al=()=>[...by],ce=()=>[ft.PLAYER,ft.CHILD],v2=()=>[ft.CHILD],Pc={herb_bandage:{id:"herb_bandage",name:"",type:"consumable",rarity:"common",desc:"",effect:{kind:"heal",amount:100},resourceCategory:"PILL",resourceLevel:Q.MORTAL.key,pillTier:st.BODY.id,usageTargets:al(),tags:["",""]},rice_ball:{id:"rice_ball",name:"",type:"consumable",rarity:"common",desc:"",effect:{kind:"heal",amount:60},resourceCategory:"PILL",resourceLevel:Q.MORTAL.key,pillTier:st.BODY.id,usageTargets:al(),tags:["",""]},iron_sword:{id:"iron_sword",name:"",type:"weapon",slot:"weapon",rarity:"common",desc:"",stats:{atk:25},resourceCategory:"WEAPON",resourceLevel:Q.MORTAL.key,weaponClass:il.SABER.id,usageTargets:ce(),tags:["",""]},beast_fang:{id:"beast_fang",name:"",type:"accessory",slot:"accessory",rarity:"uncommon",desc:"",stats:{atk:35},resourceCategory:"ACCESSORY",resourceLevel:Q.SPIRIT.key,usageTargets:ce(),tags:["",""]},beast_core:{id:"beast_core",name:"",type:"consumable",rarity:"uncommon",desc:"",effect:{kind:"exp",amount:1200},resourceCategory:"PILL",resourceLevel:Q.MORTAL.key,pillTier:st.BODY.id,usageTargets:al(),tags:["",""]},foundation_pill:{id:"foundation_pill",name:"",type:"consumable",rarity:"rare",desc:"",effect:{kind:"exp",amount:4e3},resourceCategory:"PILL",resourceLevel:Q.SPIRIT.key,pillTier:st.FOUNDATION.id,usageTargets:ce(),tags:["",""]},thunder_wood:{id:"thunder_wood",name:"",type:"accessory",slot:"accessory",rarity:"rare",desc:"",stats:{atk:60,mp:200},resourceCategory:"ACCESSORY",resourceLevel:Q.SPIRIT.key,usageTargets:ce(),tags:["",""]},iron_armor:{id:"iron_armor",name:"",type:"armor",slot:"armor",rarity:"rare",desc:"",stats:{hp:600},resourceCategory:"ARMOR",resourceLevel:Q.SPIRIT.key,usageTargets:ce(),tags:["",""]},core_pill:{id:"core_pill",name:"",type:"consumable",rarity:"epic",desc:"",effect:{kind:"exp",amount:9e3},resourceCategory:"PILL",resourceLevel:Q.EARTH.key,pillTier:st.CORE.id,usageTargets:ce(),tags:["",""]},artifact_supreme:{id:"artifact_supreme",name:"",type:"weapon",slot:"weapon",rarity:"epic",desc:"",stats:{atk:180,hp:300},resourceCategory:"WEAPON",resourceLevel:Q.HEAVEN.key,weaponClass:il.RELIC.id,usageTargets:ce(),tags:["","",""]},milk_millennium:{id:"milk_millennium",name:"",type:"consumable",rarity:"epic",desc:"",effect:{kind:"heal",amount:500},resourceCategory:"PILL",resourceLevel:Q.EARTH.key,pillTier:st.FOUNDATION.id,usageTargets:al(),tags:["",""]},marrow_wash:{id:"marrow_wash",name:"",type:"consumable",rarity:"epic",desc:"",effect:{kind:"aptitude",amount:2},resourceCategory:"PILL",resourceLevel:Q.EARTH.key,pillTier:st.FOUNDATION.id,usageTargets:ce(),tags:["",""]},nascent_fruit:{id:"nascent_fruit",name:"",type:"consumable",rarity:"legendary",desc:"",effect:{kind:"exp",amount:2e4},resourceCategory:"PILL",resourceLevel:Q.HEAVEN.key,pillTier:st.NASCENT.id,usageTargets:ce(),tags:["",""]},heaven_manual:{id:"heaven_manual",name:"",type:"accessory",slot:"accessory",rarity:"legendary",desc:"",stats:{mp:800,atk:120},resourceCategory:"ACCESSORY",resourceLevel:Q.HEAVEN.key,usageTargets:ce(),tags:["","",""]},divine_egg:{id:"divine_egg",name:"",type:"armor",slot:"armor",rarity:"legendary",desc:"",stats:{hp:1200},resourceCategory:"ARMOR",resourceLevel:Q.HEAVEN.key,usageTargets:ce(),tags:["",""]},moonshadow_saber:{id:"moonshadow_saber",name:"",type:"weapon",slot:"weapon",rarity:"epic",desc:"",stats:{atk:160,mp:60},resourceCategory:"WEAPON",resourceLevel:Q.EARTH.key,weaponClass:il.SABER.id,usageTargets:ce(),tags:["",""]},storm_piercer:{id:"storm_piercer",name:"",type:"weapon",slot:"weapon",rarity:"legendary",desc:"",stats:{atk:190,mp:120,hp:200},resourceCategory:"WEAPON",resourceLevel:Q.HEAVEN.key,weaponClass:il.SPEAR.id,usageTargets:ce(),tags:["",""]},meridian_pill:{id:"meridian_pill",name:"",type:"consumable",rarity:"uncommon",desc:"",effect:{kind:"exp",amount:1500},resourceCategory:"PILL",resourceLevel:Q.MORTAL.key,pillTier:st.BODY.id,usageTargets:v2(),tags:["",""]},dragon_heart_pill:{id:"dragon_heart_pill",name:"",type:"consumable",rarity:"epic",desc:"",effect:{kind:"exp",amount:12e3},resourceCategory:"PILL",resourceLevel:Q.EARTH.key,pillTier:st.CORE.id,usageTargets:ce(),tags:["",""]},communication_pill:{id:"communication_pill",name:"",type:"consumable",rarity:"uncommon",desc:"",effect:{kind:"intelligence",amount:2},resourceCategory:"PILL",resourceLevel:Q.MORTAL.key,pillTier:st.FOUNDATION.id,usageTargets:ce(),tags:["",""]},awakening_pill:{id:"awakening_pill",name:"",type:"consumable",rarity:"epic",desc:"",effect:{kind:"intelligence",amount:5},resourceCategory:"PILL",resourceLevel:Q.SPIRIT.key,pillTier:st.FOUNDATION.id,usageTargets:ce(),tags:["",""]},wisdom_pill:{id:"wisdom_pill",name:"",type:"consumable",rarity:"legendary",desc:"",effect:{kind:"intelligence",amount:8},resourceCategory:"PILL",resourceLevel:Q.EARTH.key,pillTier:st.CORE.id,usageTargets:ce(),tags:["",""]},starlight_pill:{id:"starlight_pill",name:"",type:"consumable",rarity:"legendary",desc:"",effect:{kind:"intelligence",amount:18},resourceCategory:"PILL",resourceLevel:Q.HEAVEN.key,pillTier:st.ASCENSION.id,usageTargets:ce(),tags:["","",""]},god_transformation_pill:{id:"god_transformation_pill",name:"",type:"consumable",rarity:"mythic",desc:"",effect:{kind:"exp",amount:3e5},resourceCategory:"PILL",resourceLevel:Q.DIVINE.key,pillTier:st.ASCENSION.id,usageTargets:ce(),tags:["","",""]},divine_soul_pill:{id:"divine_soul_pill",name:"",type:"consumable",rarity:"mythic",desc:"",effect:{kind:"exp",amount:5e5},resourceCategory:"PILL",resourceLevel:Q.DIVINE.key,pillTier:st.ASCENSION.id,usageTargets:ce(),tags:["","",""]},void_condensing_pill:{id:"void_condensing_pill",name:"",type:"consumable",rarity:"mythic",desc:"",effect:{kind:"exp",amount:8e5},resourceCategory:"PILL",resourceLevel:Q.DIVINE.key,pillTier:st.ASCENSION.id,usageTargets:ce(),tags:["","",""]},immortal_marrow_pill:{id:"immortal_marrow_pill",name:"",type:"consumable",rarity:"mythic",desc:"",effect:{kind:"aptitude",amount:8},resourceCategory:"PILL",resourceLevel:Q.DIVINE.key,pillTier:st.ASCENSION.id,usageTargets:ce(),tags:["","",""]},heaven_defying_pill:{id:"heaven_defying_pill",name:"",type:"consumable",rarity:"mythic",desc:"",effect:{kind:"exp",amount:1e6},resourceCategory:"PILL",resourceLevel:Q.DIVINE.key,pillTier:st.ASCENSION.id,usageTargets:ce(),tags:["","",""]},void_refining_pill:{id:"void_refining_pill",name:"",type:"consumable",rarity:"mythic",desc:"",effect:{kind:"exp",amount:2e6},resourceCategory:"PILL",resourceLevel:Q.DIVINE.key,pillTier:st.ASCENSION.id,usageTargets:ce(),tags:["","",""]},space_law_pill:{id:"space_law_pill",name:"",type:"consumable",rarity:"mythic",desc:"",effect:{kind:"exp",amount:3e6},resourceCategory:"PILL",resourceLevel:Q.DIVINE.key,pillTier:st.ASCENSION.id,usageTargets:ce(),tags:["","",""]},void_stabilization_pill:{id:"void_stabilization_pill",name:"",type:"consumable",rarity:"mythic",desc:"",effect:{kind:"exp",amount:5e6},resourceCategory:"PILL",resourceLevel:Q.DIVINE.key,pillTier:st.ASCENSION.id,usageTargets:ce(),tags:["","",""]},unity_pill:{id:"unity_pill",name:"",type:"consumable",rarity:"mythic",desc:"",effect:{kind:"exp",amount:8e6},resourceCategory:"PILL",resourceLevel:Q.DIVINE.key,pillTier:st.ASCENSION.id,usageTargets:ce(),tags:["","",""]},dao_comprehension_pill:{id:"dao_comprehension_pill",name:"",type:"consumable",rarity:"mythic",desc:"",effect:{kind:"exp",amount:12e6},resourceCategory:"PILL",resourceLevel:Q.DIVINE.key,pillTier:st.ASCENSION.id,usageTargets:ce(),tags:["","",""]},harmony_pill:{id:"harmony_pill",name:"",type:"consumable",rarity:"mythic",desc:"",effect:{kind:"exp",amount:18e6},resourceCategory:"PILL",resourceLevel:Q.DIVINE.key,pillTier:st.ASCENSION.id,usageTargets:ce(),tags:["","",""]},mahayana_pill:{id:"mahayana_pill",name:"",type:"consumable",rarity:"mythic",desc:"",effect:{kind:"exp",amount:3e7},resourceCategory:"PILL",resourceLevel:Q.DIVINE.key,pillTier:st.ASCENSION.id,usageTargets:ce(),tags:["","",""]},immortal_foundation_pill:{id:"immortal_foundation_pill",name:"",type:"consumable",rarity:"mythic",desc:"",effect:{kind:"exp",amount:5e7},resourceCategory:"PILL",resourceLevel:Q.DIVINE.key,pillTier:st.ASCENSION.id,usageTargets:ce(),tags:["","",""]},semi_immortal_pill:{id:"semi_immortal_pill",name:"",type:"consumable",rarity:"mythic",desc:"",effect:{kind:"exp",amount:8e7},resourceCategory:"PILL",resourceLevel:Q.DIVINE.key,pillTier:st.ASCENSION.id,usageTargets:ce(),tags:["","",""]},tribulation_pill:{id:"tribulation_pill",name:"",type:"consumable",rarity:"mythic",desc:"",effect:{kind:"exp",amount:1e8},resourceCategory:"PILL",resourceLevel:Q.DIVINE.key,pillTier:st.ASCENSION.id,usageTargets:ce(),tags:["","",""]},anti_tribulation_pill:{id:"anti_tribulation_pill",name:"",type:"consumable",rarity:"mythic",desc:"",effect:{kind:"heal",amount:5e4},resourceCategory:"PILL",resourceLevel:Q.DIVINE.key,pillTier:st.ASCENSION.id,usageTargets:ce(),tags:["","",""]},ascension_pill:{id:"ascension_pill",name:"",type:"consumable",rarity:"mythic",desc:"",effect:{kind:"exp",amount:2e8},resourceCategory:"PILL",resourceLevel:Q.DIVINE.key,pillTier:st.ASCENSION.id,usageTargets:ce(),tags:["","",""]},basic_manual:{id:"basic_manual",name:"",type:"manual",rarity:"common",tier:"",tierColor:"#D4AF37",element:"",baseBonus:"+20%",desc:"",manualIds:["basic_breath","cloud_breath"],resourceCategory:"MANUAL",resourceLevel:Q.MORTAL.key,manualSchool:ve.GENERAL.id,usageTargets:ce(),tags:["",""]},advanced_manual:{id:"advanced_manual",name:"",type:"manual",rarity:"rare",tier:"",tierColor:"#4A4A4A",element:"",baseBonus:"+50%",desc:"",manualIds:["azure_sword_art","water_flow","fire_control","mountain_body"],resourceCategory:"MANUAL",resourceLevel:Q.SPIRIT.key,manualSchool:ve.ELEMENTAL.id,usageTargets:ce(),tags:["",""]},expert_manual:{id:"expert_manual",name:"",type:"manual",rarity:"epic",tier:"",tierColor:"#8B4513",element:"",baseBonus:"+100%",desc:"",manualIds:["yin_yang_harmony","five_elements_supreme"],resourceCategory:"MANUAL",resourceLevel:Q.EARTH.key,manualSchool:ve.DUAL.id,usageTargets:ce(),tags:["",""]},yin_yang_harmony_manual:{id:"yin_yang_harmony_manual",name:"",type:"manual",rarity:"rare",tier:"",tierColor:"#4A4A4A",element:"",baseBonus:"+60%",desc:"",manualIds:["yin_yang_harmony"],resourceCategory:"MANUAL",resourceLevel:Q.SPIRIT.key,manualSchool:ve.DUAL.id,usageTargets:ce(),tags:["",""]},blood_demon_manual:{id:"blood_demon_manual",name:"",type:"manual",rarity:"epic",tier:"",tierColor:"#8B4513",element:"",baseBonus:"+120%",desc:"",manualIds:["blood_demon"],resourceCategory:"MANUAL",resourceLevel:Q.EARTH.key,manualSchool:ve.DEVIL.id,usageTargets:ce(),tags:["",""]},chaos_origin_manual:{id:"chaos_origin_manual",name:"",type:"manual",rarity:"legendary",tier:"",tierColor:"#6A5ACD",element:"",baseBonus:"+220%",desc:"",manualIds:["chaos_origin"],resourceCategory:"MANUAL",resourceLevel:Q.HEAVEN.key,manualSchool:ve.GENERAL.id,usageTargets:ce(),tags:["",""]},five_elements_supreme_manual:{id:"five_elements_supreme_manual",name:"",type:"manual",rarity:"legendary",tier:"",tierColor:"#6A5ACD",element:"",baseBonus:"+220%",desc:"",manualIds:["five_elements_supreme"],resourceCategory:"MANUAL",resourceLevel:Q.HEAVEN.key,manualSchool:ve.ELEMENTAL.id,usageTargets:ce(),tags:["",""]},emperor_scripture_manual:{id:"emperor_scripture_manual",name:"",type:"manual",rarity:"legendary",tier:"",tierColor:"#6A5ACD",element:"",baseBonus:"+240%",desc:"",manualIds:["emperor_scripture"],resourceCategory:"MANUAL",resourceLevel:Q.HEAVEN.key,manualSchool:ve.GENERAL.id,usageTargets:ce(),tags:["",""]},deep_ocean_scripture_manual:{id:"deep_ocean_scripture_manual",name:"",type:"manual",rarity:"epic",tier:"",tierColor:"#8B4513",element:"",baseBonus:"+140%",desc:"",manualIds:["deep_ocean_scripture"],resourceCategory:"MANUAL",resourceLevel:Q.EARTH.key,manualSchool:ve.ELEMENTAL.id,usageTargets:ce(),tags:["",""]},gold_manual_1:{id:"gold_manual_1",name:"",type:"manual",rarity:"common",tier:"",tierColor:"#FFD700",element:"",baseBonus:"+20%",desc:"",manualIds:["golden_light"],resourceCategory:"MANUAL",resourceLevel:Q.MORTAL.key,manualSchool:ve.ELEMENTAL.id,usageTargets:ce(),tags:["",""]},gold_manual_2:{id:"gold_manual_2",name:"",type:"manual",rarity:"uncommon",tier:"",tierColor:"#FFD700",element:"",baseBonus:"+50%",desc:"",manualIds:["azure_sword_art"],resourceCategory:"MANUAL",resourceLevel:Q.SPIRIT.key,manualSchool:ve.ELEMENTAL.id,usageTargets:ce(),tags:["",""]},gold_manual_3:{id:"gold_manual_3",name:"",type:"manual",rarity:"rare",tier:"",tierColor:"#FFD700",element:"",baseBonus:"+100%",desc:"",manualIds:["golden_light","azure_sword_art"],resourceCategory:"MANUAL",resourceLevel:Q.EARTH.key,manualSchool:ve.ELEMENTAL.id,usageTargets:ce(),tags:["",""]},gold_manual_4:{id:"gold_manual_4",name:"",type:"manual",rarity:"epic",tier:"",tierColor:"#FFD700",element:"",baseBonus:"+100%",desc:"",manualIds:["azure_sword_art"],resourceCategory:"MANUAL",resourceLevel:Q.EARTH.key,manualSchool:ve.ELEMENTAL.id,usageTargets:ce(),tags:["",""]},gold_manual_5:{id:"gold_manual_5",name:"",type:"manual",rarity:"legendary",tier:"",tierColor:"#FFD700",element:"",baseBonus:"+200%",desc:"",manualIds:["azure_sword_art"],resourceCategory:"MANUAL",resourceLevel:Q.HEAVEN.key,manualSchool:ve.ELEMENTAL.id,usageTargets:ce(),tags:["",""]},wood_manual_1:{id:"wood_manual_1",name:"",type:"manual",rarity:"common",tier:"",tierColor:"#228B22",element:"",baseBonus:"+20%",desc:"",manualIds:["evergreen_art"],resourceCategory:"MANUAL",resourceLevel:Q.MORTAL.key,manualSchool:ve.ELEMENTAL.id,usageTargets:ce(),tags:["",""]},wood_manual_2:{id:"wood_manual_2",name:"",type:"manual",rarity:"uncommon",tier:"",tierColor:"#228B22",element:"",baseBonus:"+50%",desc:"",manualIds:["spring_birth"],resourceCategory:"MANUAL",resourceLevel:Q.SPIRIT.key,manualSchool:ve.ELEMENTAL.id,usageTargets:ce(),tags:["",""]},wood_manual_3:{id:"wood_manual_3",name:"",type:"manual",rarity:"rare",tier:"",tierColor:"#228B22",element:"",baseBonus:"+100%",desc:"",manualIds:["evergreen_art","spring_birth"],resourceCategory:"MANUAL",resourceLevel:Q.EARTH.key,manualSchool:ve.ELEMENTAL.id,usageTargets:ce(),tags:["",""]},wood_manual_4:{id:"wood_manual_4",name:"",type:"manual",rarity:"epic",tier:"",tierColor:"#228B22",element:"",baseBonus:"+100%",desc:"",manualIds:["spring_birth"],resourceCategory:"MANUAL",resourceLevel:Q.EARTH.key,manualSchool:ve.ELEMENTAL.id,usageTargets:ce(),tags:["",""]},wood_manual_5:{id:"wood_manual_5",name:"",type:"manual",rarity:"legendary",tier:"",tierColor:"#228B22",element:"",baseBonus:"+200%",desc:"",manualIds:["spring_birth"],resourceCategory:"MANUAL",resourceLevel:Q.HEAVEN.key,manualSchool:ve.ELEMENTAL.id,usageTargets:ce(),tags:["",""]},water_manual_1:{id:"water_manual_1",name:"",type:"manual",rarity:"common",tier:"",tierColor:"#4169E1",element:"",baseBonus:"+20%",desc:"",manualIds:["water_flow"],resourceCategory:"MANUAL",resourceLevel:Q.MORTAL.key,manualSchool:ve.ELEMENTAL.id,usageTargets:ce(),tags:["",""]},water_manual_2:{id:"water_manual_2",name:"",type:"manual",rarity:"uncommon",tier:"",tierColor:"#4169E1",element:"",baseBonus:"+50%",desc:"",manualIds:["ocean_heart"],resourceCategory:"MANUAL",resourceLevel:Q.SPIRIT.key,manualSchool:ve.ELEMENTAL.id,usageTargets:ce(),tags:["",""]},water_manual_3:{id:"water_manual_3",name:"",type:"manual",rarity:"rare",tier:"",tierColor:"#4169E1",element:"",baseBonus:"+100%",desc:"",manualIds:["water_flow","ocean_heart"],resourceCategory:"MANUAL",resourceLevel:Q.EARTH.key,manualSchool:ve.ELEMENTAL.id,usageTargets:ce(),tags:["",""]},water_manual_4:{id:"water_manual_4",name:"",type:"manual",rarity:"epic",tier:"",tierColor:"#4169E1",element:"",baseBonus:"+100%",desc:"",manualIds:["ocean_heart"],resourceCategory:"MANUAL",resourceLevel:Q.EARTH.key,manualSchool:ve.ELEMENTAL.id,usageTargets:ce(),tags:["",""]},water_manual_5:{id:"water_manual_5",name:"",type:"manual",rarity:"legendary",tier:"",tierColor:"#4169E1",element:"",baseBonus:"+200%",desc:"",manualIds:["ocean_heart"],resourceCategory:"MANUAL",resourceLevel:Q.HEAVEN.key,manualSchool:ve.ELEMENTAL.id,usageTargets:ce(),tags:["",""]},fire_manual_1:{id:"fire_manual_1",name:"",type:"manual",rarity:"common",tier:"",tierColor:"#FF6347",element:"",baseBonus:"+20%",desc:"",manualIds:["basic_breath"],resourceCategory:"MANUAL",resourceLevel:Q.MORTAL.key,manualSchool:ve.ELEMENTAL.id,usageTargets:ce(),tags:["",""]},fire_manual_2:{id:"fire_manual_2",name:"",type:"manual",rarity:"uncommon",tier:"",tierColor:"#FF6347",element:"",baseBonus:"+50%",desc:"",manualIds:["fire_control"],resourceCategory:"MANUAL",resourceLevel:Q.SPIRIT.key,manualSchool:ve.ELEMENTAL.id,usageTargets:ce(),tags:["",""]},fire_manual_3:{id:"fire_manual_3",name:"",type:"manual",rarity:"rare",tier:"",tierColor:"#FF6347",element:"",baseBonus:"+100%",desc:"",manualIds:["nine_turns_fire"],resourceCategory:"MANUAL",resourceLevel:Q.EARTH.key,manualSchool:ve.ELEMENTAL.id,usageTargets:ce(),tags:["",""]},fire_manual_4:{id:"fire_manual_4",name:"",type:"manual",rarity:"epic",tier:"",tierColor:"#FF6347",element:"",baseBonus:"+100%",desc:"",manualIds:["vermillion_bird"],resourceCategory:"MANUAL",resourceLevel:Q.EARTH.key,manualSchool:ve.ELEMENTAL.id,usageTargets:ce(),tags:["",""]},fire_manual_5:{id:"fire_manual_5",name:"",type:"manual",rarity:"legendary",tier:"",tierColor:"#FF6347",element:"",baseBonus:"+200%",desc:"",manualIds:["nine_turns_fire","vermillion_bird"],resourceCategory:"MANUAL",resourceLevel:Q.HEAVEN.key,manualSchool:ve.ELEMENTAL.id,usageTargets:ce(),tags:["",""]},earth_manual_1:{id:"earth_manual_1",name:"",type:"manual",rarity:"common",tier:"",tierColor:"#8B4513",element:"",baseBonus:"+20%",desc:"",manualIds:["earth_shield"],resourceCategory:"MANUAL",resourceLevel:Q.MORTAL.key,manualSchool:ve.ELEMENTAL.id,usageTargets:ce(),tags:["",""]},earth_manual_2:{id:"earth_manual_2",name:"",type:"manual",rarity:"uncommon",tier:"",tierColor:"#8B4513",element:"",baseBonus:"+50%",desc:"",manualIds:["mountain_body"],resourceCategory:"MANUAL",resourceLevel:Q.SPIRIT.key,manualSchool:ve.ELEMENTAL.id,usageTargets:ce(),tags:["",""]},earth_manual_3:{id:"earth_manual_3",name:"",type:"manual",rarity:"rare",tier:"",tierColor:"#8B4513",element:"",baseBonus:"+100%",desc:"",manualIds:["earth_shield","mountain_body"],resourceCategory:"MANUAL",resourceLevel:Q.EARTH.key,manualSchool:ve.ELEMENTAL.id,usageTargets:ce(),tags:["",""]},earth_manual_4:{id:"earth_manual_4",name:"",type:"manual",rarity:"epic",tier:"",tierColor:"#8B4513",element:"",baseBonus:"+100%",desc:"",manualIds:["mountain_body"],resourceCategory:"MANUAL",resourceLevel:Q.EARTH.key,manualSchool:ve.ELEMENTAL.id,usageTargets:ce(),tags:["",""]},earth_manual_5:{id:"earth_manual_5",name:"",type:"manual",rarity:"legendary",tier:"",tierColor:"#8B4513",element:"",baseBonus:"+200%",desc:"",manualIds:["mountain_body"],resourceCategory:"MANUAL",resourceLevel:Q.HEAVEN.key,manualSchool:ve.ELEMENTAL.id,usageTargets:ce(),tags:["",""]},thunder_manual_1:{id:"thunder_manual_1",name:"",type:"manual",rarity:"uncommon",tier:"",tierColor:"#9B30FF",element:"",baseBonus:"+50%",desc:"",manualIds:["basic_breath"],resourceCategory:"MANUAL",resourceLevel:Q.SPIRIT.key,manualSchool:ve.VARIANT.id,usageTargets:ce(),tags:["",""]},thunder_manual_2:{id:"thunder_manual_2",name:"",type:"manual",rarity:"rare",tier:"",tierColor:"#9B30FF",element:"",baseBonus:"+100%",desc:"",manualIds:["basic_breath"],resourceCategory:"MANUAL",resourceLevel:Q.EARTH.key,manualSchool:ve.VARIANT.id,usageTargets:ce(),tags:["",""]},thunder_manual_3:{id:"thunder_manual_3",name:"",type:"manual",rarity:"epic",tier:"",tierColor:"#9B30FF",element:"",baseBonus:"+100%",desc:"",manualIds:["basic_breath"],resourceCategory:"MANUAL",resourceLevel:Q.EARTH.key,manualSchool:ve.VARIANT.id,usageTargets:ce(),tags:["",""]},thunder_manual_4:{id:"thunder_manual_4",name:"",type:"manual",rarity:"epic",tier:"",tierColor:"#9B30FF",element:"",baseBonus:"+200%",desc:"",manualIds:["thunder_guide"],resourceCategory:"MANUAL",resourceLevel:Q.EARTH.key,manualSchool:ve.VARIANT.id,usageTargets:ce(),tags:["",""]},thunder_manual_5:{id:"thunder_manual_5",name:"",type:"manual",rarity:"legendary",tier:"",tierColor:"#9B30FF",element:"",baseBonus:"+200%",desc:"",manualIds:["thunder_guide","heavenly_demon"],resourceCategory:"MANUAL",resourceLevel:Q.HEAVEN.key,manualSchool:ve.VARIANT.id,usageTargets:ce(),tags:["",""]},ice_manual_1:{id:"ice_manual_1",name:"",type:"manual",rarity:"uncommon",tier:"",tierColor:"#87CEEB",element:"",baseBonus:"+20%",desc:"",manualIds:["water_flow"],resourceCategory:"MANUAL",resourceLevel:Q.SPIRIT.key,manualSchool:ve.VARIANT.id,usageTargets:ce(),tags:["",""]},ice_manual_2:{id:"ice_manual_2",name:"",type:"manual",rarity:"rare",tier:"",tierColor:"#87CEEB",element:"",baseBonus:"+50%",desc:"",manualIds:["ice_heart"],resourceCategory:"MANUAL",resourceLevel:Q.SPIRIT.key,manualSchool:ve.VARIANT.id,usageTargets:ce(),tags:["",""]},ice_manual_3:{id:"ice_manual_3",name:"",type:"manual",rarity:"rare",tier:"",tierColor:"#87CEEB",element:"",baseBonus:"+100%",desc:"",manualIds:["ice_heart"],resourceCategory:"MANUAL",resourceLevel:Q.EARTH.key,manualSchool:ve.VARIANT.id,usageTargets:ce(),tags:["",""]},ice_manual_4:{id:"ice_manual_4",name:"",type:"manual",rarity:"epic",tier:"",tierColor:"#87CEEB",element:"",baseBonus:"+100%",desc:"",manualIds:["ice_heart"],resourceCategory:"MANUAL",resourceLevel:Q.EARTH.key,manualSchool:ve.VARIANT.id,usageTargets:ce(),tags:["",""]},ice_manual_5:{id:"ice_manual_5",name:"",type:"manual",rarity:"legendary",tier:"",tierColor:"#87CEEB",element:"",baseBonus:"+200%",desc:"",manualIds:["ice_heart"],resourceCategory:"MANUAL",resourceLevel:Q.HEAVEN.key,manualSchool:ve.VARIANT.id,usageTargets:ce(),tags:["",""]},wind_manual_1:{id:"wind_manual_1",name:"",type:"manual",rarity:"uncommon",tier:"",tierColor:"#E0E0E0",element:"",baseBonus:"+20%",desc:"",manualIds:["cloud_breath"],resourceCategory:"MANUAL",resourceLevel:Q.SPIRIT.key,manualSchool:ve.VARIANT.id,usageTargets:ce(),tags:["",""]},wind_manual_2:{id:"wind_manual_2",name:"",type:"manual",rarity:"rare",tier:"",tierColor:"#E0E0E0",element:"",baseBonus:"+50%",desc:"",manualIds:["wind_freedom"],resourceCategory:"MANUAL",resourceLevel:Q.SPIRIT.key,manualSchool:ve.VARIANT.id,usageTargets:ce(),tags:["",""]},wind_manual_3:{id:"wind_manual_3",name:"",type:"manual",rarity:"rare",tier:"",tierColor:"#E0E0E0",element:"",baseBonus:"+100%",desc:"",manualIds:["wind_freedom"],resourceCategory:"MANUAL",resourceLevel:Q.EARTH.key,manualSchool:ve.VARIANT.id,usageTargets:ce(),tags:["",""]},wind_manual_4:{id:"wind_manual_4",name:"",type:"manual",rarity:"epic",tier:"",tierColor:"#E0E0E0",element:"",baseBonus:"+100%",desc:"",manualIds:["wind_freedom"],resourceCategory:"MANUAL",resourceLevel:Q.EARTH.key,manualSchool:ve.VARIANT.id,usageTargets:ce(),tags:["",""]},wind_manual_5:{id:"wind_manual_5",name:"",type:"manual",rarity:"legendary",tier:"",tierColor:"#E0E0E0",element:"",baseBonus:"+200%",desc:"",manualIds:["wind_freedom"],resourceCategory:"MANUAL",resourceLevel:Q.HEAVEN.key,manualSchool:ve.VARIANT.id,usageTargets:ce(),tags:["",""]},cosmic_crystal:{id:"cosmic_crystal",name:"",type:"consumable",rarity:"legendary",desc:"",effect:{kind:"exp",amount:5e4},resourceCategory:"PILL",resourceLevel:Q.HEAVEN.key,usageTargets:ce(),tags:["",""]},void_silk:{id:"void_silk",name:"",type:"consumable",rarity:"legendary",desc:"",effect:{kind:"exp",amount:4e4},resourceCategory:"PILL",resourceLevel:Q.HEAVEN.key,usageTargets:ce(),tags:["",""]},heavenly_jade:{id:"heavenly_jade",name:"",type:"consumable",rarity:"mythic",desc:"",effect:{kind:"exp",amount:2e5},resourceCategory:"PILL",resourceLevel:Q.DIVINE.key,usageTargets:ce(),tags:["",""]},soul_essence_crystal:{id:"soul_essence_crystal",name:"",type:"consumable",rarity:"mythic",desc:"",effect:{kind:"exp",amount:18e4},resourceCategory:"PILL",resourceLevel:Q.DIVINE.key,usageTargets:ce(),tags:["",""]},star_core_fragment:{id:"star_core_fragment",name:"",type:"consumable",rarity:"mythic",desc:"",effect:{kind:"exp",amount:35e4},resourceCategory:"PILL",resourceLevel:Q.DIVINE.key,usageTargets:ce(),tags:["",""]},celestial_silk_cloth:{id:"celestial_silk_cloth",name:"",type:"consumable",rarity:"mythic",desc:"",effect:{kind:"exp",amount:3e5},resourceCategory:"PILL",resourceLevel:Q.DIVINE.key,usageTargets:ce(),tags:["",""]},abyss_stone:{id:"abyss_stone",name:"",type:"consumable",rarity:"mythic",desc:"",effect:{kind:"exp",amount:5e5},resourceCategory:"PILL",resourceLevel:Q.DIVINE.key,usageTargets:ce(),tags:["",""]},abyssal_essence:{id:"abyssal_essence",name:"",type:"consumable",rarity:"mythic",desc:"",effect:{kind:"exp",amount:55e4},resourceCategory:"PILL",resourceLevel:Q.DIVINE.key,usageTargets:ce(),tags:["",""]},divine_tribulation_stone:{id:"divine_tribulation_stone",name:"",type:"consumable",rarity:"mythic",desc:"",effect:{kind:"exp",amount:6e5},resourceCategory:"PILL",resourceLevel:Q.DIVINE.key,usageTargets:ce(),tags:["",""]},god_marrow:{id:"god_marrow",name:"",type:"consumable",rarity:"mythic",desc:"",effect:{kind:"exp",amount:65e4},resourceCategory:"PILL",resourceLevel:Q.DIVINE.key,usageTargets:ce(),tags:["",""]},divine_essence_core:{id:"divine_essence_core",name:"",type:"consumable",rarity:"mythic",desc:"",effect:{kind:"exp",amount:8e5},resourceCategory:"PILL",resourceLevel:Q.DIVINE.key,usageTargets:ce(),tags:["",""]},soul_tempering_stone:{id:"soul_tempering_stone",name:"",type:"consumable",rarity:"mythic",desc:"",effect:{kind:"exp",amount:75e4},resourceCategory:"PILL",resourceLevel:Q.DIVINE.key,usageTargets:ce(),tags:["",""]},void_manifold_crystal:{id:"void_manifold_crystal",name:"",type:"consumable",rarity:"mythic",desc:"",effect:{kind:"exp",amount:1e6},resourceCategory:"PILL",resourceLevel:Q.DIVINE.key,usageTargets:ce(),tags:["",""]},condensed_void_essence:{id:"condensed_void_essence",name:"",type:"consumable",rarity:"mythic",desc:"",effect:{kind:"exp",amount:105e4},resourceCategory:"PILL",resourceLevel:Q.DIVINE.key,usageTargets:ce(),tags:["",""]},celestial_ascension_token:{id:"celestial_ascension_token",name:"",type:"consumable",rarity:"mythic",desc:"",effect:{kind:"exp",amount:2e6},resourceCategory:"PILL",resourceLevel:Q.DIVINE.key,usageTargets:ce(),tags:["",""]},immortal_transformation_essence:{id:"immortal_transformation_essence",name:"",type:"consumable",rarity:"mythic",desc:"",effect:{kind:"exp",amount:22e5},resourceCategory:"PILL",resourceLevel:Q.DIVINE.key,usageTargets:ce(),tags:["",""]}},br=e=>{const t=Pc[e];return t?{...t,id:e,instanceId:`${e}_${Date.now()}_${Math.floor(Math.random()*1e4)}`,quantity:1,stackable:t.type==="consumable"||t.type==="manual",maxStack:t.type==="consumable"||t.type==="manual"?99:1}:null},Fo=e=>Pc[e];function S2(){const[e,t]=y.useState([]),n=y.useRef(e);y.useEffect(()=>{n.current=e},[e]);const s=y.useCallback(p=>{if(typeof p=="function"){t(c=>{const f=p(c);return n.current=f,f});return}n.current=p,t(p)},[]),o=y.useCallback((p=[])=>{const c=p.map(S=>S?typeof S=="string"?br(S):typeof S=="object"?{...S,instanceId:S.instanceId||(S.id||"item")+"_"+Date.now()+"_"+Math.floor(Math.random()*1e4),quantity:S.quantity||S.quantity===0?S.quantity:1,stackable:S.stackable??(S.type==="consumable"||S.type==="manual"),maxStack:S.maxStack||(S.type==="consumable"||S.type==="manual"?99:1)}:null:null).filter(Boolean);if(c.length===0)return[];const b=[...n.current||[]];return c.forEach(S=>{if(S.stackable){let E=S.quantity||1;const j=S.maxStack||99,x=b.find(h=>h.id===S.id&&h.name===S.name&&h.rarity===S.rarity&&h.stackable===!0&&(h.quantity||1)<j);if(x){const h=x.quantity||1,v=j-h;if(E<=v){x.quantity=h+E;return}else x.quantity=j,E-=v}for(;E>0;){const h=Math.min(E,j);b.unshift({...S,quantity:h}),E-=h}return}b.unshift(S)}),n.current=b,t(b),c},[]),i=y.useCallback((p,c)=>{const f=n.current||[];let b=[],S=typeof c=="number"?c:void 0,E=[...f];for(let j=0;j<E.length;){const x=E[j];if(String(x.instanceId)!==String(p)){j++;continue}const h=x.quantity||1;if(S===void 0||S>=h){if(b.push({...x}),S=S===void 0?void 0:S-h,E.splice(j,1),S===0)break}else{b.push({...x,quantity:S}),E[j]={...x,quantity:h-S},S=0;break}}return b.length>0&&(n.current=E,t(E)),b.length===0?null:b.length===1?b[0]:b.reduce((j,x)=>j?{...j,quantity:(j.quantity||1)+(x.quantity||1)}:{...x},null)},[]),a=y.useCallback(()=>{n.current=[],t([])},[]),l=y.useCallback(p=>e.find(p),[e]),d=y.useCallback(p=>e.filter(p),[e]),u=y.useCallback(p=>e.filter(c=>c.templateId===p).length,[e]);return{inventory:e,setInventory:s,addItemsToInventory:o,removeItemFromInventory:i,clearInventory:a,findItem:l,filterItems:d,getItemCount:u}}const fa=[{id:"stage_chu_qingyao",name:"",title:"",role:"",tier:"",baseThreat:25,baseExp:7200,powerMultiplier:1,flavor:"",defeatLog:"",unlockNextLog:"",combatStats:{hp:800,maxHp:800,atk:85,def:40},storyBeats:[{delay:1,type:"RIVAL_RISE",tier:"",exp:9e3,detail:"",description:""},{delay:1,type:"RIVAL_ENGAGED",target:"",detail:"",description:""},{delay:1,type:"RIVAL_MARRIAGE",target:"",tier:"",exp:15e3,detail:"",description:""},{delay:1,type:"RIVAL_HEIR",target:"",tier:"",exp:2e4,detail:"",description:""},{delay:1,type:"RIVAL_STAGE_EVENT",tier:"",exp:23e3,detail:"",description:""},{delay:1,type:"RIVAL_STAGE_EVENT",tier:"",exp:25e3,detail:"",description:""}]},{id:"stage_fiance",name:"",title:"",role:"",tier:"",baseThreat:40,baseExp:2e5,powerMultiplier:2.2,flavor:"",defeatLog:"",unlockNextLog:"",combatStats:{hp:1e5,maxHp:1e5,atk:1e4,def:4e3},storyBeats:[{delay:1,type:"RIVAL_STAGE_EVENT",tier:"",exp:5e5,detail:"",description:""},{delay:1,type:"RIVAL_STAGE_EVENT",tier:"",exp:8e5,detail:"",description:""},{delay:1,type:"RIVAL_STAGE_EVENT",tier:"",exp:2e6,detail:"",description:""}]},{id:"stage_family_elder",name:"",title:"",role:"",tier:"",baseThreat:55,baseExp:2e6,powerMultiplier:3.5,flavor:"",defeatLog:"",unlockNextLog:"",combatStats:{hp:1e6,maxHp:1e6,atk:1e5,def:4e4},storyBeats:[{delay:1,type:"RIVAL_STAGE_EVENT",tier:"",exp:5e6,detail:"",description:""},{delay:1,type:"RIVAL_STAGE_EVENT",tier:"",exp:1e7,detail:"",description:""},{delay:1,type:"RIVAL_STAGE_EVENT",tier:"",exp:2e7,detail:"",description:""}]},{id:"stage_sect_elder",name:"",title:"",role:"",tier:"",baseThreat:70,baseExp:1e8,powerMultiplier:6,flavor:"",defeatLog:"",unlockNextLog:"",combatStats:{hp:4e7,maxHp:4e7,atk:4e6,def:16e5},storyBeats:[{delay:1,type:"RIVAL_STAGE_EVENT",tier:"",exp:2e8,detail:"",description:""},{delay:1,type:"RIVAL_STAGE_EVENT",tier:"",exp:5e8,detail:"",description:""},{delay:1,type:"RIVAL_STAGE_EVENT",tier:"",exp:2e9,detail:"",description:""}]}],Ml=fa.length-1,dc=(e=0)=>fa[Math.max(0,Math.min(e,Ml))],ct=[ft.PLAYER,ft.CHILD],zc={YELLOW:{name:"",baseBuff:.2,color:"#D4AF37"},BLACK:{name:"",baseBuff:.5,color:"#4A4A4A"},EARTH:{name:"",baseBuff:1,color:"#8B4513"},HEAVEN:{name:"",baseBuff:2,color:"#9B30FF"}},Om={:"",:"",:"",:"",:"",:"",:"",:"",ALL:"",NONE:"",OMNI:"","":""},w2=e=>!e||e==="NONE"?"OMNI":e,k2=(e,t)=>`${e}_${w2(t)}`,hn={basic_breath:{id:"basic_breath",name:"",tier:"YELLOW",element:"NONE",desc:"",rarity:"common",source:""},cloud_breath:{id:"cloud_breath",name:"",tier:"YELLOW",element:"NONE",desc:"",rarity:"common",source:""},golden_light:{id:"golden_light",name:"",tier:"YELLOW",element:"",desc:"",rarity:"common",source:""},azure_sword_art:{id:"azure_sword_art",name:"",tier:"BLACK",element:"",desc:"",rarity:"rare",source:""},evergreen_art:{id:"evergreen_art",name:"",tier:"YELLOW",element:"",desc:"",rarity:"common",source:""},spring_birth:{id:"spring_birth",name:"",tier:"BLACK",element:"",desc:"",rarity:"rare",source:""},water_flow:{id:"water_flow",name:"",tier:"YELLOW",element:"",desc:"",rarity:"common",source:""},ocean_heart:{id:"ocean_heart",name:"",tier:"BLACK",element:"",desc:"",rarity:"rare",source:""},fire_control:{id:"fire_control",name:"",tier:"BLACK",element:"",desc:"",rarity:"rare",source:""},nine_turns_fire:{id:"nine_turns_fire",name:"",tier:"EARTH",element:"",desc:"",rarity:"epic",source:""},vermillion_bird:{id:"vermillion_bird",name:"",tier:"EARTH",element:"",desc:"",rarity:"epic",source:""},earth_shield:{id:"earth_shield",name:"",tier:"YELLOW",element:"",desc:"",rarity:"common",source:""},mountain_body:{id:"mountain_body",name:"",tier:"BLACK",element:"",desc:"",rarity:"rare",source:""},thunder_guide:{id:"thunder_guide",name:"",tier:"HEAVEN",element:"",desc:"",rarity:"legendary",source:""},heavenly_demon:{id:"heavenly_demon",name:"",tier:"HEAVEN",element:"",desc:"",rarity:"legendary",source:""},ice_heart:{id:"ice_heart",name:"",tier:"BLACK",element:"",desc:"",rarity:"rare",source:""},wind_freedom:{id:"wind_freedom",name:"",tier:"BLACK",element:"",desc:"",rarity:"rare",source:""},yin_yang_harmony:{id:"yin_yang_harmony",name:"",tier:"BLACK",element:"NONE",desc:"",rarity:"rare",source:""},blood_demon:{id:"blood_demon",name:"",tier:"EARTH",element:"NONE",desc:"",rarity:"epic",source:""},chaos_origin:{id:"chaos_origin",name:"",tier:"HEAVEN",element:"NONE",desc:"",rarity:"legendary",source:""},five_elements_supreme:{id:"five_elements_supreme",name:"",tier:"HEAVEN",element:"ALL",desc:"",rarity:"legendary",source:""},emperor_scripture:{id:"emperor_scripture",name:"",tier:"HEAVEN",element:"NONE",desc:"",rarity:"legendary",source:""},deep_ocean_scripture:{id:"deep_ocean_scripture",name:"",tier:"EARTH",element:"",desc:"",rarity:"epic",source:""},nine_star_formation:{id:"nine_star_formation",name:"",tier:"BLACK",element:"",desc:"",rarity:"rare",source:""},grass_valley_healing:{id:"grass_valley_healing",name:"",tier:"YELLOW",element:"",desc:"",rarity:"common",source:""},stone_refining:{id:"stone_refining",name:"",tier:"YELLOW",element:"",desc:"",rarity:"common",source:""},ghost_cultivation:{id:"ghost_cultivation",name:"",tier:"EARTH",element:"",desc:"",rarity:"epic",source:""},blood_river:{id:"blood_river",name:"",tier:"BLACK",element:"NONE",desc:"",rarity:"rare",source:""}},E2={basic_breath:{resourceLevel:Q.MORTAL.key,school:ve.GENERAL.id,stage:"",focus:["",""],usageTargets:ct},cloud_breath:{resourceLevel:Q.MORTAL.key,school:ve.GENERAL.id,stage:"",focus:["",""],usageTargets:ct},golden_light:{resourceLevel:Q.MORTAL.key,school:ve.ELEMENTAL.id,stage:"",focus:["",""],usageTargets:ct},azure_sword_art:{resourceLevel:Q.SPIRIT.key,school:ve.ELEMENTAL.id,stage:"",focus:["",""],usageTargets:ct},evergreen_art:{resourceLevel:Q.MORTAL.key,school:ve.ELEMENTAL.id,stage:"",focus:["",""],usageTargets:ct},spring_birth:{resourceLevel:Q.SPIRIT.key,school:ve.ELEMENTAL.id,stage:"",focus:["",""],usageTargets:ct},water_flow:{resourceLevel:Q.MORTAL.key,school:ve.ELEMENTAL.id,stage:"",focus:["",""],usageTargets:ct},ocean_heart:{resourceLevel:Q.SPIRIT.key,school:ve.ELEMENTAL.id,stage:"",focus:["",""],usageTargets:ct},fire_control:{resourceLevel:Q.SPIRIT.key,school:ve.ELEMENTAL.id,stage:"",focus:["",""],usageTargets:ct},nine_turns_fire:{resourceLevel:Q.EARTH.key,school:ve.ELEMENTAL.id,stage:"",focus:["",""],usageTargets:ct},vermillion_bird:{resourceLevel:Q.HEAVEN.key,school:ve.ELEMENTAL.id,stage:"",focus:["",""],usageTargets:ct},earth_shield:{resourceLevel:Q.MORTAL.key,school:ve.ELEMENTAL.id,stage:"",focus:["",""],usageTargets:ct},mountain_body:{resourceLevel:Q.SPIRIT.key,school:ve.ELEMENTAL.id,stage:"",focus:["",""],usageTargets:ct},thunder_guide:{resourceLevel:Q.HEAVEN.key,school:ve.VARIANT.id,stage:"",focus:["",""],usageTargets:ct},heavenly_demon:{resourceLevel:Q.DIVINE.key,school:ve.VARIANT.id,stage:"",focus:["",""],usageTargets:ct},ice_heart:{resourceLevel:Q.SPIRIT.key,school:ve.VARIANT.id,stage:"",focus:["",""],usageTargets:ct},wind_freedom:{resourceLevel:Q.SPIRIT.key,school:ve.VARIANT.id,stage:"",focus:["",""],usageTargets:ct},yin_yang_harmony:{resourceLevel:Q.SPIRIT.key,school:ve.DUAL.id,stage:"",focus:["",""],usageTargets:ct},blood_demon:{resourceLevel:Q.EARTH.key,school:ve.DEVIL.id,stage:"",focus:["",""],usageTargets:ct},chaos_origin:{resourceLevel:Q.DIVINE.key,school:ve.GENERAL.id,stage:"",focus:["",""],usageTargets:ct},five_elements_supreme:{resourceLevel:Q.DIVINE.key,school:ve.ELEMENTAL.id,stage:"",focus:["",""],usageTargets:ct},emperor_scripture:{resourceLevel:Q.DIVINE.key,school:ve.GENERAL.id,stage:"",focus:["",""],usageTargets:ct},deep_ocean_scripture:{resourceLevel:Q.EARTH.key,school:ve.ELEMENTAL.id,stage:"",focus:["",""],usageTargets:ct},nine_star_formation:{resourceLevel:Q.SPIRIT.key,school:ve.ELEMENTAL.id,stage:"",focus:["",""],usageTargets:ct},grass_valley_healing:{resourceLevel:Q.MORTAL.key,school:ve.ELEMENTAL.id,stage:"",focus:["",""],usageTargets:ct},stone_refining:{resourceLevel:Q.MORTAL.key,school:ve.ELEMENTAL.id,stage:"",focus:["",""],usageTargets:ct},ghost_cultivation:{resourceLevel:Q.EARTH.key,school:ve.DEVIL.id,stage:"",focus:["",""],usageTargets:ct},blood_river:{resourceLevel:Q.SPIRIT.key,school:ve.DEVIL.id,stage:"",focus:["",""],usageTargets:ct}};Object.entries(E2).forEach(([e,t])=>{hn[e]&&(hn[e]={...hn[e],resourceCategory:"MANUAL",...t,usageTargets:t.usageTargets?[...t.usageTargets]:[...ct]})});const Al={};Object.entries(hn).forEach(([e,t])=>{var s;const n=k2(t.tier,t.element);if(!Al[n]){const o=((s=zc[t.tier])==null?void 0:s.name)||t.tier,i=Om[t.element]||t.element||Om.NONE;Al[n]={key:n,tier:t.tier,element:t.element,label:`${o}${i}`,manualIds:[]}}Al[n].manualIds.push(e),hn[e].categoryKey=n});const j2=Al,Pm={:"azure_sword_art",:"emperor_scripture",:"fire_control",:"deep_ocean_scripture",:"thunder_guide",:"spring_birth",:"nine_star_formation",:"wind_freedom",:"yin_yang_harmony",:"mountain_body",:"grass_valley_healing",:"stone_refining",:"heavenly_demon",:"ghost_cultivation",:"blood_river"};function vf(e,t){const n=hn[e];if(!n)return{compatibility:.5,level:"poor",desc:""};if(!t||!t.elements)return{compatibility:.8,level:"neutral",desc:"",color:"#999"};const{element:s}=n,{elements:o,type:i}=t;return s==="NONE"?{compatibility:.8,level:"neutral",desc:"",color:"#FFFFFF"}:n.id==="five_elements_supreme"?o.length===5?{compatibility:1.5,level:"perfect",desc:"",color:"#FFD700"}:{compatibility:.1,level:"impossible",desc:"",color:"#FF0000"}:o.includes(s)?o.length===1&&o[0]===s?{compatibility:1.5,level:"perfect",desc:"",color:"#4CAF50"}:{compatibility:1,level:"good",desc:"",color:"#2196F3"}:{compatibility:.5,level:"poor",desc:"",color:"#FF6B6B"}}function Sf(e,t){const n=hn[e];if(!n)return 1;const s=zc[n.tier],{compatibility:o}=vf(e,t);return 1+s.baseBuff*o}function C2(e){const t=hn[e];if(!t)return null;const n=zc[t.tier];return{...t,tierName:n.name,tierColor:n.color,baseBuff:n.baseBuff}}const wf=e=>e?JSON.parse(JSON.stringify(e)):null,pp=[{name:"",key:"pure_yang",rarity:"SR",desc:"",effects:{statBonus:{aptitude:5},speedMultiplier:1.1,feedbackBonus:.05,preferredRoots:["",""],sectAffinity:{ids:["HEAVEN_EMPEROR","THUNDER"],bonus:25}}},{name:"",key:"innate_dao",rarity:"SSR",desc:"",effects:{statBonus:{looks:12,intelligence:5},speedMultiplier:1.15,feedbackBonus:.08,sectAffinity:{levels:["TOP","HIGH"],bonus:20}}},{name:"",key:"ancient_sage",rarity:"UR",desc:"",effects:{statBonus:{aptitude:8,health:25},speedMultiplier:1.2,feedbackBonus:.1,sectAffinity:{ids:["SWORD","HEAVEN_EMPEROR"],bonus:30}}},{name:"",key:"lunar_meridian",rarity:"SSR",desc:"",effects:{statBonus:{aptitude:4,intelligence:4},speedMultiplier:1.08,preferredRoots:["",""],sectAffinity:{ids:["GHOST","FLOWER"],bonus:20}}},{name:"",key:"stellar_bone",rarity:"SSR",desc:"",effects:{statBonus:{aptitude:6},speedMultiplier:1.12,preferredRoots:["",""],feedbackBonus:.06,sectAffinity:{ids:["NINE_STAR","STONE"],bonus:22}}},{name:"",key:"wood_spirit",rarity:"SR",desc:"",effects:{statBonus:{intelligence:6},speedMultiplier:1.05,preferredRoots:["",""],businessBonus:.25,feedbackBonus:.04,sectAffinity:{ids:["GRASS","FLOWER","DAN"],bonus:18}}},{name:"",key:"dragon_blood",rarity:"SR",desc:"",effects:{statBonus:{aptitude:5,health:18},speedMultiplier:1.1,feedbackBonus:.06,sectAffinity:{ids:["SWORD","IRON","BLOOD"],bonus:20}}},{name:"",key:"nether_core",rarity:"UR",desc:"",effects:{statBonus:{aptitude:7},speedMultiplier:1.18,preferredRoots:["",""],feedbackBonus:.09,sectAffinity:{ids:["GHOST","BLOOD"],bonus:28}}},{name:"",key:"fumo_frost_thunder_body",rarity:"UR",desc:"",effects:{statBonus:{aptitude:9,health:12},speedMultiplier:1.22,feedbackBonus:.12,preferredRoots:["",""],sectAffinity:{ids:["SWORD","HEAVEN_EMPEROR"],bonus:35}}},{name:"",key:"fumo_abyssal_flame_core",rarity:"UR",desc:"",effects:{statBonus:{aptitude:7,looks:8},speedMultiplier:1.18,feedbackBonus:.11,preferredRoots:["",""],sectAffinity:{ids:["BLOOD","GHOST"],bonus:30}}}],T2=()=>{const e=pp[Math.floor(Math.random()*pp.length)];return wf(e)},vy=e=>{if(!e)return null;const t=pp.find(n=>n.key===e);return wf(t)},Nl=e=>wf(e),kf=(e={},t)=>{var a;if(!((a=t==null?void 0:t.effects)!=null&&a.statBonus))return e;const{aptitude:n=0,looks:s=0,intelligence:o=0,health:i=0}=t.effects.statBonus;return{...e,aptitude:Math.max(1,Math.min(100,(e.aptitude||0)+n)),looks:Math.max(1,Math.min(120,(e.looks||0)+s)),intelligence:Math.max(1,Math.min(100,(e.intelligence||0)+o)),health:Math.max(1,Math.min(150,(e.health||0)+i))}},I2=e=>{var t;return((t=e==null?void 0:e.effects)==null?void 0:t.speedMultiplier)||1},_2=e=>{var t;return((t=e==null?void 0:e.effects)==null?void 0:t.feedbackBonus)||0},R2=e=>{var t;return((t=e==null?void 0:e.effects)==null?void 0:t.businessBonus)||0},M2=e=>{var t;return((t=e==null?void 0:e.effects)==null?void 0:t.sectAffinity)||null},A2=e=>{var t;return((t=e==null?void 0:e.effects)==null?void 0:t.preferredRoots)||null},Ef=[{id:0,name:"",level:"JUNIOR",isManagement:!1,description:"",powerScore:4,permissions:[]},{id:1,name:"",level:"JUNIOR",isManagement:!1,description:"",powerScore:8,permissions:[]},{id:2,name:"",level:"MID",isManagement:!1,description:"",powerScore:16,permissions:["access_advanced_techniques"]},{id:3,name:"",level:"HIGH",isManagement:!1,description:"",powerScore:28,permissions:["access_secret_techniques","participate_selection"]},{id:4,name:"",level:"MANAGEMENT",isManagement:!0,description:"",powerScore:36,permissions:["manage_disciples","resource_distribution"]},{id:5,name:"",level:"ELDER",isManagement:!0,description:"",powerScore:48,permissions:["manage_disciples","resource_distribution","recruitment","policy_making"]},{id:6,name:"",level:"SUPREME",isManagement:!0,description:"",powerScore:65,permissions:["manage_all","final_decision","sect_succession"]},{id:100,name:"",level:"SPECIAL",isManagement:!1,description:"",powerScore:32,permissions:["religious_authority"]},{id:101,name:"",level:"ROGUE",isManagement:!1,description:"",powerScore:12,permissions:[]},{id:102,name:"",level:"SOVEREIGN",isManagement:!0,description:"",powerScore:85,permissions:["manage_all","final_decision","sect_succession","declare_war"]}],N2=e=>Ef.find(t=>t.name===e)||null,L2=e=>{const t=N2(e);return t?t.powerScore:0},$2={:["meridian_pill","herb_bandage","rice_ball"],:["meridian_pill","beast_core","iron_armor"],:["foundation_pill","thunder_wood","iron_armor","milk_millennium"],:["core_pill","artifact_supreme","marrow_wash","dragon_heart_pill"],:["dragon_heart_pill","moonshadow_saber","thunder_wood","nascent_fruit","core_pill"],:["nascent_fruit","god_transformation_pill","divine_soul_pill","dragon_heart_pill","core_pill"],:["divine_soul_pill","void_condensing_pill","immortal_marrow_pill","heaven_defying_pill","starlight_pill","nascent_fruit"],:["void_refining_pill","space_law_pill","immortal_marrow_pill","divine_soul_pill","void_condensing_pill","heaven_defying_pill"],:["unity_pill","dao_comprehension_pill","harmony_pill","void_stabilization_pill"],:["mahayana_pill","immortal_foundation_pill","semi_immortal_pill"],:["temple_relic","buddhist_scripture"],:["meridian_pill","herb_bandage"]},B2=e=>$2[e]||null,O2=e=>{const t=B2(e);return!t||t.length===0?null:t[Math.floor(Math.random()*t.length)]},P2=()=>Ef.map(e=>e.name),Mn={HEAVEN:{id:"HEAVEN",name:"",color:"#FFD700",min:90,max:100,elementCount:1,multiplier:2.5,desc:""},MUTANT_HEAVEN:{id:"MUTANT_HEAVEN",name:"",color:"#FF00FF",min:100,max:100,elementCount:1,multiplier:2.8,desc:""},MUTANT:{id:"MUTANT",name:"",color:"#00BCD4",min:80,max:89,elementCount:1,multiplier:2,desc:"(//)"},SINGLE:{id:"SINGLE",name:"",color:"#9C27B0",min:80,max:89,elementCount:1,multiplier:1.8,desc:""},DOUBLE:{id:"DOUBLE",name:"",color:"#2196F3",min:60,max:79,elementCount:2,multiplier:1.5,desc:""},TRIPLE:{id:"TRIPLE",name:"",color:"#4CAF50",min:40,max:59,elementCount:3,multiplier:1,desc:""},QUAD:{id:"QUAD",name:"",color:"#FF9800",min:20,max:39,elementCount:4,multiplier:.8,desc:""},WASTE:{id:"WASTE",name:"",color:"#9E9E9E",min:1,max:19,elementCount:5,multiplier:.5,desc:""},NONE:{id:"NONE",name:"",color:"#000000",min:0,max:0,elementCount:0,multiplier:0,desc:""}},z2=["","","","",""],zm=["","",""],jf=e=>{if(e<=0)return Mn.NONE;if(e===100)return Math.random()<.01?Mn.MUTANT_HEAVEN:Mn.HEAVEN;if(e>=80&&e<90){const t=Math.random();return t<.01||t<.21?Mn.MUTANT:Mn.SINGLE}return e>=1&&e<80&&Math.random()<.01?Mn.MUTANT:Object.values(Mn).find(t=>e>=t.min&&e<=t.max)||Mn.WASTE},Ve=[{name:"",maxExp:100,feedback:0,chance:1,desc:""},{name:"",maxExp:500,feedback:1,chance:.95,desc:""},{name:"",maxExp:1e3,feedback:2,chance:.9,desc:""},{name:"",maxExp:2e3,feedback:3,chance:.85,desc:""},{name:"",maxExp:5e3,feedback:5,chance:.8,desc:""},{name:"",maxExp:2e4,feedback:20,chance:.6,desc:""},{name:"",maxExp:5e4,feedback:30,chance:.5,desc:""},{name:"",maxExp:8e4,feedback:40,chance:.4,desc:""},{name:"",maxExp:2e5,feedback:100,chance:.3,desc:""},{name:"",maxExp:5e5,feedback:150,chance:.25,desc:""},{name:"",maxExp:1e6,feedback:200,chance:.2,desc:""},{name:"",maxExp:2e6,feedback:500,chance:.1,desc:""},{name:"",maxExp:5e6,feedback:800,chance:.08,desc:""},{name:"",maxExp:1e7,feedback:1200,chance:.06,desc:""},{name:"",maxExp:2e7,feedback:2e3,chance:.05,desc:""},{name:"",maxExp:5e7,feedback:3500,chance:.04,desc:""},{name:"",maxExp:1e8,feedback:5e3,chance:.03,desc:""},{name:"",maxExp:2e8,feedback:8e3,chance:.025,desc:""},{name:"",maxExp:5e8,feedback:12e3,chance:.02,desc:""},{name:"",maxExp:1e9,feedback:18e3,chance:.015,desc:""},{name:"",maxExp:2e9,feedback:25e3,chance:.012,desc:""},{name:"",maxExp:5e9,feedback:4e4,chance:.01,desc:""},{name:"",maxExp:1e10,feedback:6e4,chance:.008,desc:""},{name:"",maxExp:2e10,feedback:1e5,chance:.006,desc:""},{name:"",maxExp:5e10,feedback:15e4,chance:.005,desc:""},{name:"",maxExp:1e11,feedback:25e4,chance:.004,desc:""},{name:"",maxExp:2e11,feedback:4e5,chance:.003,desc:""},{name:"",maxExp:5e11,feedback:6e5,chance:.002,desc:""},{name:"",maxExp:1e12,feedback:1e6,chance:.001,desc:""}],Cf=e=>{const t=Ve.findIndex(n=>n.name===e);return t===-1||t===Ve.length-1?null:Ve[t+1]},Cn=e=>Ve.find(t=>t.name===e)||Ve[0],D2=e=>{const t=Ve.findIndex(n=>n.name===e);return t>=0?t:0},Ho=(e,t,n,s=null,o=0,i=1)=>{const a={:{hp:100,atk:5,mp:0,def:2},:{hp:500,atk:50,mp:200,def:20},:{hp:800,atk:80,mp:400,def:35},:{hp:1200,atk:120,mp:600,def:50},:{hp:2e3,atk:200,mp:1e3,def:80},:{hp:1e4,atk:1e3,mp:5e3,def:400},:{hp:15e3,atk:1500,mp:8e3,def:600},:{hp:2e4,atk:2e3,mp:12e3,def:800},:{hp:1e5,atk:1e4,mp:5e4,def:4e3},:{hp:2e5,atk:2e4,mp:1e5,def:8e3},:{hp:4e5,atk:4e4,mp:2e5,def:16e3},:{hp:1e6,atk:1e5,mp:5e5,def:4e4},:{hp:2e6,atk:2e5,mp:1e6,def:8e4},:{hp:4e6,atk:4e5,mp:2e6,def:16e4},:{hp:1e7,atk:1e6,mp:5e6,def:4e5},:{hp:2e7,atk:2e6,mp:1e7,def:8e5},:{hp:4e7,atk:4e6,mp:2e7,def:16e5},:{hp:1e8,atk:1e7,mp:5e7,def:4e6},:{hp:2e8,atk:2e7,mp:1e8,def:8e6},:{hp:4e8,atk:4e7,mp:2e8,def:16e6},:{hp:1e9,atk:1e8,mp:5e8,def:4e7},:{hp:2e9,atk:2e8,mp:1e9,def:8e7},:{hp:4e9,atk:4e8,mp:2e9,def:16e7},:{hp:1e10,atk:1e9,mp:5e9,def:4e8},:{hp:2e10,atk:2e9,mp:1e10,def:8e8},:{hp:4e10,atk:4e9,mp:2e10,def:16e8},:{hp:1e11,atk:1e10,mp:5e10,def:4e9},:{hp:2e11,atk:2e10,mp:1e11,def:8e9},:{hp:4e11,atk:4e10,mp:2e11,def:16e9}},l=a[e]||a.;let d=1;Object.values(Mn).forEach(x=>{x.name===n&&(d=x.multiplier)});const u=1+t/100,c=1+(i>0?Math.min(1,o/i):0)*.3;let f=Math.floor(l.hp*d*u*c),b=Math.floor(l.atk*d*u*c),S=Math.floor((l.def||0)*d*u*c),E=Math.floor(l.mp*d*u*c);return(s?Object.values(s).filter(Boolean):[]).forEach(x=>{const h=x.stats||{};f+=h.hp||0,b+=h.atk||0,S+=h.def||0,E+=h.mp||0}),{hp:f,maxHp:f,atk:b,def:S||Math.floor(b*.4),mp:E,maxMp:E}},Vn=e=>{var l,d;if(!e)return{hp:100,maxHp:100,atk:10,def:5,mp:50,maxMp:50};const t=e.tier||e.tierTitle||"",n=((l=e.stats)==null?void 0:l.aptitude)||50,s=((d=e.spiritRoot)==null?void 0:d.type)||"",o=e.equipment||null,i=e.currentExp||e.cultivation||0,a=e.maxExp||1;return Ho(t,n,s,o,i,a)},Dm=[{name:"",rarity:"RED",effect:3,desc:"+200%",cost:0,bonuses:{speedMultiplier:3,feedbackMultiplier:1.5,sectAffinity:{levels:["TOP"],bonus:35}}},{name:"",rarity:"RED",effect:2.5,desc:"",cost:0,bonuses:{speedMultiplier:2.5,feedbackMultiplier:1.3,flatFeedbackBonus:5}},{name:"",rarity:"RED",effect:2.2,desc:"",cost:0,bonuses:{speedMultiplier:2.2,feedbackMultiplier:1.2,sectAffinity:{ids:["NINE_STAR","HEAVEN_EMPEROR"],bonus:30}}},{name:"",rarity:"ORANGE",effect:2,desc:"+100%",cost:0,bonuses:{speedMultiplier:2,sectAffinity:{ids:["NINE_STAR"],bonus:18}}},{name:"",rarity:"ORANGE",effect:1.8,desc:"100%",cost:0,bonuses:{speedMultiplier:1.8,sectAffinity:{ids:["SWORD"],bonus:28}}},{name:"",rarity:"ORANGE",effect:1.4,desc:"+40%",cost:0,bonuses:{speedMultiplier:1.4,businessBonus:.4,feedbackMultiplier:1.15}},{name:"",rarity:"ORANGE",effect:1.6,desc:"",cost:0,bonuses:{speedMultiplier:1.6,feedbackMultiplier:1.1,sectAffinity:{ids:["HEAVEN_EMPEROR","THUNDER"],bonus:22}}},{name:"",rarity:"PURPLE",effect:1.5,desc:"+50%",cost:0,bonuses:{speedMultiplier:1.5,sectAffinity:{ids:["IRON","STONE"],bonus:15}}},{name:"",rarity:"PURPLE",effect:1.5,desc:"",cost:0,bonuses:{speedMultiplier:1.5,feedbackMultiplier:1.05}},{name:"",rarity:"PURPLE",effect:1.3,desc:"",cost:0,bonuses:{speedMultiplier:1.3,businessBonus:.25,sectAffinity:{ids:["GRASS","DAN"],bonus:16}}},{name:"",rarity:"PURPLE",effect:1.4,desc:"",cost:0,bonuses:{speedMultiplier:1.4,sectAffinity:{ids:["THUNDER","DEMON"],bonus:18}}},{name:"",rarity:"BLUE",effect:1.2,desc:"+20%",cost:0,bonuses:{speedMultiplier:1.2}},{name:"",rarity:"BLUE",effect:1.2,desc:"",cost:0,bonuses:{speedMultiplier:1.2,feedbackMultiplier:1.05}},{name:"",rarity:"BLUE",effect:1.15,desc:"",cost:0,bonuses:{speedMultiplier:1.15,sectAffinity:{ids:["IRON"],bonus:12}}},{name:"",rarity:"GREEN",effect:1.1,desc:"",cost:0,bonuses:{speedMultiplier:1.1}},{name:"",rarity:"GREEN",effect:1.1,desc:"",cost:0,bonuses:{speedMultiplier:1.1,sectAffinity:{levels:["MID"],bonus:8}}},{name:"",rarity:"GREEN",effect:1.08,desc:"",cost:0,bonuses:{speedMultiplier:1.08,feedbackMultiplier:1.05}},{name:"",rarity:"WHITE",effect:.9,desc:"",cost:5,bonuses:{speedMultiplier:.9,feedbackMultiplier:.9}},{name:"",rarity:"WHITE",effect:.8,desc:"-20%",cost:0,bonuses:{speedMultiplier:.8}},{name:"",rarity:"WHITE",effect:.85,desc:"",cost:0,bonuses:{speedMultiplier:.85,feedbackMultiplier:.9}}],ns=[{id:"SWORD",name:"",level:"TOP",minApt:80,tuition:500,prefElements:[""],buff:1.5,risk:.02,resourceTypes:["",""],initialRankProb:{:.15,:.35,:.5},desc:"",scale:"",promotionEase:.85,requirements:{minApt:80,requiredElements:[""],allowedRootTypes:["","",""],notes:""}},{id:"HEAVEN_EMPEROR",name:"",level:"TOP",minApt:85,tuition:600,prefElements:["",""],buff:1.6,risk:.03,resourceTypes:["",""],initialRankProb:{:.2,:.4,:.4},desc:"",scale:"",promotionEase:.75,requirements:{minApt:85,allowedRootTypes:["",""],notes:""}},{id:"STAR_PALACE",name:"",level:"TOP",minApt:82,tuition:520,prefElements:["",""],buff:1.55,risk:.025,resourceTypes:["",""],initialRankProb:{:.18,:.37,:.45},desc:"",scale:"",promotionEase:.82,requirements:{minApt:82,allowedRootTypes:["","",""],notes:""}},{id:"VOID_TEMPLE",name:"",level:"TOP",minApt:83,tuition:480,prefElements:["",""],buff:1.52,risk:.028,resourceTypes:["",""],initialRankProb:{:.17,:.33,:.5},desc:"",scale:"",promotionEase:.8,requirements:{minApt:83,requiredElements:["",""],allowedRootTypes:["","",""],notes:""}},{id:"DAN",name:"",level:"HIGH",minApt:60,tuition:300,prefElements:["",""],buff:1.25,risk:.03,resourceTypes:["",""],initialRankProb:{:.1,:.4,:.5},desc:"",scale:"",promotionEase:1,requirements:{minApt:60,requiredElements:["",""],notes:""}},{id:"OCEAN_PALACE",name:"",level:"HIGH",minApt:65,tuition:350,prefElements:[""],buff:1.3,risk:.02,resourceTypes:["",""],initialRankProb:{:.12,:.38,:.5},desc:"",scale:"",promotionEase:.95,requirements:{minApt:65,requiredElements:[""],notes:""}},{id:"THUNDER",name:"",level:"HIGH",minApt:70,tuition:400,prefElements:[""],buff:1.4,risk:.04,resourceTypes:["",""],initialRankProb:{:.15,:.35,:.5},desc:"",scale:"",promotionEase:.9,requirements:{minApt:70,requiredElements:[""],notes:""}},{id:"GLACIER",name:"",level:"HIGH",minApt:68,tuition:320,prefElements:["",""],buff:1.28,risk:.03,resourceTypes:["",""],initialRankProb:{:.13,:.34,:.53},desc:"",scale:"",promotionEase:.97,requirements:{minApt:68,requiredElements:["",""],notes:""}},{id:"FLOWER",name:"",level:"MID",minApt:40,tuition:100,prefElements:["",""],buff:1.15,risk:.01,resourceTypes:["",""],initialRankProb:{:.05,:.25,:.7},desc:"",scale:"",promotionEase:1.05,requirements:{minApt:40,minLooks:75,requiredElements:["",""],notes:""}},{id:"NINE_STAR",name:"",level:"MID",minApt:45,tuition:120,prefElements:["",""],buff:1.18,risk:.02,resourceTypes:["",""],initialRankProb:{:.06,:.24,:.7},desc:"",scale:"",promotionEase:1,requirements:{minApt:45,requiredElements:["",""],notes:""}},{id:"WIND",name:"",level:"MID",minApt:50,tuition:150,prefElements:[""],buff:1.2,risk:.015,resourceTypes:["",""],initialRankProb:{:.08,:.27,:.65},desc:"",scale:"",promotionEase:1.1,requirements:{minApt:50,requiredElements:[""],notes:""}},{id:"HARMONY",name:"",level:"MID",minApt:35,tuition:80,prefElements:["",""],buff:1.12,risk:.01,resourceTypes:["",""],initialRankProb:{:.04,:.21,:.75},desc:"",scale:"",promotionEase:1.08,requirements:{minApt:35,minLooks:70,notes:""}},{id:"IRON",name:"",level:"LOW",minApt:20,tuition:50,prefElements:[""],buff:1.1,risk:.005,resourceTypes:["",""],initialRankProb:{:.02,:.15,:.83},desc:"",scale:"",promotionEase:1.2,requirements:{minApt:20,notes:""}},{id:"GRASS",name:"",level:"LOW",minApt:25,tuition:60,prefElements:[""],buff:1.08,risk:.005,resourceTypes:["",""],initialRankProb:{:.03,:.17,:.8},desc:"",scale:"",promotionEase:1.25,requirements:{minApt:25,requiredElements:[""],notes:""}},{id:"STONE",name:"",level:"LOW",minApt:20,tuition:40,prefElements:["",""],buff:1.05,risk:.003,resourceTypes:["",""],initialRankProb:{:.01,:.12,:.87},desc:"",scale:"",promotionEase:1.18,requirements:{minApt:20,requiredElements:["",""],notes:""}},{id:"EMBER",name:"",level:"LOW",minApt:18,tuition:30,prefElements:[""],buff:1.02,risk:.004,resourceTypes:["",""],initialRankProb:{:.01,:.1,:.89},desc:"",scale:"",promotionEase:1.3,requirements:{minApt:18,requiredElements:["",""],notes:""}},{id:"DEMON",name:"",level:"RECKLESS",minApt:30,tuition:0,prefElements:["",""],buff:2,risk:.1,resourceTypes:["",""],initialRankProb:{:.08,:.22,:.7},desc:"",scale:"",promotionEase:1.2,requirements:{minApt:30,allowedRootTypes:["","",""],notes:""}},{id:"GHOST",name:"",level:"RECKLESS",minApt:35,tuition:0,prefElements:[""],buff:1.8,risk:.08,resourceTypes:["",""],initialRankProb:{:.1,:.25,:.65},desc:"",scale:"",promotionEase:1.1,requirements:{minApt:35,requiredElements:["",""],notes:""}},{id:"BLOOD",name:"",level:"RECKLESS",minApt:25,tuition:0,prefElements:["",""],buff:1.7,risk:.12,resourceTypes:["",""],initialRankProb:{:.05,:.2,:.75},desc:"",scale:"",promotionEase:1.15,requirements:{minApt:25,requiredElements:["",""],notes:""}},{id:"SHADOW_PAVILION",name:"",level:"RECKLESS",minApt:28,tuition:0,prefElements:["",""],buff:1.65,risk:.09,resourceTypes:["",""],initialRankProb:{:.07,:.23,:.7},desc:"",scale:"",promotionEase:1.18,requirements:{minApt:28,requiredElements:["",""],notes:""}},{id:"NONE",name:"",level:"NONE",minApt:0,tuition:0,prefElements:[],buff:.8,risk:0,resourceTypes:[""],initialRankProb:{:1},desc:"",scale:"",promotionEase:1,requirements:{minApt:0,notes:""}}],Sy=e=>ns.find(t=>t.id===e)||ns.find(t=>t.id==="NONE"),Ki=(e,t)=>{var u,p;if(!t||!t.initialRankProb)return"";const n={...t.initialRankProb};if((((u=e.stats)==null?void 0:u.aptitude)||50)>=(t.minApt||0)+20&&n.!==void 0){const c=Math.min(n.,.3);n.-=c,n.=(n.||0)+c*.6,n.=(n.||0)+c*.4}Array.isArray((p=e.spiritRoot)==null?void 0:p.elements)&&Array.isArray(t.prefElements)&&e.spiritRoot.elements.forEach(c=>{t.prefElements.includes(c)&&(n.=(n.||0)+.05,n.=(n.||0)+.03,n.&&(n.=Math.max(0,n.-.08)))});const o=t.promotionEase??1;if(o!==1){const c=Math.max(.3,Math.min(2,o));n.&&(n.*=c),n.&&(n.*=c),n.&&(n./=c),n.&&(n./=c)}const i=Object.keys(n);let a=i.reduce((c,f)=>c+(n[f]||0),0);if(a<=0)return"";i.forEach(c=>n[c]=(n[c]||0)/a);const l=Math.random();let d=0;for(const c of i)if(d+=n[c],l<=d)return c;return i[i.length-1]},F2=e=>e?e.resourceTypes||[]:[],Fm=P2(),wy=(e,t)=>{var l,d,u,p,c;if(!e||!t)return 0;let n=0;Array.isArray((l=e.spiritRoot)==null?void 0:l.elements)&&(e.spiritRoot.elements.forEach(f=>{t.prefElements&&t.prefElements.includes(f)&&(n+=50,e.spiritRoot.elements.length===1&&(n+=30))}),e.spiritRoot.type===""&&t.level==="TOP"&&(n+=50),e.spiritRoot.type===""&&(t.id==="DEMON"&&(n+=60),t.id==="THUNDER"&&(n+=50),t.id==="GHOST"&&e.spiritRoot.elements.includes("")&&(n+=50),t.id==="WIND"&&e.spiritRoot.elements.includes("")&&(n+=50),t.id==="HEAVEN_EMPEROR"&&(n+=40)));const s=((d=e.stats)==null?void 0:d.aptitude)||0,o=(t.minApt||0)-s;if(o<=0){const f=s-(t.minApt||0);n+=Math.min(40,f),f>=20&&t.level==="TOP"&&(n+=20)}else n-=o*2;if(t.level==="TOP"?n-=5:t.level==="RECKLESS"?n+=15:t.level==="LOW"&&(n-=10),t.id==="FLOWER"||t.id==="HARMONY"){const f=((u=e.stats)==null?void 0:u.looks)||50;f>=80?n+=30:f>=60&&(n+=15)}const i=M2(e.constitution);if(i){const f=i.bonus||15;i.ids&&i.ids.includes(t.id)?n+=f:i.levels&&i.levels.includes(t.level)&&(n+=Math.max(8,f*.6))}const a=(c=(p=e.trait)==null?void 0:p.bonuses)==null?void 0:c.sectAffinity;if(a){const f=a.bonus||12;a.ids&&a.ids.includes(t.id)?n+=f:a.levels&&a.levels.includes(t.level)&&(n+=Math.max(6,f*.5))}return Math.round(n)},ky=(e,t)=>{var p,c,f,b,S,E,j,x;if(!e||!t)return{qualified:!1,reasons:[""],summary:"",notes:""};const n=t.requirements||{},s=((p=e.stats)==null?void 0:p.aptitude)??0,o=((c=e.stats)==null?void 0:c.looks)??0,i=(f=e.spiritRoot)==null?void 0:f.type,a=((b=e.spiritRoot)==null?void 0:b.elements)||[],l=n.minApt??t.minApt??0,d=[],u=[];return l>0&&d.push(`${l}`),(S=n.requiredElements)!=null&&S.length&&d.push(`${n.requiredElements.join("")}`),(E=n.allowedRootTypes)!=null&&E.length&&d.push(`${n.allowedRootTypes.join("")}`),n.minLooks&&d.push(`${n.minLooks}`),n.customText&&d.push(n.customText),s<l&&u.push(`${l}`),n.minLooks&&o<n.minLooks&&u.push(`${n.minLooks}`),(j=n.allowedRootTypes)!=null&&j.length&&i&&(n.allowedRootTypes.includes(i)||u.push(`${n.allowedRootTypes.join("")}`)),(x=n.requiredElements)!=null&&x.length&&(a.some(v=>n.requiredElements.includes(v))||u.push(`${n.requiredElements.join("")}`)),{qualified:u.length===0,reasons:u,summary:d.join(""),notes:n.notes||""}},Dc=(e,t=!1)=>{var n,s,o,i,a,l,d,u;try{let p=t?10:120;const c=((n=e.stats)==null?void 0:n.aptitude)||50,b=.5+Math.max(0,Math.min(100,c))/100*2.5;p*=b;const S=((s=e.stats)==null?void 0:s.intelligence)||50,j=.6+Math.max(0,Math.min(100,S))/100*1.4;p*=j;const x=Ve.findIndex(g=>g.name===e.tier);if(x>=0){const g=1+x/Ve.length*1.5;p*=g}if((o=e.spiritRoot)!=null&&o.multiplier){const g=e.spiritRoot.multiplier;typeof g=="number"&&isFinite(g)&&(p*=g)}if(e.cultivationMethod&&e.spiritRoot)try{const g=Sf(e.cultivationMethod,e.spiritRoot);typeof g=="number"&&isFinite(g)&&(p*=g)}catch(g){console.error("Error calculating manual multiplier:",g)}const h=((a=(i=e.trait)==null?void 0:i.bonuses)==null?void 0:a.speedMultiplier)??((l=e.trait)==null?void 0:l.effect)??1;typeof h=="number"&&isFinite(h)&&(p*=h),(u=(d=e.trait)==null?void 0:d.bonuses)!=null&&u.flatSpeedBonus&&typeof e.trait.bonuses.flatSpeedBonus=="number"&&(p+=e.trait.bonuses.flatSpeedBonus);const v=I2(e.constitution);return typeof v=="number"&&isFinite(v)&&(p*=v),e.sect&&e.sect.level!=="NONE"&&(p*=1.5),!isFinite(p)||isNaN(p)?(console.error("Invalid cultivation speed calculated:",p),t?10:120):Math.floor(p)}catch(p){return console.error("Error in calculateCultivationSpeed:",p),t?10:120}},uc=(e,t={})=>{var n,s,o,i,a;try{if(e.age<6)return 0;const l=e.tierTitle||e.tier||"";if(l==="")return 0;const d=Cn(l);if(!d)return 0;let u=d.feedback||0;if(u===0)return 0;let p=0;l.includes("")?p=e.age<16?1:2:l.includes("")?p=u*.7:l.includes("")||l.includes("")?p=u*1:p=u*.5,e.age<16&&!l.includes("")&&(p*=.5);const c=((s=(n=e.trait)==null?void 0:n.bonuses)==null?void 0:s.feedbackMultiplier)??1,f=((i=(o=e.trait)==null?void 0:o.bonuses)==null?void 0:i.flatFeedbackBonus)||0,b=1+_2(e.constitution);p=p*c*b+f;const S=((a=e.stats)==null?void 0:a.aptitude)||50,E=Math.max(.1,(S||50)/50);p*=E;let j=1;e.rank===""&&(j=1.2),e.rank===""&&(j=1.5),e.rank===""&&(j=2),p*=j;let x=1;if(e.cultivationMethod&&e.spiritRoot)try{x=Sf(e.cultivationMethod,e.spiritRoot),isFinite(x)||(x=1)}catch(g){console.error("Error calculating manual multiplier for child:",e.name,g),x=1}p*=x;const h=t.familyRatingMultiplier??1;p*=h;const v=Math.max(0,Math.floor(p));return isFinite(v)?v:0}catch(l){return console.error("Error in calculateChildFeedback:",l),0}},H2={:4,:8,:16,:28,:36,:48,:65,:85},W2={TOP:32,HIGH:22,MID:14,LOW:9,RECKLESS:18,NONE:0},Tr=[{id:"SEED",label:"",minScore:0,color:"#9e9e9e",tagline:""},{id:"BACKBONE",label:"",minScore:80,color:"#4caf50",tagline:""},{id:"ELITE",label:"",minScore:140,color:"#2196f3",tagline:""},{id:"ELDER",label:"",minScore:200,color:"#ff9800",tagline:""},{id:"SOVEREIGN",label:"",minScore:280,color:"#e91e63",tagline:""}],Gs=[{id:"CLAN_SEED",name:"",desc:"",requirements:{minMembers:1,minPower:0,minStones:0},feedbackMultiplier:1,feedbackDesc:"1.0 ()"},{id:"LOCAL_CLAN",name:"",desc:"",requirements:{minMembers:5,minPower:100,minStones:500,minOuterDoor:2},feedbackMultiplier:1.5,feedbackDesc:"1.5 (+50%)"},{id:"CITY_NOBLE",name:"",desc:"",requirements:{minMembers:8,minPower:200,minStones:1500,minInnerDoor:2},feedbackMultiplier:3,feedbackDesc:"3.0 (+200%)"},{id:"REGION_PILLAR",name:"",desc:"",requirements:{minMembers:12,minPower:350,minStones:5e3,minDiscipleRank:2},feedbackMultiplier:6,feedbackDesc:"6.0 (+500%)"},{id:"SECT_ALLY",name:"",desc:"",requirements:{minMembers:18,minPower:600,minStones:1e4,minSteward:1},feedbackMultiplier:12,feedbackDesc:"12.0 (+1100%)"},{id:"IMMORTAL_DYNASTY",name:"",desc:"",requirements:{minMembers:22,minPower:900,minStones:2e4,minElders:1},feedbackMultiplier:25,feedbackDesc:"25.0 (+2400%)"},{id:"HEAVENLY_HEGEMONY",name:"",desc:"",requirements:{minMembers:28,minPower:1400,minStones:4e4,minElders:2,minSovereigns:1},feedbackMultiplier:100,feedbackDesc:"100.0 (+9900%)"}],U2=e=>{const t=Gs.find(n=>n.id===e);return(t==null?void 0:t.feedbackMultiplier)??1},G2=e=>{const t=Ve.findIndex(n=>n.name===e);return Math.max(0,t)*8},V2=(e,t)=>{if(!e)return t?6:0;const n=L2(e);return n>0?n:H2[e]??(t?6:0)},Y2=e=>e?W2[e.level]??10:0,q2=e=>e?e.includes("")?18:e===""?8:e===""?40:0:0,Ey=e=>Math.max(0,Math.min(1,e)),jy=(e={})=>{if(!e)return{score:0,tierId:Tr[0].id,label:Tr[0].label,color:Tr[0].color,progress:0,tagline:Tr[0].tagline,tierStart:0,nextThreshold:Tr[1].minScore,isElder:!1,isSovereign:!1};const t=e.tierTitle||e.tier||"",n=G2(t),s=V2(e.rank,!!e.sect),o=Y2(e.sect),i=q2(e.rank),a=e.cultivationManual?8:0,l=e.spouse?5:0,d=Math.round(n+s+o+i+a+l),u=[...Tr].reverse().find(j=>d>=j.minScore)||Tr[0],p=Tr.findIndex(j=>j.id===u.id),c=Tr[p+1]||null,f=c?Math.max(1,c.minScore-u.minScore):1,b=c?Ey((d-u.minScore)/f):1,S=e.rank&&(e.rank.includes("")||e.rank===""),E=e.rank==="";return{score:d,tierId:u.id,label:u.label,color:u.color,tagline:u.tagline,tierStart:u.minScore,nextThreshold:(c==null?void 0:c.minScore)??d,progress:b,nextLabel:(c==null?void 0:c.label)||"",isElder:S||u.id==="ELDER"||u.id==="SOVEREIGN",isSovereign:E||u.id==="SOVEREIGN"}},Cy=Gs[0],K2=e=>{const t=Gs.findIndex(n=>n.id===e);return t>=0?{tier:Gs[t],index:t}:{tier:Cy,index:0}},Ir=(e,t,n)=>({label:e,current:t,required:n,met:t>=n}),Q2={:7,:6,:5,:4,:3,:2,:1,:0},J2=e=>e?Q2[e]??-1:-1,ll=(e,t)=>e.filter(n=>J2(n.rank)>=t).length,X2=(e=[],t={})=>{var C,k,R,T;const n=((C=t.familyRating)==null?void 0:C.currentId)||Cy.id,{tier:s,index:o}=K2(n),i=Gs[o+1]||null,a=e.filter(N=>(N.generation||1)<=2),l=a.map(N=>({id:N.id,name:N.name,generation:N.generation,influence:jy(N)})),d=l.reduce((N,Y)=>N+Y.influence.score,0),u=l.filter(N=>N.influence.isElder).length,p=l.filter(N=>N.influence.isSovereign).length,c=ll(a,1),f=ll(a,2),b=ll(a,3),S=ll(a,4),E=e.length+1,j=((k=t.resources)==null?void 0:k.spiritStones)||0,x=Math.round(d+E*5+j/200),h=((R=s.requirements)==null?void 0:R.minPower)??0,v=((T=i==null?void 0:i.requirements)==null?void 0:T.minPower)??x,g=i?Ey((x-h)/Math.max(1,v-h)):1,I=[];if(i){const N=i.requirements||{};N.minMembers!==void 0&&I.push(Ir("",E,N.minMembers)),N.minPower!==void 0&&I.push(Ir("",x,N.minPower)),N.minStones!==void 0&&I.push(Ir("",j,N.minStones)),N.minOuterDoor!==void 0&&I.push(Ir("",c,N.minOuterDoor)),N.minInnerDoor!==void 0&&I.push(Ir("",f,N.minInnerDoor)),N.minDiscipleRank!==void 0&&I.push(Ir("",b,N.minDiscipleRank)),N.minSteward!==void 0&&I.push(Ir("",S,N.minSteward)),N.minElders!==void 0&&I.push(Ir("",u,N.minElders)),N.minSovereigns!==void 0&&I.push(Ir("",p,N.minSovereigns))}const _=i?I.every(N=>N.met):!1;return{enrichedChildren:l,childInfluenceMap:l.reduce((N,Y)=>(N[Y.id]=Y.influence,N),{}),totals:{population:E,stones:j,totalPower:d,elderCount:u,sovereignCount:p,outerDoorCount:c,innerDoorCount:f,discipleRankCount:b,stewardCount:S,ratingScore:x,powerProgress:g},currentTier:s,currentIndex:o,nextTier:i,requirements:I,canUpgrade:_}},_r=fa[0],Ll=zl(),Z2={...Ll.spiritRoot},Eo={name:"",age:16,gender:"",avatar:{base:0,skinColor:0,hair:1,hairColor:0,eye:0,eyeColor:1,mouth:0},tier:Ll.tier,currentExp:Ll.currentExp,maxExp:Ll.maxExp,resources:{spiritStones:100,money:50},stats:{looks:80,cunning:60,aptitude:15,intelligence:60,health:80},familyRating:{currentId:Gs[0].id,history:[]},skillPoints:0,usedRedeemCodes:[],breakthroughBonus:0,breakthroughFailCount:0,newsBuffer:[],gazetteHistory:[],gazetteIssue:0,hasUnreadGazette:!1,worldNpcs:[],specialCollections:{fumoSwords:[]},specialFlags:{fumoDuoUnlocked:!1,fumoDuoMet:!1},rival:{name:_r.name,stageId:_r.id,state:"NORMAL",lifeStage:0,storyTimer:0,threatLevel:_r.baseThreat??0,rumorCount:0,hiddenTurns:0,isDead:!1,relationValue:-100,tier:_r.tier,currentExp:_r.baseExp,stats:{aptitude:95,looks:80,intelligence:90,health:80},combatStats:{hp:_r.combatStats.hp,maxHp:_r.combatStats.maxHp,atk:_r.combatStats.atk,def:_r.combatStats.def}},revengeProgress:{currentStageIndex:0,completedStages:[],sagaComplete:!1},revengeActions:{lastRumorMonth:0,totalRumors:0,assassinationAttempts:0,hidingMonths:0},spiritRoot:Z2,cultivationMethod:"basic_breath",combatStats:{hp:300,maxHp:300,atk:25,def:8,mp:120,maxMp:120},time:{year:3572,month:9,season:""},status:["",""],childrenStrategy:{skipZhaozhou:!1}},ew={aptitude:{name:"",desc:"",trainable:!0,howToIncrease:"",howToRestore:"",effect:""},luck:{name:"",desc:"",trainable:!0,howToIncrease:"NPC",howToRestore:"",effect:""},lifespan:{name:"",desc:"",trainable:!1,howToIncrease:"",effect:""},looks:{name:"",desc:"",trainable:!0,howToIncrease:"",howToRestore:"",effect:""},cunning:{name:"",desc:"",trainable:!0,howToIncrease:"",howToRestore:"/",effect:""},health:{name:"",desc:"0-100",trainable:!1,howToIncrease:"NPC",howToRestore:"5-10",effect:"4020",energyLimitFormula:"max(5, 20 - (100 - health) * 0.15)  // "},intelligence:{name:"",desc:"",trainable:!0,howToIncrease:"",howToRestore:"",effect:""}};function tw(e){return ew[e]||{name:e,desc:"",trainable:!1,howToIncrease:"",howToRestore:"",effect:""}}function $t(e,t=20){if(e==null)return t;const s=(100-Math.max(0,Math.min(100,e)))*.15;return Math.max(5,t-s)}function nw(e,t){const n=Math.max(0,e-t),s=e-n;let o="";return s>30?o="":s>15&&(o=""),{newHealth:n,healthLost:s,severity:o,damageDisplay:`${o} ${s} ${e}  ${n}`}}const Hm={EXPLORATION:{name:"",icon:"",minDamage:5,maxDamage:20,severity:""},ASSASSINATION:{name:"",icon:"",minDamage:15,maxDamage:40,severity:""},DUEL:{name:"",icon:"",minDamage:20,maxDamage:50,severity:""},ROMANCE:{name:"",icon:"",minDamage:3,maxDamage:10,severity:""},DISASTER:{name:"",icon:"",minDamage:10,maxDamage:30,severity:""}};function Wo(e,t,n="EXPLORATION"){var p;const s=((p=e.stats)==null?void 0:p.health)||50,o=Hm[n]||Hm.EXPLORATION,i=nw(s,t),a=$t(s),l=$t(i.newHealth),d=a-l,u=`
${o.icon} ${o.name}
${i.damageDisplay}

${i.newHealth<20?" ":""}
${d>0?`  ${d.toFixed(1)}  ${a.toFixed(1)}  ${l.toFixed(1)}`:""}
  `.trim();return{newHealth:i.newHealth,healthLost:i.healthLost,severity:i.severity,message:u,energyPenalty:Math.max(0,d),isSerious:i.newHealth<20}}function rw(e,t,n="REST"){var f;const s=((f=e.stats)==null?void 0:f.health)||50,o=$t(s),i=Math.min(100,s+t),a=i-s,l=$t(i),d=l-o;let u="",p="";n==="MEDICINE"?(u="",p=""):n==="HEALER"&&(u="",p="");const c=`
${u} ${p}
 ${a} ${s}  ${i}

${d>0?`  ${d.toFixed(1)}  ${o.toFixed(1)}  ${l.toFixed(1)}`:""}
${i===100?" ":""}
  `.trim();return{newHealth:i,recovered:a,message:c,energyBonus:Math.max(0,d)}}function sw(e){var d;const t=((d=e.stats)==null?void 0:d.health)||50,n=5+Math.floor(Math.random()*6),s=e.currentExp||0,o=Math.floor(s/1e3*.5),i=n+o,a=Math.min(100,t+i),l=a-t;return{newHealth:a,recovered:l,message:l>0?` +${l}${t}  ${a}`:null}}function Tf(e){var n;const t=((n=e.stats)==null?void 0:n.health)||50;return{canExplore:t>=20,canDuel:t>=30,canAssassinate:t>=25,health:t,reason:t<20?"":t<30?"":""}}function ow(){const[e,t]=y.useState({...Eo,businesses:[],gazetteHistory:[],gazetteIssue:0,hasUnreadGazette:!1,newsBuffer:[],lastAuctionYear:null,currentAuction:null,auctionWindowStart:null,auctionWindowEnd:null,energy:Eo.energy??20,soldAuctionItems:[]}),n=y.useCallback(k=>{t(R=>({...R,...k}))},[]),s=y.useCallback(k=>{t(R=>{const T={...R.stats,...k};let N=R.energy;if(typeof k.health=="number"){const Y=$t(k.health);N=Math.min(R.energy,Y)}return{...R,stats:T,energy:N}})},[]),o=y.useCallback(k=>{t(R=>({...R,time:{...R.time,...k}}))},[]),i=y.useCallback(k=>{t(R=>({...R,cultivation:typeof k=="function"?k(R.cultivation):k}))},[]),a=y.useCallback(k=>{t(R=>{const T={...R.resources};return k.spirit&&(T.spirit=(R.resources.spirit||0)+k.spirit),k.spirit2&&(T.spirit2=(R.resources.spirit2||0)+k.spirit2),k.spiritStones!==void 0&&(T.spiritStones=(R.resources.spiritStones||0)+k.spiritStones),{...R,resources:T}})},[]),l=y.useCallback(k=>{t(R=>{const T={...R.resources};return k.spirit&&(T.spirit=Math.max(0,(R.resources.spirit||0)-k.spirit)),k.spirit2&&(T.spirit2=Math.max(0,(R.resources.spirit2||0)-k.spirit2)),k.spiritStones!==void 0&&(T.spiritStones=Math.max(0,(R.resources.spiritStones||0)-k.spiritStones)),{...R,resources:T}})},[]),d=y.useCallback(k=>{t(R=>({...R,energy:typeof k=="function"?k(R.energy||0):Math.max(0,(R.energy||0)+k)}))},[]),u=y.useCallback((k=1)=>{t(R=>({...R,energy:Math.max(0,(R.energy||0)-k)}))},[]),p=y.useCallback(k=>{t(R=>({...R,resources:{...R.resources,spiritStones:Math.max(0,R.resources.spiritStones-k.cost)},businesses:[...R.businesses,k]}))},[]),c=y.useCallback(({won:k,expGain:R=0,spiritStones:T=0,health:N,healthDamage:Y,injurySource:H,onNotify:B})=>{t($=>{const q={...$};if(R&&(q.currentExp=($.currentExp||0)+R),T!==0&&(q.resources={...$.resources,spiritStones:T>0?$.resources.spiritStones+T:Math.max(0,$.resources.spiritStones+T)}),N!==void 0){q.stats={...$.stats,health:N};const se=$t(N);q.energy=Math.min($.energy||20,se)}else if(Y&&Y>0){const se=Wo($,Y,H||"EXPLORATION");if(q.stats={...$.stats,health:se.newHealth},se.energyPenalty>0){const J=$t(se.newHealth);q.energy=Math.min($.energy||20,J)}B&&B({type:"health_damage",message:se.message,severity:se.severity,isSerious:se.isSerious})}return q})},[]),f=y.useCallback((k,R="EXPLORATION",T)=>{t(N=>{const Y=Wo(N,k,R);T&&T({type:"health_damage",message:Y.message,severity:Y.severity,isSerious:Y.isSerious,energyPenalty:Y.energyPenalty});let H=N.energy||20;if(Y.energyPenalty>0){const B=$t(Y.newHealth);H=Math.min(H,B)}return{...N,stats:{...N.stats,health:Y.newHealth},energy:H}})},[]),b=y.useCallback((k,R="REST",T)=>{t(N=>{const Y=rw(N,k,R);return T&&Y.message&&T({type:"health_recovery",message:Y.message,energyBonus:Y.energyBonus}),{...N,stats:{...N.stats,health:Y.newHealth}}})},[]),S=y.useCallback((k="explore")=>Tf(e),[e]),E=y.useCallback(()=>{var k;return $t(((k=e.stats)==null?void 0:k.health)||50)},[e]),j=y.useCallback((k,R)=>{t(T=>({...T,worldNpcs:(T.worldNpcs||[]).map(N=>N.id===k?{...N,...R}:N)}))},[]),x=y.useCallback(k=>{t(R=>({...R,worldNpcs:k(R.worldNpcs||[])}))},[]),h=y.useCallback(k=>{t(R=>({...R,newsBuffer:[...R.newsBuffer||[],k]}))},[]),v=y.useCallback(()=>{t(k=>({...k,newsBuffer:[]}))},[]),g=y.useCallback((k,R)=>{t(T=>{var Y;const N=Array.isArray((Y=T.specialCollections)==null?void 0:Y[k])?T.specialCollections[k]:[];return N.includes(R)?T:{...T,specialCollections:{...T.specialCollections||{},[k]:[...N,R]}}})},[]),I=y.useCallback(()=>{t(k=>{const T=$t(10);return{...k,currentExp:0,stats:{...k.stats,health:10},energy:Math.min(k.energy||20,T),resources:{...k.resources,spiritStones:Math.floor(k.resources.spiritStones*.5)}}})},[]),_=y.useCallback(k=>{t(R=>({...R,inventory:[...R.inventory||[],k]}))},[]),C=y.useCallback(k=>{t(R=>({...R,inventory:(R.inventory||[]).filter(T=>T.id!==k)}))},[]);return{player:e,setPlayer:t,updatePlayer:n,updatePlayerStats:s,updatePlayerTime:o,updatePlayerCultivation:i,addResources:a,consumeResources:l,updateEnergy:d,consumeEnergy:u,purchaseBusiness:p,applyCombatResult:c,applyHealthDamageWithNotify:f,applyHealthRecovery:b,checkHealthStatus:S,getEnergyLimit:E,updateWorldNpc:j,updateWorldNpcs:x,addNewsToBuffer:h,clearNewsBuffer:v,addToSpecialCollection:g,applyDefeatPenalty:I,addInventoryItem:_,removeInventoryItem:C}}const iw={aptitude:85,looks:90,intelligence:80},Ty=[{id:1,name:"",gender:"",age:25,identity:"",desc:"",avatar:{base:0,skinColor:1,hair:0,hairColor:0,eye:0,eyeColor:0,mouth:1},...(()=>{const e=zl();return{tier:e.tier,currentExp:e.currentExp,maxExp:e.maxExp,spiritRoot:e.spiritRoot}})(),stats:iw,combatStats:{hp:2e3,maxHp:2e3,atk:180,mp:800},sect:Sy("SWORD"),sectId:"SWORD",sectRank:"",sectStatus:"defected",appearance:"...",personality:{label:"",tag:"",desc:""},relationship:{stage:1,affection:10,trust:20,jealousy:0},likes:["",""],dislikes:[""],isPregnant:!1},{id:2,name:"",gender:"",age:38,identity:"",desc:"",avatar:{base:0,skinColor:2,hair:-1,hairColor:null,eye:0,eyeColor:0,mouth:1},...(()=>{const e=zl();return{tier:e.tier,currentExp:e.currentExp,maxExp:e.maxExp,spiritRoot:e.spiritRoot}})(),stats:{aptitude:95,looks:40,intelligence:95},combatStats:{hp:1800,maxHp:1800,atk:200,mp:1200},sect:null,sectId:null,sectRank:"",sectStatus:"mysterious",personality:{label:"",tag:"",desc:""},relationship:{stage:1,affection:5,trust:10,jealousy:0},likes:[""],dislikes:[],isPregnant:!1}];function ms(e={}){var x,h,v,g;const t=e.currentExp||e.cultivation||0,n=e.combatStats||{},s=n.atk||Math.floor((((x=e.stats)==null?void 0:x.aptitude)||50)*.8),o=n.def||Math.floor((((h=e.stats)==null?void 0:h.aptitude)||50)*.4),i=n.maxHp||Math.floor(t+(((v=e.stats)==null?void 0:v.health)||50)*10),a=45,l=1,d=22,u=.08,p=18,c=Math.floor(s*a),f=Math.floor(i*l),b=Math.floor(o*d),S=Math.floor(t*u),E=Math.floor((((g=e.stats)==null?void 0:g.aptitude)||50)*p);return{total:Math.max(1,c+f+b+S+E),breakdown:{atk:c,hp:f,def:b,exp:S,aptitude:E},details:{atk:s,def:o,maxHp:i}}}function aw(e={},t={}){var j,x,h,v,g,I;const n=e.combatStats||{},s=t.combatStats||{},o=n.atk||Math.max(1,Math.floor((((j=e.stats)==null?void 0:j.aptitude)||50)*.8)),i=n.def||Math.max(0,Math.floor((((x=e.stats)==null?void 0:x.aptitude)||50)*.4)),a=n.maxHp||Math.max(1,Math.floor((e.currentExp||e.cultivation||0)+(((h=e.stats)==null?void 0:h.health)||50)*10)),l=s.atk||Math.max(1,Math.floor((((v=t.stats)==null?void 0:v.aptitude)||50)*.8)),d=s.def||Math.max(0,Math.floor((((g=t.stats)==null?void 0:g.aptitude)||50)*.4)),u=s.maxHp||Math.max(1,Math.floor((t.currentExp||t.cultivation||0)+(((I=t.stats)==null?void 0:I.health)||50)*10)),p=Math.max(1,o-Math.floor(d/2)),c=Math.max(1,l-Math.floor(i/2)),f=Math.ceil(u/p),b=Math.ceil(a/c),S=b-f;let E;return S>=3?E=.98:S===2?E=.92:S===1?E=.78:S===0?E=.55:S===-1?E=.28:S===-2?E=.12:E=.03,{prob:E,roundsToKillEnemy:f,roundsToDie:b,pDpr:p,eDpr:c}}const cl=[{id:"farm",name:"",cost:500,baseIncome:50,desc:"",minTier:""},{id:"mine",name:"",cost:2e3,baseIncome:200,desc:"",minTier:""},{id:"auction",name:"",cost:1e4,baseIncome:1500,desc:"",minTier:""},{id:"sect_branch",name:"",cost:5e4,baseIncome:8e3,desc:"",minTier:""}],Iy=[{id:"peach_island",name:"",reqTier:"",recommendCP:300,cost:10,drops:["herb_bandage","iron_sword","rice_ball","beast_core"],risk:.05,desc:"",resourceLevel:"MORTAL",dropTable:[{item:"herb_bandage",weight:.25},{item:"iron_sword",weight:.25},{item:"rice_ball",weight:.3},{item:"beast_core",weight:.2}]},{id:"snake_valley",name:"",reqTier:"",recommendCP:5e3,cost:50,drops:["beast_core","beast_fang","herb_bandage"],risk:.15,desc:"",resourceLevel:"SPIRIT",dropTable:[{item:"beast_core",weight:.3},{item:"beast_fang",weight:.4},{item:"herb_bandage",weight:.3}]},{id:"thunder_peak",name:"",reqTier:"",recommendCP:8e4,cost:300,drops:["thunder_wood","iron_armor","foundation_pill","beast_fang"],risk:.25,desc:"",resourceLevel:"SPIRIT",dropTable:[{item:"thunder_wood",weight:.3},{item:"iron_armor",weight:.3},{item:"foundation_pill",weight:.2},{item:"beast_fang",weight:.2}]},{id:"ancient_tomb",name:"",reqTier:"",recommendCP:15e4,cost:500,drops:["core_pill","milk_millennium","marrow_wash","moonshadow_saber"],risk:.4,desc:"",resourceLevel:"EARTH",dropTable:[{item:"core_pill",weight:.25},{item:"milk_millennium",weight:.25},{item:"marrow_wash",weight:.25},{item:"moonshadow_saber",weight:.25}]},{id:"demon_domain",name:"",reqTier:"",recommendCP:8e5,cost:2e3,drops:["nascent_fruit","heaven_manual","divine_egg","storm_piercer","core_pill"],risk:.6,desc:"",resourceLevel:"HEAVEN",dropTable:[{item:"nascent_fruit",weight:.25},{item:"heaven_manual",weight:.25},{item:"divine_egg",weight:.25},{item:"storm_piercer",weight:.15},{item:"core_pill",weight:.1}]},{id:"star_sea_realm",name:"",reqTier:"",recommendCP:16e5,cost:5e3,drops:["starlight_pill","cosmic_crystal","void_silk","nascent_fruit"],risk:.7,desc:"",resourceLevel:"HEAVEN",dropTable:[{item:"starlight_pill",weight:.3},{item:"cosmic_crystal",weight:.3},{item:"void_silk",weight:.2},{item:"nascent_fruit",weight:.2}]},{id:"immortal_cave",name:"",reqTier:"",recommendCP:8e6,cost:2e4,drops:["primordial_spirit_pill","heavenly_jade","soul_essence_crystal"],risk:.75,desc:"",resourceLevel:"DIVINE",dropTable:[{item:"primordial_spirit_pill",weight:.3},{item:"heavenly_jade",weight:.35},{item:"soul_essence_crystal",weight:.35}]},{id:"celestial_pagoda",name:"",reqTier:"",recommendCP:16e6,cost:5e4,drops:["nine_heaven_pill","star_core_fragment","celestial_silk_cloth"],risk:.8,desc:"",resourceLevel:"DIVINE",dropTable:[{item:"nine_heaven_pill",weight:.25},{item:"star_core_fragment",weight:.35},{item:"celestial_silk_cloth",weight:.4}]},{id:"abyss_deeps",name:"",reqTier:"",recommendCP:32e6,cost:1e5,drops:["soul_splitting_pill","abyss_stone","abyssal_essence"],risk:.85,desc:"",resourceLevel:"DIVINE",dropTable:[{item:"soul_splitting_pill",weight:.2},{item:"abyss_stone",weight:.4},{item:"abyssal_essence",weight:.4}]},{id:"divine_transformation_realm",name:"",reqTier:"",recommendCP:8e7,cost:3e5,drops:["god_transformation_pill","divine_tribulation_stone","god_marrow"],risk:.8,desc:"",resourceLevel:"DIVINE",dropTable:[{item:"god_transformation_pill",weight:.2},{item:"divine_tribulation_stone",weight:.4},{item:"god_marrow",weight:.4}]},{id:"soul_refining_abyss",name:"",reqTier:"",recommendCP:16e7,cost:5e5,drops:["divine_soul_pill","divine_essence_core","soul_tempering_stone"],risk:.82,desc:"",resourceLevel:"DIVINE",dropTable:[{item:"divine_soul_pill",weight:.2},{item:"divine_essence_core",weight:.4},{item:"soul_tempering_stone",weight:.4}]},{id:"void_condensing_heaven",name:"",reqTier:"",recommendCP:32e7,cost:8e5,drops:["void_condensing_pill","void_manifold_crystal","condensed_void_essence"],risk:.85,desc:"",resourceLevel:"DIVINE",dropTable:[{item:"void_condensing_pill",weight:.15},{item:"void_manifold_crystal",weight:.42},{item:"condensed_void_essence",weight:.43}]},{id:"immortal_ascension_peak",name:"",reqTier:"",recommendCP:4e8,cost:15e5,drops:["heaven_defying_pill","celestial_ascension_token","immortal_transformation_essence"],risk:.9,desc:"",resourceLevel:"DIVINE",dropTable:[{item:"heaven_defying_pill",weight:.15},{item:"celestial_ascension_token",weight:.42},{item:"immortal_transformation_essence",weight:.43}]}],$l=e=>ms(e).total||0,pc=(e=[])=>e[Math.floor(Math.random()*e.length)],_y=["","","","","","","","","","","","","","","","",""],lw=["","","","","","","","","","","","","","","","","","","","","","","","","","","","","",""],Jd={male:["","","","","","","","","","","","","","","","","","","",""],female:["","","","","","","","","","","","","","","","","","","",""],neutral:["","","","","","","","","","","","","","","","","","","",""]},cw=["","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","",""],dw=new Set(_y);function uw(){return pc(cw)}function Wm(e=""){const t=(e||"").replace(/\s+/g,"");if(!t)return"";const n=t.slice(0,2);return dw.has(n)?n:t.charAt(0)}const pw=()=>Math.random()<.15?pc(_y):pc(lw),fw=(e="")=>{const t=e===""?Jd.female:Jd.male,n=[...Jd.neutral,...t];return pc(n)};function If(e="",t={}){const{motherName:n="",fatherName:s="",preferSurname:o=""}=t,i=o||Wm(n)||Wm(s)||pw(),a=fw(e);return`${i}${a}`}const mw=[{base:"#FFDFC4",shadow:"#F0D5B1"},{base:"#F0D5B1",shadow:"#E0B87E"},{base:"#E0B87E",shadow:"#C59D74"},{base:"#A16E4B",shadow:"#815336"}],fp=["#2C2C2C","#5C3A21","#A88B45","#8D2323","#F2F2F2"],hw=["#333333","#4A90E2","#50E3C2","#F5A623","#D0021B"],gw=[{skinPixels:[[4,2],[5,2],[6,2],[7,2],[8,2],[9,2],[10,2],[11,2],[3,3],[4,3],[5,3],[6,3],[7,3],[8,3],[9,3],[10,3],[11,3],[12,3],[3,4],[4,4],[5,4],[6,4],[7,4],[8,4],[9,4],[10,4],[11,4],[12,4],[3,5],[4,5],[5,5],[6,5],[7,5],[8,5],[9,5],[10,5],[11,5],[12,5],[3,6],[4,6],[5,6],[6,6],[7,6],[8,6],[9,6],[10,6],[11,6],[12,6],[3,7],[4,7],[5,7],[6,7],[7,7],[8,7],[9,7],[10,7],[11,7],[12,7],[3,8],[4,8],[5,8],[6,8],[7,8],[8,8],[9,8],[10,8],[11,8],[12,8],[3,9],[4,9],[5,9],[6,9],[7,9],[8,9],[9,9],[10,9],[11,9],[12,9],[4,10],[5,10],[6,10],[7,10],[8,10],[9,10],[10,10],[11,10],[5,11],[6,11],[7,11],[8,11],[9,11],[10,11],[6,12],[7,12],[8,12],[9,12]],shadowPixels:[[3,4],[3,5],[3,6],[3,7],[3,8],[3,9],[12,4],[12,5],[12,6],[12,7],[12,8],[12,9],[4,10],[11,10],[5,11],[10,11],[6,12],[9,12],[7,9],[8,9]]}],xw=[{whitePixels:[[5,7],[6,7],[9,7],[10,7]],pupilPixels:[[6,7],[9,7]],browPixels:[[5,6],[6,6],[9,6],[10,6]]},{whitePixels:[[4,7],[5,7],[6,7],[9,7],[10,7],[11,7]],pupilPixels:[[5,7],[10,7]],browPixels:[[4,6],[5,6],[10,6],[11,6]]},{whitePixels:[[5,7],[6,7],[5,8],[9,7],[10,7],[10,8]],pupilPixels:[[6,7],[6,8],[9,7],[9,8]],browPixels:[[5,6],[6,6],[9,6],[10,6]]}],yw=[[[6,11],[9,11],[7,12],[8,12]],[[6,11],[7,11],[8,11],[9,11]],[[7,11],[8,11],[9,11],[10,10]]],bw=[[[6,0],[7,0],[8,0],[9,0],[5,1],[6,1],[7,1],[8,1],[9,1],[10,1],[4,2],[5,2],[6,2],[7,2],[8,2],[9,2],[10,2],[11,2],[3,3],[4,3],[11,3],[12,3],[3,4],[12,4],[2,5],[3,5],[12,5],[13,5],[2,6],[13,6],[2,7],[13,7],[1,8],[2,8],[13,8],[14,8],[7,3],[8,3],[7,4],[8,4]],[[5,1],[6,1],[7,1],[8,1],[9,1],[10,1],[4,2],[5,2],[6,2],[7,2],[8,2],[9,2],[10,2],[11,2],[3,3],[4,3],[5,3],[6,3],[7,3],[8,3],[9,3],[10,3],[11,3],[12,3],[2,4],[3,4],[4,4],[11,4],[12,4],[13,4],[2,5],[3,5],[12,5],[13,5],[1,6],[2,6],[3,6],[12,6],[13,6],[14,6],[1,7],[2,7],[13,7],[14,7],[1,8],[2,8],[13,8],[14,8],[2,9],[3,9],[12,9],[13,9],[2,10],[3,10],[12,10],[13,10]],[[6,0],[7,0],[8,0],[9,0],[5,1],[6,1],[9,1],[10,1],[6,2],[7,2],[8,2],[9,2],[5,3],[6,3],[7,3],[8,3],[9,3],[10,3],[4,4],[5,4],[10,4],[11,4],[4,5],[5,5],[10,5],[11,5],[3,6],[4,6],[11,6],[12,6],[7,1],[8,1]]],He=e=>!e||e.length===0?null:e[Math.floor(Math.random()*e.length)],vw={low:["{playerName}","{playerName}","{playerName}{gender_ta}","{playerName}"],medium:["{playerName}{gender_ta}","{playerName}","{playerName}","{playerName}{gender_ta}"],high:["{playerName}","{playerName}{gender_ta}","{playerName}","{playerName}{gender_ta}{gender_ta}..."]},Um={:{low:["{playerName}","{playerName}...","{playerName}"],medium:["{playerName}{gender_ta}","{playerName}","{playerName}{gender_ta}"],high:["{playerName}{gender_ta}","{playerName}...","{playerName}"]},:{low:["{playerName}","{playerName}{gender_ta}","{playerName}{gender_ta}"],medium:["{playerName}{gender_ta}","{playerName}{gender_ta}","{playerName}"],high:["{playerName}{gender_ta}{gender_ta}","{playerName}","{playerName}{gender_ta}{gender_ta}"]},:{low:["{playerName}{gender_ta}...","{playerName}{gender_ta}","{playerName}"],medium:["{playerName}......","{playerName}{gender_ta}","{playerName}"],high:["{playerName}.........{gender_ta}...","{playerName}{gender_ta}","{playerName}{gender_ta}"]},:{low:["{playerName}...{gender_ta}","{playerName}{gender_ta}...","{playerName}...{gender_ta}"],medium:["{playerName}{gender_ta}...","{playerName}...","{playerName}{gender_ta}..."],high:["{playerName}...{gender_ta}{gender_ta}...","{playerName}{gender_ta}...","{playerName}..."]},:{low:["{playerName}","{playerName}","{playerName}{gender_ta}"],medium:["{playerName}{gender_ta}","{playerName}","{playerName}{gender_ta}"],high:["{playerName}","{playerName}{gender_ta}","{playerName}{gender_ta}"]},:{low:["{playerName}","{playerName}","{playerName}{gender_ta}"],medium:["{playerName}{gender_ta}","{playerName}","{playerName}{gender_ta}"],high:["{playerName}","{playerName}{gender_ta}","{playerName}...~"]},:{low:["{playerName}{gender_ta}","{playerName}{gender_ta}","{playerName}"],medium:["{playerName}{gender_ta}","{playerName}{gender_ta}","{playerName}{gender_ta}"],high:["{playerName}{gender_ta}","{playerName}{gender_ta}","{playerName}{gender_ta}"]},:{low:["{playerName}","{playerName}","{playerName}"],medium:["{playerName}{gender_ta}","{playerName}{gender_ta}","{playerName}{gender_ta}"],high:["{playerName}","{playerName}","{playerName}{gender_ta}"]}},Sw=["{playerName}{giftName}{gender_ta}","{playerName}{giftName}{gender_ta}","{playerName}{giftName}{gender_ta}","{giftName}{playerName}{gender_ta}"],Gm={:["{playerName}{giftName}......{gender_ta}","{giftName}{playerName}","{playerName}{giftName}...{gender_ta}"],:["{playerName}{giftName}...{gender_ta}","{playerName}{giftName}{gender_ta}","{giftName}{playerName}..."],:["{playerName}{giftName}......","{giftName}...{playerName}","{playerName}{giftName}{gender_ta}"],:["{playerName}{giftName}...{gender_ta}...","{playerName}{giftName}{gender_ta}...","{giftName}...{playerName}{gender_ta}..."],:["{playerName}{giftName}","{playerName}{giftName}{gender_ta}","{giftName}{playerName}"],:["{playerName}{giftName}{gender_ta}","{giftName}{playerName}","{playerName}{giftName}"],:["{playerName}{giftName}{gender_ta}","{playerName}{giftName}{gender_ta}","{giftName}...{playerName}"],:["{playerName}{giftName}","{playerName}{giftName}","{giftName}...{playerName}"]},ww=["{playerName},{gender_ta},","{playerName},{gender_ta},,","{playerName},,",",{playerName}{gender_ta}"],Vm={:["{playerName},","{playerName},,",",{playerName},"],:["{playerName},...{gender_ta},","{playerName},{gender_ta}","{playerName},{gender_ta}"],:["!{playerName}!!()","{playerName}~{gender_ta}!!()","~,{playerName}!{gender_ta}!"],:["{playerName}...{gender_ta},{gender_ta}...","{playerName}{gender_ta}?...{gender_ta},{gender_ta}...","{playerName},{gender_ta},..."],:["{playerName},!!","{playerName},!",",{playerName}!!"],:["!{playerName}!!!","!{playerName}!,{gender_ta}!","{playerName}!,!!"],:["{playerName},","{playerName},",",{playerName}"],:["{playerName},,","{playerName},,",",{playerName},,"]},kw=["{playerName},...{gender_ta}!","{playerName},,...!{gender_ta},","{playerName},,{gender_ta}","{playerName},{gender_ta},..."],Ym={:["{playerName}...,","{playerName}...,","{playerName},,"],:["{playerName}...{gender_ta},","{playerName},,{gender_ta}","{playerName},{gender_ta}{gender_ta}..."],:["{playerName}...!()","{playerName}!!!!()","!!{playerName}!!"],:["{playerName}...{gender_ta}{gender_ta}...,{gender_ta}...","{playerName},{gender_ta}...{gender_ta}...","...{playerName},{gender_ta}......"],:["{playerName},{gender_ta}!","{playerName},!!",",{playerName},,{gender_ta}!"],:["!{playerName}!!{gender_ta}!","!{playerName}!!!!","{playerName}!{gender_ta}!!"],:["{playerName},,","{playerName},","!{playerName},!"],:["{playerName},,","{playerName},",",{playerName},"]},Ew=["{playerName},,{gender_ta}...",",{playerName},","{playerName},{gender_ta},",",{playerName},..."],qm={:["{playerName},,{gender_ta}",",{playerName}...{gender_ta}","{playerName},{gender_ta},"],:["{playerName},...{gender_ta},",",{playerName},,...","{playerName},{gender_ta}..."],:["{playerName}!{gender_ta}!!","!,!{playerName}...()","{playerName}!{gender_ta}!...(){gender_ta}..."],:["{playerName}...,{gender_ta},...",",{playerName}......","{playerName},{gender_ta},......"],:["{playerName},,{gender_ta},",",{playerName},","{playerName},,"],:["!{playerName}!!","{playerName}!{gender_ta}!!","{playerName}!!!"],:["{playerName},,{gender_ta}",",{playerName},","{playerName},"],:["{playerName},,",",{playerName},","{playerName},,,"]},jw=["{playerName}...","{playerName}...","...{playerName}","{playerName}...","{playerName}"],Xd={early:["...","","{playerName}","...''",""],mid:["...{playerName}","...","{playerName}","","","..."],late:["...","{playerName}","...","...","{playerName}","''..."]},Cw=["...{childName}","{childName}","...{playerName}","{gender_ta}{childName}{playerName}","{childName}"],Tw=["{newTier}","{newTier}","{newTier}","{newTier}","{newTier}"],Km={:["{newTier}","{newTier}","{newTier}"],:["{newTier}...{playerName}","{newTier}","{newTier}"],:["{newTier}","{newTier}...","{newTier}{playerName}"],:["{newTier}...{playerName}...","{newTier}{playerName}...","...{playerName}{gender_ta}..."],:["{newTier}","{newTier}","{newTier}"],:["{newTier}","{newTier}","{newTier}"],:["...{newTier}","{newTier}","{newTier}"],:["{newTier}","{newTier}","{newTier}"]},Iw=["...","","...","{targetTier}"],Qm={:["...","",""],:["...","...","..."],:["","...","......"],:["...{playerName}...","...{playerName}...","...{playerName}..."],:["","...",""],:["","~","......"],:["...","...",""],:["","",""]},_w=["{spouseName}","{spouseName}{gender_ta}","{spouseName}","{spouseName}{gender_ta}"],Rw=["...","","...","","{playerName}..."],Zd={:["''","","",""],:["{playerName}","","",""],:["","",""],:["","",""],:["","","...",""],:["...","","","..."],:["","","",""],:["","","",""],:["","","",""],:["","","","{gender_ta}"]},Mw={:["","","","''"],:["","","",""],:["","{playerName}...{gender_ta}","{playerName}{gender_ta}","{playerName}..."],:["{playerName}{gender_ta}...","{playerName}{gender_ta}{gender_ta}","{playerName}...","{playerName}...{gender_ta}"],:["","","",""],:["","...","","{gender_ta}"]},eu={stranger:["","","",""],crush:["{playerName}","{playerName}{gender_ta}","{playerName}...","{playerName}{gender_ta}{gender_ta}...","{playerName}{gender_ta}"],spouse:["{playerName}{gender_ta}...","{playerName}{gender_ta}","{playerName}","{playerName}{gender_ta}{gender_ta}"]},Aw=["","","",""],Nw=["","","...",""],Lw=["...","","",""],$w=["","","{gender_ta}",""],Bw=["","","",""],_f=["","","","",""],Jm={:["",""],:["",""],:["{playerName}{playerName}","",""],:["{playerName}","",""]},Xm={:{low:["",""],medium:["","{gender_ta}"],high:["",""]},:{low:["",""],medium:["",""],high:["","{gender_ta}"]},:{low:["","",""],medium:["...","",""],high:["","",""]},:{low:["","",""],medium:["","",""],high:["","",""]}},Zm={:["",""]},eh={:[""]},th={:[""]},nh={:[""],:["{playerName}",""],:["",""]},rh={:[""]},sh={:[""]},oh={:[""]},ih={:[""]};function Ow(e){if(!e)return null;const t=Object.keys(Jm).find(n=>e.includes(n));return t?He(Jm[t]):null}function Pw(e,t){if(!e)return null;const n=Object.keys(Xm).find(i=>e.includes(i));if(!n)return null;let s="low";t<30?s="low":t<70?s="medium":s="high";const o=Xm[n][s];return o?He(o):null}function zw(e){if(!e)return null;const t=Object.keys(Zm).find(n=>e.includes(n));return t?He(Zm[t]):null}function Dw(e){if(!e)return null;const t=Object.keys(eh).find(n=>e.includes(n));return t?He(eh[t]):null}function Fw(e){if(!e)return null;const t=Object.keys(th).find(n=>e.includes(n));return t?He(th[t]):null}function Hw(e){if(!e)return null;const t=Object.keys(nh).find(n=>e.includes(n));return t?He(nh[t]):null}function Ww(e){if(!e)return null;const t=Object.keys(rh).find(n=>e.includes(n));return t?He(rh[t]):null}function Uw(e){if(!e)return null;const t=Object.keys(sh).find(n=>e.includes(n));return t?He(sh[t]):null}function Gw(e){if(!e)return null;const t=Object.keys(oh).find(n=>e.includes(n));return t?He(oh[t]):null}function Vw(e){if(!e)return null;const t=Object.keys(ih).find(n=>e.includes(n));return t?He(ih[t]):null}function Yw(e,t=null){let n="low";if(e<30?n="low":e<70?n="medium":n="high",t&&Um[t]){const s=Um[t][n];if(s&&s.length>0)return He(s)}return He(vw[n])}function qw(e=null){if(e&&Gm[e]){const t=Gm[e];if(t&&t.length>0)return He(t)}return He(Sw)}function Kw(e=null){if(e&&Vm[e]){const t=Vm[e];if(t&&t.length>0)return He(t)}return He(ww)}function Qw(e=null){if(e&&Ym[e]){const t=Ym[e];if(t&&t.length>0)return He(t)}return He(kw)}function Jw(e=null){if(e&&qm[e]){const t=qm[e];if(t&&t.length>0)return He(t)}return He(Ew)}function Xw(e=null){if(e&&Km[e]){const t=Km[e];if(t&&t.length>0)return He(t)}return He(Tw)}function Zw(e=null){if(e&&Qm[e]){const t=Qm[e];if(t&&t.length>0)return He(t)}return He(Iw)}function ek(e){let t=Zd[e];return t||(e.includes("")||e.includes(""))&&(t=Zd.||Zd.),!t||t.length===0?He(_f):He(t)}function tk(e){const t=Mw[e];return He(t||_f)}function nk(e,t,n){return n?He(eu.spouse):t<20?He(eu.stranger):t>=80?He(eu.crush):null}const ah={LOW:{:["{playerName}{targetName}...{playerName}{gender_ta}","{playerName}{targetName}...{gender_ta}{gender_ta}"],:["{playerName}{targetName}...{gender_ta}...","{targetName}{playerName}......"],:["{playerName}{targetName}","{playerName}{targetName}..."],:["{playerName}{targetName}...","{playerName}{targetName}...{gender_ta}"],:["{playerName}{targetName}",""],:["{targetName}{playerName}","{playerName}{targetName}"],:["{targetName}...","{targetName}..."],:["{playerName}{targetName}","{playerName}{targetName}"]},MEDIUM:{:["{playerName}{targetName}...{gender_ta}...","{playerName}{targetName}...","{targetName}...{playerName}{playerName}"],:["{playerName}{gender_ta}{targetName}","{playerName}{targetName}...","{playerName}...{gender_ta}"],:["{playerName}{targetName}...","{playerName}...{gender_ta}{targetName}"],:["{playerName}{targetName}...{gender_ta}...","{playerName}{targetName}...{playerName}","{playerName}{gender_ta}..."],:["{playerName}","{playerName}"],:["{playerName}{gender_ta}","{playerName}"],:["{targetName}''...","{targetName}...","..."],:["{playerName}{targetName}","{playerName}{gender_ta}..."]},HIGH:{:["...{playerName}{gender_ta}{targetName}.........","{targetName}{playerName}","...{targetName}{playerName}..."],:["{playerName}{gender_ta}.........","{playerName}{targetName}............","......{playerName}..."],:["{playerName}","{playerName}","..."],:["{playerName}{targetName}...{gender_ta}...","{playerName}......","......"],:["{playerName}{targetName}{gender_ta}","{playerName}{gender_ta}","{playerName}"],:["{playerName}{gender_ta}{gender_ta}","",""],:["...{targetName}.........","...","......"],:["{playerName}{targetName}{gender_ta}","{playerName}..."]},EXTREME:{:["{targetName}{playerName}...{playerName}......","{playerName}...{targetName}","{playerName}{gender_ta}..."],:["{playerName}{targetName}","{playerName}","{playerName}{gender_ta}{targetName}......{gender_ta}"],:["{playerName}{targetName}","{playerName}","{playerName}..."],:["{playerName}.........","{playerName}......","{playerName}{targetName}......{gender_ta}..."],:["{playerName}{gender_ta}{gender_ta}","{playerName}{gender_ta}"],:["{playerName}","{playerName}{targetName}{gender_ta}{gender_ta}"],:["......","...","{gender_ta}..."],:["{playerName}{targetName}","{playerName}"]}},lh={:["{playerName}{favoriteItem}{gender_ta}...","{playerName}{gender_ta}..."],:["{playerName}...{gender_ta}","{playerName}......{gender_ta}"],:["{playerName}...{gender_ta}","{playerName}..."],:["{playerName}{gender_ta}...","{playerName}{gender_ta}..."],:["...","{gender_ta}"],:["{playerName}{gender_ta}","{playerName}"]};class Ry{constructor(t=50){this.maxSize=t,this.cache=new Map}get(t){if(!this.cache.has(t))return null;const n=this.cache.get(t);return this.cache.delete(t),this.cache.set(t,n),n}set(t,n){if(this.cache.has(t)&&this.cache.delete(t),this.cache.set(t,n),this.cache.size>this.maxSize){const s=this.cache.keys().next().value;this.cache.delete(s)}}clear(){this.cache.clear()}has(t){return this.cache.has(t)}size(){return this.cache.size}}function rk(e,t={}){const{maxSize:n=100,keyGenerator:s=(...l)=>JSON.stringify(l),ttl:o=null}=t,i=new Ry(n),a=new Map;return function(...d){const u=s(...d);o&&a.has(u)&&Date.now()-a.get(u)>o&&(i.set(u,null),a.delete(u));const p=i.get(u);if(p!==null)return p;const c=e(...d);return i.set(u,c),o&&a.set(u,Date.now()),c}}class sk{constructor(){this.caches=new Map,this.stats={hits:0,misses:0,sets:0}}createCache(t,n=100){const s=new Ry(n);return this.caches.set(t,s),s}getCache(t){return this.caches.get(t)}get(t,n){const s=this.caches.get(t);if(!s)return this.stats.misses++,null;const o=s.get(n);return o!==null?this.stats.hits++:this.stats.misses++,o}set(t,n,s){const o=this.caches.get(t);if(!o){console.warn(` ${t} `);return}o.set(n,s),this.stats.sets++}clearCache(t){const n=this.caches.get(t);n&&n.clear()}clearAll(){this.caches.forEach(t=>t.clear()),this.stats={hits:0,misses:0,sets:0}}getStats(){const t=this.stats.hits+this.stats.misses>0?(this.stats.hits/(this.stats.hits+this.stats.misses)*100).toFixed(2):0;return{...this.stats,hitRate:`${t}%`,totalCaches:this.caches.size}}}const Sa=new sk;Sa.createCache("npcLifecycle",200);Sa.createCache("combatStats",200);Sa.createCache("cultivationProgress",100);Sa.createCache("monthlyLogs",50);Sa.createCache("sortedLists",20);const pt={INTERACTION:"INTERACTION",STATE_CHANGE:"STATE_CHANGE",DAILY:"DAILY"},ok=50;rk((e,t,n,s)=>null,{maxSize:200,ttl:6e4});function Tn(e,t,n,s,o=pt.DAILY,i=!1){if(!e)return e;const a=e.logs||[],u=[{year:t,month:n,content:s,type:o,isSecret:i,timestamp:Date.now()},...a].slice(0,ok);return{...e,logs:u}}function In(e,t,n,s={}){if(!e)return"";let o=e;o=o.replace(/{playerName}/g,(n==null?void 0:n.name)||""),o=o.replace(/{npcName}/g,(t==null?void 0:t.name)||"");const i=(n==null?void 0:n.gender)||"";return t!=null&&t.gender,o=o.replace(/{gender_ta}/g,i===""?"":""),o=o.replace(/{gender_Ta}/g,i===""?"":""),Object.keys(s).forEach(a=>{const l=new RegExp(`{${a}}`,"g");o=o.replace(l,s[a])}),o}function ch(e,t,n,s){const o=e.identity||"",i=Ow(o);let a="";return i?a=In(i,e,t):e.name===""?a=`${t.name}${t.gender===""?"":""}...`:e.name===""?a=`${t.name}`:a=`${t.name}${t.gender===""?"":""}`,Tn(e,n,s,a,pt.INTERACTION)}function dh(e,t,n,s){var p,c;const o=((p=e.relationship)==null?void 0:p.affection)||0,i=((c=e.personality)==null?void 0:c.label)||null,a=e.identity||"",d=Pw(a,o)||Yw(o,i),u=In(d,e,t);return Tn(e,n,s,u,pt.INTERACTION)}function ik(e,t,n,s,o,i){var p;const a=((p=e.personality)==null?void 0:p.label)||null,l=e.identity||"";let d=null;d=zw(l)||qw(a);const u=In(d,e,t,{giftName:o});return Tn(e,n,s,u,pt.INTERACTION)}function ak(e,t,n,s,o){var p;const i=((p=e.personality)==null?void 0:p.label)||null,a=e.identity||"",d=(o?Dw(a):Fw(a))||(o?Kw(i):Qw(i)),u=In(d,e,t);return Tn(e,n,s,u,pt.INTERACTION)}function lk(e,t,n,s){var u;const o=((u=e.personality)==null?void 0:u.label)||null,i=e.identity||"",l=Hw(i)||Jw(o),d=In(l,e,t);return Tn(e,n,s,d,pt.INTERACTION,!0)}function uh(e,t,n,s,o,i){var c,f;let a="LOW";if(i>=81)a="EXTREME";else if(i>=61)a="HIGH";else if(i>=41)a="MEDIUM";else if(i>=21)a="LOW";else return e;const l=typeof e.personality=="object"&&e.personality!==null&&"label"in e.personality?e.personality.label:Array.isArray(e.personality)?e.personality[0]:"",d=((c=ah[a])==null?void 0:c[l])||((f=ah[a])==null?void 0:f.);if(!d||d.length===0)return e;const u=He(d),p=In(u,e,t,{targetName:(o==null?void 0:o.name)||""});return Tn(e,n,s,p,pt.DAILY,!0)}function ck(e,t,n,s){var u;const o=typeof e.personality=="object"&&e.personality!==null&&"label"in e.personality?e.personality.label:Array.isArray(e.personality)?e.personality[0]:"",i=lh[o]||lh.;if(!i||i.length===0)return e;const a=He(i),l=((u=e.likes)==null?void 0:u[0])||"",d=In(a,e,t,{favoriteItem:l});return Tn(e,n,s,d,pt.DAILY,!0)}function dk(e,t,n,s){const o=He(jw),i=In(o,e,t);return Tn(e,n,s,i,pt.STATE_CHANGE,!0)}function uk(e,t,n,s,o){let i;o<=3?i=Xd.early:o<=6?i=Xd.mid:i=Xd.late;const a=He(i),l=In(a,e,t);return Tn(e,n,s,l,pt.STATE_CHANGE,!0)}function pk(e,t,n,s,o){const i=He(Cw),a=In(i,e,t,{childName:o});return Tn(e,n,s,a,pt.STATE_CHANGE,!0)}function mp(e,t,n,s,o,i){var c;const a=((c=e.personality)==null?void 0:c.label)||null,l=e.identity||"",u=(o?Ww(l):Uw(l))||(o?Xw(a):Zw(a)),p=In(u,e,t,{newTier:i||"",targetTier:i||""});return Tn(e,n,s,p,pt.STATE_CHANGE)}function ph(e,t,n,s,o){const i=e.identity||"",l=Gw(i)||He(_w),d=o===(t==null?void 0:t.name),u=In(l,e,t,{spouseName:o||""});return Tn(e,n,s,u,pt.STATE_CHANGE,d)}function fk(e,t,n,s){const o=e.identity||"",a=Vw(o)||He(Rw),l=In(a,e,t);return Tn(e,n,s,l,pt.STATE_CHANGE,!0)}function mk(e,t,n,s){var E,j,x,h;if(!e)return e;if(e.isPregnant&&e.pregnancyProgress>0)return uk(e,t,n,s,e.pregnancyProgress);const o=((E=e.relationship)==null?void 0:E.affection)||0,i=e.identity||"",a=((j=e.personality)==null?void 0:j.label)||"",l=((x=e.relationship)==null?void 0:x.stage)>=3,d={relationship:0,identity:20,personality:35,event:10,scenery:35};l?(d.relationship=60,d.scenery=10):o>=80?d.relationship=40:o>=50?d.relationship=20:o<20&&(d.relationship=0);const u=Math.random()*100;let p=0,c="scenery";for(const[v,g]of Object.entries(d))if(p+=g,u<=p){c=v;break}let f=null,b=!1;switch(c){case"relationship":f=nk((h=e.relationship)==null?void 0:h.stage,o,l),b=o>=80;break;case"identity":f=ek(i);break;case"personality":f=tk(a),b=a==="";break;case"event":f=He(He([Aw,Nw,Lw,$w,Bw]));break;case"scenery":default:f=He(_f);break}f||(f="");const S=In(f,e,t);return Tn(e,n,s,S,pt.DAILY,b)}function hk(e,t,n,s){return!e||!Array.isArray(e)?e:e.map(o=>{if(o._hasLogThisMonth){const{_hasLogThisMonth:i,...a}=o;return a}return mk(o,t,n,s)})}function Pi(e){return{...e,_hasLogThisMonth:!0}}function gk(e,t=0){return!e||!e.logs?[]:t<30?[]:e.logs.filter(n=>n.isSecret?t>=80:!0)}const xk={MORTAL:100,EXPONENTIAL_BASE:1.8},hr={WASTE:.8,FIVE:.95,FOUR:1,THREE:1.15,DOUBLE:1.35,SINGLE:1.6,MUTANT:1.75,HEAVEN:2},My=(e=50)=>1+Math.max(-.5,(e-50)*.012),Mo={longevity_body:1.3,immortal_marrow:1.5,void_spirit_body:1.25,ancient_bloodline:1.2,cursed_body:.75,demonic_enhancement:.85,phoenix_reborn:1.1,common_body:1},hp={BASE_PROBABILITY:.01,DIFFICULTY_MULTIPLIER:{:10,:5,:4,:3.5,:2.5,:2,:1.8,:1.5,:1.2,:.8,:.6,:.5,:.4,:.3,:.25,:.2,:.15,:.1,:.08,:.06,:.04,:.02,:.015,:.01,:.008,:.006,:.004,:.002,:.0015,:.001,:5e-4,:3e-4,:1e-4},FACTORS:{aptitudeBonus:e=>1+Math.max(-.5,(e-50)*.015),spiritRootBonus:e=>({WASTE:.5,FIVE:.7,FOUR:.85,THREE:1,DOUBLE:1.2,SINGLE:1.5,MUTANT:1.8,HEAVEN:2.2})[e]||1,ageBonus:(e,t)=>{if(!t)return 1;const n=Math.abs(e-t);return n<=10?1+(10-n)*.05:Math.max(.3,1-(n-10)/20)},expProgress:(e,t)=>.5+Math.max(0,Math.min(1,e/t))*1.5,healthBonus:e=>.8+e*.004},LIFESPAN_GAIN_MULTIPLIER:.7};function fc(e=0,t=1,n=1,s=1){const{MORTAL:o,EXPONENTIAL_BASE:i}=xk,a=Math.pow(i,e/5),d=o*a*t*n*s;return Math.floor(d)}function yk(e,t=1){var d,u,p;const n=hp;let s=n.BASE_PROBABILITY/t;const o=n.FACTORS.aptitudeBonus(((d=e.stats)==null?void 0:d.aptitude)||50);s*=o;const i=n.FACTORS.spiritRootBonus(((u=e.spiritRoot)==null?void 0:u.id)||"FOUR");s*=i;const a=n.FACTORS.expProgress(e.currentExp||0,e.maxExp||100);s*=a;const l=n.FACTORS.healthBonus(((p=e.stats)==null?void 0:p.health)||50);return s*=l,Math.min(.5,s)}const bk=Object.values(Q).reduce((e,t)=>(e[t.key]=t.order,e),{}),vk=["","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","",""],Sk=120,wk=20,kk=5,Ek=8,jk=50,gp=(e="")=>Cn(e)?Ve.findIndex(n=>n.name===e):0,Ck=(e="")=>{if(!e)return 0;const t=vk.indexOf(e);return t>=0?t:0},mc=(e,t=wk)=>{var u,p,c;if(!e)return Sk+t;const n=gp(e.tier||"");let s=hr.FOUR;(u=e.spiritRoot)!=null&&u.id&&(s={HEAVEN:hr.HEAVEN,MUTANT:hr.MUTANT,SINGLE:hr.SINGLE,DOUBLE:hr.DOUBLE,THREE:hr.THREE,FOUR:hr.FOUR,FIVE:hr.FIVE,WASTE:hr.WASTE}[e.spiritRoot.id]||hr.FOUR);const o=My(((p=e.stats)==null?void 0:p.aptitude)||50);let i=Mo.common_body;(c=e.constitution)!=null&&c.key&&Mo[e.constitution.key]&&(i=Mo[e.constitution.key]);const a=fc(n,s,o,i),l=e.age||18,d=Math.max(a,l+t);return Math.round(d)},Ay=(e,t)=>{if(!t)return 0;const n=gp(e.name||""),s=gp(t.name||""),o=fc(n),a=fc(s)-o,l=Math.pow(t.maxExp,.2),d=a*(1+l/1e3);return Math.round(Math.max(50,d))},Ny=e=>{if(!e)return e;const t=e.stats||{},n=mc(e);return t.lifespan&&t.lifespan>=n?e:{...e,stats:{...t,lifespan:n}}},Tk=["herb_bandage","beast_fang","beast_core","foundation_pill","thunder_wood","core_pill","artifact_supreme","dragon_heart_pill","marrow_wash","milk_millennium","nascent_fruit","starlight_pill","heaven_manual","god_transformation_pill","divine_soul_pill","void_condensing_pill","immortal_marrow_pill","heaven_defying_pill","void_refining_pill","space_law_pill","void_stabilization_pill","unity_pill","dao_comprehension_pill","harmony_pill","mahayana_pill","immortal_foundation_pill","semi_immortal_pill","tribulation_pill","ascension_pill"].map(e=>{const t=Pc[e];if(!t)return null;const n=bk[t.resourceLevel]||1,s=n>=5?80:55;return{itemId:e,affectionRequirement:s+n*5,tierRequirement:Math.max(0,n-1),rarity:t.rarity,resourceOrder:n}}).filter(Boolean);function Br(e){if(!e||!e.stats)return 0;const t=e.stats.lifespan||100,n=e.age||18,s=t-n;return Math.max(0,s)}function Ik(e,t,n,s){if(!e)return e;const o=(e.age||18)+1;let i=Ny({...e,age:o});const a=Br(i);return a<=0?i={...i,isDead:!0,deathReason:""}:a<10&&!e._nearDeathLogged&&(i=fk(i,t,n,s),i._nearDeathLogged=!0),i}function _k(e,t,n,s){var j,x,h,v;if(!e||e.isDead)return{npc:e,events:[]};const o=[];let i={...e};i.currentExp||(i.currentExp=0),i.tier||(i.tier="");const a=Cn(i.tier);if(!a)return{npc:i,events:o};let l=10;const u=.5+(((j=i.stats)==null?void 0:j.aptitude)||50)/100*2.5;l*=u;const c=.6+(((x=i.stats)==null?void 0:x.intelligence)||50)/100*1.4;l*=c;const f=Ve.findIndex(g=>g.name===i.tier);if(f>=0&&Ve.length>0){const g=1+f/Ve.length*1.5;l*=g}const b=((h=i.spiritRoot)==null?void 0:h.multiplier)||.5;l*=b,i.sect&&i.sect.level!=="NONE"&&i.sectStatus==="active"&&(l*=1.5);const S=((v=i.relationship)==null?void 0:v.affection)||0;S>=20&&(S<40?l*=1.1:S<60?l*=1.2:S<80?l*=1.3:l*=1.5),l=Math.max(2,l);const E=Math.floor(l);if(i.currentExp=(i.currentExp||0)+E,i.combatStats=Vn(i),i.cultivationSpeed=l,i.currentExp>=a.maxExp){const g=Rk(i,t,n,s);if(i=g.npc,o.push(...g.events),i.currentExp>=a.maxExp){const I=Ly(i,t,n,s);i=I.npc,o.push(...I.events)}}return{npc:i,events:o}}function Ly(e,t,n,s){var f,b;const o=[];let i={...e};const a=Cn(i.tier),l=Cf(i.tier);if(!a||!l)return{npc:i,events:o};const d=((f=i.stats)==null?void 0:f.aptitude)||50,u=((b=i.spiritRoot)==null?void 0:b.multiplier)||.5;let p=a.chance||.3;if(p+=d/10*.03,p+=u*.2,p=Math.max(.05,Math.min(.95,p)),Math.random()<p){if(i.tier=l.name,i.tierTitle=l.name,i.currentExp=0,i.maxExp=l.maxExp,i.stats){const S=Ay(a,l);i.stats={...i.stats,lifespan:(i.stats.lifespan||100)+S},i._lastBreakthroughLifespanGain=S,i._lastBreakthroughType="normal"}if(i.combatStats){const S=Math.floor(i.combatStats.maxHp*.5),E=Math.floor(i.combatStats.atk*.3),j=Math.floor((i.combatStats.def||0)*.2);i.combatStats={...i.combatStats,maxHp:i.combatStats.maxHp+S,hp:i.combatStats.maxHp+S,atk:i.combatStats.atk+E,def:(i.combatStats.def||0)+j}}i=mp(i,t,n,s,!0,l.name),o.push({type:"NPC_BREAKTHROUGH",npcName:i.name,newTier:l.name,message:`${i.name}  ${l.name} ${i._lastBreakthroughLifespanGain||0} `})}else i.currentExp=0,i=mp(i,t,n,s,!1,l.name),o.push({type:"NPC_BREAKTHROUGH_FAIL",npcName:i.name,tier:i.tier,message:`${i.name} `});return{npc:i,events:o}}function Rk(e,t,n,s){const o=[];let i={...e};if(!i.tier||!i.stats)return{npc:i,events:o};const a=i.currentExp/(i.maxExp||100);if(a<.75||a>=1)return{npc:i,events:o};const l=Cn(i.tier),d=hp.DIFFICULTY_MULTIPLIER[i.tier]||1,u=yk(i,d);if(Math.random()<u){const c=Cf(i.tier);if(!c)return{npc:i,events:o};if(i.tier=c.name,i.tierTitle=c.name,i.currentExp=0,i.maxExp=c.maxExp,i.stats){const b=Ay(l,c),S=Math.floor(b*hp.LIFESPAN_GAIN_MULTIPLIER);i.stats={...i.stats,lifespan:(i.stats.lifespan||100)+S},i._lastBreakthroughLifespanGain=S,i._lastBreakthroughType="natural"}if(i.combatStats){const b=Math.floor(i.combatStats.maxHp*.4),S=Math.floor(i.combatStats.atk*.25);i.combatStats={...i.combatStats,maxHp:i.combatStats.maxHp+b,hp:i.combatStats.maxHp+b,atk:i.combatStats.atk+S}}i=mp(i,t,n,s,!0,c.name);const f=i._lastBreakthroughLifespanGain||0;o.push({type:"NPC_NATURAL_BREAKTHROUGH",npcName:i.name,newTier:c.name,message:`${i.name}  ${c.name} ${f} `})}return{npc:i,events:o}}function Mk(e,t,n,s){if(!e||!Array.isArray(e))return{npcs:e||[],events:[]};const o=[],i=s===1;return{npcs:e.map(l=>{var d,u,p;try{let c=Ny(l);if(c.isDead)return c;if(i&&(c=Ik(c,t,n,s),c.isDead))return o.push({type:"NPC_DEATH",npcName:c.name,reason:c.deathReason,message:`${c.name} ${c.deathReason}`}),c;if(!c.isDead){const b=Br(c);(((d=c.relationship)==null?void 0:d.affection)||0)>=jk&&b>0&&b<=kk&&!c._lifespanAlerted?(c={...c,_lifespanAlerted:!0},o.push({type:"NPC_LIFESPAN_ALERT",npcId:c.id,npcName:c.name,remainingYears:b})):c._lifespanAlerted&&b>Ek&&(c={...c,_lifespanAlerted:!1})}if(s%6===0){const b=((u=c.relationship)==null?void 0:u.affection)||0,S=((p=c.relationship)==null?void 0:p.stage)||0;if(b>=60&&S>=1&&Math.random()<.2){const E=Ak(c,t);E&&o.push(E)}}const f=_k(c,t,n,s);return c=(f==null?void 0:f.npc)||c,f!=null&&f.events&&Array.isArray(f.events)&&o.push(...f.events),c}catch(c){return console.error("Error processing NPC lifecycle for:",l==null?void 0:l.name,c),l}}),events:o}}const Yn={HOSTILE:"HOSTILE",NEUTRAL:"NEUTRAL",FRIENDLY:"FRIENDLY",INTIMATE:"INTIMATE"};function Ak(e,t){var f,b,S;const n=((f=e.relationship)==null?void 0:f.affection)||0,s=e.tier||"",o=Ck(s);if((((b=e.relationship)==null?void 0:b.stage)||0)<1)return null;const a=Tk.filter(E=>{const j=n>=E.affectionRequirement,x=o>=E.tierRequirement;return j&&x});if(!a.length)return null;const l=a.map(E=>({option:E,weight:Math.max(1,8-E.resourceOrder*2)})),d=l.reduce((E,j)=>E+j.weight,0);if(d===0||!l.length)return null;let u=Math.random()*d,p=(S=l[0])==null?void 0:S.option;if(!p)return null;for(const{option:E,weight:j}of l)if(u-=j,u<=0){p=E;break}if(!p||!p.itemId)return null;const c=[`${e.name}""`,`${e.name}`,`${e.name}""`,`${e.name}Ta`];return{type:"NPC_GIFT",npcName:e.name,npcId:e.id,giftItemId:p.itemId,message:c[Math.floor(Math.random()*c.length)]}}function $y(e=0){return e<0?Yn.HOSTILE:e<50?Yn.NEUTRAL:e<80?Yn.FRIENDLY:Yn.INTIMATE}function Nk(e){const t={[Yn.HOSTILE]:{text:"",color:"#f44336",icon:""},[Yn.NEUTRAL]:{text:"",color:"#9e9e9e",icon:""},[Yn.FRIENDLY]:{text:"",color:"#4caf50",icon:""},[Yn.INTIMATE]:{text:"",color:"#e91e63",icon:""}};return t[e]||t[Yn.NEUTRAL]}function tu(e,t){var o;const n=((o=e.relationship)==null?void 0:o.affection)||0,s=$y(n);switch(t){case"DUAL_CULTIVATION":if(s!==Yn.INTIMATE)return{allowed:!1,reason:" >= 80"};if(e.identity===""&&(e.dualCultivationCount||0)===0)return{allowed:!0,requiresCheck:!0,checkRate:.05};break;case"GIFT":if(s===Yn.HOSTILE)return{allowed:!1,reason:""};break;case"SPAR":if(s===Yn.HOSTILE)return{allowed:!1,reason:""};break}return{allowed:!0}}const Lk=["","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","",""],$k=["","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","",""],fh=["","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","",""],mh=["","","","","","","","","","","","","","","","","","","",""],hh=[{label:"",baseApt:20,desc:""},{label:"",baseApt:40,desc:""},{label:"",baseApt:80,desc:""},{label:"",baseApt:75,desc:""},{label:"",baseApt:70,desc:""},{label:"",baseApt:65,desc:""},{label:"",baseApt:60,desc:""},{label:"",baseApt:70,desc:""},{label:"",baseApt:70,desc:""},{label:"",baseApt:75,desc:""},{label:"",baseApt:65,desc:""},{label:"",baseApt:10,desc:""},{label:"",baseApt:80,desc:""},{label:"",baseApt:85,desc:""},{label:"",baseApt:70,desc:""},{label:"",baseApt:65,desc:""},{label:"",baseApt:60,desc:""},{label:"",baseApt:65,desc:""},{label:"",baseApt:55,desc:""}],gh=[{label:"",tag:"",desc:""},{label:"",tag:"",desc:""},{label:"",tag:"",desc:""},{label:"",tag:"",desc:""},{label:"",tag:"",desc:""},{label:"",tag:"",desc:""},{label:"",tag:"",desc:""},{label:"",tag:"",desc:""},{label:"",tag:"",desc:""},{label:"",tag:"",desc:""},{label:"",tag:"",desc:""},{label:"",tag:"",desc:""},{label:"",tag:"",desc:""},{label:"",tag:"",desc:""},{label:"",tag:"",desc:""},{label:"",tag:"",desc:""},{label:"",tag:"",desc:""}],Bk=e=>{const{stats:t,spiritRoot:n,identity:s}=e,o=(t==null?void 0:t.aptitude)||50,i=(n==null?void 0:n.elements)||[];let l={:["SWORD","HEAVEN_EMPEROR","THUNDER"],:["SWORD"],:["DAN"],:["NINE_STAR"],:["NINE_STAR","FLOWER"],:null,:["DEMON"],:["BLOOD"],:["DEMON","GHOST"],:["GHOST"],:["STONE"],:["GRASS"],:["GHOST","BLOOD"],:["FLOWER"],:null,:null,:"NONE",:Math.random()<.3?"random":"NONE",:"random",:null}[s.label];if(l==="random"&&(l=ns.filter(f=>!(f.id==="NONE"||o<f.minApt||f.prefElements&&f.prefElements.length>0&&!i.some(S=>f.prefElements.includes(S))&&o<f.minApt+10)).map(f=>f.id),l.length===0&&(l="NONE")),l===null)return{sect:null,sectId:null,rank:null,status:"mysterious"};if(l==="NONE")return{sect:ns.find(f=>f.id==="NONE"),sectId:"NONE",rank:"",status:"rogue"};const d=Array.isArray(l)?l[Math.floor(Math.random()*l.length)]:l,u=ns.find(f=>f.id===d);if(!u)return{sect:ns.find(f=>f.id==="NONE"),sectId:"NONE",rank:"",status:"rogue"};const p=Ki(e,u);let c="active";return Math.random()<.1?c="defected":Math.random()<.05&&(u.level==="RECKLESS"||s.label.includes(""))&&(c="hidden"),{sect:u,sectId:u.id,rank:p,status:c}},Ok=()=>({base:Math.floor(Math.random()*gw.length),skinColor:Math.floor(Math.random()*mw.length),eye:Math.floor(Math.random()*xw.length),eyeColor:Math.floor(Math.random()*hw.length),mouth:Math.floor(Math.random()*yw.length),hair:Math.floor(Math.random()*bw.length),hairColor:Math.floor(Math.random()*fp.length)}),xp=(e,t="")=>{const n=Date.now()+Math.random().toString().slice(2,6),s=zl(),o=s.tier||e||"",i=Ve.find(Y=>Y.name===o)||Ve[1],a=s.maxExp??i.maxExp,l=Math.min(s.currentExp??0,a),d=18+Math.floor(Math.random()*100),p=Math.random()<.15?mh[Math.floor(Math.random()*mh.length)]:fh[Math.floor(Math.random()*fh.length)],c=t===""?$k:Lk,f=c[Math.floor(Math.random()*c.length)];let b=Math.floor(Math.random()*80)+10;Math.random()<.05&&(b=90+Math.floor(Math.random()*10));let S={aptitude:b,looks:50+Math.floor(Math.random()*50),intelligence:40+Math.floor(Math.random()*60),health:80};const E=T2();S=kf(S,E);const j=Ok();let x="";j.eye===1&&(x=""),j.eye===2&&(x="");const h=`${j.skin===0?"":""}${x}`,v=Yo(b,{constitution:E}),I=Vn({tier:o,currentExp:l,maxExp:a,stats:S,spiritRoot:v,equipment:null}),_=hh[Math.floor(Math.random()*hh.length)],k=Bk({stats:S,spiritRoot:v,identity:_});let R=_.desc;k.status==="mysterious"?R+=" ":k.status==="rogue"?R+=" ":k.status==="defected"?R+=` ${k.sect.name}${k.rank}`:k.status==="hidden"?R+=` ${k.rank}`:k.status==="active"&&k.sect&&(R+=` ${k.sect.name}${k.rank}`);const N=mc({age:d,stats:S,tier:o,spiritRoot:v});return S={...S,lifespan:N},{id:n,name:p+f,gender:t,age:d,identity:_.label,desc:R,avatar:j,appearance:h,tier:o,currentExp:l,maxExp:a,stats:S,constitution:E,spiritRoot:v,cultivationMethod:"basic_breath",combatStats:I,personality:gh[Math.floor(Math.random()*gh.length)],sect:k.sect,sectId:k.sectId,sectRank:k.rank,sectStatus:k.status,relationship:{stage:0,affection:0,trust:0,jealousy:0},acceptsLetters:!0,isPregnant:!1}};function Rf(e,t){if(!e)return e;const n={...e,stats:{...e.stats||{},aptitude:t}};try{if(n.isTested||n.spiritRoot&&Array.isArray(n.spiritRoot.elements)){const s=rr(t,n.spiritRoot,null,{constitution:n.constitution});n.spiritRoot=s}}catch{}return n}function Pk(e,t){return Rf(e,t)}const zk=e=>{const t=e.reduce((s,o)=>s+(o.weight||1),0);let n=Math.random()*t;for(const s of e)if(n-=s.weight||1,n<=0)return s;return e[e.length-1]},Dk=[ft.PLAYER,ft.CHILD],Fk={YELLOW:"common",BLACK:"uncommon",EARTH:"rare",HEAVEN:"epic",DIVINE:"legendary"},Hk={YELLOW:Q.MORTAL.key,BLACK:Q.SPIRIT.key,EARTH:Q.EARTH.key,HEAVEN:Q.HEAVEN.key,DIVINE:Q.DIVINE.key},Wk={basic:["YELLOW","BLACK"],advanced:["EARTH"],apex:["HEAVEN","DIVINE"]},xh={[Q.MORTAL.key]:1,[Q.SPIRIT.key]:2,[Q.EARTH.key]:3,[Q.HEAVEN.key]:4,[Q.DIVINE.key]:5},Uk=(e,t)=>{const n=xh[t]||1;return e.filter(s=>{const o=Fo(s);return o?(xh[o.resourceLevel]||1)<=n:!0})},Gk=(e=["YELLOW"],t)=>{var i,a;let n=Object.values(j2).filter(l=>e.includes(l.tier));if(!n.length)return null;const s=((a=(i=t==null?void 0:t.player)==null?void 0:i.spiritRoot)==null?void 0:a.elements)||[],o=n.filter(l=>s.includes(l.element));return o.length&&(n=o),n[Math.floor(Math.random()*n.length)]},Vk=e=>{const t=hn[e];if(!t)return null;const n=zc[t.tier]||{};return{id:`manual_scroll_${e}`,name:`${t.name}`,type:"manual",rarity:Fk[t.tier]||"rare",tier:n.name||t.tier,tierColor:n.color,element:t.element,baseBonus:`${Math.round((n.baseBuff||0)*100)}%`,desc:t.desc,manualIds:[e],resourceCategory:"MANUAL",resourceLevel:t.resourceLevel||Hk[t.tier]||Q.MORTAL.key,manualSchool:t.school,usageTargets:Dk,tags:[t.element||"",t.tier]}},yh=(e,t)=>{const n=Wk[e]||["YELLOW"],s=Gk(n,t);if(!s)return null;const o=s.manualIds[Math.floor(Math.random()*s.manualIds.length)];return Vk(o)},bh=(e,t)=>{const n=Mf(e);if(!n)return yh("basic",t);const s=n.resourceLevel||"MORTAL";let o="basic";return s==="DIVINE"?o="apex":s==="HEAVEN"?o=Math.random()<.8?"advanced":"apex":s==="EARTH"&&(o=Math.random()<.6?"basic":"advanced"),yh(o,t)},Mf=e=>Iy.find(t=>t.id===e),Yk=(e,t=1)=>{const n=Mf(e)||{recommendCP:300,drops:["herb_bandage"],resourceLevel:"MORTAL"},s=n.recommendCP||300,o=t>=10,i=o?1.5:.6+t*.06,a=Math.floor(s*i),l=o?"":"",d=o?.02:.012,u=Uk(n.drops||["herb_bandage"],n.resourceLevel||"MORTAL");return{name:l,combatStats:{hp:Math.floor(a*.3),atk:Math.floor(a*d),def:Math.floor(a*.0073),mp:0,maxHp:Math.floor(a*.3),maxMp:0},drops:u.length>0?u:["herb_bandage"],isBoss:o}},qk=(e,t)=>!!(e!=null&&e.find(n=>n.id===t)),Kk=[{id:"combat_beast",kind:"COMBAT",realm:"ANY",weight:3,title:"",desc:"",options:[{label:"",action:e=>({type:"START_COMBAT"})},{label:"",action:()=>({type:"LOG",msg:""})}]},{id:"loot_array",kind:"LOOT",realm:"ANY",weight:2,title:"",desc:"",options:[{label:" ()",action:e=>{var n,s;return(((s=(n=e.player)==null?void 0:n.combatStats)==null?void 0:s.atk)||10)>80?{type:"LOOT",items:["beast_core"],msg:""}:{type:"HP_CHANGE",hpDelta:-150,msg:""}}},{label:" ()",action:e=>{var n,s;return(((s=(n=e.player)==null?void 0:n.stats)==null?void 0:s.intelligence)||40)>=70?{type:"LOOT",items:["foundation_pill"],msg:""}:{type:"LOG",msg:""}}}]},{id:"encounter_injured",kind:"ENCOUNTER",realm:"ANY",weight:1,title:"",desc:"",options:[{label:" (-1 )",condition:e=>qk(e.inventory,"herb_bandage"),action:e=>{let t=xp("");try{t=Rf(t,Math.max(t.stats.aptitude||0,90))}catch{t.stats.aptitude=Math.max(t.stats.aptitude||0,90)}return{type:"NPC_JOIN",npc:t,removeItemId:"herb_bandage",msg:""}}},{label:"",action:()=>({type:"LOOT",items:["spirit_stones_500"],msg:""})},{label:"",action:()=>({type:"LOG",msg:""})}]},{id:"fruit_unknown",kind:"LOOT",realm:"ANY",weight:1,title:"",desc:"",options:[{label:"",action:()=>{const e=Math.random();return e<.4?{type:"EXP_GAIN",amount:1200,msg:""}:e<.8?{type:"HP_CHANGE",hpDelta:-120,msg:""}:{type:"LOG",msg:""}}},{label:"",action:()=>({type:"LOG",msg:""})}]},{id:"story_two_beasts",kind:"STORY",realm:"ANY",weight:1,title:"",desc:"",options:[{label:"",action:()=>({type:"LOOT",items:["beast_fang"],msg:""})},{label:"",action:()=>({type:"LOG",msg:""})}]},{id:"manual_cave",kind:"LOOT",realm:"ANY",weight:1,title:"",desc:"",options:[{label:"",action:e=>{const t=bh(e.realmId,e);return t?{type:"LOOT",items:[t],msg:""}:{type:"LOG",msg:""}}},{label:"",action:()=>({type:"LOG",msg:""})}]},{id:"fortune_telling",kind:"ENCOUNTER",realm:"ANY",weight:1,title:"",desc:'""',options:[{label:" (100)",condition:e=>{var t,n;return((n=(t=e.player)==null?void 0:t.spirit)==null?void 0:n.spirits)>=100},action:e=>{const t=[{type:"EXP_GAIN",amount:2e3,msg:""},{type:"LOG",msg:""},{type:"LOG",msg:""},{type:"LOOT",items:["spirit_stones_200"],msg:""}];return{...t[Math.floor(Math.random()*t.length)],spiritsDelta:-100}}},{label:"",action:()=>({type:"LOG",msg:'""'})}]},{id:"spirit_fruit_grove",kind:"LOOT",realm:"ANY",weight:1,title:"",desc:"",options:[{label:"",action:()=>{const e=[{items:["spirit_stones_300"],msg:""},{items:["foundation_pill"],msg:""},{type:"EXP_GAIN",amount:1500,msg:""}],t=e[Math.floor(Math.random()*e.length)];return{type:t.type||"LOOT",...t}}},{label:"",action:()=>({type:"LOG",msg:""})}]},{id:"ancient_script",kind:"LOOT",realm:"ANY",weight:1,title:"",desc:"",options:[{label:"",action:e=>{var s,o;const t=((o=(s=e.player)==null?void 0:s.stats)==null?void 0:o.intelligence)||40,n=[40,60,80][Math.floor(Math.random()*3)];return t>=n?{type:"LOOT",items:["wisdom_pill"],msg:""}:{type:"HP_CHANGE",hpDelta:-80,msg:""}}},{label:"",action:()=>({type:"LOG",msg:""})}]},{id:"spirit_pool",kind:"LOOT",realm:"ANY",weight:1,title:"",desc:"",options:[{label:"",action:()=>{const e=[{type:"EXP_GAIN",amount:3e3,msg:""},{type:"LOOT",items:["primordial_spirit_pill"],msg:""},{type:"LOG",msg:""}];return e[Math.floor(Math.random()*e.length)]}},{label:"",action:()=>({type:"LOG",msg:""})}]},{id:"treasure_chest",kind:"LOOT",realm:"ANY",weight:.8,title:"",desc:"",options:[{label:"",action:e=>{var n,s;const t=((s=(n=e.player)==null?void 0:n.combatStats)==null?void 0:s.atk)||30;return t>100?{type:"LOOT",items:["cosmic_crystal","spirit_stones_500"],msg:""}:t>50?{type:"LOOT",items:["spirit_stones_300"],msg:""}:{type:"HP_CHANGE",hpDelta:-50,msg:""}}},{label:"",action:()=>({type:"LOOT",items:["spirit_stones_200"],msg:""})},{label:"",action:()=>({type:"LOG",msg:""})}]},{id:"meditation_spot",kind:"ENCOUNTER",realm:"ANY",weight:1,title:"",desc:"",options:[{label:"",action:()=>{const e=[{type:"EXP_GAIN",amount:2500,msg:""},{type:"LOOT",items:["awakening_pill"],msg:""},{type:"LOG",msg:""}];return e[Math.floor(Math.random()*e.length)]}},{label:"",action:()=>({type:"LOG",msg:""})}]},{id:"rival_encounter",kind:"ENCOUNTER",realm:"ANY",weight:.8,title:"",desc:"",options:[{label:"",action:()=>({type:"LOG",msg:Math.random()<.5?" ":" "})},{label:"",action:()=>({type:"LOG",msg:""})},{label:"",action:()=>({type:"LOOT",items:["spirit_stones_250"],msg:""})}]},{id:"demonic_lair",kind:"ENCOUNTER",realm:"ANY",weight:.5,title:"",desc:"",options:[{label:"",action:e=>{const t=Math.random();return t<.3?{type:"LOOT",items:["void_silk"],msg:""}:t<.6?{type:"HP_CHANGE",hpDelta:-150,msg:""}:{type:"LOG",msg:""}}},{label:"",action:()=>({type:"LOG",msg:""})}]},{id:"celestial_lake",kind:"ENCOUNTER",realm:"ANY",weight:1,title:"",desc:"",options:[{label:"",action:()=>{const e=[{type:"LOOT",items:["spirit_stones_400"],msg:""},{type:"EXP_GAIN",amount:1e3,msg:""},{type:"LOG",msg:""}];return e[Math.floor(Math.random()*e.length)]}},{label:"",action:()=>({type:"LOG",msg:""})}]},{id:"manual_library",kind:"LOOT",realm:"ANY",weight:1,title:"",desc:"",options:[{label:"",action:e=>{const t=bh(e.realmId,e);return t?{type:"LOOT",items:[t],msg:""}:{type:"LOG",msg:""}}},{label:"",action:()=>({type:"LOG",msg:""})}]}],Qk=e=>{const t=Mf(e),n=t!=null&&t.name?`${t.name}  `:"";return{id:"boss_guard",kind:"BOSS",realm:e,weight:1,title:n,desc:"",options:[{label:"",action:()=>({type:"START_COMBAT"})},{label:"",action:()=>({type:"LOG",msg:""})}]}},vh=e=>{const{realmId:t,progress:n}=e,o=Kk.filter(i=>i.realm==="ANY"||i.realm===t).map(i=>{let a=i.weight||1;return n<=3&&(i.kind==="LOOT"||i.kind==="ENCOUNTER")&&(a*=1.5),n>=7&&i.kind==="COMBAT"&&(a*=1.5),{...i,weight:a}});return zk(o)},Jk=e=>{const t=O2(e);if(!t)return null;const n=Fo(t);if(!n)return null;const s=typeof n.name=="string"?n.name:"";return{giftItemId:t,giftName:s}},ro=(e,t)=>Math.random()>.5?e:t,Xk=(e={},t=null)=>{const s=My(e.aptitude||50);let o=Mo.common_body;t!=null&&t.key&&Mo[t.key]&&(o=Mo[t.key]);const a=fc(0,1,s,o);return Math.floor(a)},Yo=(e,t={})=>{const n=jf(e);let s=[],o=n.name,i=n.desc;if(n.id==="NONE")s=[];else if(n.id==="MUTANT")s=[zm[Math.floor(Math.random()*zm.length)]];else{const l=[...z2];for(let d=l.length-1;d>0;d--){const u=Math.floor(Math.random()*(d+1));[l[d],l[u]]=[l[u],l[d]]}s=l.slice(0,n.elementCount)}const a=A2(t.constitution);if(a&&a.length>0){const l=a[Math.floor(Math.random()*a.length)];if(n.id==="MUTANT")s=[l];else if(s.length>0){const d=s.indexOf(l);d!==-1&&s.splice(d,1),s.unshift(l)}else s=[l]}return{type:o,elements:s,desc:i,color:n.color,multiplier:n.multiplier}},rr=(e,t,n,s={})=>Yo(e,s),yp=e=>{if(!e)return{recommended:[],others:[]};const t=ns.map(l=>({sect:l,score:wy(e,l),admission:ky(e,l)})),n=[...t].sort((l,d)=>d.score-l.score),s=[];if(n.forEach(l=>{l.sect.id!=="NONE"&&(s.length>=3||l.admission.qualified&&s.push(l))}),s.length<3&&n.forEach(l=>{l.sect.id!=="NONE"&&(s.includes(l)||s.length<3&&s.push(l))}),s.length===0&&n.length){const l=n.find(d=>d.sect.id!=="NONE")||n[0];l&&s.push(l)}const o=l=>({sect:l.sect,predictedRank:l.admission.qualified?Ki(e,l.sect):null,resources:F2(l.sect),compatibility:l.score,admission:l.admission}),i=s.map(o),a=t.filter(l=>!s.includes(l)).sort((l,d)=>d.score-l.score).map(o);return{recommended:i,others:a}},Zk=(e,t,n)=>{var _,C,k,R,T;const s=e.avatar||{base:0,skinColor:0,eye:2,eyeColor:0,mouth:0,hairColor:0},o=t.avatar,i=Math.random()>.5?"":"",a={base:ro(s.base,o.base),skinColor:ro(s.skinColor,o.skinColor),eye:ro(s.eye,o.eye),eyeColor:ro(s.eyeColor,o.eyeColor),mouth:ro(s.mouth,o.mouth),hair:Math.floor(i===""?Math.random()*2:Math.random()*4),hairColor:ro(s.hairColor,o.hairColor)};let l=((((_=e.stats)==null?void 0:_.aptitude)||50)+(((C=t.stats)==null?void 0:C.aptitude)||50))/2,d=Math.floor(Math.random()*31)-15;Math.random()<.05&&(d+=Math.random()>.5?20:-20),t.constitution&&(d+=5);const u=((k=e.spiritRoot)==null?void 0:k.type)==="",p=((R=t.spiritRoot)==null?void 0:R.type)==="";(u&&Math.random()<.2||p&&Math.random()<.2)&&(d+=30);const c=Math.max(1,Math.min(100,Math.floor(l+d))),f=Math.floor((e.stats.looks+t.stats.looks)/2+(Math.random()*10-5));let b=null;const S=Math.random(),E=e.constitution&&e.constitution.name,j=t.constitution&&t.constitution.name,x=((T=t.customFlags)==null?void 0:T.isFumoLegend)||t.identity===""||t.identity==="";if(E&&j){if(S<.8){const N=Math.random()>.5?t.constitution:e.constitution;b=Nl(N)}}else j?S<(x?1:.6)&&(b=Nl(t.constitution)):E&&S<.6&&(b=Nl(e.constitution));!b&&Math.random()<.01&&(b=vy("innate_dao")||{name:"",desc:"",rarity:"UR"});const h={weapon:null,armor:null,accessory:null};let v={aptitude:c,looks:f,intelligence:Math.floor((e.stats.cunning+t.stats.intelligence)/2)};v=kf(v,b);const g=Ho("",v.aptitude,null,h),I=If(i,{motherName:e==null?void 0:e.name,fatherName:t==null?void 0:t.name,preferSurname:""});return Ep({id:`child_${Date.now()}_${Math.floor(Math.random()*1e5)}`,name:I,fatherName:t.name,birthYear:n,generation:1,age:0,gender:i,stats:{...v,lifespan:Xk(v,b)},constitution:b,cultivationMethod:"basic_breath",equipment:h,combatStats:g,avatar:a,isTested:!1,cultivation:0,isAdult:!1})},By=e=>{for(let t=0;t<Ve.length;t++)if(e<Ve[t].maxExp)return Ve[t];return Ve[Ve.length-1]},eE=(e,t,n={})=>{var h;let s=0,o=0,i=[],a=[];const l=n.familyRatingMultiplier??1,u=(((h=n.playerStrategy)==null?void 0:h.childrenStrategy)||n.childrenStrategy||{}).skipZhaozhou===!0,p=n.currentYear||0,c=[],f=[],b=[];e.forEach(v=>{(v.generation||1)<=2?f.push(v):b.push(v)});let S=n.generation3Plus||[];b.forEach(v=>{S.find(g=>g.id===v.id)||S.push({id:v.id,generation:v.generation||3,birthYear:p-(v.age||0),parentGeneration:(v.generation||3)-1})});const E=[];return S.forEach(v=>{const g=p-v.birthYear;Math.floor(g)===20&&v.generation<6&&E.push({id:`child_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,generation:v.generation+1,birthYear:p,parentGeneration:v.generation}),g>.5&&(s+=1),E.push(v)}),S=E,{newChildren:[...f.map(v=>{var _,C,k,R,T,N,Y,H,B,$,q,se,J,X;let g={...v};g.age+=1/12;const I=g.generation||1;if(g.stats||(g.stats={}),!g.stats.lifespan){const re=((_=g.spiritRoot)==null?void 0:_.multiplier)||1,ye=100;g.stats.lifespan=Math.floor(ye*(1+re))}if(Math.floor(g.age*12)===12&&!g.trait){const re=Math.random()*100;let ye="WHITE";re>99?ye="RED":re>95?ye="ORANGE":re>85?ye="PURPLE":re>65?ye="BLUE":re>35&&(ye="GREEN");const Re=Dm.filter(ie=>ie.rarity===ye),Fe=Re[Math.floor(Math.random()*Re.length)]||Dm[0];g.trait=Fe;const O=` ${g.name} ${Fe.name}(${Fe.desc})`;i.push(O),u||a.push({type:"ZHAOZHOU",title:"",message:O,child:g,trait:Fe,showModal:!0})}if(Math.floor(g.age*12)===144&&g.isTested&&!g.sect){const{recommended:re,others:ye}=yp(g),Re=` ${g.name} 12`;i.push(Re),a.push({type:"JOIN_SECT",title:"",message:Re,child:g,selectableSects:re,otherSectOptions:ye,showModal:!0})}if(g.age>6){const re=Dc(g,!0);g.cultivation=Math.floor(g.cultivation+re);const ye=By(g.cultivation),Re=g.tierTitle;g.tierTitle=ye.name;const Fe=Ve.findIndex(ie=>ie.name===ye.name),O=Fe>0?Ve[Fe-1].maxExp:0;if(g.currentExp=g.cultivation-O,g.maxExp=ye.maxExp-O,Re&&Re!==g.tierTitle){const le={:30,:30,:30,:30,:50,:50,:50,:50,:200,:200,:200,:200,:300,:300,:300,:300,:500,:500,:500,:500}[g.tierTitle]||50;g.stats||(g.stats={}),typeof g.stats.lifespan!="number"&&(g.stats.lifespan=100),g.stats.lifespan+=le,i.push(` ${g.name} ${g.tierTitle} ${le} `)}if((g.generation||1)>2)return s+=uc(g,{familyRatingMultiplier:l})/12,g;if(s+=uc(g,{familyRatingMultiplier:l})/12,Math.floor(g.age*12)%36===0&&g.sect&&g.sect.level!=="NONE"){const ie=Fm.indexOf(g.rank),le=Math.max(.3,Math.min(2,((C=g.sect)==null?void 0:C.promotionEase)||1)),ee=Ee=>Ee/le;let he=0;if(g.cultivation>ee(500)&&(he=1),g.cultivation>ee(2e3)&&(((k=g.stats)==null?void 0:k.aptitude)||0)>50&&(he=2),g.cultivation>ee(2e4)&&(((R=g.stats)==null?void 0:R.aptitude)||0)>80&&(he=3),g.cultivation>ee(1e5)&&(he=5),he>ie){g.rank=Fm[he];let Ee=` ${g.name} ${g.sect.name}  ${g.rank}`;const _e=Jk(g.rank);_e&&(Ee+=` ${_e.giftName}${g.name} `,a.push({type:"CHILD_PROMOTION_GIFT",title:"",message:Ee,child:g,rank:g.rank,sect:g.sect,giftItemId:_e.giftItemId,giftName:_e.giftName,showModal:!0})),i.push(Ee)}}}if(Math.floor(g.age*12)===216&&(i.push(` ${g.name} `),g.isAdult=!0),I<=2&&g.isAdult&&g.spouse&&g.age<60&&Math.random()<.1&&e.filter(ye=>ye.parentId===g.id).length<3){const ye=((T=g.stats)==null?void 0:T.aptitude)||50,Re=((Y=(N=g.spouse)==null?void 0:N.stats)==null?void 0:Y.aptitude)||((H=g.spouse)==null?void 0:H.aptitude)||50,Fe=(ye+Re)/2;let O=Math.floor(Math.random()*31)-15;const ie=((B=g.spiritRoot)==null?void 0:B.type)==="",le=((q=($=g.spouse)==null?void 0:$.spiritRoot)==null?void 0:q.type)==="";(ie&&Math.random()<.2||le&&Math.random()<.2)&&(O+=30);const ee=Math.max(1,Math.min(100,Math.floor(Fe+O))),he=g.stats.looks||50,Ee=((se=g.spouse.stats)==null?void 0:se.looks)||g.spouse.looks||50,_e=Math.max(1,Math.min(100,Math.floor((he+Ee)/2+(Math.random()*10-5)))),rt=g.stats.intelligence||50,At=((J=g.spouse.stats)==null?void 0:J.intelligence)||g.spouse.intelligence||50,Oe=Math.max(1,Math.min(100,Math.floor((rt+At)/2+(Math.random()*10-5))));let P=null;const pe=Math.random(),fe=g.constitution&&g.constitution.name,ke=((X=g.spouse)==null?void 0:X.constitution)&&g.spouse.constitution.name;fe&&ke?pe<.8&&(P=Math.random()>.5?g.constitution:g.spouse.constitution):fe?pe<.6&&(P=g.constitution):ke&&pe<.6&&(P=g.spouse.constitution),!P&&Math.random()<.01&&(P={name:"",desc:"",rarity:"UR"});const je={weapon:null,armor:null,accessory:null};let Ge={aptitude:ee,looks:_e,intelligence:Oe};Ge=kf(Ge,P);const Jt=Ho("",Ge.aptitude,null,je),_t=Math.random()>.5?"":"",Xt=Ep({id:Date.now()+Math.random().toString().slice(2,10),name:If(_t,{preferSurname:""}),fatherName:g.name,motherName:g.spouse.name,parentId:g.id,birthYear:Math.floor(g.age*12/12),generation:(g.generation||1)+1,age:0,gender:_t,stats:Ge,constitution:P,cultivationMethod:"basic_breath",equipment:je,combatStats:Jt,avatar:{base:Math.floor(Math.random()*3),skinColor:Math.floor(Math.random()*5),eye:Math.floor(Math.random()*3),eyeColor:Math.floor(Math.random()*5),mouth:Math.floor(Math.random()*3),hair:Math.floor(_t===""?Math.random()*2:Math.random()*4),hairColor:Math.floor(Math.random()*5)},isTested:!1,cultivation:0,isAdult:!1});c.push(Xt);const dr=` ${g.name}  ${g.spouse.name} /${Xt.name}`;i.push(dr),a.push({type:"GRANDCHILD_BIRTH",title:"",message:dr,child:g,grandchildCount:1})}return g}),...c],generation3Plus:S,totalFeedback:s,totalCost:o,logs:i,events:a}},Bl=(e,t,n="random")=>{const s=t===""?"":"",o=If(s);let i,a,l,d=null;switch(n){case"talented":i=75+Math.floor(Math.random()*20),a=40+Math.floor(Math.random()*30),l=60+Math.floor(Math.random()*30);break;case"beautiful":i=50+Math.floor(Math.random()*30),a=80+Math.floor(Math.random()*20),l=50+Math.floor(Math.random()*30);break;case"wise":i=60+Math.floor(Math.random()*25),a=55+Math.floor(Math.random()*30),l=80+Math.floor(Math.random()*20);break;case"buddha":i=90+Math.floor(Math.random()*10),a=30+Math.floor(Math.random()*30),l=80+Math.floor(Math.random()*20),d="";break;default:i=40+Math.floor(Math.random()*50),a=50+Math.floor(Math.random()*40),l=40+Math.floor(Math.random()*40)}const u=Yo(i),p={weapon:null,armor:null,accessory:null},c=Ho("",i,u.type,p),f=500+Math.floor(Math.random()*1500),b=By(f).name,S=n==="buddha"?{base:0,skinColor:2,hair:-1,hairColor:null,eye:0,eyeColor:0,mouth:1}:{base:Math.floor(Math.random()*3),skinColor:Math.floor(Math.random()*5),eye:Math.floor(Math.random()*3),eyeColor:Math.floor(Math.random()*5),mouth:Math.floor(Math.random()*3),hair:Math.floor(Math.random()*3),hairColor:Math.floor(Math.random()*5)},E=n==="buddha"?"":s;return{id:Date.now()+Math.random().toString().slice(2,8),name:o,gender:E,identity:d,aptitude:i,looks:a,intelligence:l,spiritRoot:u,cultivationMethod:"basic_breath",equipment:p,combatStats:c,cultivation:f,tierTitle:b,isTested:!0,isAdult:!0,avatar:S,stats:{aptitude:i,looks:a,intelligence:l},relationship:n==="buddha"?{stage:1,affection:0,trust:0}:void 0,likes:n==="buddha"?[""]:void 0,isSpouse:!0,archetype:n}},Sh=(e,t)=>[Bl(e,t,"talented"),Bl(e,t,"beautiful"),Bl(e,t,"wise")],tE=(e,t)=>Bl(e,t,"random"),nE=e=>{const t=Cn(e.tier),n=Cf(e.tier);if(!n)return{success:!1,msg:""};const s=t.chance,o=(e.breakthroughBonus||0)/100,i=Math.min(.95,s+o);if(Math.random()<i)return{success:!0,newTier:n.name,newMaxExp:n.maxExp,baseChance:s,finalChance:i,resetFailCount:!0,msg:`${n.name}()`};{const d=Math.floor(t.maxExp*.2);return{success:!1,penalty:d,baseChance:s,finalChance:i,addFailBonus:!0,msg:` ${d} 5%`}}},wh=(e,t)=>{let n=0,s=[];return e.forEach(o=>{var p,c;const i=t.find(f=>f.id===o.managerId);if(!i){s.push(` ${o.name}`);return}const a=Math.floor(o.baseIncome*(1+i.stats.intelligence/100)),l=((c=(p=i.trait)==null?void 0:p.bonuses)==null?void 0:c.businessBonus)||0,d=R2(i.constitution),u=Math.floor(a*(1+l+d));n+=u}),{income:n,logs:s}};function rE(){const e=y.useMemo(()=>Ty.map(g=>{var _;const I=(_=g.stats)==null?void 0:_.aptitude;return typeof I=="number"?{...g,spiritRoot:Yo(I)}:g}),[]),[t,n]=y.useState(e),[s,o]=y.useState([]),[i,a]=y.useState(null),[l,d]=y.useState(null),u=y.useMemo(()=>t.filter(g=>{var I;return!((I=g.relationship)!=null&&I.cutTies)}),[t]),p=y.useCallback((g,I)=>{n(_=>_.map(C=>C.id===g?{...C,relationship:{...C.relationship,...I}}:C))},[]),c=y.useCallback((g,I)=>{n(_=>_.map(C=>C.id===g?{...C,...I}:C))},[]),f=y.useCallback(g=>{n(I=>[...I,g])},[]),b=y.useCallback(g=>{n(I=>{const _=I.find(C=>C.id===g);return _&&o(C=>[...C,_]),I.filter(C=>C.id!==g)})},[]),S=y.useCallback(g=>{n(I=>I.map(_=>_.id===g?{..._,isFollowed:!_.isFollowed}:_))},[]),E=y.useCallback(g=>{n(I=>I.map(g))},[]),j=y.useCallback(g=>{n(g)},[]),x=y.useCallback(g=>{n(I=>I.map(_=>g.get(_.id)||_))},[]),h=y.useCallback(g=>{const I=t.find(_=>_.id===g);I&&(o(_=>[..._,I]),n(_=>_.filter(C=>C.id!==g)))},[t]),v=y.useCallback(g=>{n(I=>I.map(_=>_.id===g?{..._,relationship:{..._.relationship||{},affection:0,trust:0,cutTies:!0}}:_))},[]);return{activeNpcs:t,deadNpcs:s,selectedNpc:i,selectedWorldNpc:l,visibleNpcs:u,setActiveNpcs:n,setDeadNpcs:o,setSelectedNpc:a,setSelectedWorldNpc:d,updateNpcRelationship:p,updateNpc:c,addNpc:f,removeNpc:b,toggleNpcFollow:S,batchUpdateNpcs:E,replaceAllNpcs:j,batchUpdateNpcsByMap:x,killNpc:h,cutTiesWithNpc:v}}function sE(){const[e,t]=y.useState([]),[n,s]=y.useState([]),[o,i]=y.useState(null),a=y.useCallback(x=>x?{...x,influenceProfile:jy(x)}:null,[]),l=y.useMemo(()=>e.map(a),[e,a]),d=y.useCallback(x=>{const h=((x==null?void 0:x.exiledChildren)||[]).map(v=>v.id);return l.filter(v=>!h.includes(v.id))},[l]),u=y.useCallback(x=>{i(typeof x=="function"?h=>a(x(h)):a(x))},[a]),p=y.useCallback((x,h)=>{t(v=>v.map(g=>g.id===x?{...g,...h}:g)),i(v=>!v||v.id!==x?v:a({...v,...h}))},[a]),c=y.useCallback(x=>{t(h=>[...h,x])},[]),f=y.useCallback(x=>{t(h=>{const v=h.find(g=>g.id===x);return v&&s(g=>[...g,v]),h.filter(g=>g.id!==x)})},[]),b=y.useCallback(x=>{t(h=>h.map(v=>v.id===x?{...v,isFavorite:!v.isFavorite}:v)),i(h=>{if(!h||h.id!==x)return h;const v={...h,isFavorite:!h.isFavorite};return a(v)})},[a]),S=y.useCallback(x=>{t(h=>h.map(x).filter(v=>v!==null))},[]),E=y.useCallback(x=>{t(x)},[]),j=y.useCallback((x,h)=>{t(v=>v.map(g=>x(g)?h(g):g))},[]);return{children:e,fallenChildren:n,selectedChild:o,enhancedChildren:l,setChildren:t,setFallenChildren:s,setSelectedChild:u,enhanceChild:a,visibleChildren:d,updateChild:p,addChild:c,removeChild:f,toggleChildFavorite:b,batchUpdateChildren:S,replaceAllChildren:E,batchUpdateChildrenIf:j}}const oE={},dl="./",iE=-.04,aE=0,lE=e=>typeof e=="string"&&e.startsWith("#")?e:typeof e=="number"?fp[e]||fp[0]:"#2C2C2C",cE=e=>{const t=e.replace("#",""),n=parseInt(t.substring(0,2),16)/255,s=parseInt(t.substring(2,4),16)/255,o=parseInt(t.substring(4,6),16)/255,i=Math.max(n,s,o),a=Math.min(n,s,o);let l=0,d=0,u=(i+a)/2;if(i!==a){const p=i-a;switch(d=u>.5?p/(2-i-a):p/(i+a),i){case n:l=(s-o)/p+(s<o?6:0);break;case s:l=(o-n)/p+2;break;case o:l=(n-s)/p+4;break}l/=6}return d=Math.max(0,Math.min(1,d*.9)),u=Math.max(0,Math.min(1,u*1.05)),`hsl(${Math.round(l*360)} ${Math.round(d*100)}% ${Math.round(u*100)}%)`},dE=e=>new Promise((t,n)=>{if(!e){n(new Error("Missing asset source"));return}const s=new Image;s.crossOrigin="anonymous",s.onload=()=>t(s),s.onerror=o=>n(o),s.src=e}),uE=(e,t,n)=>{const s=Math.min(t/e.width,n/e.height);let o=e.width*s,i=e.height*s,a=(t-o)/2,l=(n-i)/2;return o=Math.round(o),i=Math.round(i),a=Math.round(a),l=Math.round(l),{offsetX:a,offsetY:l,drawWidth:o,drawHeight:i}},pE=(e,t,n,s)=>{const o=e.canvas.width,i=e.canvas.height,a=document.createElement("canvas");a.width=o,a.height=i;const l=a.getContext("2d");l.imageSmoothingEnabled=!0,l.imageSmoothingQuality="high",l.drawImage(t,n.offsetX,n.offsetY,n.drawWidth,n.drawHeight);const d=document.createElement("canvas");d.width=o,d.height=i;const u=d.getContext("2d");u.imageSmoothingEnabled=!0,u.imageSmoothingQuality="high",u.fillStyle=cE(s),u.fillRect(n.offsetX,n.offsetY,n.drawWidth,n.drawHeight),u.globalCompositeOperation="destination-in",u.drawImage(a,0,0),e.drawImage(a,0,0),e.globalCompositeOperation="multiply",e.drawImage(d,0,0),e.globalCompositeOperation="source-over"},Hr=({dna:e,size:t=64,gender:n})=>{const s=y.useRef(null),o=e||{eye:0,mouth:0,hair:0,hairColor:0},i=o.hair??o.hairId??0,a=o.tZoneId??o.eye??0,l=o.mouth??o.mouthId??0,d=n||o.gender,u=d==="female"||d===""||d==="F",p=lE(o.hairColor),c=typeof o.centerBiasX=="number"?o.centerBiasX:iE*t,f=typeof o.centerBiasY=="number"?o.centerBiasY:aE*t,b={width:t,height:t,borderRadius:"8px",border:"3px solid #3e2723",background:"#8d6e63",position:"relative",overflow:"hidden",boxSizing:"border-box"},S={width:"100%",height:"100%",display:"block"},E=(x,h)=>{if(x==="base")return`${dl}assets/male/base_face.png`;if(h==null||h<0)return null;const v=String((h||0)+1).padStart(2,"0");return`${dl}assets/male/${x}/${x}_${v}.png`},j=(x,h)=>{if(x==="base")return`${dl}assets/female/base_face.png`;if(h==null||h<0)return null;const v=String((h||0)+1).padStart(2,"0");return`${dl}assets/female/${x}/${x}${v}.png`};return y.useEffect(()=>{let x=!1;const h=s.current;if(!h)return()=>{x=!0};const v=h.getContext("2d");if(!v)return()=>{x=!0};const g=Math.round(t),I=typeof window<"u"&&window.devicePixelRatio?window.devicePixelRatio:1,_=Math.max(1,Math.round(g*I)),C=Math.round(c*I),k=Math.round(f*I);h.width=_,h.height=_,h.style.width=`${g}px`,h.style.height=`${g}px`,v.imageSmoothingEnabled=!0,v.imageSmoothingQuality="high",v.clearRect(0,0,h.width,h.height);const R=j("hair",i),T=E("hair",i),N=u?[{src:j("base")},{src:j("tzone",a)},{src:j("mouth",l)},R?{src:R,tint:p}:null].filter(Boolean):[{src:E("base")},{src:E("tzone",a)},{src:E("mouth",l)},T?{src:T,tint:p}:null].filter(Boolean);return(async()=>{for(const H of N)try{const B=await dE(H.src);if(x)return;const $=uE(B,h.width,h.height);$.offsetX+=C,$.offsetY+=k,H.tint?pE(v,B,$,H.tint):v.drawImage(B,$.offsetX,$.offsetY,$.drawWidth,$.drawHeight)}catch(B){console.warn("Avatar asset failed to load:",H.src,B)}})(),()=>{x=!0}},[t,u,i,l,a,p,c,f]),r.jsx("div",{style:b,children:r.jsx("canvas",{ref:s,style:S})})},fE=({player:e,isAuto:t,onBreakthrough:n,auctionBanner:s})=>{const[o,i]=y.useState(!1),a=Math.floor(e.currentExp||0),l=Math.max(1,Math.floor(e.maxExp||1)),d=a/l,u=Math.min(100,Math.round(d*100)),p=a>=l,c=(e==null?void 0:e.avatar)||{base:0,skinColor:0,hair:0,hairColor:0,eye:0,eyeColor:1,mouth:0};return r.jsxs("div",{style:Wt.container,children:[r.jsxs("div",{style:Wt.left,children:[r.jsx("div",{style:Wt.avatarColumn,children:r.jsx("div",{style:{...Wt.avatar,border:t?"2px solid #76ff03":"none",animation:t?"pulse 1.5s infinite":"none"},children:t?r.jsx("div",{style:{fontSize:"24px"},children:""}):r.jsx(Hr,{dna:c,gender:e.gender,size:44})})}),r.jsxs("div",{style:Wt.info,children:[r.jsx("div",{style:Wt.name,children:e.name}),r.jsx("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:r.jsxs("div",{style:Wt.tier,children:[e.tier,t&&r.jsx("span",{style:Wt.meditateStatus,children:" "})]})})]})]}),r.jsx("div",{style:Wt.expBarContainer,children:r.jsxs("div",{style:Wt.expBarWrapper,children:[r.jsx("div",{style:{...Wt.expBarFill,width:`${u}%`,background:p?"linear-gradient(90deg, #FFD700, #FFA500)":"linear-gradient(90deg, #4CAF50, #81C784)"}}),r.jsxs("div",{style:Wt.expText,children:[a,"/",l]})]})}),r.jsx("div",{style:{flex:1}}),r.jsx("div",{style:Wt.right,children:r.jsxs("div",{style:Wt.statusColumn,children:[r.jsx("div",{style:Wt.timeIcon,children:""}),r.jsxs("div",{style:Wt.timeValue,children:[" ",e.time.year," ",e.time.month,""]})]})}),s&&r.jsx("div",{style:Wt.auctionBanner,className:"auction-alert-chip",children:s.message})]})},Wt={container:{height:"calc(60px + env(safe-area-inset-top, 0px))",paddingTop:"env(safe-area-inset-top, 0px)",background:"linear-gradient(135deg, #3e2723 0%, #2c1810 100%)",color:"#fff",display:"flex",alignItems:"center",justifyContent:"space-between",padding:"0 10px",position:"relative",boxShadow:"0 4px 15px rgba(0,0,0,0.3)",borderRadius:"0 0 16px 16px",paddingBottom:"12px"},left:{display:"flex",alignItems:"center",gap:"12px"},avatarColumn:{display:"flex",flexDirection:"column",alignItems:"center",gap:"4px"},avatar:{width:"44px",height:"44px",borderRadius:"50%",background:"linear-gradient(135deg, #a1887f 0%, #8d6e63 100%)",display:"flex",alignItems:"center",justifyContent:"center",overflow:"hidden",imageRendering:"pixelated",boxShadow:"0 2px 8px rgba(0,0,0,0.2)"},info:{display:"flex",flexDirection:"column",justifyContent:"center"},name:{fontSize:"15px",fontWeight:"bold",textShadow:"1px 1px 2px rgba(0,0,0,0.3)"},tier:{fontSize:"12px",color:"#ffecb3",textShadow:"1px 1px 2px rgba(0,0,0,0.3)"},meditateStatus:{color:"#76ff03",marginLeft:"5px",fontSize:"10px"},right:{display:"flex",gap:"8px",alignItems:"center",flexShrink:0},timeIcon:{fontSize:"16px"},timeValue:{fontSize:"13px",fontWeight:"bold",color:"#fff"},expBarContainer:{flex:1,maxWidth:"300px",marginLeft:"20px",marginRight:"20px"},expBarWrapper:{position:"relative",height:"24px",backgroundColor:"rgba(0,0,0,0.3)",borderRadius:"12px",overflow:"hidden",border:"1px solid rgba(255,255,255,0.1)"},expBarFill:{position:"absolute",left:0,top:0,height:"100%",transition:"width 0.3s ease",borderRadius:"12px"},expText:{position:"absolute",left:"50%",top:"50%",transform:"translate(-50%, -50%)",fontSize:"11px",fontWeight:"bold",color:"#fff",textShadow:"1px 1px 2px rgba(0,0,0,0.5)",zIndex:1},statusColumn:{display:"flex",flexDirection:"column",alignItems:"center",gap:"2px",backgroundColor:"rgba(255,255,255,0.06)",padding:"4px 8px",borderRadius:"12px"},auctionBanner:{position:"absolute",left:"50%",bottom:"-14px",transform:"translateX(-50%)",background:"rgba(255, 255, 255, 0.16)",padding:"4px 16px",borderRadius:"20px",color:"#ff5252",fontWeight:"bold",fontSize:"12px",letterSpacing:"0.5px",boxShadow:"0 6px 18px rgba(0,0,0,0.35)",animation:"auctionFlash 0.8s ease-in-out 3"}},mE=()=>{if(typeof document>"u"||document.getElementById("top-status-animations"))return;const e=document.createElement("style");e.id="top-status-animations",e.innerHTML=`
    @keyframes pulse {
      0% { transform: scale(1); box-shadow: 0 0 0 0 rgba(118, 255, 3, 0.4); }
      70% { transform: scale(1.05); box-shadow: 0 0 0 8px rgba(118, 255, 3, 0); }
      100% { transform: scale(1); box-shadow: 0 0 0 0 rgba(118, 255, 3, 0); }
    }
    @keyframes auctionFlash {
      0% { opacity: 0; transform: translate(-50%, 8px) scale(0.95); }
      30% { opacity: 1; transform: translate(-50%, 0) scale(1); }
      70% { opacity: 1; }
      100% { opacity: 0; transform: translate(-50%, -6px) scale(0.96); }
    }
  `,document.head.appendChild(e)};typeof window<"u"&&typeof document<"u"&&mE();const hE=({activeTab:e,onTabChange:t})=>{const n=[{id:"FAMILY",label:"",icon:""},{id:"NPC",label:"",icon:""},{id:"ACTION",label:"",icon:""},{id:"REVENGE",label:"",icon:""},{id:"PLAYER",label:"",icon:""},{id:"SYSTEM",label:"",icon:""},{id:"LOG",label:"",icon:""}];return r.jsx("div",{style:ul.container,children:n.map(s=>r.jsxs("button",{onClick:()=>t(s.id),style:{...ul.btn,backgroundColor:e===s.id?"rgba(255,193,7,0.2)":"transparent",fontWeight:e===s.id?"bold":"normal"},children:[r.jsx("div",{style:ul.icon,children:s.icon}),r.jsx("div",{style:ul.label,children:s.label})]},s.id))})},ul={container:{height:Se.sizes.navHeight,background:Se.gradients.warm,borderTop:`2px solid ${Se.colors.border}`,display:"flex",justifyContent:"space-around",alignItems:"center",position:"fixed",bottom:0,left:0,right:0,zIndex:100,boxShadow:`0 -6px 18px ${Se.colors.shadow}`,borderRadius:"16px 16px 0 0"},btn:{background:"none",border:"none",display:"flex",flexDirection:"column",alignItems:"center",cursor:"pointer",padding:"6px 3px",borderRadius:"10px",transition:"all 0.2s ease"},icon:{fontSize:"16px",marginBottom:"2px",color:Se.colors.ink},label:{fontSize:"10px",color:Se.colors.muted,fontFamily:"Microsoft YaHei, SimSun, serif"}},gE=e=>Math.max(0,Math.min(100,Number(e)||0)),kh=({npc:e,onInteract:t,actions:n})=>{var l;const s=((l=e.relationship)==null?void 0:l.affection)??0,o=gE(s),a=(()=>{const d=o;return d>=80?"#b03a3a":d>=40?Se.colors.accent:Se.colors.muted})();return r.jsxs("div",{style:Ut.card,children:[t&&r.jsx("button",{onClick:()=>t(e.id,"TOGGLE_FOLLOW"),style:{...Ut.followBtn,background:e.isFollowed?"#ffd54f":Ut.followBtn.background},title:e.isFollowed?"":"",children:e.isFollowed?"":""}),r.jsxs("div",{style:Ut.header,children:[r.jsx(Hr,{dna:e.avatar,gender:e.gender,size:60}),r.jsxs("div",{style:{flex:1},children:[r.jsxs("h3",{style:{margin:0},children:[e.name,r.jsx("span",{style:Ut.tag,children:e.identity})]}),r.jsx("small",{style:{color:Se.colors.muted},children:e.cultivation}),e.sect&&e.sectStatus!=="mysterious"&&e.sectStatus!=="rogue"&&r.jsx("div",{style:{marginTop:"2px"},children:r.jsx("span",{style:{fontSize:"9px",padding:"2px 6px",borderRadius:"8px",color:"white",background:e.sectStatus==="defected"?"#a65a5a":e.sectStatus==="hidden"?Se.colors.primary:e.sect.level==="TOP"?"#c9a84a":e.sect.level==="HIGH"?Se.colors.accent:e.sect.level==="RECKLESS"?"#a65a5a":Se.colors.muted,fontWeight:"bold"},children:e.sect.name})}),e.sectStatus==="mysterious"&&r.jsx("div",{style:{marginTop:"2px"},children:r.jsx("span",{style:{fontSize:"9px",padding:"2px 6px",borderRadius:"8px",color:"white",background:Se.colors.muted,fontWeight:"bold"},children:""})}),e.sectStatus==="rogue"&&r.jsx("div",{style:{marginTop:"2px"},children:r.jsx("span",{style:{fontSize:"9px",padding:"2px 6px",borderRadius:"8px",color:"white",background:Se.colors.primary,fontWeight:"bold"},children:""})})]})]}),r.jsxs("p",{style:Ut.desc,children:["",e.desc,""]}),r.jsxs("div",{style:Ut.statRow,children:[r.jsx("span",{children:":"}),r.jsx("div",{style:Ut.progressBar,children:r.jsx("div",{style:{...Ut.progressFill,width:`${o}%`,backgroundColor:a}})}),r.jsxs("span",{style:{color:a},children:[" ",o]})]}),n?r.jsx("div",{style:Ut.actions,children:n}):t?r.jsxs("div",{style:Ut.actions,children:[r.jsx("button",{onClick:()=>t(e.id,"DETAIL"),style:Ut.btn,children:" "}),r.jsx("button",{onClick:()=>t(e.id,"CHAT"),style:Ut.btn,children:" "}),r.jsx("button",{onClick:()=>t(e.id,"GIFT"),style:Ut.btn,children:" "}),r.jsx("button",{onClick:()=>t(e.id,"SPAR"),disabled:s<0,style:{...Ut.btn,opacity:s<0?.5:1,backgroundColor:Se.colors.primary,color:"white"},title:"",children:" "}),!e.isChild&&r.jsx("button",{onClick:()=>t(e.id,"DUAL_CULTIVATION"),style:{...Ut.btn,opacity:s<80?.5:1,backgroundColor:Se.colors.accent,color:"white"},title:"80+",children:" "}),!e.isChild&&r.jsx("button",{onClick:()=>t(e.id,"PROPOSE"),disabled:s<80,style:{...Ut.btn,opacity:s<80?.5:1,backgroundColor:Se.colors.primary,color:"white",cursor:s<80?"not-allowed":"pointer"},title:"80+",children:" "})]}):null]})},Ut={card:{border:`1px solid ${Se.colors.border}`,borderRadius:"8px",padding:"15px",backgroundColor:Se.colors.paper,boxShadow:`0 2px 6px ${Se.colors.shadow}`,marginBottom:"10px",position:"relative"},header:{display:"flex",gap:"10px",alignItems:"center",marginBottom:"10px"},tag:{fontSize:"12px",background:Se.colors.parchment,padding:"2px 6px",borderRadius:"4px",color:Se.colors.ink},desc:{fontStyle:"italic",color:Se.colors.ink,fontSize:"14px",margin:"5px 0 15px 0"},statRow:{display:"flex",alignItems:"center",gap:"10px",marginBottom:"15px",fontSize:"14px"},progressBar:{flex:1,height:"10px",background:Se.colors.parchment,borderRadius:"5px",overflow:"hidden"},progressFill:{height:"100%",transition:"width 0.3s ease"},actions:{display:"grid",gridTemplateColumns:"1fr 1fr 1fr",gap:"8px"},btn:{padding:"8px",border:`1px solid ${Se.colors.border}`,borderRadius:"4px",background:Se.colors.parchment,cursor:"pointer",fontSize:"12px",color:Se.colors.ink},followBtn:{position:"absolute",top:8,right:8,padding:"6px 8px",borderRadius:"6px",border:`1px solid ${Se.colors.border}`,background:Se.colors.parchment,cursor:"pointer",fontSize:"13px",lineHeight:"1"}},xE=[{id:"meet_normal_1",stage:0,text:"{name} ",options:[{label:"",result:"neutral",msg:"(+5)",change:{affection:5}},{label:"",result:"neutral",msg:"",change:{}}]},{id:"meet_normal_2",stage:0,text:"{name} ",options:[{label:"",check:e=>e.stats.intelligence>60,success:{msg:"(+8)",change:{affection:8}},fail:{msg:"(+2)",change:{affection:2}}},{label:"",result:"neutral",msg:"",change:{}}]},{id:"meet_normal_3",stage:0,text:"{name} ",options:[{label:"",check:e=>e.combatStats.atk>50,success:{msg:"(+10)",change:{affection:10}},fail:{msg:"(+3)",change:{affection:3}}},{label:"",result:"neutral",msg:"",change:{}}]},{id:"meet_normal_4",stage:0,text:"{name} ",options:[{label:"",result:"neutral",msg:"(+6)",change:{affection:6}},{label:"",result:"neutral",msg:"",change:{}}]},{id:"meet_normal_5",stage:0,text:"{name} ",options:[{label:"",result:"neutral",msg:"(+7)",change:{affection:7}},{label:"",result:"neutral",msg:"",change:{}}]},{id:"meet_normal_6",stage:0,text:"{name} ",options:[{label:"",result:"neutral",msg:"(+4)",change:{affection:4}},{label:"",result:"neutral",msg:"",change:{}}]},{id:"meet_cold_1",stage:0,reqTrait:"",text:"{name} ",options:[{label:"",result:"neutral",msg:"(+1)",change:{affection:1}},{label:"",result:"neutral",msg:"",change:{}}]},{id:"meet_cold_2",stage:0,reqTrait:"",text:"{name} ",options:[{label:"",check:e=>e.stats.luck>50,success:{msg:"(+5)",change:{affection:5}},fail:{msg:"",change:{}}},{label:"",result:"neutral",msg:"",change:{}}]},{id:"meet_cold_3",stage:0,reqTrait:"",text:"{name} ",options:[{label:"",result:"neutral",msg:"(+3)",change:{affection:3}},{label:"",result:"neutral",msg:"",change:{}}]},{id:"meet_cold_4",stage:0,reqTrait:"",text:"{name} ",options:[{label:"",result:"neutral",msg:"(+2)",change:{affection:2}},{label:"",result:"neutral",msg:"",change:{}}]},{id:"meet_cold_5",stage:0,reqTrait:"",text:"{name} ",options:[{label:"",check:e=>e.combatStats.atk>60,success:{msg:"(+7)",change:{affection:7}},fail:{msg:"(+1)",change:{affection:1}}},{label:"",result:"neutral",msg:"",change:{}}]},{id:"meet_cold_6",stage:0,reqTrait:"",text:"{name} ",options:[{label:"",check:e=>e.stats.intelligence>70,success:{msg:"(+8)",change:{affection:8}},fail:{msg:"(+0)",change:{affection:0}}},{label:"",result:"neutral",msg:"",change:{}}]},{id:"meet_gentle_1",stage:0,reqTrait:"",text:"{name} ",options:[{label:"",result:"neutral",msg:"(+7)",change:{affection:7}},{label:"",result:"neutral",msg:"(+3)",change:{affection:3}}]},{id:"meet_gentle_2",stage:0,reqTrait:"",text:"{name} ",options:[{label:"",result:"neutral",msg:"(+6)",change:{affection:6}},{label:"",result:"neutral",msg:"",change:{}}]},{id:"meet_gentle_3",stage:0,reqTrait:"",text:"{name} ",options:[{label:"",result:"neutral",msg:"(+9)",change:{affection:9}},{label:"",result:"neutral",msg:"(+2)",change:{affection:2}}]},{id:"meet_gentle_4",stage:0,reqTrait:"",text:"{name} ",options:[{label:"",result:"neutral",msg:"(+5)",change:{affection:5}},{label:"",result:"neutral",msg:"",change:{}}]},{id:"meet_gentle_5",stage:0,reqTrait:"",text:"{name} ",options:[{label:"",result:"neutral",msg:"(+8)",change:{affection:8}},{label:"",result:"neutral",msg:"",change:{}}]},{id:"meet_gentle_6",stage:0,reqTrait:"",text:"{name} ",options:[{label:"",result:"neutral",msg:"(+6)",change:{affection:6}},{label:"",result:"neutral",msg:"(+3)",change:{affection:3}}]},{id:"phase1_normal_1",stage:1,text:"{name} ",options:[{label:"",result:"good",msg:"(+10+5)",change:{affection:10,trust:5}},{label:"",result:"neutral",msg:"(+2)",change:{affection:2}}]},{id:"phase1_normal_2",stage:1,text:"{name} ",options:[{label:"",check:e=>e.stats.intelligence>65,success:{msg:"(+8+8)",change:{affection:8,trust:8}},fail:{msg:"(+4+3)",change:{affection:4,trust:3}}},{label:"",result:"neutral",msg:"(+1)",change:{affection:1}}]},{id:"phase1_normal_3",stage:1,text:"{name} ",options:[{label:"",result:"good",msg:"(+12+10)",change:{affection:12,trust:10}},{label:"",result:"neutral",msg:"(-1)",change:{affection:-1}}]},{id:"phase1_normal_4",stage:1,text:"{name} ",options:[{label:"",result:"good",msg:"(+7+4)",change:{affection:7,trust:4}},{label:"",result:"neutral",msg:"(+1)",change:{affection:1}}]},{id:"phase1_normal_5",stage:1,text:"{name} ",options:[{label:"",check:e=>e.combatStats.atk>70,success:{msg:"(+15+12)",change:{affection:15,trust:12}},fail:{msg:"(+8+6)",change:{affection:8,trust:6}}},{label:"",result:"bad",msg:"(-2)",change:{affection:-2}}]},{id:"phase1_normal_6",stage:1,text:"{name} ",options:[{label:"",result:"good",msg:"(+9+7)",change:{affection:9,trust:7}},{label:"",result:"neutral",msg:"(+0)",change:{affection:0}}]},{id:"phase1_tsundere_1",stage:1,reqTrait:"",text:'{name} ""',options:[{label:"",result:"good",msg:"(+10+5)",change:{affection:10,trust:5}},{label:"",result:"neutral",msg:"(+8)",change:{affection:8}}]},{id:"phase1_tsundere_2",stage:1,reqTrait:"",text:"{name} ",options:[{label:"",result:"good",msg:"(+9+4)",change:{affection:9,trust:4}},{label:"",result:"neutral",msg:"(+5)",change:{affection:5}}]},{id:"phase1_tsundere_3",stage:1,reqTrait:"",text:"{name} ",options:[{label:"",result:"good",msg:"(+12+6)",change:{affection:12,trust:6}},{label:"",result:"neutral",msg:"(+7)",change:{affection:7}}]},{id:"phase1_tsundere_4",stage:1,reqTrait:"",text:"{name} ",options:[{label:"",result:"good",msg:"(+11+8)",change:{affection:11,trust:8}},{label:"",result:"neutral",msg:"(+6)",change:{affection:6}}]},{id:"phase1_tsundere_5",stage:1,reqTrait:"",text:"{name} ",options:[{label:"",check:e=>e.combatStats.atk>75,success:{msg:"(+15+10)",change:{affection:15,trust:10}},fail:{msg:"(+8+5)",change:{affection:8,trust:5}}},{label:"",result:"bad",msg:"(-3)",change:{affection:-3}}]},{id:"phase1_tsundere_6",stage:1,reqTrait:"",text:"{name} ",options:[{label:"",result:"good",msg:"(+10+7)",change:{affection:10,trust:7}},{label:"",result:"neutral",msg:"(+9)",change:{affection:9}}]},{id:"phase1_greedy_1",stage:1,reqTrait:"",text:"{name} ",options:[{label:"",result:"good",msg:"(+12+3)",change:{affection:12,trust:3}},{label:"",result:"neutral",msg:"(+2)",change:{affection:2}}]},{id:"phase1_greedy_2",stage:1,reqTrait:"",text:"{name} ",options:[{label:"",check:e=>e.resources.spiritStones>500,success:{msg:"(+15+5)",change:{affection:15,trust:5}},fail:{msg:"(+1)",change:{affection:1}}},{label:"",result:"neutral",msg:"(+0)",change:{affection:0}}]},{id:"phase1_greedy_3",stage:1,reqTrait:"",text:"{name} ",options:[{label:"",check:e=>e.resources.spiritStones>300,success:{msg:"(+10+8)",change:{affection:10,trust:8}},fail:{msg:"(+1)",change:{affection:1}}},{label:"",result:"bad",msg:"(-2)",change:{affection:-2}}]},{id:"phase1_greedy_4",stage:1,reqTrait:"",text:"{name} ",options:[{label:"",result:"good",msg:"(+12+6)",change:{affection:12,trust:6}},{label:"",result:"neutral",msg:"(+5)",change:{affection:5}}]},{id:"phase1_greedy_5",stage:1,reqTrait:"",text:"{name} ",options:[{label:"",result:"good",msg:"(+15+4)",change:{affection:15,trust:4}},{label:"",result:"neutral",msg:"(+2)",change:{affection:2}}]},{id:"phase1_greedy_6",stage:1,reqTrait:"",text:"{name} ",options:[{label:"",result:"good",msg:"(+10+5)",change:{affection:10,trust:5}},{label:"",result:"neutral",msg:"(+0)",change:{affection:0}}]},{id:"phase2_normal_1",stage:2,text:"{name} ",options:[{label:"",result:"good",msg:"(+15+10)",change:{affection:15,trust:10}},{label:"",result:"neutral",msg:"(+8)",change:{affection:8}}]},{id:"phase2_normal_2",stage:2,text:"{name} ",options:[{label:"",result:"good",msg:"(+20+15)",change:{affection:20,trust:15}},{label:"",result:"neutral",msg:"(+10+5)",change:{affection:10,trust:5}}]},{id:"phase2_normal_3",stage:2,text:"{name} ",options:[{label:"",result:"good",msg:"(+25+20)",change:{affection:25,trust:20}},{label:"",result:"neutral",msg:"(+10)",change:{affection:10}}]},{id:"phase2_normal_4",stage:2,text:"{name} ",options:[{label:"",result:"good",msg:"(+30+25)",change:{affection:30,trust:25}},{label:"",result:"neutral",msg:"(+15+10)",change:{affection:15,trust:10}}]},{id:"phase2_normal_5",stage:2,text:"{name} ",options:[{label:"",result:"good",msg:"(+20+15)",change:{affection:20,trust:15}},{label:"",result:"neutral",msg:"(+5)",change:{affection:5}}]},{id:"phase2_normal_6",stage:2,text:"{name} ",options:[{label:"",result:"good",msg:"(+18+12)",change:{affection:18,trust:12}},{label:"",result:"bad",msg:"(-5)",change:{affection:-5}}]},{id:"phase2_yandere_1",stage:2,reqTrait:"",text:'{name} ""',options:[{label:"",result:"good",msg:"(+20+15)",change:{affection:20,trust:15}},{label:"",result:"bad",msg:"(-10-5)",change:{affection:-10,trust:-5}}]},{id:"phase2_yandere_2",stage:2,reqTrait:"",text:'{name} ""',options:[{label:"",result:"good",msg:"(+25+20)",change:{affection:25,trust:20}},{label:"",result:"neutral",msg:"(+10+5)",change:{affection:10,trust:5}}]},{id:"phase2_yandere_3",stage:2,reqTrait:"",text:'{name} ""',options:[{label:"",result:"good",msg:"(+15+10)",change:{affection:15,trust:10}},{label:"",result:"bad",msg:"(-15-10)",change:{affection:-15,trust:-10}}]},{id:"phase2_yandere_4",stage:2,reqTrait:"",text:'{name} ""',options:[{label:"",result:"good",msg:"(+30+25)",change:{affection:30,trust:25}},{label:"",result:"bad",msg:"(-5+10)",change:{affection:-5,trust:10}}]},{id:"phase2_yandere_5",stage:2,reqTrait:"",text:"{name} ",options:[{label:"",result:"good",msg:"(+35+30)",change:{affection:35,trust:30}},{label:"",result:"neutral",msg:"(+10+5)",change:{affection:10,trust:5}}]},{id:"phase2_yandere_6",stage:2,reqTrait:"",text:'{name} ""',options:[{label:"",result:"good",msg:"(+25+20)",change:{affection:25,trust:20}},{label:"",result:"neutral",msg:"(+15+10)",change:{affection:15,trust:10}}]},{id:"phase2_justice_1",stage:2,reqTrait:"",text:"{name} ",options:[{label:"",result:"good",msg:"(+25+20)",change:{affection:25,trust:20}},{label:"",result:"neutral",msg:"(+15+15)",change:{affection:15,trust:15}}]},{id:"phase2_justice_2",stage:2,reqTrait:"",text:"{name} ",options:[{label:"",result:"good",msg:"(+30+25)",change:{affection:30,trust:25}},{label:"",result:"neutral",msg:"(+10+5)",change:{affection:10,trust:5}}]},{id:"phase2_justice_3",stage:2,reqTrait:"",text:"{name} ",options:[{label:"",result:"good",msg:"(+20+18)",change:{affection:20,trust:18}},{label:"",result:"neutral",msg:"(+12+10)",change:{affection:12,trust:10}}]},{id:"phase2_justice_4",stage:2,reqTrait:"",text:"{name} ",options:[{label:"",result:"good",msg:"(+22+20)",change:{affection:22,trust:20}},{label:"",result:"neutral",msg:"(+15+15)",change:{affection:15,trust:15}}]},{id:"phase2_justice_5",stage:2,reqTrait:"",text:"{name} ",options:[{label:"",result:"good",msg:"(+28+25)",change:{affection:28,trust:25}},{label:"",result:"neutral",msg:"(+10+8)",change:{affection:10,trust:8}}]},{id:"phase2_justice_6",stage:2,reqTrait:"",text:"{name} ",options:[{label:"",result:"good",msg:"(+30+30)",change:{affection:30,trust:30}},{label:"",result:"neutral",msg:"(+15+12)",change:{affection:15,trust:12}}]}],yE=(e,t)=>{const n=xE.filter(o=>{var l;let i=0;const a=((l=e.relationship)==null?void 0:l.affection)||0;return a>=20&&(i=1),a>=60&&(i=2),!(o.stage!==i||o.reqTrait&&!(typeof e.personality=="object"&&e.personality!==null&&"label"in e.personality?[e.personality.label]:Array.isArray(e.personality)?e.personality:[]).includes(o.reqTrait)||o.condition&&!o.condition(e))});if(n.length===0)return null;const s=n[Math.floor(Math.random()*n.length)];return{...s,text:s.text.replace(/{name}/g,e.name)}},bE={GRAY:{color:"#9e9e9e",bg:"#eeeeee",border:"#bdbdbd",label:""},WHITE:{color:"#616161",bg:"#f5f5f5",border:"#e0e0e0",label:""},GREEN:{color:"#2e7d32",bg:"#e8f5e9",border:"#a5d6a7",label:""},BLUE:{color:"#1565c0",bg:"#e3f2fd",border:"#90caf9",label:""},PURPLE:{color:"#7b1fa2",bg:"#f3e5f5",border:"#ce93d8",label:""},ORANGE:{color:"#ef6c00",bg:"#fff3e0",border:"#ffcc80",label:""},RED:{color:"#c62828",bg:"#ffebee",border:"#ef9a9a",label:"",shadow:"0 0 5px rgba(198, 40, 40, 0.5)"}},vE=[{min:0,max:20,text:"",rarity:"GRAY"},{min:21,max:40,text:"",rarity:"WHITE"},{min:41,max:60,text:"",rarity:"GREEN"},{min:61,max:79,text:"",rarity:"BLUE"},{min:80,max:89,text:"",rarity:"PURPLE"},{min:90,max:99,text:"",rarity:"ORANGE"},{min:100,max:999,text:"",rarity:"RED"}],SE=[{min:0,max:20,text:"",rarity:"GRAY"},{min:21,max:40,text:"",rarity:"WHITE"},{min:41,max:60,text:"",rarity:"GREEN"},{min:61,max:79,text:"",rarity:"BLUE"},{min:80,max:89,text:"",rarity:"PURPLE"},{min:90,max:99,text:"",rarity:"ORANGE"},{min:100,max:999,text:"",rarity:"RED"}],hc=(e,t,n="")=>{let s=t==="INT"?SE:vE,o=s.find(a=>e>=a.min&&e<=a.max)||s[0],i=o.text;return t==="LOOKS"&&n===""&&(i===""&&(i=""),i===""&&(i="")),{text:i,rarity:o.rarity,value:e,style:bE[o.rarity]}},gc=({trait:e,showValue:t=!1})=>{const{style:n,text:s,value:o}=e;return r.jsxs("div",{style:{display:"inline-flex",alignItems:"center",padding:"2px 8px",borderRadius:"12px",backgroundColor:n.bg,border:`1px solid ${n.border}`,color:n.color,fontSize:"12px",fontWeight:"bold",boxShadow:n.shadow||"none",marginRight:"5px"},children:[r.jsx("span",{children:s}),t&&r.jsx("span",{style:{marginLeft:"5px",fontSize:"10px",opacity:.7,borderLeft:`1px solid ${n.color}`,paddingLeft:"5px"},children:o})]})},wE=e=>{if(!e)return e;try{const t=new URL(e),n=t.pathname.replace(/\/+$|^\/+/g,"");return!n||n==="v1"?(t.pathname="/v1/chat/completions",t.toString()):n.includes("v1/chat")||n.includes("v1/completions")?t.toString():e}catch{return e}},Fc=async(e,t,n,s={})=>{var d;if(!t)throw new Error(" API Key");if(!n)throw new Error(" API URL");const{model:o="deepseek-chat",temperature:i=.85,maxTokens:a=200}=s,l=wE(n);l!==n&&console.info(`[AI]  API URL : ${l}`);try{const u=await fetch(l,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${t}`},body:JSON.stringify({model:o,messages:e,temperature:i,max_tokens:a,stream:!1})});if(!u.ok){const c=await u.text().catch(()=>"");let f={};try{f=c?JSON.parse(c):{}}catch{f={raw:c}}const b=((d=f.error)==null?void 0:d.message)||f.message||f.raw||u.statusText;throw u.status===401?new Error("API  (401):  API Key Key"):u.status===404?new Error(`API  (404): Invalid URL (POST ${l}) API URL  https://api.gemai.cc/v1/chat/completions`):u.status===503?new Error(`API  (503): ${b||""}`):new Error(`API  (${u.status}): ${b}`)}const p=await u.json().catch(()=>null);if(!p||!p.choices||!p.choices[0]||!p.choices[0].message)throw new Error("API ");return p.choices[0].message.content}catch(u){throw console.error("AI :",u),u.message&&u.message.includes("Failed to fetch")?new Error(" API URL  CORS "):u}},kE=async(e,t)=>{try{return await Fc([{role:"system",content:""},{role:"user",content:""}],e,t,{maxTokens:10}),!0}catch(n){return console.error("API :",n),!1}},Os={UNFORGETTABLE:"",PROFOUND:"",SIGNIFICANT:""},vn=e=>{var t;return e.memories||(e.memories={profile:{name:e.name,personality:((t=e.personality)==null?void 0:t.label)||"",identity:e.identity||"",firstMeet:new Date().toISOString()},milestones:[],recentEvents:[],longTermSummary:"",meta:{totalEvents:0,lastSummaryTime:null,needsSummary:!1}}),e},Ao=(e,t)=>{vn(e);const n={id:Date.now(),event:t.event,time:t.time||jE(),detail:t.detail,emotionalImpact:t.emotionalImpact||Os.SIGNIFICANT,category:t.category||"other",tags:t.tags||[],createdAt:new Date().toISOString()};return e.memories.milestones.push(n),console.log(`[] ${e.name} : ${t.event}`),n},so=(e,t)=>{vn(e);const n={id:Date.now(),description:t.description,time:new Date().toISOString(),affectionChange:t.affectionChange||0,context:t.context||""};return e.memories.recentEvents.push(n),e.memories.meta.totalEvents++,e.memories.recentEvents.length>20&&e.memories.recentEvents.shift(),e.memories.meta.totalEvents%50===0&&(e.memories.meta.needsSummary=!0),n},Oy=(e,t={})=>{const{includeMilestones:n=!0,includeRecent:s=!0,maxRecent:o=5,contextKeywords:i=[]}=t;vn(e);let a="";if(n&&e.memories.milestones.length>0&&(a+=`


`,[...e.memories.milestones].sort((d,u)=>{const p={:4,:3,:2,:1};return(p[u.emotionalImpact]||0)-(p[d.emotionalImpact]||0)}).forEach((d,u)=>{a+=`${u+1}. **${d.event}**${d.time}
   ${d.detail}
   ${d.emotionalImpact}
`})),s&&e.memories.recentEvents.length>0&&(a+=`

`,e.memories.recentEvents.slice(-o).forEach(d=>{const u=TE(d.time);a+=`- ${u}: ${d.description}`,d.affectionChange!==0&&(a+=` (${d.affectionChange>0?"+":""}${d.affectionChange})`),a+=`
`})),i.length>0){const l=e.memories.milestones.filter(d=>i.some(u=>d.event.includes(u)||d.detail.includes(u)||d.tags.includes(u)));l.length>0&&(a+=`

`,l.forEach(d=>{a+=`${d.time}${d.event}...${d.detail}
`}))}return e.memories.longTermSummary&&(a+=`

${e.memories.longTermSummary}
`),a},EE=e=>{const t={family:["","","","","","","","","","",""],relationship:["","","","","","","",""],cultivation:["","","","","","",""],combat:["","","","","","",""],emotion:["","","","","","","",""]},n=[];for(const[s,o]of Object.entries(t))o.some(i=>e.includes(i))&&n.push(...o.filter(i=>e.includes(i)));return[...new Set(n)]},jE=()=>`5${["","","",""][Math.floor(Math.random()*4)]}`,CE=e=>new Date(e).toLocaleDateString("zh-CN",{year:"numeric",month:"long",day:"numeric"}),TE=e=>{const t=new Date,n=new Date(e),s=t-n,o=Math.floor(s/6e4),i=Math.floor(s/36e5),a=Math.floor(s/864e5);return o<1?"":o<60?`${o}`:i<24?`${i}`:a<7?`${a}`:CE(e)},Eh=(e,t,n={})=>{const{difficulty:s="",sacrifice:o=!1}=n;let i=`${t.name}`;return s===""?(i+="",o&&(i+="")):i+="",i+=`${o?"":""}`,Ao(e,{event:"",detail:i,emotionalImpact:Os.UNFORGETTABLE,category:"family",tags:["","",t.name,o?"":""]})},IE=(e,t="")=>Ao(e,{event:"",detail:`${t}`,emotionalImpact:Os.UNFORGETTABLE,category:"relationship",tags:["","","",""]}),_E=(e,t)=>Ao(e,{event:"",detail:t,emotionalImpact:Os.UNFORGETTABLE,category:"combat",tags:["","",""]}),jh=(e,t,n={},s="")=>{var h,v,g,I,_,C,k;const o=((h=e.relationship)==null?void 0:h.affection)||0;let i="";o>=80?i="":o>=60?i="":o>=40?i="":o>=20&&(i="");const a=((v=e.relationship)==null?void 0:v.jealousy)||e.jealousy||0;let l="",d="";a>=81?(l="",d=""):a>=61?(l="",d=""):a>=41?(l="",d=""):a>=21&&(l="",d="");const u=((g=e.personality)==null?void 0:g.label)||"",p=((I=e.personality)==null?void 0:I.desc)||e.desc||"",c=e.identity||"",f=e.tierTitle||"";let b="";(((_=n.npcs)==null?void 0:_.some(R=>{var T;return R.id===e.id&&((T=R.relationship)==null?void 0:T.stage)>=3}))||o>=90)&&(b+=`
`);const E=((C=n.children)==null?void 0:C.filter(R=>R.parentId===e.id||R.fatherId===e.id||R.motherId===e.id||R.fatherName===e.name||R.motherName===e.name))||[];if(E.length>0){const R=E.map(N=>`${N.name}${N.age}${N.tierTitle||""}`).join("");e.gender===""?b+=`
${E.length}${R}
${e.name}`:b+=`
${E.length}${R}
${t.name}`;const T=E.map(N=>{let Y=`${N.name}`;return N.sect&&(Y+=`${N.sect.name}`),N.spouse&&(Y+=`${N.spouse.name}`),N.trait&&(Y+=`${N.trait.name}`),Y}).join("");T&&(b+=`
${T}`)}const j=((k=e.relationship)==null?void 0:k.stage)||1;if(j>=2&&j<3&&(b+=`
`),e.isPregnant){const R=e.pregnancyProgress||0;b+=`
${R}`}if(n.eventHistory&&n.eventHistory.length>0){const R=n.eventHistory.filter(T=>T.npcId===e.id).slice(-3).map(T=>T.description).join("");R&&(b+=`


${R}`)}let x="";if(e.memories){const R=s?EE(s):[];x=Oy(e,{includeMilestones:!0,includeRecent:!0,maxRecent:5,contextKeywords:R}),R.some(T=>["","","",""].includes(T))&&(x+=`

 `),R.some(T=>["","","",""].includes(T))&&(x+=`

 `),R.some(T=>["",""].includes(T))&&(x+=`

 `)}return`
  

  /

  
  ${e.name}
  ${c}
  ${e.gender||""}
  ${f}
  ${e.age||""}
  ${u}${p}

  
  ${t.name}
  ${t.gender||""}
  ${t.tierTitle||""}
  ${i}${o}/100
  ${a>0?`${l}${a}/100- ${d}`:""}
  ${b?`
`+b:""}
  ${x?`
`+x:""}

  
  1. "${u}"
    - 
    - 
    - 
    - 
    - 

  2. /
    - 
    - 
    - 

  3. 
    - 30-50
    - 80
    - 

  4. 
    - <30
    - 30-60
    - 60-80
    - >80
    ${E.length>0?"- ":""}
    ${a>=21?`
    ${l}${d.replace("","").replace("","").replace("","")}`:""}

  5. 
    - 
    - "AI"""
    - 
    - 

  
  ${E.length>0?"":""}`},RE=({npc:e,player:t,apiKey:n,apiUrl:s,gameState:o={}})=>{const[i,a]=y.useState([]),[l,d]=y.useState(""),[u,p]=y.useState(!1),[c,f]=y.useState(null),b=y.useRef(null),[S,E]=y.useState(typeof window<"u"?window.innerHeight:600);y.useEffect(()=>{const g={role:"system",content:jh(e,t,o)},I=AE(e.id);I&&I.length>0?a([g,...I.filter(_=>_.role!=="system")]):a([g])},[e.id,e,t,o]),y.useEffect(()=>{b.current&&(b.current.scrollTop=b.current.scrollHeight)},[i]),y.useEffect(()=>{const g=()=>{typeof window<"u"&&window.innerHeight&&E(window.innerHeight)};return g(),window.addEventListener("resize",g),window.addEventListener("orientationchange",g),()=>{window.removeEventListener("resize",g),window.removeEventListener("orientationchange",g)}},[]),y.useEffect(()=>{i.length>1&&ME(e.id,i.filter(g=>g.role!=="system"))},[i,e.id]);const j=async()=>{if(!l.trim()||u)return;const g={role:"user",content:l.trim()},I=l.trim(),_={role:"system",content:jh(e,t,o,I)},C=i.filter(R=>R.role!=="system"),k=[_,...C,g];a(k),d(""),p(!0),f(null);try{const T={role:"assistant",content:await Fc(k,n,s)};a(N=>[...N,T])}catch(R){f(R.message);const T={role:"system",content:`${R.message}`};a(N=>[...N,T])}finally{p(!1)}},x=()=>{const g=i[0];a([g]),NE(e.id)},h=S?Math.max(360,S-120):null,v={...yn.container,height:"100%",minHeight:"320px",maxHeight:h?`${h}px`:"100%"};return r.jsxs("div",{style:v,children:[r.jsxs("div",{style:yn.toolbar,children:[r.jsxs("div",{style:yn.npcName,children:[" ",e.name," "]}),r.jsx("button",{onClick:x,style:yn.clearBtn,title:"",children:""})]}),r.jsxs("div",{style:yn.chatBox,ref:b,children:[i.filter(g=>g.role!=="system").map((g,I)=>{const _=g.role==="user";return g.role==="system"?r.jsx("div",{style:yn.systemMsg,children:g.content},I):r.jsxs("div",{style:{...yn.bubbleRow,justifyContent:_?"flex-end":"flex-start"},children:[!_&&r.jsx("div",{style:yn.avatar,title:e.name,children:e.name[0]}),r.jsx("div",{style:{...yn.bubble,background:_?"linear-gradient(135deg, #d4af37 0%, #c5a028 100%)":"#fff",color:_?"#fff":"#333",border:_?"none":"2px solid #d4af37",boxShadow:_?"0 2px 8px rgba(212, 175, 55, 0.3)":"0 2px 8px rgba(0, 0, 0, 0.1)"},children:g.content}),_&&r.jsx("div",{style:{...yn.avatar,background:"#4e6a5d"},title:"",children:t.name[0]})]},I)}),u&&r.jsx("div",{style:yn.loading,children:r.jsx("span",{className:"loading-dots",children:""})})]}),r.jsxs("div",{style:yn.inputArea,children:[r.jsx("input",{style:yn.input,value:l,onChange:g=>d(g.target.value),onKeyDown:g=>{g.key==="Enter"&&!g.shiftKey&&(g.preventDefault(),j())},placeholder:" Enter ...",disabled:u}),r.jsx("button",{onClick:j,style:{...yn.sendBtn,opacity:u||!l.trim()?.5:1,cursor:u||!l.trim()?"not-allowed":"pointer"},disabled:u||!l.trim(),children:u?"...":""})]})]})},xc="npc_chat_history_",nu=50,ME=(e,t)=>{try{const n=t.slice(-nu);localStorage.setItem(`${xc}${e}`,JSON.stringify(n)),t.length>nu&&console.log(`${t.length} -> ${nu} `)}catch(n){if(console.error(":",n),n.name==="QuotaExceededError"){console.warn("...");try{const s=t.slice(-20);localStorage.setItem(`${xc}${e}`,JSON.stringify(s))}catch(s){console.error(":",s)}}}},AE=e=>{try{const t=localStorage.getItem(`${xc}${e}`);return t?JSON.parse(t):[]}catch(t){return console.error(":",t),[]}},NE=e=>{try{localStorage.removeItem(`${xc}${e}`)}catch(t){console.error(":",t)}},yn={container:{display:"flex",flexDirection:"column",background:"rgba(255, 250, 240, 0.95)",borderRadius:"12px",border:"2px solid #d4af37",overflow:"hidden",boxShadow:"0 4px 12px rgba(0, 0, 0, 0.15)",position:"relative"},toolbar:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"12px 16px",background:"linear-gradient(135deg, #4e6a5d 0%, #3d5549 100%)",borderBottom:"2px solid #d4af37"},npcName:{fontSize:"16px",fontWeight:"bold",color:"#d4af37",textShadow:"0 1px 2px rgba(0, 0, 0, 0.3)"},clearBtn:{padding:"6px 12px",background:"rgba(255, 255, 255, 0.1)",border:"1px solid rgba(255, 255, 255, 0.3)",borderRadius:"6px",color:"#fff",fontSize:"12px",cursor:"pointer",transition:"all 0.2s"},chatBox:{flex:1,overflowY:"auto",padding:"20px",paddingBottom:"28px",display:"flex",flexDirection:"column",gap:"16px",background:`url("data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none' fill-rule='evenodd'%3E%3Cg fill='%23d4af37' fill-opacity='0.05'%3E%3Cpath d='M36 34v-4h-2v4h-4v2h4v4h2v-4h4v-2h-4zm0-30V0h-2v4h-4v2h4v4h2V6h4V4h-4zM6 34v-4H4v4H0v2h4v4h2v-4h4v-2H6zM6 4V0H4v4H0v2h4v4h2V6h4V4H6z'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E")`},bubbleRow:{display:"flex",gap:"10px",alignItems:"flex-start",animation:"fadeIn 0.3s ease-in"},avatar:{minWidth:"36px",width:"36px",height:"36px",borderRadius:"50%",background:"linear-gradient(135deg, #d4af37 0%, #c5a028 100%)",color:"#fff",display:"flex",alignItems:"center",justifyContent:"center",fontSize:"14px",fontWeight:"bold",boxShadow:"0 2px 6px rgba(0, 0, 0, 0.2)",border:"2px solid rgba(255, 255, 255, 0.5)"},bubble:{maxWidth:"70%",padding:"12px 16px",borderRadius:"16px",fontSize:"14px",lineHeight:"1.6",wordWrap:"break-word",whiteSpace:"pre-wrap"},systemMsg:{textAlign:"center",fontSize:"12px",color:"#999",padding:"8px 16px",background:"rgba(0, 0, 0, 0.05)",borderRadius:"8px",fontStyle:"italic"},loading:{fontSize:"13px",color:"#666",textAlign:"center",padding:"12px",fontStyle:"italic"},inputArea:{padding:"16px",paddingBottom:"calc(16px + env(safe-area-inset-bottom, 0px))",borderTop:"2px solid #d4af37",display:"flex",gap:"12px",background:"linear-gradient(180deg, rgba(255, 250, 240, 0.95) 0%, rgba(245, 240, 230, 0.95) 100%)",flexShrink:0},input:{flex:1,padding:"12px 16px",borderRadius:"24px",border:"2px solid #d4af37",outline:"none",fontSize:"14px",background:"#fff",transition:"all 0.2s"},sendBtn:{padding:"10px 24px",borderRadius:"24px",background:"linear-gradient(135deg, #4e6a5d 0%, #3d5549 100%)",color:"#fff",border:"none",fontWeight:"bold",fontSize:"14px",transition:"all 0.2s",boxShadow:"0 2px 6px rgba(0, 0, 0, 0.2)"}},LE=({npc:e,onClose:t,onOptionSelect:n,player:s,children:o=[],npcs:i=[],onViewLog:a,onCutTies:l,onToggleLetterAcceptance:d})=>{var j,x,h,v,g;const[u,p]=y.useState(null),[c,f]=y.useState("INFO"),b=e.acceptsLetters!==!1;y.useEffect(()=>{const I=_=>{_.key==="Escape"&&t&&t()};return window.addEventListener("keydown",I),()=>window.removeEventListener("keydown",I)},[t]);const S={children:o,npcs:i},E=({label:I,value:_,max:C=100,color:k})=>{const R=Number(C)||100,T=Number(_)||0,N=Math.max(0,Math.min(R,T)),Y=R===0?0:Math.min(100,Math.round(N/R*100));return r.jsxs("div",{style:{display:"flex",alignItems:"center",marginBottom:"5px",fontSize:"12px"},children:[r.jsx("span",{style:{width:"30px",color:"#666"},children:I}),r.jsx("div",{style:{flex:1,height:"6px",background:"#eee",borderRadius:"3px",margin:"0 8px"},children:r.jsx("div",{style:{width:`${Y}%`,background:k,height:"100%",borderRadius:"3px"}})}),r.jsx("span",{style:{width:"25px",textAlign:"right",fontWeight:"bold"},children:Math.floor(N)})]})};return r.jsx("div",{style:it.overlay,children:r.jsxs("div",{style:it.modalWrapper,children:[r.jsx("button",{onClick:t,style:it.closeBtn,"aria-label":"",children:""}),r.jsxs("div",{style:it.modal,children:[r.jsxs("div",{style:it.tabBar,children:[r.jsx("button",{onClick:()=>f("INFO"),style:{...it.tab,background:c==="INFO"?"linear-gradient(135deg, #4e6a5d 0%, #3d5549 100%)":"#f5f5f5",color:c==="INFO"?"#fff":"#333",fontWeight:c==="INFO"?"bold":"normal"},children:" "}),r.jsx("button",{onClick:()=>f("CHAT"),style:{...it.tab,background:c==="CHAT"?"linear-gradient(135deg, #4e6a5d 0%, #3d5549 100%)":"#f5f5f5",color:c==="CHAT"?"#fff":"#333",fontWeight:c==="CHAT"?"bold":"normal"},children:" "})]}),r.jsx("div",{style:it.content,children:c==="INFO"?r.jsxs("div",{style:it.leftCol,children:[r.jsx("div",{style:{marginBottom:"15px"},children:r.jsx(Hr,{dna:e.avatar,gender:e.gender,size:120})}),r.jsxs("div",{style:it.nameBlock,children:[r.jsx("h2",{style:{margin:"10px 0 5px"},children:e.name}),r.jsx("span",{style:it.identityTag,children:e.identity}),e.constitution&&r.jsx("span",{style:it.rareTag,children:e.constitution.name}),e.sect&&e.sectStatus!=="mysterious"&&e.sectStatus!=="rogue"&&r.jsx("div",{style:{marginTop:"8px",display:"flex",flexDirection:"column",gap:"4px"},children:r.jsxs("span",{style:{...it.identityTag,background:e.sectStatus==="defected"?"linear-gradient(135deg, #e53935 0%, #c62828 100%)":e.sectStatus==="hidden"?"linear-gradient(135deg, #9c27b0 0%, #7b1fa2 100%)":e.sect.level==="TOP"?"linear-gradient(135deg, #ffd700 0%, #ffb300 100%)":e.sect.level==="HIGH"?"linear-gradient(135deg, #00bcd4 0%, #0097a7 100%)":e.sect.level==="RECKLESS"?"linear-gradient(135deg, #d32f2f 0%, #b71c1c 100%)":"linear-gradient(135deg, #66bb6a 0%, #43a047 100%)",fontSize:"11px"},children:[e.sectStatus==="defected"?" ":e.sectStatus==="hidden"?" ":"","",e.sect.name,"",e.sectRank]})}),e.sectStatus==="mysterious"&&r.jsx("span",{style:{...it.identityTag,background:"linear-gradient(135deg, #616161 0%, #424242 100%)",fontSize:"11px"},children:" "}),e.sectStatus==="rogue"&&r.jsx("span",{style:{...it.identityTag,background:"linear-gradient(135deg, #8d6e63 0%, #6d4c41 100%)",fontSize:"11px"},children:" "})]}),r.jsxs("p",{style:it.desc,children:['"',e.desc||e.appearance||"",'"']}),r.jsxs("div",{style:it.attrBox,children:[r.jsx("h4",{children:" "}),r.jsxs("div",{style:{marginBottom:"8px",display:"flex",alignItems:"center"},children:[r.jsx("span",{style:{fontSize:"12px",width:"40px"},children:":"}),r.jsx(gc,{trait:hc(e.stats.looks,"LOOKS","")})]}),r.jsxs("div",{style:{marginBottom:"8px",display:"flex",alignItems:"center"},children:[r.jsx("span",{style:{fontSize:"12px",width:"40px"},children:":"}),r.jsx(gc,{trait:hc(e.stats.intelligence,"INT")})]}),e.spiritRoot&&r.jsxs("div",{style:{marginBottom:"8px"},children:[r.jsxs("div",{style:{display:"flex",alignItems:"center",marginBottom:"4px"},children:[r.jsx("span",{style:{fontSize:"12px",width:"40px"},children:":"}),r.jsx("span",{style:{fontSize:"12px",fontWeight:"bold",color:e.spiritRoot.color||"#d81b60"},children:e.spiritRoot.type})]}),e.spiritRoot.elements&&r.jsx("div",{style:{display:"flex",alignItems:"center",marginLeft:"40px"},children:r.jsx("div",{style:{display:"flex",gap:"4px"},children:e.spiritRoot.elements.map(I=>{const _=C=>({:"#FFD700",:"#4CAF50",:"#2196F3",:"#F44336",:"#795548",:"#673AB7",:"#00BCD4",:"#009688"})[C]||"#ccc";return r.jsx("span",{style:{padding:"2px 6px",borderRadius:"10px",color:"white",fontWeight:"bold",fontSize:"10px",background:_(I)},children:I},I)})})}),r.jsx("div",{style:{display:"flex",alignItems:"center",marginLeft:"40px",marginTop:"4px"},children:r.jsxs("span",{style:{fontSize:"11px",color:"#666"},children:[": ",(j=e.stats)==null?void 0:j.aptitude," (",((x=e.stats)==null?void 0:x.aptitude)>=80?"":"",")"]})}),e.spiritRoot.desc&&r.jsx("div",{style:{marginLeft:"40px",marginTop:"2px"},children:r.jsx("span",{style:{fontSize:"11px",color:"#666"},children:e.spiritRoot.desc})})]})]}),r.jsxs("div",{style:it.attrBox,children:[r.jsx("h4",{children:" "}),r.jsx(E,{label:"",value:((h=e.relationship)==null?void 0:h.affection)||0,max:100,color:"#f50057"}),r.jsx(E,{label:"",value:((v=e.relationship)==null?void 0:v.trust)||0,max:100,color:"#00e5ff"}),(()=>{var k;const I=((k=e.relationship)==null?void 0:k.affection)||0,_=$y(I),C=Nk(_);return r.jsxs("div",{style:{marginTop:"8px",display:"flex",alignItems:"center",gap:"8px"},children:[r.jsx("span",{style:{fontSize:"12px",color:"#666"},children:":"}),r.jsxs("span",{style:{padding:"4px 12px",borderRadius:"12px",fontSize:"12px",fontWeight:"bold",color:"white",backgroundColor:C.color},children:[C.icon," ",C.text]})]})})(),(()=>{var k;const I=((k=e.relationship)==null?void 0:k.jealousy)??e.jealousy??0,_=R=>R>=81?"#d32f2f":R>=61?"#f44336":R>=41?"#ff9800":R>=21?"#ffc107":"#4caf50",C=R=>R>=81?"":R>=61?"":R>=41?"":R>=21?"":"";return r.jsxs("div",{style:{marginTop:"8px"},children:[r.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",marginBottom:"4px"},children:[r.jsx("span",{style:{fontSize:"12px",color:"#666"},children:":"}),r.jsxs("span",{style:{fontSize:"11px",fontWeight:"bold",color:_(I)},children:[C(I)," (",I,")"]})]}),r.jsx("div",{style:{width:"100%",height:"8px",background:"#e0e0e0",borderRadius:"4px",overflow:"hidden"},children:r.jsx("div",{style:{width:`${I}%`,height:"100%",background:`linear-gradient(90deg, ${_(I)}, ${_(I)}dd)`,borderRadius:"4px",transition:"width 0.3s ease, background 0.3s ease"}})})]})})(),r.jsxs("div",{style:it.letterToggleRow,children:[r.jsxs("div",{children:[r.jsx("span",{style:{fontSize:"12px",color:"#666"},children:""}),r.jsx("span",{style:{fontSize:"12px",fontWeight:"bold",color:b?"#2e7d32":"#b71c1c"},children:b?"":""})]}),r.jsx("button",{type:"button",style:{...it.letterToggleBtn,background:b?"linear-gradient(135deg, #4caf50 0%, #2e7d32 100%)":"linear-gradient(135deg, #b0bec5 0%, #90a4ae 100%)"},onClick:()=>d&&d(e.id,!b),children:b?"":""})]}),r.jsx("p",{style:it.letterToggleHint,children:b?"Ta":"Ta"})]}),r.jsxs("div",{style:it.attrBox,children:[r.jsx("h4",{children:" "}),r.jsxs("div",{style:{fontSize:"12px",color:"#666",lineHeight:"1.6"},children:[r.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:"4px"},children:[r.jsx("span",{children:":"}),r.jsxs("span",{style:{fontWeight:"bold"},children:[Math.floor(e.age||18)," "]})]}),r.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:"4px"},children:[r.jsx("span",{children:":"}),r.jsxs("span",{style:{fontWeight:"bold"},children:[((g=e.stats)==null?void 0:g.lifespan)||100," "]})]}),r.jsxs("div",{style:{display:"flex",justifyContent:"space-between"},children:[r.jsx("span",{children:":"}),r.jsxs("span",{style:{fontWeight:"bold",color:(()=>{const I=Br(e);return I<10?"#f44336":I<30?"#ff9800":"#4caf50"})()},children:[Br(e)," "]})]}),Br(e)<10&&r.jsx("div",{style:{marginTop:"8px",padding:"8px",background:"rgba(244, 67, 54, 0.1)",borderRadius:"4px",color:"#f44336",fontSize:"11px"},children:" "})]})]}),e.tier&&r.jsxs("div",{style:it.attrBox,children:[r.jsx("h4",{children:" "}),r.jsxs("div",{style:{fontSize:"12px",marginBottom:"8px"},children:[r.jsx("span",{style:{color:"#666"},children:": "}),r.jsx("span",{style:{fontWeight:"bold",color:"#9c27b0"},children:e.tier||""})]}),e.currentExp!==void 0&&e.maxExp&&r.jsxs("div",{children:[r.jsxs("div",{style:{marginBottom:"4px"},children:[r.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",marginBottom:"4px"},children:[r.jsx("span",{style:{fontSize:"11px",color:"#666"},children:""}),r.jsxs("span",{style:{fontSize:"11px",color:"#666",fontWeight:"bold"},children:[Math.round(Math.floor(e.currentExp||0)/Math.max(1,Math.floor(e.maxExp||1))*100),"%"]})]}),r.jsx("div",{style:{width:"100%",height:"14px",background:"linear-gradient(to right, #f0f0f0, #e0e0e0)",borderRadius:"7px",overflow:"hidden",position:"relative",boxShadow:"inset 0 2px 4px rgba(0,0,0,0.1)"},children:r.jsx("div",{style:{width:`${Math.min(100,Math.round(Math.floor(e.currentExp||0)/Math.max(1,Math.floor(e.maxExp||1))*100))}%`,height:"100%",background:"linear-gradient(90deg, #9c27b0 0%, #d05ce3 100%)",borderRadius:"7px",transition:"width 0.3s ease",boxShadow:"0 0 10px rgba(156, 39, 176, 0.5)",position:"relative",overflow:"hidden"},children:r.jsx("div",{style:{position:"absolute",top:0,left:"-100%",width:"100%",height:"100%",background:"linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent)",animation:"shimmer 2s infinite"}})})})]}),r.jsxs("div",{style:{fontSize:"11px",color:"#666",textAlign:"right",marginTop:"2px"},children:[Math.floor(e.currentExp||0)," / ",Math.floor(e.maxExp||100)]}),e.cultivationSpeed&&r.jsxs("div",{style:{marginTop:"8px",padding:"6px 10px",background:"rgba(156, 39, 176, 0.05)",borderRadius:"6px",border:"1px solid rgba(156, 39, 176, 0.1)"},children:[r.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"4px"},children:[r.jsx("span",{style:{fontSize:"11px",color:"#666"},children:":"}),r.jsxs("span",{style:{fontSize:"11px",fontWeight:"bold",color:"#9c27b0"},children:[Math.floor(e.cultivationSpeed)," /"]})]}),(()=>{const I=e.maxExp-e.currentExp,_=Math.ceil(I/e.cultivationSpeed);return r.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[r.jsx("span",{style:{fontSize:"11px",color:"#666"},children:":"}),r.jsx("span",{style:{fontSize:"11px",fontWeight:"bold",color:_>12?"#ff9800":"#4caf50"},children:_>12?`${Math.floor(_/12)}`:`${_}`})]})})()]}),(()=>{var k;const I=((k=e.relationship)==null?void 0:k.affection)||0;let _=0,C="";return I>=80?(_=50,C=""):I>=60?(_=30,C=""):I>=40?(_=20,C=""):I>=20&&(_=10,C=""),_>0?r.jsxs("div",{style:{marginTop:"8px",padding:"6px 10px",background:"linear-gradient(135deg, rgba(244, 81, 108, 0.1), rgba(240, 98, 146, 0.1))",borderRadius:"6px",border:"1px solid rgba(244, 81, 108, 0.2)",fontSize:"11px",color:"#f4516c",display:"flex",alignItems:"center",justifyContent:"space-between"},children:[r.jsxs("span",{children:[" ",C,""]}),r.jsxs("span",{style:{fontWeight:"bold"},children:["+",_,"% "]})]}):null})()]})]}),r.jsxs("div",{style:it.personalityBox,children:[r.jsx("span",{children:""}),typeof e.personality=="object"&&e.personality!==null&&"label"in e.personality?r.jsxs("span",{style:it.tag,children:[e.personality.label," (",e.personality.desc,")"]}):Array.isArray(e.personality)?r.jsx("div",{style:{display:"flex",gap:"5px",marginTop:"5px"},children:e.personality.map((I,_)=>r.jsx("span",{style:it.tag,children:I},_))}):r.jsx("span",{style:it.tag,children:""})]}),a&&r.jsxs("button",{onClick:()=>a(e),style:{width:"100%",padding:"12px",marginTop:"15px",background:"linear-gradient(135deg, #667eea 0%, #764ba2 100%)",color:"white",border:"none",borderRadius:"8px",fontSize:"14px",fontWeight:"bold",cursor:"pointer",transition:"all 0.3s",boxShadow:"0 4px 12px rgba(102, 126, 234, 0.3)"},onMouseOver:I=>{I.currentTarget.style.transform="translateY(-2px)",I.currentTarget.style.boxShadow="0 6px 16px rgba(102, 126, 234, 0.4)"},onMouseOut:I=>{I.currentTarget.style.transform="translateY(0)",I.currentTarget.style.boxShadow="0 4px 12px rgba(102, 126, 234, 0.3)"},children:[" ",e.name,""]}),r.jsx("div",{style:{marginTop:"10px"},children:r.jsx("button",{onClick:()=>{l&&window.showConfirm&&window.showConfirm(` ${e.name} `,()=>l(e.id))},style:{width:"100%",padding:"12px",marginTop:"10px",background:"linear-gradient(135deg, #e53935 0%, #c62828 100%)",color:"white",border:"none",borderRadius:"8px",fontSize:"14px",cursor:"pointer"},children:" "})})]}):c==="CHAT"?r.jsx("div",{style:it.chatWrapper,children:(()=>{const I=localStorage.getItem("game_api_key"),_=localStorage.getItem("game_api_url");return!I||!_?r.jsxs("div",{style:it.noApiHint,children:[r.jsx("div",{style:{fontSize:"48px",marginBottom:"20px"},children:""}),r.jsx("h3",{children:""}),r.jsxs("p",{children:[" AI API  ",e.name," "]}),r.jsxs("div",{style:{marginTop:"20px",padding:"15px",background:"rgba(255, 255, 255, 0.7)",borderRadius:"8px",fontSize:"13px",lineHeight:"1.6"},children:[r.jsx("strong",{children:""}),r.jsx("br",{}),"1. ",r.jsx("br",{}),"2. AI  API Key  URL",r.jsx("br",{}),"3.  DeepSeek",r.jsx("br",{}),"4. ",r.jsx("br",{}),"5.  NPC "]})]}):r.jsx(RE,{npc:e,player:s,apiKey:I,apiUrl:_,gameState:S})})()}):null})]})]})})},it={overlay:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0,0,0,0.5)",display:"flex",justifyContent:"center",alignItems:"center",zIndex:1e3,backdropFilter:"blur(2px)"},modalWrapper:{position:"relative",width:"min(600px, calc(100vw - 32px))"},modal:{width:"100%",maxWidth:"600px",height:"80vh",backgroundColor:"#f5f0e8",borderRadius:"16px",overflow:"hidden",display:"flex",flexDirection:"column",position:"relative",boxShadow:"0 8px 30px rgba(0,0,0,0.2)",border:"2px solid #d7ccc8"},closeBtn:{position:"absolute",top:"-18px",left:"-18px",border:"none",background:"#ffffff",fontSize:"24px",cursor:"pointer",color:"#8d6e63",width:"44px",height:"44px",borderRadius:"50%",display:"flex",alignItems:"center",justifyContent:"center",boxShadow:"0 12px 30px rgba(0,0,0,0.25)",zIndex:5},content:{display:"flex",flex:1,height:"calc(100% - 40px)",overflow:"hidden"},leftCol:{width:"100%",backgroundColor:"#faf8f5",padding:"25px",display:"flex",flexDirection:"column",overflowY:"auto"},desc:{fontSize:"14px",color:"#5d4037",fontStyle:"italic",marginBottom:"20px",lineHeight:"1.8",padding:"15px",background:"#f5f0e8",borderRadius:"10px",border:"1px solid #e0e0e0",fontFamily:"Microsoft YaHei, SimSun, serif"},tag:{fontSize:"13px",background:"linear-gradient(135deg, #d7ccc8 0%, #bcaaa4 100%)",padding:"4px 12px",borderRadius:"15px",color:"#3e2723",boxShadow:"0 2px 4px rgba(0,0,0,0.05)"},identityTag:{background:"linear-gradient(135deg, #795548 0%, #5d4037 100%)",color:"white",padding:"4px 10px",borderRadius:"8px",fontSize:"11px",marginRight:"8px",boxShadow:"0 2px 4px rgba(0,0,0,0.1)"},rareTag:{background:"linear-gradient(45deg, #FFD700, #FFA500)",color:"white",padding:"4px 10px",borderRadius:"8px",fontSize:"11px",marginLeft:"5px",fontWeight:"bold",boxShadow:"0 2px 4px rgba(0,0,0,0.1)"},attrBox:{background:"linear-gradient(135deg, #ffffff 0%, #f5f0e8 100%)",padding:"18px",borderRadius:"12px",marginBottom:"20px",border:"1px solid #e0e0e0",boxShadow:"0 2px 8px rgba(0,0,0,0.05)"},letterToggleRow:{marginTop:"14px",padding:"10px 0",borderTop:"1px dashed rgba(0,0,0,0.08)",display:"flex",alignItems:"center",justifyContent:"space-between",gap:"12px"},letterToggleBtn:{border:"none",color:"#fff",padding:"6px 14px",borderRadius:"999px",fontSize:"12px",fontWeight:"bold",cursor:"pointer",transition:"transform 0.2s ease",boxShadow:"0 2px 6px rgba(0,0,0,0.15)"},letterToggleHint:{fontSize:"11px",color:"#8d6e63",marginTop:"4px"},personalityBox:{marginTop:"auto",padding:"15px",background:"linear-gradient(135deg, #ffffff 0%, #f5f0e8 100%)",borderRadius:"12px",fontSize:"13px",border:"1px solid #e0e0e0",boxShadow:"0 2px 8px rgba(0,0,0,0.05)"},tabBar:{display:"flex",borderBottom:"2px solid #d7ccc8",background:"linear-gradient(180deg, #f5f0e8 0%, #ebe6dd 100%)"},tab:{flex:1,padding:"15px",border:"none",cursor:"pointer",fontSize:"14px",transition:"all 0.3s",borderRadius:"0"},chatWrapper:{width:"100%",height:"100%",display:"flex",flexDirection:"column",padding:"20px",boxSizing:"border-box"},noApiHint:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",height:"100%",textAlign:"center",padding:"40px",color:"#5d4037"}},$E=e=>e>=90?"#FFD700":e>=80?"#9C27B0":e>=60?"#2196F3":"#4CAF50",BE=e=>({:"#FFD700",:"#9C27B0",:"#2196F3",:"#4CAF50",:"#9E9E9E",:"#00BCD4"})[e]||"#9E9E9E",Py=(e,t,n={})=>e==="PLAYER"?0:n[e]==="PLAYER"||!t.find(o=>o.id===n[e])?1:1+Py(n[e],t,n),zy=({node:e,allChildren:t,onNodeClick:n,generation:s=0,parentMap:o={}})=>{var d;const i=t.filter(u=>u.parentId===e.id),a=s+1,l=a<=2;return r.jsxs("div",{style:qt.nodeWrapper,children:[r.jsxs("div",{style:{...qt.card,borderColor:e.id==="PLAYER"||((d=e.stats)==null?void 0:d.aptitude)>=80?"#d4af37":"#dcd6cc",cursor:e.isPregnant?"default":"pointer"},onClick:()=>{e.isPregnant||n(e)},children:[r.jsx("div",{style:qt.avatar,children:e.gender===""?"":""}),r.jsx("div",{style:qt.name,children:e.name}),e.id!=="PLAYER"&&r.jsxs(r.Fragment,{children:[r.jsx("div",{style:qt.tier,children:e.tierTitle||""}),e.spouse&&r.jsx("div",{style:qt.spouseTag,children:" "}),e.isPregnant&&r.jsxs("div",{style:qt.pregnantTag,children:[" ",e.gender===""&&r.jsx("span",{style:{fontSize:"9px"},children:"()"})]})]})]}),i.length>0&&r.jsx("div",{style:qt.lineDown}),i.length>0&&r.jsx("div",{style:qt.childrenContainer,children:l?i.map((u,p)=>r.jsxs("div",{style:qt.childWrapper,children:[r.jsx("div",{style:{...qt.lineTop,left:p===0?"50%":"0",width:p===0||p===i.length-1?"50%":"100%",display:i.length===1?"none":"block"}}),r.jsx(zy,{node:u,allChildren:t,onNodeClick:n,generation:a,parentMap:o})]},u.id)):r.jsxs("div",{style:qt.generationCounter,children:[" ",i.length,""]})})]})},OE=({player:e,children:t,pregnantNpcs:n=[],onChildClick:s,generation3Plus:o=[]})=>{const[i,a]=y.useState(1),[l,d]=y.useState({x:0,y:0}),[u,p]=y.useState(!1),[c,f]=y.useState({x:0,y:0}),[b,S]=y.useState(null),[E,j]=y.useState(null),x=y.useRef(null),h=$=>{$.cancelable&&$.preventDefault();const q=$.deltaY*-.001,se=Math.min(Math.max(.2,i+q),3);a(se)},v=$=>{p(!0),f({x:$.clientX-l.x,y:$.clientY-l.y})},g=$=>{u&&d({x:$.clientX-c.x,y:$.clientY-c.y})},I=()=>{p(!1)},_=$=>{const q=$[0].clientX-$[1].clientX,se=$[0].clientY-$[1].clientY;return Math.sqrt(q*q+se*se)},C=$=>{$.touches.length===1?(p(!0),S({x:$.touches[0].clientX-l.x,y:$.touches[0].clientY-l.y})):$.touches.length===2&&j(_($.touches))},k=$=>{if($.cancelable&&$.preventDefault(),$.touches.length===1&&u&&b)d({x:$.touches[0].clientX-b.x,y:$.touches[0].clientY-b.y});else if($.touches.length===2&&E){const q=_($.touches),se=q/E,J=Math.min(Math.max(.2,i*se),3);a(J),j(q)}},R=()=>{p(!1),S(null),j(null)},T={id:"PLAYER",name:e.name+" ()",gender:e.gender,parentId:null},N=n.map(($,q)=>({id:`embryo-${$.id||q}`,name:`${$.name}`,gender:$.gender||"",parentId:"PLAYER",generation:1,tierTitle:"",isPregnant:!0})),Y=[...t,...N].map($=>({...$,parentId:$.parentId||"PLAYER"})),H={};Y.forEach($=>{$.id&&(H[$.id]=$.parentId)});const B={};return Y.forEach($=>{if(!$.isPregnant){const q=Py($.id,Y,H);B[q]=(B[q]||0)+1}}),o.forEach($=>{const q=$.generation;B[q]=(B[q]||0)+1}),r.jsxs("div",{ref:x,style:qt.viewport,onWheel:h,onMouseDown:v,onMouseMove:g,onMouseUp:I,onMouseLeave:I,onTouchStart:C,onTouchMove:k,onTouchEnd:R,onTouchCancel:R,children:[Object.keys(B).length>0&&r.jsx("div",{style:qt.statsPanel,children:Object.keys(B).sort(($,q)=>$-q).map($=>r.jsxs("span",{style:qt.statItem,children:["",$,": ",r.jsx("strong",{children:B[$]}),""]},$))}),r.jsxs("div",{style:qt.controls,children:[r.jsx("button",{onClick:()=>a(Math.min(3,i+.1)),children:""}),r.jsx("button",{onClick:()=>a(Math.max(.2,i-.1)),children:""}),r.jsx("button",{onClick:()=>{a(1),d({x:0,y:0})},children:""})]}),r.jsx("div",{style:{transform:`translate(${l.x}px, ${l.y}px) scale(${i})`,transformOrigin:"top center",transition:u?"none":"transform 0.1s ease-out",...qt.treeCanvas},children:r.jsx(zy,{node:T,allChildren:Y,onNodeClick:$=>$.id!=="PLAYER"&&s($),generation:0,parentMap:H})})]})},qt={viewport:{width:"100%",height:"650px",overflow:"hidden",background:"#f0f4f8",position:"relative",border:"3px double #dcd6cc",borderRadius:"12px",cursor:"grab"},controls:{position:"absolute",top:10,right:10,zIndex:10,display:"flex",gap:"5px"},statsPanel:{position:"absolute",top:10,left:10,zIndex:10,background:"rgba(255,255,255,0.95)",padding:"8px 12px",borderRadius:"8px",border:"2px solid #dcd6cc",boxShadow:"0 2px 6px rgba(0,0,0,0.1)",display:"flex",flexDirection:"column",gap:"4px",fontSize:"14px",maxHeight:"200px",overflowY:"auto"},statItem:{display:"block",color:"#333",lineHeight:"1.4"},treeCanvas:{display:"flex",justifyContent:"center",paddingTop:"50px",width:"max-content",minWidth:"100%"},nodeWrapper:{display:"flex",flexDirection:"column",alignItems:"center"},card:{width:"100px",padding:"8px",background:"#fff",border:"2px solid #ccc",borderRadius:"8px",textAlign:"center",cursor:"pointer",boxShadow:"0 2px 5px rgba(0,0,0,0.1)",position:"relative",zIndex:2},childrenContainer:{display:"flex",paddingTop:"20px"},childWrapper:{display:"flex",flexDirection:"column",alignItems:"center",position:"relative",padding:"0 10px"},lineDown:{width:"2px",height:"20px",background:"#ccc"},lineTop:{position:"absolute",top:0,height:"20px",borderTop:"2px solid #ccc",zIndex:1},avatar:{fontSize:"24px"},name:{fontSize:"12px",fontWeight:"bold",margin:"2px 0"},tier:{fontSize:"10px",color:"#666"},spouseTag:{fontSize:"10px",color:"#e91e63",marginTop:"2px"},pregnantTag:{fontSize:"10px",color:"#ff9800",marginTop:"2px"},generationCounter:{fontSize:"14px",fontWeight:"bold",color:"#2e7d32",padding:"10px 15px",backgroundColor:"#e8f5e9",borderRadius:"8px",marginTop:"10px",border:"2px dashed #2e7d32",display:"flex",alignItems:"center",justifyContent:"center"}},PE=[{value:"age",label:""},{value:"aptitude",label:""},{value:"cultivation",label:""},{value:"rank",label:""},{value:"name",label:""}],pl=10,zE=["","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","",""],Ch=(e="")=>{if(!e)return 0;const t=zE.indexOf(e);return t>=0?t:0},Th=e=>{if(!e)return 999;const t=Ef.find(n=>n.name===e);return t?t.id:999},DE=({children:e,pregnantNpcs:t=[],onChildClick:n,onToggleFavorite:s})=>{const[o,i]=y.useState("age"),[a,l]=y.useState("all"),[d,u]=y.useState("all"),[p,c]=y.useState("all"),[f,b]=y.useState(!1),[S,E]=y.useState(1),[j,x]=y.useTransition(),h=y.useCallback(T=>{x(()=>i(T))},[x]);y.useEffect(()=>{E(1)},[o,a,d,p,f,e.length]);const v=y.useMemo(()=>new Set(t.map(T=>T.id)),[t]),g=y.useMemo(()=>{const T=new Map,N=new Map(e.map(H=>[H.id,H])),Y=H=>{if(!H)return 1;if(T.has(H.id))return T.get(H.id);if(!H.parentId||H.parentId==="PLAYER")return T.set(H.id,1),1;const B=N.get(H.parentId),$=B?Y(B):0,q=Math.max(1,$+1);return T.set(H.id,q),q};return e.forEach(H=>Y(H)),T},[e]),I=y.useCallback(T=>T&&g.get(T.id)||1,[g]),_=y.useMemo(()=>{let T=[...e];return f&&(T=T.filter(N=>N.isFavorite)),a!=="all"&&(T=T.filter(N=>N.gender===a)),d!=="all"&&(T=T.filter(N=>{const Y=I(N);return d==="3+"?Y>=3:Y===parseInt(d)})),p!=="all"&&(T=T.filter(N=>p==="married"?N.spouse:p==="single"?!N.spouse:p==="pregnant"?v.has(N.id):p==="cultivating"?N.sect:!0)),T.sort((N,Y)=>{var H,B;switch(o){case"age":return N.age-Y.age;case"aptitude":return(((H=Y.stats)==null?void 0:H.aptitude)||0)-(((B=N.stats)==null?void 0:B.aptitude)||0);case"cultivation":const $=Ch(N.tier||""),q=Ch(Y.tier||"");if($!==q)return q-$;const se=N.currentExp||0;return(Y.currentExp||0)-se;case"rank":const X=Th(N.rank),re=Th(Y.rank);return X===999&&re===999?0:X===999?1:re===999?-1:re-X;case"name":return N.name.localeCompare(Y.name,"zh-CN");default:return 0}}),T},[e,o,a,d,p,v,f,g]),C=y.useMemo(()=>Math.max(1,Math.ceil(_.length/pl)),[_.length]);y.useEffect(()=>{E(T=>Math.min(T,C))},[C]);const k=y.useMemo(()=>{const T=(S-1)*pl;return _.filter(Y=>I(Y)<=2).slice(T,T+pl)},[_,S]),R=y.useMemo(()=>({total:e.length,male:e.filter(T=>T.gender==="").length,female:e.filter(T=>T.gender==="").length,married:e.filter(T=>T.spouse).length,pregnant:v.size,cultivating:e.filter(T=>T.sect).length,genius:e.filter(T=>{var N;return(((N=T.stats)==null?void 0:N.aptitude)||0)>=80}).length,favorite:e.filter(T=>T.isFavorite).length}),[e,v]);return r.jsxs("div",{style:be.container,children:[r.jsxs("div",{style:be.header,children:[r.jsxs("h3",{style:be.title,children:[" (1-2: ",_.filter(T=>I(T)<=2).length," / : ",R.total,")"]}),r.jsx("div",{style:be.statsBar,children:r.jsxs("span",{style:be.statItem,children:[": ",_.filter(T=>I(T)>2).length]})}),r.jsxs("div",{style:be.statsBar,children:[r.jsxs("span",{style:be.statItem,children:[" ",R.male]}),r.jsxs("span",{style:be.statItem,children:[" ",R.female]}),r.jsxs("span",{style:be.statItem,children:[" ",R.married]}),r.jsxs("span",{style:be.statItem,children:[" ",R.pregnant]}),r.jsxs("span",{style:be.statItem,children:[" ",R.cultivating]}),r.jsxs("span",{style:be.statItem,children:[" ",R.genius]}),r.jsxs("span",{style:be.statItem,children:[" ",R.favorite]})]})]}),r.jsxs("div",{style:be.controls,children:[r.jsxs("div",{style:be.sortRow,children:[r.jsx("span",{style:be.label,children:":"}),r.jsx("div",{style:be.segmentedRow,children:PE.map(T=>r.jsx("button",{type:"button",onClick:()=>h(T.value),style:{...be.segmentButton,...o===T.value?be.segmentButtonActive:{}},children:T.label},T.value))}),j&&r.jsx("span",{style:be.pendingHint,children:"..."}),r.jsx("button",{type:"button",onClick:()=>b(T=>!T),style:{...be.favoriteToggle,...f?be.favoriteToggleActive:{}},children:f?" ":" "})]}),r.jsxs("div",{style:be.filterRow,children:[r.jsxs("div",{style:be.controlGroup,children:[r.jsx("label",{style:be.label,children:":"}),r.jsxs("select",{value:a,onChange:T=>l(T.target.value),style:be.select,children:[r.jsx("option",{value:"all",children:""}),r.jsx("option",{value:"",children:""}),r.jsx("option",{value:"",children:""})]})]}),r.jsxs("div",{style:be.controlGroup,children:[r.jsx("label",{style:be.label,children:":"}),r.jsxs("select",{value:d,onChange:T=>u(T.target.value),style:be.select,children:[r.jsx("option",{value:"all",children:""}),r.jsx("option",{value:"1",children:""}),r.jsx("option",{value:"2",children:""}),r.jsx("option",{value:"3+",children:"+"})]})]}),r.jsxs("div",{style:be.controlGroup,children:[r.jsx("label",{style:be.label,children:":"}),r.jsxs("select",{value:p,onChange:T=>c(T.target.value),style:be.select,children:[r.jsx("option",{value:"all",children:""}),r.jsx("option",{value:"married",children:""}),r.jsx("option",{value:"single",children:""}),r.jsx("option",{value:"pregnant",children:""}),r.jsx("option",{value:"cultivating",children:""})]})]})]})]}),t.length>0&&p!=="single"&&p!=="cultivating"&&r.jsxs("div",{style:be.section,children:[r.jsxs("h4",{style:be.sectionTitle,children:["  (",t.length,")"]}),r.jsx("div",{style:be.embryoList,children:t.map(T=>r.jsxs("div",{style:be.embryoCard,children:[r.jsx("div",{style:be.embryoIcon,children:""}),r.jsxs("div",{style:be.embryoInfo,children:[r.jsx("div",{style:be.embryoName,children:"..."}),r.jsxs("div",{style:be.embryoDetail,children:[": ",T.name," ",T.gender===""&&r.jsx("span",{style:{fontSize:"10px",color:"#ff6b6b"},children:"()"})]}),r.jsx("div",{style:be.progressBar,children:r.jsx("div",{style:{...be.progressFill,width:`${(T.pregnancyProgress||0)*10}%`}})}),r.jsxs("div",{style:be.embryoProgress,children:[T.pregnancyProgress||0,"/9"]})]})]},`embryo-${T.id}`))})]}),r.jsx("div",{style:be.listContainer,children:_.length===0?r.jsxs("div",{style:be.emptyState,children:[r.jsx("div",{style:be.emptyIcon,children:""}),r.jsx("div",{style:be.emptyText,children:""})]}):k.map(T=>{var B,$,q;const N=I(T),Y=v.has(T.id),H=T.influenceProfile;return r.jsxs("div",{style:be.childCard,onClick:()=>n(T),children:[s&&r.jsx("button",{type:"button",title:T.isFavorite?"":"",style:{...be.favoriteButton,...T.isFavorite?be.favoriteButtonActive:{}},onClick:se=>{se.stopPropagation(),s(T.id)},children:T.isFavorite?"":""}),r.jsxs("div",{style:be.avatarSection,children:[T.age===0?r.jsx("div",{style:be.babyIcon,children:""}):T.age<15?r.jsx("div",{style:be.babyIcon,children:""}):r.jsx(Hr,{dna:T.avatar,gender:T.gender,size:60}),r.jsx("div",{style:be.genderBadge,"data-gender":T.gender,children:T.gender===""?"":""})]}),r.jsxs("div",{style:be.infoSection,children:[r.jsxs("div",{style:be.childName,children:[r.jsx("span",{style:{color:$E(((B=T.stats)==null?void 0:B.aptitude)||0)},children:T.name}),r.jsxs("span",{style:be.generationBadge,children:["",N,""]}),((($=T.stats)==null?void 0:$.aptitude)||0)>=80&&r.jsx("span",{style:be.geniusBadge,children:""}),T.isFavorite&&r.jsx("span",{style:be.favoriteBadge,children:" "})]}),r.jsxs("div",{style:be.infoRow,children:[r.jsxs("span",{style:be.infoItem,children:[": ",Math.floor(T.age),""]}),r.jsx("span",{style:be.infoItem,children:T.tierTitle||""}),T.isTested&&T.spiritRoot&&r.jsx("span",{style:{...be.infoItem,color:BE(T.spiritRoot.type)},children:T.spiritRoot.type})]}),r.jsxs("div",{style:be.infoRow,children:[r.jsxs("span",{style:be.infoItem,children:[": ",Math.floor(((q=T.stats)==null?void 0:q.aptitude)||0)]}),T.rank&&r.jsxs("span",{style:be.rankBadge,children:[" ",T.rank]}),T.sect&&r.jsxs("span",{style:be.sectBadge,children:[" ",T.sect.name]}),T.spouse&&r.jsxs("span",{style:be.spouseBadge,children:[" ",T.spouse.name]}),Y&&r.jsx("span",{style:be.pregnantBadge,children:" "})]}),H&&r.jsxs("div",{style:be.influenceRow,children:[r.jsx("span",{style:{...be.influenceBadge,borderColor:H.color},children:H.label}),r.jsx("div",{style:be.influenceMeter,children:r.jsx("div",{style:{...be.influenceMeterFill,width:`${Math.min(100,Math.round((H.progress||0)*100))}%`,background:H.color}})}),r.jsx("span",{style:be.influenceScore,children:Math.floor(H.score)})]}),T.cultivationManual&&r.jsxs("div",{style:be.manualInfo,children:[" ",T.cultivationManual.name]})]}),r.jsx("div",{style:be.arrowSection,children:""})]},T.id)})}),_.length>pl&&r.jsxs("div",{style:be.pagination,children:[r.jsx("button",{style:{...be.pageBtn,opacity:S===1?.6:1},onClick:()=>E(T=>Math.max(1,T-1)),disabled:S===1,children:""}),r.jsxs("span",{style:be.pageInfo,children:[" ",S," / ",C," "]}),r.jsx("button",{style:{...be.pageBtn,opacity:S>=C?.6:1},onClick:()=>E(T=>Math.min(C,T+1)),disabled:S>=C,children:""})]})]})},be={container:{padding:"15px",backgroundColor:"#f5f0e8",borderRadius:"12px",border:"2px solid #8d6e63",maxHeight:"800px",height:"100%",display:"flex",flexDirection:"column",overflow:"hidden"},header:{marginBottom:"15px"},title:{margin:"0 0 10px 0",fontSize:"18px",fontWeight:"bold",color:"#5d4037"},statsBar:{display:"flex",gap:"12px",flexWrap:"wrap"},controls:{display:"flex",flexDirection:"column",gap:"12px",marginBottom:"15px",padding:"10px",backgroundColor:"rgba(255,255,255,0.5)",borderRadius:"8px"},sortRow:{display:"flex",flexWrap:"wrap",alignItems:"center",gap:"10px"},segmentedRow:{display:"flex",flexWrap:"wrap",gap:"6px"},pendingHint:{fontSize:"11px",color:"#5d4037",fontStyle:"italic"},segmentButton:{border:"1px solid #8d6e63",borderRadius:"16px",padding:"4px 10px",fontSize:"12px",backgroundColor:"white",color:"#5d4037",cursor:"pointer",transition:"all 0.2s ease"},segmentButtonActive:{backgroundColor:"#8d6e63",color:"white",boxShadow:"0 2px 6px rgba(0,0,0,0.2)"},favoriteToggle:{border:"1px dashed #c2185b",borderRadius:"16px",padding:"4px 12px",fontSize:"12px",cursor:"pointer",backgroundColor:"white",color:"#c2185b",fontWeight:"bold"},favoriteToggleActive:{backgroundColor:"#c2185b",color:"white"},filterRow:{display:"flex",flexWrap:"wrap",gap:"10px"},controlGroup:{display:"flex",alignItems:"center",gap:"5px"},label:{fontSize:"12px",fontWeight:"bold",color:"#5d4037"},select:{padding:"4px 8px",borderRadius:"4px",border:"1px solid #8d6e63",backgroundColor:"white",fontSize:"12px",cursor:"pointer"},influenceRow:{display:"flex",alignItems:"center",gap:"8px",marginTop:"6px"},influenceBadge:{borderRadius:"999px",border:"1px solid #ccc",padding:"2px 8px",fontSize:"11px",fontWeight:600},influenceMeter:{flex:1,height:"6px",backgroundColor:"#e0e0e0",borderRadius:"999px",overflow:"hidden"},influenceMeterFill:{height:"100%"},influenceScore:{fontSize:"12px",fontWeight:700,color:"#37474f"},section:{marginBottom:"15px"},sectionTitle:{margin:"0 0 10px 0",fontSize:"14px",fontWeight:"bold",color:"#d81b60"},embryoList:{display:"flex",gap:"10px",flexWrap:"wrap",marginBottom:"10px"},embryoCard:{display:"flex",alignItems:"center",gap:"10px",padding:"10px",backgroundColor:"white",borderRadius:"8px",border:"2px dashed #d81b60",minWidth:"200px"},embryoIcon:{fontSize:"32px"},embryoInfo:{flex:1},embryoName:{fontWeight:"bold",color:"#d81b60",marginBottom:"4px"},embryoDetail:{fontSize:"11px",color:"#666",marginBottom:"4px"},progressBar:{height:"6px",backgroundColor:"#e0e0e0",borderRadius:"3px",overflow:"hidden",marginBottom:"4px"},progressFill:{height:"100%",backgroundColor:"#d81b60",transition:"width 0.3s ease"},embryoProgress:{fontSize:"10px",color:"#666"},listContainer:{flex:1,overflowY:"auto",WebkitOverflowScrolling:"touch",display:"flex",flexDirection:"column",gap:"10px",minHeight:0},childCard:{display:"flex",gap:"12px",padding:"12px",backgroundColor:"white",borderRadius:"10px",border:"2px solid #e0e0e0",cursor:"pointer",transition:"all 0.2s ease",boxShadow:"0 2px 4px rgba(0,0,0,0.05)",position:"relative"},favoriteButton:{position:"absolute",top:"10px",right:"10px",border:"none",background:"transparent",fontSize:"18px",cursor:"pointer",color:"#d7ccc8",transition:"transform 0.2s ease, color 0.2s ease"},favoriteButtonActive:{color:"#ffb300",textShadow:"0 0 6px rgba(255,179,0,0.6)"},avatarSection:{position:"relative",flexShrink:0},babyIcon:{width:"60px",height:"60px",display:"flex",alignItems:"center",justifyContent:"center",fontSize:"40px",backgroundColor:"#f5f5f5",borderRadius:"50%"},genderBadge:{position:"absolute",bottom:"-4px",right:"-4px",width:"20px",height:"20px",borderRadius:"50%",display:"flex",alignItems:"center",justifyContent:"center",fontSize:"12px",fontWeight:"bold",color:"white",backgroundColor:"#4285F4",border:"2px solid white"},infoSection:{flex:1,display:"flex",flexDirection:"column",gap:"6px",minWidth:0},childName:{display:"flex",alignItems:"center",gap:"6px",fontSize:"14px",fontWeight:"bold",flexWrap:"wrap"},generationBadge:{fontSize:"10px",padding:"2px 6px",backgroundColor:"#e3f2fd",color:"#1976d2",borderRadius:"10px",fontWeight:"normal"},geniusBadge:{fontSize:"10px",padding:"2px 6px",backgroundColor:"#fff3e0",color:"#f57c00",borderRadius:"10px",fontWeight:"normal"},favoriteBadge:{fontSize:"10px",padding:"2px 6px",backgroundColor:"#fff8e1",color:"#ff8f00",borderRadius:"10px",fontWeight:"bold"},infoRow:{display:"flex",gap:"8px",flexWrap:"wrap",alignItems:"center"},infoItem:{fontSize:"11px",color:"#666"},sectBadge:{fontSize:"10px",padding:"2px 6px",backgroundColor:"#e8f5e9",color:"#2e7d32",borderRadius:"10px",fontWeight:"bold"},rankBadge:{fontSize:"10px",padding:"2px 6px",backgroundColor:"#f3e5f5",color:"#6a1b9a",borderRadius:"10px",fontWeight:"bold"},spouseBadge:{fontSize:"10px",padding:"2px 6px",backgroundColor:"#fce4ec",color:"#c2185b",borderRadius:"10px",fontWeight:"bold"},pregnantBadge:{fontSize:"10px",padding:"2px 6px",backgroundColor:"#fff3e0",color:"#f57c00",borderRadius:"10px",fontWeight:"bold"},manualInfo:{fontSize:"11px",color:"#7b1fa2",fontWeight:"bold"},arrowSection:{display:"flex",alignItems:"center",fontSize:"20px",color:"#bbb",flexShrink:0},emptyState:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",padding:"40px",color:"#999"},emptyIcon:{fontSize:"48px",marginBottom:"10px"},emptyText:{fontSize:"14px"}},Dy=document.createElement("style");Dy.textContent=`
  [data-gender=""] {
    background-color: #4285F4 !important;
  }
  [data-gender=""] {
    background-color: #EA4335 !important;
  }
  .childCard:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(0,0,0,0.15);
    border-color: #8d6e63;
  }
  
  /*  */
  @media (max-width: 768px) {
    /*  */
    .listContainer {
      max-height: calc(100vh - 300px) !important;
      -webkit-overflow-scrolling: touch;
    }
  }
`;document.head.appendChild(Dy);const FE=({records:e=[],onMemorialClick:t})=>{const n=y.useMemo(()=>{if(!e.length)return{avgAge:0,maxGeneration:0};const s=e.reduce((i,a)=>i+(a.ageAtDeath||0),0),o=Math.max(...e.map(i=>i.generation||1));return{avgAge:Math.round(s/e.length*10)/10,maxGeneration:o}},[e]);return r.jsxs("div",{style:sn.container,children:[r.jsxs("div",{style:sn.banner,children:[r.jsxs("div",{children:["   ",e.length," "]}),e.length>0&&r.jsxs("div",{style:sn.bannerStats,children:[r.jsxs("span",{children:[" ",n.avgAge||""," "]}),r.jsxs("span",{children:[" ",n.maxGeneration||1,""]})]})]}),e.length===0?r.jsx("div",{style:sn.empty,children:""}):r.jsx("div",{style:sn.grid,children:e.map(s=>{var o;return r.jsxs("button",{type:"button",style:{...sn.tomb,...s.isExiled?sn.tombExiled:{}},onClick:()=>t&&t(s),children:[r.jsxs("div",{style:sn.tombHeader,children:[r.jsx("span",{style:sn.icon,children:s.isExiled?"":""}),r.jsxs("div",{children:[r.jsx("div",{style:sn.name,children:s.name}),r.jsxs("div",{style:sn.meta,children:[s.isExiled?"":`${s.generation||1}`,"  ",s.tierTitle||""]})]})]}),!s.isExiled&&r.jsxs("div",{style:sn.detail,children:[" ",s.deathYear||""," ",s.deathMonth||1,"   ",s.ageAtDeath??""," "]}),s.deathReason&&r.jsxs("div",{style:sn.detail,children:[s.isExiled?"":"",s.deathReason]}),((o=s.sect)==null?void 0:o.name)&&!s.isExiled&&r.jsxs("div",{style:sn.detail,children:[s.sect.name,s.rank?`  ${s.rank}`:""]}),r.jsx("p",{style:sn.epitaph,children:s.epitaph||""}),typeof s.descendants=="number"&&!s.isExiled&&r.jsxs("div",{style:sn.descendants,children:["",s.descendants]})]},s.id)})})]})},sn={container:{width:"100%",height:"100%",background:"#fdf7f2",borderRadius:"12px",border:"2px solid #8d6e63",padding:"15px",display:"flex",flexDirection:"column",gap:"12px"},banner:{background:"linear-gradient(90deg, #efebe9, #f5f0e8)",borderRadius:"10px",padding:"12px 16px",fontWeight:"bold",display:"flex",justifyContent:"space-between",alignItems:"center",color:"#5d4037"},bannerStats:{display:"flex",gap:"16px",fontSize:"12px",color:"#6d4c41"},empty:{flex:1,display:"flex",alignItems:"center",justifyContent:"center",color:"#9e9e9e",fontStyle:"italic"},grid:{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(220px, 1fr))",gap:"12px",overflowY:"auto"},tomb:{display:"flex",flexDirection:"column",alignItems:"stretch",padding:"12px",borderRadius:"10px",border:"1px solid #d7ccc8",background:"#fffefd",textAlign:"left",cursor:"pointer",transition:"transform 0.2s ease, box-shadow 0.2s ease",outline:"none"},tombExiled:{background:"#f5f5f5",border:"1px solid #ccc",opacity:.8},tombHeader:{display:"flex",alignItems:"center",gap:"10px",marginBottom:"8px"},icon:{fontSize:"24px"},name:{fontWeight:"bold",color:"#4e342e"},meta:{fontSize:"12px",color:"#8d6e63"},detail:{fontSize:"12px",color:"#5d4037",marginTop:"4px"},epitaph:{marginTop:"10px",fontSize:"12px",color:"#4e342e",lineHeight:1.5},descendants:{marginTop:"8px",fontSize:"11px",color:"#6d4c41"}},HE=({player:e,children:t,fallenChildren:n=[],exiledChildren:s=[],pregnantNpcs:o=[],onChildClick:i,onToggleFavorite:a,onMemorialClick:l,generation3Plus:d=[]})=>{const[u,p]=y.useState("tree"),c=[...n,...s.map(f=>({...f,isExiled:!0,deathReason:"",epitaph:""}))];return r.jsxs("div",{style:Dn.container,children:[r.jsxs("div",{style:Dn.viewSwitcher,children:[r.jsx("button",{style:{...Dn.viewButton,...u==="tree"?Dn.viewButtonActive:{}},onClick:()=>p("tree"),children:" "}),r.jsx("button",{style:{...Dn.viewButton,...u==="list"?Dn.viewButtonActive:{}},onClick:()=>p("list"),children:" "}),r.jsx("button",{style:{...Dn.viewButton,...u==="cemetery"?Dn.viewButtonActive:{}},onClick:()=>p("cemetery"),children:" "})]}),r.jsxs("div",{style:{...Dn.viewContent,position:"relative"},children:[u==="tree"&&r.jsx(OE,{player:e,children:t,pregnantNpcs:o,onChildClick:i,generation3Plus:d}),u==="list"&&r.jsx(DE,{children:t,pregnantNpcs:o,onChildClick:i,onToggleFavorite:a}),u==="cemetery"&&r.jsx(FE,{records:c,onMemorialClick:l})]}),u==="tree"&&r.jsx("div",{style:Dn.hint,children:" : ,/,/"}),u==="list"&&r.jsx("div",{style:Dn.hint,children:" : "}),u==="cemetery"&&r.jsx("div",{style:Dn.hint,children:" : "})]})},Dn={container:{display:"flex",flexDirection:"column",gap:"15px"},viewSwitcher:{display:"flex",gap:"10px",justifyContent:"center",padding:"10px",backgroundColor:"rgba(255,255,255,0.5)",borderRadius:"12px",border:"2px solid #8d6e63"},viewButton:{padding:"10px 20px",fontSize:"14px",fontWeight:"bold",border:"2px solid #8d6e63",borderRadius:"20px",backgroundColor:"white",color:"#5d4037",cursor:"pointer",transition:"all 0.3s ease",outline:"none",boxShadow:"0 2px 4px rgba(0,0,0,0.1)"},viewButtonActive:{backgroundColor:"#8d6e63",color:"white",transform:"scale(1.05)",boxShadow:"0 4px 8px rgba(0,0,0,0.2)"},viewContent:{flex:1},hint:{textAlign:"center",fontSize:"12px",color:"#666",padding:"8px",backgroundColor:"rgba(255,255,255,0.7)",borderRadius:"8px",border:"1px solid #e0e0e0"}},bp=document.createElement("style");bp.textContent=`
  button:hover {
    transform: translateY(-2px);
  }
  button:active {
    transform: translateY(0);
  }
`;document.querySelector("#family-view-wrapper-styles")||(bp.id="family-view-wrapper-styles",document.head.appendChild(bp));const WE=e=>{if(!e||!e.sect||!e.sectId||e.sectId==="NONE")return null;const t=e.sect.name,n=e.name,s=e.sectRank||"",o=e.sectStatus||"active",i=[];return o==="active"?(i.push(`${t}${s}${n}`,`${t}${n}`,`${t}${n}`,`${t}${n}`,`${t}${n}`,`${t}${n}`,`${t}${n}`,`${t}${n}`,`${t}${n}`,`${t}${n}`),(s===""||s==="")&&i.push(`${t}${n}`,`${t}${n}`,`${t}${n}`,`${t}${n}`),(t.includes("")||t.includes("")||t.includes(""))&&i.push(`${t}${n}`,`${t}${n}`,`${n}(${t})`)):o==="defected"?i.push(`${t}${n}`,`${t}${s}${n}`,`${t}${n}`,`${n}`,`${t}${n}`,`${n}${t}`):o==="hidden"&&i.push(`${t}${n}`,`${t}${n}`),i.length>0?i[Math.floor(Math.random()*i.length)]:null},UE=e=>{if(!e||e.length<2)return null;const t=e.filter(a=>a.sect&&a.sectId&&a.sectId!=="NONE"&&a.sectStatus==="active");if(t.length<2)return null;const n=t[Math.floor(Math.random()*t.length)];let s=t[Math.floor(Math.random()*t.length)],o=0;for(;s.sectId===n.sectId&&o<10;)s=t[Math.floor(Math.random()*t.length)],o++;if(n.sectId===s.sectId)return null;const i=[`${n.sect.name}${n.name}${s.sect.name}${s.name}`,`${n.name}(${n.sect.name})${s.name}(${s.sect.name})`,`${n.sect.name}${n.name}${s.sect.name}${s.name}`];return i[Math.floor(Math.random()*i.length)]},GE=[{type:"SECT",title:"",templates:["","","","","","","","","",""],probability:.15},{type:"SECT",title:"",templates:["","","","","","","",""],probability:.1},{type:"SECT",title:"",templates:["","","","","","","",""],probability:.12},{type:"SECT",title:"",templates:["","","","","","",""],probability:.08}],VE=[{type:"GENIUS",title:"",templates:["''","''","","''","","","''"],probability:.1},{type:"GENIUS",title:"",templates:["''","","","","",""],probability:.08},{type:"GENIUS",title:"",templates:["''''","''","","","",""],probability:.07},{type:"GENIUS",title:"",templates:["''","","","''","''",""],probability:.05}],YE=[{type:"TREASURE",title:"",templates:["","","","","","","","",""],probability:.12}],qE=[{type:"REALM",title:"",templates:["","","","","","","",""],probability:.1}],KE=[{type:"DISASTER",title:"",templates:["","","","","","","","",""],probability:.08}],QE=[{type:"POLITICS",title:"",templates:["","","","","","","",""],probability:.07}],JE=[{type:"DAILY",title:"",templates:["","","","","","",""],probability:.15}],XE=[{type:"FAMOUS",title:"",templates:["''","","","","''","","",""],probability:.06}],ZE=()=>[...GE,...VE,...YE,...qE,...KE,...QE,...JE,...XE],ej=(e,t,n=null,s=[])=>{const o=[],i=sj(e,t);for(let a=0;a<i;a++){const l=nj(e,t);l&&o.push(l)}if(s&&s.length>0&&Math.random()<.3){const a=tj(e,t,s);a&&o.push(a)}return o},tj=(e,t,n)=>{const s=Math.random();let o=null,i=null;if(s<.7){const a=n[Math.floor(Math.random()*n.length)];o=WE(a),i=[a.id]}else o=UE(n);return o?{type:"NPC_RELATED",category:"",title:"",message:o,year:e,month:t,importance:"MEDIUM",timestamp:Date.now(),npcIds:i}:null},nj=(e,t,n)=>{const s=ZE(),o=rj(s);if(!o||!o.templates||o.templates.length===0)return null;const i=He(o.templates);return i?{type:o.type,category:"",title:o.title,message:i,year:e,month:t,importance:oj(o.type),timestamp:Date.now()}:null},rj=e=>{const t=e.reduce((s,o)=>s+(o.probability||0),0);let n=Math.random()*t;for(const s of e)if(n-=s.probability||0,n<=0)return s;return e[0]},sj=(e,t)=>{if(t===1||t===7){const s=Math.random();return s<.3?3:s<.7?2:1}const n=Math.random();return n<.5?1:n<.8?2:0},oj=e=>({DISASTER:5,POLITICS:4,GENIUS:4,SECT:3,REALM:3,TREASURE:3,FAMOUS:2,DAILY:1})[e]||2,ij=(e,t,n,s)=>{const o=t.filter(i=>i.sect&&["TOP","HIGH"].includes(i.sect.level));if(o.length>0&&Math.random()<.2){const i=He(o),a=i.sect.name,l=[`${a}${i.name}`,`${a}${i.name}`,`${a}${i.name}`];return{type:"SECT",category:"",title:"",message:He(l),year:n,month:s,importance:3,relatedChild:i.id,timestamp:Date.now()}}return null},aj=e=>({SECT:"",GENIUS:"",TREASURE:"",REALM:"",DISASTER:"",POLITICS:"",DAILY:"",FAMOUS:""})[e]||"",lj=e=>({SECT:"#4A90E2",GENIUS:"#E74C3C",TREASURE:"#F39C12",REALM:"#9B59B6",DISASTER:"#E67E22",POLITICS:"#16A085",DAILY:"#95A5A6",FAMOUS:"#D4AF37"})[e]||"#7F8C8D",Ih={ready:"#43a047",pending:"#fb8c00"},cj=({summary:e,onUpgrade:t})=>{if(!e)return null;const{currentTier:n,nextTier:s,requirements:o,totals:i,canUpgrade:a,enrichedChildren:l}=e,d=Math.round((i.powerProgress||0)*100),u=[...l].filter(p=>(p.generation||1)<=2).sort((p,c)=>{var f,b;return(((f=c.influence)==null?void 0:f.score)||0)-(((b=p.influence)==null?void 0:b.score)||0)}).slice(0,3);return r.jsxs("div",{style:Qe.wrapper,children:[r.jsxs("div",{style:Qe.headerRow,children:[r.jsxs("div",{children:[r.jsx("div",{style:Qe.label,children:""}),r.jsx("div",{style:Qe.currentTier,children:(n==null?void 0:n.name)||""}),r.jsx("div",{style:Qe.desc,children:n==null?void 0:n.desc})]}),r.jsxs("div",{style:Qe.metricsBox,children:[r.jsxs("div",{style:Qe.metricItem,children:[r.jsx("span",{style:Qe.metricLabel,children:""}),r.jsx("strong",{style:Qe.metricValue,children:i.population})]}),r.jsxs("div",{style:Qe.metricItem,children:[r.jsx("span",{style:Qe.metricLabel,children:""}),r.jsx("strong",{style:Qe.metricValue,children:i.ratingScore})]}),r.jsxs("div",{style:Qe.metricItem,children:[r.jsx("span",{style:Qe.metricLabel,children:""}),r.jsx("strong",{style:Qe.metricValue,children:i.sovereignCount})]}),r.jsxs("div",{style:Qe.metricItem,children:[r.jsx("span",{style:Qe.metricLabel,children:""}),r.jsx("strong",{style:Qe.metricValue,children:i.population-l.length})]})]})]}),s?r.jsxs("div",{style:Qe.progressSection,children:[r.jsxs("div",{style:Qe.progressHeader,children:[r.jsxs("div",{children:[r.jsxs("div",{style:Qe.nextLabel,children:["",s.name]}),r.jsx("small",{style:{color:"#cfd8dc"},children:s.desc})]}),r.jsxs("span",{style:{fontWeight:"bold",color:"#fff"},children:[d,"%"]})]}),r.jsx("div",{style:Qe.progressBarBg,children:r.jsx("div",{style:{...Qe.progressBarFill,width:`${Math.min(100,d)}%`}})})]}):r.jsx("div",{style:Qe.progressSection,children:r.jsx("div",{style:Qe.nextLabel,children:""})}),(o==null?void 0:o.length)>0&&r.jsx("div",{style:Qe.requirementsGrid,children:o.map(p=>{const c=p.met;return r.jsxs("div",{style:Qe.requirementCard,children:[r.jsx("div",{style:{...Qe.requirementBadge,backgroundColor:c?Ih.ready:Ih.pending},children:c?"":""}),r.jsxs("div",{children:[r.jsx("div",{style:Qe.requirementLabel,children:p.label}),r.jsxs("div",{style:Qe.requirementValue,children:[p.current," / ",p.required]})]})]},p.label)})}),u.length>0&&r.jsxs("div",{children:[r.jsx("div",{style:Qe.label,children:""}),r.jsx("div",{style:Qe.contributorRow,children:u.map(p=>{var c,f,b;return r.jsxs("div",{style:Qe.contributorCard,children:[r.jsx("div",{style:{...Qe.contributorBadge,color:((c=p.influence)==null?void 0:c.color)||"#fff"},children:(f=p.influence)==null?void 0:f.label}),r.jsx("div",{style:Qe.contributorName,children:p.name}),r.jsx("div",{style:Qe.contributorScore,children:((b=p.influence)==null?void 0:b.score)||0})]},p.id)})})]}),r.jsx("button",{onClick:t,disabled:!a,style:{...Qe.actionBtn,background:a?"linear-gradient(120deg, #ffb300, #ff7043)":"#455a64"},children:s?a?` ${s.name}`:"":""})]})},Qe={wrapper:{background:"linear-gradient(135deg, #1f1f2b 0%, #2f2f44 100%)",borderRadius:16,padding:20,color:"#eceff1",marginBottom:20,border:"1px solid rgba(255,255,255,0.1)"},headerRow:{display:"flex",justifyContent:"space-between",gap:20,flexWrap:"wrap"},label:{fontSize:12,letterSpacing:1,textTransform:"uppercase",color:"#90a4ae"},currentTier:{fontSize:24,fontWeight:700},desc:{marginTop:4,fontSize:13,color:"#b0bec5"},metricsBox:{display:"flex",gap:12,flexWrap:"wrap",justifyContent:"flex-end"},metricItem:{minWidth:90,padding:"8px 12px",borderRadius:10,background:"rgba(255,255,255,0.08)",textAlign:"center",fontSize:12,display:"flex",flexDirection:"column",gap:4},metricLabel:{color:"#cfd8dc",fontSize:11,letterSpacing:1},metricValue:{fontSize:20,fontWeight:700,color:"#fff"},progressSection:{marginTop:16},nextLabel:{fontSize:14,fontWeight:600},progressHeader:{display:"flex",justifyContent:"space-between",marginBottom:6},progressBarBg:{width:"100%",height:10,borderRadius:999,background:"rgba(255,255,255,0.15)",overflow:"hidden"},progressBarFill:{height:"100%",background:"linear-gradient(90deg, #42a5f5, #7e57c2)"},requirementsGrid:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(150px, 1fr))",gap:12,marginTop:16},requirementCard:{display:"flex",gap:10,alignItems:"center",padding:"10px 12px",borderRadius:12,background:"rgba(255,255,255,0.08)"},requirementBadge:{width:32,height:32,borderRadius:10,display:"flex",alignItems:"center",justifyContent:"center",fontWeight:700,color:"#fff"},requirementLabel:{fontSize:12,color:"#cfd8dc"},requirementValue:{fontSize:14,fontWeight:600},contributorRow:{display:"flex",gap:12,marginTop:8,flexWrap:"wrap"},contributorCard:{flex:"1 1 120px",minWidth:120,background:"rgba(0,0,0,0.25)",borderRadius:12,padding:12},contributorBadge:{fontSize:12,fontWeight:700},contributorName:{marginTop:4,fontSize:16,fontWeight:600},contributorScore:{fontSize:13,color:"#b0bec5"},actionBtn:{width:"100%",marginTop:16,border:"none",borderRadius:999,padding:"12px 0",fontSize:14,fontWeight:600,color:"#1f1f2b",cursor:"pointer"}},dj=["","","",""],uj=["","","","","","","","","","","","","",""],pj=["","","","","","","","","","","","","","","",""],fj=["","","","","",""],mj="init-log",fl=10,ml=(e="",t=[])=>{if(!e)return!1;const n=String(e);return t.some(s=>s&&n.includes(s))},ru=e=>{if(!e)return"DAILY";const t=e.category||"",n=`${e.title||""}${e.message||""}`;return ml(t,dj)?"WORLD":e.type==="DAILY"||ml(n,fj)?"DAILY":e.id&&e.id.startsWith(mj)||e.turn===0||ml(t,uj)||ml(n,pj)||e.type&&e.type!=="DAILY"?"MAJOR":"DAILY"},hj=({logs:e,ratingSummary:t,onUpgradeRating:n})=>{const[s,o]=y.useState("ALL"),[i,a]=y.useState(()=>new Set),[l,d]=y.useState(0),u=y.useMemo(()=>s==="ALL"?e:e.filter(b=>ru(b)===s),[e,s]),p=y.useMemo(()=>Math.max(1,Math.ceil(u.length/fl)),[u.length]),c=y.useMemo(()=>{const b=l*fl;return u.slice(b,b+fl)},[u,l]),f=y.useMemo(()=>{const b={all:e.length,daily:0,major:0,world:0};return e.forEach(S=>{const E=ru(S);E==="WORLD"?b.world+=1:E==="MAJOR"?b.major+=1:b.daily+=1}),b},[e]);return y.useEffect(()=>{d(0)},[s,e.length]),r.jsxs("div",{style:at.container,children:[t&&r.jsx("div",{style:at.ratingSection,children:r.jsx(cj,{summary:t,onUpgrade:n})}),r.jsx("h3",{style:at.title,children:" "}),r.jsxs("div",{style:at.filterBar,children:[r.jsxs("button",{style:{...at.filterBtn,...s==="ALL"?at.filterBtnActive:{}},onClick:()=>o("ALL"),children:["  (",f.all,")"]}),r.jsxs("button",{style:{...at.filterBtn,...s==="DAILY"?at.filterBtnActive:{}},onClick:()=>o("DAILY"),children:["  (",f.daily,")"]}),r.jsxs("button",{style:{...at.filterBtn,...s==="MAJOR"?at.filterBtnActive:{}},onClick:()=>o("MAJOR"),children:["  (",f.major,")"]}),r.jsxs("button",{style:{...at.filterBtn,...s==="WORLD"?at.filterBtnActive:{}},onClick:()=>o("WORLD"),children:["  (",f.world,")"]})]}),r.jsxs("div",{style:at.logWindow,children:[u.length===0?r.jsx("p",{style:{color:"#999"},children:"..."}):null,c.map((b,S)=>{const E=ru(b),j=E==="WORLD",x=E==="MAJOR";let h="",v="#8B4513";j?(h=aj(b.type),v=lj(b.type)):x&&(h="",v="#b45309");const g=b.id||`${b.turn}-${S+l*fl}`,I=!!b.details,_=I&&i.has(g),C=b.title||b.message||"",k=()=>{I&&a(H=>{const B=new Set(H);return B.has(g)?B.delete(g):B.add(g),B})},R=3572,T=b.turn||0,N=R+Math.floor(T/12),Y=T%12||12;return r.jsxs("div",{style:at.logItem,children:[r.jsxs("div",{style:at.logHeader,children:[r.jsxs("span",{style:{...at.turn,color:v},children:[h," [ ",N," ",Y,"]"]}),(j||x)&&b.title&&r.jsx("span",{style:at.eventTag,children:b.title})]}),I?r.jsxs(r.Fragment,{children:[r.jsxs("div",{style:at.summaryRow,children:[r.jsx("span",{style:at.summaryText,children:C}),r.jsx("button",{style:at.toggleBtn,onClick:k,children:_?"":""})]}),_&&r.jsx("div",{style:at.detailContent,children:b.details})]}):r.jsx("div",{style:at.logContent,children:b.message})]},g)})]}),r.jsxs("div",{style:at.footer,children:[r.jsxs("div",{style:at.paginationBar,children:[r.jsx("button",{style:{...at.pageBtn,...l<=0?at.pageBtnDisabled:{}},onClick:()=>d(b=>Math.max(0,b-1)),disabled:l<=0,children:""}),r.jsxs("span",{style:at.pageInfo,children:[" ",l+1," / ",p," "]}),r.jsx("button",{style:{...at.pageBtn,...l>=p-1?at.pageBtnDisabled:{}},onClick:()=>d(b=>Math.min(p-1,b+1)),disabled:l>=p-1,children:""})]}),r.jsxs("span",{style:{fontSize:"11px",color:"#666"},children:[" ",u.length," "]})]})]})},at={container:{width:"calc(100% - 30px)",maxWidth:"800px",margin:"20px auto 150px auto",border:"1px solid #ccc",borderRadius:"8px",backgroundColor:"#fff",fontFamily:'"KaiTi", serif',display:"flex",flexDirection:"column",minHeight:"500px",pointerEvents:"auto"},ratingSection:{padding:"12px",borderBottom:"1px solid rgba(0,0,0,0.05)"},title:{margin:"0",padding:"10px",backgroundColor:"#f5f5f5",borderBottom:"1px solid #eee",fontSize:"16px"},filterBar:{display:"flex",gap:"5px",padding:"8px",backgroundColor:"#fafafa",borderBottom:"1px solid #eee",pointerEvents:"auto"},filterBtn:{flex:1,padding:"6px 8px",fontSize:"12px",border:"1px solid #ddd",borderRadius:"4px",backgroundColor:"#fff",cursor:"pointer",transition:"all 0.2s",fontFamily:"inherit",pointerEvents:"auto"},filterBtnActive:{backgroundColor:"#4A90E2",color:"#fff",border:"1px solid #4A90E2",fontWeight:"bold"},logWindow:{flex:1,minHeight:"300px",maxHeight:"500px",overflowY:"auto",padding:"10px",fontSize:"13px",pointerEvents:"auto"},logItem:{marginBottom:"10px",borderBottom:"1px dashed #eee",paddingBottom:"6px",pointerEvents:"auto"},logHeader:{display:"flex",alignItems:"center",gap:"6px",marginBottom:"3px",pointerEvents:"auto"},turn:{fontWeight:"bold",fontSize:"12px"},eventTag:{fontSize:"10px",padding:"2px 6px",backgroundColor:"#f0f0f0",borderRadius:"3px",color:"#666"},logContent:{lineHeight:"1.5",color:"#333",whiteSpace:"pre-wrap"},summaryRow:{display:"flex",justifyContent:"space-between",alignItems:"center",gap:"8px",padding:"4px 0",pointerEvents:"auto"},summaryText:{fontWeight:600,fontSize:"13px",flex:1,color:"#333",pointerEvents:"auto"},toggleBtn:{border:"1px solid #ccc",borderRadius:"999px",padding:"2px 10px",backgroundColor:"#fff",fontSize:"11px",cursor:"pointer",pointerEvents:"auto"},detailContent:{lineHeight:"1.6",color:"#444",backgroundColor:"#fafafa",borderRadius:"6px",padding:"8px 10px",border:"1px solid rgba(0,0,0,0.05)",whiteSpace:"pre-wrap",pointerEvents:"auto"},footer:{padding:"12px 10px",backgroundColor:"#f5f5f5",borderTop:"2px solid #d32f2f",textAlign:"center",pointerEvents:"auto",flexShrink:0,minHeight:"60px",display:"flex",flexDirection:"column",justifyContent:"center",gap:"6px"},paginationBar:{display:"flex",justifyContent:"center",alignItems:"center",gap:"10px",marginBottom:"6px"},pageBtn:{padding:"6px 14px",border:"2px solid #d32f2f",borderRadius:"6px",backgroundColor:"#fff",cursor:"pointer",fontSize:"13px",fontWeight:"bold",color:"#d32f2f",transition:"all 0.2s",pointerEvents:"auto"},pageBtnDisabled:{backgroundColor:"#f0f0f0",cursor:"not-allowed",color:"#999",borderColor:"#ccc"},pageInfo:{fontSize:"12px",color:"#666"}};class Jr{static onChildBirth(t,n,s={}){vn(t);const o=Eh(t,n,s);return so(t,{description:`${n.name}`,affectionChange:0,context:`${s.difficulty===""?"":""}`}),console.log(`[] ${t.name} : ${n.name}`),o}static onMarriage(t,n=""){vn(t);const s=IE(t,n);return so(t,{description:"",affectionChange:30,context:""}),console.log(`[] ${t.name} `),s}static onReceiveGift(t,n,s){vn(t);const o=so(t,{description:`${n.name}`,affectionChange:s,context:n.tier>=3?"":""});return Math.abs(s)>=20&&Ao(t,{event:`${n.name}`,detail:`${n.name}`,emotionalImpact:Os.SIGNIFICANT,category:"relationship",tags:["",n.name,""]}),o}static onCombatTogether(t,n,s=!1){return vn(t),s?_E(t,`${n}`):so(t,{description:`${n}`,affectionChange:5,context:""})}static onBreakthrough(t,n){return vn(t),Ao(t,{event:`${n}`,detail:`${n}`,emotionalImpact:Os.PROFOUND,category:"cultivation",tags:["","",n]})}static onPregnancyStart(t){return vn(t),so(t,{description:"",affectionChange:15,context:""})}static onChildJoinSect(t,n,s){return vn(t),so(t,{description:`${n.name}${s}`,affectionChange:0,context:""})}static onChildMarriage(t,n,s){return vn(t),Ao(t,{event:`${n.name}`,detail:`${n.name}${s}`,emotionalImpact:Os.SIGNIFICANT,category:"family",tags:["","",n.name]})}static initializeAllNpcs(t){t.forEach(n=>{vn(n)}),console.log(`[]  ${t.length}  NPC `)}static backfillChildrenMemories(t,n){vn(t),n.forEach(s=>{t.memories.milestones.some(i=>i.tags.includes(s.name))||(Eh(t,s,{difficulty:"",sacrifice:!1}),console.log(`[]  ${t.name}  ${s.name} `))})}static getMemorySummary(t){return t.memories||vn(t),{milestoneCount:t.memories.milestones.length,milestones:t.memories.milestones,recentEventCount:t.memories.recentEvents.length,recentEvents:t.memories.recentEvents,longTermSummary:t.memories.longTermSummary,totalEvents:t.memories.meta.totalEvents}}static clearAllMemories(t){t.memories&&(t.memories.milestones=[],t.memories.recentEvents=[],t.memories.longTermSummary="",t.memories.meta.totalEvents=0,console.log(`[]  ${t.name} `))}}const gj=e=>{const{identity:t,personality:n,stats:s,relationship:o}=e,i=typeof n=="object"&&n!==null&&"label"in n?n.label:Array.isArray(n)?n[0]:"",a=s.aptitude&&s.aptitude>=90,l=(o==null?void 0:o.jealousy)||0;if(l>=60)return iu(e,l,i);if(l>=40&&Math.random()<.5)return iu(e,l,i);if(l>=20&&Math.random()<.2)return iu(e,l,i);if(a){const p=["","",""];return p[Math.floor(Math.random()*p.length)]}const d={:["","","",""],:["","","",""],:["","","",""],:["","","",""],:["","","",""],:["","","",""],:["","","",""],:["","","",""],:["","","",""],:["","","",""],:["","","",""],:["","","",""],:["","","",""],:["","","",""],:["","","",""],:["","","",""],:["","","",""],:["","","",""],:["","","",""],:["","","",""]};if(Math.random()>.5||!d[t])switch(i){case"":return"";case"":return"";case"":return"";case"":return"";case"":return"";case"":return"";default:return""}const u=d[t]||[""];return u[Math.floor(Math.random()*u.length)]},xj=(e,t)=>{const n=typeof e.personality=="object"&&e.personality!==null&&"label"in e.personality?e.personality.label:Array.isArray(e.personality)?e.personality[0]:"",s=e.likes&&e.likes.includes(t.name);let o=t.value,i="";if(e.identity==="")return t.name&&/|||/i.test(t.name)||t.tags&&t.tags.includes("scripture")?(o=Math.floor(t.value*3),i=`${e.name} `,{msg:i,change:o}):{msg:`${e.name} `,change:0};if(t.value<10&&(["","",""].includes(n)||[""].includes(e.identity)))return{msg:`${e.name} ${t.name}`,change:-5};if(s)o*=2,i=`${e.name} ${t.name}`;else if(n===""&&t.cost>=300)o*=1.5,i=`${e.name} ${t.name}`;else switch(n){case"":i=`${e.name} `;break;case"":i=`${e.name} `;break;case"":i=`${e.name} `;break;default:i=`${e.name} ${t.name}`}return{msg:i,change:Math.floor(o)}},yj=[{title:"",text:e=>`${e}${e}""`,affectionBonus:5},{title:"",text:e=>`${e}${e}""`,affectionBonus:5},{title:"",text:e=>`${e}${e}""`,affectionBonus:8},{title:"",text:e=>`${e}${e}""`,affectionBonus:6},{title:"",text:e=>`${e}${e}${e}""`,affectionBonus:10},{title:"",text:e=>`${e}"......"${e}""`,affectionBonus:12,requirePregnant:!0},{title:"",text:e=>`${e}${e}"..."${e}"..."`,affectionBonus:13,requirePregnant:!0}],bj=[{title:"",text:e=>`${e}${e}""`,affectionBonus:6},{title:"",text:e=>`${e}${e}${e}""`,affectionBonus:7},{title:"",text:e=>`""${e}""`,affectionBonus:8},{title:"",text:e=>`${e}${e}""`,affectionBonus:7},{title:"",text:e=>`${e}""${e}""`,affectionBonus:5},{title:"",text:e=>`${e}"......"`,affectionBonus:10,requirePregnant:!0},{title:"",text:e=>`${e}"..."${e}"..."`,affectionBonus:11,requirePregnant:!0}],_h=[{title:"",text:e=>`${e}${e}""`,affectionBonus:6},{title:"",text:e=>`${e}""`,affectionBonus:7},{title:"",text:e=>`${e}""`,affectionBonus:8},{title:"",text:e=>`${e}""`,affectionBonus:5},{title:"",text:e=>`${e}${e}""`,affectionBonus:9},{title:"",text:e=>`${e}"..."`,affectionBonus:12,requirePregnant:!0},{title:"",text:e=>`${e}"..."${e}"..."`,affectionBonus:14,requirePregnant:!0}],vj=[{title:"",text:e=>`${e}${e}""`,affectionBonus:6},{title:"",text:e=>`${e}""`,affectionBonus:7},{title:"",text:e=>`${e}""${e}`,affectionBonus:6},{title:"",text:e=>`${e}${e}""`,affectionBonus:5},{title:"",text:e=>`${e}${e}""`,affectionBonus:8},{title:"",text:e=>`${e}"......"`,affectionBonus:13,requirePregnant:!0},{title:"",text:e=>`${e}"...""..."`,affectionBonus:12,requirePregnant:!0}],Rh=[{title:"",text:(e,t)=>`${e}""`,affectionBonus:8},{title:"",text:(e,t)=>`${e}""`,affectionBonus:10},{title:"",text:(e,t)=>`${e}${e}""`,affectionBonus:7},{title:"",text:(e,t)=>`${e}""`,affectionBonus:6},{title:"",text:(e,t)=>`${e}${e}""`,affectionBonus:9}],Sj=[{title:"",text:(e,t)=>`${e}${e}""`,affectionBonus:8},{title:"",text:(e,t)=>`${e}${e}"${t===""?"":""}"`,affectionBonus:6},{title:"",text:(e,t)=>`${e}""`,affectionBonus:10},{title:"",text:(e,t)=>`${e}""${e}`,affectionBonus:4},{title:"",text:(e,t)=>`${e}""`,affectionBonus:9}],wj=[{title:"",text:(e,t)=>`${e}${e}""`,affectionBonus:10},{title:"",text:(e,t)=>`${e}""`,affectionBonus:12},{title:"",text:(e,t)=>`${e}${e}${e}""`,affectionBonus:15},{title:"",text:(e,t)=>`${e}""`,affectionBonus:11},{title:"",text:(e,t)=>`${e}""`,affectionBonus:10}],Mh=(e,t)=>{let n=_h;switch(e){case"COLD":n=yj;break;case"YANDERE":n=bj;break;case"GENTLE":n=_h;break;case"FLIRTY":n=vj;break}const s=n.filter(i=>!(i.requirePregnant&&!t.isPregnant));if(s.length===0)return null;const o=s[Math.floor(Math.random()*s.length)];return{title:o.title,text:o.text(t.name),affectionBonus:o.affectionBonus}},kj=(e,t,n="")=>{let s=Rh;switch(e){case"TODDLER":s=Rh;break;case"TEEN":s=Sj;break;case"ADULT":s=wj;break}const o=s[Math.floor(Math.random()*s.length)];return{title:o.title,text:o.text(t.name,n),affectionBonus:o.affectionBonus}},Ej=[{title:"",text:e=>`${e}""`,affectionBonus:5},{title:"",text:e=>`${e}""`,affectionBonus:7},{title:"",text:e=>`${e}${e}${e}""`,affectionBonus:10}],jj=[{title:"",text:e=>`${e}${e}""`,affectionBonus:4},{title:"",text:e=>`${e}""`,affectionBonus:8},{title:"",text:e=>`${e}${e}${e}""`,affectionBonus:9}],Cj=[{title:"",text:e=>`${e}${e}${e}""`,affectionBonus:10},{title:"",text:e=>`${e}""`,affectionBonus:12},{title:"",text:e=>`${e}${e}""`,affectionBonus:8}],Tj=[{title:"",text:e=>`${e}${e}""`,affectionBonus:6},{title:"",text:e=>`${e}${e}"..."`,affectionBonus:5,minAffection:40},{title:"",text:e=>`${e}""`,affectionBonus:10,minAffection:60},{title:"",text:e=>`${e}${e}"..."`,affectionBonus:8,minAffection:70},{title:"",text:e=>`${e}""${e}""`,affectionBonus:15,minAffection:80},{title:"",text:e=>`${e}"..."${e}`,affectionBonus:12,minAffection:85},{title:"",text:e=>`${e}${e}"......"${e}`,affectionBonus:20,minAffection:90},{title:"",text:e=>`${e}"..."${e}`,affectionBonus:15,minAffection:95}],Ij=[{title:"",text:e=>`${e}${e}${e}""`,affectionBonus:10},{title:"",text:e=>`${e}${e}${e}${e}""`,affectionBonus:8},{title:"",text:e=>`${e}""${e}`,affectionBonus:15}],_j=[{title:"",text:e=>`${e}${e}""`,affectionBonus:5},{title:"",text:e=>`${e}${e}${e}""`,affectionBonus:9},{title:"",text:e=>`${e}${e}""`,affectionBonus:11}],Rj=[{title:"",text:e=>`${e}${e}""`,affectionBonus:12},{title:"",text:e=>`${e}${e}""`,affectionBonus:10},{title:"",text:e=>`${e}${e}${e}${e}""`,affectionBonus:8}],su=(e,t)=>{var a;let n=[];switch(e){case"":n=Ej;break;case"":n=jj;break;case"":case"":n=Cj;break;case"":n=Tj;break;case"":n=Ij;break;case"":n=_j;break;case"":n=Rj;break;default:return null}if(n.length===0)return null;const s=((a=t.relationship)==null?void 0:a.affection)||0,o=n.filter(l=>!(l.minAffection&&s<l.minAffection));if(o.length===0)return null;const i=o[Math.floor(Math.random()*o.length)];return{title:i.title,text:i.text(t.name),affectionBonus:i.affectionBonus}},ou=(e,t)=>{var a;if(e.isChild){if(Math.random()<.25){let l="TODDLER";return e.age>=18?l="ADULT":e.age>=11&&(l="TEEN"),kj(l,e,(t==null?void 0:t.gender)||"")}return null}if(Math.random()>=.3)return null;const s=((a=e.relationship)==null?void 0:a.affection)||0,o=typeof e.personality=="object"&&e.personality!==null&&"label"in e.personality?e.personality.label:Array.isArray(e.personality)?e.personality[0]:"";if(s>=80){if(Math.random()<.7){let d="GENTLE";return["","","",""].includes(o)?d="COLD":["","","",""].includes(o)?d="YANDERE":["","","",""].includes(o)?d="FLIRTY":["","","","",""].includes(o)&&(d="GENTLE"),Mh(d,e)}const l=su(e.identity,e);return l||null}if(s>=60){if(Math.random()<.5){let d="GENTLE";return["","","",""].includes(o)?d="COLD":["","","",""].includes(o)?d="YANDERE":["","","",""].includes(o)?d="FLIRTY":["","","","",""].includes(o)&&(d="GENTLE"),Mh(d,e)}const l=su(e.identity,e);return l||null}const i=su(e.identity,e);return i||null};function iu(e,t,n){if(e.name,t>=61){const i={:["...","...","..."],:["","...",""],:["...","",""],:["......","...","......"],:["...","...","..."],:["...","","..."]},a=i[n]||i.;return a[Math.floor(Math.random()*a.length)]}if(t>=41){const i={:["...","...","..."],:["","","..."],:["...","","..."],:["...","","......"],:["...","...","..."],:["","...","..."]},a=i[n]||i.;return a[Math.floor(Math.random()*a.length)]}const s={:["...","...","..."],:["","","..."],:["...","","..."],:["...","......","..."],:["","","..."],:["","","..."]},o=s[n]||s.;return o[Math.floor(Math.random()*o.length)]}const Mj=(e,t,n)=>{const s=typeof e.personality=="object"&&e.personality!==null&&"label"in e.personality?e.personality.label:Array.isArray(e.personality)?e.personality[0]:"",o=e.identity||"",i=e.name;return n?Aj(i,s,o,t):Nj(i,s,o,t)};function Aj(e,t,n,s){var d;const o=`${t}_${n}_${s.id}`,i=oo[o];if(i)return i(e);const a=oo[`${t}_${s.id}`];if(a)return a(e);const l=oo[`${n}_${s.id}`];return l?l(e):((d=oo[`default_${s.id}`])==null?void 0:d.call(oo,e))||`${e} ""`}const oo={_PROFIT:e=>`${e} ""`,__PROFIT:e=>`${e} ""`,__PROFIT:e=>`${e} ""`,__PROFIT:e=>`${e} ""`,_PROFIT:e=>`${e} ""`,__PROFIT:e=>`${e} ""`,__PROFIT:e=>`${e} ""`,__PROFIT:e=>`${e} ""`,_PROFIT:e=>`${e} ""`,__PROFIT:e=>`${e} ""`,__PROFIT:e=>`${e} ""`,_PROFIT:e=>`${e} ""`,__PROFIT:e=>`${e} ""`,_PROFIT:e=>`${e} ""`,__PROFIT:e=>`${e} "~"`,_PROFIT:e=>`${e} ""`,__PROFIT:e=>`${e} ""`,_PROFIT:e=>`${e} ""`,__PROFIT:e=>`${e} ""`,_PROFIT:e=>`${e} "''"`,__PROFIT:e=>`${e} ""`,_PROFIT:e=>`${e} ""`,__PROFIT:e=>`${e} ""`,_PROFIT:e=>`${e} ""`,_PROFIT:e=>`${e} "~"`,_PROFIT:e=>`${e} ""`,_PROFIT:e=>`${e} "~"`,_PROFIT:e=>`${e} ""`,_PROFIT:e=>`${e} ""`,_PROFIT:e=>`${e} ""`,_PROFIT:e=>`${e} "~"`,_EMOTION:e=>`${e} """"`,__EMOTION:e=>`${e} ""`,__EMOTION:e=>`${e} ""`,_EMOTION:e=>`${e} ""`,__EMOTION:e=>`${e} ""`,__EMOTION:e=>`${e} ""`,_EMOTION:e=>`${e} ""`,__EMOTION:e=>`${e} ""`,_EMOTION:e=>`${e} ""`,__EMOTION:e=>`${e} ""`,_EMOTION:e=>`${e} ""`,__EMOTION:e=>`${e} ""`,_EMOTION:e=>`${e} ""`,__EMOTION:e=>`${e} ""`,_EMOTION:e=>`${e} ""`,__EMOTION:e=>`${e} ""`,_EMOTION:e=>`${e} ""`,_EMOTION:e=>`${e} ""`,_EMOTION:e=>`${e} ""`,_EMOTION:e=>`${e} "~"`,_EMOTION:e=>`${e} ""`,_EMOTION:e=>`${e} "~"`,_EMOTION:e=>`${e} ""`,_EMOTION:e=>`${e} ""`,_EMOTION:e=>`${e} ""`,_REASON:e=>`${e} ""`,__REASON:e=>`${e} ""`,_REASON:e=>`${e} ""`,__REASON:e=>`${e} ""`,__REASON:e=>`${e} ""`,_REASON:e=>`${e} ""`,__REASON:e=>`${e} ""`,_REASON:e=>`${e} ""`,_REASON:e=>`${e} ""`,_REASON:e=>`${e} ""`,_REASON:e=>`${e} "~"`,_REASON:e=>`${e} ""`,_REASON:e=>`${e} ""`,_REASON:e=>`${e} ""`,_REASON:e=>`${e} "~"`,_REASON:e=>`${e} ""`,_REASON:e=>`${e} ""`,_REASON:e=>`${e} ""`,_REASON:e=>`${e} ""`,_EMOTION:e=>`${e} ""`,_REASON:e=>`${e} ""`,_EMOTION:e=>`${e} ""`,_REASON:e=>`${e} ""`,_EMOTION:e=>`${e} ""`,_REASON:e=>`${e} ""`,_EMOTION:e=>`${e} ""`,_REASON:e=>`${e} ""`,_EMOTION:e=>`${e} ""`,_PROFIT:e=>`${e} ""`,_EMOTION:e=>`${e} ""`,_REASON:e=>`${e} ""`,_EMOTION:e=>`${e} ""`,_REASON:e=>`${e} ""`,_EMOTION:e=>`${e} ""`,_EMOTION:e=>`${e} ""`,_REASON:e=>`${e} ""`,_REASON:e=>`${e} ""`,_EMOTION:e=>`${e} ""`,default_PROFIT:e=>`${e} ""`,default_EMOTION:e=>`${e} ""`,default_REASON:e=>`${e} ""`};function Nj(e,t,n,s){var d;const o=`${t}_${n}_${s.id}`,i=io[o];if(i)return i(e);const a=io[`${t}_${s.id}`];if(a)return a(e);const l=io[`${n}_${s.id}`];return l?l(e):((d=io[`default_${s.id}`])==null?void 0:d.call(io,e))||`${e} ""`}const io={_PROFIT:e=>`${e} ""`,__PROFIT:e=>`${e} ""`,__PROFIT:e=>`${e} ""`,_PROFIT:e=>`${e} ""`,__PROFIT:e=>`${e} ""`,_PROFIT:e=>`${e} ""`,__PROFIT:e=>`${e} ""`,_PROFIT:e=>`${e} ""`,__PROFIT:e=>`${e} ""`,_PROFIT:e=>`${e} ""`,_REASON:e=>`${e} ""`,_PROFIT:e=>`${e} ""`,_PROFIT:e=>`${e} ""`,_PROFIT:e=>`${e} ""`,_PROFIT:e=>`${e} "~~"`,_PROFIT:e=>`${e} ""`,_PROFIT:e=>`${e} ""`,_PROFIT:e=>`${e} ""`,_PROFIT:e=>`${e} ""`,_PROFIT:e=>`${e} ""`,_PROFIT:e=>`${e} :""`,_PROFIT:e=>`${e} :""`,_PROFIT:e=>`${e} :"~"`,_EMOTION:e=>`${e} ""`,__EMOTION:e=>`${e} ""`,__EMOTION:e=>`${e} ""`,_EMOTION:e=>`${e} ""`,__EMOTION:e=>`${e} ""`,_EMOTION:e=>`${e} ""`,__EMOTION:e=>`${e} ""`,_EMOTION:e=>`${e} ""`,__EMOTION:e=>`${e} ""`,_EMOTION:e=>`${e} ""`,__EMOTION:e=>`${e} ""`,_EMOTION:e=>`${e} ""`,__EMOTION:e=>`${e} ""`,_EMOTION:e=>`${e} ""`,_EMOTION:e=>`${e} ""`,_EMOTION:e=>`${e} ""`,_EMOTION:e=>`${e} "~"`,_EMOTION:e=>`${e} ""`,_EMOTION:e=>`${e} ""`,_EMOTION:e=>`${e} ""`,_EMOTION:e=>`${e} ""`,_EMOTION:e=>`${e} ""`,_EMOTION:e=>`${e} ""`,_EMOTION:e=>`${e} "~"`,_REASON:e=>`${e} ""`,__REASON:e=>`${e} ""`,_REASON:e=>`${e} ""`,__REASON:e=>`${e} ""`,_REASON:e=>`${e} ""`,_REASON:e=>`${e} ""`,_REASON:e=>`${e} ""`,_REASON:e=>`${e} ""`,_REASON:e=>`${e} ""`,_EMOTION:e=>`${e} ""`,_REASON:e=>`${e} ""`,_REASON:e=>`${e} "~"`,_REASON:e=>`${e} ""`,_REASON:e=>`${e} ""`,_REASON:e=>`${e} ""`,_REASON:e=>`${e} ""`,_REASON:e=>`${e} ""`,_REASON:e=>`${e} :""`,_REASON:e=>`${e} "~"`,_PROFIT:e=>`${e} ""`,_REASON:e=>`${e} ""`,_PROFIT:e=>`${e} ""`,_REASON:e=>`${e} ""`,_EMOTION:e=>`${e} ""`,_REASON:e=>`${e} ""`,_PROFIT:e=>`${e} ""`,_EMOTION:e=>`${e} ""`,_EMOTION:e=>`${e} ""`,_PROFIT:e=>`${e} ""`,default_PROFIT:e=>`${e} ""`,default_EMOTION:e=>`${e} ""`,default_REASON:e=>`${e} ""`},Ii={NONE:{min:0,max:20,label:"",color:"#4caf50"},LOW:{min:21,max:40,label:"",color:"#8bc34a"},MEDIUM:{min:41,max:60,label:"",color:"#ff9800"},HIGH:{min:61,max:80,label:"",color:"#ff5722"},EXTREME:{min:81,max:100,label:"",color:"#f44336"}};function Lj(e=0){return e<=20?Ii.NONE:e<=40?Ii.LOW:e<=60?Ii.MEDIUM:e<=80?Ii.HIGH:Ii.EXTREME}function $j(e,t,n){var u,p;const s=((u=e.relationship)==null?void 0:u.affection)||0;if(s<50)return 0;let i={CHAT:5,GIFT:10,SPAR:8,DUAL_CULTIVATION:30}[n]||5;s>=80?i*=2:s>=70?i*=1.5:s>=60&&(i*=1.2);const a=typeof e.personality=="object"&&e.personality!==null&&"label"in e.personality?e.personality.label:Array.isArray(e.personality)?e.personality[0]:"";return i*={:1.8,:1.6,:1.3,:.8,:1.1,:1.2}[a]||1,(((p=e.relationship)==null?void 0:p.jealousy)||0)>=60&&(i*=1.3),Math.floor(i)}function Bj(e,t,n,s){const o=[],a={CHAT:.12,GIFT:.18,SPAR:.15,DUAL_CULTIVATION:.08}[s]||.05;return n.forEach(l=>{var c;if(l.id===t.id||l.isDead)return;const d=((c=l.relationship)==null?void 0:c.affection)||0;if(d<50)return;let u=a;d>=80?u*=2:d>=70?u*=1.6:d>=60&&(u*=1.3);const p=typeof l.personality=="object"&&l.personality!==null&&"label"in l.personality?l.personality.label:Array.isArray(l.personality)?l.personality[0]:"";(p===""||p==="")&&(u*=1.3),Math.random()<u&&o.push(l)}),o}function Oj(e,t){var i,a;const n=((i=e.relationship)==null?void 0:i.affection)||0;if(n<70)return 0;const s=((a=e.relationship)==null?void 0:a.lastInteraction)||0;if(t-s>=3){let l=5;return n>=90?l=10:n>=80&&(l=8),l}return 0}function Pj(e,t){var l;const n=((l=e.relationship)==null?void 0:l.jealousy)||0;if(n===0)return 0;const s=2,o=typeof e.personality=="object"&&e.personality!==null&&"label"in e.personality?e.personality.label:Array.isArray(e.personality)?e.personality[0]:"",a=Math.floor(s*({:.5,:.6,:1.2,:1.5,:.8}[o]||1));return Math.min(a,n)}function zj(e){const t=e.filter(a=>{var u,p;if(a.isDead)return!1;const l=((u=a.relationship)==null?void 0:u.jealousy)||0,d=((p=a.relationship)==null?void 0:p.affection)||0;return l>=60&&d>=70});if(t.length<2)return null;const i=Math.min(.2,.05+t.length*.05);return Math.random()<i?{type:"SHURA_FIELD",participants:t,triggerChance:i}:null}function Dj(e,t){const n=t.name;t.gender;const s=[...e].sort((f,b)=>{var j,x;const S=((j=f.relationship)==null?void 0:j.jealousy)||0;return(((x=b.relationship)==null?void 0:x.jealousy)||0)-S}),o=s[0],i=s[1],a=s.slice(2),l=typeof o.personality=="object"&&o.personality!==null&&"label"in o.personality?o.personality.label:Array.isArray(o.personality)?o.personality[0]:"",d=typeof i.personality=="object"&&i.personality!==null&&"label"in i.personality?i.personality.label:Array.isArray(i.personality)?i.personality[0]:"";let u="";e.length===2?u=`

${o.name}${i.name}...`:u=`

${o.name}${i.name}${a.length>0?""+a.map(f=>f.name).join(""):""}...`;const p=[];l===""?p.push({speaker:o.name,text:`${n}...`}):l===""?p.push({speaker:o.name,text:`${n}`}):l===""?p.push({speaker:o.name,text:`${n}`}):p.push({speaker:o.name,text:`${n}${i.name}...`}),d===""?p.push({speaker:i.name,text:`${o.name}${n}...`}):d===""?p.push({speaker:i.name,text:`${o.name}${n}`}):d===""?p.push({speaker:i.name,text:`.........${n}...`}):p.push({speaker:i.name,text:`${n}`}),a.length>0&&p.push({speaker:a[0].name,text:`${n}`});const c=[{label:`${o.name}`,hint:`${o.name}`,effect:"FAVOR_NPC1"},{label:`${i.name}`,hint:`${i.name}`,effect:"FAVOR_NPC2"},{label:"",hint:"",effect:"MEDIATE"},{label:"",hint:"",effect:"HONEST"},{label:"",hint:"",effect:"AVOID"}];return{type:"SHURA_FIELD",participants:s,description:u,dialogues:p,options:c}}function Rr(e,t,n,s={}){const o=typeof e.personality=="object"&&e.personality!==null&&"label"in e.personality?e.personality.label:Array.isArray(e.personality)?e.personality[0]:"";e.identity;const i=t.name,a=t.gender===""?"":"",l={:`...${i}${i}`,:`...${i}${a}${a}`,:`${i}...`,:`${i}.........`,:`${i}${a}...`,:`${i}...`,:`...${i}""...`,:`${i}......`,:`${i}${a}...`,:`...${i}${a}...`},d={:`${i}...${a}`,:`...${i}...`,:`${i}...${a}`,:`${i}.........`,:`${i}${a}${a}`,:`${i}...`,:`${i}...`,:`${i}...${a}`,:`...${i}...`},u={:`${i}${s.favoredName}...${a}...`,:`${i}${s.favoredName}`,:`${i}${a}...${a}`,:`${i}${s.favoredName}......`,:`${i}${s.favoredName}`,:`${i}......`,:`${i}${s.favoredName}...`,:`${i}...${a}${a}...`,:`${i}${a}${a}`,:`...${i}${s.favoredName}${a}${s.favoredGender===""?"":""}`},p={:`${i}...${a}`,:`${i}...${a}`,:`${i}...`,:`${i}...${a}...`,:`${i}${a}`,:`${i}...`,:`${i}...${a}...`,:`${i}...`},c={:`${i}${a}...${a}`,:`${i}...${a}`,:`${i}...${a}`,:`${i}${a}`,:`${i}${a}...${a}`},f={:`${i}${a}${a}...`,:`${i}${a}`,:`${i}...${a}`,:`${i}${a}${a}`,:`${i}...`,:`${i}...${a}${a}...`},b={:`${i}${a}...${a}`,:`${i}...`,:`${i}...${a}`,:`${i}...${a}...`,:`${i}${a}`,:`${i}......`,:`${i}...${a}...`,:`${i}...${a}...`,:`${i}${a}`,:`${i}...${a}`,:`${i}...${a}${a}...`};let S="";switch(n){case"trigger":S=l[o]||l.;break;case"favored":S=d[o]||d.;break;case"neglected":S=u[o]||u.;break;case"mediate":S=p[o]||p.;break;case"honest_understand":S=c[o]||c.;break;case"honest_angry":S=f[o]||f.;break;case"avoid":S=b[o]||b.;break}return S}function Fj(e,t,n){const s={changes:[],message:"",npcLogs:[]};switch(t.effect){case"FAVOR_NPC1":s.changes.push({npcId:e.participants[0].id,jealousyChange:-20,affectionChange:5}),s.changes.push({npcId:e.participants[1].id,jealousyChange:10,affectionChange:-5}),e.participants.slice(2).forEach(o=>{s.changes.push({npcId:o.id,jealousyChange:10,affectionChange:-3})}),s.message=`${e.participants[0].name}${e.participants[0].gender===""?"":""}...`,s.npcLogs.push({npcId:e.participants[0].id,content:Rr(e.participants[0],n,"favored"),type:"DAILY",isSecret:!0}),s.npcLogs.push({npcId:e.participants[1].id,content:Rr(e.participants[1],n,"neglected",{favoredName:e.participants[0].name,favoredGender:e.participants[0].gender}),type:"DAILY",isSecret:!0}),e.participants.slice(2).forEach(o=>{s.npcLogs.push({npcId:o.id,content:Rr(o,n,"neglected",{favoredName:e.participants[0].name,favoredGender:e.participants[0].gender}),type:"DAILY",isSecret:!0})});break;case"FAVOR_NPC2":s.changes.push({npcId:e.participants[1].id,jealousyChange:-20,affectionChange:5}),s.changes.push({npcId:e.participants[0].id,jealousyChange:10,affectionChange:-5}),e.participants.slice(2).forEach(o=>{s.changes.push({npcId:o.id,jealousyChange:10,affectionChange:-3})}),s.message=`${e.participants[1].name}${e.participants[1].gender===""?"":""}...`,s.npcLogs.push({npcId:e.participants[1].id,content:Rr(e.participants[1],n,"favored"),type:"DAILY",isSecret:!0}),s.npcLogs.push({npcId:e.participants[0].id,content:Rr(e.participants[0],n,"neglected",{favoredName:e.participants[1].name,favoredGender:e.participants[1].gender}),type:"DAILY",isSecret:!0}),e.participants.slice(2).forEach(o=>{s.npcLogs.push({npcId:o.id,content:Rr(o,n,"neglected",{favoredName:e.participants[1].name,favoredGender:e.participants[1].gender}),type:"DAILY",isSecret:!0})});break;case"MEDIATE":e.participants.forEach(o=>{s.changes.push({npcId:o.id,jealousyChange:-10,affectionChange:0})}),s.message="...",e.participants.forEach(o=>{s.npcLogs.push({npcId:o.id,content:Rr(o,n,"mediate"),type:"DAILY",isSecret:!0})});break;case"HONEST":e.participants.forEach(o=>{var a;(((a=o.relationship)==null?void 0:a.jealousy)||0)>=80?s.changes.push({npcId:o.id,jealousyChange:5,affectionChange:-3}):s.changes.push({npcId:o.id,jealousyChange:-15,affectionChange:3})}),s.message="...",e.participants.forEach(o=>{var l;const a=(((l=o.relationship)==null?void 0:l.jealousy)||0)>=80?"honest_angry":"honest_understand";s.npcLogs.push({npcId:o.id,content:Rr(o,n,a),type:"DAILY",isSecret:!0})});break;case"AVOID":e.participants.forEach(o=>{s.changes.push({npcId:o.id,jealousyChange:5,affectionChange:-8})}),s.message="...",e.participants.forEach(o=>{s.npcLogs.push({npcId:o.id,content:Rr(o,n,"avoid"),type:"DAILY",isSecret:!0})});break}return s}const Ah={1:{relation:"",address:""},2:{relation:"",address:""},3:{relation:"",address:""},default:{relation:"",address:""}},Fy=(e={},t={})=>{const n=Math.max(1,(e==null?void 0:e.generation)||1);return{...Ah[n]||Ah.default,gender:"female",generation:n}},Rt={LETTER:"LETTER",OBITUARY:"OBITUARY",DEPARTURE:"DEPARTURE",ACHIEVEMENT:"ACHIEVEMENT"},Vs={PENDING:"PENDING",READY:"READY",READ:"READ"};function Hy({type:e,senderId:t,senderName:n,title:s,content:o="",timestamp:i,extras:a={},status:l=Vs.READY,replies:d=[]}){return{id:`msg_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,type:e,senderId:t,senderName:n,title:s,content:o,isRead:l===Vs.READ,status:l,timestamp:i,extras:a,createdAt:Date.now(),replies:d,lastRepliedAt:null}}class Hj{constructor(t=100,n=50){this.messages=[],this.maxMessages=t,this.maxLetters=n,this.recentContents=new Map}addMessage(t){if(t.type===Rt.LETTER&&t.senderId){if(this.recentContents.get(t.senderId)===t.content)return console.log(`[MessageManager] : ${t.senderName}`),!1;this.recentContents.set(t.senderId,t.content)}return this.messages.unshift(t),this.cleanup(),!0}addReplyToMessage(t,n){const s=this.messages.find(i=>i.id===t);if(!s)return null;const o={id:`reply_${Date.now()}_${Math.random().toString(36).substr(2,6)}`,content:n.content,tone:n.tone||"warm",toneLabel:n.toneLabel||"",sentiment:n.sentiment||"",timestamp:n.timestamp,from:n.from||"",affectionDelta:n.affectionDelta||0,createdAt:Date.now()};return Array.isArray(s.replies)||(s.replies=[]),s.replies.push(o),s.lastRepliedAt=o.timestamp,s.extras&&(s.extras.hasNpcRespondedToReply=!1),{message:s,reply:o}}markAsRead(t){const n=this.messages.find(s=>s.id===t);n&&(n.isRead=!0,n.status=Vs.READ)}getUnreadCount(){return this.messages.filter(t=>!t.isRead&&t.status===Vs.READY).length}getRecentRepliesForNpc(t,n=3){if(!t)return[];const s=[];return this.messages.forEach(o=>{o.senderId===t&&(!Array.isArray(o.replies)||o.replies.length===0||o.replies.forEach(i=>{s.push({messageId:o.id,messageTitle:o.title,content:i.content||"",tone:i.tone,toneLabel:i.toneLabel,timestamp:i.timestamp,createdAt:i.createdAt||0})}))}),s.sort((o,i)=>(i.createdAt||0)-(o.createdAt||0)),s.slice(0,n)}getMessagesByType(t){return this.messages.filter(n=>n.type===t)}getAllMessages(){return[...this.messages]}cleanup(){const t=this.messages.filter(s=>s.type===Rt.OBITUARY),n=this.messages.filter(s=>s.type!==Rt.OBITUARY);if(n.length>this.maxLetters){const s=n.slice(0,this.maxLetters);this.messages=[...t,...s]}this.messages.length>this.maxMessages&&(this.messages=this.messages.slice(0,this.maxMessages))}deleteMessage(t){this.messages=this.messages.filter(n=>n.id!==t)}loadFromData(t){this.messages=t||[]}toJSON(){return this.messages}}const Nh={child:(e,t,n)=>{const s=e.age||0,o=Math.floor(s*12),i=e.sect&&e.sect.name,a=e.spouse!==null&&e.spouse!==void 0,l=e.tierTitle||"",{address:d}=Fy(e,t),u=d||t.name||"";let p="";if(o<216)i?p=`${e.sect.name}${l}`:p=`${l}`;else if(a&&i){const f=e.sect.name,b=e.spouse.name;p=`${f}${b}${l}`}else if(a){const f=e.spouse.name;p=`${f}${f}`}else i?p=`${e.sect.name}${l}`:p=`${l}`;const c=o<216?"":"";return`${u}

${p}

${e.name} ${c}
 ${n.year} ${n.month}`},spouse:(e,t,n)=>{var u,p,c,f,b;const s=((u=e.relationship)==null?void 0:u.affection)||60,o=((p=e.relationship)==null?void 0:p.jealousy)||0,i=((c=e.trait)==null?void 0:c.name)||"";let a=e.gender==="male"?"":"",l="";o>=60?i.includes("")||i.includes("")?l="...":i.includes("")?l="......":l="":s>=80?i.includes("")||i.includes("")?l="":i.includes("")||i.includes("")?l="...":i.includes("")?l="":l=`${e.tier||""}`:s>=50?l="":l="",(f=e.identity)!=null&&f.includes("")?l+=`

`:(b=e.identity)!=null&&b.includes("")&&(l+=`

`);const d=s>=70?"":"";return`${a}

${l}

${e.name} ${d}
 ${n.year} ${n.month}`},friend:(e,t,n)=>{var l,d;const s=((l=e.relationship)==null?void 0:l.affection)||50,o=((d=e.trait)==null?void 0:d.name)||"";let i="";s>=70?o.includes("")||o.includes("")?i="":o.includes("")||o.includes("")?i="":i="":i="";const a=s>=60?"":"";return`${t.name}

${i}

${e.name} ${a}
 ${n.year} ${n.month}`},default:(e,t,n)=>{var T,N,Y,H,B;const s=typeof((T=e.relationship)==null?void 0:T.affection)=="number"?e.relationship.affection:typeof e.affection=="number"?e.affection:50,o=((N=e.trait)==null?void 0:N.name)||"",i=e.identity||"",a=e.tier||"",l=((Y=e.sect)==null?void 0:Y.name)||e.sect||"",d=(t==null?void 0:t.name)||"",u=((H=e.travelLog)==null?void 0:H.currentPlace)||((B=e.activity)==null?void 0:B.location)||e.currentResidence||l||"",p=s>=60?d:`${d}`,c=s>=85?"":s>=65?"":s>=45?"":"",b=`${u===""?"":`${u}`}${a}`,S=(()=>{const q=[{keywords:[""],text:""},{keywords:["",""],text:""},{keywords:[""],text:""},{keywords:["",""],text:""},{keywords:[""],text:""},{keywords:[""],text:""},{keywords:["",""],text:""},{keywords:[""],text:""}].find(se=>se.keywords.some(J=>i.includes(J)));return q?q.text:""})(),E=(()=>{var se;const $=(se=e.memories)==null?void 0:se.recentEvents;if(!Array.isArray($)||$.length===0)return"";const q=$.slice(-2).map(J=>((J==null?void 0:J.description)||"").trim()).filter(Boolean);return q.length===0?"":`${q.join("")}`})(),j=(()=>{var se;const $=(se=e.memories)==null?void 0:se.milestones;if(!Array.isArray($)||$.length===0)return"";const q=$[$.length-1];return q!=null&&q.event?`${q.event}`:""})(),x=s>=85?"":s>=65?"":s>=45?"":"",h=o.includes("")?"":o.includes("")||o.includes("")?"":o.includes("")||o.includes("")?"":o.includes("")?"":o.includes("")?"":o.includes("")||o.includes("")?"":o.includes("")?"":"",v=s>=70?"":s>=50?"":"",g=[c,b,S,E,j].filter(Boolean).join(""),I=[x,h,v].filter(Boolean).join(""),_=[g,I].filter($=>$&&$.trim().length>0).join(`

`),C=s>=80?"":s>=60?"":s>=45?"":"",k=(n==null?void 0:n.year)??"",R=(n==null?void 0:n.month)??"";return`${p}

${_}

${e.name} ${C}
 ${k} ${R}`}},Lh={child:(e,t,n)=>{const s=e.age||0,o=Math.floor(s*12),i=e.sect&&e.sect.name,a=e.spouse!==null&&e.spouse!==void 0,l=e.gender===""?e.motherName?"":"":e.fatherName?"":"";let d="";return o<216?d="......":a?d=`${e.spouse.name}/...`:i?d=`${e.sect.name}...`:d="...",`${l}

${d}

${e.name} 
 ${n.year} ${n.month}`},spouse:(e,t,n)=>{var l,d;const s=((l=e.trait)==null?void 0:l.name)||"",o=((d=e.relationship)==null?void 0:d.affection)||80,i=e.gender==="male"?"":"";let a="";return o>=90?s.includes("")||s.includes("")?a="......":s.includes("")||s.includes("")?a=".........":s.includes("")?a="......":a="...":o>=60?a="...":a="",`${i}

${a}

${e.name} 
 ${n.year} ${n.month}`},friend:(e,t,n)=>{var a,l;const s=((a=e.trait)==null?void 0:a.name)||"",o=((l=e.relationship)==null?void 0:l.affection)||60;let i="";return o>=70?s.includes("")||s.includes("")?i="":s.includes("")||s.includes("")?i="":i="":o>=40?i="":i="",`${t.name}

${i}

${e.name} 
 ${n.year} ${n.month}`},default:(e,t,n)=>{var i;const s=e.affection||((i=e.relationship)==null?void 0:i.affection)||50;let o="";return s>=60?o="":o="",`${t.name}

${o}

${e.name} 
 ${n.year} ${n.month}`}};async function Wj(e,t,n,s="default",o,i={}){var a,l,d,u,p,c,f,b,S,E;try{console.log(" []",{:e.name,ID:e.id,:s,:{fatherName:e.fatherName||"",motherName:e.motherName||"",generation:e.generation||""},children:((a=i.children)==null?void 0:a.some(ee=>ee.id===e.id))||!1,:t.name});let j="",x="",h="";const v=e.relationship||{},g=v.affection||0,I=v.jealousy||0,_=v.stage||0,C=v.cutTies||!1,k=((l=i.exiledChildren)==null?void 0:l.some(ee=>ee.id===e.id))||!1;let R="";if((u=(d=e.memories)==null?void 0:d.profile)!=null&&u.firstMeet){const ee=new Date(e.memories.profile.firstMeet),Ee=Math.floor((new Date-ee)/(365.25*24*60*60*1e3));Ee>0?R=`
${Ee}`:R=`
`}let T="",N="";g>=90?(T="",N=""):g>=70?(T="",N=""):g>=50?(T="",N=""):g>=30?(T="",N=""):(T="",N="");let Y="";if(s!=="child"&&e.memories)try{const ee=Oy(e,{includeMilestones:!0,includeRecent:!0,maxRecent:5});ee&&ee.trim().length>0&&(Y=`
`+ee)}catch(ee){console.warn(":",ee)}let H="";const B=Array.isArray(i.replyHistory)?i.replyHistory:[];B.length>0&&(H=`

${B.map((he,Ee)=>{const _e=he.timestamp,rt=_e&&_e.year?` ${_e.year} ${_e.month}`:"",At=he.toneLabel||"",Oe=(he.content||"").replace(/\s+/g," ").trim(),P=Oe.length>60?`${Oe.slice(0,60)}`:Oe||"";return`${Ee+1}. ${rt}  ${At}${P}`}).join(`
`)}
`);let $="";const q=((p=e.trait)==null?void 0:p.name)||"";q.includes("")?$="":q.includes("")?$="":q.includes("")?$="":q.includes("")?$="":q.includes("")?$="":q.includes("")?$="":q.includes("")?$="":q.includes("")?$="":q.includes("")?$="":q.includes("")?$="":q.includes("")?$="":q.includes("")?$="":q.includes("")?$="":q.includes("")?$="":q.includes("")?$="":q.includes("")?$="":q.includes("")?$="":q.includes("")?$="":q.includes("")?$="":q.includes("")||q.includes("")?$="":q.includes("")?$="":$="";let se="";const J=e.identity||"";J.includes("")?se=`
`:J.includes("")?se=`
`:J.includes("")||J.includes("")?se=`
`:J.includes("")?se=`
`:J.includes("")?se=`
`:J.includes("")?se=`
`:J.includes("")?se=`
`:J.includes("")?se=`
`:J.includes("")?se=`
`:J.includes("")?se=`
`:J.includes("")||J.includes("")?se=`
`:J.includes("")?se=`
`:J.includes("")||J.includes("")?se=`
`:J.includes("")?se=`
`:J.includes("")?se=`
`:J.includes("")?se=`
`:J.includes("")?se=`
`:J.includes("")?se=`
`:J.includes("")?se=`
`:J.includes("")&&(se=`
`);let X="normal",re="";switch(C||k?(X="farewell",h=`

`,C&&(h+=`${t.name}`),k&&(h+="")):I>=80&&s!=="child"?(X="jealous",h=`

${I}${t.name}

""""""""`):I>=60&&s!=="child"?(X="normal",re="slight_jealous",h=`

${I}`):g>=70&&s==="spouse"?(X="missing",re="longing",h=`

${g>=90?"":""}`):s==="spouse"&&Re?(X="normal",re="family"):s==="friend"?(X="normal",re="sharing"):(X="normal",re="general"),s){case"child":const ee=Math.floor((e.age||0)*12),he=((c=e.sect)==null?void 0:c.name)||e.sect||"",Ee=e.tierTitle||e.tier||"",_e=e.spouse!==null&&e.spouse!==void 0,rt=((f=e.spouse)==null?void 0:f.name)||"",At=Math.max(1,e.generation||1),{relation:Oe}=Fy(e,t),P=e.fatherName||e.motherName||"",pe=!!e.fatherName;let fe=`${e.name}${Math.floor(e.age||0)}${Ee}
${t.name}${Oe}`;P&&P!==""&&(fe+=`
${P}${pe?"":""}`),he&&(fe+=`
${he}`),_e&&(fe+=`
${rt}`),j=fe,k?x=`${Oe}`:ee<216?x=`${Oe}`:x=`${Oe}`;break;case"spouse":j=`${t.name}${e.name}${e.tier||""}`,C?x="":X==="jealous"?x="":x="";break;case"friend":if(e.fatherName||e.motherName||e.generation||e.parent||e.parentId||((b=t.children)==null?void 0:b.some(je=>je.id===e.id))){const je=(n.year-(e.birthYear||0))*12+(n.month-(e.birthMonth||1)),Ge=t.gender===""?"":"";j=`${t.name}${Math.floor(je/12)}`,je<216?x=""+Ge+"":x=""}else j=`${t.name}${e.name}${e.tier||""}`,C?x="":x="";break;default:j=`${e.name}${e.tier||""}${t.name}`,x=""}let ye="",Re=!1,Fe="";if(_>=3&&s==="spouse"&&(ye+=`
`),i.dualCultivationCount>0&&s==="spouse"&&(ye+=`
${i.dualCultivationCount}`),i.children&&i.children.length>0){const ee=i.children.filter(he=>he.fatherName===e.name||he.motherName===e.name||s==="child"&&he.parentId===e.id);if(ee.length>0){Re=!0;const he=ee.map(Ee=>Ee.name).join("");if(s==="spouse")Fe=`
${ee.length}${he}`,e.gender===""&&(Fe+=`
${g>=80?"":g>=60?"":""}`);else if(s==="child"){const Ee=ee.filter(_e=>_e.id!==e.id);Ee.length>0&&(Fe=`
${Ee.length}${Ee.map(_e=>_e.name).join("")}`)}ye+=Fe}}let O="";if(s==="child")O=`${e.name}${t.name}${X==="farewell"?"":""}


${j}

${x?`
${x}`:""}

${H?`${H}
`:""}


- 
- ${e.name}
- ${t.name}${playerRelation}
- ${generation===1?"":generation===2?"":""}
- ${X==="farewell"?"":""}
- 250
- """"""""""
- ${e.name} ${childAge<216?"":""}
 ${n.year} ${n.month}`;else{let ee="";Re&&e.gender===""&&(ee=""),O=`${e.name}${t.name}${X==="farewell"?"":""}


${ee}${t.name}


${j}
${e.identity||""}
${e.tier||""}
${e.sect?`${e.sect}`:""}


${((S=e.trait)==null?void 0:S.name)||""}${((E=e.trait)==null?void 0:E.description)||""}
${$}


${se||""}


${g}${T}
${R}${ye}

${H}${Y}${h}


1. 1-2""""
2. ${N}${x}
3. 120-180
4. 
   ${X==="farewell"?"- //":X==="jealous"?'- """"':X==="missing"?"- ":re==="slight_jealous"?`- 
   - `:re==="family"?"- ":re==="sharing"?"- ":`- 
   - `}
   ${Re&&X!=="jealous"?"- ":""}
   ${X!=="jealous"&&X!=="farewell"?`- 
   - `:""}
5. 
6. "${e.name}\\n ${n.year} ${n.month}"`}const ie=[{role:"system",content:O},{role:"user",content:s==="child"?`${e.name}${t.name}${X==="farewell"?"":""} ${n.year} ${n.month}
          

1. """"""""
2. 
3. `:`${e.name}${t.name}${X==="farewell"?"":X==="jealous"?"":X==="missing"?"":""} ${n.year} ${n.month}`}];return await Fc(ie,o.apiKey,o.apiUrl||"https://api.deepseek.com/chat/completions",{model:o.apiModel||"deepseek-chat",temperature:.9,maxTokens:350})}catch(j){return console.error("AI:",j),vp(e,t,n,s)}}function vp(e,t,n,s="default"){var i;return s==="friend"&&(e.fatherName||e.motherName||e.generation||e.parent||e.parentId||(i=t.children)!=null&&i.some(l=>l.id===e.id))&&(s="child"),(Nh[s]||Nh.default)(e,t,n)}function Uj(e,t,n,s="default"){var i;return s==="friend"&&(e.fatherName||e.motherName||e.generation||e.parent||e.parentId||(i=t.children)!=null&&i.some(l=>l.id===e.id))&&(s="child"),(Lh[s]||Lh.default)(e,t,n)}function Gj(e,t=3,n=null){var l,d,u,p,c,f;if(!e||e.acceptsLetters===!1)return!1;const s=typeof((l=e.relationship)==null?void 0:l.affection)=="number"?e.relationship.affection:void 0,o=typeof e.affection=="number"?e.affection:s;if(!e.isChild&&typeof o=="number"&&o<100||n&&((d=n.extras)==null?void 0:d.hasNpcRespondedToReply)===!0&&(!(n.replies&&n.replies.length>0)||n.extras.hasNpcRespondedToReply===!0)||t<3)return!1;let i=.3;const a=typeof o=="number"?o:0;return a>80?i+=.3:a>60?i+=.2:a>40&&(i+=.1),((u=e.traits)!=null&&u.includes("")||(p=e.traits)!=null&&p.includes(""))&&(i+=.2),((c=e.traits)!=null&&c.includes("")||(f=e.traits)!=null&&f.includes(""))&&(i-=.2),Math.random()<Math.max(.1,Math.min(.9,i))}function Wy(e,t){var n,s;return e.id===((n=t.spouse)==null?void 0:n.id)?"spouse":(s=t.children)!=null&&s.some(o=>o.id===e.id)||e.isChild===!0||e.fatherName||e.motherName||e.generation||e.parent||e.parentId?"child":e.affection>60?"friend":"default"}function Vj(e,t,n){const s=Wy(e,t),o=Uj(e,t,n,s);let i="";return s==="child"?i=`${e.name}`:s==="spouse"?i=`${e.name}`:s==="friend"&&(i=`${e.name}`),Hy({type:Rt.OBITUARY,senderId:e.id,senderName:e.name,title:i,content:o,timestamp:{...n},extras:{npcId:e.id,relation:s,deathCause:e.deathCause||""},status:Vs.READY})}async function $h(e,t,n,s=!0,o={},i={}){const a=Wy(e,t),l=Array.isArray(i.replyHistory)?i.replyHistory:[],d=l[0],u=l.length>0,p=u&&((d==null?void 0:d.content)||"").replace(/\s+/g," ").trim().slice(0,40)||"";let c="";a==="child"?c="":a==="spouse"?c="":a==="friend"&&(c="");let f="";if(s)if(o.useAIForLetter&&o.apiKey&&o.apiKey.trim().length>0)try{f=await Wj(e,t,n,a,o,i)}catch(E){console.error("AI:",E),f=vp(e,t,n,a)}else f=vp(e,t,n,a);return Hy({type:Rt.LETTER,senderId:e.id,senderName:e.name,title:`${e.name}${c}`,content:f,timestamp:{...n},extras:{npcId:e.id,relation:a,...u?{isReplyToPlayer:!0,replySourceCount:l.length,replySourceTone:(d==null?void 0:d.toneLabel)||"",replySourceSnippet:p,replySourceTimestamp:(d==null?void 0:d.timestamp)||null,hasNpcRespondedToReply:!0}:{}},status:s?Vs.READY:Vs.PENDING})}const _i=[{id:"warm",label:"",desc:"",affectionDelta:5},{id:"calm",label:"",desc:"",affectionDelta:3},{id:"firm",label:"",desc:"",affectionDelta:-2}],Yj=({isOpen:e,onClose:t,messages:n,onMarkAsRead:s,onDeleteMessage:o,onSendReply:i})=>{var N,Y,H;const[a,l]=y.useState(null),[d,u]=y.useState("all"),[p,c]=y.useState(""),[f,b]=y.useState(_i[0].id),[S,E]=y.useState(!1),[j,x]=y.useState(null),h=y.useMemo(()=>{const B=Array.isArray(n)?n:[];return d==="all"?B:d==="letter"?B.filter($=>$.type===Rt.LETTER||$.type===Rt.DEPARTURE||$.type===Rt.ACHIEVEMENT):d==="obituary"?B.filter($=>$.type===Rt.OBITUARY):B},[n,d]),v=y.useMemo(()=>h.find(B=>B.id===a),[h,a]);y.useEffect(()=>{c(""),b(_i[0].id),x(null)},[a]);const g=B=>{l(B.id),B.isRead||s(B.id)},I=()=>{l(null),t()};y.useEffect(()=>{const B=$=>{$.key==="Escape"&&I()};return window.addEventListener("keydown",B),()=>window.removeEventListener("keydown",B)},[I]);const _=B=>{if(!B)return"";if(typeof B=="object"&&B.year)return` ${Math.floor(B.year)}${B.month}`;const $=new Date(B);return Number.isNaN($.getTime())?"":`${$.getFullYear()}${$.getMonth()+1}${$.getDate()}`},C=v&&v.type!==Rt.OBITUARY&&typeof i=="function",k=async()=>{var q;if(!C)return;const B=p.trim();if(!B){x("");return}const $=_i.find(se=>se.id===f)||_i[0];E(!0);try{const se=await Promise.resolve(i({messageId:v.id,targetNpcId:v.senderId,relation:(q=v.extras)==null?void 0:q.relation,content:B,tone:$}));se&&se.success?(c(""),x(""),setTimeout(()=>x(null),1800)):x((se==null?void 0:se.error)||"")}finally{E(!1)}},R=B=>{switch(B){case Rt.OBITUARY:return"";case Rt.LETTER:return"";case Rt.DEPARTURE:return"";case Rt.ACHIEVEMENT:return"";default:return""}},T=B=>B===Rt.OBITUARY?"message-background-obituary":"message-background-letter";return e?r.jsx("div",{className:"message-center-overlay",onClick:I,children:r.jsxs("div",{className:"message-center-modal",onClick:B=>B.stopPropagation(),children:[r.jsxs("div",{className:"message-center-header",children:[r.jsx("h2",{children:" "}),r.jsx("button",{className:"close-btn",onClick:I,children:""})]}),r.jsxs("div",{className:"message-filters",children:[r.jsxs("button",{className:`filter-btn ${d==="all"?"active":""}`,onClick:()=>u("all"),children:[" (",n.length,")"]}),r.jsxs("button",{className:`filter-btn ${d==="letter"?"active":""}`,onClick:()=>u("letter"),children:[" (",n.filter(B=>B.type!==Rt.OBITUARY).length,")"]}),r.jsxs("button",{className:`filter-btn ${d==="obituary"?"active":""}`,onClick:()=>u("obituary"),children:[" (",n.filter(B=>B.type===Rt.OBITUARY).length,")"]}),n.some(B=>!B.isRead)&&r.jsx("button",{className:"filter-btn mark-all-read-btn",onClick:()=>{n.forEach(B=>{B.isRead||s(B.id)})},style:{marginLeft:"auto",background:"#7AA893",color:"white"},children:" "})]}),r.jsxs("div",{className:"message-center-content",children:[r.jsx("div",{className:"message-list",children:h.length===0?r.jsxs("div",{className:"empty-message",children:[r.jsx("p",{children:""}),r.jsx("p",{children:""})]}):h.map(B=>{var $,q;return r.jsxs("div",{className:`message-item ${a===B.id?"selected":""} ${B.isRead?"":"unread"} ${B.type===Rt.OBITUARY?"obituary":""}`,onClick:()=>g(B),children:[!B.isRead&&r.jsx("span",{className:"unread-dot"}),r.jsx("div",{className:"message-avatar",children:B.type===Rt.OBITUARY?"":""}),r.jsxs("div",{className:"message-info",children:[r.jsxs("div",{className:"message-sender",children:[B.senderName,r.jsx("span",{className:"message-type-label",children:R(B.type)}),(($=B.extras)==null?void 0:$.isReplyToPlayer)&&r.jsx("span",{className:"message-reply-badge",children:""}),((q=B.replies)==null?void 0:q.length)>0&&r.jsxs("span",{className:"message-replied-flag",children:["",B.replies.length]})]}),r.jsx("div",{className:"message-title",children:B.title}),r.jsxs("div",{className:"message-time",children:[" ",B.timestamp.year," ",B.timestamp.month,""]})]})]},B.id)})}),r.jsx("div",{className:`message-reader ${v?T(v.type):""}`,children:v?r.jsxs("div",{className:"reader-content",children:[r.jsxs("div",{className:"reader-header",children:[r.jsx("h3",{children:v.title}),r.jsxs("div",{className:"reader-meta",children:[r.jsx("span",{children:v.senderName}),r.jsx("span",{children:""}),r.jsxs("span",{children:[" ",v.timestamp.year," ",v.timestamp.month,""]})]})]}),r.jsx("div",{className:"reader-body",children:v.content?r.jsx("pre",{className:"message-content",children:v.content}):r.jsx("p",{className:"content-loading",children:"..."})}),((N=v.extras)==null?void 0:N.isReplyToPlayer)&&r.jsxs("div",{className:"reply-context-banner",children:[r.jsxs("div",{children:[" ",((Y=v.extras)==null?void 0:Y.replySourceTimestamp)&&r.jsx("span",{className:"reply-context-time",children:_(v.extras.replySourceTimestamp)})]}),((H=v.extras)==null?void 0:H.replySourceSnippet)&&r.jsxs("div",{className:"reply-context-snippet",children:["",v.extras.replySourceSnippet,""]})]}),v.replies&&v.replies.length>0&&r.jsxs("div",{className:"reply-thread",children:[r.jsx("h4",{children:" "}),r.jsx("div",{className:"reply-list",children:v.replies.map(B=>r.jsxs("div",{className:"reply-entry",children:[r.jsxs("div",{className:"reply-meta",children:[r.jsx("span",{children:B.from||""}),B.toneLabel&&r.jsx("span",{className:"reply-tone-label",children:B.toneLabel}),r.jsx("span",{children:_(B.timestamp)})]}),r.jsx("pre",{className:"reply-content",children:B.content})]},B.id))})]}),r.jsx("div",{className:"reader-actions",children:v.type===Rt.OBITUARY?r.jsxs(r.Fragment,{children:[r.jsx("button",{className:"action-btn secondary",children:" "}),r.jsx("button",{className:"action-btn danger",onClick:()=>{window.showConfirm&&window.showConfirm("",()=>{o(v.id),l(null)})},children:""})]}):r.jsx(r.Fragment,{children:r.jsx("button",{className:"action-btn",onClick:()=>{o(v.id),l(null)},children:""})})}),C&&r.jsxs("div",{className:"reply-composer",children:[r.jsxs("h4",{children:["  ",v.senderName]}),r.jsx("div",{className:"reply-tone-options",children:_i.map(B=>r.jsxs("button",{type:"button",className:`tone-btn ${f===B.id?"active":""}`,onClick:()=>b(B.id),children:[r.jsx("div",{className:"tone-header",children:r.jsx("span",{children:B.label})}),r.jsx("p",{children:B.desc})]},B.id))}),r.jsx("textarea",{className:"reply-input",placeholder:"120",maxLength:120,value:p,onChange:B=>c(B.target.value)}),r.jsxs("div",{className:"reply-actions",children:[j&&r.jsx("span",{className:"reply-feedback",children:j}),r.jsx("button",{type:"button",className:"action-btn primary",onClick:k,disabled:S,children:S?"...":""})]})]})]}):r.jsxs("div",{className:"reader-placeholder",children:[r.jsx("p",{children:""}),r.jsx("p",{children:""})]})})]})]})}):null},qj="cultivation_save_v1_slot_",Kj="cultivation_autosave_",Ol=5,Hc=3,au=100,Bh=20;let us=!1,zi=!1;const Wc=()=>{try{const e="__localStorage_test__";return localStorage.setItem(e,"test"),localStorage.removeItem(e),!0}catch(e){return console.error("localStorage :",e),!1}},Uy=()=>(us=Ob(),console.log(us?" TapTap ":"  TapTap "),us),Ps=e=>`${Kj}${e}`,qo=(e=1)=>`${qj}${e}`,Gy=e=>new Blob([JSON.stringify(e)]).size/1024,Vy=()=>{let e=0;for(let t in localStorage)localStorage.hasOwnProperty(t)&&(e+=localStorage[t].length+t.length);return{used:(e/1024).toFixed(2),usedMB:(e/1024/1024).toFixed(2)}},Sp=e=>!e||typeof e!="object"?e:Ep(e),Pl=e=>Array.isArray(e)?e.map(t=>Sp(t)):e,Qj=e=>{if(!e||typeof e!="object")return e;const t=Sp(e);return Array.isArray(e.worldNpcs)&&(t.worldNpcs=Pl(e.worldNpcs)),e.rival&&(t.rival=Sp(e.rival)),Array.isArray(e.spouses)&&(t.spouses=Pl(e.spouses)),Array.isArray(e.followers)&&(t.followers=Pl(e.followers)),Array.isArray(e.generation3Plus)?t.generation3Plus=e.generation3Plus:t.generation3Plus=[],t},yc=e=>{if(!e||typeof e!="object")return e;const t={...e};return t.player=Qj(e.player),["activeNpcs","children","deadNpcs","worldNpcs"].forEach(n=>{Array.isArray(e[n])&&(t[n]=Pl(e[n]))}),Array.isArray(t.inventory)||(console.warn(" "),t.inventory=[]),t},Yy=e=>{let t={...e};return t=og(t),t.logs&&t.logs.length>au&&(console.log(` ${t.logs.length} -> ${au}`),t.logs=t.logs.slice(0,au)),t.activeNpcs&&(t.activeNpcs=t.activeNpcs.map(n=>n.logs&&n.logs.length>Bh?{...n,logs:n.logs.slice(-Bh)}:n)),t.deadNpcs&&(t.deadNpcs=t.deadNpcs.map(n=>({id:n.id,name:n.name,deathYear:n.deathYear,deathReason:n.deathReason}))),t.messages&&Object.keys(t.messages).forEach(n=>{const s=t.messages[n];s&&s.length>30&&(t.messages[n]=s.slice(-30))}),t.player&&Array.isArray(t.player.generation3Plus)&&(t.player.generation3Plus=t.player.generation3Plus.map(n=>({id:n.id,generation:n.generation,birthYear:n.birthYear,parentGeneration:n.parentGeneration}))),t},qy=(e,t=1)=>{var n,s,o,i,a,l;if(!Wc())return{success:!1,error:"STORAGE_UNAVAILABLE",message:"localStorage "};try{const d=Yy(e),u=((s=(n=d.player)==null?void 0:n.time)==null?void 0:s.year)||((o=d.player)==null?void 0:o.age)||3572,p=((a=(i=d.player)==null?void 0:i.time)==null?void 0:a.month)||((l=d.player)==null?void 0:l.month)||1,c={...d,timestamp:Date.now(),saveDate:new Date().toLocaleString(),slotNumber:t,gameTime:` ${u} ${p}`,year:u,month:p},f=JSON.stringify(c),b=Gy(c);return console.log(`: ${b.toFixed(2)} KB`),b>102400?(console.warn(""),{success:!1,error:"STORAGE_TOO_LARGE",size:b.toFixed(2)}):(localStorage.setItem(qo(t),f),us&&!zi&&(zi=!0,ig(t,c).then(S=>{console.log(`  [${t}]:`,S.action),zi=!1}).catch(S=>{console.warn(`  [${t}]:`,S.message),zi=!1})),{success:!0,time:c.saveDate,slot:t,size:b.toFixed(2)})}catch(d){return console.error("Save failed:",d),d.name==="QuotaExceededError"||d.code===22?{success:!1,error:"QUOTA_EXCEEDED",message:""}:{success:!1,error:d.name||"UNKNOWN_ERROR",message:d.message}}},No=(e=1)=>{try{const t=localStorage.getItem(qo(e));if(!t)return null;const n=JSON.parse(t);return yc(n)}catch(t){return console.error("Load failed:",t),null}},Af=async(e=1)=>{if(!us)return console.log(""),No(e);try{const t=No(e),n=(t==null?void 0:t.timestamp)||0,s=await Pb(e,n);if(!s)return console.log(` [${e}]`),t;console.log(` [${e}]...`);const o=await zb(s.uuid,s.fileId,e);if(o){const i=yc(o);return localStorage.setItem(qo(e),JSON.stringify(i)),console.log(`  [${e}]`),i}return yc(o)}catch(t){return console.error(` [${e}]:`,t),console.log(""),No(e)}},Nf=()=>{var t,n;const e=[];if(!Wc()){console.warn("localStorage ");for(let s=1;s<=Ol;s++)e.push({slot:s,exists:!1,error:"localStorage"});return e}try{for(let s=1;s<=Ol;s++){const o=qo(s),i=localStorage.getItem(o);if(i)try{const a=JSON.parse(i);e.push({slot:s,exists:!0,saveDate:a.saveDate||"",playerName:((t=a.player)==null?void 0:t.name)||"",cultivation:((n=a.player)==null?void 0:n.cultivation)||0,timestamp:a.timestamp||0})}catch(a){console.error(` ${s} :`,a),e.push({slot:s,exists:!1})}else e.push({slot:s,exists:!1})}}catch(s){console.error(":",s);for(let o=1;o<=Ol;o++)e.push({slot:o,exists:!1})}return e},Ky=(e=1)=>{localStorage.removeItem(qo(e))},Jj=()=>{for(let e=1;e<=Ol;e++)localStorage.removeItem(qo(e));for(let e=1;e<=Hc;e++)localStorage.removeItem(Ps(e))},Qy=e=>{var t,n,s,o,i,a;if(!Wc())return console.warn("localStorage "),{success:!1,error:"STORAGE_UNAVAILABLE"};try{const l=Yy(e),d=((n=(t=l.player)==null?void 0:t.time)==null?void 0:n.year)||Math.floor(((s=l.player)==null?void 0:s.age)||0)||3572,u=((i=(o=l.player)==null?void 0:o.time)==null?void 0:i.month)||1,p=Math.floor(((a=l.player)==null?void 0:a.age)||0),c={...l,player:{...l.player,age:p},timestamp:Date.now(),saveDate:new Date().toLocaleString(),isAutoSave:!0,gameTime:` ${d} ${u}`,year:d,month:u},f=JSON.stringify(c),b=Gy(c);if(b>4096)return console.warn(""),{success:!1,error:"STORAGE_TOO_LARGE"};for(let S=Hc;S>1;S--){const E=Ps(S-1),j=localStorage.getItem(E);j&&localStorage.setItem(Ps(S),j)}return localStorage.setItem(Ps(1),f),console.log(`  [ ${d} ${u}] : ${b.toFixed(2)} KB`),l.logs&&console.log(` :  ${l.logs.length||0} `),{success:!0,time:c.saveDate,gameTime:c.gameTime,size:b.toFixed(2)}}catch(l){return console.error(":",l),{success:!1,error:l.message}}},Jy=()=>{var t,n,s,o;const e=[];if(!Wc())return console.warn("localStorage "),e;try{for(let i=1;i<=Hc;i++){const a=Ps(i),l=localStorage.getItem(a);if(l)try{const d=JSON.parse(l);e.push({slot:i,exists:!0,saveDate:d.saveDate||"",gameTime:d.gameTime||"",year:d.year||0,month:d.month||0,playerName:((t=d.player)==null?void 0:t.name)||"",cultivation:((n=d.player)==null?void 0:n.cultivation)||0,age:Math.floor(((s=d.player)==null?void 0:s.age)||0),tier:((o=d.player)==null?void 0:o.tierTitle)||""})}catch(d){console.error(` ${i} :`,d),e.push({slot:i,exists:!1,error:""})}else e.push({slot:i,exists:!1})}}catch(i){console.error(":",i)}return e},Xy=(e=1)=>{try{const t=localStorage.getItem(Ps(e));if(!t)return null;const n=JSON.parse(t);return console.log(` [${e}]: ${n.gameTime}`),yc(n)}catch(t){return console.error(` ${e} :`,t),null}},Zy=()=>{for(let e=1;e<=Hc;e++)localStorage.removeItem(Ps(e));console.log("")},e1=async(e=1)=>{if(!us)throw new Error("");const t=No(e);if(!t)throw new Error(` ${e} `);return await ig(e,t)},t1=async(e=1)=>{if(!us)throw new Error("");const t=await Af(e);if(!t)throw new Error("");return t},n1=()=>({enabled:us,syncing:zi}),Xj=Object.freeze(Object.defineProperty({__proto__:null,autoSaveGame:Qy,clearAllAutoSaves:Zy,clearAllSaves:Jj,clearSave:Ky,getAllAutoSaves:Jy,getAllSaveSlots:Nf,getCloudSaveStatus:n1,getStorageInfo:Vy,initCloudSaveSystem:Uy,loadAutoSave:Xy,loadGameFromCloud:Af,loadGameFromStorage:No,manualDownloadFromCloud:t1,manualUploadToCloud:e1,saveGameToStorage:qy},Symbol.toStringTag,{value:"Module"})),Zj=({onFinish:e,onLoadGame:t})=>{const[n,s]=y.useState(0),[o,i]=y.useState([]),[a,l]=y.useState(!1);y.useEffect(()=>{const p=Nf();i(p)},[]);const d=[{text:"",sub:""},{text:"",sub:""},{text:"",sub:""},{text:"",sub:"..."},{text:"",sub:`

`}],u=o.some(p=>p.exists);return a?r.jsxs(r.Fragment,{children:[r.jsx("div",{style:Ot.overlay}),r.jsxs("div",{style:Ot.container,children:[r.jsx("h2",{style:{color:"#d4af37",marginBottom:"clamp(15px, 4vw, 30px)",fontSize:"clamp(18px, 5vw, 24px)"},children:""}),r.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"clamp(10px, 2vw, 15px)",width:"100%",maxWidth:"500px",marginBottom:"10px"},children:o.map(p=>r.jsxs("div",{style:{...Ot.slotCard,opacity:p.exists?1:.5,cursor:p.exists?"pointer":"not-allowed"},onClick:()=>{p.exists&&t(p.slot)},children:[r.jsxs("div",{style:Ot.slotHeader,children:[r.jsxs("span",{style:Ot.slotTitle,children:[" ",p.slot]}),p.exists&&r.jsx("span",{style:Ot.slotBadge,children:""})]}),p.exists?r.jsxs("div",{style:{fontSize:"clamp(11px, 2.8vw, 13px)",color:"#ccc",marginTop:"8px",lineHeight:"1.5"},children:[r.jsxs("div",{children:[": ",p.playerName]}),p.cultivation>0&&r.jsxs("div",{children:[": ",p.cultivation," "]}),r.jsxs("div",{style:{fontSize:"clamp(10px, 2.5vw, 12px)",marginTop:"4px",opacity:.8},children:[": ",p.saveDate]})]}):r.jsx("div",{style:{fontSize:"clamp(12px, 3vw, 13px)",color:"#999",marginTop:"8px"},children:""})]},p.slot))}),r.jsx("button",{onClick:()=>l(!1),style:{...Ot.btn,background:"#666",marginTop:"clamp(10px, 2vw, 20px)",width:"clamp(150px, 40vw, 200px)",padding:"clamp(10px, 2.5vw, 12px)",minHeight:"auto"},children:" "})]})]}):n<d.length?r.jsxs(r.Fragment,{children:[r.jsx("div",{style:Ot.overlay,onClick:()=>s(n+1)}),r.jsxs("div",{style:Ot.container,children:[r.jsx("h1",{style:Ot.title,children:d[n].text}),r.jsx("p",{style:Ot.sub,children:d[n].sub}),u&&n===0&&r.jsx("button",{onClick:p=>{p.stopPropagation(),l(!0)},style:{...Ot.btn,background:"#4caf50",marginBottom:"clamp(15px, 3vw, 20px)",width:"clamp(160px, 45vw, 200px)",textAlign:"center",border:"2px solid #45a049",minHeight:"auto",padding:"clamp(10px, 2.5vw, 12px)"},children:" "}),r.jsx("div",{style:Ot.tip,children:"[  ]"}),r.jsx("button",{onClick:()=>s(n+1),style:Ot.continueBtn,children:" "})]})]}):r.jsxs(r.Fragment,{children:[r.jsx("div",{style:Ot.overlay}),r.jsxs("div",{style:Ot.container,children:[r.jsx("h2",{style:{color:"#d4af37",marginBottom:"clamp(20px, 5vw, 30px)",fontSize:"clamp(20px, 5vw, 28px)"},children:""}),r.jsx("p",{style:Ot.sub,children:"..."}),r.jsx("button",{style:{...Ot.continueBtn,background:"#d4af37",fontSize:"clamp(15px, 4vw, 18px)",padding:"clamp(12px, 3vw, 15px) clamp(30px, 8vw, 40px)",marginTop:"clamp(15px, 4vw, 25px)"},onClick:()=>e(),children:" "})]})]})},Ot={overlay:{position:"fixed",top:0,left:0,width:"100%",height:"100%",background:"rgba(0, 0, 0, 0.85)",zIndex:2499,backdropFilter:"blur(8px)"},container:{position:"fixed",top:"50%",left:"50%",transform:"translate(-50%, -50%)",width:"90%",maxWidth:"600px",maxHeight:"90vh",background:"linear-gradient(135deg, #1a1a1a 0%, #2d2d2d 100%)",color:"white",display:"flex",flexDirection:"column",justifyContent:"flex-start",alignItems:"center",zIndex:2500,padding:"clamp(15px, 4vw, 30px)",textAlign:"center",overflowY:"auto",overflowX:"hidden",borderRadius:"clamp(8px, 2vw, 16px)",boxShadow:"0 20px 60px rgba(0, 0, 0, 0.8)",border:"2px solid rgba(211, 47, 47, 0.5)",WebkitOverflowScrolling:"touch"},title:{fontSize:"clamp(18px, 5vw, 32px)",marginBottom:"clamp(12px, 3vw, 20px)",animation:"fadeIn 1s",lineHeight:"1.3",wordBreak:"break-word"},sub:{fontSize:"clamp(13px, 3.5vw, 16px)",color:"#ccc",lineHeight:"1.6",maxWidth:"100%",animation:"slideUp 1s",padding:"0 5px",wordBreak:"break-word",marginBottom:"clamp(10px, 2vw, 15px)"},tip:{fontSize:"clamp(10px, 2.5vw, 12px)",color:"#888",marginTop:"clamp(8px, 2vw, 10px)",marginBottom:"5px"},continueBtn:{padding:"clamp(8px, 2vw, 10px) clamp(20px, 5vw, 30px)",background:"#d32f2f",border:"none",color:"#fff",borderRadius:"clamp(6px, 1.5vw, 8px)",cursor:"pointer",fontSize:"clamp(13px, 3vw, 14px)",fontWeight:"bold",transition:"all 0.3s",marginTop:"clamp(10px, 2vw, 15px)",minHeight:"40px",width:"auto"},btn:{padding:"clamp(12px, 3vw, 15px) clamp(10px, 2vw, 12px)",background:"#1a1a1a",border:"2px solid #666",color:"#fff",borderRadius:"clamp(8px, 2vw, 12px)",cursor:"pointer",textAlign:"center",transition:"all 0.3s",fontSize:"clamp(12px, 3vw, 15px)",lineHeight:"1.5",whiteSpace:"normal",wordWrap:"break-word",minHeight:"clamp(50px, 12vw, 70px)",display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",gap:"6px",width:"100%"},slotCard:{background:"rgba(255, 255, 255, 0.05)",padding:"clamp(12px, 3vw, 15px)",borderRadius:"clamp(6px, 1.5vw, 8px)",border:"2px solid rgba(255, 255, 255, 0.1)",transition:"all 0.3s",marginBottom:"8px"},slotHeader:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"8px",flexWrap:"wrap",gap:"5px"},slotTitle:{fontSize:"clamp(14px, 3.5vw, 16px)",fontWeight:"bold",color:"#d4af37"},slotBadge:{fontSize:"clamp(16px, 4vw, 18px)",color:"#4caf50"}},eC=({onConfirm:e,onExit:t})=>{const[n,s]=y.useState("warning"),[o,i]=y.useState(!1),a=()=>{const d=` 


 bug


 
/

 
1. ""
2. " "
3. " "
4. 

 
1. ""
2. " "
3. 
   -  
   -  
   -  
4. 

 
- 
- 50000 10 10 

 
1. 
2. Base64
3. 
4. 

`;navigator.clipboard.writeText(d).then(()=>{i(!0),setTimeout(()=>i(!1),2e3)}).catch(()=>{const u=document.createElement("textarea");u.value=d,document.body.appendChild(u),u.select(),document.execCommand("copy"),document.body.removeChild(u),i(!0),setTimeout(()=>i(!1),2e3)})},l={overlay:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0, 0, 0, 0.7)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:9999,padding:"20px"},container:{background:"linear-gradient(135deg, #f5ecd5 0%, #e0c9a6 100%)",borderRadius:"28px 28px 22px 22px/36px 36px 18px 18px",border:"2.5px solid #bfa76a",color:"#5b4322",boxShadow:"0 12px 48px rgba(191, 167, 106, 0.18)",maxWidth:"600px",width:"100%",maxHeight:"80vh",display:"flex",flexDirection:"column",overflow:"hidden"},header:{padding:"20px",borderBottom:"1px solid #d4af37",background:"linear-gradient(90deg, #f5ecd5 60%, #e0c9a6 100%)",textAlign:"center"},warningBanner:{backgroundColor:"#ff6b6b",color:"#fff",padding:"8px 16px",borderRadius:"12px",marginBottom:"12px",fontSize:"13px",fontWeight:"bold",display:"inline-block",letterSpacing:"0.5px",boxShadow:"0 4px 12px rgba(255, 107, 107, 0.3)"},title:{fontSize:"24px",fontWeight:"bold",color:"#a67c2d",margin:0,marginBottom:"5px"},subtitle:{fontSize:"14px",color:"#8c6b3b",margin:0},tabs:{display:"flex",borderBottom:"1px solid #d4af37",padding:"0 20px",gap:"20px",backgroundColor:"#f5ecd5",justifyContent:"center"},tab:{padding:"10px 28px",cursor:"pointer",fontSize:"15px",color:"#8c6b3b",border:"none",borderRadius:"18px 18px 0 0/22px 22px 0 0",background:"linear-gradient(90deg, #f5ecd5 60%, #e0c9a6 100%)",marginBottom:"-1px",boxShadow:"0 2px 8px rgba(191,167,106,0.08)",transition:"all 0.3s",outline:"none",fontWeight:500,borderBottom:"2.5px solid transparent"},tabActive:{color:"#a67c2d",background:"linear-gradient(90deg, #f9f5e6 60%, #f3e2c2 100%)",borderBottom:"2.5px solid #a67c2d",boxShadow:"0 4px 16px rgba(191,167,106,0.13)",fontWeight:700},content:{flex:1,overflowY:"auto",padding:"28px 24px",fontSize:"15px",lineHeight:"1.7",background:"linear-gradient(135deg, #fffbe9 0%, #f5ecd5 100%)",color:"#181818",borderRadius:"18px",boxShadow:"0 2px 12px rgba(191,167,106,0.10)",border:"1.5px solid #e0c9a6",margin:"18px 0 0 0"},section:{marginBottom:"15px"},sectionTitle:{color:"#d4af37",fontWeight:"bold",marginBottom:"8px",fontSize:"16px"},warningBox:{backgroundColor:"rgba(191, 167, 106, 0.13)",borderLeft:"4px solid #bfa76a",padding:"14px",borderRadius:"10px",marginBottom:"14px",color:"#7c5c2a",fontWeight:500},infoBox:{backgroundColor:"rgba(191, 167, 106, 0.09)",borderLeft:"4px solid #a67c2d",padding:"14px",borderRadius:"10px",marginBottom:"14px",color:"#5b4322",fontWeight:500},list:{marginLeft:"20px",marginTop:"8px"},listItem:{marginBottom:"6px",color:"#181818"},guide:{backgroundColor:"#fffbe9",border:"1px solid #e0c9a6",borderRadius:"10px",padding:"14px",fontSize:"14px",lineHeight:"1.7",color:"#181818",maxHeight:"300px",overflowY:"auto",marginBottom:"14px",whiteSpace:"pre-wrap",wordBreak:"break-word"},footer:{display:"flex",gap:"12px",padding:"20px",borderTop:"1px solid #333",justifyContent:"flex-end"},button:{padding:"10px 20px",borderRadius:"4px",border:"none",fontSize:"14px",fontWeight:"bold",cursor:"pointer",transition:"all 0.3s"},buttonPrimary:{backgroundColor:"#a67c2d",color:"#fff",minWidth:"120px"},buttonSecondary:{backgroundColor:"#e0c9a6",color:"#7c5c2a",border:"1px solid #d4af37"},buttonWarning:{backgroundColor:"#bfa76a",color:"#fff"},buttonCopy:{backgroundColor:o?"#bfa76a":"#e0c9a6",color:o?"#fff":"#7c5c2a",border:`1.5px solid ${o?"#bfa76a":"#a67c2d"}`,width:"100%"}};return r.jsx("div",{style:l.overlay,children:r.jsxs("div",{style:l.container,children:[r.jsxs("div",{style:l.header,children:[r.jsx("div",{style:l.warningBanner,children:" "}),r.jsx("h1",{style:l.title,children:" "}),r.jsx("p",{style:l.subtitle,children:""})]}),r.jsxs("div",{style:l.tabs,children:[r.jsx("button",{style:{...l.tab,...n==="warning"?l.tabActive:{}},onClick:()=>s("warning"),children:""}),r.jsx("button",{style:{...l.tab,...n==="guide"?l.tabActive:{}},onClick:()=>s("guide"),children:""})]}),r.jsxs("div",{style:l.content,children:[n==="warning"&&r.jsxs(r.Fragment,{children:[r.jsxs("div",{style:l.warningBox,children:[r.jsx("div",{style:l.sectionTitle,children:" "}),r.jsxs("p",{children:["",r.jsx("strong",{children:""})," "]})]}),r.jsxs("div",{style:l.section,children:[r.jsx("div",{style:l.sectionTitle,children:" "}),r.jsxs("ul",{style:l.list,children:[r.jsx("li",{style:l.listItem,children:""}),r.jsx("li",{style:l.listItem,children:""}),r.jsx("li",{style:l.listItem,children:""}),r.jsx("li",{style:l.listItem,children:""}),r.jsx("li",{style:l.listItem,children:""})]})]}),r.jsxs("div",{style:l.section,children:[r.jsx("div",{style:l.sectionTitle,children:" "}),r.jsxs("p",{children:["",r.jsx("strong",{children:'""'}),""]}),r.jsxs("p",{children:["",r.jsx("strong",{children:'""'}),""]})]}),r.jsxs("div",{style:l.infoBox,children:[r.jsx("div",{style:l.sectionTitle,children:" "}),r.jsxs("p",{children:["",r.jsx("strong",{children:""}),""]}),r.jsx("p",{children:'""'}),r.jsxs("p",{children:["  ",r.jsx("b",{children:"100000 "}),""]}),r.jsx("p",{style:{color:"#a67c2d",fontWeight:"bold"},children:""})]})]}),n==="guide"&&r.jsxs(r.Fragment,{children:[r.jsxs("div",{style:l.section,children:[r.jsx("div",{style:l.sectionTitle,children:" "}),r.jsx("p",{children:""})]}),r.jsx("div",{style:l.guide,children:'    bug    ""   1. "" 2. " " 3. " " 4.    1. "" 2. " " 3.  -   -   -   4.    -  - 100000    1.  2. Base64 3.  4.  '}),r.jsx("button",{style:{...l.button,...l.buttonCopy},onClick:a,children:o?" ":" "}),r.jsxs("div",{style:{...l.infoBox,marginTop:"15px"},children:[r.jsxs("p",{children:[" ",r.jsx("strong",{children:""})]}),r.jsxs("ul",{style:l.list,children:[r.jsx("li",{style:l.listItem,children:""}),r.jsx("li",{style:l.listItem,children:""}),r.jsx("li",{style:l.listItem,children:""}),r.jsx("li",{style:l.listItem,children:""})]})]})]})]}),r.jsxs("div",{style:l.footer,children:[r.jsx("button",{style:{...l.button,...l.buttonSecondary,...l.buttonWarning},onClick:t,children:""}),r.jsx("button",{style:{...l.button,...l.buttonPrimary},onClick:e,children:""})]})]})})},tC=({onComplete:e})=>{const[t,n]=y.useState(0),[s,o]=y.useState(!1);y.useEffect(()=>{const a=setInterval(()=>{n(l=>l>=100?(clearInterval(a),setTimeout(()=>{o(!0)},300),100):l+2)},30);return()=>clearInterval(a)},[]);const i=()=>{e()};return s?r.jsx("div",{style:Pt.overlay,children:r.jsxs("div",{style:Pt.warningContainer,children:[r.jsx("h2",{style:Pt.warningTitle,children:""}),r.jsxs("div",{style:Pt.warningContent,children:[r.jsx("p",{style:Pt.warningText,children:""}),r.jsx("p",{style:Pt.warningText,children:""}),r.jsx("p",{style:Pt.warningText,children:""}),r.jsx("p",{style:Pt.warningText,children:""})]}),r.jsx("button",{onClick:i,style:Pt.continueBtn,children:" "})]})}):r.jsx("div",{style:Pt.overlay,children:r.jsxs("div",{style:Pt.container,children:[r.jsx("h1",{style:Pt.title,children:""}),r.jsx("p",{style:Pt.subtitle,children:""}),r.jsxs("div",{style:Pt.progressContainer,children:[r.jsx("div",{style:Pt.progressBar,children:r.jsx("div",{style:{...Pt.progressFill,width:`${t}%`}})}),r.jsxs("p",{style:Pt.progressText,children:[t,"%"]})]}),r.jsx("p",{style:Pt.loadingText,children:"..."})]})})},Pt={overlay:{position:"fixed",top:0,left:0,width:"100%",height:"100%",background:"linear-gradient(135deg, #1a1a2e 0%, #16213e 100%)",zIndex:9999,display:"flex",justifyContent:"center",alignItems:"center"},container:{textAlign:"center",color:"white",padding:"40px",maxWidth:"600px",width:"90%"},title:{fontSize:"clamp(32px, 8vw, 48px)",marginBottom:"10px",color:"#d4af37",textShadow:"0 0 20px rgba(212, 175, 55, 0.5)",fontWeight:"bold",letterSpacing:"4px"},subtitle:{fontSize:"clamp(14px, 3vw, 18px)",color:"#ccc",marginBottom:"60px",letterSpacing:"2px"},progressContainer:{marginBottom:"30px"},progressBar:{width:"100%",height:"8px",background:"rgba(255, 255, 255, 0.1)",borderRadius:"4px",overflow:"hidden",marginBottom:"10px"},progressFill:{height:"100%",background:"linear-gradient(90deg, #d4af37 0%, #ffd700 100%)",transition:"width 0.3s ease",boxShadow:"0 0 10px rgba(212, 175, 55, 0.5)"},progressText:{fontSize:"14px",color:"#d4af37",fontWeight:"bold"},loadingText:{fontSize:"14px",color:"#888",animation:"pulse 1.5s ease-in-out infinite"},warningContainer:{background:"linear-gradient(135deg, #2d2d2d 0%, #1a1a1a 100%)",padding:"clamp(30px, 6vw, 50px)",borderRadius:"16px",maxWidth:"600px",width:"90%",border:"2px solid #d4af37",boxShadow:"0 20px 60px rgba(0, 0, 0, 0.8)"},warningTitle:{fontSize:"clamp(24px, 5vw, 32px)",color:"#d4af37",marginBottom:"30px",textAlign:"center",fontWeight:"bold"},warningContent:{marginBottom:"30px"},warningText:{fontSize:"clamp(14px, 3vw, 16px)",color:"#fff",lineHeight:"2",marginBottom:"10px",textAlign:"center"},continueBtn:{width:"100%",padding:"clamp(12px, 3vw, 15px)",background:"#d4af37",border:"none",borderRadius:"8px",color:"#1a1a1a",fontSize:"clamp(14px, 3vw, 16px)",fontWeight:"bold",cursor:"pointer",transition:"all 0.3s",boxShadow:"0 4px 15px rgba(212, 175, 55, 0.3)"}},nC=e=>{if(!e||!e.player)return e;const{player:t,children:n=[],activeNpcs:s=[],deadNpcs:o=[]}=e;return rC(t)?(console.warn(" ..."),sC(e)):e};function rC(e){const t=[];(!e.combatStats||typeof e.combatStats!="object")&&t.push("combatStats"),e.rival||t.push("rival"),e.time||t.push("time"),e.manuals!==void 0&&typeof e.manuals!="object"&&t.push("manuals");const n=t.length>=4;return n&&console.warn(" ",t),n}function sC(e){var f,b;const{player:t,children:n=[],activeNpcs:s=[],deadNpcs:o=[]}=e,i={name:t.name,age:t.age,gender:t.gender,avatar:t.avatar,tier:t.tier,currentExp:t.currentExp,maxExp:t.maxExp,time:t.time},a={spiritStones:((f=t.resources)==null?void 0:f.spiritStones)||0,money:((b=t.resources)==null?void 0:b.money)||0},l=t.affectionRecords||{},d=t.cultivationMethod||null,u=t.manuals||{},p={...i,resources:a,affectionRecords:l,cultivationMethod:d,manuals:u,compensationApplied:!0,compensationTime:new Date().toISOString()};let c=[];return p.resources.spiritStones=(p.resources.spiritStones||0)+1e5,console.log(" "),console.log(" 100000 "),console.log(" ",{cultivationMethod:d,manualsCount:Object.keys(u).length}),{...e,player:p,children:n||[],activeNpcs:Oh(s),deadNpcs:Oh(o),inventory:c,logs:[]}}function Oh(e){return Array.isArray(e)?e.map(t=>({id:t.id,name:t.name,personality:t.personality,identity:t.identity,affection:t.affection||0,favorabilityLevel:t.favorabilityLevel||0,...t})):[]}const oC=e=>e.compensationApplied?`

 100000 `:null,iC=({player:e,children:t,managerOptions:n=[],onBuy:s,onAssign:o})=>{var C;const[i,a]=y.useState({}),[l,d]=y.useState(new Set),[u,p]=y.useState(1),[c,f]=y.useState(1),b=5,S=5,E=[...n].sort((k,R)=>{var Y,H;const T=((Y=k.stats)==null?void 0:Y.intelligence)||k.intelligence||0;return(((H=R.stats)==null?void 0:H.intelligence)||R.intelligence||0)-T}),j=y.useCallback((k,R)=>{const T=Math.max(0,parseInt(R)||0);a(N=>{const Y={...N};return T===0?delete Y[k]:Y[k]=T,Y})},[]),x=y.useCallback(()=>{var Y,H,B,$;const k=Object.entries(i).filter(([q,se])=>se>0).map(([q,se])=>({biz:cl.find(X=>X.id===q),quantity:se}));if(k.length===0){(Y=window.showResult)==null||Y.call(window,"","",!1,null,!1);return}if(l.size===0){(H=window.showResult)==null||H.call(window,"","",!1,null,!1);return}const R=k.reduce((q,se)=>q+se.quantity,0);if(R>l.size){(B=window.showResult)==null||B.call(window,"",` ${R}  ${l.size} `,!1,null,!1);return}const T=Array.from(l).map(q=>E.find(se=>se.id===q));let N=0;k.forEach(({biz:q,quantity:se})=>{var J;for(let X=0;X<se;X++){if(T.length===0){(J=window.showResult)==null||J.call(window,"","",!1,null,!1);break}const re=Math.floor(Math.random()*T.length),ye=T[re];s(q,ye.id),N++,T.splice(re,1)}}),($=window.showResult)==null||$.call(window,"",` ${N} `,!0,null,!0),a({})},[i,l,E,s]),h=y.useCallback(()=>{const k={};cl.forEach(R=>{k[R.id]=1}),a(k)},[]),v=y.useCallback(()=>{a({})},[]),g=y.useCallback(k=>{d(R=>{const T=new Set(R);return T.has(k)?T.delete(k):T.add(k),T})},[]),I=y.useCallback(()=>{d(new Set(E.map(k=>k.id)))},[E]),_=y.useCallback(()=>{d(new Set)},[]);return r.jsxs("div",{style:{padding:"10px"},children:[r.jsx("h3",{children:" "}),r.jsxs("p",{style:{fontSize:"12px",color:"#666"},children:["",r.jsx("br",{}),": ",((C=e.businesses)==null?void 0:C.reduce((k,R)=>k+R.income,0))||0," "]}),r.jsx("h4",{children:" "}),r.jsx("div",{style:on.grid,children:cl.map(k=>r.jsxs("div",{style:on.card,children:[r.jsx("div",{style:{fontWeight:"bold"},children:k.name}),r.jsx("div",{style:{fontSize:"10px",color:"#555",height:"30px"},children:k.desc}),r.jsxs("div",{style:{fontSize:"12px",margin:"5px 0"},children:[": ",k.minTier," | : ",k.cost]}),r.jsxs("div",{style:{marginTop:"8px",display:"flex",alignItems:"center",gap:"6px"},children:[r.jsx("label",{style:{fontSize:"12px",fontWeight:"bold",color:"#666"},children:":"}),r.jsx("input",{type:"number",min:"0",max:"10",value:i[k.id]||0,onChange:R=>j(k.id,R.target.value),style:{width:"50px",padding:"4px",borderRadius:"4px",border:"1px solid #ccc",textAlign:"center",fontSize:"12px"}})]})]},k.id))}),r.jsx("hr",{style:{margin:"15px 0",borderColor:"#ddd"}}),r.jsx("h4",{children:" "}),r.jsxs("div",{style:on.batchBuyContainer,children:[r.jsxs("div",{style:on.batchControlRow,children:[r.jsx("button",{onClick:h,style:on.controlBtn,children:" (1)"}),r.jsx("button",{onClick:v,style:on.controlBtn,children:" "}),r.jsxs("span",{style:{fontSize:"13px",fontWeight:"bold",color:"#d32f2f"},children:[": ",Object.values(i).reduce((k,R)=>k+R,0)," "]})]}),r.jsxs("div",{style:on.purchaseInfo,children:[r.jsxs("div",{style:{fontSize:"12px",color:"#666",marginBottom:"8px"},children:[" : ",Object.keys(i).length," "]}),Object.keys(i).length>0&&r.jsx("div",{style:{maxHeight:"100px",overflowY:"auto",fontSize:"12px",background:"white",padding:"6px",borderRadius:"4px",border:"1px solid #e0e0e0"},children:Object.entries(i).filter(([k,R])=>R>0).map(([k,R])=>{const T=cl.find(N=>N.id===k);return r.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:"4px"},children:[r.jsx("span",{children:T==null?void 0:T.name}),r.jsxs("span",{style:{fontWeight:"bold",color:"#ff9800"},children:["",R]})]},k)})})]}),r.jsxs("div",{style:{...on.managerSelectContainer,marginBottom:"12px",marginTop:"12px"},children:[r.jsx("div",{style:{fontSize:"13px",fontWeight:"bold",marginBottom:"8px",color:"#333"},children:"  ()"}),r.jsxs("div",{style:on.batchControlRow,children:[r.jsx("button",{onClick:I,style:on.controlBtn,children:" "}),r.jsx("button",{onClick:_,style:on.controlBtn,children:" "}),r.jsxs("span",{style:{fontSize:"13px",fontWeight:"bold",color:"#1976d2"},children:[": ",l.size," / ",E.length]})]}),E.length===0?r.jsx("div",{style:{fontSize:"12px",color:"#999",padding:"10px"},children:""}):r.jsxs(r.Fragment,{children:[r.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(120px, 1fr))",gap:"8px",marginBottom:"10px"},children:E.slice((u-1)*b,u*b).map(k=>{var N;const R=l.has(k.id),T=((N=k.stats)==null?void 0:N.intelligence)||k.intelligence||0;return r.jsxs("label",{style:{...on.managerCheckbox,...R?on.managerCheckboxSelected:{}},children:[r.jsx("input",{type:"checkbox",checked:R,onChange:()=>g(k.id),style:{marginRight:"6px"}}),r.jsxs("div",{style:{flex:1},children:[r.jsx("div",{style:{fontSize:"12px",fontWeight:"bold",color:"#333"},children:k.name}),r.jsxs("div",{style:{fontSize:"11px",color:"#666"},children:[": ",T]})]})]},k.id)})}),Math.ceil(E.length/b)>1&&r.jsxs("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",gap:"8px",fontSize:"12px"},children:[r.jsx("button",{onClick:()=>p(Math.max(1,u-1)),disabled:u===1,style:{padding:"4px 8px",borderRadius:"4px",border:"1px solid #ccc",background:u===1?"#f0f0f0":"#fff",cursor:u===1?"not-allowed":"pointer",opacity:u===1?.6:1},children:""}),r.jsxs("span",{style:{color:"#666"},children:[u," / ",Math.ceil(E.length/b)]}),r.jsx("button",{onClick:()=>p(Math.min(Math.ceil(E.length/b),u+1)),disabled:u===Math.ceil(E.length/b),style:{padding:"4px 8px",borderRadius:"4px",border:"1px solid #ccc",background:u===Math.ceil(E.length/b)?"#f0f0f0":"#fff",cursor:u===Math.ceil(E.length/b)?"not-allowed":"pointer",opacity:u===Math.ceil(E.length/b)?.6:1},children:""})]})]})]}),r.jsx("button",{onClick:x,disabled:Object.values(i).reduce((k,R)=>k+R,0)===0,style:{...on.batchPurchaseBtn,...Object.values(i).reduce((k,R)=>k+R,0)===0?on.batchPurchaseBtnDisabled:{}},children:" "}),l.size>0&&r.jsxs("div",{style:{fontSize:"12px",color:"#666",marginTop:"8px",padding:"8px",background:"white",borderRadius:"4px",border:"1px solid #e0e0e0"},children:["  ",l.size," "]})]}),r.jsx("hr",{style:{margin:"15px 0",borderColor:"#ddd"}}),r.jsx("h4",{children:" "}),r.jsx("div",{style:{marginBottom:"20px"},children:!e.businesses||e.businesses.length===0?r.jsx("div",{style:{fontSize:"12px",color:"#999",padding:"10px"},children:""}):r.jsx(r.Fragment,{children:r.jsx("div",{style:{marginBottom:"10px"},children:(()=>{const k=e.businesses.length,R=Math.ceil(k/S),T=(c-1)*S,N=Math.min(T+S,k),Y=e.businesses.slice(T,N);return r.jsxs(r.Fragment,{children:[Y.map((H,B)=>{const $=t.find(q=>q.id===H.managerId);return r.jsxs("div",{style:on.bizCard,children:[r.jsx("div",{style:{fontWeight:"bold"},children:H.name}),r.jsxs("div",{style:{fontSize:"12px"},children:[": ",$?$.name:r.jsx("span",{style:{color:"red"},children:""}),$&&` (:${$.stats.intelligence})`]}),r.jsxs("div",{style:{color:"#2e7d32"},children:[": ",H.income]})]},B)}),R>1&&r.jsxs("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",gap:"8px",marginTop:"10px",fontSize:"12px"},children:[r.jsx("button",{onClick:()=>f(Math.max(1,c-1)),disabled:c===1,style:{padding:"4px 8px",borderRadius:"4px",border:"1px solid #ccc",background:c===1?"#f0f0f0":"#fff",cursor:c===1?"not-allowed":"pointer",opacity:c===1?.6:1},children:""}),r.jsxs("span",{style:{color:"#666"},children:[c," / ",R]}),r.jsx("button",{onClick:()=>f(Math.min(R,c+1)),disabled:c===R,style:{padding:"4px 8px",borderRadius:"4px",border:"1px solid #ccc",background:c===R?"#f0f0f0":"#fff",cursor:c===R?"not-allowed":"pointer",opacity:c===R?.6:1},children:""}),r.jsxs("span",{style:{color:"#999",marginLeft:"8px"},children:[" ",k," "]})]})]})})()})})})]})},on={grid:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"10px"},card:{border:"1px solid #ddd",padding:"10px",borderRadius:"8px",background:"white"},bizCard:{border:"1px solid #81c784",background:"#e8f5e9",padding:"10px",borderRadius:"8px",marginBottom:"5px"},batchBuyContainer:{background:"#f5f5f5",padding:"12px",borderRadius:"8px",border:"1px solid #e0e0e0",marginBottom:"15px"},batchControlRow:{display:"flex",gap:"8px",alignItems:"center",marginBottom:"12px",flexWrap:"wrap"},controlBtn:{padding:"6px 12px",fontSize:"12px",border:"1px solid #999",borderRadius:"4px",background:"#fff",cursor:"pointer",fontWeight:"bold"},purchaseInfo:{background:"white",padding:"8px",borderRadius:"4px",border:"1px solid #e0e0e0",marginBottom:"10px"},batchPurchaseBtn:{width:"100%",padding:"10px",background:"#2196f3",color:"white",border:"none",borderRadius:"4px",fontWeight:"bold",cursor:"pointer",fontSize:"14px"},batchPurchaseBtnDisabled:{background:"#ccc",cursor:"not-allowed"},managerSelectContainer:{background:"#e3f2fd",padding:"12px",borderRadius:"8px",border:"1px solid #90caf9"},managerCheckbox:{display:"flex",alignItems:"center",gap:"6px",padding:"8px",backgroundColor:"white",borderRadius:"6px",border:"1px solid #ddd",cursor:"pointer",transition:"all 0.2s",fontSize:"12px"},managerCheckboxSelected:{borderColor:"#1976d2",background:"#e3f2fd",boxShadow:"0 0 4px rgba(25, 118, 210, 0.3)"}},aC=wc.memo(iC),lC=({player:e,children:t,onChallenge:n})=>{const[s,o]=y.useState(null),[i,a]=y.useState([]),l=t.filter(p=>p.age>=16),d=p=>{if(i.includes(p))a(c=>c.filter(f=>f!==p));else{if(i.length>=3){window.showResult&&window.showResult("","3",!1,null,!1);return}a(c=>[...c,p])}},u=$l(e)+i.reduce((p,c)=>{const f=l.find(b=>b.id===c);return p+(f?$l(f):0)},0);return r.jsx("div",{style:{padding:"10px"},children:s?r.jsxs("div",{children:[r.jsx("button",{onClick:()=>o(null),children:" "}),r.jsxs("h3",{children:[" ",s.name]}),r.jsx("p",{children:s.desc}),r.jsxs("div",{style:ao.statBox,children:[r.jsxs("div",{children:[": ",s.recommendCP]}),r.jsxs("div",{children:[": ",r.jsx("span",{style:{color:u>=s.recommendCP?"green":"red"},children:u})]}),r.jsxs("div",{children:[": ",(s.risk*100).toFixed(0),"%"]})]}),r.jsx("h4",{children:" (3)"}),r.jsx("div",{style:ao.list,children:l.map(p=>r.jsxs("div",{onClick:()=>d(p.id),style:{...ao.fighterRow,background:i.includes(p.id)?"#ffe0b2":"white"},children:[r.jsxs("span",{children:[p.name," (",p.tierTitle,")"]}),r.jsxs("span",{children:["CP: ",$l(p)]})]},p.id))}),r.jsxs("button",{style:ao.startBtn,onClick:()=>n(s,i),children:[" ( ",s.cost," )"]})]}):r.jsxs("div",{children:[r.jsx("h3",{children:" "}),r.jsx("p",{style:{fontSize:"12px",color:"#666"},children:""}),r.jsx("div",{style:ao.list,children:Iy.map(p=>r.jsxs("div",{onClick:()=>o(p),style:ao.realmCard,children:[r.jsx("div",{style:{fontWeight:"bold"},children:p.name}),r.jsxs("div",{style:{fontSize:"12px",color:"#d81b60"},children:[": ",p.reqTier]}),r.jsxs("div",{style:{fontSize:"12px"},children:[": ",p.cost]})]},p.id))})]})})},ao={list:{display:"flex",flexDirection:"column",gap:"8px",maxHeight:"300px",overflowY:"auto"},realmCard:{border:"1px solid #ddd",padding:"15px",borderRadius:"8px",cursor:"pointer",background:"white",display:"flex",justifyContent:"space-between",alignItems:"center"},fighterRow:{padding:"10px",borderBottom:"1px solid #eee",display:"flex",justifyContent:"space-between",cursor:"pointer"},statBox:{background:"#eee",padding:"10px",borderRadius:"5px",margin:"10px 0",fontSize:"14px"},startBtn:{width:"100%",padding:"15px",background:"#d32f2f",color:"white",border:"none",borderRadius:"8px",fontSize:"16px",marginTop:"20px",cursor:"pointer"}},cC={LEVEL_UP:[" {actor} {detail}","{actor} {detail}","{actor} {detail}","{actor} {detail}"],NPC_BREAKTHROUGH:[" {actor} {detail}"," {actor} {detail}","{actor} {detail}"],BREAKTHROUGH_FAIL:["{actor} {detail}","{actor} {detail}","{actor} {detail}"],MARRIAGE:["{actor}  {target} ","{actor}  {target} ","{actor}  {target} ","{actor}  {target} ","{actor}{target}/","{target}{actor}","{actor}{target}","{actor}{target}"],BIRTH:["{actor}  {target}","{actor}  {target}","{actor}  {target} "],DEATH:["{actor}  {location} ","{actor}  {detail} ","{actor} "],COMBAT:["{actor}  {location}  {target}","{actor}  {target}  {actor} "," {actor}  {location}  {target}","{location}{actor}{target}{actor}","{actor}{target}","{actor}{target}{location}"],JOIN_SECT:["{actor}  {target}  {detail} ","{target}  {detail}","{target}  {detail} "],GRANDCHILD:["{actor} ","{actor} {detail}"],EXPLORATION:["{actor}  {location}  {detail}"," {actor}  {location}"],FILLER:["","","","","","","","","","","","30%","","","","''","''","","","''","","","",""],RIVAL_RISE:["{actor}","{actor}{detail}''"],RIVAL_BREAKTHROUGH:["{actor}{tier}","{actor}{tier}","{actor}{tier}"],RIVAL_ENGAGED:["{actor}{target}","{target}{actor}"],RIVAL_MARRIAGE:["{target}{actor}","{actor}{target}{target}"],RIVAL_HEIR:["{actor}{target}","{actor}"],RIVAL_STAGE_EVENT:["{actor}{stageTitle}{description}","{actor}{stageTier}{description}","{actor}{stageRole}{description}"],REVENGE_STAGE_ADVANCE:["{actor}{clearedStage}{nextStage}","{actor}{clearedStage}","{actor}{clearedStage}"],REVENGE_SAGA_COMPLETE:["{actor}{finalTarget}","{actor}{finalTarget}","{actor}{finalTarget}"],REVENGE_DUEL_FAILED:["{actor}{rival}","{actor}{rival}","{stageTitle}{actor}"],RIVAL_LIGHT_RUMOR:["{actor}","{actor}''","{actor}"],RIVAL_HEAVY_RUMOR:["{actor}","{actor}","{actor}"],RIVAL_THREAT_MEDIUM:["{playerName}","{actor}..."],RIVAL_THREAT_HIGH:["{actor}''","{actor}"],RIVAL_THREAT_CRITICAL:["","{actor}","..."],RIVAL_HIDE_SUCCESS:["{actor}","{actor}{months}","{actor}"],ASSASSINATION_SURVIVED:["{actor}","{actor}","{actor}"],ASSASSINATION_INJURED:["{actor}","{actor}","{actor}"],RIVAL_DEFEATED:["{target}{actor}","{actor}{target}","{target}...{actor}"],RIVAL_VICTORY:["{target}{actor}","{target}{actor}"],NPC_AFFECTION_HIGH:["{actor}{target}","{target}{actor}","{actor}{target}"],NPC_JEALOUSY:["{actor}{target}{rival}","{actor}{target}","{actor}{target}'{rival}'","{actor}{rival}{target}"],SHURA_FIELD:["{actor}{participants}","{dominant}{rival}{actor}","{actor}{count}"],DUAL_CULTIVATION:["{actor}{target}","{actor}{target}","{actor}{target}"],NPC_PURSUIT:["{actor}{target}{target}","{actor}{target}","{target}{actor}","{actor}{target}"],NPC_ANGRY:["{actor}{target}{target}''","{actor}{target}","{target}{actor}''{actor}"],CHILD_TALENT:["{actor}{target}","{target}{actor}","{actor}{target}"],SECT_PROMOTION:["{actor}","{actor}{detail}","{actor}"],TREASURE_FIND:["{actor}{detail}","{actor}","{actor}{detail}"],RETREAT:["{actor}{detail}","{actor}","{actor}"],TOURNAMENT:["{actor}","{actor}''","{target}{actor}"],INJURED:["{actor}{target}","{actor}{target}","{actor}"],APPRENTICE:["{actor}{target}","{target}{actor}","{actor}{detail}"]};function lo(e,t){const n=cC[e];if(!n||n.length===0)return null;let o=n[Math.floor(Math.random()*n.length)];return Object.keys(t).forEach(i=>{const a=`{${i}}`;o=o.replace(new RegExp(a,"g"),t[i])}),o}function dC(e,t){const n=[],s=new Set,o=i=>i?typeof i.status=="string"?i.status!=="DEAD":typeof i.isDead=="boolean"?!i.isDead:!0:!1;return n.push({name:t.name,cultivation:t.currentExp||0,tier:t.tier||"",isPlayer:!0}),s.add(t.name),t.worldNpcs&&t.worldNpcs.length>0&&t.worldNpcs.filter(o).forEach(i=>{s.has(i.name)||(n.push({name:i.name,title:i.title,cultivation:i.currentExp||0,tier:i.tier||"",isPlayer:!1,worldNpcData:i}),s.add(i.name))}),e&&e.length>0&&e.filter(o).forEach(i=>{s.has(i.name)||(n.push({name:i.name,cultivation:i.currentExp||0,tier:i.tier||"",isPlayer:!1}),s.add(i.name))}),n.sort((i,a)=>{if(a.cultivation!==i.cultivation)return a.cultivation-i.cultivation;const l=["","","","","","","","","",""];return l.indexOf(i.tier)-l.indexOf(a.tier)}),n.slice(0,3).map((i,a)=>{const l=["","",""],d=i.isPlayer?"":"",u=i.title?`${i.title}`:"";return{displayText:`${l[a]} ${d}${u}${i.name} - ${i.tier}`,name:i.name,title:i.title,tier:i.tier,isPlayer:i.isPlayer,worldNpcData:i.worldNpcData}})}const ma=50,lu=(e=[])=>Array.isArray(e)?e.length<=ma?e:e.slice(-ma):[];function uC(e){if(!Array.isArray(e)||e.length===0)return e;const t=e.filter(o=>o.type==="MARRIAGE"||o.type==="RIVAL_MARRIAGE"),n=e.filter(o=>o.type==="BIRTH"||o.type==="GRANDCHILD"||o.type==="RIVAL_HEIR");return t.length===0||n.length===0?e:e.filter(o=>{var i;if(o.type==="BIRTH"||o.type==="GRANDCHILD"||o.type==="RIVAL_HEIR"){const a=(i=o.data)==null?void 0:i.actor,l=o.timestamp||Date.now();if(a){const d=t.filter(u=>{var p,c;return((p=u.data)==null?void 0:p.actor)===a||((c=u.data)==null?void 0:c.target)===a});for(const u of d){const p=u.timestamp||Date.now(),c=(l-p)/(1e3*60*60*24*30);if(c>=0&&c<12)return!1}}}return!0})}function pC(e,t,n,s){var h,v;const o=[],i=[];if(t.rival){const g=jC(t.rival);if(g){const I=lo(g.type,g.data);I&&o.unshift(I)}}e.filter(g=>g.type==="RIVAL_BREAKTHROUGH").forEach(g=>{const I=lo(g.type,g.data);I&&o.unshift(I)});const l=[];let d=[];e.forEach(g=>{g.type.startsWith("RIVAL_")?l.push(g):d.push(g)}),d=uC(d),l.forEach(g=>{const I=lo(g.type,g.data);I&&o.push(I)});const u=[],p=[];d.forEach(g=>{g.data.actor===t.name||g.data.target===t.name||g.type==="LEVEL_UP"||g.type==="MARRIAGE"||g.type==="BIRTH"||g.type==="COMBAT"?u.push(g):p.push(g)});const c=8,f=Math.ceil(c*.25),b=Math.ceil(c*.75);let S=0;u.forEach(g=>{if(S<f){const I=lo(g.type,g.data);I&&(o.push(I),S++)}}),p.forEach(g=>{const I=lo(g.type,g.data);I&&(o.length<5?o.push(I):i.push(I))});const E=o.length+i.length,j=Math.max(0,b-(E-S));for(let g=0;g<j;g++){const I=lo("FILLER",{});o.length<5?o.push(I):i.push(I)}const x=dC(n,t);return{issue:s,year:((h=t.time)==null?void 0:h.year)||t.age||0,month:((v=t.time)==null?void 0:v.month)||t.month||1,headlines:o,rumors:i,powerRanking:x,timestamp:Date.now()}}function fC(e,t,n,s,o){return pC(e,t,n,s)}function zt(e,t,n){Array.isArray(e)&&(e.push({type:t,data:n,timestamp:Date.now()}),e.length>ma&&e.splice(0,e.length-ma))}let zs=1.3;const r1={aptitude:92,looks:95,intelligence:90,health:85,cunning:88};var sg;const cu={type:"",name:"",multiplier:((sg=Mn==null?void 0:Mn.SINGLE)==null?void 0:sg.multiplier)||1.8,elements:[""]},mC={id:"CHU_CLAN",name:"",level:"HIGH"},hC={name:"",bonuses:{speedMultiplier:1.15}},Lf=e=>{if(!e)return e;e.stats={...r1,...e.stats||{}};const t=e.spiritRoot||cu;e.spiritRoot={...cu,...t,elements:Array.isArray(t.elements)?[...t.elements]:[...cu.elements]},e.sect=e.sect?{...e.sect}:{...mC};const n=e.trait||hC;return e.trait={...n,bonuses:n.bonuses?{...n.bonuses}:void 0},e},bc=(e,t=e==null?void 0:e.tier)=>{if(!e)return;const n=Cn(t||(e==null?void 0:e.tier));n!=null&&n.maxExp&&(e.maxExp=n.maxExp)},gC=e=>{const t=Math.min(.8,((e==null?void 0:e.baseThreat)||0)/100),n=(e==null?void 0:e.powerMultiplier)||1;return 1+t+(n-1)*.5},xC=(e,t,n=!1)=>{if(!e)return 0;Lf(e),bc(e);const s=Dc({...e,stats:e.stats,spiritRoot:e.spiritRoot,trait:e.trait,sect:e.sect},n)||0,o=n?1.8:1,i=gC(t),a=Math.max(n?10:120,Math.floor(s*i*o*zs));return e.currentExp=Math.max(0,(e.currentExp||0)+a),a},$f=e=>(e.revengeProgress||(e.revengeProgress={currentStageIndex:0,completedStages:[],sagaComplete:!1}),Array.isArray(e.revengeProgress.completedStages)||(e.revengeProgress.completedStages=[]),e.revengeProgress),yC=e=>(Array.isArray(e.newsBuffer)||(e.newsBuffer=[]),e.newsBuffer),s1=(e,t,{resetProgress:n=!0}={})=>{const s=e.rival||{},o=typeof t.baseThreat=="number"?t.baseThreat:0,i=Cn(t.tier);return e.rival={...s,name:t.name,stageId:t.id,tier:t.tier,maxExp:(i==null?void 0:i.maxExp)||s.maxExp||t.baseExp,state:n?"NORMAL":s.state||"NORMAL",lifeStage:n?0:s.lifeStage||0,storyTimer:n?0:s.storyTimer||0,isDead:n?!1:s.isDead||!1,rumorCount:n?0:s.rumorCount||0,threatLevel:n?o:s.threatLevel??o,hiddenTurns:0,currentExp:t.baseExp,stats:{...r1,...s.stats||{}},combatStats:{...s.combatStats||{},hp:t.combatStats.hp,maxHp:t.combatStats.maxHp,atk:t.combatStats.atk,def:t.combatStats.def}},Lf(e.rival),bc(e.rival,t.tier),e.rival},Ko=e=>{const t=$f(e),n=dc(t.currentStageIndex||0);return!e.rival||e.rival.stageId!==n.id?s1(e,n,{resetProgress:!0}):e.rival};function bC(e,t=50){const n=Ko(e);if(e.resources.spiritStones<t)return{success:!1,message:""};const s=e.time.year*12+e.time.month;if(e.revengeActions.lastRumorMonth===s)return{success:!1,message:""};e.resources.spiritStones=Math.max(0,e.resources.spiritStones-t);const o=Math.min(.9,.6+t/200);if(!(Math.random()<o))return n.threatLevel=Math.min(100,n.threatLevel+15),e.revengeActions.lastRumorMonth=s,{success:!0,effectType:"FAILED",message:`${n.name}...`,threatIncrease:15};let a="",l=0;return t>=100?(a="HEAVY",l=200,n.state="FURIOUS",n.threatLevel=Math.min(100,n.threatLevel+25),n.currentExp=Math.max(0,n.currentExp-l),n.rumorCount+=2):(a="LIGHT",l=100,n.state="ANXIOUS",n.threatLevel=Math.min(100,n.threatLevel+10),n.currentExp=Math.max(0,n.currentExp-l),n.rumorCount+=1),e.revengeActions.lastRumorMonth=s,e.revengeActions.totalRumors+=1,{success:!0,effectType:a,message:a==="HEAVY"?`${n.name}`:`${n.name}...`,damage:l,threatIncrease:a==="HEAVY"?25:10,newsEvent:{type:a==="HEAVY"?"RIVAL_HEAVY_RUMOR":"RIVAL_LIGHT_RUMOR",data:{actor:n.name,rumorCount:n.rumorCount}}}}function vC(e,t=1,n=30){const s=Ko(e),o=t*n;if(e.resources.spiritStones<o)return{success:!1,message:`${t}${o}`};e.resources.spiritStones=Math.max(0,e.resources.spiritStones-o);const i=40*t;return s.threatLevel=Math.max(0,s.threatLevel-i),s.threatLevel<30&&(s.state="NORMAL"),s.hiddenTurns=t,e.revengeActions.hidingMonths+=t,{success:!0,message:`${t}${s.name}`,threatReduction:i,months:t,newsEvent:{type:"RIVAL_HIDE_SUCCESS",data:{actor:s.name,months:t}}}}function SC(e){const t=Ko(e),n=$f(e),s=dc(n.currentStageIndex||0),o=yC(e);if(e.tier==="")return{success:!1,message:`${t.name}`};const a=ms(e).total,l=ms(t),d=(s==null?void 0:s.powerMultiplier)??1,u=Math.floor(l.total*zs*d),p=1-t.rumorCount*.05,c=u*Math.max(.5,p),f=a/(a+c),b=Math.random()<f;if(console.log(":",{:s==null?void 0:s.name,:a,:l.total,:Math.floor(c),:d,:`${t.rumorCount} (-${t.rumorCount*5}%)`,:`${(f*100).toFixed(1)}%`,:b?"":""}),b){const S=n.currentStageIndex>=Ml;if(t.isDead=!0,t.state="DEAD",t.threatLevel=0,n.completedStages.includes(s.id)||n.completedStages.push(s.id),S)return n.sagaComplete=!0,n.currentStageIndex=Ml,console.log("[] REVENGE_SAGA_COMPLETE"),zt(o,"REVENGE_SAGA_COMPLETE",{actor:e.name,finalTarget:t.name}),{success:!0,victory:!0,sagaComplete:!0,message:(s==null?void 0:s.defeatLog)||`${t.name}...`,playerPower:a,rivalPower:Math.floor(c),newsEvent:{type:"RIVAL_DEFEATED",data:{actor:e.name,target:t.name}}};const E=Math.min(n.currentStageIndex+1,Ml);n.currentStageIndex=E;const j=dc(E);return s1(e,j,{resetProgress:!0}),console.log("[] REVENGE_STAGE_ADVANCERIVAL_DEFEATED"),zt(o,"REVENGE_STAGE_ADVANCE",{actor:e.name,clearedStage:s.name,nextStage:j.name}),zt(o,"RIVAL_DEFEATED",{actor:e.name,target:t.name}),{success:!0,victory:!0,stageCleared:s.id,nextStageUnlocked:!0,nextStage:j,message:(s==null?void 0:s.defeatLog)||`${t.name}`,transitionLog:s==null?void 0:s.unlockNextLog,playerPower:a,rivalPower:Math.floor(c),newsEvent:{type:"RIVAL_DEFEATED",data:{actor:e.name,target:t.name}}}}else return e.combatStats.hp=Math.max(1,e.combatStats.hp*.3),e.currentExp=0,e.resources.spiritStones=Math.floor(e.resources.spiritStones*.5),e.stats.health=Math.max(10,e.stats.health*.2),zt(o,"REVENGE_DUEL_FAILED",{actor:e.name,rival:t.name,stageTitle:s==null?void 0:s.title}),{success:!0,victory:!1,message:`${t.name}...`,playerPower:a,rivalPower:Math.floor(c),newsEvent:{type:"RIVAL_VICTORY",data:{actor:t.name,target:e.name}}}}function wC(e){const t=Ko(e);if(t.hiddenTurns>0)return t.hiddenTurns-=1,null;if(t.threatLevel>=100){const n="",s=e.combatStats=e.combatStats||{},o=s.hp??s.maxHp??100,i=s.maxHp||Math.max(100,o),a=.3+e.stats.cunning/200,l=Math.random()<a,d=Math.floor(i*.4),u=Math.floor(i*.75);return e.revengeActions=e.revengeActions||{},e.revengeActions.assassinationAttempts=(e.revengeActions.assassinationAttempts||0)+1,l?(e.combatStats.hp=Math.max(10,o-d),t.threatLevel=Math.max(35,t.threatLevel-35),{type:"ASSASSINATION_SURVIVED",survived:!0,message:`${n}`,hpLoss:d}):(e.combatStats.hp=Math.max(5,o-u),e.currentExp=Math.max(0,Math.floor(e.currentExp*.6)),t.threatLevel=Math.max(40,t.threatLevel-45),{type:"ASSASSINATION_INJURED",survived:!1,message:`${n}`,hpLoss:u})}return null}function kC(e){const t=Ko(e),n=$f(e),s=dc(n.currentStageIndex||0);if(Lf(t),bc(t),t.isDead)return null;xC(t,s),t.storyTimer=(t.storyTimer||0)+1;const o=(s==null?void 0:s.storyBeats)||[],i=t.lifeStage||0,a=o[i];if(!a)return null;const l=Math.max(1,a.delay||1);if(t.storyTimer<l||!(!(typeof a.exp=="number")||(t.currentExp||0)>=a.exp*.95))return null;if(t.lifeStage=i+1,t.storyTimer=0,a.tier&&(t.tier=a.tier,bc(t,a.tier)),typeof a.exp=="number"){const c=Math.floor(a.exp*zs);t.currentExp=Math.max(t.currentExp,c)}const p={actor:t.name,detail:a.detail||a.tier||(s==null?void 0:s.title),target:a.target,stageTitle:s==null?void 0:s.title,stageRole:s==null?void 0:s.role,stageTier:a.tier||(s==null?void 0:s.tier),description:a.description};return Object.keys(p).forEach(c=>{(p[c]===void 0||p[c]===null)&&delete p[c]}),{type:a.type||"RIVAL_STAGE_EVENT",data:p}}function EC(e){const t=Ko(e);if(t.isDead||t.hiddenTurns>0)return 0;const n=Math.ceil(2*zs);let s=1;return t.threatLevel>=60?s=1.5*zs:t.threatLevel>=30&&(s=1.2*zs),Math.ceil(n*s)}function jC(e){return e.isDead?null:e.threatLevel>=80?{type:"RIVAL_THREAT_CRITICAL",data:{actor:e.name}}:e.threatLevel>=60?{type:"RIVAL_THREAT_HIGH",data:{actor:e.name}}:e.threatLevel>=30?{type:"RIVAL_THREAT_MEDIUM",data:{actor:e.name,playerName:""}}:null}const CC={currentStageIndex:0,completedStages:[],sagaComplete:!1},TC={lastRumorMonth:0,totalRumors:0,assassinationAttempts:0,hidingMonths:0},IC=e=>e&&{...e,resources:{...e.resources||{}},rival:e.rival?{...e.rival,stats:{...e.rival.stats||{}},combatStats:{...e.rival.combatStats||{}},revengeProgress:e.rival.revengeProgress?{...e.rival.revengeProgress}:void 0}:e.rival,revengeActions:{...TC,...e.revengeActions||{}},revengeProgress:e.revengeProgress?{...e.revengeProgress,completedStages:Array.isArray(e.revengeProgress.completedStages)?[...e.revengeProgress.completedStages]:[]}:{...CC},newsBuffer:Array.isArray(e.newsBuffer)?[...e.newsBuffer]:[],combatStats:e.combatStats?{...e.combatStats}:e.combatStats},_C=({player:e,setPlayer:t,addLog:n})=>{var ye,Re,Fe,O;const[s,o]=y.useState(50),[i,a]=y.useState(1),[l,d]=y.useState(null),[u,p]=y.useState(null),[c,f]=y.useState(!1),b=i*30,S=y.useMemo(()=>c?"":e!=null&&e.resources?e.resources.spiritStones<b?`${i}${b}`:"":"",[c,e==null?void 0:e.resources,(ye=e==null?void 0:e.resources)==null?void 0:ye.spiritStones,b,i]),E=!S,j=y.useCallback((ie,...le)=>{const ee=IC(e),he=ie(ee,...le);return console.log(" [executeRevengeAction] :",he),he!=null&&he.success&&t(ee),he},[e,t]),x=y.useCallback((ie,le=5e3)=>{ie&&(d(ie),setTimeout(()=>d(null),le))},[]),h=e.rival||{name:"",state:"NORMAL",lifeStage:0,threatLevel:0,rumorCount:0,isDead:!1,tier:"",currentExp:300},v=e.revengeProgress||{currentStageIndex:0,sagaComplete:!1},g=Math.min(v.currentStageIndex||0,fa.length-1),I=fa[g],_=!!v.sagaComplete,C=_?"":"",k=ms(e).total,R=ms(h).total,T=Math.max(.5,1-h.rumorCount*.05),N=zs*((I==null?void 0:I.powerMultiplier)||1),Y=Math.floor(R*N*T),H=(ie,le=50)=>Math.floor((ie??le)*T*N),B=ie=>ie>=80?"#ff4444":ie>=60?"#ff8800":ie>=30?"#ffbb00":"#44ff44",$=ie=>ie>=80?"":ie>=60?"":ie>=30?"":"",q=ie=>({NORMAL:"",ANXIOUS:"",FURIOUS:"",DEAD:""})[ie]||"",se=y.useCallback(()=>{if(c)return;f(!0);const ie=Math.floor(R*N*T),le=j(bC,s);if(le!=null&&le.success&&le.effectType!=="FAILED"){const ee=Math.max(.5,1-(h.rumorCount+(s>=100?2:1))*.05),he=Math.floor(R*N*ee),Ee=ie-he;le.actualPowerLoss=Ee}x(le),f(!1)},[j,x,c,s,R,N,T,h.rumorCount]),J=y.useCallback(()=>{if(!E){x({success:!1,message:S});return}f(!0);const ie=j(vC,i,30);x(ie),f(!1)},[E,j,S,i,x]),X=()=>{var le,ee;if(console.log("handleDuel:",e.tier),console.log(":",e),!Tf(e).canDuel){if(((le=e.stats)==null?void 0:le.health)<20){window.showResult?window.showResult(" ",`${Math.floor(e.stats.health)}/100`,!1,null,!1):p({title:" ",message:`${Math.floor(e.stats.health)}/100`});return}else if(((ee=e.stats)==null?void 0:ee.health)<30&&window.showConfirm){window.showConfirm(` 30${Math.floor(e.stats.health)}/100`,()=>{re()});return}}re()},re=()=>{const ie=h.name,le=(I==null?void 0:I.title)||"";window.showConfirm&&window.showConfirm(`${le}${ie}`,()=>{const ee=j(SC);if(console.log(" [RevengePanel] :",ee),ee!=null&&ee.success)if(console.log("  - :",ee.victory),ee.victory){const he=ee.sagaComplete?" ":` ${ie}`,Ee=ee.message||`${ie}`;if(console.log(" :",he),x({success:!0,message:Ee,transitionLog:ee.transitionLog,nextStage:ee.nextStage,sagaComplete:ee.sagaComplete},ee.sagaComplete?8e3:6e3),p({title:he,message:Ee,type:"victory"}),window.showResult&&typeof window.showResult=="function"?window.showResult(he,Ee,!0,null,!1):(console.warn(" window.showResult "),p({title:he,message:Ee,type:"victory"})),n){const _e=ee.sagaComplete?` ${ie}`:` ${ie}${I==null?void 0:I.title}`;n(_e,"","")}}else{const he=ee.message||`${ie}...`;if(console.log(" :"," ",he),console.log(" window.showResult :",{exists:!!window.showResult,isFunction:typeof window.showResult=="function"}),x({success:!1,message:he,damage:"",newsEvent:ee.newsEvent},6e3),p({title:" ",message:he,type:"defeat"}),window.showResult&&typeof window.showResult=="function")try{console.log("  window.showResult"),window.showResult(" ",he,!1,null,!1)}catch(Ee){console.error(" window.showResult :",Ee),p({title:" ",message:he,type:"defeat"})}else console.warn(" window.showResult "+typeof window.showResult+""),p({title:" ",message:he,type:"defeat"});n&&n(` ${ie}`,"","")}else{console.error(" :",ee);const he=ee&&ee.message||`${ie}`;window.showResult&&typeof window.showResult=="function"?window.showResult(" ",he,!1,null,!1):p({title:" ",message:he})}})};return h.isDead&&_?r.jsx("div",{style:Ce.panel,children:r.jsxs("div",{style:Ce.completed,children:[r.jsx("h2",{children:"  "}),r.jsxs("p",{children:[h.name,""]}),r.jsx("p",{children:"..."})]})}):r.jsxs("div",{style:Ce.panel,children:[r.jsxs("div",{style:Ce.header,children:[r.jsx("h2",{style:Ce.title,children:" "}),r.jsxs("p",{style:Ce.subtitle,children:["",h.name]})]}),r.jsxs("div",{style:Ce.stageNarrative,children:[r.jsxs("div",{style:Ce.stageFocusHeader,children:[r.jsxs("span",{style:Ce.stageBadge,children:["",g+1,""]}),r.jsx("span",{style:Ce.stageStatus,children:C})]}),r.jsx("div",{style:Ce.stageFocusName,children:h.name}),r.jsx("div",{style:Ce.stageFocusTitle,children:(I==null?void 0:I.title)||""}),r.jsx("p",{style:Ce.stageNarrativeText,children:(I==null?void 0:I.flavor)||""}),_&&r.jsx("p",{style:Ce.stageNarrativeNext,children:""})]}),r.jsxs("div",{style:Ce.rivalStatus,children:[r.jsx("h3",{style:Ce.sectionTitle,children:""}),r.jsxs("div",{style:Ce.statusGrid,children:[r.jsxs("div",{style:Ce.statusItem,children:[r.jsx("span",{style:Ce.statusLabel,children:""}),r.jsx("span",{style:Ce.statusValue,children:h.tier})]}),r.jsxs("div",{style:Ce.statusItem,children:[r.jsx("span",{style:Ce.statusLabel,children:""}),r.jsx("span",{style:Ce.statusValue,children:q(h.state)})]}),r.jsxs("div",{style:Ce.statusItem,children:[r.jsx("span",{style:Ce.statusLabel,children:""}),r.jsxs("span",{style:{...Ce.statusValue,color:B(h.threatLevel)},children:[$(h.threatLevel)," ",h.threatLevel,"%"]})]}),r.jsxs("div",{style:Ce.statusItem,children:[r.jsx("span",{style:Ce.statusLabel,children:""}),r.jsxs("span",{style:Ce.statusValue,children:[" ",h.rumorCount*5,"%"]})]})]}),r.jsx("div",{style:Ce.threatBar,children:r.jsx("div",{style:{...Ce.threatFill,width:`${h.threatLevel}%`,backgroundColor:B(h.threatLevel)}})}),h.threatLevel>=80&&r.jsx("div",{style:Ce.dangerWarning,children:" "})]}),r.jsxs("div",{style:Ce.actions,children:[r.jsx("h3",{style:Ce.sectionTitle,children:""}),r.jsxs("div",{style:Ce.actionCard,children:[r.jsxs("div",{style:Ce.actionHeader,children:[r.jsx("h4",{style:Ce.actionTitle,children:" "}),r.jsxs("span",{style:Ce.actionCost,children:["",i*30," "]})]}),r.jsxs("p",{style:Ce.actionDesc,children:["",h.name,"80%"]}),r.jsxs("div",{style:Ce.actionControlsVertical,children:[r.jsxs("select",{value:i,onChange:ie=>a(Number(ie.target.value)),style:Ce.select,children:[r.jsx("option",{value:"1",children:"1-40%"}),r.jsx("option",{value:"2",children:"2-80%"}),r.jsx("option",{value:"3",children:"3-100%"})]}),r.jsxs("button",{style:{...Ce.hideBtn,...E?{}:{opacity:.6,cursor:"not-allowed"}},onClick:J,"aria-disabled":!E,title:E?"":S,children:[" (",i*30,")"]})]})]}),r.jsxs("div",{style:Ce.actionCard,children:[r.jsxs("div",{style:Ce.actionHeader,children:[r.jsx("h4",{style:Ce.actionTitle,children:" "}),r.jsxs("span",{style:Ce.actionCost,children:["",s," "]})]}),r.jsxs("p",{style:Ce.actionDesc,children:["",h.name,"",r.jsx("br",{}),""]}),r.jsx("div",{style:Ce.actionControls,children:r.jsx("input",{type:"range",min:"50",max:"150",step:"10",value:s,onChange:ie=>o(Number(ie.target.value)),style:Ce.slider})}),r.jsxs("button",{style:Ce.rumorBtn,onClick:se,disabled:c||!(e!=null&&e.resources)||e.resources.spiritStones<s,children:[" (",s,")"]}),r.jsxs("div",{style:Ce.actionInfo,children:["",Math.min(90,60+s/2),"% | +",s>=100?25:10]})]}),r.jsxs("div",{style:{...Ce.actionCard,...Ce.finalDuelCard},children:[r.jsxs("div",{style:Ce.actionHeader,children:[r.jsx("h4",{style:Ce.actionTitle,children:" "}),r.jsx("span",{style:Ce.actionWarning,children:""})]}),r.jsxs("p",{style:Ce.actionDesc,children:["",h.name,"",r.jsx("br",{}),r.jsx("strong",{children:""}),""]}),r.jsxs("div",{style:Ce.powerComparison,children:[r.jsxs("div",{style:Ce.powerItem,children:[r.jsx("span",{children:""}),r.jsx("span",{children:k})]}),r.jsxs("div",{style:Ce.powerItem,children:[r.jsx("span",{children:""}),r.jsx("span",{children:Y})]})]}),r.jsxs("div",{style:{fontSize:"13px",color:"#444",marginTop:8},children:[": ",Math.round(aw(e,{...h,combatStats:{...h.combatStats||{},atk:H((Re=h.combatStats)==null?void 0:Re.atk,50),def:H((Fe=h.combatStats)==null?void 0:Fe.def,20),maxHp:H((O=h.combatStats)==null?void 0:O.maxHp,500)}}).prob*100),"%"]}),r.jsx("div",{style:{fontSize:"12px",color:"#666",marginTop:"8px"},children:""}),r.jsx("button",{style:Ce.duelBtn,onClick:X,disabled:e.tier==="",children:""}),e.tier===""&&r.jsx("div",{style:Ce.actionWarningText,children:" "})]})]}),l&&r.jsxs("div",{style:{...Ce.resultToast,backgroundColor:l.success?"#4caf50":"#f44336"},children:[r.jsx("p",{children:l.message}),l.damage&&r.jsxs("p",{children:["",l.damage]}),l.actualPowerLoss&&r.jsxs("p",{children:["-",l.actualPowerLoss," (-",Math.round(l.actualPowerLoss/Y*100),"%)"]}),l.threatIncrease&&r.jsxs("p",{children:["+",l.threatIncrease,"%"]}),l.threatReduction&&r.jsxs("p",{children:["-",l.threatReduction,"%"]}),l.transitionLog&&r.jsx("p",{children:l.transitionLog}),l.nextStage&&r.jsxs("p",{children:["",l.nextStage.name,"",l.nextStage.title,""]})]}),u&&r.jsx("div",{style:Ce.modalOverlay,children:r.jsxs("div",{style:Ce.modalCard,children:[r.jsx("div",{style:Ce.modalIcon,children:u.type==="victory"?"":u.type==="defeat"?"":""}),r.jsx("h3",{style:{marginBottom:10},children:u.title}),r.jsx("p",{style:Ce.modalText,children:u.message}),r.jsx("button",{style:Ce.modalButton,onClick:()=>p(null),children:u.type==="victory"?"":""})]})})]})},Ce={panel:{padding:"20px",maxWidth:"900px",margin:"0 auto",color:"#e0d5c7"},header:{textAlign:"center",marginBottom:"30px",borderBottom:"2px solid #8b4513",paddingBottom:"15px"},stageFocusHeader:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"10px"},stageBadge:{fontSize:"12px",letterSpacing:"2px",padding:"4px 10px",borderRadius:"999px",border:"1px solid #ffd700",color:"#ffd700"},stageStatus:{fontSize:"12px",padding:"4px 12px",borderRadius:"999px",background:"rgba(255,255,255,0.08)",color:"#fff"},stageFocusName:{fontSize:"22px",fontWeight:"bold",color:"#ffe4c4"},stageFocusTitle:{fontSize:"14px",color:"#ffcc80",marginTop:"4px"},stageNarrative:{border:"1px solid rgba(255,255,255,0.1)",borderRadius:"10px",padding:"16px",marginBottom:"20px",background:"rgba(0,0,0,0.25)"},stageNarrativeText:{fontSize:"14px",color:"#f0e1c3",marginTop:"6px"},stageNarrativeNext:{fontSize:"13px",color:"#ffd700",marginTop:"8px"},title:{color:"#ff6b6b",fontSize:"28px",marginBottom:"8px",textShadow:"2px 2px 4px rgba(0,0,0,0.5)"},subtitle:{color:"#ffd700",fontSize:"18px",fontStyle:"italic"},rivalStatus:{background:"linear-gradient(135deg, rgba(40, 20, 20, 0.8), rgba(60, 30, 30, 0.8))",border:"2px solid #8b4513",borderRadius:"12px",padding:"20px",marginBottom:"25px",boxShadow:"0 4px 12px rgba(0,0,0,0.4)"},sectionTitle:{color:"#ffd700",marginBottom:"15px",fontSize:"20px"},statusGrid:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(140px, 1fr))",gap:"12px",marginBottom:"15px"},statusItem:{display:"flex",justifyContent:"space-between",padding:"8px 12px",background:"rgba(0,0,0,0.3)",borderRadius:"6px"},statusLabel:{color:"#bbb",fontWeight:"500"},statusValue:{color:"#fff",fontWeight:"bold"},threatBar:{width:"100%",height:"30px",background:"rgba(0,0,0,0.5)",borderRadius:"15px",overflow:"hidden",border:"2px solid #666",marginTop:"15px",position:"relative"},threatFill:{height:"100%",transition:"width 0.5s ease, background-color 0.5s ease",display:"flex",alignItems:"center",justifyContent:"center",fontWeight:"bold",color:"white",textShadow:"1px 1px 2px rgba(0,0,0,0.8)"},dangerWarning:{marginTop:"15px",padding:"12px",background:"linear-gradient(90deg, #ff4444, #ff6b6b)",border:"2px solid #ff0000",borderRadius:"8px",color:"white",fontWeight:"bold",textAlign:"center",boxShadow:"0 0 20px rgba(255, 68, 68, 0.6)"},actions:{marginTop:"30px"},actionCard:{background:"linear-gradient(135deg, rgba(30, 30, 40, 0.9), rgba(50, 40, 60, 0.9))",border:"2px solid #8b4513",borderRadius:"12px",padding:"20px",marginBottom:"20px",boxShadow:"0 4px 12px rgba(0,0,0,0.4)"},finalDuelCard:{background:"linear-gradient(135deg, rgba(60, 20, 20, 0.9), rgba(80, 30, 30, 0.9))",borderColor:"#ff4444"},actionHeader:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"12px",borderBottom:"1px solid rgba(255, 255, 255, 0.2)",paddingBottom:"10px"},actionTitle:{color:"#ffd700",fontSize:"18px",margin:0},actionCost:{color:"#66ff66",fontWeight:"bold",fontSize:"14px"},actionWarning:{color:"#ff6b6b",fontWeight:"bold",fontSize:"14px"},actionDesc:{color:"#ccc",lineHeight:"1.6",marginBottom:"15px",fontSize:"14px"},actionControls:{display:"flex",flexDirection:"column",gap:"12px",marginBottom:"12px"},actionControlsVertical:{display:"flex",flexDirection:"column",gap:"12px"},slider:{width:"100%",height:"8px"},select:{width:"100%",padding:"12px",background:"rgba(0, 0, 0, 0.5)",color:"#fff",border:"2px solid #8b4513",borderRadius:"6px",fontSize:"14px",cursor:"pointer"},rumorBtn:{width:"100%",padding:"14px 24px",border:"none",borderRadius:"8px",background:"linear-gradient(135deg, #6a5acd, #8b7ad8)",color:"white",fontWeight:"bold",fontSize:"15px",cursor:"pointer",boxShadow:"0 4px 8px rgba(0,0,0,0.3)",transition:"transform 0.2s"},hideBtn:{width:"100%",padding:"14px 24px",border:"none",borderRadius:"8px",background:"linear-gradient(135deg, #4a90e2, #5ba3f5)",color:"white",fontWeight:"bold",fontSize:"15px",cursor:"pointer",boxShadow:"0 4px 8px rgba(0,0,0,0.3)",transition:"transform 0.2s"},duelBtn:{width:"100%",background:"linear-gradient(135deg, #ff4444, #ff6b6b)",color:"white",fontSize:"16px",padding:"14px",border:"none",borderRadius:"8px",fontWeight:"bold",cursor:"pointer",boxShadow:"0 4px 8px rgba(0,0,0,0.3)"},actionInfo:{color:"#aaa",fontSize:"12px",marginTop:"5px"},actionWarningText:{color:"#ff6b6b",fontSize:"13px",textAlign:"center",marginTop:"10px",fontWeight:"bold"},powerComparison:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"15px",margin:"15px 0",padding:"15px",background:"rgba(0, 0, 0, 0.3)",borderRadius:"8px"},powerItem:{display:"flex",flexDirection:"column",alignItems:"center",gap:"5px",color:"#bbb",fontSize:"13px"},completed:{textAlign:"center",padding:"60px 40px",background:"linear-gradient(135deg, rgba(40, 80, 40, 0.8), rgba(60, 100, 60, 0.8))",border:"3px solid #4caf50",borderRadius:"16px",boxShadow:"0 8px 24px rgba(0,0,0,0.5)"},resultToast:{position:"fixed",bottom:"30px",left:"50%",transform:"translateX(-50%)",padding:"20px 30px",borderRadius:"12px",boxShadow:"0 8px 24px rgba(0,0,0,0.5)",zIndex:9999,minWidth:"300px",maxWidth:"500px",color:"white"},modalOverlay:{position:"fixed",inset:0,background:"rgba(0,0,0,0.65)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:99999},modalCard:{width:"90%",maxWidth:420,background:"rgba(24,17,13,0.95)",border:"1px solid rgba(255,255,255,0.2)",borderRadius:18,padding:"24px 24px 28px",textAlign:"center",boxShadow:"0 20px 45px rgba(0,0,0,0.45)"},modalIcon:{fontSize:42,marginBottom:12},modalText:{lineHeight:1.7,fontSize:15,color:"#f7d8b4",marginBottom:18},modalButton:{padding:"10px 20px",borderRadius:999,border:"none",background:"linear-gradient(120deg, #f06292, #f7b733)",color:"#fff",fontWeight:"bold",cursor:"pointer",boxShadow:"0 6px 18px rgba(240,98,146,0.45)"}},ha=(e="")=>({base:0,skinColor:0,hair:1,hairColor:0,eye:0,eyeColor:1,mouth:0,gender:e}),RC=(e,t)=>!e||!t?!1:e.base===t.base&&e.skinColor===t.skinColor&&e.hair===t.hair&&e.hairColor===t.hairColor&&e.eye===t.eye&&e.eyeColor===t.eyeColor&&e.mouth===t.mouth&&e.gender===t.gender,o1=(e,t)=>{const n=e?{...e,gender:e.gender??t}:ha(t);return RC(n,ha(t))?null:n},i1=(e,t)=>e?{...ha(t),...e,gender:e.gender??t}:ha(t),hl=e=>{if(!e)return e;const t=e.gender;return{...e,avatar:o1(e.avatar,t),currentExp:Math.max(0,Math.floor((e==null?void 0:e.currentExp)||0)),maxExp:Math.max(1,Math.floor((e==null?void 0:e.maxExp)||1))}},gl=e=>{if(!e)return e;const t=e.gender;return{...e,avatar:i1(e.avatar,t),currentExp:Math.max(0,Math.floor(Number(e.currentExp)||0)),maxExp:Math.max(1,Math.floor(Number(e.maxExp)||1))}},du=2e6,uu=(e,t)=>!Array.isArray(e)||e.length<=t?e:e.slice(-t),MC=(e,t=200,n=30)=>{if(!e||typeof e!="object")return e;const o=Object.keys(e).slice(-t),i={};for(const a of o){const l=e[a];i[a]=Array.isArray(l)?l.slice(-n):l}return i},AC=(e=[])=>{if(!Array.isArray(e))return e;const t=new Map,n=[];return e.forEach(s=>{if(!s)return;const o=s.id||s.itemId;if(!(s.stackable===!0&&o)){n.push(s);return}const a=o;if(!t.has(a)){const d={...s};d.quantity=0,d.instanceId=`${o}_stack`,t.set(a,d)}const l=t.get(a);l.quantity+=Number(s.quantity||1)}),[...n,...t.values()]},NC=(e=[])=>{const t=[],n={};let s=0;e.forEach(a=>{if(!a)return;if((a.generation||1)<=2){t.push(a);return}s+=1;const d=a.tierTitle||a.tier||"";n[d]=(n[d]||0)+1});const o=Object.entries(n).map(([a,l])=>({t:a,c:l})),i=s>0?{c:s,t:o}:void 0;return{mainlineChildren:t,descendantsSummary:i}},LC=e=>{if(!e||!e.c)return[];const t=Array.isArray(e.t)?e.t:[{t:"",c:e.c}],n=[];let s=0;return t.forEach(({t:o,c:i})=>{const a=Number(i||0);for(let l=0;l<a;l+=1){s+=1;const d=s%2===0?"":"";n.push({id:`desc_${s}`,name:`${s}`,generation:3,age:20,gender:d,avatar:ha(d),stats:{aptitude:50,looks:50,intelligence:50,lifespan:100},isTested:!0,isAdult:!0,cultivation:0,tierTitle:o||"",currentExp:0,maxExp:1})}}),n},Ph=(e,t={})=>{const{aggressive:n=!1}=t,s=e.player||{},o=s.rival,i=s.revengeProgress,a=s.revengeActions,{mainlineChildren:l,descendantsSummary:d}=NC(e.children||[]),u=n?void 0:uu(s.worldEvents,200),p=n?void 0:uu(s.newsBuffer,200),c=n?[]:Array.isArray(e.messages)?uu(e.messages,200):MC(e.messages,200,30),f=n?{}:e.lastMessageCheck||{},b=AC(e.inventory||[]);return{v:2,p:{n:s.name,a:s.age,hp:s.hp,mhp:s.maxHp,cv:s.cultivation,ce:Math.max(0,Math.floor(s.currentExp||0)),me:Math.max(1,Math.floor(s.maxExp||1)),t:s.tier,tt:s.tierTitle,w:s.wealth,m:s.mood,tm:s.time,av:o1(s.avatar,s.gender),g:s.gender,ps:s.personality,ap:s.appearance,we:u,nb:p,fr:s.familyRatingSummary,bs:s.businesses||[],rs:s.resources||{spiritStones:0,money:0},st:s.stats||{},cs:s.combatStats||{},pcs:s.childrenStrategy||{skipZhaozhou:!1},rv:o?{n:o.name,sid:o.stageId,t:o.tier,st:o.state,ls:o.lifeStage||0,tl:o.threatLevel||0,d:o.isDead||!1,rc:o.rumorCount||0,ht:o.hiddenTurns||0,ce:o.currentExp||0,stt:o.stats||{},cst:o.combatStats||{}}:void 0,rp:i?{si:i.currentStageIndex||0,cs:i.completedStages||[],sc:i.sagaComplete||!1}:void 0,ra:a?{lr:a.lastRumorMonth||0,tr:a.totalRumors||0,aa:a.assassinationAttempts||0,hm:a.hidingMonths||0}:void 0},ch:l.map(hl),d3:d,fc:(e.fallenChildren||[]).map(hl),an:(e.activeNpcs||[]).map(hl),dn:(e.deadNpcs||[]).map(hl),inv:b,gs:e.gameStage,msg:c,lmc:f,psc:e.pendingSectChoices,tq:e.testQueue}},$C=e=>{const t=e.p||{},n=t.rv,s=t.rp,o=t.ra,i=(e.ch||[]).map(gl),a=LC(e.d3);return{player:{name:t.n,age:t.a,hp:t.hp,maxHp:t.mhp,cultivation:t.cv,currentExp:Math.max(0,Math.floor(Number(t.ce)||0)),maxExp:Math.max(1,Math.floor(Number(t.me)||1)),tier:t.t,tierTitle:t.tt,wealth:t.w,mood:t.m,time:t.tm,avatar:i1(t.av,t.g),gender:t.g,personality:t.ps,appearance:t.ap,worldEvents:t.we,newsBuffer:t.nb,familyRatingSummary:t.fr,businesses:t.bs||[],resources:t.rs||{spiritStones:0,money:0},stats:t.st||{},combatStats:t.cs||{},childrenStrategy:t.pcs||{skipZhaozhou:!1},rival:n?{name:n.n,stageId:n.sid,tier:n.t,state:n.st,lifeStage:n.ls||0,threatLevel:n.tl||0,isDead:n.d||!1,rumorCount:n.rc||0,hiddenTurns:n.ht||0,currentExp:n.ce||0,stats:n.stt||{},combatStats:n.cst||{}}:void 0,revengeProgress:s?{currentStageIndex:s.si||0,completedStages:s.cs||[],sagaComplete:s.sc||!1}:void 0,revengeActions:o?{lastRumorMonth:o.lr||0,totalRumors:o.tr||0,assassinationAttempts:o.aa||0,hidingMonths:o.hm||0}:void 0},children:[...i,...a],fallenChildren:(e.fc||[]).map(gl),activeNpcs:(e.an||[]).map(gl),deadNpcs:(e.dn||[]).map(gl),inventory:e.inv||[],gameStage:e.gs,messages:Array.isArray(e.msg)?e.msg:[],lastMessageCheck:e.lmc||{},pendingSectChoices:e.psc,testQueue:e.tq}},BC=(e,t="")=>{try{let n=Ph(e),s=JSON.stringify(n),o=btoa(unescape(encodeURIComponent(s)));if(o.length>du&&(n=Ph(e,{aggressive:!0}),s=JSON.stringify(n),o=btoa(unescape(encodeURIComponent(s))),console.warn(" //")),o.length>du)return console.error(` ${du.toLocaleString()} `),null;const i=(o.length/1024).toFixed(2);return console.log(` : ${i} KB (C)`),o}catch(n){return console.error(" :",n),null}},Yr=(e="")=>{const t=e===""?[0,1,2]:[0,1,2,3],n=[0,1,2,3,4,5],s=[0,1,2,3,4,5,6,7],o=[0,1,2,3,4,5,6],i=[0,1,2,3,4,5],a=[0,1,2,3,4,5],l=[0,1,2,3,4],d=u=>u[Math.floor(Math.random()*u.length)];return{base:d(t),skinColor:d(n),hair:d(s),hairColor:d(o),eye:d(i),eyeColor:d(a),mouth:d(l)}},Ri=(e,t="")=>{if(!e||typeof e!="object"||Object.keys(e).length===0)return console.log(" ..."),Yr(t);const n={...e};return!n.base&&n.base!==0&&(n.base=Yr(t).base),!n.skinColor&&n.skinColor!==0&&(n.skinColor=Yr(t).skinColor),!n.hair&&n.hair!==0&&(n.hair=Yr(t).hair),!n.hairColor&&n.hairColor!==0&&(n.hairColor=Yr(t).hairColor),!n.eye&&n.eye!==0&&(n.eye=Yr(t).eye),!n.eyeColor&&n.eyeColor!==0&&(n.eyeColor=Yr(t).eyeColor),!n.mouth&&n.mouth!==0&&(n.mouth=Yr(t).mouth),n},OC=e=>{var t;try{const n=e.trim();if(!n)return console.error(" "),null;let s;try{s=decodeURIComponent(escape(atob(n)))}catch(l){return console.error(" Base64 :",l.message),null}let o;try{o=JSON.parse(s)}catch(l){return console.error(" JSON :",l.message),null}let i=o;if(o&&o.v===2&&o.p&&(i=$C(o)),!i.player)return console.error("  player "),null;!i.player.rival&&(o!=null&&o.rival)&&(i.player.rival=o.rival),!i.player.revengeProgress&&(o!=null&&o.revengeProgress)&&(i.player.revengeProgress=o.revengeProgress),!i.player.revengeActions&&(o!=null&&o.revengeActions)&&(i.player.revengeActions=o.revengeActions);const a=i.player;if(a){if(a.cultivation!==void 0){const l=Number(a.cultivation);a.cultivation=isNaN(l)?0:l}else a.cultivation=0;a.currentExp=Math.max(0,Math.floor(Number(a.currentExp)||0)),a.maxExp=Math.max(1,Math.floor(Number(a.maxExp)||1)),a.avatar=Ri(a.avatar,a.gender),a.childrenStrategy?a.childrenStrategy.skipZhaozhou=a.childrenStrategy.skipZhaozhou??!1:a.childrenStrategy={skipZhaozhou:!1}}return Array.isArray(i.children)&&(i.children=i.children.map(l=>l&&(l.currentExp=Math.max(0,Math.floor(Number(l.currentExp)||0)),l.maxExp=Math.max(1,Math.floor(Number(l.maxExp)||1)),l.avatar=Ri(l.avatar,l.gender),l))),Array.isArray(i.activeNpcs)&&(i.activeNpcs=i.activeNpcs.map(l=>l&&(l.currentExp=Math.max(0,Math.floor(Number(l.currentExp)||0)),l.maxExp=Math.max(1,Math.floor(Number(l.maxExp)||1)),l.avatar=Ri(l.avatar,l.gender),l))),Array.isArray(i.deadNpcs)&&(i.deadNpcs=i.deadNpcs.map(l=>l&&(l.avatar=Ri(l.avatar,l.gender),l))),Array.isArray(i.fallenChildren)&&(i.fallenChildren=i.fallenChildren.map(l=>l&&(l.avatar=Ri(l.avatar,l.gender),l))),i.player.revengeProgress||(i.player.revengeProgress={currentStageIndex:0,completedStages:[],sagaComplete:!1}),i.player.revengeActions||(i.player.revengeActions={lastRumorMonth:0,totalRumors:0,assassinationAttempts:0,hidingMonths:0}),i.player.rival&&(i.player.rival.threatLevel=Math.max(0,Math.min(100,i.player.rival.threatLevel||0)),i.player.rival.isDead=i.player.rival.isDead||!1),console.log(" "),console.log(` : ${i.player.name}, : ${i.player.cultivation}`),console.log(` : ${i.player.currentExp}/${i.player.maxExp}`),console.log(` : ${(i.activeNpcs||[]).length}, : ${(i.children||[]).length}`),i.player.rival&&console.log(` :  ${(((t=i.player.revengeProgress)==null?void 0:t.currentStageIndex)||0)+1} , : ${i.player.rival.name}, : ${i.player.rival.threatLevel||0}`),i}catch(n){return console.error(" :",n),null}},PC=(e,t="save.txt")=>{try{const n=new Blob([e],{type:"text/plain;charset=utf-8"}),s=URL.createObjectURL(n),o=document.createElement("a");o.href=s,o.download=t,document.body.appendChild(o),o.click(),document.body.removeChild(o),URL.revokeObjectURL(s)}catch(n){console.error(":",n)}},zC=e=>new Promise((t,n)=>{const s=new FileReader;s.onload=o=>t(o.target.result),s.onerror=o=>n(o),s.readAsText(e)}),DC=({gameState:e,onLoadGame:t,playerName:n=""})=>{const[s,o]=y.useState("export"),[i,a]=y.useState(""),[l,d]=y.useState(""),[u,p]=y.useState(""),[c,f]=y.useState("info"),b=3e3,[S,E]=y.useState("whole"),[j,x]=y.useState(1),[h,v]=y.useState(1),g=(H,B="info")=>{p(H),f(B),setTimeout(()=>p(""),5e3)},I=()=>{if(!e){g("","error");return}try{const H=BC(e,n);if(!H){g("","error");return}a(H);const B=Math.ceil(H.length/b);v(B),x(1),E(B>1?"paginated":"whole");const $=(H.length/1024).toFixed(2),q=B>1?`${B}`:"";g(` : ${$} KB${q}`,"success")}catch(H){console.error(":",H),g(": "+H.message,"error")}},_=()=>{if(!i){g("","error");return}let H=i;if(S==="paginated"&&h>1){const B=(j-1)*b,$=Math.min(B+b,i.length);H=i.substring(B,$)}navigator.clipboard.writeText(H).then(()=>{S==="paginated"&&h>1?g(`  ${j}/${h} `,"success"):g(" ","success")}).catch(()=>{g("","error")})},C=()=>{if(!i){g("","error");return}const H=new Date().toISOString().replace(/[:.]/g,"-"),B=`save_${n}_${H}.txt`;PC(i,B),g(" ","success")},k=async H=>{var $;const B=($=H.target.files)==null?void 0:$[0];if(B)try{const q=await zC(B);d(q),g(" ","success")}catch(q){console.error(":",q),g("","error")}},R=async()=>{try{const H=await navigator.clipboard.readText();d(H),g(" ","success")}catch(H){console.error(":",H),g("","error")}},T=()=>{var H,B;if(!l.trim()){g("","error");return}try{console.log(" ..."),console.log(":",l.trim().length),console.log(":",l.trim().substring(0,30));const $=OC(l.trim());if(!$){console.error(" "),g(` 

 
  (F12) 
 
 `,"error");return}const q=`
${((H=$.player)==null?void 0:H.name)||""}
${((B=$.player)==null?void 0:B.cultivation)||0}`;window.showConfirm&&window.showConfirm(q,()=>{t&&t(null,$),g(" ","success"),d("")})}catch($){console.error(":",$),g(" : "+$.message,"error")}},N={container:{padding:"20px",background:"linear-gradient(135deg, rgba(76, 175, 80, 0.1) 0%, rgba(76, 175, 80, 0.05) 100%)",borderRadius:"8px",border:"1px solid rgba(76, 175, 80, 0.3)"},tabButtons:{display:"flex",gap:"10px",marginBottom:"20px"},tabButton:H=>({padding:"8px 16px",border:"none",borderRadius:"4px",background:H?"#4caf50":"#ddd",color:H?"white":"#333",cursor:"pointer",fontWeight:"bold",fontSize:"14px",transition:"all 0.3s"}),section:{marginBottom:"20px"},label:{display:"block",marginBottom:"8px",fontWeight:"bold",color:"#333"},input:{width:"100%",padding:"8px 12px",border:"1px solid #ccc",borderRadius:"4px",fontSize:"14px",fontFamily:"monospace",boxSizing:"border-box"},textarea:{width:"100%",minHeight:"150px",padding:"12px",border:"1px solid #ccc",borderRadius:"4px",fontSize:"12px",fontFamily:"monospace",boxSizing:"border-box",background:"#f9f9f9",color:"#333"},button:{padding:"8px 16px",margin:"5px 5px 5px 0",border:"none",borderRadius:"4px",background:"#4caf50",color:"white",cursor:"pointer",fontSize:"14px",fontWeight:"bold",transition:"background 0.3s"},buttonSecondary:{background:"#2196F3"},buttonDanger:{background:"#ff9800"},buttonDisabled:{background:"#ccc",cursor:"not-allowed"},message:{padding:"12px",borderRadius:"4px",marginBottom:"15px",fontSize:"14px",fontWeight:"bold"},messageSuccess:{background:"#c8e6c9",color:"#2e7d32",border:"1px solid #81c784"},messageError:{background:"#ffcdd2",color:"#c62828",border:"1px solid #ef5350"},messageInfo:{background:"#bbdefb",color:"#1565c0",border:"1px solid #64b5f6"},passwordContainer:{display:"flex",gap:"10px",alignItems:"center"},passwordInput:{flex:1},checkbox:{width:"18px",height:"18px",cursor:"pointer"},info:{fontSize:"12px",color:"#666",marginTop:"8px",padding:"8px",background:"#f0f0f0",borderRadius:"4px",borderLeft:"3px solid #2196F3"},fileInput:{display:"none"},fileInputLabel:{padding:"8px 16px",background:"#2196F3",color:"white",borderRadius:"4px",cursor:"pointer",fontSize:"14px",fontWeight:"bold",display:"inline-block",transition:"background 0.3s"}},Y=()=>{const H=N.message;return c==="success"?{...H,...N.messageSuccess}:c==="error"?{...H,...N.messageError}:{...H,...N.messageInfo}};return r.jsxs("div",{style:N.container,children:[r.jsx("h3",{style:{marginTop:0,color:"#2e7d32"},children:" /"}),r.jsxs("div",{style:N.tabButtons,children:[r.jsx("button",{style:N.tabButton(s==="export"),onClick:()=>o("export"),children:" "}),r.jsx("button",{style:N.tabButton(s==="import"),onClick:()=>o("import"),children:" "})]}),u&&r.jsx("div",{style:Y(),children:u}),s==="export"&&r.jsxs("div",{children:[r.jsx("div",{style:N.section,children:r.jsx("button",{style:N.button,onClick:I,children:" "})}),i&&r.jsxs("div",{style:N.section,children:[r.jsxs("label",{style:N.label,children:[" ",r.jsxs("span",{style:{marginLeft:"10px",color:"#2196F3",fontSize:"13px",fontWeight:"normal"},children:[": ",i.length.toLocaleString()]})]}),r.jsxs("div",{style:{marginBottom:"12px",padding:"10px",background:h>1?"#fff3e0":"#f5f5f5",borderRadius:"4px",border:h>1?"1px solid #ffe0b2":"1px solid #ddd"},children:[r.jsx("div",{style:{marginBottom:"8px",fontWeight:"bold",color:h>1?"#e65100":"#666"},children:h>1?" ":"  ("+i.length+")"}),r.jsxs("div",{style:{display:"flex",gap:"10px",alignItems:"center",flexWrap:"wrap"},children:[r.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"5px",cursor:"pointer"},children:[r.jsx("input",{type:"radio",name:"copyMode",value:"whole",checked:S==="whole",onChange:H=>E(H.target.value),style:{cursor:"pointer"}}),r.jsxs("span",{children:[" ",h===1?"()":"()"]})]}),r.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"5px",cursor:"pointer"},children:[r.jsx("input",{type:"radio",name:"copyMode",value:"paginated",checked:S==="paginated",onChange:H=>E(H.target.value),style:{cursor:"pointer"}}),r.jsxs("span",{children:[" ",h>1?"()":"()"]})]})]})]}),S==="paginated"&&h>1&&r.jsxs("div",{style:{marginBottom:"12px",padding:"10px",background:"#e3f2fd",borderRadius:"4px",border:"1px solid #bbdefb"},children:[r.jsxs("div",{style:{marginBottom:"8px",fontWeight:"bold",color:"#1565c0"},children:["  ",j,"/",h]}),r.jsxs("div",{style:{display:"flex",gap:"8px",alignItems:"center",flexWrap:"wrap"},children:[r.jsx("button",{style:{...N.button,...N.buttonSecondary,opacity:j===1?.5:1,cursor:j===1?"not-allowed":"pointer"},onClick:()=>x(Math.max(1,j-1)),disabled:j===1,children:" "}),r.jsx("select",{value:j,onChange:H=>x(parseInt(H.target.value)),style:{padding:"6px 10px",border:"1px solid #ccc",borderRadius:"4px",fontSize:"14px",cursor:"pointer"},children:Array.from({length:h},(H,B)=>r.jsxs("option",{value:B+1,children:[" ",B+1," "]},B+1))}),r.jsx("button",{style:{...N.button,...N.buttonSecondary,opacity:j===h?.5:1,cursor:j===h?"not-allowed":"pointer"},onClick:()=>x(Math.min(h,j+1)),disabled:j===h,children:" "})]}),r.jsx("div",{style:{fontSize:"12px",color:"#666",marginTop:"8px"},children:" "})]}),r.jsx("textarea",{value:S==="paginated"&&h>1?i.substring((j-1)*b,Math.min(j*b,i.length)):i,readOnly:!0,style:N.textarea}),r.jsxs("div",{style:{marginTop:"10px"},children:[r.jsxs("button",{style:N.button,onClick:_,children:[" ",S==="paginated"&&h>1?` ${j} `:""]}),r.jsx("button",{style:{...N.button,...N.buttonSecondary},onClick:C,children:" "})]}),r.jsxs("div",{style:N.info,children:[" ",h>1&&r.jsxs(r.Fragment,{children:[r.jsx("br",{}),"  ",h,' ""']})]})]})]}),s==="import"&&r.jsxs("div",{children:[r.jsxs("div",{style:N.section,children:[r.jsx("label",{style:N.label,children:" "}),r.jsx("input",{type:"file",accept:".txt,.json",onChange:k,style:N.fileInput,id:"saveFileInput"}),r.jsx("label",{htmlFor:"saveFileInput",style:N.fileInputLabel,children:" "}),r.jsx("button",{style:{...N.button,...N.buttonSecondary,marginLeft:"10px"},onClick:R,children:" "})]}),r.jsxs("div",{style:N.section,children:[r.jsx("label",{style:N.label,children:" "}),r.jsx("textarea",{value:l,onChange:H=>d(H.target.value),placeholder:"...",style:N.textarea})]}),r.jsxs("div",{style:N.section,children:[r.jsx("button",{style:N.button,onClick:T,children:" "}),r.jsx("button",{style:{...N.button,...N.buttonDanger},onClick:()=>{d("")},children:" "})]}),r.jsx("div",{style:N.info,children:" "})]})]})},FC=({player:e,onSave:t,onLoad:n,onReset:s,onOpenGuide:o,autoAssignEnabled:i=!1,onToggleAutoAssign:a,autoSkipSpiritTest:l=!1,onToggleAutoSkip:d,skipChildGiftPopups:u=!1,onToggleSkipChildGiftPopups:p,skipShuraFieldEvents:c=!1,onToggleSkipShuraFieldEvents:f,skipRomanceGiftPopups:b=!1,onToggleSkipRomanceGiftPopups:S,skipJealousyPopups:E=!1,onToggleSkipJealousyPopups:j,skipZhaozhou:x=!1,onToggleSkipZhaozhou:h,isPortraitViewport:v=!0,isOrientationFixApplied:g=!1,onRequestPortraitFix:I=()=>{},onReleasePortraitFix:_=()=>{},onAutoAssignSpouses:C=()=>{},onRedeemCode:k=null,gameState:R=null})=>{const[T,N]=y.useState([]),[Y,H]=y.useState([]),[B,$]=y.useState({used:"0",usedMB:"0"}),[q,se]=y.useState({enabled:!1,syncing:!1}),[J,X]=y.useState([]),[re,ye]=y.useState(!1),[Re,Fe]=y.useState(""),[O,ie]=y.useState(""),[le,ee]=y.useState(""),[he,Ee]=y.useState(!1),[_e,rt]=y.useState(null),[At,Oe]=y.useState(!0),[P,pe]=y.useState(!0),[fe,ke]=y.useState(!0),[je,Ge]=y.useState(!0),[Jt,_t]=y.useState(!0),[Xt,dr]=y.useState(!1),[wa,Ks]=y.useState(null),[Qo,Pn]=y.useState(!1),[Zt,Uc]=y.useState(!1),[ur,ka]=y.useState(!1),[Ea,ys]=y.useState(!1),[bs,Ae]=y.useState(!1),[Xn,Gc]=y.useState(!1),[en,Zn]=y.useState(!1),[vs,Vc]=y.useState(!1),[Ss,Yc]=y.useState(!1),[ja,Of]=y.useState(!1),[ws,qc]=y.useState(null),[Qs,ks]=y.useState(""),[er,Es]=y.useState(null),Kc=[{key:"autoAssign",label:"",brief:"12",detail:["","1)  12 ","2) ","3) "].join(`
`),checked:!!i,onChange:a},{key:"autoSpirit",label:"",brief:"",detail:["","1) ","2) ","3) "].join(`
`),checked:!!l,onChange:d},{key:"skipGiftModal",label:"",brief:"",detail:["","1) ","2) ","3) "].join(`
`),checked:!!u,onChange:p},{key:"skipZhaozhou",label:"",brief:"",detail:["","1) ",'2) ""',"3) "].join(`
`),checked:!!x,onChange:h}],Qc=[i?"":"",l?"":"",u?"":"",x?"":""].join("  "),Jc=[{key:"skipShura",label:"",brief:"",detail:["","1) ","2) ","3) "].join(`
`),checked:!!c,onChange:f},{key:"skipRomanceGift",label:"",brief:"NPC ",detail:["","1) ","2) ","3) "].join(`
`),checked:!!b,onChange:S},{key:"skipJealousy",label:"",brief:"",detail:["","1) ","2) ","3) "].join(`
`),checked:!!E,onChange:j}],Xc=[c?"":"",b?"":"",E?"":""].join("  "),Ca=W=>{Ks(Le=>Le===W?null:W)},Jo=W=>{qc(Le=>Le===W?null:W)},Xo=()=>{if(typeof k!="function"){Es({success:!1,message:""});return}const W=k(Qs);W!=null&&W.success&&ks(""),Es(W||{success:!1,message:""})},Zo=T.filter(W=>W.exists).length,Zc=Y.filter(W=>W.exists).length,ei=`${Re?"API Key ":"API Key "}   ${le||""}`,ti=At?"":"",ed=`${P?"AI":""}  ${fe?"":""}  ${je?"":""}`,Ta=Jt?"AI ":"",Ia=` ${Zo}    ${Zc}   ${B.usedMB} MB`,td="",Js=`${v?"":""}  ${g?"":""}`;y.useEffect(()=>{Er(),Xs(),_a(),rd(),pr(),nd();const W=Le=>{console.log(""),Xs(),pr()};window.addEventListener("autoSaveCompleted",W);try{const Le="__test__";localStorage.setItem(Le,"test"),localStorage.removeItem(Le)}catch(Le){console.error("localStorage :",Le),window.showResult&&window.showResult("",` 


1. 
2. 
3. 

`,!1,null,!1)}return()=>{window.removeEventListener("autoSaveCompleted",W)}},[]),y.useEffect(()=>{bs&&(console.log(""),Er(),Xs(),pr())},[bs]);const nd=()=>{const W=n1();se(W),W.enabled&&ni()},ni=async()=>{try{ye(!0);const W=await Db();X(W)}catch(W){console.error(":",W)}finally{ye(!1)}},Er=()=>{try{const W=Nf();console.log(":",W),N(W),pr()}catch(W){console.error(":",W),N([{slot:1,exists:!1},{slot:2,exists:!1},{slot:3,exists:!1}])}},Xs=()=>{try{const W=Jy();console.log(":",W),H(W)}catch(W){console.error(":",W),H([])}},pr=()=>{const W=Vy();$(W)},rd=()=>{const W=localStorage.getItem("enableGazette"),Le=localStorage.getItem("useAIForLetter"),cn=localStorage.getItem("useAIForTianjiProfile"),dn=localStorage.getItem("acceptChildLetters"),tr=localStorage.getItem("acceptLoverLetters");Oe(W!=="false"),pe(Le!=="false"),_t(cn!=="false"),ke(dn!=="false"),Ge(tr!=="false")},ri=()=>{localStorage.setItem("enableGazette",At.toString()),localStorage.setItem("useAIForLetter",P.toString()),localStorage.setItem("useAIForTianjiProfile",Jt.toString()),localStorage.setItem("acceptChildLetters",fe.toString()),localStorage.setItem("acceptLoverLetters",je.toString()),window.showResult&&window.showResult("","",!0,null,!1)},_a=()=>{const W=localStorage.getItem("game_api_key")||"",Le=localStorage.getItem("game_api_url")||"https://api.deepseek.com/chat/completions",cn=localStorage.getItem("game_api_model")||"deepseek-chat";Fe(W),ie(Le),ee(cn)},sd=()=>{localStorage.setItem("game_api_key",Re),localStorage.setItem("game_api_url",O),localStorage.setItem("game_api_model",le),window.showResult&&window.showResult("AI ","AI ",!0,null,!1),rt(null)},Ra=async()=>{if(!Re||!O){window.showResult&&window.showResult(""," API Key  URL",!1,null,!1);return}Ee(!0),rt(null);try{const W=await kE(Re,O);rt(W?{success:!0,message:" API "}:{success:!1,message:" "})}catch(W){rt({success:!1,message:` : ${W.message}`})}finally{Ee(!1)}},Ma=W=>{const Le=t(W);window.showResult&&(Le.success?(window.showResult("",` : ${W}
: ${Le.time}
: ${Le.size} KB`,!0,null,!1),Er()):Le.error==="QUOTA_EXCEEDED"?window.showResult("",` 


1. 
2. 
3. 

: ${Le.size||""} KB`,!1,null,!1):Le.error==="STORAGE_TOO_LARGE"?window.showResult("",` ${Le.size} KB



`,!1,null,!1):window.showResult("",` 

: ${Le.error||""}
: ${Le.message||""}


1. 
2. 
3. `,!1,null,!1))},Zs=W=>{window.showConfirm&&window.showConfirm(` ${W} `,()=>n(W))},od=W=>{window.showConfirm&&window.showConfirm(` ${W} `,()=>{Ky(W),Er(),window.showResult&&window.showResult("",` ${W} `,!0,null,!1)})},si=(W=1)=>{try{if(!R){window.showResult&&window.showResult(""," ",!1,null,!1);return}const Le=JSON.stringify(R).length/1024,cn=og(R),dn=Fb(R,cn),tr=JSON.stringify(cn).length/1024;console.log(" :",dn),console.log(` : ${Le.toFixed(2)} KB -> ${tr.toFixed(2)} KB ( ${(Le-tr).toFixed(2)} KB)`);const js=t(W,cn);if(js&&js.success){const ht=` 

:
- :  ${dn.mainLogsRemoved}  ${dn.mainLogsKept} 
- NPC:  ${dn.npcLogsRemoved}  ${dn.npcLogsKept} 
- : ${dn.totalRemoved} 

: ${tr.toFixed(2)} KB
: ${(Le-tr).toFixed(2)} KB`;window.showResult&&window.showResult("",ht,!0,null,!1),Er(),pr()}else window.showResult&&window.showResult("",` 
${(js==null?void 0:js.message)||""}`,!1,null,!1)}catch(Le){console.error(":",Le),window.showResult&&window.showResult("",` : ${Le.message}`,!1,null,!1)}},id=W=>{window.showConfirm&&window.showConfirm(` ${W} `,()=>{try{const Le=Xy(W);Le?(n(null,Le),window.showResult&&window.showResult("",`  ${W} 
: ${Le.gameTime||""}`,!0,null,!1)):window.showResult&&window.showResult(""," ",!1,null,!1)}catch(Le){console.error(":",Le),window.showResult&&window.showResult(""," "+Le.message,!1,null,!1)}})},eo=()=>{window.showConfirm&&window.showConfirm(`

`,()=>{Zy(),Xs(),window.showResult&&window.showResult(""," ",!0,null,!1)})},ad=()=>{window.showConfirm&&window.showConfirm(" ",()=>{s(),Er()})},ld=async W=>{if(!q.enabled){window.showResult&&window.showResult("",` 
 TapTap `,!1,null,!1);return}window.showConfirm&&window.showConfirm(` ${W} `,async()=>{try{ye(!0);const Le=await e1(W);window.showResult&&window.showResult("",` 

: ${Le.action==="create"?"":""}
UUID: ${Le.uuid}`,!0,null,!1),await ni()}catch(Le){window.showResult&&window.showResult("",` 

${Le.message}


 65
 
 10MB`,!1,null,!1)}finally{ye(!1)}})},oi=async W=>{if(!q.enabled){window.showResult&&window.showResult("",` 
 TapTap `,!1,null,!1);return}window.showConfirm&&window.showConfirm(` ${W} `,async()=>{var Le,cn;try{ye(!0);const dn=await t1(W);window.showResult&&window.showResult("",` 

: ${((Le=dn.player)==null?void 0:Le.name)||""}
: ${((cn=dn.player)==null?void 0:cn.cultivation)||0} `,!0,null,!1),Er()}catch(dn){window.showResult&&window.showResult("",` 

${dn.message}`,!1,null,!1)}finally{ye(!1)}})};return r.jsxs("div",{style:{padding:"20px"},children:[r.jsx("h3",{style:{borderBottom:"1px solid #ccc",paddingBottom:"10px"},children:" "}),r.jsxs("div",{style:G.collapsibleCard,children:[r.jsxs("button",{type:"button",style:G.collapsibleHeader,onClick:()=>dr(W=>!W),children:[r.jsxs("div",{style:G.collapsibleTitleRow,children:[r.jsx("span",{children:" "}),r.jsx("span",{style:G.collapsibleHint,children:Xt?"":""})]}),r.jsxs("div",{style:G.collapsibleSummary,children:["",Qc]})]}),Xt&&r.jsxs("div",{style:G.collapseBody,children:[r.jsx("p",{style:{...G.info,marginBottom:"10px"},children:""}),r.jsx("div",{style:G.optionGroup,children:Kc.map(W=>r.jsxs("div",{style:G.optionCard,children:[r.jsxs("div",{style:G.optionRow,children:[r.jsxs("label",{style:G.optionToggle,children:[r.jsx("input",{type:"checkbox",checked:W.checked,onChange:Le=>W.onChange&&W.onChange(Le.target.checked)}),r.jsx("span",{children:W.checked?"":""})]}),r.jsxs("button",{type:"button",style:G.optionText,onClick:()=>Ca(W.key),children:[r.jsxs("div",{style:G.optionTitleRow,children:[r.jsx("span",{children:W.label}),r.jsx("span",{style:G.detailHint,children:wa===W.key?"":""})]}),r.jsx("div",{style:G.optionBrief,children:W.brief})]})]}),wa===W.key&&r.jsx("div",{style:G.optionDetail,children:W.detail})]},W.key))}),r.jsxs("div",{style:G.familyActionCard,children:[r.jsxs("div",{style:G.familyActionHeader,children:[r.jsx("span",{children:" "}),r.jsx("span",{style:{fontSize:"11px",color:"#8d6e63"},children:""})]}),r.jsx("p",{style:G.familyActionDesc,children:" 500 "}),r.jsx("button",{type:"button",style:G.familyActionBtn,onClick:()=>C&&C(),children:" "}),r.jsx("small",{style:G.hint,children:""})]})]})]}),r.jsxs("div",{style:G.collapsibleCard,children:[r.jsxs("button",{type:"button",style:G.collapsibleHeader,onClick:()=>Of(W=>!W),children:[r.jsxs("div",{style:G.collapsibleTitleRow,children:[r.jsx("span",{children:" "}),r.jsx("span",{style:G.collapsibleHint,children:ja?"":""})]}),r.jsxs("div",{style:G.collapsibleSummary,children:["",Xc]})]}),ja&&r.jsxs("div",{style:G.collapseBody,children:[r.jsx("p",{style:{...G.info,marginBottom:"10px"},children:""}),r.jsx("div",{style:G.optionGroup,children:Jc.map(W=>r.jsxs("div",{style:G.optionCard,children:[r.jsxs("div",{style:G.optionRow,children:[r.jsxs("label",{style:G.optionToggle,children:[r.jsx("input",{type:"checkbox",checked:W.checked,onChange:Le=>W.onChange&&W.onChange(Le.target.checked)}),r.jsx("span",{children:W.checked?"":""})]}),r.jsxs("button",{type:"button",style:G.optionText,onClick:()=>Jo(W.key),children:[r.jsxs("div",{style:G.optionTitleRow,children:[r.jsx("span",{children:W.label}),r.jsx("span",{style:G.detailHint,children:ws===W.key?"":""})]}),r.jsx("div",{style:G.optionBrief,children:W.brief})]})]}),ws===W.key&&r.jsx("div",{style:G.optionDetail,children:W.detail})]},W.key))})]})]}),r.jsxs("div",{style:G.collapsibleCard,children:[r.jsxs("button",{type:"button",style:G.collapsibleHeader,onClick:()=>Yc(W=>!W),children:[r.jsxs("div",{style:G.collapsibleTitleRow,children:[r.jsx("span",{children:" "}),r.jsx("span",{style:G.collapsibleHint,children:Ss?"":""})]}),r.jsx("div",{style:G.collapsibleSummary,children:Js})]}),Ss&&r.jsxs("div",{style:G.collapseBody,children:[r.jsx("p",{style:G.info,children:" UI "}),r.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"10px"},children:[r.jsx("button",{onClick:I,style:{...G.saveBtn,width:"100%"},children:" "}),r.jsx("button",{onClick:_,style:{...G.btn,width:"100%",border:"1px solid #d32f2f",color:"#d32f2f"},disabled:!g,children:" "})]}),r.jsx("small",{style:G.hint,children:""})]})]}),r.jsxs("div",{style:G.collapsibleCard,children:[r.jsxs("button",{type:"button",style:G.collapsibleHeader,onClick:()=>Pn(W=>!W),children:[r.jsxs("div",{style:G.collapsibleTitleRow,children:[r.jsx("span",{children:" AI "}),r.jsx("span",{style:G.collapsibleHint,children:Qo?"":""})]}),r.jsx("div",{style:G.collapsibleSummary,children:ei})]}),Qo&&r.jsxs("div",{style:G.collapseBody,children:[r.jsxs("p",{style:G.info,children:[" API NPC ",r.jsx("br",{}),r.jsx("small",{style:{color:"#999"},children:" DeepSeek "})]}),r.jsxs("div",{style:G.formGroup,children:[r.jsx("label",{style:G.label,children:":"}),r.jsxs("select",{onChange:W=>{W.target.value==="deepseek"&&(ie("https://api.deepseek.com/chat/completions"),ee("deepseek-chat")),W.target.value=""},style:G.select,children:[r.jsx("option",{value:"",children:"..."}),r.jsx("option",{value:"deepseek",children:" DeepSeek"})]}),r.jsx("small",{style:G.hint,children:" URL  API Key"})]}),r.jsxs("div",{style:G.formGroup,children:[r.jsx("label",{style:G.label,children:"API Key:"}),r.jsx("input",{type:"password",value:Re,onChange:W=>Fe(W.target.value),placeholder:"sk-xxxxxxxxxxxxxxxx",style:G.input}),r.jsxs("small",{style:G.hint,children:[" Key:",r.jsx("a",{href:"https://platform.deepseek.com/",target:"_blank",rel:"noopener",children:" DeepSeek"})]})]}),r.jsxs("div",{style:G.formGroup,children:[r.jsx("label",{style:G.label,children:"API URL:"}),r.jsx("input",{type:"text",value:O,onChange:W=>ie(W.target.value),placeholder:"https://api.deepseek.com/chat/completions",style:G.input}),r.jsx("small",{style:G.hint,children:"DeepSeek: https://api.deepseek.com/chat/completions"})]}),r.jsxs("div",{style:G.formGroup,children:[r.jsx("label",{style:G.label,children:":"}),r.jsx("input",{type:"text",value:le,onChange:W=>ee(W.target.value),placeholder:"deepseek-chat",style:G.input}),r.jsx("small",{style:G.hint,children:"DeepSeek: deepseek-chat"})]}),_e&&r.jsx("div",{style:{...G.statusBox,background:_e.success?"#e8f5e9":"#ffebee",color:_e.success?"#2e7d32":"#c62828"},children:_e.message}),r.jsxs("div",{style:G.btnGroup,children:[r.jsx("button",{onClick:sd,style:G.saveBtn,children:" "}),r.jsx("button",{onClick:Ra,style:{...G.btn,background:"#2196f3",color:"white",border:"none"},disabled:he,children:he?"...":" "})]})]})]}),r.jsxs("div",{style:G.collapsibleCard,children:[r.jsxs("button",{type:"button",style:G.collapsibleHeader,onClick:()=>Uc(W=>!W),children:[r.jsxs("div",{style:G.collapsibleTitleRow,children:[r.jsx("span",{children:" "}),r.jsx("span",{style:G.collapsibleHint,children:Zt?"":""})]}),r.jsx("div",{style:G.collapsibleSummary,children:ti})]}),Zt&&r.jsxs("div",{style:G.collapseBody,children:[r.jsxs("p",{style:G.info,children:["NPC",r.jsx("br",{}),r.jsx("small",{style:{color:"#999"},children:""})]}),r.jsxs("div",{style:G.formGroup,children:[r.jsxs("label",{style:G.checkboxLabel,children:[r.jsx("input",{type:"checkbox",checked:At,onChange:W=>Oe(W.target.checked),style:G.checkbox}),r.jsx("span",{children:""})]}),r.jsx("small",{style:G.hint,children:""})]}),r.jsx("button",{onClick:ri,style:G.saveBtn,children:" "})]})]}),r.jsxs("div",{style:G.collapsibleCard,children:[r.jsxs("button",{type:"button",style:G.collapsibleHeader,onClick:()=>ka(W=>!W),children:[r.jsxs("div",{style:G.collapsibleTitleRow,children:[r.jsx("span",{children:" "}),r.jsx("span",{style:G.collapsibleHint,children:ur?"":""})]}),r.jsx("div",{style:G.collapsibleSummary,children:ed})]}),ur&&r.jsxs("div",{style:G.collapseBody,children:[r.jsxs("p",{style:G.info,children:["NPC",r.jsx("br",{}),r.jsx("small",{style:{color:"#999"},children:"AI"})]}),r.jsxs("div",{style:G.formGroup,children:[r.jsxs("label",{style:G.checkboxLabel,children:[r.jsx("input",{type:"checkbox",checked:P,onChange:W=>pe(W.target.checked),style:G.checkbox}),r.jsx("span",{children:"AI"})]}),r.jsx("small",{style:G.hint,children:"API Key"})]}),r.jsxs("div",{style:G.formGroup,children:[r.jsxs("label",{style:G.checkboxLabel,children:[r.jsx("input",{type:"checkbox",checked:fe,onChange:W=>ke(W.target.checked),style:G.checkbox}),r.jsx("span",{children:""})]}),r.jsx("small",{style:G.hint,children:""})]}),r.jsxs("div",{style:G.formGroup,children:[r.jsxs("label",{style:G.checkboxLabel,children:[r.jsx("input",{type:"checkbox",checked:je,onChange:W=>Ge(W.target.checked),style:G.checkbox}),r.jsx("span",{children:""})]}),r.jsx("small",{style:G.hint,children:""})]}),r.jsx("button",{onClick:ri,style:G.saveBtn,children:" "})]})]}),r.jsxs("div",{style:G.collapsibleCard,children:[r.jsxs("button",{type:"button",style:G.collapsibleHeader,onClick:()=>ys(W=>!W),children:[r.jsxs("div",{style:G.collapsibleTitleRow,children:[r.jsx("span",{children:" "}),r.jsx("span",{style:G.collapsibleHint,children:Ea?"":""})]}),r.jsx("div",{style:G.collapsibleSummary,children:Ta})]}),Ea&&r.jsxs("div",{style:G.collapseBody,children:[r.jsxs("p",{style:G.info,children:[" AI ",r.jsx("br",{}),r.jsx("small",{style:{color:"#999"},children:""}),r.jsx("br",{}),r.jsx("small",{style:{color:"#999"},children:"/ AI "})]}),r.jsxs("div",{style:G.formGroup,children:[r.jsxs("label",{style:G.checkboxLabel,children:[r.jsx("input",{type:"checkbox",checked:Jt,onChange:W=>_t(W.target.checked),style:G.checkbox}),r.jsx("span",{children:" AI "})]}),r.jsx("small",{style:G.hint,children:" API Key"})]}),r.jsx("button",{onClick:ri,style:G.saveBtn,children:" "})]})]}),r.jsxs("div",{style:G.collapsibleCard,children:[r.jsxs("button",{type:"button",style:G.collapsibleHeader,onClick:()=>Ae(W=>!W),children:[r.jsxs("div",{style:G.collapsibleTitleRow,children:[r.jsx("span",{children:" "}),r.jsx("span",{style:G.collapsibleHint,children:bs?"":""})]}),r.jsx("div",{style:G.collapsibleSummary,children:Ia})]}),bs&&r.jsxs("div",{style:G.collapseBody,children:[r.jsxs("p",{style:G.info,children:["",q.enabled&&r.jsx("span",{style:{color:"#4caf50",fontWeight:"bold"},children:"  "})]}),r.jsxs("div",{style:{background:"linear-gradient(135deg, #667eea 0%, #764ba2 100%)",borderRadius:"8px",padding:"15px",marginBottom:"20px",color:"white"},children:[r.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"10px"},children:[r.jsx("h5",{style:{margin:0,fontSize:"16px"},children:" 3"}),Y.some(W=>W.exists)&&r.jsx("button",{onClick:eo,style:{background:"rgba(255,255,255,0.2)",border:"1px solid rgba(255,255,255,0.3)",color:"white",padding:"4px 10px",borderRadius:"4px",fontSize:"11px",cursor:"pointer"},children:" "})]}),r.jsx("p",{style:{fontSize:"12px",margin:"0 0 15px 0",opacity:.9},children:" 3"}),Y.length===0?r.jsx("div",{style:{background:"rgba(255,255,255,0.1)",borderRadius:"5px",padding:"15px",textAlign:"center",fontSize:"13px"},children:""}):r.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"10px"},children:[Y.filter(W=>W.exists).map(W=>r.jsxs("div",{style:{background:"rgba(255,255,255,0.15)",borderRadius:"6px",padding:"12px",backdropFilter:"blur(10px)"},children:[r.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"8px"},children:[r.jsxs("div",{style:{fontSize:"13px",fontWeight:"bold"},children:["#",W.slot," - ",W.gameTime||""]}),r.jsx("div",{style:{background:"rgba(76, 175, 80, 0.8)",padding:"2px 8px",borderRadius:"10px",fontSize:"11px"},children:W.tier||""})]}),r.jsxs("div",{style:{fontSize:"11px",opacity:.9,marginBottom:"8px"},children:[r.jsxs("div",{children:[": ",W.playerName||""," | : ",W.cultivation||0," | : ",W.age||0,""]}),r.jsxs("div",{children:[": ",W.saveDate||""]})]}),r.jsx("button",{onClick:()=>id(W.slot),style:{background:"rgba(33, 150, 243, 0.9)",border:"none",color:"white",padding:"6px 15px",borderRadius:"4px",fontSize:"12px",cursor:"pointer",width:"100%",fontWeight:"bold"},children:" "})]},W.slot)),Y.filter(W=>W.exists).length===0&&r.jsx("div",{style:{background:"rgba(255,255,255,0.1)",borderRadius:"5px",padding:"15px",textAlign:"center",fontSize:"13px"},children:""})]})]}),r.jsxs("div",{style:{background:"#fff3cd",border:"1px solid #ffc107",borderRadius:"8px",padding:"12px",marginBottom:"15px"},children:[r.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"10px"},children:[r.jsx("div",{style:{fontSize:"14px",fontWeight:"bold",color:"#856404"},children:" "}),r.jsx("span",{style:{fontSize:"11px",color:"#856404",opacity:.8},children:"3+"})]}),r.jsxs("div",{style:{fontSize:"12px",color:"#856404",marginBottom:"10px",lineHeight:"1.5"},children:[" 3",r.jsx("br",{}),' ""',r.jsx("br",{})," ",r.jsx("br",{})," NPC"]}),r.jsx("button",{onClick:()=>{window.showConfirm&&window.showConfirm(`

- 3
- 
- 

""`,()=>{si()})},style:{background:"#ffc107",border:"none",color:"#000",padding:"8px 16px",borderRadius:"4px",fontSize:"13px",fontWeight:"bold",cursor:"pointer",width:"100%"},children:" "})]}),q.enabled&&r.jsxs("div",{style:{background:"#e8f5e9",border:"1px solid #4caf50",borderRadius:"5px",padding:"10px",marginBottom:"15px",fontSize:"12px"},children:[r.jsx("div",{style:{fontWeight:"bold",marginBottom:"5px",color:"#2e7d32"},children:" TapTap "}),r.jsxs("div",{style:{color:"#555"},children:[" ",r.jsx("br",{})," ",r.jsx("br",{})," ",r.jsx("br",{})," 1/"]}),q.syncing&&r.jsx("div",{style:{marginTop:"8px",color:"#ff9800"},children:" ..."})]}),r.jsxs("div",{style:{background:"#f5f5f5",padding:"10px",borderRadius:"5px",marginBottom:"15px",fontSize:"12px"},children:[r.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:"5px"},children:[r.jsx("span",{children:" :"}),r.jsxs("span",{children:[r.jsxs("strong",{children:[B.usedMB," MB"]})," / 100 MB"]})]}),r.jsx("div",{style:{height:"8px",background:"#ddd",borderRadius:"4px",overflow:"hidden"},children:r.jsx("div",{style:{height:"100%",background:B.usedMB>80?"#f44336":B.usedMB>60?"#ff9800":"#4caf50",width:`${Math.min(B.usedMB/100*100,100)}%`,transition:"width 0.3s"}})}),B.usedMB>80&&r.jsx("div",{style:{color:"#f44336",marginTop:"5px",fontSize:"11px"},children:" "})]}),r.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"15px"},children:T.length===0?r.jsx("div",{style:{padding:"20px",textAlign:"center",color:"#999",background:"#f5f5f5",borderRadius:"5px"},children:"..."}):T.map(W=>r.jsxs("div",{style:G.slotCard,children:[r.jsxs("div",{style:G.slotHeader,children:[r.jsxs("span",{style:G.slotTitle,children:[" ",W.slot]}),W.exists&&r.jsx("span",{style:G.slotBadge,children:""})]}),W.exists?r.jsxs("div",{style:G.slotInfo,children:[r.jsxs("div",{style:{fontSize:"12px",color:"#666",marginBottom:"8px"},children:[r.jsxs("div",{children:[": ",W.playerName]}),W.cultivation>0&&r.jsxs("div",{children:[": ",W.cultivation," "]}),r.jsxs("div",{children:[": ",W.saveDate]})]}),r.jsxs("div",{style:{...G.btnGroup,gap:"8px",flexWrap:"wrap"},children:[r.jsx("button",{onClick:()=>Ma(W.slot),style:{...G.slotBtn,background:"#4caf50",color:"white"},children:" "}),r.jsx("button",{onClick:()=>Zs(W.slot),style:{...G.slotBtn,background:"#2196f3",color:"white"},children:" "}),r.jsx("button",{onClick:()=>od(W.slot),style:{...G.slotBtn,background:"#f44336",color:"white"},children:" "}),q.enabled&&r.jsxs(r.Fragment,{children:[r.jsx("button",{onClick:()=>ld(W.slot),style:{...G.slotBtn,background:"#ff9800",color:"white"},disabled:re,children:" "}),r.jsx("button",{onClick:()=>oi(W.slot),style:{...G.slotBtn,background:"#9c27b0",color:"white"},disabled:re,children:" "})]})]})]}):r.jsxs("div",{style:G.slotInfo,children:[r.jsx("div",{style:{fontSize:"13px",color:"#999",marginBottom:"10px"},children:""}),r.jsxs("div",{style:{...G.btnGroup,gap:"8px"},children:[r.jsx("button",{onClick:()=>Ma(W.slot),style:{...G.slotBtn,background:"#4caf50",color:"white",flex:1},children:" "}),q.enabled&&r.jsx("button",{onClick:()=>oi(W.slot),style:{...G.slotBtn,background:"#9c27b0",color:"white",flex:1},disabled:re,children:" "})]})]})]},W.slot))})]})]}),r.jsxs("div",{style:G.collapsibleCard,children:[r.jsxs("button",{type:"button",style:G.collapsibleHeader,onClick:()=>Gc(W=>!W),children:[r.jsxs("div",{style:G.collapsibleTitleRow,children:[r.jsx("span",{children:" /"}),r.jsx("span",{style:G.collapsibleHint,children:Xn?"":""})]}),r.jsx("div",{style:G.collapsibleSummary,children:""})]}),Xn&&r.jsx("div",{style:G.collapseBody,children:r.jsx(DC,{gameState:R||{player:e,children:[],fallenChildren:[],activeNpcs:[],deadNpcs:[],inventory:[],logs:[],messages:{},lastMessageCheck:{},gameStage:"MAIN",pendingSectChoices:null,testQueue:[],worldEvents:[],newsBuffer:[]},onLoadGame:n,playerName:(e==null?void 0:e.name)||""})})]}),r.jsxs("div",{style:G.collapsibleCard,children:[r.jsxs("button",{type:"button",style:G.collapsibleHeader,onClick:()=>Zn(W=>!W),children:[r.jsxs("div",{style:G.collapsibleTitleRow,children:[r.jsx("span",{children:" "}),r.jsx("span",{style:G.collapsibleHint,children:en?"":""})]}),r.jsx("div",{style:G.collapsibleSummary,children:""})]}),en&&r.jsxs("div",{style:G.collapseBody,children:[r.jsxs("div",{style:G.formGroup,children:[r.jsx("label",{style:G.label,children:""}),r.jsx("input",{type:"text",value:Qs,onChange:W=>ks(W.target.value),placeholder:"",style:G.input}),r.jsx("span",{style:G.hint,children:""})]}),r.jsx("button",{onClick:Xo,style:{...G.btn,background:"#ffb74d",color:"#4e342e",border:"none",width:"100%"},children:" "}),er&&r.jsx("div",{style:{...G.statusBox,background:er.success?"#e8f5e9":"#ffebee",color:er.success?"#2e7d32":"#c62828",marginTop:"12px"},children:er.message})]})]}),r.jsxs("div",{style:G.collapsibleCard,children:[r.jsxs("button",{type:"button",style:G.collapsibleHeader,onClick:()=>Vc(W=>!W),children:[r.jsxs("div",{style:G.collapsibleTitleRow,children:[r.jsx("span",{children:" "}),r.jsx("span",{style:G.collapsibleHint,children:vs?"":""})]}),r.jsx("div",{style:G.collapsibleSummary,children:td})]}),vs&&r.jsxs("div",{style:G.collapseBody,children:[r.jsx("p",{style:G.info,children:""}),r.jsx("button",{onClick:o,style:{...G.btn,background:"#2196f3",color:"white",border:"none",width:"100%"},children:" "})]})]}),r.jsxs("div",{style:{...G.card,borderColor:"#d32f2f",background:"#ffebee"},children:[r.jsx("h4",{style:{color:"#d32f2f"},children:" "}),r.jsx("p",{style:{fontSize:"12px",color:"#666"},children:"Bug"}),r.jsx("button",{onClick:ad,style:G.resetBtn,children:" "})]}),r.jsxs("div",{style:{textAlign:"center",marginTop:"30px",color:"#999",fontSize:"12px"},children:[r.jsx("p",{children:": v1.2.0 Alpha"}),r.jsxs("p",{children:["5MB",r.jsx("br",{}),q.enabled?" ":"  TapTap "]}),r.jsxs("p",{style:{marginTop:"8px",fontSize:"11px"},children:[" ",r.jsx("br",{}),"100"]})]})]})},G={card:{background:"white",padding:"15px",borderRadius:"8px",border:"1px solid #ddd",marginBottom:"20px"},info:{marginBottom:"15px",fontSize:"14px",color:"#555"},btnGroup:{display:"flex",gap:"10px"},btn:{flex:1,padding:"10px",cursor:"pointer",borderRadius:"5px",border:"1px solid #ccc",background:"#f5f5f5"},saveBtn:{flex:1,padding:"10px",cursor:"pointer",borderRadius:"5px",border:"none",background:"#4caf50",color:"white",fontWeight:"bold"},resetBtn:{width:"100%",padding:"10px",cursor:"pointer",borderRadius:"5px",border:"none",background:"#d32f2f",color:"white"},formGroup:{marginBottom:"15px"},label:{display:"block",marginBottom:"5px",fontSize:"13px",fontWeight:"bold",color:"#333"},checkboxLabel:{display:"flex",alignItems:"center",gap:"8px",fontSize:"14px",color:"#333",cursor:"pointer"},checkbox:{width:"18px",height:"18px",cursor:"pointer"},input:{width:"100%",padding:"10px",borderRadius:"5px",border:"1px solid #ddd",fontSize:"14px",boxSizing:"border-box"},select:{width:"100%",padding:"10px",borderRadius:"5px",border:"1px solid #ddd",fontSize:"14px",boxSizing:"border-box",cursor:"pointer",background:"white"},hint:{display:"block",marginTop:"5px",fontSize:"11px",color:"#999",lineHeight:"1.4"},statusBox:{padding:"10px",borderRadius:"5px",marginBottom:"15px",fontSize:"13px",fontWeight:"bold"},slotCard:{background:"#f9f9f9",padding:"12px",borderRadius:"6px",border:"1px solid #e0e0e0"},slotHeader:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"10px"},slotTitle:{fontSize:"14px",fontWeight:"bold",color:"#333"},slotBadge:{fontSize:"11px",padding:"3px 8px",borderRadius:"10px",background:"#4caf50",color:"white"},slotInfo:{marginTop:"8px"},slotBtn:{flex:1,padding:"8px",cursor:"pointer",borderRadius:"4px",border:"none",fontSize:"12px",fontWeight:"bold"},collapsibleCard:{background:"white",border:"1px solid #ddd",borderRadius:"10px",marginBottom:"20px",overflow:"hidden",boxShadow:"0 4px 12px rgba(0,0,0,0.04)"},collapsibleHeader:{width:"100%",background:"linear-gradient(120deg, #f5efe6, #fff)",border:"none",padding:"14px",textAlign:"left",cursor:"pointer"},collapsibleTitleRow:{display:"flex",justifyContent:"space-between",alignItems:"center",fontWeight:"bold",color:"#4e342e"},collapsibleHint:{fontSize:"12px",color:"#8d6e63"},collapsibleSummary:{marginTop:"6px",fontSize:"12px",color:"#6d4c41"},collapseBody:{padding:"14px",borderTop:"1px solid #f0e0d6",background:"#fff"},optionGroup:{display:"flex",flexDirection:"column",gap:"8px"},optionCard:{background:"rgba(249, 246, 243, 0.9)",borderRadius:"8px",border:"1px solid #efe0d4",padding:"8px"},optionRow:{display:"flex",gap:"10px",alignItems:"center"},optionToggle:{display:"flex",alignItems:"center",gap:"6px",fontSize:"12px",color:"#5d4037"},optionText:{flex:1,border:"none",background:"transparent",textAlign:"left",padding:0,cursor:"pointer",color:"#4e342e"},optionTitleRow:{display:"flex",justifyContent:"space-between",alignItems:"center",fontSize:"13px",fontWeight:600},detailHint:{fontSize:"12px",color:"#8d6e63"},optionBrief:{fontSize:"11px",color:"#6d4c41",marginTop:"2px"},optionDetail:{marginTop:"6px",padding:"8px",borderRadius:"6px",background:"#fff",border:"1px dashed #e0c5b4",fontSize:"11px",color:"#5d4037",lineHeight:1.5,whiteSpace:"pre-line"},familyActionCard:{marginTop:"12px",padding:"14px",borderRadius:"10px",border:"1px solid #e0c5b4",background:"linear-gradient(135deg, #fff7ec 0%, #fde2cf 100%)"},familyActionHeader:{display:"flex",justifyContent:"space-between",alignItems:"center",fontSize:"13px",fontWeight:600,color:"#4e342e",marginBottom:"6px"},familyActionDesc:{fontSize:"12px",color:"#6d4c41",lineHeight:1.5,margin:"8px 0 12px 0"},familyActionBtn:{width:"100%",padding:"10px",border:"none",borderRadius:"999px",cursor:"pointer",background:"linear-gradient(120deg, #ff9a62, #ff6f3c)",color:"#fff",fontWeight:"bold",fontSize:"14px",boxShadow:"0 4px 10px rgba(255, 111, 60, 0.3)"}},HC=(e,t)=>{var n;if(Pm[t]){const s=Pm[t];e.cultivationMethod=s;const o=((n=hn[s])==null?void 0:n.name)||s;return`${e.name}  ${t}${o}`}return null},zh=(e,t)=>{const n=hn[t];if(!n)return{success:!1,message:""};const s=e.cultivationMethod,o=hn[s];e.cultivationMethod=t;const i=vf(t,e.spiritRoot);return{success:!0,message:`${e.name} ${(o==null?void 0:o.name)||""}${n.name}`,compatibility:i}},vc=(e,t)=>{const n=C2(e);if(!n)return{manual:null,compatibility:null};const s=vf(e,t);return{manual:n,compatibility:s,speedBonus:`${(s.compatibility*n.baseBuff*100).toFixed(0)}%`}},WC=({player:e,childFeedback:t=0,onOpenInventory:n,onAllocateSkillPoint:s})=>{var R,T,N,Y;const[o,i]=y.useState(!1);if(!e||!e.stats||!e.resources)return r.jsx("div",{style:{padding:"20px",textAlign:"center",color:"#999"},children:"..."});const a=jf(e.stats.aptitude),l=Dc(e,!0),d=l+t,u=Cn(e.tier),p=(u==null?void 0:u.chance)??0,c=(e.breakthroughBonus||0)/100,f=Math.min(.95,p+c);e.currentExp>=e.maxExp&&!u&&console.warn(` "${e.tier}" `);const S=((e.stats.aptitude||50)/50).toFixed(2),E=((R=e.spiritRoot)==null?void 0:R.multiplier)||1,j=((N=(T=e.trait)==null?void 0:T.bonuses)==null?void 0:N.speedMultiplier)??((Y=e.trait)==null?void 0:Y.effect)??1,x=e.sect&&e.sect.level!=="NONE"?1.5:1,h=e.cultivationMethod&&e.spiritRoot?Sf(e.cultivationMethod,e.spiritRoot):1,v=e.cultivationMethod||"basic_breath",g=e.spiritRoot?vc(v,e.spiritRoot):null,I=ms(e||{}),_=Math.floor(e.currentExp||0),C=Math.max(1,Math.floor(e.maxExp||1)),k=Math.min(100,Math.round(_/C*100));return r.jsxs("div",{style:me.container,children:[r.jsx("h3",{style:me.title,children:" "}),r.jsxs("div",{style:me.content,children:[r.jsxs("div",{style:me.topSection,children:[r.jsx("div",{style:me.avatarContainer,children:r.jsx(Hr,{dna:e.avatar,gender:e.gender,size:80})}),r.jsxs("div",{style:me.basicInfo,children:[r.jsx("h2",{style:me.playerName,children:e.name}),r.jsx("div",{style:me.tierBadge,children:e.tier}),r.jsx("div",{style:{display:"flex",gap:"8px",alignItems:"center"},children:r.jsxs("div",{style:me.ageText,children:[Math.floor(e.age),""]})})]})]}),r.jsxs("div",{style:me.resourceStatsBox,children:[r.jsxs("div",{style:me.resourceRow,children:[r.jsxs("div",{style:me.resourceStatItem,children:[r.jsx("span",{style:me.resourceIcon,children:""}),r.jsxs("div",{style:me.resourceInfo,children:[r.jsx("div",{style:me.resourceLabel,children:""}),r.jsx("div",{style:me.resourceValue,children:e.resources.spiritStones})]})]}),r.jsxs("div",{style:me.resourceStatItem,children:[r.jsx("span",{style:me.resourceIcon,children:""}),r.jsxs("div",{style:me.resourceInfo,children:[r.jsx("div",{style:me.resourceLabel,children:""}),r.jsx("div",{style:me.resourceValue,children:I.total})]})]})]}),r.jsxs("div",{style:me.expSection,children:[r.jsx("div",{style:me.expLabel,children:""}),r.jsxs("div",{style:me.expBarWrapper,children:[r.jsx("div",{style:{...me.expBarFill,width:`${k}%`}}),r.jsxs("div",{style:me.expText,children:[_,"/",C]})]})]})]}),r.jsxs("div",{style:me.mainSection,children:[r.jsxs("div",{style:me.section,children:[r.jsx("h4",{children:" "}),e.spiritRoot?r.jsxs(r.Fragment,{children:[r.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"10px",marginBottom:"10px"},children:[r.jsx("strong",{style:{color:a.color,fontSize:"16px"},children:e.spiritRoot.type}),r.jsx("div",{style:{display:"flex",gap:"4px"},children:e.spiritRoot.elements.map(H=>{const B=$=>({:"#FFD700",:"#4CAF50",:"#2196F3",:"#F44336",:"#795548",:"#673AB7",:"#00BCD4",:"#009688"})[$]||"#9e9e9e";return r.jsx("span",{style:{padding:"2px 6px",borderRadius:"10px",color:"white",fontWeight:"bold",fontSize:"10px",background:B(H)},children:H},H)})})]}),r.jsxs("div",{style:me.barContainer,children:[r.jsxs("span",{children:[" (",e.stats.aptitude,")"]}),r.jsx("div",{style:me.barBg,children:r.jsx("div",{style:{...me.barFill,width:`${e.stats.aptitude}%`,background:a.color}})})]}),r.jsx("p",{style:{fontSize:"12px",color:"#666",marginTop:"5px"},children:e.spiritRoot.desc})]}):r.jsx("div",{style:{padding:"10px",background:"rgba(0,0,0,0.2)",borderRadius:"8px",fontSize:"13px",color:"rgba(255,255,255,0.75)"},children:""})]}),r.jsxs("div",{style:me.section,children:[r.jsx("h4",{children:" "}),e.spiritRoot?g!=null&&g.manual?r.jsxs("div",{style:me.manualCard,children:[r.jsxs("div",{style:me.manualHeader,children:[r.jsxs("div",{style:me.manualName,children:[g.manual.name,r.jsx("span",{style:{...me.manualTierBadge,background:g.manual.tierColor},children:g.manual.tierName})]}),g.manual.element!=="NONE"&&r.jsx("span",{style:me.manualElementBadge,children:g.manual.element})]}),r.jsx("p",{style:me.manualDesc,children:g.manual.desc}),g.compatibility&&r.jsxs("div",{style:me.manualMetaRow,children:[r.jsxs("span",{children:["",r.jsx("strong",{style:{color:g.compatibility.color},children:g.compatibility.desc})]}),r.jsxs("span",{children:["",r.jsxs("strong",{style:{color:"#64ffda"},children:["+",g.speedBonus]})]})]}),r.jsxs("div",{style:me.manualMetaRow,children:[r.jsxs("span",{children:["",g.manual.source||""]}),r.jsxs("span",{children:["",g.manual.element==="NONE"?"":g.manual.element]})]})]}):r.jsx("div",{style:me.manualPlaceholder,children:""}):r.jsx("div",{style:me.manualPlaceholder,children:""})]}),r.jsxs("div",{style:me.section,children:[r.jsx("h4",{children:" "}),r.jsxs("div",{style:me.barContainer,children:[r.jsxs("span",{children:[" (",_,"/",C,")"]}),r.jsx("div",{style:me.barBg,children:r.jsx("div",{style:{...me.barFill,width:`${k}%`,background:"#4CAF50"}})})]}),e.currentExp>=e.maxExp&&r.jsx("div",{style:{marginTop:"10px",padding:"10px",background:"rgba(255,193,7,0.15)",borderRadius:"8px",border:"1px solid #FFC107"},children:u?r.jsxs(r.Fragment,{children:[r.jsxs("div",{style:{fontSize:"13px",color:"#F57C00",fontWeight:"bold",marginBottom:"4px"},children:[" : ",(f*100).toFixed(1),"%"]}),r.jsxs("div",{style:{fontSize:"11px",color:"rgba(245,124,0,0.8)"},children:[": ",(p*100).toFixed(1),"%",c>0&&` | : +${(c*100).toFixed(1)}%`]})]}):r.jsx("div",{style:{fontSize:"12px",color:"#f44336"},children:" "})}),r.jsxs("div",{style:me.speedInfo,children:[r.jsxs("div",{style:me.speedHeader,children:[r.jsxs("span",{style:{fontWeight:"bold",color:"#4CAF50"},children:[" : ",d,"/"]}),t>0&&r.jsxs("span",{style:{fontSize:"12px",color:"#666",marginLeft:"8px"},children:["( ",l," +  ",t,")"]})]}),r.jsxs("div",{style:me.speedFormula,children:[r.jsx("div",{style:{fontSize:"11px",color:"#666",marginBottom:"4px"},children:": (10/)          "}),r.jsxs("div",{style:me.speedBreakdown,children:[r.jsxs("span",{style:me.speedItem,children:[r.jsx("span",{style:{color:"#888"},children:":"})," ",S]}),r.jsxs("span",{style:me.speedItem,children:[r.jsx("span",{style:{color:"#888"},children:":"})," ",E]}),r.jsxs("span",{style:me.speedItem,children:[r.jsx("span",{style:{color:"#888"},children:":"})," ",h.toFixed(2)]}),r.jsxs("span",{style:me.speedItem,children:[r.jsx("span",{style:{color:"#888"},children:":"})," ",j]}),r.jsxs("span",{style:me.speedItem,children:[r.jsx("span",{style:{color:"#888"},children:":"})," ",x]})]}),r.jsxs("div",{style:{fontSize:"10px",color:"#999",marginTop:"4px",fontStyle:"italic"},children:["= 10  ",S,"  ",E,"  ",h.toFixed(2),"  ",j,"  ",x," = ",l]}),t>0&&r.jsxs("div",{style:{fontSize:"11px",color:"#4CAF50",marginTop:"6px",paddingTop:"6px",borderTop:"1px dashed #ddd"},children:[" : +",t,"/"]})]})]})]}),r.jsxs("div",{style:me.section,children:[r.jsx("h4",{children:" "}),r.jsxs("div",{style:me.statsGrid,children:[r.jsxs("div",{style:me.statItem,children:[r.jsx("div",{style:me.statLabel,children:""}),r.jsx("div",{style:me.statValue,children:e.stats.looks}),r.jsx("div",{style:me.statBar,children:r.jsx("div",{style:{...me.statBarFill,width:`${e.stats.looks}%`,background:"#FF6B6B"}})})]}),r.jsxs("div",{style:me.statItem,children:[r.jsx("div",{style:me.statLabel,children:""}),r.jsx("div",{style:me.statValue,children:e.stats.cunning}),r.jsx("div",{style:me.statBar,children:r.jsx("div",{style:{...me.statBarFill,width:`${e.stats.cunning}%`,background:"#4ECDC4"}})})]}),r.jsxs("div",{style:me.statItem,children:[r.jsx("div",{style:me.statLabel,children:""}),r.jsx("div",{style:me.statValue,children:e.stats.health}),r.jsx("div",{style:me.statBar,children:r.jsx("div",{style:{...me.statBarFill,width:`${e.stats.health}%`,background:e.stats.health<30?"#F44336":e.stats.health<60?"#FFC107":"#45B7D1"}})}),r.jsxs("div",{style:{fontSize:"10px",color:"#ccc",marginTop:"4px",opacity:.8},children:[": ",$t(e.stats.health).toFixed(1),"/20"]})]}),r.jsxs("div",{style:me.statItem,children:[r.jsx("div",{style:me.statLabel,children:""}),r.jsx("div",{style:me.statValue,children:e.stats.intelligence}),r.jsx("div",{style:me.statBar,children:r.jsx("div",{style:{...me.statBarFill,width:`${e.stats.intelligence}%`,background:"#96CEB4"}})})]})]}),r.jsx("div",{style:{display:"flex",justifyContent:"center",marginTop:"12px"},children:r.jsx("button",{onClick:()=>i(H=>!H),style:me.detailsBtn,children:o?" ":" "})}),o&&r.jsx("div",{style:{marginTop:"15px",padding:"12px",background:"rgba(0,0,0,0.3)",borderRadius:"8px",border:"1px solid rgba(255,255,255,0.1)"},children:r.jsxs("div",{style:{fontSize:"12px",color:"#eee",lineHeight:1.8},children:[["looks","cunning","health","intelligence"].map(H=>{const B=tw(H),$=e.stats[H];let q=`${B.desc}`;if(H==="health"){const se=$t($);q+=` (: ${se.toFixed(1)}/20)`}return r.jsxs("div",{style:{marginBottom:"8px",padding:"8px",background:"rgba(255,255,255,0.05)",borderRadius:"6px"},children:[r.jsxs("div",{style:{fontWeight:"bold",color:"#64ffda",marginBottom:"4px"},children:[B.name," (",$,"/100)"]}),r.jsx("div",{style:{opacity:.85,fontSize:"11px"},children:q}),B.trainable&&r.jsxs("div",{style:{opacity:.7,fontSize:"10px",marginTop:"4px",color:"#4CAF50"},children:[" ",B.howToIncrease]})]},H)}),r.jsx("div",{style:{marginTop:"12px",paddingTop:"12px",borderTop:"1px dashed rgba(255,255,255,0.2)",opacity:.75,fontSize:"11px"},children:r.jsxs("div",{style:{marginBottom:"4px"},children:["  ",e.stats.aptitude," ",e.stats.luck," ",e.stats.lifespan]})})]})})]}),r.jsxs("div",{style:me.section,children:[r.jsx("h4",{children:" "}),r.jsxs("div",{style:me.resourcesGrid,children:[r.jsxs("div",{style:me.resourceItem,children:[r.jsx("span",{children:":"})," ",r.jsx("span",{style:{fontWeight:"bold"},children:e.resources.spiritStones})]}),r.jsxs("div",{style:me.resourceItem,children:[r.jsx("span",{children:":"}),r.jsx("span",{style:{fontWeight:"bold",color:"#FF9800"},children:e.skillPoints||0})]})]}),(e.skillPoints||0)>0&&r.jsxs("div",{style:{marginTop:"10px",padding:"10px",background:"#FFF3E0",borderRadius:"8px",border:"1px solid #FFB74D"},children:[r.jsxs("div",{style:{fontSize:"12px",color:"#E65100",marginBottom:"8px"},children:[" : ",e.skillPoints]}),r.jsxs("div",{style:{display:"flex",gap:"8px"},children:[r.jsx("button",{onClick:()=>s&&s("aptitude"),style:{...me.allocateBtn,background:"#9C27B0"},children:"+"}),r.jsx("button",{onClick:()=>s&&s("combatPower"),style:{...me.allocateBtn,background:"#F44336"},children:"+"}),r.jsx("button",{onClick:()=>s&&s("breakthrough"),style:{...me.allocateBtn,background:"#FF9800"},children:"+"})]})]}),e.breakthroughBonus>0&&r.jsx("div",{style:{marginTop:"10px",padding:"8px",background:"rgba(255,152,0,0.1)",borderRadius:"8px",border:"1px solid #FF9800"},children:r.jsxs("div",{style:{fontSize:"12px",color:"#F57C00"},children:[" : +",e.breakthroughBonus,"%",e.breakthroughFailCount>0&&r.jsxs("span",{style:{marginLeft:"8px",opacity:.8},children:["(: ",e.breakthroughFailCount,")"]})]})})]}),r.jsxs("div",{style:me.section,children:[r.jsx("h4",{children:" "}),r.jsx("button",{onClick:n,style:me.inventoryBtn,children:""})]})]})]})]})},me={container:{background:"linear-gradient(135deg, #667eea 0%, #764ba2 100%)",borderRadius:"16px",padding:"20px",color:"white",boxShadow:"0 8px 32px rgba(0,0,0,0.3)",marginBottom:"20px"},title:{margin:"0 0 20px 0",fontSize:"24px",textAlign:"center",textShadow:"2px 2px 4px rgba(0,0,0,0.3)"},content:{display:"flex",flexDirection:"column",gap:"16px"},topSection:{display:"flex",alignItems:"center",gap:"16px",padding:"16px",background:"rgba(255,255,255,0.1)",borderRadius:"12px",backdropFilter:"blur(10px)"},mainSection:{display:"flex",flexDirection:"column",gap:"15px"},avatarContainer:{background:"rgba(255,255,255,0.15)",borderRadius:"50%",padding:"8px",boxShadow:"0 4px 12px rgba(0,0,0,0.3)",flexShrink:0},basicInfo:{flex:1,display:"flex",flexDirection:"column",gap:"6px"},playerName:{margin:0,fontSize:"20px",fontWeight:"bold"},tierBadge:{background:"rgba(255,255,255,0.25)",padding:"4px 12px",borderRadius:"16px",fontSize:"13px",display:"inline-block",border:"1px solid rgba(255,255,255,0.3)",fontWeight:"600"},ageText:{fontSize:"14px",opacity:.9},section:{background:"rgba(255,255,255,0.1)",borderRadius:"12px",padding:"15px",backdropFilter:"blur(10px)"},barContainer:{marginBottom:"10px"},barBg:{background:"rgba(0,0,0,0.3)",borderRadius:"10px",height:"20px",marginTop:"5px",overflow:"hidden",position:"relative"},barFill:{height:"100%",borderRadius:"10px",transition:"width 0.5s ease",position:"relative",overflow:"hidden"},speedInfo:{marginTop:"10px",padding:"10px",background:"rgba(255,255,255,0.1)",borderRadius:"8px",fontSize:"12px"},speedHeader:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"8px"},statsGrid:{display:"grid",gridTemplateColumns:"1fr",gap:"12px"},statItem:{display:"grid",gridTemplateColumns:"60px 40px 1fr",gap:"8px",alignItems:"center"},statLabel:{fontSize:"14px"},statValue:{fontWeight:"bold",fontSize:"14px"},statBar:{background:"rgba(0,0,0,0.3)",borderRadius:"10px",height:"16px",overflow:"hidden"},statBarFill:{height:"100%",borderRadius:"10px",transition:"width 0.5s ease"},resourcesGrid:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"10px"},resourceItem:{display:"flex",justifyContent:"space-between",padding:"8px",background:"rgba(255,255,255,0.1)",borderRadius:"8px"},allocateBtn:{flex:1,padding:"8px 16px",border:"none",borderRadius:"8px",color:"white",fontWeight:"bold",cursor:"pointer",fontSize:"14px",transition:"transform 0.2s, box-shadow 0.2s",boxShadow:"0 2px 8px rgba(0,0,0,0.2)"},inventoryBtn:{width:"100%",padding:"10px",background:"rgba(255,255,255,0.2)",border:"1px solid rgba(255,255,255,0.3)",borderRadius:"8px",color:"white",cursor:"pointer",fontWeight:"bold",transition:"all 0.3s"},speedFormula:{fontSize:"12px"},speedBreakdown:{display:"flex",flexWrap:"wrap",gap:"8px",marginTop:"6px",marginBottom:"4px"},speedItem:{fontSize:"11px",padding:"2px 6px",backgroundColor:"rgba(255,255,255,0.1)",borderRadius:"3px",border:"1px solid rgba(255,255,255,0.2)"},detailsBtn:{padding:"8px 16px",borderRadius:"8px",border:"1px solid rgba(255,255,255,0.3)",background:"rgba(100,255,218,0.1)",color:"#64ffda",cursor:"pointer",fontSize:"13px",fontWeight:"500",transition:"all 0.3s ease",hover:{background:"rgba(100,255,218,0.2)"}},resourceStatsBox:{background:"linear-gradient(135deg, rgba(76,175,80,0.15) 0%, rgba(129,199,132,0.1) 100%)",borderRadius:"12px",padding:"15px",marginBottom:"15px",border:"1px solid rgba(255,255,255,0.2)",backdropFilter:"blur(10px)"},resourceRow:{display:"flex",gap:"15px",marginBottom:"12px"},resourceStatItem:{flex:1,display:"flex",alignItems:"center",padding:"10px",background:"rgba(255,255,255,0.1)",borderRadius:"8px"},resourceInfo:{display:"flex",flexDirection:"column",gap:"2px"},resourceLabel:{fontSize:"11px",color:"rgba(255,255,255,0.7)",fontWeight:"500"},resourceIcon:{fontSize:"24px",marginRight:"8px"},expSection:{marginTop:"8px"},expLabel:{fontSize:"12px",color:"rgba(255,255,255,0.8)",marginBottom:"6px",fontWeight:"500"},expBarWrapper:{position:"relative",height:"24px",backgroundColor:"rgba(0,0,0,0.3)",borderRadius:"12px",overflow:"hidden",border:"1px solid rgba(255,255,255,0.1)"},expBarFill:{position:"absolute",left:0,top:0,height:"100%",background:"linear-gradient(90deg, #4CAF50, #81C784)",transition:"width 0.3s ease",borderRadius:"12px"},expText:{position:"absolute",left:"50%",top:"50%",transform:"translate(-50%, -50%)",fontSize:"11px",fontWeight:"bold",color:"#fff",textShadow:"1px 1px 2px rgba(0,0,0,0.5)",zIndex:1},manualCard:{background:"rgba(255,255,255,0.08)",borderRadius:"12px",padding:"12px 14px",border:"1px solid rgba(255,255,255,0.2)",display:"flex",flexDirection:"column",gap:"8px"},manualHeader:{display:"flex",justifyContent:"space-between",alignItems:"center",gap:"16px"},manualName:{fontSize:"18px",fontWeight:"bold",display:"flex",alignItems:"center",gap:"8px"},manualTierBadge:{padding:"2px 8px",borderRadius:"999px",fontSize:"11px",color:"#fff",fontWeight:"bold"},manualElementBadge:{padding:"4px 12px",background:"rgba(255,255,255,0.2)",borderRadius:"999px",fontSize:"12px",fontWeight:"bold"},manualDesc:{fontSize:"13px",color:"rgba(255,255,255,0.85)",lineHeight:1.6},manualMetaRow:{display:"flex",justifyContent:"space-between",fontSize:"13px",color:"rgba(255,255,255,0.9)"},manualPlaceholder:{padding:"10px 14px",borderRadius:"10px",background:"rgba(0,0,0,0.2)",fontSize:"13px",color:"rgba(255,255,255,0.75)"}},UC={common:"#9e9e9e",uncommon:"#4caf50",rare:"#2196f3",epic:"#9c27b0",legendary:"#ff9800"},GC=e=>!e||!Array.isArray(e.usageTargets)||e.usageTargets.length===0?!0:e.usageTargets.includes(ft.NPC),VC=({npc:e,inventory:t=[],onClose:n,onGift:s})=>{const o=t.filter(u=>["consumable","weapon","armor","accessory"].includes(u.type)&&GC(u)),[i,a]=y.useState({}),l=y.useMemo(()=>{const u=Object.entries(i).filter(([,f])=>f>0),p=u.length,c=u.reduce((f,[,b])=>f+b,0);return{totalKinds:p,totalCount:c}},[i]),d={consumable:"",weapon:"",armor:"",accessory:""};return r.jsx("div",{style:yt.overlay,children:r.jsxs("div",{style:yt.modal,children:[r.jsxs("div",{style:yt.header,children:[r.jsxs("h3",{children:["  ",e.name," "]}),r.jsx("button",{onClick:n,style:yt.closeIcon,children:""})]}),r.jsx("p",{style:{fontSize:"12px",color:"#666",marginBottom:"10px",padding:"0 10px"},children:""}),r.jsx("div",{style:yt.itemList,children:o.length===0?r.jsx("div",{style:yt.empty,children:""}):o.map(u=>r.jsxs("div",{style:yt.itemCard,children:[r.jsxs("div",{style:yt.itemHeader,children:[r.jsxs("label",{style:yt.itemSelect,children:[r.jsx("input",{type:"checkbox",checked:!!i[u.instanceId],onChange:p=>{const c=p.target.checked;a(f=>({...f,[u.instanceId]:c?1:0}))}}),r.jsx("span",{children:""})]}),r.jsx("span",{style:{...yt.itemName,color:UC[u.rarity]||"#333"},children:u.name}),r.jsx("span",{style:yt.itemType,children:d[u.type]||u.type})]}),r.jsx("div",{style:yt.itemDesc,children:u.desc}),r.jsxs("div",{style:yt.itemMetaRow,children:[r.jsxs("span",{style:yt.itemStock,children:[": ",u.quantity||1]}),r.jsxs("div",{style:yt.qtyControls,children:[r.jsx("button",{type:"button",onClick:()=>{const p=i[u.instanceId]||0;if(p<=1){a(c=>({...c,[u.instanceId]:0}));return}a(c=>({...c,[u.instanceId]:p-1}))},disabled:!i[u.instanceId],style:yt.qtyBtn,children:"-"}),r.jsx("input",{type:"number",min:"1",max:u.quantity||1,value:i[u.instanceId]||"",onChange:p=>{const c=parseInt(p.target.value,10);if(Number.isNaN(c)){a(b=>({...b,[u.instanceId]:0}));return}const f=Math.max(1,Math.min(u.quantity||1,c));a(b=>({...b,[u.instanceId]:f}))},placeholder:"",style:yt.qtyInput}),r.jsx("button",{type:"button",onClick:()=>{const p=i[u.instanceId]||0,c=u.quantity||1,f=Math.min(c,p>0?p+1:1);a(b=>({...b,[u.instanceId]:f}))},style:yt.qtyBtn,children:"+"})]})]}),u.stats&&r.jsxs("div",{style:yt.itemStats,children:[u.stats.atk&&r.jsxs("span",{children:["+",u.stats.atk]}),u.stats.hp&&r.jsxs("span",{children:["+",u.stats.hp]}),u.stats.def&&r.jsxs("span",{children:["+",u.stats.def]}),u.stats.mp&&r.jsxs("span",{children:["+",u.stats.mp]})]}),u.effect&&r.jsxs("div",{style:yt.itemEffect,children:[u.effect.kind==="heal"&&`${u.effect.amount}`,u.effect.kind==="exp"&&`+${u.effect.amount}`,u.effect.kind==="aptitude"&&`+${u.effect.amount}`]})]},u.instanceId))}),r.jsxs("div",{style:yt.footer,children:[r.jsxs("div",{style:yt.summary,children:[" ",l.totalKinds,"  /  ",l.totalCount," "]}),r.jsxs("div",{style:yt.footerActions,children:[r.jsx("button",{onClick:n,style:yt.closeBtn,children:""}),r.jsx("button",{onClick:()=>{const u=Object.entries(i).filter(([,p])=>p>0).map(([p,c])=>({instanceId:p,quantity:c}));u.length!==0&&s&&s(u)},disabled:l.totalKinds===0,style:{...yt.primaryBtn,opacity:l.totalKinds===0?.5:1,cursor:l.totalKinds===0?"not-allowed":"pointer"},children:""})]})]})]})})},yt={overlay:{position:"fixed",top:0,left:0,right:0,bottom:0,background:"rgba(0,0,0,0.6)",display:"flex",justifyContent:"center",alignItems:"center",zIndex:200},modal:{width:"450px",maxHeight:"80vh",background:"#fff",borderRadius:"12px",padding:"20px",boxShadow:"0 8px 30px rgba(0,0,0,0.3)",display:"flex",flexDirection:"column"},header:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"15px"},closeIcon:{border:"none",background:"transparent",fontSize:"24px",cursor:"pointer",color:"#666",lineHeight:1},itemList:{flex:1,overflowY:"auto",maxHeight:"400px",marginBottom:"15px"},empty:{textAlign:"center",padding:"40px 20px",color:"#999",fontSize:"14px"},itemCard:{padding:"12px",marginBottom:"8px",background:"#fafafa",borderRadius:"8px",cursor:"pointer",border:"1px solid #eee",transition:"all 0.2s",":hover":{background:"#f5f5f5",borderColor:"#8d6e63"}},itemHeader:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"6px"},itemName:{fontWeight:"bold",fontSize:"14px"},itemType:{fontSize:"11px",padding:"2px 8px",background:"#e0e0e0",borderRadius:"10px",color:"#666"},itemDesc:{fontSize:"12px",color:"#666",marginBottom:"6px"},itemStats:{fontSize:"11px",color:"#1976d2",display:"flex",gap:"8px",flexWrap:"wrap"},itemEffect:{fontSize:"11px",color:"#388e3c",marginTop:"4px"},itemSelect:{display:"flex",alignItems:"center",gap:"6px",fontSize:"11px",color:"#666"},itemMetaRow:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"6px"},itemStock:{fontSize:"11px",color:"#999"},qtyControls:{display:"flex",alignItems:"center",gap:"6px"},qtyBtn:{width:"24px",height:"24px",border:"none",borderRadius:"4px",background:"#e0e0e0",cursor:"pointer",fontSize:"14px"},qtyInput:{width:"56px",padding:"4px",textAlign:"center",border:"1px solid #ddd",borderRadius:"4px",fontSize:"12px"},footer:{display:"flex",justifyContent:"space-between",alignItems:"center",gap:"12px"},summary:{fontSize:"12px",color:"#666"},footerActions:{display:"flex",gap:"8px"},closeBtn:{padding:"10px 16px",background:"#e0e0e0",border:"none",borderRadius:"8px",cursor:"pointer",fontSize:"14px"},primaryBtn:{padding:"10px 16px",background:"#ff9800",border:"none",borderRadius:"8px",color:"#fff",fontSize:"14px"}},YC=[{id:"EMOTION",label:"",desc:"",strongAgainst:["",""],weakAgainst:["",""]},{id:"PROFIT",label:"",desc:"",strongAgainst:["",""],weakAgainst:["",""]},{id:"REASON",label:"",desc:"",strongAgainst:["",""],weakAgainst:["",""]}],qC=({npc:e,onClose:t,onNegotiate:n})=>{var s;return r.jsx("div",{style:Mi.overlay,children:r.jsxs("div",{style:Mi.modal,children:[r.jsx("h3",{children:" "}),r.jsxs("p",{style:{color:"#555",fontSize:"14px"},children:[" ",r.jsx("strong",{style:{color:"#d81b60"},children:(s=e.personality)==null?void 0:s.label}),"  ",e.name,"",r.jsx("br",{}),""]}),r.jsx("div",{style:Mi.list,children:YC.map(o=>r.jsxs("button",{onClick:()=>n(o),style:Mi.btn,children:[r.jsx("div",{style:{fontWeight:"bold"},children:o.label}),r.jsx("small",{style:{color:"#666"},children:o.desc})]},o.id))}),r.jsx("button",{onClick:t,style:Mi.cancel,children:""})]})})},Mi={overlay:{position:"fixed",top:0,left:0,right:0,bottom:0,background:"rgba(0,0,0,0.7)",display:"flex",justifyContent:"center",alignItems:"center",zIndex:200},modal:{width:"300px",background:"#fff8e1",borderRadius:"12px",padding:"20px",border:"2px solid #8d6e63"},list:{display:"flex",flexDirection:"column",gap:"10px",margin:"20px 0"},btn:{padding:"15px",background:"#fff",border:"1px solid #d7ccc8",borderRadius:"8px",cursor:"pointer",textAlign:"left",":hover":{background:"#efebe9"}},cancel:{width:"100%",padding:"10px",background:"transparent",border:"none",color:"#888",cursor:"pointer"}},KC=({items:e,playerSpiritStones:t,onPurchase:n,onClose:s})=>{const[o,i]=y.useState({}),[a,l]=y.useState(null),d=(p,c)=>{const f=p.price*c;if(t<f){l(` ${p.name} x${c}  ${f}  ${t} `),setTimeout(()=>l(null),3e3);return}n(p,c,f),l(` ${p.name} x${c} ${f} `),setTimeout(()=>l(null),2e3)},u={common:"#9e9e9e",uncommon:"#4caf50",rare:"#2196f3",epic:"#9c27b0",legendary:"#ff9800"};return r.jsx("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0,0,0,0.5)",display:"flex",justifyContent:"center",alignItems:"center",zIndex:1e3},children:r.jsxs("div",{style:{backgroundColor:"#fff",padding:"25px",borderRadius:"16px",maxWidth:"600px",maxHeight:"80vh",width:"90%",boxShadow:"0 8px 30px rgba(0,0,0,0.3)",border:"2px solid #8d6e63",display:"flex",flexDirection:"column"},children:[r.jsx("h2",{style:{marginTop:0,color:"#5d4037",textAlign:"center",marginBottom:"10px"},children:" "}),r.jsx("p",{style:{color:"#666",textAlign:"center",fontSize:"13px",marginBottom:"15px"},children:""}),r.jsx("div",{style:{flex:1,overflowY:"auto",marginBottom:"15px"},children:e.length===0?r.jsx("div",{style:{textAlign:"center",padding:"40px",color:"#999"},children:""}):r.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"10px"},children:e.map(p=>{const c=o[p.instanceId]||1,f=p.price*c,b=t>=f;return r.jsxs("div",{style:{padding:"12px",border:`2px solid ${u[p.rarity]||"#ddd"}`,borderRadius:"10px",backgroundColor:b?"#fafafa":"#f5f5f5",opacity:b?1:.6,transition:"all 0.2s"},children:[r.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"6px"},children:[r.jsx("span",{style:{fontSize:"15px",fontWeight:"bold",color:u[p.rarity]},children:p.name}),r.jsxs("span",{style:{fontSize:"14px",color:"#f57c00",fontWeight:"bold"},children:[" ",p.price," "]})]}),r.jsx("div",{style:{fontSize:"12px",color:"#666",marginBottom:"8px"},children:p.desc}),p.stats&&r.jsxs("div",{style:{fontSize:"11px",color:"#1976d2",display:"flex",gap:"8px",flexWrap:"wrap",marginBottom:"8px"},children:[p.stats.atk&&r.jsxs("span",{children:["+",p.stats.atk]}),p.stats.hp&&r.jsxs("span",{children:["+",p.stats.hp]}),p.stats.def&&r.jsxs("span",{children:["+",p.stats.def]}),p.stats.mp&&r.jsxs("span",{children:["+",p.stats.mp]})]}),p.effect&&r.jsxs("div",{style:{fontSize:"11px",color:"#388e3c",marginBottom:"8px"},children:[p.effect.kind==="heal"&&`${p.effect.amount}`,p.effect.kind==="exp"&&`+${p.effect.amount}`,p.effect.kind==="aptitude"&&`+${p.effect.amount}`]}),r.jsxs("div",{style:{display:"flex",gap:"8px",alignItems:"center",marginBottom:"8px"},children:[r.jsxs("div",{style:{display:"flex",alignItems:"center",gap:6},children:[r.jsx("label",{style:{fontSize:12,color:"#555"},children:""}),r.jsx("input",{type:"number",min:1,value:c,onChange:S=>{const E=Math.max(1,parseInt(S.target.value||"1",10));i(j=>({...j,[p.instanceId]:E}))},style:{width:60,padding:6,borderRadius:6,border:"1px solid #ddd"}})]}),r.jsx("div",{style:{flex:1}})]}),r.jsxs("button",{onClick:()=>d(p,c),disabled:!b,style:{width:"100%",padding:"8px",border:"none",borderRadius:"6px",backgroundColor:b?"#8d6e63":"#ccc",color:"white",cursor:b?"pointer":"not-allowed",fontSize:"13px",fontWeight:"bold"},children:[" x",c,"  ",f,""]})]},p.instanceId)})})}),a&&r.jsx("div",{style:{marginBottom:15,padding:"10px 15px",textAlign:"center",backgroundColor:a.includes("")?"#ffebee":"#e8f5e9",color:a.includes("")?"#c62828":"#2e7d32",fontWeight:"bold",borderRadius:"8px",border:`2px solid ${a.includes("")?"#ef5350":"#66bb6a"}`},children:a}),r.jsxs("div",{style:{marginTop:"10px",padding:"10px",backgroundColor:"#fff3e0",borderRadius:"8px",fontSize:"12px",color:"#666",textAlign:"center"},children:[" "," ",r.jsx("span",{style:{fontWeight:"bold",color:"#f57c00"},children:t})," ",""]}),r.jsx("button",{onClick:s,style:{marginTop:"15px",padding:"10px",border:"1px solid #ccc",borderRadius:"8px",backgroundColor:"white",cursor:"pointer",fontSize:"14px"},children:""})]})})},QC=({result:e,onClose:t})=>{if(y.useEffect(()=>{if(e&&e.autoClose!==!1){const s=setTimeout(t,3e3);return()=>clearTimeout(s)}},[t,e]),!e)return null;const n=()=>{e.autoClose!==!1&&t()};return r.jsx("div",{style:qr.overlay,onClick:n,children:r.jsxs("div",{style:qr.card,onClick:s=>s.stopPropagation(),children:[r.jsx("div",{style:qr.icon,children:e.success?"":""}),r.jsx("h3",{style:{margin:"10px 0"},children:e.title}),r.jsx("div",{style:qr.scrollText,children:e.msg}),e.changes&&r.jsx("div",{style:qr.changes,children:Object.entries(e.changes).map(([s,o])=>r.jsxs("span",{style:qr.badge,children:[s,": ",o>0?"+":"",o]},s))}),e.autoClose===!1?r.jsx("button",{onClick:t,style:qr.confirmBtn,children:""}):r.jsx("div",{style:qr.tip,children:"[  ]"})]})})},qr={overlay:{position:"fixed",top:0,left:0,right:0,bottom:0,background:"rgba(0,0,0,0.5)",display:"flex",justifyContent:"center",alignItems:"center",zIndex:2200,animation:"fadeIn 0.2s",backdropFilter:"blur(2px)"},card:{width:"85%",maxWidth:"500px",background:"#f5f0e8",padding:"25px",borderRadius:"16px",textAlign:"center",boxShadow:"0 8px 30px rgba(0,0,0,0.2)",animation:"fadeIn 0.3s ease-out",maxHeight:"80vh",display:"flex",flexDirection:"column",border:"2px solid #d7ccc8"},scrollText:{maxHeight:"250px",overflowY:"auto",lineHeight:"1.8",color:"#5d4037",textAlign:"left",background:"#faf8f5",padding:"20px",borderRadius:"12px",margin:"15px 0",border:"1px solid #e0e0e0",boxShadow:"0 2px 8px rgba(0,0,0,0.05)",fontFamily:"Microsoft YaHei, SimSun, serif"},confirmBtn:{marginTop:"20px",padding:"12px 25px",background:"linear-gradient(135deg, #8d6e63 0%, #6d4c41 100%)",color:"white",border:"none",borderRadius:"25px",cursor:"pointer",fontSize:"15px",transition:"all 0.3s ease",boxShadow:"0 2px 8px rgba(0,0,0,0.15)",":hover":{background:"linear-gradient(135deg, #6d4c41 0%, #5d4037 100%)",transform:"translateY(-2px)",boxShadow:"0 4px 12px rgba(0,0,0,0.2)"}},icon:{fontSize:"48px",marginBottom:"15px"},changes:{marginTop:"20px",display:"flex",gap:"8px",justifyContent:"center",flexWrap:"wrap"},badge:{background:"linear-gradient(135deg, #f1f8e9 0%, #e8f5e8 100%)",color:"#5d4037",padding:"4px 12px",borderRadius:"15px",fontSize:"13px",border:"1px solid #d7ccc8",boxShadow:"0 2px 4px rgba(0,0,0,0.05)"},tip:{marginTop:"15px",fontSize:"12px",color:"#8d6e63",fontStyle:"italic"}},JC=({message:e,onConfirm:t,onCancel:n,input:s})=>{const[o,i]=y.useState((s==null?void 0:s.defaultValue)??"");return r.jsx("div",{style:gr.overlay,onClick:n,children:r.jsxs("div",{style:gr.card,onClick:a=>a.stopPropagation(),children:[r.jsx("div",{style:gr.icon,children:""}),r.jsx("h3",{style:{margin:"10px 0"},children:""}),r.jsx("div",{style:gr.message,children:e}),s&&r.jsxs("div",{style:gr.inputWrap,children:[s.label&&r.jsx("div",{style:gr.inputLabel,children:s.label}),r.jsx("input",{type:s.type||"text",value:o,min:s.min,max:s.max,step:s.step,placeholder:s.placeholder,onChange:a=>i(a.target.value),style:gr.input})]}),r.jsxs("div",{style:gr.buttons,children:[r.jsx("button",{onClick:n,style:gr.cancelBtn,children:""}),r.jsx("button",{onClick:()=>t(s?o:void 0),style:gr.confirmBtn,children:""})]})]})})},gr={overlay:{position:"fixed",top:0,left:0,right:0,bottom:0,background:"rgba(0, 0, 0, 0.5)",display:"flex",justifyContent:"center",alignItems:"center",zIndex:2200,animation:"fadeIn 0.2s",backdropFilter:"blur(2px)"},card:{width:"85%",maxWidth:"400px",background:"linear-gradient(135deg, #F4EEE6 0%, #EFE6D8 100%)",borderRadius:"12px",padding:"30px",textAlign:"center",boxShadow:"0 20px 60px rgba(0, 0, 0, 0.3)",border:"2px solid #D4AF37"},icon:{fontSize:"48px",marginBottom:"10px"},message:{margin:"20px 0",lineHeight:"1.6",whiteSpace:"pre-wrap"},inputWrap:{marginTop:"10px"},inputLabel:{fontSize:"12px",color:"#555",marginBottom:"6px"},input:{width:"100%",padding:"8px 10px",border:"1px solid #ccc",borderRadius:"6px",fontSize:"14px"},buttons:{display:"flex",gap:"15px",justifyContent:"center",marginTop:"20px"},cancelBtn:{padding:"10px 20px",background:"#666",color:"white",border:"none",borderRadius:"8px",cursor:"pointer",fontSize:"16px"},confirmBtn:{padding:"10px 20px",background:"#4CAF50",color:"white",border:"none",borderRadius:"8px",cursor:"pointer",fontSize:"16px"}},XC=({event:e,npc:t,onClose:n,onOptionSelect:s})=>{const o=l=>{try{s((t==null?void 0:t.id)||null,l)}catch(d){console.error("EventModal option select error",d)}},i=(e==null?void 0:e.title)||(t?`${t.name} - `:""),a=(e==null?void 0:e.text)||(e==null?void 0:e.desc)||(e==null?void 0:e.description)||"";return r.jsx("div",{style:Mr.overlay,children:r.jsxs("div",{style:Mr.modalWrapper,children:[r.jsx("button",{onClick:n,style:Mr.closeBtn,"aria-label":"",children:""}),r.jsxs("div",{style:Mr.modal,children:[r.jsx("h2",{style:Mr.title,children:i}),r.jsxs("div",{style:Mr.content,children:[r.jsx("p",{style:Mr.eventText,children:a}),r.jsx("div",{style:Mr.options,children:((e==null?void 0:e.options)||[]).map((l,d)=>r.jsx("button",{style:Mr.optionBtn,onClick:()=>o(l),children:l.label},d))})]})]})]})})},Mr={overlay:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0, 0, 0, 0.5)",display:"flex",justifyContent:"center",alignItems:"center",zIndex:1e3,backdropFilter:"blur(2px)"},modalWrapper:{position:"relative",width:"min(600px, calc(100vw - 32px))"},modal:{width:"90%",maxWidth:"600px",backgroundColor:"#f5f0e8",borderRadius:"16px",padding:"25px",position:"relative",boxShadow:"0 8px 30px rgba(0, 0, 0, 0.2)",border:"2px solid #d7ccc8",animation:"fadeIn 0.3s ease-out"},closeBtn:{position:"absolute",top:"-18px",left:"-18px",border:"none",background:"#fff",fontSize:"22px",cursor:"pointer",color:"#8d6e63",width:"42px",height:"42px",borderRadius:"50%",display:"flex",alignItems:"center",justifyContent:"center",boxShadow:"0 10px 24px rgba(0,0,0,0.2)"},title:{fontSize:"20px",marginBottom:"25px",color:"#5d4037",textAlign:"center",fontWeight:"bold",paddingBottom:"15px",borderBottom:"2px solid #d7ccc8",fontFamily:"Microsoft YaHei, SimSun, serif"},content:{maxHeight:"70vh",overflowY:"auto",paddingRight:"10px"},eventText:{fontSize:"16px",lineHeight:"1.8",marginBottom:"35px",color:"#5d4037",padding:"20px",background:"#faf8f5",borderRadius:"12px",border:"1px solid #e0e0e0",boxShadow:"0 2px 8px rgba(0, 0, 0, 0.05)",fontFamily:"Microsoft YaHei, SimSun, serif"},options:{display:"flex",flexDirection:"column",gap:"12px"},optionBtn:{padding:"18px",border:"2px solid #d7ccc8",borderRadius:"12px",background:"linear-gradient(135deg, #ffffff 0%, #f5f0e8 100%)",cursor:"pointer",textAlign:"left",transition:"all 0.3s ease",fontSize:"15px",color:"#5d4037",boxShadow:"0 2px 8px rgba(0, 0, 0, 0.05)",":hover":{background:"linear-gradient(135deg, #f5f0e8 0%, #e8e0d8 100%)",transform:"translateY(-2px)",boxShadow:"0 4px 12px rgba(0, 0, 0, 0.1)",borderColor:"#bcaaa4"},":active":{transform:"translateY(0)",boxShadow:"0 2px 6px rgba(0, 0, 0, 0.05)"}}},Dh=e=>Math.max(0,Math.min(100,Number(e)||0)),ZC=({event:e,player:t,onClose:n,onOptionSelect:s})=>{const[o,i]=y.useState(null),a=d=>{i(d),setTimeout(()=>{s(d),n()},300)},l=()=>e.participants.map((d,u)=>{var S,E;const p=((S=d.relationship)==null?void 0:S.jealousy)||0,c=((E=d.relationship)==null?void 0:E.affection)||0,f=Dh(c),b=Dh(p);return r.jsxs("div",{style:Je.npcCard,children:[r.jsxs("div",{style:Je.npcHeader,children:[r.jsx("span",{style:Je.npcName,children:d.name}),r.jsx("span",{style:Je.npcRealm,children:d.tierTitle||""})]}),r.jsxs("div",{style:Je.npcStats,children:[r.jsxs("div",{style:Je.statBar,children:[r.jsx("span",{style:Je.statLabel,children:""}),r.jsx("div",{style:Je.barContainer,children:r.jsx("div",{style:{...Je.barFill,width:`${f}%`,background:"#ff6b9d"}})}),r.jsx("span",{style:Je.statValue,children:f})]}),r.jsxs("div",{style:Je.statBar,children:[r.jsx("span",{style:Je.statLabel,children:""}),r.jsx("div",{style:Je.barContainer,children:r.jsx("div",{style:{...Je.barFill,width:`${b}%`,background:b>=80?"#d32f2f":b>=60?"#f44336":"#ff9800"}})}),r.jsx("span",{style:Je.statValue,children:b})]})]})]},d.id)});return r.jsx("div",{style:Je.overlay,children:r.jsxs("div",{style:Je.modalWrapper,children:[r.jsx("button",{onClick:n,style:Je.closeBtn,"aria-label":"",children:""}),r.jsxs("div",{style:Je.modal,children:[r.jsxs("h2",{style:Je.title,children:[r.jsx("span",{style:Je.titleIcon,children:""}),"",r.jsx("span",{style:Je.titleIcon,children:""})]}),r.jsxs("div",{style:Je.content,children:[r.jsx("div",{style:Je.sceneDescription,children:r.jsx("p",{style:Je.mainText,children:e.description})}),r.jsxs("div",{style:Je.participants,children:[r.jsx("h3",{style:Je.sectionTitle,children:""}),r.jsx("div",{style:Je.npcList,children:l()})]}),e.dialogues&&e.dialogues.length>0&&r.jsx("div",{style:Je.dialogues,children:e.dialogues.map((d,u)=>r.jsxs("div",{style:Je.dialogueItem,children:[r.jsxs("span",{style:Je.dialogueSpeaker,children:[d.speaker,""]}),r.jsxs("span",{style:Je.dialogueText,children:['"',d.text,'"']})]},u))}),r.jsx("div",{style:Je.options,children:e.options.map((d,u)=>r.jsxs("button",{style:{...Je.optionBtn,...o===d?Je.optionBtnSelected:{}},onClick:()=>a(d),children:[r.jsx("div",{style:Je.optionLabel,children:d.label}),d.hint&&r.jsx("div",{style:Je.optionHint,children:d.hint})]},u))})]})]})]})})},Je={overlay:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0, 0, 0, 0.7)",display:"flex",justifyContent:"center",alignItems:"center",zIndex:1100,backdropFilter:"blur(3px)",animation:"fadeIn 0.3s ease-out"},modalWrapper:{position:"relative",width:"min(700px, calc(100vw - 32px))"},modal:{width:"90%",maxWidth:"700px",maxHeight:"90vh",backgroundColor:"#fff5f5",borderRadius:"20px",padding:"30px",position:"relative",boxShadow:"0 10px 40px rgba(211, 47, 47, 0.3)",border:"3px solid #ffcdd2",overflowY:"auto",animation:"slideIn 0.4s ease-out"},closeBtn:{position:"absolute",top:"-20px",left:"-20px",border:"none",background:"#fff5f5",fontSize:"26px",cursor:"pointer",color:"#d32f2f",width:"48px",height:"48px",borderRadius:"50%",display:"flex",alignItems:"center",justifyContent:"center",boxShadow:"0 12px 30px rgba(211,47,47,0.25)"},title:{fontSize:"28px",marginBottom:"25px",color:"#d32f2f",textAlign:"center",fontWeight:"bold",paddingBottom:"15px",borderBottom:"3px solid #ffcdd2",fontFamily:"Microsoft YaHei, serif",textShadow:"2px 2px 4px rgba(211, 47, 47, 0.2)",display:"flex",alignItems:"center",justifyContent:"center",gap:"15px"},titleIcon:{fontSize:"24px",animation:"pulse 2s infinite"},content:{maxHeight:"calc(90vh - 120px)",overflowY:"auto",paddingRight:"10px"},sceneDescription:{marginBottom:"25px",padding:"20px",background:"linear-gradient(135deg, #fff 0%, #ffebee 100%)",borderRadius:"15px",border:"2px solid #ffcdd2",boxShadow:"0 4px 12px rgba(211, 47, 47, 0.1)"},mainText:{fontSize:"17px",lineHeight:"1.9",color:"#5d4037",margin:0,fontFamily:"Microsoft YaHei, serif",textAlign:"justify"},participants:{marginBottom:"25px"},sectionTitle:{fontSize:"18px",color:"#d32f2f",marginBottom:"15px",fontWeight:"bold",paddingLeft:"10px",borderLeft:"4px solid #d32f2f"},npcList:{display:"flex",flexDirection:"column",gap:"12px"},npcCard:{padding:"15px",background:"#fff",borderRadius:"12px",border:"2px solid #ffcdd2",boxShadow:"0 2px 8px rgba(211, 47, 47, 0.1)"},npcHeader:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"10px"},npcName:{fontSize:"16px",fontWeight:"bold",color:"#d32f2f"},npcRealm:{fontSize:"13px",color:"#666",background:"#f5f5f5",padding:"4px 10px",borderRadius:"8px"},npcStats:{display:"flex",flexDirection:"column",gap:"8px"},statBar:{display:"flex",alignItems:"center",gap:"10px"},statLabel:{fontSize:"13px",color:"#666",minWidth:"40px"},barContainer:{flex:1,height:"8px",background:"#e0e0e0",borderRadius:"4px",overflow:"hidden"},barFill:{height:"100%",transition:"width 0.5s ease"},statValue:{fontSize:"13px",color:"#666",minWidth:"30px",textAlign:"right"},dialogues:{marginBottom:"25px",padding:"20px",background:"#fafafa",borderRadius:"12px",border:"1px solid #e0e0e0"},dialogueItem:{marginBottom:"12px",fontSize:"15px",lineHeight:"1.8",color:"#5d4037"},dialogueSpeaker:{fontWeight:"bold",color:"#d32f2f"},dialogueText:{color:"#5d4037",fontStyle:"italic"},options:{display:"flex",flexDirection:"column",gap:"12px",marginTop:"20px"},optionBtn:{padding:"18px 20px",border:"2px solid #ffcdd2",borderRadius:"12px",background:"linear-gradient(135deg, #ffffff 0%, #fff5f5 100%)",cursor:"pointer",textAlign:"left",transition:"all 0.3s ease",fontSize:"15px",color:"#5d4037",boxShadow:"0 2px 8px rgba(211, 47, 47, 0.1)"},optionBtnSelected:{background:"linear-gradient(135deg, #ffebee 0%, #ffcdd2 100%)",borderColor:"#d32f2f",transform:"translateY(-2px)",boxShadow:"0 4px 12px rgba(211, 47, 47, 0.2)"},optionLabel:{fontSize:"15px",fontWeight:"bold",marginBottom:"5px"},optionHint:{fontSize:"13px",color:"#999",marginTop:"5px"}},e5=(e="")=>{switch(e){case"":return"#c62828";case"":return"#ef6c00";case"":return"#fb8c00";case"":return"#fdd835";default:return"#8d6e63"}},t5=({event:e,onClose:t})=>{if(!e)return null;const{alerts:n=[],summary:s,actionLabel:o,timestamp:i={},targetName:a}=e,l=`${i.year||"???"}${i.month||"??"}  ${o||""}`;return r.jsx("div",{style:Gt.overlay,children:r.jsxs("div",{style:Gt.modal,children:[r.jsx("button",{type:"button","aria-label":"",onClick:t,style:Gt.closeBtn,children:""}),r.jsx("h2",{style:Gt.title,children:" "}),r.jsx("p",{style:Gt.subtitle,children:l}),r.jsx("div",{style:Gt.summaryBox,children:r.jsx("p",{style:Gt.summaryText,children:s})}),r.jsx("div",{style:Gt.alertList,children:n.map(d=>r.jsxs("div",{style:Gt.alertCard,children:[r.jsxs("div",{style:Gt.alertHeader,children:[r.jsxs("div",{style:Gt.alertNameRow,children:[r.jsx("span",{style:Gt.alertName,children:d.witnessName}),r.jsx("span",{style:{...Gt.levelBadge,backgroundColor:e5(d.level)},children:d.level})]}),r.jsxs("span",{style:Gt.targetTip,children:["",d.targetName||a]})]}),r.jsxs("div",{style:Gt.alertMeta,children:["",o]}),r.jsxs("div",{style:Gt.alertMeta,children:["+",d.increase,"  ",d.newJealousy]})]},`${d.witnessName}-${d.targetName}-${d.newJealousy}`))}),r.jsx("button",{type:"button",onClick:t,style:Gt.primaryBtn,children:""})]})})},Gt={overlay:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0,0,0,0.65)",display:"flex",justifyContent:"center",alignItems:"center",zIndex:2300,padding:"16px"},modal:{width:"min(640px, 100%)",background:"#fffdf7",borderRadius:"18px",padding:"28px 26px 32px",position:"relative",boxShadow:"0 18px 40px rgba(93,64,55,0.3)",border:"2px solid #ffe0b2",maxHeight:"92vh",overflowY:"auto"},closeBtn:{position:"absolute",top:"14px",right:"14px",border:"none",background:"transparent",fontSize:"26px",cursor:"pointer",color:"#8d6e63"},title:{margin:0,fontSize:"26px",color:"#c62828",textAlign:"center"},subtitle:{textAlign:"center",margin:"6px 0 18px",color:"#795548",fontSize:"14px"},summaryBox:{background:"#fff8e1",borderRadius:"12px",border:"1px solid #ffe0b2",padding:"16px",marginBottom:"18px"},summaryText:{margin:0,fontSize:"15px",lineHeight:1.7,color:"#5d4037",whiteSpace:"pre-line"},alertList:{display:"flex",flexDirection:"column",gap:"12px",marginBottom:"24px"},alertCard:{border:"1px solid #ffe0b2",borderRadius:"12px",padding:"14px 16px",background:"#fff"},alertHeader:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"8px"},alertNameRow:{display:"flex",alignItems:"center",gap:"8px"},alertName:{fontWeight:"bold",fontSize:"16px",color:"#5d4037"},levelBadge:{padding:"2px 10px",borderRadius:"999px",color:"#fff",fontSize:"12px"},targetTip:{fontSize:"13px",color:"#8d6e63"},alertMeta:{fontSize:"14px",color:"#6d4c41"},primaryBtn:{width:"100%",padding:"12px",borderRadius:"10px",border:"none",background:"linear-gradient(120deg, #ffb300, #ff7043)",color:"#fff",fontSize:"16px",fontWeight:"bold",cursor:"pointer"}},n5=["","","","","",""],Fh={COMMON:"",UNCOMMON:"",RARE:"",EPIC:"",LEGENDARY:"",MYTHIC:"",UNIQUE:"",SPECIAL:""},r5=e=>{var n;if(!e)return"";const t=e.toString().trim().toUpperCase();return(n=Q[t])!=null&&n.label?Q[t].label:Fh[t]?Fh[t]:/^[A-Z]+$/.test(t)?"":e},Hh=(e=[])=>{const t={};return e.forEach(n=>{n!=null&&n.id&&(t[n.id]=[{bidder:"",amount:Math.max(1,n.basePrice||0),time:Date.now()}])}),t},s5=({auction:e,playerResources:t,onClose:n,onBuy:s,onShowPlot:o,playerSoldAuctionItems:i=[]})=>{if(!e)return null;const a=y.useMemo(()=>e.items||[],[e]),l=()=>typeof window>"u"?!1:window.innerWidth<=768,[d,u]=y.useState(l),[p,c]=y.useState(()=>Hh(a)),[f,b]=y.useState(null),[S,E]=y.useState(a[0]||null),[j,x]=y.useState({}),[h,v]=y.useState(null),[g,I]=y.useState({}),_=y.useRef(p),C=(O,ie)=>d?ie:O;y.useEffect(()=>{_.current=p},[p]),y.useEffect(()=>{if(typeof window>"u")return;const O=()=>u(l());return window.addEventListener("resize",O),()=>window.removeEventListener("resize",O)},[]),y.useEffect(()=>{const O=Hh(a);c(O),_.current=O,b(null),E(a[0]||null),x({}),v(null),I({})},[a]);const k=O=>{O&&v({...O,id:Date.now()})},R=O=>_.current[O]||[],T=O=>{const ie=R(O);return ie.length===0?0:ie[ie.length-1].amount},N=O=>{const ie=R(O);return ie.length===0?null:ie[ie.length-1].bidder},Y=(O,ie,le)=>{c(ee=>{const he=ee[O]?[...ee[O]]:[];he.push({bidder:ie,amount:le,time:Date.now()});const Ee={...ee,[O]:he};return _.current=Ee,Ee})},H=(O,ie)=>{c(le=>{const ee=[...le[O]||[]];for(let Ee=ee.length-1;Ee>=0;Ee-=1)if(ee[Ee].bidder===""&&(!ie||ee[Ee].amount===ie)){ee.splice(Ee,1);break}const he={...le,[O]:ee};return _.current=he,he})},B=O=>Math.max(1,Math.floor(((O==null?void 0:O.basePrice)||0)*.05)),$=O=>Math.max(1,Math.floor((O==null?void 0:O.basePrice)||0))*2,q=(O,ie)=>{I(le=>({...le,[O]:{enabled:!1,ceiling:"",...le[O]||{},...ie}}))},se=O=>{const ie=g[O.id];if(!(ie!=null&&ie.enabled))return;const le=Number(ie.ceiling)||0,ee=T(O.id);if(N(O.id)===""||le<=0||ee>=le)return;const Ee=Math.min(le,ee+B(O));if(((t==null?void 0:t.spiritStones)||0)<Ee){k({type:"error",title:"",message:`${O.name} `}),q(O.id,{enabled:!1});return}Y(O.id,"",Ee)},J=O=>{for(let ie=0;ie<2;ie+=1)n5.forEach(le=>{if(Math.random()<.35){const ee=T(O.id),he=(O==null?void 0:O.basePrice)||0,Ee=Math.max(1,Math.floor(he*(.02+Math.random()*.12))||1),_e=$(O),rt=Math.min(ee+Ee,_e);rt>ee&&(Y(O.id,le,rt),se(O))}})},X=(O,ie,le)=>{le!=null&&le.success?(x(ee=>({...ee,[O.id]:{status:"won",price:ie,bidder:""}})),q(O.id,{enabled:!1}),k({type:"success",title:le.title||"",message:le.message||`${O.name} `})):(H(O.id,ie),k({type:"error",title:(le==null?void 0:le.title)||"",message:(le==null?void 0:le.message)||""}))},re=O=>{const ie=O.itemId||O.swordId||O.id,le=!!j[O.id]||i.includes(ie);if(!O||le)return;const ee=T(O.id);try{const he=s(O,ee);he&&typeof he.then=="function"?he.then(Ee=>X(O,ee,Ee)).catch(()=>{X(O,ee,{success:!1,title:"",message:""})}):X(O,ee,he)}catch{X(O,ee,{success:!1,title:"",message:""})}},ye=(O,ie,le)=>{const ee=O.itemId||O.swordId||O.id,he=!!j[O.id]||i.includes(ee);if(!O||he){k({type:"error",title:"",message:""});return}const Ee=T(O.id)+B(O),_e=Math.max(Number(ie)||0,Ee);if(((t==null?void 0:t.spiritStones)||0)<_e){k({type:"error",title:"",message:""});return}Y(O.id,"",_e),le(""),J(O),setTimeout(()=>{N(O.id)===""&&re(O)},60)},Re=O=>{b(O)},Fe=()=>v(null);return r.jsxs("div",{style:{...ze.overlay,alignItems:d?"flex-start":"center",padding:d?"12px":"20px"},children:[r.jsx("div",{style:{...ze.modalWrapper,width:d?"100%":ze.modalWrapper.width,maxHeight:d?"none":ze.modalWrapper.maxHeight},children:r.jsxs("div",{style:{...ze.modalShell,borderRadius:d?16:ze.modalShell.borderRadius,padding:d?"18px":ze.modalShell.padding,maxHeight:d?"none":ze.modalShell.maxHeight},children:[r.jsxs("header",{style:{...ze.header,paddingTop:d?"40px":"30px"},children:[r.jsx("button",{onClick:n,style:{...ze.closeBtn,fontSize:C("14px","12px"),padding:C("6px 16px","4px 12px"),position:"absolute",top:d?"12px":"16px",left:d?"12px":"16px"},"aria-label":"",children:""}),r.jsxs("div",{style:{flex:1},children:[r.jsx("h2",{style:{...ze.title,fontSize:C("24px","18px")},children:e.title}),r.jsx("p",{style:{...ze.message,fontSize:C("14px","12px")},children:e.message})]}),r.jsx("div",{style:ze.headerActions,children:r.jsxs("div",{style:{...ze.resourceChip,fontSize:C("14px","12px"),padding:C("6px 14px","4px 10px")},children:["  ",(t==null?void 0:t.spiritStones)||0]})})]}),r.jsx("div",{style:{...ze.body,flexDirection:"column",gap:"16px"},children:f?r.jsxs("div",{style:{...ze.plotCard,padding:C("20px","16px")},children:[r.jsx("h3",{style:{...ze.plotTitle,fontSize:C("18px","16px")},children:f.name}),r.jsx("div",{style:{...ze.plotContent,fontSize:C("14px","13px")},children:o(f)}),r.jsx("button",{style:{...ze.backBtn,fontSize:C("13px","12px"),padding:C("10px","8px")},onClick:()=>b(null),children:""})]}):r.jsx("section",{style:{...ze.catalogPanel,gridTemplateColumns:d?"1fr":ze.catalogPanel.gridTemplateColumns,maxHeight:d?"none":ze.catalogPanel.maxHeight,paddingRight:d?0:ze.catalogPanel.paddingRight,gap:C(ze.catalogPanel.gap,"12px")},children:a.map(O=>{const ie=O.itemId||O.swordId||O.id,le=!!j[O.id]||i.includes(ie);return r.jsx(o5,{item:O,bids:R(O.id),currentHighest:T(O.id),highestBidder:N(O.id),onPlayerBid:ye,onShowPlot:()=>Re(O),sold:le,autoBidConfig:g[O.id],onAutoBidConfigChange:q,isMobile:d},O.id)})})})]})}),h&&r.jsx("div",{style:ze.feedbackOverlay,children:r.jsxs("div",{style:{...ze.feedbackCard,borderColor:h.type==="success"?"#66bb6a":"#ef5350"},children:[r.jsx("h3",{style:{marginTop:0,color:h.type==="success"?"#1b5e20":"#b71c1c"},children:h.title}),r.jsx("p",{style:{whiteSpace:"pre-wrap",color:"#333"},children:h.message}),r.jsx("button",{style:ze.feedbackBtn,onClick:Fe,children:""})]})})]})},o5=({item:e,bids:t,currentHighest:n,highestBidder:s,onPlayerBid:o,onShowPlot:i,sold:a,autoBidConfig:l,onAutoBidConfigChange:d,isMobile:u})=>{const[p,c]=y.useState("");y.useEffect(()=>c(""),[e.id]);const f=(_,C)=>u?C:_,b=y.useMemo(()=>r5(e.rarity),[e.rarity]),S=y.useMemo(()=>[{label:"+5%",value:Math.max(1,Math.floor((e.basePrice||0)*.05))},{label:"+10%",value:Math.max(1,Math.floor((e.basePrice||0)*.1))},{label:"+50",value:50}],[e.basePrice]),E=n+Math.max(1,Math.floor((e.basePrice||0)*.05)),j=l||{enabled:!1,ceiling:""},x=_=>{const C=Number(p)||n;c(String(C+_))},h=()=>{o(e,p,c)},v=()=>{d(e.id,{enabled:!j.enabled})},g=_=>{const C=Number(_.replace(/[^0-9]/g,""));d(e.id,{ceiling:Number.isNaN(C)?"":C})},I=t.slice(-3).reverse();return r.jsxs("div",{style:{...ze.item,borderColor:a?"#66bb6a":"#f5deb3",opacity:a?.6:1,padding:f("14px","12px"),gap:f("8px","6px")},children:[r.jsxs("div",{style:{...ze.itemHeader,flexDirection:u?"column":"row",gap:u?"4px":"0"},children:[r.jsx("div",{style:{fontWeight:"bold",color:"#4e342e",fontSize:f("14px","13px")},children:e.name}),r.jsxs("div",{style:{color:"#ffb300",fontWeight:"bold",fontSize:f("14px","13px")},children:[n," "]})]}),r.jsx("div",{style:{...ze.desc,fontSize:f("13px","12px")},children:e.description}),r.jsxs("div",{style:{...ze.chipRow,gap:f("6px","4px")},children:[r.jsx("span",{style:{...ze.chip,fontSize:f("11px","10px")},children:b}),r.jsxs("span",{style:{...ze.chip,fontSize:f("11px","10px")},children:[" ",Math.max(1,Math.floor((e.basePrice||0)*.05))]}),a&&r.jsx("span",{style:{...ze.chip,background:"#ef5350",color:"#fff",fontSize:f("11px","10px"),fontWeight:"bold"},children:""})]}),r.jsxs("div",{style:{...ze.bidRow,flexDirection:u?"column":"row",gap:u?"4px":"0"},children:[r.jsxs("div",{style:{...ze.bidMeta,fontSize:f("12px","11px")},children:["",s||""]}),r.jsxs("div",{style:{...ze.bidMeta,fontSize:f("12px","11px")},children:["",E]})]}),r.jsxs("div",{style:{...ze.inputRow,flexDirection:u?"column":"row"},children:[r.jsx("input",{value:p,onChange:_=>c(_.target.value),placeholder:` ${E}`,style:{...ze.input,fontSize:f("13px","12px"),padding:f("8px","6px")},disabled:!!a}),r.jsx("button",{style:{...ze.bidBtn,fontSize:f("13px","12px"),padding:f("8px 14px","6px 12px")},onClick:h,disabled:!!a,children:""}),r.jsx("button",{style:{...ze.plotBtn,fontSize:f("13px","12px"),padding:f("8px 12px","6px 10px")},onClick:i,children:""})]}),r.jsx("div",{style:{...ze.quickRow,flexWrap:u?"wrap":"nowrap"},children:S.map(_=>r.jsx("button",{style:{...ze.quickBtn,flex:u?"1 1 30%":"1",fontSize:f("12px","11px")},disabled:!!a,onClick:()=>x(_.value),children:_.label},_.label))}),r.jsxs("div",{style:{...ze.autoBidRow,flexDirection:u?"column":"row",alignItems:u?"flex-start":"center"},children:[r.jsxs("label",{style:{display:"flex",alignItems:"center",gap:8,fontSize:f("12px","11px")},children:[r.jsx("input",{type:"checkbox",checked:!!j.enabled,onChange:v,disabled:!!a}),r.jsx("span",{children:""})]}),r.jsx("input",{value:j.ceiling,onChange:_=>g(_.target.value),placeholder:"",style:{...ze.input,width:f("120px","100%"),fontSize:f("13px","12px"),padding:f("8px","6px")},disabled:!j.enabled||a})]}),r.jsx("div",{style:{...ze.history,fontSize:f("12px","11px")},children:I.map((_,C)=>r.jsxs("div",{style:{...ze.historyRow,fontSize:f("12px","11px")},children:[r.jsx("span",{children:_.bidder}),r.jsxs("span",{children:[_.amount," "]})]},`${_.bidder}-${C}`))})]})},ze={overlay:{position:"fixed",inset:0,backgroundColor:"rgba(0,0,0,0.7)",display:"flex",justifyContent:"center",alignItems:"center",zIndex:1200,padding:"20px",overflowY:"auto"},modalWrapper:{position:"relative",width:"min(1080px, 96vw)",maxHeight:"92vh"},modalShell:{position:"relative",background:"linear-gradient(160deg, rgba(29,24,18,0.95), rgba(36,28,22,0.92))",borderRadius:"24px",border:"1px solid rgba(255,255,255,0.08)",boxShadow:"0 25px 80px rgba(0,0,0,0.55)",padding:"24px",color:"#fcefdc",maxHeight:"92vh",overflow:"hidden",display:"flex",flexDirection:"column"},header:{position:"relative",display:"flex",justifyContent:"space-between",gap:"16px",borderBottom:"1px solid rgba(255,255,255,0.08)",paddingBottom:"16px"},headerActions:{display:"flex",alignItems:"center",gap:"12px"},title:{margin:0,fontSize:"24px",letterSpacing:"1px"},message:{margin:"6px 0 0",color:"#f5d7a0"},resourceChip:{background:"rgba(0,0,0,0.35)",padding:"6px 14px",borderRadius:"999px",fontWeight:"bold",border:"1px solid rgba(255,255,255,0.15)"},closeBtn:{border:"1px solid rgba(255,255,255,0.35)",background:"transparent",color:"#fff",borderRadius:"999px",padding:"6px 16px",cursor:"pointer"},body:{marginTop:"20px",overflow:"hidden"},catalogPanel:{flex:1,maxHeight:"60vh",overflowY:"auto",display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(260px, 1fr))",gap:"14px",paddingRight:"6px"},plotCard:{borderRadius:"18px",padding:"20px",background:"rgba(0,0,0,0.35)",border:"1px solid rgba(255,255,255,0.06)",flex:1,display:"flex",flexDirection:"column"},plotTitle:{margin:0,color:"#ffe0b2"},plotContent:{marginTop:"12px",whiteSpace:"pre-wrap",lineHeight:1.6,color:"#f8f0dd",overflowY:"auto"},backBtn:{marginTop:"auto",border:"1px solid rgba(255,255,255,0.4)",borderRadius:"12px",padding:"10px",background:"transparent",color:"#fff",cursor:"pointer"},item:{borderRadius:"16px",border:"1px solid #f5deb3",background:"rgba(255,252,247,0.9)",padding:"14px",display:"flex",flexDirection:"column",gap:"8px"},itemHeader:{display:"flex",justifyContent:"space-between"},desc:{fontSize:"13px",color:"#654321"},chipRow:{display:"flex",gap:"6px",flexWrap:"wrap"},chip:{padding:"2px 10px",borderRadius:"999px",background:"rgba(255,193,7,0.15)",border:"1px solid rgba(255,193,7,0.3)",fontSize:"11px",color:"#a15c00"},bidRow:{display:"flex",justifyContent:"space-between",fontSize:"12px",color:"#775c44"},bidMeta:{fontSize:"12px"},inputRow:{display:"flex",gap:"8px"},input:{flex:1,borderRadius:"10px",border:"1px solid #d7ccc8",padding:"8px"},bidBtn:{padding:"8px 14px",borderRadius:"10px",border:"none",background:"#8d6e63",color:"#fff",cursor:"pointer"},plotBtn:{padding:"8px 12px",borderRadius:"10px",border:"1px solid #d7ccc8",background:"transparent",cursor:"pointer"},quickRow:{display:"flex",gap:"8px"},quickBtn:{flex:1,padding:"6px 0",borderRadius:"8px",border:"1px dashed #c7b8a3",background:"transparent",cursor:"pointer"},autoBidRow:{display:"flex",alignItems:"center",justifyContent:"space-between",gap:"10px"},history:{marginTop:"8px",borderTop:"1px dashed #d7ccc8",paddingTop:"8px"},historyRow:{display:"flex",justifyContent:"space-between",fontSize:"12px"},feedbackOverlay:{position:"fixed",inset:0,background:"rgba(0,0,0,0.55)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1300,padding:"20px"},feedbackCard:{background:"#fffef8",borderRadius:"18px",padding:"24px",maxWidth:"420px",width:"100%",border:"2px solid",boxShadow:"0 18px 45px rgba(0,0,0,0.3)"},feedbackBtn:{marginTop:"16px",width:"100%",padding:"10px 12px",borderRadius:"12px",border:"none",background:"#6d4c41",color:"#fff",cursor:"pointer"}},pu={common:"#9e9e9e",uncommon:"#4caf50",rare:"#2196f3",epic:"#9c27b0",legendary:"#ff9800"},Wh=[{id:"ALL",label:"",matcher:()=>!0},{id:"CONSUMABLE",label:"",matcher:e=>e.type==="consumable"},{id:"EQUIPMENT",label:"",matcher:e=>["weapon","armor","accessory"].includes(e.type)},{id:"MANUAL",label:"",matcher:e=>e.type==="manual"},{id:"OTHER",label:"",matcher:e=>!["consumable","manual","weapon","armor","accessory"].includes(e.type)}],i5=({items:e=[],mode:t="VIEW",slot:n=null,childId:s=null,children:o=[],batchUseItems:i=[],onClose:a,onEquip:l,onUse:d,onBatchUse:u,onGiveToChild:p,onBatchGive:c,onSell:f,onDiscard:b,onAutoAssignManual:S,getMarketPrice:E})=>{const[j,x]=y.useState([]),[h,v]=y.useState(!1),[g,I]=y.useState("grid"),[_,C]=y.useState("ALL"),[k,R]=y.useState(!1),[T,N]=y.useState({}),[Y,H]=y.useState(!1),[B,$]=y.useState({}),q=t==="VIEW",se=e.some(P=>P.type==="manual");y.useEffect(()=>{t!=="VIEW"&&_!=="ALL"&&C("ALL")},[t,_]);const J=P=>P.type!=="manual"?null:r.jsxs("div",{style:Ne.manualInfo,children:[P.tier&&r.jsx("span",{style:{...Ne.manualBadge,background:P.tierColor||"#999",marginRight:"8px"},children:P.tier}),P.element&&r.jsxs("span",{style:{...Ne.manualBadge,background:"#e3f2fd",color:"#1976d2",marginRight:"8px"},children:[": ",P.element]}),P.baseBonus&&r.jsxs("span",{style:{...Ne.manualBadge,background:"#e8f5e9",color:"#2e7d32"},children:[": ",P.baseBonus]})]}),X=t==="SELECT"&&n?e.filter(P=>P.slot===n):t==="MANUAL_SELECT"?e.filter(P=>P.type==="manual"):e,ye=(P=>{if(!q||_==="ALL")return P;const pe=Wh.find(fe=>fe.id===_);return pe?P.filter(pe.matcher):P})(X),Re={legendary:5,epic:4,rare:3,uncommon:2,common:1},Fe=[...ye].sort((P,pe)=>{const fe=Re[P.rarity]||0,ke=Re[pe.rarity]||0;return ke!==fe?ke-fe:(pe.name||"")!==(P.name||"")?(P.name||"").localeCompare(pe.name||""):(pe.quantity||0)-(P.quantity||0)}),O=P=>!P||!Array.isArray(P.usageTargets)||P.usageTargets.length===0?!0:P.usageTargets.includes(ft.CHILD),ie=P=>O(P)?P.type==="manual"?{allowed:!1,reason:""}:P.type==="consumable"?{allowed:!0,reason:""}:P.type==="weapon"||P.type==="armor"||P.type==="accessory"?{allowed:!0,reason:""}:{allowed:!1,reason:""}:{allowed:!1,reason:""},le=P=>{j.includes(P)?x(j.filter(pe=>pe!==P)):x([...j,P])},ee=()=>{if(j.length===0){window.showResult&&window.showResult("","",!1,null,!1);return}const P=j.filter(fe=>{const ke=e.find(je=>je.instanceId===fe);return ke&&ie(ke).allowed});if(P.length===0){window.showResult&&window.showResult("","",!1,null,!1);return}H(!0),v(!1);const pe={};P.forEach(fe=>{e.find(je=>je.instanceId===fe)&&(pe[fe]=1)}),$(pe)},he={consumable:"",weapon:"",armor:"",accessory:"",manual:""},Ee={consumable:"",weapon:"",armor:"",accessory:"",manual:""},_e={weapon:"",armor:"",accessory:""},rt=P=>P.icon||P.emoji||Ee[P.type]||"",At=P=>{if(P.type==="consumable"&&P.effect){const ke=P.effect;if(ke.kind==="exp")return` +${ke.amount}`;if(ke.kind==="aptitude")return` +${ke.amount}`;if(ke.kind==="intelligence")return` +${ke.amount}`;if(ke.kind==="heal")return` +${ke.amount}`}if(P.type==="manual"&&P.manualIds)return` ${P.manualIds.length} `;const pe=P.stats||{},fe=[];return pe.atk&&fe.push(` +${pe.atk}`),pe.hp&&fe.push(` +${pe.hp}`),pe.mp&&fe.push(` +${pe.mp}`),fe.join(" / ")},Oe=P=>{if(h)return null;const pe=[];return t==="SELECT"&&P.slot===n&&pe.push(r.jsx("button",{style:Ne.btnPrimary,onClick:fe=>{fe.stopPropagation(),l&&l(P.instanceId)},children:""},"equip")),t==="MANUAL_SELECT"&&P.type==="manual"&&pe.push(r.jsx("button",{style:Ne.btnPrimary,onClick:fe=>{fe.stopPropagation(),d&&d(P.instanceId)},children:""},"manual")),t==="VIEW"&&P.type==="consumable"&&pe.push(r.jsx("button",{style:Ne.btnPrimary,onClick:fe=>{fe.stopPropagation(),d&&d(P.instanceId)},children:s?"":""},"use")),t==="VIEW"&&P.type==="manual"&&pe.push(r.jsx("button",{style:Ne.btnPrimary,onClick:fe=>{fe.stopPropagation(),d&&d(P.instanceId)},children:s?"":""},"study")),t==="VIEW"&&!s&&pe.push(r.jsx("button",{style:{...Ne.btnSecondary,background:"#e53935"},onClick:fe=>{fe.stopPropagation(),window.showConfirm?window.showConfirm(` ${P.name}${P.quantity&&P.quantity>1?" () ":""}`,()=>{b&&b(P.instanceId)}):b&&b(P.instanceId)},children:""},"discard")),t==="VIEW"&&!s&&o&&o.length>0&&pe.push(r.jsx("button",{style:Ne.btnSecondary,onClick:fe=>{fe.stopPropagation(),p&&p(P.instanceId)},children:""},"give")),t==="SELL"&&pe.push(r.jsx("button",{style:{...Ne.btnPrimary,background:"#f57c00"},onClick:fe=>{if(fe.stopPropagation(),!!f){if(P.quantity&&P.quantity>1&&window.showConfirm){window.showConfirm(`1-${P.quantity}`,ke=>{const je=parseInt(ke||`${P.quantity}`,10);if(!je||je<=0){window.showResult&&window.showResult("","",!1,null,!1);return}f(P.instanceId,Math.min(je,P.quantity||1))},{input:{type:"number",min:1,max:P.quantity||1,step:1,defaultValue:`${P.quantity}`}});return}f(P.instanceId,1)}},children:""},"sell")),pe.length?pe:null};return r.jsx("div",{style:Ne.overlay,children:r.jsxs("div",{style:Ne.modal,children:[r.jsxs("div",{style:Ne.header,children:[r.jsx("h3",{style:{margin:0},children:t==="SELECT"?"":""}),r.jsx("button",{style:Ne.close,onClick:a,children:""})]}),r.jsx("div",{style:Ne.tip,children:t==="SELECT"&&n?`${_e[n]||n}`:t==="MANUAL_SELECT"?"":t==="SELL"?"":""}),r.jsxs("div",{style:Ne.toolbar,children:[r.jsxs("span",{style:Ne.toolbarMeta,children:[" ",Fe.length,"   ",g==="grid"?"":""]}),r.jsxs("div",{style:Ne.viewSwitch,children:[r.jsx("button",{type:"button",style:g==="grid"?{...Ne.viewBtn,...Ne.viewBtnActive}:Ne.viewBtn,onClick:()=>I("grid"),children:" "}),r.jsx("button",{type:"button",style:g==="list"?{...Ne.viewBtn,...Ne.viewBtnActive}:Ne.viewBtn,onClick:()=>I("list"),children:" "})]})]}),q&&r.jsxs("div",{style:Ne.categoryBar,children:[r.jsx("div",{style:Ne.categoryGroup,children:Wh.map(P=>r.jsx("button",{type:"button",onClick:()=>C(P.id),style:_===P.id?{...Ne.categoryBtn,...Ne.categoryBtnActive}:Ne.categoryBtn,children:P.label},P.id))}),S&&r.jsx("button",{type:"button",onClick:S,disabled:!se||!(o&&o.length),style:{...Ne.autoAssignBtn,opacity:!se||!(o&&o.length)?.5:1,cursor:!se||!(o&&o.length)?"not-allowed":"pointer"},children:" "})]}),t==="VIEW"&&!s&&r.jsxs("div",{style:{padding:"10px 16px",borderBottom:"1px solid #eee",background:h?"#e3f2fd":"#f5f5f5",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[r.jsx("button",{onClick:()=>{v(!h),x([])},style:{padding:"6px 12px",border:"none",borderRadius:"6px",background:h?"#1976d2":"#757575",color:"#fff",cursor:"pointer",fontSize:"12px"},children:h?" ":" "}),h&&r.jsxs("div",{style:{display:"flex",gap:"8px",alignItems:"center"},children:[r.jsxs("span",{style:{fontSize:"12px",color:"#666"},children:[" ",j.length," "]}),!s&&r.jsx("button",{onClick:()=>{if(j.length===0){window.showResult&&window.showResult("","",!1,null,!1);return}R(!0),v(!1);const P={};j.forEach(pe=>{const fe=e.find(ke=>ke.instanceId===pe);fe&&fe.type==="consumable"&&(P[pe]=1)}),N(P)},disabled:j.length===0,style:{padding:"6px 12px",border:"none",borderRadius:"6px",background:j.length>0?"#4caf50":"#ccc",color:"#fff",cursor:j.length>0?"pointer":"not-allowed",fontSize:"12px"},children:""}),o&&o.length>0&&r.jsx("button",{onClick:ee,disabled:j.length===0,style:{padding:"6px 12px",border:"none",borderRadius:"6px",background:j.length>0?"#7b1fa2":"#ccc",color:"#fff",cursor:j.length>0?"pointer":"not-allowed",fontSize:"12px"},children:""}),t==="SELL"&&r.jsx("button",{onClick:()=>{if(!f)return;if(j.length===0){window.showResult&&window.showResult("","",!1,null,!1);return}const P=j.map(ke=>{const je=e.find(Ge=>Ge.instanceId===ke);return je?{instanceId:ke,qty:je.quantity||1}:null}).filter(Boolean);let pe=0;const fe=()=>{if(pe>=P.length){x([]),v(!1);return}const{instanceId:ke,qty:je}=P[pe];f(ke,je),pe++,setTimeout(fe,50)};fe()},disabled:j.length===0,style:{padding:"6px 12px",border:"none",borderRadius:"6px",background:j.length>0?"#f57c00":"#ccc",color:"#fff",cursor:j.length>0?"pointer":"not-allowed",fontSize:"12px"},children:""}),o&&o.length>0&&r.jsx("button",{onClick:()=>{const P=ye.filter(pe=>ie(pe).allowed).map(pe=>pe.instanceId);x(P)},style:{padding:"6px 12px",border:"none",borderRadius:"6px",background:"#00897b",color:"#fff",cursor:"pointer",fontSize:"12px"},children:""})]})]}),k&&r.jsxs("div",{style:{padding:"16px",background:"#e8f5e9",borderBottom:"1px solid #c8e6c9",borderRadius:"8px",margin:"8px"},children:[r.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"12px"},children:[r.jsx("h4",{style:{margin:0,color:"#2e7d32"},children:" "}),r.jsx("button",{onClick:()=>{R(!1),N({}),x([])},style:{padding:"4px 8px",border:"none",borderRadius:"4px",background:"#757575",color:"#fff",cursor:"pointer",fontSize:"11px"},children:""})]}),r.jsx("div",{style:{maxHeight:"200px",overflowY:"auto",marginBottom:"12px"},children:Object.keys(T).map(P=>{const pe=e.find(je=>je.instanceId===P);if(!pe)return null;const fe=pe.quantity||1,ke=T[P]||1;return r.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",padding:"8px",background:"#fff",borderRadius:"6px",marginBottom:"8px",border:"1px solid #c8e6c9"},children:[r.jsxs("span",{style:{fontSize:"13px",flex:1},children:[rt(pe)," ",pe.name,r.jsxs("span",{style:{color:"#999",marginLeft:"8px"},children:["(: ",fe,")"]})]}),r.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[r.jsx("button",{onClick:()=>{const je=Math.max(1,ke-1);N(Ge=>({...Ge,[P]:je}))},disabled:ke<=1,style:{width:"24px",height:"24px",border:"none",borderRadius:"4px",background:ke<=1?"#e0e0e0":"#4caf50",color:"#fff",cursor:ke<=1?"not-allowed":"pointer",fontSize:"16px",lineHeight:"1"},children:"-"}),r.jsx("input",{type:"number",min:"1",max:fe,value:ke,onChange:je=>{const Ge=parseInt(je.target.value)||1,Jt=Math.max(1,Math.min(fe,Ge));N(_t=>({..._t,[P]:Jt}))},style:{width:"50px",padding:"4px",textAlign:"center",border:"1px solid #c8e6c9",borderRadius:"4px",fontSize:"13px"}}),r.jsx("button",{onClick:()=>{const je=Math.min(fe,ke+1);N(Ge=>({...Ge,[P]:je}))},disabled:ke>=fe,style:{width:"24px",height:"24px",border:"none",borderRadius:"4px",background:ke>=fe?"#e0e0e0":"#4caf50",color:"#fff",cursor:ke>=fe?"not-allowed":"pointer",fontSize:"16px",lineHeight:"1"},children:"+"}),r.jsx("button",{onClick:()=>{const je={...T};delete je[P],N(je),x(Ge=>Ge.filter(Jt=>Jt!==P))},style:{padding:"4px 8px",border:"none",borderRadius:"4px",background:"#f44336",color:"#fff",cursor:"pointer",fontSize:"11px"},children:""})]})]},P)})}),r.jsx("div",{style:{display:"flex",gap:"8px",justifyContent:"flex-end"},children:r.jsx("button",{onClick:()=>{const P=Object.keys(T).map(pe=>({instanceId:pe,quantity:T[pe]}));if(P.length===0){window.showResult&&window.showResult("","",!1,null,!1);return}u&&u(s||null,P),R(!1),N({}),x([])},style:{padding:"8px 16px",border:"none",borderRadius:"6px",background:"#4caf50",color:"#fff",cursor:"pointer",fontSize:"13px",fontWeight:"bold"},children:" "})})]}),Y&&r.jsxs("div",{style:{padding:"16px",background:"#f3e5f5",borderBottom:"1px solid #e1bee7",borderRadius:"8px",margin:"8px"},children:[r.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"12px"},children:[r.jsx("h4",{style:{margin:0,color:"#7b1fa2"},children:" "}),r.jsx("button",{onClick:()=>{H(!1),$({}),x([])},style:{padding:"4px 8px",border:"none",borderRadius:"4px",background:"#757575",color:"#fff",cursor:"pointer",fontSize:"11px"},children:""})]}),r.jsx("div",{style:{maxHeight:"200px",overflowY:"auto",marginBottom:"12px"},children:Object.keys(B).map(P=>{const pe=e.find(je=>je.instanceId===P);if(!pe)return null;const fe=pe.quantity||1,ke=B[P]||1;return r.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",padding:"8px",background:"#fff",borderRadius:"6px",marginBottom:"8px",border:"1px solid #e1bee7"},children:[r.jsxs("span",{style:{fontSize:"13px",flex:1},children:[rt(pe)," ",pe.name,r.jsxs("span",{style:{color:"#999",marginLeft:"8px"},children:["(: ",fe,")"]})]}),r.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[r.jsx("button",{onClick:()=>{const je=Math.max(1,ke-1);$(Ge=>({...Ge,[P]:je}))},disabled:ke<=1,style:{width:"24px",height:"24px",border:"none",borderRadius:"4px",background:ke<=1?"#e0e0e0":"#7b1fa2",color:"#fff",cursor:ke<=1?"not-allowed":"pointer",fontSize:"16px",lineHeight:"1"},children:"-"}),r.jsx("input",{type:"number",min:"1",max:fe,value:ke,onChange:je=>{const Ge=parseInt(je.target.value)||1,Jt=Math.max(1,Math.min(fe,Ge));$(_t=>({..._t,[P]:Jt}))},style:{width:"50px",padding:"4px",textAlign:"center",border:"1px solid #e1bee7",borderRadius:"4px",fontSize:"13px"}}),r.jsx("button",{onClick:()=>{const je=Math.min(fe,ke+1);$(Ge=>({...Ge,[P]:je}))},disabled:ke>=fe,style:{width:"24px",height:"24px",border:"none",borderRadius:"4px",background:ke>=fe?"#e0e0e0":"#7b1fa2",color:"#fff",cursor:ke>=fe?"not-allowed":"pointer",fontSize:"16px",lineHeight:"1"},children:"+"}),r.jsx("button",{onClick:()=>{const je={...B};delete je[P],$(je),x(Ge=>Ge.filter(Jt=>Jt!==P))},style:{padding:"4px 8px",border:"none",borderRadius:"4px",background:"#f44336",color:"#fff",cursor:"pointer",fontSize:"11px"},children:""})]})]},P)})}),r.jsx("div",{style:{display:"flex",gap:"8px",justifyContent:"flex-end"},children:r.jsx("button",{onClick:()=>{const P=Object.keys(B).map(fe=>({instanceId:fe,quantity:B[fe]}));if(P.length===0){window.showResult&&window.showResult("","",!1,null,!1);return}const pe=P.map(({instanceId:fe,quantity:ke})=>({instanceId:fe,quantity:ke}));c&&c(pe),H(!1),$({}),x([])},style:{padding:"8px 16px",border:"none",borderRadius:"6px",background:"#7b1fa2",color:"#fff",cursor:"pointer",fontSize:"13px",fontWeight:"bold"},children:" "})})]}),r.jsxs("div",{style:Ne.list,children:[Fe.length===0&&r.jsx("div",{style:Ne.empty,children:""}),Fe.length>0&&r.jsx("div",{style:g==="grid"?Ne.gridContainer:Ne.listContainer,children:Fe.map(P=>{const pe=j.includes(P.instanceId),fe=ie(P),ke=Oe(P),je=t==="SELL"?Math.floor((E?E(P):P.sellPrice||P.price||0)*.7):null;return g==="grid"?r.jsxs("div",{style:{...Ne.gridCard,borderColor:pe?"#1976d2":"rgba(0,0,0,0.05)",borderWidth:"2px",boxShadow:pe?"0 0 0 1px #1976d2":"0 6px 16px rgba(0,0,0,0.08)",cursor:h?"pointer":"default"},onClick:()=>{h&&le(P.instanceId)},children:[h&&r.jsx("input",{type:"checkbox",checked:pe,onChange:Ge=>{Ge.stopPropagation(),le(P.instanceId)},style:Ne.gridCheckbox}),r.jsxs("div",{style:Ne.gridMain,children:[r.jsx("div",{style:{...Ne.gridIcon,borderColor:pu[P.rarity]||"#d7ccc8",borderWidth:"2px",borderStyle:"solid"},children:r.jsx("span",{children:rt(P)})}),r.jsxs("div",{style:Ne.gridBody,children:[r.jsxs("div",{style:Ne.gridTitleRow,children:[r.jsx("span",{style:{color:pu[P.rarity]||"#333",fontWeight:"bold"},children:P.name}),P.quantity&&P.quantity>1&&r.jsxs("span",{style:Ne.gridQty,children:["x",P.quantity]})]}),r.jsxs("div",{style:Ne.gridMeta,children:[r.jsx("span",{style:Ne.gridTag,children:he[P.type]||P.type}),r.jsx("span",{style:{fontSize:"11px",color:"#5d4037"},children:At(P)||""})]}),r.jsx("div",{style:Ne.gridDesc,children:P.desc}),J(P),je!==null&&r.jsxs("div",{style:Ne.gridPrice,children:[": ",je," "]}),h&&!fe.allowed&&r.jsxs("div",{style:Ne.gridWarning,children:[" ",fe.reason]})]})]}),ke&&r.jsx("div",{style:Ne.gridActions,children:ke})]},P.instanceId):r.jsxs("div",{style:{...Ne.card,borderColor:pe?"#1976d2":"#eee",borderWidth:pe?"2px":"1px",background:pe?"#e3f2fd":"#fafafa",cursor:h?"pointer":"default"},onClick:()=>{h&&le(P.instanceId)},children:[r.jsxs("div",{style:Ne.rowBetween,children:[r.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[h&&r.jsx("input",{type:"checkbox",checked:pe,onChange:Ge=>{Ge.stopPropagation(),le(P.instanceId)},style:{cursor:"pointer"}}),r.jsx("span",{style:{color:pu[P.rarity]||"#333",fontWeight:"bold"},children:P.name}),P.quantity&&P.quantity>1&&r.jsxs("span",{style:{fontSize:"12px",color:"#666",marginLeft:"6px"},children:["x",P.quantity]})]}),r.jsx("span",{style:Ne.tag,children:he[P.type]||P.type})]}),J(P),r.jsx("div",{style:Ne.desc,children:P.desc}),r.jsx("div",{style:Ne.stats,children:At(P)||""}),je!==null&&r.jsxs("div",{style:{fontSize:"12px",color:"#f57c00",marginTop:6},children:[": ",je," "]}),h&&!fe.allowed&&r.jsxs("div",{style:{fontSize:"11px",color:"#f44336",marginTop:"4px",padding:"4px 8px",background:"rgba(244, 67, 54, 0.1)",borderRadius:"4px"},children:[" ",fe.reason]}),ke&&r.jsx("div",{style:Ne.actions,children:ke})]},P.instanceId)})})]})]})})},Ne={overlay:{position:"fixed",inset:0,background:"rgba(0,0,0,0.5)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:2e3},modal:{width:"520px",maxHeight:"80vh",background:"#fff",borderRadius:"12px",boxShadow:"0 10px 25px rgba(0,0,0,0.2)",display:"flex",flexDirection:"column"},header:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"12px 16px",borderBottom:"1px solid #eee"},close:{border:"none",background:"transparent",fontSize:"20px",cursor:"pointer",color:"#888"},tip:{padding:"8px 16px",fontSize:"12px",color:"#666",borderBottom:"1px dashed #eee"},toolbar:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"10px 16px",borderBottom:"1px solid #f0e0d6",background:"#fffbe6"},toolbarMeta:{fontSize:"12px",color:"#8d6e63"},viewSwitch:{display:"flex",gap:"6px"},viewBtn:{fontSize:"12px",padding:"4px 10px",borderRadius:"999px",border:"1px solid #d7ccc8",background:"#fff",cursor:"pointer",color:"#6d4c41"},viewBtnActive:{background:"#6d4c41",color:"#fff",borderColor:"#6d4c41"},categoryBar:{display:"flex",justifyContent:"space-between",alignItems:"center",gap:"12px",padding:"8px 16px",borderBottom:"1px solid #f0f0f0",background:"#fff"},categoryGroup:{display:"flex",flexWrap:"wrap",gap:"8px"},categoryBtn:{fontSize:"12px",padding:"4px 12px",borderRadius:"12px",border:"1px solid #d7ccc8",background:"#fff",color:"#6d4c41",cursor:"pointer",transition:"all 0.2s"},categoryBtnActive:{background:"#6d4c41",color:"#fff",borderColor:"#6d4c41",boxShadow:"0 2px 6px rgba(0,0,0,0.1)"},autoAssignBtn:{fontSize:"12px",padding:"6px 14px",borderRadius:"16px",border:"none",background:"linear-gradient(120deg, #ff9800, #ff5722)",color:"#fff",fontWeight:"bold"},list:{padding:"12px",overflowY:"auto"},listContainer:{display:"flex",flexDirection:"column",gap:"10px"},gridContainer:{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(180px, 1fr))",gap:"12px"},empty:{textAlign:"center",color:"#999",padding:"20px"},card:{borderWidth:"1px",borderStyle:"solid",borderColor:"#eee",borderRadius:"8px",padding:"10px",marginBottom:"10px",background:"#fafafa"},gridCard:{position:"relative",borderRadius:"12px",padding:"14px",background:"#fff",display:"flex",flexDirection:"column",gap:"10px",borderStyle:"solid",borderColor:"rgba(0,0,0,0.05)"},gridMain:{display:"flex",gap:"10px",alignItems:"flex-start"},rowBetween:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"6px"},tag:{fontSize:"10px",padding:"2px 6px",borderRadius:"6px",background:"#e0e0e0",color:"#555",textTransform:"uppercase"},desc:{fontSize:"12px",color:"#555",marginBottom:"6px"},stats:{fontSize:"12px",color:"#333",marginBottom:"8px"},actions:{display:"flex",gap:"8px",flexWrap:"wrap"},gridIcon:{width:"54px",height:"54px",borderRadius:"12px",borderWidth:"2px",borderStyle:"solid",borderColor:"#d7ccc8",display:"flex",alignItems:"center",justifyContent:"center",fontSize:"24px",color:"#4e342e"},gridBody:{display:"flex",flexDirection:"column",gap:"6px"},gridTitleRow:{display:"flex",justifyContent:"space-between",alignItems:"center"},gridQty:{fontSize:"12px",color:"#6d4c41"},gridMeta:{display:"flex",flexDirection:"column",alignItems:"flex-start",gap:"4px"},gridTag:{fontSize:"10px",padding:"2px 6px",borderRadius:"999px",background:"#f3e5f5",color:"#6a1b9a"},gridDesc:{fontSize:"11px",color:"#5d4037",lineHeight:1.4,minHeight:"32px"},gridActions:{display:"flex",flexWrap:"wrap",gap:"6px"},gridCheckbox:{position:"absolute",top:"10px",left:"10px",cursor:"pointer"},gridWarning:{fontSize:"11px",color:"#c62828",background:"rgba(198,40,40,0.08)",padding:"4px 8px",borderRadius:"6px"},gridPrice:{fontSize:"11px",color:"#f57c00",fontWeight:"bold"},btnPrimary:{padding:"6px 12px",border:"none",borderRadius:"6px",background:"#1976d2",color:"#fff",cursor:"pointer"},btnSecondary:{padding:"6px 12px",border:"none",borderRadius:"6px",background:"#7b1fa2",color:"#fff",cursor:"pointer",fontSize:"12px"},manualInfo:{display:"flex",flexWrap:"wrap",gap:"6px",marginTop:"8px",marginBottom:"8px"},manualBadge:{fontSize:"11px",padding:"3px 8px",borderRadius:"12px",color:"#fff",fontWeight:"bold",whiteSpace:"nowrap"}},a5=({child:e,onClose:t,onFinish:n})=>{const[s,o]=y.useState("INIT"),i=()=>{o("ANIMATING"),setTimeout(()=>{o("REVEAL")},2e3)},a=()=>{n(e),t()},l=d=>({:"#FFD700",:"#4CAF50",:"#2196F3",:"#F44336",:"#795548",:"#673AB7",:"#00BCD4",:"#009688"})[d]||"#ccc";return r.jsx("div",{style:xr.overlay,children:r.jsxs("div",{style:xr.card,children:[r.jsx("h2",{style:{color:"#3e2723"},children:" "}),s==="INIT"&&r.jsxs("div",{style:{textAlign:"center"},children:[r.jsx("h3",{style:{margin:"0 0 15px 0",color:"#3e2723"},children:e.name}),r.jsx("p",{children:""}),r.jsxs("p",{children:["",e.gender===""?"":"",""]}),r.jsx("div",{style:xr.childIcon,children:e.gender===""?"":""}),r.jsx("button",{onClick:i,style:xr.btn,children:" "})]}),s==="ANIMATING"&&r.jsxs("div",{style:{textAlign:"center"},children:[r.jsx("h3",{style:{margin:"0 0 15px 0",color:"#3e2723"},children:e.name}),r.jsx("div",{style:xr.orb}),r.jsx("p",{children:"..."})]}),s==="REVEAL"&&r.jsxs("div",{style:{textAlign:"center",animation:"fadeIn 0.5s"},children:[r.jsx("h3",{style:{margin:"0 0 15px 0",color:"#3e2723"},children:e.name}),r.jsx("h3",{children:"  "}),r.jsxs("div",{style:xr.resultBox,children:[r.jsx("div",{style:{color:e.spiritRoot.color,fontSize:"24px",fontWeight:"bold"},children:e.spiritRoot.type}),r.jsx("div",{style:xr.elements,children:e.spiritRoot.elements.map(d=>r.jsx("span",{style:{...xr.elBadge,background:l(d)},children:d},d))}),r.jsxs("div",{style:{marginTop:"15px"},children:[r.jsx("span",{style:{fontSize:"12px",color:"#666"},children:""}),r.jsxs("div",{style:{fontSize:"40px",fontWeight:"bold",color:"#333"},children:[e.stats.aptitude,r.jsx("span",{style:{fontSize:"14px",color:"#999"},children:"/100"})]})]}),r.jsx("p",{style:{fontSize:"12px",color:"#666",marginTop:"10px"},children:e.spiritRoot.desc})]}),r.jsxs("div",{style:xr.stats,children:[r.jsxs("p",{children:[": ",r.jsx("strong",{children:e.stats.aptitude})]}),r.jsxs("p",{children:[": ",r.jsx("strong",{children:e.combatStats.mp})]})]}),r.jsx("button",{onClick:a,style:xr.confirmBtn,children:""})]})]})})},xr={overlay:{position:"fixed",top:0,left:0,right:0,bottom:0,background:"rgba(0,0,0,0.8)",display:"flex",justifyContent:"center",alignItems:"center",zIndex:400},card:{width:"320px",background:"#fff",borderRadius:"15px",padding:"30px",textAlign:"center",boxShadow:"0 0 20px rgba(255, 215, 0, 0.3)"},btn:{padding:"15px 30px",fontSize:"18px",background:"#3e2723",color:"white",border:"none",borderRadius:"25px",cursor:"pointer",marginTop:"20px"},confirmBtn:{padding:"10px 20px",background:"#4caf50",color:"white",border:"none",borderRadius:"5px",marginTop:"20px",cursor:"pointer"},orb:{width:"80px",height:"80px",borderRadius:"50%",background:"radial-gradient(circle, #fff, #2196f3, #000)",margin:"20px auto",animation:"pulse 1s infinite"},childIcon:{fontSize:"50px",margin:"20px 0"},resultBox:{background:"#f5f5f5",padding:"15px",borderRadius:"10px",margin:"20px 0"},elements:{display:"flex",justifyContent:"center",gap:"5px",marginBottom:"10px"},elBadge:{padding:"4px 8px",borderRadius:"50%",color:"white",fontWeight:"bold",width:"24px",height:"24px",lineHeight:"24px"},stats:{display:"flex",justifyContent:"space-around",fontSize:"14px",borderTop:"1px dashed #ccc",paddingTop:"15px"}},l5=["","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","",""],Uh=(e="")=>{if(!e)return 0;const t=l5.indexOf(e);return t>=0?t:0},fu=8,c5=({children:e,item:t,items:n,isBatch:s=!1,onSelect:o,onClose:i})=>{const[a,l]=y.useState(null),[d,u]=y.useState("age"),[p,c]=y.useState(1),f=y.useMemo(()=>{const E=[...e];return E.sort((j,x)=>{var h,v;switch(d){case"age":return j.age-x.age;case"aptitude":return(((h=x.stats)==null?void 0:h.aptitude)||0)-(((v=j.stats)==null?void 0:v.aptitude)||0);case"cultivation":const g=Uh(j.tier||""),I=Uh(x.tier||"");if(g!==I)return I-g;const _=j.currentExp||0;return(x.currentExp||0)-_;case"name":return j.name.localeCompare(x.name,"zh-CN");default:return 0}}),E},[e,d]),b=Math.max(1,Math.ceil(f.length/fu)),S=y.useMemo(()=>{const E=(p-1)*fu;return f.slice(E,E+fu)},[f,p]);return wc.useEffect(()=>{c(1)},[d]),r.jsx("div",{style:lt.overlay,children:r.jsxs("div",{style:lt.modal,children:[r.jsxs("div",{style:lt.header,children:[r.jsx("h3",{style:{margin:0},children:""}),r.jsx("button",{style:lt.close,onClick:i,children:""})]}),r.jsx("div",{style:lt.tip,children:s?r.jsxs(r.Fragment,{children:[" ",r.jsx("strong",{style:{color:"#1976d2"},children:(n==null?void 0:n.length)||0})," ",r.jsxs("div",{style:{marginTop:"6px",fontSize:"11px",color:"#666"},children:[n==null?void 0:n.slice(0,3).map((E,j)=>r.jsxs("span",{style:{marginRight:"8px"},children:[" ",E.name]},j)),(n==null?void 0:n.length)>3&&`...${n.length}`]})]}):r.jsxs(r.Fragment,{children:[" ",r.jsx("strong",{style:{color:"#1976d2"},children:t==null?void 0:t.name})," "]})}),r.jsx("div",{style:lt.controlBar,children:r.jsxs("div",{style:lt.sortButtons,children:[r.jsx("button",{style:{...lt.sortBtn,...d==="age"?lt.sortBtnActive:{}},onClick:()=>u("age"),children:""}),r.jsx("button",{style:{...lt.sortBtn,...d==="cultivation"?lt.sortBtnActive:{}},onClick:()=>u("cultivation"),children:""}),r.jsx("button",{style:{...lt.sortBtn,...d==="aptitude"?lt.sortBtnActive:{}},onClick:()=>u("aptitude"),children:""}),r.jsx("button",{style:{...lt.sortBtn,...d==="name"?lt.sortBtnActive:{}},onClick:()=>u("name"),children:""})]})}),r.jsxs("div",{style:lt.list,children:[e.length===0&&r.jsx("div",{style:lt.empty,children:""}),S.map((E,j)=>{var x;return r.jsxs("div",{style:{...lt.childCard,...a===E.id?lt.childCardHover:{}},onClick:()=>o(E),onMouseEnter:()=>l(E.id),onMouseLeave:()=>l(null),children:[r.jsxs("div",{style:lt.childInfo,children:[r.jsxs("div",{style:lt.childHeader,children:[r.jsx("span",{style:lt.childName,children:E.name}),r.jsx("span",{style:lt.childTier,children:E.tierTitle||""})]}),r.jsxs("div",{style:lt.childStats,children:[r.jsxs("span",{children:[" ",Math.floor(E.age),""]}),r.jsxs("span",{children:[" ",E.gender]}),r.jsxs("span",{children:["  ",((x=E.stats)==null?void 0:x.aptitude)||50]})]})]}),r.jsx("div",{style:lt.arrow,children:""})]},E.id)})]}),b>1&&r.jsxs("div",{style:lt.pagination,children:[r.jsx("button",{style:{...lt.pageBtn,opacity:p===1?.5:1},disabled:p===1,onClick:()=>c(Math.max(1,p-1)),children:""}),r.jsxs("span",{style:lt.pageInfo,children:[" ",p," / ",b," "]}),r.jsx("button",{style:{...lt.pageBtn,opacity:p>=b?.5:1},disabled:p>=b,onClick:()=>c(Math.min(b,p+1)),children:""})]})]})})},lt={overlay:{position:"fixed",inset:0,background:"rgba(0,0,0,0.5)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:2100},modal:{width:"450px",maxHeight:"70vh",background:"#fff",borderRadius:"12px",boxShadow:"0 10px 25px rgba(0,0,0,0.2)",display:"flex",flexDirection:"column"},header:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"12px 16px",borderBottom:"1px solid #eee"},close:{border:"none",background:"transparent",fontSize:"20px",cursor:"pointer",color:"#888"},tip:{padding:"12px 16px",fontSize:"13px",color:"#555",background:"#f5f5f5",borderBottom:"1px solid #eee"},controlBar:{padding:"12px 12px",borderBottom:"1px solid #eee",backgroundColor:"#fafafa"},sortButtons:{display:"flex",gap:"6px",flexWrap:"wrap"},sortBtn:{padding:"6px 12px",fontSize:"11px",backgroundColor:"#f0f0f0",color:"#666",border:"1px solid #ddd",borderRadius:"4px",cursor:"pointer",transition:"all 0.2s"},sortBtnActive:{backgroundColor:"#1976d2",color:"#fff",borderColor:"#1976d2"},list:{padding:"12px",overflowY:"auto",flex:1},empty:{textAlign:"center",color:"#999",padding:"20px"},childCard:{borderWidth:"1px",borderStyle:"solid",borderColor:"#e0e0e0",borderRadius:"8px",padding:"12px",marginBottom:"10px",background:"#fafafa",cursor:"pointer",display:"flex",justifyContent:"space-between",alignItems:"center",transition:"all 0.2s"},childCardHover:{background:"#e3f2fd",borderColor:"#1976d2",borderWidth:"1px",borderStyle:"solid"},childInfo:{flex:1},childHeader:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"6px"},childName:{fontSize:"15px",fontWeight:"bold",color:"#333"},childTier:{fontSize:"11px",padding:"2px 8px",borderRadius:"10px",background:"#3e2723",color:"#fff"},childStats:{display:"flex",gap:"12px",fontSize:"12px",color:"#666"},arrow:{fontSize:"20px",color:"#1976d2",marginLeft:"10px"},pagination:{display:"flex",justifyContent:"center",alignItems:"center",gap:"8px",padding:"12px 16px",borderTop:"1px solid #eee",backgroundColor:"#fafafa"},pageBtn:{padding:"6px 12px",fontSize:"11px",backgroundColor:"#f0f0f0",color:"#666",border:"1px solid #ddd",borderRadius:"4px",cursor:"pointer",transition:"all 0.2s"},pageInfo:{color:"#666",fontSize:"12px",minWidth:"70px",textAlign:"center"}},d5=({child:e,onChangeManual:t})=>{if(!e.spiritRoot||!e.spiritRoot.elements)return r.jsxs("div",{style:Vt.section,children:[r.jsx("h4",{style:Vt.secTitle,children:" "}),r.jsx("p",{style:{color:"#999",fontSize:"12px"},children:"(6)"})]});const n=e.cultivationMethod||"basic_breath",s=vc(n,e.spiritRoot);if(!s.manual)return r.jsxs("div",{style:Vt.section,children:[r.jsx("h4",{style:Vt.secTitle,children:" "}),r.jsx("p",{style:{color:"#999",fontSize:"12px"},children:""})]});const{manual:o,compatibility:i,speedBonus:a}=s,l=i.color||"#999";return r.jsxs("div",{style:Vt.section,children:[r.jsx("h4",{style:Vt.secTitle,children:" "}),r.jsxs("div",{style:Vt.manualCard,children:[r.jsxs("div",{style:Vt.manualHeader,children:[r.jsxs("div",{style:Vt.manualName,children:[o.name,r.jsx("span",{style:{...Vt.tierBadge,background:o.tierColor,marginLeft:"8px"},children:o.tierName})]}),o.element!=="NONE"&&r.jsx("div",{style:Vt.elementBadge,children:o.element})]}),r.jsx("div",{style:Vt.manualDesc,children:o.desc}),r.jsxs("div",{style:{...Vt.compatibilityBox,borderColor:l},children:[r.jsxs("div",{style:Vt.compatibilityRow,children:[r.jsx("span",{children:""}),r.jsx("span",{style:{color:l,fontWeight:"bold"},children:i.desc})]}),r.jsxs("div",{style:Vt.compatibilityRow,children:[r.jsx("span",{children:""}),r.jsxs("span",{style:{color:"#2196F3",fontWeight:"bold"},children:["+",a]})]})]}),r.jsx("div",{style:Vt.actionRow,children:r.jsx("button",{style:Vt.changeBtn,onClick:()=>{t&&t(e)},children:" "})})]})]})},Vt={section:{marginBottom:"20px",paddingBottom:"15px",borderBottom:"1px dashed #e0e0e0"},secTitle:{fontSize:"14px",fontWeight:"bold",marginBottom:"10px",color:"#333"},manualCard:{background:"#f9f9f9",borderRadius:"8px",padding:"12px",border:"1px solid #e0e0e0"},manualHeader:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"8px"},manualName:{fontSize:"16px",fontWeight:"bold",color:"#333",display:"flex",alignItems:"center"},tierBadge:{display:"inline-block",padding:"2px 8px",borderRadius:"4px",fontSize:"11px",color:"white",fontWeight:"bold"},elementBadge:{padding:"4px 10px",background:"#FF6B6B",color:"white",borderRadius:"12px",fontSize:"12px",fontWeight:"bold"},manualDesc:{fontSize:"12px",color:"#666",marginBottom:"10px",lineHeight:"1.5"},compatibilityBox:{background:"white",borderLeft:"3px solid",padding:"8px 10px",marginBottom:"10px",borderRadius:"4px"},compatibilityRow:{display:"flex",justifyContent:"space-between",fontSize:"13px",marginBottom:"4px"},actionRow:{display:"flex",justifyContent:"flex-end"},changeBtn:{padding:"6px 16px",background:"#2196F3",color:"white",border:"none",borderRadius:"6px",cursor:"pointer",fontSize:"13px",fontWeight:"bold",transition:"background 0.2s"}},u5=({child:e,onClose:t,onAction:n,navigation:s,onNavigate:o})=>{var I,_,C,k,R,T,N,Y,H,B,$,q,se,J;const[i,a]=y.useState(!1),[l,d]=y.useState(e.name);y.useEffect(()=>{d(e.name),a(!1)},[e.id,e.name]),y.useEffect(()=>{if(typeof window>"u"||!o)return;const X=re=>{re.key==="ArrowLeft"&&(s!=null&&s.hasPrev)&&(re.preventDefault(),o("PREV")),re.key==="ArrowRight"&&(s!=null&&s.hasNext)&&(re.preventDefault(),o("NEXT"))};return window.addEventListener("keydown",X),()=>window.removeEventListener("keydown",X)},[s,o]);const u=X=>({:"#FFD700",:"#4CAF50",:"#2196F3",:"#F44336",:"#795548",:"#673AB7",:"#00BCD4",:"#009688"})[X]||"#9e9e9e",p=X=>({WHITE:"#9e9e9e",GREEN:"#4caf50",BLUE:"#2196f3",PURPLE:"#9c27b0",ORANGE:"#ff9800",RED:"#f44336"})[X]||"#333",c=()=>{n("RENAME",l),a(!1)},f=Math.floor(e.age*12),b=e.isTested&&f>=72&&!!e.spiritRoot,S=((I=e.stats)==null?void 0:I.aptitude)||0,E=jf(S),j=Math.min(100,S),x=Math.max(0,Math.floor(e.currentExp||0)),h=Math.max(1,Math.floor(e.maxExp||1)),v=Math.min(100,Math.round(x/h*100)),g=(X,re,ye)=>r.jsxs("div",{style:we.fractionWrapper,"aria-label":`${ye} ${X}/${re}`,children:[r.jsx("span",{style:we.fractionCaption,children:ye}),r.jsxs("div",{style:we.fractionBox,children:[r.jsx("span",{style:we.fractionNumerator,children:X}),r.jsx("span",{style:we.fractionDivider}),r.jsx("span",{style:we.fractionDenominator,children:re})]})]});return r.jsx("div",{style:we.overlay,children:r.jsxs("div",{style:we.modalWrapper,children:[r.jsx("button",{onClick:t,style:we.closeBtn,"aria-label":"",children:""}),r.jsxs("div",{style:we.modal,children:[s&&r.jsxs("div",{style:we.navBar,children:[r.jsxs("button",{type:"button","aria-label":"",onClick:()=>s.hasPrev&&o&&o("PREV"),disabled:!s.hasPrev,style:{...we.navBtn,...s.hasPrev?{}:we.navBtnDisabled},children:[" ",s.prevName||""]}),r.jsx("span",{style:we.navLabel,children:s.label||"--/--"}),r.jsxs("button",{type:"button","aria-label":"",onClick:()=>s.hasNext&&o&&o("NEXT"),disabled:!s.hasNext,style:{...we.navBtn,...s.hasNext?{}:we.navBtnDisabled},children:[s.nextName||""," "]})]}),r.jsx("div",{style:we.content,children:r.jsxs("div",{style:we.singleCol,children:[r.jsxs("div",{style:{display:"flex",gap:"20px",alignItems:"center",marginBottom:"20px",paddingBottom:"15px",borderBottom:"1px dashed #e0e0e0"},children:[r.jsx("div",{style:{marginBottom:"15px"},children:e.age===0?r.jsx("div",{style:{fontSize:"48px"},children:""}):e.age<15?r.jsx("div",{style:{fontSize:"48px"},children:""}):r.jsx(Hr,{dna:e.avatar,gender:e.gender,size:100})}),r.jsxs("div",{style:we.nameBox,children:[i?r.jsxs("div",{style:{display:"flex",gap:"5px"},children:[r.jsx("input",{value:l,onChange:X=>d(X.target.value),style:we.input}),r.jsx("button",{onClick:c,style:we.smallBtn,children:""})]}):r.jsxs("h2",{style:{margin:0},children:[e.name,r.jsx("span",{onClick:()=>a(!0),style:we.editIcon,children:""})]}),r.jsx("div",{style:we.tierBadge,children:e.tierTitle||""}),(e.sect||e.rank)&&r.jsx("div",{style:{marginTop:"8px",fontSize:"13px",color:"#d7a574",fontWeight:"bold"},children:e.sect?r.jsxs(r.Fragment,{children:[e.sect.name,e.rank&&`  ${e.rank}`]}):e.rank&&e.rank}),r.jsxs("div",{style:{marginTop:"10px",fontSize:"13px",color:"#555"},children:[r.jsxs("div",{style:{display:"flex",gap:"15px",marginBottom:"5px",flexWrap:"wrap"},children:[r.jsxs("div",{children:[" ",Math.floor(e.age),"",Math.floor(e.age%1*12),""]}),r.jsxs("div",{children:[" ",e.fatherName]}),r.jsxs("div",{children:[" ",e.gender]}),((_=e.stats)==null?void 0:_.lifespan)&&r.jsxs("div",{children:["  ",Math.floor(Math.max(0,Br(e))),"/",Math.floor(e.stats.lifespan),""]})]}),e.trait&&r.jsxs("div",{style:{...we.traitBox,borderColor:p(e.trait.rarity),marginTop:"5px",display:"inline-block"},children:[r.jsx("span",{style:{color:p(e.trait.rarity),fontWeight:"bold"},children:e.trait.name}),r.jsx("p",{style:{margin:"5px 0 0",fontSize:"10px",color:"#666"},children:e.trait.desc})]}),e.influenceProfile&&r.jsxs("div",{style:we.influencePanel,children:[r.jsxs("div",{style:{...we.influenceHeader,color:e.influenceProfile.color},children:[e.influenceProfile.label,r.jsx("span",{style:we.influenceScore,children:e.influenceProfile.score})]}),r.jsx("p",{style:we.influenceTagline,children:e.influenceProfile.tagline}),r.jsx("div",{style:we.influenceProgress,children:r.jsx("div",{style:{...we.influenceProgressFill,width:`${Math.min(100,Math.round((e.influenceProfile.progress||0)*100))}%`,background:e.influenceProfile.color}})}),r.jsxs("div",{style:we.influenceFooter,children:["",e.influenceProfile.nextLabel]})]})]})]})]}),r.jsxs("div",{style:we.section,children:[r.jsx("h4",{style:we.secTitle,children:" "}),e.spouse?r.jsxs("div",{style:we.spouseCard,children:[r.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"10px"},children:[r.jsx("div",{style:we.miniAvatar,children:e.spouse.gender===""?"":""}),r.jsxs("div",{children:[r.jsx("div",{style:{fontWeight:"bold",color:"#e91e63"},children:e.spouse.name}),r.jsx("div",{style:{fontSize:"12px",color:"#666"},children:e.spouse.gender===""?" ":" "}),r.jsx("div",{style:{fontSize:"12px"},children:e.spouse.tierTitle||""})]})]}),r.jsxs("div",{style:{marginTop:"8px",fontSize:"13px",display:"grid",gridTemplateColumns:"1fr 1fr 1fr",gap:"8px"},children:[r.jsxs("div",{children:[": ",r.jsx("span",{style:{color:"purple"},children:((C=e.spouse.stats)==null?void 0:C.aptitude)||e.spouse.aptitude})]}),r.jsxs("div",{children:[": ",((k=e.spouse.stats)==null?void 0:k.looks)||e.spouse.looks]}),r.jsxs("div",{children:[": ",((R=e.spouse.stats)==null?void 0:R.intelligence)||e.spouse.intelligence]}),r.jsxs("div",{style:{gridColumn:"span 3",color:"#d81b60"},children:[(T=e.spouse.spiritRoot)==null?void 0:T.type," ",(Y=(N=e.spouse.spiritRoot)==null?void 0:N.elements)==null?void 0:Y.join(", ")]})]})]}):r.jsxs("div",{style:{color:"#999",fontSize:"12px",textAlign:"center",padding:"15px",background:"#f5f5f5",borderRadius:"8px"},children:["",r.jsx("br",{}),r.jsx("button",{style:we.marryBtn,onClick:()=>{console.log("Marriage button clicked for child:",e.name,"id:",e.id),n("MARRY")},children:" "})]})]}),r.jsxs("div",{style:we.section,children:[r.jsx("h4",{style:we.secTitle,children:" "}),b?r.jsxs(r.Fragment,{children:[r.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"10px",marginBottom:"10px"},children:[r.jsx("strong",{style:{fontSize:"16px"},children:e.spiritRoot.type}),r.jsx("div",{style:{display:"flex",gap:"4px"},children:e.spiritRoot.elements.map(X=>r.jsx("span",{style:{...we.elBadge,background:u(X)},children:X},X))})]}),r.jsxs("div",{style:we.barContainer,children:[r.jsxs("span",{children:[" (",S,")"]}),r.jsx("div",{style:we.barBg,children:r.jsx("div",{style:{...we.barFill,width:`${j}%`,background:E.color}})})]}),r.jsx("p",{style:{fontSize:"12px",color:"#666",marginTop:"5px"},children:e.spiritRoot.desc})]}):r.jsx("p",{style:{color:"#999",fontStyle:"italic"},children:"6"})]}),r.jsxs("div",{style:we.section,children:[r.jsx("h4",{style:we.secTitle,children:" "}),r.jsx("div",{style:we.equipGrid,children:["weapon","armor","accessory"].map(X=>{var Re;const re=(Re=e.equipment)==null?void 0:Re[X],ye={weapon:"",armor:"",accessory:""};return r.jsxs("div",{style:we.equipSlot,children:[r.jsx("div",{style:{fontWeight:"bold"},children:ye[X]}),r.jsx("div",{style:{fontSize:"12px",color:"#555",minHeight:"18px"},children:re?re.name:""}),r.jsxs("div",{style:{display:"flex",gap:"6px"},children:[r.jsx("button",{style:we.smallBtn,onClick:()=>n("OPEN_INVENTORY",{mode:"SELECT",slot:X}),children:""}),re&&r.jsx("button",{style:we.smallBtn,onClick:()=>n("UNEQUIP",{slot:X}),children:""})]})]},X)})}),r.jsxs("div",{style:{marginTop:"8px",textAlign:"right"},children:[r.jsx("button",{style:we.smallBtn,onClick:()=>n("OPEN_INVENTORY",{mode:"VIEW"}),children:" "}),r.jsx(d5,{child:e,onChangeManual:X=>n("CHANGE_MANUAL",X)})]})]}),r.jsxs("div",{style:we.section,children:[r.jsx("h4",{style:we.secTitle,children:" "}),r.jsxs("div",{style:we.traitGrid,children:[r.jsxs("div",{style:we.traitRow,children:[r.jsx("span",{style:we.label,children:":"}),r.jsx(gc,{trait:hc(((H=e.stats)==null?void 0:H.looks)||50,"LOOKS",e.gender),showValue:!0})]}),r.jsxs("div",{style:we.traitRow,children:[r.jsx("span",{style:we.label,children:":"}),r.jsx(gc,{trait:hc(((B=e.stats)==null?void 0:B.intelligence)||50,"INT"),showValue:!0})]}),r.jsxs("div",{style:we.traitRow,children:[r.jsx("span",{style:we.label,children:":"}),r.jsx("div",{style:{flex:1,height:"8px",background:"#eee",borderRadius:"4px",overflow:"hidden"},children:r.jsx("div",{style:{height:"100%",width:`${S}%`,background:S>=90?"#d50000":S>=80?"#aa00ff":"#4caf50"}})}),r.jsx("span",{style:{fontSize:"12px",marginLeft:"5px"},children:S})]})]})]}),r.jsxs("div",{style:we.section,children:[r.jsx("h4",{style:we.secTitle,children:" "}),r.jsxs("div",{style:we.combatGrid,children:[r.jsxs("div",{style:we.statItem,children:[r.jsx("span",{style:{color:"#d32f2f"},children:""}),r.jsx("strong",{children:(($=e.combatStats)==null?void 0:$.hp)||100})]}),r.jsxs("div",{style:we.statItem,children:[r.jsx("span",{style:{color:"#1976d2"},children:""}),r.jsx("strong",{children:((q=e.combatStats)==null?void 0:q.mp)||0})]}),r.jsxs("div",{style:we.statItem,children:[r.jsx("span",{style:{color:"#f57c00"},children:""}),r.jsx("strong",{children:((se=e.combatStats)==null?void 0:se.atk)||5})]})]})]}),((J=e.stats)==null?void 0:J.lifespan)&&r.jsxs("div",{style:we.section,children:[r.jsx("h4",{style:we.secTitle,children:" "}),r.jsxs("div",{style:{fontSize:"12px",color:"#666",lineHeight:"1.6"},children:[r.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:"4px"},children:[r.jsx("span",{children:":"}),r.jsxs("span",{style:{fontWeight:"bold"},children:[Math.floor(e.age||0)," "]})]}),r.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:"4px"},children:[r.jsx("span",{children:":"}),r.jsxs("span",{style:{fontWeight:"bold"},children:[Math.floor(e.stats.lifespan)," "]})]}),r.jsxs("div",{style:{display:"flex",justifyContent:"space-between"},children:[r.jsx("span",{children:":"}),r.jsxs("span",{style:{fontWeight:"bold",color:(()=>{const X=Br(e);return X<10?"#f44336":X<30?"#ff9800":"#4caf50"})()},children:[Math.floor(Br(e))," "]})]}),Br(e)<10&&r.jsx("div",{style:{marginTop:"8px",padding:"8px",background:"rgba(244, 67, 54, 0.1)",borderRadius:"4px",color:"#f44336",fontSize:"11px"},children:" "})]})]}),e.tierTitle&&r.jsxs("div",{style:we.section,children:[r.jsx("h4",{style:we.secTitle,children:" "}),r.jsxs("div",{style:{fontSize:"12px",marginBottom:"8px"},children:[r.jsx("span",{style:{color:"#666"},children:": "}),r.jsx("span",{style:{fontWeight:"bold",color:"#9c27b0"},children:e.tierTitle||""})]}),e.currentExp!==void 0&&e.maxExp&&r.jsxs("div",{children:[r.jsxs("div",{style:{marginBottom:"4px"},children:[r.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",marginBottom:"4px"},children:[r.jsx("span",{style:{fontSize:"11px",color:"#666"},children:""}),r.jsxs("span",{style:{fontSize:"11px",color:"#666",fontWeight:"bold"},children:[v,"%"]})]}),r.jsx("div",{style:{width:"100%",height:"14px",background:"linear-gradient(to right, #f0f0f0, #e0e0e0)",borderRadius:"7px",overflow:"hidden",position:"relative",boxShadow:"inset 0 2px 4px rgba(0,0,0,0.1)"},children:r.jsx("div",{style:{width:`${v}%`,height:"100%",background:"linear-gradient(90deg, #9c27b0 0%, #d05ce3 100%)",borderRadius:"7px",transition:"width 0.3s ease",boxShadow:"0 0 10px rgba(156, 39, 176, 0.5)",position:"relative",overflow:"hidden"},children:r.jsx("div",{style:{position:"absolute",top:0,left:"-100%",width:"100%",height:"100%",background:"linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent)",animation:"shimmer 2s infinite"}})})})]}),g(x,h,""),e.cultivationSpeed&&r.jsxs("div",{style:{marginTop:"8px",padding:"6px 10px",background:"rgba(156, 39, 176, 0.05)",borderRadius:"6px",border:"1px solid rgba(156, 39, 176, 0.1)"},children:[r.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"4px"},children:[r.jsx("span",{style:{fontSize:"11px",color:"#666"},children:":"}),r.jsxs("span",{style:{fontSize:"11px",fontWeight:"bold",color:"#9c27b0"},children:[Math.floor(e.cultivationSpeed)," /"]})]}),(()=>{const X=Math.max(0,h-x),re=Math.ceil(X/e.cultivationSpeed);return r.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[r.jsx("span",{style:{fontSize:"11px",color:"#666"},children:":"}),r.jsx("span",{style:{fontSize:"11px",fontWeight:"bold",color:re>12?"#ff9800":"#4caf50"},children:re>12?`${Math.floor(re/12)}`:`${re}`})]})})()]})]})]}),r.jsxs("div",{style:we.section,children:[r.jsx("h4",{style:we.secTitle,children:" "}),e.sect?r.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[r.jsxs("div",{children:[r.jsx("div",{style:{fontWeight:"bold",color:"#00695c"},children:e.sect.name}),r.jsx("div",{style:{fontSize:"12px"},children:e.rank})]}),r.jsx("div",{style:{textAlign:"right",fontSize:"12px"},children:r.jsxs("div",{children:[": ",Math.floor(e.age*12)>=192?"":""]})})]}):r.jsxs("div",{children:[r.jsx("p",{style:{color:"#666",fontSize:"12px",marginBottom:"8px"},children:" / "}),Math.floor(e.age*12)>=144&&e.isTested&&r.jsxs("div",{style:{display:"flex",gap:"8px",alignItems:"center"},children:[r.jsx("button",{style:we.smallBtn,onClick:()=>n("SELECT_SECT"),children:" "}),r.jsxs("label",{style:{display:"flex",alignItems:"center",gap:8,fontSize:12,color:"#555"},children:[r.jsx("input",{type:"checkbox",checked:!!e.autoJoinBestSect,onChange:X=>n("TOGGLE_AUTO_JOIN_SECT",X.target.checked)}),""]})]})]})]}),r.jsxs("div",{style:{...we.actionArea,gridTemplateColumns:"1fr 1fr 1fr"},children:[r.jsxs("button",{onClick:()=>n("CHAT"),style:{...we.actionBtn,background:"#7e57c2"},children:[" ",r.jsx("br",{}),r.jsx("small",{style:{fontSize:"10px",opacity:.8},children:""})]}),r.jsxs("button",{onClick:()=>{window.showConfirm&&window.showConfirm(` ${e.name} `,()=>n("EXPEL"))},style:{...we.actionBtn,background:"#d32f2f"},children:[" ",r.jsx("br",{}),r.jsx("small",{style:{fontSize:"10px",opacity:.9},children:""})]})]})]})})]})]})})},we={overlay:{position:"fixed",top:0,left:0,right:0,bottom:0,background:"rgba(0,0,0,0.6)",display:"flex",justifyContent:"center",alignItems:"center",zIndex:1e3},modalWrapper:{position:"relative",width:"min(600px, calc(100vw - 32px))"},modal:{width:"100%",height:"600px",background:"#fff",borderRadius:"12px",overflow:"hidden",position:"relative",boxShadow:"0 10px 25px rgba(0,0,0,0.2)",display:"flex",flexDirection:"column"},closeBtn:{position:"absolute",top:"-18px",left:"-18px",border:"none",background:"#ffffff",fontSize:"22px",cursor:"pointer",color:"#888",width:"44px",height:"44px",display:"flex",alignItems:"center",justifyContent:"center",borderRadius:"22px",boxShadow:"0 12px 30px rgba(0,0,0,0.25)"},content:{flex:1,height:"100%",overflow:"hidden"},navBar:{flex:"0 0 auto",padding:"12px 20px",borderBottom:"1px solid #f0f0f0",background:"#fafafa",display:"flex",alignItems:"center",justifyContent:"space-between"},navBtn:{border:"none",background:"transparent",cursor:"pointer",color:"#333",fontSize:"13px",display:"flex",alignItems:"center",gap:"6px",padding:"6px 10px",borderRadius:"6px"},navBtnDisabled:{color:"#bbb",cursor:"not-allowed"},navLabel:{fontSize:"12px",color:"#666",fontWeight:"bold"},singleCol:{width:"100%",padding:"25px 25px 90px 25px",overflowY:"auto",height:"100%",boxSizing:"border-box"},nameBox:{textAlign:"left"},editIcon:{fontSize:"12px",cursor:"pointer",marginLeft:"5px",opacity:.5},input:{width:"120px",padding:"5px",borderRadius:"4px",border:"1px solid #ccc"},smallBtn:{padding:"5px 10px",cursor:"pointer",borderRadius:"4px",border:"1px solid #ccc",backgroundColor:"#f5f5f5"},tierBadge:{fontSize:"12px",background:"#3e2723",color:"#fff",padding:"2px 8px",borderRadius:"10px",marginTop:"5px",display:"inline-block"},traitBox:{padding:"10px",background:"#fff",border:"1px solid",borderRadius:"8px",textAlign:"center",display:"inline-block"},influencePanel:{marginTop:"10px",padding:"12px",borderRadius:"10px",background:"linear-gradient(135deg, rgba(255,255,255,0.8), rgba(240,240,240,0.9))",border:"1px solid #e0e0e0"},influenceHeader:{fontWeight:"bold",fontSize:"16px",display:"flex",justifyContent:"space-between",alignItems:"center"},influenceScore:{fontSize:"18px"},influenceTagline:{fontSize:"11px",margin:"4px 0",color:"#666"},influenceProgress:{height:"8px",borderRadius:"999px",background:"#e0e0e0",overflow:"hidden"},influenceProgressFill:{height:"100%"},influenceFooter:{marginTop:"4px",fontSize:"11px",color:"#888"},spouseCard:{background:"#fff8e1",padding:"15px",borderRadius:"8px",border:"1px solid #ffecb3",boxShadow:"0 2px 4px rgba(0,0,0,0.05)"},miniAvatar:{fontSize:"24px",width:"40px",height:"40px",borderRadius:"50%",background:"#fff",display:"flex",alignItems:"center",justifyContent:"center",boxShadow:"0 1px 3px rgba(0,0,0,0.1)"},marryBtn:{marginTop:"10px",padding:"5px 15px",fontSize:"12px",cursor:"pointer",borderRadius:"15px",border:"1px solid #e91e63",backgroundColor:"#fff",color:"#e91e63",transition:"all 0.2s",":hover":{backgroundColor:"#fce4ec",transform:"translateY(-1px)"}},section:{marginBottom:"25px"},secTitle:{margin:"0 0 15px 0",fontSize:"14px",color:"#333",borderBottom:"1px dashed #ccc",paddingBottom:"8px"},elBadge:{padding:"2px 6px",borderRadius:"4px",color:"#fff",fontSize:"10px",fontWeight:"bold"},barContainer:{display:"flex",alignItems:"center",gap:"10px",fontSize:"12px",marginBottom:"10px"},barBg:{flex:1,height:"8px",background:"#eee",borderRadius:"4px"},barFill:{height:"100%",borderRadius:"4px"},combatGrid:{display:"grid",gridTemplateColumns:"1fr 1fr 1fr",gap:"10px",textAlign:"center"},statItem:{background:"#fafafa",padding:"10px",borderRadius:"8px",display:"flex",flexDirection:"column",gap:"5px"},actionArea:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"10px",marginTop:"20px"},actionBtn:{padding:"12px",border:"none",borderRadius:"8px",background:"#ff9800",color:"white",cursor:"pointer",textAlign:"center",fontSize:"14px",transition:"all 0.2s",":hover":{transform:"translateY(-1px)",boxShadow:"0 4px 8px rgba(0,0,0,0.15)"}},traitGrid:{display:"flex",flexDirection:"column",gap:"15px"},traitRow:{display:"flex",alignItems:"center",gap:"10px"},label:{width:"60px",fontSize:"13px",color:"#555",fontWeight:"bold"},equipGrid:{display:"grid",gridTemplateColumns:"1fr 1fr 1fr",gap:"10px"},equipSlot:{border:"1px dashed #ccc",borderRadius:"8px",padding:"10px",background:"#fafafa",textAlign:"center"},fractionWrapper:{display:"flex",flexDirection:"column",alignItems:"flex-end",marginTop:"6px",color:"#4a148c"},fractionCaption:{fontSize:"11px",color:"#777",marginBottom:"2px"},fractionBox:{display:"flex",flexDirection:"column",alignItems:"center",minWidth:"60px",lineHeight:1.2},fractionNumerator:{fontWeight:"bold",fontSize:"15px"},fractionDivider:{width:"100%",borderBottom:"1px solid rgba(0,0,0,0.2)",margin:"2px 0"},fractionDenominator:{fontWeight:"bold",fontSize:"13px"}},p5=({child:e,candidates:t,onSelect:n,onClose:s})=>{if(!t||t.length===0)return null;const o=a=>{switch(a){case"talented":return" ";case"beautiful":return" ";case"wise":return" ";case"buddha":return" ";default:return" "}},i=a=>{switch(a){case"talented":return"";case"beautiful":return"";case"wise":return"";case"buddha":return"";default:return""}};return r.jsx("div",{style:Xe.overlay,children:r.jsxs("div",{style:Xe.modalWrapper,children:[r.jsx("button",{style:Xe.closeBtn,onClick:s,"aria-label":"",children:""}),r.jsxs("div",{style:Xe.modal,children:[r.jsx("div",{style:Xe.header,children:r.jsxs("h2",{style:Xe.title,children:["  ",e.name," "]})}),r.jsxs("div",{style:Xe.subtitle,children:[" ",e.name," "]}),r.jsx("div",{style:Xe.candidatesContainer,children:t.map((a,l)=>{var d,u,p;return r.jsxs("div",{style:Xe.candidateCard,children:[r.jsx("div",{style:Xe.cardHeader,children:r.jsx("div",{style:Xe.archetypeBadge,children:o(a.archetype)})}),r.jsxs("div",{style:Xe.avatarSection,children:[r.jsx(Hr,{avatar:a.avatar,gender:a.gender,size:80}),r.jsxs("div",{style:Xe.nameSection,children:[r.jsx("div",{style:Xe.candidateName,children:a.name}),r.jsx("div",{style:Xe.candidateGender,children:a.gender===""?" ":" "}),a.identity&&r.jsx("div",{style:Xe.identity,children:a.identity})]})]}),r.jsx("div",{style:Xe.archetypeDesc,children:i(a.archetype)}),r.jsxs("div",{style:Xe.statsSection,children:[r.jsxs("div",{style:Xe.statRow,children:[r.jsx("span",{style:Xe.statLabel,children:""}),r.jsx("span",{style:{...Xe.statValue,color:a.stats.aptitude>=80?"#ff4081":a.stats.aptitude>=60?"#9c27b0":"#666"},children:a.stats.aptitude})]}),r.jsxs("div",{style:Xe.statRow,children:[r.jsx("span",{style:Xe.statLabel,children:""}),r.jsx("span",{style:{...Xe.statValue,color:a.stats.looks>=80?"#ff4081":a.stats.looks>=60?"#9c27b0":"#666"},children:a.stats.looks})]}),r.jsxs("div",{style:Xe.statRow,children:[r.jsx("span",{style:Xe.statLabel,children:""}),r.jsx("span",{style:{...Xe.statValue,color:a.stats.intelligence>=80?"#ff4081":a.stats.intelligence>=60?"#9c27b0":"#666"},children:a.stats.intelligence})]})]}),r.jsxs("div",{style:Xe.spiritRootSection,children:[r.jsx("div",{style:Xe.spiritRootLabel,children:""}),r.jsxs("div",{style:Xe.spiritRootValue,children:[(d=a.spiritRoot)==null?void 0:d.type,((p=(u=a.spiritRoot)==null?void 0:u.elements)==null?void 0:p.length)>0&&` (${a.spiritRoot.elements.join("")})`]})]}),r.jsxs("div",{style:Xe.cultivationSection,children:[r.jsx("div",{style:Xe.tierLabel,children:a.tierTitle}),r.jsxs("div",{style:Xe.cultivationValue,children:[": ",a.cultivation]})]}),r.jsxs("button",{style:Xe.selectBtn,onClick:()=>n(a),onMouseEnter:c=>c.target.style.background="#d81b60",onMouseLeave:c=>c.target.style.background="#e91e63",children:[" ",a.name]})]},a.id)})}),r.jsxs("div",{style:Xe.footer,children:[r.jsx("div",{style:Xe.costInfo,children:" 500 "}),r.jsx("button",{style:Xe.cancelBtn,onClick:s,children:""})]})]})]})})},Xe={overlay:{position:"fixed",top:0,left:0,right:0,bottom:0,background:"rgba(0, 0, 0, 0.7)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:2e3,padding:"20px"},modalWrapper:{position:"relative",width:"min(1100px, calc(100vw - 40px))"},modal:{background:"linear-gradient(135deg, #fff8e1 0%, #ffe0b2 100%)",borderRadius:"16px",maxWidth:"1100px",width:"100%",maxHeight:"90vh",overflow:"auto",boxShadow:"0 8px 32px rgba(0,0,0,0.3)",border:"2px solid #ffb74d",position:"relative"},header:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"20px 24px",borderBottom:"2px solid #ffb74d",background:"linear-gradient(90deg, #ffe0b2, #ffcc80)"},title:{margin:0,fontSize:"24px",color:"#d84315",fontWeight:"bold"},closeBtn:{position:"absolute",top:"-18px",left:"-18px",background:"#fff",border:"2px solid rgba(0,0,0,0.08)",fontSize:"20px",cursor:"pointer",color:"#bf360c",width:"44px",height:"44px",display:"flex",alignItems:"center",justifyContent:"center",borderRadius:"50%",boxShadow:"0 10px 24px rgba(0,0,0,0.2)",zIndex:5},subtitle:{padding:"16px 24px",fontSize:"16px",color:"#5d4037",textAlign:"center",background:"#fff3e0"},candidatesContainer:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(300px, 1fr))",gap:"20px",padding:"24px"},candidateCard:{background:"white",borderRadius:"12px",padding:"20px",border:"2px solid #ffb74d",boxShadow:"0 4px 12px rgba(0,0,0,0.1)",display:"flex",flexDirection:"column",transition:"transform 0.2s, box-shadow 0.2s",cursor:"pointer"},cardHeader:{marginBottom:"12px",display:"flex",justifyContent:"center"},archetypeBadge:{background:"linear-gradient(135deg, #e91e63, #f06292)",color:"white",padding:"6px 16px",borderRadius:"20px",fontSize:"14px",fontWeight:"bold",textAlign:"center"},avatarSection:{display:"flex",alignItems:"center",gap:"16px",marginBottom:"12px",paddingBottom:"12px",borderBottom:"1px solid #ffe0b2"},nameSection:{flex:1},candidateName:{fontSize:"20px",fontWeight:"bold",color:"#d84315",marginBottom:"4px"},candidateGender:{fontSize:"14px",color:"#666",marginBottom:"4px"},identity:{fontSize:"12px",color:"#ff6f00",fontWeight:"bold",background:"#fff3e0",padding:"2px 8px",borderRadius:"4px",display:"inline-block"},archetypeDesc:{fontSize:"13px",color:"#795548",fontStyle:"italic",marginBottom:"16px",textAlign:"center",padding:"8px",background:"#fff8e1",borderRadius:"6px"},statsSection:{display:"flex",flexDirection:"column",gap:"8px",marginBottom:"12px",padding:"12px",background:"#fafafa",borderRadius:"8px"},statRow:{display:"flex",justifyContent:"space-between",alignItems:"center"},statLabel:{fontSize:"14px",color:"#666",fontWeight:"500"},statValue:{fontSize:"16px",fontWeight:"bold"},spiritRootSection:{marginBottom:"12px",padding:"10px",background:"#e3f2fd",borderRadius:"6px",border:"1px solid #90caf9"},spiritRootLabel:{fontSize:"12px",color:"#1565c0",marginBottom:"4px"},spiritRootValue:{fontSize:"14px",color:"#0d47a1",fontWeight:"bold"},cultivationSection:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"16px",padding:"10px",background:"#f3e5f5",borderRadius:"6px"},tierLabel:{fontSize:"14px",color:"#6a1b9a",fontWeight:"bold"},cultivationValue:{fontSize:"13px",color:"#4a148c"},selectBtn:{background:"#e91e63",color:"white",border:"none",padding:"12px",borderRadius:"8px",fontSize:"16px",fontWeight:"bold",cursor:"pointer",transition:"background 0.2s",boxShadow:"0 2px 8px rgba(233, 30, 99, 0.3)"},footer:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"16px 24px",borderTop:"2px solid #ffb74d",background:"#fff3e0"},costInfo:{fontSize:"16px",color:"#d84315",fontWeight:"bold"},cancelBtn:{background:"#9e9e9e",color:"white",border:"none",padding:"10px 24px",borderRadius:"6px",fontSize:"14px",cursor:"pointer",transition:"background 0.2s"}},f5=({giftEvents:e,onConfirm:t,onClose:n})=>{const[s,o]=y.useState(new Set),i=p=>{const c=new Set(s);c.has(p)?c.delete(p):c.add(p),o(c)},a=()=>{s.size===e.length?o(new Set):o(new Set(e.map(p=>p.npcId)))},l=()=>{const p=e.filter(c=>s.has(c.npcId));t(p)},d=p=>Fo(p)||{name:"",rarity:"common"},u={common:"#9e9e9e",uncommon:"#4caf50",rare:"#2196f3",epic:"#9c27b0",legendary:"#ff9800"};return r.jsx("div",{style:St.overlay,children:r.jsxs("div",{style:St.modal,children:[r.jsxs("div",{style:St.header,children:[r.jsxs("h3",{style:St.title,children:[" ",e.length,""]}),r.jsx("button",{onClick:n,style:St.closeIcon,children:""})]}),r.jsx("div",{style:St.subtitle,children:""}),r.jsxs("div",{style:St.toolbar,children:[r.jsx("button",{onClick:a,style:St.selectAllBtn,children:s.size===e.length?" ":""}),r.jsxs("div",{style:St.selectionInfo,children:[" ",s.size," / ",e.length]})]}),r.jsx("div",{style:St.giftList,children:e.map((p,c)=>{const f=d(p.giftItemId),b=s.has(p.npcId);return r.jsxs("div",{style:{...St.giftCard,borderColor:b?"#4caf50":"#e0e0e0",background:b?"#f1f8f4":"#fff"},onClick:()=>i(p.npcId),children:[r.jsx("div",{style:St.checkbox,children:r.jsx("input",{type:"checkbox",checked:b,onChange:()=>i(p.npcId),style:St.checkboxInput})}),r.jsxs("div",{style:St.cardContent,children:[r.jsxs("div",{style:St.giftHeader,children:[r.jsx("span",{style:St.npcName,children:p.npcName}),r.jsx("span",{style:{...St.itemName,color:u[f.rarity]||"#666"},children:f.name})]}),r.jsx("div",{style:St.message,children:p.message}),f.desc&&r.jsxs("div",{style:St.itemDesc,children:[" ",f.desc]}),f.stats&&r.jsxs("div",{style:St.itemStats,children:[f.stats.atk&&r.jsxs("span",{children:["+",f.stats.atk]}),f.stats.hp&&r.jsxs("span",{children:["+",f.stats.hp]}),f.stats.def&&r.jsxs("span",{children:["+",f.stats.def]})]}),f.effect&&r.jsxs("div",{style:St.itemEffect,children:[" ",typeof f.effect=="object"?`${f.effect.kind==="heal"?"":f.effect.kind==="exp"?"":f.effect.kind==="aptitude"?"":""} +${f.effect.amount}`:f.effect]})]})]},p.npcId||c)})}),r.jsxs("div",{style:St.footer,children:[r.jsxs("button",{style:St.confirmBtn,onClick:l,disabled:s.size===0,children:[" (",s.size,")"]}),r.jsx("button",{style:St.cancelBtn,onClick:n,children:""})]})]})})},St={overlay:{position:"fixed",top:0,left:0,right:0,bottom:0,background:"rgba(0, 0, 0, 0.75)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:3e3,padding:"20px"},modal:{background:"linear-gradient(135deg, #fff 0%, #f5f5f5 100%)",borderRadius:"16px",width:"90%",maxWidth:"800px",maxHeight:"85vh",display:"flex",flexDirection:"column",boxShadow:"0 10px 40px rgba(0,0,0,0.3)",overflow:"hidden"},header:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"20px 24px",borderBottom:"2px solid #e91e63",background:"linear-gradient(90deg, #fce4ec, #f8bbd0)",flexShrink:0},title:{margin:0,fontSize:"22px",color:"#c2185b",fontWeight:"bold"},closeIcon:{background:"none",border:"none",fontSize:"28px",cursor:"pointer",color:"#c2185b",padding:"0",lineHeight:"1"},subtitle:{padding:"16px 24px",fontSize:"14px",color:"#666",borderBottom:"1px solid #e0e0e0",flexShrink:0},toolbar:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"12px 24px",background:"#fafafa",borderBottom:"1px solid #e0e0e0",flexShrink:0},selectAllBtn:{padding:"6px 16px",background:"#e0e0e0",border:"none",borderRadius:"6px",cursor:"pointer",fontSize:"13px",transition:"all 0.2s"},selectionInfo:{fontSize:"13px",color:"#666"},giftList:{flex:1,overflowY:"auto",padding:"16px 24px",display:"flex",flexDirection:"column",gap:"12px"},giftCard:{display:"flex",gap:"12px",padding:"16px",border:"2px solid #e0e0e0",borderRadius:"12px",cursor:"pointer",transition:"all 0.2s",background:"#fff"},checkbox:{flexShrink:0,display:"flex",alignItems:"flex-start",paddingTop:"2px"},checkboxInput:{width:"18px",height:"18px",cursor:"pointer"},cardContent:{flex:1,display:"flex",flexDirection:"column",gap:"8px"},giftHeader:{display:"flex",justifyContent:"space-between",alignItems:"center",gap:"12px"},npcName:{fontSize:"16px",fontWeight:"bold",color:"#e91e63"},itemName:{fontSize:"15px",fontWeight:"600"},message:{fontSize:"14px",color:"#444",lineHeight:"1.5",background:"#fff8e1",padding:"8px 12px",borderRadius:"8px",border:"1px solid #fff176"},itemDesc:{fontSize:"12px",color:"#666",fontStyle:"italic"},itemStats:{display:"flex",gap:"12px",fontSize:"12px",color:"#2196f3",fontWeight:"500"},itemEffect:{fontSize:"12px",color:"#4caf50",fontStyle:"italic"},footer:{display:"flex",gap:"12px",padding:"16px 24px",borderTop:"2px solid #e0e0e0",background:"#fafafa",flexShrink:0},confirmBtn:{flex:1,padding:"12px",background:"#4caf50",color:"#fff",border:"none",borderRadius:"8px",cursor:"pointer",fontSize:"15px",fontWeight:"bold",transition:"all 0.2s"},cancelBtn:{padding:"12px 24px",background:"#e0e0e0",border:"none",borderRadius:"8px",cursor:"pointer",fontSize:"15px"}},m5=({promotionEvents:e,onConfirm:t,onClose:n})=>{const[s,o]=y.useState(new Set(e.map(c=>c.child.id))),i=c=>{const f=new Set(s);f.has(c)?f.delete(c):f.add(c),o(f)},a=()=>{s.size===e.length?o(new Set):o(new Set(e.map(c=>c.child.id)))},l=()=>{const c=e.filter(f=>s.has(f.child.id));t(c)},d=c=>Fo(c)||{name:"",rarity:"common"},u={common:"#9e9e9e",uncommon:"#4caf50",rare:"#2196f3",epic:"#9c27b0",legendary:"#ff9800"},p={:"#9e9e9e",:"#4caf50",:"#2196f3",:"#9c27b0",:"#ff9800"};return r.jsx("div",{style:qe.overlay,children:r.jsxs("div",{style:qe.modal,children:[r.jsxs("div",{style:qe.header,children:[r.jsx("h3",{style:qe.title,children:" "}),r.jsx("button",{onClick:n,style:qe.closeIcon,children:""})]}),r.jsxs("div",{style:qe.subtitle,children:["",e.length," "]}),r.jsxs("div",{style:qe.toolbar,children:[r.jsx("button",{onClick:a,style:qe.selectAllBtn,children:s.size===e.length?" ":""}),r.jsxs("div",{style:qe.selectionInfo,children:[" ",s.size," / ",e.length]})]}),r.jsx("div",{style:qe.eventList,children:e.map(c=>{var E;const f=c.child,b=d(c.giftItemId),S=s.has(f.id);return r.jsxs("div",{style:{...qe.eventCard,borderColor:S?"#4caf50":"#e0e0e0",background:S?"#f1f8f4":"#fff"},onClick:()=>i(f.id),children:[r.jsx("div",{style:qe.checkbox,children:r.jsx("input",{type:"checkbox",checked:S,onChange:()=>i(f.id),style:qe.checkboxInput})}),r.jsxs("div",{style:qe.cardContent,children:[r.jsxs("div",{style:qe.promotionHeader,children:[r.jsxs("div",{style:qe.childInfo,children:[r.jsx("span",{style:qe.childName,children:f.name}),r.jsx("span",{style:qe.childGender,children:f.gender===""?"":""})]}),r.jsxs("div",{style:qe.promotionBadge,children:[r.jsx("span",{style:qe.promotionLabel,children:""}),r.jsx("span",{style:{...qe.rankBadge,background:p[c.rank]||"#666"},children:c.rank})]})]}),r.jsxs("div",{style:qe.sectInfo,children:[r.jsx("span",{style:qe.sectIcon,children:""}),r.jsx("span",{style:qe.sectName,children:((E=c.sect)==null?void 0:E.name)||""})]}),r.jsxs("div",{style:qe.giftSection,children:[r.jsxs("div",{style:qe.giftHeader,children:[r.jsx("span",{style:qe.giftLabel,children:""}),r.jsx("span",{style:{...qe.giftName,color:u[b.rarity]||"#666"},children:b.name})]}),b.desc&&r.jsx("div",{style:qe.giftDesc,children:b.desc}),b.stats&&r.jsxs("div",{style:qe.giftStats,children:[b.stats.atk&&r.jsxs("span",{style:qe.statBadge,children:[" +",b.stats.atk]}),b.stats.hp&&r.jsxs("span",{style:qe.statBadge,children:[" +",b.stats.hp]}),b.stats.def&&r.jsxs("span",{style:qe.statBadge,children:[" +",b.stats.def]})]}),b.effect&&r.jsxs("div",{style:qe.giftEffect,children:[" ",typeof b.effect=="object"?`${b.effect.kind==="heal"?"":b.effect.kind==="exp"?"":b.effect.kind==="aptitude"?"":""} +${b.effect.amount}`:b.effect]})]}),r.jsx("div",{style:qe.message,children:typeof c.message=="string"?c.message:JSON.stringify(c.message)})]})]},f.id)})}),r.jsxs("div",{style:qe.footer,children:[r.jsxs("button",{style:qe.confirmBtn,onClick:l,disabled:s.size===0,children:[" (",s.size,")"]}),r.jsx("button",{style:qe.cancelBtn,onClick:n,children:""})]})]})})},qe={overlay:{position:"fixed",top:0,left:0,right:0,bottom:0,background:"rgba(0, 0, 0, 0.75)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:3e3,padding:"20px"},modal:{background:"linear-gradient(135deg, #fff9c4 0%, #fff59d 100%)",borderRadius:"16px",width:"90%",maxWidth:"850px",maxHeight:"85vh",display:"flex",flexDirection:"column",boxShadow:"0 10px 40px rgba(0,0,0,0.3)",overflow:"hidden",border:"2px solid #fdd835"},header:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"20px 24px",borderBottom:"2px solid #fdd835",background:"linear-gradient(90deg, #fff9c4, #fff176)",flexShrink:0},title:{margin:0,fontSize:"22px",color:"#f57f17",fontWeight:"bold"},closeIcon:{background:"none",border:"none",fontSize:"28px",cursor:"pointer",color:"#f57f17",padding:"0",lineHeight:"1"},subtitle:{padding:"16px 24px",fontSize:"14px",color:"#666",borderBottom:"1px solid #fdd835",flexShrink:0},toolbar:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"12px 24px",background:"#fffde7",borderBottom:"1px solid #e0e0e0",flexShrink:0},selectAllBtn:{padding:"6px 16px",background:"#fdd835",color:"#333",border:"none",borderRadius:"6px",cursor:"pointer",fontSize:"13px",fontWeight:"500"},selectionInfo:{fontSize:"13px",color:"#666"},eventList:{flex:1,overflowY:"auto",padding:"16px 24px",display:"flex",flexDirection:"column",gap:"16px"},eventCard:{display:"flex",gap:"12px",padding:"16px",border:"2px solid #e0e0e0",borderRadius:"12px",cursor:"pointer",transition:"all 0.2s",background:"#fff"},checkbox:{flexShrink:0,display:"flex",alignItems:"flex-start",paddingTop:"4px"},checkboxInput:{width:"18px",height:"18px",cursor:"pointer"},cardContent:{flex:1,display:"flex",flexDirection:"column",gap:"12px"},promotionHeader:{display:"flex",justifyContent:"space-between",alignItems:"center",paddingBottom:"12px",borderBottom:"1px dashed #e0e0e0"},childInfo:{display:"flex",alignItems:"center",gap:"8px"},childName:{fontSize:"18px",fontWeight:"bold",color:"#333"},childGender:{fontSize:"14px",color:"#999"},promotionBadge:{display:"flex",alignItems:"center",gap:"8px"},promotionLabel:{fontSize:"12px",color:"#666"},rankBadge:{padding:"4px 12px",borderRadius:"12px",color:"#fff",fontSize:"13px",fontWeight:"bold"},sectInfo:{display:"flex",alignItems:"center",gap:"8px",padding:"8px 12px",background:"#e3f2fd",borderRadius:"8px"},sectIcon:{fontSize:"16px"},sectName:{fontSize:"14px",color:"#1976d2",fontWeight:"600"},giftSection:{display:"flex",flexDirection:"column",gap:"8px",padding:"12px",background:"#f3e5f5",borderRadius:"8px",border:"1px solid #ce93d8"},giftHeader:{display:"flex",alignItems:"center",gap:"8px"},giftLabel:{fontSize:"13px",color:"#666",fontWeight:"500"},giftName:{fontSize:"15px",fontWeight:"bold"},giftDesc:{fontSize:"12px",color:"#666",fontStyle:"italic"},giftStats:{display:"flex",gap:"8px",flexWrap:"wrap"},statBadge:{padding:"3px 8px",background:"#fff",borderRadius:"8px",fontSize:"11px",color:"#666",fontWeight:"500",border:"1px solid #e0e0e0"},giftEffect:{fontSize:"12px",color:"#4caf50",fontWeight:"500"},message:{fontSize:"13px",color:"#555",lineHeight:"1.5",padding:"8px 12px",background:"#fff8e1",borderRadius:"8px",border:"1px solid #fff176"},footer:{display:"flex",gap:"12px",padding:"16px 24px",borderTop:"2px solid #fdd835",background:"#fffde7",flexShrink:0},confirmBtn:{flex:1,padding:"12px",background:"#4caf50",color:"#fff",border:"none",borderRadius:"8px",cursor:"pointer",fontSize:"15px",fontWeight:"bold",transition:"all 0.2s"},cancelBtn:{padding:"12px 24px",background:"#e0e0e0",border:"none",borderRadius:"8px",cursor:"pointer",fontSize:"15px"}},h5=({marriagePlans:e,onConfirm:t,onClose:n,onModify:s})=>{const[o,i]=y.useState(new Set(e.map(c=>c.childId))),a=c=>{const f=new Set(o);f.has(c)?f.delete(c):f.add(c),i(f)},l=()=>{o.size===e.length?i(new Set):i(new Set(e.map(c=>c.childId)))},d=()=>{const c=e.filter(f=>o.has(f.childId));t(c)},u=o.size*500,p=c=>{switch(c){case"talented":return" ";case"beautiful":return" ";case"wise":return" ";case"buddha":return" ";default:return" "}};return r.jsx("div",{style:Be.overlay,children:r.jsxs("div",{style:Be.modal,children:[r.jsxs("div",{style:Be.header,children:[r.jsx("h3",{style:Be.title,children:" "}),r.jsx("button",{onClick:n,style:Be.closeIcon,children:""})]}),r.jsxs("div",{style:Be.summary,children:[r.jsxs("div",{style:Be.summaryItem,children:[r.jsx("span",{style:Be.summaryLabel,children:""}),r.jsxs("span",{style:Be.summaryValue,children:[e.length," "]})]}),r.jsxs("div",{style:Be.summaryItem,children:[r.jsx("span",{style:Be.summaryLabel,children:""}),r.jsxs("span",{style:{...Be.summaryValue,color:"#4caf50"},children:[o.size," "]})]}),r.jsxs("div",{style:Be.summaryItem,children:[r.jsx("span",{style:Be.summaryLabel,children:""}),r.jsxs("span",{style:{...Be.summaryValue,color:"#ff9800"},children:[u," "]})]})]}),r.jsxs("div",{style:Be.toolbar,children:[r.jsx("button",{onClick:l,style:Be.selectAllBtn,children:o.size===e.length?" ":""}),r.jsx("div",{style:Be.hint,children:""})]}),r.jsx("div",{style:Be.planList,children:e.map(c=>{var E,j,x,h,v,g,I,_,C,k,R,T;const f=o.has(c.childId),b=c.childRef,S=c.spouse;return r.jsxs("div",{style:{...Be.planCard,borderColor:f?"#4caf50":"#e0e0e0",background:f?"#f1f8f4":"#fff",opacity:f?1:.6},onClick:()=>a(c.childId),children:[r.jsx("div",{style:Be.checkbox,children:r.jsx("input",{type:"checkbox",checked:f,onChange:()=>a(c.childId),style:Be.checkboxInput})}),r.jsxs("div",{style:Be.cardContent,children:[r.jsxs("div",{style:Be.personSection,children:[r.jsx("div",{style:Be.avatarWrapper,children:r.jsx(Hr,{avatar:b.avatar,gender:b.gender,size:60})}),r.jsxs("div",{style:Be.personInfo,children:[r.jsx("div",{style:Be.personName,children:b.name}),r.jsxs("div",{style:Be.personDetail,children:[b.gender===""?"":""," | ",b.tierTitle||""]}),r.jsxs("div",{style:Be.stats,children:[r.jsxs("span",{style:Be.statItem,children:[" ",((E=b.stats)==null?void 0:E.aptitude)||0]}),r.jsxs("span",{style:Be.statItem,children:[" ",((j=b.stats)==null?void 0:j.looks)||0]}),r.jsxs("span",{style:Be.statItem,children:[" ",((x=b.stats)==null?void 0:x.intelligence)||0]})]})]})]}),r.jsxs("div",{style:Be.arrow,children:[r.jsx("div",{style:Be.arrowIcon,children:""}),r.jsx("div",{style:Be.arrowLine})]}),r.jsxs("div",{style:Be.personSection,children:[r.jsx("div",{style:Be.avatarWrapper,children:r.jsx(Hr,{avatar:S.avatar,gender:S.gender,size:60})}),r.jsxs("div",{style:Be.personInfo,children:[r.jsxs("div",{style:Be.personName,children:[S.name,r.jsx("span",{style:Be.archetypeBadge,children:p(S.archetype)})]}),r.jsxs("div",{style:Be.personDetail,children:[S.gender===""?"":""," | ",S.tierTitle||""]}),r.jsxs("div",{style:Be.stats,children:[r.jsxs("span",{style:{...Be.statItem,color:((h=S.stats)==null?void 0:h.aptitude)>=80?"#e91e63":"#666"},children:[" ",((v=S.stats)==null?void 0:v.aptitude)||0]}),r.jsxs("span",{style:{...Be.statItem,color:((g=S.stats)==null?void 0:g.looks)>=80?"#e91e63":"#666"},children:[" ",((I=S.stats)==null?void 0:I.looks)||0]}),r.jsxs("span",{style:{...Be.statItem,color:((_=S.stats)==null?void 0:_.intelligence)>=80?"#e91e63":"#666"},children:[" ",((C=S.stats)==null?void 0:C.intelligence)||0]})]})]})]}),r.jsx("div",{style:Be.spiritRootSection,children:r.jsxs("div",{style:Be.spiritRoot,children:["",((k=S.spiritRoot)==null?void 0:k.type)||"",((T=(R=S.spiritRoot)==null?void 0:R.elements)==null?void 0:T.length)>0&&` (${S.spiritRoot.elements.join("")})`]})})]})]},c.childId)})}),r.jsxs("div",{style:Be.footer,children:[r.jsxs("button",{style:Be.confirmBtn,onClick:d,disabled:o.size===0,children:[" (",o.size,"   ",u," )"]}),r.jsx("button",{style:Be.cancelBtn,onClick:n,children:""})]})]})})},Be={overlay:{position:"fixed",top:0,left:0,right:0,bottom:0,background:"rgba(0, 0, 0, 0.75)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:3e3,padding:"20px"},modal:{background:"linear-gradient(135deg, #fff8e1 0%, #ffe0b2 100%)",borderRadius:"16px",width:"90%",maxWidth:"1000px",maxHeight:"85vh",display:"flex",flexDirection:"column",boxShadow:"0 10px 40px rgba(0,0,0,0.3)",overflow:"hidden",border:"2px solid #ffb74d"},header:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"20px 24px",borderBottom:"2px solid #ffb74d",background:"linear-gradient(90deg, #ffe0b2, #ffcc80)",flexShrink:0},title:{margin:0,fontSize:"22px",color:"#d84315",fontWeight:"bold"},closeIcon:{background:"none",border:"none",fontSize:"28px",cursor:"pointer",color:"#d84315",padding:"0",lineHeight:"1"},summary:{display:"flex",justifyContent:"space-around",padding:"16px 24px",background:"#fff8e1",borderBottom:"1px solid #ffb74d",flexShrink:0},summaryItem:{display:"flex",flexDirection:"column",alignItems:"center",gap:"4px"},summaryLabel:{fontSize:"12px",color:"#666"},summaryValue:{fontSize:"16px",fontWeight:"bold",color:"#d84315"},toolbar:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"12px 24px",background:"#fafafa",borderBottom:"1px solid #e0e0e0",flexShrink:0},selectAllBtn:{padding:"6px 16px",background:"#ff9800",color:"#fff",border:"none",borderRadius:"6px",cursor:"pointer",fontSize:"13px",fontWeight:"500"},hint:{fontSize:"12px",color:"#999",fontStyle:"italic"},planList:{flex:1,overflowY:"auto",padding:"16px 24px",display:"flex",flexDirection:"column",gap:"16px"},planCard:{display:"flex",gap:"12px",padding:"16px",border:"2px solid #e0e0e0",borderRadius:"16px",cursor:"pointer",transition:"all 0.2s",background:"#fff"},checkbox:{flexShrink:0,display:"flex",alignItems:"center"},checkboxInput:{width:"20px",height:"20px",cursor:"pointer"},cardContent:{flex:1,display:"flex",alignItems:"center",gap:"20px"},personSection:{flex:1,display:"flex",gap:"12px",alignItems:"center"},avatarWrapper:{flexShrink:0},personInfo:{flex:1,display:"flex",flexDirection:"column",gap:"6px"},personName:{fontSize:"16px",fontWeight:"bold",color:"#333",display:"flex",alignItems:"center",gap:"8px"},archetypeBadge:{fontSize:"11px",padding:"2px 8px",background:"#e91e63",color:"#fff",borderRadius:"10px",fontWeight:"500"},personDetail:{fontSize:"13px",color:"#666"},stats:{display:"flex",gap:"12px",fontSize:"12px"},statItem:{color:"#666"},arrow:{display:"flex",flexDirection:"column",alignItems:"center",gap:"4px",flexShrink:0},arrowIcon:{fontSize:"20px"},arrowLine:{width:"2px",height:"40px",background:"linear-gradient(to bottom, #e91e63, #f06292)",borderRadius:"1px"},spiritRootSection:{width:"100%",padding:"8px 12px",background:"#fff3e0",borderRadius:"8px",fontSize:"12px",color:"#e65100",marginTop:"8px"},spiritRoot:{fontWeight:"500"},footer:{display:"flex",gap:"12px",padding:"16px 24px",borderTop:"2px solid #ffb74d",background:"#fff8e1",flexShrink:0},confirmBtn:{flex:1,padding:"12px",background:"#4caf50",color:"#fff",border:"none",borderRadius:"8px",cursor:"pointer",fontSize:"15px",fontWeight:"bold",transition:"all 0.2s"},cancelBtn:{padding:"12px 24px",background:"#e0e0e0",border:"none",borderRadius:"8px",cursor:"pointer",fontSize:"15px"}},g5=({manualItems:e,children:t,onAssign:n,onClose:s})=>{const[o,i]=y.useState([]),[a,l]=y.useState("AUTO"),u=(()=>{const j=[];return e.forEach(x=>{(x.manualIds&&x.manualIds.length?x.manualIds:x.manualId?[x.manualId]:[]).forEach(v=>{const g=hn[v];g&&t.forEach(I=>{var R,T,N;if(!I||!I.spiritRoot||I.cultivationMethod===v)return;const _=vc(v,I.spiritRoot);if(!(_!=null&&_.compatibility))return;const k=(_.compatibility.compatibility||0)+(((R=I.stats)==null?void 0:R.aptitude)||0)/200;j.push({manualId:v,manualName:g.name,childId:I.id,childName:I.name,childTier:I.tierTitle||"",childAptitude:((T=I.stats)==null?void 0:T.aptitude)||0,currentManual:I.cultivationMethod,currentManualName:((N=hn[I.cultivationMethod])==null?void 0:N.name)||"",compatibility:_.compatibility,score:k,itemInstanceId:x.instanceId})})})}),j.sort((x,h)=>h.score-x.score)})(),c=(()=>{const j=new Map;return u.forEach(x=>{const h=j.get(x.childId);(!h||x.score>h.score)&&j.set(x.childId,x)}),Array.from(j.values()).filter(x=>{var v,g,I;const h=((I=(g=vc(x.currentManual,(v=t.find(_=>_.id===x.childId))==null?void 0:v.spiritRoot))==null?void 0:g.compatibility)==null?void 0:I.compatibility)||0;return x.compatibility.compatibility>h}).slice(0,10)})(),f=j=>{const x=`${j.childId}-${j.manualId}`,h=o.findIndex(v=>`${v.childId}-${v.manualId}`===x);h>=0?i(v=>v.filter((g,I)=>I!==h)):i(v=>[...v.filter(g=>g.childId!==j.childId),j])},b=()=>{i(c)},S=()=>{n(o)},E=j=>{switch(j){case"":return"#4caf50";case"":return"#8bc34a";case"":return"#ffc107";case"":return"#ff9800";case"":return"#f44336";default:return"#9e9e9e"}};return r.jsx("div",{style:Pe.overlay,children:r.jsxs("div",{style:Pe.modal,children:[r.jsxs("div",{style:Pe.header,children:[r.jsx("h3",{style:Pe.title,children:" "}),r.jsx("button",{onClick:s,style:Pe.closeIcon,children:""})]}),r.jsxs("div",{style:Pe.modeSwitch,children:[r.jsx("button",{style:{...Pe.modeBtn,...a==="AUTO"?Pe.modeBtnActive:{}},onClick:()=>l("AUTO"),children:" "}),r.jsx("button",{style:{...Pe.modeBtn,...a==="MANUAL"?Pe.modeBtnActive:{}},onClick:()=>l("MANUAL"),children:" "})]}),a==="AUTO"?r.jsxs("div",{style:Pe.content,children:[r.jsxs("div",{style:Pe.recommendHeader,children:[r.jsxs("div",{style:Pe.recommendTitle,children:[" ",c.length," "]}),c.length>0&&r.jsx("button",{onClick:b,style:Pe.quickSelectBtn,children:" "})]}),c.length===0?r.jsx("div",{style:Pe.empty,children:" "}):r.jsx("div",{style:Pe.optionList,children:c.map((j,x)=>{const h=o.some(v=>v.childId===j.childId&&v.manualId===j.manualId);return r.jsxs("div",{style:{...Pe.optionCard,borderColor:h?"#4caf50":"#e0e0e0",background:h?"#f1f8f4":"#fff"},onClick:()=>f(j),children:[r.jsxs("div",{style:Pe.optionHeader,children:[r.jsx("input",{type:"checkbox",checked:h,onChange:()=>f(j),style:Pe.checkbox}),r.jsxs("div",{style:Pe.optionInfo,children:[r.jsxs("div",{style:Pe.childInfo,children:[j.childName," (",j.childTier,")"]}),r.jsxs("div",{style:Pe.manualChange,children:[r.jsx("span",{style:Pe.oldManual,children:j.currentManualName}),r.jsx("span",{style:Pe.arrow,children:""}),r.jsx("span",{style:Pe.newManual,children:j.manualName})]})]})]}),r.jsxs("div",{style:Pe.compatibilityRow,children:[r.jsx("span",{style:Pe.compatibilityLabel,children:""}),r.jsxs("span",{style:{...Pe.compatibilityValue,color:E(j.compatibility.level)},children:[j.compatibility.level," (",j.compatibility.compatibility,"%)"]}),r.jsxs("span",{style:Pe.speedBonus,children:[" ",j.compatibility.speedMultiplier]})]}),j.compatibility.desc&&r.jsxs("div",{style:Pe.compatibilityDesc,children:[" ",j.compatibility.desc]})]},`${j.childId}-${j.manualId}`)})})]}):r.jsxs("div",{style:Pe.content,children:[r.jsxs("div",{style:Pe.allOptionsHeader,children:[" ",u.length," "]}),u.length===0?r.jsx("div",{style:Pe.empty,children:""}):r.jsx("div",{style:Pe.optionList,children:u.slice(0,50).map(j=>{const x=o.some(h=>h.childId===j.childId&&h.manualId===j.manualId);return r.jsxs("div",{style:{...Pe.optionCard,borderColor:x?"#4caf50":"#e0e0e0",background:x?"#f1f8f4":"#fff"},onClick:()=>f(j),children:[r.jsxs("div",{style:Pe.optionHeader,children:[r.jsx("input",{type:"checkbox",checked:x,onChange:()=>f(j),style:Pe.checkbox}),r.jsxs("div",{style:Pe.optionInfo,children:[r.jsxs("div",{style:Pe.childInfo,children:[j.childName," (",j.childTier,", ",j.childAptitude,")"]}),r.jsx("div",{style:Pe.manualName,children:j.manualName})]})]}),r.jsxs("div",{style:Pe.compatibilityRow,children:[r.jsx("span",{style:{...Pe.compatibilityBadge,background:E(j.compatibility.level)},children:j.compatibility.level}),r.jsxs("span",{style:Pe.speedBonus,children:["",j.compatibility.speedMultiplier]})]})]},`${j.childId}-${j.manualId}`)})})]}),r.jsxs("div",{style:Pe.footer,children:[r.jsxs("div",{style:Pe.selectionInfo,children:[" ",o.length," "]}),r.jsxs("div",{style:Pe.footerActions,children:[r.jsxs("button",{style:Pe.confirmBtn,onClick:S,disabled:o.length===0,children:[" (",o.length,")"]}),r.jsx("button",{style:Pe.cancelBtn,onClick:s,children:""})]})]})]})})},Pe={overlay:{position:"fixed",top:0,left:0,right:0,bottom:0,background:"rgba(0, 0, 0, 0.75)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:3e3,padding:"20px"},modal:{background:"#fff",borderRadius:"16px",width:"90%",maxWidth:"900px",maxHeight:"85vh",display:"flex",flexDirection:"column",boxShadow:"0 10px 40px rgba(0,0,0,0.3)",overflow:"hidden"},header:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"20px 24px",borderBottom:"2px solid #7e57c2",background:"linear-gradient(90deg, #ede7f6, #d1c4e9)",flexShrink:0},title:{margin:0,fontSize:"22px",color:"#5e35b1",fontWeight:"bold"},closeIcon:{background:"none",border:"none",fontSize:"28px",cursor:"pointer",color:"#5e35b1",padding:"0",lineHeight:"1"},modeSwitch:{display:"flex",gap:"8px",padding:"16px 24px",background:"#f5f5f5",borderBottom:"1px solid #e0e0e0",flexShrink:0},modeBtn:{flex:1,padding:"10px",background:"#fff",border:"2px solid #e0e0e0",borderRadius:"8px",cursor:"pointer",fontSize:"14px",fontWeight:"500",transition:"all 0.2s"},modeBtnActive:{background:"#7e57c2",color:"#fff",borderColor:"#7e57c2"},content:{flex:1,overflowY:"auto",display:"flex",flexDirection:"column"},recommendHeader:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"16px 24px",background:"#f5f5f5",borderBottom:"1px solid #e0e0e0"},recommendTitle:{fontSize:"14px",color:"#666",fontWeight:"500"},quickSelectBtn:{padding:"6px 16px",background:"#4caf50",color:"#fff",border:"none",borderRadius:"6px",cursor:"pointer",fontSize:"13px"},allOptionsHeader:{padding:"16px 24px",fontSize:"14px",color:"#666",background:"#f5f5f5",borderBottom:"1px solid #e0e0e0"},empty:{padding:"60px 24px",textAlign:"center",fontSize:"15px",color:"#999"},optionList:{padding:"16px 24px",display:"flex",flexDirection:"column",gap:"12px"},optionCard:{padding:"16px",border:"2px solid #e0e0e0",borderRadius:"12px",cursor:"pointer",transition:"all 0.2s",display:"flex",flexDirection:"column",gap:"12px"},optionHeader:{display:"flex",gap:"12px",alignItems:"flex-start"},checkbox:{width:"18px",height:"18px",cursor:"pointer",marginTop:"2px",flexShrink:0},optionInfo:{flex:1,display:"flex",flexDirection:"column",gap:"6px"},childInfo:{fontSize:"15px",fontWeight:"bold",color:"#333"},manualChange:{display:"flex",alignItems:"center",gap:"8px",fontSize:"14px"},oldManual:{color:"#999",textDecoration:"line-through"},arrow:{color:"#666"},newManual:{color:"#7e57c2",fontWeight:"600"},manualName:{fontSize:"14px",color:"#7e57c2",fontWeight:"600"},compatibilityRow:{display:"flex",gap:"12px",alignItems:"center",fontSize:"13px"},compatibilityLabel:{color:"#666"},compatibilityValue:{fontWeight:"600"},compatibilityBadge:{padding:"4px 10px",borderRadius:"12px",color:"#fff",fontSize:"12px",fontWeight:"bold"},speedBonus:{color:"#2196f3",fontWeight:"500"},compatibilityDesc:{fontSize:"12px",color:"#666",fontStyle:"italic",paddingLeft:"30px"},footer:{padding:"16px 24px",borderTop:"2px solid #e0e0e0",background:"#f5f5f5",display:"flex",justifyContent:"space-between",alignItems:"center",flexShrink:0},selectionInfo:{fontSize:"14px",color:"#666"},footerActions:{display:"flex",gap:"12px"},confirmBtn:{padding:"10px 24px",background:"#7e57c2",color:"#fff",border:"none",borderRadius:"8px",cursor:"pointer",fontSize:"15px",fontWeight:"bold",transition:"all 0.2s"},cancelBtn:{padding:"10px 24px",background:"#e0e0e0",border:"none",borderRadius:"8px",cursor:"pointer",fontSize:"15px"}},x5=({modalState:e,closeModal:t,player:n,inventory:s,handleGiftConfirm:o,handleNegotiateConfirm:i,handleShopPurchase:a,handleOptionSelect:l,handleShuraFieldSelect:d,handleBuyAuctionItem:u,handleShowAuctionPlot:p,modalMgr:c,allChildren:f,visibleChildren:b,handleEquipToChild:S,handleUseConsumable:E,handleBatchUseConsumables:j,handleDiscardFromInventory:x,handleGiveToChild:h,handleBatchGiveToChildren:v,handleSell:g,handleAutoAssignManualToChild:I,getMarketPrice:_,testQueue:C,handleTestFinish:k,handleTestQueueClose:R,childSelectorModal:T,handleChildSelectorSelect:N,closeChildSelectorModal:Y,selectedChild:H,childNavigationMeta:B,handleNavigateChild:$,handleChildAction:q,setSelectedChild:se,showSpouseSelection:J,marryingChild:X,spouseCandidates:re,handleSpouseSelect:ye,resetSpouseSelection:Re,batchGiftEvents:Fe,handleBatchGiftConfirm:O,handleBatchGiftClose:ie,batchPromotionEvents:le,handleBatchPromotionConfirm:ee,handleBatchPromotionClose:he,batchMarriagePlans:Ee,handleBatchMarriageConfirm:_e,handleBatchMarriageClose:rt,handleBatchManualAssign:At})=>r.jsxs(r.Fragment,{children:[e.type==="GIFT"&&r.jsx(VC,{npc:e.data,inventory:s,onGift:o,onClose:t}),e.type==="NEGOTIATE"&&r.jsx(qC,{npc:e.data,onNegotiate:i,onClose:t}),e.type==="SHOP"&&r.jsx(KC,{items:e.data.items,playerSpiritStones:n.resources.spiritStones||0,onPurchase:a,onClose:t}),e.type==="RESULT"&&r.jsx(QC,{result:e.data,onClose:t}),e.type==="CONFIRM"&&r.jsx(JC,{message:e.data.message,input:e.data.input,onConfirm:Oe=>{e.data.onConfirm(Oe),t()},onCancel:t}),e.type==="EVENT"&&r.jsx(XC,{event:e.data.event,npc:e.data.npc,onClose:t,onOptionSelect:l}),e.type==="SHURA_FIELD"&&r.jsx(ZC,{event:e.data,player:n,onClose:t,onOptionSelect:d}),e.type==="JEALOUSY"&&r.jsx(t5,{event:e.data,onClose:t}),e.type==="AUCTION"&&r.jsx(s5,{auction:e.data,playerResources:n.resources,onClose:t,onBuy:u,onShowPlot:p,playerSoldAuctionItems:n.soldAuctionItems||[]}),c.inventoryModal.open&&r.jsx(i5,{items:s,mode:c.inventoryModal.mode,slot:c.inventoryModal.slot,childId:c.inventoryModal.childId,children:f,batchUseItems:c.inventoryModal.batchUseItems||[],onClose:()=>c.closeInventory(),onEquip:Oe=>S(c.inventoryModal.childId,c.inventoryModal.slot,Oe),onUse:Oe=>E(c.inventoryModal.childId,Oe),onBatchUse:(Oe,P)=>j(Oe,P),onDiscard:Oe=>x(Oe),onGiveToChild:h,onBatchGive:v,onSell:(Oe,P)=>g(Oe,P),onAutoAssignManual:I,getMarketPrice:_}),C.length>0&&r.jsx(a5,{child:C[0],onFinish:k,onClose:R}),T.open&&r.jsx(c5,{children:b,item:T.item,items:T.items,isBatch:T.isBatch,onSelect:N,onClose:Y}),H&&r.jsx(u5,{child:H,navigation:B,onNavigate:$,onClose:()=>se(null),onAction:(Oe,P)=>q(H.id,Oe,P)}),J&&X&&r.jsx(p5,{child:X,candidates:re,onSelect:ye,onClose:Re}),c.showBatchGiftModal&&Fe.length>0&&r.jsx(f5,{giftEvents:Fe,onConfirm:O,onClose:ie}),c.showBatchPromotionModal&&le.length>0&&r.jsx(m5,{promotionEvents:le,onConfirm:ee,onClose:he}),c.showBatchMarriageModal&&Ee.length>0&&r.jsx(h5,{marriagePlans:Ee,onConfirm:_e,onClose:rt}),c.showBatchManualModal&&r.jsx(g5,{manualItems:s.filter(Oe=>Oe.type==="manual"&&(Oe.manualIds&&Oe.manualIds.length||Oe.manualId)),children:b.length?b:f,onAssign:At,onClose:()=>c.closeBatchManualModal()})]});function y5({npc:e,onClose:t,playerAffection:n=0}){var j,x;const[s,o]=y.useState("ALL"),[i,a]=y.useState(0),l=20;if(y.useEffect(()=>{const h=v=>{v.key==="Escape"&&t()};return window.addEventListener("keydown",h),()=>window.removeEventListener("keydown",h)},[t]),y.useEffect(()=>{a(0)},[s]),!e)return null;const d=Number(n)||0,u=Math.max(0,Math.min(100,d));if(d<30)return r.jsx("div",{className:"modal-overlay",onClick:t,children:r.jsxs("div",{className:"npc-log-modal",onClick:h=>h.stopPropagation(),children:[r.jsxs("div",{className:"log-modal-header",children:[r.jsx("div",{className:"log-modal-title",children:r.jsxs("h2",{children:[e.name," "]})}),r.jsx("button",{className:"close-btn",onClick:t,children:""})]}),r.jsxs("div",{className:"log-empty",style:{padding:"80px 20px"},children:[r.jsx("p",{style:{fontSize:"64px",margin:"0 0 20px 0"},children:""}),r.jsx("h3",{style:{color:"#ffd700",marginBottom:"12px"},children:""}),r.jsxs("p",{style:{color:"rgba(255,255,255,0.7)",fontSize:"16px"},children:[" ",e.name," ",r.jsx("br",{})," ",r.jsx("span",{style:{color:"#ffd700",fontWeight:"bold"},children:"30"})," ",e.gender===""?"":"",""]}),r.jsxs("p",{style:{color:"rgba(255,255,255,0.5)",fontSize:"14px",marginTop:"20px"},children:["",r.jsx("span",{style:{color:d<10?"#f44336":"#ff9800"},children:u})," / 30"]})]})]})});const p=gk(e,d),c=s==="ALL"?p:p.filter(h=>h.type===s),f=Math.max(1,Math.ceil(c.length/l)),b=c.slice(i*l,(i+1)*l),S={all:p.length,interaction:p.filter(h=>h.type===pt.INTERACTION).length,stateChange:p.filter(h=>h.type===pt.STATE_CHANGE).length,daily:p.filter(h=>h.type===pt.DAILY).length},E=h=>{switch(h){case pt.INTERACTION:return{icon:"",color:"#4CAF50",label:""};case pt.STATE_CHANGE:return{icon:"",color:"#FF5722",label:""};case pt.DAILY:return{icon:"",color:"#2196F3",label:""};default:return{icon:"",color:"#9E9E9E",label:""}}};return r.jsx("div",{className:"modal-overlay",onClick:t,children:r.jsxs("div",{className:"npc-log-modal",onClick:h=>h.stopPropagation(),children:[r.jsxs("div",{className:"log-modal-header",children:[r.jsxs("div",{className:"log-modal-title",children:[r.jsxs("h2",{children:[e.name," "]}),r.jsxs("p",{className:"log-modal-subtitle",children:[e.gender===""?"":"","..."]})]}),r.jsx("button",{className:"close-btn",onClick:t,children:""})]}),r.jsxs("div",{className:"log-filter-bar",children:[r.jsxs("button",{className:`filter-btn ${s==="ALL"?"active":""}`,onClick:()=>o("ALL"),children:["  (",S.all,")"]}),r.jsxs("button",{className:`filter-btn ${s===pt.INTERACTION?"active":""}`,onClick:()=>o(pt.INTERACTION),children:["  (",S.interaction,")"]}),r.jsxs("button",{className:`filter-btn ${s===pt.STATE_CHANGE?"active":""}`,onClick:()=>o(pt.STATE_CHANGE),children:["  (",S.stateChange,")"]}),r.jsxs("button",{className:`filter-btn ${s===pt.DAILY?"active":""}`,onClick:()=>o(pt.DAILY),children:["  (",S.daily,")"]})]}),r.jsx("div",{className:"log-content",children:c.length===0?r.jsxs("div",{className:"log-empty",children:[r.jsx("p",{children:""}),r.jsx("p",{children:""}),d<80&&p.length<((j=e.logs)==null?void 0:j.length)&&r.jsx("p",{className:"log-hint",children:" "})]}):r.jsx("div",{className:"log-list",children:b.map((h,v)=>{const g=E(h.type);return r.jsxs("div",{className:`log-entry ${h.isSecret?"secret":""}`,children:[r.jsxs("div",{className:"log-header",children:[r.jsxs("span",{className:"log-type-badge",style:{backgroundColor:g.color},children:[g.icon," ",g.label]}),r.jsxs("span",{className:"log-date",children:[" ",h.year,"  ",h.month," "]}),h.isSecret&&r.jsx("span",{className:"secret-badge",title:"",children:""})]}),r.jsx("div",{className:"log-text",children:h.content})]},`${h.timestamp}-${v}`)})})}),c.length>l&&r.jsxs("div",{className:"log-pagination",children:[r.jsx("button",{className:"page-btn",onClick:()=>a(h=>Math.max(0,h-1)),disabled:i<=0,children:""}),r.jsxs("span",{className:"page-info",children:[" ",i+1," / ",f," "]}),r.jsx("button",{className:"page-btn",onClick:()=>a(h=>Math.min(f-1,h+1)),disabled:i>=f-1,children:""})]}),r.jsxs("div",{className:"log-record-count",children:[" ",c.length," "]}),d<80&&((x=e.logs)==null?void 0:x.length)>p.length&&r.jsx("div",{className:"log-footer-hint",children:"  80+ "})]})})}const b5=({player:e,enemy:t,result:n,onClose:s})=>{var d,u;const o=y.useRef(null),[i,a]=y.useState(0),l=y.useMemo(()=>v5((n==null?void 0:n.logs)||[],e),[n==null?void 0:n.logs,e,t]);return y.useEffect(()=>{if(a(0),!l.length)return;const p=setInterval(()=>{a(c=>c>=l.length?(clearInterval(p),c):c+1)},300);return()=>clearInterval(p)},[l.length]),y.useEffect(()=>{o.current&&(o.current.scrollTop=o.current.scrollHeight)},[i]),r.jsx("div",{style:pn.overlay,children:r.jsxs("div",{style:pn.window,children:[r.jsx("div",{style:pn.header,children:" "}),r.jsxs("div",{style:pn.statusBar,children:[r.jsxs("div",{style:pn.fighter,children:[r.jsx("div",{style:pn.avatar,children:""}),r.jsx("div",{children:e.name}),r.jsxs("div",{style:{color:"#d32f2f"},children:["HP: ",((d=e.combatStats)==null?void 0:d.hp)||0]}),r.jsxs("div",{style:{marginTop:6,fontSize:12,color:"#666"},children:[": ",ms(e).total]})]}),r.jsx("div",{style:pn.vs,children:"VS"}),r.jsxs("div",{style:pn.fighter,children:[r.jsx("div",{style:{...pn.avatar,background:"#d32f2f"},children:""}),r.jsx("div",{children:t.name}),r.jsxs("div",{style:{color:"#d32f2f"},children:["HP: ",((u=t.combatStats)==null?void 0:u.hp)||0]}),r.jsxs("div",{style:{marginTop:6,fontSize:12,color:"#666"},children:[": ",ms(t).total]})]})]}),r.jsx("div",{style:{padding:"10px 15px",fontSize:12,color:"#444",background:"#fff8",borderBottom:"1px solid #eee"},children:""}),r.jsx("div",{style:pn.logBox,ref:o,children:l.slice(0,i).map((p,c)=>r.jsxs("div",{style:pn.entryRow,children:[r.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8},children:[r.jsx("div",{style:{fontSize:16},children:p.icon}),r.jsxs("div",{children:[r.jsx("div",{style:{fontSize:13,color:p.isDamage?p.byPlayer?"#2e7d32":"#d32f2f":"#444",fontWeight:600},children:p.text}),p.damage!=null&&r.jsxs("div",{style:{fontSize:12,color:"#666",marginTop:4},children:[": ",r.jsx("strong",{style:{color:p.byPlayer?"#2e7d32":"#d32f2f"},children:p.damage}),p.defended?"":""]})]})]}),p.maxHp!=null&&r.jsxs("div",{style:pn.hpBarWrap,children:[r.jsx("div",{style:pn.hpBarBg,children:r.jsx("div",{style:{...pn.hpBarFill,width:`${Math.max(0,Math.min(100,Math.floor(p.remaining/p.maxHp*100)))}%`,background:p.byPlayer?"#2e7d32":"#d32f2f"}})}),r.jsxs("div",{style:{fontSize:12,color:"#333",marginLeft:8},children:[p.remaining,"/",p.maxHp," HP"]})]})]},c))}),r.jsx("button",{onClick:s,style:{...pn.btn,background:n.success?"#4caf50":"#d32f2f"},children:n.success?"":""})]})})},pn={overlay:{position:"fixed",top:0,left:0,right:0,bottom:0,background:"rgba(0,0,0,0.85)",zIndex:2200,display:"flex",alignItems:"center",justifyContent:"center"},window:{width:"90%",maxWidth:"400px",background:"#fff",borderRadius:"8px",overflow:"hidden",display:"flex",flexDirection:"column",boxShadow:"0 0 20px rgba(255,0,0,0.5)"},header:{background:"#212121",color:"#fff",padding:"15px",textAlign:"center",fontSize:"18px",fontWeight:"bold"},statusBar:{display:"flex",justifyContent:"space-between",padding:"15px",background:"#f5f5f5",borderBottom:"1px solid #ddd"},fighter:{textAlign:"center",fontSize:"12px"},avatar:{width:"40px",height:"40px",borderRadius:"50%",background:"#333",color:"white",display:"flex",alignItems:"center",justifyContent:"center",margin:"0 auto 5px"},vs:{fontSize:"24px",fontStyle:"italic",fontWeight:"bold",color:"#999",alignSelf:"center"},logBox:{padding:"15px",height:"250px",overflowY:"auto",background:"#fff",fontSize:"13px",lineHeight:"1.6"},entryRow:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"8px 0",borderBottom:"1px dashed #eee"},hpBarWrap:{display:"flex",alignItems:"center",gap:8},hpBarBg:{width:140,height:10,background:"#eee",borderRadius:6,overflow:"hidden"},hpBarFill:{height:"100%",borderRadius:6,transition:"width 0.3s ease"},btn:{padding:"15px",border:"none",color:"#fff",fontSize:"16px",cursor:"pointer",fontWeight:"bold"}};function v5(e=[],t,n){const s=[],o=/(.+)  (.+)  (\d+) ()?/,i=/(.+)  (.+)  (\d+) ()?/,a=/(.+)  HP: (\d+)\/(\d+)/;for(let l=0;l<e.length;l++){const d=e[l];let u=d.match(o)||d.match(i);if(u){const p=u[1],c=u[2],f=Number(u[3]),b=!!u[4];let S=null,E=null;if(l+1<e.length){const x=e[l+1].match(a);x&&x[1]===c&&(S=Number(x[2]),E=Number(x[3]),l++)}const j=p===t.name;s.push({icon:j?"":"",text:`${p}  ${c}`,damage:f,remaining:S,maxHp:E,defended:b,isDamage:!0,byPlayer:j});continue}s.push({icon:"",text:d,isDamage:!1})}return s}const S5=({open:e,realmName:t,progress:n,total:s,event:o,log:i,optionContext:a,onSelectOption:l,onNext:d,onStartCombat:u,onClose:p})=>{const[c,f]=y.useState(null),[b,S]=y.useState(null),[E,j]=y.useState(!1),[x,h]=y.useState(!1),[v,g]=y.useState("");if(y.useEffect(()=>{e&&j(!0)},[e]),!e)return null;const I=()=>{if(!o)return"";switch(o.kind){case"COMBAT":return"";case"BOSS":return"";case"TREASURE":return"";case"MYSTERY":return"";default:return""}},_=()=>{if(!o)return"#4a5568";switch(o.kind){case"COMBAT":return"#d32f2f";case"BOSS":return"#7b1fa2";case"TREASURE":return"#f57c00";case"MYSTERY":return"#1976d2";default:return"#388e3c"}},C=(n/s*100).toFixed(0),k=N=>{g(N.label),h(!0),l(N)},R=()=>{h(!1),g(""),setTimeout(()=>{d()},300)},T=()=>{g(""),h(!0),u()};return r.jsxs("div",{style:Ze.overlay,children:[r.jsxs("div",{style:{...Ze.window,animation:E?"slideIn 0.3s ease-out":"none"},children:[r.jsxs("div",{style:{...Ze.header,background:`linear-gradient(135deg, ${_()}, ${_()}dd)`},children:[r.jsxs("div",{style:Ze.headerTop,children:[r.jsxs("span",{style:Ze.realmTitle,children:[I()," ",t]}),r.jsx("button",{style:Ze.closeIconBtn,onClick:p,onMouseEnter:()=>S("close"),onMouseLeave:()=>S(null),children:""})]}),r.jsxs("div",{style:Ze.progressContainer,children:[r.jsx("div",{style:{...Ze.progressBar,width:`${C}%`,background:"linear-gradient(90deg, #ffd54f, #ffb300)"}}),r.jsxs("span",{style:Ze.progressText,children:[n," / ",s]})]})]}),r.jsxs("div",{style:Ze.body,children:[r.jsxs("div",{style:{...Ze.eventCard,borderLeft:`4px solid ${_()}`},children:[r.jsxs("div",{style:Ze.eventHeader,children:[r.jsx("span",{style:{...Ze.eventBadge,background:_()},children:(o==null?void 0:o.kind)||""}),r.jsx("h3",{style:Ze.eventTitle,children:(o==null?void 0:o.title)||""})]}),r.jsx("p",{style:Ze.eventDesc,children:(o==null?void 0:o.desc)||""})]}),(o==null?void 0:o.options)&&o.options.length>0&&r.jsxs("div",{style:Ze.optionsContainer,children:[r.jsx("div",{style:Ze.optionsLabel,children:" "}),r.jsx("div",{style:Ze.options,children:o.options.map((N,Y)=>{const H=a||{},B=!N.condition||N.condition(H);return r.jsxs("button",{style:{...Ze.optionBtn,...c===Y&&B?Ze.optionBtnHover:{},...B?{}:Ze.optionBtnDisabled},onMouseEnter:()=>f(Y),onMouseLeave:()=>f(null),onClick:()=>{B&&k(N)},disabled:!B,"aria-disabled":!B,children:[r.jsx("span",{style:Ze.optionIcon,children:""}),r.jsx("span",{style:Ze.optionLabel,children:N.label})]},Y)})})]}),((o==null?void 0:o.kind)==="COMBAT"||(o==null?void 0:o.kind)==="BOSS")&&r.jsxs("button",{style:{...Ze.fightBtn,...b==="fight"?Ze.fightBtnHover:{}},onMouseEnter:()=>S("fight"),onMouseLeave:()=>S(null),onClick:T,children:[r.jsx("span",{style:Ze.fightIcon,children:""}),r.jsx("span",{children:""})]})]}),r.jsx("div",{style:Ze.footer,children:r.jsx("button",{style:{...Ze.actionBtn,...Ze.exitBtn,...b==="exit"?Ze.exitBtnHover:{}},onMouseEnter:()=>S("exit"),onMouseLeave:()=>S(null),onClick:p,children:r.jsx("span",{children:""})})})]}),x&&r.jsx("div",{style:Ze.resultOverlay,children:r.jsxs("div",{style:Ze.resultBox,children:[r.jsx("div",{style:Ze.resultIcon,children:""}),r.jsx("div",{style:Ze.resultTitle,children:""}),r.jsx("div",{style:Ze.resultMessage,children:i&&i.length>0?i[i.length-1]:v}),r.jsx("button",{style:{...Ze.resultBtn,...b==="result"?Ze.resultBtnHover:{}},onMouseEnter:()=>S("result"),onMouseLeave:()=>S(null),onClick:R,children:""})]})}),r.jsx("style",{children:`
        @keyframes slideIn {
          from {
            opacity: 0;
            transform: translateY(-30px) scale(0.95);
          }
          to {
            opacity: 1;
            transform: translateY(0) scale(1);
          }
        }
        @keyframes fadeIn {
          from {
            opacity: 0;
            transform: translateX(-10px);
          }
          to {
            opacity: 1;
            transform: translateX(0);
          }
        }
        @keyframes popIn {
          0% {
            opacity: 0;
            transform: scale(0.8);
          }
          50% {
            transform: scale(1.05);
          }
          100% {
            opacity: 1;
            transform: scale(1);
          }
        }
        @keyframes bounce {
          0%, 100% {
            transform: translateY(0);
          }
          50% {
            transform: translateY(-10px);
          }
        }
      `})]})},Ze={overlay:{position:"fixed",top:0,left:0,right:0,bottom:0,background:"rgba(0, 0, 0, 0.75)",backdropFilter:"blur(4px)",zIndex:2100,display:"flex",alignItems:"center",justifyContent:"center",padding:"20px"},window:{width:"100%",maxWidth:"600px",background:"linear-gradient(to bottom, #ffffff, #f8f9fa)",borderRadius:"16px",boxShadow:"0 20px 60px rgba(0, 0, 0, 0.4)",overflow:"hidden",display:"flex",flexDirection:"column",maxHeight:"90vh"},header:{color:"#fff",padding:"16px 20px",position:"relative"},headerTop:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"12px"},realmTitle:{fontSize:"18px",fontWeight:"bold",textShadow:"0 2px 4px rgba(0,0,0,0.2)"},closeIconBtn:{background:"rgba(255,255,255,0.2)",border:"none",color:"#fff",width:"32px",height:"32px",borderRadius:"50%",cursor:"pointer",fontSize:"20px",display:"flex",alignItems:"center",justifyContent:"center",transition:"all 0.2s ease",":hover":{background:"rgba(255,255,255,0.3)"}},progressContainer:{position:"relative",background:"rgba(0,0,0,0.2)",height:"24px",borderRadius:"12px",overflow:"hidden"},progressBar:{height:"100%",transition:"width 0.5s ease",borderRadius:"12px",boxShadow:"inset 0 2px 4px rgba(0,0,0,0.1)"},progressText:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",fontSize:"13px",fontWeight:"bold",textShadow:"0 1px 2px rgba(0,0,0,0.3)"},body:{padding:"20px",flex:1,overflowY:"auto"},eventCard:{background:"#fff",borderRadius:"12px",padding:"16px",marginBottom:"16px",boxShadow:"0 2px 8px rgba(0,0,0,0.08)"},eventHeader:{display:"flex",alignItems:"center",gap:"10px",marginBottom:"10px"},eventBadge:{padding:"4px 12px",borderRadius:"12px",color:"#fff",fontSize:"11px",fontWeight:"bold",textTransform:"uppercase",letterSpacing:"0.5px"},eventTitle:{fontSize:"18px",fontWeight:"bold",color:"#1a202c",margin:0},eventDesc:{fontSize:"14px",color:"#4a5568",lineHeight:1.7,margin:0},optionsContainer:{marginBottom:"16px"},optionsLabel:{fontSize:"13px",fontWeight:"600",color:"#2d3748",marginBottom:"10px"},options:{display:"grid",gridTemplateColumns:"1fr",gap:"10px"},optionBtn:{display:"flex",alignItems:"center",gap:"10px",padding:"14px 16px",border:"2px solid #e2e8f0",borderRadius:"10px",background:"#fff",cursor:"pointer",fontSize:"14px",fontWeight:"500",color:"#2d3748",transition:"all 0.2s ease",textAlign:"left"},optionBtnHover:{border:"2px solid #4299e1",background:"#ebf8ff",transform:"translateX(4px)",boxShadow:"0 4px 12px rgba(66, 153, 225, 0.15)"},optionBtnDisabled:{borderColor:"#cbd5e1",background:"#f8fafc",color:"#94a3b8",cursor:"not-allowed",opacity:.7},optionIcon:{fontSize:"16px"},optionLabel:{flex:1},fightBtn:{width:"100%",display:"flex",alignItems:"center",justifyContent:"center",gap:"10px",padding:"16px",border:"none",borderRadius:"10px",background:"linear-gradient(135deg, #dc2626, #b91c1c)",color:"#fff",fontWeight:"bold",fontSize:"16px",cursor:"pointer",marginBottom:"16px",transition:"all 0.3s ease",boxShadow:"0 4px 12px rgba(220, 38, 38, 0.3)"},fightBtnHover:{transform:"translateY(-2px)",boxShadow:"0 6px 20px rgba(220, 38, 38, 0.4)"},fightIcon:{fontSize:"20px",animation:"pulse 1.5s ease-in-out infinite"},footer:{display:"flex",gap:"12px",padding:"16px 20px",background:"#fff",borderTop:"1px solid #e2e8f0"},actionBtn:{flex:1,display:"flex",alignItems:"center",justifyContent:"center",gap:"8px",padding:"14px 20px",border:"none",borderRadius:"10px",cursor:"pointer",fontWeight:"600",fontSize:"15px",transition:"all 0.2s ease"},exitBtn:{background:"#f1f5f9",color:"#475569",border:"1px solid #cbd5e1"},exitBtnHover:{background:"#e2e8f0",border:"1px solid #94a3b8"},resultOverlay:{position:"absolute",top:0,left:0,right:0,bottom:0,background:"rgba(0, 0, 0, 0.6)",backdropFilter:"blur(2px)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:10,borderRadius:"16px"},resultBox:{background:"linear-gradient(135deg, #ffffff, #f0f9ff)",borderRadius:"16px",padding:"32px",maxWidth:"400px",width:"90%",boxShadow:"0 20px 60px rgba(0, 0, 0, 0.3)",textAlign:"center",animation:"popIn 0.3s ease-out",border:"2px solid #3b82f6"},resultIcon:{fontSize:"48px",marginBottom:"16px",animation:"bounce 0.6s ease-in-out"},resultTitle:{fontSize:"20px",fontWeight:"bold",color:"#1e40af",marginBottom:"16px"},resultMessage:{fontSize:"15px",color:"#475569",lineHeight:1.8,marginBottom:"24px",padding:"16px",background:"rgba(59, 130, 246, 0.08)",borderRadius:"8px",border:"1px solid rgba(59, 130, 246, 0.2)"},resultBtn:{padding:"12px 32px",background:"linear-gradient(135deg, #3b82f6, #2563eb)",color:"#fff",border:"none",borderRadius:"8px",fontSize:"16px",fontWeight:"600",cursor:"pointer",transition:"all 0.2s ease",boxShadow:"0 4px 12px rgba(59, 130, 246, 0.3)"},resultBtnHover:{transform:"translateY(-2px)",boxShadow:"0 6px 20px rgba(59, 130, 246, 0.4)"}},w5=({event:e,onClose:t,onAssign:n})=>{var f,b,S,E;if(!e)return null;const{child:s,selectableSects:o=[],otherSectOptions:i=[],title:a,message:l}=e,[d,u]=y.useState(!1),p=j=>{if(typeof j.compatibility=="number")return j.compatibility;const x=j.sect||j;return wy(s,x)},c=j=>{if(j.admission&&j.admission.qualified===!1)return;const x=j.sect||j,h=j.predictedRank||"";n(s.id,x.id,h)};return r.jsx("div",{style:Fn.overlay,children:r.jsxs("div",{style:Fn.card,children:[r.jsx("h2",{children:a||""}),r.jsx("p",{style:{color:"#444"},children:l}),r.jsxs("div",{style:Fn.content,children:[r.jsxs("div",{style:Fn.childBox,children:[r.jsxs("h3",{children:[s.name," (",s.gender,")"]}),r.jsxs("p",{children:[": ",((f=s.stats)==null?void 0:f.aptitude)||0]}),r.jsxs("p",{children:[": ",r.jsx("strong",{style:{color:((b=s.spiritRoot)==null?void 0:b.color)||"#666"},children:((S=s.spiritRoot)==null?void 0:S.type)||""})]}),r.jsx("div",{style:{display:"flex",gap:6},children:(((E=s.spiritRoot)==null?void 0:E.elements)||[]).map(j=>r.jsx("span",{style:{padding:"4px 8px",background:"#eee",borderRadius:6},children:j},j))})]}),r.jsx("div",{style:Fn.listBox,children:o.map(j=>{var k;const x=j.sect||j,h=j.predictedRank,v=j.resources||[],g=j.admission||{},I=g.qualified!==!1,_=g.summary||g.notes||"",C=I?g.notes||"":((k=g.reasons)==null?void 0:k.join(""))||"";return r.jsxs("div",{style:Fn.sectRow,children:[r.jsxs("div",{children:[r.jsx("div",{style:{fontWeight:"bold"},children:x.name}),r.jsx("div",{style:{fontSize:12,color:"#666"},children:x.desc}),r.jsxs("div",{style:{fontSize:12,color:"#444",marginTop:6},children:[": ",v.join(", ")||""]}),r.jsxs("div",{style:{fontSize:12,color:"#888",marginTop:4},children:[": ",_]}),r.jsx("div",{style:{fontSize:12,color:I?"#1b5e20":"#a00"},children:C})]}),r.jsxs("div",{style:{textAlign:"right"},children:[r.jsxs("div",{style:{marginBottom:6},children:[": ",p(j)]}),r.jsxs("div",{style:{fontSize:12,color:"#333",marginBottom:6},children:[": ",h||""]}),r.jsx("button",{disabled:!I,onClick:()=>c(j),style:{...Fn.btn,opacity:I?1:.4,cursor:I?"pointer":"not-allowed"},children:I?"":""})]})]},x.id)})}),i.length>0&&r.jsxs("div",{style:{marginTop:12},children:[r.jsx("button",{onClick:()=>u(j=>!j),style:Fn.secondaryBtn,children:d?"":""}),d&&r.jsx("div",{style:Fn.otherList,children:i.map(j=>{var I;const x=j.sect||j,h=j.admission||{},v=h.qualified!==!1,g=((I=h.reasons)==null?void 0:I.join(""))||"";return r.jsxs("div",{style:Fn.otherRow,children:[r.jsxs("div",{children:[r.jsx("div",{style:{fontWeight:"bold"},children:x.name}),r.jsx("div",{style:{fontSize:12,color:"#666"},children:h.summary||x.desc}),r.jsx("div",{style:{fontSize:12,color:v?"#1b5e20":"#a00"},children:v?` ${p(j)}  `:`${g}`})]}),r.jsx("button",{disabled:!v,onClick:()=>c(j),style:{...Fn.btn,opacity:v?1:.35,cursor:v?"pointer":"not-allowed"},children:v?"":""})]},x.id)})})]})]}),r.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginTop:12},children:[r.jsx("button",{onClick:t,style:Fn.cancel,children:""}),r.jsx("p",{style:{fontSize:"11px",color:"#999",marginTop:"6px",marginLeft:"10px"},children:""})]})]})})},Fn={overlay:{position:"fixed",inset:0,background:"rgba(0,0,0,0.7)",display:"flex",justifyContent:"center",alignItems:"center",zIndex:500,padding:"10px",overflowY:"auto"},card:{width:"100%",maxWidth:"640px",background:"#fff",borderRadius:12,padding:"16px",maxHeight:"90vh",overflowY:"auto",margin:"auto"},content:{display:"flex",gap:12,flexDirection:window.innerWidth<=768?"column":"row"},childBox:{width:window.innerWidth<=768?"100%":"220px",padding:12,background:"#fafafa",borderRadius:8},listBox:{flex:1,display:"flex",flexDirection:"column",gap:8},sectRow:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:10,borderRadius:8,background:"#fff",boxShadow:"0 1px 4px rgba(0,0,0,0.05)",flexDirection:window.innerWidth<=480?"column":"row",gap:window.innerWidth<=480?"10px":"0"},btn:{padding:"8px 12px",background:"#3e2723",color:"white",border:"none",borderRadius:6,cursor:"pointer",fontSize:"clamp(12px, 3vw, 14px)",whiteSpace:"nowrap"},cancel:{padding:"8px 12px",background:"#ddd",border:"none",borderRadius:6,cursor:"pointer",fontSize:"clamp(12px, 3vw, 14px)"},secondaryBtn:{marginTop:8,padding:"6px 10px",background:"#f5f5f5",border:"1px solid #ccc",borderRadius:6,cursor:"pointer",fontSize:"clamp(12px, 3vw, 13px)"},otherList:{marginTop:10,display:"flex",flexDirection:"column",gap:8},otherRow:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"8px 10px",borderRadius:8,background:"#fafafa"}},Ai=[{id:1,title:"",content:`
      <p> </p>
      <p><strong></strong><strong></strong></p>
      <p><strong></strong></p>
      <br/>
      <p> <strong></strong></p>
      <ul>
        <li> </li>
        <li> </li>
        <li> </li>
        <li> </li>
      </ul>
    `},{id:2,title:"",content:`
      <p> <strong></strong></p>
      <br/>
      <p> <strong></strong></p>
      <ul>
        <li><strong> </strong>NPC</li>
        <li><strong> </strong></li>
        <li><strong> </strong></li>
        <li><strong> </strong></li>
        <li><strong> </strong></li>
        <li><strong> </strong></li>
      </ul>
    `},{id:3,title:"",content:`
      <p> <strong></strong></p>
      <br/>
      <p><strong></strong></p>
      <p><strong></strong>10%</p>
      <br/>
      <p> <strong></strong></p>
      <ul>
        <li> /10% </li>
        <li> 50% </li>
        <li> 100% </li>
      </ul>
      <br/>
      <p> <strong></strong></p>
      <ul>
        <li>></li>
        <li></li>
        <li></li>
      </ul>
    `},{id:4,title:"",content:`
      <p> <strong></strong></p>
      <br/>
      <p><strong></strong></p>
      <ul>
        <li></li>
        <li> <strong>100</strong> </li>
        <li><strong>""</strong></li>
      </ul>
      <br/>
      <p> <strong></strong></p>
      <ul>
        <li> HP()  ATK()</li>
        <li></li>
      </ul>
    `},{id:5,title:"",content:`
      <p> <strong></strong></p>
      <br/>
      <p> <strong></strong></p>
      <p></p>
      <br/>
      <p> <strong></strong></p>
      <ul>
        <li>NPC</li>
        <li> </li>
        <li>6</li>
        <li></li>
      </ul>
      <br/>
      <p style="text-align:center; color:#d32f2f; font-weight:bold;">
        
      </p>
    `}],k5=({onClose:e,onComplete:t})=>{const[n,s]=y.useState(0),o=()=>{n<Ai.length-1?s(n+1):(t&&t(),e())},i=()=>{t&&t(),e()},a=Ai[n],l=(n+1)/Ai.length*100;return r.jsx("div",{style:bn.overlay,children:r.jsxs("div",{style:bn.modal,children:[r.jsxs("div",{style:bn.header,children:[r.jsxs("div",{style:bn.headerContent,children:[r.jsxs("span",{style:bn.stepIndicator,children:[" ",n+1," / ",Ai.length]}),r.jsx("h3",{style:bn.title,children:a.title})]}),r.jsx("button",{onClick:i,style:bn.skipBtn,children:""})]}),r.jsx("div",{style:bn.progressBar,children:r.jsx("div",{style:{...bn.progressFill,width:`${l}%`}})}),r.jsx("div",{style:bn.content,children:r.jsx("div",{style:bn.contentText,dangerouslySetInnerHTML:{__html:a.content}})}),r.jsxs("div",{style:bn.footer,children:[n>0&&r.jsx("button",{onClick:()=>s(n-1),style:bn.prevBtn,children:""}),r.jsx("div",{style:{flex:1}}),r.jsx("button",{onClick:o,style:bn.nextBtn,children:n===Ai.length-1?"":""})]})]})})},bn={overlay:{position:"fixed",top:0,left:0,right:0,bottom:0,background:"rgba(0, 0, 0, 0.85)",zIndex:9999,display:"flex",alignItems:"center",justifyContent:"center",animation:"fadeIn 0.3s ease-in"},modal:{width:"90%",maxWidth:"550px",maxHeight:"85vh",background:"linear-gradient(135deg, #ffffff 0%, #f5f5f5 100%)",borderRadius:"16px",boxShadow:"0 20px 60px rgba(0,0,0,0.5)",display:"flex",flexDirection:"column",overflow:"hidden",border:"2px solid #d4af37"},header:{padding:"20px",background:"linear-gradient(135deg, #5d4037 0%, #3e2723 100%)",color:"#fff",display:"flex",justifyContent:"space-between",alignItems:"flex-start"},headerContent:{flex:1},stepIndicator:{display:"inline-block",background:"rgba(255, 255, 255, 0.2)",padding:"4px 12px",borderRadius:"12px",fontSize:"12px",marginBottom:"8px"},title:{margin:0,fontSize:"20px",fontWeight:"bold"},skipBtn:{background:"transparent",border:"1px solid rgba(255, 255, 255, 0.5)",color:"#fff",padding:"6px 12px",borderRadius:"4px",cursor:"pointer",fontSize:"13px",transition:"all 0.3s"},progressBar:{width:"100%",height:"4px",background:"#e0e0e0"},progressFill:{height:"100%",background:"linear-gradient(90deg, #d4af37 0%, #f4e4a6 100%)",transition:"width 0.3s ease"},content:{flex:1,padding:"30px",overflowY:"auto",fontSize:"14px",lineHeight:"1.8"},contentText:{color:"#333"},footer:{padding:"15px 20px",borderTop:"1px solid #e0e0e0",background:"#fff",display:"flex",justifyContent:"space-between",gap:"10px"},prevBtn:{padding:"10px 20px",background:"#9e9e9e",color:"#fff",border:"none",borderRadius:"6px",cursor:"pointer",fontSize:"14px",fontWeight:"bold",transition:"all 0.3s"},nextBtn:{padding:"10px 24px",background:"linear-gradient(135deg, #d4af37 0%, #f4e4a6 100%)",color:"#3e2723",border:"none",borderRadius:"6px",cursor:"pointer",fontSize:"14px",fontWeight:"bold",transition:"all 0.3s",boxShadow:"0 2px 8px rgba(212, 175, 55, 0.4)"}},xl=[{id:"INTRO",title:"  ()",content:`
      <p><strong></strong><strong></strong></p>
      <p><strong></strong></p>
      <ul>
        <li><strong></strong></li>
        <li><strong></strong></li>
        <li><strong></strong><strong></strong></li>
        <li><strong></strong></li>
      </ul>
    `},{id:"FEEDBACK",title:"  ()",content:`
      <p><strong></strong></p>
      <div style="background:#eee; padding:10px; border-radius:5px; margin:10px 0;">
        <strong></strong><br/>
            <strong></strong>  <strong></strong>
      </div>
      <p><strong></strong></p>
      <ul>
        <li> <strong>/</strong> (10%)</li>
        <li> <strong></strong> (50%)</li>
        <li> <strong></strong> (100%)</li>
      </ul>
      
      <p><strong style="color:#D32F2F;"> ()</strong></p>
      <div style="background:#fff3e0; padding:12px; border-radius:5px; margin:10px 0; border-left: 4px solid #FF9800;">
        <p style="margin:0 0 8px 0;"><strong></strong></p>
        <ul style="margin:5px 0; padding-left:20px;">
          <li> <strong></strong>1.0 ()</li>
          <li> <strong></strong>1.5 (+50%)</li>
          <li> <strong></strong>3.0 (+200%)</li>
          <li> <strong></strong>6.0 (+500%)</li>
          <li> <strong></strong>12.0 (+1100%)</li>
          <li> <strong></strong>25.0 (+2400%)</li>
          <li> <strong></strong>100.0 (<strong style="color:#D32F2F;">+9900%</strong>)</li>
        </ul>
      </div>
      
      <p><strong></strong>""""100</p>
      <ol style="background:#f5f5f5; padding:12px; border-radius:5px;">
        <li></li>
        <li></li>
        <li><strong></strong></li>
        <li>""</li>
      </ol>
    `},{id:"COMBAT",title:" ",content:`
      <p><strong></strong><strong></strong></p>
      <ul>
        <li><strong></strong></li>
        <li><strong></strong> <strong>100</strong> </li>
        <li><strong></strong> <strong>HP()</strong>  <strong>ATK()</strong></li>
      </ul>
      <p><strong></strong><br/>1. <strong></strong><br/>2. </p>
    `},{id:"ROOTS",title:" ",content:`
      <p>6</p>
      <ul>
        <li><span style="color:#FFD700"> (90-100)</span></li>
        <li><span style="color:#00BCD4"> (80-89)</span>//</li>
        <li><span style="color:#9C27B0">/</span></li>
        <li><span style="color:#9E9E9E">/</span></li>
      </ul>
    `}],E5=({onClose:e,initialTab:t=0})=>{const[n,s]=y.useState(t);return r.jsx("div",{style:Hn.overlay,children:r.jsxs("div",{style:Hn.modalWrapper,children:[r.jsx("button",{onClick:e,style:Hn.closeBtn,"aria-label":"",children:""}),r.jsxs("div",{style:Hn.modal,children:[r.jsx("div",{style:Hn.header,children:r.jsx("h3",{children:" "})}),r.jsxs("div",{style:Hn.body,children:[r.jsx("div",{style:Hn.sidebar,children:xl.map((o,i)=>r.jsx("div",{onClick:()=>s(i),style:{...Hn.menuItem,background:n===i?"#e0e0e0":"transparent",fontWeight:n===i?"bold":"normal",color:n===i?"#3e2723":"#666"},children:o.title},o.id))}),r.jsxs("div",{style:Hn.content,children:[r.jsx("h4",{style:{marginTop:0,borderBottom:"1px solid #eee",paddingBottom:"10px"},children:xl[n].title}),r.jsx("div",{style:{lineHeight:"1.6",fontSize:"14px",color:"#444"},dangerouslySetInnerHTML:{__html:xl[n].content}})]})]}),r.jsx("div",{style:Hn.footer,children:n<xl.length-1?r.jsx("button",{onClick:()=>s(n+1),style:Hn.nextBtn,children:""}):r.jsx("button",{onClick:e,style:Hn.finishBtn,children:""})})]})]})})},Hn={overlay:{position:"fixed",top:0,left:0,right:0,bottom:0,background:"rgba(0,0,0,0.7)",zIndex:3e3,display:"flex",alignItems:"center",justifyContent:"center"},modalWrapper:{position:"relative",width:"min(600px, calc(100vw - 32px))"},modal:{width:"100%",height:"450px",background:"#fff",borderRadius:"12px",display:"flex",flexDirection:"column",overflow:"hidden",boxShadow:"0 10px 30px rgba(0,0,0,0.3)",position:"relative"},header:{padding:"15px 20px",background:"#3e2723",color:"#fff",display:"flex",justifyContent:"center",alignItems:"center"},closeBtn:{position:"absolute",top:"-18px",left:"-18px",background:"#3e2723",border:"none",color:"#fff",fontSize:"22px",cursor:"pointer",width:"44px",height:"44px",display:"flex",alignItems:"center",justifyContent:"center",borderRadius:"22px",boxShadow:"0 12px 30px rgba(0,0,0,0.25)"},body:{flex:1,display:"flex",overflow:"hidden"},sidebar:{width:"180px",background:"#f5f5f5",borderRight:"1px solid #ddd",overflowY:"auto"},menuItem:{padding:"15px",cursor:"pointer",borderBottom:"1px solid #eee",fontSize:"13px"},content:{flex:1,padding:"20px",overflowY:"auto"},footer:{padding:"10px 20px",borderTop:"1px solid #eee",display:"flex",justifyContent:"flex-end",background:"#fafafa"},nextBtn:{padding:"8px 20px",background:"#2196f3",color:"white",border:"none",borderRadius:"4px",cursor:"pointer"},finishBtn:{padding:"8px 20px",background:"#4caf50",color:"white",border:"none",borderRadius:"4px",cursor:"pointer"}},j5=({gazette:e,onClose:t,history:n=[],playerName:s="",onWorldNpcClick:o})=>{var b;const[i,a]=y.useState("current"),[l,d]=y.useState(null);console.log("GazetteModal props:",{gazette:e,history:n,hasGazette:!!e,historyLength:n.length});const u=S=>{if(!S||!s)return S;const E=new RegExp(`(${s})`,"g");return S.split(E).map((x,h)=>x===s?r.jsx("span",{style:{color:"#b33",fontWeight:"bold"},children:x},h):x)};y.useEffect(()=>{!e&&n.length>0&&a("history")},[e,n]);const c=(i==="current"?e:l)||{issue:"-",year:0,month:"-",headlines:[],powerRanking:[],rumors:[]},f=!e&&n.length===0;return r.jsx("div",{style:$e.overlay,children:r.jsxs("div",{style:$e.modalWrapper,children:[r.jsx("button",{onClick:t,style:$e.closeBtn,"aria-label":"",children:""}),r.jsx("div",{style:$e.modal,children:f?r.jsxs("div",{style:$e.emptyState,children:[r.jsx("div",{style:$e.emptyIcon,children:""}),r.jsx("h3",{style:$e.emptyTitle,children:""}),r.jsx("p",{style:$e.emptyText,children:"36912"}),r.jsx("button",{onClick:t,style:$e.emptyBtn,children:""})]}):r.jsxs(r.Fragment,{children:[r.jsxs("div",{style:$e.tabBar,children:[r.jsx("button",{onClick:()=>a("current"),style:{...$e.tab,background:i==="current"?Se.colors.primary:Se.colors.parchment,color:i==="current"?"#fff":Se.colors.ink,opacity:e?1:.5,cursor:e?"pointer":"not-allowed"},disabled:!e,children:" "}),r.jsxs("button",{onClick:()=>a("history"),style:{...$e.tab,background:i==="history"?Se.colors.primary:Se.colors.parchment,color:i==="history"?"#fff":Se.colors.ink},children:["  (",n.length,")"]})]}),r.jsx("div",{style:$e.content,children:i==="current"?r.jsxs("div",{style:$e.newspaper,children:[r.jsxs("div",{style:$e.header,children:[r.jsx("h1",{style:$e.title,children:""}),r.jsxs("div",{style:$e.subtitle,children:["   ",c.issue," "]}),r.jsxs("div",{style:$e.date,children:[" ",c.year," ",c.month,""]})]}),c.powerRanking&&c.powerRanking.length>0&&r.jsxs("div",{style:$e.section,children:[r.jsx("h3",{style:$e.sectionTitle,children:" - "}),r.jsx("div",{style:$e.ranking,children:c.powerRanking.map((S,E)=>{const j=typeof S=="string"?S:S.displayText,x=typeof S=="object"&&S.worldNpcData&&!S.isPlayer;return r.jsx("div",{style:{...$e.rankItem,...x?$e.clickableRankItem:{}},onClick:()=>{x&&o&&o(S.worldNpcData)},children:j},E)})})]}),r.jsxs("div",{style:$e.section,children:[r.jsx("h3",{style:$e.sectionTitle,children:""}),r.jsx("div",{style:$e.newsContent,children:c.headlines&&c.headlines.length>0?c.headlines.map((S,E)=>r.jsxs("p",{style:$e.newsItem,children:[" ",u(S)]},E)):r.jsx("p",{style:$e.placeholder,children:""})})]}),c.rumors&&c.rumors.length>0&&r.jsxs("div",{style:$e.section,children:[r.jsx("h3",{style:$e.sectionTitle,children:""}),r.jsx("div",{style:$e.newsContent,children:c.rumors.map((S,E)=>r.jsxs("p",{style:$e.newsItem,children:[" ",u(S)]},E))})]}),r.jsxs("div",{style:$e.adSection,children:[r.jsx("div",{style:$e.ad,children:" "}),r.jsx("div",{style:$e.ad,children:" "})]})]}):r.jsx("div",{style:$e.historyView,children:n.length===0?r.jsx("div",{style:$e.emptyHistory,children:""}):l?r.jsxs("div",{children:[r.jsx("button",{onClick:()=>d(null),style:$e.backBtn,children:" "}),r.jsxs("div",{style:$e.newspaper,children:[r.jsxs("div",{style:$e.header,children:[r.jsx("h1",{style:$e.title,children:""}),r.jsxs("div",{style:$e.subtitle,children:[" ",l.issue," "]}),r.jsxs("div",{style:$e.date,children:[" ",l.year," ",l.month,""]})]}),r.jsxs("div",{style:$e.section,children:[r.jsx("h3",{style:$e.sectionTitle,children:""}),r.jsx("div",{style:$e.newsContent,children:(b=l.headlines)==null?void 0:b.map((S,E)=>r.jsxs("p",{style:$e.newsItem,children:[" ",S]},E))})]})]})]}):r.jsx("div",{style:$e.historyList,children:n.map((S,E)=>r.jsxs("div",{style:$e.historyItem,onClick:()=>d(S),children:[r.jsxs("div",{style:$e.historyTitle,children:[" ",S.issue," "]}),r.jsxs("div",{style:$e.historyDate,children:[Math.floor(S.year)," ",S.month,""]})]},E))})})})]})})]})})},$e={overlay:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0, 0, 0, 0.7)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e3},modalWrapper:{position:"relative",width:"min(800px, calc(100vw - 32px))"},modal:{background:Se.gradients.warm,borderRadius:"16px",maxWidth:"800px",width:"100%",maxHeight:"85vh",overflow:"hidden",position:"relative",boxShadow:"0 8px 32px rgba(0,0,0,0.3)",border:`3px solid ${Se.colors.border}`},closeBtn:{position:"absolute",top:"-20px",left:"-20px",width:"48px",height:"48px",borderRadius:"50%",border:"none",background:"#b33",color:"white",fontSize:"24px",cursor:"pointer",boxShadow:"0 12px 32px rgba(0,0,0,0.25)",fontWeight:"bold"},tabBar:{display:"flex",gap:"10px",padding:"15px 20px",borderBottom:`2px solid ${Se.colors.border}`},tab:{padding:"10px 20px",border:"none",borderRadius:"8px",cursor:"pointer",fontWeight:"bold",fontSize:"14px",transition:"all 0.3s"},content:{padding:"20px",maxHeight:"calc(85vh - 100px)",overflowY:"auto"},newspaper:{background:Se.colors.paper,padding:"30px",borderRadius:"8px",boxShadow:`inset 0 0 20px ${Se.colors.shadow}`,fontFamily:'"Noto Serif SC", "KaiTi", serif'},header:{textAlign:"center",borderBottom:`3px double ${Se.colors.border}`,paddingBottom:"20px",marginBottom:"25px"},title:{fontSize:"36px",color:Se.colors.primary,margin:"0 0 10px 0",letterSpacing:"8px",textShadow:"2px 2px 4px rgba(0,0,0,0.1)"},subtitle:{fontSize:"14px",color:Se.colors.primary,marginBottom:"5px"},date:{fontSize:"12px",color:Se.colors.muted},section:{marginBottom:"25px",padding:"15px",background:Se.gradients.subtle,borderRadius:"8px",border:`1px solid ${Se.colors.border}`},sectionTitle:{fontSize:"20px",color:Se.colors.primary,marginBottom:"15px",borderBottom:`2px solid ${Se.colors.border}`,paddingBottom:"8px"},ranking:{display:"flex",flexDirection:"column",gap:"10px"},rankItem:{fontSize:"16px",padding:"8px",background:Se.colors.paper,borderRadius:"4px",border:`1px solid ${Se.colors.border}`},clickableRankItem:{cursor:"pointer",transition:"all 0.3s",":hover":{background:Se.gradients.subtle,transform:"translateX(5px)",borderColor:Se.colors.primary}},newsContent:{fontSize:"15px",lineHeight:"1.8",color:Se.colors.ink},newsItem:{margin:"10px 0",paddingLeft:"15px",textIndent:"0"},placeholder:{color:"#999",fontStyle:"italic",textAlign:"center"},adSection:{marginTop:"30px",padding:"15px",background:Se.gradients.subtle,borderRadius:"8px",border:`2px dashed ${Se.colors.border}`},ad:{fontSize:"12px",color:Se.colors.primary,marginBottom:"5px"},historyView:{minHeight:"400px"},historyList:{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(150px, 1fr))",gap:"15px"},historyItem:{padding:"20px",background:Se.colors.paper,borderRadius:"8px",border:`2px solid ${Se.colors.border}`,cursor:"pointer",textAlign:"center",transition:"all 0.3s",":hover":{transform:"translateY(-5px)",boxShadow:`0 4px 12px ${Se.colors.shadow}`}},historyTitle:{fontSize:"16px",fontWeight:"bold",color:Se.colors.primary,marginBottom:"8px"},historyDate:{fontSize:"12px",color:Se.colors.primary},emptyHistory:{textAlign:"center",padding:"50px",color:"#999",fontSize:"16px"},backBtn:{marginBottom:"15px",padding:"8px 16px",background:"#8d6e63",color:"white",border:"none",borderRadius:"8px",cursor:"pointer",fontWeight:"bold"},emptyState:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",padding:"80px 40px",minHeight:"400px"},emptyIcon:{fontSize:"80px",marginBottom:"20px",opacity:.5},emptyTitle:{fontSize:"24px",color:Se.colors.primary,marginBottom:"10px"},emptyText:{fontSize:"14px",color:Se.colors.muted,textAlign:"center",lineHeight:"1.6",marginBottom:"30px"},emptyBtn:{padding:"10px 30px",background:Se.colors.primary,color:"white",border:"none",borderRadius:"8px",cursor:"pointer",fontSize:"14px",fontWeight:"bold",transition:"all 0.3s"}},C5=({worldNpc:e,onClose:t,onInvite:n,player:s})=>{var g,I,_;if(!e)return null;const[o,i]=y.useState(""),[a,l]=y.useState(""),[d,u]=y.useState(!1),p=C=>C==="male"||C===""?"":C==="female"||C===""?"":C,c=C=>C?typeof C=="string"?C:typeof C=="object"&&C.name?C.name:"":"",f=()=>{var k;if((k=e.appearance)!=null&&k.description&&typeof e.appearance.description=="string")return e.appearance.description;if(e.gender==="female"||e.gender===""){const R=["","","","",""];return R[Math.floor(Math.random()*R.length)]}else{const R=["","","","",""];return R[Math.floor(Math.random()*R.length)]}},b=y.useMemo(()=>f(),[e==null?void 0:e.id]),S=C=>{if(!C)return"";if(typeof C=="string")return C;if(typeof C=="object"){const k=[C.temperament,C.alignment,C.attitude].filter(Boolean);return k.length>0?k.join(""):""}return""},E=C=>{if(!C)return"";const k=C.rootType||C.type;return k||(Array.isArray(C.elements)&&C.elements.length>0?C.elements.map(R=>typeof R=="object"?R.element:R).join("")+"":"")},j=(C,k)=>{if(typeof C!="number")return"";const R=k==="female"||k==="";return C>=90?R?"":"":C>=80?R?"":"":C>=70?R?"":"":C>=60?"":""},x=y.useMemo(()=>e!=null&&e.id?`tianji_profile_${e.id}`:"",[e==null?void 0:e.id]),h=()=>{var se;const C=e.name||"",k=e.title||"",R=e.tier||"",T=c(e.sect),N=E(e.spiritRoot),Y=S(e.personality);j((se=e.stats)==null?void 0:se.looks,e.gender);const H=b,B=T===""?"":`${T}`,$=`${C}${R}${B}${k}${N}${H}${Y}${e.signature||""}`,q=`${C}${k}${R}${B}${N}${T===""?"":T}${Y}"${e.signature||""}"`;return{summary:$,bio:q}},v=(C,k)=>{if(!C)return k;const R=C.match(/\{[\s\S]*\}/);if(R)try{const N=JSON.parse(R[0]);if(N&&(N.summary||N.bio))return{summary:N.summary||k.summary,bio:N.bio||k.bio}}catch{}const T=C.split(`
`).map(N=>N.trim()).filter(Boolean);if(T.length>=2){const N=T[0].replace(/^[:]\s*/,""),Y=T.slice(1).join(`
`).replace(/^[:]\s*/,"");return{summary:N||k.summary,bio:Y||k.bio}}return{summary:C.trim().slice(0,80)||k.summary,bio:k.bio}};return y.useEffect(()=>{var H;if(!e)return;const C=h();try{if(x){const B=localStorage.getItem(x);if(B){const $=JSON.parse(B);if($!=null&&$.summary&&$.summary.includes(e.name)){i($.summary||C.summary),l($.bio||C.bio);return}}}}catch{}if(i(C.summary),l(C.bio),!(localStorage.getItem("useAIForTianjiProfile")!=="false")){try{x&&localStorage.setItem(x,JSON.stringify(C))}catch{}return}const R=localStorage.getItem("game_api_key")||"",T=localStorage.getItem("game_api_url")||"",N=localStorage.getItem("game_api_model")||"deepseek-chat";if(!R||!T)return;const Y={name:e.name,title:e.title||"",tier:e.tier,sect:c(e.sect),spiritRoot:E(e.spiritRoot),personality:S(e.personality),appearance:b,looks:((H=e.stats)==null?void 0:H.looks)||0,signature:e.signature||""};u(!0),Fc([{role:"system",content:`""""JSON{"summary":"...","bio":"..."}80160


1. nametitletier
2. name
3. """"
4. `},{role:"user",content:`
${Y.name}
${Y.title}
${Y.tier}
${Y.sect}
${Y.spiritRoot}
${Y.personality}
${Y.appearance}
${Y.signature}

"${Y.name}${Y.tier}""${Y.title}"`}],R,T,{model:N,temperature:.7,maxTokens:260}).then(B=>{const $=v(B,C),q=$.summary.includes(e.name)?$.summary:C.summary,se=$.bio.includes(e.name)?$.bio:C.bio;i(q),l(se);try{x&&localStorage.setItem(x,JSON.stringify({summary:q,bio:se}))}catch{}}).catch(()=>{i(C.summary),l(C.bio)}).finally(()=>u(!1))},[e,x]),e.gender!==s.gender&&e.hasMetPlayer,r.jsx("div",{style:Ue.overlay,onClick:t,children:r.jsxs("div",{style:Ue.modalWrapper,onClick:C=>C.stopPropagation(),children:[r.jsx("button",{onClick:t,style:Ue.closeBtn,"aria-label":"",children:""}),r.jsxs("div",{style:Ue.modal,children:[r.jsxs("div",{style:Ue.header,children:[r.jsxs("h2",{style:Ue.title,children:[e.title&&`${e.title}`,e.name]}),r.jsxs("div",{style:Ue.subtitle,children:["  ",e.tier,"  ",p(e.gender)]})]}),r.jsxs("div",{style:Ue.content,children:[r.jsxs("div",{style:Ue.section,children:[r.jsx("h3",{style:Ue.sectionTitle,children:" "}),r.jsxs("div",{style:Ue.infoGrid,children:[r.jsx(co,{label:"",value:e.name}),r.jsx(co,{label:"",value:e.title||""}),r.jsx(co,{label:"",value:p(e.gender)}),r.jsx(co,{label:"",value:e.tier}),r.jsx(co,{label:"",value:c(e.sect)}),r.jsx(co,{label:"",value:((g=e.spiritRoot)==null?void 0:g.rootType)||((I=e.spiritRoot)==null?void 0:I.type)||""})]})]}),r.jsxs("div",{style:Ue.section,children:[r.jsx("h3",{style:Ue.sectionTitle,children:" "}),r.jsx("div",{style:Ue.statsGrid,children:e.stats&&Object.entries(e.stats).map(([C,k])=>r.jsxs("div",{style:Ue.statItem,children:[r.jsx("span",{style:Ue.statLabel,children:T5(C)}),r.jsx("span",{style:Ue.statValue,children:Math.floor(k)})]},C))})]}),r.jsxs("div",{style:Ue.section,children:[r.jsx("h3",{style:Ue.sectionTitle,children:" "}),r.jsx("p",{style:Ue.description,children:b})]}),r.jsxs("div",{style:Ue.section,children:[r.jsx("h3",{style:Ue.sectionTitle,children:" "}),r.jsx("p",{style:Ue.description,children:o||""}),d&&r.jsx("div",{style:Ue.hintText,children:"AI "})]}),r.jsxs("div",{style:Ue.section,children:[r.jsx("h3",{style:Ue.sectionTitle,children:" "}),r.jsx("p",{style:Ue.description,children:a||""}),r.jsx("p",{style:Ue.hintText,children:"/ AI "})]}),e.personality&&typeof e.personality=="string"&&r.jsxs("div",{style:Ue.section,children:[r.jsx("h3",{style:Ue.sectionTitle,children:" "}),r.jsx("p",{style:Ue.description,children:e.personality})]}),((_=e.spiritRoot)==null?void 0:_.elements)&&Array.isArray(e.spiritRoot.elements)&&r.jsxs("div",{style:Ue.section,children:[r.jsx("h3",{style:Ue.sectionTitle,children:" "}),r.jsx("div",{style:Ue.elementsGrid,children:e.spiritRoot.elements.map((C,k)=>r.jsx("div",{style:Ue.elementTag,children:typeof C=="object"?`${C.element} ${C.value}`:C},k))})]}),e.gender!==s.gender&&!e.hasMetPlayer&&(e.gender==="male"||e.gender==="")&&r.jsxs("div",{style:Ue.hintBox,children:[r.jsx("div",{style:Ue.hintIcon,children:""}),r.jsx("p",{style:Ue.hintText,children:""})]}),e.hasMetPlayer&&r.jsx("div",{style:Ue.metHint,children:" "})]})]})]})})},co=({label:e,value:t})=>{const n=typeof t=="object"&&t!==null?JSON.stringify(t):t??"";return r.jsxs("div",{style:Ue.infoItem,children:[r.jsxs("span",{style:Ue.infoLabel,children:[e,""]}),r.jsx("span",{style:Ue.infoValue,children:n})]})},T5=e=>({attack:"",defense:"",speed:"",hp:"",cultivation:"",atk:"",def:"",spd:"",maxHp:"",aptitude:"",looks:"",intelligence:"",health:""})[e]||e,Ue={overlay:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0, 0, 0, 0.7)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:2e3},modalWrapper:{position:"relative",width:"min(600px, calc(100vw - 32px))",maxHeight:"85vh"},modal:{background:Se.gradients.warm,borderRadius:"16px",width:"100%",maxHeight:"85vh",overflow:"hidden",boxShadow:"0 8px 32px rgba(0,0,0,0.3)",border:`3px solid ${Se.colors.border}`},closeBtn:{position:"absolute",top:"-20px",right:"-20px",width:"48px",height:"48px",borderRadius:"50%",border:"none",background:"#b33",color:"white",fontSize:"24px",cursor:"pointer",boxShadow:"0 4px 12px rgba(0,0,0,0.3)",fontWeight:"bold",zIndex:1},header:{textAlign:"center",padding:"25px 20px",background:"linear-gradient(135deg, #8d6e63 0%, #6d4c41 100%)",color:"white",borderBottom:`3px solid ${Se.colors.border}`},title:{fontSize:"24px",margin:"0 0 8px 0",fontWeight:"bold",textShadow:"2px 2px 4px rgba(0,0,0,0.3)"},subtitle:{fontSize:"14px",opacity:.9},content:{padding:"20px",maxHeight:"calc(85vh - 120px)",overflowY:"auto"},section:{marginBottom:"20px",padding:"15px",background:Se.colors.paper,borderRadius:"8px",border:`1px solid ${Se.colors.border}`},sectionTitle:{fontSize:"16px",color:Se.colors.primary,marginBottom:"12px",paddingBottom:"8px",borderBottom:`2px solid ${Se.colors.border}`},infoGrid:{display:"grid",gridTemplateColumns:"repeat(2, 1fr)",gap:"10px"},infoItem:{fontSize:"14px",padding:"5px"},infoLabel:{color:"#666",marginRight:"5px"},infoValue:{color:Se.colors.ink,fontWeight:"bold"},statsGrid:{display:"grid",gridTemplateColumns:"repeat(3, 1fr)",gap:"10px"},statItem:{display:"flex",flexDirection:"column",alignItems:"center",padding:"10px",background:Se.gradients.subtle,borderRadius:"6px"},statLabel:{fontSize:"12px",color:"#666",marginBottom:"5px"},statValue:{fontSize:"18px",fontWeight:"bold",color:Se.colors.primary},description:{fontSize:"14px",lineHeight:"1.6",color:Se.colors.ink},elementsGrid:{display:"flex",flexWrap:"wrap",gap:"8px"},elementTag:{padding:"6px 12px",background:"linear-gradient(135deg, #fff9e6 0%, #ffe5b4 100%)",border:"1px solid #d4a574",borderRadius:"12px",fontSize:"13px",fontWeight:"bold",color:"#8d6e63"},hintBox:{textAlign:"center",padding:"20px",background:"linear-gradient(135deg, #fff9e6 0%, #ffe5b4 100%)",borderRadius:"12px",border:"2px dashed #d4a574"},hintIcon:{fontSize:"32px",marginBottom:"10px"},hintText:{fontSize:"14px",color:"#8d6e63",lineHeight:"1.6",margin:0},metHint:{textAlign:"center",padding:"15px",background:"#e8f5e9",border:"1px solid #81c784",borderRadius:"8px",color:"#2e7d32",fontSize:"14px",fontWeight:"bold"}},I5=({selectedNpc:e,setSelectedNpc:t,handleOptionSelect:n,player:s,visibleChildren:o,visibleNpcs:i,activeNpcs:a,modalMgr:l,addLog:d,showResult:u,cutTiesWithNpc:p,handleToggleNpcLetterAcceptance:c,messages:f,messageManager:b,setMessages:S,handleSendMessageReply:E,combatData:j,handleCombatClose:x,isExploring:h,exploreRealmState:v,exploreProgress:g,currentExploreEvent:I,exploreLog:_,inventory:C,setExploreLog:k,handleExplorationOption:R,handleStartCombat:T,setExploreProgress:N,setCurrentExploreEvent:Y,setIsExploring:H,getBossEvent:B,getRandomExplorationEvent:$,pendingSectChoices:q,setPendingSectChoices:se,handleAssignSect:J,handleCloseTutorial:X,handleCompleteTutorial:re,handleCloseGuide:ye,currentGazette:Re,setSelectedWorldNpc:Fe,selectedWorldNpc:O,handleInviteWorldNpc:ie})=>{var le;return r.jsxs(r.Fragment,{children:[e&&r.jsx(LE,{npc:e,onClose:()=>t(null),onOptionSelect:n,player:s,children:o,npcs:i,onViewLog:ee=>l.openNpcLog(ee),onCutTies:ee=>{const he=a.find(Ee=>Ee.id===ee);he&&(p(ee),t(null),d(`  ${he.name} `),u("",` ${he.name} `,!0))},onToggleLetterAcceptance:c}),l.npcLogModal.open&&l.npcLogModal.npc&&r.jsx(y5,{npc:l.npcLogModal.npc,playerAffection:((le=l.npcLogModal.npc.relationship)==null?void 0:le.affection)||0,onClose:()=>l.closeNpcLog()}),r.jsx(Yj,{isOpen:l.showMessageCenter,onClose:()=>l.closeMessageCenter(),messages:f,onMarkAsRead:ee=>{b.markAsRead(ee),S(b.getAllMessages())},onDeleteMessage:ee=>{b.deleteMessage(ee),S(b.getAllMessages())},onSendReply:E}),j&&r.jsx(b5,{player:s,enemy:j.enemy,result:j.result,onClose:x}),h&&r.jsx(S5,{open:h,realmName:v.name,progress:g,total:v.total,event:I,log:_,optionContext:{player:s,inventory:C,realmId:v.id,progress:g},onSelectOption:R,onStartCombat:T,onNext:()=>{if(g>=v.total){k(Ee=>[...Ee,""]),H(!1),u("","",!0,null,!1);return}const ee=g+1;N(ee);const he=ee===v.total?B(v.id):$({realmId:v.id,progress:ee});Y(he),k(Ee=>[...Ee,` (${ee}/${v.total})`])},onClose:()=>{H(!1),k(ee=>[...ee,""])}}),q.length>0&&r.jsx(w5,{event:q[0],onClose:()=>se(ee=>ee.slice(1)),onAssign:J}),l.showTutorial&&r.jsx(k5,{onClose:X,onComplete:re}),l.showGuide&&r.jsx(E5,{onClose:ye}),l.showGazette&&r.jsx(j5,{gazette:Re,history:s.gazetteHistory||[],playerName:s.name,onClose:()=>l.closeGazette(),onWorldNpcClick:ee=>{Fe(ee)}}),O&&r.jsx(C5,{worldNpc:O,player:s,onClose:()=>Fe(null),onInvite:ie})]})};class _5 extends wc.Component{constructor(n){super(n);j0(this,"handleReset",()=>{this.setState({hasError:!1,error:null,errorInfo:null})});this.state={hasError:!1,error:null,errorInfo:null}}static getDerivedStateFromError(n){return{hasError:!0}}componentDidCatch(n,s){console.error("[] :",n),console.error("[] :",s),this.setState({error:n,errorInfo:s})}render(){var n;return this.state.hasError?r.jsxs("div",{style:{padding:"20px",margin:"20px",backgroundColor:"#ffebee",border:"2px solid #f44336",borderRadius:"8px",textAlign:"center",fontFamily:"Arial, sans-serif"},children:[r.jsx("h2",{style:{color:"#c62828",margin:"0 0 12px 0"},children:" "}),r.jsx("p",{style:{color:"#d32f2f",margin:"8px 0",fontSize:"14px"},children:((n=this.state.error)==null?void 0:n.message)||""}),!1,r.jsx("button",{onClick:this.handleReset,style:{marginTop:"12px",padding:"8px 16px",backgroundColor:"#2196f3",color:"#fff",border:"none",borderRadius:"4px",cursor:"pointer",fontSize:"14px",fontWeight:"bold"},children:" "})]}):this.props.children}}const R5=({options:e,currentSort:t,onSortChange:n})=>{const s=o=>{typeof n=="function"?n(o):console.warn("SortBar: onSortChange is not a function",{onSortChange:n,value:o})};return r.jsxs("div",{style:Ni.container,children:[r.jsx("span",{style:Ni.label,children:" :"}),r.jsx("div",{style:Ni.buttonGroup,children:e.map(o=>r.jsx("button",{type:"button",onClick:()=>s(o.value),style:{...Ni.button,...t===o.value?Ni.buttonActive:{}},children:o.label},o.value))})]})},Ni={container:{display:"flex",alignItems:"center",justifyContent:"flex-end",padding:"5px 10px",marginBottom:"10px",background:"#f5f5f5",borderRadius:"4px",fontSize:"12px"},label:{color:"#666",marginRight:"8px",fontWeight:"bold"},buttonGroup:{display:"flex",gap:"6px",flexWrap:"wrap"},button:{border:"1px solid #ccc",borderRadius:"999px",padding:"4px 10px",fontSize:"12px",cursor:"pointer",backgroundColor:"white",color:"#333",transition:"all 0.2s ease"},buttonActive:{backgroundColor:"#1976d2",color:"#fff",borderColor:"#1976d2",boxShadow:"0 2px 6px rgba(25,118,210,0.4)"}};function M5({player:e,inventory:t,children:n,exploreRealmState:s,exploreProgress:o,exploreTeamIds:i,setPlayer:a,setExploreLog:l,setCombatData:d,addNpc:u,addItemsToInventory:p,inventoryMgr:c,calculateDynamicCombatStats:f,simulateCombat:b,generateRealmEnemy:S}){const E=y.useCallback(()=>{var C,k;const _=Tf(e);if(!_.canExplore){if(((C=e.stats)==null?void 0:C.health)<20)return l(R=>[...R,` ${Math.floor(e.stats.health)}/100`]),!1;((k=e.stats)==null?void 0:k.health)<30&&l(R=>[...R,` 30${Math.floor(e.stats.health)}/100`])}return _.canExplore},[e,l]),j=y.useCallback(_=>{if(!E())return;const C={player:e,inventory:t,realmId:s.id,progress:o};if(_.condition&&!_.condition(C)){l(R=>[...R,""]);return}const k=_.action?_.action(C):{type:"LOG",msg:""};switch(k.type){case"START_COMBAT":x();break;case"LOOT":h(k);break;case"NPC_JOIN":v(k);break;case"HP_CHANGE":g(k);break;case"EXP_GAIN":I(k);break;case"LOG":case"NONE":default:l(R=>[...R,k.msg||""]);break}},[e,t,s.id,o,l]),x=y.useCallback(()=>{const _=S(s.id,o),C={...e,combatStats:e.combatStats||{maxHp:100,maxMp:50,atk:10,def:5,hp:100,mp:50}},k=i.map(T=>n.find(N=>N.id===T)).filter(Boolean).map(T=>({...T,combatStats:T.combatStats||{maxHp:100,maxMp:50,atk:10,def:5,hp:100,mp:50}})),R=b(C,_,k);d({enemy:_,result:R,context:"exploration"})},[e,n,i,s.id,o,S,b,d]),h=y.useCallback(_=>{const k=p(_.items||[]).map(T=>T.name).filter(Boolean).join(", "),R=[];_.msg&&R.push(_.msg),k&&R.push(`${k}`),R.length>0&&l(T=>[...T,...R])},[p,l]),v=y.useCallback(_=>{if(u(_.npc,_.msg),_.removeItemId){const C=t.find(k=>k.id===_.removeItemId);C&&c.removeItemFromInventory(C.instanceId,C.stackable?1:void 0)}l(C=>[...C,_.msg||""])},[u,t,c,l]),g=y.useCallback(_=>{const C=_.hpDelta||0;if(C<0){const k=Math.abs(C),R=Wo(e,k,"EXPLORATION");a(N=>({...N,stats:{...N.stats,health:R.newHealth}}));const T=[];T.push(R.message),_.msg&&_.msg!==""&&T.push(_.msg),l(N=>[...N,...T])}else a(k=>{var R,T;return{...k,stats:{...k.stats,health:Math.max(1,Math.min(100,(((R=k.stats)==null?void 0:R.health)||50)+Math.floor(C/(((T=k.combatStats)==null?void 0:T.maxHp)||100)*100)))}}}),l(k=>[...k,_.msg||(C<0?"":"")])},[e,a,l]),I=y.useCallback(_=>{a(C=>{const k={...C,currentExp:(C.currentExp||0)+(_.amount||0)};return{...k,combatStats:f(k)}}),l(C=>[...C,_.msg||""])},[a,f,l]);return{handleExplorationOption:j,handleStartCombat:x,checkExplorationHealth:E}}function A5({player:e,children:t,exploreRealmState:n,applyCombatResult:s,addLog:o,setCombatData:i,setExploreLog:a,batchUpdateChildren:l,archiveChildDeaths:d,addItemsToInventory:u,setIsExploring:p}){const c=y.useCallback(j=>{if(!j)return;const{success:x,remainingHp:h}=j.result;if((j.context||"rival")==="rival"){f(x,h),i(null);return}x?b(j):S(j),i(null)},[e,t,n]),f=y.useCallback((j,x)=>{var h;if(j){const v=Math.floor((1-x/(((h=e.combatStats)==null?void 0:h.maxHp)||100))*100),g=Math.max(5,Math.floor(v/5));s({won:!0,spiritStones:500,healthDamage:g,injurySource:"DUEL"}),o("  500 ")}else{const v=Wo(e,40,"DUEL");s({won:!1,expGain:-e.currentExp,spiritStones:-Math.floor(e.resources.spiritStones*.5),health:v.newHealth}),o(` ...
`+v.message)}},[e,s,o]),b=y.useCallback(j=>{var _,C;const x=((_=j.enemy)==null?void 0:_.drops)||[],h=(C=j.enemy)==null?void 0:C.isBoss;let v=[];if(x.length){const k=h?2+Math.floor(Math.random()*2):1;for(let R=0;R<k&&R<x.length;R++){const T=x[Math.floor(Math.random()*x.length)];v.push(T)}}const g=v.length?u(v):[],I=g.length?`${g.map(k=>k.name).join(", ")}`:"";if(a(h?k=>[...k,` ${I}`]:k=>[...k,`${I}`]),j.result.party&&Array.isArray(j.result.party)){const k=[];j.result.party.forEach(R=>{R.currentHp<=0&&k.push({id:R.id,name:R.name,deathReason:`${n.name}`})}),k.length>0&&E(k)}},[u,a,n.name]),S=y.useCallback(j=>{const x=Wo(e,35,"EXPLORATION");if(a(h=>[...h,"",x.message," ..."]),s({won:!1,expGain:-e.currentExp,spiritStones:-Math.floor(e.resources.spiritStones*.5),health:x.newHealth}),j.result.party&&Array.isArray(j.result.party)){const h=[];j.result.party.forEach(v=>{var I;const g=v.currentHp/(((I=v.combatStats)==null?void 0:I.maxHp)||100);(g<=0||g<.3&&Math.random()<.5)&&h.push({id:v.id,name:v.name,deathReason:`${n.name}`})}),h.length>0&&E(h)}p(!1)},[e,a,n.name,p,s,l]),E=y.useCallback(j=>{const x=j.map(v=>v.id);l(v=>x.includes(v.id)?null:v),j.forEach(v=>{const g=t.find(I=>I.id===v.id);g&&(d([{...g,deathReason:v.deathReason}],t),o(` ${v.name} ${v.deathReason} ${Math.floor(g.age||0)} `))});const h=j.map(v=>v.name).join("");a(v=>[...v,` ${h} `])},[t,l,d,o,a]);return{handleCombatClose:c}}function N5({player:e,inventory:t,activeNpcs:n,modalState:s,setModalState:o,removeItemFromInventory:i,updateNpc:a,setActiveNpcs:l,batchUpdateNpcsByMap:d,setSelectedNpc:u,showResult:p,addLog:c,handleWitnessCheck:f,pushToNewsBuffer:b,isUsageAllowedForTarget:S,RESOURCE_USAGE:E,formatUsageTargets:j}){const x=y.useCallback(I=>{var he,Ee,_e,rt,At;const _=s.data;if(!_){console.warn("No NPC found in modalState.data");return}const C=Array.isArray(I)?I:I?[{instanceId:I.instanceId,quantity:I.quantity||1}]:[];if(C.length===0){p("","",!1,null,!1,{category:"",type:"GIFT",title:"",message:"",details:"",forceManual:!0});return}const k={common:5,uncommon:10,rare:20,epic:35,legendary:50},R=_.identity==="",T=_.identity==="",N=_.identity==="";let Y=0,H=0,B=0,$=0;const q=[],se=[],J=[];if(C.forEach(({instanceId:Oe,quantity:P})=>{const pe=t.find(Xt=>Xt.instanceId===Oe);if(!pe||!S(pe,E.NPC))return;const fe=pe.quantity||1,ke=Math.max(1,Math.min(fe,parseInt(P,10)||1));i(pe.instanceId,pe.stackable?ke:void 0);const je={...pe};let Ge=k[je.rarity]||5;je.type==="consumable"&&(Ge+=5),(je.type==="weapon"||je.type==="armor")&&(Ge+=3),(R||T||N)&&(je.rarity==="common"||je.rarity==="uncommon")&&(Ge=0);const _t=Math.min(Ge,50)*ke;if(Y+=_t,q.push(`${je.name} x${ke}`),se.push(` ${je.name} x${ke} +${_t}`),je.type==="consumable"&&je.effect){const Xt=je.effect||{},dr=(Xt.amount||0)*ke;Xt.kind==="exp"&&(H+=dr),Xt.kind==="aptitude"&&(B+=dr),Xt.kind,Xt.kind==="heal"&&($+=dr)}}),Y<=0){p("","",!1,null,!1,{category:"",type:"GIFT",title:"",message:"",details:"",forceManual:!0});return}const X=_.gender===""?"":"",re=Y>15?"":Y>8?"":"",ye=` ${q.join("")}  ${_.name}${X}${re}`,Re=C.length===1&&q.length===1?((he=xj(_,t.find(Oe=>Oe.instanceId===C[0].instanceId)))==null?void 0:he.description)||ye:`${ye}

${se.join(`
`)}`,Fe=_.relationship||{affection:0,trust:0};let O={..._,relationship:{...Fe,affection:Math.min(100,(Fe.affection||0)+Y)}},ie=null;if(H>0){const Oe=Cn(O.tier||""),P=O.maxExp||(Oe==null?void 0:Oe.maxExp)||0;if(O={...O,currentExp:(O.currentExp||0)+H,maxExp:P||O.maxExp},O.combatStats=Vn(O),J.push(`${_.name} +${H}`),ie={...ie||{},:H},O.maxExp&&O.currentExp>=O.maxExp){const pe=Ly(O,e,e.time.year,e.time.month);O=pe.npc,O.combatStats=Vn(O),pe.events&&pe.events.length>0&&J.push(pe.events[0].message)}}if(B>0){try{O=Rf(O,Math.min(100,(((Ee=O.stats)==null?void 0:Ee.aptitude)||50)+B))}catch{O={...O,stats:{...O.stats,aptitude:Math.min(100,(((_e=O.stats)==null?void 0:_e.aptitude)||50)+B)}}}O.combatStats=Vn(O),J.push(`${_.name} +${B}`),ie={...ie||{},:B}}if($>0){const Oe=Math.min(100,(((rt=O.stats)==null?void 0:rt.health)||100)+$);O={...O,stats:{...O.stats,health:Oe}},J.push(`${_.name} +${$}`),ie={...ie||{},:$}}const le=q.join("");O=ik(O,e,Math.floor(e.age),e.time.month,le),O=Pi(O),Jr.onReceiveGift(O,{name:le},Y),a(_.id,O);const ee=J.length>0?`${Re}

${J.join("")}`:Re;p("",ee,!0,{:Y,...ie||{}},!1,{category:"",type:"GIFT",title:`-${_.name}`,message:`${_.name}`,details:ee,forceManual:!0}),f(_,"GIFT"),((At=_.relationship)==null?void 0:At.affection)>=60&&Math.random()<.3&&b(e.newsBuffer,"NPC_PURSUIT",{actor:e.name,target:_.name}),o({type:null,data:null})},[s,t,e,i,a,p,f,b,o,S,E]),h=y.useCallback(I=>{var Y,H,B;const _=s.data;if(!_){console.warn("No NPC found in modalState.data");return}const C=_.identity==="",k=(_.dualCultivationCount||0)>0;if(C&&!k){const $=`${_.name}"..."`;p("",$,!1,null,!1);return}let R=((Y=_.relationship)==null?void 0:Y.affection)||0;I.strongAgainst.includes(((H=_.personality)==null?void 0:H.label)||"")?R+=30:I.weakAgainst.includes(((B=_.personality)==null?void 0:B.label)||"")&&(R-=20);const T=Math.random()*100<R,N=Mj(_,I,T);if(T){const $=dk(_,e,Math.floor(e.age),e.time.month);Jr.onPregnancyStart($),l(q=>q.map(se=>se.id===_.id?{...$,isPregnant:!0,pregnancyProgress:0}:se)),p("",N,!0,null,!1)}else p("",N,!1,null,!1)},[s,e,l,p]),v=y.useCallback((I,_)=>{let C=_;_.check&&(C=_.check(e)?_.success:_.fail);const k=(C==null?void 0:C.change)||{},R=(C==null?void 0:C.result)||_.result,T=n.find(Y=>Y.id===I);if(T){const Y=T.relationship||{affection:0,trust:0,jealousy:0,stage:0},H={...Y};k.affection!==void 0&&(H.affection=Math.min(100,Math.max(0,(H.affection||0)+k.affection))),k.trust!==void 0&&(H.trust=Math.min(100,Math.max(0,(H.trust||0)+k.trust))),k.jealousy!==void 0&&(H.jealousy=Math.min(100,Math.max(0,(H.jealousy||0)+k.jealousy)));let B=Y.stage||0;if(k.stageUp){const $=H.affection||0;$>=80?B=3:$>=50?B=2:$>=20?B=1:B=0}a(I,{relationship:{...H,stage:B}})}const N=(C==null?void 0:C.msg)||"";c(`${N}`),p("",N,R==="good",{:k.affection||0,:k.trust||0,:k.jealousy||0},!1),u(null)},[e,n,a,c,p,u]),g=y.useCallback(I=>{const _=s.data;if(!_)return;const C=Fj(_,I,e),k=new Map;C.changes.forEach(R=>{var se,J,X;const T=n.find(re=>re.id===R.npcId);if(!T)return;const N=((se=T.relationship)==null?void 0:se.jealousy)||0,Y=((J=T.relationship)==null?void 0:J.affection)||0,H=Math.min(100,Math.max(0,N+R.jealousyChange)),B=Math.min(100,Math.max(0,Y+R.affectionChange)),$=(X=C.npcLogs)==null?void 0:X.find(re=>re.npcId===T.id);let q={...T,relationship:{...T.relationship,jealousy:H,affection:B}};if($){const re=q.logs||[],ye={year:e.time.year,month:e.time.month,content:$.content,type:$.type||"DAILY",isSecret:$.isSecret||!1,timestamp:Date.now()};q={...q,logs:[ye,...re].slice(0,50)}}k.set(R.npcId,q)}),d(k),c(` ${C.message}`),p("",C.message,!0,{},!1),o({type:null,data:null})},[s,e,n,d,c,p,o]);return{handleGiftConfirm:x,handleNegotiateConfirm:h,handleOptionSelect:v,handleShuraFieldSelect:g}}function L5({player:e,onBreakthroughClick:t}){const n=Math.min(100,e.currentExp/e.maxExp*100),s=Math.min(100,(e.energy||0)/20*100),o=e.currentExp>=e.maxExp&&e.maxExp>0;return r.jsxs("div",{style:yr.cultivationSection,children:[r.jsxs("div",{style:yr.expContainer,children:[r.jsx("div",{style:yr.expLabel,children:""}),r.jsxs("div",{style:yr.expBar,children:[r.jsx("div",{style:{...yr.expBarFill,width:`${n}%`,background:o?"linear-gradient(90deg, #ff6f00 0%, #ff8f00 100%)":"linear-gradient(90deg, #76ff03 0%, #64dd17 100%)"}}),r.jsxs("span",{style:yr.expText,children:[e.currentExp," / ",e.maxExp]})]}),r.jsxs("div",{style:{marginTop:8},children:[r.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:6},children:[r.jsx("div",{style:{fontSize:12,color:"#666"},children:""}),r.jsxs("div",{style:yr.energyText,children:[e.energy||0," / 20"]})]}),r.jsx("div",{style:yr.energyBar,children:r.jsx("div",{style:{...yr.energyFill,width:`${s}%`}})})]})]}),o&&r.jsx("button",{onClick:t,style:yr.breakthroughBtn,children:" "})]})}const yr={cultivationSection:{display:"flex",alignItems:"center",gap:"15px",padding:"15px 20px",background:"linear-gradient(135deg, #ffffff 0%, #f5f5f5 100%)",borderBottom:"2px solid #e0e0e0",boxShadow:"0 2px 4px rgba(0,0,0,0.05)"},expContainer:{flex:1,minWidth:0},expLabel:{fontSize:"13px",fontWeight:"600",color:"#555",marginBottom:"6px"},expBar:{position:"relative",height:"24px",background:"#e0e0e0",borderRadius:"12px",overflow:"hidden",boxShadow:"inset 0 2px 4px rgba(0,0,0,0.1)"},expBarFill:{position:"absolute",top:0,left:0,height:"100%",transition:"width 0.3s ease, background 0.3s ease",boxShadow:"0 0 8px rgba(118, 255, 3, 0.4)"},expText:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",fontSize:"11px",fontWeight:"700",color:"#333",textShadow:"0 1px 2px rgba(255,255,255,0.8)",zIndex:1},energyBar:{position:"relative",height:"14px",background:"#e0e0e0",borderRadius:"7px",overflow:"hidden",boxShadow:"inset 0 1px 3px rgba(0,0,0,0.1)"},energyFill:{height:"100%",background:"linear-gradient(90deg, #29b6f6 0%, #0288d1 100%)",borderRadius:"7px",transition:"width 0.3s ease",boxShadow:"0 0 6px rgba(41, 182, 246, 0.3)"},energyText:{fontSize:"11px",color:"#666",fontWeight:"500"},breakthroughBtn:{padding:"10px 20px",background:"linear-gradient(135deg, #ff6f00 0%, #ff8f00 100%)",color:"white",border:"none",borderRadius:"8px",fontSize:"14px",fontWeight:"600",cursor:"pointer",boxShadow:"0 4px 8px rgba(255, 111, 0, 0.3)",transition:"all 0.2s",animation:"pulse 2s infinite",whiteSpace:"nowrap"}};function $5({player:e,visibleChildren:t,pregnantNpcs:n,fallenChildren:s,exiledChildren:o=[],onChildClick:i,onToggleFavorite:a,onMemorialClick:l,generation3Plus:d=[]}){return r.jsxs("div",{style:Gh.tabContent,children:[r.jsx(HE,{player:e,children:t,pregnantNpcs:n,fallenChildren:s,exiledChildren:o,onChildClick:i,onToggleFavorite:a,onMemorialClick:l,generation3Plus:d}),r.jsxs("div",{style:Gh.statsBar,children:[": ",t.length+1," | : ",t.filter(u=>u.generation>1).length]})]})}const Gh={tabContent:{flex:1,overflow:"auto",background:"#fafafa"},statsBar:{padding:"15px",textAlign:"center",fontSize:"13px",color:"#555",borderTop:"1px dashed #e0e0e0",marginTop:"15px"}};function B5({isAuto:e,autoSpeed:t,player:n,messageUnreadCount:s,onToggleAuto:o,onSetAutoSpeed:i,onNextMonth:a,onOpenGazette:l,onOpenMessageCenter:d,onMarkGazetteRead:u}){return r.jsxs(r.Fragment,{children:[r.jsxs("div",{style:Wn.fabContainer,children:[e&&r.jsxs("div",{style:Wn.speedSelector,children:[r.jsx("button",{onClick:()=>i(.3),style:{...Wn.speedBtn,backgroundColor:t===.3?"#4CAF50":"#e0e0e0",color:t===.3?"white":"#666"},children:"0.3"}),r.jsx("button",{onClick:()=>i(1),style:{...Wn.speedBtn,backgroundColor:t===1?"#4CAF50":"#e0e0e0",color:t===1?"white":"#666"},children:"1"}),r.jsx("button",{onClick:()=>i(3),style:{...Wn.speedBtn,backgroundColor:t===3?"#4CAF50":"#e0e0e0",color:t===3?"white":"#666"},children:"3"})]}),r.jsx("button",{onClick:o,style:{...Wn.autoBtn,backgroundColor:e?"#76ff03":"#e0e0e0",color:e?"#33691e":"#757575"},children:e?" ":" "}),r.jsx("button",{onClick:()=>a(!1),style:{...Wn.fabBtn,transform:e?"scale(0.9)":"scale(1)",opacity:e?.8:1},disabled:e,children:e?r.jsx("div",{style:Wn.spinner,children:""}):r.jsxs(r.Fragment,{children:[r.jsx("span",{style:{fontSize:"18px"},children:""}),r.jsx("span",{style:{fontSize:"9px"},children:""})]})})]}),r.jsxs("button",{onClick:()=>{l(),u()},style:Wn.gazetteBtn,title:"",children:["",n.hasUnreadGazette&&r.jsx("span",{style:Wn.redDot})]}),r.jsxs("button",{onClick:d,style:Wn.messageCenterBtn,title:" - ",children:["",s>0&&r.jsx("span",{style:Wn.redDot,children:s})]})]})}const Wn={fabContainer:{position:"fixed",bottom:"76px",right:"20px",display:"flex",flexDirection:"column",alignItems:"flex-end",gap:"12px",zIndex:99},speedSelector:{display:"flex",gap:"6px",padding:"8px",background:"rgba(255,255,255,0.95)",borderRadius:"20px",boxShadow:"0 4px 12px rgba(0,0,0,0.15)"},speedBtn:{padding:"6px 12px",border:"none",borderRadius:"12px",fontSize:"12px",fontWeight:"600",cursor:"pointer",transition:"all 0.2s",minWidth:"45px"},autoBtn:{padding:"10px 18px",border:"none",borderRadius:"20px",fontSize:"13px",fontWeight:"600",cursor:"pointer",boxShadow:"0 4px 12px rgba(0,0,0,0.15)",transition:"all 0.2s"},fabBtn:{width:"60px",height:"60px",borderRadius:"50%",border:"none",background:"linear-gradient(135deg, #8b7355 0%, #a0826d 100%)",color:"#fff",fontSize:"14px",fontWeight:"600",cursor:"pointer",boxShadow:"0 6px 20px rgba(139, 115, 85, 0.3)",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",gap:"2px",transition:"all 0.2s"},spinner:{fontSize:"24px",animation:"spin 2s linear infinite"},gazetteBtn:{position:"fixed",bottom:"76px",left:"20px",width:"50px",height:"50px",borderRadius:"50%",border:"none",background:"linear-gradient(135deg, #8b6f47 0%, #a0916f 100%)",color:"#fff",fontSize:"24px",cursor:"pointer",boxShadow:"0 4px 12px rgba(139, 111, 71, 0.3)",zIndex:99,transition:"all 0.2s"},messageCenterBtn:{position:"fixed",bottom:"136px",left:"20px",width:"50px",height:"50px",borderRadius:"50%",border:"none",background:"linear-gradient(135deg, #c9b5a0 0%, #d4c9c1 100%)",color:"#4a3728",fontSize:"24px",cursor:"pointer",boxShadow:"0 4px 12px rgba(201, 181, 160, 0.3)",zIndex:99,transition:"all 0.2s"},redDot:{position:"absolute",top:"0",right:"0",width:"18px",height:"18px",background:"#f44336",color:"white",borderRadius:"50%",fontSize:"10px",fontWeight:"700",display:"flex",alignItems:"center",justifyContent:"center",border:"2px solid white",boxShadow:"0 2px 4px rgba(0,0,0,0.2)"}},O5=[{value:"DEFAULT",label:" ()"},{value:"AFFECTION_DESC",label:" ()"},{value:"APTITUDE_DESC",label:" ()"},{value:"TRUST_DESC",label:" ()"}],P5=({sortedNpcs:e,pagedNpcs:t,deadNpcs:n,npcSort:s,npcPage:o,npcPageCount:i,hasNpcPagination:a,showFollowedOnly:l,onExplore:d,onSortChange:u,onToggleFollowedOnly:p,onPrevPage:c,onNextPage:f,onNpcInteract:b,onNpcAction:S})=>r.jsxs("div",{style:{padding:"15px",maxWidth:"800px",margin:"0 auto",paddingBottom:"80px"},children:[r.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"15px"},children:[r.jsxs("h2",{style:{margin:0,color:"#5d4037"},children:[" ",e.length,""]}),r.jsx("button",{onClick:d,style:{padding:"8px 16px",backgroundColor:"#8d6e63",color:"white",border:"none",borderRadius:"8px",cursor:"pointer",fontSize:"14px"},children:" "})]}),r.jsxs("div",{style:{marginBottom:"15px"},children:[r.jsx(R5,{options:O5,currentSort:s,onSortChange:u}),r.jsx("div",{style:{marginTop:"10px"},children:r.jsxs("label",{style:{fontSize:"14px",color:"#666",cursor:"pointer",userSelect:"none"},children:[r.jsx("input",{type:"checkbox",checked:l,onChange:E=>p(E.target.checked),style:{marginRight:"6px"}})," NPC"]})})]}),r.jsxs("div",{children:[t.length===0?r.jsx("div",{style:{textAlign:"center",padding:"40px",color:"#999",fontSize:"14px"},children:""}):r.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(280px, 1fr))",gap:"12px"},children:t.map(E=>r.jsx(kh,{npc:E,onInteract:(j,x)=>{S?S(j,x):x==="DETAIL"&&b(E)}},E.id))}),a&&r.jsxs("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",gap:"15px",marginTop:"20px"},children:[r.jsx("button",{onClick:c,disabled:o===0,style:{padding:"8px 16px",border:"1px solid #ccc",borderRadius:"8px",backgroundColor:o===0?"#f5f5f5":"white",cursor:o===0?"not-allowed":"pointer",fontSize:"14px"},children:""}),r.jsxs("span",{style:{fontSize:"14px",color:"#666"},children:[" ",o+1," / ",i," "]}),r.jsx("button",{onClick:f,disabled:o>=i-1,style:{padding:"8px 16px",border:"1px solid #ccc",borderRadius:"8px",backgroundColor:o>=i-1?"#f5f5f5":"white",cursor:o>=i-1?"not-allowed":"pointer",fontSize:"14px"},children:""})]})]}),n.length>0&&r.jsxs("div",{style:{marginTop:"30px"},children:[r.jsxs("h3",{style:{color:"#999",fontSize:"16px",marginBottom:"15px"},children:[" ",n.length,""]}),r.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(280px, 1fr))",gap:"12px",opacity:.6},children:n.map(E=>r.jsx(kh,{npc:E,actions:r.jsx("button",{onClick:()=>b(E),style:{width:"100%",padding:"8px",border:"1px solid #ccc",borderRadius:"6px",backgroundColor:"#f5f5f5",color:"#999",cursor:"pointer",fontSize:"14px"},children:""})},E.id))})]})]}),z5=({player:e,children:t,showBizPanel:n,showChallengePanel:s,idleManagerOptions:o,onDailyAction:i,onShopping:a,onOpenInventory:l,onBuyBusiness:d,onExploreRealm:u,onOpenAuction:p,onCloseBizPanel:c,onCloseChallengePanel:f,onOpenBizPanel:b,onOpenChallengePanel:S})=>{const E=((e.time.year-3572)*12+e.time.month)%36===0;return r.jsx("div",{style:{padding:"15px",maxWidth:"800px",margin:"0 auto",paddingBottom:"80px"},children:n?r.jsxs("div",{children:[r.jsx("button",{onClick:c,style:{padding:"8px 16px",marginBottom:"15px",border:"1px solid #ccc",borderRadius:"8px",backgroundColor:"white",cursor:"pointer",fontSize:"14px"},children:" "}),r.jsx(aC,{player:e,children:t,managerOptions:o,onBuy:d})]}):s?r.jsxs("div",{children:[r.jsx("button",{onClick:f,style:{padding:"8px 16px",marginBottom:"15px",border:"1px solid #ccc",borderRadius:"8px",backgroundColor:"white",cursor:"pointer",fontSize:"14px"},children:" "}),r.jsx(lC,{player:e,children:t,onChallenge:u})]}):r.jsxs("div",{children:[r.jsx("h2",{style:{margin:"0 0 20px 0",color:"#5d4037"},children:""}),r.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"10px",marginBottom:"30px"},children:[r.jsx("button",{onClick:()=>i("CULTIVATE"),style:{padding:"12px 20px",border:"none",borderRadius:"8px",backgroundColor:"#8d6e63",color:"white",cursor:"pointer",fontSize:"16px",fontWeight:"bold"},children:" (+10-15)"}),r.jsx("button",{onClick:()=>i("WORK"),style:{padding:"12px 20px",border:"none",borderRadius:"8px",backgroundColor:"#8d6e63",color:"white",cursor:"pointer",fontSize:"16px",fontWeight:"bold"},children:" (+15)"}),r.jsx("button",{onClick:a,style:{padding:"12px 20px",border:"none",borderRadius:"8px",backgroundColor:"#8d6e63",color:"white",cursor:"pointer",fontSize:"16px",fontWeight:"bold"},children:" (-10)"}),r.jsx("button",{onClick:()=>l("SELL"),style:{padding:"12px 20px",border:"none",borderRadius:"8px",backgroundColor:"#8d6e63",color:"white",cursor:"pointer",fontSize:"16px",fontWeight:"bold"},children:" ()"})]}),r.jsxs("div",{style:{marginTop:"30px",borderTop:"1px dashed #ccc",paddingTop:"20px"},children:[r.jsx("h3",{style:{margin:"0 0 15px 0",color:"#5d4037"},children:" "}),r.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(140px, 1fr))",gap:"15px"},children:[r.jsxs("button",{onClick:b,style:{padding:"20px",border:"2px solid #8d6e63",borderRadius:"12px",backgroundColor:"white",cursor:"pointer",display:"flex",flexDirection:"column",alignItems:"center",gap:"10px",transition:"all 0.2s"},children:[r.jsx("div",{style:{fontSize:"36px"},children:""}),r.jsx("div",{style:{fontSize:"14px",fontWeight:"bold",color:"#5d4037"},children:""})]}),r.jsxs("button",{onClick:S,style:{padding:"20px",border:"2px solid #8d6e63",borderRadius:"12px",backgroundColor:"white",cursor:"pointer",display:"flex",flexDirection:"column",alignItems:"center",gap:"10px",transition:"all 0.2s"},children:[r.jsx("div",{style:{fontSize:"36px"},children:""}),r.jsx("div",{style:{fontSize:"14px",fontWeight:"bold",color:"#5d4037"},children:""})]}),r.jsxs("button",{onClick:p,style:{padding:"20px",border:"2px solid #8d6e63",borderRadius:"12px",backgroundColor:"white",cursor:"pointer",display:"flex",flexDirection:"column",alignItems:"center",gap:"10px",transition:"all 0.2s",opacity:E?1:.6},children:[r.jsx("div",{style:{fontSize:"36px"},children:""}),r.jsx("div",{style:{fontSize:"14px",fontWeight:"bold",color:"#5d4037"},children:""}),r.jsx("div",{style:{fontSize:"10px",color:"#999"},children:""})]})]})]})]})})},Vh=["","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","",""],D5=["","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","",""],F5=["","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","",""],Yh=["","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","",""],qh=["","","","","","","","","","","","","","","","","","","",""];function a1(e){const t=Vh[Math.floor(Math.random()*Vh.length)],n=e==="male"?D5:F5;if(Math.random()>.3){const o=n[Math.floor(Math.random()*n.length)],i=n[Math.floor(Math.random()*n.length)];return t+o+i}else{const o=n[Math.floor(Math.random()*n.length)];return t+o}}function l1(e){const t=Yh[Math.floor(Math.random()*Yh.length)],n=qh[Math.floor(Math.random()*qh.length)];if(e.includes("")||e.includes("")){const s=["","","","",""];return s[Math.floor(Math.random()*s.length)]+n}else if(e.includes("")||e.includes("")){const s=["","","","",""];return s[Math.floor(Math.random()*s.length)]+n}return t+n}function H5(e=30){const t=[],n=new Set,s={:Math.floor(e*.03),:Math.floor(e*.03),:Math.floor(e*.04),:Math.floor(e*.05),:Math.floor(e*.05),:Math.floor(e*.07),:Math.floor(e*.07),:Math.floor(e*.1),:Math.floor(e*.1),:Math.floor(e*.13),:Math.floor(e*.16),:Math.floor(e*.17)};let o=1;return["","","","","","","","","","","",""].forEach(a=>{const l=s[a]||1;for(let d=0;d<l;d++){const u=Math.random()>.7?"female":"male";let p,c=0;do p=a1(u),c++;while(n.has(p)&&c<100);n.has(p)&&(p=p+o),n.add(p);const f=l1(a);let b=null;if(Math.random()>.3){const C=ns.filter(k=>k.id!=="SECT_NONE");b=C[Math.floor(Math.random()*C.length)]}const S=Ve.findIndex(C=>C.name===a);if(S===-1){console.error(`: ${a}`);return}const E=Ve[S],x=E.maxExp*2*(.8+Math.random()*.4),v=Math.random()<.8?90+Math.floor(Math.random()*11):80+Math.floor(Math.random()*10),g=Yo(v),I=50+Math.floor(Math.random()*50),_={id:`world_npc_${o}`,name:p,title:f,gender:u,tier:a,tierIndex:S,sect:b?{id:b.id,name:b.name}:null,status:"ALIVE",location:"Unknown",hasMetPlayer:!1,firstMetYear:null,currentExp:Math.floor(Math.random()*E.maxExp*.8)+E.maxExp*.2,maxExp:E.maxExp,stats:{aptitude:v,looks:I,intelligence:60+Math.floor(Math.random()*40),health:80},spiritRoot:g,combatPower:Math.floor(x),age:30+(Ve.length-S)*50+Math.floor(Math.random()*100),personality:c1(),signature:d1(a),appearance:{description:u1(u,a,I)},relationships:{allies:[],enemies:[],disciples:[]},majorEvents:[`${f}`],lastActiveYear:3572};t.push(_),o++}}),W5(t),t}function c1(){const e=[["","","","",""],["","","","",""],["","","","",""]];return{temperament:e[0][Math.floor(Math.random()*e[0].length)],alignment:e[1][Math.floor(Math.random()*e[1].length)],attitude:e[2][Math.floor(Math.random()*e[2].length)]}}function d1(e){const t={:["","","",""],:["","","",""],:["","","",""],:["","","",""],:["","","",""],:["","","",""]},n=t[e]||t.;return n[Math.floor(Math.random()*n.length)]}function u1(e,t,n=60){const s=Number.isFinite(n)?n:60,o={high:["","",""],mid:["","",""],low:["","",""]},i={high:["","",""],mid:["","",""],low:["","",""]},a=s>=85?"high":s>=60?"mid":"low",l=e==="male"?o[a]:i[a];return l[Math.floor(Math.random()*l.length)]}function W5(e){const t=e.filter(s=>["","",""].includes(s.tier));e.filter(s=>["",""].includes(s.tier)).forEach(s=>{if(Math.random()>.5&&t.length>0){const o=t[Math.floor(Math.random()*t.length)];o.sect&&s.sect&&o.sect.id===s.sect.id&&(o.relationships.disciples.push(s.id),s.majorEvents.push(`${o.name}`))}});for(let s=0;s<Math.min(5,e.length/3);s++){const o=e[Math.floor(Math.random()*e.length)],i=e[Math.floor(Math.random()*e.length)];o.id!==i.id&&!o.relationships.enemies.includes(i.id)&&Math.abs(o.tierIndex-i.tierIndex)<=2&&(o.relationships.enemies.push(i.id),i.relationships.enemies.push(o.id),o.majorEvents.push(`${i.name}`),i.majorEvents.push(`${o.name}`))}}function Kh(e,t){const n=e.map(i=>{if(i.status==="DEAD")return i;const a={...i};a.age=(i.age||100)+1;const l=Ve.findIndex(S=>S.name===i.tier);if(l===-1)return console.warn(`: ${i.tier}`),i;const d=1/Math.max(1,l*.5),u=Math.floor(i.maxExp*.05*d*(.8+Math.random()*.4));a.currentExp=Math.min(i.maxExp,i.currentExp+u);const p=a.currentExp>=a.maxExp,c=Math.max(.02,.1-l*.01);if(p&&Math.random()<c&&l<Ve.length-1){const S=l+1,E=Ve[S].name;a.tier=E,a.tierIndex=S,a.currentExp=0,a.maxExp=Ve[S].maxExp,a.combatPower=Math.floor(a.combatPower*1.5),a.majorEvents.push(`${t}${E}`)}const b=.005/Math.max(1,l*.3);if(Math.random()<b){a.status="DEAD",a.deathYear=t;const S=["","","","",""];a.deathReason=S[Math.floor(Math.random()*S.length)],a.majorEvents.push(`${t}${a.deathReason}`)}return a.lastActiveYear=t,a}),s=n.filter(i=>i.status==="DEAD"&&i.deathYear===t).length,o=[];for(let i=0;i<s;i++)if(Math.random()<.2){const a=Math.random()>.5?"male":"female",l=a1(a),d=l1(""),u=Ve.findIndex(b=>b.name===""),p=Ve[u],c=55+Math.floor(Math.random()*40),f={id:`world_npc_new_${t}_${i}`,name:l,title:d,gender:a,tier:"",tierIndex:u,sect:null,status:"ALIVE",location:"Unknown",hasMetPlayer:!1,firstMetYear:null,currentExp:Math.floor(p.maxExp*.5),maxExp:p.maxExp,combatPower:Math.floor(p.maxExp*1.5),age:50+Math.floor(Math.random()*50),stats:{aptitude:80+Math.floor(Math.random()*16),looks:c,intelligence:60+Math.floor(Math.random()*30),health:80},personality:c1(),signature:d1(""),appearance:{description:u1(a,"",c)},relationships:{allies:[],enemies:[],disciples:[]},majorEvents:[`${t}`],lastActiveYear:t};o.push(f)}return[...n,...o]}const Bf=[{id:"dawn_breaker",name:"",epithet:"",element:"",basePrice:2600,desc:"",auctionFlavor:"",blessing:""},{id:"dusk_ember",name:"",epithet:"",element:"",basePrice:2750,desc:"",auctionFlavor:"",blessing:""},{id:"frost_pulse",name:"",epithet:"",element:"",basePrice:2900,desc:"",auctionFlavor:"",blessing:""},{id:"abyssal_flare",name:"",epithet:"",element:"",basePrice:3100,desc:"",auctionFlavor:"",blessing:""}],U5=[{key:"sword_saint",name:"",alias:"",gender:"",identity:"",tier:"",expRatio:.86,age:230,stats:{aptitude:98,looks:92,intelligence:90,health:95},baseAffection:45,baseTrust:25,spiritRoot:{type:"",elements:["",""],color:"#8ad3ff",desc:""},constitutionKey:"fumo_frost_thunder_body",inheritance:{bloodline:"",desc:""},cultivationMethod:"wanjian_heart",personality:{label:"",tag:"",desc:""},appearance:"",desc:"",title:"",trait:{name:"",desc:""},likes:["",""],dislikes:[""],world:{rankHint:"",combatPower:36e4,location:""}},{key:"demon_sage",name:"",alias:"",gender:"",identity:"",tier:"",expRatio:.78,age:210,stats:{aptitude:96,looks:95,intelligence:93,health:90},baseAffection:50,baseTrust:28,spiritRoot:{type:"",elements:["",""],color:"#ff7c8a",desc:""},constitutionKey:"fumo_abyssal_flame_core",inheritance:{bloodline:"",desc:""},cultivationMethod:"wanmo_heart",personality:{label:"",tag:"",desc:""},appearance:"",desc:"",title:"",trait:{name:"",desc:""},likes:["",""],dislikes:[""],world:{rankHint:"",combatPower:345e3,location:""}}],mu=Bf.length,hu=U5,Qh=e=>Bf.find(t=>t.id===e),wp=(e=[])=>{const t=new Set(e||[]);return Bf.filter(n=>!t.has(n.id))},G5=e=>e?{id:`FUMO_${e.id}_${Date.now()}`,type:"FUMO_SWORD",swordId:e.id,name:e.name,basePrice:e.basePrice,description:`${e.epithet}  ${e.desc}`,rarity:"legendary",plot:e.auctionFlavor}:null,V5=e=>e?{instanceId:`fumo_sword_${e.id}_${Date.now()}`,name:e.name,type:"weapon",rarity:"legendary",desc:`${e.epithet}  ${e.desc}

${e.blessing}`,tags:["",""],bound:!0,effect:{kind:"artifact",stat:"atk",amount:800}}:null,Y5=e=>{var i;if(!e)return null;const t=Cn(e.tier)||{maxExp:12e4},n=Math.floor((e.expRatio||.8)*t.maxExp),s=e.constitution?Nl(e.constitution):e.constitutionKey?vy(e.constitutionKey):null,o={id:`legend_${e.key}`,name:e.name,alias:e.alias,gender:e.gender,identity:e.identity,title:e.title,tier:e.tier,currentExp:n,maxExp:t.maxExp,stats:{...e.stats},spiritRoot:e.spiritRoot?{...e.spiritRoot}:null,cultivationMethod:e.cultivationMethod,constitution:s,personality:e.personality,appearance:e.appearance,desc:e.desc,trait:e.trait,likes:e.likes,dislikes:e.dislikes,relationship:{stage:0,affection:e.baseAffection??40,trust:e.baseTrust??20,jealousy:10},logs:[],status:"AVAILABLE",customFlags:{isFumoLegend:!0,legendKey:e.key,inheritanceTag:(i=e.inheritance)==null?void 0:i.bloodline}};return o.combatStats=Vn(o),o},q5=(e,t)=>{var o,i,a,l;if(!e)return null;const n=Ve.findIndex(d=>d.name===e.tier),s=Cn(e.tier)||{maxExp:12e4};return{id:`world_${e.key}`,name:e.name,title:e.title||e.identity,gender:e.gender===""?"female":"male",tier:e.tier,tierIndex:n>=0?n:Ve.length-1,status:"ALIVE",location:((o=e.world)==null?void 0:o.location)||"",hasMetPlayer:!0,firstMetYear:t,currentExp:Math.floor((e.expRatio||.8)*s.maxExp),maxExp:s.maxExp,combatPower:((i=e.world)==null?void 0:i.combatPower)||s.maxExp*2,age:e.age||200,personality:e.personality,appearance:{description:e.appearance},relationships:{allies:[],enemies:[],disciples:[]},majorEvents:[`${t}${e.name} `],lastActiveYear:t,customFlags:{isFumoLegend:!0,legendKey:e.key,rankHint:(a=e.world)==null?void 0:a.rankHint,inheritanceTag:(l=e.inheritance)==null?void 0:l.bloodline}}},K5=["","",""],Q5=e=>e[Math.floor(Math.random()*e.length)],kp=Object.values(Q).reduce((e,t)=>(e[t.key]=t.order,e),{}),J5={common:80,uncommon:160,rare:420,epic:900,legendary:2200},X5=e=>{const t=kp[e.resourceLevel]||1,n=J5[e.rarity]||300;return Math.floor(n*(1+t*.55))},Jh=Object.values(Pc).filter(e=>e.resourceLevel&&kp[e.resourceLevel]>=2).map(e=>{var t;return{itemId:e.id,name:e.name,description:e.desc,rarity:e.rarity,resourceLevel:e.resourceLevel,resourceOrder:kp[e.resourceLevel]||1,basePrice:X5(e),type:e.type,plot:`${e.source||""}${((t=Q[e.resourceLevel])==null?void 0:t.label)||""}`}}),Xh=(e,t={})=>{const{ownedFumoSwords:n=[],soldAuctionItems:s=[]}=t,o=3+Math.floor(Math.random()*3),i=[],a=()=>{if(!Jh.length)return null;const c=Jh.map(S=>({entry:S,weight:Math.max(1,10-S.resourceOrder*2)})),f=c.reduce((S,{weight:E})=>S+E,0);let b=Math.random()*f;for(const{entry:S,weight:E}of c)if(b-=E,b<=0)return S;return c[c.length-1].entry};for(let c=0;c<o;c++){const f=a();f&&!s.includes(f.itemId)&&i.push({id:`ITEM_${Date.now()}_${c}`,type:"ITEM",itemId:f.itemId,name:f.name,basePrice:f.basePrice,description:f.description||`${f.name}`,resourceLevel:f.resourceLevel,rarity:f.rarity,plot:f.plot})}if(Math.random()<.5){const c=Q5(K5)+uw(),f=150+Math.floor(Math.random()*300);i.push({id:`SLAVE_${Date.now()}_${Math.floor(Math.random()*999)}`,type:"SLAVE",name:c,basePrice:f,description:"",plot:""})}const d=wp(n).filter(c=>!s.includes(c.id));if(d.length>0){const c=Math.random()<.25?2:1,f=[...d];for(let b=0;b<c&&f.length>0;b++){const S=Math.floor(Math.random()*f.length),E=f.splice(S,1)[0],j=G5(E);j&&i.push(j)}}const u=` ${e} `,p=` ${i.length} `;return{title:u,message:p,items:i}},Z5=(e,t,n=[])=>{const s=t.combatStats||{maxHp:100,maxMp:50},o=a=>{const l=a.combatStats||{maxHp:100,maxMp:50,atk:10,def:5};return{...a,combatStats:l,currentHp:l.maxHp,currentMp:l.maxMp,isDefending:!1}},i=[o(e),...n.map(o)];return{player:i[0],party:i,enemy:{...t,currentHp:s.maxHp,currentMp:s.maxMp,combatStats:s},turn:0,logs:[],result:null}},eT=(e,t,n=null)=>{const{party:s,enemy:o}=e,i=[...e.logs];let a=s.map(S=>({...S})),l={...o},d=null;const u=e.turn+1;i.push(`===  ${u}  ===`);for(let S=0;S<a.length;S++){const E=a[S];if(E.currentHp<=0)continue;const j=tT(E,l,t);if(a[S]=j.player,l=j.enemy,i.push(...j.logs),l.currentHp<=0)return i.push(`${l.name} `),d="win",{party:a,player:a[0],enemy:l,turn:u,logs:i,result:d}}if(a.filter(S=>S.currentHp>0).length===0)return i.push(""),d="lose",{party:a,player:a[0],enemy:l,turn:u,logs:i,result:d};const c=a.findIndex(S=>S.currentHp>0),f=nT(l,a[c]);return l=f.enemy,a[c]=f.player,i.push(...f.logs),a.some(S=>S.currentHp>0)?{party:a,player:a[0],enemy:l,turn:u,logs:i,result:d}:(i.push(""),d="lose",{party:a,player:a[0],enemy:l,turn:u,logs:i,result:d})},tT=(e,t,n,s)=>{var i,a,l;const o=[];switch(n){case"attack":const d=gu(e,t);t.currentHp-=d,t.currentHp=Math.max(0,Math.floor(t.currentHp)),o.push(`${e.name}  ${t.name}  ${d} `),o.push(`${t.name}  HP: ${t.currentHp}/${((i=t.combatStats)==null?void 0:i.maxHp)||0}`);break;case"defend":e.isDefending=!0,o.push(`${e.name} `);break;case"skill":const u=Math.floor(gu(e,t)*1.5);t.currentHp-=u,t.currentHp=Math.max(0,Math.floor(t.currentHp)),e.currentMp-=50,o.push(`${e.name}  ${t.name}  ${u} `),o.push(`${t.name}  HP: ${t.currentHp}/${((a=t.combatStats)==null?void 0:a.maxHp)||0}`);break;default:const p=gu(e,t);t.currentHp-=p,t.currentHp=Math.max(0,Math.floor(t.currentHp)),o.push(`${e.name}  ${t.name}  ${p} `),o.push(`${t.name}  HP: ${t.currentHp}/${((l=t.combatStats)==null?void 0:l.maxHp)||0}`)}return{player:e,enemy:t,logs:o}},nT=(e,t)=>{var c,f,b;const n=[],s=((c=e.combatStats)==null?void 0:c.atk)||10,o=((f=t.combatStats)==null?void 0:f.def)||5,i=s-Math.floor(o/2),a=Math.max(1,i),l=t.isDefending?Math.floor(a*.5):a,d=i<=0,u=t.isDefending&&l<a,p=d||u?"":"";return t.currentHp-=l,t.isDefending=!1,t.currentHp=Math.max(0,Math.floor(t.currentHp)),n.push(`${e.name}  ${t.name}  ${l} ${p}`),n.push(`${t.name}  HP: ${t.currentHp}/${((b=t.combatStats)==null?void 0:b.maxHp)||0}`),{enemy:e,player:t,logs:n}},gu=(e,t)=>{var a,l;const n=((a=e.combatStats)==null?void 0:a.atk)||10,s=((l=t.combatStats)==null?void 0:l.def)||5,o=n-Math.floor(s/2);return Math.max(1,o)},xu=(e,t,n=[])=>{let s=Z5(e,t,n);for(;!s.result;)s=eT(s,"attack");return{success:s.result==="win",logs:s.logs,remainingHp:s.player.currentHp,party:s.party}},yl=10,Zh=60,eg=e=>e?typeof e=="string"?{contextMessage:e}:e:{},tg=(e=3572,t=1)=>{const n=Math.max(1,Math.min(12,t||1));return(e-3572)*12+n},rT={[ft.PLAYER]:"",[ft.CHILD]:"",[ft.NPC]:""},p1=e=>e&&Array.isArray(e.usageTargets)&&e.usageTargets.length>0?e.usageTargets:by,uo=e=>p1(e).map(n=>rT[n]||b2[n]||n).join(""),_s=(e,t)=>e?p1(e).includes(t):!1,sT=()=>`log-${Date.now()}-${Math.random().toString(16).slice(2)}`,oT=[{id:"init-log-1",turn:0,message:"",category:"",type:null,title:null,details:null},{id:"init-log-2",turn:0,message:"",category:"",type:null,title:null,details:null},{id:"init-log-3",turn:0,message:"",category:"",type:null,title:null,details:null}],iT=Eo!=null&&Eo.avatar?{...Eo.avatar}:{base:0,skinColor:0,hair:1,hairColor:0,eye:0,eyeColor:1,mouth:0},ng=e=>!e||typeof e!="object"?!1:["hair","hairId","faceId","eye","tZoneId"].some(t=>typeof e[t]<"u"&&e[t]!==null),aT=250,yu="forcePortraitUI",rg=()=>typeof window>"u"?!0:window.innerHeight>=window.innerWidth,lT=e=>e?!!(e.status==="DEAD"||e.state==="DEAD"||e.isDeceased||e.deathYear||e.deathReason||typeof e.lifespan=="number"&&e.lifespan<=0||typeof e.health=="number"&&e.health<=0||typeof e.currentHp=="number"&&e.currentHp<=0):!1;function cT(){var n0,r0,s0,o0,i0,a0,l0,c0,d0,u0,p0;const e=y2(),{modalState:t,setModalState:n,openModal:s,closeModal:o}=e,i=y.useCallback(m=>{m.type===null?o():s(m.type,m.data)},[s,o]),a=S2(),{inventory:l,addItemsToInventory:d,removeItemFromInventory:u}=a,p=ow(),{player:c,setPlayer:f,updatePlayer:b,addResources:S,consumeResources:E,consumeEnergy:j,purchaseBusiness:x,applyCombatResult:h,updateWorldNpc:v,clearNewsBuffer:g,addToSpecialCollection:I}=p,_=rE(),{activeNpcs:C,deadNpcs:k,selectedNpc:R,selectedWorldNpc:T,visibleNpcs:N,setActiveNpcs:Y,setDeadNpcs:H,setSelectedNpc:B,setSelectedWorldNpc:$,updateNpc:q,addNpc:se,toggleNpcFollow:J,batchUpdateNpcs:X,replaceAllNpcs:re,batchUpdateNpcsByMap:ye,cutTiesWithNpc:Re}=_,Fe=sE(),{children:O,fallenChildren:ie,selectedChild:le,enhancedChildren:ee,setChildren:he,setFallenChildren:Ee,setSelectedChild:_e,updateChild:rt,removeChild:At,toggleChildFavorite:Oe,batchUpdateChildren:P,replaceAllChildren:pe,batchUpdateChildrenIf:fe}=Fe,[ke,je]=y.useState(!0),[Ge,Jt]=y.useState(!0),[_t,Xt]=y.useState("PROLOGUE");y.useEffect(()=>{const m=Uy();console.log(":",m?"":"")},[]),y.useMemo(()=>Ty.map(m=>{var w;const M=(w=m.stats)==null?void 0:w.aptitude;return typeof M=="number"?{...m,spiritRoot:Yo(M)}:m}),[]);const[dr,wa]=y.useState(()=>rg()),[Ks,Qo]=y.useState(()=>typeof window>"u"?!1:localStorage.getItem(yu)==="true"),Pn=y.useMemo(()=>{const m=((c==null?void 0:c.exiledChildren)||[]).map(M=>M.id);return ee.filter(M=>!m.includes(M.id))},[ee,c==null?void 0:c.exiledChildren]),Zt=y.useMemo(()=>[...Pn].sort((m,M)=>{var A,L;const w=m.age-M.age;if(w!==0)return w;const F=(((A=M.stats)==null?void 0:A.aptitude)||0)-(((L=m.stats)==null?void 0:L.aptitude)||0);return F!==0?F:m.name.localeCompare(M.name,"zh-CN")}),[Pn]),Uc=y.useMemo(()=>Pn.filter(m=>m.age>=16&&!m.job).map(m=>{var M;return{id:m.id,name:m.name,age:Math.max(16,Math.floor(m.age||0)),gender:m.gender,tierTitle:m.tierTitle||"",intelligence:((M=m.stats)==null?void 0:M.intelligence)??0}}).sort((m,M)=>(M.intelligence??0)-(m.intelligence??0)),[Pn]),ur=y.useMemo(()=>{var m;return[...((m=c.specialCollections)==null?void 0:m.fumoSwords)||[]]},[(n0=c.specialCollections)==null?void 0:n0.fumoSwords]),ka=y.useMemo(()=>wp(ur),[ur]),Ea=y.useMemo(()=>{var m,M;return(m=c.specialFlags)!=null&&m.fumoDuoMet?!1:(M=c.specialFlags)!=null&&M.fumoDuoUnlocked?!0:mu>0&&ka.length===0},[(r0=c.specialFlags)==null?void 0:r0.fumoDuoMet,(s0=c.specialFlags)==null?void 0:s0.fumoDuoUnlocked,ka.length]);y.useEffect(()=>{if(typeof window>"u")return;const m=()=>{wa(rg())};return m(),window.addEventListener("resize",m),window.addEventListener("orientationchange",m),()=>{window.removeEventListener("resize",m),window.removeEventListener("orientationchange",m)}},[]),y.useEffect(()=>{typeof document<"u"&&document.body.classList.toggle("force-portrait-ui",Ks),typeof window<"u"&&(Ks?localStorage.setItem(yu,"true"):localStorage.removeItem(yu))},[Ks]),y.useEffect(()=>()=>{typeof document<"u"&&document.body.classList.remove("force-portrait-ui")},[]);const[ys,bs]=y.useState(oT),Ae=y.useCallback((m,M="",w=null,F=null,A=null)=>{var D,oe;const L=((D=c==null?void 0:c.time)==null?void 0:D.year)??3572,z=((oe=c==null?void 0:c.time)==null?void 0:oe.month)??1,U=(L-3572)*12+z,V={id:sT(),turn:U,message:m,category:M,type:w,title:F,details:A};bs(ne=>[V,...ne])},[(o0=c==null?void 0:c.time)==null?void 0:o0.year,(i0=c==null?void 0:c.time)==null?void 0:i0.month]),[Xn,Gc]=y.useState("FAMILY"),[en,Zn]=y.useState(!1),[vs,Vc]=y.useState(1),[Ss,Yc]=y.useState(!1),[ja,Of]=y.useState("AGE_DESC"),[ws,qc]=y.useState("DEFAULT"),[Qs,ks]=y.useState(0),er=y.useMemo(()=>{const m=C.filter(M=>{var w;return!((w=M.relationship)!=null&&w.cutTies)&&(!Ss||M.isFollowed)});switch(ws){case"AFFECTION_DESC":return m.sort((M,w)=>{var L,z;const F=((L=M.relationship)==null?void 0:L.affection)||0;return(((z=w.relationship)==null?void 0:z.affection)||0)-F});case"TRUST_DESC":return m.sort((M,w)=>{var L,z;const F=((L=M.relationship)==null?void 0:L.trust)||0;return(((z=w.relationship)==null?void 0:z.trust)||0)-F});case"APTITUDE_DESC":return m.sort((M,w)=>{var L,z;const F=((L=M.stats)==null?void 0:L.aptitude)||0;return(((z=w.stats)==null?void 0:z.aptitude)||0)-F});default:return m}},[C,ws,Ss]),Es=y.useMemo(()=>Math.max(1,Math.ceil(er.length/yl)),[er.length]);y.useEffect(()=>{ks(0)},[ws,Ss]),y.useEffect(()=>{ks(m=>Math.min(m,Math.max(0,Es-1)))},[Es]);const Kc=y.useMemo(()=>{const m=Qs*yl;return er.slice(m,m+yl)},[er,Qs]),Qc=er.length>yl,Jc=y.useMemo(()=>{if(!le||Zt.length===0)return null;const m=Zt.findIndex(M=>M.id===le.id);return m===-1?null:{hasPrev:m>0,hasNext:m<Zt.length-1,prevName:m>0?Zt[m-1].name:null,nextName:m<Zt.length-1?Zt[m+1].name:null,label:`${m+1}/${Zt.length}`}},[Zt,le]),Xc=y.useCallback(m=>{if(!le)return;const M=Zt.findIndex(w=>w.id===le.id);M!==-1&&(m==="PREV"&&M>0?_e(Zt[M-1]):m==="NEXT"&&M<Zt.length-1&&_e(Zt[M+1]))},[Zt,le,_e]),Ca=y.useCallback((m,M={})=>{var L,z,U,V,D;if(!m)return"";const w=[],F=m.gender===""?"":"",A=((L=m.stats)==null?void 0:L.aptitude)??"--";return w.push(`${F} ${A} ${m.tierTitle||""}`),(z=m.sect)!=null&&z.name&&w.push(` ${m.sect.name}${m.rank?`  ${m.rank}`:""}`),(U=m.spouse)!=null&&U.name&&w.push(` ${m.spouse.name} `),(V=m.trait)!=null&&V.name&&w.push(`${m.trait.name}`),(D=m.influenceProfile)!=null&&D.label&&w.push(`${m.influenceProfile.label}`),typeof M.descendantCount=="number"&&M.descendantCount>0&&w.push(` ${M.descendantCount} `),`${w.join("")}`},[]),Jo=y.useCallback((m,M=[])=>{var A,L;if(!Array.isArray(m)||m.length===0)return;const w=((A=c==null?void 0:c.time)==null?void 0:A.year)??0,F=((L=c==null?void 0:c.time)==null?void 0:L.month)??1;Ee(z=>{const U=new Set(z.map(D=>D.id)),V=[];return m.forEach(D=>{var te;if(!D||U.has(D.id))return;const oe=M.filter(ae=>ae.parentId===D.id).length,ne=D.deathReason||(typeof D.lifespan=="number"&&D.lifespan<=0?"":"");V.push({id:D.id,name:D.name,gender:D.gender,avatar:D.avatar,tierTitle:D.tierTitle,generation:D.generation||1,ageAtDeath:Math.max(0,Math.floor(D.age||0)),deathYear:w,deathMonth:F,deathReason:ne,sect:D.sect?{...D.sect}:null,rank:D.rank||null,trait:D.trait||null,influenceLabel:((te=D.influenceProfile)==null?void 0:te.label)||null,descendants:oe,epitaph:Ca(D,{descendantCount:oe})})}),V.length?[...V,...z]:z}),m.forEach(z=>{if(!z)return;const U=z.deathReason||(typeof z.lifespan=="number"&&z.lifespan<=0?"":"");Ae(` ${z.name} ${U} ${Math.max(0,Math.floor(z.age||0))} `)})},[(a0=c==null?void 0:c.time)==null?void 0:a0.year,(l0=c==null?void 0:c.time)==null?void 0:l0.month,Ca,Ae]),[Xo,Zo]=y.useState(null),[Zc,ei]=y.useState(!1),[ti,ed]=y.useState({id:null,name:"",total:0}),[Ta,Ia]=y.useState(0),[td,Js]=y.useState([]),[nd,ni]=y.useState(null),[Er,Xs]=y.useState([]),pr=y.useRef(null),{handleExplorationOption:rd,handleStartCombat:ri}=M5({player:c,inventory:l,children:O,exploreRealmState:ti,exploreProgress:Ta,exploreTeamIds:Er,setPlayer:f,setExploreLog:Js,setCombatData:Zo,addNpc:(m,M)=>{var w;return(w=pr.current)==null?void 0:w.call(pr,m,M)},addItemsToInventory:d,inventoryMgr:a,calculateDynamicCombatStats:Vn,simulateCombat:xu,generateRealmEnemy:Yk}),{handleCombatClose:_a}=A5({player:c,children:O,exploreRealmState:ti,applyCombatResult:h,addLog:Ae,setCombatData:Zo,setExploreLog:Js,batchUpdateChildren:P,archiveChildDeaths:Jo,addItemsToInventory:d,setIsExploring:ei}),sd=y.useCallback(()=>{_a(Xo)},[_a,Xo]),[Ra,Ma]=y.useState(null),[Zs,od]=y.useState(!1),[si,id]=y.useState(!1),[eo,ad]=y.useState(!1),[ld,oi]=y.useState(!1),[W,Le]=y.useState(!1),[cn,dn]=y.useState(!1),[tr,js]=y.useState(!1),[ht]=y.useState(()=>new Hj),[f1,Cs]=y.useState([]),[ii,Pf]=y.useState({}),Aa=y.useCallback(()=>{const m=pi.current;m&&(m.type==="idle"&&typeof window<"u"&&typeof window.cancelIdleCallback=="function"?window.cancelIdleCallback(m.id):clearTimeout(m.id),pi.current=null,$a.current=null)},[]),Na=y.useCallback((m,M)=>{try{const w=Qy(m);w.success&&(Ff.current=M,console.log(` : ${w.gameTime}`),window.dispatchEvent(new CustomEvent("autoSaveCompleted",{detail:{gameTime:w.gameTime}})))}catch(w){console.error(":",w)}finally{$a.current=null}},[]),zf=y.useCallback((m,M)=>{if(typeof window<"u"){if(typeof window.requestIdleCallback=="function"){window.requestIdleCallback(()=>Na(m,M),{timeout:1e3});return}if(typeof window.requestAnimationFrame=="function"){window.requestAnimationFrame(()=>Na(m,M));return}}setTimeout(()=>Na(m,M),0)},[Na]),Df=y.useCallback((m,M)=>{Aa();const w=()=>{pi.current=null,zf(m,M)};if(typeof window<"u"&&typeof window.requestIdleCallback=="function"){const F=window.requestIdleCallback(w,{timeout:1500});pi.current={type:"idle",id:F}}else{const F=setTimeout(w,aT);pi.current={type:"timeout",id:F}}$a.current=M},[Aa,zf]);y.useEffect(()=>()=>{Aa()},[Aa]);const[Ts,cd]=y.useState([]),[ai,li]=y.useState([]),[m1,dd]=y.useState(!1),[h1,ud]=y.useState([]),[La,pd]=y.useState(null),[g1,ci]=y.useState([]),[x1,di]=y.useState([]),[y1,ui]=y.useState([]),pi=y.useRef(null),Ff=y.useRef(null),$a=y.useRef(null),Hf=y.useMemo(()=>{if(typeof navigator>"u")return!1;const m=navigator.userAgent||"";return/Android|Adr|OPPO|VIVO|MIUI|HONOR|HUAWEI/i.test(m)},[]);y.useEffect(()=>{Array.isArray(c==null?void 0:c.newsBuffer)&&(c.newsBuffer.length<=ma||f(m=>({...m,newsBuffer:lu(m.newsBuffer)})))},[c==null?void 0:c.newsBuffer,f]),y.useEffect(()=>{var F;const m=!c.specialCollections||!Array.isArray(c.specialCollections.fumoSwords),M=!c.specialFlags||typeof c.specialFlags.fumoDuoUnlocked>"u"||typeof c.specialFlags.fumoDuoMet>"u";if(m||M){f(A=>{var U,V,D;const L=!A.specialCollections||!Array.isArray(A.specialCollections.fumoSwords),z=!A.specialFlags||typeof A.specialFlags.fumoDuoUnlocked>"u"||typeof A.specialFlags.fumoDuoMet>"u";return!L&&!z?A:{...A,specialCollections:L?{...A.specialCollections||{},fumoSwords:[...((U=A.specialCollections)==null?void 0:U.fumoSwords)||[]]}:A.specialCollections,specialFlags:z?{...A.specialFlags||{},fumoDuoUnlocked:((V=A.specialFlags)==null?void 0:V.fumoDuoUnlocked)||!1,fumoDuoMet:((D=A.specialFlags)==null?void 0:D.fumoDuoMet)||!1}:A.specialFlags}});return}if(c&&!c.familyRating&&f(A=>A.familyRating?A:{...A,familyRating:{currentId:Gs[0].id,history:[]}}),c&&!c.combatStats){console.log("...");const A=c.stats||{aptitude:50,luck:50,lifespan:100},L=((F=c.spiritRoot)==null?void 0:F.type)||"",z=Ho(c.tier||"",A.aptitude,L);f(U=>({...U,stats:U.stats||A,spiritRoot:U.spiritRoot||{type:"",elements:["","","","",""],color:"#9E9E9E",multiplier:.5},combatStats:z}))}if(c&&!ng(c.avatar)&&f(A=>ng(A.avatar)?A:{...A,avatar:{...iT,...A.gender?{gender:A.gender}:{}}}),C.some(A=>!A.relationship||A.currentExp===void 0)&&(console.log(" NPC ..."),X(A=>{const L={...A};if(L.relationship||(L.relationship={stage:0,affection:0,trust:0,jealousy:0}),L.currentExp===void 0){const z=L.tier||"",U=Cn(z);L.tier=z,L.currentExp=Math.floor(Math.random()*U.maxExp*.3),L.maxExp=U.maxExp}return L})),C.some(A=>{var z;if(!A)return!1;const L=mc(A);return!((z=A.stats)!=null&&z.lifespan)||A.stats.lifespan<L})&&X(A=>{if(!A)return A;const L=A.stats||{},z=mc(A);return L.lifespan&&L.lifespan>=z?A:{...A,stats:{...L,lifespan:z}}}),C.some(A=>!A.memories)){console.log(" NPC ...");const A=C.map(L=>{Jr.initializeAllNpcs([L]);const z=O.filter(U=>U.fatherName===L.name||U.motherName===L.name);return z.length>0&&Jr.backfillChildrenMemories(L,z),L});re(A)}O.some(A=>!A.equipment)&&P(A=>xi(A)),O.some(A=>A.spiritRoot&&!A.spiritRoot.elements)&&(console.log("..."),P(A=>A.spiritRoot&&!A.spiritRoot.elements?{...A,spiritRoot:{type:"",elements:["","","","",""],desc:"",color:"#9E9E9E",multiplier:.5}}:A))},[c,C,O]),y.useEffect(()=>{if(!Array.isArray(c.worldNpcs)||c.worldNpcs.length===0){console.log("...");const m=H5(30);f(M=>({...M,worldNpcs:m}))}},[c.worldNpcs]),y.useEffect(()=>{const m=localStorage.getItem("has_read_tutorial_v2");_t==="MAIN"&&!m&&setTimeout(()=>{e.openTutorial()},1e3)},[_t,e]);const b1=()=>{var m;e.closeTutorial(),localStorage.setItem("has_read_tutorial_v2","true"),y.useEffect(()=>{var M;((M=c==null?void 0:c.childrenStrategy)==null?void 0:M.skipZhaozhou)!==void 0&&oi(!!c.childrenStrategy.skipZhaozhou)},[(m=c==null?void 0:c.childrenStrategy)==null?void 0:m.skipZhaozhou])};y.useEffect(()=>{if(!Zs)return;const m=O.filter(w=>Math.floor(w.age*12)>=144&&w.isTested&&!w.sect);if(m.length===0)return;let M=0;P(w=>{if(!m.some(L=>L.id===w.id))return w;const A=yd(w);return A?(M++,{...w,sect:A,rank:Ki(w,A)}):w}),M>0&&Z("",` ${M} `,!0)},[O,Zs]);const v1=()=>{localStorage.setItem("has_read_tutorial_v2","true")},S1=()=>{e.closeGuide()},Wf=(c0=t.data)==null?void 0:c0.autoClose,[dT,uT]=y.useState(null),[pT,fT]=y.useState({}),[fd,fi]=y.useState(null);y.useEffect(()=>{if(!fd)return;const m=setTimeout(()=>fi(null),3200);return()=>clearTimeout(m)},[fd]);const[to,mi]=y.useState([]),[Ba,md]=y.useState([]),[Is,hd]=y.useState({open:!1,item:null}),w1=y.useCallback(({messageId:m,targetNpcId:M,relation:w,content:F,tone:A})=>{var V;const L=(F||"").trim();if(!L)return{success:!1,error:""};const z={year:c.time.year,month:c.time.month},U=ht.addReplyToMessage(m,{content:L,tone:A==null?void 0:A.id,toneLabel:A==null?void 0:A.label,sentiment:A==null?void 0:A.desc,timestamp:z,from:c.name,affectionDelta:(A==null?void 0:A.affectionDelta)||0});if(!U)return{success:!1,error:""};if(Cs(ht.getAllMessages()),Ae(`${U.message.senderName}`,""),A!=null&&A.affectionDelta&&w!=="child"){const D=C.find(oe=>oe.id===M);if(D){const oe=((V=D.relationship)==null?void 0:V.affection)||0,ne=Math.max(0,Math.min(100,oe+A.affectionDelta));q(M,{relationship:{...D.relationship||{},affection:ne}})}}return{success:!0}},[ht,c.time.year,c.time.month,c.name,Ae]),Oa=y.useMemo(()=>{var m;return U2((m=c==null?void 0:c.familyRating)==null?void 0:m.currentId)},[(d0=c==null?void 0:c.familyRating)==null?void 0:d0.currentId]),k1=y.useMemo(()=>{let m=0;return O.forEach(M=>{m+=uc(M,{familyRatingMultiplier:Oa})}),m},[O,Oa]),hi=y.useMemo(()=>X2(O,c),[O,c]),E1=y.useCallback(()=>i({type:null,data:null}),[i]),Z=y.useCallback((m,M,w=!0,F=null,A=!0,L=null)=>{const z=L||{},U=z.forceManual?!1:A;if(i({type:"RESULT",data:{title:m,msg:M,success:w,changes:F,autoClose:U}}),z.skipLog)return;const V=typeof M=="string"?M:"",D=m||"",oe=V.length>20,ne=z.message||(oe?`${D}`:V||D),te=z.details!==void 0?z.details:oe?V:null,ae=z.title??D,Ie=z.category||"",de=z.type??null;Ae(ne,Ie,de,ae,te)},[Ae]),Uf=y.useCallback((m,M,w=null)=>{i({type:"CONFIRM",data:{message:m,onConfirm:M,input:(w==null?void 0:w.input)||null}})},[]),gd=y.useRef(0);y.useEffect(()=>{gd.current=0},[N.length]);const Pa=y.useCallback(()=>N.length+gd.current,[N.length]),Gf=y.useCallback(m=>{const M=m?`${m}

`:"";Z("",`${M}${ROMANCE_LIMIT_MESSAGE}`,!1),Ae("","")},[Z,Ae]),gi=y.useCallback(m=>{const M=eg(m);return Pa()>=Zh?(M.silent||Gf(M.contextMessage),!1):!0},[Pa,Gf]),jr=y.useCallback((m,M)=>{if(!m)return!1;const w=eg(M);return gi(w)?(gd.current+=1,se(m),!0):!1},[se,gi]);y.useEffect(()=>{pr.current=(m,M)=>jr(m,M||"")},[jr]);const Vf=y.useCallback(()=>Math.max(0,Zh-Pa()),[Pa]),j1={"XMZM-TEST-2026":{spiritStones:1e5},"XMZM-SKILL-5000-2026":{skillPoints:5e3},"XMZM-SPECIAL-MANUAL-2026":{items:["yin_yang_harmony_manual","blood_demon_manual","chaos_origin_manual","five_elements_supreme_manual","emperor_scripture_manual","deep_ocean_scripture_manual"]}},Yf=y.useCallback(()=>new Set((c==null?void 0:c.usedRedeemCodes)||[]),[c==null?void 0:c.usedRedeemCodes]),qf=y.useCallback(m=>{f(M=>({...M,usedRedeemCodes:[...m]}))},[f]),C1=y.useCallback(m=>{const M=(m||"").trim();if(!M)return{success:!1,message:""};const w=j1[M];if(!w)return{success:!1,message:""};const F=Yf();if(F.has(M))return{success:!1,message:""};F.add(M),qf(F),w.spiritStones&&S({spiritStones:w.spiritStones}),w.skillPoints&&f(U=>({...U,skillPoints:(U.skillPoints||0)+w.skillPoints})),w.items&&w.items.length&&d(w.items);const A=[];if(w.spiritStones&&A.push(` ${w.spiritStones} `),w.skillPoints&&A.push(` ${w.skillPoints} `),w.items&&w.items.length){const U=w.items.reduce((V,D)=>(V[D]=(V[D]||0)+1,V),{});Object.entries(U).forEach(([V,D])=>{var ne;const oe=((ne=Fo(V))==null?void 0:ne.name)||V;A.push(` ${oe} ${D}`)})}const L=`
${A.join(`
`)}`,z={...w.spiritStones?{:w.spiritStones}:{},...w.skillPoints?{:w.skillPoints}:{},...w.items&&w.items.length?w.items.reduce((U,V)=>{var oe;const D=((oe=Fo(V))==null?void 0:oe.name)||V;return U[D]=(U[D]||0)+1,U},{}):{}};return Z("",L,!0,z),{success:!0,message:""}},[Yf,qf,S,d,f,Z]),T1=y.useCallback(async()=>{var M,w;let m=!1;if(typeof window<"u"&&((w=(M=window.screen)==null?void 0:M.orientation)!=null&&w.lock))try{await window.screen.orientation.lock("portrait"),m=!0}catch(F){console.warn(":",F)}Qo(!0),!m&&typeof window<"u"&&setTimeout(()=>window.dispatchEvent(new Event("resize")),80),Z("",m?"":"",!0)},[Z]),I1=y.useCallback(()=>{var m,M;if(typeof window<"u"&&((M=(m=window.screen)==null?void 0:m.orientation)!=null&&M.unlock))try{window.screen.orientation.unlock()}catch(w){console.warn(":",w)}Qo(!1),Z("","",!0)},[Z]),_1=y.useCallback(()=>{if(!hi.nextTier){Z("","",!0);return}if(!hi.canUpgrade){Z("","",!1);return}const m=hi.nextTier;f(w=>{var F;return{...w,familyRating:{currentId:m.id,history:[...((F=w.familyRating)==null?void 0:F.history)||[],{id:m.id,name:m.name,year:w.time.year,month:w.time.month}]}}});const M=`${m.name}`;Ae(` ${M}`,""),Z("",`${M}

${m.desc}`,!0)},[hi,f,Ae,Z]);y.useEffect(()=>{window.showResult=Z,window.showConfirm=Uf},[Z,Uf]),y.useEffect(()=>{if(!c.currentAuction||!c.auctionWindowStart||!c.auctionWindowEnd)return;tg(c.time.year,c.time.month)>=c.auctionWindowEnd&&b({currentAuction:null,auctionWindowStart:null,auctionWindowEnd:null})},[c.currentAuction,c.auctionWindowStart,c.auctionWindowEnd,c.time.year,c.time.month,b]);const R1=(m,M)=>{if(!m)return{success:!1,title:"",message:""};const w=Math.max(0,M||m.basePrice||0);if((c.resources.spiritStones||0)<w)return{success:!1,title:"",message:""};if(m.type==="SLAVE"&&!gi({contextMessage:"",silent:!0}))return{success:!1,title:"",message:ROMANCE_LIMIT_MESSAGE};E({spiritStones:w});let A="";if(m.type==="SLAVE"){const L=xp(c.tier);L.name=m.name,L.identity="",L.relationship=L.relationship||{},L.relationship.owner=c.name,L.relationship.affection=-20,L.relationship.trust=0,L.relationship.stage=0;const z=N1(m,L);if(L.slavePlot=z,!jr(L,{contextMessage:`${m.name}`,silent:!0}))return S({spiritStones:w}),{success:!1,title:"",message:ROMANCE_LIMIT_MESSAGE};A=` ${w}  ${m.name}Ta 

${z.intro}`,Ae(" "+w+"  "+m.name)}else if(m.type==="ITEM"&&m.itemId){const L=br(m.itemId);if(!L)return{success:!1,title:"",message:""};m.description&&(L.desc=m.description),d([L]),A=` ${w}  ${m.name}`,Ae(` ${w}  ${m.name}`)}else if(m.type==="FUMO_SWORD"){const L=Qh(m.swordId)||{id:m.swordId,name:m.name},z=V5(L)||{instanceId:`fumo_${m.swordId||Date.now()}`,name:m.name,type:"weapon",rarity:"legendary",desc:m.description||m.plot||""};d([z]);const V=L.id&&ur.includes(L.id)?ur.length:ur.length+1,D=Math.max(0,mu-V),oe=L.blessing||"",ne=D===0?"":` ${D} `;A=` ${w}  ${m.name}
${oe}

${ne}`,Ae(` ${m.name}`,""),B1(L.id||m.swordId)}else{const L={instanceId:"auction_"+Date.now()+"_"+Math.floor(Math.random()*1e4),name:m.name,type:"consumable",rarity:m.rarity||"rare",desc:m.description||m.plot||"",effect:{kind:"exp",amount:3e3}};d([L]),A=` ${w}  ${m.name}`,Ae(` ${w}  ${m.name}`)}return b({soldAuctionItems:[...c.soldAuctionItems||[],m.itemId||m.swordId||m.id]}),{success:!0,title:"",message:A}},M1=m=>m.plot||m.description,A1=()=>{const m=tg(c.time.year,c.time.month),w=c.auctionWindowStart&&c.auctionWindowEnd&&m>=c.auctionWindowStart&&m<c.auctionWindowEnd;if(c.currentAuction){if(!w){b({currentAuction:null,auctionWindowStart:null,auctionWindowEnd:null}),fi(null),Z("","",!1);return}fi(null),i({type:"AUCTION",data:c.currentAuction});return}if(m%36!==0){Z("","",!1);return}const F=Xh(c.time.year,{ownedFumoSwords:ur,soldAuctionItems:c.soldAuctionItems||[]});b({currentAuction:F,lastAuctionYear:c.time.year,auctionWindowStart:m,auctionWindowEnd:m+12}),fi(null),i({type:"AUCTION",data:F})},N1=(m,M)=>{const w=[{intro:`${M.name}Ta`,trauma:"",hope:""},{intro:`${M.name}Ta`,trauma:"",hope:""},{intro:`${M.name}Ta`,trauma:"",hope:""},{intro:`${M.name}Ta`,trauma:"",hope:""}];return{...w[Math.floor(Math.random()*w.length)],unlockStage:2}},xi=m=>{const M=m.equipment||{weapon:null,armor:null,accessory:null};return{...m,equipment:M}},gt=m=>{const M=xi(m);return{...M,combatStats:Vn(M)}},L1={:30,:30,:30,:30,:50,:50,:50,:50,:200,:200,:200,:200,:300,:300,:300,:300,:500,:500,:500,:500},$1=(m=0)=>{for(let M=0;M<Ve.length;M++)if(m<Ve[M].maxExp)return Ve[M];return Ve[Ve.length-1]},tn=(m,M=0)=>{var oe;const w=(m.cultivation||0)+M,F=m.tierTitle,A=$1(w),L=Ve.findIndex(ne=>ne.name===A.name),z=L>0?Ve[L-1].maxExp:0;let U={...m,cultivation:w,tierTitle:A.name,currentExp:w-z,maxExp:A.maxExp-z},V=0;const D=!!F&&F!==A.name;return D&&(V=L1[A.name]||50,U={...U,stats:{...U.stats,lifespan:(((oe=U.stats)==null?void 0:oe.lifespan)??100)+V}}),{updated:U,tierChanged:D,lifespanIncrease:V,newTier:A.name,prevTier:F}},B1=y.useCallback(m=>{var z,U;if(!m)return;const M=Array.isArray((z=c.specialCollections)==null?void 0:z.fumoSwords)?c.specialCollections.fumoSwords:[];if(M.includes(m))return;I("fumoSwords",m);const w=[...M,m];wp(w).length===0&&mu>0&&!((U=c.specialFlags)!=null&&U.fumoDuoUnlocked)&&b({specialFlags:{...c.specialFlags||{},fumoDuoUnlocked:!0}});const L=Qh(m);L&&Ae(` ${L.name} `,"")},[c.specialCollections,c.specialFlags,I,b,Ae]),Kf=m=>{if(!m)return 0;const w={common:10,uncommon:50,rare:200,epic:800,legendary:3e3,mythic:8e3}[m.rarity]||10,F=m.type==="weapon"||m.type==="armor"||m.type==="accessory"?2:1;return Math.max(1,Math.floor(w*F))},O1=(m,M)=>{const w=l.find(D=>D.instanceId===m);if(!w){Z("","",!1);return}const F=typeof M=="number"?Math.min(M,w.quantity||1):w.quantity||1,A=u(m,F);if(!A){Z("","",!1);return}const L=Kf(w),U=Math.floor(L*.7*(A.quantity||1)),V=A.quantity&&A.quantity>1?" x"+A.quantity:"";S({spiritStones:U}),Z(""," "+U+"  "+A.name+V+"",!0,{:U}),Ae(""+A.name+V+" "+U+" ")},P1=m=>{if(!l.find(F=>F.instanceId===m)){Z("","",!1);return}const w=u(m);if(!w){Z("","",!1);return}Z("",` ${w.name}${w.quantity&&w.quantity>1?` x${w.quantity}`:""}`,!0),Ae(`${w.name}${w.quantity&&w.quantity>1?` x${w.quantity}`:""}`)},Qf=(m,M)=>{var F;const w=C.find(A=>A.id===m);if(M==="TOGGLE_FOLLOW"){J(m);return}if(M==="GIFT"){i({type:"GIFT",data:w});return}if(M==="PROPOSE"){const A=tu(w,"PERSUADE");if(!A.allowed){Z("",A.reason,!1,null,!1,{category:"",type:"PERSUADE",title:"",message:"",details:A.reason,forceManual:!0});return}i({type:"NEGOTIATE",data:w});return}if(M==="SPAR"){const A=tu(w,"SPAR");if(!A.allowed){Z("",A.reason,!1,null,!1,{category:"",type:"SPAR",title:"",message:"",details:A.reason,forceManual:!0});return}if((c.energy||0)<=0){Z("","",!1,null,!1,{category:"",type:"SPAR",title:"",message:"",details:"",forceManual:!0});return}j(1);const L={...c,combatStats:c.combatStats||{maxHp:100,maxMp:50,atk:10,def:5,hp:100,mp:50}},z={...w,combatStats:w.combatStats||{maxHp:100,maxMp:50,atk:10,def:5,hp:100,mp:50}},V=xu(L,z).winner==="player";let D=0;const oe=w.identity==="",ne=w.identity==="",te=w.identity==="";oe||ne||te||Math.random()<.3&&(D=V?2:3);const Ie=C.find(kt=>kt.id===m);if(Ie){const kt=Ie.relationship||{},zn=kt.affection||0;let _n={...Ie,relationship:{...kt,affection:Math.min(100,zn+D)}};_n=ak(_n,c,Math.floor(c.age),c.time.month,!V),_n=Pi(_n),q(m,_n)}f(kt=>{const zn={...kt,currentExp:(kt.currentExp||0)+(V?3:5)};return{...zn,combatStats:Vn(zn)}});const de=ou(w,c),Ye=(de==null?void 0:de.title)||(V?"":""),Ke=(de==null?void 0:de.description)||(V?` ${w.name}${w.gender===""?"":""}`:` ${w.name}`);Z(Ye,Ke,!0,{:D,:V?3:5},!1,{category:"",type:"SPAR",title:Ye,message:`${Ye}`,details:Ke,forceManual:!0}),za(w,"SPAR");return}if(M==="DUAL_CULTIVATION"){const A=tu(w,"DUAL_CULTIVATION");if(!A.allowed){Z("",A.reason,!1,null,!1,{category:"",type:"DUAL_CULTIVATION",title:"",message:"",details:A.reason,forceManual:!0});return}if((c.energy||0)<=0){Z("","",!1,null,!1,{category:"",type:"DUAL_CULTIVATION",title:"",message:"",details:"",forceManual:!0});return}const L=A.requiresCheck;if(L&&!(Math.random()<A.checkRate)){Z("",`${w.name}"..."${w.gender===""?"":""}`,!1,null,!1,{category:"",type:"DUAL_CULTIVATION",title:"",message:"",details:`${w.name}${w.gender===""?"":""}`,forceManual:!0});return}const z=50;if(c.resources.spiritStones<z){Z("",` ${z} : ${c.resources.spiritStones}`,!1,null,!1,{category:"",type:"DUAL_CULTIVATION",title:"",message:"",details:` ${z}  ${c.resources.spiritStones??0}`,forceManual:!0});return}const U=((F=w.relationship)==null?void 0:F.affection)||0;let V=20,D=1;U>=80?(D=2,V=30):U>=60?(D=1.5,V=25):U>=40&&(D=1.2,V=22);const oe=Math.floor(V*D);f(de=>{const Ye={...de,resources:{...de.resources,spiritStones:Math.max(0,de.resources.spiritStones-z)},currentExp:(de.currentExp||0)+V,energy:Math.max(0,(de.energy||0)-1)};return{...Ye,combatStats:Vn(Ye)}});const ne=C.find(de=>de.id===m);if(ne){const de=ne.relationship||{},Ye=de.affection||0;let Ke={...ne,currentExp:(ne.currentExp||0)+oe,relationship:{...de,affection:Math.min(100,Ye+5)},dualCultivationCount:(ne.dualCultivationCount||0)+1};Ke=lk(Ke,c,Math.floor(c.age),c.time.month),Ke=Pi(Ke),q(m,Ke)}let te;L?te=`${w.name}${w.gender===""?"":""}

${w.gender===""?"":""}

""${w.gender===""?"":""}""`:te=` ${w.name} ${U>=80?"":U>=60?"":""}`;const ae=L?"":"",Ie=L?"BUDDHA_FIRST_DUAL":"DUAL_CULTIVATION";Z(ae,te,!0,{:5,:V,[`${w.name}`]:oe,:-z,:-1},!1,{category:"",type:Ie,title:ae,message:`${ae}`,details:te,forceManual:!0}),U>=70&&Math.random()<.3&&zt(c.newsBuffer,"DUAL_CULTIVATION",{actor:c.name,target:w.name}),za(w,"DUAL_CULTIVATION");return}if(M==="CHAT"){if((c.energy||0)<=0){Z("","",!1,null,!1,{category:"",type:"CHAT",title:"",message:"",details:"",forceManual:!0});return}j(1);const A=w.identity==="",L=w.identity==="",z=w.identity==="",U=A||L||z,D=(U?Math.random()<.05:!0)?ou(w,c):null;if(D){const de=w.relationship||{},Ye=de.affection||0;q(m,{relationship:{...de,affection:Math.min(100,Ye+(D.affectionBonus||2))}});const Ke=(D==null?void 0:D.title)||"",kt=(D==null?void 0:D.text)||"";Z(Ke,kt,!0,{:(D==null?void 0:D.affectionBonus)||2},!1,{category:"",type:"CHAT_EVENT",title:Ke,message:`${Ke}`,details:kt,forceManual:!0});return}const oe=U?.05:.15;if(Math.random()<oe){const de=yE(w);if(de){i({type:"EVENT",data:{npc:w,event:de}});return}}const ne=gj(w),ae=w.identity===""||A||L||z;if(ae){let de=dh(w,c,Math.floor(c.age),c.time.month);de=Pi(de),q(m,de)}else{const de=w.relationship||{},Ye=de.affection||0;let Ke={...w,relationship:{...de,affection:Ye+2}};Ke=dh(Ke,c,Math.floor(c.age),c.time.month),Ke=Pi(Ke),q(m,Ke)}const Ie=` ${w.name} ${w.gender===""?"":""}
"${ne}"`;Z("",Ie,!0,ae?{}:{:2},!1,{category:"",type:"CHAT",title:`${w.name}`,message:`${w.name}`,details:Ie,forceManual:!0}),za(w,"CHAT")}M==="DETAIL"&&B(w)},za=(m,M)=>{const w=Bj(c,m,C,M);if(w.length>0){const F=new Set(w.map(U=>U.id)),A=[],L={CHAT:"",GIFT:"",SPAR:"",DUAL_CULTIVATION:""};if(Y(U=>U.map(V=>{var Ie,de;if(!F.has(V.id))return V;const D=$j(V,m,M);if(D===0)return V;const oe=((Ie=V.relationship)==null?void 0:Ie.jealousy)||0,ne=Math.min(100,oe+D),te=new Set([...((de=V.relationship)==null?void 0:de.rivalNpcs)||[],m.id]);let ae={...V,relationship:{...V.relationship||{},jealousy:ne,rivalNpcs:Array.from(te),lastInteraction:c.time.month}};return A.push({witnessName:V.name,targetName:m.name,increase:D,newJealousy:ne,level:Lj(ne).label,actionLabel:L[M]||""}),ae=uh(ae,c,c.time.year,c.time.month,m,ne),ne>=41&&Math.random()<.3&&(ae=ck(ae,c,c.time.year,c.time.month)),ne>=60&&Math.random()<.25&&zt(c.newsBuffer,"NPC_JEALOUSY",{actor:V.name,target:c.name,rival:m.name}),ae})),A.length>0){const U=A.map(V=>`${V.level}${V.witnessName}${V.targetName}${V.actionLabel} +${V.increase}  ${V.newJealousy}`).join(`

`);Ae(`${A[0].witnessName} ${A[0].newJealousy}`,"","JEALOUSY","",U),tr||md(V=>[...V,{id:`${c.time.year}-${c.time.month}-${Date.now()}`,alerts:A,summary:U,actionLabel:L[M]||"",timestamp:{year:c.time.year,month:c.time.month},targetName:m.name}])}w.find(U=>{var D;return(((D=U.relationship)==null?void 0:D.jealousy)||0)>=60})&&Ae("...")}},{handleGiftConfirm:z1,handleNegotiateConfirm:D1,handleOptionSelect:Jf,handleShuraFieldSelect:F1}=N5({player:c,inventory:l,activeNpcs:C,modalState:t,setModalState:i,removeItemFromInventory:u,updateNpc:q,setActiveNpcs:Y,batchUpdateNpcsByMap:ye,setSelectedNpc:B,showResult:Z,addLog:Ae,handleWitnessCheck:za,pushToNewsBuffer:zt,isUsageAllowedForTarget:_s,RESOURCE_USAGE:ft,formatUsageTargets:uo}),H1=m=>{if(m==="CULTIVATE"){if((c.energy||0)<=0){Z("","",!1);return}const M=10+Math.floor(Math.random()*5);f(w=>{const F={...w,currentExp:w.currentExp+M,energy:Math.max(0,(w.energy||0)-1)};return{...F,combatStats:Vn(F)}}),Z("","",!0,{:M})}if(m==="WORK"){if((c.energy||0)<=0){Z("","",!1);return}const M=15;S({spiritStones:M}),j(1),Z("","",!0,{:M})}},W1=()=>{if(c.resources.spiritStones<10){Z("",` 10 : ${c.resources.spiritStones}`,!1);return}E({spiritStones:10});const M=3+Math.floor(Math.random()*3),w=[],F={common:[{id:"herb_bandage",basePrice:15},{id:"rice_ball",basePrice:10}],uncommon:[{id:"beast_fang",basePrice:80},{id:"beast_core",basePrice:120},{id:"iron_sword",basePrice:100}],rare:[{id:"foundation_pill",basePrice:350},{id:"thunder_wood",basePrice:400},{id:"iron_armor",basePrice:450}],epic:[{id:"core_pill",basePrice:800},{id:"artifact_supreme",basePrice:1200},{id:"marrow_wash",basePrice:900}],legendary:[{id:"nascent_fruit",basePrice:2500},{id:"heaven_manual",basePrice:3e3}]},A=D2(c.tier);let L={common:60,uncommon:25,rare:10,epic:4,legendary:1};A>=6&&A<20?L={common:50,uncommon:27,rare:14,epic:7,legendary:2}:A>=20&&(L={common:45,uncommon:25,rare:18,epic:9,legendary:3});for(let z=0;z<M;z++){const U=G1(L),V=F[U];if(V&&V.length>0){const D=V[Math.floor(Math.random()*V.length)],oe=br(D.id);if(oe){const ne=.8+Math.random()*.4;oe.price=Math.floor(D.basePrice*ne),w.push(oe)}}}i({type:"SHOP",data:{items:w}})},U1=y.useCallback((m,M=1,w)=>{var U;if(!m)return;const F=Math.max(1,parseInt(M,10)||1),A=typeof w=="number"?w:(m.price||0)*F;if((((U=c==null?void 0:c.resources)==null?void 0:U.spiritStones)||0)<A)return;const z=[];if(m.stackable)z.push({...m,quantity:F,instanceId:`${m.id}_${Date.now()}_${Math.floor(Math.random()*1e4)}`});else for(let V=0;V<F;V++){const D=br(m.id);D&&z.push(D)}z.length!==0&&(E({spiritStones:A}),d(z))},[(u0=c==null?void 0:c.resources)==null?void 0:u0.spiritStones,E,d]),G1=m=>{const M=Object.values(m).reduce((F,A)=>F+A,0);let w=Math.random()*M;for(const[F,A]of Object.entries(m)){if(w<A)return F;w-=A}return"common"},V1=y.useCallback(()=>{const m=hu.map(Y5).filter(Boolean);if(m.length===0)return;const M=new Set(C.map(A=>A.id)),w=m.filter(A=>!M.has(A.id)).map(A=>ch(A,c,c.time.year,c.time.month));if(w.length>0){if(Vf()<w.length){gi({contextMessage:""});return}w.forEach(L=>jr(L,""))}f(A=>{const L=new Set((A.worldNpcs||[]).map(U=>U.id)),z=hu.map(U=>q5(U,c.time.year)).filter(U=>U&&!L.has(U.id));return{...A,specialFlags:{...A.specialFlags||{},fumoDuoUnlocked:!0,fumoDuoMet:!0},worldNpcs:[...A.worldNpcs||[],...z]}}),hu.forEach(A=>{var L;Ae(` ${((L=A.world)==null?void 0:L.rankHint)||""}${A.name}`,"")});const F="";Z("",F,!0,null,!1,{category:"",type:"FUMO_LEGEND",title:"",message:F})},[Ae,c,c.time.year,c.time.month,f,Z,Vf,gi,jr]),Y1=y.useCallback(m=>{if(C.some(F=>F.id===m.id)){Ae(`${m.name}`,"");return}const w=Xf(m);jr(w,`${m.name} `)&&(v(m.id,{hasMetPlayer:!0}),Ae(` ${m.name}`,""))},[C,Ae,jr,v]),Xf=m=>{var w;return{id:m.id,name:m.name,gender:m.gender,identity:m.title||"",appearance:((w=m.appearance)==null?void 0:w.description)||"",desc:m.signature||"",tier:m.tier,currentExp:m.currentExp||0,maxExp:m.maxExp||500,stats:m.stats||{aptitude:85,looks:80,intelligence:85,health:90},spiritRoot:m.spiritRoot||{type:"",elements:[""],multiplier:1.8},relationship:{stage:0,affection:0,trust:0,jealousy:0},trait:{name:"",bonuses:{speedMultiplier:1.2}},sect:m.sect,sectId:m.sectId,sectRank:m.sectRank,sectStatus:m.sectStatus||"active",combatStats:m.combatStats||{hp:1e3,maxHp:1e3,atk:100,def:50,mp:500,maxMp:500},isTested:!0,isWorldElite:!0,isFollowed:!1,age:m.age||100,personality:m.personality,acceptsLetters:!0,isPregnant:!1,cultivationMethod:"basic_breath",constitution:m.constitution,avatar:m.avatar||{base:Math.floor(Math.random()*3),skinColor:Math.floor(Math.random()*5),eye:Math.floor(Math.random()*3),eyeColor:Math.floor(Math.random()*5),mouth:Math.floor(Math.random()*3),hair:Math.floor(Math.random()*3),hairColor:Math.floor(Math.random()*5)}}},q1=()=>{var F;if(c.resources.spiritStones<5){Z("",` 5 : ${c.resources.spiritStones}`,!1);return}if(E({spiritStones:5}),Ea){V1();return}const w=(c.worldNpcs||[]).filter(A=>A.status==="ALIVE"&&A.gender!==c.gender&&!A.hasMetPlayer);if(Math.random()<.05&&w.length>0){const A=w[Math.floor(Math.random()*w.length)],L=Xf(A);if(!C.find(V=>V.id===L.id)&&!jr(L,` ${A.name}

${A.gender===""?"":""}`))return;v(A.id,{hasMetPlayer:!0,firstMetYear:c.age});const U=`${A.gender===""?"":""}

${A.title} ${A.name}${A.gender===""?"":""}${A.tier}${A.gender===""?"":""}${((F=A.appearance)==null?void 0:F.description)||""}

${A.gender===""?"":""}...

 ${A.name}`;Z(` ${A.name}`,U,!0,null,!1),Ae(` ${A.title} ${A.name}`,"");return}if(Math.random()<.4){const A=xp(c.tier);let L="";if(A.identity===""?L=`${A.identity}${A.appearance}`:A.identity===""?L=`${A.identity}${A.appearance}`:A.identity===""?L=`${A.identity}${A.appearance}`:L=`${A.identity}${A.appearance}${A.desc.includes("")?"":""}`,!jr(A,L))return;Z(`${A.name}`,L,!0,null,!1)}else Z("","",!1,{:-5})},K1=y.useCallback((m,M)=>{var F;q(m,{acceptsLetters:M}),B(A=>A&&A.id===m?{...A,acceptsLetters:M}:A);const w=((F=C.find(A=>A.id===m))==null?void 0:F.name)||"";Ae(M?`  ${w} `:`  ${w} `,"")},[C,Ae,q]),Q1=()=>{Ae("..."),X(m=>m.id===1||m.id===2?ch(m,c,c.time.year,c.time.month):m),Xt("MAIN")},J1=(m=1,M=null)=>{let w;if(M)w=M;else{const A=lu(c.newsBuffer);w={player:c,children:O,fallenChildren:ie,activeNpcs:C,deadNpcs:k,gameStage:_t,logs:ys,inventory:l,messages:ht.toJSON(),lastMessageCheck:ii,pendingSectChoices:ai,testQueue:Ts,worldEvents:c.worldEvents||[],newsBuffer:A}}return qy(w,m)},Zf=async(m=1,M=null)=>{try{let w;if(M)w=M;else try{w=await Af(m)}catch(L){console.warn(":",L),w=No(m)}if(!w||!w.player)throw new Error("");w=nC(w);const F=oC(w.player);f(L=>{var z;return{...w.player,businesses:((z=w.player)==null?void 0:z.businesses)||[]}}),he(w.children||[]),Y(w.activeNpcs||[]),H(w.deadNpcs||[]);const A=Array.isArray(w.inventory)?w.inventory:[];if(a&&a.setInventory(A),Xt(w.gameStage||"MAIN"),bs(w.logs||[]),w.messages&&Cs(Array.isArray(w.messages)?w.messages:[]),Pf(w.lastMessageCheck||{}),w.pendingSectChoices&&li(w.pendingSectChoices),w.testQueue&&cd(w.testQueue),Ee(w.fallenChildren||[]),Zn(!1),_e(null),i({type:null,data:null}),M){let L=`
${w.gameTime||""}
${w.saveDate||""}`;F&&(L=F+`

`+L),Z("",L,!0,null,!1)}else{let L=`
: ${m}
${w.saveDate||""}`;F&&(L=F+`

`+L),Z("",L,!0,null,!1)}}catch(w){console.error(":",w),Z("","",!1,null,!1)}},X1=()=>{x2(async()=>{const{clearAllSaves:m}=await Promise.resolve().then(()=>Xj);return{clearAllSaves:m}},void 0,import.meta.url).then(({clearAllSaves:m})=>{m(),Z("","",!0,null,!1)})},Z1=(m,M)=>{if(c.resources.spiritStones<m.cost){Z("","",!1);return}if(c.resources.spiritStones<m.cost){Z("",`${m.name} ${m.cost} : ${c.resources.spiritStones}`,!1);return}const w=O.find(A=>A.id===M),F=Math.floor(m.baseIncome*(1+w.stats.intelligence/100));x({id:`${m.id}-${Date.now()}`,name:m.name,managerId:M,baseIncome:m.baseIncome,income:F,type:m.id,cost:m.cost}),rt(M,{job:m.id}),Z("",`${m.cost}${m.name}${w.name}: ${F}`,!0)},eb=(m,M)=>{if(c.resources.spiritStones<m.cost){Z("",`${m.name} ${m.cost} : ${c.resources.spiritStones}`,!1);return}if((c.energy||0)<5){Z("",`${m.name} 5 : ${c.energy||0}`,!1);return}E({spiritStones:m.cost}),j(5),ed({id:m.id,name:m.name,total:10}),Xs(M),Ia(1);const w=M.map(L=>{var z;return(z=O.find(U=>U.id===L))==null?void 0:z.name}).filter(Boolean).join(""),F=`${m.name}${w||""}`;Js([F,`${m.name}`,`${m.difficulty}${m.recommendCP}`]);const A=vh({realmId:m.id,progress:1});ni(A),ei(!0),Ae(F,"exploration")},tb=y.useCallback(m=>{var w;if(!m)return;const M=[m.tierTitle?`${m.tierTitle}`:null,typeof m.ageAtDeath=="number"?`${m.ageAtDeath}`:null,m.deathYear?` ${m.deathYear} ${m.deathMonth||1}`:null,m.deathReason?`${m.deathReason}`:null,(w=m.sect)!=null&&w.name?`${m.sect.name}${m.rank?`  ${m.rank}`:""}`:null,typeof m.descendants=="number"?`${m.descendants}`:null,m.influenceLabel?`${m.influenceLabel}`:null].filter(Boolean).join(`
`);Z(`  ${m.name}`,`${m.epitaph||""}

${M}`,!0,null,!1)},[Z]),nb=m=>{fe(M=>M.id===m.id,M=>{const w={...M,isTested:!0,spiritRoot:m.spiritRoot};return gt(w)})},xd=y.useCallback((m=!1)=>{var x0,y0,b0,v0,S0,w0,k0,E0;let M=[];const w=K=>m?!K.includes(""):!0;let F=[],A=0;const L=C.map(K=>{if(K.isPregnant){const ge=K.pregnancyProgress+1;if(ge>=9){const xe=Zk(c,K,Math.floor(c.age));F.push(xe),M.push(`${K.name}${xe.name}${xe.gender}${xe.tier}`),zt(c.newsBuffer||[],"BIRTH",{actor:c.name,target:xe.name,detail:xe.gender}),A+=1;let Me=pk(K,c,Math.floor(c.age),c.time.month,xe.name);const De=Math.random()>.7?"":"",We=Math.random()>.85;return Jr.onChildBirth(Me,xe,{difficulty:De,sacrifice:We}),{...Me,isPregnant:!1,pregnancyProgress:0}}return{...K,pregnancyProgress:ge}}return K});re(L),L.some(K=>{var xe;return(((xe=K.customFlags)==null?void 0:xe.isFumoLegend)||K.identity===""||K.identity==="")&&K.isPregnant&&K.pregnancyProgress===8})&&console.log(" NPC8 - ");const U=((x0=c.stats)==null?void 0:x0.health)||50,V=$t(U);b({energy:V});const D=((y0=c==null?void 0:c.time)==null?void 0:y0.year)??3572,{newChildren:oe,generation3Plus:ne,totalCost:te,logs:ae,events:Ie}=eE(O||[],c.resources,{familyRatingMultiplier:Oa,playerStrategy:c,childrenStrategy:c==null?void 0:c.childrenStrategy,generation3Plus:(c==null?void 0:c.generation3Plus)||[],currentYear:D});f(K=>({...K,generation3Plus:ne}));let de=[...oe];const Ye=new Set(((c==null?void 0:c.exiledChildren)||[]).map(K=>K.id)),Ke=de.filter(K=>{const ge=Math.floor(K.age*12);return ge>=72&&ge<78&&!K.isTested&&!Ye.has(K.id)});if(Ke.length>0){const K=new Set(Ke.map(xe=>xe.id));de=de.map(xe=>{var Me,De,We;if(K.has(xe.id)){const tt=((Me=xe.stats)==null?void 0:Me.aptitude)||50,ot=C.find(Tt=>Tt.name===xe.fatherName);let ut=null;if(ot&&(((De=ot.customFlags)==null?void 0:De.isFumoLegend)||ot.identity===""||ot.identity==="")&&(We=ot.spiritRoot)!=null&&We.type){let un=0;tt>=75?un=.85:tt>=70?un=.75:tt>=65?un=.6:tt>=60?un=.45:un=.2,Math.random()<un&&(ut={...ot.spiritRoot,multiplier:(ot.spiritRoot.multiplier||1)*.9})}ut||(ut=rr(tt,xe.spiritRoot,null,{constitution:xe.constitution}));const xt={...xe,spiritRoot:ut,isTested:!0};if(si||(xe.generation||1)>1){const Tt=gt(xt);return M.push({message:` ${xe.name} ${ut.type}${tt}`,category:""}),Tt}return xt}return xe});const ge=si?[]:de.filter(xe=>Ke.some(Me=>Me.id===xe.id)&&(xe.generation||1)===1);ge.length>0&&(cd(xe=>[...xe,...ge]),en&&Zn(!1))}F.length>0&&(de=[...de,...F]);const kt=de.reduce((K,ge)=>(lT(ge)?K.casualties.push(ge):K.survivors.push(ge),K),{survivors:[],casualties:[]});kt.casualties.length>0&&(Jo(kt.casualties,de),le&&kt.casualties.some(K=>K.id===le.id)&&_e(null)),pe(kt.survivors);const zn=Ie.filter(K=>K.type==="GRANDCHILD_BIRTH");if(A+=zn.length,A>0&&M.push(` ${A}${A}`),M=[...M,...ae],Ie.length>0){Ie.filter(xe=>xe.type==="ZHAOZHOU").forEach(xe=>{Z(xe.title,xe.message,!0,null,!1)});const K=Ie.filter(xe=>xe.type==="CHILD_PROMOTION_GIFT");if(K.length>0){const xe=K.map(Me=>{const De=typeof Me.message=="string"?Me.message:String(Me.message||"");return{...Me,message:De}});xe.length>=2&&!eo?(di(xe),e.openBatchPromotionModal()):xe.forEach(Me=>{const De=Me.giftItemId?br(Me.giftItemId):null;De&&d([De]);const We=Me.title||"";eo||Z(We,Me.message,!0,null,!1)})}const ge=Ie.filter(xe=>{var Me;return xe.type==="JOIN_SECT"&&!Ye.has((Me=xe.child)==null?void 0:Me.id)});if(ge.length>0)if(Zs){let xe=0;P(Me=>{if(!ge.find(ot=>{var ut;return((ut=ot.child)==null?void 0:ut.id)===Me.id})||!(Math.floor(Me.age*12)>=144)||!Me.isTested||Me.sect||Ye.has(Me.id))return Me;const tt=yd(Me);return tt?(xe++,{...Me,sect:tt,rank:Ki(Me,tt)}):Me}),xe>0&&Z("",` ${xe} `,!0)}else li(xe=>{const Me=[...xe,...ge];return Me.sort((De,We)=>{var ot,ut;return(((ot=De.child)==null?void 0:ot.name)||"").localeCompare(((ut=We.child)==null?void 0:ut.name)||"")}),Me}),en&&Zn(!1)}if(c.businesses&&c.businesses.length>0&&de){const{income:K,logs:ge}=wh(c.businesses,de);M=[...M,...ge],K>0&&M.push(` : ${K} `)}let _n=0;if(de.forEach(K=>{try{const ge=uc(K,{familyRatingMultiplier:Oa});typeof ge=="number"&&!isNaN(ge)&&isFinite(ge)?_n+=ge:console.warn("Invalid feedback for child:",K.name,ge)}catch(ge){console.error("Error calculating feedback for child:",K.name,ge)}}),c.rival&&!c.rival.isDead){const K=EC(c),ge=c.rival.threatLevel||0,xe=Math.min(100,ge+K);c.rival.threatLevel=xe,c.rival._threatChangeThisMonth={from:ge,to:xe,increased:K};const Me=wC(c);if(Me){const{survived:De,message:We,type:tt,hpLoss:ot}=Me,ut=De?"":"";m&&Zn(!1),M.push(`${ut}${We}`);let xt="";if(ot&&ot>0){const Cr=Math.max(10,Math.floor(ot*.2+Math.random()*ot*.2)),Tt=Wo(c,Cr,"ASSASSINATION");if(c.stats.health=Tt.newHealth,Tt.energyPenalty>0){const un=$t(Tt.newHealth);c.energy=Math.min(c.energy||20,un)}xt=Tt.message,Tt.isSerious&&M.push(" ")}zt(c.newsBuffer||[],tt||(De?"ASSASSINATION_SURVIVED":"ASSASSINATION_INJURED"),{actor:c.name}),Z("",xt?`${We}
${xt}`:We,De,null,!1)}if(c.time.month===12){const De=kC(c);De&&zt(c.newsBuffer||[],De.type,De.data)}}if(!((b0=c.rival)!=null&&b0.isDead)){const K=(v0=c.rival)==null?void 0:v0._threatChangeThisMonth,ge=(K==null?void 0:K.from)||0,xe=((S0=c.rival)==null?void 0:S0.threatLevel)||0;if(ge<100&&xe>=100){m&&Zn(!1),console.log("100%",{previousThreat:ge,currentThreat:xe});const De={currentExp:((w0=c.rival)==null?void 0:w0.currentExp)||300,stats:{aptitude:80}},We=$l(De),tt={name:"",combatStats:{hp:Math.floor(We*2.5),atk:Math.floor(We*.4),def:Math.floor(We*.2),mp:0,maxHp:Math.floor(We*2.5),maxMp:0}},ot={...c,combatStats:c.combatStats||{maxHp:100,maxMp:50,atk:10,def:5,hp:100,mp:50}},ut=xu(ot,tt);Zo({enemy:tt,result:ut,context:"rival"}),f(xt=>({...xt,rival:{...xt.rival,threatLevel:0}}))}}f(K=>{var Gr;const ge={...K.time};ge.month+=1,ge.month>12&&(ge.month=1,ge.year+=1);const xe=(K.age||16)+1/12,Me=sw(K);let De=((Gr=K.stats)==null?void 0:Gr.health)||50,We=K.energy||20;if(Me&&Me.recovered>0){De=Me.newHealth,M.push(Me.message);const Ha=$t(De);Ha>We&&(We=Ha)}const tt={...K,energy:We,stats:{...K.stats,health:De},resources:K.resources||{spiritStones:0,spiritualAwareness:0}},ot=Cn(tt.tier),ut=Dc(tt,!0),xt=typeof ut=="number"&&isFinite(ut)?ut:0,Cr=typeof _n=="number"&&isFinite(_n)?_n:0;let Tt=tt.currentExp+xt+Cr;(!isFinite(Tt)||isNaN(Tt))&&(console.error("Invalid newExp calculation:",{currentExp:tt.currentExp,playerSpeed:xt,totalFeedback:Cr}),Tt=tt.currentExp),Tt>=ot.maxExp&&(Tt=ot.maxExp);const{income:un}=wh(tt.businesses||[],de),fr={...tt,age:xe,skillPoints:(tt.skillPoints||0)+A,time:ge,currentExp:Tt,maxExp:(ot==null?void 0:ot.maxExp)||5e5,resources:{...tt.resources,spiritStones:Math.max(0,tt.resources.spiritStones-te+10+un)}};try{return{...fr,combatStats:Vn(fr)}}catch(Ha){return console.error("Error calculating combat stats:",Ha),fr}}),M.length===0&&M.push("..."),M.forEach(K=>{w(K)&&Ae(K)});const Ht=c.time.month===12?1:c.time.month+1,Rn=c.time.month===12?c.time.year+1:c.time.year;try{const ge=(c.time.year-3572)*12+c.time.month+1;if(ge%36===0){const xe=c.time.year+(Ht===1?1:0),Me=Xh(xe,{ownedFumoSwords:ur,soldAuctionItems:c.soldAuctionItems||[]}),De=ge,We=De+12;f(tt=>({...tt,lastAuctionYear:xe,currentAuction:Me,auctionWindowStart:De,auctionWindowEnd:We})),fi({id:`${xe}-${Date.now()}`,message:""}),Ae(" ")}}catch(K){console.warn("",K)}let Ur;try{Ur=Mk(L,c,Rn,Ht)}catch(K){console.error("Error processing NPC lifecycles:",K),Ur={npcs:L,events:[]}}const f0=(Ur==null?void 0:Ur.npcs)||L,vd=(Ur==null?void 0:Ur.events)||[],m0=vd.filter(K=>K.type==="NPC_LIFESPAN_ALERT");if(m0.length>0){const K=m0.map(ge=>{const xe=Math.max(0,Math.floor(ge.remainingYears));return`${ge.npcName} ${xe} `});Z("",K.join(`
`),!1,null,!1,{title:"",category:"",type:"WARNING"}),en&&Zn(!1)}const Fa=vd.filter(K=>K.type==="NPC_GIFT");if(Fa.length>0)if(Fa.length>=2&&!cn)ci(Fa),e.openBatchGiftModal();else{const K=[];if(Fa.forEach(ge=>{const xe=br(ge.giftItemId);if(xe){d([xe]);const Me=`${ge.message}${xe.name}`;Ae(Me),K.push(`${ge.message}
${xe.name}`)}}),!cn&&K.length>0){const ge=K.join(`

`);Z("",ge,!0,null,!1,{category:"",type:"NPC_GIFT",title:"",message:ge,details:ge,forceManual:!0})}}const yi=f0.filter(K=>!K.isDead),Sd=f0.filter(K=>K.isDead);Sd.length>0&&(H(K=>[...K,...Sd]),Sd.forEach(K=>{const ge=Vj(K,c,{year:Rn,month:Ht});ht.addMessage(ge)}),Cs(ht.getAllMessages())),Ht%3===0&&(yi.forEach(K=>{var Tt,un;if(!(K.sect||K.status==="away"))return;const xe=localStorage.getItem("acceptChildLetters")!=="false",Me=localStorage.getItem("acceptLoverLetters")!=="false",De=K.fatherName||K.motherName||K.generation||K.parent||K.parentId||((Tt=c.children)==null?void 0:Tt.some(fr=>fr.id===K.id)),We=K.id===((un=c.spouse)==null?void 0:un.id)||K.affection>60&&!De;if(De&&!xe||We&&!Me)return;const tt=ii[K.id]||0,ot=Rn*12+Ht,ut=ot-tt,Cr=ht.getAllMessages().find(fr=>fr.senderId===K.id&&fr.type===Rt.LETTER);if(Gj(K,ut,Cr)){const fr=ht.getRecentRepliesForNpc(K.id,3);$h(K,c,{year:Rn,month:Ht},!0,{apiKey:localStorage.getItem("game_api_key")||"",apiUrl:localStorage.getItem("game_api_url")||"https://api.deepseek.com/chat/completions",apiModel:localStorage.getItem("game_api_model")||"deepseek-chat",useAIForLetter:localStorage.getItem("useAIForLetter")!=="false"},{children:O,exiledChildren:c.exiledChildren||[],dualCultivationCount:K.dualCultivationCount||0,replyHistory:fr}).then(Gr=>{ht.addMessage(Gr),Cs(ht.getAllMessages())}).catch(Gr=>{console.error(":",Gr)}),Pf(Gr=>({...Gr,[K.id]:ot}))}}),Cs(ht.getAllMessages())),vd.forEach(K=>{var ge;if(K.type==="NPC_DEATH")M.push(` ${K.message}`),zt(c.newsBuffer||[],"DEATH",{actor:K.npcName,detail:K.age||0,location:""});else if(K.type==="NPC_BREAKTHROUGH"){M.push(` ${K.message}`),zt(c.newsBuffer||[],"NPC_BREAKTHROUGH",{actor:K.npcName,detail:K.newTier});const xe=yi.find(Me=>Me.name===K.npcName);xe&&((ge=xe.relationship)==null?void 0:ge.affection)>=70&&Math.random()<.4&&zt(c.newsBuffer||[],"NPC_AFFECTION_HIGH",{actor:c.name,target:xe.name})}else K.type==="NPC_BREAKTHROUGH_FAIL"&&zt(c.newsBuffer||[],"BREAKTHROUGH_FAIL",{actor:K.npcName,detail:K.tier})});const wd=hk(yi,c,Rn,Ht),Rb=wd.map(K=>{K.jealousy||(K.jealousy=0),K.lastInteraction||(K.lastInteraction={year:Rn,month:Ht});const ge=Rn*12+Ht,xe=K.lastInteraction.year*12+K.lastInteraction.month,Me=ge-xe;if(Me>=3){const{jealousyGain:De,shouldLog:We}=Oj(K,Me);if(De>0&&(K.jealousy=Math.min(100,(K.jealousy||0)+De),We)){const tt=uh(K,K.jealousy,{year:Rn,month:Ht},c.name,"neglect");tt&&(K.logs=[...K.logs||[],tt])}}if(K.jealousy>0){const De=Pj(K);K.jealousy=Math.max(0,K.jealousy-De)}return K});re(Rb);const h0=ej(Rn,Ht,c,wd),g0=ij(c,de,Rn,Ht);g0&&h0.push(g0),h0.forEach(K=>{Ae(K.message,K.category,K.type,K.title)});let bi=c.worldNpcs||[];if(Ht%3===0&&bi.length>0&&(bi=Kh(bi,Rn),b({worldNpcs:bi})),Ht%3===0)if(localStorage.getItem("enableGazette")!=="false"){const ge=c.newsBuffer||[],xe=ge.length>0?ge:[{type:"FILLER",data:{},timestamp:Date.now()}];localStorage.getItem("game_api_key"),localStorage.getItem("game_api_url"),localStorage.getItem("game_api_model"),localStorage.getItem("useAIForGazette");const Me={...c,worldNpcs:bi};b({newsBuffer:[],hasUnreadGazette:!1}),Promise.resolve(fC(xe,Me,wd,(Me.gazetteIssue||0)+1)).then(De=>{De&&(b({gazetteHistory:[...Me.gazetteHistory||[],De],gazetteIssue:De.issue,hasUnreadGazette:!0}),Ma(De))}).catch(De=>{console.error(":",De),g()})}else b({newsBuffer:[]});if(Ht===1&&Ht!==3){const K=Kh(c.worldNpcs||[],Rn);b({worldNpcs:K}),K.forEach(ge=>{ge.status==="DEAD"&&ge.deathYear===Rn&&(zt(c.newsBuffer||[],"DEATH",{actor:`${ge.title} ${ge.name}`,detail:ge.age,location:ge.deathReason||""}),Ae(` ${ge.rank?`${ge.rank}`:""}${ge.title} ${ge.name}${ge.deathReason}`))})}if(Ht%3===0)if(W)to.length>0&&mi([]);else{const K=zj(yi);if(K){const ge=Dj(K.participants,c),xe=ge.participants.map(We=>We.name),Me=xe[0]||"",De=xe[1]||"";zt(c.newsBuffer,"SHURA_FIELD",{actor:c.name,dominant:Me,rival:De,participants:xe.join(""),count:xe.length}),X(We=>{if(!ge.participants.find(un=>un.id===We.id))return We;const ot=typeof We.personality=="object"&&We.personality!==null&&"label"in We.personality?We.personality.label:Array.isArray(We.personality)?We.personality[0]:"",ut=c.gender===""?"":"";let xt="";switch(ot){case"":xt=`...${c.name}${c.name}`;break;case"":xt=`...${c.name}${ut}${ut}`;break;case"":xt=`${c.name}...`;break;case"":xt=`${c.name}.........`;break;case"":xt=`${c.name}${ut}...`;break;case"":xt=`${c.name}...`;break;case"":xt=`...${c.name}""...`;break;case"":xt=`${c.name}......`;break;case"":xt=`${c.name}${ut}...`;break;default:xt=`...${c.name}${ut}...`}const Cr=We.logs||[],Tt={year:c.time.year,month:c.time.month,content:xt,type:"DAILY",isSecret:!0,timestamp:Date.now()};return{...We,logs:[Tt,...Cr].slice(0,50)}}),mi(We=>[...We,ge]),en&&Zn(!1),Ae(" ...")}}const Mb=((k0=c==null?void 0:c.time)==null?void 0:k0.year)??0,kd=((E0=c==null?void 0:c.time)==null?void 0:E0.month)??0,Ed=`${Mb}-${kd}`,Ab=Ff.current===Ed,Nb=$a.current===Ed,Lb=Hf&&kd%2===0;if(!Ab&&!Nb&&kd>0&&!Lb)try{const K=lu(c.newsBuffer),ge={player:c,children:O,fallenChildren:ie,activeNpcs:yi,deadNpcs:k,gameStage:_t,logs:ys,inventory:l,messages:ht.toJSON(),lastMessageCheck:ii,pendingSectChoices:ai,testQueue:Ts,worldEvents:c.worldEvents||[],newsBuffer:K};Df(ge,Ed)}catch(K){console.error(":",K)}},[O,c,C,Ts,eo,W,cn,en,to,Jo,le,_e,_t,ys,l,ht,ii,ai,Df,Hf]);y.useEffect(()=>{C.some(M=>M.isPregnant&&M.pregnancyProgress===8)&&en&&console.warn(" NPC8")},[C,en]);const rb=(m,M,w="")=>{var U,V;const F=Sy(M),A=O.find(D=>D.id===m);if(!A)return;const L=ky(A,F);if(!L.qualified){Z("",((U=L.reasons)==null?void 0:U.join(""))||"",!1);return}fe(D=>D.id===m,D=>{const oe={...D,sect:F,rank:w},ne=C.find(Ie=>Ie.name===D.fatherName||Ie.name===D.motherName);ne&&Jr.onChildJoinSect(ne,D,F.name),localStorage.getItem("acceptChildLetters")!=="false"&&$h({id:D.id,name:D.name,gender:D.gender,sect:F.name,tier:D.tierTitle,fatherName:D.fatherName,generation:D.generation,affection:100,relationship:{affection:100,stage:0}},c,{year:Math.floor(c.age),month:c.time.month},!0,{apiKey:localStorage.getItem("game_api_key")||"",apiUrl:localStorage.getItem("game_api_url")||"https://api.deepseek.com/chat/completions",apiModel:localStorage.getItem("game_api_model")||"deepseek-chat",useAIForLetter:localStorage.getItem("useAIForLetter")!=="false"},{children:O,exiledChildren:c.exiledChildren||[],replyHistory:ht.getRecentRepliesForNpc(D.id,3)}).then(Ie=>{ht.addMessage(Ie),Cs(ht.getAllMessages())}).catch(Ie=>{console.error(":",Ie)}),zt(c.newsBuffer||[],"JOIN_SECT",{actor:c.name,target:D.name,detail:F.name});const ae=HC(oe,F.name);return ae&&Ae(ae,"cultivation"),gt(oe)}),li(D=>D.filter(oe=>oe.child.id!==m));const z=((V=O.find(D=>D.id===m))==null?void 0:V.name)||"";Ae(` ${z} ${F.name}`,"")};y.useEffect(()=>{let m;if(en){const M=()=>{xd(!0),m=setTimeout(M,1e3/vs)};m=setTimeout(M,1e3/vs)}return()=>clearTimeout(m)},[en,vs,xd]),y.useEffect(()=>{if(tr){Ba.length>0&&md([]);return}if(Ba.length>0&&!t.type){const m=Ba[0];i({type:"JEALOUSY",data:m}),md(M=>M.slice(1))}},[Ba,t.type,tr]),y.useEffect(()=>{if(W){to.length>0&&mi([]);return}if(to.length!==0){if(t.type==="RESULT"&&Wf!==!1){i({type:null,data:null});return}if(!t.type){const m=to[0];i({type:"SHURA_FIELD",data:m}),mi(M=>M.slice(1))}}},[to,t.type,Wf,W]),y.useEffect(()=>{var M,w,F,A;if(!le)return;const m=ee.find(L=>L.id===le.id);m&&(m.name!==le.name||m.cultivation!==le.cultivation||((M=m.stats)==null?void 0:M.aptitude)!==((w=le.stats)==null?void 0:w.aptitude)||((F=m.influenceProfile)==null?void 0:F.tierId)!==((A=le.influenceProfile)==null?void 0:A.tierId)||m.isFavorite!==le.isFavorite)&&_e(m)},[ja,ee,le,_e]);const sb=m=>{const M=O.find(F=>F.id===m);if(!M)return;if(Math.floor(M.age*12)<216){Z("","18",!1,null,!1);return}if(c.resources.spiritStones<500){Z("",` 500 : ${c.resources.spiritStones}`,!1);return}const w=Sh(M.tierTitle||"",M.gender);ud(w),pd(M),dd(!0)},ob=m=>{if(!La)return;fe(w=>w.id===La.id,w=>{const F=C.find(A=>A.name===w.fatherName||A.name===w.motherName);if(F){Jr.onChildMarriage(F,w,m.name);const A=ph(F,c,Math.floor(c.age),c.time.month,m.name);q(F.id,A)}return{...w,spouse:m}}),E({spiritStones:500}),Ae(` 500 ${La.name}  ${m.name} `),dd(!1),ud([]),pd(null)},ib=(m,M,w)=>{var F,A;if(M==="CHAT"){const L=O.find(D=>D.id===m);if(!L)return;if((c.energy||0)<=0){Z("","",!1);return}j(1);const z={...L,isChild:!0,relationship:{affection:100}},U=ou(z,c);if(U){Z((U==null?void 0:U.title)||"",(U==null?void 0:U.text)||"",!0,null);return}const V=[`${L.name}`,`${L.name}`,`${L.name}${L.gender===""?"":""}`,`${L.name}"${c.gender===""?"":""}"`,`${L.name}`];Z("",V[Math.floor(Math.random()*V.length)],!0,null);return}if(M==="MARRY"){sb(m);return}if(M==="RENAME"&&(rt(m,{name:w}),_e(L=>L&&L.id===m?{...L,name:w}:L),Z("","",!0)),M==="FEED_PILL"){if(c.resources.spiritStones<100){Z("",` 100 : ${c.resources.spiritStones}`,!1);return}const z=O.find(oe=>oe.id===m);if(!z)return;const U=500*(1+(((F=z.stats)==null?void 0:F.aptitude)||0)/100),V=tn(z,U);E({spiritStones:100}),fe(oe=>oe.id===m,oe=>{var ae;const ne=500*(1+(((ae=oe.stats)==null?void 0:ae.aptitude)||0)/100),te=tn(oe,ne);return gt(te.updated)}),_e(oe=>{var ne;if(oe&&oe.id===m){const te=500*(1+(((ne=oe.stats)==null?void 0:ne.aptitude)||0)/100),ae=tn(oe,te);return gt(ae.updated)}return oe});const D=V.tierChanged?`

 ${z.name} ${V.newTier} ${V.lifespanIncrease} `:"";Z("",`${D}`,!0)}if(M==="EDUCATE"){if(c.resources.spiritStones<50){Z("",` 50 : ${c.resources.spiritStones}`,!1);return}E({spiritStones:50});const z=O.find(D=>D.id===m),U=z?tn(z,Math.floor((((A=z.stats)==null?void 0:A.aptitude)||50)*5)):null;fe(D=>D.id===m,D=>{var te;const oe=Math.floor((((te=D.stats)==null?void 0:te.aptitude)||50)*5),ne=tn(D,oe);return gt(ne.updated)}),_e(D=>{var oe;if(D&&D.id===m){const ne=Math.floor((((oe=D.stats)==null?void 0:oe.aptitude)||50)*5),te=tn(D,ne);return gt(te.updated)}return D});const V=U!=null&&U.tierChanged?`

 ${(z==null?void 0:z.name)||""} ${U.newTier} ${U.lifespanIncrease} `:"";Z("",`${(le==null?void 0:le.name)||""} ${V}

 `,!0)}if(M==="OPEN_INVENTORY"&&e.openInventory((w==null?void 0:w.mode)||"VIEW",(w==null?void 0:w.slot)||null,m),M==="UNEQUIP"){const L=w==null?void 0:w.slot;if(!L)return;const z=O.find(D=>D.id===m);if(!z)return;const U=xi(z),V=U.equipment[L];if(!V)return;a.setInventory(D=>[V,...D]),fe(D=>D.id===m,D=>{const oe={...U,equipment:{...U.equipment,[L]:null}};return gt(oe)}),_e(D=>{if(D&&D.id===m){const oe={...U,equipment:{...U.equipment,[L]:null}};return gt(oe)}return D})}if(M==="CHANGE_MANUAL"){if(!O.find(U=>U.id===m))return;if(l.filter(U=>U.type==="manual").length===0){Z("","",!1);return}e.openInventory("MANUAL_SELECT",null,m)}if(M==="SELECT_SECT"){const L=O.find(V=>V.id===m);if(!L)return;if(Math.floor(L.age*12)<144){Z("","12",!1);return}if(!L.isTested){Z("","",!1);return}const{recommended:z,others:U}=yp(L);if(!z.length&&!U.length){Z("","",!1);return}li([{type:"JOIN_SECT",title:"",message:`${L.name} `,child:L,selectableSects:z,otherSectOptions:U,showModal:!0}]),en&&Zn(!1)}if(M==="TOGGLE_AUTO_JOIN_SECT"){const L=!!w;rt(m,{autoJoinBestSect:L}),_e(z=>z&&z.id===m?{...z,autoJoinBestSect:L}:z),Z("",L?"":"",!0);return}if(M==="EXPEL"){const L=O.find(z=>z.id===m);if(!L)return;At(m),b({exiledChildren:[...c.exiledChildren||[],L]}),_e(null),Ae(` ${L.name} `),Z("",`${L.name} `,!0);return}},yd=m=>{const{recommended:M,others:w}=yp(m),F=[...M,...w],A=F.filter(L=>{var z;return(z=L.admission)==null?void 0:z.qualified});return A.length?A[0].sect:F.length?F[0].sect:null},ab=m=>{if(od(!!m),!m){Z("","",!0);return}let M=0;P(w=>{if(!(Math.floor(w.age*12)>=144)||!w.isTested||w.sect)return w;const A=yd(w);return A?(M++,{...w,sect:A,rank:Ki(w,A)}):w}),Z("",` ${M} `,!0)},lb=()=>{var z;const M=((z=c==null?void 0:c.resources)==null?void 0:z.spiritStones)||0,w=O.filter(U=>!U.spouse&&Math.floor((U.age||0)*12)>=216).sort((U,V)=>{var D,oe;return(((D=V.stats)==null?void 0:D.aptitude)||0)-(((oe=U.stats)==null?void 0:oe.aptitude)||0)});if(!w.length){Z("","18",!1);return}const F=Math.min(w.length,Math.floor(M/500));if(F<=0){Z(""," 500 ",!1);return}const L=w.slice(0,F).map(U=>{const D=(Sh(U.tierTitle||"",U.gender)||[]).reduce((oe,ne)=>{var Ie,de,Ye,Ke;if(!oe)return ne;const te=((Ie=ne.stats)==null?void 0:Ie.aptitude)||0,ae=((de=oe.stats)==null?void 0:de.aptitude)||0;return te===ae?(((Ye=ne.stats)==null?void 0:Ye.intelligence)||0)>(((Ke=oe.stats)==null?void 0:Ke.intelligence)||0)?ne:oe:te>ae?ne:oe},null)||tE(U.tierTitle||"",U.gender);return{childId:U.id,childName:U.name,spouse:D,childRef:U}});if(!L.length){Z("","",!1);return}ui(L),e.openBatchMarriageModal()},cb=m=>{var U;if(!m||m.length===0){e.closeBatchMarriageModal(),ui([]);return}const M=new Map(m.map(V=>[V.childId,V]));P(V=>{const D=M.get(V.id);return D?{...V,spouse:D.spouse}:V}),_e(V=>V&&M.has(V.id)?{...V,spouse:M.get(V.id).spouse}:V);const w=Math.floor((c==null?void 0:c.age)||0),F=((U=c==null?void 0:c.time)==null?void 0:U.month)??1,A=new Map;m.forEach(V=>{var ne,te;const D=V.childRef,oe=C.find(ae=>ae.name===D.fatherName||ae.name===D.motherName);if(oe&&!A.has(oe.id)){Jr.onChildMarriage(oe,D,(ne=V.spouse)==null?void 0:ne.name);const ae=ph(oe,c,w,F,(te=V.spouse)==null?void 0:te.name);A.set(oe.id,ae)}}),A.size&&ye(A);const L=m.length*500;E({spiritStones:L});const z=m.map(V=>{var D,oe,ne;return` ${V.childName}  ${((D=V.spouse)==null?void 0:D.name)||""}${((ne=(oe=V.spouse)==null?void 0:oe.stats)==null?void 0:ne.aptitude)??"?"}`}).join(`
`);Ae(`  ${m.length} 
${z}`),Z("",` ${L}  ${m.length} 
${z}`,!0),e.closeBatchMarriageModal(),ui([])},db=m=>{id(!!m),Z(m?"":"",m?"":"",!0)},ub=m=>{ad(!!m),Z(m?"":"",m?"":"",!0)},pb=m=>{oi(!!m),b({childrenStrategy:{...c.childrenStrategy,skipZhaozhou:!!m}}),Z(m?"":"",m?"":"",!0)},fb=m=>{Le(!!m),m&&mi([]),Z(m?"":"",m?"":"",!0)},mb=m=>{dn(!!m),Z(m?"":"",m?"":"",!0)},hb=m=>{js(!!m),Z(m?"":"",m?"":"",!0)},e0=(m,M,w)=>{const F=l.find(U=>U.instanceId===w);if(!F)return Z("","",!1);if(F.slot!==M)return Z("","",!1);const A=O.find(U=>U.id===m);if(!A)return;const L=xi(A),z=L.equipment[M];fe(U=>U.id===m,U=>{const V={...L,equipment:{...L.equipment,[M]:F}};return gt(V)}),_e(U=>{if(U&&U.id===m){const V={...L,equipment:{...L.equipment,[M]:F}};return gt(V)}return U}),a.setInventory(U=>{const V=U.filter(D=>D.instanceId!==w);return z?[z,...V]:V}),e.closeInventory(),Z("",`${A.name}  ${F.name}`,!0)},bd=(m,M)=>{var oe;const w=l.find(ne=>ne.instanceId===M);if(!w)return Z("","",!1);const F=!m,A=F?null:O.find(ne=>ne.id===m);if(!F&&!A)return Z("","",!1);const L=F?ft.PLAYER:ft.CHILD;if(!_s(w,L)){Z("",`${w.name||""}  ${uo(w)} `,!1);return}if(w.type==="manual"){const ne=w.manualIds||[];if(ne.length===0)return Z("","",!1);const te=ne[Math.floor(Math.random()*ne.length)],ae=hn[te];if(!ae)return Z("","",!1);if(F){f(de=>{const Ye={...de,cultivationMethod:te};return gt(Ye)}),e.closeInventory(),Z("",` ${ae.name||te}`,!0);return}const Ie=zh(A,te);if(!Ie.success)return Z("",Ie.message,!1);fe(de=>de.id===m,de=>{const Ye={...de,cultivationMethod:te};return gt(Ye)}),_e(de=>{if(de&&de.id===m){const Ye={...de,cultivationMethod:te};return gt(Ye)}return de}),e.closeInventory(),Ae(Ie.message),Z("",Ie.message+"",!0,{:((oe=Ie.compatibility)==null?void 0:oe.desc)||""});return}if(["weapon","armor","accessory"].includes(w.type)){if(F){f(ne=>{const te=xi(ne),ae={...te,equipment:{...te.equipment,[w.slot]:w}};return gt(ae)}),a.setInventory(ne=>ne.filter(te=>te.instanceId!==M)),e.closeInventory(),Z("",` ${w.name}`,!0);return}e0(m,w.slot,M);return}if(w.type!=="consumable")return Z("","",!1);const z=w.effect||{};if(F){f(te=>{var Ie,de;let ae={...te};if(z.kind==="exp")ae.currentExp=(ae.currentExp||0)+(z.amount||0);else if(z.kind==="aptitude"){const Ye=Math.min(100,(((Ie=ae.stats)==null?void 0:Ie.aptitude)||50)+(z.amount||0));ae={...ae,stats:{...ae.stats,aptitude:Ye}};try{const Ke=rr(Ye,ae.spiritRoot,null,{constitution:ae.constitution});ae={...ae,spiritRoot:Ke}}catch{}}else if(z.kind==="heal"){const Ye=((de=ae.stats)==null?void 0:de.health)||100,Ke=Math.min(100,Ye+(z.amount||0));ae={...ae,stats:{...ae.stats,health:Ke}};const kt=$t(Ye),zn=$t(Ke),_n=zn-kt;_n>0&&(ae.energy=Math.min(zn,(ae.energy||0)+_n))}return gt(ae)}),u(M,w.stackable?1:void 0),e.closeInventory();let ne=`  ${w.name}`;z.kind==="exp"&&(ne+=` +${z.amount}`),z.kind==="aptitude"&&(ne+=` +${z.amount}`),z.kind==="heal"&&(ne+=""),Z("",ne,!0);return}const U=z.kind==="exp"?z.amount||0:z.kind==="heal"?Math.floor((z.amount||0)*2):0,V=U>0?tn(A,U):null;fe(ne=>ne.id===m,ne=>{var ae;let te={...ne};if(z.kind==="exp"||z.kind==="heal")te=tn(te,U).updated;else if(z.kind==="aptitude"){const Ie=Math.min(100,(((ae=te.stats)==null?void 0:ae.aptitude)||50)+(z.amount||0));if(te={...te,stats:{...te.stats,aptitude:Ie}},te.isTested||te.spiritRoot&&Array.isArray(te.spiritRoot.elements))try{const de=rr(Ie,te.spiritRoot,null,{constitution:te.constitution});te={...te,spiritRoot:de}}catch{}}return gt(te)}),_e(ne=>{var te;if(ne&&ne.id===m){let ae={...ne};if(z.kind==="exp"||z.kind==="heal")ae=tn(ae,U).updated;else if(z.kind==="aptitude"){const Ie=Math.min(100,(((te=ae.stats)==null?void 0:te.aptitude)||50)+(z.amount||0));if(ae={...ae,stats:{...ae.stats,aptitude:Ie}},ae.isTested||ae.spiritRoot&&Array.isArray(ae.spiritRoot.elements))try{const de=rr(Ie,ae.spiritRoot,null,{constitution:ae.constitution});ae={...ae,spiritRoot:de}}catch{}}return gt(ae)}return ne}),u(M,w.stackable?1:void 0),e.closeInventory();let D=`${A.name}  ${w.name}`;z.kind==="exp"&&(D+=`+${z.amount}`),z.kind==="aptitude"&&(D+=`+${z.amount}`),z.kind==="heal"&&(D+=""),V!=null&&V.tierChanged&&(D+=`

 ${A.name} ${V.newTier} ${V.lifespanIncrease} `),Z("",D,!0)},gb=(m,M)=>{if(!M||M.length===0){Z("","",!1);return}const w=!m,F=w?c:O.find(ne=>ne.id===m);if(!w&&!F){Z("","",!1);return}let A=0,L=0,z=0,U=[];M.forEach(ne=>{const te=l.find(kt=>kt.instanceId===ne.instanceId);if(!te||!te.effect)return;const ae=Math.min(ne.quantity||1,te.quantity||1);if(ae<=0)return;const Ie=w?ft.PLAYER:ft.CHILD;if(!_s(te,Ie))return;const de=te.effect,Ke=(de.amount||0)*ae;de.kind==="exp"?A+=Ke:de.kind==="aptitude"?L+=Ke:de.kind==="heal"&&(z+=Ke),U.push({name:te.name,quantity:ae,effect:de.kind}),u(te.instanceId,ae)});const V=w?0:A+Math.floor(z*2),D=!w&&V>0?tn(F,V):null;w?f(ne=>{var ae,Ie;let te={...ne};if(A>0&&(te.currentExp=(te.currentExp||0)+A),L>0){const de=Math.min(100,(((ae=te.stats)==null?void 0:ae.aptitude)||50)+L);te={...te,stats:{...te.stats,aptitude:de}};try{const Ye=rr(de,te.spiritRoot,null,{constitution:te.constitution});te={...te,spiritRoot:Ye}}catch{}}if(z>0){const de=((Ie=te.stats)==null?void 0:Ie.health)||100,Ye=Math.min(100,de+z);te={...te,stats:{...te.stats,health:Ye}};const Ke=$t(de),kt=$t(Ye),zn=kt-Ke;zn>0&&(te.energy=Math.min(kt,(te.energy||0)+zn))}return gt(te)}):(fe(ne=>ne.id===m,ne=>{var ae;let te={...ne};if(V>0&&(te=tn(te,V).updated),L>0){const Ie=Math.min(100,(((ae=te.stats)==null?void 0:ae.aptitude)||50)+L);if(te={...te,stats:{...te.stats,aptitude:Ie}},te.isTested||te.spiritRoot&&Array.isArray(te.spiritRoot.elements))try{const de=rr(Ie,te.spiritRoot,null,{constitution:te.constitution});te={...te,spiritRoot:de}}catch{}}return gt(te)}),_e(ne=>{var te;if(ne&&ne.id===m){let ae={...ne};if(V>0&&(ae=tn(ae,V).updated),L>0){const Ie=Math.min(100,(((te=ae.stats)==null?void 0:te.aptitude)||50)+L);if(ae={...ae,stats:{...ae.stats,aptitude:Ie}},ae.isTested||ae.spiritRoot&&Array.isArray(ae.spiritRoot.elements))try{const de=rr(Ie,ae.spiritRoot,null,{constitution:ae.constitution});ae={...ae,spiritRoot:de}}catch{}}return gt(ae)}return ne}));let oe=`${w?"":F.name}  ${U.length} 
`;U.forEach(ne=>{oe+=`
 ${ne.name} x${ne.quantity}`}),A>0&&(oe+=`

+${A}`),L>0&&(oe+=`
+${L}`),z>0&&(oe+=`
+${z}`),D!=null&&D.tierChanged&&(oe+=`

 ${F.name} ${D.newTier} ${D.lifespanIncrease} `),Z("",oe,!0),e.closeInventory()},Da=y.useCallback(()=>{hd({open:!1,item:null,items:null,isBatch:!1})},[]),xb=y.useCallback(()=>{dd(!1),ud([]),pd(null)},[]),yb=y.useCallback(m=>{m.forEach(M=>{const w=br(M.giftItemId);w&&(d([w]),Ae(`${M.message}${w.name}`))}),e.closeBatchGiftModal(),ci([]),Z("",` ${m.length} `,!0)},[br,d,Ae,e,ci,Z]),bb=y.useCallback(()=>{e.closeBatchGiftModal(),ci([])},[e,ci]),vb=y.useCallback(m=>{m.forEach(M=>{const w=M.giftItemId?br(M.giftItemId):null;w&&d([w])}),e.closeBatchPromotionModal(),di([]),Z("",` ${m.length} `,!0)},[br,d,e,di,Z]),Sb=y.useCallback(()=>{e.closeBatchPromotionModal(),di([])},[e,di]),wb=y.useCallback(()=>{e.closeBatchMarriageModal(),ui([])},[e,ui]),kb=y.useCallback(m=>{if(Is.isBatch&&Is.items){let M=0,w=0,F=0,A=0,L=[];Is.items.forEach(V=>{const D=typeof V=="object"?V.instanceId:V,oe=typeof V=="object"&&V.quantity?V.quantity:1;for(let ne=0;ne<oe;ne++){const te=l.find(Ie=>Ie.instanceId===D);if(!te)continue;const ae=te.effect||{};if(ae.kind==="exp"||ae.kind==="heal"){const Ie=ae.kind==="exp"?ae.amount||0:Math.floor((ae.amount||0)*2);F+=Ie;const de=tn(m,Ie);de!=null&&de.tierChanged&&L.push({newTier:de.newTier,lifespanIncrease:de.lifespanIncrease})}else ae.kind==="aptitude"&&(A+=ae.amount||0);u(D,te.stackable?1:void 0),M++}w++}),fe(V=>V.id===m.id,V=>{var oe;let D={...V};if(F>0&&(D=tn(D,F).updated),A>0){const ne=Math.min(100,(((oe=D.stats)==null?void 0:oe.aptitude)||50)+A);if(D={...D,stats:{...D.stats,aptitude:ne}},D.isTested||D.spiritRoot&&Array.isArray(D.spiritRoot.elements))try{const te=rr(ne,D.spiritRoot,null,{constitution:D.constitution});D={...D,spiritRoot:te}}catch{}}return gt(D)}),_e(V=>{var D;if(V&&V.id===m.id){let oe={...V};if(F>0&&(oe=tn(oe,F).updated),A>0){const ne=Math.min(100,(((D=oe.stats)==null?void 0:D.aptitude)||50)+A);if(oe={...oe,stats:{...oe.stats,aptitude:ne}},oe.isTested||oe.spiritRoot&&Array.isArray(oe.spiritRoot.elements))try{const te=rr(ne,oe.spiritRoot,null,{constitution:oe.constitution});oe={...oe,spiritRoot:te}}catch{}}return gt(oe)}return V});let z=` ${w}  ${M}  ${m.name}`,U={};if(F>0&&(z+=`
 +${F}`,U.=`+${F}`),A>0&&(z+=`
 +${A}`,U.=`+${A}`),L.length>0){const V=L[L.length-1];z+=`

 ${m.name} ${V.newTier} ${V.lifespanIncrease} `}Z("",z,!0,Object.keys(U).length>0?U:null),Da(),e.closeInventory()}else Is.item&&(bd(m.id,Is.item.instanceId),Da(),e.closeInventory())},[Is,bd,Z,Da,e,l,u,fe,_e,tn,gt,rr]),Eb=y.useCallback(m=>{const M=l.find(w=>w.instanceId===m);if(M){if(!_s(M,ft.CHILD)){Z("",`${M.name||""}  ${uo(M)} `,!1);return}hd({open:!0,item:M})}},[l,_s,ft,Z,uo]),jb=y.useCallback(m=>{if(m.length===0)return;const M=m.map(F=>{const A=typeof F=="object"?F.instanceId:F,L=typeof F=="object"&&F.quantity?F.quantity:1,z=l.find(U=>U.instanceId===A);return z?{...z,giveQuantity:L}:null}).filter(Boolean);if(M.length===0)return;const w=M.filter(F=>!_s(F,ft.CHILD));if(w.length>0){const F=w.slice(0,3).map(L=>L.name).join(""),A=w.length>3?" ":"";Z("",`${F}${A}  ${uo(w[0])} `,!1);return}hd({open:!0,items:M.map(F=>({instanceId:F.instanceId,quantity:F.giveQuantity||1})),isBatch:!0})},[l,_s,ft,Z,uo]),Cb=y.useCallback(()=>{const m=Ts[0];m&&rt(m.id,{isTested:!0}),cd(M=>M.slice(1))},[Ts,rt]),Tb=()=>{if(l.filter(w=>w.type==="manual"&&(w.manualIds&&w.manualIds.length||w.manualId)).length===0){Z("","",!1);return}if(!(Pn.length?Pn:O).length){Z("","",!1);return}e.openBatchManualModal()},Ib=m=>{if(!m||m.length===0){e.closeBatchManualModal();return}let M=0;const w=[];m.forEach(F=>{const A=O.find(U=>U.id===F.childId);if(!A)return;const L={...A},z=zh(L,F.manualId);if(z.success){const U=gt({...L});w.push(U),M++,Ae(z.message)}}),w.length>0&&(P(F=>w.find(L=>L.id===F.id)||F),_e(F=>F&&(w.find(L=>L.id===F.id)||F))),Z("",` ${M} `,!0),e.closeBatchManualModal()},t0=()=>{const m=nE(c);m.success?(f(M=>{var L,z;const w=((L=M.stats)==null?void 0:L.aptitude)||50,F=((z=M.spiritRoot)==null?void 0:z.type)||"",A=Ho(m.newTier,w,F,M.equipment);return{...M,tier:m.newTier,currentExp:0,maxExp:m.newMaxExp,breakthroughBonus:0,breakthroughFailCount:0,combatStats:A}}),zt(c.newsBuffer||[],"LEVEL_UP",{actor:c.name,detail:m.newTier}),Z("",m.msg,!0,{:""},!1)):(f(M=>{const w=(M.breakthroughFailCount||0)+1,F=(M.breakthroughBonus||0)+5;return{...M,currentExp:Math.max(0,M.currentExp-m.penalty),breakthroughFailCount:w,breakthroughBonus:F}}),Z("",m.msg,!1,{:-m.penalty},!1))},_b=m=>{if((c.skillPoints||0)<=0){Ae(" ");return}f(M=>{const w={...M,skillPoints:M.skillPoints-1};if(m==="aptitude"){const F=Math.min(100,(w.stats.aptitude||20)+1),A=Pk(w,F);return Ae(` 1 ${A.stats.aptitude}`),A}else m==="combatPower"?(w.combatStats={...w.combatStats,maxHp:w.combatStats.maxHp+50,hp:w.combatStats.maxHp+50,atk:w.combatStats.atk+5,def:(w.combatStats.def||0)+3},Ae(" 1+50+5+3")):m==="breakthrough"&&(w.breakthroughBonus=(w.breakthroughBonus||0)+5,Ae(` 15%: ${w.breakthroughBonus}%`));return w})};return r.jsxs("div",{style:Bm.appContainer,children:[ke&&r.jsx(tC,{onComplete:()=>je(!1)}),Ge&&r.jsx(eC,{onConfirm:()=>Jt(!1),onExit:()=>{window.location.href="about:blank"}}),r.jsx(fE,{player:c,isAuto:en,onBreakthrough:t0,auctionBanner:fd}),_t==="PROLOGUE"?r.jsx(Zj,{onFinish:Q1,onLoadGame:Zf}):r.jsxs("div",{style:Bm.mainContent,children:[r.jsx(L5,{player:c,onBreakthroughClick:t0}),Xn==="FAMILY"&&r.jsx($5,{player:c,visibleChildren:Pn,pregnantNpcs:C.filter(m=>{var M;return m.isPregnant&&!((M=m.relationship)!=null&&M.cutTies)}),fallenChildren:ie,exiledChildren:(c==null?void 0:c.exiledChildren)||[],generation3Plus:(c==null?void 0:c.generation3Plus)||[],onChildClick:m=>{m.isEmbryo?Z("",`${m.npc.name} ...

 

: ${m.npc.pregnancyProgress||0}/9`,!0,null,!1):_e(m)},onToggleFavorite:Oe,onMemorialClick:tb}),Xn==="NPC"&&r.jsx(P5,{sortedNpcs:er,pagedNpcs:Kc,deadNpcs:k,npcSort:ws,npcPage:Qs,npcPageCount:Es,hasNpcPagination:Qc,showFollowedOnly:Ss,onExplore:q1,onSortChange:qc,onToggleFollowedOnly:Yc,onPrevPage:()=>ks(m=>Math.max(0,m-1)),onNextPage:()=>ks(m=>Math.min(Math.max(0,Es-1),m+1)),onNpcInteract:m=>Qf(m.id,"DETAIL"),onNpcAction:Qf}),Xn==="ACTION"&&r.jsx(z5,{player:c,children:Pn,showBizPanel:e.showBizPanel,showChallengePanel:e.showChallengePanel,idleManagerOptions:Uc,onDailyAction:H1,onShopping:W1,onOpenInventory:e.openInventory,onBuyBusiness:Z1,onExploreRealm:eb,onOpenAuction:A1,onCloseBizPanel:e.closeBizPanel,onCloseChallengePanel:e.closeChallengePanel,onOpenBizPanel:e.openBizPanel,onOpenChallengePanel:e.openChallengePanel}),Xn==="REVENGE"&&r.jsx(_5,{children:r.jsx(_C,{player:c,setPlayer:f,addLog:Ae})}),Xn==="SYSTEM"&&r.jsx(FC,{player:c,onSave:J1,onLoad:Zf,onReset:X1,onRedeemCode:C1,onOpenGuide:()=>e.openGuide(),autoAssignEnabled:Zs,onToggleAutoAssign:ab,autoSkipSpiritTest:si,onToggleAutoSkip:db,skipChildGiftPopups:eo,onToggleSkipChildGiftPopups:ub,skipZhaozhou:ld,onToggleSkipZhaozhou:pb,skipShuraFieldEvents:W,onToggleSkipShuraFieldEvents:fb,skipRomanceGiftPopups:cn,onToggleSkipRomanceGiftPopups:mb,skipJealousyPopups:tr,onToggleSkipJealousyPopups:hb,isPortraitViewport:dr,isOrientationFixApplied:Ks,onRequestPortraitFix:T1,onReleasePortraitFix:I1,onAutoAssignSpouses:lb,gameState:{player:c,children:O,fallenChildren:ie,activeNpcs:C,deadNpcs:k,gameStage:_t,logs:ys,inventory:l,messages:((p0=ht==null?void 0:ht.toJSON)==null?void 0:p0.call(ht))||{},lastMessageCheck:ii,pendingSectChoices:ai,testQueue:Ts,worldEvents:(c==null?void 0:c.worldEvents)||[],newsBuffer:(c==null?void 0:c.newsBuffer)||[]}}),Xn==="LOG"&&r.jsx(hj,{logs:ys,ratingSummary:hi,onUpgradeRating:_1}),Xn==="PLAYER"&&r.jsx(WC,{player:c,childFeedback:k1,onOpenInventory:()=>e.openInventory("VIEW"),onAllocateSkillPoint:_b})]}),r.jsx(x5,{modalState:t,closeModal:E1,player:c,inventory:l,handleGiftConfirm:z1,handleNegotiateConfirm:D1,handleShopPurchase:U1,handleOptionSelect:Jf,handleShuraFieldSelect:F1,handleBuyAuctionItem:R1,handleShowAuctionPlot:M1,modalMgr:e,allChildren:O,visibleChildren:Pn,handleEquipToChild:e0,handleUseConsumable:bd,handleBatchUseConsumables:gb,handleDiscardFromInventory:P1,handleGiveToChild:Eb,handleBatchGiveToChildren:jb,handleSell:O1,handleAutoAssignManualToChild:Tb,getMarketPrice:Kf,testQueue:Ts,handleTestFinish:nb,handleTestQueueClose:Cb,childSelectorModal:Is,handleChildSelectorSelect:kb,closeChildSelectorModal:Da,selectedChild:le,childNavigationMeta:Jc,handleNavigateChild:Xc,handleChildAction:ib,setSelectedChild:_e,showSpouseSelection:m1,marryingChild:La,spouseCandidates:h1,handleSpouseSelect:ob,resetSpouseSelection:xb,batchGiftEvents:g1,handleBatchGiftConfirm:yb,handleBatchGiftClose:bb,batchPromotionEvents:x1,handleBatchPromotionConfirm:vb,handleBatchPromotionClose:Sb,batchMarriagePlans:y1,handleBatchMarriageConfirm:cb,handleBatchMarriageClose:wb,handleBatchManualAssign:Ib}),r.jsx(hE,{activeTab:Xn,onTabChange:Gc}),r.jsx(B5,{isAuto:en,autoSpeed:vs,player:c,messageUnreadCount:ht.getUnreadCount(),onToggleAuto:()=>Zn(!en),onSetAutoSpeed:Vc,onNextMonth:xd,onOpenGazette:()=>{console.log(":",{currentGazette:Ra,gazetteHistory:c.gazetteHistory,hasUnreadGazette:c.hasUnreadGazette}),e.openGazette()},onOpenMessageCenter:()=>e.openMessageCenter(),onMarkGazetteRead:()=>b({hasUnreadGazette:!1})}),r.jsx(I5,{selectedNpc:R,setSelectedNpc:B,handleOptionSelect:Jf,player:c,visibleChildren:Pn,visibleNpcs:N,activeNpcs:C,modalMgr:e,addLog:Ae,showResult:Z,cutTiesWithNpc:Re,handleToggleNpcLetterAcceptance:K1,messages:f1,messageManager:ht,setMessages:Cs,handleSendMessageReply:w1,combatData:Xo,handleCombatClose:sd,isExploring:Zc,exploreRealmState:ti,exploreProgress:Ta,currentExploreEvent:nd,exploreLog:td,inventory:l,setExploreLog:Js,handleExplorationOption:rd,handleStartCombat:ri,setExploreProgress:Ia,setCurrentExploreEvent:ni,setIsExploring:ei,getBossEvent:Qk,getRandomExplorationEvent:vh,pendingSectChoices:ai,setPendingSectChoices:li,handleAssignSect:rb,handleCloseTutorial:b1,handleCompleteTutorial:v1,handleCloseGuide:S1,currentGazette:Ra,setSelectedWorldNpc:$,selectedWorldNpc:T,handleInviteWorldNpc:Y1})]})}bu.createRoot(document.getElementById("root")).render(r.jsx(wc.StrictMode,{children:r.jsx(cT,{})}));
