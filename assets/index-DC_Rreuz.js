var Ub=Object.defineProperty;var Gb=(e,t,n)=>t in e?Ub(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n;var R0=(e,t,n)=>Gb(e,typeof t!="symbol"?t+"":t,n);import{g as Vo,a as Rp,i as Vb,c as ah,b as Yb,d as qb,e as lh,f as Kb,h as Qb}from"./saveSystem-D2VifvcS.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))s(o);new MutationObserver(o=>{for(const i of o)if(i.type==="childList")for(const a of i.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&s(a)}).observe(document,{childList:!0,subtree:!0});function n(o){const i={};return o.integrity&&(i.integrity=o.integrity),o.referrerPolicy&&(i.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?i.credentials="include":o.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function s(o){if(o.ep)return;o.ep=!0;const i=n(o);fetch(o.href,i)}})();function Jb(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var ch={exports:{}},Rc={},dh={exports:{}},st={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Ca=Symbol.for("react.element"),Xb=Symbol.for("react.portal"),Zb=Symbol.for("react.fragment"),ev=Symbol.for("react.strict_mode"),tv=Symbol.for("react.profiler"),nv=Symbol.for("react.provider"),rv=Symbol.for("react.context"),sv=Symbol.for("react.forward_ref"),ov=Symbol.for("react.suspense"),iv=Symbol.for("react.memo"),av=Symbol.for("react.lazy"),_0=Symbol.iterator;function lv(e){return e===null||typeof e!="object"?null:(e=_0&&e[_0]||e["@@iterator"],typeof e=="function"?e:null)}var uh={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},ph=Object.assign,fh={};function ni(e,t,n){this.props=e,this.context=t,this.refs=fh,this.updater=n||uh}ni.prototype.isReactComponent={};ni.prototype.setState=function(e,t){if(typeof e!="object"&&typeof e!="function"&&e!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,e,t,"setState")};ni.prototype.forceUpdate=function(e){this.updater.enqueueForceUpdate(this,e,"forceUpdate")};function mh(){}mh.prototype=ni.prototype;function _p(e,t,n){this.props=e,this.context=t,this.refs=fh,this.updater=n||uh}var Mp=_p.prototype=new mh;Mp.constructor=_p;ph(Mp,ni.prototype);Mp.isPureReactComponent=!0;var M0=Array.isArray,gh=Object.prototype.hasOwnProperty,Ap={current:null},hh={key:!0,ref:!0,__self:!0,__source:!0};function xh(e,t,n){var s,o={},i=null,a=null;if(t!=null)for(s in t.ref!==void 0&&(a=t.ref),t.key!==void 0&&(i=""+t.key),t)gh.call(t,s)&&!hh.hasOwnProperty(s)&&(o[s]=t[s]);var l=arguments.length-2;if(l===1)o.children=n;else if(1<l){for(var d=Array(l),u=0;u<l;u++)d[u]=arguments[u+2];o.children=d}if(e&&e.defaultProps)for(s in l=e.defaultProps,l)o[s]===void 0&&(o[s]=l[s]);return{$$typeof:Ca,type:e,key:i,ref:a,props:o,_owner:Ap.current}}function cv(e,t){return{$$typeof:Ca,type:e.type,key:t,ref:e.ref,props:e.props,_owner:e._owner}}function Np(e){return typeof e=="object"&&e!==null&&e.$$typeof===Ca}function dv(e){var t={"=":"=0",":":"=2"};return"$"+e.replace(/[=:]/g,function(n){return t[n]})}var A0=/\/+/g;function Rd(e,t){return typeof e=="object"&&e!==null&&e.key!=null?dv(""+e.key):t.toString(36)}function Rl(e,t,n,s,o){var i=typeof e;(i==="undefined"||i==="boolean")&&(e=null);var a=!1;if(e===null)a=!0;else switch(i){case"string":case"number":a=!0;break;case"object":switch(e.$$typeof){case Ca:case Xb:a=!0}}if(a)return a=e,o=o(a),e=s===""?"."+Rd(a,0):s,M0(o)?(n="",e!=null&&(n=e.replace(A0,"$&/")+"/"),Rl(o,t,n,"",function(u){return u})):o!=null&&(Np(o)&&(o=cv(o,n+(!o.key||a&&a.key===o.key?"":(""+o.key).replace(A0,"$&/")+"/")+e)),t.push(o)),1;if(a=0,s=s===""?".":s+":",M0(e))for(var l=0;l<e.length;l++){i=e[l];var d=s+Rd(i,l);a+=Rl(i,t,n,d,o)}else if(d=lv(e),typeof d=="function")for(e=d.call(e),l=0;!(i=e.next()).done;)i=i.value,d=s+Rd(i,l++),a+=Rl(i,t,n,d,o);else if(i==="object")throw t=String(e),Error("Objects are not valid as a React child (found: "+(t==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":t)+"). If you meant to render a collection of children, use an array instead.");return a}function Za(e,t,n){if(e==null)return e;var s=[],o=0;return Rl(e,s,"","",function(i){return t.call(n,i,o++)}),s}function uv(e){if(e._status===-1){var t=e._result;t=t(),t.then(function(n){(e._status===0||e._status===-1)&&(e._status=1,e._result=n)},function(n){(e._status===0||e._status===-1)&&(e._status=2,e._result=n)}),e._status===-1&&(e._status=0,e._result=t)}if(e._status===1)return e._result.default;throw e._result}var Sn={current:null},_l={transition:null},pv={ReactCurrentDispatcher:Sn,ReactCurrentBatchConfig:_l,ReactCurrentOwner:Ap};function yh(){throw Error("act(...) is not supported in production builds of React.")}st.Children={map:Za,forEach:function(e,t,n){Za(e,function(){t.apply(this,arguments)},n)},count:function(e){var t=0;return Za(e,function(){t++}),t},toArray:function(e){return Za(e,function(t){return t})||[]},only:function(e){if(!Np(e))throw Error("React.Children.only expected to receive a single React element child.");return e}};st.Component=ni;st.Fragment=Zb;st.Profiler=tv;st.PureComponent=_p;st.StrictMode=ev;st.Suspense=ov;st.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=pv;st.act=yh;st.cloneElement=function(e,t,n){if(e==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+e+".");var s=ph({},e.props),o=e.key,i=e.ref,a=e._owner;if(t!=null){if(t.ref!==void 0&&(i=t.ref,a=Ap.current),t.key!==void 0&&(o=""+t.key),e.type&&e.type.defaultProps)var l=e.type.defaultProps;for(d in t)gh.call(t,d)&&!hh.hasOwnProperty(d)&&(s[d]=t[d]===void 0&&l!==void 0?l[d]:t[d])}var d=arguments.length-2;if(d===1)s.children=n;else if(1<d){l=Array(d);for(var u=0;u<d;u++)l[u]=arguments[u+2];s.children=l}return{$$typeof:Ca,type:e.type,key:o,ref:i,props:s,_owner:a}};st.createContext=function(e){return e={$$typeof:rv,_currentValue:e,_currentValue2:e,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},e.Provider={$$typeof:nv,_context:e},e.Consumer=e};st.createElement=xh;st.createFactory=function(e){var t=xh.bind(null,e);return t.type=e,t};st.createRef=function(){return{current:null}};st.forwardRef=function(e){return{$$typeof:sv,render:e}};st.isValidElement=Np;st.lazy=function(e){return{$$typeof:av,_payload:{_status:-1,_result:e},_init:uv}};st.memo=function(e,t){return{$$typeof:iv,type:e,compare:t===void 0?null:t}};st.startTransition=function(e){var t=_l.transition;_l.transition={};try{e()}finally{_l.transition=t}};st.unstable_act=yh;st.useCallback=function(e,t){return Sn.current.useCallback(e,t)};st.useContext=function(e){return Sn.current.useContext(e)};st.useDebugValue=function(){};st.useDeferredValue=function(e){return Sn.current.useDeferredValue(e)};st.useEffect=function(e,t){return Sn.current.useEffect(e,t)};st.useId=function(){return Sn.current.useId()};st.useImperativeHandle=function(e,t,n){return Sn.current.useImperativeHandle(e,t,n)};st.useInsertionEffect=function(e,t){return Sn.current.useInsertionEffect(e,t)};st.useLayoutEffect=function(e,t){return Sn.current.useLayoutEffect(e,t)};st.useMemo=function(e,t){return Sn.current.useMemo(e,t)};st.useReducer=function(e,t,n){return Sn.current.useReducer(e,t,n)};st.useRef=function(e){return Sn.current.useRef(e)};st.useState=function(e){return Sn.current.useState(e)};st.useSyncExternalStore=function(e,t,n){return Sn.current.useSyncExternalStore(e,t,n)};st.useTransition=function(){return Sn.current.useTransition()};st.version="18.3.1";dh.exports=st;var y=dh.exports;const _c=Jb(y);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var fv=y,mv=Symbol.for("react.element"),gv=Symbol.for("react.fragment"),hv=Object.prototype.hasOwnProperty,xv=fv.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,yv={key:!0,ref:!0,__self:!0,__source:!0};function bh(e,t,n){var s,o={},i=null,a=null;n!==void 0&&(i=""+n),t.key!==void 0&&(i=""+t.key),t.ref!==void 0&&(a=t.ref);for(s in t)hv.call(t,s)&&!yv.hasOwnProperty(s)&&(o[s]=t[s]);if(e&&e.defaultProps)for(s in t=e.defaultProps,t)o[s]===void 0&&(o[s]=t[s]);return{$$typeof:mv,type:e,key:i,ref:a,props:o,_owner:xv.current}}Rc.Fragment=gv;Rc.jsx=bh;Rc.jsxs=bh;ch.exports=Rc;var r=ch.exports,Eu={},vh={exports:{}},Hn={},Sh={exports:{}},wh={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(e){function t(Q,se){var ye=Q.length;Q.push(se);e:for(;0<ye;){var Me=ye-1>>>1,Pe=Q[Me];if(0<o(Pe,se))Q[Me]=se,Q[ye]=Pe,ye=Me;else break e}}function n(Q){return Q.length===0?null:Q[0]}function s(Q){if(Q.length===0)return null;var se=Q[0],ye=Q.pop();if(ye!==se){Q[0]=ye;e:for(var Me=0,Pe=Q.length,Ke=Pe>>>1;Me<Ke;){var q=2*(Me+1)-1,de=Q[q],Z=q+1,re=Q[Z];if(0>o(de,ye))Z<Pe&&0>o(re,de)?(Q[Me]=re,Q[Z]=ye,Me=Z):(Q[Me]=de,Q[q]=ye,Me=q);else if(Z<Pe&&0>o(re,ye))Q[Me]=re,Q[Z]=ye,Me=Z;else break e}}return se}function o(Q,se){var ye=Q.sortIndex-se.sortIndex;return ye!==0?ye:Q.id-se.id}if(typeof performance=="object"&&typeof performance.now=="function"){var i=performance;e.unstable_now=function(){return i.now()}}else{var a=Date,l=a.now();e.unstable_now=function(){return a.now()-l}}var d=[],u=[],p=1,c=null,f=3,x=!1,C=!1,w=!1,S=typeof setTimeout=="function"?setTimeout:null,h=typeof clearTimeout=="function"?clearTimeout:null,g=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function v(Q){for(var se=n(u);se!==null;){if(se.callback===null)s(u);else if(se.startTime<=Q)s(u),se.sortIndex=se.expirationTime,t(d,se);else break;se=n(u)}}function j(Q){if(w=!1,v(Q),!C)if(n(d)!==null)C=!0,z(R);else{var se=n(u);se!==null&&ne(j,se.startTime-Q)}}function R(Q,se){C=!1,w&&(w=!1,h(I),I=-1),x=!0;var ye=f;try{for(v(se),c=n(d);c!==null&&(!(c.expirationTime>se)||Q&&!N());){var Me=c.callback;if(typeof Me=="function"){c.callback=null,f=c.priorityLevel;var Pe=Me(c.expirationTime<=se);se=e.unstable_now(),typeof Pe=="function"?c.callback=Pe:c===n(d)&&s(d),v(se)}else s(d);c=n(d)}if(c!==null)var Ke=!0;else{var q=n(u);q!==null&&ne(j,q.startTime-se),Ke=!1}return Ke}finally{c=null,f=ye,x=!1}}var b=!1,_=null,I=-1,k=5,T=-1;function N(){return!(e.unstable_now()-T<k)}function K(){if(_!==null){var Q=e.unstable_now();T=Q;var se=!0;try{se=_(!0,Q)}finally{se?L():(b=!1,_=null)}}else b=!1}var L;if(typeof g=="function")L=function(){g(K)};else if(typeof MessageChannel<"u"){var B=new MessageChannel,W=B.port2;B.port1.onmessage=K,L=function(){W.postMessage(null)}}else L=function(){S(K,0)};function z(Q){_=Q,b||(b=!0,L())}function ne(Q,se){I=S(function(){Q(e.unstable_now())},se)}e.unstable_IdlePriority=5,e.unstable_ImmediatePriority=1,e.unstable_LowPriority=4,e.unstable_NormalPriority=3,e.unstable_Profiling=null,e.unstable_UserBlockingPriority=2,e.unstable_cancelCallback=function(Q){Q.callback=null},e.unstable_continueExecution=function(){C||x||(C=!0,z(R))},e.unstable_forceFrameRate=function(Q){0>Q||125<Q?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):k=0<Q?Math.floor(1e3/Q):5},e.unstable_getCurrentPriorityLevel=function(){return f},e.unstable_getFirstCallbackNode=function(){return n(d)},e.unstable_next=function(Q){switch(f){case 1:case 2:case 3:var se=3;break;default:se=f}var ye=f;f=se;try{return Q()}finally{f=ye}},e.unstable_pauseExecution=function(){},e.unstable_requestPaint=function(){},e.unstable_runWithPriority=function(Q,se){switch(Q){case 1:case 2:case 3:case 4:case 5:break;default:Q=3}var ye=f;f=Q;try{return se()}finally{f=ye}},e.unstable_scheduleCallback=function(Q,se,ye){var Me=e.unstable_now();switch(typeof ye=="object"&&ye!==null?(ye=ye.delay,ye=typeof ye=="number"&&0<ye?Me+ye:Me):ye=Me,Q){case 1:var Pe=-1;break;case 2:Pe=250;break;case 5:Pe=1073741823;break;case 4:Pe=1e4;break;default:Pe=5e3}return Pe=ye+Pe,Q={id:p++,callback:se,priorityLevel:Q,startTime:ye,expirationTime:Pe,sortIndex:-1},ye>Me?(Q.sortIndex=ye,t(u,Q),n(d)===null&&Q===n(u)&&(w?(h(I),I=-1):w=!0,ne(j,ye-Me))):(Q.sortIndex=Pe,t(d,Q),C||x||(C=!0,z(R))),Q},e.unstable_shouldYield=N,e.unstable_wrapCallback=function(Q){var se=f;return function(){var ye=f;f=se;try{return Q.apply(this,arguments)}finally{f=ye}}}})(wh);Sh.exports=wh;var bv=Sh.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var vv=y,Fn=bv;function he(e){for(var t="https://reactjs.org/docs/error-decoder.html?invariant="+e,n=1;n<arguments.length;n++)t+="&args[]="+encodeURIComponent(arguments[n]);return"Minified React error #"+e+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var kh=new Set,oa={};function ao(e,t){Yo(e,t),Yo(e+"Capture",t)}function Yo(e,t){for(oa[e]=t,e=0;e<t.length;e++)kh.add(t[e])}var Hr=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),ju=Object.prototype.hasOwnProperty,Sv=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,N0={},L0={};function wv(e){return ju.call(L0,e)?!0:ju.call(N0,e)?!1:Sv.test(e)?L0[e]=!0:(N0[e]=!0,!1)}function kv(e,t,n,s){if(n!==null&&n.type===0)return!1;switch(typeof t){case"function":case"symbol":return!0;case"boolean":return s?!1:n!==null?!n.acceptsBooleans:(e=e.toLowerCase().slice(0,5),e!=="data-"&&e!=="aria-");default:return!1}}function Ev(e,t,n,s){if(t===null||typeof t>"u"||kv(e,t,n,s))return!0;if(s)return!1;if(n!==null)switch(n.type){case 3:return!t;case 4:return t===!1;case 5:return isNaN(t);case 6:return isNaN(t)||1>t}return!1}function wn(e,t,n,s,o,i,a){this.acceptsBooleans=t===2||t===3||t===4,this.attributeName=s,this.attributeNamespace=o,this.mustUseProperty=n,this.propertyName=e,this.type=t,this.sanitizeURL=i,this.removeEmptyString=a}var Zt={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(e){Zt[e]=new wn(e,0,!1,e,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(e){var t=e[0];Zt[t]=new wn(t,1,!1,e[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(e){Zt[e]=new wn(e,2,!1,e.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(e){Zt[e]=new wn(e,2,!1,e,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(e){Zt[e]=new wn(e,3,!1,e.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(e){Zt[e]=new wn(e,3,!0,e,null,!1,!1)});["capture","download"].forEach(function(e){Zt[e]=new wn(e,4,!1,e,null,!1,!1)});["cols","rows","size","span"].forEach(function(e){Zt[e]=new wn(e,6,!1,e,null,!1,!1)});["rowSpan","start"].forEach(function(e){Zt[e]=new wn(e,5,!1,e.toLowerCase(),null,!1,!1)});var Lp=/[\-:]([a-z])/g;function $p(e){return e[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(e){var t=e.replace(Lp,$p);Zt[t]=new wn(t,1,!1,e,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(e){var t=e.replace(Lp,$p);Zt[t]=new wn(t,1,!1,e,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(e){var t=e.replace(Lp,$p);Zt[t]=new wn(t,1,!1,e,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(e){Zt[e]=new wn(e,1,!1,e.toLowerCase(),null,!1,!1)});Zt.xlinkHref=new wn("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(e){Zt[e]=new wn(e,1,!1,e.toLowerCase(),null,!0,!0)});function Bp(e,t,n,s){var o=Zt.hasOwnProperty(t)?Zt[t]:null;(o!==null?o.type!==0:s||!(2<t.length)||t[0]!=="o"&&t[0]!=="O"||t[1]!=="n"&&t[1]!=="N")&&(Ev(t,n,o,s)&&(n=null),s||o===null?wv(t)&&(n===null?e.removeAttribute(t):e.setAttribute(t,""+n)):o.mustUseProperty?e[o.propertyName]=n===null?o.type===3?!1:"":n:(t=o.attributeName,s=o.attributeNamespace,n===null?e.removeAttribute(t):(o=o.type,n=o===3||o===4&&n===!0?"":""+n,s?e.setAttributeNS(s,t,n):e.setAttribute(t,n))))}var Yr=vv.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,el=Symbol.for("react.element"),Eo=Symbol.for("react.portal"),jo=Symbol.for("react.fragment"),Op=Symbol.for("react.strict_mode"),Cu=Symbol.for("react.profiler"),Eh=Symbol.for("react.provider"),jh=Symbol.for("react.context"),Pp=Symbol.for("react.forward_ref"),Tu=Symbol.for("react.suspense"),Iu=Symbol.for("react.suspense_list"),zp=Symbol.for("react.memo"),is=Symbol.for("react.lazy"),Ch=Symbol.for("react.offscreen"),$0=Symbol.iterator;function Ii(e){return e===null||typeof e!="object"?null:(e=$0&&e[$0]||e["@@iterator"],typeof e=="function"?e:null)}var _t=Object.assign,_d;function Hi(e){if(_d===void 0)try{throw Error()}catch(n){var t=n.stack.trim().match(/\n( *(at )?)/);_d=t&&t[1]||""}return`
`+_d+e}var Md=!1;function Ad(e,t){if(!e||Md)return"";Md=!0;var n=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(t)if(t=function(){throw Error()},Object.defineProperty(t.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(t,[])}catch(u){var s=u}Reflect.construct(e,[],t)}else{try{t.call()}catch(u){s=u}e.call(t.prototype)}else{try{throw Error()}catch(u){s=u}e()}}catch(u){if(u&&s&&typeof u.stack=="string"){for(var o=u.stack.split(`
`),i=s.stack.split(`
`),a=o.length-1,l=i.length-1;1<=a&&0<=l&&o[a]!==i[l];)l--;for(;1<=a&&0<=l;a--,l--)if(o[a]!==i[l]){if(a!==1||l!==1)do if(a--,l--,0>l||o[a]!==i[l]){var d=`
`+o[a].replace(" at new "," at ");return e.displayName&&d.includes("<anonymous>")&&(d=d.replace("<anonymous>",e.displayName)),d}while(1<=a&&0<=l);break}}}finally{Md=!1,Error.prepareStackTrace=n}return(e=e?e.displayName||e.name:"")?Hi(e):""}function jv(e){switch(e.tag){case 5:return Hi(e.type);case 16:return Hi("Lazy");case 13:return Hi("Suspense");case 19:return Hi("SuspenseList");case 0:case 2:case 15:return e=Ad(e.type,!1),e;case 11:return e=Ad(e.type.render,!1),e;case 1:return e=Ad(e.type,!0),e;default:return""}}function Ru(e){if(e==null)return null;if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e;switch(e){case jo:return"Fragment";case Eo:return"Portal";case Cu:return"Profiler";case Op:return"StrictMode";case Tu:return"Suspense";case Iu:return"SuspenseList"}if(typeof e=="object")switch(e.$$typeof){case jh:return(e.displayName||"Context")+".Consumer";case Eh:return(e._context.displayName||"Context")+".Provider";case Pp:var t=e.render;return e=e.displayName,e||(e=t.displayName||t.name||"",e=e!==""?"ForwardRef("+e+")":"ForwardRef"),e;case zp:return t=e.displayName||null,t!==null?t:Ru(e.type)||"Memo";case is:t=e._payload,e=e._init;try{return Ru(e(t))}catch{}}return null}function Cv(e){var t=e.type;switch(e.tag){case 24:return"Cache";case 9:return(t.displayName||"Context")+".Consumer";case 10:return(t._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return e=t.render,e=e.displayName||e.name||"",t.displayName||(e!==""?"ForwardRef("+e+")":"ForwardRef");case 7:return"Fragment";case 5:return t;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return Ru(t);case 8:return t===Op?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof t=="function")return t.displayName||t.name||null;if(typeof t=="string")return t}return null}function ks(e){switch(typeof e){case"boolean":case"number":case"string":case"undefined":return e;case"object":return e;default:return""}}function Th(e){var t=e.type;return(e=e.nodeName)&&e.toLowerCase()==="input"&&(t==="checkbox"||t==="radio")}function Tv(e){var t=Th(e)?"checked":"value",n=Object.getOwnPropertyDescriptor(e.constructor.prototype,t),s=""+e[t];if(!e.hasOwnProperty(t)&&typeof n<"u"&&typeof n.get=="function"&&typeof n.set=="function"){var o=n.get,i=n.set;return Object.defineProperty(e,t,{configurable:!0,get:function(){return o.call(this)},set:function(a){s=""+a,i.call(this,a)}}),Object.defineProperty(e,t,{enumerable:n.enumerable}),{getValue:function(){return s},setValue:function(a){s=""+a},stopTracking:function(){e._valueTracker=null,delete e[t]}}}}function tl(e){e._valueTracker||(e._valueTracker=Tv(e))}function Ih(e){if(!e)return!1;var t=e._valueTracker;if(!t)return!0;var n=t.getValue(),s="";return e&&(s=Th(e)?e.checked?"true":"false":e.value),e=s,e!==n?(t.setValue(e),!0):!1}function ql(e){if(e=e||(typeof document<"u"?document:void 0),typeof e>"u")return null;try{return e.activeElement||e.body}catch{return e.body}}function _u(e,t){var n=t.checked;return _t({},t,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:n??e._wrapperState.initialChecked})}function B0(e,t){var n=t.defaultValue==null?"":t.defaultValue,s=t.checked!=null?t.checked:t.defaultChecked;n=ks(t.value!=null?t.value:n),e._wrapperState={initialChecked:s,initialValue:n,controlled:t.type==="checkbox"||t.type==="radio"?t.checked!=null:t.value!=null}}function Rh(e,t){t=t.checked,t!=null&&Bp(e,"checked",t,!1)}function Mu(e,t){Rh(e,t);var n=ks(t.value),s=t.type;if(n!=null)s==="number"?(n===0&&e.value===""||e.value!=n)&&(e.value=""+n):e.value!==""+n&&(e.value=""+n);else if(s==="submit"||s==="reset"){e.removeAttribute("value");return}t.hasOwnProperty("value")?Au(e,t.type,n):t.hasOwnProperty("defaultValue")&&Au(e,t.type,ks(t.defaultValue)),t.checked==null&&t.defaultChecked!=null&&(e.defaultChecked=!!t.defaultChecked)}function O0(e,t,n){if(t.hasOwnProperty("value")||t.hasOwnProperty("defaultValue")){var s=t.type;if(!(s!=="submit"&&s!=="reset"||t.value!==void 0&&t.value!==null))return;t=""+e._wrapperState.initialValue,n||t===e.value||(e.value=t),e.defaultValue=t}n=e.name,n!==""&&(e.name=""),e.defaultChecked=!!e._wrapperState.initialChecked,n!==""&&(e.name=n)}function Au(e,t,n){(t!=="number"||ql(e.ownerDocument)!==e)&&(n==null?e.defaultValue=""+e._wrapperState.initialValue:e.defaultValue!==""+n&&(e.defaultValue=""+n))}var Wi=Array.isArray;function Oo(e,t,n,s){if(e=e.options,t){t={};for(var o=0;o<n.length;o++)t["$"+n[o]]=!0;for(n=0;n<e.length;n++)o=t.hasOwnProperty("$"+e[n].value),e[n].selected!==o&&(e[n].selected=o),o&&s&&(e[n].defaultSelected=!0)}else{for(n=""+ks(n),t=null,o=0;o<e.length;o++){if(e[o].value===n){e[o].selected=!0,s&&(e[o].defaultSelected=!0);return}t!==null||e[o].disabled||(t=e[o])}t!==null&&(t.selected=!0)}}function Nu(e,t){if(t.dangerouslySetInnerHTML!=null)throw Error(he(91));return _t({},t,{value:void 0,defaultValue:void 0,children:""+e._wrapperState.initialValue})}function P0(e,t){var n=t.value;if(n==null){if(n=t.children,t=t.defaultValue,n!=null){if(t!=null)throw Error(he(92));if(Wi(n)){if(1<n.length)throw Error(he(93));n=n[0]}t=n}t==null&&(t=""),n=t}e._wrapperState={initialValue:ks(n)}}function _h(e,t){var n=ks(t.value),s=ks(t.defaultValue);n!=null&&(n=""+n,n!==e.value&&(e.value=n),t.defaultValue==null&&e.defaultValue!==n&&(e.defaultValue=n)),s!=null&&(e.defaultValue=""+s)}function z0(e){var t=e.textContent;t===e._wrapperState.initialValue&&t!==""&&t!==null&&(e.value=t)}function Mh(e){switch(e){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function Lu(e,t){return e==null||e==="http://www.w3.org/1999/xhtml"?Mh(t):e==="http://www.w3.org/2000/svg"&&t==="foreignObject"?"http://www.w3.org/1999/xhtml":e}var nl,Ah=function(e){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(t,n,s,o){MSApp.execUnsafeLocalFunction(function(){return e(t,n,s,o)})}:e}(function(e,t){if(e.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in e)e.innerHTML=t;else{for(nl=nl||document.createElement("div"),nl.innerHTML="<svg>"+t.valueOf().toString()+"</svg>",t=nl.firstChild;e.firstChild;)e.removeChild(e.firstChild);for(;t.firstChild;)e.appendChild(t.firstChild)}});function ia(e,t){if(t){var n=e.firstChild;if(n&&n===e.lastChild&&n.nodeType===3){n.nodeValue=t;return}}e.textContent=t}var Ki={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},Iv=["Webkit","ms","Moz","O"];Object.keys(Ki).forEach(function(e){Iv.forEach(function(t){t=t+e.charAt(0).toUpperCase()+e.substring(1),Ki[t]=Ki[e]})});function Nh(e,t,n){return t==null||typeof t=="boolean"||t===""?"":n||typeof t!="number"||t===0||Ki.hasOwnProperty(e)&&Ki[e]?(""+t).trim():t+"px"}function Lh(e,t){e=e.style;for(var n in t)if(t.hasOwnProperty(n)){var s=n.indexOf("--")===0,o=Nh(n,t[n],s);n==="float"&&(n="cssFloat"),s?e.setProperty(n,o):e[n]=o}}var Rv=_t({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function $u(e,t){if(t){if(Rv[e]&&(t.children!=null||t.dangerouslySetInnerHTML!=null))throw Error(he(137,e));if(t.dangerouslySetInnerHTML!=null){if(t.children!=null)throw Error(he(60));if(typeof t.dangerouslySetInnerHTML!="object"||!("__html"in t.dangerouslySetInnerHTML))throw Error(he(61))}if(t.style!=null&&typeof t.style!="object")throw Error(he(62))}}function Bu(e,t){if(e.indexOf("-")===-1)return typeof t.is=="string";switch(e){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var Ou=null;function Dp(e){return e=e.target||e.srcElement||window,e.correspondingUseElement&&(e=e.correspondingUseElement),e.nodeType===3?e.parentNode:e}var Pu=null,Po=null,zo=null;function D0(e){if(e=Ra(e)){if(typeof Pu!="function")throw Error(he(280));var t=e.stateNode;t&&(t=$c(t),Pu(e.stateNode,e.type,t))}}function $h(e){Po?zo?zo.push(e):zo=[e]:Po=e}function Bh(){if(Po){var e=Po,t=zo;if(zo=Po=null,D0(e),t)for(e=0;e<t.length;e++)D0(t[e])}}function Oh(e,t){return e(t)}function Ph(){}var Nd=!1;function zh(e,t,n){if(Nd)return e(t,n);Nd=!0;try{return Oh(e,t,n)}finally{Nd=!1,(Po!==null||zo!==null)&&(Ph(),Bh())}}function aa(e,t){var n=e.stateNode;if(n===null)return null;var s=$c(n);if(s===null)return null;n=s[t];e:switch(t){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(s=!s.disabled)||(e=e.type,s=!(e==="button"||e==="input"||e==="select"||e==="textarea")),e=!s;break e;default:e=!1}if(e)return null;if(n&&typeof n!="function")throw Error(he(231,t,typeof n));return n}var zu=!1;if(Hr)try{var Ri={};Object.defineProperty(Ri,"passive",{get:function(){zu=!0}}),window.addEventListener("test",Ri,Ri),window.removeEventListener("test",Ri,Ri)}catch{zu=!1}function _v(e,t,n,s,o,i,a,l,d){var u=Array.prototype.slice.call(arguments,3);try{t.apply(n,u)}catch(p){this.onError(p)}}var Qi=!1,Kl=null,Ql=!1,Du=null,Mv={onError:function(e){Qi=!0,Kl=e}};function Av(e,t,n,s,o,i,a,l,d){Qi=!1,Kl=null,_v.apply(Mv,arguments)}function Nv(e,t,n,s,o,i,a,l,d){if(Av.apply(this,arguments),Qi){if(Qi){var u=Kl;Qi=!1,Kl=null}else throw Error(he(198));Ql||(Ql=!0,Du=u)}}function lo(e){var t=e,n=e;if(e.alternate)for(;t.return;)t=t.return;else{e=t;do t=e,t.flags&4098&&(n=t.return),e=t.return;while(e)}return t.tag===3?n:null}function Dh(e){if(e.tag===13){var t=e.memoizedState;if(t===null&&(e=e.alternate,e!==null&&(t=e.memoizedState)),t!==null)return t.dehydrated}return null}function F0(e){if(lo(e)!==e)throw Error(he(188))}function Lv(e){var t=e.alternate;if(!t){if(t=lo(e),t===null)throw Error(he(188));return t!==e?null:e}for(var n=e,s=t;;){var o=n.return;if(o===null)break;var i=o.alternate;if(i===null){if(s=o.return,s!==null){n=s;continue}break}if(o.child===i.child){for(i=o.child;i;){if(i===n)return F0(o),e;if(i===s)return F0(o),t;i=i.sibling}throw Error(he(188))}if(n.return!==s.return)n=o,s=i;else{for(var a=!1,l=o.child;l;){if(l===n){a=!0,n=o,s=i;break}if(l===s){a=!0,s=o,n=i;break}l=l.sibling}if(!a){for(l=i.child;l;){if(l===n){a=!0,n=i,s=o;break}if(l===s){a=!0,s=i,n=o;break}l=l.sibling}if(!a)throw Error(he(189))}}if(n.alternate!==s)throw Error(he(190))}if(n.tag!==3)throw Error(he(188));return n.stateNode.current===n?e:t}function Fh(e){return e=Lv(e),e!==null?Hh(e):null}function Hh(e){if(e.tag===5||e.tag===6)return e;for(e=e.child;e!==null;){var t=Hh(e);if(t!==null)return t;e=e.sibling}return null}var Wh=Fn.unstable_scheduleCallback,H0=Fn.unstable_cancelCallback,$v=Fn.unstable_shouldYield,Bv=Fn.unstable_requestPaint,$t=Fn.unstable_now,Ov=Fn.unstable_getCurrentPriorityLevel,Fp=Fn.unstable_ImmediatePriority,Uh=Fn.unstable_UserBlockingPriority,Jl=Fn.unstable_NormalPriority,Pv=Fn.unstable_LowPriority,Gh=Fn.unstable_IdlePriority,Mc=null,jr=null;function zv(e){if(jr&&typeof jr.onCommitFiberRoot=="function")try{jr.onCommitFiberRoot(Mc,e,void 0,(e.current.flags&128)===128)}catch{}}var dr=Math.clz32?Math.clz32:Hv,Dv=Math.log,Fv=Math.LN2;function Hv(e){return e>>>=0,e===0?32:31-(Dv(e)/Fv|0)|0}var rl=64,sl=4194304;function Ui(e){switch(e&-e){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return e&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return e}}function Xl(e,t){var n=e.pendingLanes;if(n===0)return 0;var s=0,o=e.suspendedLanes,i=e.pingedLanes,a=n&268435455;if(a!==0){var l=a&~o;l!==0?s=Ui(l):(i&=a,i!==0&&(s=Ui(i)))}else a=n&~o,a!==0?s=Ui(a):i!==0&&(s=Ui(i));if(s===0)return 0;if(t!==0&&t!==s&&!(t&o)&&(o=s&-s,i=t&-t,o>=i||o===16&&(i&4194240)!==0))return t;if(s&4&&(s|=n&16),t=e.entangledLanes,t!==0)for(e=e.entanglements,t&=s;0<t;)n=31-dr(t),o=1<<n,s|=e[n],t&=~o;return s}function Wv(e,t){switch(e){case 1:case 2:case 4:return t+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function Uv(e,t){for(var n=e.suspendedLanes,s=e.pingedLanes,o=e.expirationTimes,i=e.pendingLanes;0<i;){var a=31-dr(i),l=1<<a,d=o[a];d===-1?(!(l&n)||l&s)&&(o[a]=Wv(l,t)):d<=t&&(e.expiredLanes|=l),i&=~l}}function Fu(e){return e=e.pendingLanes&-1073741825,e!==0?e:e&1073741824?1073741824:0}function Vh(){var e=rl;return rl<<=1,!(rl&4194240)&&(rl=64),e}function Ld(e){for(var t=[],n=0;31>n;n++)t.push(e);return t}function Ta(e,t,n){e.pendingLanes|=t,t!==536870912&&(e.suspendedLanes=0,e.pingedLanes=0),e=e.eventTimes,t=31-dr(t),e[t]=n}function Gv(e,t){var n=e.pendingLanes&~t;e.pendingLanes=t,e.suspendedLanes=0,e.pingedLanes=0,e.expiredLanes&=t,e.mutableReadLanes&=t,e.entangledLanes&=t,t=e.entanglements;var s=e.eventTimes;for(e=e.expirationTimes;0<n;){var o=31-dr(n),i=1<<o;t[o]=0,s[o]=-1,e[o]=-1,n&=~i}}function Hp(e,t){var n=e.entangledLanes|=t;for(e=e.entanglements;n;){var s=31-dr(n),o=1<<s;o&t|e[s]&t&&(e[s]|=t),n&=~o}}var gt=0;function Yh(e){return e&=-e,1<e?4<e?e&268435455?16:536870912:4:1}var qh,Wp,Kh,Qh,Jh,Hu=!1,ol=[],ms=null,gs=null,hs=null,la=new Map,ca=new Map,cs=[],Vv="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function W0(e,t){switch(e){case"focusin":case"focusout":ms=null;break;case"dragenter":case"dragleave":gs=null;break;case"mouseover":case"mouseout":hs=null;break;case"pointerover":case"pointerout":la.delete(t.pointerId);break;case"gotpointercapture":case"lostpointercapture":ca.delete(t.pointerId)}}function _i(e,t,n,s,o,i){return e===null||e.nativeEvent!==i?(e={blockedOn:t,domEventName:n,eventSystemFlags:s,nativeEvent:i,targetContainers:[o]},t!==null&&(t=Ra(t),t!==null&&Wp(t)),e):(e.eventSystemFlags|=s,t=e.targetContainers,o!==null&&t.indexOf(o)===-1&&t.push(o),e)}function Yv(e,t,n,s,o){switch(t){case"focusin":return ms=_i(ms,e,t,n,s,o),!0;case"dragenter":return gs=_i(gs,e,t,n,s,o),!0;case"mouseover":return hs=_i(hs,e,t,n,s,o),!0;case"pointerover":var i=o.pointerId;return la.set(i,_i(la.get(i)||null,e,t,n,s,o)),!0;case"gotpointercapture":return i=o.pointerId,ca.set(i,_i(ca.get(i)||null,e,t,n,s,o)),!0}return!1}function Xh(e){var t=Vs(e.target);if(t!==null){var n=lo(t);if(n!==null){if(t=n.tag,t===13){if(t=Dh(n),t!==null){e.blockedOn=t,Jh(e.priority,function(){Kh(n)});return}}else if(t===3&&n.stateNode.current.memoizedState.isDehydrated){e.blockedOn=n.tag===3?n.stateNode.containerInfo:null;return}}}e.blockedOn=null}function Ml(e){if(e.blockedOn!==null)return!1;for(var t=e.targetContainers;0<t.length;){var n=Wu(e.domEventName,e.eventSystemFlags,t[0],e.nativeEvent);if(n===null){n=e.nativeEvent;var s=new n.constructor(n.type,n);Ou=s,n.target.dispatchEvent(s),Ou=null}else return t=Ra(n),t!==null&&Wp(t),e.blockedOn=n,!1;t.shift()}return!0}function U0(e,t,n){Ml(e)&&n.delete(t)}function qv(){Hu=!1,ms!==null&&Ml(ms)&&(ms=null),gs!==null&&Ml(gs)&&(gs=null),hs!==null&&Ml(hs)&&(hs=null),la.forEach(U0),ca.forEach(U0)}function Mi(e,t){e.blockedOn===t&&(e.blockedOn=null,Hu||(Hu=!0,Fn.unstable_scheduleCallback(Fn.unstable_NormalPriority,qv)))}function da(e){function t(o){return Mi(o,e)}if(0<ol.length){Mi(ol[0],e);for(var n=1;n<ol.length;n++){var s=ol[n];s.blockedOn===e&&(s.blockedOn=null)}}for(ms!==null&&Mi(ms,e),gs!==null&&Mi(gs,e),hs!==null&&Mi(hs,e),la.forEach(t),ca.forEach(t),n=0;n<cs.length;n++)s=cs[n],s.blockedOn===e&&(s.blockedOn=null);for(;0<cs.length&&(n=cs[0],n.blockedOn===null);)Xh(n),n.blockedOn===null&&cs.shift()}var Do=Yr.ReactCurrentBatchConfig,Zl=!0;function Kv(e,t,n,s){var o=gt,i=Do.transition;Do.transition=null;try{gt=1,Up(e,t,n,s)}finally{gt=o,Do.transition=i}}function Qv(e,t,n,s){var o=gt,i=Do.transition;Do.transition=null;try{gt=4,Up(e,t,n,s)}finally{gt=o,Do.transition=i}}function Up(e,t,n,s){if(Zl){var o=Wu(e,t,n,s);if(o===null)Ud(e,t,s,ec,n),W0(e,s);else if(Yv(o,e,t,n,s))s.stopPropagation();else if(W0(e,s),t&4&&-1<Vv.indexOf(e)){for(;o!==null;){var i=Ra(o);if(i!==null&&qh(i),i=Wu(e,t,n,s),i===null&&Ud(e,t,s,ec,n),i===o)break;o=i}o!==null&&s.stopPropagation()}else Ud(e,t,s,null,n)}}var ec=null;function Wu(e,t,n,s){if(ec=null,e=Dp(s),e=Vs(e),e!==null)if(t=lo(e),t===null)e=null;else if(n=t.tag,n===13){if(e=Dh(t),e!==null)return e;e=null}else if(n===3){if(t.stateNode.current.memoizedState.isDehydrated)return t.tag===3?t.stateNode.containerInfo:null;e=null}else t!==e&&(e=null);return ec=e,null}function Zh(e){switch(e){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(Ov()){case Fp:return 1;case Uh:return 4;case Jl:case Pv:return 16;case Gh:return 536870912;default:return 16}default:return 16}}var us=null,Gp=null,Al=null;function ex(){if(Al)return Al;var e,t=Gp,n=t.length,s,o="value"in us?us.value:us.textContent,i=o.length;for(e=0;e<n&&t[e]===o[e];e++);var a=n-e;for(s=1;s<=a&&t[n-s]===o[i-s];s++);return Al=o.slice(e,1<s?1-s:void 0)}function Nl(e){var t=e.keyCode;return"charCode"in e?(e=e.charCode,e===0&&t===13&&(e=13)):e=t,e===10&&(e=13),32<=e||e===13?e:0}function il(){return!0}function G0(){return!1}function Wn(e){function t(n,s,o,i,a){this._reactName=n,this._targetInst=o,this.type=s,this.nativeEvent=i,this.target=a,this.currentTarget=null;for(var l in e)e.hasOwnProperty(l)&&(n=e[l],this[l]=n?n(i):i[l]);return this.isDefaultPrevented=(i.defaultPrevented!=null?i.defaultPrevented:i.returnValue===!1)?il:G0,this.isPropagationStopped=G0,this}return _t(t.prototype,{preventDefault:function(){this.defaultPrevented=!0;var n=this.nativeEvent;n&&(n.preventDefault?n.preventDefault():typeof n.returnValue!="unknown"&&(n.returnValue=!1),this.isDefaultPrevented=il)},stopPropagation:function(){var n=this.nativeEvent;n&&(n.stopPropagation?n.stopPropagation():typeof n.cancelBubble!="unknown"&&(n.cancelBubble=!0),this.isPropagationStopped=il)},persist:function(){},isPersistent:il}),t}var ri={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(e){return e.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},Vp=Wn(ri),Ia=_t({},ri,{view:0,detail:0}),Jv=Wn(Ia),$d,Bd,Ai,Ac=_t({},Ia,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Yp,button:0,buttons:0,relatedTarget:function(e){return e.relatedTarget===void 0?e.fromElement===e.srcElement?e.toElement:e.fromElement:e.relatedTarget},movementX:function(e){return"movementX"in e?e.movementX:(e!==Ai&&(Ai&&e.type==="mousemove"?($d=e.screenX-Ai.screenX,Bd=e.screenY-Ai.screenY):Bd=$d=0,Ai=e),$d)},movementY:function(e){return"movementY"in e?e.movementY:Bd}}),V0=Wn(Ac),Xv=_t({},Ac,{dataTransfer:0}),Zv=Wn(Xv),eS=_t({},Ia,{relatedTarget:0}),Od=Wn(eS),tS=_t({},ri,{animationName:0,elapsedTime:0,pseudoElement:0}),nS=Wn(tS),rS=_t({},ri,{clipboardData:function(e){return"clipboardData"in e?e.clipboardData:window.clipboardData}}),sS=Wn(rS),oS=_t({},ri,{data:0}),Y0=Wn(oS),iS={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},aS={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},lS={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function cS(e){var t=this.nativeEvent;return t.getModifierState?t.getModifierState(e):(e=lS[e])?!!t[e]:!1}function Yp(){return cS}var dS=_t({},Ia,{key:function(e){if(e.key){var t=iS[e.key]||e.key;if(t!=="Unidentified")return t}return e.type==="keypress"?(e=Nl(e),e===13?"Enter":String.fromCharCode(e)):e.type==="keydown"||e.type==="keyup"?aS[e.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Yp,charCode:function(e){return e.type==="keypress"?Nl(e):0},keyCode:function(e){return e.type==="keydown"||e.type==="keyup"?e.keyCode:0},which:function(e){return e.type==="keypress"?Nl(e):e.type==="keydown"||e.type==="keyup"?e.keyCode:0}}),uS=Wn(dS),pS=_t({},Ac,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),q0=Wn(pS),fS=_t({},Ia,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Yp}),mS=Wn(fS),gS=_t({},ri,{propertyName:0,elapsedTime:0,pseudoElement:0}),hS=Wn(gS),xS=_t({},Ac,{deltaX:function(e){return"deltaX"in e?e.deltaX:"wheelDeltaX"in e?-e.wheelDeltaX:0},deltaY:function(e){return"deltaY"in e?e.deltaY:"wheelDeltaY"in e?-e.wheelDeltaY:"wheelDelta"in e?-e.wheelDelta:0},deltaZ:0,deltaMode:0}),yS=Wn(xS),bS=[9,13,27,32],qp=Hr&&"CompositionEvent"in window,Ji=null;Hr&&"documentMode"in document&&(Ji=document.documentMode);var vS=Hr&&"TextEvent"in window&&!Ji,tx=Hr&&(!qp||Ji&&8<Ji&&11>=Ji),K0=" ",Q0=!1;function nx(e,t){switch(e){case"keyup":return bS.indexOf(t.keyCode)!==-1;case"keydown":return t.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function rx(e){return e=e.detail,typeof e=="object"&&"data"in e?e.data:null}var Co=!1;function SS(e,t){switch(e){case"compositionend":return rx(t);case"keypress":return t.which!==32?null:(Q0=!0,K0);case"textInput":return e=t.data,e===K0&&Q0?null:e;default:return null}}function wS(e,t){if(Co)return e==="compositionend"||!qp&&nx(e,t)?(e=ex(),Al=Gp=us=null,Co=!1,e):null;switch(e){case"paste":return null;case"keypress":if(!(t.ctrlKey||t.altKey||t.metaKey)||t.ctrlKey&&t.altKey){if(t.char&&1<t.char.length)return t.char;if(t.which)return String.fromCharCode(t.which)}return null;case"compositionend":return tx&&t.locale!=="ko"?null:t.data;default:return null}}var kS={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function J0(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t==="input"?!!kS[e.type]:t==="textarea"}function sx(e,t,n,s){$h(s),t=tc(t,"onChange"),0<t.length&&(n=new Vp("onChange","change",null,n,s),e.push({event:n,listeners:t}))}var Xi=null,ua=null;function ES(e){gx(e,0)}function Nc(e){var t=Ro(e);if(Ih(t))return e}function jS(e,t){if(e==="change")return t}var ox=!1;if(Hr){var Pd;if(Hr){var zd="oninput"in document;if(!zd){var X0=document.createElement("div");X0.setAttribute("oninput","return;"),zd=typeof X0.oninput=="function"}Pd=zd}else Pd=!1;ox=Pd&&(!document.documentMode||9<document.documentMode)}function Z0(){Xi&&(Xi.detachEvent("onpropertychange",ix),ua=Xi=null)}function ix(e){if(e.propertyName==="value"&&Nc(ua)){var t=[];sx(t,ua,e,Dp(e)),zh(ES,t)}}function CS(e,t,n){e==="focusin"?(Z0(),Xi=t,ua=n,Xi.attachEvent("onpropertychange",ix)):e==="focusout"&&Z0()}function TS(e){if(e==="selectionchange"||e==="keyup"||e==="keydown")return Nc(ua)}function IS(e,t){if(e==="click")return Nc(t)}function RS(e,t){if(e==="input"||e==="change")return Nc(t)}function _S(e,t){return e===t&&(e!==0||1/e===1/t)||e!==e&&t!==t}var pr=typeof Object.is=="function"?Object.is:_S;function pa(e,t){if(pr(e,t))return!0;if(typeof e!="object"||e===null||typeof t!="object"||t===null)return!1;var n=Object.keys(e),s=Object.keys(t);if(n.length!==s.length)return!1;for(s=0;s<n.length;s++){var o=n[s];if(!ju.call(t,o)||!pr(e[o],t[o]))return!1}return!0}function em(e){for(;e&&e.firstChild;)e=e.firstChild;return e}function tm(e,t){var n=em(e);e=0;for(var s;n;){if(n.nodeType===3){if(s=e+n.textContent.length,e<=t&&s>=t)return{node:n,offset:t-e};e=s}e:{for(;n;){if(n.nextSibling){n=n.nextSibling;break e}n=n.parentNode}n=void 0}n=em(n)}}function ax(e,t){return e&&t?e===t?!0:e&&e.nodeType===3?!1:t&&t.nodeType===3?ax(e,t.parentNode):"contains"in e?e.contains(t):e.compareDocumentPosition?!!(e.compareDocumentPosition(t)&16):!1:!1}function lx(){for(var e=window,t=ql();t instanceof e.HTMLIFrameElement;){try{var n=typeof t.contentWindow.location.href=="string"}catch{n=!1}if(n)e=t.contentWindow;else break;t=ql(e.document)}return t}function Kp(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t&&(t==="input"&&(e.type==="text"||e.type==="search"||e.type==="tel"||e.type==="url"||e.type==="password")||t==="textarea"||e.contentEditable==="true")}function MS(e){var t=lx(),n=e.focusedElem,s=e.selectionRange;if(t!==n&&n&&n.ownerDocument&&ax(n.ownerDocument.documentElement,n)){if(s!==null&&Kp(n)){if(t=s.start,e=s.end,e===void 0&&(e=t),"selectionStart"in n)n.selectionStart=t,n.selectionEnd=Math.min(e,n.value.length);else if(e=(t=n.ownerDocument||document)&&t.defaultView||window,e.getSelection){e=e.getSelection();var o=n.textContent.length,i=Math.min(s.start,o);s=s.end===void 0?i:Math.min(s.end,o),!e.extend&&i>s&&(o=s,s=i,i=o),o=tm(n,i);var a=tm(n,s);o&&a&&(e.rangeCount!==1||e.anchorNode!==o.node||e.anchorOffset!==o.offset||e.focusNode!==a.node||e.focusOffset!==a.offset)&&(t=t.createRange(),t.setStart(o.node,o.offset),e.removeAllRanges(),i>s?(e.addRange(t),e.extend(a.node,a.offset)):(t.setEnd(a.node,a.offset),e.addRange(t)))}}for(t=[],e=n;e=e.parentNode;)e.nodeType===1&&t.push({element:e,left:e.scrollLeft,top:e.scrollTop});for(typeof n.focus=="function"&&n.focus(),n=0;n<t.length;n++)e=t[n],e.element.scrollLeft=e.left,e.element.scrollTop=e.top}}var AS=Hr&&"documentMode"in document&&11>=document.documentMode,To=null,Uu=null,Zi=null,Gu=!1;function nm(e,t,n){var s=n.window===n?n.document:n.nodeType===9?n:n.ownerDocument;Gu||To==null||To!==ql(s)||(s=To,"selectionStart"in s&&Kp(s)?s={start:s.selectionStart,end:s.selectionEnd}:(s=(s.ownerDocument&&s.ownerDocument.defaultView||window).getSelection(),s={anchorNode:s.anchorNode,anchorOffset:s.anchorOffset,focusNode:s.focusNode,focusOffset:s.focusOffset}),Zi&&pa(Zi,s)||(Zi=s,s=tc(Uu,"onSelect"),0<s.length&&(t=new Vp("onSelect","select",null,t,n),e.push({event:t,listeners:s}),t.target=To)))}function al(e,t){var n={};return n[e.toLowerCase()]=t.toLowerCase(),n["Webkit"+e]="webkit"+t,n["Moz"+e]="moz"+t,n}var Io={animationend:al("Animation","AnimationEnd"),animationiteration:al("Animation","AnimationIteration"),animationstart:al("Animation","AnimationStart"),transitionend:al("Transition","TransitionEnd")},Dd={},cx={};Hr&&(cx=document.createElement("div").style,"AnimationEvent"in window||(delete Io.animationend.animation,delete Io.animationiteration.animation,delete Io.animationstart.animation),"TransitionEvent"in window||delete Io.transitionend.transition);function Lc(e){if(Dd[e])return Dd[e];if(!Io[e])return e;var t=Io[e],n;for(n in t)if(t.hasOwnProperty(n)&&n in cx)return Dd[e]=t[n];return e}var dx=Lc("animationend"),ux=Lc("animationiteration"),px=Lc("animationstart"),fx=Lc("transitionend"),mx=new Map,rm="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function js(e,t){mx.set(e,t),ao(t,[e])}for(var Fd=0;Fd<rm.length;Fd++){var Hd=rm[Fd],NS=Hd.toLowerCase(),LS=Hd[0].toUpperCase()+Hd.slice(1);js(NS,"on"+LS)}js(dx,"onAnimationEnd");js(ux,"onAnimationIteration");js(px,"onAnimationStart");js("dblclick","onDoubleClick");js("focusin","onFocus");js("focusout","onBlur");js(fx,"onTransitionEnd");Yo("onMouseEnter",["mouseout","mouseover"]);Yo("onMouseLeave",["mouseout","mouseover"]);Yo("onPointerEnter",["pointerout","pointerover"]);Yo("onPointerLeave",["pointerout","pointerover"]);ao("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));ao("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));ao("onBeforeInput",["compositionend","keypress","textInput","paste"]);ao("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));ao("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));ao("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Gi="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),$S=new Set("cancel close invalid load scroll toggle".split(" ").concat(Gi));function sm(e,t,n){var s=e.type||"unknown-event";e.currentTarget=n,Nv(s,t,void 0,e),e.currentTarget=null}function gx(e,t){t=(t&4)!==0;for(var n=0;n<e.length;n++){var s=e[n],o=s.event;s=s.listeners;e:{var i=void 0;if(t)for(var a=s.length-1;0<=a;a--){var l=s[a],d=l.instance,u=l.currentTarget;if(l=l.listener,d!==i&&o.isPropagationStopped())break e;sm(o,l,u),i=d}else for(a=0;a<s.length;a++){if(l=s[a],d=l.instance,u=l.currentTarget,l=l.listener,d!==i&&o.isPropagationStopped())break e;sm(o,l,u),i=d}}}if(Ql)throw e=Du,Ql=!1,Du=null,e}function wt(e,t){var n=t[Qu];n===void 0&&(n=t[Qu]=new Set);var s=e+"__bubble";n.has(s)||(hx(t,e,2,!1),n.add(s))}function Wd(e,t,n){var s=0;t&&(s|=4),hx(n,e,s,t)}var ll="_reactListening"+Math.random().toString(36).slice(2);function fa(e){if(!e[ll]){e[ll]=!0,kh.forEach(function(n){n!=="selectionchange"&&($S.has(n)||Wd(n,!1,e),Wd(n,!0,e))});var t=e.nodeType===9?e:e.ownerDocument;t===null||t[ll]||(t[ll]=!0,Wd("selectionchange",!1,t))}}function hx(e,t,n,s){switch(Zh(t)){case 1:var o=Kv;break;case 4:o=Qv;break;default:o=Up}n=o.bind(null,t,n,e),o=void 0,!zu||t!=="touchstart"&&t!=="touchmove"&&t!=="wheel"||(o=!0),s?o!==void 0?e.addEventListener(t,n,{capture:!0,passive:o}):e.addEventListener(t,n,!0):o!==void 0?e.addEventListener(t,n,{passive:o}):e.addEventListener(t,n,!1)}function Ud(e,t,n,s,o){var i=s;if(!(t&1)&&!(t&2)&&s!==null)e:for(;;){if(s===null)return;var a=s.tag;if(a===3||a===4){var l=s.stateNode.containerInfo;if(l===o||l.nodeType===8&&l.parentNode===o)break;if(a===4)for(a=s.return;a!==null;){var d=a.tag;if((d===3||d===4)&&(d=a.stateNode.containerInfo,d===o||d.nodeType===8&&d.parentNode===o))return;a=a.return}for(;l!==null;){if(a=Vs(l),a===null)return;if(d=a.tag,d===5||d===6){s=i=a;continue e}l=l.parentNode}}s=s.return}zh(function(){var u=i,p=Dp(n),c=[];e:{var f=mx.get(e);if(f!==void 0){var x=Vp,C=e;switch(e){case"keypress":if(Nl(n)===0)break e;case"keydown":case"keyup":x=uS;break;case"focusin":C="focus",x=Od;break;case"focusout":C="blur",x=Od;break;case"beforeblur":case"afterblur":x=Od;break;case"click":if(n.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":x=V0;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":x=Zv;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":x=mS;break;case dx:case ux:case px:x=nS;break;case fx:x=hS;break;case"scroll":x=Jv;break;case"wheel":x=yS;break;case"copy":case"cut":case"paste":x=sS;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":x=q0}var w=(t&4)!==0,S=!w&&e==="scroll",h=w?f!==null?f+"Capture":null:f;w=[];for(var g=u,v;g!==null;){v=g;var j=v.stateNode;if(v.tag===5&&j!==null&&(v=j,h!==null&&(j=aa(g,h),j!=null&&w.push(ma(g,j,v)))),S)break;g=g.return}0<w.length&&(f=new x(f,C,null,n,p),c.push({event:f,listeners:w}))}}if(!(t&7)){e:{if(f=e==="mouseover"||e==="pointerover",x=e==="mouseout"||e==="pointerout",f&&n!==Ou&&(C=n.relatedTarget||n.fromElement)&&(Vs(C)||C[Wr]))break e;if((x||f)&&(f=p.window===p?p:(f=p.ownerDocument)?f.defaultView||f.parentWindow:window,x?(C=n.relatedTarget||n.toElement,x=u,C=C?Vs(C):null,C!==null&&(S=lo(C),C!==S||C.tag!==5&&C.tag!==6)&&(C=null)):(x=null,C=u),x!==C)){if(w=V0,j="onMouseLeave",h="onMouseEnter",g="mouse",(e==="pointerout"||e==="pointerover")&&(w=q0,j="onPointerLeave",h="onPointerEnter",g="pointer"),S=x==null?f:Ro(x),v=C==null?f:Ro(C),f=new w(j,g+"leave",x,n,p),f.target=S,f.relatedTarget=v,j=null,Vs(p)===u&&(w=new w(h,g+"enter",C,n,p),w.target=v,w.relatedTarget=S,j=w),S=j,x&&C)t:{for(w=x,h=C,g=0,v=w;v;v=xo(v))g++;for(v=0,j=h;j;j=xo(j))v++;for(;0<g-v;)w=xo(w),g--;for(;0<v-g;)h=xo(h),v--;for(;g--;){if(w===h||h!==null&&w===h.alternate)break t;w=xo(w),h=xo(h)}w=null}else w=null;x!==null&&om(c,f,x,w,!1),C!==null&&S!==null&&om(c,S,C,w,!0)}}e:{if(f=u?Ro(u):window,x=f.nodeName&&f.nodeName.toLowerCase(),x==="select"||x==="input"&&f.type==="file")var R=jS;else if(J0(f))if(ox)R=RS;else{R=TS;var b=CS}else(x=f.nodeName)&&x.toLowerCase()==="input"&&(f.type==="checkbox"||f.type==="radio")&&(R=IS);if(R&&(R=R(e,u))){sx(c,R,n,p);break e}b&&b(e,f,u),e==="focusout"&&(b=f._wrapperState)&&b.controlled&&f.type==="number"&&Au(f,"number",f.value)}switch(b=u?Ro(u):window,e){case"focusin":(J0(b)||b.contentEditable==="true")&&(To=b,Uu=u,Zi=null);break;case"focusout":Zi=Uu=To=null;break;case"mousedown":Gu=!0;break;case"contextmenu":case"mouseup":case"dragend":Gu=!1,nm(c,n,p);break;case"selectionchange":if(AS)break;case"keydown":case"keyup":nm(c,n,p)}var _;if(qp)e:{switch(e){case"compositionstart":var I="onCompositionStart";break e;case"compositionend":I="onCompositionEnd";break e;case"compositionupdate":I="onCompositionUpdate";break e}I=void 0}else Co?nx(e,n)&&(I="onCompositionEnd"):e==="keydown"&&n.keyCode===229&&(I="onCompositionStart");I&&(tx&&n.locale!=="ko"&&(Co||I!=="onCompositionStart"?I==="onCompositionEnd"&&Co&&(_=ex()):(us=p,Gp="value"in us?us.value:us.textContent,Co=!0)),b=tc(u,I),0<b.length&&(I=new Y0(I,e,null,n,p),c.push({event:I,listeners:b}),_?I.data=_:(_=rx(n),_!==null&&(I.data=_)))),(_=vS?SS(e,n):wS(e,n))&&(u=tc(u,"onBeforeInput"),0<u.length&&(p=new Y0("onBeforeInput","beforeinput",null,n,p),c.push({event:p,listeners:u}),p.data=_))}gx(c,t)})}function ma(e,t,n){return{instance:e,listener:t,currentTarget:n}}function tc(e,t){for(var n=t+"Capture",s=[];e!==null;){var o=e,i=o.stateNode;o.tag===5&&i!==null&&(o=i,i=aa(e,n),i!=null&&s.unshift(ma(e,i,o)),i=aa(e,t),i!=null&&s.push(ma(e,i,o))),e=e.return}return s}function xo(e){if(e===null)return null;do e=e.return;while(e&&e.tag!==5);return e||null}function om(e,t,n,s,o){for(var i=t._reactName,a=[];n!==null&&n!==s;){var l=n,d=l.alternate,u=l.stateNode;if(d!==null&&d===s)break;l.tag===5&&u!==null&&(l=u,o?(d=aa(n,i),d!=null&&a.unshift(ma(n,d,l))):o||(d=aa(n,i),d!=null&&a.push(ma(n,d,l)))),n=n.return}a.length!==0&&e.push({event:t,listeners:a})}var BS=/\r\n?/g,OS=/\u0000|\uFFFD/g;function im(e){return(typeof e=="string"?e:""+e).replace(BS,`
`).replace(OS,"")}function cl(e,t,n){if(t=im(t),im(e)!==t&&n)throw Error(he(425))}function nc(){}var Vu=null,Yu=null;function qu(e,t){return e==="textarea"||e==="noscript"||typeof t.children=="string"||typeof t.children=="number"||typeof t.dangerouslySetInnerHTML=="object"&&t.dangerouslySetInnerHTML!==null&&t.dangerouslySetInnerHTML.__html!=null}var Ku=typeof setTimeout=="function"?setTimeout:void 0,PS=typeof clearTimeout=="function"?clearTimeout:void 0,am=typeof Promise=="function"?Promise:void 0,zS=typeof queueMicrotask=="function"?queueMicrotask:typeof am<"u"?function(e){return am.resolve(null).then(e).catch(DS)}:Ku;function DS(e){setTimeout(function(){throw e})}function Gd(e,t){var n=t,s=0;do{var o=n.nextSibling;if(e.removeChild(n),o&&o.nodeType===8)if(n=o.data,n==="/$"){if(s===0){e.removeChild(o),da(t);return}s--}else n!=="$"&&n!=="$?"&&n!=="$!"||s++;n=o}while(n);da(t)}function xs(e){for(;e!=null;e=e.nextSibling){var t=e.nodeType;if(t===1||t===3)break;if(t===8){if(t=e.data,t==="$"||t==="$!"||t==="$?")break;if(t==="/$")return null}}return e}function lm(e){e=e.previousSibling;for(var t=0;e;){if(e.nodeType===8){var n=e.data;if(n==="$"||n==="$!"||n==="$?"){if(t===0)return e;t--}else n==="/$"&&t++}e=e.previousSibling}return null}var si=Math.random().toString(36).slice(2),kr="__reactFiber$"+si,ga="__reactProps$"+si,Wr="__reactContainer$"+si,Qu="__reactEvents$"+si,FS="__reactListeners$"+si,HS="__reactHandles$"+si;function Vs(e){var t=e[kr];if(t)return t;for(var n=e.parentNode;n;){if(t=n[Wr]||n[kr]){if(n=t.alternate,t.child!==null||n!==null&&n.child!==null)for(e=lm(e);e!==null;){if(n=e[kr])return n;e=lm(e)}return t}e=n,n=e.parentNode}return null}function Ra(e){return e=e[kr]||e[Wr],!e||e.tag!==5&&e.tag!==6&&e.tag!==13&&e.tag!==3?null:e}function Ro(e){if(e.tag===5||e.tag===6)return e.stateNode;throw Error(he(33))}function $c(e){return e[ga]||null}var Ju=[],_o=-1;function Cs(e){return{current:e}}function kt(e){0>_o||(e.current=Ju[_o],Ju[_o]=null,_o--)}function yt(e,t){_o++,Ju[_o]=e.current,e.current=t}var Es={},un=Cs(Es),Rn=Cs(!1),eo=Es;function qo(e,t){var n=e.type.contextTypes;if(!n)return Es;var s=e.stateNode;if(s&&s.__reactInternalMemoizedUnmaskedChildContext===t)return s.__reactInternalMemoizedMaskedChildContext;var o={},i;for(i in n)o[i]=t[i];return s&&(e=e.stateNode,e.__reactInternalMemoizedUnmaskedChildContext=t,e.__reactInternalMemoizedMaskedChildContext=o),o}function _n(e){return e=e.childContextTypes,e!=null}function rc(){kt(Rn),kt(un)}function cm(e,t,n){if(un.current!==Es)throw Error(he(168));yt(un,t),yt(Rn,n)}function xx(e,t,n){var s=e.stateNode;if(t=t.childContextTypes,typeof s.getChildContext!="function")return n;s=s.getChildContext();for(var o in s)if(!(o in t))throw Error(he(108,Cv(e)||"Unknown",o));return _t({},n,s)}function sc(e){return e=(e=e.stateNode)&&e.__reactInternalMemoizedMergedChildContext||Es,eo=un.current,yt(un,e),yt(Rn,Rn.current),!0}function dm(e,t,n){var s=e.stateNode;if(!s)throw Error(he(169));n?(e=xx(e,t,eo),s.__reactInternalMemoizedMergedChildContext=e,kt(Rn),kt(un),yt(un,e)):kt(Rn),yt(Rn,n)}var Or=null,Bc=!1,Vd=!1;function yx(e){Or===null?Or=[e]:Or.push(e)}function WS(e){Bc=!0,yx(e)}function Ts(){if(!Vd&&Or!==null){Vd=!0;var e=0,t=gt;try{var n=Or;for(gt=1;e<n.length;e++){var s=n[e];do s=s(!0);while(s!==null)}Or=null,Bc=!1}catch(o){throw Or!==null&&(Or=Or.slice(e+1)),Wh(Fp,Ts),o}finally{gt=t,Vd=!1}}return null}var Mo=[],Ao=0,oc=null,ic=0,qn=[],Kn=0,to=null,Pr=1,zr="";function Us(e,t){Mo[Ao++]=ic,Mo[Ao++]=oc,oc=e,ic=t}function bx(e,t,n){qn[Kn++]=Pr,qn[Kn++]=zr,qn[Kn++]=to,to=e;var s=Pr;e=zr;var o=32-dr(s)-1;s&=~(1<<o),n+=1;var i=32-dr(t)+o;if(30<i){var a=o-o%5;i=(s&(1<<a)-1).toString(32),s>>=a,o-=a,Pr=1<<32-dr(t)+o|n<<o|s,zr=i+e}else Pr=1<<i|n<<o|s,zr=e}function Qp(e){e.return!==null&&(Us(e,1),bx(e,1,0))}function Jp(e){for(;e===oc;)oc=Mo[--Ao],Mo[Ao]=null,ic=Mo[--Ao],Mo[Ao]=null;for(;e===to;)to=qn[--Kn],qn[Kn]=null,zr=qn[--Kn],qn[Kn]=null,Pr=qn[--Kn],qn[Kn]=null}var Dn=null,Pn=null,jt=!1,cr=null;function vx(e,t){var n=Jn(5,null,null,0);n.elementType="DELETED",n.stateNode=t,n.return=e,t=e.deletions,t===null?(e.deletions=[n],e.flags|=16):t.push(n)}function um(e,t){switch(e.tag){case 5:var n=e.type;return t=t.nodeType!==1||n.toLowerCase()!==t.nodeName.toLowerCase()?null:t,t!==null?(e.stateNode=t,Dn=e,Pn=xs(t.firstChild),!0):!1;case 6:return t=e.pendingProps===""||t.nodeType!==3?null:t,t!==null?(e.stateNode=t,Dn=e,Pn=null,!0):!1;case 13:return t=t.nodeType!==8?null:t,t!==null?(n=to!==null?{id:Pr,overflow:zr}:null,e.memoizedState={dehydrated:t,treeContext:n,retryLane:1073741824},n=Jn(18,null,null,0),n.stateNode=t,n.return=e,e.child=n,Dn=e,Pn=null,!0):!1;default:return!1}}function Xu(e){return(e.mode&1)!==0&&(e.flags&128)===0}function Zu(e){if(jt){var t=Pn;if(t){var n=t;if(!um(e,t)){if(Xu(e))throw Error(he(418));t=xs(n.nextSibling);var s=Dn;t&&um(e,t)?vx(s,n):(e.flags=e.flags&-4097|2,jt=!1,Dn=e)}}else{if(Xu(e))throw Error(he(418));e.flags=e.flags&-4097|2,jt=!1,Dn=e}}}function pm(e){for(e=e.return;e!==null&&e.tag!==5&&e.tag!==3&&e.tag!==13;)e=e.return;Dn=e}function dl(e){if(e!==Dn)return!1;if(!jt)return pm(e),jt=!0,!1;var t;if((t=e.tag!==3)&&!(t=e.tag!==5)&&(t=e.type,t=t!=="head"&&t!=="body"&&!qu(e.type,e.memoizedProps)),t&&(t=Pn)){if(Xu(e))throw Sx(),Error(he(418));for(;t;)vx(e,t),t=xs(t.nextSibling)}if(pm(e),e.tag===13){if(e=e.memoizedState,e=e!==null?e.dehydrated:null,!e)throw Error(he(317));e:{for(e=e.nextSibling,t=0;e;){if(e.nodeType===8){var n=e.data;if(n==="/$"){if(t===0){Pn=xs(e.nextSibling);break e}t--}else n!=="$"&&n!=="$!"&&n!=="$?"||t++}e=e.nextSibling}Pn=null}}else Pn=Dn?xs(e.stateNode.nextSibling):null;return!0}function Sx(){for(var e=Pn;e;)e=xs(e.nextSibling)}function Ko(){Pn=Dn=null,jt=!1}function Xp(e){cr===null?cr=[e]:cr.push(e)}var US=Yr.ReactCurrentBatchConfig;function Ni(e,t,n){if(e=n.ref,e!==null&&typeof e!="function"&&typeof e!="object"){if(n._owner){if(n=n._owner,n){if(n.tag!==1)throw Error(he(309));var s=n.stateNode}if(!s)throw Error(he(147,e));var o=s,i=""+e;return t!==null&&t.ref!==null&&typeof t.ref=="function"&&t.ref._stringRef===i?t.ref:(t=function(a){var l=o.refs;a===null?delete l[i]:l[i]=a},t._stringRef=i,t)}if(typeof e!="string")throw Error(he(284));if(!n._owner)throw Error(he(290,e))}return e}function ul(e,t){throw e=Object.prototype.toString.call(t),Error(he(31,e==="[object Object]"?"object with keys {"+Object.keys(t).join(", ")+"}":e))}function fm(e){var t=e._init;return t(e._payload)}function wx(e){function t(h,g){if(e){var v=h.deletions;v===null?(h.deletions=[g],h.flags|=16):v.push(g)}}function n(h,g){if(!e)return null;for(;g!==null;)t(h,g),g=g.sibling;return null}function s(h,g){for(h=new Map;g!==null;)g.key!==null?h.set(g.key,g):h.set(g.index,g),g=g.sibling;return h}function o(h,g){return h=Ss(h,g),h.index=0,h.sibling=null,h}function i(h,g,v){return h.index=v,e?(v=h.alternate,v!==null?(v=v.index,v<g?(h.flags|=2,g):v):(h.flags|=2,g)):(h.flags|=1048576,g)}function a(h){return e&&h.alternate===null&&(h.flags|=2),h}function l(h,g,v,j){return g===null||g.tag!==6?(g=Zd(v,h.mode,j),g.return=h,g):(g=o(g,v),g.return=h,g)}function d(h,g,v,j){var R=v.type;return R===jo?p(h,g,v.props.children,j,v.key):g!==null&&(g.elementType===R||typeof R=="object"&&R!==null&&R.$$typeof===is&&fm(R)===g.type)?(j=o(g,v.props),j.ref=Ni(h,g,v),j.return=h,j):(j=Dl(v.type,v.key,v.props,null,h.mode,j),j.ref=Ni(h,g,v),j.return=h,j)}function u(h,g,v,j){return g===null||g.tag!==4||g.stateNode.containerInfo!==v.containerInfo||g.stateNode.implementation!==v.implementation?(g=eu(v,h.mode,j),g.return=h,g):(g=o(g,v.children||[]),g.return=h,g)}function p(h,g,v,j,R){return g===null||g.tag!==7?(g=Qs(v,h.mode,j,R),g.return=h,g):(g=o(g,v),g.return=h,g)}function c(h,g,v){if(typeof g=="string"&&g!==""||typeof g=="number")return g=Zd(""+g,h.mode,v),g.return=h,g;if(typeof g=="object"&&g!==null){switch(g.$$typeof){case el:return v=Dl(g.type,g.key,g.props,null,h.mode,v),v.ref=Ni(h,null,g),v.return=h,v;case Eo:return g=eu(g,h.mode,v),g.return=h,g;case is:var j=g._init;return c(h,j(g._payload),v)}if(Wi(g)||Ii(g))return g=Qs(g,h.mode,v,null),g.return=h,g;ul(h,g)}return null}function f(h,g,v,j){var R=g!==null?g.key:null;if(typeof v=="string"&&v!==""||typeof v=="number")return R!==null?null:l(h,g,""+v,j);if(typeof v=="object"&&v!==null){switch(v.$$typeof){case el:return v.key===R?d(h,g,v,j):null;case Eo:return v.key===R?u(h,g,v,j):null;case is:return R=v._init,f(h,g,R(v._payload),j)}if(Wi(v)||Ii(v))return R!==null?null:p(h,g,v,j,null);ul(h,v)}return null}function x(h,g,v,j,R){if(typeof j=="string"&&j!==""||typeof j=="number")return h=h.get(v)||null,l(g,h,""+j,R);if(typeof j=="object"&&j!==null){switch(j.$$typeof){case el:return h=h.get(j.key===null?v:j.key)||null,d(g,h,j,R);case Eo:return h=h.get(j.key===null?v:j.key)||null,u(g,h,j,R);case is:var b=j._init;return x(h,g,v,b(j._payload),R)}if(Wi(j)||Ii(j))return h=h.get(v)||null,p(g,h,j,R,null);ul(g,j)}return null}function C(h,g,v,j){for(var R=null,b=null,_=g,I=g=0,k=null;_!==null&&I<v.length;I++){_.index>I?(k=_,_=null):k=_.sibling;var T=f(h,_,v[I],j);if(T===null){_===null&&(_=k);break}e&&_&&T.alternate===null&&t(h,_),g=i(T,g,I),b===null?R=T:b.sibling=T,b=T,_=k}if(I===v.length)return n(h,_),jt&&Us(h,I),R;if(_===null){for(;I<v.length;I++)_=c(h,v[I],j),_!==null&&(g=i(_,g,I),b===null?R=_:b.sibling=_,b=_);return jt&&Us(h,I),R}for(_=s(h,_);I<v.length;I++)k=x(_,h,I,v[I],j),k!==null&&(e&&k.alternate!==null&&_.delete(k.key===null?I:k.key),g=i(k,g,I),b===null?R=k:b.sibling=k,b=k);return e&&_.forEach(function(N){return t(h,N)}),jt&&Us(h,I),R}function w(h,g,v,j){var R=Ii(v);if(typeof R!="function")throw Error(he(150));if(v=R.call(v),v==null)throw Error(he(151));for(var b=R=null,_=g,I=g=0,k=null,T=v.next();_!==null&&!T.done;I++,T=v.next()){_.index>I?(k=_,_=null):k=_.sibling;var N=f(h,_,T.value,j);if(N===null){_===null&&(_=k);break}e&&_&&N.alternate===null&&t(h,_),g=i(N,g,I),b===null?R=N:b.sibling=N,b=N,_=k}if(T.done)return n(h,_),jt&&Us(h,I),R;if(_===null){for(;!T.done;I++,T=v.next())T=c(h,T.value,j),T!==null&&(g=i(T,g,I),b===null?R=T:b.sibling=T,b=T);return jt&&Us(h,I),R}for(_=s(h,_);!T.done;I++,T=v.next())T=x(_,h,I,T.value,j),T!==null&&(e&&T.alternate!==null&&_.delete(T.key===null?I:T.key),g=i(T,g,I),b===null?R=T:b.sibling=T,b=T);return e&&_.forEach(function(K){return t(h,K)}),jt&&Us(h,I),R}function S(h,g,v,j){if(typeof v=="object"&&v!==null&&v.type===jo&&v.key===null&&(v=v.props.children),typeof v=="object"&&v!==null){switch(v.$$typeof){case el:e:{for(var R=v.key,b=g;b!==null;){if(b.key===R){if(R=v.type,R===jo){if(b.tag===7){n(h,b.sibling),g=o(b,v.props.children),g.return=h,h=g;break e}}else if(b.elementType===R||typeof R=="object"&&R!==null&&R.$$typeof===is&&fm(R)===b.type){n(h,b.sibling),g=o(b,v.props),g.ref=Ni(h,b,v),g.return=h,h=g;break e}n(h,b);break}else t(h,b);b=b.sibling}v.type===jo?(g=Qs(v.props.children,h.mode,j,v.key),g.return=h,h=g):(j=Dl(v.type,v.key,v.props,null,h.mode,j),j.ref=Ni(h,g,v),j.return=h,h=j)}return a(h);case Eo:e:{for(b=v.key;g!==null;){if(g.key===b)if(g.tag===4&&g.stateNode.containerInfo===v.containerInfo&&g.stateNode.implementation===v.implementation){n(h,g.sibling),g=o(g,v.children||[]),g.return=h,h=g;break e}else{n(h,g);break}else t(h,g);g=g.sibling}g=eu(v,h.mode,j),g.return=h,h=g}return a(h);case is:return b=v._init,S(h,g,b(v._payload),j)}if(Wi(v))return C(h,g,v,j);if(Ii(v))return w(h,g,v,j);ul(h,v)}return typeof v=="string"&&v!==""||typeof v=="number"?(v=""+v,g!==null&&g.tag===6?(n(h,g.sibling),g=o(g,v),g.return=h,h=g):(n(h,g),g=Zd(v,h.mode,j),g.return=h,h=g),a(h)):n(h,g)}return S}var Qo=wx(!0),kx=wx(!1),ac=Cs(null),lc=null,No=null,Zp=null;function ef(){Zp=No=lc=null}function tf(e){var t=ac.current;kt(ac),e._currentValue=t}function ep(e,t,n){for(;e!==null;){var s=e.alternate;if((e.childLanes&t)!==t?(e.childLanes|=t,s!==null&&(s.childLanes|=t)):s!==null&&(s.childLanes&t)!==t&&(s.childLanes|=t),e===n)break;e=e.return}}function Fo(e,t){lc=e,Zp=No=null,e=e.dependencies,e!==null&&e.firstContext!==null&&(e.lanes&t&&(In=!0),e.firstContext=null)}function Zn(e){var t=e._currentValue;if(Zp!==e)if(e={context:e,memoizedValue:t,next:null},No===null){if(lc===null)throw Error(he(308));No=e,lc.dependencies={lanes:0,firstContext:e}}else No=No.next=e;return t}var Ys=null;function nf(e){Ys===null?Ys=[e]:Ys.push(e)}function Ex(e,t,n,s){var o=t.interleaved;return o===null?(n.next=n,nf(t)):(n.next=o.next,o.next=n),t.interleaved=n,Ur(e,s)}function Ur(e,t){e.lanes|=t;var n=e.alternate;for(n!==null&&(n.lanes|=t),n=e,e=e.return;e!==null;)e.childLanes|=t,n=e.alternate,n!==null&&(n.childLanes|=t),n=e,e=e.return;return n.tag===3?n.stateNode:null}var as=!1;function rf(e){e.updateQueue={baseState:e.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function jx(e,t){e=e.updateQueue,t.updateQueue===e&&(t.updateQueue={baseState:e.baseState,firstBaseUpdate:e.firstBaseUpdate,lastBaseUpdate:e.lastBaseUpdate,shared:e.shared,effects:e.effects})}function Fr(e,t){return{eventTime:e,lane:t,tag:0,payload:null,callback:null,next:null}}function ys(e,t,n){var s=e.updateQueue;if(s===null)return null;if(s=s.shared,lt&2){var o=s.pending;return o===null?t.next=t:(t.next=o.next,o.next=t),s.pending=t,Ur(e,n)}return o=s.interleaved,o===null?(t.next=t,nf(s)):(t.next=o.next,o.next=t),s.interleaved=t,Ur(e,n)}function Ll(e,t,n){if(t=t.updateQueue,t!==null&&(t=t.shared,(n&4194240)!==0)){var s=t.lanes;s&=e.pendingLanes,n|=s,t.lanes=n,Hp(e,n)}}function mm(e,t){var n=e.updateQueue,s=e.alternate;if(s!==null&&(s=s.updateQueue,n===s)){var o=null,i=null;if(n=n.firstBaseUpdate,n!==null){do{var a={eventTime:n.eventTime,lane:n.lane,tag:n.tag,payload:n.payload,callback:n.callback,next:null};i===null?o=i=a:i=i.next=a,n=n.next}while(n!==null);i===null?o=i=t:i=i.next=t}else o=i=t;n={baseState:s.baseState,firstBaseUpdate:o,lastBaseUpdate:i,shared:s.shared,effects:s.effects},e.updateQueue=n;return}e=n.lastBaseUpdate,e===null?n.firstBaseUpdate=t:e.next=t,n.lastBaseUpdate=t}function cc(e,t,n,s){var o=e.updateQueue;as=!1;var i=o.firstBaseUpdate,a=o.lastBaseUpdate,l=o.shared.pending;if(l!==null){o.shared.pending=null;var d=l,u=d.next;d.next=null,a===null?i=u:a.next=u,a=d;var p=e.alternate;p!==null&&(p=p.updateQueue,l=p.lastBaseUpdate,l!==a&&(l===null?p.firstBaseUpdate=u:l.next=u,p.lastBaseUpdate=d))}if(i!==null){var c=o.baseState;a=0,p=u=d=null,l=i;do{var f=l.lane,x=l.eventTime;if((s&f)===f){p!==null&&(p=p.next={eventTime:x,lane:0,tag:l.tag,payload:l.payload,callback:l.callback,next:null});e:{var C=e,w=l;switch(f=t,x=n,w.tag){case 1:if(C=w.payload,typeof C=="function"){c=C.call(x,c,f);break e}c=C;break e;case 3:C.flags=C.flags&-65537|128;case 0:if(C=w.payload,f=typeof C=="function"?C.call(x,c,f):C,f==null)break e;c=_t({},c,f);break e;case 2:as=!0}}l.callback!==null&&l.lane!==0&&(e.flags|=64,f=o.effects,f===null?o.effects=[l]:f.push(l))}else x={eventTime:x,lane:f,tag:l.tag,payload:l.payload,callback:l.callback,next:null},p===null?(u=p=x,d=c):p=p.next=x,a|=f;if(l=l.next,l===null){if(l=o.shared.pending,l===null)break;f=l,l=f.next,f.next=null,o.lastBaseUpdate=f,o.shared.pending=null}}while(!0);if(p===null&&(d=c),o.baseState=d,o.firstBaseUpdate=u,o.lastBaseUpdate=p,t=o.shared.interleaved,t!==null){o=t;do a|=o.lane,o=o.next;while(o!==t)}else i===null&&(o.shared.lanes=0);ro|=a,e.lanes=a,e.memoizedState=c}}function gm(e,t,n){if(e=t.effects,t.effects=null,e!==null)for(t=0;t<e.length;t++){var s=e[t],o=s.callback;if(o!==null){if(s.callback=null,s=n,typeof o!="function")throw Error(he(191,o));o.call(s)}}}var _a={},Cr=Cs(_a),ha=Cs(_a),xa=Cs(_a);function qs(e){if(e===_a)throw Error(he(174));return e}function sf(e,t){switch(yt(xa,t),yt(ha,e),yt(Cr,_a),e=t.nodeType,e){case 9:case 11:t=(t=t.documentElement)?t.namespaceURI:Lu(null,"");break;default:e=e===8?t.parentNode:t,t=e.namespaceURI||null,e=e.tagName,t=Lu(t,e)}kt(Cr),yt(Cr,t)}function Jo(){kt(Cr),kt(ha),kt(xa)}function Cx(e){qs(xa.current);var t=qs(Cr.current),n=Lu(t,e.type);t!==n&&(yt(ha,e),yt(Cr,n))}function of(e){ha.current===e&&(kt(Cr),kt(ha))}var It=Cs(0);function dc(e){for(var t=e;t!==null;){if(t.tag===13){var n=t.memoizedState;if(n!==null&&(n=n.dehydrated,n===null||n.data==="$?"||n.data==="$!"))return t}else if(t.tag===19&&t.memoizedProps.revealOrder!==void 0){if(t.flags&128)return t}else if(t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break;for(;t.sibling===null;){if(t.return===null||t.return===e)return null;t=t.return}t.sibling.return=t.return,t=t.sibling}return null}var Yd=[];function af(){for(var e=0;e<Yd.length;e++)Yd[e]._workInProgressVersionPrimary=null;Yd.length=0}var $l=Yr.ReactCurrentDispatcher,qd=Yr.ReactCurrentBatchConfig,no=0,Rt=null,Pt=null,Ut=null,uc=!1,ea=!1,ya=0,GS=0;function on(){throw Error(he(321))}function lf(e,t){if(t===null)return!1;for(var n=0;n<t.length&&n<e.length;n++)if(!pr(e[n],t[n]))return!1;return!0}function cf(e,t,n,s,o,i){if(no=i,Rt=t,t.memoizedState=null,t.updateQueue=null,t.lanes=0,$l.current=e===null||e.memoizedState===null?KS:QS,e=n(s,o),ea){i=0;do{if(ea=!1,ya=0,25<=i)throw Error(he(301));i+=1,Ut=Pt=null,t.updateQueue=null,$l.current=JS,e=n(s,o)}while(ea)}if($l.current=pc,t=Pt!==null&&Pt.next!==null,no=0,Ut=Pt=Rt=null,uc=!1,t)throw Error(he(300));return e}function df(){var e=ya!==0;return ya=0,e}function wr(){var e={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Ut===null?Rt.memoizedState=Ut=e:Ut=Ut.next=e,Ut}function er(){if(Pt===null){var e=Rt.alternate;e=e!==null?e.memoizedState:null}else e=Pt.next;var t=Ut===null?Rt.memoizedState:Ut.next;if(t!==null)Ut=t,Pt=e;else{if(e===null)throw Error(he(310));Pt=e,e={memoizedState:Pt.memoizedState,baseState:Pt.baseState,baseQueue:Pt.baseQueue,queue:Pt.queue,next:null},Ut===null?Rt.memoizedState=Ut=e:Ut=Ut.next=e}return Ut}function ba(e,t){return typeof t=="function"?t(e):t}function Kd(e){var t=er(),n=t.queue;if(n===null)throw Error(he(311));n.lastRenderedReducer=e;var s=Pt,o=s.baseQueue,i=n.pending;if(i!==null){if(o!==null){var a=o.next;o.next=i.next,i.next=a}s.baseQueue=o=i,n.pending=null}if(o!==null){i=o.next,s=s.baseState;var l=a=null,d=null,u=i;do{var p=u.lane;if((no&p)===p)d!==null&&(d=d.next={lane:0,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null}),s=u.hasEagerState?u.eagerState:e(s,u.action);else{var c={lane:p,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null};d===null?(l=d=c,a=s):d=d.next=c,Rt.lanes|=p,ro|=p}u=u.next}while(u!==null&&u!==i);d===null?a=s:d.next=l,pr(s,t.memoizedState)||(In=!0),t.memoizedState=s,t.baseState=a,t.baseQueue=d,n.lastRenderedState=s}if(e=n.interleaved,e!==null){o=e;do i=o.lane,Rt.lanes|=i,ro|=i,o=o.next;while(o!==e)}else o===null&&(n.lanes=0);return[t.memoizedState,n.dispatch]}function Qd(e){var t=er(),n=t.queue;if(n===null)throw Error(he(311));n.lastRenderedReducer=e;var s=n.dispatch,o=n.pending,i=t.memoizedState;if(o!==null){n.pending=null;var a=o=o.next;do i=e(i,a.action),a=a.next;while(a!==o);pr(i,t.memoizedState)||(In=!0),t.memoizedState=i,t.baseQueue===null&&(t.baseState=i),n.lastRenderedState=i}return[i,s]}function Tx(){}function Ix(e,t){var n=Rt,s=er(),o=t(),i=!pr(s.memoizedState,o);if(i&&(s.memoizedState=o,In=!0),s=s.queue,uf(Mx.bind(null,n,s,e),[e]),s.getSnapshot!==t||i||Ut!==null&&Ut.memoizedState.tag&1){if(n.flags|=2048,va(9,_x.bind(null,n,s,o,t),void 0,null),Gt===null)throw Error(he(349));no&30||Rx(n,t,o)}return o}function Rx(e,t,n){e.flags|=16384,e={getSnapshot:t,value:n},t=Rt.updateQueue,t===null?(t={lastEffect:null,stores:null},Rt.updateQueue=t,t.stores=[e]):(n=t.stores,n===null?t.stores=[e]:n.push(e))}function _x(e,t,n,s){t.value=n,t.getSnapshot=s,Ax(t)&&Nx(e)}function Mx(e,t,n){return n(function(){Ax(t)&&Nx(e)})}function Ax(e){var t=e.getSnapshot;e=e.value;try{var n=t();return!pr(e,n)}catch{return!0}}function Nx(e){var t=Ur(e,1);t!==null&&ur(t,e,1,-1)}function hm(e){var t=wr();return typeof e=="function"&&(e=e()),t.memoizedState=t.baseState=e,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:ba,lastRenderedState:e},t.queue=e,e=e.dispatch=qS.bind(null,Rt,e),[t.memoizedState,e]}function va(e,t,n,s){return e={tag:e,create:t,destroy:n,deps:s,next:null},t=Rt.updateQueue,t===null?(t={lastEffect:null,stores:null},Rt.updateQueue=t,t.lastEffect=e.next=e):(n=t.lastEffect,n===null?t.lastEffect=e.next=e:(s=n.next,n.next=e,e.next=s,t.lastEffect=e)),e}function Lx(){return er().memoizedState}function Bl(e,t,n,s){var o=wr();Rt.flags|=e,o.memoizedState=va(1|t,n,void 0,s===void 0?null:s)}function Oc(e,t,n,s){var o=er();s=s===void 0?null:s;var i=void 0;if(Pt!==null){var a=Pt.memoizedState;if(i=a.destroy,s!==null&&lf(s,a.deps)){o.memoizedState=va(t,n,i,s);return}}Rt.flags|=e,o.memoizedState=va(1|t,n,i,s)}function xm(e,t){return Bl(8390656,8,e,t)}function uf(e,t){return Oc(2048,8,e,t)}function $x(e,t){return Oc(4,2,e,t)}function Bx(e,t){return Oc(4,4,e,t)}function Ox(e,t){if(typeof t=="function")return e=e(),t(e),function(){t(null)};if(t!=null)return e=e(),t.current=e,function(){t.current=null}}function Px(e,t,n){return n=n!=null?n.concat([e]):null,Oc(4,4,Ox.bind(null,t,e),n)}function pf(){}function zx(e,t){var n=er();t=t===void 0?null:t;var s=n.memoizedState;return s!==null&&t!==null&&lf(t,s[1])?s[0]:(n.memoizedState=[e,t],e)}function Dx(e,t){var n=er();t=t===void 0?null:t;var s=n.memoizedState;return s!==null&&t!==null&&lf(t,s[1])?s[0]:(e=e(),n.memoizedState=[e,t],e)}function Fx(e,t,n){return no&21?(pr(n,t)||(n=Vh(),Rt.lanes|=n,ro|=n,e.baseState=!0),t):(e.baseState&&(e.baseState=!1,In=!0),e.memoizedState=n)}function VS(e,t){var n=gt;gt=n!==0&&4>n?n:4,e(!0);var s=qd.transition;qd.transition={};try{e(!1),t()}finally{gt=n,qd.transition=s}}function Hx(){return er().memoizedState}function YS(e,t,n){var s=vs(e);if(n={lane:s,action:n,hasEagerState:!1,eagerState:null,next:null},Wx(e))Ux(t,n);else if(n=Ex(e,t,n,s),n!==null){var o=bn();ur(n,e,s,o),Gx(n,t,s)}}function qS(e,t,n){var s=vs(e),o={lane:s,action:n,hasEagerState:!1,eagerState:null,next:null};if(Wx(e))Ux(t,o);else{var i=e.alternate;if(e.lanes===0&&(i===null||i.lanes===0)&&(i=t.lastRenderedReducer,i!==null))try{var a=t.lastRenderedState,l=i(a,n);if(o.hasEagerState=!0,o.eagerState=l,pr(l,a)){var d=t.interleaved;d===null?(o.next=o,nf(t)):(o.next=d.next,d.next=o),t.interleaved=o;return}}catch{}finally{}n=Ex(e,t,o,s),n!==null&&(o=bn(),ur(n,e,s,o),Gx(n,t,s))}}function Wx(e){var t=e.alternate;return e===Rt||t!==null&&t===Rt}function Ux(e,t){ea=uc=!0;var n=e.pending;n===null?t.next=t:(t.next=n.next,n.next=t),e.pending=t}function Gx(e,t,n){if(n&4194240){var s=t.lanes;s&=e.pendingLanes,n|=s,t.lanes=n,Hp(e,n)}}var pc={readContext:Zn,useCallback:on,useContext:on,useEffect:on,useImperativeHandle:on,useInsertionEffect:on,useLayoutEffect:on,useMemo:on,useReducer:on,useRef:on,useState:on,useDebugValue:on,useDeferredValue:on,useTransition:on,useMutableSource:on,useSyncExternalStore:on,useId:on,unstable_isNewReconciler:!1},KS={readContext:Zn,useCallback:function(e,t){return wr().memoizedState=[e,t===void 0?null:t],e},useContext:Zn,useEffect:xm,useImperativeHandle:function(e,t,n){return n=n!=null?n.concat([e]):null,Bl(4194308,4,Ox.bind(null,t,e),n)},useLayoutEffect:function(e,t){return Bl(4194308,4,e,t)},useInsertionEffect:function(e,t){return Bl(4,2,e,t)},useMemo:function(e,t){var n=wr();return t=t===void 0?null:t,e=e(),n.memoizedState=[e,t],e},useReducer:function(e,t,n){var s=wr();return t=n!==void 0?n(t):t,s.memoizedState=s.baseState=t,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:e,lastRenderedState:t},s.queue=e,e=e.dispatch=YS.bind(null,Rt,e),[s.memoizedState,e]},useRef:function(e){var t=wr();return e={current:e},t.memoizedState=e},useState:hm,useDebugValue:pf,useDeferredValue:function(e){return wr().memoizedState=e},useTransition:function(){var e=hm(!1),t=e[0];return e=VS.bind(null,e[1]),wr().memoizedState=e,[t,e]},useMutableSource:function(){},useSyncExternalStore:function(e,t,n){var s=Rt,o=wr();if(jt){if(n===void 0)throw Error(he(407));n=n()}else{if(n=t(),Gt===null)throw Error(he(349));no&30||Rx(s,t,n)}o.memoizedState=n;var i={value:n,getSnapshot:t};return o.queue=i,xm(Mx.bind(null,s,i,e),[e]),s.flags|=2048,va(9,_x.bind(null,s,i,n,t),void 0,null),n},useId:function(){var e=wr(),t=Gt.identifierPrefix;if(jt){var n=zr,s=Pr;n=(s&~(1<<32-dr(s)-1)).toString(32)+n,t=":"+t+"R"+n,n=ya++,0<n&&(t+="H"+n.toString(32)),t+=":"}else n=GS++,t=":"+t+"r"+n.toString(32)+":";return e.memoizedState=t},unstable_isNewReconciler:!1},QS={readContext:Zn,useCallback:zx,useContext:Zn,useEffect:uf,useImperativeHandle:Px,useInsertionEffect:$x,useLayoutEffect:Bx,useMemo:Dx,useReducer:Kd,useRef:Lx,useState:function(){return Kd(ba)},useDebugValue:pf,useDeferredValue:function(e){var t=er();return Fx(t,Pt.memoizedState,e)},useTransition:function(){var e=Kd(ba)[0],t=er().memoizedState;return[e,t]},useMutableSource:Tx,useSyncExternalStore:Ix,useId:Hx,unstable_isNewReconciler:!1},JS={readContext:Zn,useCallback:zx,useContext:Zn,useEffect:uf,useImperativeHandle:Px,useInsertionEffect:$x,useLayoutEffect:Bx,useMemo:Dx,useReducer:Qd,useRef:Lx,useState:function(){return Qd(ba)},useDebugValue:pf,useDeferredValue:function(e){var t=er();return Pt===null?t.memoizedState=e:Fx(t,Pt.memoizedState,e)},useTransition:function(){var e=Qd(ba)[0],t=er().memoizedState;return[e,t]},useMutableSource:Tx,useSyncExternalStore:Ix,useId:Hx,unstable_isNewReconciler:!1};function ar(e,t){if(e&&e.defaultProps){t=_t({},t),e=e.defaultProps;for(var n in e)t[n]===void 0&&(t[n]=e[n]);return t}return t}function tp(e,t,n,s){t=e.memoizedState,n=n(s,t),n=n==null?t:_t({},t,n),e.memoizedState=n,e.lanes===0&&(e.updateQueue.baseState=n)}var Pc={isMounted:function(e){return(e=e._reactInternals)?lo(e)===e:!1},enqueueSetState:function(e,t,n){e=e._reactInternals;var s=bn(),o=vs(e),i=Fr(s,o);i.payload=t,n!=null&&(i.callback=n),t=ys(e,i,o),t!==null&&(ur(t,e,o,s),Ll(t,e,o))},enqueueReplaceState:function(e,t,n){e=e._reactInternals;var s=bn(),o=vs(e),i=Fr(s,o);i.tag=1,i.payload=t,n!=null&&(i.callback=n),t=ys(e,i,o),t!==null&&(ur(t,e,o,s),Ll(t,e,o))},enqueueForceUpdate:function(e,t){e=e._reactInternals;var n=bn(),s=vs(e),o=Fr(n,s);o.tag=2,t!=null&&(o.callback=t),t=ys(e,o,s),t!==null&&(ur(t,e,s,n),Ll(t,e,s))}};function ym(e,t,n,s,o,i,a){return e=e.stateNode,typeof e.shouldComponentUpdate=="function"?e.shouldComponentUpdate(s,i,a):t.prototype&&t.prototype.isPureReactComponent?!pa(n,s)||!pa(o,i):!0}function Vx(e,t,n){var s=!1,o=Es,i=t.contextType;return typeof i=="object"&&i!==null?i=Zn(i):(o=_n(t)?eo:un.current,s=t.contextTypes,i=(s=s!=null)?qo(e,o):Es),t=new t(n,i),e.memoizedState=t.state!==null&&t.state!==void 0?t.state:null,t.updater=Pc,e.stateNode=t,t._reactInternals=e,s&&(e=e.stateNode,e.__reactInternalMemoizedUnmaskedChildContext=o,e.__reactInternalMemoizedMaskedChildContext=i),t}function bm(e,t,n,s){e=t.state,typeof t.componentWillReceiveProps=="function"&&t.componentWillReceiveProps(n,s),typeof t.UNSAFE_componentWillReceiveProps=="function"&&t.UNSAFE_componentWillReceiveProps(n,s),t.state!==e&&Pc.enqueueReplaceState(t,t.state,null)}function np(e,t,n,s){var o=e.stateNode;o.props=n,o.state=e.memoizedState,o.refs={},rf(e);var i=t.contextType;typeof i=="object"&&i!==null?o.context=Zn(i):(i=_n(t)?eo:un.current,o.context=qo(e,i)),o.state=e.memoizedState,i=t.getDerivedStateFromProps,typeof i=="function"&&(tp(e,t,i,n),o.state=e.memoizedState),typeof t.getDerivedStateFromProps=="function"||typeof o.getSnapshotBeforeUpdate=="function"||typeof o.UNSAFE_componentWillMount!="function"&&typeof o.componentWillMount!="function"||(t=o.state,typeof o.componentWillMount=="function"&&o.componentWillMount(),typeof o.UNSAFE_componentWillMount=="function"&&o.UNSAFE_componentWillMount(),t!==o.state&&Pc.enqueueReplaceState(o,o.state,null),cc(e,n,o,s),o.state=e.memoizedState),typeof o.componentDidMount=="function"&&(e.flags|=4194308)}function Xo(e,t){try{var n="",s=t;do n+=jv(s),s=s.return;while(s);var o=n}catch(i){o=`
Error generating stack: `+i.message+`
`+i.stack}return{value:e,source:t,stack:o,digest:null}}function Jd(e,t,n){return{value:e,source:null,stack:n??null,digest:t??null}}function rp(e,t){try{console.error(t.value)}catch(n){setTimeout(function(){throw n})}}var XS=typeof WeakMap=="function"?WeakMap:Map;function Yx(e,t,n){n=Fr(-1,n),n.tag=3,n.payload={element:null};var s=t.value;return n.callback=function(){mc||(mc=!0,fp=s),rp(e,t)},n}function qx(e,t,n){n=Fr(-1,n),n.tag=3;var s=e.type.getDerivedStateFromError;if(typeof s=="function"){var o=t.value;n.payload=function(){return s(o)},n.callback=function(){rp(e,t)}}var i=e.stateNode;return i!==null&&typeof i.componentDidCatch=="function"&&(n.callback=function(){rp(e,t),typeof s!="function"&&(bs===null?bs=new Set([this]):bs.add(this));var a=t.stack;this.componentDidCatch(t.value,{componentStack:a!==null?a:""})}),n}function vm(e,t,n){var s=e.pingCache;if(s===null){s=e.pingCache=new XS;var o=new Set;s.set(t,o)}else o=s.get(t),o===void 0&&(o=new Set,s.set(t,o));o.has(n)||(o.add(n),e=p2.bind(null,e,t,n),t.then(e,e))}function Sm(e){do{var t;if((t=e.tag===13)&&(t=e.memoizedState,t=t!==null?t.dehydrated!==null:!0),t)return e;e=e.return}while(e!==null);return null}function wm(e,t,n,s,o){return e.mode&1?(e.flags|=65536,e.lanes=o,e):(e===t?e.flags|=65536:(e.flags|=128,n.flags|=131072,n.flags&=-52805,n.tag===1&&(n.alternate===null?n.tag=17:(t=Fr(-1,1),t.tag=2,ys(n,t,1))),n.lanes|=1),e)}var ZS=Yr.ReactCurrentOwner,In=!1;function yn(e,t,n,s){t.child=e===null?kx(t,null,n,s):Qo(t,e.child,n,s)}function km(e,t,n,s,o){n=n.render;var i=t.ref;return Fo(t,o),s=cf(e,t,n,s,i,o),n=df(),e!==null&&!In?(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~o,Gr(e,t,o)):(jt&&n&&Qp(t),t.flags|=1,yn(e,t,s,o),t.child)}function Em(e,t,n,s,o){if(e===null){var i=n.type;return typeof i=="function"&&!vf(i)&&i.defaultProps===void 0&&n.compare===null&&n.defaultProps===void 0?(t.tag=15,t.type=i,Kx(e,t,i,s,o)):(e=Dl(n.type,null,s,t,t.mode,o),e.ref=t.ref,e.return=t,t.child=e)}if(i=e.child,!(e.lanes&o)){var a=i.memoizedProps;if(n=n.compare,n=n!==null?n:pa,n(a,s)&&e.ref===t.ref)return Gr(e,t,o)}return t.flags|=1,e=Ss(i,s),e.ref=t.ref,e.return=t,t.child=e}function Kx(e,t,n,s,o){if(e!==null){var i=e.memoizedProps;if(pa(i,s)&&e.ref===t.ref)if(In=!1,t.pendingProps=s=i,(e.lanes&o)!==0)e.flags&131072&&(In=!0);else return t.lanes=e.lanes,Gr(e,t,o)}return sp(e,t,n,s,o)}function Qx(e,t,n){var s=t.pendingProps,o=s.children,i=e!==null?e.memoizedState:null;if(s.mode==="hidden")if(!(t.mode&1))t.memoizedState={baseLanes:0,cachePool:null,transitions:null},yt($o,On),On|=n;else{if(!(n&1073741824))return e=i!==null?i.baseLanes|n:n,t.lanes=t.childLanes=1073741824,t.memoizedState={baseLanes:e,cachePool:null,transitions:null},t.updateQueue=null,yt($o,On),On|=e,null;t.memoizedState={baseLanes:0,cachePool:null,transitions:null},s=i!==null?i.baseLanes:n,yt($o,On),On|=s}else i!==null?(s=i.baseLanes|n,t.memoizedState=null):s=n,yt($o,On),On|=s;return yn(e,t,o,n),t.child}function Jx(e,t){var n=t.ref;(e===null&&n!==null||e!==null&&e.ref!==n)&&(t.flags|=512,t.flags|=2097152)}function sp(e,t,n,s,o){var i=_n(n)?eo:un.current;return i=qo(t,i),Fo(t,o),n=cf(e,t,n,s,i,o),s=df(),e!==null&&!In?(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~o,Gr(e,t,o)):(jt&&s&&Qp(t),t.flags|=1,yn(e,t,n,o),t.child)}function jm(e,t,n,s,o){if(_n(n)){var i=!0;sc(t)}else i=!1;if(Fo(t,o),t.stateNode===null)Ol(e,t),Vx(t,n,s),np(t,n,s,o),s=!0;else if(e===null){var a=t.stateNode,l=t.memoizedProps;a.props=l;var d=a.context,u=n.contextType;typeof u=="object"&&u!==null?u=Zn(u):(u=_n(n)?eo:un.current,u=qo(t,u));var p=n.getDerivedStateFromProps,c=typeof p=="function"||typeof a.getSnapshotBeforeUpdate=="function";c||typeof a.UNSAFE_componentWillReceiveProps!="function"&&typeof a.componentWillReceiveProps!="function"||(l!==s||d!==u)&&bm(t,a,s,u),as=!1;var f=t.memoizedState;a.state=f,cc(t,s,a,o),d=t.memoizedState,l!==s||f!==d||Rn.current||as?(typeof p=="function"&&(tp(t,n,p,s),d=t.memoizedState),(l=as||ym(t,n,l,s,f,d,u))?(c||typeof a.UNSAFE_componentWillMount!="function"&&typeof a.componentWillMount!="function"||(typeof a.componentWillMount=="function"&&a.componentWillMount(),typeof a.UNSAFE_componentWillMount=="function"&&a.UNSAFE_componentWillMount()),typeof a.componentDidMount=="function"&&(t.flags|=4194308)):(typeof a.componentDidMount=="function"&&(t.flags|=4194308),t.memoizedProps=s,t.memoizedState=d),a.props=s,a.state=d,a.context=u,s=l):(typeof a.componentDidMount=="function"&&(t.flags|=4194308),s=!1)}else{a=t.stateNode,jx(e,t),l=t.memoizedProps,u=t.type===t.elementType?l:ar(t.type,l),a.props=u,c=t.pendingProps,f=a.context,d=n.contextType,typeof d=="object"&&d!==null?d=Zn(d):(d=_n(n)?eo:un.current,d=qo(t,d));var x=n.getDerivedStateFromProps;(p=typeof x=="function"||typeof a.getSnapshotBeforeUpdate=="function")||typeof a.UNSAFE_componentWillReceiveProps!="function"&&typeof a.componentWillReceiveProps!="function"||(l!==c||f!==d)&&bm(t,a,s,d),as=!1,f=t.memoizedState,a.state=f,cc(t,s,a,o);var C=t.memoizedState;l!==c||f!==C||Rn.current||as?(typeof x=="function"&&(tp(t,n,x,s),C=t.memoizedState),(u=as||ym(t,n,u,s,f,C,d)||!1)?(p||typeof a.UNSAFE_componentWillUpdate!="function"&&typeof a.componentWillUpdate!="function"||(typeof a.componentWillUpdate=="function"&&a.componentWillUpdate(s,C,d),typeof a.UNSAFE_componentWillUpdate=="function"&&a.UNSAFE_componentWillUpdate(s,C,d)),typeof a.componentDidUpdate=="function"&&(t.flags|=4),typeof a.getSnapshotBeforeUpdate=="function"&&(t.flags|=1024)):(typeof a.componentDidUpdate!="function"||l===e.memoizedProps&&f===e.memoizedState||(t.flags|=4),typeof a.getSnapshotBeforeUpdate!="function"||l===e.memoizedProps&&f===e.memoizedState||(t.flags|=1024),t.memoizedProps=s,t.memoizedState=C),a.props=s,a.state=C,a.context=d,s=u):(typeof a.componentDidUpdate!="function"||l===e.memoizedProps&&f===e.memoizedState||(t.flags|=4),typeof a.getSnapshotBeforeUpdate!="function"||l===e.memoizedProps&&f===e.memoizedState||(t.flags|=1024),s=!1)}return op(e,t,n,s,i,o)}function op(e,t,n,s,o,i){Jx(e,t);var a=(t.flags&128)!==0;if(!s&&!a)return o&&dm(t,n,!1),Gr(e,t,i);s=t.stateNode,ZS.current=t;var l=a&&typeof n.getDerivedStateFromError!="function"?null:s.render();return t.flags|=1,e!==null&&a?(t.child=Qo(t,e.child,null,i),t.child=Qo(t,null,l,i)):yn(e,t,l,i),t.memoizedState=s.state,o&&dm(t,n,!0),t.child}function Xx(e){var t=e.stateNode;t.pendingContext?cm(e,t.pendingContext,t.pendingContext!==t.context):t.context&&cm(e,t.context,!1),sf(e,t.containerInfo)}function Cm(e,t,n,s,o){return Ko(),Xp(o),t.flags|=256,yn(e,t,n,s),t.child}var ip={dehydrated:null,treeContext:null,retryLane:0};function ap(e){return{baseLanes:e,cachePool:null,transitions:null}}function Zx(e,t,n){var s=t.pendingProps,o=It.current,i=!1,a=(t.flags&128)!==0,l;if((l=a)||(l=e!==null&&e.memoizedState===null?!1:(o&2)!==0),l?(i=!0,t.flags&=-129):(e===null||e.memoizedState!==null)&&(o|=1),yt(It,o&1),e===null)return Zu(t),e=t.memoizedState,e!==null&&(e=e.dehydrated,e!==null)?(t.mode&1?e.data==="$!"?t.lanes=8:t.lanes=1073741824:t.lanes=1,null):(a=s.children,e=s.fallback,i?(s=t.mode,i=t.child,a={mode:"hidden",children:a},!(s&1)&&i!==null?(i.childLanes=0,i.pendingProps=a):i=Fc(a,s,0,null),e=Qs(e,s,n,null),i.return=t,e.return=t,i.sibling=e,t.child=i,t.child.memoizedState=ap(n),t.memoizedState=ip,e):ff(t,a));if(o=e.memoizedState,o!==null&&(l=o.dehydrated,l!==null))return e2(e,t,a,s,l,o,n);if(i){i=s.fallback,a=t.mode,o=e.child,l=o.sibling;var d={mode:"hidden",children:s.children};return!(a&1)&&t.child!==o?(s=t.child,s.childLanes=0,s.pendingProps=d,t.deletions=null):(s=Ss(o,d),s.subtreeFlags=o.subtreeFlags&14680064),l!==null?i=Ss(l,i):(i=Qs(i,a,n,null),i.flags|=2),i.return=t,s.return=t,s.sibling=i,t.child=s,s=i,i=t.child,a=e.child.memoizedState,a=a===null?ap(n):{baseLanes:a.baseLanes|n,cachePool:null,transitions:a.transitions},i.memoizedState=a,i.childLanes=e.childLanes&~n,t.memoizedState=ip,s}return i=e.child,e=i.sibling,s=Ss(i,{mode:"visible",children:s.children}),!(t.mode&1)&&(s.lanes=n),s.return=t,s.sibling=null,e!==null&&(n=t.deletions,n===null?(t.deletions=[e],t.flags|=16):n.push(e)),t.child=s,t.memoizedState=null,s}function ff(e,t){return t=Fc({mode:"visible",children:t},e.mode,0,null),t.return=e,e.child=t}function pl(e,t,n,s){return s!==null&&Xp(s),Qo(t,e.child,null,n),e=ff(t,t.pendingProps.children),e.flags|=2,t.memoizedState=null,e}function e2(e,t,n,s,o,i,a){if(n)return t.flags&256?(t.flags&=-257,s=Jd(Error(he(422))),pl(e,t,a,s)):t.memoizedState!==null?(t.child=e.child,t.flags|=128,null):(i=s.fallback,o=t.mode,s=Fc({mode:"visible",children:s.children},o,0,null),i=Qs(i,o,a,null),i.flags|=2,s.return=t,i.return=t,s.sibling=i,t.child=s,t.mode&1&&Qo(t,e.child,null,a),t.child.memoizedState=ap(a),t.memoizedState=ip,i);if(!(t.mode&1))return pl(e,t,a,null);if(o.data==="$!"){if(s=o.nextSibling&&o.nextSibling.dataset,s)var l=s.dgst;return s=l,i=Error(he(419)),s=Jd(i,s,void 0),pl(e,t,a,s)}if(l=(a&e.childLanes)!==0,In||l){if(s=Gt,s!==null){switch(a&-a){case 4:o=2;break;case 16:o=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:o=32;break;case 536870912:o=268435456;break;default:o=0}o=o&(s.suspendedLanes|a)?0:o,o!==0&&o!==i.retryLane&&(i.retryLane=o,Ur(e,o),ur(s,e,o,-1))}return bf(),s=Jd(Error(he(421))),pl(e,t,a,s)}return o.data==="$?"?(t.flags|=128,t.child=e.child,t=f2.bind(null,e),o._reactRetry=t,null):(e=i.treeContext,Pn=xs(o.nextSibling),Dn=t,jt=!0,cr=null,e!==null&&(qn[Kn++]=Pr,qn[Kn++]=zr,qn[Kn++]=to,Pr=e.id,zr=e.overflow,to=t),t=ff(t,s.children),t.flags|=4096,t)}function Tm(e,t,n){e.lanes|=t;var s=e.alternate;s!==null&&(s.lanes|=t),ep(e.return,t,n)}function Xd(e,t,n,s,o){var i=e.memoizedState;i===null?e.memoizedState={isBackwards:t,rendering:null,renderingStartTime:0,last:s,tail:n,tailMode:o}:(i.isBackwards=t,i.rendering=null,i.renderingStartTime=0,i.last=s,i.tail=n,i.tailMode=o)}function ey(e,t,n){var s=t.pendingProps,o=s.revealOrder,i=s.tail;if(yn(e,t,s.children,n),s=It.current,s&2)s=s&1|2,t.flags|=128;else{if(e!==null&&e.flags&128)e:for(e=t.child;e!==null;){if(e.tag===13)e.memoizedState!==null&&Tm(e,n,t);else if(e.tag===19)Tm(e,n,t);else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===t)break e;for(;e.sibling===null;){if(e.return===null||e.return===t)break e;e=e.return}e.sibling.return=e.return,e=e.sibling}s&=1}if(yt(It,s),!(t.mode&1))t.memoizedState=null;else switch(o){case"forwards":for(n=t.child,o=null;n!==null;)e=n.alternate,e!==null&&dc(e)===null&&(o=n),n=n.sibling;n=o,n===null?(o=t.child,t.child=null):(o=n.sibling,n.sibling=null),Xd(t,!1,o,n,i);break;case"backwards":for(n=null,o=t.child,t.child=null;o!==null;){if(e=o.alternate,e!==null&&dc(e)===null){t.child=o;break}e=o.sibling,o.sibling=n,n=o,o=e}Xd(t,!0,n,null,i);break;case"together":Xd(t,!1,null,null,void 0);break;default:t.memoizedState=null}return t.child}function Ol(e,t){!(t.mode&1)&&e!==null&&(e.alternate=null,t.alternate=null,t.flags|=2)}function Gr(e,t,n){if(e!==null&&(t.dependencies=e.dependencies),ro|=t.lanes,!(n&t.childLanes))return null;if(e!==null&&t.child!==e.child)throw Error(he(153));if(t.child!==null){for(e=t.child,n=Ss(e,e.pendingProps),t.child=n,n.return=t;e.sibling!==null;)e=e.sibling,n=n.sibling=Ss(e,e.pendingProps),n.return=t;n.sibling=null}return t.child}function t2(e,t,n){switch(t.tag){case 3:Xx(t),Ko();break;case 5:Cx(t);break;case 1:_n(t.type)&&sc(t);break;case 4:sf(t,t.stateNode.containerInfo);break;case 10:var s=t.type._context,o=t.memoizedProps.value;yt(ac,s._currentValue),s._currentValue=o;break;case 13:if(s=t.memoizedState,s!==null)return s.dehydrated!==null?(yt(It,It.current&1),t.flags|=128,null):n&t.child.childLanes?Zx(e,t,n):(yt(It,It.current&1),e=Gr(e,t,n),e!==null?e.sibling:null);yt(It,It.current&1);break;case 19:if(s=(n&t.childLanes)!==0,e.flags&128){if(s)return ey(e,t,n);t.flags|=128}if(o=t.memoizedState,o!==null&&(o.rendering=null,o.tail=null,o.lastEffect=null),yt(It,It.current),s)break;return null;case 22:case 23:return t.lanes=0,Qx(e,t,n)}return Gr(e,t,n)}var ty,lp,ny,ry;ty=function(e,t){for(var n=t.child;n!==null;){if(n.tag===5||n.tag===6)e.appendChild(n.stateNode);else if(n.tag!==4&&n.child!==null){n.child.return=n,n=n.child;continue}if(n===t)break;for(;n.sibling===null;){if(n.return===null||n.return===t)return;n=n.return}n.sibling.return=n.return,n=n.sibling}};lp=function(){};ny=function(e,t,n,s){var o=e.memoizedProps;if(o!==s){e=t.stateNode,qs(Cr.current);var i=null;switch(n){case"input":o=_u(e,o),s=_u(e,s),i=[];break;case"select":o=_t({},o,{value:void 0}),s=_t({},s,{value:void 0}),i=[];break;case"textarea":o=Nu(e,o),s=Nu(e,s),i=[];break;default:typeof o.onClick!="function"&&typeof s.onClick=="function"&&(e.onclick=nc)}$u(n,s);var a;n=null;for(u in o)if(!s.hasOwnProperty(u)&&o.hasOwnProperty(u)&&o[u]!=null)if(u==="style"){var l=o[u];for(a in l)l.hasOwnProperty(a)&&(n||(n={}),n[a]="")}else u!=="dangerouslySetInnerHTML"&&u!=="children"&&u!=="suppressContentEditableWarning"&&u!=="suppressHydrationWarning"&&u!=="autoFocus"&&(oa.hasOwnProperty(u)?i||(i=[]):(i=i||[]).push(u,null));for(u in s){var d=s[u];if(l=o!=null?o[u]:void 0,s.hasOwnProperty(u)&&d!==l&&(d!=null||l!=null))if(u==="style")if(l){for(a in l)!l.hasOwnProperty(a)||d&&d.hasOwnProperty(a)||(n||(n={}),n[a]="");for(a in d)d.hasOwnProperty(a)&&l[a]!==d[a]&&(n||(n={}),n[a]=d[a])}else n||(i||(i=[]),i.push(u,n)),n=d;else u==="dangerouslySetInnerHTML"?(d=d?d.__html:void 0,l=l?l.__html:void 0,d!=null&&l!==d&&(i=i||[]).push(u,d)):u==="children"?typeof d!="string"&&typeof d!="number"||(i=i||[]).push(u,""+d):u!=="suppressContentEditableWarning"&&u!=="suppressHydrationWarning"&&(oa.hasOwnProperty(u)?(d!=null&&u==="onScroll"&&wt("scroll",e),i||l===d||(i=[])):(i=i||[]).push(u,d))}n&&(i=i||[]).push("style",n);var u=i;(t.updateQueue=u)&&(t.flags|=4)}};ry=function(e,t,n,s){n!==s&&(t.flags|=4)};function Li(e,t){if(!jt)switch(e.tailMode){case"hidden":t=e.tail;for(var n=null;t!==null;)t.alternate!==null&&(n=t),t=t.sibling;n===null?e.tail=null:n.sibling=null;break;case"collapsed":n=e.tail;for(var s=null;n!==null;)n.alternate!==null&&(s=n),n=n.sibling;s===null?t||e.tail===null?e.tail=null:e.tail.sibling=null:s.sibling=null}}function an(e){var t=e.alternate!==null&&e.alternate.child===e.child,n=0,s=0;if(t)for(var o=e.child;o!==null;)n|=o.lanes|o.childLanes,s|=o.subtreeFlags&14680064,s|=o.flags&14680064,o.return=e,o=o.sibling;else for(o=e.child;o!==null;)n|=o.lanes|o.childLanes,s|=o.subtreeFlags,s|=o.flags,o.return=e,o=o.sibling;return e.subtreeFlags|=s,e.childLanes=n,t}function n2(e,t,n){var s=t.pendingProps;switch(Jp(t),t.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return an(t),null;case 1:return _n(t.type)&&rc(),an(t),null;case 3:return s=t.stateNode,Jo(),kt(Rn),kt(un),af(),s.pendingContext&&(s.context=s.pendingContext,s.pendingContext=null),(e===null||e.child===null)&&(dl(t)?t.flags|=4:e===null||e.memoizedState.isDehydrated&&!(t.flags&256)||(t.flags|=1024,cr!==null&&(hp(cr),cr=null))),lp(e,t),an(t),null;case 5:of(t);var o=qs(xa.current);if(n=t.type,e!==null&&t.stateNode!=null)ny(e,t,n,s,o),e.ref!==t.ref&&(t.flags|=512,t.flags|=2097152);else{if(!s){if(t.stateNode===null)throw Error(he(166));return an(t),null}if(e=qs(Cr.current),dl(t)){s=t.stateNode,n=t.type;var i=t.memoizedProps;switch(s[kr]=t,s[ga]=i,e=(t.mode&1)!==0,n){case"dialog":wt("cancel",s),wt("close",s);break;case"iframe":case"object":case"embed":wt("load",s);break;case"video":case"audio":for(o=0;o<Gi.length;o++)wt(Gi[o],s);break;case"source":wt("error",s);break;case"img":case"image":case"link":wt("error",s),wt("load",s);break;case"details":wt("toggle",s);break;case"input":B0(s,i),wt("invalid",s);break;case"select":s._wrapperState={wasMultiple:!!i.multiple},wt("invalid",s);break;case"textarea":P0(s,i),wt("invalid",s)}$u(n,i),o=null;for(var a in i)if(i.hasOwnProperty(a)){var l=i[a];a==="children"?typeof l=="string"?s.textContent!==l&&(i.suppressHydrationWarning!==!0&&cl(s.textContent,l,e),o=["children",l]):typeof l=="number"&&s.textContent!==""+l&&(i.suppressHydrationWarning!==!0&&cl(s.textContent,l,e),o=["children",""+l]):oa.hasOwnProperty(a)&&l!=null&&a==="onScroll"&&wt("scroll",s)}switch(n){case"input":tl(s),O0(s,i,!0);break;case"textarea":tl(s),z0(s);break;case"select":case"option":break;default:typeof i.onClick=="function"&&(s.onclick=nc)}s=o,t.updateQueue=s,s!==null&&(t.flags|=4)}else{a=o.nodeType===9?o:o.ownerDocument,e==="http://www.w3.org/1999/xhtml"&&(e=Mh(n)),e==="http://www.w3.org/1999/xhtml"?n==="script"?(e=a.createElement("div"),e.innerHTML="<script><\/script>",e=e.removeChild(e.firstChild)):typeof s.is=="string"?e=a.createElement(n,{is:s.is}):(e=a.createElement(n),n==="select"&&(a=e,s.multiple?a.multiple=!0:s.size&&(a.size=s.size))):e=a.createElementNS(e,n),e[kr]=t,e[ga]=s,ty(e,t,!1,!1),t.stateNode=e;e:{switch(a=Bu(n,s),n){case"dialog":wt("cancel",e),wt("close",e),o=s;break;case"iframe":case"object":case"embed":wt("load",e),o=s;break;case"video":case"audio":for(o=0;o<Gi.length;o++)wt(Gi[o],e);o=s;break;case"source":wt("error",e),o=s;break;case"img":case"image":case"link":wt("error",e),wt("load",e),o=s;break;case"details":wt("toggle",e),o=s;break;case"input":B0(e,s),o=_u(e,s),wt("invalid",e);break;case"option":o=s;break;case"select":e._wrapperState={wasMultiple:!!s.multiple},o=_t({},s,{value:void 0}),wt("invalid",e);break;case"textarea":P0(e,s),o=Nu(e,s),wt("invalid",e);break;default:o=s}$u(n,o),l=o;for(i in l)if(l.hasOwnProperty(i)){var d=l[i];i==="style"?Lh(e,d):i==="dangerouslySetInnerHTML"?(d=d?d.__html:void 0,d!=null&&Ah(e,d)):i==="children"?typeof d=="string"?(n!=="textarea"||d!=="")&&ia(e,d):typeof d=="number"&&ia(e,""+d):i!=="suppressContentEditableWarning"&&i!=="suppressHydrationWarning"&&i!=="autoFocus"&&(oa.hasOwnProperty(i)?d!=null&&i==="onScroll"&&wt("scroll",e):d!=null&&Bp(e,i,d,a))}switch(n){case"input":tl(e),O0(e,s,!1);break;case"textarea":tl(e),z0(e);break;case"option":s.value!=null&&e.setAttribute("value",""+ks(s.value));break;case"select":e.multiple=!!s.multiple,i=s.value,i!=null?Oo(e,!!s.multiple,i,!1):s.defaultValue!=null&&Oo(e,!!s.multiple,s.defaultValue,!0);break;default:typeof o.onClick=="function"&&(e.onclick=nc)}switch(n){case"button":case"input":case"select":case"textarea":s=!!s.autoFocus;break e;case"img":s=!0;break e;default:s=!1}}s&&(t.flags|=4)}t.ref!==null&&(t.flags|=512,t.flags|=2097152)}return an(t),null;case 6:if(e&&t.stateNode!=null)ry(e,t,e.memoizedProps,s);else{if(typeof s!="string"&&t.stateNode===null)throw Error(he(166));if(n=qs(xa.current),qs(Cr.current),dl(t)){if(s=t.stateNode,n=t.memoizedProps,s[kr]=t,(i=s.nodeValue!==n)&&(e=Dn,e!==null))switch(e.tag){case 3:cl(s.nodeValue,n,(e.mode&1)!==0);break;case 5:e.memoizedProps.suppressHydrationWarning!==!0&&cl(s.nodeValue,n,(e.mode&1)!==0)}i&&(t.flags|=4)}else s=(n.nodeType===9?n:n.ownerDocument).createTextNode(s),s[kr]=t,t.stateNode=s}return an(t),null;case 13:if(kt(It),s=t.memoizedState,e===null||e.memoizedState!==null&&e.memoizedState.dehydrated!==null){if(jt&&Pn!==null&&t.mode&1&&!(t.flags&128))Sx(),Ko(),t.flags|=98560,i=!1;else if(i=dl(t),s!==null&&s.dehydrated!==null){if(e===null){if(!i)throw Error(he(318));if(i=t.memoizedState,i=i!==null?i.dehydrated:null,!i)throw Error(he(317));i[kr]=t}else Ko(),!(t.flags&128)&&(t.memoizedState=null),t.flags|=4;an(t),i=!1}else cr!==null&&(hp(cr),cr=null),i=!0;if(!i)return t.flags&65536?t:null}return t.flags&128?(t.lanes=n,t):(s=s!==null,s!==(e!==null&&e.memoizedState!==null)&&s&&(t.child.flags|=8192,t.mode&1&&(e===null||It.current&1?Dt===0&&(Dt=3):bf())),t.updateQueue!==null&&(t.flags|=4),an(t),null);case 4:return Jo(),lp(e,t),e===null&&fa(t.stateNode.containerInfo),an(t),null;case 10:return tf(t.type._context),an(t),null;case 17:return _n(t.type)&&rc(),an(t),null;case 19:if(kt(It),i=t.memoizedState,i===null)return an(t),null;if(s=(t.flags&128)!==0,a=i.rendering,a===null)if(s)Li(i,!1);else{if(Dt!==0||e!==null&&e.flags&128)for(e=t.child;e!==null;){if(a=dc(e),a!==null){for(t.flags|=128,Li(i,!1),s=a.updateQueue,s!==null&&(t.updateQueue=s,t.flags|=4),t.subtreeFlags=0,s=n,n=t.child;n!==null;)i=n,e=s,i.flags&=14680066,a=i.alternate,a===null?(i.childLanes=0,i.lanes=e,i.child=null,i.subtreeFlags=0,i.memoizedProps=null,i.memoizedState=null,i.updateQueue=null,i.dependencies=null,i.stateNode=null):(i.childLanes=a.childLanes,i.lanes=a.lanes,i.child=a.child,i.subtreeFlags=0,i.deletions=null,i.memoizedProps=a.memoizedProps,i.memoizedState=a.memoizedState,i.updateQueue=a.updateQueue,i.type=a.type,e=a.dependencies,i.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext}),n=n.sibling;return yt(It,It.current&1|2),t.child}e=e.sibling}i.tail!==null&&$t()>Zo&&(t.flags|=128,s=!0,Li(i,!1),t.lanes=4194304)}else{if(!s)if(e=dc(a),e!==null){if(t.flags|=128,s=!0,n=e.updateQueue,n!==null&&(t.updateQueue=n,t.flags|=4),Li(i,!0),i.tail===null&&i.tailMode==="hidden"&&!a.alternate&&!jt)return an(t),null}else 2*$t()-i.renderingStartTime>Zo&&n!==1073741824&&(t.flags|=128,s=!0,Li(i,!1),t.lanes=4194304);i.isBackwards?(a.sibling=t.child,t.child=a):(n=i.last,n!==null?n.sibling=a:t.child=a,i.last=a)}return i.tail!==null?(t=i.tail,i.rendering=t,i.tail=t.sibling,i.renderingStartTime=$t(),t.sibling=null,n=It.current,yt(It,s?n&1|2:n&1),t):(an(t),null);case 22:case 23:return yf(),s=t.memoizedState!==null,e!==null&&e.memoizedState!==null!==s&&(t.flags|=8192),s&&t.mode&1?On&1073741824&&(an(t),t.subtreeFlags&6&&(t.flags|=8192)):an(t),null;case 24:return null;case 25:return null}throw Error(he(156,t.tag))}function r2(e,t){switch(Jp(t),t.tag){case 1:return _n(t.type)&&rc(),e=t.flags,e&65536?(t.flags=e&-65537|128,t):null;case 3:return Jo(),kt(Rn),kt(un),af(),e=t.flags,e&65536&&!(e&128)?(t.flags=e&-65537|128,t):null;case 5:return of(t),null;case 13:if(kt(It),e=t.memoizedState,e!==null&&e.dehydrated!==null){if(t.alternate===null)throw Error(he(340));Ko()}return e=t.flags,e&65536?(t.flags=e&-65537|128,t):null;case 19:return kt(It),null;case 4:return Jo(),null;case 10:return tf(t.type._context),null;case 22:case 23:return yf(),null;case 24:return null;default:return null}}var fl=!1,dn=!1,s2=typeof WeakSet=="function"?WeakSet:Set,_e=null;function Lo(e,t){var n=e.ref;if(n!==null)if(typeof n=="function")try{n(null)}catch(s){Nt(e,t,s)}else n.current=null}function cp(e,t,n){try{n()}catch(s){Nt(e,t,s)}}var Im=!1;function o2(e,t){if(Vu=Zl,e=lx(),Kp(e)){if("selectionStart"in e)var n={start:e.selectionStart,end:e.selectionEnd};else e:{n=(n=e.ownerDocument)&&n.defaultView||window;var s=n.getSelection&&n.getSelection();if(s&&s.rangeCount!==0){n=s.anchorNode;var o=s.anchorOffset,i=s.focusNode;s=s.focusOffset;try{n.nodeType,i.nodeType}catch{n=null;break e}var a=0,l=-1,d=-1,u=0,p=0,c=e,f=null;t:for(;;){for(var x;c!==n||o!==0&&c.nodeType!==3||(l=a+o),c!==i||s!==0&&c.nodeType!==3||(d=a+s),c.nodeType===3&&(a+=c.nodeValue.length),(x=c.firstChild)!==null;)f=c,c=x;for(;;){if(c===e)break t;if(f===n&&++u===o&&(l=a),f===i&&++p===s&&(d=a),(x=c.nextSibling)!==null)break;c=f,f=c.parentNode}c=x}n=l===-1||d===-1?null:{start:l,end:d}}else n=null}n=n||{start:0,end:0}}else n=null;for(Yu={focusedElem:e,selectionRange:n},Zl=!1,_e=t;_e!==null;)if(t=_e,e=t.child,(t.subtreeFlags&1028)!==0&&e!==null)e.return=t,_e=e;else for(;_e!==null;){t=_e;try{var C=t.alternate;if(t.flags&1024)switch(t.tag){case 0:case 11:case 15:break;case 1:if(C!==null){var w=C.memoizedProps,S=C.memoizedState,h=t.stateNode,g=h.getSnapshotBeforeUpdate(t.elementType===t.type?w:ar(t.type,w),S);h.__reactInternalSnapshotBeforeUpdate=g}break;case 3:var v=t.stateNode.containerInfo;v.nodeType===1?v.textContent="":v.nodeType===9&&v.documentElement&&v.removeChild(v.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(he(163))}}catch(j){Nt(t,t.return,j)}if(e=t.sibling,e!==null){e.return=t.return,_e=e;break}_e=t.return}return C=Im,Im=!1,C}function ta(e,t,n){var s=t.updateQueue;if(s=s!==null?s.lastEffect:null,s!==null){var o=s=s.next;do{if((o.tag&e)===e){var i=o.destroy;o.destroy=void 0,i!==void 0&&cp(t,n,i)}o=o.next}while(o!==s)}}function zc(e,t){if(t=t.updateQueue,t=t!==null?t.lastEffect:null,t!==null){var n=t=t.next;do{if((n.tag&e)===e){var s=n.create;n.destroy=s()}n=n.next}while(n!==t)}}function dp(e){var t=e.ref;if(t!==null){var n=e.stateNode;switch(e.tag){case 5:e=n;break;default:e=n}typeof t=="function"?t(e):t.current=e}}function sy(e){var t=e.alternate;t!==null&&(e.alternate=null,sy(t)),e.child=null,e.deletions=null,e.sibling=null,e.tag===5&&(t=e.stateNode,t!==null&&(delete t[kr],delete t[ga],delete t[Qu],delete t[FS],delete t[HS])),e.stateNode=null,e.return=null,e.dependencies=null,e.memoizedProps=null,e.memoizedState=null,e.pendingProps=null,e.stateNode=null,e.updateQueue=null}function oy(e){return e.tag===5||e.tag===3||e.tag===4}function Rm(e){e:for(;;){for(;e.sibling===null;){if(e.return===null||oy(e.return))return null;e=e.return}for(e.sibling.return=e.return,e=e.sibling;e.tag!==5&&e.tag!==6&&e.tag!==18;){if(e.flags&2||e.child===null||e.tag===4)continue e;e.child.return=e,e=e.child}if(!(e.flags&2))return e.stateNode}}function up(e,t,n){var s=e.tag;if(s===5||s===6)e=e.stateNode,t?n.nodeType===8?n.parentNode.insertBefore(e,t):n.insertBefore(e,t):(n.nodeType===8?(t=n.parentNode,t.insertBefore(e,n)):(t=n,t.appendChild(e)),n=n._reactRootContainer,n!=null||t.onclick!==null||(t.onclick=nc));else if(s!==4&&(e=e.child,e!==null))for(up(e,t,n),e=e.sibling;e!==null;)up(e,t,n),e=e.sibling}function pp(e,t,n){var s=e.tag;if(s===5||s===6)e=e.stateNode,t?n.insertBefore(e,t):n.appendChild(e);else if(s!==4&&(e=e.child,e!==null))for(pp(e,t,n),e=e.sibling;e!==null;)pp(e,t,n),e=e.sibling}var Qt=null,lr=!1;function ns(e,t,n){for(n=n.child;n!==null;)iy(e,t,n),n=n.sibling}function iy(e,t,n){if(jr&&typeof jr.onCommitFiberUnmount=="function")try{jr.onCommitFiberUnmount(Mc,n)}catch{}switch(n.tag){case 5:dn||Lo(n,t);case 6:var s=Qt,o=lr;Qt=null,ns(e,t,n),Qt=s,lr=o,Qt!==null&&(lr?(e=Qt,n=n.stateNode,e.nodeType===8?e.parentNode.removeChild(n):e.removeChild(n)):Qt.removeChild(n.stateNode));break;case 18:Qt!==null&&(lr?(e=Qt,n=n.stateNode,e.nodeType===8?Gd(e.parentNode,n):e.nodeType===1&&Gd(e,n),da(e)):Gd(Qt,n.stateNode));break;case 4:s=Qt,o=lr,Qt=n.stateNode.containerInfo,lr=!0,ns(e,t,n),Qt=s,lr=o;break;case 0:case 11:case 14:case 15:if(!dn&&(s=n.updateQueue,s!==null&&(s=s.lastEffect,s!==null))){o=s=s.next;do{var i=o,a=i.destroy;i=i.tag,a!==void 0&&(i&2||i&4)&&cp(n,t,a),o=o.next}while(o!==s)}ns(e,t,n);break;case 1:if(!dn&&(Lo(n,t),s=n.stateNode,typeof s.componentWillUnmount=="function"))try{s.props=n.memoizedProps,s.state=n.memoizedState,s.componentWillUnmount()}catch(l){Nt(n,t,l)}ns(e,t,n);break;case 21:ns(e,t,n);break;case 22:n.mode&1?(dn=(s=dn)||n.memoizedState!==null,ns(e,t,n),dn=s):ns(e,t,n);break;default:ns(e,t,n)}}function _m(e){var t=e.updateQueue;if(t!==null){e.updateQueue=null;var n=e.stateNode;n===null&&(n=e.stateNode=new s2),t.forEach(function(s){var o=m2.bind(null,e,s);n.has(s)||(n.add(s),s.then(o,o))})}}function sr(e,t){var n=t.deletions;if(n!==null)for(var s=0;s<n.length;s++){var o=n[s];try{var i=e,a=t,l=a;e:for(;l!==null;){switch(l.tag){case 5:Qt=l.stateNode,lr=!1;break e;case 3:Qt=l.stateNode.containerInfo,lr=!0;break e;case 4:Qt=l.stateNode.containerInfo,lr=!0;break e}l=l.return}if(Qt===null)throw Error(he(160));iy(i,a,o),Qt=null,lr=!1;var d=o.alternate;d!==null&&(d.return=null),o.return=null}catch(u){Nt(o,t,u)}}if(t.subtreeFlags&12854)for(t=t.child;t!==null;)ay(t,e),t=t.sibling}function ay(e,t){var n=e.alternate,s=e.flags;switch(e.tag){case 0:case 11:case 14:case 15:if(sr(t,e),xr(e),s&4){try{ta(3,e,e.return),zc(3,e)}catch(w){Nt(e,e.return,w)}try{ta(5,e,e.return)}catch(w){Nt(e,e.return,w)}}break;case 1:sr(t,e),xr(e),s&512&&n!==null&&Lo(n,n.return);break;case 5:if(sr(t,e),xr(e),s&512&&n!==null&&Lo(n,n.return),e.flags&32){var o=e.stateNode;try{ia(o,"")}catch(w){Nt(e,e.return,w)}}if(s&4&&(o=e.stateNode,o!=null)){var i=e.memoizedProps,a=n!==null?n.memoizedProps:i,l=e.type,d=e.updateQueue;if(e.updateQueue=null,d!==null)try{l==="input"&&i.type==="radio"&&i.name!=null&&Rh(o,i),Bu(l,a);var u=Bu(l,i);for(a=0;a<d.length;a+=2){var p=d[a],c=d[a+1];p==="style"?Lh(o,c):p==="dangerouslySetInnerHTML"?Ah(o,c):p==="children"?ia(o,c):Bp(o,p,c,u)}switch(l){case"input":Mu(o,i);break;case"textarea":_h(o,i);break;case"select":var f=o._wrapperState.wasMultiple;o._wrapperState.wasMultiple=!!i.multiple;var x=i.value;x!=null?Oo(o,!!i.multiple,x,!1):f!==!!i.multiple&&(i.defaultValue!=null?Oo(o,!!i.multiple,i.defaultValue,!0):Oo(o,!!i.multiple,i.multiple?[]:"",!1))}o[ga]=i}catch(w){Nt(e,e.return,w)}}break;case 6:if(sr(t,e),xr(e),s&4){if(e.stateNode===null)throw Error(he(162));o=e.stateNode,i=e.memoizedProps;try{o.nodeValue=i}catch(w){Nt(e,e.return,w)}}break;case 3:if(sr(t,e),xr(e),s&4&&n!==null&&n.memoizedState.isDehydrated)try{da(t.containerInfo)}catch(w){Nt(e,e.return,w)}break;case 4:sr(t,e),xr(e);break;case 13:sr(t,e),xr(e),o=e.child,o.flags&8192&&(i=o.memoizedState!==null,o.stateNode.isHidden=i,!i||o.alternate!==null&&o.alternate.memoizedState!==null||(hf=$t())),s&4&&_m(e);break;case 22:if(p=n!==null&&n.memoizedState!==null,e.mode&1?(dn=(u=dn)||p,sr(t,e),dn=u):sr(t,e),xr(e),s&8192){if(u=e.memoizedState!==null,(e.stateNode.isHidden=u)&&!p&&e.mode&1)for(_e=e,p=e.child;p!==null;){for(c=_e=p;_e!==null;){switch(f=_e,x=f.child,f.tag){case 0:case 11:case 14:case 15:ta(4,f,f.return);break;case 1:Lo(f,f.return);var C=f.stateNode;if(typeof C.componentWillUnmount=="function"){s=f,n=f.return;try{t=s,C.props=t.memoizedProps,C.state=t.memoizedState,C.componentWillUnmount()}catch(w){Nt(s,n,w)}}break;case 5:Lo(f,f.return);break;case 22:if(f.memoizedState!==null){Am(c);continue}}x!==null?(x.return=f,_e=x):Am(c)}p=p.sibling}e:for(p=null,c=e;;){if(c.tag===5){if(p===null){p=c;try{o=c.stateNode,u?(i=o.style,typeof i.setProperty=="function"?i.setProperty("display","none","important"):i.display="none"):(l=c.stateNode,d=c.memoizedProps.style,a=d!=null&&d.hasOwnProperty("display")?d.display:null,l.style.display=Nh("display",a))}catch(w){Nt(e,e.return,w)}}}else if(c.tag===6){if(p===null)try{c.stateNode.nodeValue=u?"":c.memoizedProps}catch(w){Nt(e,e.return,w)}}else if((c.tag!==22&&c.tag!==23||c.memoizedState===null||c===e)&&c.child!==null){c.child.return=c,c=c.child;continue}if(c===e)break e;for(;c.sibling===null;){if(c.return===null||c.return===e)break e;p===c&&(p=null),c=c.return}p===c&&(p=null),c.sibling.return=c.return,c=c.sibling}}break;case 19:sr(t,e),xr(e),s&4&&_m(e);break;case 21:break;default:sr(t,e),xr(e)}}function xr(e){var t=e.flags;if(t&2){try{e:{for(var n=e.return;n!==null;){if(oy(n)){var s=n;break e}n=n.return}throw Error(he(160))}switch(s.tag){case 5:var o=s.stateNode;s.flags&32&&(ia(o,""),s.flags&=-33);var i=Rm(e);pp(e,i,o);break;case 3:case 4:var a=s.stateNode.containerInfo,l=Rm(e);up(e,l,a);break;default:throw Error(he(161))}}catch(d){Nt(e,e.return,d)}e.flags&=-3}t&4096&&(e.flags&=-4097)}function i2(e,t,n){_e=e,ly(e)}function ly(e,t,n){for(var s=(e.mode&1)!==0;_e!==null;){var o=_e,i=o.child;if(o.tag===22&&s){var a=o.memoizedState!==null||fl;if(!a){var l=o.alternate,d=l!==null&&l.memoizedState!==null||dn;l=fl;var u=dn;if(fl=a,(dn=d)&&!u)for(_e=o;_e!==null;)a=_e,d=a.child,a.tag===22&&a.memoizedState!==null?Nm(o):d!==null?(d.return=a,_e=d):Nm(o);for(;i!==null;)_e=i,ly(i),i=i.sibling;_e=o,fl=l,dn=u}Mm(e)}else o.subtreeFlags&8772&&i!==null?(i.return=o,_e=i):Mm(e)}}function Mm(e){for(;_e!==null;){var t=_e;if(t.flags&8772){var n=t.alternate;try{if(t.flags&8772)switch(t.tag){case 0:case 11:case 15:dn||zc(5,t);break;case 1:var s=t.stateNode;if(t.flags&4&&!dn)if(n===null)s.componentDidMount();else{var o=t.elementType===t.type?n.memoizedProps:ar(t.type,n.memoizedProps);s.componentDidUpdate(o,n.memoizedState,s.__reactInternalSnapshotBeforeUpdate)}var i=t.updateQueue;i!==null&&gm(t,i,s);break;case 3:var a=t.updateQueue;if(a!==null){if(n=null,t.child!==null)switch(t.child.tag){case 5:n=t.child.stateNode;break;case 1:n=t.child.stateNode}gm(t,a,n)}break;case 5:var l=t.stateNode;if(n===null&&t.flags&4){n=l;var d=t.memoizedProps;switch(t.type){case"button":case"input":case"select":case"textarea":d.autoFocus&&n.focus();break;case"img":d.src&&(n.src=d.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(t.memoizedState===null){var u=t.alternate;if(u!==null){var p=u.memoizedState;if(p!==null){var c=p.dehydrated;c!==null&&da(c)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(he(163))}dn||t.flags&512&&dp(t)}catch(f){Nt(t,t.return,f)}}if(t===e){_e=null;break}if(n=t.sibling,n!==null){n.return=t.return,_e=n;break}_e=t.return}}function Am(e){for(;_e!==null;){var t=_e;if(t===e){_e=null;break}var n=t.sibling;if(n!==null){n.return=t.return,_e=n;break}_e=t.return}}function Nm(e){for(;_e!==null;){var t=_e;try{switch(t.tag){case 0:case 11:case 15:var n=t.return;try{zc(4,t)}catch(d){Nt(t,n,d)}break;case 1:var s=t.stateNode;if(typeof s.componentDidMount=="function"){var o=t.return;try{s.componentDidMount()}catch(d){Nt(t,o,d)}}var i=t.return;try{dp(t)}catch(d){Nt(t,i,d)}break;case 5:var a=t.return;try{dp(t)}catch(d){Nt(t,a,d)}}}catch(d){Nt(t,t.return,d)}if(t===e){_e=null;break}var l=t.sibling;if(l!==null){l.return=t.return,_e=l;break}_e=t.return}}var a2=Math.ceil,fc=Yr.ReactCurrentDispatcher,mf=Yr.ReactCurrentOwner,Xn=Yr.ReactCurrentBatchConfig,lt=0,Gt=null,Ot=null,Xt=0,On=0,$o=Cs(0),Dt=0,Sa=null,ro=0,Dc=0,gf=0,na=null,Tn=null,hf=0,Zo=1/0,Br=null,mc=!1,fp=null,bs=null,ml=!1,ps=null,gc=0,ra=0,mp=null,Pl=-1,zl=0;function bn(){return lt&6?$t():Pl!==-1?Pl:Pl=$t()}function vs(e){return e.mode&1?lt&2&&Xt!==0?Xt&-Xt:US.transition!==null?(zl===0&&(zl=Vh()),zl):(e=gt,e!==0||(e=window.event,e=e===void 0?16:Zh(e.type)),e):1}function ur(e,t,n,s){if(50<ra)throw ra=0,mp=null,Error(he(185));Ta(e,n,s),(!(lt&2)||e!==Gt)&&(e===Gt&&(!(lt&2)&&(Dc|=n),Dt===4&&ds(e,Xt)),Mn(e,s),n===1&&lt===0&&!(t.mode&1)&&(Zo=$t()+500,Bc&&Ts()))}function Mn(e,t){var n=e.callbackNode;Uv(e,t);var s=Xl(e,e===Gt?Xt:0);if(s===0)n!==null&&H0(n),e.callbackNode=null,e.callbackPriority=0;else if(t=s&-s,e.callbackPriority!==t){if(n!=null&&H0(n),t===1)e.tag===0?WS(Lm.bind(null,e)):yx(Lm.bind(null,e)),zS(function(){!(lt&6)&&Ts()}),n=null;else{switch(Yh(s)){case 1:n=Fp;break;case 4:n=Uh;break;case 16:n=Jl;break;case 536870912:n=Gh;break;default:n=Jl}n=hy(n,cy.bind(null,e))}e.callbackPriority=t,e.callbackNode=n}}function cy(e,t){if(Pl=-1,zl=0,lt&6)throw Error(he(327));var n=e.callbackNode;if(Ho()&&e.callbackNode!==n)return null;var s=Xl(e,e===Gt?Xt:0);if(s===0)return null;if(s&30||s&e.expiredLanes||t)t=hc(e,s);else{t=s;var o=lt;lt|=2;var i=uy();(Gt!==e||Xt!==t)&&(Br=null,Zo=$t()+500,Ks(e,t));do try{d2();break}catch(l){dy(e,l)}while(!0);ef(),fc.current=i,lt=o,Ot!==null?t=0:(Gt=null,Xt=0,t=Dt)}if(t!==0){if(t===2&&(o=Fu(e),o!==0&&(s=o,t=gp(e,o))),t===1)throw n=Sa,Ks(e,0),ds(e,s),Mn(e,$t()),n;if(t===6)ds(e,s);else{if(o=e.current.alternate,!(s&30)&&!l2(o)&&(t=hc(e,s),t===2&&(i=Fu(e),i!==0&&(s=i,t=gp(e,i))),t===1))throw n=Sa,Ks(e,0),ds(e,s),Mn(e,$t()),n;switch(e.finishedWork=o,e.finishedLanes=s,t){case 0:case 1:throw Error(he(345));case 2:Gs(e,Tn,Br);break;case 3:if(ds(e,s),(s&130023424)===s&&(t=hf+500-$t(),10<t)){if(Xl(e,0)!==0)break;if(o=e.suspendedLanes,(o&s)!==s){bn(),e.pingedLanes|=e.suspendedLanes&o;break}e.timeoutHandle=Ku(Gs.bind(null,e,Tn,Br),t);break}Gs(e,Tn,Br);break;case 4:if(ds(e,s),(s&4194240)===s)break;for(t=e.eventTimes,o=-1;0<s;){var a=31-dr(s);i=1<<a,a=t[a],a>o&&(o=a),s&=~i}if(s=o,s=$t()-s,s=(120>s?120:480>s?480:1080>s?1080:1920>s?1920:3e3>s?3e3:4320>s?4320:1960*a2(s/1960))-s,10<s){e.timeoutHandle=Ku(Gs.bind(null,e,Tn,Br),s);break}Gs(e,Tn,Br);break;case 5:Gs(e,Tn,Br);break;default:throw Error(he(329))}}}return Mn(e,$t()),e.callbackNode===n?cy.bind(null,e):null}function gp(e,t){var n=na;return e.current.memoizedState.isDehydrated&&(Ks(e,t).flags|=256),e=hc(e,t),e!==2&&(t=Tn,Tn=n,t!==null&&hp(t)),e}function hp(e){Tn===null?Tn=e:Tn.push.apply(Tn,e)}function l2(e){for(var t=e;;){if(t.flags&16384){var n=t.updateQueue;if(n!==null&&(n=n.stores,n!==null))for(var s=0;s<n.length;s++){var o=n[s],i=o.getSnapshot;o=o.value;try{if(!pr(i(),o))return!1}catch{return!1}}}if(n=t.child,t.subtreeFlags&16384&&n!==null)n.return=t,t=n;else{if(t===e)break;for(;t.sibling===null;){if(t.return===null||t.return===e)return!0;t=t.return}t.sibling.return=t.return,t=t.sibling}}return!0}function ds(e,t){for(t&=~gf,t&=~Dc,e.suspendedLanes|=t,e.pingedLanes&=~t,e=e.expirationTimes;0<t;){var n=31-dr(t),s=1<<n;e[n]=-1,t&=~s}}function Lm(e){if(lt&6)throw Error(he(327));Ho();var t=Xl(e,0);if(!(t&1))return Mn(e,$t()),null;var n=hc(e,t);if(e.tag!==0&&n===2){var s=Fu(e);s!==0&&(t=s,n=gp(e,s))}if(n===1)throw n=Sa,Ks(e,0),ds(e,t),Mn(e,$t()),n;if(n===6)throw Error(he(345));return e.finishedWork=e.current.alternate,e.finishedLanes=t,Gs(e,Tn,Br),Mn(e,$t()),null}function xf(e,t){var n=lt;lt|=1;try{return e(t)}finally{lt=n,lt===0&&(Zo=$t()+500,Bc&&Ts())}}function so(e){ps!==null&&ps.tag===0&&!(lt&6)&&Ho();var t=lt;lt|=1;var n=Xn.transition,s=gt;try{if(Xn.transition=null,gt=1,e)return e()}finally{gt=s,Xn.transition=n,lt=t,!(lt&6)&&Ts()}}function yf(){On=$o.current,kt($o)}function Ks(e,t){e.finishedWork=null,e.finishedLanes=0;var n=e.timeoutHandle;if(n!==-1&&(e.timeoutHandle=-1,PS(n)),Ot!==null)for(n=Ot.return;n!==null;){var s=n;switch(Jp(s),s.tag){case 1:s=s.type.childContextTypes,s!=null&&rc();break;case 3:Jo(),kt(Rn),kt(un),af();break;case 5:of(s);break;case 4:Jo();break;case 13:kt(It);break;case 19:kt(It);break;case 10:tf(s.type._context);break;case 22:case 23:yf()}n=n.return}if(Gt=e,Ot=e=Ss(e.current,null),Xt=On=t,Dt=0,Sa=null,gf=Dc=ro=0,Tn=na=null,Ys!==null){for(t=0;t<Ys.length;t++)if(n=Ys[t],s=n.interleaved,s!==null){n.interleaved=null;var o=s.next,i=n.pending;if(i!==null){var a=i.next;i.next=o,s.next=a}n.pending=s}Ys=null}return e}function dy(e,t){do{var n=Ot;try{if(ef(),$l.current=pc,uc){for(var s=Rt.memoizedState;s!==null;){var o=s.queue;o!==null&&(o.pending=null),s=s.next}uc=!1}if(no=0,Ut=Pt=Rt=null,ea=!1,ya=0,mf.current=null,n===null||n.return===null){Dt=1,Sa=t,Ot=null;break}e:{var i=e,a=n.return,l=n,d=t;if(t=Xt,l.flags|=32768,d!==null&&typeof d=="object"&&typeof d.then=="function"){var u=d,p=l,c=p.tag;if(!(p.mode&1)&&(c===0||c===11||c===15)){var f=p.alternate;f?(p.updateQueue=f.updateQueue,p.memoizedState=f.memoizedState,p.lanes=f.lanes):(p.updateQueue=null,p.memoizedState=null)}var x=Sm(a);if(x!==null){x.flags&=-257,wm(x,a,l,i,t),x.mode&1&&vm(i,u,t),t=x,d=u;var C=t.updateQueue;if(C===null){var w=new Set;w.add(d),t.updateQueue=w}else C.add(d);break e}else{if(!(t&1)){vm(i,u,t),bf();break e}d=Error(he(426))}}else if(jt&&l.mode&1){var S=Sm(a);if(S!==null){!(S.flags&65536)&&(S.flags|=256),wm(S,a,l,i,t),Xp(Xo(d,l));break e}}i=d=Xo(d,l),Dt!==4&&(Dt=2),na===null?na=[i]:na.push(i),i=a;do{switch(i.tag){case 3:i.flags|=65536,t&=-t,i.lanes|=t;var h=Yx(i,d,t);mm(i,h);break e;case 1:l=d;var g=i.type,v=i.stateNode;if(!(i.flags&128)&&(typeof g.getDerivedStateFromError=="function"||v!==null&&typeof v.componentDidCatch=="function"&&(bs===null||!bs.has(v)))){i.flags|=65536,t&=-t,i.lanes|=t;var j=qx(i,l,t);mm(i,j);break e}}i=i.return}while(i!==null)}fy(n)}catch(R){t=R,Ot===n&&n!==null&&(Ot=n=n.return);continue}break}while(!0)}function uy(){var e=fc.current;return fc.current=pc,e===null?pc:e}function bf(){(Dt===0||Dt===3||Dt===2)&&(Dt=4),Gt===null||!(ro&268435455)&&!(Dc&268435455)||ds(Gt,Xt)}function hc(e,t){var n=lt;lt|=2;var s=uy();(Gt!==e||Xt!==t)&&(Br=null,Ks(e,t));do try{c2();break}catch(o){dy(e,o)}while(!0);if(ef(),lt=n,fc.current=s,Ot!==null)throw Error(he(261));return Gt=null,Xt=0,Dt}function c2(){for(;Ot!==null;)py(Ot)}function d2(){for(;Ot!==null&&!$v();)py(Ot)}function py(e){var t=gy(e.alternate,e,On);e.memoizedProps=e.pendingProps,t===null?fy(e):Ot=t,mf.current=null}function fy(e){var t=e;do{var n=t.alternate;if(e=t.return,t.flags&32768){if(n=r2(n,t),n!==null){n.flags&=32767,Ot=n;return}if(e!==null)e.flags|=32768,e.subtreeFlags=0,e.deletions=null;else{Dt=6,Ot=null;return}}else if(n=n2(n,t,On),n!==null){Ot=n;return}if(t=t.sibling,t!==null){Ot=t;return}Ot=t=e}while(t!==null);Dt===0&&(Dt=5)}function Gs(e,t,n){var s=gt,o=Xn.transition;try{Xn.transition=null,gt=1,u2(e,t,n,s)}finally{Xn.transition=o,gt=s}return null}function u2(e,t,n,s){do Ho();while(ps!==null);if(lt&6)throw Error(he(327));n=e.finishedWork;var o=e.finishedLanes;if(n===null)return null;if(e.finishedWork=null,e.finishedLanes=0,n===e.current)throw Error(he(177));e.callbackNode=null,e.callbackPriority=0;var i=n.lanes|n.childLanes;if(Gv(e,i),e===Gt&&(Ot=Gt=null,Xt=0),!(n.subtreeFlags&2064)&&!(n.flags&2064)||ml||(ml=!0,hy(Jl,function(){return Ho(),null})),i=(n.flags&15990)!==0,n.subtreeFlags&15990||i){i=Xn.transition,Xn.transition=null;var a=gt;gt=1;var l=lt;lt|=4,mf.current=null,o2(e,n),ay(n,e),MS(Yu),Zl=!!Vu,Yu=Vu=null,e.current=n,i2(n),Bv(),lt=l,gt=a,Xn.transition=i}else e.current=n;if(ml&&(ml=!1,ps=e,gc=o),i=e.pendingLanes,i===0&&(bs=null),zv(n.stateNode),Mn(e,$t()),t!==null)for(s=e.onRecoverableError,n=0;n<t.length;n++)o=t[n],s(o.value,{componentStack:o.stack,digest:o.digest});if(mc)throw mc=!1,e=fp,fp=null,e;return gc&1&&e.tag!==0&&Ho(),i=e.pendingLanes,i&1?e===mp?ra++:(ra=0,mp=e):ra=0,Ts(),null}function Ho(){if(ps!==null){var e=Yh(gc),t=Xn.transition,n=gt;try{if(Xn.transition=null,gt=16>e?16:e,ps===null)var s=!1;else{if(e=ps,ps=null,gc=0,lt&6)throw Error(he(331));var o=lt;for(lt|=4,_e=e.current;_e!==null;){var i=_e,a=i.child;if(_e.flags&16){var l=i.deletions;if(l!==null){for(var d=0;d<l.length;d++){var u=l[d];for(_e=u;_e!==null;){var p=_e;switch(p.tag){case 0:case 11:case 15:ta(8,p,i)}var c=p.child;if(c!==null)c.return=p,_e=c;else for(;_e!==null;){p=_e;var f=p.sibling,x=p.return;if(sy(p),p===u){_e=null;break}if(f!==null){f.return=x,_e=f;break}_e=x}}}var C=i.alternate;if(C!==null){var w=C.child;if(w!==null){C.child=null;do{var S=w.sibling;w.sibling=null,w=S}while(w!==null)}}_e=i}}if(i.subtreeFlags&2064&&a!==null)a.return=i,_e=a;else e:for(;_e!==null;){if(i=_e,i.flags&2048)switch(i.tag){case 0:case 11:case 15:ta(9,i,i.return)}var h=i.sibling;if(h!==null){h.return=i.return,_e=h;break e}_e=i.return}}var g=e.current;for(_e=g;_e!==null;){a=_e;var v=a.child;if(a.subtreeFlags&2064&&v!==null)v.return=a,_e=v;else e:for(a=g;_e!==null;){if(l=_e,l.flags&2048)try{switch(l.tag){case 0:case 11:case 15:zc(9,l)}}catch(R){Nt(l,l.return,R)}if(l===a){_e=null;break e}var j=l.sibling;if(j!==null){j.return=l.return,_e=j;break e}_e=l.return}}if(lt=o,Ts(),jr&&typeof jr.onPostCommitFiberRoot=="function")try{jr.onPostCommitFiberRoot(Mc,e)}catch{}s=!0}return s}finally{gt=n,Xn.transition=t}}return!1}function $m(e,t,n){t=Xo(n,t),t=Yx(e,t,1),e=ys(e,t,1),t=bn(),e!==null&&(Ta(e,1,t),Mn(e,t))}function Nt(e,t,n){if(e.tag===3)$m(e,e,n);else for(;t!==null;){if(t.tag===3){$m(t,e,n);break}else if(t.tag===1){var s=t.stateNode;if(typeof t.type.getDerivedStateFromError=="function"||typeof s.componentDidCatch=="function"&&(bs===null||!bs.has(s))){e=Xo(n,e),e=qx(t,e,1),t=ys(t,e,1),e=bn(),t!==null&&(Ta(t,1,e),Mn(t,e));break}}t=t.return}}function p2(e,t,n){var s=e.pingCache;s!==null&&s.delete(t),t=bn(),e.pingedLanes|=e.suspendedLanes&n,Gt===e&&(Xt&n)===n&&(Dt===4||Dt===3&&(Xt&130023424)===Xt&&500>$t()-hf?Ks(e,0):gf|=n),Mn(e,t)}function my(e,t){t===0&&(e.mode&1?(t=sl,sl<<=1,!(sl&130023424)&&(sl=4194304)):t=1);var n=bn();e=Ur(e,t),e!==null&&(Ta(e,t,n),Mn(e,n))}function f2(e){var t=e.memoizedState,n=0;t!==null&&(n=t.retryLane),my(e,n)}function m2(e,t){var n=0;switch(e.tag){case 13:var s=e.stateNode,o=e.memoizedState;o!==null&&(n=o.retryLane);break;case 19:s=e.stateNode;break;default:throw Error(he(314))}s!==null&&s.delete(t),my(e,n)}var gy;gy=function(e,t,n){if(e!==null)if(e.memoizedProps!==t.pendingProps||Rn.current)In=!0;else{if(!(e.lanes&n)&&!(t.flags&128))return In=!1,t2(e,t,n);In=!!(e.flags&131072)}else In=!1,jt&&t.flags&1048576&&bx(t,ic,t.index);switch(t.lanes=0,t.tag){case 2:var s=t.type;Ol(e,t),e=t.pendingProps;var o=qo(t,un.current);Fo(t,n),o=cf(null,t,s,e,o,n);var i=df();return t.flags|=1,typeof o=="object"&&o!==null&&typeof o.render=="function"&&o.$$typeof===void 0?(t.tag=1,t.memoizedState=null,t.updateQueue=null,_n(s)?(i=!0,sc(t)):i=!1,t.memoizedState=o.state!==null&&o.state!==void 0?o.state:null,rf(t),o.updater=Pc,t.stateNode=o,o._reactInternals=t,np(t,s,e,n),t=op(null,t,s,!0,i,n)):(t.tag=0,jt&&i&&Qp(t),yn(null,t,o,n),t=t.child),t;case 16:s=t.elementType;e:{switch(Ol(e,t),e=t.pendingProps,o=s._init,s=o(s._payload),t.type=s,o=t.tag=h2(s),e=ar(s,e),o){case 0:t=sp(null,t,s,e,n);break e;case 1:t=jm(null,t,s,e,n);break e;case 11:t=km(null,t,s,e,n);break e;case 14:t=Em(null,t,s,ar(s.type,e),n);break e}throw Error(he(306,s,""))}return t;case 0:return s=t.type,o=t.pendingProps,o=t.elementType===s?o:ar(s,o),sp(e,t,s,o,n);case 1:return s=t.type,o=t.pendingProps,o=t.elementType===s?o:ar(s,o),jm(e,t,s,o,n);case 3:e:{if(Xx(t),e===null)throw Error(he(387));s=t.pendingProps,i=t.memoizedState,o=i.element,jx(e,t),cc(t,s,null,n);var a=t.memoizedState;if(s=a.element,i.isDehydrated)if(i={element:s,isDehydrated:!1,cache:a.cache,pendingSuspenseBoundaries:a.pendingSuspenseBoundaries,transitions:a.transitions},t.updateQueue.baseState=i,t.memoizedState=i,t.flags&256){o=Xo(Error(he(423)),t),t=Cm(e,t,s,n,o);break e}else if(s!==o){o=Xo(Error(he(424)),t),t=Cm(e,t,s,n,o);break e}else for(Pn=xs(t.stateNode.containerInfo.firstChild),Dn=t,jt=!0,cr=null,n=kx(t,null,s,n),t.child=n;n;)n.flags=n.flags&-3|4096,n=n.sibling;else{if(Ko(),s===o){t=Gr(e,t,n);break e}yn(e,t,s,n)}t=t.child}return t;case 5:return Cx(t),e===null&&Zu(t),s=t.type,o=t.pendingProps,i=e!==null?e.memoizedProps:null,a=o.children,qu(s,o)?a=null:i!==null&&qu(s,i)&&(t.flags|=32),Jx(e,t),yn(e,t,a,n),t.child;case 6:return e===null&&Zu(t),null;case 13:return Zx(e,t,n);case 4:return sf(t,t.stateNode.containerInfo),s=t.pendingProps,e===null?t.child=Qo(t,null,s,n):yn(e,t,s,n),t.child;case 11:return s=t.type,o=t.pendingProps,o=t.elementType===s?o:ar(s,o),km(e,t,s,o,n);case 7:return yn(e,t,t.pendingProps,n),t.child;case 8:return yn(e,t,t.pendingProps.children,n),t.child;case 12:return yn(e,t,t.pendingProps.children,n),t.child;case 10:e:{if(s=t.type._context,o=t.pendingProps,i=t.memoizedProps,a=o.value,yt(ac,s._currentValue),s._currentValue=a,i!==null)if(pr(i.value,a)){if(i.children===o.children&&!Rn.current){t=Gr(e,t,n);break e}}else for(i=t.child,i!==null&&(i.return=t);i!==null;){var l=i.dependencies;if(l!==null){a=i.child;for(var d=l.firstContext;d!==null;){if(d.context===s){if(i.tag===1){d=Fr(-1,n&-n),d.tag=2;var u=i.updateQueue;if(u!==null){u=u.shared;var p=u.pending;p===null?d.next=d:(d.next=p.next,p.next=d),u.pending=d}}i.lanes|=n,d=i.alternate,d!==null&&(d.lanes|=n),ep(i.return,n,t),l.lanes|=n;break}d=d.next}}else if(i.tag===10)a=i.type===t.type?null:i.child;else if(i.tag===18){if(a=i.return,a===null)throw Error(he(341));a.lanes|=n,l=a.alternate,l!==null&&(l.lanes|=n),ep(a,n,t),a=i.sibling}else a=i.child;if(a!==null)a.return=i;else for(a=i;a!==null;){if(a===t){a=null;break}if(i=a.sibling,i!==null){i.return=a.return,a=i;break}a=a.return}i=a}yn(e,t,o.children,n),t=t.child}return t;case 9:return o=t.type,s=t.pendingProps.children,Fo(t,n),o=Zn(o),s=s(o),t.flags|=1,yn(e,t,s,n),t.child;case 14:return s=t.type,o=ar(s,t.pendingProps),o=ar(s.type,o),Em(e,t,s,o,n);case 15:return Kx(e,t,t.type,t.pendingProps,n);case 17:return s=t.type,o=t.pendingProps,o=t.elementType===s?o:ar(s,o),Ol(e,t),t.tag=1,_n(s)?(e=!0,sc(t)):e=!1,Fo(t,n),Vx(t,s,o),np(t,s,o,n),op(null,t,s,!0,e,n);case 19:return ey(e,t,n);case 22:return Qx(e,t,n)}throw Error(he(156,t.tag))};function hy(e,t){return Wh(e,t)}function g2(e,t,n,s){this.tag=e,this.key=n,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=t,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=s,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Jn(e,t,n,s){return new g2(e,t,n,s)}function vf(e){return e=e.prototype,!(!e||!e.isReactComponent)}function h2(e){if(typeof e=="function")return vf(e)?1:0;if(e!=null){if(e=e.$$typeof,e===Pp)return 11;if(e===zp)return 14}return 2}function Ss(e,t){var n=e.alternate;return n===null?(n=Jn(e.tag,t,e.key,e.mode),n.elementType=e.elementType,n.type=e.type,n.stateNode=e.stateNode,n.alternate=e,e.alternate=n):(n.pendingProps=t,n.type=e.type,n.flags=0,n.subtreeFlags=0,n.deletions=null),n.flags=e.flags&14680064,n.childLanes=e.childLanes,n.lanes=e.lanes,n.child=e.child,n.memoizedProps=e.memoizedProps,n.memoizedState=e.memoizedState,n.updateQueue=e.updateQueue,t=e.dependencies,n.dependencies=t===null?null:{lanes:t.lanes,firstContext:t.firstContext},n.sibling=e.sibling,n.index=e.index,n.ref=e.ref,n}function Dl(e,t,n,s,o,i){var a=2;if(s=e,typeof e=="function")vf(e)&&(a=1);else if(typeof e=="string")a=5;else e:switch(e){case jo:return Qs(n.children,o,i,t);case Op:a=8,o|=8;break;case Cu:return e=Jn(12,n,t,o|2),e.elementType=Cu,e.lanes=i,e;case Tu:return e=Jn(13,n,t,o),e.elementType=Tu,e.lanes=i,e;case Iu:return e=Jn(19,n,t,o),e.elementType=Iu,e.lanes=i,e;case Ch:return Fc(n,o,i,t);default:if(typeof e=="object"&&e!==null)switch(e.$$typeof){case Eh:a=10;break e;case jh:a=9;break e;case Pp:a=11;break e;case zp:a=14;break e;case is:a=16,s=null;break e}throw Error(he(130,e==null?e:typeof e,""))}return t=Jn(a,n,t,o),t.elementType=e,t.type=s,t.lanes=i,t}function Qs(e,t,n,s){return e=Jn(7,e,s,t),e.lanes=n,e}function Fc(e,t,n,s){return e=Jn(22,e,s,t),e.elementType=Ch,e.lanes=n,e.stateNode={isHidden:!1},e}function Zd(e,t,n){return e=Jn(6,e,null,t),e.lanes=n,e}function eu(e,t,n){return t=Jn(4,e.children!==null?e.children:[],e.key,t),t.lanes=n,t.stateNode={containerInfo:e.containerInfo,pendingChildren:null,implementation:e.implementation},t}function x2(e,t,n,s,o){this.tag=t,this.containerInfo=e,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=Ld(0),this.expirationTimes=Ld(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Ld(0),this.identifierPrefix=s,this.onRecoverableError=o,this.mutableSourceEagerHydrationData=null}function Sf(e,t,n,s,o,i,a,l,d){return e=new x2(e,t,n,l,d),t===1?(t=1,i===!0&&(t|=8)):t=0,i=Jn(3,null,null,t),e.current=i,i.stateNode=e,i.memoizedState={element:s,isDehydrated:n,cache:null,transitions:null,pendingSuspenseBoundaries:null},rf(i),e}function y2(e,t,n){var s=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:Eo,key:s==null?null:""+s,children:e,containerInfo:t,implementation:n}}function xy(e){if(!e)return Es;e=e._reactInternals;e:{if(lo(e)!==e||e.tag!==1)throw Error(he(170));var t=e;do{switch(t.tag){case 3:t=t.stateNode.context;break e;case 1:if(_n(t.type)){t=t.stateNode.__reactInternalMemoizedMergedChildContext;break e}}t=t.return}while(t!==null);throw Error(he(171))}if(e.tag===1){var n=e.type;if(_n(n))return xx(e,n,t)}return t}function yy(e,t,n,s,o,i,a,l,d){return e=Sf(n,s,!0,e,o,i,a,l,d),e.context=xy(null),n=e.current,s=bn(),o=vs(n),i=Fr(s,o),i.callback=t??null,ys(n,i,o),e.current.lanes=o,Ta(e,o,s),Mn(e,s),e}function Hc(e,t,n,s){var o=t.current,i=bn(),a=vs(o);return n=xy(n),t.context===null?t.context=n:t.pendingContext=n,t=Fr(i,a),t.payload={element:e},s=s===void 0?null:s,s!==null&&(t.callback=s),e=ys(o,t,a),e!==null&&(ur(e,o,a,i),Ll(e,o,a)),a}function xc(e){if(e=e.current,!e.child)return null;switch(e.child.tag){case 5:return e.child.stateNode;default:return e.child.stateNode}}function Bm(e,t){if(e=e.memoizedState,e!==null&&e.dehydrated!==null){var n=e.retryLane;e.retryLane=n!==0&&n<t?n:t}}function wf(e,t){Bm(e,t),(e=e.alternate)&&Bm(e,t)}function b2(){return null}var by=typeof reportError=="function"?reportError:function(e){console.error(e)};function kf(e){this._internalRoot=e}Wc.prototype.render=kf.prototype.render=function(e){var t=this._internalRoot;if(t===null)throw Error(he(409));Hc(e,t,null,null)};Wc.prototype.unmount=kf.prototype.unmount=function(){var e=this._internalRoot;if(e!==null){this._internalRoot=null;var t=e.containerInfo;so(function(){Hc(null,e,null,null)}),t[Wr]=null}};function Wc(e){this._internalRoot=e}Wc.prototype.unstable_scheduleHydration=function(e){if(e){var t=Qh();e={blockedOn:null,target:e,priority:t};for(var n=0;n<cs.length&&t!==0&&t<cs[n].priority;n++);cs.splice(n,0,e),n===0&&Xh(e)}};function Ef(e){return!(!e||e.nodeType!==1&&e.nodeType!==9&&e.nodeType!==11)}function Uc(e){return!(!e||e.nodeType!==1&&e.nodeType!==9&&e.nodeType!==11&&(e.nodeType!==8||e.nodeValue!==" react-mount-point-unstable "))}function Om(){}function v2(e,t,n,s,o){if(o){if(typeof s=="function"){var i=s;s=function(){var u=xc(a);i.call(u)}}var a=yy(t,s,e,0,null,!1,!1,"",Om);return e._reactRootContainer=a,e[Wr]=a.current,fa(e.nodeType===8?e.parentNode:e),so(),a}for(;o=e.lastChild;)e.removeChild(o);if(typeof s=="function"){var l=s;s=function(){var u=xc(d);l.call(u)}}var d=Sf(e,0,!1,null,null,!1,!1,"",Om);return e._reactRootContainer=d,e[Wr]=d.current,fa(e.nodeType===8?e.parentNode:e),so(function(){Hc(t,d,n,s)}),d}function Gc(e,t,n,s,o){var i=n._reactRootContainer;if(i){var a=i;if(typeof o=="function"){var l=o;o=function(){var d=xc(a);l.call(d)}}Hc(t,a,e,o)}else a=v2(n,t,e,o,s);return xc(a)}qh=function(e){switch(e.tag){case 3:var t=e.stateNode;if(t.current.memoizedState.isDehydrated){var n=Ui(t.pendingLanes);n!==0&&(Hp(t,n|1),Mn(t,$t()),!(lt&6)&&(Zo=$t()+500,Ts()))}break;case 13:so(function(){var s=Ur(e,1);if(s!==null){var o=bn();ur(s,e,1,o)}}),wf(e,1)}};Wp=function(e){if(e.tag===13){var t=Ur(e,134217728);if(t!==null){var n=bn();ur(t,e,134217728,n)}wf(e,134217728)}};Kh=function(e){if(e.tag===13){var t=vs(e),n=Ur(e,t);if(n!==null){var s=bn();ur(n,e,t,s)}wf(e,t)}};Qh=function(){return gt};Jh=function(e,t){var n=gt;try{return gt=e,t()}finally{gt=n}};Pu=function(e,t,n){switch(t){case"input":if(Mu(e,n),t=n.name,n.type==="radio"&&t!=null){for(n=e;n.parentNode;)n=n.parentNode;for(n=n.querySelectorAll("input[name="+JSON.stringify(""+t)+'][type="radio"]'),t=0;t<n.length;t++){var s=n[t];if(s!==e&&s.form===e.form){var o=$c(s);if(!o)throw Error(he(90));Ih(s),Mu(s,o)}}}break;case"textarea":_h(e,n);break;case"select":t=n.value,t!=null&&Oo(e,!!n.multiple,t,!1)}};Oh=xf;Ph=so;var S2={usingClientEntryPoint:!1,Events:[Ra,Ro,$c,$h,Bh,xf]},$i={findFiberByHostInstance:Vs,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},w2={bundleType:$i.bundleType,version:$i.version,rendererPackageName:$i.rendererPackageName,rendererConfig:$i.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:Yr.ReactCurrentDispatcher,findHostInstanceByFiber:function(e){return e=Fh(e),e===null?null:e.stateNode},findFiberByHostInstance:$i.findFiberByHostInstance||b2,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var gl=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!gl.isDisabled&&gl.supportsFiber)try{Mc=gl.inject(w2),jr=gl}catch{}}Hn.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=S2;Hn.createPortal=function(e,t){var n=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!Ef(t))throw Error(he(200));return y2(e,t,null,n)};Hn.createRoot=function(e,t){if(!Ef(e))throw Error(he(299));var n=!1,s="",o=by;return t!=null&&(t.unstable_strictMode===!0&&(n=!0),t.identifierPrefix!==void 0&&(s=t.identifierPrefix),t.onRecoverableError!==void 0&&(o=t.onRecoverableError)),t=Sf(e,1,!1,null,null,n,!1,s,o),e[Wr]=t.current,fa(e.nodeType===8?e.parentNode:e),new kf(t)};Hn.findDOMNode=function(e){if(e==null)return null;if(e.nodeType===1)return e;var t=e._reactInternals;if(t===void 0)throw typeof e.render=="function"?Error(he(188)):(e=Object.keys(e).join(","),Error(he(268,e)));return e=Fh(t),e=e===null?null:e.stateNode,e};Hn.flushSync=function(e){return so(e)};Hn.hydrate=function(e,t,n){if(!Uc(t))throw Error(he(200));return Gc(null,e,t,!0,n)};Hn.hydrateRoot=function(e,t,n){if(!Ef(e))throw Error(he(405));var s=n!=null&&n.hydratedSources||null,o=!1,i="",a=by;if(n!=null&&(n.unstable_strictMode===!0&&(o=!0),n.identifierPrefix!==void 0&&(i=n.identifierPrefix),n.onRecoverableError!==void 0&&(a=n.onRecoverableError)),t=yy(t,null,e,1,n??null,o,!1,i,a),e[Wr]=t.current,fa(e),s)for(e=0;e<s.length;e++)n=s[e],o=n._getVersion,o=o(n._source),t.mutableSourceEagerHydrationData==null?t.mutableSourceEagerHydrationData=[n,o]:t.mutableSourceEagerHydrationData.push(n,o);return new Wc(t)};Hn.render=function(e,t,n){if(!Uc(t))throw Error(he(200));return Gc(null,e,t,!1,n)};Hn.unmountComponentAtNode=function(e){if(!Uc(e))throw Error(he(40));return e._reactRootContainer?(so(function(){Gc(null,null,e,!1,function(){e._reactRootContainer=null,e[Wr]=null})}),!0):!1};Hn.unstable_batchedUpdates=xf;Hn.unstable_renderSubtreeIntoContainer=function(e,t,n,s){if(!Uc(n))throw Error(he(200));if(e==null||e._reactInternals===void 0)throw Error(he(38));return Gc(e,t,n,!1,s)};Hn.version="18.3.1-next-f1338f8080-20240426";function vy(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(vy)}catch(e){console.error(e)}}vy(),vh.exports=Hn;var k2=vh.exports,Pm=k2;Eu.createRoot=Pm.createRoot,Eu.hydrateRoot=Pm.hydrateRoot;const E2="modulepreload",j2=function(e,t){return new URL(e,t).href},zm={},C2=function(t,n,s){let o=Promise.resolve();if(n&&n.length>0){const a=document.getElementsByTagName("link"),l=document.querySelector("meta[property=csp-nonce]"),d=(l==null?void 0:l.nonce)||(l==null?void 0:l.getAttribute("nonce"));o=Promise.allSettled(n.map(u=>{if(u=j2(u,s),u in zm)return;zm[u]=!0;const p=u.endsWith(".css"),c=p?'[rel="stylesheet"]':"";if(!!s)for(let C=a.length-1;C>=0;C--){const w=a[C];if(w.href===u&&(!p||w.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${u}"]${c}`))return;const x=document.createElement("link");if(x.rel=p?"stylesheet":E2,p||(x.as="script"),x.crossOrigin="",x.href=u,d&&x.setAttribute("nonce",d),document.head.appendChild(x),p)return new Promise((C,w)=>{x.addEventListener("load",C),x.addEventListener("error",()=>w(new Error(`Unable to preload CSS for ${u}`)))})}))}function i(a){const l=new Event("vite:preloadError",{cancelable:!0});if(l.payload=a,window.dispatchEvent(l),!l.defaultPrevented)throw a}return o.then(a=>{for(const l of a||[])l.status==="rejected"&&i(l.reason);return t().catch(i)})},Ie={colors:{background:"#F8F3EE",paper:"#F4EEE6",ink:"#2E2B26",primary:"#6B513A",accent:"#7AA893",muted:"#A59786",parchment:"#EDE3D6",border:"#B8A895",shadow:"rgba(34,28,22,0.12)"},gradients:{subtle:"linear-gradient(135deg, rgba(255,255,255,0.6), rgba(240,235,230,0.6))",warm:"linear-gradient(135deg, #EDE3D6 0%, #F4EEE6 100%)"},sizes:{navHeight:"56px"}},Dm={appContainer:{display:"flex",flexDirection:"column",height:"100vh",fontFamily:"'Noto Serif SC', serif",backgroundColor:Ie.colors.background,backgroundImage:"linear-gradient(rgba(245, 240, 232, 0.6), rgba(245, 240, 232, 0.6))",backgroundSize:"100% 100%"},mainContent:{flex:1,padding:"15px",paddingBottom:"70px",overflowY:"auto"}};function T2(){const[e,t]=y.useState({type:null,data:null}),[n,s]=y.useState(!1),[o,i]=y.useState(!1),[a,l]=y.useState(!1),[d,u]=y.useState(!1),[p,c]=y.useState(!1),[f,x]=y.useState(!1),[C,w]=y.useState({open:!1,npc:null}),[S,h]=y.useState({open:!1,mode:"VIEW",slot:null,childId:null}),[g,v]=y.useState(!1),[j,R]=y.useState(!1),[b,_]=y.useState(!1),[I,k]=y.useState(!1),T=y.useCallback((ke,Ee=null)=>{t({type:ke,data:Ee})},[]),N=y.useCallback(()=>{t({type:null,data:null})},[]),K=y.useCallback(()=>s(!0),[]),L=y.useCallback(()=>s(!1),[]),B=y.useCallback(()=>i(!0),[]),W=y.useCallback(()=>i(!1),[]),z=y.useCallback(()=>l(!0),[]),ne=y.useCallback(()=>l(!1),[]),Q=y.useCallback(()=>u(!0),[]),se=y.useCallback(()=>u(!1),[]),ye=y.useCallback(()=>c(!0),[]),Me=y.useCallback(()=>c(!1),[]),Pe=y.useCallback(()=>x(!0),[]),Ke=y.useCallback(()=>x(!1),[]),q=y.useCallback(ke=>{w({open:!0,npc:ke})},[]),de=y.useCallback(()=>{w({open:!1,npc:null})},[]),Z=y.useCallback((ke="VIEW",Ee=null,Xe=null)=>{h({open:!0,mode:ke,slot:Ee,childId:Xe})},[]),re=y.useCallback(()=>{h({open:!1,mode:"VIEW",slot:null,childId:null})},[]),ce=y.useCallback(()=>v(!0),[]),le=y.useCallback(()=>v(!1),[]),we=y.useCallback(()=>R(!0),[]),Ue=y.useCallback(()=>R(!1),[]),Oe=y.useCallback(()=>_(!0),[]),ze=y.useCallback(()=>_(!1),[]),D=y.useCallback(()=>k(!0),[]),me=y.useCallback(()=>k(!1),[]),xe=y.useCallback(()=>{N(),s(!1),i(!1),l(!1),u(!1),c(!1),x(!1),w({open:!1,npc:null}),h({open:!1,mode:"VIEW",slot:null,childId:null}),v(!1),R(!1),_(!1),k(!1)},[N]);return y.useMemo(()=>({modalState:e,openModal:T,closeModal:N,showGazette:n,setShowGazette:s,openGazette:K,closeGazette:L,showMessageCenter:o,setShowMessageCenter:i,openMessageCenter:B,closeMessageCenter:W,showGuide:a,setShowGuide:l,openGuide:z,closeGuide:ne,showTutorial:d,setShowTutorial:u,openTutorial:Q,closeTutorial:se,showBizPanel:p,setShowBizPanel:c,openBizPanel:ye,closeBizPanel:Me,showChallengePanel:f,setShowChallengePanel:x,openChallengePanel:Pe,closeChallengePanel:Ke,npcLogModal:C,setNpcLogModal:w,openNpcLog:q,closeNpcLog:de,inventoryModal:S,showBatchGiftModal:g,setShowBatchGiftModal:v,openBatchGiftModal:ce,closeBatchGiftModal:le,showBatchPromotionModal:j,setShowBatchPromotionModal:R,openBatchPromotionModal:we,closeBatchPromotionModal:Ue,showBatchMarriageModal:b,setShowBatchMarriageModal:_,openBatchMarriageModal:Oe,closeBatchMarriageModal:ze,showBatchManualModal:I,setShowBatchManualModal:k,openBatchManualModal:D,closeBatchManualModal:me,openInventory:Z,closeInventory:re,closeAllModals:xe}),[e,n,o,a,d,p,f,C,S,g,j,b,I])}const ht={PLAYER:"player",CHILD:"child",NPC:"npc"},Sy=[ht.PLAYER,ht.CHILD,ht.NPC],J={MORTAL:{key:"MORTAL",label:"",color:"#a1887f",order:1,desc:""},SPIRIT:{key:"SPIRIT",label:"",color:"#00897b",order:2,desc:""},EARTH:{key:"EARTH",label:"",color:"#7cb342",order:3,desc:""},HEAVEN:{key:"HEAVEN",label:"",color:"#5e35b1",order:4,desc:""},DIVINE:{key:"DIVINE",label:"",color:"#ffa000",order:5,desc:""}},Te={GENERAL:{id:"GENERAL"},ELEMENTAL:{id:"ELEMENTAL"},VARIANT:{id:"VARIANT"},DUAL:{id:"DUAL"},DEVIL:{id:"DEVIL"}},hl={SABER:{id:"SABER"},SPEAR:{id:"SPEAR"},RELIC:{id:"RELIC"}},ct={BODY:{id:"BODY"},FOUNDATION:{id:"FOUNDATION"},CORE:{id:"CORE"},NASCENT:{id:"NASCENT"},ASCENSION:{id:"ASCENSION"}},I2={[ht.PLAYER]:"",[ht.CHILD]:"",[ht.NPC]:""},xl=()=>[...Sy],fe=()=>[ht.PLAYER,ht.CHILD],R2=()=>[ht.CHILD],Vc={herb_bandage:{id:"herb_bandage",name:"",type:"consumable",rarity:"common",desc:"",effect:{kind:"heal",amount:100},resourceCategory:"PILL",resourceLevel:J.MORTAL.key,pillTier:ct.BODY.id,usageTargets:xl(),tags:["",""]},rice_ball:{id:"rice_ball",name:"",type:"consumable",rarity:"common",desc:"",effect:{kind:"heal",amount:60},resourceCategory:"PILL",resourceLevel:J.MORTAL.key,pillTier:ct.BODY.id,usageTargets:xl(),tags:["",""]},iron_sword:{id:"iron_sword",name:"",type:"weapon",slot:"weapon",rarity:"common",desc:"",stats:{atk:25},resourceCategory:"WEAPON",resourceLevel:J.MORTAL.key,weaponClass:hl.SABER.id,usageTargets:fe(),tags:["",""]},beast_fang:{id:"beast_fang",name:"",type:"accessory",slot:"accessory",rarity:"uncommon",desc:"",stats:{atk:35},resourceCategory:"ACCESSORY",resourceLevel:J.SPIRIT.key,usageTargets:fe(),tags:["",""]},beast_core:{id:"beast_core",name:"",type:"consumable",rarity:"uncommon",desc:"",effect:{kind:"exp",amount:1200},resourceCategory:"PILL",resourceLevel:J.MORTAL.key,pillTier:ct.BODY.id,usageTargets:xl(),tags:["",""]},foundation_pill:{id:"foundation_pill",name:"",type:"consumable",rarity:"rare",desc:"",effect:{kind:"exp",amount:4e3},resourceCategory:"PILL",resourceLevel:J.SPIRIT.key,pillTier:ct.FOUNDATION.id,usageTargets:fe(),tags:["",""]},thunder_wood:{id:"thunder_wood",name:"",type:"accessory",slot:"accessory",rarity:"rare",desc:"",stats:{atk:60,mp:200},resourceCategory:"ACCESSORY",resourceLevel:J.SPIRIT.key,usageTargets:fe(),tags:["",""]},iron_armor:{id:"iron_armor",name:"",type:"armor",slot:"armor",rarity:"rare",desc:"",stats:{hp:600},resourceCategory:"ARMOR",resourceLevel:J.SPIRIT.key,usageTargets:fe(),tags:["",""]},core_pill:{id:"core_pill",name:"",type:"consumable",rarity:"epic",desc:"",effect:{kind:"exp",amount:9e3},resourceCategory:"PILL",resourceLevel:J.EARTH.key,pillTier:ct.CORE.id,usageTargets:fe(),tags:["",""]},artifact_supreme:{id:"artifact_supreme",name:"",type:"weapon",slot:"weapon",rarity:"epic",desc:"",stats:{atk:180,hp:300},resourceCategory:"WEAPON",resourceLevel:J.HEAVEN.key,weaponClass:hl.RELIC.id,usageTargets:fe(),tags:["","",""]},milk_millennium:{id:"milk_millennium",name:"",type:"consumable",rarity:"epic",desc:"",effect:{kind:"heal",amount:500},resourceCategory:"PILL",resourceLevel:J.EARTH.key,pillTier:ct.FOUNDATION.id,usageTargets:xl(),tags:["",""]},marrow_wash:{id:"marrow_wash",name:"",type:"consumable",rarity:"epic",desc:"",effect:{kind:"aptitude",amount:2},resourceCategory:"PILL",resourceLevel:J.EARTH.key,pillTier:ct.FOUNDATION.id,usageTargets:fe(),tags:["",""]},nascent_fruit:{id:"nascent_fruit",name:"",type:"consumable",rarity:"legendary",desc:"",effect:{kind:"exp",amount:2e4},resourceCategory:"PILL",resourceLevel:J.HEAVEN.key,pillTier:ct.NASCENT.id,usageTargets:fe(),tags:["",""]},heaven_manual:{id:"heaven_manual",name:"",type:"accessory",slot:"accessory",rarity:"legendary",desc:"",stats:{mp:800,atk:120},resourceCategory:"ACCESSORY",resourceLevel:J.HEAVEN.key,usageTargets:fe(),tags:["","",""]},divine_egg:{id:"divine_egg",name:"",type:"armor",slot:"armor",rarity:"legendary",desc:"",stats:{hp:1200},resourceCategory:"ARMOR",resourceLevel:J.HEAVEN.key,usageTargets:fe(),tags:["",""]},moonshadow_saber:{id:"moonshadow_saber",name:"",type:"weapon",slot:"weapon",rarity:"epic",desc:"",stats:{atk:160,mp:60},resourceCategory:"WEAPON",resourceLevel:J.EARTH.key,weaponClass:hl.SABER.id,usageTargets:fe(),tags:["",""]},storm_piercer:{id:"storm_piercer",name:"",type:"weapon",slot:"weapon",rarity:"legendary",desc:"",stats:{atk:190,mp:120,hp:200},resourceCategory:"WEAPON",resourceLevel:J.HEAVEN.key,weaponClass:hl.SPEAR.id,usageTargets:fe(),tags:["",""]},meridian_pill:{id:"meridian_pill",name:"",type:"consumable",rarity:"uncommon",desc:"",effect:{kind:"exp",amount:1500},resourceCategory:"PILL",resourceLevel:J.MORTAL.key,pillTier:ct.BODY.id,usageTargets:R2(),tags:["",""]},dragon_heart_pill:{id:"dragon_heart_pill",name:"",type:"consumable",rarity:"epic",desc:"",effect:{kind:"exp",amount:12e3},resourceCategory:"PILL",resourceLevel:J.EARTH.key,pillTier:ct.CORE.id,usageTargets:fe(),tags:["",""]},communication_pill:{id:"communication_pill",name:"",type:"consumable",rarity:"uncommon",desc:"",effect:{kind:"intelligence",amount:2},resourceCategory:"PILL",resourceLevel:J.MORTAL.key,pillTier:ct.FOUNDATION.id,usageTargets:fe(),tags:["",""]},awakening_pill:{id:"awakening_pill",name:"",type:"consumable",rarity:"epic",desc:"",effect:{kind:"intelligence",amount:5},resourceCategory:"PILL",resourceLevel:J.SPIRIT.key,pillTier:ct.FOUNDATION.id,usageTargets:fe(),tags:["",""]},wisdom_pill:{id:"wisdom_pill",name:"",type:"consumable",rarity:"legendary",desc:"",effect:{kind:"intelligence",amount:8},resourceCategory:"PILL",resourceLevel:J.EARTH.key,pillTier:ct.CORE.id,usageTargets:fe(),tags:[""]},starlight_pill:{id:"starlight_pill",name:"",type:"consumable",rarity:"legendary",desc:"",effect:{kind:"intelligence",amount:18},resourceCategory:"PILL",resourceLevel:J.HEAVEN.key,pillTier:ct.ASCENSION.id,usageTargets:fe(),tags:["","",""]},god_transformation_pill:{id:"god_transformation_pill",name:"",type:"consumable",rarity:"mythic",desc:"",effect:{kind:"exp",amount:3e5},resourceCategory:"PILL",resourceLevel:J.DIVINE.key,pillTier:ct.ASCENSION.id,usageTargets:fe(),tags:["","",""]},divine_soul_pill:{id:"divine_soul_pill",name:"",type:"consumable",rarity:"mythic",desc:"",effect:{kind:"exp",amount:5e5},resourceCategory:"PILL",resourceLevel:J.DIVINE.key,pillTier:ct.ASCENSION.id,usageTargets:fe(),tags:["","",""]},void_condensing_pill:{id:"void_condensing_pill",name:"",type:"consumable",rarity:"mythic",desc:"",effect:{kind:"exp",amount:8e5},resourceCategory:"PILL",resourceLevel:J.DIVINE.key,pillTier:ct.ASCENSION.id,usageTargets:fe(),tags:["","",""]},immortal_marrow_pill:{id:"immortal_marrow_pill",name:"",type:"consumable",rarity:"mythic",desc:"",effect:{kind:"aptitude",amount:8},resourceCategory:"PILL",resourceLevel:J.DIVINE.key,pillTier:ct.ASCENSION.id,usageTargets:fe(),tags:["","",""]},heaven_defying_pill:{id:"heaven_defying_pill",name:"",type:"consumable",rarity:"mythic",desc:"",effect:{kind:"exp",amount:1e6},resourceCategory:"PILL",resourceLevel:J.DIVINE.key,pillTier:ct.ASCENSION.id,usageTargets:fe(),tags:["","",""]},void_refining_pill:{id:"void_refining_pill",name:"",type:"consumable",rarity:"mythic",desc:"",effect:{kind:"exp",amount:2e6},resourceCategory:"PILL",resourceLevel:J.DIVINE.key,pillTier:ct.ASCENSION.id,usageTargets:fe(),tags:["","",""]},space_law_pill:{id:"space_law_pill",name:"",type:"consumable",rarity:"mythic",desc:"",effect:{kind:"exp",amount:3e6},resourceCategory:"PILL",resourceLevel:J.DIVINE.key,pillTier:ct.ASCENSION.id,usageTargets:fe(),tags:["","",""]},void_stabilization_pill:{id:"void_stabilization_pill",name:"",type:"consumable",rarity:"mythic",desc:"",effect:{kind:"exp",amount:5e6},resourceCategory:"PILL",resourceLevel:J.DIVINE.key,pillTier:ct.ASCENSION.id,usageTargets:fe(),tags:["","",""]},unity_pill:{id:"unity_pill",name:"",type:"consumable",rarity:"mythic",desc:"",effect:{kind:"exp",amount:8e6},resourceCategory:"PILL",resourceLevel:J.DIVINE.key,pillTier:ct.ASCENSION.id,usageTargets:fe(),tags:["","",""]},dao_comprehension_pill:{id:"dao_comprehension_pill",name:"",type:"consumable",rarity:"mythic",desc:"",effect:{kind:"exp",amount:12e6},resourceCategory:"PILL",resourceLevel:J.DIVINE.key,pillTier:ct.ASCENSION.id,usageTargets:fe(),tags:["","",""]},harmony_pill:{id:"harmony_pill",name:"",type:"consumable",rarity:"mythic",desc:"",effect:{kind:"exp",amount:18e6},resourceCategory:"PILL",resourceLevel:J.DIVINE.key,pillTier:ct.ASCENSION.id,usageTargets:fe(),tags:["","",""]},mahayana_pill:{id:"mahayana_pill",name:"",type:"consumable",rarity:"mythic",desc:"",effect:{kind:"exp",amount:3e7},resourceCategory:"PILL",resourceLevel:J.DIVINE.key,pillTier:ct.ASCENSION.id,usageTargets:fe(),tags:["","",""]},immortal_foundation_pill:{id:"immortal_foundation_pill",name:"",type:"consumable",rarity:"mythic",desc:"",effect:{kind:"exp",amount:5e7},resourceCategory:"PILL",resourceLevel:J.DIVINE.key,pillTier:ct.ASCENSION.id,usageTargets:fe(),tags:["","",""]},semi_immortal_pill:{id:"semi_immortal_pill",name:"",type:"consumable",rarity:"mythic",desc:"",effect:{kind:"exp",amount:8e7},resourceCategory:"PILL",resourceLevel:J.DIVINE.key,pillTier:ct.ASCENSION.id,usageTargets:fe(),tags:["","",""]},tribulation_pill:{id:"tribulation_pill",name:"",type:"consumable",rarity:"mythic",desc:"",effect:{kind:"exp",amount:1e8},resourceCategory:"PILL",resourceLevel:J.DIVINE.key,pillTier:ct.ASCENSION.id,usageTargets:fe(),tags:["","",""]},anti_tribulation_pill:{id:"anti_tribulation_pill",name:"",type:"consumable",rarity:"mythic",desc:"",effect:{kind:"heal",amount:5e4},resourceCategory:"PILL",resourceLevel:J.DIVINE.key,pillTier:ct.ASCENSION.id,usageTargets:fe(),tags:["","",""]},ascension_pill:{id:"ascension_pill",name:"",type:"consumable",rarity:"mythic",desc:"",effect:{kind:"exp",amount:2e8},resourceCategory:"PILL",resourceLevel:J.DIVINE.key,pillTier:ct.ASCENSION.id,usageTargets:fe(),tags:["","",""]},basic_manual:{id:"basic_manual",name:"",type:"manual",rarity:"common",tier:"",tierColor:"#D4AF37",element:"",baseBonus:"+20%",desc:"",manualIds:["basic_breath","cloud_breath"],resourceCategory:"MANUAL",resourceLevel:J.MORTAL.key,manualSchool:Te.GENERAL.id,usageTargets:fe(),tags:["",""]},advanced_manual:{id:"advanced_manual",name:"",type:"manual",rarity:"rare",tier:"",tierColor:"#4A4A4A",element:"",baseBonus:"+50%",desc:"",manualIds:["azure_sword_art","water_flow","fire_control","mountain_body"],resourceCategory:"MANUAL",resourceLevel:J.SPIRIT.key,manualSchool:Te.ELEMENTAL.id,usageTargets:fe(),tags:["",""]},expert_manual:{id:"expert_manual",name:"",type:"manual",rarity:"epic",tier:"",tierColor:"#8B4513",element:"",baseBonus:"+100%",desc:"",manualIds:["yin_yang_harmony","five_elements_supreme"],resourceCategory:"MANUAL",resourceLevel:J.EARTH.key,manualSchool:Te.DUAL.id,usageTargets:fe(),tags:["",""]},yin_yang_harmony_manual:{id:"yin_yang_harmony_manual",name:"",type:"manual",rarity:"rare",tier:"",tierColor:"#4A4A4A",element:"",baseBonus:"+60%",desc:"",manualIds:["yin_yang_harmony"],resourceCategory:"MANUAL",resourceLevel:J.SPIRIT.key,manualSchool:Te.DUAL.id,usageTargets:fe(),tags:["",""]},blood_demon_manual:{id:"blood_demon_manual",name:"",type:"manual",rarity:"epic",tier:"",tierColor:"#8B4513",element:"",baseBonus:"+120%",desc:"",manualIds:["blood_demon"],resourceCategory:"MANUAL",resourceLevel:J.EARTH.key,manualSchool:Te.DEVIL.id,usageTargets:fe(),tags:["",""]},chaos_origin_manual:{id:"chaos_origin_manual",name:"",type:"manual",rarity:"legendary",tier:"",tierColor:"#6A5ACD",element:"",baseBonus:"+220%",desc:"",manualIds:["chaos_origin"],resourceCategory:"MANUAL",resourceLevel:J.HEAVEN.key,manualSchool:Te.GENERAL.id,usageTargets:fe(),tags:["",""]},five_elements_supreme_manual:{id:"five_elements_supreme_manual",name:"",type:"manual",rarity:"legendary",tier:"",tierColor:"#6A5ACD",element:"",baseBonus:"+220%",desc:"",manualIds:["five_elements_supreme"],resourceCategory:"MANUAL",resourceLevel:J.HEAVEN.key,manualSchool:Te.ELEMENTAL.id,usageTargets:fe(),tags:["",""]},emperor_scripture_manual:{id:"emperor_scripture_manual",name:"",type:"manual",rarity:"legendary",tier:"",tierColor:"#6A5ACD",element:"",baseBonus:"+240%",desc:"",manualIds:["emperor_scripture"],resourceCategory:"MANUAL",resourceLevel:J.HEAVEN.key,manualSchool:Te.GENERAL.id,usageTargets:fe(),tags:["",""]},deep_ocean_scripture_manual:{id:"deep_ocean_scripture_manual",name:"",type:"manual",rarity:"epic",tier:"",tierColor:"#8B4513",element:"",baseBonus:"+140%",desc:"",manualIds:["deep_ocean_scripture"],resourceCategory:"MANUAL",resourceLevel:J.EARTH.key,manualSchool:Te.ELEMENTAL.id,usageTargets:fe(),tags:["",""]},gold_manual_1:{id:"gold_manual_1",name:"",type:"manual",rarity:"common",tier:"",tierColor:"#FFD700",element:"",baseBonus:"+20%",desc:"",manualIds:["golden_light"],resourceCategory:"MANUAL",resourceLevel:J.MORTAL.key,manualSchool:Te.ELEMENTAL.id,usageTargets:fe(),tags:["",""]},gold_manual_2:{id:"gold_manual_2",name:"",type:"manual",rarity:"uncommon",tier:"",tierColor:"#FFD700",element:"",baseBonus:"+50%",desc:"",manualIds:["azure_sword_art"],resourceCategory:"MANUAL",resourceLevel:J.SPIRIT.key,manualSchool:Te.ELEMENTAL.id,usageTargets:fe(),tags:["",""]},gold_manual_3:{id:"gold_manual_3",name:"",type:"manual",rarity:"rare",tier:"",tierColor:"#FFD700",element:"",baseBonus:"+100%",desc:"",manualIds:["golden_light","azure_sword_art"],resourceCategory:"MANUAL",resourceLevel:J.EARTH.key,manualSchool:Te.ELEMENTAL.id,usageTargets:fe(),tags:["",""]},gold_manual_4:{id:"gold_manual_4",name:"",type:"manual",rarity:"epic",tier:"",tierColor:"#FFD700",element:"",baseBonus:"+100%",desc:"",manualIds:["azure_sword_art"],resourceCategory:"MANUAL",resourceLevel:J.EARTH.key,manualSchool:Te.ELEMENTAL.id,usageTargets:fe(),tags:["",""]},gold_manual_5:{id:"gold_manual_5",name:"",type:"manual",rarity:"legendary",tier:"",tierColor:"#FFD700",element:"",baseBonus:"+200%",desc:"",manualIds:["azure_sword_art"],resourceCategory:"MANUAL",resourceLevel:J.HEAVEN.key,manualSchool:Te.ELEMENTAL.id,usageTargets:fe(),tags:["",""]},wood_manual_1:{id:"wood_manual_1",name:"",type:"manual",rarity:"common",tier:"",tierColor:"#228B22",element:"",baseBonus:"+20%",desc:"",manualIds:["evergreen_art"],resourceCategory:"MANUAL",resourceLevel:J.MORTAL.key,manualSchool:Te.ELEMENTAL.id,usageTargets:fe(),tags:["",""]},wood_manual_2:{id:"wood_manual_2",name:"",type:"manual",rarity:"uncommon",tier:"",tierColor:"#228B22",element:"",baseBonus:"+50%",desc:"",manualIds:["spring_birth"],resourceCategory:"MANUAL",resourceLevel:J.SPIRIT.key,manualSchool:Te.ELEMENTAL.id,usageTargets:fe(),tags:["",""]},wood_manual_3:{id:"wood_manual_3",name:"",type:"manual",rarity:"rare",tier:"",tierColor:"#228B22",element:"",baseBonus:"+100%",desc:"",manualIds:["evergreen_art","spring_birth"],resourceCategory:"MANUAL",resourceLevel:J.EARTH.key,manualSchool:Te.ELEMENTAL.id,usageTargets:fe(),tags:["",""]},wood_manual_4:{id:"wood_manual_4",name:"",type:"manual",rarity:"epic",tier:"",tierColor:"#228B22",element:"",baseBonus:"+100%",desc:"",manualIds:["spring_birth"],resourceCategory:"MANUAL",resourceLevel:J.EARTH.key,manualSchool:Te.ELEMENTAL.id,usageTargets:fe(),tags:["",""]},wood_manual_5:{id:"wood_manual_5",name:"",type:"manual",rarity:"legendary",tier:"",tierColor:"#228B22",element:"",baseBonus:"+200%",desc:"",manualIds:["spring_birth"],resourceCategory:"MANUAL",resourceLevel:J.HEAVEN.key,manualSchool:Te.ELEMENTAL.id,usageTargets:fe(),tags:["",""]},water_manual_1:{id:"water_manual_1",name:"",type:"manual",rarity:"common",tier:"",tierColor:"#4169E1",element:"",baseBonus:"+20%",desc:"",manualIds:["water_flow"],resourceCategory:"MANUAL",resourceLevel:J.MORTAL.key,manualSchool:Te.ELEMENTAL.id,usageTargets:fe(),tags:["",""]},water_manual_2:{id:"water_manual_2",name:"",type:"manual",rarity:"uncommon",tier:"",tierColor:"#4169E1",element:"",baseBonus:"+50%",desc:"",manualIds:["ocean_heart"],resourceCategory:"MANUAL",resourceLevel:J.SPIRIT.key,manualSchool:Te.ELEMENTAL.id,usageTargets:fe(),tags:["",""]},water_manual_3:{id:"water_manual_3",name:"",type:"manual",rarity:"rare",tier:"",tierColor:"#4169E1",element:"",baseBonus:"+100%",desc:"",manualIds:["water_flow","ocean_heart"],resourceCategory:"MANUAL",resourceLevel:J.EARTH.key,manualSchool:Te.ELEMENTAL.id,usageTargets:fe(),tags:["",""]},water_manual_4:{id:"water_manual_4",name:"",type:"manual",rarity:"epic",tier:"",tierColor:"#4169E1",element:"",baseBonus:"+100%",desc:"",manualIds:["ocean_heart"],resourceCategory:"MANUAL",resourceLevel:J.EARTH.key,manualSchool:Te.ELEMENTAL.id,usageTargets:fe(),tags:["",""]},water_manual_5:{id:"water_manual_5",name:"",type:"manual",rarity:"legendary",tier:"",tierColor:"#4169E1",element:"",baseBonus:"+200%",desc:"",manualIds:["ocean_heart"],resourceCategory:"MANUAL",resourceLevel:J.HEAVEN.key,manualSchool:Te.ELEMENTAL.id,usageTargets:fe(),tags:["",""]},fire_manual_1:{id:"fire_manual_1",name:"",type:"manual",rarity:"common",tier:"",tierColor:"#FF6347",element:"",baseBonus:"+20%",desc:"",manualIds:["basic_breath"],resourceCategory:"MANUAL",resourceLevel:J.MORTAL.key,manualSchool:Te.ELEMENTAL.id,usageTargets:fe(),tags:["",""]},fire_manual_2:{id:"fire_manual_2",name:"",type:"manual",rarity:"uncommon",tier:"",tierColor:"#FF6347",element:"",baseBonus:"+50%",desc:"",manualIds:["fire_control"],resourceCategory:"MANUAL",resourceLevel:J.SPIRIT.key,manualSchool:Te.ELEMENTAL.id,usageTargets:fe(),tags:["",""]},fire_manual_3:{id:"fire_manual_3",name:"",type:"manual",rarity:"rare",tier:"",tierColor:"#FF6347",element:"",baseBonus:"+100%",desc:"",manualIds:["nine_turns_fire"],resourceCategory:"MANUAL",resourceLevel:J.EARTH.key,manualSchool:Te.ELEMENTAL.id,usageTargets:fe(),tags:["",""]},fire_manual_4:{id:"fire_manual_4",name:"",type:"manual",rarity:"epic",tier:"",tierColor:"#FF6347",element:"",baseBonus:"+100%",desc:"",manualIds:["vermillion_bird"],resourceCategory:"MANUAL",resourceLevel:J.EARTH.key,manualSchool:Te.ELEMENTAL.id,usageTargets:fe(),tags:["",""]},fire_manual_5:{id:"fire_manual_5",name:"",type:"manual",rarity:"legendary",tier:"",tierColor:"#FF6347",element:"",baseBonus:"+200%",desc:"",manualIds:["nine_turns_fire","vermillion_bird"],resourceCategory:"MANUAL",resourceLevel:J.HEAVEN.key,manualSchool:Te.ELEMENTAL.id,usageTargets:fe(),tags:["",""]},earth_manual_1:{id:"earth_manual_1",name:"",type:"manual",rarity:"common",tier:"",tierColor:"#8B4513",element:"",baseBonus:"+20%",desc:"",manualIds:["earth_shield"],resourceCategory:"MANUAL",resourceLevel:J.MORTAL.key,manualSchool:Te.ELEMENTAL.id,usageTargets:fe(),tags:["",""]},earth_manual_2:{id:"earth_manual_2",name:"",type:"manual",rarity:"uncommon",tier:"",tierColor:"#8B4513",element:"",baseBonus:"+50%",desc:"",manualIds:["mountain_body"],resourceCategory:"MANUAL",resourceLevel:J.SPIRIT.key,manualSchool:Te.ELEMENTAL.id,usageTargets:fe(),tags:["",""]},earth_manual_3:{id:"earth_manual_3",name:"",type:"manual",rarity:"rare",tier:"",tierColor:"#8B4513",element:"",baseBonus:"+100%",desc:"",manualIds:["earth_shield","mountain_body"],resourceCategory:"MANUAL",resourceLevel:J.EARTH.key,manualSchool:Te.ELEMENTAL.id,usageTargets:fe(),tags:["",""]},earth_manual_4:{id:"earth_manual_4",name:"",type:"manual",rarity:"epic",tier:"",tierColor:"#8B4513",element:"",baseBonus:"+100%",desc:"",manualIds:["mountain_body"],resourceCategory:"MANUAL",resourceLevel:J.EARTH.key,manualSchool:Te.ELEMENTAL.id,usageTargets:fe(),tags:["",""]},earth_manual_5:{id:"earth_manual_5",name:"",type:"manual",rarity:"legendary",tier:"",tierColor:"#8B4513",element:"",baseBonus:"+200%",desc:"",manualIds:["mountain_body"],resourceCategory:"MANUAL",resourceLevel:J.HEAVEN.key,manualSchool:Te.ELEMENTAL.id,usageTargets:fe(),tags:["",""]},thunder_manual_1:{id:"thunder_manual_1",name:"",type:"manual",rarity:"uncommon",tier:"",tierColor:"#9B30FF",element:"",baseBonus:"+50%",desc:"",manualIds:["basic_breath"],resourceCategory:"MANUAL",resourceLevel:J.SPIRIT.key,manualSchool:Te.VARIANT.id,usageTargets:fe(),tags:["",""]},thunder_manual_2:{id:"thunder_manual_2",name:"",type:"manual",rarity:"rare",tier:"",tierColor:"#9B30FF",element:"",baseBonus:"+100%",desc:"",manualIds:["basic_breath"],resourceCategory:"MANUAL",resourceLevel:J.EARTH.key,manualSchool:Te.VARIANT.id,usageTargets:fe(),tags:["",""]},thunder_manual_3:{id:"thunder_manual_3",name:"",type:"manual",rarity:"epic",tier:"",tierColor:"#9B30FF",element:"",baseBonus:"+100%",desc:"",manualIds:["basic_breath"],resourceCategory:"MANUAL",resourceLevel:J.EARTH.key,manualSchool:Te.VARIANT.id,usageTargets:fe(),tags:["",""]},thunder_manual_4:{id:"thunder_manual_4",name:"",type:"manual",rarity:"epic",tier:"",tierColor:"#9B30FF",element:"",baseBonus:"+200%",desc:"",manualIds:["thunder_guide"],resourceCategory:"MANUAL",resourceLevel:J.EARTH.key,manualSchool:Te.VARIANT.id,usageTargets:fe(),tags:["",""]},thunder_manual_5:{id:"thunder_manual_5",name:"",type:"manual",rarity:"legendary",tier:"",tierColor:"#9B30FF",element:"",baseBonus:"+200%",desc:"",manualIds:["thunder_guide","heavenly_demon"],resourceCategory:"MANUAL",resourceLevel:J.HEAVEN.key,manualSchool:Te.VARIANT.id,usageTargets:fe(),tags:["",""]},ice_manual_1:{id:"ice_manual_1",name:"",type:"manual",rarity:"uncommon",tier:"",tierColor:"#87CEEB",element:"",baseBonus:"+20%",desc:"",manualIds:["water_flow"],resourceCategory:"MANUAL",resourceLevel:J.SPIRIT.key,manualSchool:Te.VARIANT.id,usageTargets:fe(),tags:["",""]},ice_manual_2:{id:"ice_manual_2",name:"",type:"manual",rarity:"rare",tier:"",tierColor:"#87CEEB",element:"",baseBonus:"+50%",desc:"",manualIds:["ice_heart"],resourceCategory:"MANUAL",resourceLevel:J.SPIRIT.key,manualSchool:Te.VARIANT.id,usageTargets:fe(),tags:["",""]},ice_manual_3:{id:"ice_manual_3",name:"",type:"manual",rarity:"rare",tier:"",tierColor:"#87CEEB",element:"",baseBonus:"+100%",desc:"",manualIds:["ice_heart"],resourceCategory:"MANUAL",resourceLevel:J.EARTH.key,manualSchool:Te.VARIANT.id,usageTargets:fe(),tags:["",""]},ice_manual_4:{id:"ice_manual_4",name:"",type:"manual",rarity:"epic",tier:"",tierColor:"#87CEEB",element:"",baseBonus:"+100%",desc:"",manualIds:["ice_heart"],resourceCategory:"MANUAL",resourceLevel:J.EARTH.key,manualSchool:Te.VARIANT.id,usageTargets:fe(),tags:["",""]},ice_manual_5:{id:"ice_manual_5",name:"",type:"manual",rarity:"legendary",tier:"",tierColor:"#87CEEB",element:"",baseBonus:"+200%",desc:"",manualIds:["ice_heart"],resourceCategory:"MANUAL",resourceLevel:J.HEAVEN.key,manualSchool:Te.VARIANT.id,usageTargets:fe(),tags:["",""]},wind_manual_1:{id:"wind_manual_1",name:"",type:"manual",rarity:"uncommon",tier:"",tierColor:"#E0E0E0",element:"",baseBonus:"+20%",desc:"",manualIds:["cloud_breath"],resourceCategory:"MANUAL",resourceLevel:J.SPIRIT.key,manualSchool:Te.VARIANT.id,usageTargets:fe(),tags:["",""]},wind_manual_2:{id:"wind_manual_2",name:"",type:"manual",rarity:"rare",tier:"",tierColor:"#E0E0E0",element:"",baseBonus:"+50%",desc:"",manualIds:["wind_freedom"],resourceCategory:"MANUAL",resourceLevel:J.SPIRIT.key,manualSchool:Te.VARIANT.id,usageTargets:fe(),tags:["",""]},wind_manual_3:{id:"wind_manual_3",name:"",type:"manual",rarity:"rare",tier:"",tierColor:"#E0E0E0",element:"",baseBonus:"+100%",desc:"",manualIds:["wind_freedom"],resourceCategory:"MANUAL",resourceLevel:J.EARTH.key,manualSchool:Te.VARIANT.id,usageTargets:fe(),tags:["",""]},wind_manual_4:{id:"wind_manual_4",name:"",type:"manual",rarity:"epic",tier:"",tierColor:"#E0E0E0",element:"",baseBonus:"+100%",desc:"",manualIds:["wind_freedom"],resourceCategory:"MANUAL",resourceLevel:J.EARTH.key,manualSchool:Te.VARIANT.id,usageTargets:fe(),tags:["",""]},wind_manual_5:{id:"wind_manual_5",name:"",type:"manual",rarity:"legendary",tier:"",tierColor:"#E0E0E0",element:"",baseBonus:"+200%",desc:"",manualIds:["wind_freedom"],resourceCategory:"MANUAL",resourceLevel:J.HEAVEN.key,manualSchool:Te.VARIANT.id,usageTargets:fe(),tags:["",""]},cosmic_crystal:{id:"cosmic_crystal",name:"",type:"consumable",rarity:"legendary",desc:"",effect:{kind:"exp",amount:5e4},resourceCategory:"PILL",resourceLevel:J.HEAVEN.key,usageTargets:fe(),tags:["",""]},void_silk:{id:"void_silk",name:"",type:"consumable",rarity:"legendary",desc:"",effect:{kind:"exp",amount:4e4},resourceCategory:"PILL",resourceLevel:J.HEAVEN.key,usageTargets:fe(),tags:["",""]},heavenly_jade:{id:"heavenly_jade",name:"",type:"consumable",rarity:"mythic",desc:"",effect:{kind:"exp",amount:2e5},resourceCategory:"PILL",resourceLevel:J.DIVINE.key,usageTargets:fe(),tags:["",""]},soul_essence_crystal:{id:"soul_essence_crystal",name:"",type:"consumable",rarity:"mythic",desc:"",effect:{kind:"exp",amount:18e4},resourceCategory:"PILL",resourceLevel:J.DIVINE.key,usageTargets:fe(),tags:["",""]},star_core_fragment:{id:"star_core_fragment",name:"",type:"consumable",rarity:"mythic",desc:"",effect:{kind:"exp",amount:35e4},resourceCategory:"PILL",resourceLevel:J.DIVINE.key,usageTargets:fe(),tags:["",""]},celestial_silk_cloth:{id:"celestial_silk_cloth",name:"",type:"consumable",rarity:"mythic",desc:"",effect:{kind:"exp",amount:3e5},resourceCategory:"PILL",resourceLevel:J.DIVINE.key,usageTargets:fe(),tags:["",""]},abyss_stone:{id:"abyss_stone",name:"",type:"consumable",rarity:"mythic",desc:"",effect:{kind:"exp",amount:5e5},resourceCategory:"PILL",resourceLevel:J.DIVINE.key,usageTargets:fe(),tags:["",""]},abyssal_essence:{id:"abyssal_essence",name:"",type:"consumable",rarity:"mythic",desc:"",effect:{kind:"exp",amount:55e4},resourceCategory:"PILL",resourceLevel:J.DIVINE.key,usageTargets:fe(),tags:["",""]},divine_tribulation_stone:{id:"divine_tribulation_stone",name:"",type:"consumable",rarity:"mythic",desc:"",effect:{kind:"exp",amount:6e5},resourceCategory:"PILL",resourceLevel:J.DIVINE.key,usageTargets:fe(),tags:["",""]},god_marrow:{id:"god_marrow",name:"",type:"consumable",rarity:"mythic",desc:"",effect:{kind:"exp",amount:65e4},resourceCategory:"PILL",resourceLevel:J.DIVINE.key,usageTargets:fe(),tags:["",""]},divine_essence_core:{id:"divine_essence_core",name:"",type:"consumable",rarity:"mythic",desc:"",effect:{kind:"exp",amount:8e5},resourceCategory:"PILL",resourceLevel:J.DIVINE.key,usageTargets:fe(),tags:["",""]},soul_tempering_stone:{id:"soul_tempering_stone",name:"",type:"consumable",rarity:"mythic",desc:"",effect:{kind:"exp",amount:75e4},resourceCategory:"PILL",resourceLevel:J.DIVINE.key,usageTargets:fe(),tags:["",""]},void_manifold_crystal:{id:"void_manifold_crystal",name:"",type:"consumable",rarity:"mythic",desc:"",effect:{kind:"exp",amount:1e6},resourceCategory:"PILL",resourceLevel:J.DIVINE.key,usageTargets:fe(),tags:["",""]},condensed_void_essence:{id:"condensed_void_essence",name:"",type:"consumable",rarity:"mythic",desc:"",effect:{kind:"exp",amount:105e4},resourceCategory:"PILL",resourceLevel:J.DIVINE.key,usageTargets:fe(),tags:["",""]},celestial_ascension_token:{id:"celestial_ascension_token",name:"",type:"consumable",rarity:"mythic",desc:"",effect:{kind:"exp",amount:2e6},resourceCategory:"PILL",resourceLevel:J.DIVINE.key,usageTargets:fe(),tags:["",""]},immortal_transformation_essence:{id:"immortal_transformation_essence",name:"",type:"consumable",rarity:"mythic",desc:"",effect:{kind:"exp",amount:22e5},resourceCategory:"PILL",resourceLevel:J.DIVINE.key,usageTargets:fe(),tags:["",""]}},or=e=>{const t=Vc[e];if(!t)return null;const n=["weapon","armor","accessory"].includes(t.type),s=t.type==="consumable"||t.type==="manual"||n;return{...t,id:e,instanceId:`${e}_${Date.now()}_${Math.floor(Math.random()*1e4)}`,quantity:1,stackable:s,maxStack:s?99:1}},fs=e=>Vc[e];function _2(){const[e,t]=y.useState([]),n=y.useRef(e);y.useEffect(()=>{n.current=e},[e]);const s=y.useCallback(p=>{if(typeof p=="function"){t(c=>{const f=p(c);return n.current=f,f});return}n.current=p,t(p)},[]),o=y.useCallback((p=[])=>{const c=p.map(h=>{if(!h)return null;if(typeof h=="string")return or(h);if(typeof h=="object"){const g=h.type==="weapon"||h.type==="armor"||h.type==="accessory",v=h.type==="consumable"||h.type==="manual"||g;return{...h,instanceId:h.instanceId||(h.id||"item")+"_"+Date.now()+"_"+Math.floor(Math.random()*1e4),quantity:h.quantity||h.quantity===0?h.quantity:1,stackable:h.stackable??v,maxStack:h.maxStack||(v?99:1)}}return null}).filter(Boolean);if(c.length===0)return[];const x=[...n.current||[]],C=h=>(h==null?void 0:h.stackable)===!0||(h==null?void 0:h.type)==="consumable"||(h==null?void 0:h.type)==="manual"||(h==null?void 0:h.type)==="weapon"||(h==null?void 0:h.type)==="armor"||(h==null?void 0:h.type)==="accessory",w=h=>{if(!h||typeof h!="object")return"";const g=Object.keys(h).sort(),v={};return g.forEach(j=>{v[j]=h[j]}),JSON.stringify(v)},S=h=>(h==null?void 0:h.type)==="weapon"||(h==null?void 0:h.type)==="armor"||(h==null?void 0:h.type)==="accessory";return c.forEach(h=>{if(C(h)){let g=Number(h.quantity??1)||0;const v=Math.max(1,Number(h.maxStack??99)||99);if(g<=0)return;const j=R=>R.id===h.id&&R.name===h.name&&R.rarity===h.rarity&&C(R)&&(!S(h)||R.slot===h.slot&&w(R.stats)===w(h.stats));for(let R=0;R<x.length&&g>0;R+=1){const b=x[R];if(!j(b))continue;const _=Number(b.quantity??1)||1;if(_>=v)continue;const I=v-_,k=Math.min(g,I);b.quantity=_+k,g-=k}for(;g>0;){const R=Math.min(g,v);x.unshift({...h,quantity:R,instanceId:(h.id||"item")+"_"+Date.now()+"_"+Math.floor(Math.random()*1e4)}),g-=R}return}x.unshift(h)}),n.current=x,t(x),c},[]),i=y.useCallback((p,c)=>{const f=n.current||[];let x=[],C=typeof c=="number"?c:void 0,w=[...f];for(let S=0;S<w.length;){const h=w[S];if(String(h.instanceId)!==String(p)){S++;continue}const g=h.quantity||1;if(C===void 0||C>=g){if(x.push({...h}),C=C===void 0?void 0:C-g,w.splice(S,1),C===0)break}else{x.push({...h,quantity:C}),w[S]={...h,quantity:g-C},C=0;break}}return x.length>0&&(n.current=w,t(w)),x.length===0?null:x.length===1?x[0]:x.reduce((S,h)=>S?{...S,quantity:(S.quantity||1)+(h.quantity||1)}:{...h},null)},[]),a=y.useCallback(()=>{n.current=[],t([])},[]),l=y.useCallback(p=>e.find(p),[e]),d=y.useCallback(p=>e.filter(p),[e]),u=y.useCallback(p=>e.filter(c=>c.templateId===p).length,[e]);return{inventory:e,setInventory:s,addItemsToInventory:o,removeItemFromInventory:i,clearInventory:a,findItem:l,filterItems:d,getItemCount:u}}const wa=[{id:"stage_chu_qingyao",name:"",title:"",role:"",tier:"",baseThreat:25,baseExp:7200,powerMultiplier:1,flavor:"",defeatLog:"",unlockNextLog:"",combatStats:{hp:800,maxHp:800,atk:85,def:40},storyBeats:[{delay:1,type:"RIVAL_RISE",tier:"",exp:9e3,detail:"",description:""},{delay:1,type:"RIVAL_ENGAGED",target:"",detail:"",description:""},{delay:1,type:"RIVAL_MARRIAGE",target:"",tier:"",exp:15e3,detail:"",description:""},{delay:1,type:"RIVAL_HEIR",target:"",tier:"",exp:2e4,detail:"",description:""},{delay:1,type:"RIVAL_STAGE_EVENT",tier:"",exp:23e3,detail:"",description:""},{delay:1,type:"RIVAL_STAGE_EVENT",tier:"",exp:25e3,detail:"",description:""}]},{id:"stage_fiance",name:"",title:"",role:"",tier:"",baseThreat:40,baseExp:2e5,powerMultiplier:2.2,flavor:"",defeatLog:"",unlockNextLog:"",combatStats:{hp:1e5,maxHp:1e5,atk:1e4,def:4e3},storyBeats:[{delay:1,type:"RIVAL_STAGE_EVENT",tier:"",exp:5e5,detail:"",description:""},{delay:1,type:"RIVAL_STAGE_EVENT",tier:"",exp:8e5,detail:"",description:""},{delay:1,type:"RIVAL_STAGE_EVENT",tier:"",exp:2e6,detail:"",description:""}]},{id:"stage_family_elder",name:"",title:"",role:"",tier:"",baseThreat:55,baseExp:2e6,powerMultiplier:3.5,flavor:"",defeatLog:"",unlockNextLog:"",combatStats:{hp:1e6,maxHp:1e6,atk:1e5,def:4e4},storyBeats:[{delay:1,type:"RIVAL_STAGE_EVENT",tier:"",exp:5e6,detail:"",description:""},{delay:1,type:"RIVAL_STAGE_EVENT",tier:"",exp:1e7,detail:"",description:""},{delay:1,type:"RIVAL_STAGE_EVENT",tier:"",exp:2e7,detail:"",description:""}]},{id:"stage_sect_elder",name:"",title:"",role:"",tier:"",baseThreat:70,baseExp:1e8,powerMultiplier:6,flavor:"",defeatLog:"",unlockNextLog:"",combatStats:{hp:4e7,maxHp:4e7,atk:4e6,def:16e5},storyBeats:[{delay:1,type:"RIVAL_STAGE_EVENT",tier:"",exp:2e8,detail:"",description:""},{delay:1,type:"RIVAL_STAGE_EVENT",tier:"",exp:5e8,detail:"",description:""},{delay:1,type:"RIVAL_STAGE_EVENT",tier:"",exp:2e9,detail:"",description:""}]}],Fl=wa.length-1,yc=(e=0)=>wa[Math.max(0,Math.min(e,Fl))],mt=[ht.PLAYER,ht.CHILD],Yc={YELLOW:{name:"",baseBuff:.2,color:"#D4AF37"},BLACK:{name:"",baseBuff:.5,color:"#4A4A4A"},EARTH:{name:"",baseBuff:1,color:"#8B4513"},HEAVEN:{name:"",baseBuff:2,color:"#9B30FF"}},Fm={:"",:"",:"",:"",:"",:"",:"",:"",ALL:"",NONE:"",OMNI:"","":""},M2=e=>!e||e==="NONE"?"OMNI":e,A2=(e,t)=>`${e}_${M2(t)}`,vn={basic_breath:{id:"basic_breath",name:"",tier:"YELLOW",element:"NONE",desc:"",rarity:"common",source:""},cloud_breath:{id:"cloud_breath",name:"",tier:"YELLOW",element:"NONE",desc:"",rarity:"common",source:""},golden_light:{id:"golden_light",name:"",tier:"YELLOW",element:"",desc:"",rarity:"common",source:""},azure_sword_art:{id:"azure_sword_art",name:"",tier:"BLACK",element:"",desc:"",rarity:"rare",source:""},evergreen_art:{id:"evergreen_art",name:"",tier:"YELLOW",element:"",desc:"",rarity:"common",source:""},spring_birth:{id:"spring_birth",name:"",tier:"BLACK",element:"",desc:"",rarity:"rare",source:""},water_flow:{id:"water_flow",name:"",tier:"YELLOW",element:"",desc:"",rarity:"common",source:""},ocean_heart:{id:"ocean_heart",name:"",tier:"BLACK",element:"",desc:"",rarity:"rare",source:""},fire_control:{id:"fire_control",name:"",tier:"BLACK",element:"",desc:"",rarity:"rare",source:""},nine_turns_fire:{id:"nine_turns_fire",name:"",tier:"EARTH",element:"",desc:"",rarity:"epic",source:""},vermillion_bird:{id:"vermillion_bird",name:"",tier:"EARTH",element:"",desc:"",rarity:"epic",source:""},earth_shield:{id:"earth_shield",name:"",tier:"YELLOW",element:"",desc:"",rarity:"common",source:""},mountain_body:{id:"mountain_body",name:"",tier:"BLACK",element:"",desc:"",rarity:"rare",source:""},thunder_guide:{id:"thunder_guide",name:"",tier:"HEAVEN",element:"",desc:"",rarity:"legendary",source:""},heavenly_demon:{id:"heavenly_demon",name:"",tier:"HEAVEN",element:"",desc:"",rarity:"legendary",source:""},ice_heart:{id:"ice_heart",name:"",tier:"BLACK",element:"",desc:"",rarity:"rare",source:""},wind_freedom:{id:"wind_freedom",name:"",tier:"BLACK",element:"",desc:"",rarity:"rare",source:""},yin_yang_harmony:{id:"yin_yang_harmony",name:"",tier:"BLACK",element:"NONE",desc:"",rarity:"rare",source:""},blood_demon:{id:"blood_demon",name:"",tier:"EARTH",element:"NONE",desc:"",rarity:"epic",source:""},chaos_origin:{id:"chaos_origin",name:"",tier:"HEAVEN",element:"NONE",desc:"",rarity:"legendary",source:""},five_elements_supreme:{id:"five_elements_supreme",name:"",tier:"HEAVEN",element:"ALL",desc:"",rarity:"legendary",source:""},emperor_scripture:{id:"emperor_scripture",name:"",tier:"HEAVEN",element:"NONE",desc:"",rarity:"legendary",source:""},deep_ocean_scripture:{id:"deep_ocean_scripture",name:"",tier:"EARTH",element:"",desc:"",rarity:"epic",source:""},nine_star_formation:{id:"nine_star_formation",name:"",tier:"BLACK",element:"",desc:"",rarity:"rare",source:""},grass_valley_healing:{id:"grass_valley_healing",name:"",tier:"YELLOW",element:"",desc:"",rarity:"common",source:""},stone_refining:{id:"stone_refining",name:"",tier:"YELLOW",element:"",desc:"",rarity:"common",source:""},ghost_cultivation:{id:"ghost_cultivation",name:"",tier:"EARTH",element:"",desc:"",rarity:"epic",source:""},blood_river:{id:"blood_river",name:"",tier:"BLACK",element:"NONE",desc:"",rarity:"rare",source:""}},N2={basic_breath:{resourceLevel:J.MORTAL.key,school:Te.GENERAL.id,stage:"",focus:["",""],usageTargets:mt},cloud_breath:{resourceLevel:J.MORTAL.key,school:Te.GENERAL.id,stage:"",focus:["",""],usageTargets:mt},golden_light:{resourceLevel:J.MORTAL.key,school:Te.ELEMENTAL.id,stage:"",focus:["",""],usageTargets:mt},azure_sword_art:{resourceLevel:J.SPIRIT.key,school:Te.ELEMENTAL.id,stage:"",focus:["",""],usageTargets:mt},evergreen_art:{resourceLevel:J.MORTAL.key,school:Te.ELEMENTAL.id,stage:"",focus:["",""],usageTargets:mt},spring_birth:{resourceLevel:J.SPIRIT.key,school:Te.ELEMENTAL.id,stage:"",focus:["",""],usageTargets:mt},water_flow:{resourceLevel:J.MORTAL.key,school:Te.ELEMENTAL.id,stage:"",focus:["",""],usageTargets:mt},ocean_heart:{resourceLevel:J.SPIRIT.key,school:Te.ELEMENTAL.id,stage:"",focus:["",""],usageTargets:mt},fire_control:{resourceLevel:J.SPIRIT.key,school:Te.ELEMENTAL.id,stage:"",focus:["",""],usageTargets:mt},nine_turns_fire:{resourceLevel:J.EARTH.key,school:Te.ELEMENTAL.id,stage:"",focus:["",""],usageTargets:mt},vermillion_bird:{resourceLevel:J.HEAVEN.key,school:Te.ELEMENTAL.id,stage:"",focus:["",""],usageTargets:mt},earth_shield:{resourceLevel:J.MORTAL.key,school:Te.ELEMENTAL.id,stage:"",focus:["",""],usageTargets:mt},mountain_body:{resourceLevel:J.SPIRIT.key,school:Te.ELEMENTAL.id,stage:"",focus:["",""],usageTargets:mt},thunder_guide:{resourceLevel:J.HEAVEN.key,school:Te.VARIANT.id,stage:"",focus:["",""],usageTargets:mt},heavenly_demon:{resourceLevel:J.DIVINE.key,school:Te.VARIANT.id,stage:"",focus:["",""],usageTargets:mt},ice_heart:{resourceLevel:J.SPIRIT.key,school:Te.VARIANT.id,stage:"",focus:["",""],usageTargets:mt},wind_freedom:{resourceLevel:J.SPIRIT.key,school:Te.VARIANT.id,stage:"",focus:["",""],usageTargets:mt},yin_yang_harmony:{resourceLevel:J.SPIRIT.key,school:Te.DUAL.id,stage:"",focus:["",""],usageTargets:mt},blood_demon:{resourceLevel:J.EARTH.key,school:Te.DEVIL.id,stage:"",focus:["",""],usageTargets:mt},chaos_origin:{resourceLevel:J.DIVINE.key,school:Te.GENERAL.id,stage:"",focus:["",""],usageTargets:mt},five_elements_supreme:{resourceLevel:J.DIVINE.key,school:Te.ELEMENTAL.id,stage:"",focus:["",""],usageTargets:mt},emperor_scripture:{resourceLevel:J.DIVINE.key,school:Te.GENERAL.id,stage:"",focus:["",""],usageTargets:mt},deep_ocean_scripture:{resourceLevel:J.EARTH.key,school:Te.ELEMENTAL.id,stage:"",focus:["",""],usageTargets:mt},nine_star_formation:{resourceLevel:J.SPIRIT.key,school:Te.ELEMENTAL.id,stage:"",focus:["",""],usageTargets:mt},grass_valley_healing:{resourceLevel:J.MORTAL.key,school:Te.ELEMENTAL.id,stage:"",focus:["",""],usageTargets:mt},stone_refining:{resourceLevel:J.MORTAL.key,school:Te.ELEMENTAL.id,stage:"",focus:["",""],usageTargets:mt},ghost_cultivation:{resourceLevel:J.EARTH.key,school:Te.DEVIL.id,stage:"",focus:["",""],usageTargets:mt},blood_river:{resourceLevel:J.SPIRIT.key,school:Te.DEVIL.id,stage:"",focus:["",""],usageTargets:mt}};Object.entries(N2).forEach(([e,t])=>{vn[e]&&(vn[e]={...vn[e],resourceCategory:"MANUAL",...t,usageTargets:t.usageTargets?[...t.usageTargets]:[...mt]})});const Hl={};Object.entries(vn).forEach(([e,t])=>{var s;const n=A2(t.tier,t.element);if(!Hl[n]){const o=((s=Yc[t.tier])==null?void 0:s.name)||t.tier,i=Fm[t.element]||t.element||Fm.NONE;Hl[n]={key:n,tier:t.tier,element:t.element,label:`${o}${i}`,manualIds:[]}}Hl[n].manualIds.push(e),vn[e].categoryKey=n});const L2=Hl,Hm={:"azure_sword_art",:"emperor_scripture",:"fire_control",:"deep_ocean_scripture",:"thunder_guide",:"spring_birth",:"nine_star_formation",:"wind_freedom",:"yin_yang_harmony",:"mountain_body",:"grass_valley_healing",:"stone_refining",:"heavenly_demon",:"ghost_cultivation",:"blood_river"};function jf(e,t){const n=vn[e];if(!n)return{compatibility:.5,level:"poor",desc:""};if(!t||!t.elements)return{compatibility:.8,level:"neutral",desc:"",color:"#999"};const{element:s}=n,{elements:o,type:i}=t;return s==="NONE"?{compatibility:.8,level:"neutral",desc:"",color:"#FFFFFF"}:n.id==="five_elements_supreme"?o.length===5?{compatibility:1.5,level:"perfect",desc:"",color:"#FFD700"}:{compatibility:.1,level:"impossible",desc:"",color:"#FF0000"}:o.includes(s)?o.length===1&&o[0]===s?{compatibility:1.5,level:"perfect",desc:"",color:"#4CAF50"}:{compatibility:1,level:"good",desc:"",color:"#2196F3"}:{compatibility:.5,level:"poor",desc:"",color:"#FF6B6B"}}function Cf(e,t){const n=vn[e];if(!n)return 1;const s=Yc[n.tier],{compatibility:o}=jf(e,t);return 1+s.baseBuff*o}function $2(e){const t=vn[e];if(!t)return null;const n=Yc[t.tier];return{...t,tierName:n.name,tierColor:n.color,baseBuff:n.baseBuff}}const Tf=e=>e?JSON.parse(JSON.stringify(e)):null,xp=[{name:"",key:"pure_yang",rarity:"SR",desc:"",effects:{statBonus:{aptitude:5},speedMultiplier:1.1,feedbackBonus:.05,preferredRoots:["",""],sectAffinity:{ids:["HEAVEN_EMPEROR","THUNDER"],bonus:25}}},{name:"",key:"innate_dao",rarity:"SSR",desc:"",effects:{statBonus:{looks:12,intelligence:5},speedMultiplier:1.15,feedbackBonus:.08,sectAffinity:{levels:["TOP","HIGH"],bonus:20}}},{name:"",key:"ancient_sage",rarity:"UR",desc:"",effects:{statBonus:{aptitude:8,health:25},speedMultiplier:1.2,feedbackBonus:.1,sectAffinity:{ids:["SWORD","HEAVEN_EMPEROR"],bonus:30}}},{name:"",key:"lunar_meridian",rarity:"SSR",desc:"",effects:{statBonus:{aptitude:4,intelligence:4},speedMultiplier:1.08,preferredRoots:["",""],sectAffinity:{ids:["GHOST","FLOWER"],bonus:20}}},{name:"",key:"stellar_bone",rarity:"SSR",desc:"",effects:{statBonus:{aptitude:6},speedMultiplier:1.12,preferredRoots:["",""],feedbackBonus:.06,sectAffinity:{ids:["NINE_STAR","STONE"],bonus:22}}},{name:"",key:"wood_spirit",rarity:"SR",desc:"",effects:{statBonus:{intelligence:6},speedMultiplier:1.05,preferredRoots:["",""],businessBonus:.25,feedbackBonus:.04,sectAffinity:{ids:["GRASS","FLOWER","DAN"],bonus:18}}},{name:"",key:"dragon_blood",rarity:"SR",desc:"",effects:{statBonus:{aptitude:5,health:18},speedMultiplier:1.1,feedbackBonus:.06,sectAffinity:{ids:["SWORD","IRON","BLOOD"],bonus:20}}},{name:"",key:"nether_core",rarity:"UR",desc:"",effects:{statBonus:{aptitude:7},speedMultiplier:1.18,preferredRoots:["",""],feedbackBonus:.09,sectAffinity:{ids:["GHOST","BLOOD"],bonus:28}}},{name:"",key:"fumo_frost_thunder_body",rarity:"UR",desc:"",effects:{statBonus:{aptitude:9,health:12},speedMultiplier:1.22,feedbackBonus:.12,preferredRoots:["",""],sectAffinity:{ids:["SWORD","HEAVEN_EMPEROR"],bonus:35}}},{name:"",key:"fumo_abyssal_flame_core",rarity:"UR",desc:"",effects:{statBonus:{aptitude:7,looks:8},speedMultiplier:1.18,feedbackBonus:.11,preferredRoots:["",""],sectAffinity:{ids:["BLOOD","GHOST"],bonus:30}}}],B2=()=>{const e=xp[Math.floor(Math.random()*xp.length)];return Tf(e)},wy=e=>{if(!e)return null;const t=xp.find(n=>n.key===e);return Tf(t)},Wl=e=>Tf(e),If=(e={},t)=>{var a;if(!((a=t==null?void 0:t.effects)!=null&&a.statBonus))return e;const{aptitude:n=0,looks:s=0,intelligence:o=0,health:i=0}=t.effects.statBonus;return{...e,aptitude:Math.max(1,Math.min(100,(e.aptitude||0)+n)),looks:Math.max(1,Math.min(120,(e.looks||0)+s)),intelligence:Math.max(1,Math.min(100,(e.intelligence||0)+o)),health:Math.max(1,Math.min(150,(e.health||0)+i))}},O2=e=>{var t;return((t=e==null?void 0:e.effects)==null?void 0:t.speedMultiplier)||1},P2=e=>{var t;return((t=e==null?void 0:e.effects)==null?void 0:t.feedbackBonus)||0},z2=e=>{var t;return((t=e==null?void 0:e.effects)==null?void 0:t.businessBonus)||0},D2=e=>{var t;return((t=e==null?void 0:e.effects)==null?void 0:t.sectAffinity)||null},F2=e=>{var t;return((t=e==null?void 0:e.effects)==null?void 0:t.preferredRoots)||null},Rf=[{id:0,name:"",level:"JUNIOR",isManagement:!1,description:"",powerScore:4,permissions:[]},{id:1,name:"",level:"JUNIOR",isManagement:!1,description:"",powerScore:8,permissions:[]},{id:2,name:"",level:"MID",isManagement:!1,description:"",powerScore:16,permissions:["access_advanced_techniques"]},{id:3,name:"",level:"HIGH",isManagement:!1,description:"",powerScore:28,permissions:["access_secret_techniques","participate_selection"]},{id:4,name:"",level:"MANAGEMENT",isManagement:!0,description:"",powerScore:36,permissions:["manage_disciples","resource_distribution"]},{id:5,name:"",level:"ELDER",isManagement:!0,description:"",powerScore:48,permissions:["manage_disciples","resource_distribution","recruitment","policy_making"]},{id:6,name:"",level:"SUPREME",isManagement:!0,description:"",powerScore:65,permissions:["manage_all","final_decision","sect_succession"]},{id:100,name:"",level:"SPECIAL",isManagement:!1,description:"",powerScore:32,permissions:["religious_authority"]},{id:101,name:"",level:"ROGUE",isManagement:!1,description:"",powerScore:12,permissions:[]},{id:102,name:"",level:"SOVEREIGN",isManagement:!0,description:"",powerScore:85,permissions:["manage_all","final_decision","sect_succession","declare_war"]}],H2=e=>Rf.find(t=>t.name===e)||null,W2=e=>{const t=H2(e);return t?t.powerScore:0},U2={:["meridian_pill","herb_bandage","rice_ball"],:["meridian_pill","beast_core","iron_armor"],:["foundation_pill","thunder_wood","iron_armor","milk_millennium"],:["core_pill","artifact_supreme","marrow_wash","dragon_heart_pill"],:["dragon_heart_pill","moonshadow_saber","thunder_wood","nascent_fruit","core_pill"],:["nascent_fruit","god_transformation_pill","divine_soul_pill","dragon_heart_pill","core_pill"],:["divine_soul_pill","void_condensing_pill","immortal_marrow_pill","heaven_defying_pill","starlight_pill","nascent_fruit"],:["void_refining_pill","space_law_pill","immortal_marrow_pill","divine_soul_pill","void_condensing_pill","heaven_defying_pill"],:["unity_pill","dao_comprehension_pill","harmony_pill","void_stabilization_pill"],:["mahayana_pill","immortal_foundation_pill","semi_immortal_pill"],:["temple_relic","buddhist_scripture"],:["meridian_pill","herb_bandage"]},G2=e=>U2[e]||null,V2=e=>{const t=G2(e);return!t||t.length===0?null:t[Math.floor(Math.random()*t.length)]},Y2=()=>Rf.map(e=>e.name),Bn={HEAVEN:{id:"HEAVEN",name:"",color:"#FFD700",min:90,max:100,elementCount:1,multiplier:2.5,desc:""},MUTANT_HEAVEN:{id:"MUTANT_HEAVEN",name:"",color:"#FF00FF",min:100,max:100,elementCount:1,multiplier:2.8,desc:""},MUTANT:{id:"MUTANT",name:"",color:"#00BCD4",min:80,max:89,elementCount:1,multiplier:2,desc:"(//)"},SINGLE:{id:"SINGLE",name:"",color:"#9C27B0",min:80,max:89,elementCount:1,multiplier:1.8,desc:""},DOUBLE:{id:"DOUBLE",name:"",color:"#2196F3",min:60,max:79,elementCount:2,multiplier:1.5,desc:""},TRIPLE:{id:"TRIPLE",name:"",color:"#4CAF50",min:40,max:59,elementCount:3,multiplier:1,desc:""},QUAD:{id:"QUAD",name:"",color:"#FF9800",min:20,max:39,elementCount:4,multiplier:.8,desc:""},WASTE:{id:"WASTE",name:"",color:"#9E9E9E",min:1,max:19,elementCount:5,multiplier:.5,desc:""},NONE:{id:"NONE",name:"",color:"#000000",min:0,max:0,elementCount:0,multiplier:0,desc:""}},q2=["","","","",""],Wm=["","",""],_f=e=>{if(e<=0)return Bn.NONE;if(e===100)return Math.random()<.01?Bn.MUTANT_HEAVEN:Bn.HEAVEN;if(e>=80&&e<90){const t=Math.random();return t<.01||t<.21?Bn.MUTANT:Bn.SINGLE}return e>=1&&e<80&&Math.random()<.01?Bn.MUTANT:Object.values(Bn).find(t=>e>=t.min&&e<=t.max)||Bn.WASTE},Qe=[{name:"",maxExp:100,feedback:0,chance:1,desc:""},{name:"",maxExp:500,feedback:1,chance:.95,desc:""},{name:"",maxExp:1e3,feedback:2,chance:.9,desc:""},{name:"",maxExp:2e3,feedback:3,chance:.85,desc:""},{name:"",maxExp:5e3,feedback:5,chance:.8,desc:""},{name:"",maxExp:2e4,feedback:20,chance:.6,desc:""},{name:"",maxExp:5e4,feedback:30,chance:.5,desc:""},{name:"",maxExp:8e4,feedback:40,chance:.4,desc:""},{name:"",maxExp:2e5,feedback:100,chance:.3,desc:""},{name:"",maxExp:5e5,feedback:150,chance:.25,desc:""},{name:"",maxExp:1e6,feedback:200,chance:.2,desc:""},{name:"",maxExp:2e6,feedback:500,chance:.1,desc:""},{name:"",maxExp:5e6,feedback:800,chance:.08,desc:""},{name:"",maxExp:1e7,feedback:1200,chance:.06,desc:""},{name:"",maxExp:2e7,feedback:2e3,chance:.05,desc:""},{name:"",maxExp:5e7,feedback:3500,chance:.04,desc:""},{name:"",maxExp:1e8,feedback:5e3,chance:.03,desc:""},{name:"",maxExp:2e8,feedback:8e3,chance:.025,desc:""},{name:"",maxExp:5e8,feedback:12e3,chance:.02,desc:""},{name:"",maxExp:1e9,feedback:18e3,chance:.015,desc:""},{name:"",maxExp:2e9,feedback:25e3,chance:.012,desc:""},{name:"",maxExp:5e9,feedback:4e4,chance:.01,desc:""},{name:"",maxExp:1e10,feedback:6e4,chance:.008,desc:""},{name:"",maxExp:2e10,feedback:1e5,chance:.006,desc:""},{name:"",maxExp:5e10,feedback:15e4,chance:.005,desc:""},{name:"",maxExp:1e11,feedback:25e4,chance:.004,desc:""},{name:"",maxExp:2e11,feedback:4e5,chance:.003,desc:""},{name:"",maxExp:5e11,feedback:6e5,chance:.002,desc:""},{name:"",maxExp:1e12,feedback:1e6,chance:.001,desc:""}],K2={:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:""},tu=["","","","","","","","","",""],Q2=e=>K2[e]||"",J2=e=>{const t=Q2(e),n=tu.indexOf(t);return n===-1||n===tu.length-1?null:tu[n+1]},Mf=e=>{const t=Qe.findIndex(n=>n.name===e);return t===-1||t===Qe.length-1?null:Qe[t+1]},An=e=>Qe.find(t=>t.name===e)||Qe[0],X2=e=>{const t=Qe.findIndex(n=>n.name===e);return t>=0?t:0},ei=(e,t,n,s=null,o=0,i=1)=>{const a={:{hp:100,atk:5,mp:0,def:2},:{hp:500,atk:50,mp:200,def:20},:{hp:800,atk:80,mp:400,def:35},:{hp:1200,atk:120,mp:600,def:50},:{hp:2e3,atk:200,mp:1e3,def:80},:{hp:1e4,atk:1e3,mp:5e3,def:400},:{hp:15e3,atk:1500,mp:8e3,def:600},:{hp:2e4,atk:2e3,mp:12e3,def:800},:{hp:1e5,atk:1e4,mp:5e4,def:4e3},:{hp:2e5,atk:2e4,mp:1e5,def:8e3},:{hp:4e5,atk:4e4,mp:2e5,def:16e3},:{hp:1e6,atk:1e5,mp:5e5,def:4e4},:{hp:2e6,atk:2e5,mp:1e6,def:8e4},:{hp:4e6,atk:4e5,mp:2e6,def:16e4},:{hp:1e7,atk:1e6,mp:5e6,def:4e5},:{hp:2e7,atk:2e6,mp:1e7,def:8e5},:{hp:4e7,atk:4e6,mp:2e7,def:16e5},:{hp:1e8,atk:1e7,mp:5e7,def:4e6},:{hp:2e8,atk:2e7,mp:1e8,def:8e6},:{hp:4e8,atk:4e7,mp:2e8,def:16e6},:{hp:1e9,atk:1e8,mp:5e8,def:4e7},:{hp:2e9,atk:2e8,mp:1e9,def:8e7},:{hp:4e9,atk:4e8,mp:2e9,def:16e7},:{hp:1e10,atk:1e9,mp:5e9,def:4e8},:{hp:2e10,atk:2e9,mp:1e10,def:8e8},:{hp:4e10,atk:4e9,mp:2e10,def:16e8},:{hp:1e11,atk:1e10,mp:5e10,def:4e9},:{hp:2e11,atk:2e10,mp:1e11,def:8e9},:{hp:4e11,atk:4e10,mp:2e11,def:16e9}},l=a[e]||a.;let d=1;Object.values(Bn).forEach(h=>{h.name===n&&(d=h.multiplier)});const u=1+t/100,c=1+(i>0?Math.min(1,o/i):0)*.3;let f=Math.floor(l.hp*d*u*c),x=Math.floor(l.atk*d*u*c),C=Math.floor((l.def||0)*d*u*c),w=Math.floor(l.mp*d*u*c);return(s?Object.values(s).filter(Boolean):[]).forEach(h=>{const g=h.stats||{};f+=g.hp||0,x+=g.atk||0,C+=g.def||0,w+=g.mp||0}),{hp:f,maxHp:f,atk:x,def:C||Math.floor(x*.4),mp:w,maxMp:w}},Cn=e=>{var l,d;if(!e)return{hp:100,maxHp:100,atk:10,def:5,mp:50,maxMp:50};const t=e.tier||e.tierTitle||"",n=((l=e.stats)==null?void 0:l.aptitude)||50,s=((d=e.spiritRoot)==null?void 0:d.type)||"",o=e.equipment||null,i=e.currentExp||e.cultivation||0,a=e.maxExp||1;return ei(t,n,s,o,i,a)},Um=[{name:"",rarity:"RED",effect:3,desc:"+200%",cost:0,bonuses:{speedMultiplier:3,feedbackMultiplier:1.5,sectAffinity:{levels:["TOP"],bonus:35}}},{name:"",rarity:"RED",effect:2.5,desc:"",cost:0,bonuses:{speedMultiplier:2.5,feedbackMultiplier:1.3,flatFeedbackBonus:5}},{name:"",rarity:"RED",effect:2.2,desc:"",cost:0,bonuses:{speedMultiplier:2.2,feedbackMultiplier:1.2,sectAffinity:{ids:["NINE_STAR","HEAVEN_EMPEROR"],bonus:30}}},{name:"",rarity:"ORANGE",effect:2,desc:"+100%",cost:0,bonuses:{speedMultiplier:2,sectAffinity:{ids:["NINE_STAR"],bonus:18}}},{name:"",rarity:"ORANGE",effect:1.8,desc:"100%",cost:0,bonuses:{speedMultiplier:1.8,sectAffinity:{ids:["SWORD"],bonus:28}}},{name:"",rarity:"ORANGE",effect:1.4,desc:"+40%",cost:0,bonuses:{speedMultiplier:1.4,businessBonus:.4,feedbackMultiplier:1.15}},{name:"",rarity:"ORANGE",effect:1.6,desc:"",cost:0,bonuses:{speedMultiplier:1.6,feedbackMultiplier:1.1,sectAffinity:{ids:["HEAVEN_EMPEROR","THUNDER"],bonus:22}}},{name:"",rarity:"PURPLE",effect:1.5,desc:"+50%",cost:0,bonuses:{speedMultiplier:1.5,sectAffinity:{ids:["IRON","STONE"],bonus:15}}},{name:"",rarity:"PURPLE",effect:1.5,desc:"",cost:0,bonuses:{speedMultiplier:1.5,feedbackMultiplier:1.05}},{name:"",rarity:"PURPLE",effect:1.3,desc:"",cost:0,bonuses:{speedMultiplier:1.3,businessBonus:.25,sectAffinity:{ids:["GRASS","DAN"],bonus:16}}},{name:"",rarity:"PURPLE",effect:1.4,desc:"",cost:0,bonuses:{speedMultiplier:1.4,sectAffinity:{ids:["THUNDER","DEMON"],bonus:18}}},{name:"",rarity:"BLUE",effect:1.2,desc:"+20%",cost:0,bonuses:{speedMultiplier:1.2}},{name:"",rarity:"BLUE",effect:1.2,desc:"",cost:0,bonuses:{speedMultiplier:1.2,feedbackMultiplier:1.05}},{name:"",rarity:"BLUE",effect:1.15,desc:"",cost:0,bonuses:{speedMultiplier:1.15,sectAffinity:{ids:["IRON"],bonus:12}}},{name:"",rarity:"GREEN",effect:1.1,desc:"",cost:0,bonuses:{speedMultiplier:1.1}},{name:"",rarity:"GREEN",effect:1.1,desc:"",cost:0,bonuses:{speedMultiplier:1.1,sectAffinity:{levels:["MID"],bonus:8}}},{name:"",rarity:"GREEN",effect:1.08,desc:"",cost:0,bonuses:{speedMultiplier:1.08,feedbackMultiplier:1.05}},{name:"",rarity:"WHITE",effect:.9,desc:"",cost:5,bonuses:{speedMultiplier:.9,feedbackMultiplier:.9}},{name:"",rarity:"WHITE",effect:.8,desc:"-20%",cost:0,bonuses:{speedMultiplier:.8}},{name:"",rarity:"WHITE",effect:.85,desc:"",cost:0,bonuses:{speedMultiplier:.85,feedbackMultiplier:.9}}],Er=[{id:"SWORD",name:"",level:"TOP",minApt:80,tuition:500,prefElements:[""],buff:1.5,risk:.02,resourceTypes:["",""],initialRankProb:{:.15,:.35,:.5},desc:"",scale:"",promotionEase:.85,requirements:{minApt:80,requiredElements:[""],allowedRootTypes:["","",""],notes:""}},{id:"HEAVEN_EMPEROR",name:"",level:"TOP",minApt:85,tuition:600,prefElements:["",""],buff:1.6,risk:.03,resourceTypes:["",""],initialRankProb:{:.2,:.4,:.4},desc:"",scale:"",promotionEase:.75,requirements:{minApt:85,allowedRootTypes:["",""],notes:""}},{id:"STAR_PALACE",name:"",level:"TOP",minApt:82,tuition:520,prefElements:["",""],buff:1.55,risk:.025,resourceTypes:["",""],initialRankProb:{:.18,:.37,:.45},desc:"",scale:"",promotionEase:.82,requirements:{minApt:82,allowedRootTypes:["","",""],notes:""}},{id:"VOID_TEMPLE",name:"",level:"TOP",minApt:83,tuition:480,prefElements:["",""],buff:1.52,risk:.028,resourceTypes:["",""],initialRankProb:{:.17,:.33,:.5},desc:"",scale:"",promotionEase:.8,requirements:{minApt:83,requiredElements:["",""],allowedRootTypes:["","",""],notes:""}},{id:"DAN",name:"",level:"HIGH",minApt:60,tuition:300,prefElements:["",""],buff:1.25,risk:.03,resourceTypes:["",""],initialRankProb:{:.1,:.4,:.5},desc:"",scale:"",promotionEase:1,requirements:{minApt:60,requiredElements:["",""],notes:""}},{id:"OCEAN_PALACE",name:"",level:"HIGH",minApt:65,tuition:350,prefElements:[""],buff:1.3,risk:.02,resourceTypes:["",""],initialRankProb:{:.12,:.38,:.5},desc:"",scale:"",promotionEase:.95,requirements:{minApt:65,requiredElements:[""],notes:""}},{id:"THUNDER",name:"",level:"HIGH",minApt:70,tuition:400,prefElements:[""],buff:1.4,risk:.04,resourceTypes:["",""],initialRankProb:{:.15,:.35,:.5},desc:"",scale:"",promotionEase:.9,requirements:{minApt:70,requiredElements:[""],notes:""}},{id:"GLACIER",name:"",level:"HIGH",minApt:68,tuition:320,prefElements:["",""],buff:1.28,risk:.03,resourceTypes:["",""],initialRankProb:{:.13,:.34,:.53},desc:"",scale:"",promotionEase:.97,requirements:{minApt:68,requiredElements:["",""],notes:""}},{id:"FLOWER",name:"",level:"MID",minApt:40,tuition:100,prefElements:["",""],buff:1.15,risk:.01,resourceTypes:["",""],initialRankProb:{:.05,:.25,:.7},desc:"",scale:"",promotionEase:1.05,requirements:{minApt:40,minLooks:75,requiredElements:["",""],notes:""}},{id:"NINE_STAR",name:"",level:"MID",minApt:45,tuition:120,prefElements:["",""],buff:1.18,risk:.02,resourceTypes:["",""],initialRankProb:{:.06,:.24,:.7},desc:"",scale:"",promotionEase:1,requirements:{minApt:45,requiredElements:["",""],notes:""}},{id:"WIND",name:"",level:"MID",minApt:50,tuition:150,prefElements:[""],buff:1.2,risk:.015,resourceTypes:["",""],initialRankProb:{:.08,:.27,:.65},desc:"",scale:"",promotionEase:1.1,requirements:{minApt:50,requiredElements:[""],notes:""}},{id:"HARMONY",name:"",level:"MID",minApt:35,tuition:80,prefElements:["",""],buff:1.12,risk:.01,resourceTypes:["",""],initialRankProb:{:.04,:.21,:.75},desc:"",scale:"",promotionEase:1.08,requirements:{minApt:35,minLooks:70,notes:""}},{id:"IRON",name:"",level:"LOW",minApt:20,tuition:50,prefElements:[""],buff:1.1,risk:.005,resourceTypes:["",""],initialRankProb:{:.02,:.15,:.83},desc:"",scale:"",promotionEase:1.2,requirements:{minApt:20,notes:""}},{id:"GRASS",name:"",level:"LOW",minApt:25,tuition:60,prefElements:[""],buff:1.08,risk:.005,resourceTypes:["",""],initialRankProb:{:.03,:.17,:.8},desc:"",scale:"",promotionEase:1.25,requirements:{minApt:25,requiredElements:[""],notes:""}},{id:"STONE",name:"",level:"LOW",minApt:20,tuition:40,prefElements:["",""],buff:1.05,risk:.003,resourceTypes:["",""],initialRankProb:{:.01,:.12,:.87},desc:"",scale:"",promotionEase:1.18,requirements:{minApt:20,requiredElements:["",""],notes:""}},{id:"EMBER",name:"",level:"LOW",minApt:18,tuition:30,prefElements:[""],buff:1.02,risk:.004,resourceTypes:["",""],initialRankProb:{:.01,:.1,:.89},desc:"",scale:"",promotionEase:1.3,requirements:{minApt:18,requiredElements:["",""],notes:""}},{id:"DEMON",name:"",level:"RECKLESS",minApt:30,tuition:0,prefElements:["",""],buff:2,risk:.1,resourceTypes:["",""],initialRankProb:{:.08,:.22,:.7},desc:"",scale:"",promotionEase:1.2,requirements:{minApt:30,allowedRootTypes:["","",""],notes:""}},{id:"GHOST",name:"",level:"RECKLESS",minApt:35,tuition:0,prefElements:[""],buff:1.8,risk:.08,resourceTypes:["",""],initialRankProb:{:.1,:.25,:.65},desc:"",scale:"",promotionEase:1.1,requirements:{minApt:35,requiredElements:["",""],notes:""}},{id:"BLOOD",name:"",level:"RECKLESS",minApt:25,tuition:0,prefElements:["",""],buff:1.7,risk:.12,resourceTypes:["",""],initialRankProb:{:.05,:.2,:.75},desc:"",scale:"",promotionEase:1.15,requirements:{minApt:25,requiredElements:["",""],notes:""}},{id:"SHADOW_PAVILION",name:"",level:"RECKLESS",minApt:28,tuition:0,prefElements:["",""],buff:1.65,risk:.09,resourceTypes:["",""],initialRankProb:{:.07,:.23,:.7},desc:"",scale:"",promotionEase:1.18,requirements:{minApt:28,requiredElements:["",""],notes:""}},{id:"NONE",name:"",level:"NONE",minApt:0,tuition:0,prefElements:[],buff:.8,risk:0,resourceTypes:[""],initialRankProb:{:1},desc:"",scale:"",promotionEase:1,requirements:{minApt:0,notes:""}}],ky=e=>Er.find(t=>t.id===e)||Er.find(t=>t.id==="NONE"),sa=(e,t)=>{var u,p;if(!t||!t.initialRankProb)return"";const n={...t.initialRankProb};if((((u=e.stats)==null?void 0:u.aptitude)||50)>=(t.minApt||0)+20&&n.!==void 0){const c=Math.min(n.,.3);n.-=c,n.=(n.||0)+c*.6,n.=(n.||0)+c*.4}Array.isArray((p=e.spiritRoot)==null?void 0:p.elements)&&Array.isArray(t.prefElements)&&e.spiritRoot.elements.forEach(c=>{t.prefElements.includes(c)&&(n.=(n.||0)+.05,n.=(n.||0)+.03,n.&&(n.=Math.max(0,n.-.08)))});const o=t.promotionEase??1;if(o!==1){const c=Math.max(.3,Math.min(2,o));n.&&(n.*=c),n.&&(n.*=c),n.&&(n./=c),n.&&(n./=c)}const i=Object.keys(n);let a=i.reduce((c,f)=>c+(n[f]||0),0);if(a<=0)return"";i.forEach(c=>n[c]=(n[c]||0)/a);const l=Math.random();let d=0;for(const c of i)if(d+=n[c],l<=d)return c;return i[i.length-1]},Z2=e=>e?e.resourceTypes||[]:[];Y2();const Ey=(e,t)=>{var l,d,u,p,c;if(!e||!t)return 0;let n=0;Array.isArray((l=e.spiritRoot)==null?void 0:l.elements)&&(e.spiritRoot.elements.forEach(f=>{t.prefElements&&t.prefElements.includes(f)&&(n+=50,e.spiritRoot.elements.length===1&&(n+=30))}),e.spiritRoot.type===""&&t.level==="TOP"&&(n+=50),e.spiritRoot.type===""&&(t.id==="DEMON"&&(n+=60),t.id==="THUNDER"&&(n+=50),t.id==="GHOST"&&e.spiritRoot.elements.includes("")&&(n+=50),t.id==="WIND"&&e.spiritRoot.elements.includes("")&&(n+=50),t.id==="HEAVEN_EMPEROR"&&(n+=40)));const s=((d=e.stats)==null?void 0:d.aptitude)||0,o=(t.minApt||0)-s;if(o<=0){const f=s-(t.minApt||0);n+=Math.min(40,f),f>=20&&t.level==="TOP"&&(n+=20)}else n-=o*2;if(t.level==="TOP"?n-=5:t.level==="RECKLESS"?n+=15:t.level==="LOW"&&(n-=10),t.id==="FLOWER"||t.id==="HARMONY"){const f=((u=e.stats)==null?void 0:u.looks)||50;f>=80?n+=30:f>=60&&(n+=15)}const i=D2(e.constitution);if(i){const f=i.bonus||15;i.ids&&i.ids.includes(t.id)?n+=f:i.levels&&i.levels.includes(t.level)&&(n+=Math.max(8,f*.6))}const a=(c=(p=e.trait)==null?void 0:p.bonuses)==null?void 0:c.sectAffinity;if(a){const f=a.bonus||12;a.ids&&a.ids.includes(t.id)?n+=f:a.levels&&a.levels.includes(t.level)&&(n+=Math.max(6,f*.5))}return Math.round(n)},jy=(e,t)=>{var p,c,f,x,C,w,S,h;if(!e||!t)return{qualified:!1,reasons:[""],summary:"",notes:""};const n=t.requirements||{},s=((p=e.stats)==null?void 0:p.aptitude)??0,o=((c=e.stats)==null?void 0:c.looks)??0,i=(f=e.spiritRoot)==null?void 0:f.type,a=((x=e.spiritRoot)==null?void 0:x.elements)||[],l=n.minApt??t.minApt??0,d=[],u=[];return l>0&&d.push(`${l}`),(C=n.requiredElements)!=null&&C.length&&d.push(`${n.requiredElements.join("")}`),(w=n.allowedRootTypes)!=null&&w.length&&d.push(`${n.allowedRootTypes.join("")}`),n.minLooks&&d.push(`${n.minLooks}`),n.customText&&d.push(n.customText),s<l&&u.push(`${l}`),n.minLooks&&o<n.minLooks&&u.push(`${n.minLooks}`),(S=n.allowedRootTypes)!=null&&S.length&&i&&(n.allowedRootTypes.includes(i)||u.push(`${n.allowedRootTypes.join("")}`)),(h=n.requiredElements)!=null&&h.length&&(a.some(v=>n.requiredElements.includes(v))||u.push(`${n.requiredElements.join("")}`)),{qualified:u.length===0,reasons:u,summary:d.join(""),notes:n.notes||""}},ka=(e,t=!1)=>{var n,s,o,i,a,l,d,u;try{let p=t?10:120;const c=((n=e.stats)==null?void 0:n.aptitude)||50,x=.5+Math.max(0,Math.min(100,c))/100*2.5;p*=x;const C=((s=e.stats)==null?void 0:s.intelligence)||50,S=.6+Math.max(0,Math.min(100,C))/100*1.4;p*=S;const h=Qe.findIndex(j=>j.name===e.tier);if(h>=0){const j=1+h/Qe.length*1.5;p*=j}if((o=e.spiritRoot)!=null&&o.multiplier){const j=e.spiritRoot.multiplier;typeof j=="number"&&isFinite(j)&&(p*=j)}if(e.cultivationMethod&&e.spiritRoot)try{const j=Cf(e.cultivationMethod,e.spiritRoot);typeof j=="number"&&isFinite(j)&&(p*=j)}catch(j){console.error("Error calculating manual multiplier:",j)}const g=((a=(i=e.trait)==null?void 0:i.bonuses)==null?void 0:a.speedMultiplier)??((l=e.trait)==null?void 0:l.effect)??1;typeof g=="number"&&isFinite(g)&&(p*=g),(u=(d=e.trait)==null?void 0:d.bonuses)!=null&&u.flatSpeedBonus&&typeof e.trait.bonuses.flatSpeedBonus=="number"&&(p+=e.trait.bonuses.flatSpeedBonus);const v=O2(e.constitution);return typeof v=="number"&&isFinite(v)&&(p*=v),e.sect&&e.sect.level!=="NONE"&&(p*=1.5),!isFinite(p)||isNaN(p)?(console.error("Invalid cultivation speed calculated:",p),t?10:120):Math.floor(p)}catch(p){return console.error("Error in calculateCultivationSpeed:",p),t?10:120}},bc=(e,t={})=>{var n,s,o,i,a;try{if(e.age<6)return 0;const l=e.tierTitle||e.tier||"";if(l==="")return 0;const d=An(l);if(!d)return 0;let u=d.feedback||0;if(u===0)return 0;let p=0;l.includes("")?p=e.age<16?1:2:l.includes("")?p=u*.7:l.includes("")||l.includes("")?p=u*1:p=u*.5,e.age<16&&!l.includes("")&&(p*=.5);const c=((s=(n=e.trait)==null?void 0:n.bonuses)==null?void 0:s.feedbackMultiplier)??1,f=((i=(o=e.trait)==null?void 0:o.bonuses)==null?void 0:i.flatFeedbackBonus)||0,x=1+P2(e.constitution);p=p*c*x+f;const C=((a=e.stats)==null?void 0:a.aptitude)||50,w=Math.max(.1,(C||50)/50);p*=w;let S=1;e.rank===""&&(S=1.2),e.rank===""&&(S=1.5),e.rank===""&&(S=2),p*=S;let h=1;if(e.cultivationMethod&&e.spiritRoot)try{h=Cf(e.cultivationMethod,e.spiritRoot),isFinite(h)||(h=1)}catch(j){console.error("Error calculating manual multiplier for child:",e.name,j),h=1}p*=h;const g=t.familyRatingMultiplier??1;p*=g;const v=Math.max(0,Math.floor(p));return isFinite(v)?v:0}catch(l){return console.error("Error in calculateChildFeedback:",l),0}},ew={:4,:8,:16,:28,:36,:48,:65,:85},tw={TOP:32,HIGH:22,MID:14,LOW:9,RECKLESS:18,NONE:0},Mr=[{id:"SEED",label:"",minScore:0,color:"#9e9e9e",tagline:""},{id:"BACKBONE",label:"",minScore:80,color:"#4caf50",tagline:""},{id:"ELITE",label:"",minScore:140,color:"#2196f3",tagline:""},{id:"ELDER",label:"",minScore:200,color:"#ff9800",tagline:""},{id:"SOVEREIGN",label:"",minScore:280,color:"#e91e63",tagline:""}],oo=[{id:"CLAN_SEED",name:"",desc:"",requirements:{minMembers:1,minPower:0,minStones:0},feedbackMultiplier:1,feedbackDesc:"1.0 ()"},{id:"LOCAL_CLAN",name:"",desc:"",requirements:{minMembers:5,minPower:100,minStones:500,minOuterDoor:2},feedbackMultiplier:1.5,feedbackDesc:"1.5 (+50%)"},{id:"CITY_NOBLE",name:"",desc:"",requirements:{minMembers:8,minPower:200,minStones:1500,minInnerDoor:2},feedbackMultiplier:3,feedbackDesc:"3.0 (+200%)"},{id:"REGION_PILLAR",name:"",desc:"",requirements:{minMembers:12,minPower:350,minStones:5e3,minDiscipleRank:2},feedbackMultiplier:6,feedbackDesc:"6.0 (+500%)"},{id:"SECT_ALLY",name:"",desc:"",requirements:{minMembers:18,minPower:600,minStones:1e4,minSteward:1},feedbackMultiplier:12,feedbackDesc:"12.0 (+1100%)"},{id:"IMMORTAL_DYNASTY",name:"",desc:"",requirements:{minMembers:22,minPower:900,minStones:2e4,minElders:1},feedbackMultiplier:25,feedbackDesc:"25.0 (+2400%)"},{id:"HEAVENLY_HEGEMONY",name:"",desc:"",requirements:{minMembers:28,minPower:1400,minStones:4e4,minElders:2,minSovereigns:1},feedbackMultiplier:100,feedbackDesc:"100.0 (+9900%)"}],nw=e=>{const t=oo.find(n=>n.id===e);return(t==null?void 0:t.feedbackMultiplier)??1},rw=e=>{const t=Qe.findIndex(n=>n.name===e);return Math.max(0,t)*8},sw=(e,t)=>{if(!e)return t?6:0;const n=W2(e);return n>0?n:ew[e]??(t?6:0)},ow=e=>e?tw[e.level]??10:0,iw=e=>e?e.includes("")?18:e===""?8:e===""?40:0:0,Cy=e=>Math.max(0,Math.min(1,e)),Ty=(e={})=>{if(!e)return{score:0,tierId:Mr[0].id,label:Mr[0].label,color:Mr[0].color,progress:0,tagline:Mr[0].tagline,tierStart:0,nextThreshold:Mr[1].minScore,isElder:!1,isSovereign:!1};const t=e.tierTitle||e.tier||"",n=rw(t),s=sw(e.rank,!!e.sect),o=ow(e.sect),i=iw(e.rank),a=e.cultivationManual?8:0,l=e.spouse?5:0,d=Math.round(n+s+o+i+a+l),u=[...Mr].reverse().find(S=>d>=S.minScore)||Mr[0],p=Mr.findIndex(S=>S.id===u.id),c=Mr[p+1]||null,f=c?Math.max(1,c.minScore-u.minScore):1,x=c?Cy((d-u.minScore)/f):1,C=e.rank&&(e.rank.includes("")||e.rank===""),w=e.rank==="";return{score:d,tierId:u.id,label:u.label,color:u.color,tagline:u.tagline,tierStart:u.minScore,nextThreshold:(c==null?void 0:c.minScore)??d,progress:x,nextLabel:(c==null?void 0:c.label)||"",isElder:C||u.id==="ELDER"||u.id==="SOVEREIGN",isSovereign:w||u.id==="SOVEREIGN"}},Iy=oo[0],aw=e=>{const t=oo.findIndex(n=>n.id===e);return t>=0?{tier:oo[t],index:t}:{tier:Iy,index:0}},Ar=(e,t,n)=>({label:e,current:t,required:n,met:t>=n}),lw={:7,:6,:5,:4,:3,:2,:1,:0},cw=e=>e?lw[e]??-1:-1,yl=(e,t)=>e.filter(n=>cw(n.rank)>=t).length,dw=(e=[],t={})=>{var k,T,N,K;const n=((k=t.familyRating)==null?void 0:k.currentId)||Iy.id,{tier:s,index:o}=aw(n),i=oo[o+1]||null,a=e.filter(L=>(L.generation||1)<=2),l=a.map(L=>({id:L.id,name:L.name,generation:L.generation,influence:Ty(L)})),d=l.reduce((L,B)=>L+B.influence.score,0),u=l.filter(L=>L.influence.isElder).length,p=l.filter(L=>L.influence.isSovereign).length,c=(t.worldNpcs||[]).filter(L=>(L==null?void 0:L.status)!=="DEAD"&&(L==null?void 0:L.sectRank)===""&&(L==null?void 0:L.source)==="child").length,f=p+c,x=yl(a,1),C=yl(a,2),w=yl(a,3),S=yl(a,4),h=e.length+1,g=((T=t.resources)==null?void 0:T.spiritStones)||0,v=Math.round(d+h*5+g/200),j=((N=s.requirements)==null?void 0:N.minPower)??0,R=((K=i==null?void 0:i.requirements)==null?void 0:K.minPower)??v,b=i?Cy((v-j)/Math.max(1,R-j)):1,_=[];if(i){const L=i.requirements||{};L.minMembers!==void 0&&_.push(Ar("",h,L.minMembers)),L.minPower!==void 0&&_.push(Ar("",v,L.minPower)),L.minStones!==void 0&&_.push(Ar("",g,L.minStones)),L.minOuterDoor!==void 0&&_.push(Ar("",x,L.minOuterDoor)),L.minInnerDoor!==void 0&&_.push(Ar("",C,L.minInnerDoor)),L.minDiscipleRank!==void 0&&_.push(Ar("",w,L.minDiscipleRank)),L.minSteward!==void 0&&_.push(Ar("",S,L.minSteward)),L.minElders!==void 0&&_.push(Ar("",u,L.minElders)),L.minSovereigns!==void 0&&_.push(Ar("",f,L.minSovereigns))}const I=i?_.every(L=>L.met):!1;return{enrichedChildren:l,childInfluenceMap:l.reduce((L,B)=>(L[B.id]=B.influence,L),{}),totals:{population:h,stones:g,totalPower:d,elderCount:u,sovereignCount:f,outerDoorCount:x,innerDoorCount:C,discipleRankCount:w,stewardCount:S,ratingScore:v,powerProgress:b},currentTier:s,currentIndex:o,nextTier:i,requirements:_,canUpgrade:I}},Nr=wa[0],Ul=Vo(),uw={...Ul.spiritRoot},Bo={name:"",age:16,gender:"",avatar:{base:0,skinColor:0,hair:1,hairColor:0,eye:0,eyeColor:1,mouth:0},tier:Ul.tier,currentExp:Ul.currentExp,maxExp:Ul.maxExp,resources:{spiritStones:100,money:50},stats:{looks:80,cunning:60,aptitude:15,intelligence:60,health:80},familyRating:{currentId:oo[0].id,history:[]},skillPoints:0,usedRedeemCodes:[],breakthroughBonus:0,breakthroughFailCount:0,newsBuffer:[],gazetteHistory:[],gazetteIssue:0,hasUnreadGazette:!1,worldNpcs:[],specialCollections:{fumoSwords:[]},specialFlags:{fumoDuoUnlocked:!1,fumoDuoMet:!1},rival:{name:Nr.name,stageId:Nr.id,state:"NORMAL",lifeStage:0,storyTimer:0,threatLevel:Nr.baseThreat??0,rumorCount:0,hiddenTurns:0,isDead:!1,relationValue:-100,tier:Nr.tier,currentExp:Nr.baseExp,stats:{aptitude:95,looks:80,intelligence:90,health:80},combatStats:{hp:Nr.combatStats.hp,maxHp:Nr.combatStats.maxHp,atk:Nr.combatStats.atk,def:Nr.combatStats.def}},revengeProgress:{currentStageIndex:0,completedStages:[],sagaComplete:!1},revengeActions:{lastRumorMonth:0,totalRumors:0,assassinationAttempts:0,hidingMonths:0},spiritRoot:uw,cultivationMethod:"basic_breath",combatStats:{hp:300,maxHp:300,atk:25,def:8,mp:120,maxMp:120},time:{year:3572,month:9,season:""},status:["",""],childrenStrategy:{skipZhaozhou:!1},generation3Plus:[]},pw={aptitude:{name:"",desc:"",trainable:!0,howToIncrease:"",howToRestore:"",effect:""},luck:{name:"",desc:"",trainable:!0,howToIncrease:"NPC",howToRestore:"",effect:""},lifespan:{name:"",desc:"",trainable:!1,howToIncrease:"",effect:""},looks:{name:"",desc:"",trainable:!0,howToIncrease:"",howToRestore:"",effect:""},cunning:{name:"",desc:"",trainable:!0,howToIncrease:"",howToRestore:"/",effect:""},health:{name:"",desc:"0-100",trainable:!1,howToIncrease:"NPC",howToRestore:"5-10",effect:"4020",energyLimitFormula:"max(5, 20 - (100 - health) * 0.15)  // "},intelligence:{name:"",desc:"",trainable:!0,howToIncrease:"",howToRestore:"",effect:""}};function fw(e){return pw[e]||{name:e,desc:"",trainable:!1,howToIncrease:"",howToRestore:"",effect:""}}function zt(e,t=20){if(e==null)return t;const s=(100-Math.max(0,Math.min(100,e)))*.15;return Math.max(5,t-s)}function mw(e,t){const n=Math.max(0,e-t),s=e-n;let o="";return s>30?o="":s>15&&(o=""),{newHealth:n,healthLost:s,severity:o,damageDisplay:`${o} ${s} ${e}  ${n}`}}const Gm={EXPLORATION:{name:"",icon:"",minDamage:5,maxDamage:20,severity:""},ASSASSINATION:{name:"",icon:"",minDamage:15,maxDamage:40,severity:""},DUEL:{name:"",icon:"",minDamage:20,maxDamage:50,severity:""},ROMANCE:{name:"",icon:"",minDamage:3,maxDamage:10,severity:""},DISASTER:{name:"",icon:"",minDamage:10,maxDamage:30,severity:""}};function ti(e,t,n="EXPLORATION"){var p;const s=((p=e.stats)==null?void 0:p.health)||50,o=Gm[n]||Gm.EXPLORATION,i=mw(s,t),a=zt(s),l=zt(i.newHealth),d=a-l,u=`
${o.icon} ${o.name}
${i.damageDisplay}

${i.newHealth<20?" ":""}
${d>0?`  ${d.toFixed(1)}  ${a.toFixed(1)}  ${l.toFixed(1)}`:""}
  `.trim();return{newHealth:i.newHealth,healthLost:i.healthLost,severity:i.severity,message:u,energyPenalty:Math.max(0,d),isSerious:i.newHealth<20}}function gw(e,t,n="REST"){var f;const s=((f=e.stats)==null?void 0:f.health)||50,o=zt(s),i=Math.min(100,s+t),a=i-s,l=zt(i),d=l-o;let u="",p="";n==="MEDICINE"?(u="",p=""):n==="HEALER"&&(u="",p="");const c=`
${u} ${p}
 ${a} ${s}  ${i}

${d>0?`  ${d.toFixed(1)}  ${o.toFixed(1)}  ${l.toFixed(1)}`:""}
${i===100?" ":""}
  `.trim();return{newHealth:i,recovered:a,message:c,energyBonus:Math.max(0,d)}}function hw(e){var d;const t=((d=e.stats)==null?void 0:d.health)||50,n=5+Math.floor(Math.random()*6),s=e.currentExp||0,o=Math.floor(s/1e3*.5),i=n+o,a=Math.min(100,t+i),l=a-t;return{newHealth:a,recovered:l,message:l>0?` +${l}${t}  ${a}`:null}}function Af(e){var n;const t=((n=e.stats)==null?void 0:n.health)||50;return{canExplore:t>=20,canDuel:t>=30,canAssassinate:t>=25,health:t,reason:t<20?"":t<30?"":""}}const xw=10,Ry=e=>{var o;if(!e)return e;const t=xw,n=zt(t),s=Math.floor((((o=e.resources)==null?void 0:o.spiritStones)||0)*.5);return{...e,currentExp:0,stats:{...e.stats,health:t},energy:Math.min(e.energy||20,n),resources:{...e.resources,spiritStones:s}}},yw=e=>{const t=Ry(e);return!t||t===e||Object.assign(e,t),e};function bw(){const[e,t]=y.useState({...Bo,businesses:[],gazetteHistory:[],gazetteIssue:0,hasUnreadGazette:!1,newsBuffer:[],lastAuctionYear:null,currentAuction:null,auctionWindowStart:null,auctionWindowEnd:null,energy:Bo.energy??20,soldAuctionItems:[]}),n=y.useCallback(I=>{t(k=>({...k,...I}))},[]),s=y.useCallback(I=>{t(k=>{const T={...k.stats,...I};let N=k.energy;if(typeof I.health=="number"){const K=zt(I.health);N=Math.min(k.energy,K)}return{...k,stats:T,energy:N}})},[]),o=y.useCallback(I=>{t(k=>({...k,time:{...k.time,...I}}))},[]),i=y.useCallback(I=>{t(k=>({...k,cultivation:typeof I=="function"?I(k.cultivation):I}))},[]),a=y.useCallback(I=>{t(k=>{const T={...k.resources};return I.spirit&&(T.spirit=(k.resources.spirit||0)+I.spirit),I.spirit2&&(T.spirit2=(k.resources.spirit2||0)+I.spirit2),I.spiritStones!==void 0&&(T.spiritStones=(k.resources.spiritStones||0)+I.spiritStones),{...k,resources:T}})},[]),l=y.useCallback(I=>{t(k=>{const T={...k.resources};return I.spirit&&(T.spirit=Math.max(0,(k.resources.spirit||0)-I.spirit)),I.spirit2&&(T.spirit2=Math.max(0,(k.resources.spirit2||0)-I.spirit2)),I.spiritStones!==void 0&&(T.spiritStones=Math.max(0,(k.resources.spiritStones||0)-I.spiritStones)),{...k,resources:T}})},[]),d=y.useCallback(I=>{t(k=>({...k,energy:typeof I=="function"?I(k.energy||0):Math.max(0,(k.energy||0)+I)}))},[]),u=y.useCallback((I=1)=>{t(k=>({...k,energy:Math.max(0,(k.energy||0)-I)}))},[]),p=y.useCallback(I=>{t(k=>({...k,resources:{...k.resources,spiritStones:Math.max(0,k.resources.spiritStones-I.cost)},businesses:[...k.businesses,I]}))},[]),c=y.useCallback(({won:I,expGain:k=0,spiritStones:T=0,health:N,healthDamage:K,injurySource:L,onNotify:B})=>{t(W=>{const z={...W};if(k&&(z.currentExp=(W.currentExp||0)+k),T!==0&&(z.resources={...W.resources,spiritStones:T>0?W.resources.spiritStones+T:Math.max(0,W.resources.spiritStones+T)}),N!==void 0){z.stats={...W.stats,health:N};const ne=zt(N);z.energy=Math.min(W.energy||20,ne)}else if(K&&K>0){const ne=ti(W,K,L||"EXPLORATION");if(z.stats={...W.stats,health:ne.newHealth},ne.energyPenalty>0){const Q=zt(ne.newHealth);z.energy=Math.min(W.energy||20,Q)}B&&B({type:"health_damage",message:ne.message,severity:ne.severity,isSerious:ne.isSerious})}return z})},[]),f=y.useCallback((I,k="EXPLORATION",T)=>{t(N=>{const K=ti(N,I,k);T&&T({type:"health_damage",message:K.message,severity:K.severity,isSerious:K.isSerious,energyPenalty:K.energyPenalty});let L=N.energy||20;if(K.energyPenalty>0){const B=zt(K.newHealth);L=Math.min(L,B)}return{...N,stats:{...N.stats,health:K.newHealth},energy:L}})},[]),x=y.useCallback((I,k="REST",T)=>{t(N=>{const K=gw(N,I,k);return T&&K.message&&T({type:"health_recovery",message:K.message,energyBonus:K.energyBonus}),{...N,stats:{...N.stats,health:K.newHealth}}})},[]),C=y.useCallback((I="explore")=>Af(e),[e]),w=y.useCallback(()=>{var I;return zt(((I=e.stats)==null?void 0:I.health)||50)},[e]),S=y.useCallback((I,k)=>{t(T=>({...T,worldNpcs:(T.worldNpcs||[]).map(N=>N.id===I?{...N,...k}:N)}))},[]),h=y.useCallback(I=>{t(k=>({...k,worldNpcs:I(k.worldNpcs||[])}))},[]),g=y.useCallback(I=>{t(k=>({...k,newsBuffer:[...k.newsBuffer||[],I]}))},[]),v=y.useCallback(()=>{t(I=>({...I,newsBuffer:[]}))},[]),j=y.useCallback((I,k)=>{t(T=>{var K;const N=Array.isArray((K=T.specialCollections)==null?void 0:K[I])?T.specialCollections[I]:[];return N.includes(k)?T:{...T,specialCollections:{...T.specialCollections||{},[I]:[...N,k]}}})},[]),R=y.useCallback(()=>{t(I=>Ry(I))},[]),b=y.useCallback(I=>{t(k=>({...k,inventory:[...k.inventory||[],I]}))},[]),_=y.useCallback(I=>{t(k=>({...k,inventory:(k.inventory||[]).filter(T=>T.id!==I)}))},[]);return{player:e,setPlayer:t,updatePlayer:n,updatePlayerStats:s,updatePlayerTime:o,updatePlayerCultivation:i,addResources:a,consumeResources:l,updateEnergy:d,consumeEnergy:u,purchaseBusiness:p,applyCombatResult:c,applyHealthDamageWithNotify:f,applyHealthRecovery:x,checkHealthStatus:C,getEnergyLimit:w,updateWorldNpc:S,updateWorldNpcs:h,addNewsToBuffer:g,clearNewsBuffer:v,addToSpecialCollection:j,applyDefeatPenalty:R,addInventoryItem:b,removeInventoryItem:_}}const vw={aptitude:85,looks:90,intelligence:80},_y=[{id:1,name:"",gender:"",age:25,identity:"",desc:"",avatar:{base:0,skinColor:1,hair:0,hairColor:0,eye:0,eyeColor:0,mouth:1},...(()=>{const e=Vo();return{tier:e.tier,currentExp:e.currentExp,maxExp:e.maxExp,spiritRoot:e.spiritRoot}})(),stats:vw,combatStats:{hp:2e3,maxHp:2e3,atk:180,mp:800},sect:ky("SWORD"),sectId:"SWORD",sectRank:"",sectStatus:"defected",appearance:"...",personality:{label:"",tag:"",desc:""},relationship:{stage:1,affection:10,trust:20,jealousy:0},likes:["",""],dislikes:[""],isPregnant:!1},{id:2,name:"",gender:"",age:38,identity:"",desc:"",avatar:{base:0,skinColor:2,hair:-1,hairColor:null,eye:0,eyeColor:0,mouth:1},...(()=>{const e=Vo();return{tier:e.tier,currentExp:e.currentExp,maxExp:e.maxExp,spiritRoot:e.spiritRoot}})(),stats:{aptitude:95,looks:40,intelligence:95},combatStats:{hp:1800,maxHp:1800,atk:200,mp:1200},sect:null,sectId:null,sectRank:"",sectStatus:"mysterious",personality:{label:"",tag:"",desc:""},relationship:{stage:1,affection:5,trust:10,jealousy:0},likes:[""],dislikes:[],isPregnant:!1}];function zn(e={}){var h,g,v,j;const t=e.currentExp||e.cultivation||0,n=e.combatStats||{},s=n.atk||Math.floor((((h=e.stats)==null?void 0:h.aptitude)||50)*.8),o=n.def||Math.floor((((g=e.stats)==null?void 0:g.aptitude)||50)*.4),i=n.maxHp||Math.floor(t+(((v=e.stats)==null?void 0:v.health)||50)*10),a=45,l=1,d=22,u=.08,p=18,c=Math.floor(s*a),f=Math.floor(i*l),x=Math.floor(o*d),C=Math.floor(t*u),w=Math.floor((((j=e.stats)==null?void 0:j.aptitude)||50)*p);return{total:Math.max(1,c+f+x+C+w),breakdown:{atk:c,hp:f,def:x,exp:C,aptitude:w},details:{atk:s,def:o,maxHp:i}}}function My(e={},t={}){var S,h,g,v,j,R;const n=e.combatStats||{},s=t.combatStats||{},o=n.atk||Math.max(1,Math.floor((((S=e.stats)==null?void 0:S.aptitude)||50)*.8)),i=n.def||Math.max(0,Math.floor((((h=e.stats)==null?void 0:h.aptitude)||50)*.4)),a=n.maxHp||Math.max(1,Math.floor((e.currentExp||e.cultivation||0)+(((g=e.stats)==null?void 0:g.health)||50)*10)),l=s.atk||Math.max(1,Math.floor((((v=t.stats)==null?void 0:v.aptitude)||50)*.8)),d=s.def||Math.max(0,Math.floor((((j=t.stats)==null?void 0:j.aptitude)||50)*.4)),u=s.maxHp||Math.max(1,Math.floor((t.currentExp||t.cultivation||0)+(((R=t.stats)==null?void 0:R.health)||50)*10)),p=Math.max(1,o-Math.floor(d/2)),c=Math.max(1,l-Math.floor(i/2)),f=Math.ceil(u/p),x=Math.ceil(a/c),C=x-f;let w;return C>=3?w=.98:C===2?w=.92:C===1?w=.78:C===0?w=.55:C===-1?w=.28:C===-2?w=.12:w=.03,{prob:w,roundsToKillEnemy:f,roundsToDie:x,pDpr:p,eDpr:c}}const bl=[{id:"farm",name:"",cost:500,baseIncome:50,desc:"",minTier:""},{id:"mine",name:"",cost:2e3,baseIncome:200,desc:"",minTier:""},{id:"auction",name:"",cost:1e4,baseIncome:1500,desc:"",minTier:""},{id:"sect_branch",name:"",cost:5e4,baseIncome:8e3,desc:"",minTier:""}],Ay=[{id:"peach_island",name:"",reqTier:"",recommendCP:300,cost:10,drops:["herb_bandage","iron_sword","rice_ball","beast_core"],risk:.05,desc:"",resourceLevel:"MORTAL",dropTable:[{item:"herb_bandage",weight:.25},{item:"iron_sword",weight:.25},{item:"rice_ball",weight:.3},{item:"beast_core",weight:.2}]},{id:"snake_valley",name:"",reqTier:"",recommendCP:5e3,cost:50,drops:["beast_core","beast_fang","herb_bandage"],risk:.15,desc:"",resourceLevel:"SPIRIT",dropTable:[{item:"beast_core",weight:.3},{item:"beast_fang",weight:.4},{item:"herb_bandage",weight:.3}]},{id:"thunder_peak",name:"",reqTier:"",recommendCP:8e4,cost:300,drops:["thunder_wood","iron_armor","foundation_pill","beast_fang"],risk:.25,desc:"",resourceLevel:"SPIRIT",dropTable:[{item:"thunder_wood",weight:.3},{item:"iron_armor",weight:.3},{item:"foundation_pill",weight:.2},{item:"beast_fang",weight:.2}]},{id:"ancient_tomb",name:"",reqTier:"",recommendCP:15e4,cost:500,drops:["core_pill","milk_millennium","marrow_wash","moonshadow_saber"],risk:.4,desc:"",resourceLevel:"EARTH",dropTable:[{item:"core_pill",weight:.25},{item:"milk_millennium",weight:.25},{item:"marrow_wash",weight:.25},{item:"moonshadow_saber",weight:.25}]},{id:"demon_domain",name:"",reqTier:"",recommendCP:8e5,cost:2e3,drops:["nascent_fruit","heaven_manual","divine_egg","storm_piercer","core_pill"],risk:.6,desc:"",resourceLevel:"HEAVEN",dropTable:[{item:"nascent_fruit",weight:.25},{item:"heaven_manual",weight:.25},{item:"divine_egg",weight:.25},{item:"storm_piercer",weight:.15},{item:"core_pill",weight:.1}]},{id:"star_sea_realm",name:"",reqTier:"",recommendCP:16e5,cost:5e3,drops:["starlight_pill","cosmic_crystal","void_silk","nascent_fruit"],risk:.7,desc:"",resourceLevel:"HEAVEN",dropTable:[{item:"starlight_pill",weight:.3},{item:"cosmic_crystal",weight:.3},{item:"void_silk",weight:.2},{item:"nascent_fruit",weight:.2}]},{id:"immortal_cave",name:"",reqTier:"",recommendCP:8e6,cost:2e4,drops:["primordial_spirit_pill","heavenly_jade","soul_essence_crystal"],risk:.75,desc:"",resourceLevel:"DIVINE",dropTable:[{item:"primordial_spirit_pill",weight:.3},{item:"heavenly_jade",weight:.35},{item:"soul_essence_crystal",weight:.35}]},{id:"celestial_pagoda",name:"",reqTier:"",recommendCP:16e6,cost:5e4,drops:["nine_heaven_pill","star_core_fragment","celestial_silk_cloth"],risk:.8,desc:"",resourceLevel:"DIVINE",dropTable:[{item:"nine_heaven_pill",weight:.25},{item:"star_core_fragment",weight:.35},{item:"celestial_silk_cloth",weight:.4}]},{id:"abyss_deeps",name:"",reqTier:"",recommendCP:32e6,cost:1e5,drops:["soul_splitting_pill","abyss_stone","abyssal_essence"],risk:.85,desc:"",resourceLevel:"DIVINE",dropTable:[{item:"soul_splitting_pill",weight:.2},{item:"abyss_stone",weight:.4},{item:"abyssal_essence",weight:.4}]},{id:"divine_transformation_realm",name:"",reqTier:"",recommendCP:8e7,cost:3e5,drops:["god_transformation_pill","divine_tribulation_stone","god_marrow"],risk:.8,desc:"",resourceLevel:"DIVINE",dropTable:[{item:"god_transformation_pill",weight:.2},{item:"divine_tribulation_stone",weight:.4},{item:"god_marrow",weight:.4}]},{id:"soul_refining_abyss",name:"",reqTier:"",recommendCP:16e7,cost:5e5,drops:["divine_soul_pill","divine_essence_core","soul_tempering_stone"],risk:.82,desc:"",resourceLevel:"DIVINE",dropTable:[{item:"divine_soul_pill",weight:.2},{item:"divine_essence_core",weight:.4},{item:"soul_tempering_stone",weight:.4}]},{id:"void_condensing_heaven",name:"",reqTier:"",recommendCP:32e7,cost:8e5,drops:["void_condensing_pill","void_manifold_crystal","condensed_void_essence"],risk:.85,desc:"",resourceLevel:"DIVINE",dropTable:[{item:"void_condensing_pill",weight:.15},{item:"void_manifold_crystal",weight:.42},{item:"condensed_void_essence",weight:.43}]},{id:"immortal_ascension_peak",name:"",reqTier:"",recommendCP:4e8,cost:15e5,drops:["heaven_defying_pill","celestial_ascension_token","immortal_transformation_essence"],risk:.9,desc:"",resourceLevel:"DIVINE",dropTable:[{item:"heaven_defying_pill",weight:.15},{item:"celestial_ascension_token",weight:.42},{item:"immortal_transformation_essence",weight:.43}]}],nu=e=>zn(e).total||0,vc=(e=[])=>e[Math.floor(Math.random()*e.length)],Ny=["","","","","","","","","","","","","","","","",""],Sw=["","","","","","","","","","","","","","","","","","","","","","","","","","","","","",""],ru={male:["","","","","","","","","","","","","","","","","","","",""],female:["","","","","","","","","","","","","","","","","","","",""],neutral:["","","","","","","","","","","","","","","","","","","",""]},ww=["","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","",""],kw=new Set(Ny);function Ew(){return vc(ww)}function Vm(e=""){const t=(e||"").replace(/\s+/g,"");if(!t)return"";const n=t.slice(0,2);return kw.has(n)?n:t.charAt(0)}const jw=()=>Math.random()<.15?vc(Ny):vc(Sw),Cw=(e="")=>{const t=e===""?ru.female:ru.male,n=[...ru.neutral,...t];return vc(n)};function Nf(e="",t={}){const{motherName:n="",fatherName:s="",preferSurname:o=""}=t,i=o||Vm(n)||Vm(s)||jw(),a=Cw(e);return`${i}${a}`}const Tw=[{base:"#FFDFC4",shadow:"#F0D5B1"},{base:"#F0D5B1",shadow:"#E0B87E"},{base:"#E0B87E",shadow:"#C59D74"},{base:"#A16E4B",shadow:"#815336"}],yp=["#2C2C2C","#5C3A21","#A88B45","#8D2323","#F2F2F2"],Iw=["#333333","#4A90E2","#50E3C2","#F5A623","#D0021B"],Rw=[{skinPixels:[[4,2],[5,2],[6,2],[7,2],[8,2],[9,2],[10,2],[11,2],[3,3],[4,3],[5,3],[6,3],[7,3],[8,3],[9,3],[10,3],[11,3],[12,3],[3,4],[4,4],[5,4],[6,4],[7,4],[8,4],[9,4],[10,4],[11,4],[12,4],[3,5],[4,5],[5,5],[6,5],[7,5],[8,5],[9,5],[10,5],[11,5],[12,5],[3,6],[4,6],[5,6],[6,6],[7,6],[8,6],[9,6],[10,6],[11,6],[12,6],[3,7],[4,7],[5,7],[6,7],[7,7],[8,7],[9,7],[10,7],[11,7],[12,7],[3,8],[4,8],[5,8],[6,8],[7,8],[8,8],[9,8],[10,8],[11,8],[12,8],[3,9],[4,9],[5,9],[6,9],[7,9],[8,9],[9,9],[10,9],[11,9],[12,9],[4,10],[5,10],[6,10],[7,10],[8,10],[9,10],[10,10],[11,10],[5,11],[6,11],[7,11],[8,11],[9,11],[10,11],[6,12],[7,12],[8,12],[9,12]],shadowPixels:[[3,4],[3,5],[3,6],[3,7],[3,8],[3,9],[12,4],[12,5],[12,6],[12,7],[12,8],[12,9],[4,10],[11,10],[5,11],[10,11],[6,12],[9,12],[7,9],[8,9]]}],_w=[{whitePixels:[[5,7],[6,7],[9,7],[10,7]],pupilPixels:[[6,7],[9,7]],browPixels:[[5,6],[6,6],[9,6],[10,6]]},{whitePixels:[[4,7],[5,7],[6,7],[9,7],[10,7],[11,7]],pupilPixels:[[5,7],[10,7]],browPixels:[[4,6],[5,6],[10,6],[11,6]]},{whitePixels:[[5,7],[6,7],[5,8],[9,7],[10,7],[10,8]],pupilPixels:[[6,7],[6,8],[9,7],[9,8]],browPixels:[[5,6],[6,6],[9,6],[10,6]]}],Mw=[[[6,11],[9,11],[7,12],[8,12]],[[6,11],[7,11],[8,11],[9,11]],[[7,11],[8,11],[9,11],[10,10]]],Aw=[[[6,0],[7,0],[8,0],[9,0],[5,1],[6,1],[7,1],[8,1],[9,1],[10,1],[4,2],[5,2],[6,2],[7,2],[8,2],[9,2],[10,2],[11,2],[3,3],[4,3],[11,3],[12,3],[3,4],[12,4],[2,5],[3,5],[12,5],[13,5],[2,6],[13,6],[2,7],[13,7],[1,8],[2,8],[13,8],[14,8],[7,3],[8,3],[7,4],[8,4]],[[5,1],[6,1],[7,1],[8,1],[9,1],[10,1],[4,2],[5,2],[6,2],[7,2],[8,2],[9,2],[10,2],[11,2],[3,3],[4,3],[5,3],[6,3],[7,3],[8,3],[9,3],[10,3],[11,3],[12,3],[2,4],[3,4],[4,4],[11,4],[12,4],[13,4],[2,5],[3,5],[12,5],[13,5],[1,6],[2,6],[3,6],[12,6],[13,6],[14,6],[1,7],[2,7],[13,7],[14,7],[1,8],[2,8],[13,8],[14,8],[2,9],[3,9],[12,9],[13,9],[2,10],[3,10],[12,10],[13,10]],[[6,0],[7,0],[8,0],[9,0],[5,1],[6,1],[9,1],[10,1],[6,2],[7,2],[8,2],[9,2],[5,3],[6,3],[7,3],[8,3],[9,3],[10,3],[4,4],[5,4],[10,4],[11,4],[4,5],[5,5],[10,5],[11,5],[3,6],[4,6],[11,6],[12,6],[7,1],[8,1]]],qe=e=>!e||e.length===0?null:e[Math.floor(Math.random()*e.length)],Nw={low:["{playerName}","{playerName}","{playerName}{gender_ta}","{playerName}"],medium:["{playerName}{gender_ta}","{playerName}","{playerName}","{playerName}{gender_ta}"],high:["{playerName}","{playerName}{gender_ta}","{playerName}","{playerName}{gender_ta}{gender_ta}..."]},Ym={:{low:["{playerName}","{playerName}...","{playerName}"],medium:["{playerName}{gender_ta}","{playerName}","{playerName}{gender_ta}"],high:["{playerName}{gender_ta}","{playerName}...","{playerName}"]},:{low:["{playerName}","{playerName}{gender_ta}","{playerName}{gender_ta}"],medium:["{playerName}{gender_ta}","{playerName}{gender_ta}","{playerName}"],high:["{playerName}{gender_ta}{gender_ta}","{playerName}","{playerName}{gender_ta}{gender_ta}"]},:{low:["{playerName}{gender_ta}...","{playerName}{gender_ta}","{playerName}"],medium:["{playerName}......","{playerName}{gender_ta}","{playerName}"],high:["{playerName}.........{gender_ta}...","{playerName}{gender_ta}","{playerName}{gender_ta}"]},:{low:["{playerName}...{gender_ta}","{playerName}{gender_ta}...","{playerName}...{gender_ta}"],medium:["{playerName}{gender_ta}...","{playerName}...","{playerName}{gender_ta}..."],high:["{playerName}...{gender_ta}{gender_ta}...","{playerName}{gender_ta}...","{playerName}..."]},:{low:["{playerName}","{playerName}","{playerName}{gender_ta}"],medium:["{playerName}{gender_ta}","{playerName}","{playerName}{gender_ta}"],high:["{playerName}","{playerName}{gender_ta}","{playerName}{gender_ta}"]},:{low:["{playerName}","{playerName}","{playerName}{gender_ta}"],medium:["{playerName}{gender_ta}","{playerName}","{playerName}{gender_ta}"],high:["{playerName}","{playerName}{gender_ta}","{playerName}...~"]},:{low:["{playerName}{gender_ta}","{playerName}{gender_ta}","{playerName}"],medium:["{playerName}{gender_ta}","{playerName}{gender_ta}","{playerName}{gender_ta}"],high:["{playerName}{gender_ta}","{playerName}{gender_ta}","{playerName}{gender_ta}"]},:{low:["{playerName}","{playerName}","{playerName}"],medium:["{playerName}{gender_ta}","{playerName}{gender_ta}","{playerName}{gender_ta}"],high:["{playerName}","{playerName}","{playerName}{gender_ta}"]}},Lw=["{playerName}{giftName}{gender_ta}","{playerName}{giftName}{gender_ta}","{playerName}{giftName}{gender_ta}","{giftName}{playerName}{gender_ta}"],qm={:["{playerName}{giftName}......{gender_ta}","{giftName}{playerName}","{playerName}{giftName}...{gender_ta}"],:["{playerName}{giftName}...{gender_ta}","{playerName}{giftName}{gender_ta}","{giftName}{playerName}..."],:["{playerName}{giftName}......","{giftName}...{playerName}","{playerName}{giftName}{gender_ta}"],:["{playerName}{giftName}...{gender_ta}...","{playerName}{giftName}{gender_ta}...","{giftName}...{playerName}{gender_ta}..."],:["{playerName}{giftName}","{playerName}{giftName}{gender_ta}","{giftName}{playerName}"],:["{playerName}{giftName}{gender_ta}","{giftName}{playerName}","{playerName}{giftName}"],:["{playerName}{giftName}{gender_ta}","{playerName}{giftName}{gender_ta}","{giftName}...{playerName}"],:["{playerName}{giftName}","{playerName}{giftName}","{giftName}...{playerName}"]},$w=["{playerName},{gender_ta},","{playerName},{gender_ta},,","{playerName},,",",{playerName}{gender_ta}"],Km={:["{playerName},","{playerName},,",",{playerName},"],:["{playerName},...{gender_ta},","{playerName},{gender_ta}","{playerName},{gender_ta}"],:["!{playerName}!!()","{playerName}~{gender_ta}!!()","~,{playerName}!{gender_ta}!"],:["{playerName}...{gender_ta},{gender_ta}...","{playerName}{gender_ta}?...{gender_ta},{gender_ta}...","{playerName},{gender_ta},..."],:["{playerName},!!","{playerName},!",",{playerName}!!"],:["!{playerName}!!!","!{playerName}!,{gender_ta}!","{playerName}!,!!"],:["{playerName},","{playerName},",",{playerName}"],:["{playerName},,","{playerName},,",",{playerName},,"]},Bw=["{playerName},...{gender_ta}!","{playerName},,...!{gender_ta},","{playerName},,{gender_ta}","{playerName},{gender_ta},..."],Qm={:["{playerName}...,","{playerName}...,","{playerName},,"],:["{playerName}...{gender_ta},","{playerName},,{gender_ta}","{playerName},{gender_ta}{gender_ta}..."],:["{playerName}...!()","{playerName}!!!!()","!!{playerName}!!"],:["{playerName}...{gender_ta}{gender_ta}...,{gender_ta}...","{playerName},{gender_ta}...{gender_ta}...","...{playerName},{gender_ta}......"],:["{playerName},{gender_ta}!","{playerName},!!",",{playerName},,{gender_ta}!"],:["!{playerName}!!{gender_ta}!","!{playerName}!!!!","{playerName}!{gender_ta}!!"],:["{playerName},,","{playerName},","!{playerName},!"],:["{playerName},,","{playerName},",",{playerName},"]},Ow=["{playerName},,{gender_ta}...",",{playerName},","{playerName},{gender_ta},",",{playerName},..."],Jm={:["{playerName},,{gender_ta}",",{playerName}...{gender_ta}","{playerName},{gender_ta},"],:["{playerName},...{gender_ta},",",{playerName},,...","{playerName},{gender_ta}..."],:["{playerName}!{gender_ta}!!","!,!{playerName}...()","{playerName}!{gender_ta}!...(){gender_ta}..."],:["{playerName}...,{gender_ta},...",",{playerName}......","{playerName},{gender_ta},......"],:["{playerName},,{gender_ta},",",{playerName},","{playerName},,"],:["!{playerName}!!","{playerName}!{gender_ta}!!","{playerName}!!!"],:["{playerName},,{gender_ta}",",{playerName},","{playerName},"],:["{playerName},,",",{playerName},","{playerName},,,"]},Pw=["{playerName}...","{playerName}...","...{playerName}","{playerName}...","{playerName}"],su={early:["...","","{playerName}","...''",""],mid:["...{playerName}","...","{playerName}","","","..."],late:["...","{playerName}","...","...","{playerName}","''..."]},zw=["...{childName}","{childName}","...{playerName}","{gender_ta}{childName}{playerName}","{childName}"],Dw=["{newTier}","{newTier}","{newTier}","{newTier}","{newTier}"],Xm={:["{newTier}","{newTier}","{newTier}"],:["{newTier}...{playerName}","{newTier}","{newTier}"],:["{newTier}","{newTier}...","{newTier}{playerName}"],:["{newTier}...{playerName}...","{newTier}{playerName}...","...{playerName}{gender_ta}..."],:["{newTier}","{newTier}","{newTier}"],:["{newTier}","{newTier}","{newTier}"],:["...{newTier}","{newTier}","{newTier}"],:["{newTier}","{newTier}","{newTier}"]},Fw=["...","","...","{targetTier}"],Zm={:["...","",""],:["...","...","..."],:["","...","......"],:["...{playerName}...","...{playerName}...","...{playerName}..."],:["","...",""],:["","~","......"],:["...","...",""],:["","",""]},Hw=["{spouseName}","{spouseName}{gender_ta}","{spouseName}","{spouseName}{gender_ta}"],Ww=["...","","...","","{playerName}..."],ou={:["''","","",""],:["{playerName}","","",""],:["","",""],:["","",""],:["","","...",""],:["...","","","..."],:["","","",""],:["","","",""],:["","","",""],:["","","","{gender_ta}"]},Uw={:["","","","''"],:["","","",""],:["","{playerName}...{gender_ta}","{playerName}{gender_ta}","{playerName}..."],:["{playerName}{gender_ta}...","{playerName}{gender_ta}{gender_ta}","{playerName}...","{playerName}...{gender_ta}"],:["","","",""],:["","...","","{gender_ta}"]},iu={stranger:["","","",""],crush:["{playerName}","{playerName}{gender_ta}","{playerName}...","{playerName}{gender_ta}{gender_ta}...","{playerName}{gender_ta}"],spouse:["{playerName}{gender_ta}...","{playerName}{gender_ta}","{playerName}","{playerName}{gender_ta}{gender_ta}"]},Gw=["","","",""],Vw=["","","...",""],Yw=["...","","",""],qw=["","","{gender_ta}",""],Kw=["","","",""],Lf=["","","","",""],eg={:["",""],:["",""],:["{playerName}{playerName}","",""],:["{playerName}","",""]},tg={:{low:["",""],medium:["","{gender_ta}"],high:["",""]},:{low:["",""],medium:["",""],high:["","{gender_ta}"]},:{low:["","",""],medium:["...","",""],high:["","",""]},:{low:["","",""],medium:["","",""],high:["","",""]}},ng={:["",""]},rg={:[""]},sg={:[""]},og={:[""],:["{playerName}",""],:["",""]},ig={:[""]},ag={:[""]},lg={:[""]},cg={:[""]};function Qw(e){if(!e)return null;const t=Object.keys(eg).find(n=>e.includes(n));return t?qe(eg[t]):null}function Jw(e,t){if(!e)return null;const n=Object.keys(tg).find(i=>e.includes(i));if(!n)return null;let s="low";t<30?s="low":t<70?s="medium":s="high";const o=tg[n][s];return o?qe(o):null}function Xw(e){if(!e)return null;const t=Object.keys(ng).find(n=>e.includes(n));return t?qe(ng[t]):null}function Zw(e){if(!e)return null;const t=Object.keys(rg).find(n=>e.includes(n));return t?qe(rg[t]):null}function ek(e){if(!e)return null;const t=Object.keys(sg).find(n=>e.includes(n));return t?qe(sg[t]):null}function tk(e){if(!e)return null;const t=Object.keys(og).find(n=>e.includes(n));return t?qe(og[t]):null}function nk(e){if(!e)return null;const t=Object.keys(ig).find(n=>e.includes(n));return t?qe(ig[t]):null}function rk(e){if(!e)return null;const t=Object.keys(ag).find(n=>e.includes(n));return t?qe(ag[t]):null}function sk(e){if(!e)return null;const t=Object.keys(lg).find(n=>e.includes(n));return t?qe(lg[t]):null}function ok(e){if(!e)return null;const t=Object.keys(cg).find(n=>e.includes(n));return t?qe(cg[t]):null}function ik(e,t=null){let n="low";if(e<30?n="low":e<70?n="medium":n="high",t&&Ym[t]){const s=Ym[t][n];if(s&&s.length>0)return qe(s)}return qe(Nw[n])}function ak(e=null){if(e&&qm[e]){const t=qm[e];if(t&&t.length>0)return qe(t)}return qe(Lw)}function lk(e=null){if(e&&Km[e]){const t=Km[e];if(t&&t.length>0)return qe(t)}return qe($w)}function ck(e=null){if(e&&Qm[e]){const t=Qm[e];if(t&&t.length>0)return qe(t)}return qe(Bw)}function dk(e=null){if(e&&Jm[e]){const t=Jm[e];if(t&&t.length>0)return qe(t)}return qe(Ow)}function uk(e=null){if(e&&Xm[e]){const t=Xm[e];if(t&&t.length>0)return qe(t)}return qe(Dw)}function pk(e=null){if(e&&Zm[e]){const t=Zm[e];if(t&&t.length>0)return qe(t)}return qe(Fw)}function fk(e){let t=ou[e];return t||(e.includes("")||e.includes(""))&&(t=ou.||ou.),!t||t.length===0?qe(Lf):qe(t)}function mk(e){const t=Uw[e];return qe(t||Lf)}function gk(e,t,n){return n?qe(iu.spouse):t<20?qe(iu.stranger):t>=80?qe(iu.crush):null}const dg={LOW:{:["{playerName}{targetName}...{playerName}{gender_ta}","{playerName}{targetName}...{gender_ta}{gender_ta}"],:["{playerName}{targetName}...{gender_ta}...","{targetName}{playerName}......"],:["{playerName}{targetName}","{playerName}{targetName}..."],:["{playerName}{targetName}...","{playerName}{targetName}...{gender_ta}"],:["{playerName}{targetName}",""],:["{targetName}{playerName}","{playerName}{targetName}"],:["{targetName}...","{targetName}..."],:["{playerName}{targetName}","{playerName}{targetName}"]},MEDIUM:{:["{playerName}{targetName}...{gender_ta}...","{playerName}{targetName}...","{targetName}...{playerName}{playerName}"],:["{playerName}{gender_ta}{targetName}","{playerName}{targetName}...","{playerName}...{gender_ta}"],:["{playerName}{targetName}...","{playerName}...{gender_ta}{targetName}"],:["{playerName}{targetName}...{gender_ta}...","{playerName}{targetName}...{playerName}","{playerName}{gender_ta}..."],:["{playerName}","{playerName}"],:["{playerName}{gender_ta}","{playerName}"],:["{targetName}''...","{targetName}...","..."],:["{playerName}{targetName}","{playerName}{gender_ta}..."]},HIGH:{:["...{playerName}{gender_ta}{targetName}.........","{targetName}{playerName}","...{targetName}{playerName}..."],:["{playerName}{gender_ta}.........","{playerName}{targetName}............","......{playerName}..."],:["{playerName}","{playerName}","..."],:["{playerName}{targetName}...{gender_ta}...","{playerName}......","......"],:["{playerName}{targetName}{gender_ta}","{playerName}{gender_ta}","{playerName}"],:["{playerName}{gender_ta}{gender_ta}","",""],:["...{targetName}.........","...","......"],:["{playerName}{targetName}{gender_ta}","{playerName}..."]},EXTREME:{:["{targetName}{playerName}...{playerName}......","{playerName}...{targetName}","{playerName}{gender_ta}..."],:["{playerName}{targetName}","{playerName}","{playerName}{gender_ta}{targetName}......{gender_ta}"],:["{playerName}{targetName}","{playerName}","{playerName}..."],:["{playerName}.........","{playerName}......","{playerName}{targetName}......{gender_ta}..."],:["{playerName}{gender_ta}{gender_ta}","{playerName}{gender_ta}"],:["{playerName}","{playerName}{targetName}{gender_ta}{gender_ta}"],:["......","...","{gender_ta}..."],:["{playerName}{targetName}","{playerName}"]}},ug={:["{playerName}{favoriteItem}{gender_ta}...","{playerName}{gender_ta}..."],:["{playerName}...{gender_ta}","{playerName}......{gender_ta}"],:["{playerName}...{gender_ta}","{playerName}..."],:["{playerName}{gender_ta}...","{playerName}{gender_ta}..."],:["...","{gender_ta}"],:["{playerName}{gender_ta}","{playerName}"]};class Ly{constructor(t=50){this.maxSize=t,this.cache=new Map}get(t){if(!this.cache.has(t))return null;const n=this.cache.get(t);return this.cache.delete(t),this.cache.set(t,n),n}set(t,n){if(this.cache.has(t)&&this.cache.delete(t),this.cache.set(t,n),this.cache.size>this.maxSize){const s=this.cache.keys().next().value;this.cache.delete(s)}}clear(){this.cache.clear()}has(t){return this.cache.has(t)}size(){return this.cache.size}}function hk(e,t={}){const{maxSize:n=100,keyGenerator:s=(...l)=>JSON.stringify(l),ttl:o=null}=t,i=new Ly(n),a=new Map;return function(...d){const u=s(...d);o&&a.has(u)&&Date.now()-a.get(u)>o&&(i.set(u,null),a.delete(u));const p=i.get(u);if(p!==null)return p;const c=e(...d);return i.set(u,c),o&&a.set(u,Date.now()),c}}class xk{constructor(){this.caches=new Map,this.stats={hits:0,misses:0,sets:0}}createCache(t,n=100){const s=new Ly(n);return this.caches.set(t,s),s}getCache(t){return this.caches.get(t)}get(t,n){const s=this.caches.get(t);if(!s)return this.stats.misses++,null;const o=s.get(n);return o!==null?this.stats.hits++:this.stats.misses++,o}set(t,n,s){const o=this.caches.get(t);if(!o){console.warn(` ${t} `);return}o.set(n,s),this.stats.sets++}clearCache(t){const n=this.caches.get(t);n&&n.clear()}clearAll(){this.caches.forEach(t=>t.clear()),this.stats={hits:0,misses:0,sets:0}}getStats(){const t=this.stats.hits+this.stats.misses>0?(this.stats.hits/(this.stats.hits+this.stats.misses)*100).toFixed(2):0;return{...this.stats,hitRate:`${t}%`,totalCaches:this.caches.size}}}const Ma=new xk;Ma.createCache("npcLifecycle",200);Ma.createCache("combatStats",200);Ma.createCache("cultivationProgress",100);Ma.createCache("monthlyLogs",50);Ma.createCache("sortedLists",20);const xt={INTERACTION:"INTERACTION",STATE_CHANGE:"STATE_CHANGE",DAILY:"DAILY"},yk=50;hk((e,t,n,s)=>null,{maxSize:200,ttl:6e4});function Nn(e,t,n,s,o=xt.DAILY,i=!1){if(!e)return e;const a=e.logs||[],u=[{year:t,month:n,content:s,type:o,isSecret:i,timestamp:Date.now()},...a].slice(0,yk);return{...e,logs:u}}function Ln(e,t,n,s={}){if(!e)return"";let o=e;o=o.replace(/{playerName}/g,(n==null?void 0:n.name)||""),o=o.replace(/{npcName}/g,(t==null?void 0:t.name)||"");const i=(n==null?void 0:n.gender)||"";return t!=null&&t.gender,o=o.replace(/{gender_ta}/g,i===""?"":""),o=o.replace(/{gender_Ta}/g,i===""?"":""),Object.keys(s).forEach(a=>{const l=new RegExp(`{${a}}`,"g");o=o.replace(l,s[a])}),o}function pg(e,t,n,s){const o=e.identity||"",i=Qw(o);let a="";return i?a=Ln(i,e,t):e.name===""?a=`${t.name}${t.gender===""?"":""}...`:e.name===""?a=`${t.name}`:a=`${t.name}${t.gender===""?"":""}`,Nn(e,n,s,a,xt.INTERACTION)}function fg(e,t,n,s){var p,c;const o=((p=e.relationship)==null?void 0:p.affection)||0,i=((c=e.personality)==null?void 0:c.label)||null,a=e.identity||"",d=Jw(a,o)||ik(o,i),u=Ln(d,e,t);return Nn(e,n,s,u,xt.INTERACTION)}function bk(e,t,n,s,o,i){var p;const a=((p=e.personality)==null?void 0:p.label)||null,l=e.identity||"";let d=null;d=Xw(l)||ak(a);const u=Ln(d,e,t,{giftName:o});return Nn(e,n,s,u,xt.INTERACTION)}function vk(e,t,n,s,o){var p;const i=((p=e.personality)==null?void 0:p.label)||null,a=e.identity||"",d=(o?Zw(a):ek(a))||(o?lk(i):ck(i)),u=Ln(d,e,t);return Nn(e,n,s,u,xt.INTERACTION)}function Sk(e,t,n,s){var u;const o=((u=e.personality)==null?void 0:u.label)||null,i=e.identity||"",l=tk(i)||dk(o),d=Ln(l,e,t);return Nn(e,n,s,d,xt.INTERACTION,!0)}function mg(e,t,n,s,o,i){var c,f;let a="LOW";if(i>=81)a="EXTREME";else if(i>=61)a="HIGH";else if(i>=41)a="MEDIUM";else if(i>=21)a="LOW";else return e;const l=typeof e.personality=="object"&&e.personality!==null&&"label"in e.personality?e.personality.label:Array.isArray(e.personality)?e.personality[0]:"",d=((c=dg[a])==null?void 0:c[l])||((f=dg[a])==null?void 0:f.);if(!d||d.length===0)return e;const u=qe(d),p=Ln(u,e,t,{targetName:(o==null?void 0:o.name)||""});return Nn(e,n,s,p,xt.DAILY,!0)}function wk(e,t,n,s){var u;const o=typeof e.personality=="object"&&e.personality!==null&&"label"in e.personality?e.personality.label:Array.isArray(e.personality)?e.personality[0]:"",i=ug[o]||ug.;if(!i||i.length===0)return e;const a=qe(i),l=((u=e.likes)==null?void 0:u[0])||"",d=Ln(a,e,t,{favoriteItem:l});return Nn(e,n,s,d,xt.DAILY,!0)}function kk(e,t,n,s){const o=qe(Pw),i=Ln(o,e,t);return Nn(e,n,s,i,xt.STATE_CHANGE,!0)}function Ek(e,t,n,s,o){let i;o<=3?i=su.early:o<=6?i=su.mid:i=su.late;const a=qe(i),l=Ln(a,e,t);return Nn(e,n,s,l,xt.STATE_CHANGE,!0)}function jk(e,t,n,s,o){const i=qe(zw),a=Ln(i,e,t,{childName:o});return Nn(e,n,s,a,xt.STATE_CHANGE,!0)}function bp(e,t,n,s,o,i){var c;const a=((c=e.personality)==null?void 0:c.label)||null,l=e.identity||"",u=(o?nk(l):rk(l))||(o?uk(a):pk(a)),p=Ln(u,e,t,{newTier:i||"",targetTier:i||""});return Nn(e,n,s,p,xt.STATE_CHANGE)}function gg(e,t,n,s,o){const i=e.identity||"",l=sk(i)||qe(Hw),d=o===(t==null?void 0:t.name),u=Ln(l,e,t,{spouseName:o||""});return Nn(e,n,s,u,xt.STATE_CHANGE,d)}function Ck(e,t,n,s){const o=e.identity||"",a=ok(o)||qe(Ww),l=Ln(a,e,t);return Nn(e,n,s,l,xt.STATE_CHANGE,!0)}function Tk(e,t,n,s){var w,S,h,g;if(!e)return e;if(e.isPregnant&&e.pregnancyProgress>0)return Ek(e,t,n,s,e.pregnancyProgress);const o=((w=e.relationship)==null?void 0:w.affection)||0,i=e.identity||"",a=((S=e.personality)==null?void 0:S.label)||"",l=((h=e.relationship)==null?void 0:h.stage)>=3,d={relationship:0,identity:20,personality:35,event:10,scenery:35};l?(d.relationship=60,d.scenery=10):o>=80?d.relationship=40:o>=50?d.relationship=20:o<20&&(d.relationship=0);const u=Math.random()*100;let p=0,c="scenery";for(const[v,j]of Object.entries(d))if(p+=j,u<=p){c=v;break}let f=null,x=!1;switch(c){case"relationship":f=gk((g=e.relationship)==null?void 0:g.stage,o,l),x=o>=80;break;case"identity":f=fk(i);break;case"personality":f=mk(a),x=a==="";break;case"event":f=qe(qe([Gw,Vw,Yw,qw,Kw]));break;case"scenery":default:f=qe(Lf);break}f||(f="");const C=Ln(f,e,t);return Nn(e,n,s,C,xt.DAILY,x)}function Ik(e,t,n,s){if(!e||!Array.isArray(e))return e;const o=e.length>50;return e.map(i=>{if(o&&i.logs&&i.logs.length>0&&i._lastLogMonth===s)return i;if(i._hasLogThisMonth){const{_hasLogThisMonth:l,...d}=i;return d}const a=Tk(i,t,n,s);return o&&(a._lastLogMonth=s),a})}function Vi(e){return{...e,_hasLogThisMonth:!0}}function Rk(e,t=0){return!e||!e.logs?[]:t<30?[]:e.logs.filter(n=>n.isSecret?t>=80:!0)}const _k={MORTAL:100,EXPONENTIAL_BASE:1.8},yr={WASTE:.8,FIVE:.95,FOUR:1,THREE:1.15,DOUBLE:1.35,SINGLE:1.6,MUTANT:1.75,HEAVEN:2},$y=(e=50)=>1+Math.max(-.5,(e-50)*.012),Wo={longevity_body:1.3,immortal_marrow:1.5,void_spirit_body:1.25,ancient_bloodline:1.2,cursed_body:.75,demonic_enhancement:.85,phoenix_reborn:1.1,common_body:1},vp={BASE_PROBABILITY:.01,DIFFICULTY_MULTIPLIER:{:10,:5,:4,:3.5,:2.5,:2,:1.8,:1.5,:1.2,:.8,:.6,:.5,:.4,:.3,:.25,:.2,:.15,:.1,:.08,:.06,:.04,:.02,:.015,:.01,:.008,:.006,:.004,:.002,:.0015,:.001,:5e-4,:3e-4,:1e-4},FACTORS:{aptitudeBonus:e=>1+Math.max(-.5,(e-50)*.015),spiritRootBonus:e=>({WASTE:.5,FIVE:.7,FOUR:.85,THREE:1,DOUBLE:1.2,SINGLE:1.5,MUTANT:1.8,HEAVEN:2.2})[e]||1,ageBonus:(e,t)=>{if(!t)return 1;const n=Math.abs(e-t);return n<=10?1+(10-n)*.05:Math.max(.3,1-(n-10)/20)},expProgress:(e,t)=>.5+Math.max(0,Math.min(1,e/t))*1.5,healthBonus:e=>.8+e*.004},LIFESPAN_GAIN_MULTIPLIER:.7};function Sc(e=0,t=1,n=1,s=1){const{MORTAL:o,EXPONENTIAL_BASE:i}=_k,a=Math.pow(i,e/5),d=o*a*t*n*s;return Math.floor(d)}function Mk(e,t=1){var d,u,p;const n=vp;let s=n.BASE_PROBABILITY/t;const o=n.FACTORS.aptitudeBonus(((d=e.stats)==null?void 0:d.aptitude)||50);s*=o;const i=n.FACTORS.spiritRootBonus(((u=e.spiritRoot)==null?void 0:u.id)||"FOUR");s*=i;const a=n.FACTORS.expProgress(e.currentExp||0,e.maxExp||100);s*=a;const l=n.FACTORS.healthBonus(((p=e.stats)==null?void 0:p.health)||50);return s*=l,Math.min(.5,s)}const Ak=Object.values(J).reduce((e,t)=>(e[t.key]=t.order,e),{}),Nk=["","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","",""],Lk=120,$k=20,Bk=5,Ok=8,Pk=50,Sp=(e="")=>An(e)?Qe.findIndex(n=>n.name===e):0,zk=(e="")=>{if(!e)return 0;const t=Nk.indexOf(e);return t>=0?t:0},wc=(e,t=$k)=>{var u,p,c;if(!e)return Lk+t;const n=Sp(e.tier||"");let s=yr.FOUR;(u=e.spiritRoot)!=null&&u.id&&(s={HEAVEN:yr.HEAVEN,MUTANT:yr.MUTANT,SINGLE:yr.SINGLE,DOUBLE:yr.DOUBLE,THREE:yr.THREE,FOUR:yr.FOUR,FIVE:yr.FIVE,WASTE:yr.WASTE}[e.spiritRoot.id]||yr.FOUR);const o=$y(((p=e.stats)==null?void 0:p.aptitude)||50);let i=Wo.common_body;(c=e.constitution)!=null&&c.key&&Wo[e.constitution.key]&&(i=Wo[e.constitution.key]);const a=Sc(n,s,o,i),l=e.age||18,d=Math.max(a,l+t);return Math.round(d)},By=(e,t)=>{if(!t)return 0;const n=Sp(e.name||""),s=Sp(t.name||""),o=Sc(n),a=Sc(s)-o,l=Math.pow(t.maxExp,.2),d=a*(1+l/1e3);return Math.round(Math.max(50,d))},Oy=e=>{if(!e)return e;const t=e.stats||{},n=wc(e);return t.lifespan&&t.lifespan>=n?e:{...e,stats:{...t,lifespan:n}}},Dk=["herb_bandage","beast_fang","beast_core","foundation_pill","thunder_wood","core_pill","artifact_supreme","dragon_heart_pill","marrow_wash","milk_millennium","nascent_fruit","starlight_pill","heaven_manual","god_transformation_pill","divine_soul_pill","void_condensing_pill","immortal_marrow_pill","heaven_defying_pill","void_refining_pill","space_law_pill","void_stabilization_pill","unity_pill","dao_comprehension_pill","harmony_pill","mahayana_pill","immortal_foundation_pill","semi_immortal_pill","tribulation_pill","ascension_pill"].map(e=>{const t=Vc[e];if(!t)return null;const n=Ak[t.resourceLevel]||1,s=n>=5?80:55;return{itemId:e,affectionRequirement:s+n*5,tierRequirement:Math.max(0,n-1),rarity:t.rarity,resourceOrder:n}}).filter(Boolean);function Dr(e){if(!e||!e.stats)return 0;const t=e.stats.lifespan||100,n=e.age||18,s=t-n;return Math.max(0,s)}function Fk(e,t,n,s){if(!e)return e;const o=(e.age||18)+1;let i=Oy({...e,age:o});const a=Dr(i);return a<=0?i={...i,isDead:!0,deathReason:""}:a<10&&!e._nearDeathLogged&&(i=Ck(i,t,n,s),i._nearDeathLogged=!0),i}function Hk(e,t,n,s){var S,h,g,v;if(!e||e.isDead)return{npc:e,events:[]};const o=[];let i={...e};i.currentExp||(i.currentExp=0),i.tier||(i.tier="");const a=An(i.tier);if(!a)return{npc:i,events:o};let l=10;const u=.5+(((S=i.stats)==null?void 0:S.aptitude)||50)/100*2.5;l*=u;const c=.6+(((h=i.stats)==null?void 0:h.intelligence)||50)/100*1.4;l*=c;const f=Qe.findIndex(j=>j.name===i.tier);if(f>=0&&Qe.length>0){const j=1+f/Qe.length*1.5;l*=j}const x=((g=i.spiritRoot)==null?void 0:g.multiplier)||.5;l*=x,i.sect&&i.sect.level!=="NONE"&&i.sectStatus==="active"&&(l*=1.5);const C=((v=i.relationship)==null?void 0:v.affection)||0;C>=20&&(C<40?l*=1.1:C<60?l*=1.2:C<80?l*=1.3:l*=1.5),l=Math.max(2,l);const w=Math.floor(l);if(i.currentExp=(i.currentExp||0)+w,i.combatStats=Cn(i),i.cultivationSpeed=l,i.currentExp>=a.maxExp){const j=Wk(i,t,n,s);if(i=j.npc,o.push(...j.events),i.currentExp>=a.maxExp){const R=Py(i,t,n,s);i=R.npc,o.push(...R.events)}}return{npc:i,events:o}}function Py(e,t,n,s){var f,x;const o=[];let i={...e};const a=An(i.tier),l=Mf(i.tier);if(!a||!l)return{npc:i,events:o};const d=((f=i.stats)==null?void 0:f.aptitude)||50,u=((x=i.spiritRoot)==null?void 0:x.multiplier)||.5;let p=a.chance||.3;if(p+=d/10*.03,p+=u*.2,p=Math.max(.05,Math.min(.95,p)),Math.random()<p){if(i.tier=l.name,i.tierTitle=l.name,i.currentExp=0,i.maxExp=l.maxExp,i.stats){const C=By(a,l);i.stats={...i.stats,lifespan:(i.stats.lifespan||100)+C},i._lastBreakthroughLifespanGain=C,i._lastBreakthroughType="normal"}if(i.combatStats){const C=Math.floor(i.combatStats.maxHp*.5),w=Math.floor(i.combatStats.atk*.3),S=Math.floor((i.combatStats.def||0)*.2);i.combatStats={...i.combatStats,maxHp:i.combatStats.maxHp+C,hp:i.combatStats.maxHp+C,atk:i.combatStats.atk+w,def:(i.combatStats.def||0)+S}}i=bp(i,t,n,s,!0,l.name),o.push({type:"NPC_BREAKTHROUGH",npcName:i.name,newTier:l.name,message:`${i.name}  ${l.name} ${i._lastBreakthroughLifespanGain||0} `})}else i.currentExp=0,i=bp(i,t,n,s,!1,l.name),o.push({type:"NPC_BREAKTHROUGH_FAIL",npcName:i.name,tier:i.tier,message:`${i.name} `});return{npc:i,events:o}}function Wk(e,t,n,s){const o=[];let i={...e};if(!i.tier||!i.stats)return{npc:i,events:o};const a=i.currentExp/(i.maxExp||100);if(a<.75||a>=1)return{npc:i,events:o};const l=An(i.tier),d=vp.DIFFICULTY_MULTIPLIER[i.tier]||1,u=Mk(i,d);if(Math.random()<u){const c=Mf(i.tier);if(!c)return{npc:i,events:o};if(i.tier=c.name,i.tierTitle=c.name,i.currentExp=0,i.maxExp=c.maxExp,i.stats){const x=By(l,c),C=Math.floor(x*vp.LIFESPAN_GAIN_MULTIPLIER);i.stats={...i.stats,lifespan:(i.stats.lifespan||100)+C},i._lastBreakthroughLifespanGain=C,i._lastBreakthroughType="natural"}if(i.combatStats){const x=Math.floor(i.combatStats.maxHp*.4),C=Math.floor(i.combatStats.atk*.25);i.combatStats={...i.combatStats,maxHp:i.combatStats.maxHp+x,hp:i.combatStats.maxHp+x,atk:i.combatStats.atk+C}}i=bp(i,t,n,s,!0,c.name);const f=i._lastBreakthroughLifespanGain||0;o.push({type:"NPC_NATURAL_BREAKTHROUGH",npcName:i.name,newTier:c.name,message:`${i.name}  ${c.name} ${f} `})}return{npc:i,events:o}}function Uk(e,t,n,s){if(!e||!Array.isArray(e))return{npcs:e||[],events:[]};const o=[],i=s===1;return{npcs:e.map(l=>{var d,u,p;try{let c=Oy(l);if(c.isDead)return c;if(i&&(c=Fk(c,t,n,s),c.isDead))return o.push({type:"NPC_DEATH",npcName:c.name,reason:c.deathReason,message:`${c.name} ${c.deathReason}`}),c;if(!c.isDead){const x=Dr(c);(((d=c.relationship)==null?void 0:d.affection)||0)>=Pk&&x>0&&x<=Bk&&!c._lifespanAlerted?(c={...c,_lifespanAlerted:!0},o.push({type:"NPC_LIFESPAN_ALERT",npcId:c.id,npcName:c.name,remainingYears:x})):c._lifespanAlerted&&x>Ok&&(c={...c,_lifespanAlerted:!1})}if(s%6===0){const x=((u=c.relationship)==null?void 0:u.affection)||0,C=((p=c.relationship)==null?void 0:p.stage)||0;if(x>=60&&C>=1&&Math.random()<.2){const w=Gk(c,t);w&&o.push(w)}}const f=Hk(c,t,n,s);return c=(f==null?void 0:f.npc)||c,f!=null&&f.events&&Array.isArray(f.events)&&o.push(...f.events),c}catch(c){return console.error("Error processing NPC lifecycle for:",l==null?void 0:l.name,c),l}}),events:o}}const Qn={HOSTILE:"HOSTILE",NEUTRAL:"NEUTRAL",FRIENDLY:"FRIENDLY",INTIMATE:"INTIMATE"};function Gk(e,t){var f,x,C;const n=((f=e.relationship)==null?void 0:f.affection)||0,s=e.tier||"",o=zk(s);if((((x=e.relationship)==null?void 0:x.stage)||0)<1)return null;const a=Dk.filter(w=>{const S=n>=w.affectionRequirement,h=o>=w.tierRequirement;return S&&h});if(!a.length)return null;const l=a.map(w=>({option:w,weight:Math.max(1,8-w.resourceOrder*2)})),d=l.reduce((w,S)=>w+S.weight,0);if(d===0||!l.length)return null;let u=Math.random()*d,p=(C=l[0])==null?void 0:C.option;if(!p)return null;for(const{option:w,weight:S}of l)if(u-=S,u<=0){p=w;break}if(!p||!p.itemId)return null;const c=[`${e.name}""`,`${e.name}`,`${e.name}""`,`${e.name}Ta`];return{type:"NPC_GIFT",npcName:e.name,npcId:e.id,giftItemId:p.itemId,message:c[Math.floor(Math.random()*c.length)]}}function zy(e=0){return e<0?Qn.HOSTILE:e<50?Qn.NEUTRAL:e<80?Qn.FRIENDLY:Qn.INTIMATE}function Vk(e){const t={[Qn.HOSTILE]:{text:"",color:"#f44336",icon:""},[Qn.NEUTRAL]:{text:"",color:"#9e9e9e",icon:""},[Qn.FRIENDLY]:{text:"",color:"#4caf50",icon:""},[Qn.INTIMATE]:{text:"",color:"#e91e63",icon:""}};return t[e]||t[Qn.NEUTRAL]}function au(e,t){var o;const n=((o=e.relationship)==null?void 0:o.affection)||0,s=zy(n);switch(t){case"DUAL_CULTIVATION":if(s!==Qn.INTIMATE)return{allowed:!1,reason:" >= 80"};if(e.identity===""&&(e.dualCultivationCount||0)===0)return{allowed:!0,requiresCheck:!0,checkRate:.05};break;case"GIFT":if(s===Qn.HOSTILE)return{allowed:!1,reason:""};break;case"SPAR":if(s===Qn.HOSTILE)return{allowed:!1,reason:""};break}return{allowed:!0}}const Yk=["","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","",""],qk=["","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","",""],hg=["","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","",""],xg=["","","","","","","","","","","","","","","","","","","",""],yg=[{label:"",baseApt:20,desc:""},{label:"",baseApt:40,desc:""},{label:"",baseApt:80,desc:""},{label:"",baseApt:75,desc:""},{label:"",baseApt:70,desc:""},{label:"",baseApt:65,desc:""},{label:"",baseApt:60,desc:""},{label:"",baseApt:70,desc:""},{label:"",baseApt:70,desc:""},{label:"",baseApt:75,desc:""},{label:"",baseApt:65,desc:""},{label:"",baseApt:10,desc:""},{label:"",baseApt:80,desc:""},{label:"",baseApt:85,desc:""},{label:"",baseApt:70,desc:""},{label:"",baseApt:65,desc:""},{label:"",baseApt:60,desc:""},{label:"",baseApt:65,desc:""},{label:"",baseApt:55,desc:""}],bg=[{label:"",tag:"",desc:""},{label:"",tag:"",desc:""},{label:"",tag:"",desc:""},{label:"",tag:"",desc:""},{label:"",tag:"",desc:""},{label:"",tag:"",desc:""},{label:"",tag:"",desc:""},{label:"",tag:"",desc:""},{label:"",tag:"",desc:""},{label:"",tag:"",desc:""},{label:"",tag:"",desc:""},{label:"",tag:"",desc:""},{label:"",tag:"",desc:""},{label:"",tag:"",desc:""},{label:"",tag:"",desc:""},{label:"",tag:"",desc:""},{label:"",tag:"",desc:""}],Kk=e=>{const{stats:t,spiritRoot:n,identity:s}=e,o=(t==null?void 0:t.aptitude)||50,i=(n==null?void 0:n.elements)||[];let l={:["SWORD","HEAVEN_EMPEROR","THUNDER"],:["SWORD"],:["DAN"],:["NINE_STAR"],:["NINE_STAR","FLOWER"],:null,:["DEMON"],:["BLOOD"],:["DEMON","GHOST"],:["GHOST"],:["STONE"],:["GRASS"],:["GHOST","BLOOD"],:["FLOWER"],:null,:null,:"NONE",:Math.random()<.3?"random":"NONE",:"random",:null}[s.label];if(l==="random"&&(l=Er.filter(f=>!(f.id==="NONE"||o<f.minApt||f.prefElements&&f.prefElements.length>0&&!i.some(C=>f.prefElements.includes(C))&&o<f.minApt+10)).map(f=>f.id),l.length===0&&(l="NONE")),l===null)return{sect:null,sectId:null,rank:null,status:"mysterious"};if(l==="NONE")return{sect:Er.find(f=>f.id==="NONE"),sectId:"NONE",rank:"",status:"rogue"};const d=Array.isArray(l)?l[Math.floor(Math.random()*l.length)]:l,u=Er.find(f=>f.id===d);if(!u)return{sect:Er.find(f=>f.id==="NONE"),sectId:"NONE",rank:"",status:"rogue"};const p=sa(e,u);let c="active";return Math.random()<.1?c="defected":Math.random()<.05&&(u.level==="RECKLESS"||s.label.includes(""))&&(c="hidden"),{sect:u,sectId:u.id,rank:p,status:c}},Qk=()=>({base:Math.floor(Math.random()*Rw.length),skinColor:Math.floor(Math.random()*Tw.length),eye:Math.floor(Math.random()*_w.length),eyeColor:Math.floor(Math.random()*Iw.length),mouth:Math.floor(Math.random()*Mw.length),hair:Math.floor(Math.random()*Aw.length),hairColor:Math.floor(Math.random()*yp.length)}),wp=(e,t="")=>{const n=Date.now()+Math.random().toString().slice(2,6),s=Vo(),o=s.tier||e||"",i=Qe.find(K=>K.name===o)||Qe[1],a=s.maxExp??i.maxExp,l=Math.min(s.currentExp??0,a),d=18+Math.floor(Math.random()*100),p=Math.random()<.15?xg[Math.floor(Math.random()*xg.length)]:hg[Math.floor(Math.random()*hg.length)],c=t===""?qk:Yk,f=c[Math.floor(Math.random()*c.length)];let x=Math.floor(Math.random()*80)+10;Math.random()<.05&&(x=90+Math.floor(Math.random()*10));let C={aptitude:x,looks:50+Math.floor(Math.random()*50),intelligence:40+Math.floor(Math.random()*60),health:80};const w=B2();C=If(C,w);const S=Qk();let h="";S.eye===1&&(h=""),S.eye===2&&(h="");const g=`${S.skin===0?"":""}${h}`,v=oi(x,{constitution:w}),R=Cn({tier:o,currentExp:l,maxExp:a,stats:C,spiritRoot:v,equipment:null}),b=yg[Math.floor(Math.random()*yg.length)],I=Kk({stats:C,spiritRoot:v,identity:b});let k=b.desc;I.status==="mysterious"?k+=" ":I.status==="rogue"?k+=" ":I.status==="defected"?k+=` ${I.sect.name}${I.rank}`:I.status==="hidden"?k+=` ${I.rank}`:I.status==="active"&&I.sect&&(k+=` ${I.sect.name}${I.rank}`);const N=wc({age:d,stats:C,tier:o,spiritRoot:v});return C={...C,lifespan:N},{id:n,name:p+f,gender:t,age:d,identity:b.label,desc:k,avatar:S,appearance:g,tier:o,currentExp:l,maxExp:a,stats:C,constitution:w,spiritRoot:v,cultivationMethod:"basic_breath",combatStats:R,personality:bg[Math.floor(Math.random()*bg.length)],sect:I.sect,sectId:I.sectId,sectRank:I.rank,sectStatus:I.status,relationship:{stage:0,affection:0,trust:0,jealousy:0},acceptsLetters:!0,isPregnant:!1}};function $f(e,t){if(!e)return e;const n={...e,stats:{...e.stats||{},aptitude:t}};try{if(n.isTested||n.spiritRoot&&Array.isArray(n.spiritRoot.elements)){const s=ir(t,n.spiritRoot,null,{constitution:n.constitution});n.spiritRoot=s}}catch{}return n}function Jk(e,t){return $f(e,t)}const Xk=e=>{const t=e.reduce((s,o)=>s+(o.weight||1),0);let n=Math.random()*t;for(const s of e)if(n-=s.weight||1,n<=0)return s;return e[e.length-1]},Zk=[ht.PLAYER,ht.CHILD],eE={YELLOW:"common",BLACK:"uncommon",EARTH:"rare",HEAVEN:"epic",DIVINE:"legendary"},tE={YELLOW:J.MORTAL.key,BLACK:J.SPIRIT.key,EARTH:J.EARTH.key,HEAVEN:J.HEAVEN.key,DIVINE:J.DIVINE.key},nE={basic:["YELLOW","BLACK"],advanced:["EARTH"],apex:["HEAVEN","DIVINE"]},vg={[J.MORTAL.key]:1,[J.SPIRIT.key]:2,[J.EARTH.key]:3,[J.HEAVEN.key]:4,[J.DIVINE.key]:5},rE=(e,t)=>{const n=vg[t]||1;return e.filter(s=>{const o=fs(s);return o?(vg[o.resourceLevel]||1)<=n:!0})},sE=(e=["YELLOW"],t)=>{var i,a;let n=Object.values(L2).filter(l=>e.includes(l.tier));if(!n.length)return null;const s=((a=(i=t==null?void 0:t.player)==null?void 0:i.spiritRoot)==null?void 0:a.elements)||[],o=n.filter(l=>s.includes(l.element));return o.length&&(n=o),n[Math.floor(Math.random()*n.length)]},oE=e=>{const t=vn[e];if(!t)return null;const n=Yc[t.tier]||{};return{id:`manual_scroll_${e}`,name:`${t.name}`,type:"manual",rarity:eE[t.tier]||"rare",tier:n.name||t.tier,tierColor:n.color,element:t.element,baseBonus:`${Math.round((n.baseBuff||0)*100)}%`,desc:t.desc,manualIds:[e],resourceCategory:"MANUAL",resourceLevel:t.resourceLevel||tE[t.tier]||J.MORTAL.key,manualSchool:t.school,usageTargets:Zk,tags:[t.element||"",t.tier]}},Sg=(e,t)=>{const n=nE[e]||["YELLOW"],s=sE(n,t);if(!s)return null;const o=s.manualIds[Math.floor(Math.random()*s.manualIds.length)];return oE(o)},wg=(e,t)=>{const n=Bf(e);if(!n)return Sg("basic",t);const s=n.resourceLevel||"MORTAL";let o="basic";return s==="DIVINE"?o="apex":s==="HEAVEN"?o=Math.random()<.8?"advanced":"apex":s==="EARTH"&&(o=Math.random()<.6?"basic":"advanced"),Sg(o,t)},Bf=e=>Ay.find(t=>t.id===e),iE=(e,t=1)=>{const n=Bf(e)||{recommendCP:300,drops:["herb_bandage"],resourceLevel:"MORTAL"},s=n.recommendCP||300,o=t>=10,i=o?1.5:.6+t*.06,a=Math.floor(s*i),l=o?"":"",d=o?.02:.012,u=rE(n.drops||["herb_bandage"],n.resourceLevel||"MORTAL");return{name:l,combatStats:{hp:Math.floor(a*.3),atk:Math.floor(a*d),def:Math.floor(a*.0073),mp:0,maxHp:Math.floor(a*.3),maxMp:0},drops:u.length>0?u:["herb_bandage"],isBoss:o}},aE=(e,t)=>!!(e!=null&&e.find(n=>n.id===t)),lE=[{id:"combat_beast",kind:"COMBAT",realm:"ANY",weight:3,title:"",desc:"",options:[{label:"",action:e=>({type:"START_COMBAT"})},{label:"",action:()=>({type:"LOG",msg:""})}]},{id:"loot_array",kind:"LOOT",realm:"ANY",weight:2,title:"",desc:"",options:[{label:" ()",action:e=>{var n,s;return(((s=(n=e.player)==null?void 0:n.combatStats)==null?void 0:s.atk)||10)>80?{type:"LOOT",items:["beast_core"],msg:""}:{type:"HP_CHANGE",hpDelta:-150,msg:""}}},{label:" ()",action:e=>{var n,s;return(((s=(n=e.player)==null?void 0:n.stats)==null?void 0:s.intelligence)||40)>=70?{type:"LOOT",items:["foundation_pill"],msg:""}:{type:"LOG",msg:""}}}]},{id:"encounter_injured",kind:"ENCOUNTER",realm:"ANY",weight:1,title:"",desc:"",options:[{label:" (-1 )",condition:e=>aE(e.inventory,"herb_bandage"),action:e=>{let t=wp("");try{t=$f(t,Math.max(t.stats.aptitude||0,90))}catch{t.stats.aptitude=Math.max(t.stats.aptitude||0,90)}return{type:"NPC_JOIN",npc:t,removeItemId:"herb_bandage",msg:""}}},{label:"",action:()=>({type:"LOOT",items:["spirit_stones_500"],msg:""})},{label:"",action:()=>({type:"LOG",msg:""})}]},{id:"fruit_unknown",kind:"LOOT",realm:"ANY",weight:1,title:"",desc:"",options:[{label:"",action:()=>{const e=Math.random();return e<.4?{type:"EXP_GAIN",amount:1200,msg:""}:e<.8?{type:"HP_CHANGE",hpDelta:-120,msg:""}:{type:"LOG",msg:""}}},{label:"",action:()=>({type:"LOG",msg:""})}]},{id:"story_two_beasts",kind:"STORY",realm:"ANY",weight:1,title:"",desc:"",options:[{label:"",action:()=>({type:"LOOT",items:["beast_fang"],msg:""})},{label:"",action:()=>({type:"LOG",msg:""})}]},{id:"manual_cave",kind:"LOOT",realm:"ANY",weight:1,title:"",desc:"",options:[{label:"",action:e=>{const t=wg(e.realmId,e);return t?{type:"LOOT",items:[t],msg:""}:{type:"LOG",msg:""}}},{label:"",action:()=>({type:"LOG",msg:""})}]},{id:"fortune_telling",kind:"ENCOUNTER",realm:"ANY",weight:1,title:"",desc:'""',options:[{label:" (100)",condition:e=>{var t,n;return(((n=(t=e.player)==null?void 0:t.resources)==null?void 0:n.spiritStones)||0)>=100},action:e=>{const t=[{type:"EXP_GAIN",amount:2e3,msg:""},{type:"LOG",msg:""},{type:"LOG",msg:""},{type:"LOOT",items:["spirit_stones_200"],msg:""}];return{...t[Math.floor(Math.random()*t.length)],spiritStonesDelta:-100}}},{label:"",action:()=>({type:"LOG",msg:'""'})}]},{id:"spirit_fruit_grove",kind:"LOOT",realm:"ANY",weight:1,title:"",desc:"",options:[{label:"",action:()=>{const e=[{items:["spirit_stones_300"],msg:""},{items:["foundation_pill"],msg:""},{type:"EXP_GAIN",amount:1500,msg:""}],t=e[Math.floor(Math.random()*e.length)];return{type:t.type||"LOOT",...t}}},{label:"",action:()=>({type:"LOG",msg:""})}]},{id:"ancient_script",kind:"LOOT",realm:"ANY",weight:1,title:"",desc:"",options:[{label:"",action:e=>{var s,o;const t=((o=(s=e.player)==null?void 0:s.stats)==null?void 0:o.intelligence)||40,n=[40,60,80][Math.floor(Math.random()*3)];return t>=n?{type:"LOOT",items:["wisdom_pill"],msg:""}:{type:"HP_CHANGE",hpDelta:-80,msg:""}}},{label:"",action:()=>({type:"LOG",msg:""})}]},{id:"spirit_pool",kind:"LOOT",realm:"ANY",weight:1,title:"",desc:"",options:[{label:"",action:()=>{const e=[{type:"EXP_GAIN",amount:3e3,msg:""},{type:"LOOT",items:["primordial_spirit_pill"],msg:""},{type:"LOG",msg:""}];return e[Math.floor(Math.random()*e.length)]}},{label:"",action:()=>({type:"LOG",msg:""})}]},{id:"treasure_chest",kind:"LOOT",realm:"ANY",weight:.8,title:"",desc:"",options:[{label:"",action:e=>{var n,s;const t=((s=(n=e.player)==null?void 0:n.combatStats)==null?void 0:s.atk)||30;return t>100?{type:"LOOT",items:["cosmic_crystal","spirit_stones_500"],msg:""}:t>50?{type:"LOOT",items:["spirit_stones_300"],msg:""}:{type:"HP_CHANGE",hpDelta:-50,msg:""}}},{label:"",action:()=>({type:"LOOT",items:["spirit_stones_200"],msg:""})},{label:"",action:()=>({type:"LOG",msg:""})}]},{id:"meditation_spot",kind:"ENCOUNTER",realm:"ANY",weight:1,title:"",desc:"",options:[{label:"",action:()=>{const e=[{type:"EXP_GAIN",amount:2500,msg:""},{type:"LOOT",items:["awakening_pill"],msg:""},{type:"LOG",msg:""}];return e[Math.floor(Math.random()*e.length)]}},{label:"",action:()=>({type:"LOG",msg:""})}]},{id:"rival_encounter",kind:"ENCOUNTER",realm:"ANY",weight:.8,title:"",desc:"",options:[{label:"",action:()=>({type:"LOG",msg:Math.random()<.5?" ":" "})},{label:"",action:()=>({type:"LOG",msg:""})},{label:"",action:()=>({type:"LOOT",items:["spirit_stones_250"],msg:""})}]},{id:"demonic_lair",kind:"ENCOUNTER",realm:"ANY",weight:.5,title:"",desc:"",options:[{label:"",action:e=>{const t=Math.random();return t<.3?{type:"LOOT",items:["void_silk"],msg:""}:t<.6?{type:"HP_CHANGE",hpDelta:-150,msg:""}:{type:"LOG",msg:""}}},{label:"",action:()=>({type:"LOG",msg:""})}]},{id:"celestial_lake",kind:"ENCOUNTER",realm:"ANY",weight:1,title:"",desc:"",options:[{label:"",action:()=>{const e=[{type:"LOOT",items:["spirit_stones_400"],msg:""},{type:"EXP_GAIN",amount:1e3,msg:""},{type:"LOG",msg:""}];return e[Math.floor(Math.random()*e.length)]}},{label:"",action:()=>({type:"LOG",msg:""})}]},{id:"manual_library",kind:"LOOT",realm:"ANY",weight:1,title:"",desc:"",options:[{label:"",action:e=>{const t=wg(e.realmId,e);return t?{type:"LOOT",items:[t],msg:""}:{type:"LOG",msg:""}}},{label:"",action:()=>({type:"LOG",msg:""})}]}],cE=e=>{const t=Bf(e),n=t!=null&&t.name?`${t.name}  `:"";return{id:"boss_guard",kind:"BOSS",realm:e,weight:1,title:n,desc:"",options:[{label:"",action:()=>({type:"START_COMBAT"})},{label:"",action:()=>({type:"LOG",msg:""})}]}},kg=e=>{const{realmId:t,progress:n}=e,o=lE.filter(i=>i.realm==="ANY"||i.realm===t).map(i=>{let a=i.weight||1;return n<=3&&(i.kind==="LOOT"||i.kind==="ENCOUNTER")&&(a*=1.5),n>=7&&i.kind==="COMBAT"&&(a*=1.5),{...i,weight:a}});return Xk(o)},dE=e=>{const t=V2(e);if(!t)return null;const n=fs(t);if(!n)return null;const s=typeof n.name=="string"?n.name:"";return{giftItemId:t,giftName:s}},yo=(e,t)=>Math.random()>.5?e:t,uE=(e={},t=null)=>{const s=$y(e.aptitude||50);let o=Wo.common_body;t!=null&&t.key&&Wo[t.key]&&(o=Wo[t.key]);const a=Sc(0,1,s,o);return Math.floor(a)},oi=(e,t={})=>{const n=_f(e);let s=[],o=n.name,i=n.desc;if(n.id==="NONE")s=[];else if(n.id==="MUTANT"||n.id==="MUTANT_HEAVEN")s=[Wm[Math.floor(Math.random()*Wm.length)]];else{const l=[...q2];for(let d=l.length-1;d>0;d--){const u=Math.floor(Math.random()*(d+1));[l[d],l[u]]=[l[u],l[d]]}s=l.slice(0,n.elementCount)}const a=F2(t.constitution);if(a&&a.length>0){const l=a[Math.floor(Math.random()*a.length)];if(n.id==="MUTANT")s=[l];else if(s.length>0){const d=s.indexOf(l);d!==-1&&s.splice(d,1),s.unshift(l)}else s=[l]}return{type:o,elements:s,desc:i,color:n.color,multiplier:n.multiplier}},ir=(e,t,n,s={})=>oi(e,s),kp=e=>{if(!e)return{recommended:[],others:[]};const t=Er.map(l=>({sect:l,score:Ey(e,l),admission:jy(e,l)})),n=[...t].sort((l,d)=>d.score-l.score),s=[];if(n.forEach(l=>{l.sect.id!=="NONE"&&(s.length>=3||l.admission.qualified&&s.push(l))}),s.length<3&&n.forEach(l=>{l.sect.id!=="NONE"&&(s.includes(l)||s.length<3&&s.push(l))}),s.length===0&&n.length){const l=n.find(d=>d.sect.id!=="NONE")||n[0];l&&s.push(l)}const o=l=>({sect:l.sect,predictedRank:l.admission.qualified?sa(e,l.sect):null,resources:Z2(l.sect),compatibility:l.score,admission:l.admission}),i=s.map(o),a=t.filter(l=>!s.includes(l)).sort((l,d)=>d.score-l.score).map(o);return{recommended:i,others:a}},pE=(e,t,n)=>{var _,I,k,T,N;const s={base:0,skinColor:0,eye:2,eyeColor:0,mouth:0,hairColor:0},o=(e==null?void 0:e.avatar)||s,i=(t==null?void 0:t.avatar)||s,a=Math.random()>.5?"":"",l={base:yo(o.base,i.base),skinColor:yo(o.skinColor,i.skinColor),eye:yo(o.eye,i.eye),eyeColor:yo(o.eyeColor,i.eyeColor),mouth:yo(o.mouth,i.mouth),hair:Math.floor(a===""?Math.random()*2:Math.random()*4),hairColor:yo(o.hairColor,i.hairColor)};let d=((((_=e.stats)==null?void 0:_.aptitude)||50)+(((I=t.stats)==null?void 0:I.aptitude)||50))/2,u=Math.floor(Math.random()*31)-15;Math.random()<.05&&(u+=Math.random()>.5?20:-20),t.constitution&&(u+=5);const p=((k=e.spiritRoot)==null?void 0:k.type)==="",c=((T=t.spiritRoot)==null?void 0:T.type)==="";(p&&Math.random()<.2||c&&Math.random()<.2)&&(u+=30);const f=Math.max(1,Math.min(100,Math.floor(d+u))),x=Math.floor((e.stats.looks+t.stats.looks)/2+(Math.random()*10-5));let C=null;const w=Math.random(),S=e.constitution&&e.constitution.name,h=t.constitution&&t.constitution.name,g=((N=t.customFlags)==null?void 0:N.isFumoLegend)||t.identity===""||t.identity==="";if(S&&h){if(w<.8){const K=Math.random()>.5?t.constitution:e.constitution;C=Wl(K)}}else h?w<(g?1:.6)&&(C=Wl(t.constitution)):S&&w<.6&&(C=Wl(e.constitution));!C&&Math.random()<.01&&(C=wy("innate_dao")||{name:"",desc:"",rarity:"UR"});const v={weapon:null,armor:null,accessory:null};let j={aptitude:f,looks:x,intelligence:Math.floor((e.stats.cunning+t.stats.intelligence)/2)};j=If(j,C);const R=ei("",j.aptitude,null,v),b=Nf(a,{motherName:e==null?void 0:e.name,fatherName:t==null?void 0:t.name,preferSurname:""});return Rp({id:`child_${Date.now()}_${Math.floor(Math.random()*1e5)}`,name:b,fatherName:t.name,birthYear:n,generation:1,age:0,gender:a,stats:{...j,lifespan:uE(j,C)},constitution:C,cultivationMethod:"basic_breath",equipment:v,combatStats:R,avatar:l,isTested:!1,cultivation:0,isAdult:!1})},Dy=e=>{for(let t=0;t<Qe.length;t++)if(e<Qe[t].maxExp)return Qe[t];return Qe[Qe.length-1]},fE=(e,t,n={})=>{var j;let s=0,o=0,i=[],a=[];const l=n.familyRatingMultiplier??1,u=(((j=n.playerStrategy)==null?void 0:j.childrenStrategy)||n.childrenStrategy||{}).skipZhaozhou===!0,p=n.currentYear||0;if(!e||!Array.isArray(e)||e.length===0)return{newChildren:[],generation3Plus:n.generation3Plus||[],totalFeedback:0,totalCost:0,logs:[],events:[]};const c=[],f=[],x=[];e.forEach(R=>{(R.generation||1)<=2?f.push(R):x.push(R)});let C=n.generation3Plus||[];const w=new Set(C.map(R=>R.id));x.forEach(R=>{w.has(R.id)||(C.push({id:R.id,generation:R.generation||3,birthYear:p-(R.age||0),parentGeneration:(R.generation||3)-1}),w.add(R.id))});const S=[];let h=0;for(let R=0;R<C.length;R++){const b=C[R],_=p-b.birthYear;Math.floor(_)===20&&b.generation<6&&S.push({id:`child_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,generation:b.generation+1,birthYear:p,parentGeneration:b.generation}),_>.5&&(h+=1),S.push(b)}return C=S,s+=h,{newChildren:[...f.map(R=>{var k,T,N,K,L,B,W,z,ne,Q,se,ye,Me,Pe,Ke,q,de;let b={...R};b.age+=1/12;const _=b.generation||1;if(_>2){if(b.age>6){const Z=ka(b,!0);b.cultivation=Math.floor((b.cultivation||0)+Z)}return b}if(b.stats||(b.stats={}),!b.stats.lifespan){const Z=((k=b.spiritRoot)==null?void 0:k.multiplier)||1,re=100;b.stats.lifespan=Math.floor(re*(1+Z))}if(Math.floor(b.age*12)===12&&!b.trait){const Z=Math.random()*100;let re="WHITE";Z>99?re="RED":Z>95?re="ORANGE":Z>85?re="PURPLE":Z>65?re="BLUE":Z>35&&(re="GREEN");const ce=Um.filter(Ue=>Ue.rarity===re),le=ce[Math.floor(Math.random()*ce.length)]||Um[0];b.trait=le;const we=` ${b.name} ${le.name}(${le.desc})`;i.push(we),u||a.push({type:"ZHAOZHOU",title:"",message:we,child:b,trait:le,showModal:!0})}if(Math.floor(b.age*12)===144&&b.isTested&&!b.sect){const{recommended:Z,others:re}=kp(b),ce=` ${b.name} 12`;i.push(ce),a.push({type:"JOIN_SECT",title:"",message:ce,child:b,selectableSects:Z,otherSectOptions:re,showModal:!0})}if(b.age>6){const Z=ka(b,!0);b.cultivation=Math.floor(b.cultivation+Z);const re=Dy(b.cultivation),ce=b.tierTitle;b.tierTitle=re.name;const le=Qe.findIndex(Ue=>Ue.name===re.name),we=le>0?Qe[le-1].maxExp:0;if(b.currentExp=b.cultivation-we,b.maxExp=re.maxExp-we,ce&&ce!==b.tierTitle){const Oe={:30,:30,:30,:30,:50,:50,:50,:50,:200,:200,:200,:200,:300,:300,:300,:300,:500,:500,:500,:500}[b.tierTitle]||50;b.stats||(b.stats={}),typeof b.stats.lifespan!="number"&&(b.stats.lifespan=100),b.stats.lifespan+=Oe,i.push(` ${b.name} ${b.tierTitle} ${Oe} `)}if((b.generation||1)>2)return s+=bc(b,{familyRatingMultiplier:l})/12,b;if(s+=bc(b,{familyRatingMultiplier:l})/12,Math.floor(b.age*12)%36===0&&b.sect&&b.sect.level!=="NONE"){const Ue=["","","","","","","",""],Oe=Ue.indexOf(b.rank),ze=Math.max(.3,Math.min(2,((T=b.sect)==null?void 0:T.promotionEase)||1)),D=xe=>xe/ze;let me=0;if(b.cultivation>D(500)&&(me=1),b.cultivation>D(2e3)&&(((N=b.stats)==null?void 0:N.aptitude)||0)>50&&(me=2),b.cultivation>D(2e4)&&(((K=b.stats)==null?void 0:K.aptitude)||0)>80&&(me=3),b.cultivation>D(1e5)&&(me=5),b.cultivation>D(2e5)&&(((L=b.stats)==null?void 0:L.aptitude)||0)>90&&(me=6),b.cultivation>D(35e4)&&(((B=b.stats)==null?void 0:B.aptitude)||0)>95&&(me=7),me===7&&Array.isArray(n.worldNpcs)&&((W=b.sect)!=null&&W.id)&&n.worldNpcs.some(ke=>{var Ee;return((Ee=ke==null?void 0:ke.sect)==null?void 0:Ee.id)===b.sect.id&&(ke==null?void 0:ke.sectRank)===""&&(ke==null?void 0:ke.status)!=="DEAD"})&&(me=6),me>Oe){b.rank=Ue[me];let xe=` ${b.name} ${b.sect.name}  ${b.rank}`;const ke=dE(b.rank);ke&&(xe+=` ${ke.giftName}${b.name} `,a.push({type:"CHILD_PROMOTION_GIFT",title:"",message:xe,child:b,rank:b.rank,sect:b.sect,giftItemId:ke.giftItemId,giftName:ke.giftName,showModal:!0})),i.push(xe)}}}if(Math.floor(b.age*12)===216&&(i.push(` ${b.name} `),b.isAdult=!0),_<=2&&b.isAdult&&b.spouse&&b.age<60&&Math.random()<.1&&e.filter(re=>re.parentId===b.id).length<3){const re=((z=b.stats)==null?void 0:z.aptitude)||50,ce=((Q=(ne=b.spouse)==null?void 0:ne.stats)==null?void 0:Q.aptitude)||((se=b.spouse)==null?void 0:se.aptitude)||50,le=(re+ce)/2;let we=Math.floor(Math.random()*31)-15;const Ue=((ye=b.spiritRoot)==null?void 0:ye.type)==="",Oe=((Pe=(Me=b.spouse)==null?void 0:Me.spiritRoot)==null?void 0:Pe.type)==="";(Ue&&Math.random()<.2||Oe&&Math.random()<.2)&&(we+=30);const ze=Math.max(1,Math.min(100,Math.floor(le+we))),D=b.stats.looks||50,me=((Ke=b.spouse.stats)==null?void 0:Ke.looks)||b.spouse.looks||50,xe=Math.max(1,Math.min(100,Math.floor((D+me)/2+(Math.random()*10-5)))),ke=b.stats.intelligence||50,Ee=((q=b.spouse.stats)==null?void 0:q.intelligence)||b.spouse.intelligence||50,Xe=Math.max(1,Math.min(100,Math.floor((ke+Ee)/2+(Math.random()*10-5))));let Mt=null;const pn=Math.random(),fn=b.constitution&&b.constitution.name,en=((de=b.spouse)==null?void 0:de.constitution)&&b.spouse.constitution.name;fn&&en?pn<.8&&(Mt=Math.random()>.5?b.constitution:b.spouse.constitution):fn?pn<.6&&(Mt=b.constitution):en&&pn<.6&&(Mt=b.spouse.constitution),!Mt&&Math.random()<.01&&(Mt={name:"",desc:"",rarity:"UR"});const qr={weapon:null,armor:null,accessory:null};let Kr={aptitude:ze,looks:xe,intelligence:Xe};Kr=If(Kr,Mt);const co=ei("",Kr.aptitude,null,qr),fr=Math.random()>.5?"":"",Qr=Rp({id:Date.now()+Math.random().toString().slice(2,10),name:Nf(fr,{preferSurname:""}),fatherName:b.name,motherName:b.spouse.name,parentId:b.id,birthYear:Math.floor(b.age*12/12),generation:(b.generation||1)+1,age:0,gender:fr,stats:Kr,constitution:Mt,cultivationMethod:"basic_breath",equipment:qr,combatStats:co,avatar:{base:Math.floor(Math.random()*3),skinColor:Math.floor(Math.random()*5),eye:Math.floor(Math.random()*3),eyeColor:Math.floor(Math.random()*5),mouth:Math.floor(Math.random()*3),hair:Math.floor(fr===""?Math.random()*2:Math.random()*4),hairColor:Math.floor(Math.random()*5)},isTested:!1,cultivation:0,isAdult:!1});c.push(Qr);const mn=` ${b.name}  ${b.spouse.name} /${Qr.name}`;i.push(mn),a.push({type:"GRANDCHILD_BIRTH",title:"",message:mn,child:b,grandchildCount:1})}return b}),...c],generation3Plus:C,totalFeedback:s,totalCost:o,logs:i,events:a}},Gl=(e,t,n="random")=>{const s=t===""?"":"",o=Nf(s);let i,a,l,d=null;switch(n){case"talented":i=75+Math.floor(Math.random()*20),a=40+Math.floor(Math.random()*30),l=60+Math.floor(Math.random()*30);break;case"beautiful":i=50+Math.floor(Math.random()*30),a=80+Math.floor(Math.random()*20),l=50+Math.floor(Math.random()*30);break;case"wise":i=60+Math.floor(Math.random()*25),a=55+Math.floor(Math.random()*30),l=80+Math.floor(Math.random()*20);break;case"buddha":i=90+Math.floor(Math.random()*10),a=30+Math.floor(Math.random()*30),l=80+Math.floor(Math.random()*20),d="";break;default:i=40+Math.floor(Math.random()*50),a=50+Math.floor(Math.random()*40),l=40+Math.floor(Math.random()*40)}const u=oi(i),p={weapon:null,armor:null,accessory:null},c=ei("",i,u.type,p),f=500+Math.floor(Math.random()*1500),x=Dy(f).name,C=n==="buddha"?{base:0,skinColor:2,hair:-1,hairColor:null,eye:0,eyeColor:0,mouth:1}:{base:Math.floor(Math.random()*3),skinColor:Math.floor(Math.random()*5),eye:Math.floor(Math.random()*3),eyeColor:Math.floor(Math.random()*5),mouth:Math.floor(Math.random()*3),hair:Math.floor(Math.random()*3),hairColor:Math.floor(Math.random()*5)},w=n==="buddha"?"":s;return{id:Date.now()+Math.random().toString().slice(2,8),name:o,gender:w,identity:d,aptitude:i,looks:a,intelligence:l,spiritRoot:u,cultivationMethod:"basic_breath",equipment:p,combatStats:c,cultivation:f,tierTitle:x,isTested:!0,isAdult:!0,avatar:C,stats:{aptitude:i,looks:a,intelligence:l},relationship:n==="buddha"?{stage:1,affection:0,trust:0}:void 0,likes:n==="buddha"?[""]:void 0,isSpouse:!0,archetype:n}},Eg=(e,t)=>[Gl(e,t,"talented"),Gl(e,t,"beautiful"),Gl(e,t,"wise")],mE=(e,t)=>Gl(e,t,"random"),gE=e=>{const t=An(e.tier),n=Mf(e.tier);if(!n)return{success:!1,msg:""};const s=t.chance,o=(e.breakthroughBonus||0)/100,i=Math.min(.95,s+o);if(Math.random()<i)return{success:!0,newTier:n.name,newMaxExp:n.maxExp,baseChance:s,finalChance:i,resetFailCount:!0,msg:`${n.name}()`};{const d=Math.floor(t.maxExp*.2);return{success:!1,penalty:d,baseChance:s,finalChance:i,addFailBonus:!0,msg:` ${d} 5%`}}},jg=(e,t)=>{let n=0,s=[];return e.forEach(o=>{var p,c;const i=t.find(f=>f.id===o.managerId);if(!i){s.push(` ${o.name}`);return}const a=Math.floor(o.baseIncome*(1+i.stats.intelligence/100)),l=((c=(p=i.trait)==null?void 0:p.bonuses)==null?void 0:c.businessBonus)||0,d=z2(i.constitution),u=Math.floor(a*(1+l+d));n+=u}),{income:n,logs:s}};function hE(){const e=y.useMemo(()=>_y.map(j=>{var b;const R=(b=j.stats)==null?void 0:b.aptitude;return typeof R=="number"?{...j,spiritRoot:oi(R)}:j}),[]),[t,n]=y.useState(e),[s,o]=y.useState([]),[i,a]=y.useState(null),[l,d]=y.useState(null),u=y.useMemo(()=>t.filter(j=>{var R;return!((R=j.relationship)!=null&&R.cutTies)}),[t]),p=y.useCallback((j,R)=>{n(b=>b.map(_=>_.id===j?{..._,relationship:{..._.relationship,...R}}:_))},[]),c=y.useCallback((j,R)=>{n(b=>b.map(_=>_.id===j?{..._,...R}:_))},[]),f=y.useCallback(j=>{n(R=>[...R,j])},[]),x=y.useCallback(j=>{n(R=>{const b=R.find(_=>_.id===j);return b&&o(_=>[..._,b]),R.filter(_=>_.id!==j)})},[]),C=y.useCallback(j=>{n(R=>R.map(b=>b.id===j?{...b,isFollowed:!b.isFollowed}:b))},[]),w=y.useCallback(j=>{n(R=>R.map(j))},[]),S=y.useCallback(j=>{n(j)},[]),h=y.useCallback(j=>{n(R=>R.map(b=>j.get(b.id)||b))},[]),g=y.useCallback(j=>{const R=t.find(b=>b.id===j);R&&(o(b=>[...b,R]),n(b=>b.filter(_=>_.id!==j)))},[t]),v=y.useCallback(j=>{n(R=>R.map(b=>b.id===j?{...b,relationship:{...b.relationship||{},affection:0,trust:0,cutTies:!0}}:b))},[]);return{activeNpcs:t,deadNpcs:s,selectedNpc:i,selectedWorldNpc:l,visibleNpcs:u,setActiveNpcs:n,setDeadNpcs:o,setSelectedNpc:a,setSelectedWorldNpc:d,updateNpcRelationship:p,updateNpc:c,addNpc:f,removeNpc:x,toggleNpcFollow:C,batchUpdateNpcs:w,replaceAllNpcs:S,batchUpdateNpcsByMap:h,killNpc:g,cutTiesWithNpc:v}}function xE(){const[e,t]=y.useState([]),[n,s]=y.useState([]),[o,i]=y.useState(null),a=y.useCallback(h=>h?{...h,influenceProfile:Ty(h)}:null,[]),l=y.useMemo(()=>e.map(a),[e,a]),d=y.useCallback(h=>{const g=((h==null?void 0:h.exiledChildren)||[]).map(v=>v.id);return l.filter(v=>!g.includes(v.id))},[l]),u=y.useCallback(h=>{i(typeof h=="function"?g=>a(h(g)):a(h))},[a]),p=y.useCallback((h,g)=>{t(v=>v.map(j=>j.id===h?{...j,...g}:j)),i(v=>!v||v.id!==h?v:a({...v,...g}))},[a]),c=y.useCallback(h=>{t(g=>[...g,h])},[]),f=y.useCallback(h=>{t(g=>{const v=g.find(j=>j.id===h);return v&&s(j=>[...j,v]),g.filter(j=>j.id!==h)})},[]),x=y.useCallback(h=>{t(g=>g.map(v=>v.id===h?{...v,isFavorite:!v.isFavorite}:v)),i(g=>{if(!g||g.id!==h)return g;const v={...g,isFavorite:!g.isFavorite};return a(v)})},[a]),C=y.useCallback(h=>{t(g=>g.map(h).filter(v=>v!==null))},[]),w=y.useCallback(h=>{t(h)},[]),S=y.useCallback((h,g)=>{t(v=>v.map(j=>h(j)?g(j):j))},[]);return{children:e,fallenChildren:n,selectedChild:o,enhancedChildren:l,setChildren:t,setFallenChildren:s,setSelectedChild:u,enhanceChild:a,visibleChildren:d,updateChild:p,addChild:c,removeChild:f,toggleChildFavorite:x,batchUpdateChildren:C,replaceAllChildren:w,batchUpdateChildrenIf:S}}const yE={},vl="./",bE=-.04,vE=0,SE=e=>typeof e=="string"&&e.startsWith("#")?e:typeof e=="number"?yp[e]||yp[0]:"#2C2C2C",wE=e=>{const t=e.replace("#",""),n=parseInt(t.substring(0,2),16)/255,s=parseInt(t.substring(2,4),16)/255,o=parseInt(t.substring(4,6),16)/255,i=Math.max(n,s,o),a=Math.min(n,s,o);let l=0,d=0,u=(i+a)/2;if(i!==a){const p=i-a;switch(d=u>.5?p/(2-i-a):p/(i+a),i){case n:l=(s-o)/p+(s<o?6:0);break;case s:l=(o-n)/p+2;break;case o:l=(n-s)/p+4;break}l/=6}return d=Math.max(0,Math.min(1,d*.9)),u=Math.max(0,Math.min(1,u*1.05)),`hsl(${Math.round(l*360)} ${Math.round(d*100)}% ${Math.round(u*100)}%)`},kE=e=>new Promise((t,n)=>{if(!e){n(new Error("Missing asset source"));return}const s=new Image;s.crossOrigin="anonymous",s.onload=()=>t(s),s.onerror=o=>n(o),s.src=e}),EE=(e,t,n)=>{const s=Math.min(t/e.width,n/e.height);let o=e.width*s,i=e.height*s,a=(t-o)/2,l=(n-i)/2;return o=Math.round(o),i=Math.round(i),a=Math.round(a),l=Math.round(l),{offsetX:a,offsetY:l,drawWidth:o,drawHeight:i}},jE=(e,t,n,s)=>{const o=e.canvas.width,i=e.canvas.height,a=document.createElement("canvas");a.width=o,a.height=i;const l=a.getContext("2d");l.imageSmoothingEnabled=!0,l.imageSmoothingQuality="high",l.drawImage(t,n.offsetX,n.offsetY,n.drawWidth,n.drawHeight);const d=document.createElement("canvas");d.width=o,d.height=i;const u=d.getContext("2d");u.imageSmoothingEnabled=!0,u.imageSmoothingQuality="high",u.fillStyle=wE(s),u.fillRect(n.offsetX,n.offsetY,n.drawWidth,n.drawHeight),u.globalCompositeOperation="destination-in",u.drawImage(a,0,0),e.drawImage(a,0,0),e.globalCompositeOperation="multiply",e.drawImage(d,0,0),e.globalCompositeOperation="source-over"},Vr=({dna:e,size:t=64,gender:n})=>{const s=y.useRef(null),o=e||{eye:0,mouth:0,hair:0,hairColor:0},i=o.hair??o.hairId??0,a=o.tZoneId??o.eye??0,l=o.mouth??o.mouthId??0,d=n||o.gender,u=d==="female"||d===""||d==="F",p=SE(o.hairColor),c=typeof o.centerBiasX=="number"?o.centerBiasX:bE*t,f=typeof o.centerBiasY=="number"?o.centerBiasY:vE*t,x={width:t,height:t,borderRadius:"8px",border:"3px solid #3e2723",background:"#8d6e63",position:"relative",overflow:"hidden",boxSizing:"border-box"},C={width:"100%",height:"100%",display:"block"},w=(h,g)=>{if(h==="base")return`${vl}assets/male/base_face.png`;if(g==null||g<0)return null;const v=String((g||0)+1).padStart(2,"0");return`${vl}assets/male/${h}/${h}_${v}.png`},S=(h,g)=>{if(h==="base")return`${vl}assets/female/base_face.png`;if(g==null||g<0)return null;const v=String((g||0)+1).padStart(2,"0");return`${vl}assets/female/${h}/${h}${v}.png`};return y.useEffect(()=>{let h=!1;const g=s.current;if(!g)return()=>{h=!0};const v=g.getContext("2d");if(!v)return()=>{h=!0};const j=Math.round(t),R=typeof window<"u"&&window.devicePixelRatio?window.devicePixelRatio:1,b=Math.max(1,Math.round(j*R)),_=Math.round(c*R),I=Math.round(f*R);g.width=b,g.height=b,g.style.width=`${j}px`,g.style.height=`${j}px`,v.imageSmoothingEnabled=!0,v.imageSmoothingQuality="high",v.clearRect(0,0,g.width,g.height);const k=S("hair",i),T=w("hair",i),N=u?[{src:S("base")},{src:S("tzone",a)},{src:S("mouth",l)},k?{src:k,tint:p}:null].filter(Boolean):[{src:w("base")},{src:w("tzone",a)},{src:w("mouth",l)},T?{src:T,tint:p}:null].filter(Boolean);return(async()=>{for(const L of N)try{const B=await kE(L.src);if(h)return;const W=EE(B,g.width,g.height);W.offsetX+=_,W.offsetY+=I,L.tint?jE(v,B,W,L.tint):v.drawImage(B,W.offsetX,W.offsetY,W.drawWidth,W.drawHeight)}catch(B){console.warn("Avatar asset failed to load:",L.src,B)}})(),()=>{h=!0}},[t,u,i,l,a,p,c,f]),r.jsx("div",{style:x,children:r.jsx("canvas",{ref:s,style:C})})},CE=({player:e,isAuto:t,onBreakthrough:n,auctionBanner:s})=>{const[o,i]=y.useState(!1),a=Math.floor(e.currentExp||0),l=Math.max(1,Math.floor(e.maxExp||1)),d=a/l,u=Math.min(100,Math.round(d*100)),p=a>=l,c=(e==null?void 0:e.avatar)||{base:0,skinColor:0,hair:0,hairColor:0,eye:0,eyeColor:1,mouth:0};return r.jsxs("div",{style:Vt.container,children:[r.jsxs("div",{style:Vt.left,children:[r.jsx("div",{style:Vt.avatarColumn,children:r.jsx("div",{style:{...Vt.avatar,border:t?"2px solid #76ff03":"none",animation:t?"pulse 1.5s infinite":"none"},children:t?r.jsx("div",{style:{fontSize:"24px"},children:""}):r.jsx(Vr,{dna:c,gender:e.gender,size:44})})}),r.jsxs("div",{style:Vt.info,children:[r.jsx("div",{style:Vt.name,children:e.name}),r.jsx("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:r.jsxs("div",{style:Vt.tier,children:[e.tier,t&&r.jsx("span",{style:Vt.meditateStatus,children:" "})]})})]})]}),r.jsx("div",{style:Vt.expBarContainer,children:r.jsxs("div",{style:Vt.expBarWrapper,children:[r.jsx("div",{style:{...Vt.expBarFill,width:`${u}%`,background:p?"linear-gradient(90deg, #FFD700, #FFA500)":"linear-gradient(90deg, #4CAF50, #81C784)"}}),r.jsxs("div",{style:Vt.expText,children:[a,"/",l]})]})}),r.jsx("div",{style:{flex:1}}),r.jsx("div",{style:Vt.right,children:r.jsxs("div",{style:Vt.statusColumn,children:[r.jsx("div",{style:Vt.timeIcon,children:""}),r.jsxs("div",{style:Vt.timeValue,children:[" ",e.time.year," ",e.time.month,""]})]})}),s&&r.jsx("div",{style:Vt.auctionBanner,className:"auction-alert-chip",children:s.message})]})},Vt={container:{height:"calc(60px + env(safe-area-inset-top, 0px))",paddingTop:"env(safe-area-inset-top, 0px)",background:"linear-gradient(135deg, #3e2723 0%, #2c1810 100%)",color:"#fff",display:"flex",alignItems:"center",justifyContent:"space-between",padding:"0 10px",position:"relative",boxShadow:"0 4px 15px rgba(0,0,0,0.3)",borderRadius:"0 0 16px 16px",paddingBottom:"12px"},left:{display:"flex",alignItems:"center",gap:"12px"},avatarColumn:{display:"flex",flexDirection:"column",alignItems:"center",gap:"4px"},avatar:{width:"44px",height:"44px",borderRadius:"50%",background:"linear-gradient(135deg, #a1887f 0%, #8d6e63 100%)",display:"flex",alignItems:"center",justifyContent:"center",overflow:"hidden",imageRendering:"pixelated",boxShadow:"0 2px 8px rgba(0,0,0,0.2)"},info:{display:"flex",flexDirection:"column",justifyContent:"center"},name:{fontSize:"15px",fontWeight:"bold",textShadow:"1px 1px 2px rgba(0,0,0,0.3)"},tier:{fontSize:"12px",color:"#ffecb3",textShadow:"1px 1px 2px rgba(0,0,0,0.3)"},meditateStatus:{color:"#76ff03",marginLeft:"5px",fontSize:"10px"},right:{display:"flex",gap:"8px",alignItems:"center",flexShrink:0},timeIcon:{fontSize:"16px"},timeValue:{fontSize:"13px",fontWeight:"bold",color:"#fff"},expBarContainer:{flex:1,maxWidth:"300px",marginLeft:"20px",marginRight:"20px"},expBarWrapper:{position:"relative",height:"24px",backgroundColor:"rgba(0,0,0,0.3)",borderRadius:"12px",overflow:"hidden",border:"1px solid rgba(255,255,255,0.1)"},expBarFill:{position:"absolute",left:0,top:0,height:"100%",transition:"width 0.3s ease",borderRadius:"12px"},expText:{position:"absolute",left:"50%",top:"50%",transform:"translate(-50%, -50%)",fontSize:"11px",fontWeight:"bold",color:"#fff",textShadow:"1px 1px 2px rgba(0,0,0,0.5)",zIndex:1},statusColumn:{display:"flex",flexDirection:"column",alignItems:"center",gap:"2px",backgroundColor:"rgba(255,255,255,0.06)",padding:"4px 8px",borderRadius:"12px"},auctionBanner:{position:"absolute",left:"50%",bottom:"-14px",transform:"translateX(-50%)",background:"rgba(255, 255, 255, 0.16)",padding:"4px 16px",borderRadius:"20px",color:"#ff5252",fontWeight:"bold",fontSize:"12px",letterSpacing:"0.5px",boxShadow:"0 6px 18px rgba(0,0,0,0.35)",animation:"auctionFlash 0.8s ease-in-out 3"}},TE=()=>{if(typeof document>"u"||document.getElementById("top-status-animations"))return;const e=document.createElement("style");e.id="top-status-animations",e.innerHTML=`
    @keyframes pulse {
      0% { transform: scale(1); box-shadow: 0 0 0 0 rgba(118, 255, 3, 0.4); }
      70% { transform: scale(1.05); box-shadow: 0 0 0 8px rgba(118, 255, 3, 0); }
      100% { transform: scale(1); box-shadow: 0 0 0 0 rgba(118, 255, 3, 0); }
    }
    @keyframes auctionFlash {
      0% { opacity: 0; transform: translate(-50%, 8px) scale(0.95); }
      30% { opacity: 1; transform: translate(-50%, 0) scale(1); }
      70% { opacity: 1; }
      100% { opacity: 0; transform: translate(-50%, -6px) scale(0.96); }
    }
  `,document.head.appendChild(e)};typeof window<"u"&&typeof document<"u"&&TE();const IE=({activeTab:e,onTabChange:t})=>{const n=[{id:"FAMILY",label:"",icon:""},{id:"NPC",label:"",icon:""},{id:"ACTION",label:"",icon:""},{id:"REVENGE",label:"",icon:""},{id:"PLAYER",label:"",icon:""},{id:"SYSTEM",label:"",icon:""},{id:"LOG",label:"",icon:""}];return r.jsx("div",{style:Sl.container,children:n.map(s=>r.jsxs("button",{onClick:()=>t(s.id),style:{...Sl.btn,backgroundColor:e===s.id?"rgba(255,193,7,0.2)":"transparent",fontWeight:e===s.id?"bold":"normal"},children:[r.jsx("div",{style:Sl.icon,children:s.icon}),r.jsx("div",{style:Sl.label,children:s.label})]},s.id))})},Sl={container:{height:Ie.sizes.navHeight,background:Ie.gradients.warm,borderTop:`2px solid ${Ie.colors.border}`,display:"flex",justifyContent:"space-around",alignItems:"center",position:"fixed",bottom:0,left:0,right:0,zIndex:100,boxShadow:`0 -6px 18px ${Ie.colors.shadow}`,borderRadius:"16px 16px 0 0"},btn:{background:"none",border:"none",display:"flex",flexDirection:"column",alignItems:"center",cursor:"pointer",padding:"6px 3px",borderRadius:"10px",transition:"all 0.2s ease"},icon:{fontSize:"16px",marginBottom:"2px",color:Ie.colors.ink},label:{fontSize:"10px",color:Ie.colors.muted,fontFamily:"Microsoft YaHei, SimSun, serif"}},RE=e=>Math.max(0,Math.min(100,Number(e)||0)),Cg=({npc:e,onInteract:t,actions:n})=>{var l;const s=((l=e.relationship)==null?void 0:l.affection)??0,o=RE(s),a=(()=>{const d=o;return d>=80?"#b03a3a":d>=40?Ie.colors.accent:Ie.colors.muted})();return r.jsxs("div",{style:Yt.card,children:[t&&r.jsx("button",{onClick:()=>t(e.id,"TOGGLE_FOLLOW"),style:{...Yt.followBtn,background:e.isFollowed?"#ffd54f":Yt.followBtn.background},title:e.isFollowed?"":"",children:e.isFollowed?"":""}),r.jsxs("div",{style:Yt.header,children:[r.jsx(Vr,{dna:e.avatar,gender:e.gender,size:60}),r.jsxs("div",{style:{flex:1},children:[r.jsxs("h3",{style:{margin:0},children:[e.name,r.jsx("span",{style:Yt.tag,children:e.identity})]}),r.jsx("small",{style:{color:Ie.colors.muted},children:e.cultivation}),e.sect&&e.sectStatus!=="mysterious"&&e.sectStatus!=="rogue"&&r.jsx("div",{style:{marginTop:"2px"},children:r.jsx("span",{style:{fontSize:"9px",padding:"2px 6px",borderRadius:"8px",color:"white",background:e.sectStatus==="defected"?"#a65a5a":e.sectStatus==="hidden"?Ie.colors.primary:e.sect.level==="TOP"?"#c9a84a":e.sect.level==="HIGH"?Ie.colors.accent:e.sect.level==="RECKLESS"?"#a65a5a":Ie.colors.muted,fontWeight:"bold"},children:e.sect.name})}),e.sectStatus==="mysterious"&&r.jsx("div",{style:{marginTop:"2px"},children:r.jsx("span",{style:{fontSize:"9px",padding:"2px 6px",borderRadius:"8px",color:"white",background:Ie.colors.muted,fontWeight:"bold"},children:""})}),e.sectStatus==="rogue"&&r.jsx("div",{style:{marginTop:"2px"},children:r.jsx("span",{style:{fontSize:"9px",padding:"2px 6px",borderRadius:"8px",color:"white",background:Ie.colors.primary,fontWeight:"bold"},children:""})})]})]}),r.jsxs("p",{style:Yt.desc,children:["",e.desc,""]}),r.jsxs("div",{style:Yt.statRow,children:[r.jsx("span",{children:":"}),r.jsx("div",{style:Yt.progressBar,children:r.jsx("div",{style:{...Yt.progressFill,width:`${o}%`,backgroundColor:a}})}),r.jsxs("span",{style:{color:a},children:[" ",o]})]}),n?r.jsx("div",{style:Yt.actions,children:n}):t?r.jsxs("div",{style:Yt.actions,children:[r.jsx("button",{onClick:()=>t(e.id,"DETAIL"),style:Yt.btn,children:" "}),r.jsx("button",{onClick:()=>t(e.id,"CHAT"),style:Yt.btn,children:" "}),r.jsx("button",{onClick:()=>t(e.id,"GIFT"),style:Yt.btn,children:" "}),r.jsx("button",{onClick:()=>t(e.id,"SPAR"),disabled:s<0,style:{...Yt.btn,opacity:s<0?.5:1,backgroundColor:Ie.colors.primary,color:"white"},title:"",children:" "}),!e.isChild&&r.jsx("button",{onClick:()=>t(e.id,"DUAL_CULTIVATION"),style:{...Yt.btn,opacity:s<80?.5:1,backgroundColor:Ie.colors.accent,color:"white"},title:"80+",children:" "}),!e.isChild&&r.jsx("button",{onClick:()=>t(e.id,"PROPOSE"),disabled:s<80,style:{...Yt.btn,opacity:s<80?.5:1,backgroundColor:Ie.colors.primary,color:"white",cursor:s<80?"not-allowed":"pointer"},title:"80+",children:" "})]}):null]})},Yt={card:{border:`1px solid ${Ie.colors.border}`,borderRadius:"8px",padding:"15px",backgroundColor:Ie.colors.paper,boxShadow:`0 2px 6px ${Ie.colors.shadow}`,marginBottom:"10px",position:"relative"},header:{display:"flex",gap:"10px",alignItems:"center",marginBottom:"10px"},tag:{fontSize:"12px",background:Ie.colors.parchment,padding:"2px 6px",borderRadius:"4px",color:Ie.colors.ink},desc:{fontStyle:"italic",color:Ie.colors.ink,fontSize:"14px",margin:"5px 0 15px 0"},statRow:{display:"flex",alignItems:"center",gap:"10px",marginBottom:"15px",fontSize:"14px"},progressBar:{flex:1,height:"10px",background:Ie.colors.parchment,borderRadius:"5px",overflow:"hidden"},progressFill:{height:"100%",transition:"width 0.3s ease"},actions:{display:"grid",gridTemplateColumns:"1fr 1fr 1fr",gap:"8px"},btn:{padding:"8px",border:`1px solid ${Ie.colors.border}`,borderRadius:"4px",background:Ie.colors.parchment,cursor:"pointer",fontSize:"12px",color:Ie.colors.ink},followBtn:{position:"absolute",top:8,right:8,padding:"6px 8px",borderRadius:"6px",border:`1px solid ${Ie.colors.border}`,background:Ie.colors.parchment,cursor:"pointer",fontSize:"13px",lineHeight:"1"}},_E=[{id:"meet_normal_1",stage:0,text:"{name} ",options:[{label:"",result:"neutral",msg:"(+5)",change:{affection:5}},{label:"",result:"neutral",msg:"",change:{}}]},{id:"meet_normal_2",stage:0,text:"{name} ",options:[{label:"",check:e=>e.stats.intelligence>60,success:{msg:"(+8)",change:{affection:8}},fail:{msg:"(+2)",change:{affection:2}}},{label:"",result:"neutral",msg:"",change:{}}]},{id:"meet_normal_3",stage:0,text:"{name} ",options:[{label:"",check:e=>e.combatStats.atk>50,success:{msg:"(+10)",change:{affection:10}},fail:{msg:"(+3)",change:{affection:3}}},{label:"",result:"neutral",msg:"",change:{}}]},{id:"meet_normal_4",stage:0,text:"{name} ",options:[{label:"",result:"neutral",msg:"(+6)",change:{affection:6}},{label:"",result:"neutral",msg:"",change:{}}]},{id:"meet_normal_5",stage:0,text:"{name} ",options:[{label:"",result:"neutral",msg:"(+7)",change:{affection:7}},{label:"",result:"neutral",msg:"",change:{}}]},{id:"meet_normal_6",stage:0,text:"{name} ",options:[{label:"",result:"neutral",msg:"(+4)",change:{affection:4}},{label:"",result:"neutral",msg:"",change:{}}]},{id:"meet_cold_1",stage:0,reqTrait:"",text:"{name} ",options:[{label:"",result:"neutral",msg:"(+1)",change:{affection:1}},{label:"",result:"neutral",msg:"",change:{}}]},{id:"meet_cold_2",stage:0,reqTrait:"",text:"{name} ",options:[{label:"",check:e=>e.stats.luck>50,success:{msg:"(+5)",change:{affection:5}},fail:{msg:"",change:{}}},{label:"",result:"neutral",msg:"",change:{}}]},{id:"meet_cold_3",stage:0,reqTrait:"",text:"{name} ",options:[{label:"",result:"neutral",msg:"(+3)",change:{affection:3}},{label:"",result:"neutral",msg:"",change:{}}]},{id:"meet_cold_4",stage:0,reqTrait:"",text:"{name} ",options:[{label:"",result:"neutral",msg:"(+2)",change:{affection:2}},{label:"",result:"neutral",msg:"",change:{}}]},{id:"meet_cold_5",stage:0,reqTrait:"",text:"{name} ",options:[{label:"",check:e=>e.combatStats.atk>60,success:{msg:"(+7)",change:{affection:7}},fail:{msg:"(+1)",change:{affection:1}}},{label:"",result:"neutral",msg:"",change:{}}]},{id:"meet_cold_6",stage:0,reqTrait:"",text:"{name} ",options:[{label:"",check:e=>e.stats.intelligence>70,success:{msg:"(+8)",change:{affection:8}},fail:{msg:"(+0)",change:{affection:0}}},{label:"",result:"neutral",msg:"",change:{}}]},{id:"meet_gentle_1",stage:0,reqTrait:"",text:"{name} ",options:[{label:"",result:"neutral",msg:"(+7)",change:{affection:7}},{label:"",result:"neutral",msg:"(+3)",change:{affection:3}}]},{id:"meet_gentle_2",stage:0,reqTrait:"",text:"{name} ",options:[{label:"",result:"neutral",msg:"(+6)",change:{affection:6}},{label:"",result:"neutral",msg:"",change:{}}]},{id:"meet_gentle_3",stage:0,reqTrait:"",text:"{name} ",options:[{label:"",result:"neutral",msg:"(+9)",change:{affection:9}},{label:"",result:"neutral",msg:"(+2)",change:{affection:2}}]},{id:"meet_gentle_4",stage:0,reqTrait:"",text:"{name} ",options:[{label:"",result:"neutral",msg:"(+5)",change:{affection:5}},{label:"",result:"neutral",msg:"",change:{}}]},{id:"meet_gentle_5",stage:0,reqTrait:"",text:"{name} ",options:[{label:"",result:"neutral",msg:"(+8)",change:{affection:8}},{label:"",result:"neutral",msg:"",change:{}}]},{id:"meet_gentle_6",stage:0,reqTrait:"",text:"{name} ",options:[{label:"",result:"neutral",msg:"(+6)",change:{affection:6}},{label:"",result:"neutral",msg:"(+3)",change:{affection:3}}]},{id:"phase1_normal_1",stage:1,text:"{name} ",options:[{label:"",result:"good",msg:"(+10+5)",change:{affection:10,trust:5}},{label:"",result:"neutral",msg:"(+2)",change:{affection:2}}]},{id:"phase1_normal_2",stage:1,text:"{name} ",options:[{label:"",check:e=>e.stats.intelligence>65,success:{msg:"(+8+8)",change:{affection:8,trust:8}},fail:{msg:"(+4+3)",change:{affection:4,trust:3}}},{label:"",result:"neutral",msg:"(+1)",change:{affection:1}}]},{id:"phase1_normal_3",stage:1,text:"{name} ",options:[{label:"",result:"good",msg:"(+12+10)",change:{affection:12,trust:10}},{label:"",result:"neutral",msg:"(-1)",change:{affection:-1}}]},{id:"phase1_normal_4",stage:1,text:"{name} ",options:[{label:"",result:"good",msg:"(+7+4)",change:{affection:7,trust:4}},{label:"",result:"neutral",msg:"(+1)",change:{affection:1}}]},{id:"phase1_normal_5",stage:1,text:"{name} ",options:[{label:"",check:e=>e.combatStats.atk>70,success:{msg:"(+15+12)",change:{affection:15,trust:12}},fail:{msg:"(+8+6)",change:{affection:8,trust:6}}},{label:"",result:"bad",msg:"(-2)",change:{affection:-2}}]},{id:"phase1_normal_6",stage:1,text:"{name} ",options:[{label:"",result:"good",msg:"(+9+7)",change:{affection:9,trust:7}},{label:"",result:"neutral",msg:"(+0)",change:{affection:0}}]},{id:"phase1_tsundere_1",stage:1,reqTrait:"",text:'{name} ""',options:[{label:"",result:"good",msg:"(+10+5)",change:{affection:10,trust:5}},{label:"",result:"neutral",msg:"(+8)",change:{affection:8}}]},{id:"phase1_tsundere_2",stage:1,reqTrait:"",text:"{name} ",options:[{label:"",result:"good",msg:"(+9+4)",change:{affection:9,trust:4}},{label:"",result:"neutral",msg:"(+5)",change:{affection:5}}]},{id:"phase1_tsundere_3",stage:1,reqTrait:"",text:"{name} ",options:[{label:"",result:"good",msg:"(+12+6)",change:{affection:12,trust:6}},{label:"",result:"neutral",msg:"(+7)",change:{affection:7}}]},{id:"phase1_tsundere_4",stage:1,reqTrait:"",text:"{name} ",options:[{label:"",result:"good",msg:"(+11+8)",change:{affection:11,trust:8}},{label:"",result:"neutral",msg:"(+6)",change:{affection:6}}]},{id:"phase1_tsundere_5",stage:1,reqTrait:"",text:"{name} ",options:[{label:"",check:e=>e.combatStats.atk>75,success:{msg:"(+15+10)",change:{affection:15,trust:10}},fail:{msg:"(+8+5)",change:{affection:8,trust:5}}},{label:"",result:"bad",msg:"(-3)",change:{affection:-3}}]},{id:"phase1_tsundere_6",stage:1,reqTrait:"",text:"{name} ",options:[{label:"",result:"good",msg:"(+10+7)",change:{affection:10,trust:7}},{label:"",result:"neutral",msg:"(+9)",change:{affection:9}}]},{id:"phase1_greedy_1",stage:1,reqTrait:"",text:"{name} ",options:[{label:"",result:"good",msg:"(+12+3)",change:{affection:12,trust:3}},{label:"",result:"neutral",msg:"(+2)",change:{affection:2}}]},{id:"phase1_greedy_2",stage:1,reqTrait:"",text:"{name} ",options:[{label:"",check:e=>e.resources.spiritStones>500,success:{msg:"(+15+5)",change:{affection:15,trust:5}},fail:{msg:"(+1)",change:{affection:1}}},{label:"",result:"neutral",msg:"(+0)",change:{affection:0}}]},{id:"phase1_greedy_3",stage:1,reqTrait:"",text:"{name} ",options:[{label:"",check:e=>e.resources.spiritStones>300,success:{msg:"(+10+8)",change:{affection:10,trust:8}},fail:{msg:"(+1)",change:{affection:1}}},{label:"",result:"bad",msg:"(-2)",change:{affection:-2}}]},{id:"phase1_greedy_4",stage:1,reqTrait:"",text:"{name} ",options:[{label:"",result:"good",msg:"(+12+6)",change:{affection:12,trust:6}},{label:"",result:"neutral",msg:"(+5)",change:{affection:5}}]},{id:"phase1_greedy_5",stage:1,reqTrait:"",text:"{name} ",options:[{label:"",result:"good",msg:"(+15+4)",change:{affection:15,trust:4}},{label:"",result:"neutral",msg:"(+2)",change:{affection:2}}]},{id:"phase1_greedy_6",stage:1,reqTrait:"",text:"{name} ",options:[{label:"",result:"good",msg:"(+10+5)",change:{affection:10,trust:5}},{label:"",result:"neutral",msg:"(+0)",change:{affection:0}}]},{id:"phase2_normal_1",stage:2,text:"{name} ",options:[{label:"",result:"good",msg:"(+15+10)",change:{affection:15,trust:10}},{label:"",result:"neutral",msg:"(+8)",change:{affection:8}}]},{id:"phase2_normal_2",stage:2,text:"{name} ",options:[{label:"",result:"good",msg:"(+20+15)",change:{affection:20,trust:15}},{label:"",result:"neutral",msg:"(+10+5)",change:{affection:10,trust:5}}]},{id:"phase2_normal_3",stage:2,text:"{name} ",options:[{label:"",result:"good",msg:"(+25+20)",change:{affection:25,trust:20}},{label:"",result:"neutral",msg:"(+10)",change:{affection:10}}]},{id:"phase2_normal_4",stage:2,text:"{name} ",options:[{label:"",result:"good",msg:"(+30+25)",change:{affection:30,trust:25}},{label:"",result:"neutral",msg:"(+15+10)",change:{affection:15,trust:10}}]},{id:"phase2_normal_5",stage:2,text:"{name} ",options:[{label:"",result:"good",msg:"(+20+15)",change:{affection:20,trust:15}},{label:"",result:"neutral",msg:"(+5)",change:{affection:5}}]},{id:"phase2_normal_6",stage:2,text:"{name} ",options:[{label:"",result:"good",msg:"(+18+12)",change:{affection:18,trust:12}},{label:"",result:"bad",msg:"(-5)",change:{affection:-5}}]},{id:"phase2_yandere_1",stage:2,reqTrait:"",text:'{name} ""',options:[{label:"",result:"good",msg:"(+20+15)",change:{affection:20,trust:15}},{label:"",result:"bad",msg:"(-10-5)",change:{affection:-10,trust:-5}}]},{id:"phase2_yandere_2",stage:2,reqTrait:"",text:'{name} ""',options:[{label:"",result:"good",msg:"(+25+20)",change:{affection:25,trust:20}},{label:"",result:"neutral",msg:"(+10+5)",change:{affection:10,trust:5}}]},{id:"phase2_yandere_3",stage:2,reqTrait:"",text:'{name} ""',options:[{label:"",result:"good",msg:"(+15+10)",change:{affection:15,trust:10}},{label:"",result:"bad",msg:"(-15-10)",change:{affection:-15,trust:-10}}]},{id:"phase2_yandere_4",stage:2,reqTrait:"",text:'{name} ""',options:[{label:"",result:"good",msg:"(+30+25)",change:{affection:30,trust:25}},{label:"",result:"bad",msg:"(-5+10)",change:{affection:-5,trust:10}}]},{id:"phase2_yandere_5",stage:2,reqTrait:"",text:"{name} ",options:[{label:"",result:"good",msg:"(+35+30)",change:{affection:35,trust:30}},{label:"",result:"neutral",msg:"(+10+5)",change:{affection:10,trust:5}}]},{id:"phase2_yandere_6",stage:2,reqTrait:"",text:'{name} ""',options:[{label:"",result:"good",msg:"(+25+20)",change:{affection:25,trust:20}},{label:"",result:"neutral",msg:"(+15+10)",change:{affection:15,trust:10}}]},{id:"phase2_justice_1",stage:2,reqTrait:"",text:"{name} ",options:[{label:"",result:"good",msg:"(+25+20)",change:{affection:25,trust:20}},{label:"",result:"neutral",msg:"(+15+15)",change:{affection:15,trust:15}}]},{id:"phase2_justice_2",stage:2,reqTrait:"",text:"{name} ",options:[{label:"",result:"good",msg:"(+30+25)",change:{affection:30,trust:25}},{label:"",result:"neutral",msg:"(+10+5)",change:{affection:10,trust:5}}]},{id:"phase2_justice_3",stage:2,reqTrait:"",text:"{name} ",options:[{label:"",result:"good",msg:"(+20+18)",change:{affection:20,trust:18}},{label:"",result:"neutral",msg:"(+12+10)",change:{affection:12,trust:10}}]},{id:"phase2_justice_4",stage:2,reqTrait:"",text:"{name} ",options:[{label:"",result:"good",msg:"(+22+20)",change:{affection:22,trust:20}},{label:"",result:"neutral",msg:"(+15+15)",change:{affection:15,trust:15}}]},{id:"phase2_justice_5",stage:2,reqTrait:"",text:"{name} ",options:[{label:"",result:"good",msg:"(+28+25)",change:{affection:28,trust:25}},{label:"",result:"neutral",msg:"(+10+8)",change:{affection:10,trust:8}}]},{id:"phase2_justice_6",stage:2,reqTrait:"",text:"{name} ",options:[{label:"",result:"good",msg:"(+30+30)",change:{affection:30,trust:30}},{label:"",result:"neutral",msg:"(+15+12)",change:{affection:15,trust:12}}]}],ME=(e,t)=>{const n=_E.filter(o=>{var l;let i=0;const a=((l=e.relationship)==null?void 0:l.affection)||0;return a>=20&&(i=1),a>=60&&(i=2),!(o.stage!==i||o.reqTrait&&!(typeof e.personality=="object"&&e.personality!==null&&"label"in e.personality?[e.personality.label]:Array.isArray(e.personality)?e.personality:[]).includes(o.reqTrait)||o.condition&&!o.condition(e))});if(n.length===0)return null;const s=n[Math.floor(Math.random()*n.length)];return{...s,text:s.text.replace(/{name}/g,e.name)}},AE={GRAY:{color:"#9e9e9e",bg:"#eeeeee",border:"#bdbdbd",label:""},WHITE:{color:"#616161",bg:"#f5f5f5",border:"#e0e0e0",label:""},GREEN:{color:"#2e7d32",bg:"#e8f5e9",border:"#a5d6a7",label:""},BLUE:{color:"#1565c0",bg:"#e3f2fd",border:"#90caf9",label:""},PURPLE:{color:"#7b1fa2",bg:"#f3e5f5",border:"#ce93d8",label:""},ORANGE:{color:"#ef6c00",bg:"#fff3e0",border:"#ffcc80",label:""},RED:{color:"#c62828",bg:"#ffebee",border:"#ef9a9a",label:"",shadow:"0 0 5px rgba(198, 40, 40, 0.5)"}},NE=[{min:0,max:20,text:"",rarity:"GRAY"},{min:21,max:40,text:"",rarity:"WHITE"},{min:41,max:60,text:"",rarity:"GREEN"},{min:61,max:79,text:"",rarity:"BLUE"},{min:80,max:89,text:"",rarity:"PURPLE"},{min:90,max:99,text:"",rarity:"ORANGE"},{min:100,max:999,text:"",rarity:"RED"}],LE=[{min:0,max:20,text:"",rarity:"GRAY"},{min:21,max:40,text:"",rarity:"WHITE"},{min:41,max:60,text:"",rarity:"GREEN"},{min:61,max:79,text:"",rarity:"BLUE"},{min:80,max:89,text:"",rarity:"PURPLE"},{min:90,max:99,text:"",rarity:"ORANGE"},{min:100,max:999,text:"",rarity:"RED"}],kc=(e,t,n="")=>{let s=t==="INT"?LE:NE,o=s.find(a=>e>=a.min&&e<=a.max)||s[0],i=o.text;return t==="LOOKS"&&n===""&&(i===""&&(i=""),i===""&&(i="")),{text:i,rarity:o.rarity,value:e,style:AE[o.rarity]}},Ec=({trait:e,showValue:t=!1})=>{const{style:n,text:s,value:o}=e;return r.jsxs("div",{style:{display:"inline-flex",alignItems:"center",padding:"2px 8px",borderRadius:"12px",backgroundColor:n.bg,border:`1px solid ${n.border}`,color:n.color,fontSize:"12px",fontWeight:"bold",boxShadow:n.shadow||"none",marginRight:"5px"},children:[r.jsx("span",{children:s}),t&&r.jsx("span",{style:{marginLeft:"5px",fontSize:"10px",opacity:.7,borderLeft:`1px solid ${n.color}`,paddingLeft:"5px"},children:o})]})},$E=e=>{if(!e)return e;try{const t=new URL(e),n=t.pathname.replace(/\/+$|^\/+/g,"");return!n||n==="v1"?(t.pathname="/v1/chat/completions",t.toString()):n.includes("v1/chat")||n.includes("v1/completions")?t.toString():e}catch{return e}},Aa=async(e,t,n,s={})=>{var d;if(!t)throw new Error(" API Key");if(!n)throw new Error(" API URL");const{model:o="deepseek-chat",temperature:i=.85,maxTokens:a=200}=s,l=$E(n);l!==n&&console.info(`[AI]  API URL : ${l}`);try{const u=await fetch(l,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${t}`},body:JSON.stringify({model:o,messages:e,temperature:i,max_tokens:a,stream:!1})});if(!u.ok){const c=await u.text().catch(()=>"");let f={};try{f=c?JSON.parse(c):{}}catch{f={raw:c}}const x=((d=f.error)==null?void 0:d.message)||f.message||f.raw||u.statusText;throw u.status===401?new Error("API  (401):  API Key Key"):u.status===404?new Error(`API  (404): Invalid URL (POST ${l}) API URL  https://api.gemai.cc/v1/chat/completions`):u.status===503?new Error(`API  (503): ${x||""}`):new Error(`API  (${u.status}): ${x}`)}const p=await u.json().catch(()=>null);if(!p||!p.choices||!p.choices[0]||!p.choices[0].message)throw new Error("API ");return p.choices[0].message.content}catch(u){throw console.error("AI :",u),u.message&&u.message.includes("Failed to fetch")?new Error(" API URL  CORS "):u}},BE=async(e,t)=>{try{return await Aa([{role:"system",content:""},{role:"user",content:""}],e,t,{maxTokens:10}),!0}catch(n){return console.error("API :",n),!1}},Js={UNFORGETTABLE:"",PROFOUND:"",SIGNIFICANT:""},jn=e=>{var t;return e.memories||(e.memories={profile:{name:e.name,personality:((t=e.personality)==null?void 0:t.label)||"",identity:e.identity||"",firstMeet:new Date().toISOString()},milestones:[],recentEvents:[],longTermSummary:"",meta:{totalEvents:0,lastSummaryTime:null,needsSummary:!1}}),e},Uo=(e,t)=>{jn(e);const n={id:Date.now(),event:t.event,time:t.time||PE(),detail:t.detail,emotionalImpact:t.emotionalImpact||Js.SIGNIFICANT,category:t.category||"other",tags:t.tags||[],createdAt:new Date().toISOString()};return e.memories.milestones.push(n),console.log(`[] ${e.name} : ${t.event}`),n},bo=(e,t)=>{jn(e);const n={id:Date.now(),description:t.description,time:new Date().toISOString(),affectionChange:t.affectionChange||0,context:t.context||""};return e.memories.recentEvents.push(n),e.memories.meta.totalEvents++,e.memories.recentEvents.length>20&&e.memories.recentEvents.shift(),e.memories.meta.totalEvents%50===0&&(e.memories.meta.needsSummary=!0),n},Fy=(e,t={})=>{const{includeMilestones:n=!0,includeRecent:s=!0,maxRecent:o=5,contextKeywords:i=[]}=t;jn(e);let a="";if(n&&e.memories.milestones.length>0&&(a+=`


`,[...e.memories.milestones].sort((d,u)=>{const p={:4,:3,:2,:1};return(p[u.emotionalImpact]||0)-(p[d.emotionalImpact]||0)}).forEach((d,u)=>{a+=`${u+1}. **${d.event}**${d.time}
   ${d.detail}
   ${d.emotionalImpact}
`})),s&&e.memories.recentEvents.length>0&&(a+=`

`,e.memories.recentEvents.slice(-o).forEach(d=>{const u=DE(d.time);a+=`- ${u}: ${d.description}`,d.affectionChange!==0&&(a+=` (${d.affectionChange>0?"+":""}${d.affectionChange})`),a+=`
`})),i.length>0){const l=e.memories.milestones.filter(d=>i.some(u=>d.event.includes(u)||d.detail.includes(u)||d.tags.includes(u)));l.length>0&&(a+=`

`,l.forEach(d=>{a+=`${d.time}${d.event}...${d.detail}
`}))}return e.memories.longTermSummary&&(a+=`

${e.memories.longTermSummary}
`),a},OE=e=>{const t={family:["","","","","","","","","","",""],relationship:["","","","","","","",""],cultivation:["","","","","","",""],combat:["","","","","","",""],emotion:["","","","","","","",""]},n=[];for(const[s,o]of Object.entries(t))o.some(i=>e.includes(i))&&n.push(...o.filter(i=>e.includes(i)));return[...new Set(n)]},PE=()=>`5${["","","",""][Math.floor(Math.random()*4)]}`,zE=e=>new Date(e).toLocaleDateString("zh-CN",{year:"numeric",month:"long",day:"numeric"}),DE=e=>{const t=new Date,n=new Date(e),s=t-n,o=Math.floor(s/6e4),i=Math.floor(s/36e5),a=Math.floor(s/864e5);return o<1?"":o<60?`${o}`:i<24?`${i}`:a<7?`${a}`:zE(e)},Tg=(e,t,n={})=>{const{difficulty:s="",sacrifice:o=!1}=n;let i=`${t.name}`;return s===""?(i+="",o&&(i+="")):i+="",i+=`${o?"":""}`,Uo(e,{event:"",detail:i,emotionalImpact:Js.UNFORGETTABLE,category:"family",tags:["","",t.name,o?"":""]})},FE=(e,t="")=>Uo(e,{event:"",detail:`${t}`,emotionalImpact:Js.UNFORGETTABLE,category:"relationship",tags:["","","",""]}),HE=(e,t)=>Uo(e,{event:"",detail:t,emotionalImpact:Js.UNFORGETTABLE,category:"combat",tags:["","",""]}),Ig=(e,t,n={},s="")=>{var g,v,j,R,b,_,I;const o=((g=e.relationship)==null?void 0:g.affection)||0;let i="";o>=80?i="":o>=60?i="":o>=40?i="":o>=20&&(i="");const a=((v=e.relationship)==null?void 0:v.jealousy)||e.jealousy||0;let l="",d="";a>=81?(l="",d=""):a>=61?(l="",d=""):a>=41?(l="",d=""):a>=21&&(l="",d="");const u=((j=e.personality)==null?void 0:j.label)||"",p=((R=e.personality)==null?void 0:R.desc)||e.desc||"",c=e.identity||"",f=e.tierTitle||"";let x="";(((b=n.npcs)==null?void 0:b.some(k=>{var T;return k.id===e.id&&((T=k.relationship)==null?void 0:T.stage)>=3}))||o>=90)&&(x+=`
`);const w=((_=n.children)==null?void 0:_.filter(k=>k.parentId===e.id||k.fatherId===e.id||k.motherId===e.id||k.fatherName===e.name||k.motherName===e.name))||[];if(w.length>0){const k=w.map(N=>`${N.name}${N.age}${N.tierTitle||""}`).join("");e.gender===""?x+=`
${w.length}${k}
${e.name}`:x+=`
${w.length}${k}
${t.name}`;const T=w.map(N=>{let K=`${N.name}`;return N.sect&&(K+=`${N.sect.name}`),N.spouse&&(K+=`${N.spouse.name}`),N.trait&&(K+=`${N.trait.name}`),K}).join("");T&&(x+=`
${T}`)}const S=((I=e.relationship)==null?void 0:I.stage)||1;if(S>=2&&S<3&&(x+=`
`),e.isPregnant){const k=e.pregnancyProgress||0;x+=`
${k}`}if(n.eventHistory&&n.eventHistory.length>0){const k=n.eventHistory.filter(T=>T.npcId===e.id).slice(-3).map(T=>T.description).join("");k&&(x+=`


${k}`)}let h="";if(e.memories){const k=s?OE(s):[];h=Fy(e,{includeMilestones:!0,includeRecent:!0,maxRecent:5,contextKeywords:k}),k.some(T=>["","","",""].includes(T))&&(h+=`

 `),k.some(T=>["","","",""].includes(T))&&(h+=`

 `),k.some(T=>["",""].includes(T))&&(h+=`

 `)}return`
  

  /

  
  ${e.name}
  ${c}
  ${e.gender||""}
  ${f}
  ${e.age||""}
  ${u}${p}

  
  ${t.name}
  ${t.gender||""}
  ${t.tierTitle||""}
  ${i}${o}/100
  ${a>0?`${l}${a}/100- ${d}`:""}
  ${x?`
`+x:""}
  ${h?`
`+h:""}

  
  1. "${u}"
    - 
    - 
    - 
    - 
    - 

  2. /
    - 
    - 
    - 

  3. 
    - 30-50
    - 80
    - 

  4. 
    - <30
    - 30-60
    - 60-80
    - >80
    ${w.length>0?"- ":""}
    ${a>=21?`
    ${l}${d.replace("","").replace("","").replace("","")}`:""}

  5. 
    - 
    - "AI"""
    - 
    - 

  
  ${w.length>0?"":""}`},WE=({npc:e,player:t,apiKey:n,apiUrl:s,gameState:o={}})=>{const[i,a]=y.useState([]),[l,d]=y.useState(""),[u,p]=y.useState(!1),[c,f]=y.useState(null),x=y.useRef(null),[C,w]=y.useState(typeof window<"u"?window.innerHeight:600);y.useEffect(()=>{const j={role:"system",content:Ig(e,t,o)},R=GE(e.id);R&&R.length>0?a([j,...R.filter(b=>b.role!=="system")]):a([j])},[e.id,e,t,o]),y.useEffect(()=>{x.current&&(x.current.scrollTop=x.current.scrollHeight)},[i]),y.useEffect(()=>{const j=()=>{typeof window<"u"&&window.innerHeight&&w(window.innerHeight)};return j(),window.addEventListener("resize",j),window.addEventListener("orientationchange",j),()=>{window.removeEventListener("resize",j),window.removeEventListener("orientationchange",j)}},[]),y.useEffect(()=>{i.length>1&&UE(e.id,i.filter(j=>j.role!=="system"))},[i,e.id]);const S=async()=>{if(!l.trim()||u)return;const j={role:"user",content:l.trim()},R=l.trim(),b={role:"system",content:Ig(e,t,o,R)},_=i.filter(k=>k.role!=="system"),I=[b,..._,j];a(I),d(""),p(!0),f(null);try{const T={role:"assistant",content:await Aa(I,n,s)};a(N=>[...N,T])}catch(k){f(k.message);const T={role:"system",content:`${k.message}`};a(N=>[...N,T])}finally{p(!1)}},h=()=>{const j=i[0];a([j]),VE(e.id)},g=C?Math.max(360,C-120):null,v={...kn.container,height:"100%",minHeight:"320px",maxHeight:g?`${g}px`:"100%"};return r.jsxs("div",{style:v,children:[r.jsxs("div",{style:kn.toolbar,children:[r.jsxs("div",{style:kn.npcName,children:[" ",e.name," "]}),r.jsx("button",{onClick:h,style:kn.clearBtn,title:"",children:""})]}),r.jsxs("div",{style:kn.chatBox,ref:x,children:[i.filter(j=>j.role!=="system").map((j,R)=>{const b=j.role==="user";return j.role==="system"?r.jsx("div",{style:kn.systemMsg,children:j.content},R):r.jsxs("div",{style:{...kn.bubbleRow,justifyContent:b?"flex-end":"flex-start"},children:[!b&&r.jsx("div",{style:kn.avatar,title:e.name,children:e.name[0]}),r.jsx("div",{style:{...kn.bubble,background:b?"linear-gradient(135deg, #d4af37 0%, #c5a028 100%)":"#fff",color:b?"#fff":"#333",border:b?"none":"2px solid #d4af37",boxShadow:b?"0 2px 8px rgba(212, 175, 55, 0.3)":"0 2px 8px rgba(0, 0, 0, 0.1)"},children:j.content}),b&&r.jsx("div",{style:{...kn.avatar,background:"#4e6a5d"},title:"",children:t.name[0]})]},R)}),u&&r.jsx("div",{style:kn.loading,children:r.jsx("span",{className:"loading-dots",children:""})})]}),r.jsxs("div",{style:kn.inputArea,children:[r.jsx("input",{style:kn.input,value:l,onChange:j=>d(j.target.value),onKeyDown:j=>{j.key==="Enter"&&!j.shiftKey&&(j.preventDefault(),S())},placeholder:" Enter ...",disabled:u}),r.jsx("button",{onClick:S,style:{...kn.sendBtn,opacity:u||!l.trim()?.5:1,cursor:u||!l.trim()?"not-allowed":"pointer"},disabled:u||!l.trim(),children:u?"...":""})]})]})},jc="npc_chat_history_",lu=50,UE=(e,t)=>{try{const n=t.slice(-lu);localStorage.setItem(`${jc}${e}`,JSON.stringify(n)),t.length>lu&&console.log(`${t.length} -> ${lu} `)}catch(n){if(console.error(":",n),n.name==="QuotaExceededError"){console.warn("...");try{const s=t.slice(-20);localStorage.setItem(`${jc}${e}`,JSON.stringify(s))}catch(s){console.error(":",s)}}}},GE=e=>{try{const t=localStorage.getItem(`${jc}${e}`);return t?JSON.parse(t):[]}catch(t){return console.error(":",t),[]}},VE=e=>{try{localStorage.removeItem(`${jc}${e}`)}catch(t){console.error(":",t)}},kn={container:{display:"flex",flexDirection:"column",background:"rgba(255, 250, 240, 0.95)",borderRadius:"12px",border:"2px solid #d4af37",overflow:"hidden",boxShadow:"0 4px 12px rgba(0, 0, 0, 0.15)",position:"relative"},toolbar:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"12px 16px",background:"linear-gradient(135deg, #4e6a5d 0%, #3d5549 100%)",borderBottom:"2px solid #d4af37"},npcName:{fontSize:"16px",fontWeight:"bold",color:"#d4af37",textShadow:"0 1px 2px rgba(0, 0, 0, 0.3)"},clearBtn:{padding:"6px 12px",background:"rgba(255, 255, 255, 0.1)",border:"1px solid rgba(255, 255, 255, 0.3)",borderRadius:"6px",color:"#fff",fontSize:"12px",cursor:"pointer",transition:"all 0.2s"},chatBox:{flex:1,overflowY:"auto",padding:"20px",paddingBottom:"28px",display:"flex",flexDirection:"column",gap:"16px",background:`url("data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none' fill-rule='evenodd'%3E%3Cg fill='%23d4af37' fill-opacity='0.05'%3E%3Cpath d='M36 34v-4h-2v4h-4v2h4v4h2v-4h4v-2h-4zm0-30V0h-2v4h-4v2h4v4h2V6h4V4h-4zM6 34v-4H4v4H0v2h4v4h2v-4h4v-2H6zM6 4V0H4v4H0v2h4v4h2V6h4V4H6z'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E")`},bubbleRow:{display:"flex",gap:"10px",alignItems:"flex-start",animation:"fadeIn 0.3s ease-in"},avatar:{minWidth:"36px",width:"36px",height:"36px",borderRadius:"50%",background:"linear-gradient(135deg, #d4af37 0%, #c5a028 100%)",color:"#fff",display:"flex",alignItems:"center",justifyContent:"center",fontSize:"14px",fontWeight:"bold",boxShadow:"0 2px 6px rgba(0, 0, 0, 0.2)",border:"2px solid rgba(255, 255, 255, 0.5)"},bubble:{maxWidth:"70%",padding:"12px 16px",borderRadius:"16px",fontSize:"14px",lineHeight:"1.6",wordWrap:"break-word",whiteSpace:"pre-wrap"},systemMsg:{textAlign:"center",fontSize:"12px",color:"#999",padding:"8px 16px",background:"rgba(0, 0, 0, 0.05)",borderRadius:"8px",fontStyle:"italic"},loading:{fontSize:"13px",color:"#666",textAlign:"center",padding:"12px",fontStyle:"italic"},inputArea:{padding:"16px",paddingBottom:"calc(16px + env(safe-area-inset-bottom, 0px))",borderTop:"2px solid #d4af37",display:"flex",gap:"12px",background:"linear-gradient(180deg, rgba(255, 250, 240, 0.95) 0%, rgba(245, 240, 230, 0.95) 100%)",flexShrink:0},input:{flex:1,padding:"12px 16px",borderRadius:"24px",border:"2px solid #d4af37",outline:"none",fontSize:"14px",background:"#fff",transition:"all 0.2s"},sendBtn:{padding:"10px 24px",borderRadius:"24px",background:"linear-gradient(135deg, #4e6a5d 0%, #3d5549 100%)",color:"#fff",border:"none",fontWeight:"bold",fontSize:"14px",transition:"all 0.2s",boxShadow:"0 2px 6px rgba(0, 0, 0, 0.2)"}},YE=({npc:e,onClose:t,onOptionSelect:n,player:s,children:o=[],npcs:i=[],onViewLog:a,onCutTies:l,onToggleLetterAcceptance:d})=>{var S,h,g,v,j;const[u,p]=y.useState(null),[c,f]=y.useState("INFO"),x=e.acceptsLetters!==!1;y.useEffect(()=>{const R=b=>{b.key==="Escape"&&t&&t()};return window.addEventListener("keydown",R),()=>window.removeEventListener("keydown",R)},[t]);const C={children:o,npcs:i},w=({label:R,value:b,max:_=100,color:I})=>{const k=Number(_)||100,T=Number(b)||0,N=Math.max(0,Math.min(k,T)),K=k===0?0:Math.min(100,Math.round(N/k*100));return r.jsxs("div",{style:{display:"flex",alignItems:"center",marginBottom:"5px",fontSize:"12px"},children:[r.jsx("span",{style:{width:"30px",color:"#666"},children:R}),r.jsx("div",{style:{flex:1,height:"6px",background:"#eee",borderRadius:"3px",margin:"0 8px"},children:r.jsx("div",{style:{width:`${K}%`,background:I,height:"100%",borderRadius:"3px"}})}),r.jsx("span",{style:{width:"25px",textAlign:"right",fontWeight:"bold"},children:Math.floor(N)})]})};return r.jsx("div",{style:ut.overlay,children:r.jsxs("div",{style:ut.modalWrapper,children:[r.jsx("button",{onClick:t,style:ut.closeBtn,"aria-label":"",children:""}),r.jsxs("div",{style:ut.modal,children:[r.jsxs("div",{style:ut.tabBar,children:[r.jsx("button",{onClick:()=>f("INFO"),style:{...ut.tab,background:c==="INFO"?"linear-gradient(135deg, #4e6a5d 0%, #3d5549 100%)":"#f5f5f5",color:c==="INFO"?"#fff":"#333",fontWeight:c==="INFO"?"bold":"normal"},children:" "}),r.jsx("button",{onClick:()=>f("CHAT"),style:{...ut.tab,background:c==="CHAT"?"linear-gradient(135deg, #4e6a5d 0%, #3d5549 100%)":"#f5f5f5",color:c==="CHAT"?"#fff":"#333",fontWeight:c==="CHAT"?"bold":"normal"},children:" "})]}),r.jsx("div",{style:ut.content,children:c==="INFO"?r.jsxs("div",{style:ut.leftCol,children:[r.jsx("div",{style:{marginBottom:"15px"},children:r.jsx(Vr,{dna:e.avatar,gender:e.gender,size:120})}),r.jsxs("div",{style:ut.nameBlock,children:[r.jsx("h2",{style:{margin:"10px 0 5px"},children:e.name}),r.jsx("span",{style:ut.identityTag,children:e.identity}),e.constitution&&r.jsx("span",{style:ut.rareTag,children:e.constitution.name}),e.sect&&e.sectStatus!=="mysterious"&&e.sectStatus!=="rogue"&&r.jsx("div",{style:{marginTop:"8px",display:"flex",flexDirection:"column",gap:"4px"},children:r.jsxs("span",{style:{...ut.identityTag,background:e.sectStatus==="defected"?"linear-gradient(135deg, #e53935 0%, #c62828 100%)":e.sectStatus==="hidden"?"linear-gradient(135deg, #9c27b0 0%, #7b1fa2 100%)":e.sect.level==="TOP"?"linear-gradient(135deg, #ffd700 0%, #ffb300 100%)":e.sect.level==="HIGH"?"linear-gradient(135deg, #00bcd4 0%, #0097a7 100%)":e.sect.level==="RECKLESS"?"linear-gradient(135deg, #d32f2f 0%, #b71c1c 100%)":"linear-gradient(135deg, #66bb6a 0%, #43a047 100%)",fontSize:"11px"},children:[e.sectStatus==="defected"?" ":e.sectStatus==="hidden"?" ":"","",e.sect.name,"",e.sectRank]})}),e.sectStatus==="mysterious"&&r.jsx("span",{style:{...ut.identityTag,background:"linear-gradient(135deg, #616161 0%, #424242 100%)",fontSize:"11px"},children:" "}),e.sectStatus==="rogue"&&r.jsx("span",{style:{...ut.identityTag,background:"linear-gradient(135deg, #8d6e63 0%, #6d4c41 100%)",fontSize:"11px"},children:" "})]}),r.jsxs("p",{style:ut.desc,children:['"',e.desc||e.appearance||"",'"']}),r.jsxs("div",{style:ut.attrBox,children:[r.jsx("h4",{children:" "}),r.jsxs("div",{style:{marginBottom:"8px",display:"flex",alignItems:"center"},children:[r.jsx("span",{style:{fontSize:"12px",width:"40px"},children:":"}),r.jsx(Ec,{trait:kc(e.stats.looks,"LOOKS","")})]}),r.jsxs("div",{style:{marginBottom:"8px",display:"flex",alignItems:"center"},children:[r.jsx("span",{style:{fontSize:"12px",width:"40px"},children:":"}),r.jsx(Ec,{trait:kc(e.stats.intelligence,"INT")})]}),e.spiritRoot&&r.jsxs("div",{style:{marginBottom:"8px"},children:[r.jsxs("div",{style:{display:"flex",alignItems:"center",marginBottom:"4px"},children:[r.jsx("span",{style:{fontSize:"12px",width:"40px"},children:":"}),r.jsx("span",{style:{fontSize:"12px",fontWeight:"bold",color:e.spiritRoot.color||"#d81b60"},children:e.spiritRoot.type})]}),e.spiritRoot.elements&&r.jsx("div",{style:{display:"flex",alignItems:"center",marginLeft:"40px"},children:r.jsx("div",{style:{display:"flex",gap:"4px"},children:e.spiritRoot.elements.map(R=>{const b=_=>({:"#FFD700",:"#4CAF50",:"#2196F3",:"#F44336",:"#795548",:"#673AB7",:"#00BCD4",:"#009688"})[_]||"#ccc";return r.jsx("span",{style:{padding:"2px 6px",borderRadius:"10px",color:"white",fontWeight:"bold",fontSize:"10px",background:b(R)},children:R},R)})})}),r.jsx("div",{style:{display:"flex",alignItems:"center",marginLeft:"40px",marginTop:"4px"},children:r.jsxs("span",{style:{fontSize:"11px",color:"#666"},children:[": ",(S=e.stats)==null?void 0:S.aptitude," (",((h=e.stats)==null?void 0:h.aptitude)>=80?"":"",")"]})}),e.spiritRoot.desc&&r.jsx("div",{style:{marginLeft:"40px",marginTop:"2px"},children:r.jsx("span",{style:{fontSize:"11px",color:"#666"},children:e.spiritRoot.desc})})]})]}),r.jsxs("div",{style:ut.attrBox,children:[r.jsx("h4",{children:" "}),r.jsx(w,{label:"",value:((g=e.relationship)==null?void 0:g.affection)||0,max:100,color:"#f50057"}),r.jsx(w,{label:"",value:((v=e.relationship)==null?void 0:v.trust)||0,max:100,color:"#00e5ff"}),(()=>{var I;const R=((I=e.relationship)==null?void 0:I.affection)||0,b=zy(R),_=Vk(b);return r.jsxs("div",{style:{marginTop:"8px",display:"flex",alignItems:"center",gap:"8px"},children:[r.jsx("span",{style:{fontSize:"12px",color:"#666"},children:":"}),r.jsxs("span",{style:{padding:"4px 12px",borderRadius:"12px",fontSize:"12px",fontWeight:"bold",color:"white",backgroundColor:_.color},children:[_.icon," ",_.text]})]})})(),(()=>{var I;const R=((I=e.relationship)==null?void 0:I.jealousy)??e.jealousy??0,b=k=>k>=81?"#d32f2f":k>=61?"#f44336":k>=41?"#ff9800":k>=21?"#ffc107":"#4caf50",_=k=>k>=81?"":k>=61?"":k>=41?"":k>=21?"":"";return r.jsxs("div",{style:{marginTop:"8px"},children:[r.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",marginBottom:"4px"},children:[r.jsx("span",{style:{fontSize:"12px",color:"#666"},children:":"}),r.jsxs("span",{style:{fontSize:"11px",fontWeight:"bold",color:b(R)},children:[_(R)," (",R,")"]})]}),r.jsx("div",{style:{width:"100%",height:"8px",background:"#e0e0e0",borderRadius:"4px",overflow:"hidden"},children:r.jsx("div",{style:{width:`${R}%`,height:"100%",background:`linear-gradient(90deg, ${b(R)}, ${b(R)}dd)`,borderRadius:"4px",transition:"width 0.3s ease, background 0.3s ease"}})})]})})(),r.jsxs("div",{style:ut.letterToggleRow,children:[r.jsxs("div",{children:[r.jsx("span",{style:{fontSize:"12px",color:"#666"},children:""}),r.jsx("span",{style:{fontSize:"12px",fontWeight:"bold",color:x?"#2e7d32":"#b71c1c"},children:x?"":""})]}),r.jsx("button",{type:"button",style:{...ut.letterToggleBtn,background:x?"linear-gradient(135deg, #4caf50 0%, #2e7d32 100%)":"linear-gradient(135deg, #b0bec5 0%, #90a4ae 100%)"},onClick:()=>d&&d(e.id,!x),children:x?"":""})]}),r.jsx("p",{style:ut.letterToggleHint,children:x?"Ta":"Ta"})]}),r.jsxs("div",{style:ut.attrBox,children:[r.jsx("h4",{children:" "}),r.jsxs("div",{style:{fontSize:"12px",color:"#666",lineHeight:"1.6"},children:[r.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:"4px"},children:[r.jsx("span",{children:":"}),r.jsxs("span",{style:{fontWeight:"bold"},children:[Math.floor(e.age||18)," "]})]}),r.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:"4px"},children:[r.jsx("span",{children:":"}),r.jsxs("span",{style:{fontWeight:"bold"},children:[((j=e.stats)==null?void 0:j.lifespan)||100," "]})]}),r.jsxs("div",{style:{display:"flex",justifyContent:"space-between"},children:[r.jsx("span",{children:":"}),r.jsxs("span",{style:{fontWeight:"bold",color:(()=>{const R=Dr(e);return R<10?"#f44336":R<30?"#ff9800":"#4caf50"})()},children:[Dr(e)," "]})]}),Dr(e)<10&&r.jsx("div",{style:{marginTop:"8px",padding:"8px",background:"rgba(244, 67, 54, 0.1)",borderRadius:"4px",color:"#f44336",fontSize:"11px"},children:" "})]})]}),e.tier&&r.jsxs("div",{style:ut.attrBox,children:[r.jsx("h4",{children:" "}),r.jsxs("div",{style:{fontSize:"12px",marginBottom:"8px"},children:[r.jsx("span",{style:{color:"#666"},children:": "}),r.jsx("span",{style:{fontWeight:"bold",color:"#9c27b0"},children:e.tier||""})]}),e.currentExp!==void 0&&e.maxExp&&r.jsxs("div",{children:[r.jsxs("div",{style:{marginBottom:"4px"},children:[r.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",marginBottom:"4px"},children:[r.jsx("span",{style:{fontSize:"11px",color:"#666"},children:""}),r.jsxs("span",{style:{fontSize:"11px",color:"#666",fontWeight:"bold"},children:[Math.round(Math.floor(e.currentExp||0)/Math.max(1,Math.floor(e.maxExp||1))*100),"%"]})]}),r.jsx("div",{style:{width:"100%",height:"14px",background:"linear-gradient(to right, #f0f0f0, #e0e0e0)",borderRadius:"7px",overflow:"hidden",position:"relative",boxShadow:"inset 0 2px 4px rgba(0,0,0,0.1)"},children:r.jsx("div",{style:{width:`${Math.min(100,Math.round(Math.floor(e.currentExp||0)/Math.max(1,Math.floor(e.maxExp||1))*100))}%`,height:"100%",background:"linear-gradient(90deg, #9c27b0 0%, #d05ce3 100%)",borderRadius:"7px",transition:"width 0.3s ease",boxShadow:"0 0 10px rgba(156, 39, 176, 0.5)",position:"relative",overflow:"hidden"},children:r.jsx("div",{style:{position:"absolute",top:0,left:"-100%",width:"100%",height:"100%",background:"linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent)",animation:"shimmer 2s infinite"}})})})]}),r.jsxs("div",{style:{fontSize:"11px",color:"#666",textAlign:"right",marginTop:"2px"},children:[Math.floor(e.currentExp||0)," / ",Math.floor(e.maxExp||100)]}),e.cultivationSpeed&&r.jsxs("div",{style:{marginTop:"8px",padding:"6px 10px",background:"rgba(156, 39, 176, 0.05)",borderRadius:"6px",border:"1px solid rgba(156, 39, 176, 0.1)"},children:[r.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"4px"},children:[r.jsx("span",{style:{fontSize:"11px",color:"#666"},children:":"}),r.jsxs("span",{style:{fontSize:"11px",fontWeight:"bold",color:"#9c27b0"},children:[Math.floor(e.cultivationSpeed)," /"]})]}),(()=>{const R=e.maxExp-e.currentExp,b=Math.ceil(R/e.cultivationSpeed);return r.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[r.jsx("span",{style:{fontSize:"11px",color:"#666"},children:":"}),r.jsx("span",{style:{fontSize:"11px",fontWeight:"bold",color:b>12?"#ff9800":"#4caf50"},children:b>12?`${Math.floor(b/12)}`:`${b}`})]})})()]}),(()=>{var I;const R=((I=e.relationship)==null?void 0:I.affection)||0;let b=0,_="";return R>=80?(b=50,_=""):R>=60?(b=30,_=""):R>=40?(b=20,_=""):R>=20&&(b=10,_=""),b>0?r.jsxs("div",{style:{marginTop:"8px",padding:"6px 10px",background:"linear-gradient(135deg, rgba(244, 81, 108, 0.1), rgba(240, 98, 146, 0.1))",borderRadius:"6px",border:"1px solid rgba(244, 81, 108, 0.2)",fontSize:"11px",color:"#f4516c",display:"flex",alignItems:"center",justifyContent:"space-between"},children:[r.jsxs("span",{children:[" ",_,""]}),r.jsxs("span",{style:{fontWeight:"bold"},children:["+",b,"% "]})]}):null})()]})]}),r.jsxs("div",{style:ut.personalityBox,children:[r.jsx("span",{children:""}),typeof e.personality=="object"&&e.personality!==null&&"label"in e.personality?r.jsxs("span",{style:ut.tag,children:[e.personality.label," (",e.personality.desc,")"]}):Array.isArray(e.personality)?r.jsx("div",{style:{display:"flex",gap:"5px",marginTop:"5px"},children:e.personality.map((R,b)=>r.jsx("span",{style:ut.tag,children:R},b))}):r.jsx("span",{style:ut.tag,children:""})]}),a&&r.jsxs("button",{onClick:()=>a(e),style:{width:"100%",padding:"12px",marginTop:"15px",background:"linear-gradient(135deg, #667eea 0%, #764ba2 100%)",color:"white",border:"none",borderRadius:"8px",fontSize:"14px",fontWeight:"bold",cursor:"pointer",transition:"all 0.3s",boxShadow:"0 4px 12px rgba(102, 126, 234, 0.3)"},onMouseOver:R=>{R.currentTarget.style.transform="translateY(-2px)",R.currentTarget.style.boxShadow="0 6px 16px rgba(102, 126, 234, 0.4)"},onMouseOut:R=>{R.currentTarget.style.transform="translateY(0)",R.currentTarget.style.boxShadow="0 4px 12px rgba(102, 126, 234, 0.3)"},children:[" ",e.name,""]}),r.jsx("div",{style:{marginTop:"10px"},children:r.jsx("button",{onClick:()=>{l&&window.showConfirm&&window.showConfirm(` ${e.name} `,()=>l(e.id))},style:{width:"100%",padding:"12px",marginTop:"10px",background:"linear-gradient(135deg, #e53935 0%, #c62828 100%)",color:"white",border:"none",borderRadius:"8px",fontSize:"14px",cursor:"pointer"},children:" "})})]}):c==="CHAT"?r.jsx("div",{style:ut.chatWrapper,children:(()=>{const R=localStorage.getItem("game_api_key"),b=localStorage.getItem("game_api_url");return!R||!b?r.jsxs("div",{style:ut.noApiHint,children:[r.jsx("div",{style:{fontSize:"48px",marginBottom:"20px"},children:""}),r.jsx("h3",{children:""}),r.jsxs("p",{children:[" AI API  ",e.name," "]}),r.jsxs("div",{style:{marginTop:"20px",padding:"15px",background:"rgba(255, 255, 255, 0.7)",borderRadius:"8px",fontSize:"13px",lineHeight:"1.6"},children:[r.jsx("strong",{children:""}),r.jsx("br",{}),"1. ",r.jsx("br",{}),"2. AI  API Key  URL",r.jsx("br",{}),"3.  DeepSeek",r.jsx("br",{}),"4. ",r.jsx("br",{}),"5.  NPC "]})]}):r.jsx(WE,{npc:e,player:s,apiKey:R,apiUrl:b,gameState:C})})()}):null})]})]})})},ut={overlay:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0,0,0,0.5)",display:"flex",justifyContent:"center",alignItems:"center",zIndex:1e3,backdropFilter:"blur(2px)"},modalWrapper:{position:"relative",width:"min(600px, calc(100vw - 32px))"},modal:{width:"100%",maxWidth:"600px",height:"80vh",backgroundColor:"#f5f0e8",borderRadius:"16px",overflow:"hidden",display:"flex",flexDirection:"column",position:"relative",boxShadow:"0 8px 30px rgba(0,0,0,0.2)",border:"2px solid #d7ccc8"},closeBtn:{position:"absolute",top:"-18px",left:"-18px",border:"none",background:"#ffffff",fontSize:"24px",cursor:"pointer",color:"#8d6e63",width:"44px",height:"44px",borderRadius:"50%",display:"flex",alignItems:"center",justifyContent:"center",boxShadow:"0 12px 30px rgba(0,0,0,0.25)",zIndex:5},content:{display:"flex",flex:1,height:"calc(100% - 40px)",overflow:"hidden"},leftCol:{width:"100%",backgroundColor:"#faf8f5",padding:"25px",display:"flex",flexDirection:"column",overflowY:"auto"},desc:{fontSize:"14px",color:"#5d4037",fontStyle:"italic",marginBottom:"20px",lineHeight:"1.8",padding:"15px",background:"#f5f0e8",borderRadius:"10px",border:"1px solid #e0e0e0",fontFamily:"Microsoft YaHei, SimSun, serif"},tag:{fontSize:"13px",background:"linear-gradient(135deg, #d7ccc8 0%, #bcaaa4 100%)",padding:"4px 12px",borderRadius:"15px",color:"#3e2723",boxShadow:"0 2px 4px rgba(0,0,0,0.05)"},identityTag:{background:"linear-gradient(135deg, #795548 0%, #5d4037 100%)",color:"white",padding:"4px 10px",borderRadius:"8px",fontSize:"11px",marginRight:"8px",boxShadow:"0 2px 4px rgba(0,0,0,0.1)"},rareTag:{background:"linear-gradient(45deg, #FFD700, #FFA500)",color:"white",padding:"4px 10px",borderRadius:"8px",fontSize:"11px",marginLeft:"5px",fontWeight:"bold",boxShadow:"0 2px 4px rgba(0,0,0,0.1)"},attrBox:{background:"linear-gradient(135deg, #ffffff 0%, #f5f0e8 100%)",padding:"18px",borderRadius:"12px",marginBottom:"20px",border:"1px solid #e0e0e0",boxShadow:"0 2px 8px rgba(0,0,0,0.05)"},letterToggleRow:{marginTop:"14px",padding:"10px 0",borderTop:"1px dashed rgba(0,0,0,0.08)",display:"flex",alignItems:"center",justifyContent:"space-between",gap:"12px"},letterToggleBtn:{border:"none",color:"#fff",padding:"6px 14px",borderRadius:"999px",fontSize:"12px",fontWeight:"bold",cursor:"pointer",transition:"transform 0.2s ease",boxShadow:"0 2px 6px rgba(0,0,0,0.15)"},letterToggleHint:{fontSize:"11px",color:"#8d6e63",marginTop:"4px"},personalityBox:{marginTop:"auto",padding:"15px",background:"linear-gradient(135deg, #ffffff 0%, #f5f0e8 100%)",borderRadius:"12px",fontSize:"13px",border:"1px solid #e0e0e0",boxShadow:"0 2px 8px rgba(0,0,0,0.05)"},tabBar:{display:"flex",borderBottom:"2px solid #d7ccc8",background:"linear-gradient(180deg, #f5f0e8 0%, #ebe6dd 100%)"},tab:{flex:1,padding:"15px",border:"none",cursor:"pointer",fontSize:"14px",transition:"all 0.3s",borderRadius:"0"},chatWrapper:{width:"100%",height:"100%",display:"flex",flexDirection:"column",padding:"20px",boxSizing:"border-box"},noApiHint:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",height:"100%",textAlign:"center",padding:"40px",color:"#5d4037"}},qE=e=>e>=90?"#FFD700":e>=80?"#9C27B0":e>=60?"#2196F3":"#4CAF50",KE=e=>({:"#FFD700",:"#9C27B0",:"#2196F3",:"#4CAF50",:"#9E9E9E",:"#00BCD4"})[e]||"#9E9E9E",Hy=(e,t,n={})=>e==="PLAYER"?0:n[e]==="PLAYER"||!t.find(o=>o.id===n[e])?1:1+Hy(n[e],t,n),Wy=({node:e,allChildren:t,onNodeClick:n,generation:s=0,parentMap:o={}})=>{var d;const i=t.filter(u=>u.parentId===e.id),a=s+1,l=a<=2;return r.jsxs("div",{style:Jt.nodeWrapper,children:[r.jsxs("div",{style:{...Jt.card,borderColor:e.id==="PLAYER"||((d=e.stats)==null?void 0:d.aptitude)>=80?"#d4af37":"#dcd6cc",cursor:e.isPregnant?"default":"pointer"},onClick:()=>{e.isPregnant||n(e)},children:[r.jsx("div",{style:Jt.avatar,children:e.gender===""?"":""}),r.jsx("div",{style:Jt.name,children:e.name}),e.id!=="PLAYER"&&r.jsxs(r.Fragment,{children:[r.jsx("div",{style:Jt.tier,children:e.tierTitle||""}),e.spouse&&r.jsx("div",{style:Jt.spouseTag,children:" "}),e.isPregnant&&r.jsxs("div",{style:Jt.pregnantTag,children:[" ",e.gender===""&&r.jsx("span",{style:{fontSize:"9px"},children:"()"})]})]})]}),i.length>0&&r.jsx("div",{style:Jt.lineDown}),i.length>0&&r.jsx("div",{style:Jt.childrenContainer,children:l?i.map((u,p)=>r.jsxs("div",{style:Jt.childWrapper,children:[r.jsx("div",{style:{...Jt.lineTop,left:p===0?"50%":"0",width:p===0||p===i.length-1?"50%":"100%",display:i.length===1?"none":"block"}}),r.jsx(Wy,{node:u,allChildren:t,onNodeClick:n,generation:a,parentMap:o})]},u.id)):r.jsxs("div",{style:Jt.generationCounter,children:[" ",i.length,""]})})]})},QE=({player:e,children:t,pregnantNpcs:n=[],onChildClick:s,generation3Plus:o=[]})=>{const i=Array.isArray(o)?o:[],[a,l]=y.useState(1),[d,u]=y.useState({x:0,y:0}),[p,c]=y.useState(!1),[f,x]=y.useState({x:0,y:0}),[C,w]=y.useState(null),[S,h]=y.useState(null),g=y.useRef(null),v=z=>{z.cancelable&&z.preventDefault();const ne=z.deltaY*-.001,Q=Math.min(Math.max(.2,a+ne),3);l(Q)},j=z=>{c(!0),x({x:z.clientX-d.x,y:z.clientY-d.y})},R=z=>{p&&u({x:z.clientX-f.x,y:z.clientY-f.y})},b=()=>{c(!1)},_=z=>{const ne=z[0].clientX-z[1].clientX,Q=z[0].clientY-z[1].clientY;return Math.sqrt(ne*ne+Q*Q)},I=z=>{z.touches.length===1?(c(!0),w({x:z.touches[0].clientX-d.x,y:z.touches[0].clientY-d.y})):z.touches.length===2&&h(_(z.touches))},k=z=>{if(z.cancelable&&z.preventDefault(),z.touches.length===1&&p&&C)u({x:z.touches[0].clientX-C.x,y:z.touches[0].clientY-C.y});else if(z.touches.length===2&&S){const ne=_(z.touches),Q=ne/S,se=Math.min(Math.max(.2,a*Q),3);l(se),h(ne)}},T=()=>{c(!1),w(null),h(null)},N={id:"PLAYER",name:e.name+" ()",gender:e.gender,parentId:null},K=n.map((z,ne)=>({id:`embryo-${z.id||ne}`,name:`${z.name}`,gender:z.gender||"",parentId:"PLAYER",generation:1,tierTitle:"",isPregnant:!0})),L=[...t,...K].map(z=>({...z,parentId:z.parentId||"PLAYER"})),B={};L.forEach(z=>{z.id&&(B[z.id]=z.parentId)});const W={};return L.forEach(z=>{if(!z.isPregnant){const ne=Hy(z.id,L,B);W[ne]=(W[ne]||0)+1}}),i.forEach(z=>{const ne=z.generation;W[ne]=(W[ne]||0)+1}),r.jsxs("div",{ref:g,style:Jt.viewport,onWheel:v,onMouseDown:j,onMouseMove:R,onMouseUp:b,onMouseLeave:b,onTouchStart:I,onTouchMove:k,onTouchEnd:T,onTouchCancel:T,children:[Object.keys(W).length>0&&r.jsx("div",{style:Jt.statsPanel,children:Object.keys(W).sort((z,ne)=>z-ne).map(z=>r.jsxs("span",{style:Jt.statItem,children:["",z,": ",r.jsx("strong",{children:W[z]}),""]},z))}),r.jsxs("div",{style:Jt.controls,children:[r.jsx("button",{onClick:()=>l(Math.min(3,a+.1)),children:""}),r.jsx("button",{onClick:()=>l(Math.max(.2,a-.1)),children:""}),r.jsx("button",{onClick:()=>{l(1),u({x:0,y:0})},children:""})]}),r.jsx("div",{style:{transform:`translate(${d.x}px, ${d.y}px) scale(${a})`,transformOrigin:"top center",transition:p?"none":"transform 0.1s ease-out",...Jt.treeCanvas},children:r.jsx(Wy,{node:N,allChildren:L,onNodeClick:z=>z.id!=="PLAYER"&&s(z),generation:0,parentMap:B})})]})},Jt={viewport:{width:"100%",height:"650px",overflow:"hidden",background:"#f0f4f8",position:"relative",border:"3px double #dcd6cc",borderRadius:"12px",cursor:"grab"},controls:{position:"absolute",top:10,right:10,zIndex:10,display:"flex",gap:"5px"},statsPanel:{position:"absolute",top:10,left:10,zIndex:10,background:"rgba(255,255,255,0.95)",padding:"8px 12px",borderRadius:"8px",border:"2px solid #dcd6cc",boxShadow:"0 2px 6px rgba(0,0,0,0.1)",display:"flex",flexDirection:"column",gap:"4px",fontSize:"14px",maxHeight:"200px",overflowY:"auto"},statItem:{display:"block",color:"#333",lineHeight:"1.4"},treeCanvas:{display:"flex",justifyContent:"center",paddingTop:"50px",width:"max-content",minWidth:"100%"},nodeWrapper:{display:"flex",flexDirection:"column",alignItems:"center"},card:{width:"100px",padding:"8px",background:"#fff",border:"2px solid #ccc",borderRadius:"8px",textAlign:"center",cursor:"pointer",boxShadow:"0 2px 5px rgba(0,0,0,0.1)",position:"relative",zIndex:2},childrenContainer:{display:"flex",paddingTop:"20px"},childWrapper:{display:"flex",flexDirection:"column",alignItems:"center",position:"relative",padding:"0 10px"},lineDown:{width:"2px",height:"20px",background:"#ccc"},lineTop:{position:"absolute",top:0,height:"20px",borderTop:"2px solid #ccc",zIndex:1},avatar:{fontSize:"24px"},name:{fontSize:"12px",fontWeight:"bold",margin:"2px 0"},tier:{fontSize:"10px",color:"#666"},spouseTag:{fontSize:"10px",color:"#e91e63",marginTop:"2px"},pregnantTag:{fontSize:"10px",color:"#ff9800",marginTop:"2px"},generationCounter:{fontSize:"14px",fontWeight:"bold",color:"#2e7d32",padding:"10px 15px",backgroundColor:"#e8f5e9",borderRadius:"8px",marginTop:"10px",border:"2px dashed #2e7d32",display:"flex",alignItems:"center",justifyContent:"center"}},JE=[{value:"age",label:""},{value:"aptitude",label:""},{value:"cultivation",label:""},{value:"rank",label:""},{value:"name",label:""}],wl=10,XE=["","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","",""],Rg=(e="")=>{if(!e)return 0;const t=XE.indexOf(e);return t>=0?t:0},_g=e=>{if(!e)return 999;const t=Rf.find(n=>n.name===e);return t?t.id:999},ZE=({children:e,pregnantNpcs:t=[],onChildClick:n,onToggleFavorite:s})=>{const[o,i]=y.useState("age"),[a,l]=y.useState("all"),[d,u]=y.useState("all"),[p,c]=y.useState("all"),[f,x]=y.useState(!1),[C,w]=y.useState(1),[S,h]=y.useTransition(),g=y.useCallback(T=>{h(()=>i(T))},[h]);y.useEffect(()=>{w(1)},[o,a,d,p,f,e.length]);const v=y.useMemo(()=>new Set(t.map(T=>T.id)),[t]),j=y.useMemo(()=>{const T=new Map,N=new Map(e.map(L=>[L.id,L])),K=L=>{if(!L)return 1;if(T.has(L.id))return T.get(L.id);if(!L.parentId||L.parentId==="PLAYER")return T.set(L.id,1),1;const B=N.get(L.parentId),W=B?K(B):0,z=Math.max(1,W+1);return T.set(L.id,z),z};return e.forEach(L=>K(L)),T},[e]),R=y.useCallback(T=>T&&j.get(T.id)||1,[j]),b=y.useMemo(()=>{let T=[...e];return f&&(T=T.filter(N=>N.isFavorite)),a!=="all"&&(T=T.filter(N=>N.gender===a)),d!=="all"&&(T=T.filter(N=>{const K=R(N);return d==="3+"?K>=3:K===parseInt(d)})),p!=="all"&&(T=T.filter(N=>p==="married"?N.spouse:p==="single"?!N.spouse:p==="pregnant"?v.has(N.id):p==="cultivating"?N.sect:!0)),T.sort((N,K)=>{var L,B;switch(o){case"age":return N.age-K.age;case"aptitude":return(((L=K.stats)==null?void 0:L.aptitude)||0)-(((B=N.stats)==null?void 0:B.aptitude)||0);case"cultivation":const W=Rg(N.tier||""),z=Rg(K.tier||"");if(W!==z)return z-W;const ne=N.currentExp||0;return(K.currentExp||0)-ne;case"rank":const se=_g(N.rank),ye=_g(K.rank);return se===999&&ye===999?0:se===999?1:ye===999?-1:ye-se;case"name":return N.name.localeCompare(K.name,"zh-CN");default:return 0}}),T},[e,o,a,d,p,v,f,j]),_=y.useMemo(()=>Math.max(1,Math.ceil(b.length/wl)),[b.length]);y.useEffect(()=>{w(T=>Math.min(T,_))},[_]);const I=y.useMemo(()=>{const T=(C-1)*wl;return b.filter(K=>R(K)<=2).slice(T,T+wl)},[b,C]),k=y.useMemo(()=>({total:e.length,male:e.filter(T=>T.gender==="").length,female:e.filter(T=>T.gender==="").length,married:e.filter(T=>T.spouse).length,pregnant:v.size,cultivating:e.filter(T=>T.sect).length,genius:e.filter(T=>{var N;return(((N=T.stats)==null?void 0:N.aptitude)||0)>=80}).length,favorite:e.filter(T=>T.isFavorite).length}),[e,v]);return r.jsxs("div",{style:je.container,children:[r.jsxs("div",{style:je.header,children:[r.jsxs("h3",{style:je.title,children:[" (1-2: ",b.filter(T=>R(T)<=2).length," / : ",k.total,")"]}),r.jsx("div",{style:je.statsBar,children:r.jsxs("span",{style:je.statItem,children:[": ",b.filter(T=>R(T)>2).length]})}),r.jsxs("div",{style:je.statsBar,children:[r.jsxs("span",{style:je.statItem,children:[" ",k.male]}),r.jsxs("span",{style:je.statItem,children:[" ",k.female]}),r.jsxs("span",{style:je.statItem,children:[" ",k.married]}),r.jsxs("span",{style:je.statItem,children:[" ",k.pregnant]}),r.jsxs("span",{style:je.statItem,children:[" ",k.cultivating]}),r.jsxs("span",{style:je.statItem,children:[" ",k.genius]}),r.jsxs("span",{style:je.statItem,children:[" ",k.favorite]})]})]}),r.jsxs("div",{style:je.controls,children:[r.jsxs("div",{style:je.sortRow,children:[r.jsx("span",{style:je.label,children:":"}),r.jsx("div",{style:je.segmentedRow,children:JE.map(T=>r.jsx("button",{type:"button",onClick:()=>g(T.value),style:{...je.segmentButton,...o===T.value?je.segmentButtonActive:{}},children:T.label},T.value))}),S&&r.jsx("span",{style:je.pendingHint,children:"..."}),r.jsx("button",{type:"button",onClick:()=>x(T=>!T),style:{...je.favoriteToggle,...f?je.favoriteToggleActive:{}},children:f?" ":" "})]}),r.jsxs("div",{style:je.filterRow,children:[r.jsxs("div",{style:je.controlGroup,children:[r.jsx("label",{style:je.label,children:":"}),r.jsxs("select",{value:a,onChange:T=>l(T.target.value),style:je.select,children:[r.jsx("option",{value:"all",children:""}),r.jsx("option",{value:"",children:""}),r.jsx("option",{value:"",children:""})]})]}),r.jsxs("div",{style:je.controlGroup,children:[r.jsx("label",{style:je.label,children:":"}),r.jsxs("select",{value:d,onChange:T=>u(T.target.value),style:je.select,children:[r.jsx("option",{value:"all",children:""}),r.jsx("option",{value:"1",children:""}),r.jsx("option",{value:"2",children:""}),r.jsx("option",{value:"3+",children:"+"})]})]}),r.jsxs("div",{style:je.controlGroup,children:[r.jsx("label",{style:je.label,children:":"}),r.jsxs("select",{value:p,onChange:T=>c(T.target.value),style:je.select,children:[r.jsx("option",{value:"all",children:""}),r.jsx("option",{value:"married",children:""}),r.jsx("option",{value:"single",children:""}),r.jsx("option",{value:"pregnant",children:""}),r.jsx("option",{value:"cultivating",children:""})]})]})]})]}),t.length>0&&p!=="single"&&p!=="cultivating"&&r.jsxs("div",{style:je.section,children:[r.jsxs("h4",{style:je.sectionTitle,children:["  (",t.length,")"]}),r.jsx("div",{style:je.embryoList,children:t.map(T=>r.jsxs("div",{style:je.embryoCard,children:[r.jsx("div",{style:je.embryoIcon,children:""}),r.jsxs("div",{style:je.embryoInfo,children:[r.jsx("div",{style:je.embryoName,children:"..."}),r.jsxs("div",{style:je.embryoDetail,children:[": ",T.name," ",T.gender===""&&r.jsx("span",{style:{fontSize:"10px",color:"#ff6b6b"},children:"()"})]}),r.jsx("div",{style:je.progressBar,children:r.jsx("div",{style:{...je.progressFill,width:`${(T.pregnancyProgress||0)*10}%`}})}),r.jsxs("div",{style:je.embryoProgress,children:[T.pregnancyProgress||0,"/9"]})]})]},`embryo-${T.id}`))})]}),r.jsx("div",{style:je.listContainer,children:b.length===0?r.jsxs("div",{style:je.emptyState,children:[r.jsx("div",{style:je.emptyIcon,children:""}),r.jsx("div",{style:je.emptyText,children:""})]}):I.map(T=>{var B,W,z;const N=R(T),K=v.has(T.id),L=T.influenceProfile;return r.jsxs("div",{style:je.childCard,onClick:()=>n(T),children:[s&&r.jsx("button",{type:"button",title:T.isFavorite?"":"",style:{...je.favoriteButton,...T.isFavorite?je.favoriteButtonActive:{}},onClick:ne=>{ne.stopPropagation(),s(T.id)},children:T.isFavorite?"":""}),r.jsxs("div",{style:je.avatarSection,children:[T.age===0?r.jsx("div",{style:je.babyIcon,children:""}):T.age<15?r.jsx("div",{style:je.babyIcon,children:""}):r.jsx(Vr,{dna:T.avatar,gender:T.gender,size:60}),r.jsx("div",{style:je.genderBadge,"data-gender":T.gender,children:T.gender===""?"":""})]}),r.jsxs("div",{style:je.infoSection,children:[r.jsxs("div",{style:je.childName,children:[r.jsx("span",{style:{color:qE(((B=T.stats)==null?void 0:B.aptitude)||0)},children:T.name}),r.jsxs("span",{style:je.generationBadge,children:["",N,""]}),(((W=T.stats)==null?void 0:W.aptitude)||0)>=80&&r.jsx("span",{style:je.geniusBadge,children:""}),T.isFavorite&&r.jsx("span",{style:je.favoriteBadge,children:" "})]}),r.jsxs("div",{style:je.infoRow,children:[r.jsxs("span",{style:je.infoItem,children:[": ",Math.floor(T.age),""]}),r.jsx("span",{style:je.infoItem,children:T.tierTitle||""}),T.isTested&&T.spiritRoot&&r.jsx("span",{style:{...je.infoItem,color:KE(T.spiritRoot.type)},children:T.spiritRoot.type})]}),r.jsxs("div",{style:je.infoRow,children:[r.jsxs("span",{style:je.infoItem,children:[": ",Math.floor(((z=T.stats)==null?void 0:z.aptitude)||0)]}),T.rank&&r.jsxs("span",{style:je.rankBadge,children:[" ",T.rank]}),T.sect&&r.jsxs("span",{style:je.sectBadge,children:[" ",T.sect.name]}),T.spouse&&r.jsxs("span",{style:je.spouseBadge,children:[" ",T.spouse.name]}),K&&r.jsx("span",{style:je.pregnantBadge,children:" "})]}),L&&r.jsxs("div",{style:je.influenceRow,children:[r.jsx("span",{style:{...je.influenceBadge,borderColor:L.color},children:L.label}),r.jsx("div",{style:je.influenceMeter,children:r.jsx("div",{style:{...je.influenceMeterFill,width:`${Math.min(100,Math.round((L.progress||0)*100))}%`,background:L.color}})}),r.jsx("span",{style:je.influenceScore,children:Math.floor(L.score)})]}),T.cultivationManual&&r.jsxs("div",{style:je.manualInfo,children:[" ",T.cultivationManual.name]})]}),r.jsx("div",{style:je.arrowSection,children:""})]},T.id)})}),b.length>wl&&r.jsxs("div",{style:je.pagination,children:[r.jsx("button",{style:{...je.pageBtn,opacity:C===1?.6:1},onClick:()=>w(T=>Math.max(1,T-1)),disabled:C===1,children:""}),r.jsxs("span",{style:je.pageInfo,children:[" ",C," / ",_," "]}),r.jsx("button",{style:{...je.pageBtn,opacity:C>=_?.6:1},onClick:()=>w(T=>Math.min(_,T+1)),disabled:C>=_,children:""})]})]})},je={container:{padding:"15px",backgroundColor:"#f5f0e8",borderRadius:"12px",border:"2px solid #8d6e63",maxHeight:"800px",height:"100%",display:"flex",flexDirection:"column",overflow:"hidden"},header:{marginBottom:"15px"},title:{margin:"0 0 10px 0",fontSize:"18px",fontWeight:"bold",color:"#5d4037"},statsBar:{display:"flex",gap:"12px",flexWrap:"wrap"},controls:{display:"flex",flexDirection:"column",gap:"12px",marginBottom:"15px",padding:"10px",backgroundColor:"rgba(255,255,255,0.5)",borderRadius:"8px"},sortRow:{display:"flex",flexWrap:"wrap",alignItems:"center",gap:"10px"},segmentedRow:{display:"flex",flexWrap:"wrap",gap:"6px"},pendingHint:{fontSize:"11px",color:"#5d4037",fontStyle:"italic"},segmentButton:{border:"1px solid #8d6e63",borderRadius:"16px",padding:"4px 10px",fontSize:"12px",backgroundColor:"white",color:"#5d4037",cursor:"pointer",transition:"all 0.2s ease"},segmentButtonActive:{backgroundColor:"#8d6e63",color:"white",boxShadow:"0 2px 6px rgba(0,0,0,0.2)"},favoriteToggle:{border:"1px dashed #c2185b",borderRadius:"16px",padding:"4px 12px",fontSize:"12px",cursor:"pointer",backgroundColor:"white",color:"#c2185b",fontWeight:"bold"},favoriteToggleActive:{backgroundColor:"#c2185b",color:"white"},filterRow:{display:"flex",flexWrap:"wrap",gap:"10px"},controlGroup:{display:"flex",alignItems:"center",gap:"5px"},label:{fontSize:"12px",fontWeight:"bold",color:"#5d4037"},select:{padding:"4px 8px",borderRadius:"4px",border:"1px solid #8d6e63",backgroundColor:"white",fontSize:"12px",cursor:"pointer"},influenceRow:{display:"flex",alignItems:"center",gap:"8px",marginTop:"6px"},influenceBadge:{borderRadius:"999px",border:"1px solid #ccc",padding:"2px 8px",fontSize:"11px",fontWeight:600},influenceMeter:{flex:1,height:"6px",backgroundColor:"#e0e0e0",borderRadius:"999px",overflow:"hidden"},influenceMeterFill:{height:"100%"},influenceScore:{fontSize:"12px",fontWeight:700,color:"#37474f"},section:{marginBottom:"15px"},sectionTitle:{margin:"0 0 10px 0",fontSize:"14px",fontWeight:"bold",color:"#d81b60"},embryoList:{display:"flex",gap:"10px",flexWrap:"wrap",marginBottom:"10px"},embryoCard:{display:"flex",alignItems:"center",gap:"10px",padding:"10px",backgroundColor:"white",borderRadius:"8px",border:"2px dashed #d81b60",minWidth:"200px"},embryoIcon:{fontSize:"32px"},embryoInfo:{flex:1},embryoName:{fontWeight:"bold",color:"#d81b60",marginBottom:"4px"},embryoDetail:{fontSize:"11px",color:"#666",marginBottom:"4px"},progressBar:{height:"6px",backgroundColor:"#e0e0e0",borderRadius:"3px",overflow:"hidden",marginBottom:"4px"},progressFill:{height:"100%",backgroundColor:"#d81b60",transition:"width 0.3s ease"},embryoProgress:{fontSize:"10px",color:"#666"},listContainer:{flex:1,overflowY:"auto",WebkitOverflowScrolling:"touch",display:"flex",flexDirection:"column",gap:"10px",minHeight:0},childCard:{display:"flex",gap:"12px",padding:"12px",backgroundColor:"white",borderRadius:"10px",border:"2px solid #e0e0e0",cursor:"pointer",transition:"all 0.2s ease",boxShadow:"0 2px 4px rgba(0,0,0,0.05)",position:"relative"},favoriteButton:{position:"absolute",top:"10px",right:"10px",border:"none",background:"transparent",fontSize:"18px",cursor:"pointer",color:"#d7ccc8",transition:"transform 0.2s ease, color 0.2s ease"},favoriteButtonActive:{color:"#ffb300",textShadow:"0 0 6px rgba(255,179,0,0.6)"},avatarSection:{position:"relative",flexShrink:0},babyIcon:{width:"60px",height:"60px",display:"flex",alignItems:"center",justifyContent:"center",fontSize:"40px",backgroundColor:"#f5f5f5",borderRadius:"50%"},genderBadge:{position:"absolute",bottom:"-4px",right:"-4px",width:"20px",height:"20px",borderRadius:"50%",display:"flex",alignItems:"center",justifyContent:"center",fontSize:"12px",fontWeight:"bold",color:"white",backgroundColor:"#4285F4",border:"2px solid white"},infoSection:{flex:1,display:"flex",flexDirection:"column",gap:"6px",minWidth:0},childName:{display:"flex",alignItems:"center",gap:"6px",fontSize:"14px",fontWeight:"bold",flexWrap:"wrap"},generationBadge:{fontSize:"10px",padding:"2px 6px",backgroundColor:"#e3f2fd",color:"#1976d2",borderRadius:"10px",fontWeight:"normal"},geniusBadge:{fontSize:"10px",padding:"2px 6px",backgroundColor:"#fff3e0",color:"#f57c00",borderRadius:"10px",fontWeight:"normal"},favoriteBadge:{fontSize:"10px",padding:"2px 6px",backgroundColor:"#fff8e1",color:"#ff8f00",borderRadius:"10px",fontWeight:"bold"},infoRow:{display:"flex",gap:"8px",flexWrap:"wrap",alignItems:"center"},infoItem:{fontSize:"11px",color:"#666"},sectBadge:{fontSize:"10px",padding:"2px 6px",backgroundColor:"#e8f5e9",color:"#2e7d32",borderRadius:"10px",fontWeight:"bold"},rankBadge:{fontSize:"10px",padding:"2px 6px",backgroundColor:"#f3e5f5",color:"#6a1b9a",borderRadius:"10px",fontWeight:"bold"},spouseBadge:{fontSize:"10px",padding:"2px 6px",backgroundColor:"#fce4ec",color:"#c2185b",borderRadius:"10px",fontWeight:"bold"},pregnantBadge:{fontSize:"10px",padding:"2px 6px",backgroundColor:"#fff3e0",color:"#f57c00",borderRadius:"10px",fontWeight:"bold"},manualInfo:{fontSize:"11px",color:"#7b1fa2",fontWeight:"bold"},arrowSection:{display:"flex",alignItems:"center",fontSize:"20px",color:"#bbb",flexShrink:0},emptyState:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",padding:"40px",color:"#999"},emptyIcon:{fontSize:"48px",marginBottom:"10px"},emptyText:{fontSize:"14px"}},Uy=document.createElement("style");Uy.textContent=`
  [data-gender=""] {
    background-color: #4285F4 !important;
  }
  [data-gender=""] {
    background-color: #EA4335 !important;
  }
  .childCard:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(0,0,0,0.15);
    border-color: #8d6e63;
  }
  
  /*  */
  @media (max-width: 768px) {
    /*  */
    .listContainer {
      max-height: calc(100vh - 300px) !important;
      -webkit-overflow-scrolling: touch;
    }
  }
`;document.head.appendChild(Uy);const ej=({records:e=[],onMemorialClick:t})=>{const n=y.useMemo(()=>{if(!e.length)return{avgAge:0,maxGeneration:0};const s=e.reduce((i,a)=>i+(a.ageAtDeath||0),0),o=Math.max(...e.map(i=>i.generation||1));return{avgAge:Math.round(s/e.length*10)/10,maxGeneration:o}},[e]);return r.jsxs("div",{style:ln.container,children:[r.jsxs("div",{style:ln.banner,children:[r.jsxs("div",{children:["   ",e.length," "]}),e.length>0&&r.jsxs("div",{style:ln.bannerStats,children:[r.jsxs("span",{children:[" ",n.avgAge||""," "]}),r.jsxs("span",{children:[" ",n.maxGeneration||1,""]})]})]}),e.length===0?r.jsx("div",{style:ln.empty,children:""}):r.jsx("div",{style:ln.grid,children:e.map(s=>{var o;return r.jsxs("button",{type:"button",style:{...ln.tomb,...s.isExiled?ln.tombExiled:{}},onClick:()=>t&&t(s),children:[r.jsxs("div",{style:ln.tombHeader,children:[r.jsx("span",{style:ln.icon,children:s.isExiled?"":""}),r.jsxs("div",{children:[r.jsx("div",{style:ln.name,children:s.name}),r.jsxs("div",{style:ln.meta,children:[s.isExiled?"":`${s.generation||1}`,"  ",s.tierTitle||""]})]})]}),!s.isExiled&&r.jsxs("div",{style:ln.detail,children:[" ",s.deathYear||""," ",s.deathMonth||1,"   ",s.ageAtDeath??""," "]}),s.deathReason&&r.jsxs("div",{style:ln.detail,children:[s.isExiled?"":"",s.deathReason]}),((o=s.sect)==null?void 0:o.name)&&!s.isExiled&&r.jsxs("div",{style:ln.detail,children:[s.sect.name,s.rank?`  ${s.rank}`:""]}),r.jsx("p",{style:ln.epitaph,children:s.epitaph||""}),typeof s.descendants=="number"&&!s.isExiled&&r.jsxs("div",{style:ln.descendants,children:["",s.descendants]})]},s.id)})})]})},ln={container:{width:"100%",height:"100%",background:"#fdf7f2",borderRadius:"12px",border:"2px solid #8d6e63",padding:"15px",display:"flex",flexDirection:"column",gap:"12px"},banner:{background:"linear-gradient(90deg, #efebe9, #f5f0e8)",borderRadius:"10px",padding:"12px 16px",fontWeight:"bold",display:"flex",justifyContent:"space-between",alignItems:"center",color:"#5d4037"},bannerStats:{display:"flex",gap:"16px",fontSize:"12px",color:"#6d4c41"},empty:{flex:1,display:"flex",alignItems:"center",justifyContent:"center",color:"#9e9e9e",fontStyle:"italic"},grid:{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(220px, 1fr))",gap:"12px",overflowY:"auto"},tomb:{display:"flex",flexDirection:"column",alignItems:"stretch",padding:"12px",borderRadius:"10px",border:"1px solid #d7ccc8",background:"#fffefd",textAlign:"left",cursor:"pointer",transition:"transform 0.2s ease, box-shadow 0.2s ease",outline:"none"},tombExiled:{background:"#f5f5f5",border:"1px solid #ccc",opacity:.8},tombHeader:{display:"flex",alignItems:"center",gap:"10px",marginBottom:"8px"},icon:{fontSize:"24px"},name:{fontWeight:"bold",color:"#4e342e"},meta:{fontSize:"12px",color:"#8d6e63"},detail:{fontSize:"12px",color:"#5d4037",marginTop:"4px"},epitaph:{marginTop:"10px",fontSize:"12px",color:"#4e342e",lineHeight:1.5},descendants:{marginTop:"8px",fontSize:"11px",color:"#6d4c41"}},tj=({player:e,children:t,fallenChildren:n=[],exiledChildren:s=[],pregnantNpcs:o=[],onChildClick:i,onToggleFavorite:a,onMemorialClick:l,generation3Plus:d=[]})=>{const[u,p]=y.useState("tree"),c=[...n,...s.map(f=>({...f,isExiled:!0,deathReason:"",epitaph:""}))];return r.jsxs("div",{style:Un.container,children:[r.jsxs("div",{style:Un.viewSwitcher,children:[r.jsx("button",{style:{...Un.viewButton,...u==="tree"?Un.viewButtonActive:{}},onClick:()=>p("tree"),children:" "}),r.jsx("button",{style:{...Un.viewButton,...u==="list"?Un.viewButtonActive:{}},onClick:()=>p("list"),children:" "}),r.jsx("button",{style:{...Un.viewButton,...u==="cemetery"?Un.viewButtonActive:{}},onClick:()=>p("cemetery"),children:" "})]}),r.jsxs("div",{style:{...Un.viewContent,position:"relative"},children:[u==="tree"&&r.jsx(QE,{player:e,children:t,pregnantNpcs:o,onChildClick:i,generation3Plus:d}),u==="list"&&r.jsx(ZE,{children:t,pregnantNpcs:o,onChildClick:i,onToggleFavorite:a}),u==="cemetery"&&r.jsx(ej,{records:c,onMemorialClick:l})]}),u==="tree"&&r.jsx("div",{style:Un.hint,children:" : ,/,/"}),u==="list"&&r.jsx("div",{style:Un.hint,children:" : "}),u==="cemetery"&&r.jsx("div",{style:Un.hint,children:" : "})]})},Un={container:{display:"flex",flexDirection:"column",gap:"15px"},viewSwitcher:{display:"flex",gap:"10px",justifyContent:"center",padding:"10px",backgroundColor:"rgba(255,255,255,0.5)",borderRadius:"12px",border:"2px solid #8d6e63"},viewButton:{padding:"10px 20px",fontSize:"14px",fontWeight:"bold",border:"2px solid #8d6e63",borderRadius:"20px",backgroundColor:"white",color:"#5d4037",cursor:"pointer",transition:"all 0.3s ease",outline:"none",boxShadow:"0 2px 4px rgba(0,0,0,0.1)"},viewButtonActive:{backgroundColor:"#8d6e63",color:"white",transform:"scale(1.05)",boxShadow:"0 4px 8px rgba(0,0,0,0.2)"},viewContent:{flex:1},hint:{textAlign:"center",fontSize:"12px",color:"#666",padding:"8px",backgroundColor:"rgba(255,255,255,0.7)",borderRadius:"8px",border:"1px solid #e0e0e0"}},Ep=document.createElement("style");Ep.textContent=`
  button:hover {
    transform: translateY(-2px);
  }
  button:active {
    transform: translateY(0);
  }
`;document.querySelector("#family-view-wrapper-styles")||(Ep.id="family-view-wrapper-styles",document.head.appendChild(Ep));const nj=e=>{if(!e||!e.sect||!e.sectId||e.sectId==="NONE")return null;const t=e.sect.name,n=e.name,s=e.sectRank||"",o=e.sectStatus||"active",i=[];return o==="active"?(i.push(`${t}${s}${n}`,`${t}${n}`,`${t}${n}`,`${t}${n}`,`${t}${n}`,`${t}${n}`,`${t}${n}`,`${t}${n}`,`${t}${n}`,`${t}${n}`),(s===""||s==="")&&i.push(`${t}${n}`,`${t}${n}`,`${t}${n}`,`${t}${n}`),(t.includes("")||t.includes("")||t.includes(""))&&i.push(`${t}${n}`,`${t}${n}`,`${n}(${t})`)):o==="defected"?i.push(`${t}${n}`,`${t}${s}${n}`,`${t}${n}`,`${n}`,`${t}${n}`,`${n}${t}`):o==="hidden"&&i.push(`${t}${n}`,`${t}${n}`),i.length>0?i[Math.floor(Math.random()*i.length)]:null},rj=e=>{if(!e||e.length<2)return null;const t=e.filter(a=>a.sect&&a.sectId&&a.sectId!=="NONE"&&a.sectStatus==="active");if(t.length<2)return null;const n=t[Math.floor(Math.random()*t.length)];let s=t[Math.floor(Math.random()*t.length)],o=0;for(;s.sectId===n.sectId&&o<10;)s=t[Math.floor(Math.random()*t.length)],o++;if(n.sectId===s.sectId)return null;const i=[`${n.sect.name}${n.name}${s.sect.name}${s.name}`,`${n.name}(${n.sect.name})${s.name}(${s.sect.name})`,`${n.sect.name}${n.name}${s.sect.name}${s.name}`];return i[Math.floor(Math.random()*i.length)]},sj=[{type:"SECT",title:"",templates:["","","","","","","","","",""],probability:.15},{type:"SECT",title:"",templates:["","","","","","","",""],probability:.1},{type:"SECT",title:"",templates:["","","","","","","",""],probability:.12},{type:"SECT",title:"",templates:["","","","","","",""],probability:.08}],oj=[{type:"GENIUS",title:"",templates:["''","''","","''","","","''"],probability:.1},{type:"GENIUS",title:"",templates:["''","","","","",""],probability:.08},{type:"GENIUS",title:"",templates:["''''","''","","","",""],probability:.07},{type:"GENIUS",title:"",templates:["''","","","''","''",""],probability:.05}],ij=[{type:"TREASURE",title:"",templates:["","","","","","","","",""],probability:.12}],aj=[{type:"REALM",title:"",templates:["","","","","","","",""],probability:.1}],lj=[{type:"DISASTER",title:"",templates:["","","","","","","","",""],probability:.08}],cj=[{type:"POLITICS",title:"",templates:["","","","","","","",""],probability:.07}],dj=[{type:"DAILY",title:"",templates:["","","","","","",""],probability:.15}],uj=[{type:"FAMOUS",title:"",templates:["''","","","","''","","",""],probability:.06}],pj=()=>[...sj,...oj,...ij,...aj,...lj,...cj,...dj,...uj],fj=(e,t,n=null,s=[])=>{const o=[],i=xj(e,t);for(let a=0;a<i;a++){const l=gj(e,t);l&&o.push(l)}if(s&&s.length>0&&Math.random()<.3){const a=mj(e,t,s);a&&o.push(a)}return o},mj=(e,t,n)=>{const s=Math.random();let o=null,i=null;if(s<.7){const a=n[Math.floor(Math.random()*n.length)];o=nj(a),i=[a.id]}else o=rj(n);return o?{type:"NPC_RELATED",category:"",title:"",message:o,year:e,month:t,importance:"MEDIUM",timestamp:Date.now(),npcIds:i}:null},gj=(e,t,n)=>{const s=pj(),o=hj(s);if(!o||!o.templates||o.templates.length===0)return null;const i=qe(o.templates);return i?{type:o.type,category:"",title:o.title,message:i,year:e,month:t,importance:yj(o.type),timestamp:Date.now()}:null},hj=e=>{const t=e.reduce((s,o)=>s+(o.probability||0),0);let n=Math.random()*t;for(const s of e)if(n-=s.probability||0,n<=0)return s;return e[0]},xj=(e,t)=>{if(t===1||t===7){const s=Math.random();return s<.3?3:s<.7?2:1}const n=Math.random();return n<.5?1:n<.8?2:0},yj=e=>({DISASTER:5,POLITICS:4,GENIUS:4,SECT:3,REALM:3,TREASURE:3,FAMOUS:2,DAILY:1})[e]||2,bj=(e,t,n,s)=>{const o=t.filter(i=>i.sect&&["TOP","HIGH"].includes(i.sect.level));if(o.length>0&&Math.random()<.2){const i=qe(o),a=i.sect.name,l=[`${a}${i.name}`,`${a}${i.name}`,`${a}${i.name}`];return{type:"SECT",category:"",title:"",message:qe(l),year:n,month:s,importance:3,relatedChild:i.id,timestamp:Date.now()}}return null},vj=e=>({SECT:"",GENIUS:"",TREASURE:"",REALM:"",DISASTER:"",POLITICS:"",DAILY:"",FAMOUS:""})[e]||"",Sj=e=>({SECT:"#4A90E2",GENIUS:"#E74C3C",TREASURE:"#F39C12",REALM:"#9B59B6",DISASTER:"#E67E22",POLITICS:"#16A085",DAILY:"#95A5A6",FAMOUS:"#D4AF37"})[e]||"#7F8C8D",Mg={ready:"#43a047",pending:"#fb8c00"},wj=({summary:e,onUpgrade:t})=>{if(!e)return null;const{currentTier:n,nextTier:s,requirements:o,totals:i,canUpgrade:a,enrichedChildren:l}=e,d=Math.round((i.powerProgress||0)*100),u=[...l].filter(p=>(p.generation||1)<=2).sort((p,c)=>{var f,x;return(((f=c.influence)==null?void 0:f.score)||0)-(((x=p.influence)==null?void 0:x.score)||0)}).slice(0,3);return r.jsxs("div",{style:et.wrapper,children:[r.jsxs("div",{style:et.headerRow,children:[r.jsxs("div",{children:[r.jsx("div",{style:et.label,children:""}),r.jsx("div",{style:et.currentTier,children:(n==null?void 0:n.name)||""}),r.jsx("div",{style:et.desc,children:n==null?void 0:n.desc})]}),r.jsxs("div",{style:et.metricsBox,children:[r.jsxs("div",{style:et.metricItem,children:[r.jsx("span",{style:et.metricLabel,children:""}),r.jsx("strong",{style:et.metricValue,children:i.population})]}),r.jsxs("div",{style:et.metricItem,children:[r.jsx("span",{style:et.metricLabel,children:""}),r.jsx("strong",{style:et.metricValue,children:i.ratingScore})]}),r.jsxs("div",{style:et.metricItem,children:[r.jsx("span",{style:et.metricLabel,children:""}),r.jsx("strong",{style:et.metricValue,children:i.sovereignCount})]}),r.jsxs("div",{style:et.metricItem,children:[r.jsx("span",{style:et.metricLabel,children:""}),r.jsx("strong",{style:et.metricValue,children:i.population-l.length})]})]})]}),s?r.jsxs("div",{style:et.progressSection,children:[r.jsxs("div",{style:et.progressHeader,children:[r.jsxs("div",{children:[r.jsxs("div",{style:et.nextLabel,children:["",s.name]}),r.jsx("small",{style:{color:"#cfd8dc"},children:s.desc})]}),r.jsxs("span",{style:{fontWeight:"bold",color:"#fff"},children:[d,"%"]})]}),r.jsx("div",{style:et.progressBarBg,children:r.jsx("div",{style:{...et.progressBarFill,width:`${Math.min(100,d)}%`}})})]}):r.jsx("div",{style:et.progressSection,children:r.jsx("div",{style:et.nextLabel,children:""})}),(o==null?void 0:o.length)>0&&r.jsx("div",{style:et.requirementsGrid,children:o.map(p=>{const c=p.met;return r.jsxs("div",{style:et.requirementCard,children:[r.jsx("div",{style:{...et.requirementBadge,backgroundColor:c?Mg.ready:Mg.pending},children:c?"":""}),r.jsxs("div",{children:[r.jsx("div",{style:et.requirementLabel,children:p.label}),r.jsxs("div",{style:et.requirementValue,children:[p.current," / ",p.required]})]})]},p.label)})}),u.length>0&&r.jsxs("div",{children:[r.jsx("div",{style:et.label,children:""}),r.jsx("div",{style:et.contributorRow,children:u.map(p=>{var c,f,x;return r.jsxs("div",{style:et.contributorCard,children:[r.jsx("div",{style:{...et.contributorBadge,color:((c=p.influence)==null?void 0:c.color)||"#fff"},children:(f=p.influence)==null?void 0:f.label}),r.jsx("div",{style:et.contributorName,children:p.name}),r.jsx("div",{style:et.contributorScore,children:((x=p.influence)==null?void 0:x.score)||0})]},p.id)})})]}),r.jsx("button",{onClick:t,disabled:!a,style:{...et.actionBtn,background:a?"linear-gradient(120deg, #ffb300, #ff7043)":"#455a64"},children:s?a?` ${s.name}`:"":""})]})},et={wrapper:{background:"linear-gradient(135deg, #1f1f2b 0%, #2f2f44 100%)",borderRadius:16,padding:20,color:"#eceff1",marginBottom:20,border:"1px solid rgba(255,255,255,0.1)"},headerRow:{display:"flex",justifyContent:"space-between",gap:20,flexWrap:"wrap"},label:{fontSize:12,letterSpacing:1,textTransform:"uppercase",color:"#90a4ae"},currentTier:{fontSize:24,fontWeight:700},desc:{marginTop:4,fontSize:13,color:"#b0bec5"},metricsBox:{display:"flex",gap:12,flexWrap:"wrap",justifyContent:"flex-end"},metricItem:{minWidth:90,padding:"8px 12px",borderRadius:10,background:"rgba(255,255,255,0.08)",textAlign:"center",fontSize:12,display:"flex",flexDirection:"column",gap:4},metricLabel:{color:"#cfd8dc",fontSize:11,letterSpacing:1},metricValue:{fontSize:20,fontWeight:700,color:"#fff"},progressSection:{marginTop:16},nextLabel:{fontSize:14,fontWeight:600},progressHeader:{display:"flex",justifyContent:"space-between",marginBottom:6},progressBarBg:{width:"100%",height:10,borderRadius:999,background:"rgba(255,255,255,0.15)",overflow:"hidden"},progressBarFill:{height:"100%",background:"linear-gradient(90deg, #42a5f5, #7e57c2)"},requirementsGrid:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(150px, 1fr))",gap:12,marginTop:16},requirementCard:{display:"flex",gap:10,alignItems:"center",padding:"10px 12px",borderRadius:12,background:"rgba(255,255,255,0.08)"},requirementBadge:{width:32,height:32,borderRadius:10,display:"flex",alignItems:"center",justifyContent:"center",fontWeight:700,color:"#fff"},requirementLabel:{fontSize:12,color:"#cfd8dc"},requirementValue:{fontSize:14,fontWeight:600},contributorRow:{display:"flex",gap:12,marginTop:8,flexWrap:"wrap"},contributorCard:{flex:"1 1 120px",minWidth:120,background:"rgba(0,0,0,0.25)",borderRadius:12,padding:12},contributorBadge:{fontSize:12,fontWeight:700},contributorName:{marginTop:4,fontSize:16,fontWeight:600},contributorScore:{fontSize:13,color:"#b0bec5"},actionBtn:{width:"100%",marginTop:16,border:"none",borderRadius:999,padding:"12px 0",fontSize:14,fontWeight:600,color:"#1f1f2b",cursor:"pointer"}},kj=["","","",""],Ej=["","","","","","","","","","","","","",""],jj=["","","","","","","","","","","","","","","",""],Cj=["","","","","",""],Tj="init-log",kl=10,El=(e="",t=[])=>{if(!e)return!1;const n=String(e);return t.some(s=>s&&n.includes(s))},cu=e=>{if(!e)return"DAILY";const t=e.category||"",n=`${e.title||""}${e.message||""}`;return El(t,kj)?"WORLD":e.type==="DAILY"||El(n,Cj)?"DAILY":e.id&&e.id.startsWith(Tj)||e.turn===0||El(t,Ej)||El(n,jj)||e.type&&e.type!=="DAILY"?"MAJOR":"DAILY"},Ij=({logs:e,ratingSummary:t,onUpgradeRating:n})=>{const[s,o]=y.useState("ALL"),[i,a]=y.useState(()=>new Set),[l,d]=y.useState(0),u=y.useMemo(()=>s==="ALL"?e:e.filter(x=>cu(x)===s),[e,s]),p=y.useMemo(()=>Math.max(1,Math.ceil(u.length/kl)),[u.length]),c=y.useMemo(()=>{const x=l*kl;return u.slice(x,x+kl)},[u,l]),f=y.useMemo(()=>{const x={all:e.length,daily:0,major:0,world:0};return e.forEach(C=>{const w=cu(C);w==="WORLD"?x.world+=1:w==="MAJOR"?x.major+=1:x.daily+=1}),x},[e]);return y.useEffect(()=>{d(0)},[s,e.length]),r.jsxs("div",{style:pt.container,children:[t&&r.jsx("div",{style:pt.ratingSection,children:r.jsx(wj,{summary:t,onUpgrade:n})}),r.jsx("h3",{style:pt.title,children:" "}),r.jsxs("div",{style:pt.filterBar,children:[r.jsxs("button",{style:{...pt.filterBtn,...s==="ALL"?pt.filterBtnActive:{}},onClick:()=>o("ALL"),children:["  (",f.all,")"]}),r.jsxs("button",{style:{...pt.filterBtn,...s==="DAILY"?pt.filterBtnActive:{}},onClick:()=>o("DAILY"),children:["  (",f.daily,")"]}),r.jsxs("button",{style:{...pt.filterBtn,...s==="MAJOR"?pt.filterBtnActive:{}},onClick:()=>o("MAJOR"),children:["  (",f.major,")"]}),r.jsxs("button",{style:{...pt.filterBtn,...s==="WORLD"?pt.filterBtnActive:{}},onClick:()=>o("WORLD"),children:["  (",f.world,")"]})]}),r.jsxs("div",{style:pt.logWindow,children:[u.length===0?r.jsx("p",{style:{color:"#999"},children:"..."}):null,c.map((x,C)=>{const w=cu(x),S=w==="WORLD",h=w==="MAJOR";let g="",v="#8B4513";S?(g=vj(x.type),v=Sj(x.type)):h&&(g="",v="#b45309");const j=x.id||`${x.turn}-${C+l*kl}`,R=!!x.details,b=R&&i.has(j),_=x.title||x.message||"",I=()=>{R&&a(L=>{const B=new Set(L);return B.has(j)?B.delete(j):B.add(j),B})},k=3572,T=x.turn||0,N=k+Math.floor(T/12),K=T%12||12;return r.jsxs("div",{style:pt.logItem,children:[r.jsxs("div",{style:pt.logHeader,children:[r.jsxs("span",{style:{...pt.turn,color:v},children:[g," [ ",N," ",K,"]"]}),(S||h)&&x.title&&r.jsx("span",{style:pt.eventTag,children:x.title})]}),R?r.jsxs(r.Fragment,{children:[r.jsxs("div",{style:pt.summaryRow,children:[r.jsx("span",{style:pt.summaryText,children:_}),r.jsx("button",{style:pt.toggleBtn,onClick:I,children:b?"":""})]}),b&&r.jsx("div",{style:pt.detailContent,children:x.details})]}):r.jsx("div",{style:pt.logContent,children:x.message})]},j)})]}),r.jsxs("div",{style:pt.footer,children:[r.jsxs("div",{style:pt.paginationBar,children:[r.jsx("button",{style:{...pt.pageBtn,...l<=0?pt.pageBtnDisabled:{}},onClick:()=>d(x=>Math.max(0,x-1)),disabled:l<=0,children:""}),r.jsxs("span",{style:pt.pageInfo,children:[" ",l+1," / ",p," "]}),r.jsx("button",{style:{...pt.pageBtn,...l>=p-1?pt.pageBtnDisabled:{}},onClick:()=>d(x=>Math.min(p-1,x+1)),disabled:l>=p-1,children:""})]}),r.jsxs("span",{style:{fontSize:"11px",color:"#666"},children:[" ",u.length," "]})]})]})},pt={container:{width:"calc(100% - 30px)",maxWidth:"800px",margin:"20px auto 150px auto",border:"1px solid #ccc",borderRadius:"8px",backgroundColor:"#fff",fontFamily:'"KaiTi", serif',display:"flex",flexDirection:"column",minHeight:"500px",pointerEvents:"auto"},ratingSection:{padding:"12px",borderBottom:"1px solid rgba(0,0,0,0.05)"},title:{margin:"0",padding:"10px",backgroundColor:"#f5f5f5",borderBottom:"1px solid #eee",fontSize:"16px"},filterBar:{display:"flex",gap:"5px",padding:"8px",backgroundColor:"#fafafa",borderBottom:"1px solid #eee",pointerEvents:"auto"},filterBtn:{flex:1,padding:"6px 8px",fontSize:"12px",border:"1px solid #ddd",borderRadius:"4px",backgroundColor:"#fff",cursor:"pointer",transition:"all 0.2s",fontFamily:"inherit",pointerEvents:"auto"},filterBtnActive:{backgroundColor:"#4A90E2",color:"#fff",border:"1px solid #4A90E2",fontWeight:"bold"},logWindow:{flex:1,minHeight:"300px",maxHeight:"500px",overflowY:"auto",padding:"10px",fontSize:"13px",pointerEvents:"auto"},logItem:{marginBottom:"10px",borderBottom:"1px dashed #eee",paddingBottom:"6px",pointerEvents:"auto"},logHeader:{display:"flex",alignItems:"center",gap:"6px",marginBottom:"3px",pointerEvents:"auto"},turn:{fontWeight:"bold",fontSize:"12px"},eventTag:{fontSize:"10px",padding:"2px 6px",backgroundColor:"#f0f0f0",borderRadius:"3px",color:"#666"},logContent:{lineHeight:"1.5",color:"#333",whiteSpace:"pre-wrap"},summaryRow:{display:"flex",justifyContent:"space-between",alignItems:"center",gap:"8px",padding:"4px 0",pointerEvents:"auto"},summaryText:{fontWeight:600,fontSize:"13px",flex:1,color:"#333",pointerEvents:"auto"},toggleBtn:{border:"1px solid #ccc",borderRadius:"999px",padding:"2px 10px",backgroundColor:"#fff",fontSize:"11px",cursor:"pointer",pointerEvents:"auto"},detailContent:{lineHeight:"1.6",color:"#444",backgroundColor:"#fafafa",borderRadius:"6px",padding:"8px 10px",border:"1px solid rgba(0,0,0,0.05)",whiteSpace:"pre-wrap",pointerEvents:"auto"},footer:{padding:"12px 10px",backgroundColor:"#f5f5f5",borderTop:"2px solid #d32f2f",textAlign:"center",pointerEvents:"auto",flexShrink:0,minHeight:"60px",display:"flex",flexDirection:"column",justifyContent:"center",gap:"6px"},paginationBar:{display:"flex",justifyContent:"center",alignItems:"center",gap:"10px",marginBottom:"6px"},pageBtn:{padding:"6px 14px",border:"2px solid #d32f2f",borderRadius:"6px",backgroundColor:"#fff",cursor:"pointer",fontSize:"13px",fontWeight:"bold",color:"#d32f2f",transition:"all 0.2s",pointerEvents:"auto"},pageBtnDisabled:{backgroundColor:"#f0f0f0",cursor:"not-allowed",color:"#999",borderColor:"#ccc"},pageInfo:{fontSize:"12px",color:"#666"}};class ls{static onChildBirth(t,n,s={}){jn(t);const o=Tg(t,n,s);return bo(t,{description:`${n.name}`,affectionChange:0,context:`${s.difficulty===""?"":""}`}),console.log(`[] ${t.name} : ${n.name}`),o}static onMarriage(t,n=""){jn(t);const s=FE(t,n);return bo(t,{description:"",affectionChange:30,context:""}),console.log(`[] ${t.name} `),s}static onReceiveGift(t,n,s){jn(t);const o=bo(t,{description:`${n.name}`,affectionChange:s,context:n.tier>=3?"":""});return Math.abs(s)>=20&&Uo(t,{event:`${n.name}`,detail:`${n.name}`,emotionalImpact:Js.SIGNIFICANT,category:"relationship",tags:["",n.name,""]}),o}static onCombatTogether(t,n,s=!1){return jn(t),s?HE(t,`${n}`):bo(t,{description:`${n}`,affectionChange:5,context:""})}static onBreakthrough(t,n){return jn(t),Uo(t,{event:`${n}`,detail:`${n}`,emotionalImpact:Js.PROFOUND,category:"cultivation",tags:["","",n]})}static onPregnancyStart(t){return jn(t),bo(t,{description:"",affectionChange:15,context:""})}static onChildJoinSect(t,n,s){return jn(t),bo(t,{description:`${n.name}${s}`,affectionChange:0,context:""})}static onChildMarriage(t,n,s){return jn(t),Uo(t,{event:`${n.name}`,detail:`${n.name}${s}`,emotionalImpact:Js.SIGNIFICANT,category:"family",tags:["","",n.name]})}static initializeAllNpcs(t){t.forEach(n=>{jn(n)}),console.log(`[]  ${t.length}  NPC `)}static backfillChildrenMemories(t,n){jn(t),n.forEach(s=>{t.memories.milestones.some(i=>i.tags.includes(s.name))||(Tg(t,s,{difficulty:"",sacrifice:!1}),console.log(`[]  ${t.name}  ${s.name} `))})}static getMemorySummary(t){return t.memories||jn(t),{milestoneCount:t.memories.milestones.length,milestones:t.memories.milestones,recentEventCount:t.memories.recentEvents.length,recentEvents:t.memories.recentEvents,longTermSummary:t.memories.longTermSummary,totalEvents:t.memories.meta.totalEvents}}static clearAllMemories(t){t.memories&&(t.memories.milestones=[],t.memories.recentEvents=[],t.memories.longTermSummary="",t.memories.meta.totalEvents=0,console.log(`[]  ${t.name} `))}}const Rj=e=>{const{identity:t,personality:n,stats:s,relationship:o}=e,i=typeof n=="object"&&n!==null&&"label"in n?n.label:Array.isArray(n)?n[0]:"",a=s.aptitude&&s.aptitude>=90,l=(o==null?void 0:o.jealousy)||0;if(l>=60)return pu(e,l,i);if(l>=40&&Math.random()<.5)return pu(e,l,i);if(l>=20&&Math.random()<.2)return pu(e,l,i);if(a){const p=["","",""];return p[Math.floor(Math.random()*p.length)]}const d={:["","","",""],:["","","",""],:["","","",""],:["","","",""],:["","","",""],:["","","",""],:["","","",""],:["","","",""],:["","","",""],:["","","",""],:["","","",""],:["","","",""],:["","","",""],:["","","",""],:["","","",""],:["","","",""],:["","","",""],:["","","",""],:["","","",""],:["","","",""]};if(Math.random()>.5||!d[t])switch(i){case"":return"";case"":return"";case"":return"";case"":return"";case"":return"";case"":return"";default:return""}const u=d[t]||[""];return u[Math.floor(Math.random()*u.length)]},_j=(e,t)=>{const n=typeof e.personality=="object"&&e.personality!==null&&"label"in e.personality?e.personality.label:Array.isArray(e.personality)?e.personality[0]:"",s=e.likes&&e.likes.includes(t.name);let o=t.value,i="";if(e.identity==="")return t.name&&/|||/i.test(t.name)||t.tags&&t.tags.includes("scripture")?(o=Math.floor(t.value*3),i=`${e.name} `,{msg:i,change:o}):{msg:`${e.name} `,change:0};if(t.value<10&&(["","",""].includes(n)||[""].includes(e.identity)))return{msg:`${e.name} ${t.name}`,change:-5};if(s)o*=2,i=`${e.name} ${t.name}`;else if(n===""&&t.cost>=300)o*=1.5,i=`${e.name} ${t.name}`;else switch(n){case"":i=`${e.name} `;break;case"":i=`${e.name} `;break;case"":i=`${e.name} `;break;default:i=`${e.name} ${t.name}`}return{msg:i,change:Math.floor(o)}},Mj=[{title:"",text:e=>`${e}${e}""`,affectionBonus:5},{title:"",text:e=>`${e}${e}""`,affectionBonus:5},{title:"",text:e=>`${e}${e}""`,affectionBonus:8},{title:"",text:e=>`${e}${e}""`,affectionBonus:6},{title:"",text:e=>`${e}${e}${e}""`,affectionBonus:10},{title:"",text:e=>`${e}"......"${e}""`,affectionBonus:12,requirePregnant:!0},{title:"",text:e=>`${e}${e}"..."${e}"..."`,affectionBonus:13,requirePregnant:!0}],Aj=[{title:"",text:e=>`${e}${e}""`,affectionBonus:6},{title:"",text:e=>`${e}${e}${e}""`,affectionBonus:7},{title:"",text:e=>`""${e}""`,affectionBonus:8},{title:"",text:e=>`${e}${e}""`,affectionBonus:7},{title:"",text:e=>`${e}""${e}""`,affectionBonus:5},{title:"",text:e=>`${e}"......"`,affectionBonus:10,requirePregnant:!0},{title:"",text:e=>`${e}"..."${e}"..."`,affectionBonus:11,requirePregnant:!0}],Ag=[{title:"",text:e=>`${e}${e}""`,affectionBonus:6},{title:"",text:e=>`${e}""`,affectionBonus:7},{title:"",text:e=>`${e}""`,affectionBonus:8},{title:"",text:e=>`${e}""`,affectionBonus:5},{title:"",text:e=>`${e}${e}""`,affectionBonus:9},{title:"",text:e=>`${e}"..."`,affectionBonus:12,requirePregnant:!0},{title:"",text:e=>`${e}"..."${e}"..."`,affectionBonus:14,requirePregnant:!0}],Nj=[{title:"",text:e=>`${e}${e}""`,affectionBonus:6},{title:"",text:e=>`${e}""`,affectionBonus:7},{title:"",text:e=>`${e}""${e}`,affectionBonus:6},{title:"",text:e=>`${e}${e}""`,affectionBonus:5},{title:"",text:e=>`${e}${e}""`,affectionBonus:8},{title:"",text:e=>`${e}"......"`,affectionBonus:13,requirePregnant:!0},{title:"",text:e=>`${e}"...""..."`,affectionBonus:12,requirePregnant:!0}],Ng=[{title:"",text:(e,t)=>`${e}""`,affectionBonus:8},{title:"",text:(e,t)=>`${e}""`,affectionBonus:10},{title:"",text:(e,t)=>`${e}${e}""`,affectionBonus:7},{title:"",text:(e,t)=>`${e}""`,affectionBonus:6},{title:"",text:(e,t)=>`${e}${e}""`,affectionBonus:9}],Lj=[{title:"",text:(e,t)=>`${e}${e}""`,affectionBonus:8},{title:"",text:(e,t)=>`${e}${e}"${t===""?"":""}"`,affectionBonus:6},{title:"",text:(e,t)=>`${e}""`,affectionBonus:10},{title:"",text:(e,t)=>`${e}""${e}`,affectionBonus:4},{title:"",text:(e,t)=>`${e}""`,affectionBonus:9}],$j=[{title:"",text:(e,t)=>`${e}${e}""`,affectionBonus:10},{title:"",text:(e,t)=>`${e}""`,affectionBonus:12},{title:"",text:(e,t)=>`${e}${e}${e}""`,affectionBonus:15},{title:"",text:(e,t)=>`${e}""`,affectionBonus:11},{title:"",text:(e,t)=>`${e}""`,affectionBonus:10}],Lg=(e,t)=>{let n=Ag;switch(e){case"COLD":n=Mj;break;case"YANDERE":n=Aj;break;case"GENTLE":n=Ag;break;case"FLIRTY":n=Nj;break}const s=n.filter(i=>!(i.requirePregnant&&!t.isPregnant));if(s.length===0)return null;const o=s[Math.floor(Math.random()*s.length)];return{title:o.title,text:o.text(t.name),affectionBonus:o.affectionBonus}},Bj=(e,t,n="")=>{let s=Ng;switch(e){case"TODDLER":s=Ng;break;case"TEEN":s=Lj;break;case"ADULT":s=$j;break}const o=s[Math.floor(Math.random()*s.length)];return{title:o.title,text:o.text(t.name,n),affectionBonus:o.affectionBonus}},Oj=[{title:"",text:e=>`${e}""`,affectionBonus:5},{title:"",text:e=>`${e}""`,affectionBonus:7},{title:"",text:e=>`${e}${e}${e}""`,affectionBonus:10}],Pj=[{title:"",text:e=>`${e}${e}""`,affectionBonus:4},{title:"",text:e=>`${e}""`,affectionBonus:8},{title:"",text:e=>`${e}${e}${e}""`,affectionBonus:9}],zj=[{title:"",text:e=>`${e}${e}${e}""`,affectionBonus:10},{title:"",text:e=>`${e}""`,affectionBonus:12},{title:"",text:e=>`${e}${e}""`,affectionBonus:8}],Dj=[{title:"",text:e=>`${e}${e}""`,affectionBonus:6},{title:"",text:e=>`${e}${e}"..."`,affectionBonus:5,minAffection:40},{title:"",text:e=>`${e}""`,affectionBonus:10,minAffection:60},{title:"",text:e=>`${e}${e}"..."`,affectionBonus:8,minAffection:70},{title:"",text:e=>`${e}""${e}""`,affectionBonus:15,minAffection:80},{title:"",text:e=>`${e}"..."${e}`,affectionBonus:12,minAffection:85},{title:"",text:e=>`${e}${e}"......"${e}`,affectionBonus:20,minAffection:90},{title:"",text:e=>`${e}"..."${e}`,affectionBonus:15,minAffection:95}],Fj=[{title:"",text:e=>`${e}${e}${e}""`,affectionBonus:10},{title:"",text:e=>`${e}${e}${e}${e}""`,affectionBonus:8},{title:"",text:e=>`${e}""${e}`,affectionBonus:15}],Hj=[{title:"",text:e=>`${e}${e}""`,affectionBonus:5},{title:"",text:e=>`${e}${e}${e}""`,affectionBonus:9},{title:"",text:e=>`${e}${e}""`,affectionBonus:11}],Wj=[{title:"",text:e=>`${e}${e}""`,affectionBonus:12},{title:"",text:e=>`${e}${e}""`,affectionBonus:10},{title:"",text:e=>`${e}${e}${e}${e}""`,affectionBonus:8}],du=(e,t)=>{var a;let n=[];switch(e){case"":n=Oj;break;case"":n=Pj;break;case"":case"":n=zj;break;case"":n=Dj;break;case"":n=Fj;break;case"":n=Hj;break;case"":n=Wj;break;default:return null}if(n.length===0)return null;const s=((a=t.relationship)==null?void 0:a.affection)||0,o=n.filter(l=>!(l.minAffection&&s<l.minAffection));if(o.length===0)return null;const i=o[Math.floor(Math.random()*o.length)];return{title:i.title,text:i.text(t.name),affectionBonus:i.affectionBonus}},uu=(e,t)=>{var a;if(e.isChild){if(Math.random()<.25){let l="TODDLER";return e.age>=18?l="ADULT":e.age>=11&&(l="TEEN"),Bj(l,e,(t==null?void 0:t.gender)||"")}return null}if(Math.random()>=.3)return null;const s=((a=e.relationship)==null?void 0:a.affection)||0,o=typeof e.personality=="object"&&e.personality!==null&&"label"in e.personality?e.personality.label:Array.isArray(e.personality)?e.personality[0]:"";if(s>=80){if(Math.random()<.7){let d="GENTLE";return["","","",""].includes(o)?d="COLD":["","","",""].includes(o)?d="YANDERE":["","","",""].includes(o)?d="FLIRTY":["","","","",""].includes(o)&&(d="GENTLE"),Lg(d,e)}const l=du(e.identity,e);return l||null}if(s>=60){if(Math.random()<.5){let d="GENTLE";return["","","",""].includes(o)?d="COLD":["","","",""].includes(o)?d="YANDERE":["","","",""].includes(o)?d="FLIRTY":["","","","",""].includes(o)&&(d="GENTLE"),Lg(d,e)}const l=du(e.identity,e);return l||null}const i=du(e.identity,e);return i||null};function pu(e,t,n){if(e.name,t>=61){const i={:["...","...","..."],:["","...",""],:["...","",""],:["......","...","......"],:["...","...","..."],:["...","","..."]},a=i[n]||i.;return a[Math.floor(Math.random()*a.length)]}if(t>=41){const i={:["...","...","..."],:["","","..."],:["...","","..."],:["...","","......"],:["...","...","..."],:["","...","..."]},a=i[n]||i.;return a[Math.floor(Math.random()*a.length)]}const s={:["...","...","..."],:["","","..."],:["...","","..."],:["...","......","..."],:["","","..."],:["","","..."]},o=s[n]||s.;return o[Math.floor(Math.random()*o.length)]}const Uj=(e,t,n)=>{const s=typeof e.personality=="object"&&e.personality!==null&&"label"in e.personality?e.personality.label:Array.isArray(e.personality)?e.personality[0]:"",o=e.identity||"",i=e.name;return n?Gj(i,s,o,t):Vj(i,s,o,t)};function Gj(e,t,n,s){var d;const o=`${t}_${n}_${s.id}`,i=vo[o];if(i)return i(e);const a=vo[`${t}_${s.id}`];if(a)return a(e);const l=vo[`${n}_${s.id}`];return l?l(e):((d=vo[`default_${s.id}`])==null?void 0:d.call(vo,e))||`${e} ""`}const vo={_PROFIT:e=>`${e} ""`,__PROFIT:e=>`${e} ""`,__PROFIT:e=>`${e} ""`,__PROFIT:e=>`${e} ""`,_PROFIT:e=>`${e} ""`,__PROFIT:e=>`${e} ""`,__PROFIT:e=>`${e} ""`,__PROFIT:e=>`${e} ""`,_PROFIT:e=>`${e} ""`,__PROFIT:e=>`${e} ""`,__PROFIT:e=>`${e} ""`,_PROFIT:e=>`${e} ""`,__PROFIT:e=>`${e} ""`,_PROFIT:e=>`${e} ""`,__PROFIT:e=>`${e} "~"`,_PROFIT:e=>`${e} ""`,__PROFIT:e=>`${e} ""`,_PROFIT:e=>`${e} ""`,__PROFIT:e=>`${e} ""`,_PROFIT:e=>`${e} "''"`,__PROFIT:e=>`${e} ""`,_PROFIT:e=>`${e} ""`,__PROFIT:e=>`${e} ""`,_PROFIT:e=>`${e} ""`,_PROFIT:e=>`${e} "~"`,_PROFIT:e=>`${e} ""`,_PROFIT:e=>`${e} "~"`,_PROFIT:e=>`${e} ""`,_PROFIT:e=>`${e} ""`,_PROFIT:e=>`${e} ""`,_PROFIT:e=>`${e} "~"`,_EMOTION:e=>`${e} """"`,__EMOTION:e=>`${e} ""`,__EMOTION:e=>`${e} ""`,_EMOTION:e=>`${e} ""`,__EMOTION:e=>`${e} ""`,__EMOTION:e=>`${e} ""`,_EMOTION:e=>`${e} ""`,__EMOTION:e=>`${e} ""`,_EMOTION:e=>`${e} ""`,__EMOTION:e=>`${e} ""`,_EMOTION:e=>`${e} ""`,__EMOTION:e=>`${e} ""`,_EMOTION:e=>`${e} ""`,__EMOTION:e=>`${e} ""`,_EMOTION:e=>`${e} ""`,__EMOTION:e=>`${e} ""`,_EMOTION:e=>`${e} ""`,_EMOTION:e=>`${e} ""`,_EMOTION:e=>`${e} ""`,_EMOTION:e=>`${e} "~"`,_EMOTION:e=>`${e} ""`,_EMOTION:e=>`${e} "~"`,_EMOTION:e=>`${e} ""`,_EMOTION:e=>`${e} ""`,_EMOTION:e=>`${e} ""`,_REASON:e=>`${e} ""`,__REASON:e=>`${e} ""`,_REASON:e=>`${e} ""`,__REASON:e=>`${e} ""`,__REASON:e=>`${e} ""`,_REASON:e=>`${e} ""`,__REASON:e=>`${e} ""`,_REASON:e=>`${e} ""`,_REASON:e=>`${e} ""`,_REASON:e=>`${e} ""`,_REASON:e=>`${e} "~"`,_REASON:e=>`${e} ""`,_REASON:e=>`${e} ""`,_REASON:e=>`${e} ""`,_REASON:e=>`${e} "~"`,_REASON:e=>`${e} ""`,_REASON:e=>`${e} ""`,_REASON:e=>`${e} ""`,_REASON:e=>`${e} ""`,_EMOTION:e=>`${e} ""`,_REASON:e=>`${e} ""`,_EMOTION:e=>`${e} ""`,_REASON:e=>`${e} ""`,_EMOTION:e=>`${e} ""`,_REASON:e=>`${e} ""`,_EMOTION:e=>`${e} ""`,_REASON:e=>`${e} ""`,_EMOTION:e=>`${e} ""`,_PROFIT:e=>`${e} ""`,_EMOTION:e=>`${e} ""`,_REASON:e=>`${e} ""`,_EMOTION:e=>`${e} ""`,_REASON:e=>`${e} ""`,_EMOTION:e=>`${e} ""`,_EMOTION:e=>`${e} ""`,_REASON:e=>`${e} ""`,_REASON:e=>`${e} ""`,_EMOTION:e=>`${e} ""`,default_PROFIT:e=>`${e} ""`,default_EMOTION:e=>`${e} ""`,default_REASON:e=>`${e} ""`};function Vj(e,t,n,s){var d;const o=`${t}_${n}_${s.id}`,i=So[o];if(i)return i(e);const a=So[`${t}_${s.id}`];if(a)return a(e);const l=So[`${n}_${s.id}`];return l?l(e):((d=So[`default_${s.id}`])==null?void 0:d.call(So,e))||`${e} ""`}const So={_PROFIT:e=>`${e} ""`,__PROFIT:e=>`${e} ""`,__PROFIT:e=>`${e} ""`,_PROFIT:e=>`${e} ""`,__PROFIT:e=>`${e} ""`,_PROFIT:e=>`${e} ""`,__PROFIT:e=>`${e} ""`,_PROFIT:e=>`${e} ""`,__PROFIT:e=>`${e} ""`,_PROFIT:e=>`${e} ""`,_REASON:e=>`${e} ""`,_PROFIT:e=>`${e} ""`,_PROFIT:e=>`${e} ""`,_PROFIT:e=>`${e} ""`,_PROFIT:e=>`${e} "~~"`,_PROFIT:e=>`${e} ""`,_PROFIT:e=>`${e} ""`,_PROFIT:e=>`${e} ""`,_PROFIT:e=>`${e} ""`,_PROFIT:e=>`${e} ""`,_PROFIT:e=>`${e} :""`,_PROFIT:e=>`${e} :""`,_PROFIT:e=>`${e} :"~"`,_EMOTION:e=>`${e} ""`,__EMOTION:e=>`${e} ""`,__EMOTION:e=>`${e} ""`,_EMOTION:e=>`${e} ""`,__EMOTION:e=>`${e} ""`,_EMOTION:e=>`${e} ""`,__EMOTION:e=>`${e} ""`,_EMOTION:e=>`${e} ""`,__EMOTION:e=>`${e} ""`,_EMOTION:e=>`${e} ""`,__EMOTION:e=>`${e} ""`,_EMOTION:e=>`${e} ""`,__EMOTION:e=>`${e} ""`,_EMOTION:e=>`${e} ""`,_EMOTION:e=>`${e} ""`,_EMOTION:e=>`${e} ""`,_EMOTION:e=>`${e} "~"`,_EMOTION:e=>`${e} ""`,_EMOTION:e=>`${e} ""`,_EMOTION:e=>`${e} ""`,_EMOTION:e=>`${e} ""`,_EMOTION:e=>`${e} ""`,_EMOTION:e=>`${e} ""`,_EMOTION:e=>`${e} "~"`,_REASON:e=>`${e} ""`,__REASON:e=>`${e} ""`,_REASON:e=>`${e} ""`,__REASON:e=>`${e} ""`,_REASON:e=>`${e} ""`,_REASON:e=>`${e} ""`,_REASON:e=>`${e} ""`,_REASON:e=>`${e} ""`,_REASON:e=>`${e} ""`,_EMOTION:e=>`${e} ""`,_REASON:e=>`${e} ""`,_REASON:e=>`${e} "~"`,_REASON:e=>`${e} ""`,_REASON:e=>`${e} ""`,_REASON:e=>`${e} ""`,_REASON:e=>`${e} ""`,_REASON:e=>`${e} ""`,_REASON:e=>`${e} :""`,_REASON:e=>`${e} "~"`,_PROFIT:e=>`${e} ""`,_REASON:e=>`${e} ""`,_PROFIT:e=>`${e} ""`,_REASON:e=>`${e} ""`,_EMOTION:e=>`${e} ""`,_REASON:e=>`${e} ""`,_PROFIT:e=>`${e} ""`,_EMOTION:e=>`${e} ""`,_EMOTION:e=>`${e} ""`,_PROFIT:e=>`${e} ""`,default_PROFIT:e=>`${e} ""`,default_EMOTION:e=>`${e} ""`,default_REASON:e=>`${e} ""`},Bi={NONE:{min:0,max:20,label:"",color:"#4caf50"},LOW:{min:21,max:40,label:"",color:"#8bc34a"},MEDIUM:{min:41,max:60,label:"",color:"#ff9800"},HIGH:{min:61,max:80,label:"",color:"#ff5722"},EXTREME:{min:81,max:100,label:"",color:"#f44336"}};function Yj(e=0){return e<=20?Bi.NONE:e<=40?Bi.LOW:e<=60?Bi.MEDIUM:e<=80?Bi.HIGH:Bi.EXTREME}function qj(e,t,n){var u,p;const s=((u=e.relationship)==null?void 0:u.affection)||0;if(s<50)return 0;let i={CHAT:5,GIFT:10,SPAR:8,DUAL_CULTIVATION:30}[n]||5;s>=80?i*=2:s>=70?i*=1.5:s>=60&&(i*=1.2);const a=typeof e.personality=="object"&&e.personality!==null&&"label"in e.personality?e.personality.label:Array.isArray(e.personality)?e.personality[0]:"";return i*={:1.8,:1.6,:1.3,:.8,:1.1,:1.2}[a]||1,(((p=e.relationship)==null?void 0:p.jealousy)||0)>=60&&(i*=1.3),Math.floor(i)}function Kj(e,t,n,s){const o=[],a={CHAT:.12,GIFT:.18,SPAR:.15,DUAL_CULTIVATION:.08}[s]||.05;return n.forEach(l=>{var c;if(l.id===t.id||l.isDead)return;const d=((c=l.relationship)==null?void 0:c.affection)||0;if(d<50)return;let u=a;d>=80?u*=2:d>=70?u*=1.6:d>=60&&(u*=1.3);const p=typeof l.personality=="object"&&l.personality!==null&&"label"in l.personality?l.personality.label:Array.isArray(l.personality)?l.personality[0]:"";(p===""||p==="")&&(u*=1.3),Math.random()<u&&o.push(l)}),o}function Qj(e,t){var i,a;const n=((i=e.relationship)==null?void 0:i.affection)||0;if(n<70)return 0;const s=((a=e.relationship)==null?void 0:a.lastInteraction)||0;if(t-s>=3){let l=5;return n>=90?l=10:n>=80&&(l=8),l}return 0}function $g(e,t){var l;const n=((l=e.relationship)==null?void 0:l.jealousy)||0;if(n===0)return 0;const s=2,o=typeof e.personality=="object"&&e.personality!==null&&"label"in e.personality?e.personality.label:Array.isArray(e.personality)?e.personality[0]:"",a=Math.floor(s*({:.5,:.6,:1.2,:1.5,:.8}[o]||1));return Math.min(a,n)}function Jj(e){const t=e.filter(a=>{var u,p;if(a.isDead)return!1;const l=((u=a.relationship)==null?void 0:u.jealousy)||0,d=((p=a.relationship)==null?void 0:p.affection)||0;return l>=60&&d>=70});if(t.length<2)return null;const i=Math.min(.2,.05+t.length*.05);return Math.random()<i?{type:"SHURA_FIELD",participants:t,triggerChance:i}:null}function Xj(e,t){const n=t.name;t.gender;const s=[...e].sort((f,x)=>{var S,h;const C=((S=f.relationship)==null?void 0:S.jealousy)||0;return(((h=x.relationship)==null?void 0:h.jealousy)||0)-C}),o=s[0],i=s[1],a=s.slice(2),l=typeof o.personality=="object"&&o.personality!==null&&"label"in o.personality?o.personality.label:Array.isArray(o.personality)?o.personality[0]:"",d=typeof i.personality=="object"&&i.personality!==null&&"label"in i.personality?i.personality.label:Array.isArray(i.personality)?i.personality[0]:"";let u="";e.length===2?u=`

${o.name}${i.name}...`:u=`

${o.name}${i.name}${a.length>0?""+a.map(f=>f.name).join(""):""}...`;const p=[];l===""?p.push({speaker:o.name,text:`${n}...`}):l===""?p.push({speaker:o.name,text:`${n}`}):l===""?p.push({speaker:o.name,text:`${n}`}):p.push({speaker:o.name,text:`${n}${i.name}...`}),d===""?p.push({speaker:i.name,text:`${o.name}${n}...`}):d===""?p.push({speaker:i.name,text:`${o.name}${n}`}):d===""?p.push({speaker:i.name,text:`.........${n}...`}):p.push({speaker:i.name,text:`${n}`}),a.length>0&&p.push({speaker:a[0].name,text:`${n}`});const c=[{label:`${o.name}`,hint:`${o.name}`,effect:"FAVOR_NPC1"},{label:`${i.name}`,hint:`${i.name}`,effect:"FAVOR_NPC2"},{label:"",hint:"",effect:"MEDIATE"},{label:"",hint:"",effect:"HONEST"},{label:"",hint:"",effect:"AVOID"}];return{type:"SHURA_FIELD",participants:s,description:u,dialogues:p,options:c}}function Lr(e,t,n,s={}){const o=typeof e.personality=="object"&&e.personality!==null&&"label"in e.personality?e.personality.label:Array.isArray(e.personality)?e.personality[0]:"";e.identity;const i=t.name,a=t.gender===""?"":"",l={:`...${i}${i}`,:`...${i}${a}${a}`,:`${i}...`,:`${i}.........`,:`${i}${a}...`,:`${i}...`,:`...${i}""...`,:`${i}......`,:`${i}${a}...`,:`...${i}${a}...`},d={:`${i}...${a}`,:`...${i}...`,:`${i}...${a}`,:`${i}.........`,:`${i}${a}${a}`,:`${i}...`,:`${i}...`,:`${i}...${a}`,:`...${i}...`},u={:`${i}${s.favoredName}...${a}...`,:`${i}${s.favoredName}`,:`${i}${a}...${a}`,:`${i}${s.favoredName}......`,:`${i}${s.favoredName}`,:`${i}......`,:`${i}${s.favoredName}...`,:`${i}...${a}${a}...`,:`${i}${a}${a}`,:`...${i}${s.favoredName}${a}${s.favoredGender===""?"":""}`},p={:`${i}...${a}`,:`${i}...${a}`,:`${i}...`,:`${i}...${a}...`,:`${i}${a}`,:`${i}...`,:`${i}...${a}...`,:`${i}...`},c={:`${i}${a}...${a}`,:`${i}...${a}`,:`${i}...${a}`,:`${i}${a}`,:`${i}${a}...${a}`},f={:`${i}${a}${a}...`,:`${i}${a}`,:`${i}...${a}`,:`${i}${a}${a}`,:`${i}...`,:`${i}...${a}${a}...`},x={:`${i}${a}...${a}`,:`${i}...`,:`${i}...${a}`,:`${i}...${a}...`,:`${i}${a}`,:`${i}......`,:`${i}...${a}...`,:`${i}...${a}...`,:`${i}${a}`,:`${i}...${a}`,:`${i}...${a}${a}...`};let C="";switch(n){case"trigger":C=l[o]||l.;break;case"favored":C=d[o]||d.;break;case"neglected":C=u[o]||u.;break;case"mediate":C=p[o]||p.;break;case"honest_understand":C=c[o]||c.;break;case"honest_angry":C=f[o]||f.;break;case"avoid":C=x[o]||x.;break}return C}function Zj(e,t,n){const s={changes:[],message:"",npcLogs:[]};switch(t.effect){case"FAVOR_NPC1":s.changes.push({npcId:e.participants[0].id,jealousyChange:-20,affectionChange:5}),s.changes.push({npcId:e.participants[1].id,jealousyChange:10,affectionChange:-5}),e.participants.slice(2).forEach(o=>{s.changes.push({npcId:o.id,jealousyChange:10,affectionChange:-3})}),s.message=`${e.participants[0].name}${e.participants[0].gender===""?"":""}...`,s.npcLogs.push({npcId:e.participants[0].id,content:Lr(e.participants[0],n,"favored"),type:"DAILY",isSecret:!0}),s.npcLogs.push({npcId:e.participants[1].id,content:Lr(e.participants[1],n,"neglected",{favoredName:e.participants[0].name,favoredGender:e.participants[0].gender}),type:"DAILY",isSecret:!0}),e.participants.slice(2).forEach(o=>{s.npcLogs.push({npcId:o.id,content:Lr(o,n,"neglected",{favoredName:e.participants[0].name,favoredGender:e.participants[0].gender}),type:"DAILY",isSecret:!0})});break;case"FAVOR_NPC2":s.changes.push({npcId:e.participants[1].id,jealousyChange:-20,affectionChange:5}),s.changes.push({npcId:e.participants[0].id,jealousyChange:10,affectionChange:-5}),e.participants.slice(2).forEach(o=>{s.changes.push({npcId:o.id,jealousyChange:10,affectionChange:-3})}),s.message=`${e.participants[1].name}${e.participants[1].gender===""?"":""}...`,s.npcLogs.push({npcId:e.participants[1].id,content:Lr(e.participants[1],n,"favored"),type:"DAILY",isSecret:!0}),s.npcLogs.push({npcId:e.participants[0].id,content:Lr(e.participants[0],n,"neglected",{favoredName:e.participants[1].name,favoredGender:e.participants[1].gender}),type:"DAILY",isSecret:!0}),e.participants.slice(2).forEach(o=>{s.npcLogs.push({npcId:o.id,content:Lr(o,n,"neglected",{favoredName:e.participants[1].name,favoredGender:e.participants[1].gender}),type:"DAILY",isSecret:!0})});break;case"MEDIATE":e.participants.forEach(o=>{s.changes.push({npcId:o.id,jealousyChange:-10,affectionChange:0})}),s.message="...",e.participants.forEach(o=>{s.npcLogs.push({npcId:o.id,content:Lr(o,n,"mediate"),type:"DAILY",isSecret:!0})});break;case"HONEST":e.participants.forEach(o=>{var a;(((a=o.relationship)==null?void 0:a.jealousy)||0)>=80?s.changes.push({npcId:o.id,jealousyChange:5,affectionChange:-3}):s.changes.push({npcId:o.id,jealousyChange:-15,affectionChange:3})}),s.message="...",e.participants.forEach(o=>{var l;const a=(((l=o.relationship)==null?void 0:l.jealousy)||0)>=80?"honest_angry":"honest_understand";s.npcLogs.push({npcId:o.id,content:Lr(o,n,a),type:"DAILY",isSecret:!0})});break;case"AVOID":e.participants.forEach(o=>{s.changes.push({npcId:o.id,jealousyChange:5,affectionChange:-8})}),s.message="...",e.participants.forEach(o=>{s.npcLogs.push({npcId:o.id,content:Lr(o,n,"avoid"),type:"DAILY",isSecret:!0})});break}return s}const Bg={1:{relation:"",address:""},2:{relation:"",address:""},3:{relation:"",address:""},default:{relation:"",address:""}},Gy=(e={},t={})=>{const n=Math.max(1,(e==null?void 0:e.generation)||1);return{...Bg[n]||Bg.default,gender:"female",generation:n}},Lt={LETTER:"LETTER",OBITUARY:"OBITUARY",DEPARTURE:"DEPARTURE",ACHIEVEMENT:"ACHIEVEMENT"},io={PENDING:"PENDING",READY:"READY",READ:"READ"};function Vy({type:e,senderId:t,senderName:n,title:s,content:o="",timestamp:i,extras:a={},status:l=io.READY,replies:d=[]}){return{id:`msg_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,type:e,senderId:t,senderName:n,title:s,content:o,isRead:l===io.READ,status:l,timestamp:i,extras:a,createdAt:Date.now(),replies:d,lastRepliedAt:null}}class e5{constructor(t=100,n=50){this.messages=[],this.maxMessages=t,this.maxLetters=n,this.recentContents=new Map}addMessage(t){if(t.type===Lt.LETTER&&t.senderId){if(this.recentContents.get(t.senderId)===t.content)return console.log(`[MessageManager] : ${t.senderName}`),!1;this.recentContents.set(t.senderId,t.content)}return this.messages.unshift(t),this.cleanup(),!0}addReplyToMessage(t,n){const s=this.messages.find(i=>i.id===t);if(!s)return null;const o={id:`reply_${Date.now()}_${Math.random().toString(36).substr(2,6)}`,content:n.content,tone:n.tone||"warm",toneLabel:n.toneLabel||"",sentiment:n.sentiment||"",timestamp:n.timestamp,from:n.from||"",affectionDelta:n.affectionDelta||0,createdAt:Date.now()};return Array.isArray(s.replies)||(s.replies=[]),s.replies.push(o),s.lastRepliedAt=o.timestamp,s.extras&&(s.extras.hasNpcRespondedToReply=!1),{message:s,reply:o}}markAsRead(t){const n=this.messages.find(s=>s.id===t);n&&(n.isRead=!0,n.status=io.READ)}getUnreadCount(){return this.messages.filter(t=>!t.isRead&&t.status===io.READY).length}getRecentRepliesForNpc(t,n=3){if(!t)return[];const s=[];return this.messages.forEach(o=>{o.senderId===t&&(!Array.isArray(o.replies)||o.replies.length===0||o.replies.forEach(i=>{s.push({messageId:o.id,messageTitle:o.title,content:i.content||"",tone:i.tone,toneLabel:i.toneLabel,timestamp:i.timestamp,createdAt:i.createdAt||0})}))}),s.sort((o,i)=>(i.createdAt||0)-(o.createdAt||0)),s.slice(0,n)}getMessagesByType(t){return this.messages.filter(n=>n.type===t)}getAllMessages(){return[...this.messages]}cleanup(){const t=this.messages.filter(s=>s.type===Lt.OBITUARY),n=this.messages.filter(s=>s.type!==Lt.OBITUARY);if(n.length>this.maxLetters){const s=n.slice(0,this.maxLetters);this.messages=[...t,...s]}this.messages.length>this.maxMessages&&(this.messages=this.messages.slice(0,this.maxMessages))}deleteMessage(t){this.messages=this.messages.filter(n=>n.id!==t)}loadFromData(t){this.messages=t||[]}toJSON(){return this.messages}}const Og={child:(e,t,n)=>{const s=e.age||0,o=Math.floor(s*12),i=e.sect&&e.sect.name,a=e.spouse!==null&&e.spouse!==void 0,l=e.tierTitle||"",{address:d}=Gy(e,t),u=d||t.name||"";let p="";if(o<216)i?p=`${e.sect.name}${l}`:p=`${l}`;else if(a&&i){const f=e.sect.name,x=e.spouse.name;p=`${f}${x}${l}`}else if(a){const f=e.spouse.name;p=`${f}${f}`}else i?p=`${e.sect.name}${l}`:p=`${l}`;const c=o<216?"":"";return`${u}

${p}

${e.name} ${c}
 ${n.year} ${n.month}`},spouse:(e,t,n)=>{var u,p,c,f,x;const s=((u=e.relationship)==null?void 0:u.affection)||60,o=((p=e.relationship)==null?void 0:p.jealousy)||0,i=((c=e.trait)==null?void 0:c.name)||"";let a=e.gender==="male"?"":"",l="";o>=60?i.includes("")||i.includes("")?l="...":i.includes("")?l="......":l="":s>=80?i.includes("")||i.includes("")?l="":i.includes("")||i.includes("")?l="...":i.includes("")?l="":l=`${e.tier||""}`:s>=50?l="":l="",(f=e.identity)!=null&&f.includes("")?l+=`

`:(x=e.identity)!=null&&x.includes("")&&(l+=`

`);const d=s>=70?"":"";return`${a}

${l}

${e.name} ${d}
 ${n.year} ${n.month}`},friend:(e,t,n)=>{var l,d;const s=((l=e.relationship)==null?void 0:l.affection)||50,o=((d=e.trait)==null?void 0:d.name)||"";let i="";s>=70?o.includes("")||o.includes("")?i="":o.includes("")||o.includes("")?i="":i="":i="";const a=s>=60?"":"";return`${t.name}

${i}

${e.name} ${a}
 ${n.year} ${n.month}`},default:(e,t,n)=>{var T,N,K,L,B;const s=typeof((T=e.relationship)==null?void 0:T.affection)=="number"?e.relationship.affection:typeof e.affection=="number"?e.affection:50,o=((N=e.trait)==null?void 0:N.name)||"",i=e.identity||"",a=e.tier||"",l=((K=e.sect)==null?void 0:K.name)||e.sect||"",d=(t==null?void 0:t.name)||"",u=((L=e.travelLog)==null?void 0:L.currentPlace)||((B=e.activity)==null?void 0:B.location)||e.currentResidence||l||"",p=s>=60?d:`${d}`,c=s>=85?"":s>=65?"":s>=45?"":"",x=`${u===""?"":`${u}`}${a}`,C=(()=>{const z=[{keywords:[""],text:""},{keywords:["",""],text:""},{keywords:[""],text:""},{keywords:["",""],text:""},{keywords:[""],text:""},{keywords:[""],text:""},{keywords:["",""],text:""},{keywords:[""],text:""}].find(ne=>ne.keywords.some(Q=>i.includes(Q)));return z?z.text:""})(),w=(()=>{var ne;const W=(ne=e.memories)==null?void 0:ne.recentEvents;if(!Array.isArray(W)||W.length===0)return"";const z=W.slice(-2).map(Q=>((Q==null?void 0:Q.description)||"").trim()).filter(Boolean);return z.length===0?"":`${z.join("")}`})(),S=(()=>{var ne;const W=(ne=e.memories)==null?void 0:ne.milestones;if(!Array.isArray(W)||W.length===0)return"";const z=W[W.length-1];return z!=null&&z.event?`${z.event}`:""})(),h=s>=85?"":s>=65?"":s>=45?"":"",g=o.includes("")?"":o.includes("")||o.includes("")?"":o.includes("")||o.includes("")?"":o.includes("")?"":o.includes("")?"":o.includes("")||o.includes("")?"":o.includes("")?"":"",v=s>=70?"":s>=50?"":"",j=[c,x,C,w,S].filter(Boolean).join(""),R=[h,g,v].filter(Boolean).join(""),b=[j,R].filter(W=>W&&W.trim().length>0).join(`

`),_=s>=80?"":s>=60?"":s>=45?"":"",I=(n==null?void 0:n.year)??"",k=(n==null?void 0:n.month)??"";return`${p}

${b}

${e.name} ${_}
 ${I} ${k}`}},Pg={child:(e,t,n)=>{const s=e.age||0,o=Math.floor(s*12),i=e.sect&&e.sect.name,a=e.spouse!==null&&e.spouse!==void 0,l=e.gender===""?e.motherName?"":"":e.fatherName?"":"";let d="";return o<216?d="......":a?d=`${e.spouse.name}/...`:i?d=`${e.sect.name}...`:d="...",`${l}

${d}

${e.name} 
 ${n.year} ${n.month}`},spouse:(e,t,n)=>{var l,d;const s=((l=e.trait)==null?void 0:l.name)||"",o=((d=e.relationship)==null?void 0:d.affection)||80,i=e.gender==="male"?"":"";let a="";return o>=90?s.includes("")||s.includes("")?a="......":s.includes("")||s.includes("")?a=".........":s.includes("")?a="......":a="...":o>=60?a="...":a="",`${i}

${a}

${e.name} 
 ${n.year} ${n.month}`},friend:(e,t,n)=>{var a,l;const s=((a=e.trait)==null?void 0:a.name)||"",o=((l=e.relationship)==null?void 0:l.affection)||60;let i="";return o>=70?s.includes("")||s.includes("")?i="":s.includes("")||s.includes("")?i="":i="":o>=40?i="":i="",`${t.name}

${i}

${e.name} 
 ${n.year} ${n.month}`},default:(e,t,n)=>{var i;const s=e.affection||((i=e.relationship)==null?void 0:i.affection)||50;let o="";return s>=60?o="":o="",`${t.name}

${o}

${e.name} 
 ${n.year} ${n.month}`}};async function t5(e,t,n,s="default",o,i={}){var a,l,d,u,p,c,f,x,C,w;try{console.log(" []",{:e.name,ID:e.id,:s,:{fatherName:e.fatherName||"",motherName:e.motherName||"",generation:e.generation||""},children:((a=i.children)==null?void 0:a.some(re=>re.id===e.id))||!1,:t.name});let S="",h="",g="";const v=e.relationship||{},j=v.affection||0,R=v.jealousy||0,b=v.stage||0,_=v.cutTies||!1,I=((l=i.exiledChildren)==null?void 0:l.some(re=>re.id===e.id))||!1;let k="";if((u=(d=e.memories)==null?void 0:d.profile)!=null&&u.firstMeet){const re=new Date(e.memories.profile.firstMeet),le=Math.floor((new Date-re)/(365.25*24*60*60*1e3));le>0?k=`
${le}`:k=`
`}let T="",N="";j>=90?(T="",N=""):j>=70?(T="",N=""):j>=50?(T="",N=""):j>=30?(T="",N=""):(T="",N="");let K="";if(s!=="child"&&e.memories)try{const re=Fy(e,{includeMilestones:!0,includeRecent:!0,maxRecent:5});re&&re.trim().length>0&&(K=`
`+re)}catch(re){console.warn(":",re)}let L="";const B=Array.isArray(i.replyHistory)?i.replyHistory:[];B.length>0&&(L=`

${B.map((ce,le)=>{const we=ce.timestamp,Ue=we&&we.year?` ${we.year} ${we.month}`:"",Oe=ce.toneLabel||"",ze=(ce.content||"").replace(/\s+/g," ").trim(),D=ze.length>60?`${ze.slice(0,60)}`:ze||"";return`${le+1}. ${Ue}  ${Oe}${D}`}).join(`
`)}
`);let W="";const z=((p=e.trait)==null?void 0:p.name)||"";z.includes("")?W="":z.includes("")?W="":z.includes("")?W="":z.includes("")?W="":z.includes("")?W="":z.includes("")?W="":z.includes("")?W="":z.includes("")?W="":z.includes("")?W="":z.includes("")?W="":z.includes("")?W="":z.includes("")?W="":z.includes("")?W="":z.includes("")?W="":z.includes("")?W="":z.includes("")?W="":z.includes("")?W="":z.includes("")?W="":z.includes("")?W="":z.includes("")||z.includes("")?W="":z.includes("")?W="":W="";let ne="";const Q=e.identity||"";Q.includes("")?ne=`
`:Q.includes("")?ne=`
`:Q.includes("")||Q.includes("")?ne=`
`:Q.includes("")?ne=`
`:Q.includes("")?ne=`
`:Q.includes("")?ne=`
`:Q.includes("")?ne=`
`:Q.includes("")?ne=`
`:Q.includes("")?ne=`
`:Q.includes("")?ne=`
`:Q.includes("")||Q.includes("")?ne=`
`:Q.includes("")?ne=`
`:Q.includes("")||Q.includes("")?ne=`
`:Q.includes("")?ne=`
`:Q.includes("")?ne=`
`:Q.includes("")?ne=`
`:Q.includes("")?ne=`
`:Q.includes("")?ne=`
`:Q.includes("")?ne=`
`:Q.includes("")&&(ne=`
`);let se="normal",ye="";switch(_||I?(se="farewell",g=`

`,_&&(g+=`${t.name}`),I&&(g+="")):R>=80&&s!=="child"?(se="jealous",g=`

${R}${t.name}

""""""""`):R>=60&&s!=="child"?(se="normal",ye="slight_jealous",g=`

${R}`):j>=70&&s==="spouse"?(se="missing",ye="longing",g=`

${j>=90?"":""}`):s==="spouse"&&Pe?(se="normal",ye="family"):s==="friend"?(se="normal",ye="sharing"):(se="normal",ye="general"),s){case"child":const re=Math.floor((e.age||0)*12),ce=((c=e.sect)==null?void 0:c.name)||e.sect||"",le=e.tierTitle||e.tier||"",we=e.spouse!==null&&e.spouse!==void 0,Ue=((f=e.spouse)==null?void 0:f.name)||"",Oe=Math.max(1,e.generation||1),{relation:ze}=Gy(e,t),D=e.fatherName||e.motherName||"",me=!!e.fatherName;let xe=`${e.name}${Math.floor(e.age||0)}${le}
${t.name}${ze}`;D&&D!==""&&(xe+=`
${D}${me?"":""}`),ce&&(xe+=`
${ce}`),we&&(xe+=`
${Ue}`),S=xe,I?h=`${ze}`:re<216?h=`${ze}`:h=`${ze}`;break;case"spouse":S=`${t.name}${e.name}${e.tier||""}`,_?h="":se==="jealous"?h="":h="";break;case"friend":if(e.fatherName||e.motherName||e.generation||e.parent||e.parentId||((x=t.children)==null?void 0:x.some(Ee=>Ee.id===e.id))){const Ee=(n.year-(e.birthYear||0))*12+(n.month-(e.birthMonth||1)),Xe=t.gender===""?"":"";S=`${t.name}${Math.floor(Ee/12)}`,Ee<216?h=""+Xe+"":h=""}else S=`${t.name}${e.name}${e.tier||""}`,_?h="":h="";break;default:S=`${e.name}${e.tier||""}${t.name}`,h=""}let Me="",Pe=!1,Ke="";if(b>=3&&s==="spouse"&&(Me+=`
`),i.dualCultivationCount>0&&s==="spouse"&&(Me+=`
${i.dualCultivationCount}`),i.children&&i.children.length>0){const re=i.children.filter(ce=>ce.fatherName===e.name||ce.motherName===e.name||s==="child"&&ce.parentId===e.id);if(re.length>0){Pe=!0;const ce=re.map(le=>le.name).join("");if(s==="spouse")Ke=`
${re.length}${ce}`,e.gender===""&&(Ke+=`
${j>=80?"":j>=60?"":""}`);else if(s==="child"){const le=re.filter(we=>we.id!==e.id);le.length>0&&(Ke=`
${le.length}${le.map(we=>we.name).join("")}`)}Me+=Ke}}let q="";if(s==="child")q=`${e.name}${t.name}${se==="farewell"?"":""}


${S}

${h?`
${h}`:""}

${L?`${L}
`:""}


- 
- ${e.name}
- ${t.name}${playerRelation}
- ${generation===1?"":generation===2?"":""}
- ${se==="farewell"?"":""}
- 250
- """"""""""
- ${e.name} ${childAge<216?"":""}
 ${n.year} ${n.month}`;else{let re="";Pe&&e.gender===""&&(re=""),q=`${e.name}${t.name}${se==="farewell"?"":""}


${re}${t.name}


${S}
${e.identity||""}
${e.tier||""}
${e.sect?`${e.sect}`:""}


${((C=e.trait)==null?void 0:C.name)||""}${((w=e.trait)==null?void 0:w.description)||""}
${W}


${ne||""}


${j}${T}
${k}${Me}

${L}${K}${g}


1. 1-2""""
2. ${N}${h}
3. 120-180
4. 
   ${se==="farewell"?"- //":se==="jealous"?'- """"':se==="missing"?"- ":ye==="slight_jealous"?`- 
   - `:ye==="family"?"- ":ye==="sharing"?"- ":`- 
   - `}
   ${Pe&&se!=="jealous"?"- ":""}
   ${se!=="jealous"&&se!=="farewell"?`- 
   - `:""}
5. 
6. "${e.name}\\n ${n.year} ${n.month}"`}const de=[{role:"system",content:q},{role:"user",content:s==="child"?`${e.name}${t.name}${se==="farewell"?"":""} ${n.year} ${n.month}
          

1. """"""""
2. 
3. `:`${e.name}${t.name}${se==="farewell"?"":se==="jealous"?"":se==="missing"?"":""} ${n.year} ${n.month}`}];return await Aa(de,o.apiKey,o.apiUrl||"https://api.deepseek.com/chat/completions",{model:o.apiModel||"deepseek-chat",temperature:.9,maxTokens:350})}catch(S){return console.error("AI:",S),jp(e,t,n,s)}}function jp(e,t,n,s="default"){var i;return s==="friend"&&(e.fatherName||e.motherName||e.generation||e.parent||e.parentId||(i=t.children)!=null&&i.some(l=>l.id===e.id))&&(s="child"),(Og[s]||Og.default)(e,t,n)}function n5(e,t,n,s="default"){var i;return s==="friend"&&(e.fatherName||e.motherName||e.generation||e.parent||e.parentId||(i=t.children)!=null&&i.some(l=>l.id===e.id))&&(s="child"),(Pg[s]||Pg.default)(e,t,n)}function r5(e,t=3,n=null){var l,d,u,p,c,f;if(!e||e.acceptsLetters===!1)return!1;const s=typeof((l=e.relationship)==null?void 0:l.affection)=="number"?e.relationship.affection:void 0,o=typeof e.affection=="number"?e.affection:s;if(!e.isChild&&typeof o=="number"&&o<100||n&&((d=n.extras)==null?void 0:d.hasNpcRespondedToReply)===!0&&(!(n.replies&&n.replies.length>0)||n.extras.hasNpcRespondedToReply===!0)||t<3)return!1;let i=.3;const a=typeof o=="number"?o:0;return a>80?i+=.3:a>60?i+=.2:a>40&&(i+=.1),((u=e.traits)!=null&&u.includes("")||(p=e.traits)!=null&&p.includes(""))&&(i+=.2),((c=e.traits)!=null&&c.includes("")||(f=e.traits)!=null&&f.includes(""))&&(i-=.2),Math.random()<Math.max(.1,Math.min(.9,i))}function Yy(e,t){var n,s;return e.id===((n=t.spouse)==null?void 0:n.id)?"spouse":(s=t.children)!=null&&s.some(o=>o.id===e.id)||e.isChild===!0||e.fatherName||e.motherName||e.generation||e.parent||e.parentId?"child":e.affection>60?"friend":"default"}function s5(e,t,n){const s=Yy(e,t),o=n5(e,t,n,s);let i="";return s==="child"?i=`${e.name}`:s==="spouse"?i=`${e.name}`:s==="friend"&&(i=`${e.name}`),Vy({type:Lt.OBITUARY,senderId:e.id,senderName:e.name,title:i,content:o,timestamp:{...n},extras:{npcId:e.id,relation:s,deathCause:e.deathCause||""},status:io.READY})}async function zg(e,t,n,s=!0,o={},i={}){const a=Yy(e,t),l=Array.isArray(i.replyHistory)?i.replyHistory:[],d=l[0],u=l.length>0,p=u&&((d==null?void 0:d.content)||"").replace(/\s+/g," ").trim().slice(0,40)||"";let c="";a==="child"?c="":a==="spouse"?c="":a==="friend"&&(c="");let f="";if(s)if(o.useAIForLetter&&o.apiKey&&o.apiKey.trim().length>0)try{f=await t5(e,t,n,a,o,i)}catch(w){console.error("AI:",w),f=jp(e,t,n,a)}else f=jp(e,t,n,a);return Vy({type:Lt.LETTER,senderId:e.id,senderName:e.name,title:`${e.name}${c}`,content:f,timestamp:{...n},extras:{npcId:e.id,relation:a,...u?{isReplyToPlayer:!0,replySourceCount:l.length,replySourceTone:(d==null?void 0:d.toneLabel)||"",replySourceSnippet:p,replySourceTimestamp:(d==null?void 0:d.timestamp)||null,hasNpcRespondedToReply:!0}:{}},status:s?io.READY:io.PENDING})}async function o5(e,t,n={}){var s,o;try{const i=e.name||"",a=e.tier||e.tierTitle||"",l=e.gender==="female"||e.gender===""?"":"",d=(typeof e.sect=="string"?e.sect:(s=e.sect)==null?void 0:s.name)||"",u=e.age||0,p=e.generation||1;let c="";e.spiritRoot&&(e.spiritRoot.type?c=e.spiritRoot.type:Array.isArray(e.spiritRoot.elements)&&e.spiritRoot.elements.length>0&&(c=e.spiritRoot.elements.map(g=>typeof g=="object"?g.element||g.type||"":g).join("")+""));let f="";e.personality&&(typeof e.personality=="string"?f=e.personality:typeof e.personality=="object"&&(f=e.personality.label||e.personality.desc||""));let x="";const C=((o=e.stats)==null?void 0:o.looks)||60;C>=90?x=l===""?"":"":C>=80?x=l===""?"":"":C>=70?x=l===""?"":"":C>=60?x="":x="";let w="";if(e.parents){const g=[];e.parents.father&&g.push(e.parents.father),e.parents.mother&&g.push(e.parents.mother),g.length>0&&(w=`${g.join("")}`)}const S=[{role:"system",content:""},{role:"user",content:`JSON summary  bio {"summary":"...","bio":"..."}

****
${i}
${l}
${u}
${a}
${p}
${d}
${c}
${f}
${x}
${w}

**** ${(t==null?void 0:t.name)||""}

****

1. summary100-120
   - "${i}${p===1?"":""}"
   - /
   - /
   - /

2. bio150-200
   - ${i}
   - 
   - 
   - "${(t==null?void 0:t.name)||""}"//
   - 

****
- 
- 
- 
- /`}],h=await Aa(S);try{const g=JSON.parse(h);return{summary:g.summary||"",bio:g.bio||""}}catch(g){console.warn("Failed to parse AI response as JSON:",g);const v=h.match(/"summary"\s*:\s*"([^"]+)"/),j=h.match(/"bio"\s*:\s*"([^"]+)"/);return{summary:v?v[1]:h.substring(0,200),bio:j?j[1]:h.substring(200,400)}}}catch(i){return console.error("Error generating child profile:",i),{summary:"",bio:""}}}const Oi=[{id:"warm",label:"",desc:"",affectionDelta:5},{id:"calm",label:"",desc:"",affectionDelta:3},{id:"firm",label:"",desc:"",affectionDelta:-2}],i5=({isOpen:e,onClose:t,messages:n,onMarkAsRead:s,onDeleteMessage:o,onSendReply:i})=>{var N,K,L;const[a,l]=y.useState(null),[d,u]=y.useState("all"),[p,c]=y.useState(""),[f,x]=y.useState(Oi[0].id),[C,w]=y.useState(!1),[S,h]=y.useState(null),g=y.useMemo(()=>{const B=Array.isArray(n)?n:[];return d==="all"?B:d==="letter"?B.filter(W=>W.type===Lt.LETTER||W.type===Lt.DEPARTURE||W.type===Lt.ACHIEVEMENT):d==="obituary"?B.filter(W=>W.type===Lt.OBITUARY):B},[n,d]),v=y.useMemo(()=>g.find(B=>B.id===a),[g,a]);y.useEffect(()=>{c(""),x(Oi[0].id),h(null)},[a]);const j=B=>{l(B.id),B.isRead||s(B.id)},R=()=>{l(null),t()};y.useEffect(()=>{const B=W=>{W.key==="Escape"&&R()};return window.addEventListener("keydown",B),()=>window.removeEventListener("keydown",B)},[R]);const b=B=>{if(!B)return"";if(typeof B=="object"&&B.year)return` ${Math.floor(B.year)}${B.month}`;const W=new Date(B);return Number.isNaN(W.getTime())?"":`${W.getFullYear()}${W.getMonth()+1}${W.getDate()}`},_=v&&v.type!==Lt.OBITUARY&&typeof i=="function",I=async()=>{var z;if(!_)return;const B=p.trim();if(!B){h("");return}const W=Oi.find(ne=>ne.id===f)||Oi[0];w(!0);try{const ne=await Promise.resolve(i({messageId:v.id,targetNpcId:v.senderId,relation:(z=v.extras)==null?void 0:z.relation,content:B,tone:W}));ne&&ne.success?(c(""),h(""),setTimeout(()=>h(null),1800)):h((ne==null?void 0:ne.error)||"")}finally{w(!1)}},k=B=>{switch(B){case Lt.OBITUARY:return"";case Lt.LETTER:return"";case Lt.DEPARTURE:return"";case Lt.ACHIEVEMENT:return"";default:return""}},T=B=>B===Lt.OBITUARY?"message-background-obituary":"message-background-letter";return e?r.jsx("div",{className:"message-center-overlay",onClick:R,children:r.jsxs("div",{className:"message-center-modal",onClick:B=>B.stopPropagation(),children:[r.jsxs("div",{className:"message-center-header",children:[r.jsx("h2",{children:" "}),r.jsx("button",{className:"close-btn",onClick:R,children:""})]}),r.jsxs("div",{className:"message-filters",children:[r.jsxs("button",{className:`filter-btn ${d==="all"?"active":""}`,onClick:()=>u("all"),children:[" (",n.length,")"]}),r.jsxs("button",{className:`filter-btn ${d==="letter"?"active":""}`,onClick:()=>u("letter"),children:[" (",n.filter(B=>B.type!==Lt.OBITUARY).length,")"]}),r.jsxs("button",{className:`filter-btn ${d==="obituary"?"active":""}`,onClick:()=>u("obituary"),children:[" (",n.filter(B=>B.type===Lt.OBITUARY).length,")"]}),n.some(B=>!B.isRead)&&r.jsx("button",{className:"filter-btn mark-all-read-btn",onClick:()=>{n.forEach(B=>{B.isRead||s(B.id)})},style:{marginLeft:"auto",background:"#7AA893",color:"white"},children:" "})]}),r.jsxs("div",{className:"message-center-content",children:[r.jsx("div",{className:"message-list",children:g.length===0?r.jsxs("div",{className:"empty-message",children:[r.jsx("p",{children:""}),r.jsx("p",{children:""})]}):g.map(B=>{var W,z;return r.jsxs("div",{className:`message-item ${a===B.id?"selected":""} ${B.isRead?"":"unread"} ${B.type===Lt.OBITUARY?"obituary":""}`,onClick:()=>j(B),children:[!B.isRead&&r.jsx("span",{className:"unread-dot"}),r.jsx("div",{className:"message-avatar",children:B.type===Lt.OBITUARY?"":""}),r.jsxs("div",{className:"message-info",children:[r.jsxs("div",{className:"message-sender",children:[B.senderName,r.jsx("span",{className:"message-type-label",children:k(B.type)}),((W=B.extras)==null?void 0:W.isReplyToPlayer)&&r.jsx("span",{className:"message-reply-badge",children:""}),((z=B.replies)==null?void 0:z.length)>0&&r.jsxs("span",{className:"message-replied-flag",children:["",B.replies.length]})]}),r.jsx("div",{className:"message-title",children:B.title}),r.jsxs("div",{className:"message-time",children:[" ",B.timestamp.year," ",B.timestamp.month,""]})]})]},B.id)})}),r.jsx("div",{className:`message-reader ${v?T(v.type):""}`,children:v?r.jsxs("div",{className:"reader-content",children:[r.jsxs("div",{className:"reader-header",children:[r.jsx("h3",{children:v.title}),r.jsxs("div",{className:"reader-meta",children:[r.jsx("span",{children:v.senderName}),r.jsx("span",{children:""}),r.jsxs("span",{children:[" ",v.timestamp.year," ",v.timestamp.month,""]})]})]}),r.jsx("div",{className:"reader-body",children:v.content?r.jsx("pre",{className:"message-content",children:v.content}):r.jsx("p",{className:"content-loading",children:"..."})}),((N=v.extras)==null?void 0:N.isReplyToPlayer)&&r.jsxs("div",{className:"reply-context-banner",children:[r.jsxs("div",{children:[" ",((K=v.extras)==null?void 0:K.replySourceTimestamp)&&r.jsx("span",{className:"reply-context-time",children:b(v.extras.replySourceTimestamp)})]}),((L=v.extras)==null?void 0:L.replySourceSnippet)&&r.jsxs("div",{className:"reply-context-snippet",children:["",v.extras.replySourceSnippet,""]})]}),v.replies&&v.replies.length>0&&r.jsxs("div",{className:"reply-thread",children:[r.jsx("h4",{children:" "}),r.jsx("div",{className:"reply-list",children:v.replies.map(B=>r.jsxs("div",{className:"reply-entry",children:[r.jsxs("div",{className:"reply-meta",children:[r.jsx("span",{children:B.from||""}),B.toneLabel&&r.jsx("span",{className:"reply-tone-label",children:B.toneLabel}),r.jsx("span",{children:b(B.timestamp)})]}),r.jsx("pre",{className:"reply-content",children:B.content})]},B.id))})]}),r.jsx("div",{className:"reader-actions",children:v.type===Lt.OBITUARY?r.jsxs(r.Fragment,{children:[r.jsx("button",{className:"action-btn secondary",children:" "}),r.jsx("button",{className:"action-btn danger",onClick:()=>{window.showConfirm&&window.showConfirm("",()=>{o(v.id),l(null)})},children:""})]}):r.jsx(r.Fragment,{children:r.jsx("button",{className:"action-btn",onClick:()=>{o(v.id),l(null)},children:""})})}),_&&r.jsxs("div",{className:"reply-composer",children:[r.jsxs("h4",{children:["  ",v.senderName]}),r.jsx("div",{className:"reply-tone-options",children:Oi.map(B=>r.jsxs("button",{type:"button",className:`tone-btn ${f===B.id?"active":""}`,onClick:()=>x(B.id),children:[r.jsx("div",{className:"tone-header",children:r.jsx("span",{children:B.label})}),r.jsx("p",{children:B.desc})]},B.id))}),r.jsx("textarea",{className:"reply-input",placeholder:"120",maxLength:120,value:p,onChange:B=>c(B.target.value)}),r.jsxs("div",{className:"reply-actions",children:[S&&r.jsx("span",{className:"reply-feedback",children:S}),r.jsx("button",{type:"button",className:"action-btn primary",onClick:I,disabled:C,children:C?"...":""})]})]})]}):r.jsxs("div",{className:"reader-placeholder",children:[r.jsx("p",{children:""}),r.jsx("p",{children:""})]})})]})]})}):null},a5="cultivation_save_v1_slot_",l5="cultivation_autosave_",Vl=5,qc=3,fu=100,Dg=20;let ws=!1,Yi=!1;const Kc=()=>{try{const e="__localStorage_test__";return localStorage.setItem(e,"test"),localStorage.removeItem(e),!0}catch(e){return console.error("localStorage :",e),!1}},qy=()=>(ws=Vb(),console.log(ws?" TapTap ":"  TapTap "),ws),Xs=e=>`${l5}${e}`,ii=(e=1)=>`${a5}${e}`,Ky=e=>new Blob([JSON.stringify(e)]).size/1024,Qy=()=>{let e=0;for(let t in localStorage)localStorage.hasOwnProperty(t)&&(e+=localStorage[t].length+t.length);return{used:(e/1024).toFixed(2),usedMB:(e/1024/1024).toFixed(2)}},Cp=e=>!e||typeof e!="object"?e:Rp(e),Yl=e=>Array.isArray(e)?e.map(t=>Cp(t)):e,c5=e=>{if(!e||typeof e!="object")return e;const t=Cp(e);return Array.isArray(e.worldNpcs)&&(t.worldNpcs=Yl(e.worldNpcs)),e.rival&&(t.rival=Cp(e.rival)),Array.isArray(e.spouses)&&(t.spouses=Yl(e.spouses)),Array.isArray(e.followers)&&(t.followers=Yl(e.followers)),Array.isArray(e.generation3Plus)?t.generation3Plus=e.generation3Plus:t.generation3Plus=[],t},Cc=e=>{if(!e||typeof e!="object")return e;const t={...e};return t.player=c5(e.player),["activeNpcs","children","deadNpcs","worldNpcs"].forEach(n=>{Array.isArray(e[n])&&(t[n]=Yl(e[n]))}),Array.isArray(t.inventory)||(console.warn(" "),t.inventory=[]),t},Jy=e=>{let t={...e};return t=ah(t),t.logs&&t.logs.length>fu&&(console.log(` ${t.logs.length} -> ${fu}`),t.logs=t.logs.slice(0,fu)),t.activeNpcs&&(t.activeNpcs=t.activeNpcs.map(n=>n.logs&&n.logs.length>Dg?{...n,logs:n.logs.slice(-Dg)}:n)),t.deadNpcs&&(t.deadNpcs=t.deadNpcs.map(n=>({id:n.id,name:n.name,deathYear:n.deathYear,deathReason:n.deathReason}))),t.messages&&Object.keys(t.messages).forEach(n=>{const s=t.messages[n];s&&s.length>30&&(t.messages[n]=s.slice(-30))}),t.player&&Array.isArray(t.player.generation3Plus)&&(t.player.generation3Plus=t.player.generation3Plus.map(n=>({id:n.id,generation:n.generation,birthYear:n.birthYear,parentGeneration:n.parentGeneration}))),t},Xy=(e,t=1)=>{var n,s,o,i,a,l;if(!Kc())return{success:!1,error:"STORAGE_UNAVAILABLE",message:"localStorage "};try{const d=Jy(e),u=((s=(n=d.player)==null?void 0:n.time)==null?void 0:s.year)||((o=d.player)==null?void 0:o.age)||3572,p=((a=(i=d.player)==null?void 0:i.time)==null?void 0:a.month)||((l=d.player)==null?void 0:l.month)||1,c={...d,timestamp:Date.now(),saveDate:new Date().toLocaleString(),slotNumber:t,gameTime:` ${u} ${p}`,year:u,month:p},f=JSON.stringify(c),x=Ky(c);return console.log(`: ${x.toFixed(2)} KB`),x>5120?(console.warn(""),{success:!1,error:"STORAGE_TOO_LARGE",size:x.toFixed(2)}):(localStorage.setItem(ii(t),f),ws&&!Yi&&(Yi=!0,lh(t,c).then(C=>{console.log(`  [${t}]:`,C.action),Yi=!1}).catch(C=>{console.warn(`  [${t}]:`,C.message),Yi=!1})),{success:!0,time:c.saveDate,slot:t,size:x.toFixed(2)})}catch(d){return console.error("Save failed:",d),d.name==="QuotaExceededError"||d.code===22?{success:!1,error:"QUOTA_EXCEEDED",message:""}:{success:!1,error:d.name||"UNKNOWN_ERROR",message:d.message}}},Go=(e=1)=>{try{const t=localStorage.getItem(ii(e));if(!t)return null;const n=JSON.parse(t);return Cc(n)}catch(t){return console.error("Load failed:",t),null}},Of=async(e=1)=>{if(!ws)return console.log(""),Go(e);try{const t=Go(e),n=(t==null?void 0:t.timestamp)||0,s=await Yb(e,n);if(!s)return console.log(` [${e}]`),t;console.log(` [${e}]...`);const o=await qb(s.uuid,s.fileId,e);if(o){const i=Cc(o);return localStorage.setItem(ii(e),JSON.stringify(i)),console.log(`  [${e}]`),i}return Cc(o)}catch(t){return console.error(` [${e}]:`,t),console.log(""),Go(e)}},Pf=()=>{var t,n;const e=[];if(!Kc()){console.warn("localStorage ");for(let s=1;s<=Vl;s++)e.push({slot:s,exists:!1,error:"localStorage"});return e}try{for(let s=1;s<=Vl;s++){const o=ii(s),i=localStorage.getItem(o);if(i)try{const a=JSON.parse(i);e.push({slot:s,exists:!0,saveDate:a.saveDate||"",playerName:((t=a.player)==null?void 0:t.name)||"",cultivation:((n=a.player)==null?void 0:n.cultivation)||0,timestamp:a.timestamp||0})}catch(a){console.error(` ${s} :`,a),e.push({slot:s,exists:!1})}else e.push({slot:s,exists:!1})}}catch(s){console.error(":",s);for(let o=1;o<=Vl;o++)e.push({slot:o,exists:!1})}return e},Zy=(e=1)=>{localStorage.removeItem(ii(e))},d5=()=>{for(let e=1;e<=Vl;e++)localStorage.removeItem(ii(e));for(let e=1;e<=qc;e++)localStorage.removeItem(Xs(e))},e1=e=>{var t,n,s,o,i,a;if(!Kc())return console.warn("localStorage "),{success:!1,error:"STORAGE_UNAVAILABLE"};try{const l=Jy(e),d=((n=(t=l.player)==null?void 0:t.time)==null?void 0:n.year)||Math.floor(((s=l.player)==null?void 0:s.age)||0)||3572,u=((i=(o=l.player)==null?void 0:o.time)==null?void 0:i.month)||1,p=Math.floor(((a=l.player)==null?void 0:a.age)||0),c={...l,player:{...l.player,age:p},timestamp:Date.now(),saveDate:new Date().toLocaleString(),isAutoSave:!0,gameTime:` ${d} ${u}`,year:d,month:u},f=JSON.stringify(c),x=Ky(c);if(x>4096)return console.warn(""),{success:!1,error:"STORAGE_TOO_LARGE"};for(let C=qc;C>1;C--){const w=Xs(C-1),S=localStorage.getItem(w);S&&localStorage.setItem(Xs(C),S)}return localStorage.setItem(Xs(1),f),console.log(`  [ ${d} ${u}] : ${x.toFixed(2)} KB`),l.logs&&console.log(` :  ${l.logs.length||0} `),{success:!0,time:c.saveDate,gameTime:c.gameTime,size:x.toFixed(2)}}catch(l){return console.error(":",l),{success:!1,error:l.message}}},t1=()=>{var t,n,s,o;const e=[];if(!Kc())return console.warn("localStorage "),e;try{for(let i=1;i<=qc;i++){const a=Xs(i),l=localStorage.getItem(a);if(l)try{const d=JSON.parse(l);e.push({slot:i,exists:!0,saveDate:d.saveDate||"",gameTime:d.gameTime||"",year:d.year||0,month:d.month||0,playerName:((t=d.player)==null?void 0:t.name)||"",cultivation:((n=d.player)==null?void 0:n.cultivation)||0,age:Math.floor(((s=d.player)==null?void 0:s.age)||0),tier:((o=d.player)==null?void 0:o.tierTitle)||""})}catch(d){console.error(` ${i} :`,d),e.push({slot:i,exists:!1,error:""})}else e.push({slot:i,exists:!1})}}catch(i){console.error(":",i)}return e},n1=(e=1)=>{try{const t=localStorage.getItem(Xs(e));if(!t)return null;const n=JSON.parse(t);return console.log(` [${e}]: ${n.gameTime}`),Cc(n)}catch(t){return console.error(` ${e} :`,t),null}},r1=()=>{for(let e=1;e<=qc;e++)localStorage.removeItem(Xs(e));console.log("")},s1=async(e=1)=>{if(!ws)throw new Error("");const t=Go(e);if(!t)throw new Error(` ${e} `);return await lh(e,t)},o1=async(e=1)=>{if(!ws)throw new Error("");const t=await Of(e);if(!t)throw new Error("");return t},i1=()=>({enabled:ws,syncing:Yi}),u5=Object.freeze(Object.defineProperty({__proto__:null,autoSaveGame:e1,clearAllAutoSaves:r1,clearAllSaves:d5,clearSave:Zy,getAllAutoSaves:t1,getAllSaveSlots:Pf,getCloudSaveStatus:i1,getStorageInfo:Qy,initCloudSaveSystem:qy,loadAutoSave:n1,loadGameFromCloud:Of,loadGameFromStorage:Go,manualDownloadFromCloud:o1,manualUploadToCloud:s1,saveGameToStorage:Xy},Symbol.toStringTag,{value:"Module"})),p5=({onFinish:e,onLoadGame:t})=>{const[n,s]=y.useState(0),[o,i]=y.useState([]),[a,l]=y.useState(!1);y.useEffect(()=>{const p=Pf();i(p)},[]);const d=[{text:"",sub:""},{text:"",sub:""},{text:"",sub:""},{text:"",sub:"..."},{text:"",sub:`

`}],u=o.some(p=>p.exists);return a?r.jsxs(r.Fragment,{children:[r.jsx("div",{style:Ft.overlay}),r.jsxs("div",{style:Ft.container,children:[r.jsx("h2",{style:{color:"#d4af37",marginBottom:"clamp(15px, 4vw, 30px)",fontSize:"clamp(18px, 5vw, 24px)"},children:""}),r.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"clamp(10px, 2vw, 15px)",width:"100%",maxWidth:"500px",marginBottom:"10px"},children:o.map(p=>r.jsxs("div",{style:{...Ft.slotCard,opacity:p.exists?1:.5,cursor:p.exists?"pointer":"not-allowed"},onClick:()=>{p.exists&&t(p.slot)},children:[r.jsxs("div",{style:Ft.slotHeader,children:[r.jsxs("span",{style:Ft.slotTitle,children:[" ",p.slot]}),p.exists&&r.jsx("span",{style:Ft.slotBadge,children:""})]}),p.exists?r.jsxs("div",{style:{fontSize:"clamp(11px, 2.8vw, 13px)",color:"#ccc",marginTop:"8px",lineHeight:"1.5"},children:[r.jsxs("div",{children:[": ",p.playerName]}),p.cultivation>0&&r.jsxs("div",{children:[": ",p.cultivation," "]}),r.jsxs("div",{style:{fontSize:"clamp(10px, 2.5vw, 12px)",marginTop:"4px",opacity:.8},children:[": ",p.saveDate]})]}):r.jsx("div",{style:{fontSize:"clamp(12px, 3vw, 13px)",color:"#999",marginTop:"8px"},children:""})]},p.slot))}),r.jsx("button",{onClick:()=>l(!1),style:{...Ft.btn,background:"#666",marginTop:"clamp(10px, 2vw, 20px)",width:"clamp(150px, 40vw, 200px)",padding:"clamp(10px, 2.5vw, 12px)",minHeight:"auto"},children:" "})]})]}):n<d.length?r.jsxs(r.Fragment,{children:[r.jsx("div",{style:Ft.overlay,onClick:()=>s(n+1)}),r.jsxs("div",{style:Ft.container,children:[r.jsx("h1",{style:Ft.title,children:d[n].text}),r.jsx("p",{style:Ft.sub,children:d[n].sub}),u&&n===0&&r.jsx("button",{onClick:p=>{p.stopPropagation(),l(!0)},style:{...Ft.btn,background:"#4caf50",marginBottom:"clamp(15px, 3vw, 20px)",width:"clamp(160px, 45vw, 200px)",textAlign:"center",border:"2px solid #45a049",minHeight:"auto",padding:"clamp(10px, 2.5vw, 12px)"},children:" "}),r.jsx("div",{style:Ft.tip,children:"[  ]"}),r.jsx("button",{onClick:()=>s(n+1),style:Ft.continueBtn,children:" "})]})]}):r.jsxs(r.Fragment,{children:[r.jsx("div",{style:Ft.overlay}),r.jsxs("div",{style:Ft.container,children:[r.jsx("h2",{style:{color:"#d4af37",marginBottom:"clamp(20px, 5vw, 30px)",fontSize:"clamp(20px, 5vw, 28px)"},children:""}),r.jsx("p",{style:Ft.sub,children:"..."}),r.jsx("button",{style:{...Ft.continueBtn,background:"#d4af37",fontSize:"clamp(15px, 4vw, 18px)",padding:"clamp(12px, 3vw, 15px) clamp(30px, 8vw, 40px)",marginTop:"clamp(15px, 4vw, 25px)"},onClick:()=>e(),children:" "})]})]})},Ft={overlay:{position:"fixed",top:0,left:0,width:"100%",height:"100%",background:"rgba(0, 0, 0, 0.85)",zIndex:2499,backdropFilter:"blur(8px)"},container:{position:"fixed",top:"50%",left:"50%",transform:"translate(-50%, -50%)",width:"90%",maxWidth:"600px",maxHeight:"90vh",background:"linear-gradient(135deg, #1a1a1a 0%, #2d2d2d 100%)",color:"white",display:"flex",flexDirection:"column",justifyContent:"flex-start",alignItems:"center",zIndex:2500,padding:"clamp(15px, 4vw, 30px)",textAlign:"center",overflowY:"auto",overflowX:"hidden",borderRadius:"clamp(8px, 2vw, 16px)",boxShadow:"0 20px 60px rgba(0, 0, 0, 0.8)",border:"2px solid rgba(211, 47, 47, 0.5)",WebkitOverflowScrolling:"touch"},title:{fontSize:"clamp(18px, 5vw, 32px)",marginBottom:"clamp(12px, 3vw, 20px)",animation:"fadeIn 1s",lineHeight:"1.3",wordBreak:"break-word"},sub:{fontSize:"clamp(13px, 3.5vw, 16px)",color:"#ccc",lineHeight:"1.6",maxWidth:"100%",animation:"slideUp 1s",padding:"0 5px",wordBreak:"break-word",marginBottom:"clamp(10px, 2vw, 15px)"},tip:{fontSize:"clamp(10px, 2.5vw, 12px)",color:"#888",marginTop:"clamp(8px, 2vw, 10px)",marginBottom:"5px"},continueBtn:{padding:"clamp(8px, 2vw, 10px) clamp(20px, 5vw, 30px)",background:"#d32f2f",border:"none",color:"#fff",borderRadius:"clamp(6px, 1.5vw, 8px)",cursor:"pointer",fontSize:"clamp(13px, 3vw, 14px)",fontWeight:"bold",transition:"all 0.3s",marginTop:"clamp(10px, 2vw, 15px)",minHeight:"40px",width:"auto"},btn:{padding:"clamp(12px, 3vw, 15px) clamp(10px, 2vw, 12px)",background:"#1a1a1a",border:"2px solid #666",color:"#fff",borderRadius:"clamp(8px, 2vw, 12px)",cursor:"pointer",textAlign:"center",transition:"all 0.3s",fontSize:"clamp(12px, 3vw, 15px)",lineHeight:"1.5",whiteSpace:"normal",wordWrap:"break-word",minHeight:"clamp(50px, 12vw, 70px)",display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",gap:"6px",width:"100%"},slotCard:{background:"rgba(255, 255, 255, 0.05)",padding:"clamp(12px, 3vw, 15px)",borderRadius:"clamp(6px, 1.5vw, 8px)",border:"2px solid rgba(255, 255, 255, 0.1)",transition:"all 0.3s",marginBottom:"8px"},slotHeader:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"8px",flexWrap:"wrap",gap:"5px"},slotTitle:{fontSize:"clamp(14px, 3.5vw, 16px)",fontWeight:"bold",color:"#d4af37"},slotBadge:{fontSize:"clamp(16px, 4vw, 18px)",color:"#4caf50"}},f5=({onConfirm:e,onExit:t})=>{const[n,s]=y.useState("warning"),[o,i]=y.useState(!1),a=()=>{const d=` 


 bug


 
/

 
1. ""
2. " "
3. " "
4. 

 
1. ""
2. " "
3. 
   -  
   -  
   -  
4. 

 
- 
- 50000 10 10 

 
1. 
2. Base64
3. 
4. 

`;navigator.clipboard.writeText(d).then(()=>{i(!0),setTimeout(()=>i(!1),2e3)}).catch(()=>{const u=document.createElement("textarea");u.value=d,document.body.appendChild(u),u.select(),document.execCommand("copy"),document.body.removeChild(u),i(!0),setTimeout(()=>i(!1),2e3)})},l={overlay:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0, 0, 0, 0.7)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:9999,padding:"20px"},container:{background:"linear-gradient(135deg, #f5ecd5 0%, #e0c9a6 100%)",borderRadius:"28px 28px 22px 22px/36px 36px 18px 18px",border:"2.5px solid #bfa76a",color:"#5b4322",boxShadow:"0 12px 48px rgba(191, 167, 106, 0.18)",maxWidth:"600px",width:"100%",maxHeight:"80vh",display:"flex",flexDirection:"column",overflow:"hidden"},header:{padding:"20px",borderBottom:"1px solid #d4af37",background:"linear-gradient(90deg, #f5ecd5 60%, #e0c9a6 100%)",textAlign:"center"},warningBanner:{backgroundColor:"#ff6b6b",color:"#fff",padding:"8px 16px",borderRadius:"12px",marginBottom:"12px",fontSize:"13px",fontWeight:"bold",display:"inline-block",letterSpacing:"0.5px",boxShadow:"0 4px 12px rgba(255, 107, 107, 0.3)"},title:{fontSize:"24px",fontWeight:"bold",color:"#a67c2d",margin:0,marginBottom:"5px"},subtitle:{fontSize:"14px",color:"#8c6b3b",margin:0},tabs:{display:"flex",borderBottom:"1px solid #d4af37",padding:"0 20px",gap:"20px",backgroundColor:"#f5ecd5",justifyContent:"center"},tab:{padding:"10px 28px",cursor:"pointer",fontSize:"15px",color:"#8c6b3b",border:"none",borderRadius:"18px 18px 0 0/22px 22px 0 0",background:"linear-gradient(90deg, #f5ecd5 60%, #e0c9a6 100%)",marginBottom:"-1px",boxShadow:"0 2px 8px rgba(191,167,106,0.08)",transition:"all 0.3s",outline:"none",fontWeight:500,borderBottom:"2.5px solid transparent"},tabActive:{color:"#a67c2d",background:"linear-gradient(90deg, #f9f5e6 60%, #f3e2c2 100%)",borderBottom:"2.5px solid #a67c2d",boxShadow:"0 4px 16px rgba(191,167,106,0.13)",fontWeight:700},content:{flex:1,overflowY:"auto",padding:"28px 24px",fontSize:"15px",lineHeight:"1.7",background:"linear-gradient(135deg, #fffbe9 0%, #f5ecd5 100%)",color:"#181818",borderRadius:"18px",boxShadow:"0 2px 12px rgba(191,167,106,0.10)",border:"1.5px solid #e0c9a6",margin:"18px 0 0 0"},section:{marginBottom:"15px"},sectionTitle:{color:"#d4af37",fontWeight:"bold",marginBottom:"8px",fontSize:"16px"},warningBox:{backgroundColor:"rgba(191, 167, 106, 0.13)",borderLeft:"4px solid #bfa76a",padding:"14px",borderRadius:"10px",marginBottom:"14px",color:"#7c5c2a",fontWeight:500},infoBox:{backgroundColor:"rgba(191, 167, 106, 0.09)",borderLeft:"4px solid #a67c2d",padding:"14px",borderRadius:"10px",marginBottom:"14px",color:"#5b4322",fontWeight:500},list:{marginLeft:"20px",marginTop:"8px"},listItem:{marginBottom:"6px",color:"#181818"},guide:{backgroundColor:"#fffbe9",border:"1px solid #e0c9a6",borderRadius:"10px",padding:"14px",fontSize:"14px",lineHeight:"1.7",color:"#181818",maxHeight:"300px",overflowY:"auto",marginBottom:"14px",whiteSpace:"pre-wrap",wordBreak:"break-word"},footer:{display:"flex",gap:"12px",padding:"20px",borderTop:"1px solid #333",justifyContent:"flex-end"},button:{padding:"10px 20px",borderRadius:"4px",border:"none",fontSize:"14px",fontWeight:"bold",cursor:"pointer",transition:"all 0.3s"},buttonPrimary:{backgroundColor:"#a67c2d",color:"#fff",minWidth:"120px"},buttonSecondary:{backgroundColor:"#e0c9a6",color:"#7c5c2a",border:"1px solid #d4af37"},buttonWarning:{backgroundColor:"#bfa76a",color:"#fff"},buttonCopy:{backgroundColor:o?"#bfa76a":"#e0c9a6",color:o?"#fff":"#7c5c2a",border:`1.5px solid ${o?"#bfa76a":"#a67c2d"}`,width:"100%"}};return r.jsx("div",{style:l.overlay,children:r.jsxs("div",{style:l.container,children:[r.jsxs("div",{style:l.header,children:[r.jsx("div",{style:l.warningBanner,children:" "}),r.jsx("h1",{style:l.title,children:" "}),r.jsx("p",{style:l.subtitle,children:""})]}),r.jsxs("div",{style:l.tabs,children:[r.jsx("button",{style:{...l.tab,...n==="warning"?l.tabActive:{}},onClick:()=>s("warning"),children:""}),r.jsx("button",{style:{...l.tab,...n==="guide"?l.tabActive:{}},onClick:()=>s("guide"),children:""})]}),r.jsxs("div",{style:l.content,children:[n==="warning"&&r.jsxs(r.Fragment,{children:[r.jsxs("div",{style:l.warningBox,children:[r.jsx("div",{style:l.sectionTitle,children:" "}),r.jsxs("p",{children:["",r.jsx("strong",{children:""})," "]})]}),r.jsxs("div",{style:l.section,children:[r.jsx("div",{style:l.sectionTitle,children:" "}),r.jsxs("ul",{style:l.list,children:[r.jsx("li",{style:l.listItem,children:""}),r.jsx("li",{style:l.listItem,children:""}),r.jsx("li",{style:l.listItem,children:""}),r.jsx("li",{style:l.listItem,children:""}),r.jsx("li",{style:l.listItem,children:""})]})]}),r.jsxs("div",{style:l.section,children:[r.jsx("div",{style:l.sectionTitle,children:" "}),r.jsxs("p",{children:["",r.jsx("strong",{children:'""'}),""]}),r.jsxs("p",{children:["",r.jsx("strong",{children:'""'}),""]})]}),r.jsxs("div",{style:l.infoBox,children:[r.jsx("div",{style:l.sectionTitle,children:" "}),r.jsxs("p",{children:["",r.jsx("strong",{children:""}),""]}),r.jsx("p",{children:'""'}),r.jsxs("p",{children:["  ",r.jsx("b",{children:"100000 "}),""]}),r.jsx("p",{style:{color:"#a67c2d",fontWeight:"bold"},children:""})]})]}),n==="guide"&&r.jsxs(r.Fragment,{children:[r.jsxs("div",{style:l.section,children:[r.jsx("div",{style:l.sectionTitle,children:" "}),r.jsx("p",{children:""})]}),r.jsx("div",{style:l.guide,children:'    bug    ""   1. "" 2. " " 3. " " 4.    1. "" 2. " " 3.  -   -   -   4.    -  - 100000    1.  2. Base64 3.  4.  '}),r.jsx("button",{style:{...l.button,...l.buttonCopy},onClick:a,children:o?" ":" "}),r.jsxs("div",{style:{...l.infoBox,marginTop:"15px"},children:[r.jsxs("p",{children:[" ",r.jsx("strong",{children:""})]}),r.jsxs("ul",{style:l.list,children:[r.jsx("li",{style:l.listItem,children:""}),r.jsx("li",{style:l.listItem,children:""}),r.jsx("li",{style:l.listItem,children:""}),r.jsx("li",{style:l.listItem,children:""})]})]})]})]}),r.jsxs("div",{style:l.footer,children:[r.jsx("button",{style:{...l.button,...l.buttonSecondary,...l.buttonWarning},onClick:t,children:""}),r.jsx("button",{style:{...l.button,...l.buttonPrimary},onClick:e,children:""})]})]})})},m5=({onComplete:e})=>{const[t,n]=y.useState(0),[s,o]=y.useState(!1);y.useEffect(()=>{const a=setInterval(()=>{n(l=>l>=100?(clearInterval(a),setTimeout(()=>{o(!0)},300),100):l+2)},30);return()=>clearInterval(a)},[]);const i=()=>{e()};return s?r.jsx("div",{style:Ht.overlay,children:r.jsxs("div",{style:Ht.warningContainer,children:[r.jsx("h2",{style:Ht.warningTitle,children:""}),r.jsxs("div",{style:Ht.warningContent,children:[r.jsx("p",{style:Ht.warningText,children:""}),r.jsx("p",{style:Ht.warningText,children:""}),r.jsx("p",{style:Ht.warningText,children:""}),r.jsx("p",{style:Ht.warningText,children:""})]}),r.jsx("button",{onClick:i,style:Ht.continueBtn,children:" "})]})}):r.jsx("div",{style:Ht.overlay,children:r.jsxs("div",{style:Ht.container,children:[r.jsx("h1",{style:Ht.title,children:""}),r.jsx("p",{style:Ht.subtitle,children:""}),r.jsxs("div",{style:Ht.progressContainer,children:[r.jsx("div",{style:Ht.progressBar,children:r.jsx("div",{style:{...Ht.progressFill,width:`${t}%`}})}),r.jsxs("p",{style:Ht.progressText,children:[t,"%"]})]}),r.jsx("p",{style:Ht.loadingText,children:"..."})]})})},Ht={overlay:{position:"fixed",top:0,left:0,width:"100%",height:"100%",background:"linear-gradient(135deg, #1a1a2e 0%, #16213e 100%)",zIndex:9999,display:"flex",justifyContent:"center",alignItems:"center"},container:{textAlign:"center",color:"white",padding:"40px",maxWidth:"600px",width:"90%"},title:{fontSize:"clamp(32px, 8vw, 48px)",marginBottom:"10px",color:"#d4af37",textShadow:"0 0 20px rgba(212, 175, 55, 0.5)",fontWeight:"bold",letterSpacing:"4px"},subtitle:{fontSize:"clamp(14px, 3vw, 18px)",color:"#ccc",marginBottom:"60px",letterSpacing:"2px"},progressContainer:{marginBottom:"30px"},progressBar:{width:"100%",height:"8px",background:"rgba(255, 255, 255, 0.1)",borderRadius:"4px",overflow:"hidden",marginBottom:"10px"},progressFill:{height:"100%",background:"linear-gradient(90deg, #d4af37 0%, #ffd700 100%)",transition:"width 0.3s ease",boxShadow:"0 0 10px rgba(212, 175, 55, 0.5)"},progressText:{fontSize:"14px",color:"#d4af37",fontWeight:"bold"},loadingText:{fontSize:"14px",color:"#888",animation:"pulse 1.5s ease-in-out infinite"},warningContainer:{background:"linear-gradient(135deg, #2d2d2d 0%, #1a1a1a 100%)",padding:"clamp(30px, 6vw, 50px)",borderRadius:"16px",maxWidth:"600px",width:"90%",border:"2px solid #d4af37",boxShadow:"0 20px 60px rgba(0, 0, 0, 0.8)"},warningTitle:{fontSize:"clamp(24px, 5vw, 32px)",color:"#d4af37",marginBottom:"30px",textAlign:"center",fontWeight:"bold"},warningContent:{marginBottom:"30px"},warningText:{fontSize:"clamp(14px, 3vw, 16px)",color:"#fff",lineHeight:"2",marginBottom:"10px",textAlign:"center"},continueBtn:{width:"100%",padding:"clamp(12px, 3vw, 15px)",background:"#d4af37",border:"none",borderRadius:"8px",color:"#1a1a1a",fontSize:"clamp(14px, 3vw, 16px)",fontWeight:"bold",cursor:"pointer",transition:"all 0.3s",boxShadow:"0 4px 15px rgba(212, 175, 55, 0.3)"}},g5=e=>{if(!e||!e.player)return e;const{player:t,children:n=[],activeNpcs:s=[],deadNpcs:o=[]}=e;return h5(t)?(console.warn(" ..."),x5(e)):e};function h5(e){const t=[];(!e.combatStats||typeof e.combatStats!="object")&&t.push("combatStats"),e.rival||t.push("rival"),e.time||t.push("time"),e.manuals!==void 0&&typeof e.manuals!="object"&&t.push("manuals");const n=t.length>=4;return n&&console.warn(" ",t),n}function x5(e){var w,S;const{player:t,children:n=[],activeNpcs:s=[],deadNpcs:o=[]}=e,i={name:t.name,age:t.age,gender:t.gender,avatar:t.avatar,tier:t.tier,currentExp:t.currentExp,maxExp:t.maxExp,time:t.time,cultivation:t.cultivation||0},a={spiritStones:((w=t.resources)==null?void 0:w.spiritStones)||0,money:((S=t.resources)==null?void 0:S.money)||0},l=t.affectionRecords||{},d=t.cultivationMethod||null,u=t.manuals||{},p=t.familyRating||{currentId:"CLAN_SEED",history:[]},c=t.skillPoints||0,f=Array.isArray(t.generation3Plus)?t.generation3Plus:[],x={...i,resources:a,affectionRecords:l,cultivationMethod:d,manuals:u,familyRating:p,skillPoints:c,generation3Plus:f,compensationApplied:!0,compensationTime:new Date().toISOString()};let C=[];return x.resources.spiritStones=(x.resources.spiritStones||0)+1e5,console.log(" "),console.log(" 100000 "),console.log(" ",{cultivationMethod:d,manualsCount:Object.keys(u).length}),console.log(" ",{currentRating:p.currentId,historyCount:p.history.length}),console.log(" ",{skillPoints:c}),console.log(" ",{cultivation:i.cultivation}),{...e,player:x,children:n||[],activeNpcs:Fg(s),deadNpcs:Fg(o),inventory:C,logs:[]}}function Fg(e){return Array.isArray(e)?e.map(t=>({id:t.id,name:t.name,personality:t.personality,identity:t.identity,affection:t.affection||0,favorabilityLevel:t.favorabilityLevel||0,...t})):[]}const y5=e=>e.compensationApplied?`

 100000 `:null,b5=({player:e,children:t,managerOptions:n=[],onBuy:s,onAssign:o})=>{var _;const[i,a]=y.useState({}),[l,d]=y.useState(new Set),[u,p]=y.useState(1),[c,f]=y.useState(1),x=5,C=5,w=[...n].sort((I,k)=>{var K,L;const T=((K=I.stats)==null?void 0:K.intelligence)||I.intelligence||0;return(((L=k.stats)==null?void 0:L.intelligence)||k.intelligence||0)-T}),S=y.useCallback((I,k)=>{const T=Math.max(0,parseInt(k)||0);a(N=>{const K={...N};return T===0?delete K[I]:K[I]=T,K})},[]),h=y.useCallback(()=>{var K,L,B,W;const I=Object.entries(i).filter(([z,ne])=>ne>0).map(([z,ne])=>({biz:bl.find(se=>se.id===z),quantity:ne}));if(I.length===0){(K=window.showResult)==null||K.call(window,"","",!1,null,!1);return}if(l.size===0){(L=window.showResult)==null||L.call(window,"","",!1,null,!1);return}const k=I.reduce((z,ne)=>z+ne.quantity,0);if(k>l.size){(B=window.showResult)==null||B.call(window,"",` ${k}  ${l.size} `,!1,null,!1);return}const T=Array.from(l).map(z=>w.find(ne=>ne.id===z));let N=0;I.forEach(({biz:z,quantity:ne})=>{var Q;for(let se=0;se<ne;se++){if(T.length===0){(Q=window.showResult)==null||Q.call(window,"","",!1,null,!1);break}const ye=Math.floor(Math.random()*T.length),Me=T[ye];s(z,Me.id),N++,T.splice(ye,1)}}),(W=window.showResult)==null||W.call(window,"",` ${N} `,!0,null,!0),a({})},[i,l,w,s]),g=y.useCallback(()=>{const I={};bl.forEach(k=>{I[k.id]=1}),a(I)},[]),v=y.useCallback(()=>{a({})},[]),j=y.useCallback(I=>{d(k=>{const T=new Set(k);return T.has(I)?T.delete(I):T.add(I),T})},[]),R=y.useCallback(()=>{d(new Set(w.map(I=>I.id)))},[w]),b=y.useCallback(()=>{d(new Set)},[]);return r.jsxs("div",{style:{padding:"10px"},children:[r.jsx("h3",{children:" "}),r.jsxs("p",{style:{fontSize:"12px",color:"#666"},children:["",r.jsx("br",{}),": ",((_=e.businesses)==null?void 0:_.reduce((I,k)=>I+k.income,0))||0," "]}),r.jsx("h4",{children:" "}),r.jsx("div",{style:cn.grid,children:bl.map(I=>r.jsxs("div",{style:cn.card,children:[r.jsx("div",{style:{fontWeight:"bold"},children:I.name}),r.jsx("div",{style:{fontSize:"10px",color:"#555",height:"30px"},children:I.desc}),r.jsxs("div",{style:{fontSize:"12px",margin:"5px 0"},children:[": ",I.minTier," | : ",I.cost]}),r.jsxs("div",{style:{marginTop:"8px",display:"flex",alignItems:"center",gap:"6px"},children:[r.jsx("label",{style:{fontSize:"12px",fontWeight:"bold",color:"#666"},children:":"}),r.jsx("input",{type:"number",min:"0",max:"10",value:i[I.id]||0,onChange:k=>S(I.id,k.target.value),style:{width:"50px",padding:"4px",borderRadius:"4px",border:"1px solid #ccc",textAlign:"center",fontSize:"12px"}})]})]},I.id))}),r.jsx("hr",{style:{margin:"15px 0",borderColor:"#ddd"}}),r.jsx("h4",{children:" "}),r.jsxs("div",{style:cn.batchBuyContainer,children:[r.jsxs("div",{style:cn.batchControlRow,children:[r.jsx("button",{onClick:g,style:cn.controlBtn,children:" (1)"}),r.jsx("button",{onClick:v,style:cn.controlBtn,children:" "}),r.jsxs("span",{style:{fontSize:"13px",fontWeight:"bold",color:"#d32f2f"},children:[": ",Object.values(i).reduce((I,k)=>I+k,0)," "]})]}),r.jsxs("div",{style:cn.purchaseInfo,children:[r.jsxs("div",{style:{fontSize:"12px",color:"#666",marginBottom:"8px"},children:[" : ",Object.keys(i).length," "]}),Object.keys(i).length>0&&r.jsx("div",{style:{maxHeight:"100px",overflowY:"auto",fontSize:"12px",background:"white",padding:"6px",borderRadius:"4px",border:"1px solid #e0e0e0"},children:Object.entries(i).filter(([I,k])=>k>0).map(([I,k])=>{const T=bl.find(N=>N.id===I);return r.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:"4px"},children:[r.jsx("span",{children:T==null?void 0:T.name}),r.jsxs("span",{style:{fontWeight:"bold",color:"#ff9800"},children:["",k]})]},I)})})]}),r.jsxs("div",{style:{...cn.managerSelectContainer,marginBottom:"12px",marginTop:"12px"},children:[r.jsx("div",{style:{fontSize:"13px",fontWeight:"bold",marginBottom:"8px",color:"#333"},children:"  ()"}),r.jsxs("div",{style:cn.batchControlRow,children:[r.jsx("button",{onClick:R,style:cn.controlBtn,children:" "}),r.jsx("button",{onClick:b,style:cn.controlBtn,children:" "}),r.jsxs("span",{style:{fontSize:"13px",fontWeight:"bold",color:"#1976d2"},children:[": ",l.size," / ",w.length]})]}),w.length===0?r.jsx("div",{style:{fontSize:"12px",color:"#999",padding:"10px"},children:""}):r.jsxs(r.Fragment,{children:[r.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(120px, 1fr))",gap:"8px",marginBottom:"10px"},children:w.slice((u-1)*x,u*x).map(I=>{var N;const k=l.has(I.id),T=((N=I.stats)==null?void 0:N.intelligence)||I.intelligence||0;return r.jsxs("label",{style:{...cn.managerCheckbox,...k?cn.managerCheckboxSelected:{}},children:[r.jsx("input",{type:"checkbox",checked:k,onChange:()=>j(I.id),style:{marginRight:"6px"}}),r.jsxs("div",{style:{flex:1},children:[r.jsx("div",{style:{fontSize:"12px",fontWeight:"bold",color:"#333"},children:I.name}),r.jsxs("div",{style:{fontSize:"11px",color:"#666"},children:[": ",T]})]})]},I.id)})}),Math.ceil(w.length/x)>1&&r.jsxs("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",gap:"8px",fontSize:"12px"},children:[r.jsx("button",{onClick:()=>p(Math.max(1,u-1)),disabled:u===1,style:{padding:"4px 8px",borderRadius:"4px",border:"1px solid #ccc",background:u===1?"#f0f0f0":"#fff",cursor:u===1?"not-allowed":"pointer",opacity:u===1?.6:1},children:""}),r.jsxs("span",{style:{color:"#666"},children:[u," / ",Math.ceil(w.length/x)]}),r.jsx("button",{onClick:()=>p(Math.min(Math.ceil(w.length/x),u+1)),disabled:u===Math.ceil(w.length/x),style:{padding:"4px 8px",borderRadius:"4px",border:"1px solid #ccc",background:u===Math.ceil(w.length/x)?"#f0f0f0":"#fff",cursor:u===Math.ceil(w.length/x)?"not-allowed":"pointer",opacity:u===Math.ceil(w.length/x)?.6:1},children:""})]})]})]}),r.jsx("button",{onClick:h,disabled:Object.values(i).reduce((I,k)=>I+k,0)===0,style:{...cn.batchPurchaseBtn,...Object.values(i).reduce((I,k)=>I+k,0)===0?cn.batchPurchaseBtnDisabled:{}},children:" "}),l.size>0&&r.jsxs("div",{style:{fontSize:"12px",color:"#666",marginTop:"8px",padding:"8px",background:"white",borderRadius:"4px",border:"1px solid #e0e0e0"},children:["  ",l.size," "]})]}),r.jsx("hr",{style:{margin:"15px 0",borderColor:"#ddd"}}),r.jsx("h4",{children:" "}),r.jsx("div",{style:{marginBottom:"20px"},children:!e.businesses||e.businesses.length===0?r.jsx("div",{style:{fontSize:"12px",color:"#999",padding:"10px"},children:""}):r.jsx(r.Fragment,{children:r.jsx("div",{style:{marginBottom:"10px"},children:(()=>{const I=e.businesses.length,k=Math.ceil(I/C),T=(c-1)*C,N=Math.min(T+C,I),K=e.businesses.slice(T,N);return r.jsxs(r.Fragment,{children:[K.map((L,B)=>{const W=t.find(z=>z.id===L.managerId);return r.jsxs("div",{style:cn.bizCard,children:[r.jsx("div",{style:{fontWeight:"bold"},children:L.name}),r.jsxs("div",{style:{fontSize:"12px"},children:[": ",W?W.name:r.jsx("span",{style:{color:"red"},children:""}),W&&` (:${W.stats.intelligence})`]}),r.jsxs("div",{style:{color:"#2e7d32"},children:[": ",L.income]})]},B)}),k>1&&r.jsxs("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",gap:"8px",marginTop:"10px",fontSize:"12px"},children:[r.jsx("button",{onClick:()=>f(Math.max(1,c-1)),disabled:c===1,style:{padding:"4px 8px",borderRadius:"4px",border:"1px solid #ccc",background:c===1?"#f0f0f0":"#fff",cursor:c===1?"not-allowed":"pointer",opacity:c===1?.6:1},children:""}),r.jsxs("span",{style:{color:"#666"},children:[c," / ",k]}),r.jsx("button",{onClick:()=>f(Math.min(k,c+1)),disabled:c===k,style:{padding:"4px 8px",borderRadius:"4px",border:"1px solid #ccc",background:c===k?"#f0f0f0":"#fff",cursor:c===k?"not-allowed":"pointer",opacity:c===k?.6:1},children:""}),r.jsxs("span",{style:{color:"#999",marginLeft:"8px"},children:[" ",I," "]})]})]})})()})})})]})},cn={grid:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"10px"},card:{border:"1px solid #ddd",padding:"10px",borderRadius:"8px",background:"white"},bizCard:{border:"1px solid #81c784",background:"#e8f5e9",padding:"10px",borderRadius:"8px",marginBottom:"5px"},batchBuyContainer:{background:"#f5f5f5",padding:"12px",borderRadius:"8px",border:"1px solid #e0e0e0",marginBottom:"15px"},batchControlRow:{display:"flex",gap:"8px",alignItems:"center",marginBottom:"12px",flexWrap:"wrap"},controlBtn:{padding:"6px 12px",fontSize:"12px",border:"1px solid #999",borderRadius:"4px",background:"#fff",cursor:"pointer",fontWeight:"bold"},purchaseInfo:{background:"white",padding:"8px",borderRadius:"4px",border:"1px solid #e0e0e0",marginBottom:"10px"},batchPurchaseBtn:{width:"100%",padding:"10px",background:"#2196f3",color:"white",border:"none",borderRadius:"4px",fontWeight:"bold",cursor:"pointer",fontSize:"14px"},batchPurchaseBtnDisabled:{background:"#ccc",cursor:"not-allowed"},managerSelectContainer:{background:"#e3f2fd",padding:"12px",borderRadius:"8px",border:"1px solid #90caf9"},managerCheckbox:{display:"flex",alignItems:"center",gap:"6px",padding:"8px",backgroundColor:"white",borderRadius:"6px",border:"1px solid #ddd",cursor:"pointer",transition:"all 0.2s",fontSize:"12px"},managerCheckboxSelected:{borderColor:"#1976d2",background:"#e3f2fd",boxShadow:"0 0 4px rgba(25, 118, 210, 0.3)"}},v5=_c.memo(b5),S5=({player:e,children:t,onChallenge:n,isRomanceLimitReached:s=!1})=>{var R;const[o,i]=y.useState(null),[a,l]=y.useState([]),[d,u]=y.useState(!1),[p,c]=y.useState(10),[f,x]=y.useState(!1),C=t.filter(b=>b.age>=16),w=b=>{if(a.includes(b))l(_=>_.filter(I=>I!==b));else{if(a.length>=3){window.showResult&&window.showResult("","3",!1,null,!1);return}l(_=>[..._,b])}},S=nu(e)+a.reduce((b,_)=>{const I=C.find(k=>k.id===_);return b+(I?nu(I):0)},0),h=o&&S>=o.recommendCP*1.5,g=((e==null?void 0:e.energy)!==void 0?e.energy:((R=e==null?void 0:e.resources)==null?void 0:R.energy)||20)||20,v=Math.floor(g/5);o&&console.log(" ChallengePanel :",{playerEnergy:g,maxBatchCount:v});const j=()=>{var k;if(a.length===0){window.showResult&&window.showResult("","",!1,null,!1);return}if(!h){window.showResult&&window.showResult("","150%",!1,null,!1);return}const b=Math.min(p,v);if(b<=0){window.showResult&&window.showResult("","5",!1,null,!1);return}x(!0);const _=o.cost*b,I=((k=e.resources)==null?void 0:k.spiritStones)||0;if(I<_){window.showResult&&window.showResult("",` ${_}  ${I} `,!1,null,!1),x(!1);return}setTimeout(()=>{n(o,a,{batchCount:b,isFastMode:!0}),x(!1),i(null),u(!1),c(10)},500)};return r.jsx("div",{style:{padding:"10px"},children:o?r.jsxs("div",{children:[r.jsx("button",{onClick:()=>i(null),children:" "}),r.jsxs("h3",{children:[" ",o.name]}),r.jsx("p",{children:o.desc}),r.jsxs("div",{style:Fs.statBox,children:[r.jsxs("div",{children:[": ",o.recommendCP]}),r.jsxs("div",{children:[": ",r.jsx("span",{style:{color:S>=o.recommendCP?"green":"red"},children:S})]}),r.jsxs("div",{children:[": ",(o.risk*100).toFixed(0),"%"]})]}),r.jsx("h4",{children:" (3)"}),r.jsx("div",{style:Fs.list,children:C.map(b=>r.jsxs("div",{onClick:()=>w(b.id),style:{...Fs.fighterRow,background:a.includes(b.id)?"#ffe0b2":"white"},children:[r.jsxs("span",{children:[b.name," (",b.tierTitle,")"]}),r.jsxs("span",{children:["CP: ",nu(b)]})]},b.id))}),r.jsxs("button",{style:Fs.startBtn,onClick:()=>n(o,a),children:[" ( ",o.cost," )"]}),h&&r.jsxs("div",{style:{marginTop:"15px"},children:[r.jsx("div",{style:{padding:"10px",background:"#e8f5e9",borderRadius:"5px",marginBottom:"10px",fontSize:"13px",color:"#2e7d32",fontWeight:"500"},children:" "}),d?r.jsxs("div",{style:{border:"1px solid #1976d2",padding:"15px",borderRadius:"8px",background:"#f5f5f5"},children:[r.jsx("div",{style:{marginBottom:"10px",fontWeight:"bold"},children:" "}),r.jsxs("div",{style:{marginBottom:"10px"},children:[r.jsx("label",{style:{fontSize:"13px"},children:""}),r.jsx("input",{type:"number",min:"1",max:v,value:p,onChange:b=>c(Math.max(1,Math.min(v,parseInt(b.target.value)||1))),disabled:f||v===0,style:{width:"60px",padding:"5px",marginLeft:"5px",border:"1px solid #999",borderRadius:"4px"}}),r.jsxs("span",{style:{marginLeft:"10px",fontSize:"12px",color:"#666"},children:[" ",v,"  |  ",o.cost*Math.min(p,v)," ",Math.min(p,v)*5," "]})]}),r.jsxs("div",{style:{display:"flex",gap:"10px"},children:[r.jsx("button",{style:{flex:1,padding:"10px",background:f||v===0?"#999":"#1976d2",color:"white",border:"none",borderRadius:"5px",cursor:f||v===0?"not-allowed":"pointer",fontWeight:"bold"},onClick:j,disabled:f||v===0,children:f?"...":v===0?"":""}),r.jsx("button",{style:{flex:1,padding:"10px",background:"#999",color:"white",border:"none",borderRadius:"5px",cursor:f?"not-allowed":"pointer"},onClick:()=>u(!1),disabled:f,children:""})]})]}):r.jsx("button",{style:{...Fs.startBtn,background:"#1976d2"},onClick:()=>u(!0),children:" "})]})]}):r.jsxs("div",{children:[r.jsx("h3",{children:" "}),r.jsx("p",{style:{fontSize:"12px",color:"#666"},children:""}),s&&r.jsx("div",{style:{padding:"12px",marginBottom:"15px",backgroundColor:"#fff3e0",borderLeft:"4px solid #ff9800",borderRadius:"4px",color:"#e65100",fontSize:"13px",fontWeight:"500"},children:" "}),r.jsx("div",{style:Fs.list,children:Ay.map(b=>r.jsxs("div",{onClick:()=>i(b),style:Fs.realmCard,children:[r.jsx("div",{style:{fontWeight:"bold"},children:b.name}),r.jsxs("div",{style:{fontSize:"12px",color:"#d81b60"},children:[": ",b.reqTier]}),r.jsxs("div",{style:{fontSize:"12px"},children:[": ",b.cost]})]},b.id))})]})})},Fs={list:{display:"flex",flexDirection:"column",gap:"8px",maxHeight:"300px",overflowY:"auto"},realmCard:{border:"1px solid #ddd",padding:"15px",borderRadius:"8px",cursor:"pointer",background:"white",display:"flex",justifyContent:"space-between",alignItems:"center"},fighterRow:{padding:"10px",borderBottom:"1px solid #eee",display:"flex",justifyContent:"space-between",cursor:"pointer"},statBox:{background:"#eee",padding:"10px",borderRadius:"5px",margin:"10px 0",fontSize:"14px"},startBtn:{width:"100%",padding:"15px",background:"#d32f2f",color:"white",border:"none",borderRadius:"8px",fontSize:"16px",marginTop:"20px",cursor:"pointer"}},w5={LEVEL_UP:[" {actor} {detail}","{actor} {detail}","{actor} {detail}","{actor} {detail}"],NPC_BREAKTHROUGH:[" {actor} {detail}"," {actor} {detail}","{actor} {detail}"],BREAKTHROUGH_FAIL:["{actor} {detail}","{actor} {detail}","{actor} {detail}"],MARRIAGE:["{actor}  {target} ","{actor}  {target} ","{actor}  {target} ","{actor}  {target} ","{actor}{target}/","{target}{actor}","{actor}{target}","{actor}{target}"],BIRTH:["{actor}  {target}","{actor}  {target}","{actor}  {target} "],DEATH:["{actor}  {location} ","{actor}  {detail} ","{actor} "],COMBAT:["{actor}  {location}  {target}","{actor}  {target}  {actor} "," {actor}  {location}  {target}","{location}{actor}{target}{actor}","{actor}{target}","{actor}{target}{location}"],JOIN_SECT:["{actor}  {target}  {detail} ","{target}  {detail}","{target}  {detail} "],GRANDCHILD:["{actor} ","{actor} {detail}"],EXPLORATION:["{actor}  {location}  {detail}"," {actor}  {location}"],FILLER:["","","","","","","","","","","","30%","","","","''","''","","","''","","","",""],RIVAL_RISE:["{actor}","{actor}{detail}''"],RIVAL_BREAKTHROUGH:["{actor}{tier}","{actor}{tier}","{actor}{tier}"],RIVAL_ENGAGED:["{actor}{target}","{target}{actor}"],RIVAL_MARRIAGE:["{target}{actor}","{actor}{target}{target}"],RIVAL_HEIR:["{actor}{target}","{actor}"],RIVAL_STAGE_EVENT:["{actor}{stageTitle}{description}","{actor}{stageTier}{description}","{actor}{stageRole}{description}"],REVENGE_STAGE_ADVANCE:["{actor}{clearedStage}{nextStage}","{actor}{clearedStage}","{actor}{clearedStage}"],REVENGE_SAGA_COMPLETE:["{actor}{finalTarget}","{actor}{finalTarget}","{actor}{finalTarget}"],REVENGE_DUEL_FAILED:["{actor}{rival}","{actor}{rival}","{stageTitle}{actor}"],RIVAL_LIGHT_RUMOR:["{actor}","{actor}''","{actor}"],RIVAL_HEAVY_RUMOR:["{actor}","{actor}","{actor}"],RIVAL_THREAT_MEDIUM:["{playerName}","{actor}..."],RIVAL_THREAT_HIGH:["{actor}''","{actor}"],RIVAL_THREAT_CRITICAL:["","{actor}","..."],RIVAL_HIDE_SUCCESS:["{actor}","{actor}{months}","{actor}"],ASSASSINATION_SURVIVED:["{actor}","{actor}","{actor}"],ASSASSINATION_INJURED:["{actor}","{actor}","{actor}"],RIVAL_DEFEATED:["{target}{actor}","{actor}{target}","{target}...{actor}"],RIVAL_VICTORY:["{target}{actor}","{target}{actor}"],NPC_AFFECTION_HIGH:["{actor}{target}","{target}{actor}","{actor}{target}"],NPC_JEALOUSY:["{actor}{target}{rival}","{actor}{target}","{actor}{target}'{rival}'","{actor}{rival}{target}"],SHURA_FIELD:["{actor}{participants}","{dominant}{rival}{actor}","{actor}{count}"],DUAL_CULTIVATION:["{actor}{target}","{actor}{target}","{actor}{target}"],NPC_PURSUIT:["{actor}{target}{target}","{actor}{target}","{target}{actor}","{actor}{target}"],NPC_ANGRY:["{actor}{target}{target}''","{actor}{target}","{target}{actor}''{actor}"],CHILD_TALENT:["{actor}{target}","{target}{actor}","{actor}{target}"],SECT_PROMOTION:["{actor}","{actor}{detail}","{actor}"],TREASURE_FIND:["{actor}{detail}","{actor}","{actor}{detail}"],RETREAT:["{actor}{detail}","{actor}","{actor}"],TOURNAMENT:["{actor}","{actor}''","{target}{actor}"],INJURED:["{actor}{target}","{actor}{target}","{actor}"],APPRENTICE:["{actor}{target}","{target}{actor}","{actor}{detail}"]};function wo(e,t){const n=w5[e];if(!n||n.length===0)return null;let o=n[Math.floor(Math.random()*n.length)];return Object.keys(t).forEach(i=>{const a=`{${i}}`;o=o.replace(new RegExp(a,"g"),t[i])}),o}function k5(e,t,n=[]){const s=[],o=new Set,i=a=>a?typeof a.status=="string"?a.status!=="DEAD":typeof a.isDead=="boolean"?!a.isDead:!0:!1;return s.push({name:t.name,cultivation:t.currentExp||0,tier:t.tier||"",isPlayer:!0}),o.add(t.name),t.worldNpcs&&t.worldNpcs.length>0&&t.worldNpcs.filter(i).forEach(a=>{o.has(a.name)||(s.push({name:a.name,title:a.title,cultivation:a.currentExp||0,tier:a.tier||"",isPlayer:!1,worldNpcData:a}),o.add(a.name))}),n&&Array.isArray(n)&&n.filter(i).forEach(a=>{var l,d;if(!o.has(a.name)){const u=a.currentExp||a.cultivation||0;s.push({name:a.name,title:a.rank?`${((l=a.sect)==null?void 0:l.name)||""}${a.rank}`:((d=a.sect)==null?void 0:d.name)||"",cultivation:u,tier:a.tier||a.tierTitle||"",isPlayer:!1,isChild:!0,childData:a}),o.add(a.name)}}),e&&e.length>0&&e.filter(i).forEach(a=>{o.has(a.name)||(s.push({name:a.name,cultivation:a.currentExp||0,tier:a.tier||"",isPlayer:!1}),o.add(a.name))}),s.sort((a,l)=>{if(l.cultivation!==a.cultivation)return l.cultivation-a.cultivation;const d=["","","","","","","","","",""];return d.indexOf(a.tier)-d.indexOf(l.tier)}),s.slice(0,3).map((a,l)=>{var C,w,S;const d=["","",""],u=a.isPlayer?"":"",p=a.isChild?"":"",c=!a.isPlayer&&((C=a.worldNpcData)==null?void 0:C.sectRank)===""&&((S=(w=a.worldNpcData)==null?void 0:w.sect)!=null&&S.name)?`${a.worldNpcData.sect.name}`:"",f=a.title?`${a.title}`:"";return{displayText:`${d[l]} ${u}${p}${c}${f}${a.name} - ${a.tier}`,name:a.name,title:a.title,tier:a.tier,isPlayer:a.isPlayer,isChild:a.isChild,worldNpcData:a.worldNpcData,childData:a.childData}})}const Ea=50,mu=(e=[])=>Array.isArray(e)?e.length<=Ea?e:e.slice(-Ea):[];function E5(e){if(!Array.isArray(e)||e.length===0)return e;const t=e.filter(o=>o.type==="MARRIAGE"||o.type==="RIVAL_MARRIAGE"),n=e.filter(o=>o.type==="BIRTH"||o.type==="GRANDCHILD"||o.type==="RIVAL_HEIR");return t.length===0||n.length===0?e:e.filter(o=>{var i;if(o.type==="BIRTH"||o.type==="GRANDCHILD"||o.type==="RIVAL_HEIR"){const a=(i=o.data)==null?void 0:i.actor,l=o.timestamp||Date.now();if(a){const d=t.filter(u=>{var p,c;return((p=u.data)==null?void 0:p.actor)===a||((c=u.data)==null?void 0:c.target)===a});for(const u of d){const p=u.timestamp||Date.now(),c=(l-p)/(1e3*60*60*24*30);if(c>=0&&c<12)return!1}}}return!0})}function j5(e,t){if(!t||t.length===0)return[];const n=[],s=new Map,o=new Map;return t.forEach((i,a)=>{o.set(i.name,a+1)}),e.forEach((i,a)=>{const l=a+1,d=o.get(i.name);if(d){if(d!==l){if(i.isPlayer)return;const u=l<d?"":"",p=Math.abs(l-d),c=u===""?"":"",f=i.isChild?"[]":"",x=`${c} ${f}${i.name}${u}${p}(${d}${l})`;s.has(x)||(n.push(x),s.set(x,!0))}}else{if(i.isPlayer)return;const u=i.isChild?"":"",p=i.isChild?"[]":"",c=`${u} ${p}${i.name}`;s.has(c)||(n.push(c),s.set(c,!0))}}),o.forEach((i,a)=>{if(!e.some(d=>d.name===a)){const d=` ${a}`;s.has(d)||(n.push(d),s.set(d,!0))}}),n}function C5(e,t,n){if(!t||t.length===0)return[];const s=[],o=new Map,i=new Map;return t.forEach(a=>{a.worldNpcData&&i.set(a.sectId,{name:a.worldNpcData.name,tier:a.worldNpcData.tier,npcId:a.worldNpcData.id})}),e.forEach(a=>{const l=i.get(a.sectId);if(a.worldNpcData)if(l){if(l.name!==a.worldNpcData.name){let d=!0;if(n!=null&&n.worldNpcs&&l.npcId){const u=n.worldNpcs.find(p=>p.id===l.npcId);if(u&&u.status==="DEAD"){const p=` ${a.sectName}${l.name}${a.worldNpcData.name}`;o.has(p)||(s.push(p),o.set(p,!0)),d=!1}}if(d){const u=` ${a.sectName}${l.name}${a.worldNpcData.name}`;o.has(u)||(s.push(u),o.set(u,!0))}}}else{const d=a.worldNpcData.status==="ALIVE"?"":"[]",u=` ${a.sectName}${d}${a.worldNpcData.name}`;o.has(u)||(s.push(u),o.set(u,!0))}else if(l){let d=!0;if(n!=null&&n.worldNpcs&&l.npcId){const u=n.worldNpcs.find(p=>p.id===l.npcId);u&&u.status==="ALIVE"&&(d=!1)}if(d){const u=` ${a.sectName}${l.name}`;o.has(u)||(s.push(u),o.set(u,!0))}}}),s}function T5(e){const n=((e==null?void 0:e.worldNpcs)||[]).filter(o=>{var i;return(o==null?void 0:o.status)!=="DEAD"&&(o==null?void 0:o.sectRank)===""&&((i=o==null?void 0:o.sect)==null?void 0:i.id)}),s=new Map;return n.forEach(o=>{s.has(o.sect.id)||s.set(o.sect.id,o)}),Er.filter(o=>o&&o.id&&o.id!=="SECT_NONE").map(o=>{const i=s.get(o.id),a=i!=null&&i.title?`${i.title}`:"";return{displayText:i?`${o.name}${a}${i.name} - ${i.tier}`:`${o.name}`,sectId:o.id,sectName:o.name,worldNpcData:i||null}}).slice(0,10)}function I5(e,t,n,s,o=[],i=null){var R,b;const a=[],l=[];if(t.rival){const _=G5(t.rival);if(_){const I=wo(_.type,_.data);I&&a.unshift(I)}}e.filter(_=>_.type==="RIVAL_BREAKTHROUGH").forEach(_=>{const I=wo(_.type,_.data);I&&a.unshift(I)});const u=[];let p=[];e.forEach(_=>{_.type.startsWith("RIVAL_")?u.push(_):p.push(_)}),p=E5(p),u.forEach(_=>{const I=wo(_.type,_.data);I&&a.push(I)});const c=[],f=[];p.forEach(_=>{_.data.actor===t.name||_.data.target===t.name||_.type==="LEVEL_UP"||_.type==="MARRIAGE"||_.type==="BIRTH"||_.type==="COMBAT"?c.push(_):f.push(_)});const x=8,C=Math.ceil(x*.25),w=Math.ceil(x*.75);let S=0;c.forEach(_=>{if(S<C){const I=wo(_.type,_.data);I&&(a.push(I),S++)}}),f.forEach(_=>{const I=wo(_.type,_.data);I&&(a.length<5?a.push(I):l.push(I))});const h=a.length+l.length,g=Math.max(0,w-(h-S));for(let _=0;_<g;_++){const I=wo("FILLER",{});a.length<5?a.push(I):l.push(I)}const v=k5(n,t,o),j=T5(t);if(i&&i.powerRanking&&i.sectRanking){const _=j5(v,i.powerRanking),I=C5(j,i.sectRanking,t);_.length>0&&_.forEach(k=>{a.length<3?a.unshift(k):l.unshift(k)}),I.length>0&&I.forEach(k=>{a.length<5?a.push(k):l.push(k)})}return{issue:s,year:((R=t.time)==null?void 0:R.year)||t.age||0,month:((b=t.time)==null?void 0:b.month)||t.month||1,headlines:a,rumors:l,powerRanking:v,sectRanking:j,timestamp:Date.now()}}function R5(e,t,n,s,o,i=[]){const a=t.gazetteHistory&&t.gazetteHistory.length>0?t.gazetteHistory[t.gazetteHistory.length-1]:null;return I5(e,t,n,s,i,a)}function Wt(e,t,n){Array.isArray(e)&&(e.push({type:t,data:n,timestamp:Date.now()}),e.length>Ea&&e.splice(0,e.length-Ea))}const _5=(e,t,n=[])=>{const s=t.combatStats||{maxHp:100,maxMp:50},o=a=>{const l=a.combatStats||{maxHp:100,maxMp:50,atk:10,def:5};return{...a,combatStats:l,currentHp:l.maxHp,currentMp:l.maxMp,isDefending:!1}},i=[o(e),...n.map(o)];return{player:i[0],party:i,enemy:{...t,currentHp:s.maxHp,currentMp:s.maxMp,combatStats:s},turn:0,logs:[],result:null}},M5=(e,t,n=null)=>{const{party:s,enemy:o}=e,i=[...e.logs];let a=s.map(C=>({...C})),l={...o},d=null;const u=e.turn+1;i.push(`===  ${u}  ===`);for(let C=0;C<a.length;C++){const w=a[C];if(w.currentHp<=0)continue;const S=A5(w,l,t);if(a[C]=S.player,l=S.enemy,i.push(...S.logs),l.currentHp<=0)return i.push(`${l.name} `),d="win",{party:a,player:a[0],enemy:l,turn:u,logs:i,result:d}}if(a.filter(C=>C.currentHp>0).length===0)return i.push(""),d="lose",{party:a,player:a[0],enemy:l,turn:u,logs:i,result:d};const c=a.findIndex(C=>C.currentHp>0),f=N5(l,a[c]);return l=f.enemy,a[c]=f.player,i.push(...f.logs),a.some(C=>C.currentHp>0)?{party:a,player:a[0],enemy:l,turn:u,logs:i,result:d}:(i.push(""),d="lose",{party:a,player:a[0],enemy:l,turn:u,logs:i,result:d})},A5=(e,t,n,s)=>{var i,a,l;const o=[];switch(n){case"attack":const d=gu(e,t);t.currentHp-=d,t.currentHp=Math.max(0,Math.floor(t.currentHp)),o.push(`${e.name}  ${t.name}  ${d} `),o.push(`${t.name}  HP: ${t.currentHp}/${((i=t.combatStats)==null?void 0:i.maxHp)||0}`);break;case"defend":e.isDefending=!0,o.push(`${e.name} `);break;case"skill":const u=Math.floor(gu(e,t)*1.5);t.currentHp-=u,t.currentHp=Math.max(0,Math.floor(t.currentHp)),e.currentMp-=50,o.push(`${e.name}  ${t.name}  ${u} `),o.push(`${t.name}  HP: ${t.currentHp}/${((a=t.combatStats)==null?void 0:a.maxHp)||0}`);break;default:const p=gu(e,t);t.currentHp-=p,t.currentHp=Math.max(0,Math.floor(t.currentHp)),o.push(`${e.name}  ${t.name}  ${p} `),o.push(`${t.name}  HP: ${t.currentHp}/${((l=t.combatStats)==null?void 0:l.maxHp)||0}`)}return{player:e,enemy:t,logs:o}},N5=(e,t)=>{var c,f,x;const n=[],s=((c=e.combatStats)==null?void 0:c.atk)||10,o=((f=t.combatStats)==null?void 0:f.def)||5,i=s-Math.floor(o/2),a=Math.max(1,i),l=t.isDefending?Math.floor(a*.5):a,d=i<=0,u=t.isDefending&&l<a,p=d||u?"":"";return t.currentHp-=l,t.isDefending=!1,t.currentHp=Math.max(0,Math.floor(t.currentHp)),n.push(`${e.name}  ${t.name}  ${l} ${p}`),n.push(`${t.name}  HP: ${t.currentHp}/${((x=t.combatStats)==null?void 0:x.maxHp)||0}`),{enemy:e,player:t,logs:n}},gu=(e,t)=>{var a,l;const n=((a=e.combatStats)==null?void 0:a.atk)||10,s=((l=t.combatStats)==null?void 0:l.def)||5,o=n-Math.floor(s/2);return Math.max(1,o)},qi=(e,t,n=[])=>{let s=_5(e,t,n);for(;!s.result;)s=M5(s,"attack");return{success:s.result==="win",logs:s.logs,remainingHp:s.player.currentHp,party:s.party}};let Zs=1.3;const a1={aptitude:92,looks:95,intelligence:90,health:85,cunning:88};var ih;const hu={type:"",name:"",multiplier:((ih=Bn==null?void 0:Bn.SINGLE)==null?void 0:ih.multiplier)||1.8,elements:[""]},L5={id:"CHU_CLAN",name:"",level:"HIGH"},$5={name:"",bonuses:{speedMultiplier:1.15}},zf=e=>{if(!e)return e;e.stats={...a1,...e.stats||{}};const t=e.spiritRoot||hu;e.spiritRoot={...hu,...t,elements:Array.isArray(t.elements)?[...t.elements]:[...hu.elements]},e.sect=e.sect?{...e.sect}:{...L5};const n=e.trait||$5;return e.trait={...n,bonuses:n.bonuses?{...n.bonuses}:void 0},e},Tc=(e,t=e==null?void 0:e.tier)=>{if(!e)return;const n=An(t||(e==null?void 0:e.tier));n!=null&&n.maxExp&&(e.maxExp=n.maxExp)},B5=e=>{const t=Math.min(.8,((e==null?void 0:e.baseThreat)||0)/100),n=(e==null?void 0:e.powerMultiplier)||1;return 1+t+(n-1)*.5},O5=(e,t,n=!1)=>{if(!e)return 0;zf(e),Tc(e);const s=ka({...e,stats:e.stats,spiritRoot:e.spiritRoot,trait:e.trait,sect:e.sect},n)||0,o=n?1.8:1,i=B5(t),a=Math.max(n?10:120,Math.floor(s*i*o*Zs));return e.currentExp=Math.max(0,(e.currentExp||0)+a),a},Df=e=>(e.revengeProgress||(e.revengeProgress={currentStageIndex:0,completedStages:[],sagaComplete:!1}),Array.isArray(e.revengeProgress.completedStages)||(e.revengeProgress.completedStages=[]),e.revengeProgress),P5=e=>(Array.isArray(e.newsBuffer)||(e.newsBuffer=[]),e.newsBuffer),l1=(e,t,{resetProgress:n=!0}={})=>{const s=e.rival||{},o=typeof t.baseThreat=="number"?t.baseThreat:0,i=An(t.tier);return e.rival={...s,name:t.name,stageId:t.id,tier:t.tier,maxExp:(i==null?void 0:i.maxExp)||s.maxExp||t.baseExp,state:n?"NORMAL":s.state||"NORMAL",lifeStage:n?0:s.lifeStage||0,storyTimer:n?0:s.storyTimer||0,isDead:n?!1:s.isDead||!1,rumorCount:n?0:s.rumorCount||0,threatLevel:n?o:s.threatLevel??o,hiddenTurns:0,currentExp:t.baseExp,stats:{...a1,...s.stats||{}},combatStats:{...s.combatStats||{},hp:t.combatStats.hp,maxHp:t.combatStats.maxHp,atk:t.combatStats.atk,def:t.combatStats.def}},zf(e.rival),Tc(e.rival,t.tier),e.rival},ai=e=>{const t=Df(e),n=yc(t.currentStageIndex||0);return!e.rival||e.rival.stageId!==n.id?l1(e,n,{resetProgress:!0}):e.rival};function z5(e,t=50){const n=ai(e);if(e.resources.spiritStones<t)return{success:!1,message:""};const s=e.time.year*12+e.time.month;if(e.revengeActions.lastRumorMonth===s)return{success:!1,message:""};e.resources.spiritStones=Math.max(0,e.resources.spiritStones-t);const o=Math.min(.9,.6+t/200);if(!(Math.random()<o))return n.threatLevel=Math.min(100,n.threatLevel+15),e.revengeActions.lastRumorMonth=s,{success:!0,effectType:"FAILED",message:`${n.name}...`,threatIncrease:15};let a="",l=0;return t>=100?(a="HEAVY",l=200,n.state="FURIOUS",n.threatLevel=Math.min(100,n.threatLevel+25),n.currentExp=Math.max(0,n.currentExp-l),n.rumorCount+=2):(a="LIGHT",l=100,n.state="ANXIOUS",n.threatLevel=Math.min(100,n.threatLevel+10),n.currentExp=Math.max(0,n.currentExp-l),n.rumorCount+=1),e.revengeActions.lastRumorMonth=s,e.revengeActions.totalRumors+=1,{success:!0,effectType:a,message:a==="HEAVY"?`${n.name}`:`${n.name}...`,damage:l,threatIncrease:a==="HEAVY"?25:10,newsEvent:{type:a==="HEAVY"?"RIVAL_HEAVY_RUMOR":"RIVAL_LIGHT_RUMOR",data:{actor:n.name,rumorCount:n.rumorCount}}}}function D5(e,t=1,n=30){const s=ai(e),o=t*n;if(e.resources.spiritStones<o)return{success:!1,message:`${t}${o}`};e.resources.spiritStones=Math.max(0,e.resources.spiritStones-o);const i=40*t;return s.threatLevel=Math.max(0,s.threatLevel-i),s.threatLevel<30&&(s.state="NORMAL"),s.hiddenTurns=t,e.revengeActions.hidingMonths+=t,{success:!0,message:`${t}${s.name}`,threatReduction:i,months:t,newsEvent:{type:"RIVAL_HIDE_SUCCESS",data:{actor:s.name,months:t}}}}function F5(e){const t=ai(e),n=Df(e),s=yc(n.currentStageIndex||0),o=P5(e);if(e.tier==="")return{success:!1,message:`${t.name}`};const a=zn(e).total,l=(s==null?void 0:s.powerMultiplier)??1,d=1-t.rumorCount*.05,u=Math.max(.5,Zs*l*Math.max(.5,d)),p=(h={})=>{const g=Math.max(1,Math.floor((h.maxHp||100)*u)),v=Math.max(1,Math.floor((h.maxMp||50)*u));return{...h,maxHp:g,maxMp:v,hp:Math.max(1,Math.floor((h.hp||h.maxHp||100)*u)),mp:Math.max(1,Math.floor((h.mp||h.maxMp||50)*u)),atk:Math.max(1,Math.floor((h.atk||10)*u)),def:Math.max(0,Math.floor((h.def||5)*u))}},c={...e,combatStats:e.combatStats||{maxHp:100,maxMp:50,atk:10,def:5,hp:100,mp:50}},f={...t,combatStats:p(t.combatStats||{maxHp:120,maxMp:60,atk:12,def:6,hp:120,mp:60})},C=qi(c,f).success,w=zn(f).total,S=a/(a+w);if(console.log(":",{:s==null?void 0:s.name,:a,:zn(t).total,:Math.floor(w),:l,:`${t.rumorCount} (-${t.rumorCount*5}%)`,:`${(S*100).toFixed(1)}%`,:C?"":""}),C){const h=n.currentStageIndex>=Fl;if(t.isDead=!0,t.state="DEAD",t.threatLevel=0,n.completedStages.includes(s.id)||n.completedStages.push(s.id),h)return n.sagaComplete=!0,n.currentStageIndex=Fl,console.log("[] REVENGE_SAGA_COMPLETE"),Wt(o,"REVENGE_SAGA_COMPLETE",{actor:e.name,finalTarget:t.name}),{success:!0,victory:!0,sagaComplete:!0,message:(s==null?void 0:s.defeatLog)||`${t.name}...`,playerPower:a,rivalPower:Math.floor(w),newsEvent:{type:"RIVAL_DEFEATED",data:{actor:e.name,target:t.name}}};const g=Math.min(n.currentStageIndex+1,Fl);n.currentStageIndex=g;const v=yc(g);return l1(e,v,{resetProgress:!0}),console.log("[] REVENGE_STAGE_ADVANCERIVAL_DEFEATED"),Wt(o,"REVENGE_STAGE_ADVANCE",{actor:e.name,clearedStage:s.name,nextStage:v.name}),Wt(o,"RIVAL_DEFEATED",{actor:e.name,target:t.name}),{success:!0,victory:!0,stageCleared:s.id,nextStageUnlocked:!0,nextStage:v,message:(s==null?void 0:s.defeatLog)||`${t.name}`,transitionLog:s==null?void 0:s.unlockNextLog,playerPower:a,rivalPower:Math.floor(w),newsEvent:{type:"RIVAL_DEFEATED",data:{actor:e.name,target:t.name}}}}else return yw(e),Wt(o,"REVENGE_DUEL_FAILED",{actor:e.name,rival:t.name,stageTitle:s==null?void 0:s.title}),{success:!0,victory:!1,message:`${t.name}...`,playerPower:a,rivalPower:Math.floor(w),newsEvent:{type:"RIVAL_VICTORY",data:{actor:t.name,target:e.name}}}}function H5(e){const t=ai(e);if(t.hiddenTurns>0)return t.hiddenTurns-=1,null;if(t.threatLevel>=100){const n="",s=e.combatStats=e.combatStats||{},o=s.hp??s.maxHp??100,i=s.maxHp||Math.max(100,o),a=.3+e.stats.cunning/200,l=Math.random()<a,d=Math.floor(i*.4),u=Math.floor(i*.75);return e.revengeActions=e.revengeActions||{},e.revengeActions.assassinationAttempts=(e.revengeActions.assassinationAttempts||0)+1,l?(e.combatStats.hp=Math.max(10,o-d),t.threatLevel=Math.max(35,t.threatLevel-35),{type:"ASSASSINATION_SURVIVED",survived:!0,message:`${n}`,hpLoss:d}):(e.combatStats.hp=Math.max(5,o-u),e.currentExp=Math.max(0,Math.floor(e.currentExp*.6)),t.threatLevel=Math.max(40,t.threatLevel-45),{type:"ASSASSINATION_INJURED",survived:!1,message:`${n}`,hpLoss:u})}return null}function W5(e){const t=ai(e),n=Df(e),s=yc(n.currentStageIndex||0);if(zf(t),Tc(t),t.isDead)return null;O5(t,s),t.storyTimer=(t.storyTimer||0)+1;const o=(s==null?void 0:s.storyBeats)||[],i=t.lifeStage||0,a=o[i];if(!a)return null;const l=Math.max(1,a.delay||1);if(t.storyTimer<l||!(!(typeof a.exp=="number")||(t.currentExp||0)>=a.exp*.95))return null;if(t.lifeStage=i+1,t.storyTimer=0,a.tier&&(t.tier=a.tier,Tc(t,a.tier)),typeof a.exp=="number"){const c=Math.floor(a.exp*Zs);t.currentExp=Math.max(t.currentExp,c)}const p={actor:t.name,detail:a.detail||a.tier||(s==null?void 0:s.title),target:a.target,stageTitle:s==null?void 0:s.title,stageRole:s==null?void 0:s.role,stageTier:a.tier||(s==null?void 0:s.tier),description:a.description};return Object.keys(p).forEach(c=>{(p[c]===void 0||p[c]===null)&&delete p[c]}),{type:a.type||"RIVAL_STAGE_EVENT",data:p}}function U5(e){const t=ai(e);if(t.isDead||t.hiddenTurns>0)return 0;const n=Math.ceil(2*Zs);let s=1;return t.threatLevel>=60?s=1.5*Zs:t.threatLevel>=30&&(s=1.2*Zs),Math.ceil(n*s)}function G5(e){return e.isDead?null:e.threatLevel>=80?{type:"RIVAL_THREAT_CRITICAL",data:{actor:e.name}}:e.threatLevel>=60?{type:"RIVAL_THREAT_HIGH",data:{actor:e.name}}:e.threatLevel>=30?{type:"RIVAL_THREAT_MEDIUM",data:{actor:e.name,playerName:""}}:null}const V5={currentStageIndex:0,completedStages:[],sagaComplete:!1},Y5={lastRumorMonth:0,totalRumors:0,assassinationAttempts:0,hidingMonths:0},q5=e=>e&&{...e,resources:{...e.resources||{}},rival:e.rival?{...e.rival,stats:{...e.rival.stats||{}},combatStats:{...e.rival.combatStats||{}},revengeProgress:e.rival.revengeProgress?{...e.rival.revengeProgress}:void 0}:e.rival,revengeActions:{...Y5,...e.revengeActions||{}},revengeProgress:e.revengeProgress?{...e.revengeProgress,completedStages:Array.isArray(e.revengeProgress.completedStages)?[...e.revengeProgress.completedStages]:[]}:{...V5},newsBuffer:Array.isArray(e.newsBuffer)?[...e.newsBuffer]:[],combatStats:e.combatStats?{...e.combatStats}:e.combatStats},K5=({player:e,setPlayer:t,addLog:n})=>{var Me,Pe,Ke,q;const[s,o]=y.useState(50),[i,a]=y.useState(1),[l,d]=y.useState(null),[u,p]=y.useState(null),[c,f]=y.useState(!1),x=i*30,C=y.useMemo(()=>c?"":e!=null&&e.resources?e.resources.spiritStones<x?`${i}${x}`:"":"",[c,e==null?void 0:e.resources,(Me=e==null?void 0:e.resources)==null?void 0:Me.spiritStones,x,i]),w=!C,S=y.useCallback((de,...Z)=>{const re=q5(e),ce=de(re,...Z);return console.log(" [executeRevengeAction] :",ce),ce!=null&&ce.success&&t(re),ce},[e,t]),h=y.useCallback((de,Z=5e3)=>{de&&(d(de),setTimeout(()=>d(null),Z))},[]),g=e.rival||{name:"",state:"NORMAL",lifeStage:0,threatLevel:0,rumorCount:0,isDead:!1,tier:"",currentExp:300},v=e.revengeProgress||{currentStageIndex:0,sagaComplete:!1},j=Math.min(v.currentStageIndex||0,wa.length-1),R=wa[j],b=!!v.sagaComplete,_=b?"":"",I=zn(e).total,k=zn(g).total,T=Math.max(.5,1-g.rumorCount*.05),N=Zs*((R==null?void 0:R.powerMultiplier)||1),K=Math.floor(k*N*T),L=(de,Z=50)=>Math.floor((de??Z)*T*N),B=de=>de>=80?"#ff4444":de>=60?"#ff8800":de>=30?"#ffbb00":"#44ff44",W=de=>de>=80?"":de>=60?"":de>=30?"":"",z=de=>({NORMAL:"",ANXIOUS:"",FURIOUS:"",DEAD:""})[de]||"",ne=y.useCallback(()=>{if(c)return;f(!0);const de=Math.floor(k*N*T),Z=S(z5,s);if(Z!=null&&Z.success&&Z.effectType!=="FAILED"){const re=Math.max(.5,1-(g.rumorCount+(s>=100?2:1))*.05),ce=Math.floor(k*N*re),le=de-ce;Z.actualPowerLoss=le}h(Z),f(!1)},[S,h,c,s,k,N,T,g.rumorCount]),Q=y.useCallback(()=>{if(!w){h({success:!1,message:C});return}f(!0);const de=S(D5,i,30);h(de),f(!1)},[w,S,C,i,h]),se=()=>{var Z,re;if(console.log("handleDuel:",e.tier),console.log(":",e),!Af(e).canDuel){if(((Z=e.stats)==null?void 0:Z.health)<20){window.showResult?window.showResult(" ",`${Math.floor(e.stats.health)}/100`,!1,null,!1):p({title:" ",message:`${Math.floor(e.stats.health)}/100`});return}else if(((re=e.stats)==null?void 0:re.health)<30&&window.showConfirm){window.showConfirm(` 30${Math.floor(e.stats.health)}/100`,()=>{ye()});return}}ye()},ye=()=>{const de=g.name,Z=(R==null?void 0:R.title)||"";window.showConfirm&&window.showConfirm(`${Z}${de}`,()=>{const re=S(F5);if(console.log(" [RevengePanel] :",re),re!=null&&re.success)if(console.log("  - :",re.victory),re.victory){const ce=re.sagaComplete?" ":` ${de}`,le=re.message||`${de}`;if(console.log(" :",ce),h({success:!0,message:le,transitionLog:re.transitionLog,nextStage:re.nextStage,sagaComplete:re.sagaComplete},re.sagaComplete?8e3:6e3),p({title:ce,message:le,type:"victory"}),window.showResult&&typeof window.showResult=="function"?window.showResult(ce,le,!0,null,!1):(console.warn(" window.showResult "),p({title:ce,message:le,type:"victory"})),n){const we=re.sagaComplete?` ${de}`:` ${de}${R==null?void 0:R.title}`;n(we,"","")}}else{const ce=re.message||`${de}...`;if(console.log(" :"," ",ce),console.log(" window.showResult :",{exists:!!window.showResult,isFunction:typeof window.showResult=="function"}),h({success:!1,message:ce,damage:"",newsEvent:re.newsEvent},6e3),p({title:" ",message:ce,type:"defeat"}),window.showResult&&typeof window.showResult=="function")try{console.log("  window.showResult"),window.showResult(" ",ce,!1,null,!1)}catch(le){console.error(" window.showResult :",le),p({title:" ",message:ce,type:"defeat"})}else console.warn(" window.showResult "+typeof window.showResult+""),p({title:" ",message:ce,type:"defeat"});n&&n(` ${de}`,"","")}else{console.error(" :",re);const ce=re&&re.message||`${de}`;window.showResult&&typeof window.showResult=="function"?window.showResult(" ",ce,!1,null,!1):p({title:" ",message:ce})}})};return g.isDead&&b?r.jsx("div",{style:Re.panel,children:r.jsxs("div",{style:Re.completed,children:[r.jsx("h2",{children:"  "}),r.jsxs("p",{children:[g.name,""]}),r.jsx("p",{children:"..."})]})}):r.jsxs("div",{style:Re.panel,children:[r.jsxs("div",{style:Re.header,children:[r.jsx("h2",{style:Re.title,children:" "}),r.jsxs("p",{style:Re.subtitle,children:["",g.name]})]}),r.jsxs("div",{style:Re.stageNarrative,children:[r.jsxs("div",{style:Re.stageFocusHeader,children:[r.jsxs("span",{style:Re.stageBadge,children:["",j+1,""]}),r.jsx("span",{style:Re.stageStatus,children:_})]}),r.jsx("div",{style:Re.stageFocusName,children:g.name}),r.jsx("div",{style:Re.stageFocusTitle,children:(R==null?void 0:R.title)||""}),r.jsx("p",{style:Re.stageNarrativeText,children:(R==null?void 0:R.flavor)||""}),b&&r.jsx("p",{style:Re.stageNarrativeNext,children:""})]}),r.jsxs("div",{style:Re.rivalStatus,children:[r.jsx("h3",{style:Re.sectionTitle,children:""}),r.jsxs("div",{style:Re.statusGrid,children:[r.jsxs("div",{style:Re.statusItem,children:[r.jsx("span",{style:Re.statusLabel,children:""}),r.jsx("span",{style:Re.statusValue,children:g.tier})]}),r.jsxs("div",{style:Re.statusItem,children:[r.jsx("span",{style:Re.statusLabel,children:""}),r.jsx("span",{style:Re.statusValue,children:z(g.state)})]}),r.jsxs("div",{style:Re.statusItem,children:[r.jsx("span",{style:Re.statusLabel,children:""}),r.jsxs("span",{style:{...Re.statusValue,color:B(g.threatLevel)},children:[W(g.threatLevel)," ",g.threatLevel,"%"]})]}),r.jsxs("div",{style:Re.statusItem,children:[r.jsx("span",{style:Re.statusLabel,children:""}),r.jsxs("span",{style:Re.statusValue,children:[" ",g.rumorCount*5,"%"]})]})]}),r.jsx("div",{style:Re.threatBar,children:r.jsx("div",{style:{...Re.threatFill,width:`${g.threatLevel}%`,backgroundColor:B(g.threatLevel)}})}),g.threatLevel>=80&&r.jsx("div",{style:Re.dangerWarning,children:" "})]}),r.jsxs("div",{style:Re.actions,children:[r.jsx("h3",{style:Re.sectionTitle,children:""}),r.jsxs("div",{style:Re.actionCard,children:[r.jsxs("div",{style:Re.actionHeader,children:[r.jsx("h4",{style:Re.actionTitle,children:" "}),r.jsxs("span",{style:Re.actionCost,children:["",i*30," "]})]}),r.jsxs("p",{style:Re.actionDesc,children:["",g.name,"80%"]}),r.jsxs("div",{style:Re.actionControlsVertical,children:[r.jsxs("select",{value:i,onChange:de=>a(Number(de.target.value)),style:Re.select,children:[r.jsx("option",{value:"1",children:"1-40%"}),r.jsx("option",{value:"2",children:"2-80%"}),r.jsx("option",{value:"3",children:"3-100%"})]}),r.jsxs("button",{style:{...Re.hideBtn,...w?{}:{opacity:.6,cursor:"not-allowed"}},onClick:Q,"aria-disabled":!w,title:w?"":C,children:[" (",i*30,")"]})]})]}),r.jsxs("div",{style:Re.actionCard,children:[r.jsxs("div",{style:Re.actionHeader,children:[r.jsx("h4",{style:Re.actionTitle,children:" "}),r.jsxs("span",{style:Re.actionCost,children:["",s," "]})]}),r.jsxs("p",{style:Re.actionDesc,children:["",g.name,"",r.jsx("br",{}),""]}),r.jsx("div",{style:Re.actionControls,children:r.jsx("input",{type:"range",min:"50",max:"150",step:"10",value:s,onChange:de=>o(Number(de.target.value)),style:Re.slider})}),r.jsxs("button",{style:Re.rumorBtn,onClick:ne,disabled:c||!(e!=null&&e.resources)||e.resources.spiritStones<s,children:[" (",s,")"]}),r.jsxs("div",{style:Re.actionInfo,children:["",Math.min(90,60+s/2),"% | +",s>=100?25:10]})]}),r.jsxs("div",{style:{...Re.actionCard,...Re.finalDuelCard},children:[r.jsxs("div",{style:Re.actionHeader,children:[r.jsx("h4",{style:Re.actionTitle,children:" "}),r.jsx("span",{style:Re.actionWarning,children:""})]}),r.jsxs("p",{style:Re.actionDesc,children:["",g.name,"",r.jsx("br",{}),r.jsx("strong",{children:""}),""]}),r.jsxs("div",{style:Re.powerComparison,children:[r.jsxs("div",{style:Re.powerItem,children:[r.jsx("span",{children:""}),r.jsx("span",{children:I})]}),r.jsxs("div",{style:Re.powerItem,children:[r.jsx("span",{children:""}),r.jsx("span",{children:K})]})]}),r.jsx("div",{style:{fontSize:"12px",color:"#666",marginTop:"8px"},children:""}),r.jsx("button",{style:Re.duelBtn,onClick:se,disabled:e.tier==="",children:""}),r.jsxs("div",{style:{fontSize:"16px",fontWeight:"bold",color:"#d4af37",marginTop:12,textAlign:"center",backgroundColor:"rgba(212, 175, 55, 0.1)",padding:"8px",borderRadius:"4px"},children:[" ",Math.round(My(e,{...g,combatStats:{...g.combatStats||{},atk:L((Pe=g.combatStats)==null?void 0:Pe.atk,50),def:L((Ke=g.combatStats)==null?void 0:Ke.def,20),maxHp:L((q=g.combatStats)==null?void 0:q.maxHp,500)}}).prob*100),"%"]}),e.tier===""&&r.jsx("div",{style:Re.actionWarningText,children:" "})]})]}),l&&r.jsxs("div",{style:{...Re.resultToast,backgroundColor:l.success?"#4caf50":"#f44336"},children:[r.jsx("p",{children:l.message}),l.damage&&r.jsxs("p",{children:["",l.damage]}),l.actualPowerLoss&&r.jsxs("p",{children:["-",l.actualPowerLoss," (-",Math.round(l.actualPowerLoss/K*100),"%)"]}),l.threatIncrease&&r.jsxs("p",{children:["+",l.threatIncrease,"%"]}),l.threatReduction&&r.jsxs("p",{children:["-",l.threatReduction,"%"]}),l.transitionLog&&r.jsx("p",{children:l.transitionLog}),l.nextStage&&r.jsxs("p",{children:["",l.nextStage.name,"",l.nextStage.title,""]})]}),u&&r.jsx("div",{style:Re.modalOverlay,children:r.jsxs("div",{style:Re.modalCard,children:[r.jsx("div",{style:Re.modalIcon,children:u.type==="victory"?"":u.type==="defeat"?"":""}),r.jsx("h3",{style:{marginBottom:10},children:u.title}),r.jsx("p",{style:Re.modalText,children:u.message}),r.jsx("button",{style:Re.modalButton,onClick:()=>p(null),children:u.type==="victory"?"":""})]})})]})},Re={panel:{padding:"20px",maxWidth:"900px",margin:"0 auto",color:"#e0d5c7"},header:{textAlign:"center",marginBottom:"30px",borderBottom:"2px solid #8b4513",paddingBottom:"15px"},stageFocusHeader:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"10px"},stageBadge:{fontSize:"12px",letterSpacing:"2px",padding:"4px 10px",borderRadius:"999px",border:"1px solid #ffd700",color:"#ffd700"},stageStatus:{fontSize:"12px",padding:"4px 12px",borderRadius:"999px",background:"rgba(255,255,255,0.08)",color:"#fff"},stageFocusName:{fontSize:"22px",fontWeight:"bold",color:"#ffe4c4"},stageFocusTitle:{fontSize:"14px",color:"#ffcc80",marginTop:"4px"},stageNarrative:{border:"1px solid rgba(255,255,255,0.1)",borderRadius:"10px",padding:"16px",marginBottom:"20px",background:"rgba(0,0,0,0.25)"},stageNarrativeText:{fontSize:"14px",color:"#f0e1c3",marginTop:"6px"},stageNarrativeNext:{fontSize:"13px",color:"#ffd700",marginTop:"8px"},title:{color:"#ff6b6b",fontSize:"28px",marginBottom:"8px",textShadow:"2px 2px 4px rgba(0,0,0,0.5)"},subtitle:{color:"#ffd700",fontSize:"18px",fontStyle:"italic"},rivalStatus:{background:"linear-gradient(135deg, rgba(40, 20, 20, 0.8), rgba(60, 30, 30, 0.8))",border:"2px solid #8b4513",borderRadius:"12px",padding:"20px",marginBottom:"25px",boxShadow:"0 4px 12px rgba(0,0,0,0.4)"},sectionTitle:{color:"#ffd700",marginBottom:"15px",fontSize:"20px"},statusGrid:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(140px, 1fr))",gap:"12px",marginBottom:"15px"},statusItem:{display:"flex",justifyContent:"space-between",padding:"8px 12px",background:"rgba(0,0,0,0.3)",borderRadius:"6px"},statusLabel:{color:"#bbb",fontWeight:"500"},statusValue:{color:"#fff",fontWeight:"bold"},threatBar:{width:"100%",height:"30px",background:"rgba(0,0,0,0.5)",borderRadius:"15px",overflow:"hidden",border:"2px solid #666",marginTop:"15px",position:"relative"},threatFill:{height:"100%",transition:"width 0.5s ease, background-color 0.5s ease",display:"flex",alignItems:"center",justifyContent:"center",fontWeight:"bold",color:"white",textShadow:"1px 1px 2px rgba(0,0,0,0.8)"},dangerWarning:{marginTop:"15px",padding:"12px",background:"linear-gradient(90deg, #ff4444, #ff6b6b)",border:"2px solid #ff0000",borderRadius:"8px",color:"white",fontWeight:"bold",textAlign:"center",boxShadow:"0 0 20px rgba(255, 68, 68, 0.6)"},actions:{marginTop:"30px"},actionCard:{background:"linear-gradient(135deg, rgba(30, 30, 40, 0.9), rgba(50, 40, 60, 0.9))",border:"2px solid #8b4513",borderRadius:"12px",padding:"20px",marginBottom:"20px",boxShadow:"0 4px 12px rgba(0,0,0,0.4)"},finalDuelCard:{background:"linear-gradient(135deg, rgba(60, 20, 20, 0.9), rgba(80, 30, 30, 0.9))",borderColor:"#ff4444"},actionHeader:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"12px",borderBottom:"1px solid rgba(255, 255, 255, 0.2)",paddingBottom:"10px"},actionTitle:{color:"#ffd700",fontSize:"18px",margin:0},actionCost:{color:"#66ff66",fontWeight:"bold",fontSize:"14px"},actionWarning:{color:"#ff6b6b",fontWeight:"bold",fontSize:"14px"},actionDesc:{color:"#ccc",lineHeight:"1.6",marginBottom:"15px",fontSize:"14px"},actionControls:{display:"flex",flexDirection:"column",gap:"12px",marginBottom:"12px"},actionControlsVertical:{display:"flex",flexDirection:"column",gap:"12px"},slider:{width:"100%",height:"8px"},select:{width:"100%",padding:"12px",background:"rgba(0, 0, 0, 0.5)",color:"#fff",border:"2px solid #8b4513",borderRadius:"6px",fontSize:"14px",cursor:"pointer"},rumorBtn:{width:"100%",padding:"14px 24px",border:"none",borderRadius:"8px",background:"linear-gradient(135deg, #6a5acd, #8b7ad8)",color:"white",fontWeight:"bold",fontSize:"15px",cursor:"pointer",boxShadow:"0 4px 8px rgba(0,0,0,0.3)",transition:"transform 0.2s"},hideBtn:{width:"100%",padding:"14px 24px",border:"none",borderRadius:"8px",background:"linear-gradient(135deg, #4a90e2, #5ba3f5)",color:"white",fontWeight:"bold",fontSize:"15px",cursor:"pointer",boxShadow:"0 4px 8px rgba(0,0,0,0.3)",transition:"transform 0.2s"},duelBtn:{width:"100%",background:"linear-gradient(135deg, #ff4444, #ff6b6b)",color:"white",fontSize:"16px",padding:"14px",border:"none",borderRadius:"8px",fontWeight:"bold",cursor:"pointer",boxShadow:"0 4px 8px rgba(0,0,0,0.3)"},actionInfo:{color:"#aaa",fontSize:"12px",marginTop:"5px"},actionWarningText:{color:"#ff6b6b",fontSize:"13px",textAlign:"center",marginTop:"10px",fontWeight:"bold"},powerComparison:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"15px",margin:"15px 0",padding:"15px",background:"rgba(0, 0, 0, 0.3)",borderRadius:"8px"},powerItem:{display:"flex",flexDirection:"column",alignItems:"center",gap:"5px",color:"#bbb",fontSize:"13px"},completed:{textAlign:"center",padding:"60px 40px",background:"linear-gradient(135deg, rgba(40, 80, 40, 0.8), rgba(60, 100, 60, 0.8))",border:"3px solid #4caf50",borderRadius:"16px",boxShadow:"0 8px 24px rgba(0,0,0,0.5)"},resultToast:{position:"fixed",bottom:"30px",left:"50%",transform:"translateX(-50%)",padding:"20px 30px",borderRadius:"12px",boxShadow:"0 8px 24px rgba(0,0,0,0.5)",zIndex:9999,minWidth:"300px",maxWidth:"500px",color:"white"},modalOverlay:{position:"fixed",inset:0,background:"rgba(0,0,0,0.65)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:99999},modalCard:{width:"90%",maxWidth:420,background:"rgba(24,17,13,0.95)",border:"1px solid rgba(255,255,255,0.2)",borderRadius:18,padding:"24px 24px 28px",textAlign:"center",boxShadow:"0 20px 45px rgba(0,0,0,0.45)"},modalIcon:{fontSize:42,marginBottom:12},modalText:{lineHeight:1.7,fontSize:15,color:"#f7d8b4",marginBottom:18},modalButton:{padding:"10px 20px",borderRadius:999,border:"none",background:"linear-gradient(120deg, #f06292, #f7b733)",color:"#fff",fontWeight:"bold",cursor:"pointer",boxShadow:"0 6px 18px rgba(240,98,146,0.45)"}},ja=(e="")=>({base:0,skinColor:0,hair:1,hairColor:0,eye:0,eyeColor:1,mouth:0,gender:e}),Q5=(e,t)=>!e||!t?!1:e.base===t.base&&e.skinColor===t.skinColor&&e.hair===t.hair&&e.hairColor===t.hairColor&&e.eye===t.eye&&e.eyeColor===t.eyeColor&&e.mouth===t.mouth&&e.gender===t.gender,c1=(e,t)=>{const n=e?{...e,gender:e.gender??t}:ja(t);return Q5(n,ja(t))?null:n},d1=(e,t)=>e?{...ja(t),...e,gender:e.gender??t}:ja(t),jl=e=>{if(!e)return e;const t=e.gender;return{...e,avatar:c1(e.avatar,t),currentExp:Math.max(0,Math.floor((e==null?void 0:e.currentExp)||0)),maxExp:Math.max(1,Math.floor((e==null?void 0:e.maxExp)||1))}},Cl=e=>{if(!e)return e;const t=e.gender;return{...e,avatar:d1(e.avatar,t),currentExp:Math.max(0,Math.floor(Number(e.currentExp)||0)),maxExp:Math.max(1,Math.floor(Number(e.maxExp)||1))}},xu=2e6,yu=(e,t)=>!Array.isArray(e)||e.length<=t?e:e.slice(-t),J5=(e,t=200,n=30)=>{if(!e||typeof e!="object")return e;const o=Object.keys(e).slice(-t),i={};for(const a of o){const l=e[a];i[a]=Array.isArray(l)?l.slice(-n):l}return i},X5=(e=[])=>{if(!Array.isArray(e))return e;const t=new Map,n=[];return e.forEach(s=>{if(!s)return;const o=s.id||s.itemId;if(!(s.stackable===!0&&o)){n.push(s);return}const a=o;if(!t.has(a)){const d={...s};d.quantity=0,d.instanceId=`${o}_stack`,t.set(a,d)}const l=t.get(a);l.quantity+=Number(s.quantity||1)}),[...n,...t.values()]},Z5=(e=[])=>{const t=[],n={};let s=0;e.forEach(a=>{if(!a)return;if((a.generation||1)<=2){t.push(a);return}s+=1;const d=a.tierTitle||a.tier||"";n[d]=(n[d]||0)+1});const o=Object.entries(n).map(([a,l])=>({t:a,c:l})),i=s>0?{c:s,t:o}:void 0;return{mainlineChildren:t,descendantsSummary:i}},eC=e=>{if(!e||!e.c)return[];const t=Array.isArray(e.t)?e.t:[{t:"",c:e.c}],n=[];let s=0;return t.forEach(({t:o,c:i})=>{const a=Number(i||0);for(let l=0;l<a;l+=1){s+=1;const d=s%2===0?"":"";n.push({id:`desc_${s}`,name:`${s}`,generation:3,age:20,gender:d,avatar:ja(d),stats:{aptitude:50,looks:50,intelligence:50,lifespan:100},isTested:!0,isAdult:!0,cultivation:0,tierTitle:o||"",currentExp:0,maxExp:1})}}),n},Hg=(e,t={})=>{const{aggressive:n=!1}=t,s=e.player||{},o=s.rival,i=s.revengeProgress,a=s.revengeActions,{mainlineChildren:l,descendantsSummary:d}=Z5(e.children||[]),u=n?void 0:yu(s.worldEvents,200),p=n?void 0:yu(s.newsBuffer,200),c=n?[]:Array.isArray(e.messages)?yu(e.messages,200):J5(e.messages,200,30),f=n?{}:e.lastMessageCheck||{},x=X5(e.inventory||[]),C=Array.isArray(e.logs)?e.logs.filter(w=>w&&w.category===""):[];return{v:2,p:{n:s.name,a:s.age,hp:s.hp,mhp:s.maxHp,cv:s.cultivation,ce:Math.max(0,Math.floor(s.currentExp||0)),me:Math.max(1,Math.floor(s.maxExp||1)),t:s.tier,tt:s.tierTitle,w:s.wealth,m:s.mood,tm:s.time,av:c1(s.avatar,s.gender),g:s.gender,ps:s.personality,ap:s.appearance,we:u,nb:p,fr:s.familyRatingSummary,frc:s.familyRating,bs:s.businesses||[],rs:s.resources||{spiritStones:0,money:0},sp:s.skillPoints||0,st:s.stats||{},cs:s.combatStats||{},sr:s.spiritRoot||null,pcs:s.childrenStrategy||{skipZhaozhou:!1},rv:o?{n:o.name,sid:o.stageId,t:o.tier,st:o.state,ls:o.lifeStage||0,tl:o.threatLevel||0,d:o.isDead||!1,rc:o.rumorCount||0,ht:o.hiddenTurns||0,ce:o.currentExp||0,stt:o.stats||{},cst:o.combatStats||{}}:void 0,rp:i?{si:i.currentStageIndex||0,cs:i.completedStages||[],sc:i.sagaComplete||!1}:void 0,ra:a?{lr:a.lastRumorMonth||0,tr:a.totalRumors||0,aa:a.assassinationAttempts||0,hm:a.hidingMonths||0}:void 0},ch:l.map(jl),d3:d,fc:(e.fallenChildren||[]).map(jl),an:(e.activeNpcs||[]).map(jl),dn:(e.deadNpcs||[]).map(jl),inv:x,lg:C,gs:e.gameStage,msg:c,lmc:f,psc:e.pendingSectChoices,tq:e.testQueue}},tC=e=>{const t=e.p||{},n=t.rv,s=t.rp,o=t.ra,i=Vo(),a=(e.ch||[]).map(Cl),l=eC(e.d3);return{player:{name:t.n,age:t.a,hp:t.hp,maxHp:t.mhp,cultivation:t.cv,currentExp:Math.max(0,Math.floor(Number(t.ce)||0)),maxExp:Math.max(1,Math.floor(Number(t.me)||1)),tier:t.t,tierTitle:t.tt,wealth:t.w,mood:t.m,time:t.tm,avatar:d1(t.av,t.g),gender:t.g,personality:t.ps,appearance:t.ap,worldEvents:t.we,newsBuffer:t.nb,familyRatingSummary:t.fr,familyRating:t.frc,businesses:t.bs||[],resources:t.rs||{spiritStones:0,money:0},skillPoints:t.sp||0,stats:t.st||{},combatStats:t.cs||{},spiritRoot:t.sr?{...i.spiritRoot,...t.sr}:{...i.spiritRoot},childrenStrategy:t.pcs||{skipZhaozhou:!1},rival:n?{name:n.n,stageId:n.sid,tier:n.t,state:n.st,lifeStage:n.ls||0,threatLevel:n.tl||0,isDead:n.d||!1,rumorCount:n.rc||0,hiddenTurns:n.ht||0,currentExp:n.ce||0,stats:n.stt||{},combatStats:n.cst||{}}:void 0,revengeProgress:s?{currentStageIndex:s.si||0,completedStages:s.cs||[],sagaComplete:s.sc||!1}:void 0,revengeActions:o?{lastRumorMonth:o.lr||0,totalRumors:o.tr||0,assassinationAttempts:o.aa||0,hidingMonths:o.hm||0}:void 0},children:[...a,...l],fallenChildren:(e.fc||[]).map(Cl),activeNpcs:(e.an||[]).map(Cl),deadNpcs:(e.dn||[]).map(Cl),inventory:e.inv||[],logs:e.lg||[],gameStage:e.gs,messages:Array.isArray(e.msg)?e.msg:[],lastMessageCheck:e.lmc||{},pendingSectChoices:e.psc,testQueue:e.tq}},nC=(e,t="")=>{try{let n=Hg(e),s=JSON.stringify(n),o=btoa(unescape(encodeURIComponent(s)));if(o.length>xu&&(n=Hg(e,{aggressive:!0}),s=JSON.stringify(n),o=btoa(unescape(encodeURIComponent(s))),console.warn(" //")),o.length>xu)return console.error(` ${xu.toLocaleString()} `),null;const i=(o.length/1024).toFixed(2);return console.log(` : ${i} KB (C)`),o}catch(n){return console.error(" :",n),null}},rs=(e="")=>{const t=e===""?[0,1,2]:[0,1,2,3],n=[0,1,2,3,4,5],s=[0,1,2,3,4,5,6,7],o=[0,1,2,3,4,5,6],i=[0,1,2,3,4,5],a=[0,1,2,3,4,5],l=[0,1,2,3,4],d=u=>u[Math.floor(Math.random()*u.length)];return{base:d(t),skinColor:d(n),hair:d(s),hairColor:d(o),eye:d(i),eyeColor:d(a),mouth:d(l)}},Pi=(e,t="")=>{if(!e||typeof e!="object"||Object.keys(e).length===0)return console.log(" ..."),rs(t);const n={...e};return!n.base&&n.base!==0&&(n.base=rs(t).base),!n.skinColor&&n.skinColor!==0&&(n.skinColor=rs(t).skinColor),!n.hair&&n.hair!==0&&(n.hair=rs(t).hair),!n.hairColor&&n.hairColor!==0&&(n.hairColor=rs(t).hairColor),!n.eye&&n.eye!==0&&(n.eye=rs(t).eye),!n.eyeColor&&n.eyeColor!==0&&(n.eyeColor=rs(t).eyeColor),!n.mouth&&n.mouth!==0&&(n.mouth=rs(t).mouth),n},rC=e=>{var t;try{const n=e.trim();if(!n)return console.error(" "),null;let s;try{s=decodeURIComponent(escape(atob(n)))}catch(l){return console.error(" Base64 :",l.message),null}let o;try{o=JSON.parse(s)}catch(l){return console.error(" JSON :",l.message),null}let i=o;if(o&&o.v===2&&o.p&&(i=tC(o)),!i.player)return console.error("  player "),null;!i.player.rival&&(o!=null&&o.rival)&&(i.player.rival=o.rival),!i.player.revengeProgress&&(o!=null&&o.revengeProgress)&&(i.player.revengeProgress=o.revengeProgress),!i.player.revengeActions&&(o!=null&&o.revengeActions)&&(i.player.revengeActions=o.revengeActions);const a=i.player;if(a){if(a.cultivation!==void 0){const l=Number(a.cultivation);a.cultivation=isNaN(l)?0:l}else a.cultivation=0;if(a.currentExp=Math.max(0,Math.floor(Number(a.currentExp)||0)),a.maxExp=Math.max(1,Math.floor(Number(a.maxExp)||1)),a.avatar=Pi(a.avatar,a.gender),!a.spiritRoot){const l=Vo();a.spiritRoot={...l.spiritRoot}}a.childrenStrategy?a.childrenStrategy.skipZhaozhou=a.childrenStrategy.skipZhaozhou??!1:a.childrenStrategy={skipZhaozhou:!1}}return Array.isArray(i.children)&&(i.children=i.children.map(l=>l&&(l.currentExp=Math.max(0,Math.floor(Number(l.currentExp)||0)),l.maxExp=Math.max(1,Math.floor(Number(l.maxExp)||1)),l.avatar=Pi(l.avatar,l.gender),l))),Array.isArray(i.activeNpcs)&&(i.activeNpcs=i.activeNpcs.map(l=>l&&(l.currentExp=Math.max(0,Math.floor(Number(l.currentExp)||0)),l.maxExp=Math.max(1,Math.floor(Number(l.maxExp)||1)),l.avatar=Pi(l.avatar,l.gender),l))),Array.isArray(i.deadNpcs)&&(i.deadNpcs=i.deadNpcs.map(l=>l&&(l.avatar=Pi(l.avatar,l.gender),l))),Array.isArray(i.fallenChildren)&&(i.fallenChildren=i.fallenChildren.map(l=>l&&(l.avatar=Pi(l.avatar,l.gender),l))),i.player.revengeProgress||(i.player.revengeProgress={currentStageIndex:0,completedStages:[],sagaComplete:!1}),i.player.revengeActions||(i.player.revengeActions={lastRumorMonth:0,totalRumors:0,assassinationAttempts:0,hidingMonths:0}),i.player.rival&&(i.player.rival.threatLevel=Math.max(0,Math.min(100,i.player.rival.threatLevel||0)),i.player.rival.isDead=i.player.rival.isDead||!1),console.log(" "),console.log(` : ${i.player.name}, : ${i.player.cultivation}`),console.log(` : ${i.player.currentExp}/${i.player.maxExp}`),console.log(` : ${(i.activeNpcs||[]).length}, : ${(i.children||[]).length}`),i.player.rival&&console.log(` :  ${(((t=i.player.revengeProgress)==null?void 0:t.currentStageIndex)||0)+1} , : ${i.player.rival.name}, : ${i.player.rival.threatLevel||0}`),i}catch(n){return console.error(" :",n),null}},sC=(e,t="save.txt")=>{try{const n=new Blob([e],{type:"text/plain;charset=utf-8"}),s=URL.createObjectURL(n),o=document.createElement("a");o.href=s,o.download=t,document.body.appendChild(o),o.click(),document.body.removeChild(o),URL.revokeObjectURL(s)}catch(n){console.error(":",n)}},oC=e=>new Promise((t,n)=>{const s=new FileReader;s.onload=o=>t(o.target.result),s.onerror=o=>n(o),s.readAsText(e)}),iC=({gameState:e,onLoadGame:t,playerName:n=""})=>{const[s,o]=y.useState("export"),[i,a]=y.useState(""),[l,d]=y.useState(""),[u,p]=y.useState(""),[c,f]=y.useState("info"),x=3e3,[C,w]=y.useState("whole"),[S,h]=y.useState(1),[g,v]=y.useState(1),j=(L,B="info")=>{p(L),f(B),setTimeout(()=>p(""),5e3)},R=()=>{if(!e){j("","error");return}try{const L=nC(e,n);if(!L){j("","error");return}a(L);const B=Math.ceil(L.length/x);v(B),h(1),w(B>1?"paginated":"whole");const W=(L.length/1024).toFixed(2),z=B>1?`${B}`:"";j(` : ${W} KB${z}`,"success")}catch(L){console.error(":",L),j(": "+L.message,"error")}},b=()=>{if(!i){j("","error");return}let L=i;if(C==="paginated"&&g>1){const B=(S-1)*x,W=Math.min(B+x,i.length);L=i.substring(B,W)}navigator.clipboard.writeText(L).then(()=>{C==="paginated"&&g>1?j(`  ${S}/${g} `,"success"):j(" ","success")}).catch(()=>{j("","error")})},_=()=>{if(!i){j("","error");return}const L=new Date().toISOString().replace(/[:.]/g,"-"),B=`save_${n}_${L}.txt`;sC(i,B),j(" ","success")},I=async L=>{var W;const B=(W=L.target.files)==null?void 0:W[0];if(B)try{const z=await oC(B);d(z),j(" ","success")}catch(z){console.error(":",z),j("","error")}},k=async()=>{try{const L=await navigator.clipboard.readText();d(L),j(" ","success")}catch(L){console.error(":",L),j("","error")}},T=()=>{var L,B;if(!l.trim()){j("","error");return}try{console.log(" ..."),console.log(":",l.trim().length),console.log(":",l.trim().substring(0,30));const W=rC(l.trim());if(!W){console.error(" "),j(` 

 
  (F12) 
 
 `,"error");return}const z=`
${((L=W.player)==null?void 0:L.name)||""}
${((B=W.player)==null?void 0:B.cultivation)||0}`;window.showConfirm&&window.showConfirm(z,()=>{t&&t(null,W),j(" ","success"),d("")})}catch(W){console.error(":",W),j(" : "+W.message,"error")}},N={container:{padding:"20px",background:"linear-gradient(135deg, rgba(76, 175, 80, 0.1) 0%, rgba(76, 175, 80, 0.05) 100%)",borderRadius:"8px",border:"1px solid rgba(76, 175, 80, 0.3)"},tabButtons:{display:"flex",gap:"10px",marginBottom:"20px"},tabButton:L=>({padding:"8px 16px",border:"none",borderRadius:"4px",background:L?"#4caf50":"#ddd",color:L?"white":"#333",cursor:"pointer",fontWeight:"bold",fontSize:"14px",transition:"all 0.3s"}),section:{marginBottom:"20px"},label:{display:"block",marginBottom:"8px",fontWeight:"bold",color:"#333"},input:{width:"100%",padding:"8px 12px",border:"1px solid #ccc",borderRadius:"4px",fontSize:"14px",fontFamily:"monospace",boxSizing:"border-box"},textarea:{width:"100%",minHeight:"150px",padding:"12px",border:"1px solid #ccc",borderRadius:"4px",fontSize:"12px",fontFamily:"monospace",boxSizing:"border-box",background:"#f9f9f9",color:"#333"},button:{padding:"8px 16px",margin:"5px 5px 5px 0",border:"none",borderRadius:"4px",background:"#4caf50",color:"white",cursor:"pointer",fontSize:"14px",fontWeight:"bold",transition:"background 0.3s"},buttonSecondary:{background:"#2196F3"},buttonDanger:{background:"#ff9800"},buttonDisabled:{background:"#ccc",cursor:"not-allowed"},message:{padding:"12px",borderRadius:"4px",marginBottom:"15px",fontSize:"14px",fontWeight:"bold"},messageSuccess:{background:"#c8e6c9",color:"#2e7d32",border:"1px solid #81c784"},messageError:{background:"#ffcdd2",color:"#c62828",border:"1px solid #ef5350"},messageInfo:{background:"#bbdefb",color:"#1565c0",border:"1px solid #64b5f6"},passwordContainer:{display:"flex",gap:"10px",alignItems:"center"},passwordInput:{flex:1},checkbox:{width:"18px",height:"18px",cursor:"pointer"},info:{fontSize:"12px",color:"#666",marginTop:"8px",padding:"8px",background:"#f0f0f0",borderRadius:"4px",borderLeft:"3px solid #2196F3"},fileInput:{display:"none"},fileInputLabel:{padding:"8px 16px",background:"#2196F3",color:"white",borderRadius:"4px",cursor:"pointer",fontSize:"14px",fontWeight:"bold",display:"inline-block",transition:"background 0.3s"}},K=()=>{const L=N.message;return c==="success"?{...L,...N.messageSuccess}:c==="error"?{...L,...N.messageError}:{...L,...N.messageInfo}};return r.jsxs("div",{style:N.container,children:[r.jsx("h3",{style:{marginTop:0,color:"#2e7d32"},children:" /"}),r.jsxs("div",{style:N.tabButtons,children:[r.jsx("button",{style:N.tabButton(s==="export"),onClick:()=>o("export"),children:" "}),r.jsx("button",{style:N.tabButton(s==="import"),onClick:()=>o("import"),children:" "})]}),u&&r.jsx("div",{style:K(),children:u}),s==="export"&&r.jsxs("div",{children:[r.jsx("div",{style:N.section,children:r.jsx("button",{style:N.button,onClick:R,children:" "})}),i&&r.jsxs("div",{style:N.section,children:[r.jsxs("label",{style:N.label,children:[" ",r.jsxs("span",{style:{marginLeft:"10px",color:"#2196F3",fontSize:"13px",fontWeight:"normal"},children:[": ",i.length.toLocaleString()]})]}),r.jsxs("div",{style:{marginBottom:"12px",padding:"10px",background:g>1?"#fff3e0":"#f5f5f5",borderRadius:"4px",border:g>1?"1px solid #ffe0b2":"1px solid #ddd"},children:[r.jsx("div",{style:{marginBottom:"8px",fontWeight:"bold",color:g>1?"#e65100":"#666"},children:g>1?" ":"  ("+i.length+")"}),r.jsxs("div",{style:{display:"flex",gap:"10px",alignItems:"center",flexWrap:"wrap"},children:[r.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"5px",cursor:"pointer"},children:[r.jsx("input",{type:"radio",name:"copyMode",value:"whole",checked:C==="whole",onChange:L=>w(L.target.value),style:{cursor:"pointer"}}),r.jsxs("span",{children:[" ",g===1?"()":"()"]})]}),r.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"5px",cursor:"pointer"},children:[r.jsx("input",{type:"radio",name:"copyMode",value:"paginated",checked:C==="paginated",onChange:L=>w(L.target.value),style:{cursor:"pointer"}}),r.jsxs("span",{children:[" ",g>1?"()":"()"]})]})]})]}),C==="paginated"&&g>1&&r.jsxs("div",{style:{marginBottom:"12px",padding:"10px",background:"#e3f2fd",borderRadius:"4px",border:"1px solid #bbdefb"},children:[r.jsxs("div",{style:{marginBottom:"8px",fontWeight:"bold",color:"#1565c0"},children:["  ",S,"/",g]}),r.jsxs("div",{style:{display:"flex",gap:"8px",alignItems:"center",flexWrap:"wrap"},children:[r.jsx("button",{style:{...N.button,...N.buttonSecondary,opacity:S===1?.5:1,cursor:S===1?"not-allowed":"pointer"},onClick:()=>h(Math.max(1,S-1)),disabled:S===1,children:" "}),r.jsx("select",{value:S,onChange:L=>h(parseInt(L.target.value)),style:{padding:"6px 10px",border:"1px solid #ccc",borderRadius:"4px",fontSize:"14px",cursor:"pointer"},children:Array.from({length:g},(L,B)=>r.jsxs("option",{value:B+1,children:[" ",B+1," "]},B+1))}),r.jsx("button",{style:{...N.button,...N.buttonSecondary,opacity:S===g?.5:1,cursor:S===g?"not-allowed":"pointer"},onClick:()=>h(Math.min(g,S+1)),disabled:S===g,children:" "})]}),r.jsx("div",{style:{fontSize:"12px",color:"#666",marginTop:"8px"},children:" "})]}),r.jsx("textarea",{value:C==="paginated"&&g>1?i.substring((S-1)*x,Math.min(S*x,i.length)):i,readOnly:!0,style:N.textarea}),r.jsxs("div",{style:{marginTop:"10px"},children:[r.jsxs("button",{style:N.button,onClick:b,children:[" ",C==="paginated"&&g>1?` ${S} `:""]}),r.jsx("button",{style:{...N.button,...N.buttonSecondary},onClick:_,children:" "})]}),r.jsxs("div",{style:N.info,children:[" ",g>1&&r.jsxs(r.Fragment,{children:[r.jsx("br",{}),"  ",g,' ""']})]})]})]}),s==="import"&&r.jsxs("div",{children:[r.jsxs("div",{style:N.section,children:[r.jsx("label",{style:N.label,children:" "}),r.jsx("input",{type:"file",accept:".txt,.json",onChange:I,style:N.fileInput,id:"saveFileInput"}),r.jsx("label",{htmlFor:"saveFileInput",style:N.fileInputLabel,children:" "}),r.jsx("button",{style:{...N.button,...N.buttonSecondary,marginLeft:"10px"},onClick:k,children:" "})]}),r.jsxs("div",{style:N.section,children:[r.jsx("label",{style:N.label,children:" "}),r.jsx("textarea",{value:l,onChange:L=>d(L.target.value),placeholder:"...",style:N.textarea})]}),r.jsxs("div",{style:N.section,children:[r.jsx("button",{style:N.button,onClick:T,children:" "}),r.jsx("button",{style:{...N.button,...N.buttonDanger},onClick:()=>{d("")},children:" "})]}),r.jsx("div",{style:N.info,children:" "})]})]})},aC=({player:e,onSave:t,onLoad:n,onReset:s,onOpenGuide:o,autoAssignEnabled:i=!1,onToggleAutoAssign:a,autoSkipSpiritTest:l=!1,onToggleAutoSkip:d,skipChildGiftPopups:u=!1,onToggleSkipChildGiftPopups:p,skipShuraFieldEvents:c=!1,onToggleSkipShuraFieldEvents:f,skipRomanceGiftPopups:x=!1,onToggleSkipRomanceGiftPopups:C,skipJealousyPopups:w=!1,onToggleSkipJealousyPopups:S,skipZhaozhou:h=!1,onToggleSkipZhaozhou:g,isPortraitViewport:v=!0,isOrientationFixApplied:j=!1,onRequestPortraitFix:R=()=>{},onReleasePortraitFix:b=()=>{},onAutoAssignSpouses:_=()=>{},onRedeemCode:I=null,gameState:k=null})=>{const[T,N]=y.useState([]),[K,L]=y.useState([]),[B,W]=y.useState({used:"0",usedMB:"0"}),[z,ne]=y.useState({enabled:!1,syncing:!1}),[Q,se]=y.useState([]),[ye,Me]=y.useState(!1),[Pe,Ke]=y.useState(""),[q,de]=y.useState(""),[Z,re]=y.useState(""),[ce,le]=y.useState(!1),[we,Ue]=y.useState(null),[Oe,ze]=y.useState(!0),[D,me]=y.useState(!0),[xe,ke]=y.useState(!0),[Ee,Xe]=y.useState(!0),[Mt,pn]=y.useState(!0),[fn,en]=y.useState(!1),[qr,Kr]=y.useState(null),[co,fr]=y.useState(!1),[Qr,mn]=y.useState(!1),[tn,Qc]=y.useState(!1),[mr,Na]=y.useState(!1),[uo,Is]=y.useState(!1),[li,Be]=y.useState(!1),[tr,Jc]=y.useState(!1),[nn,nr]=y.useState(!1),[Rs,Xc]=y.useState(!1),[_s,Zc]=y.useState(!1),[La,Hf]=y.useState(null),[Ms,$a]=y.useState(""),[Jr,As]=y.useState(null),Xr=[{key:"autoAssign",label:"",brief:"12",detail:["","1)  12 ","2) ","3) "].join(`
`),checked:!!i,onChange:a},{key:"autoSpirit",label:"",brief:"",detail:["","1) ","2) ","3) "].join(`
`),checked:!!l,onChange:d},{key:"skipGiftModal",label:"",brief:"",detail:["","1) ","2) ","3) "].join(`
`),checked:!!u,onChange:p},{key:"skipZhaozhou",label:"",brief:"",detail:["","1) ",'2) ""',"3) "].join(`
`),checked:!!h,onChange:g}],po=[i?"":"",l?"":"",u?"":"",h?"":""].join("  "),ed=[{key:"skipShura",label:"",brief:"",detail:["","1) ","2) ","3) "].join(`
`),checked:!!c,onChange:f},{key:"skipRomanceGift",label:"",brief:"NPC ",detail:["","1) ","2) ","3) "].join(`
`),checked:!!x,onChange:C},{key:"skipJealousy",label:"",brief:"",detail:["","1) ","2) ","3) "].join(`
`),checked:!!w,onChange:S}],td=[c?"":"",x?"":"",w?"":""].join("  "),nd=G=>{Kr(Fe=>Fe===G?null:G)},rd=G=>{Hf(Fe=>Fe===G?null:G)},Ba=()=>{if(typeof I!="function"){As({success:!1,message:""});return}const G=I(Ms);G!=null&&G.success&&$a(""),As(G||{success:!1,message:""})},ci=T.filter(G=>G.exists).length,di=K.filter(G=>G.exists).length,Ns=`${Pe?"API Key ":"API Key "}   ${Z||""}`,sd=Oe?"":"",ui=`${D?"AI":""}  ${xe?"":""}  ${Ee?"":""}`,pi=Mt?"AI ":"",od=` ${ci}    ${di}   ${B.usedMB} MB`,Oa="",Pa=`${v?"":""}  ${j?"":""}`;y.useEffect(()=>{Tr(),$s(),ld(),ad(),Bs(),id();const G=Fe=>{console.log(""),$s(),Bs()};window.addEventListener("autoSaveCompleted",G);try{const Fe="__test__";localStorage.setItem(Fe,"test"),localStorage.removeItem(Fe)}catch(Fe){console.error("localStorage :",Fe),window.showResult&&window.showResult("",` 


1. 
2. 
3. 

`,!1,null,!1)}return()=>{window.removeEventListener("autoSaveCompleted",G)}},[]),y.useEffect(()=>{uo&&(console.log(""),Tr(),$s(),Bs())},[uo]);const id=()=>{const G=i1();ne(G),G.enabled&&Ls()},Ls=async()=>{try{Me(!0);const G=await Kb();se(G)}catch(G){console.error(":",G)}finally{Me(!1)}},Tr=()=>{try{const G=Pf();console.log(":",G),N(G),Bs()}catch(G){console.error(":",G),N([{slot:1,exists:!1},{slot:2,exists:!1},{slot:3,exists:!1}])}},$s=()=>{try{const G=t1();console.log(":",G),L(G)}catch(G){console.error(":",G),L([])}},Bs=()=>{const G=Qy();W(G)},ad=()=>{const G=localStorage.getItem("enableGazette"),Fe=localStorage.getItem("useAIForLetter"),rn=localStorage.getItem("useAIForTianjiProfile"),gn=localStorage.getItem("acceptChildLetters"),rr=localStorage.getItem("acceptLoverLetters");ze(G!=="false"),me(Fe!=="false"),pn(rn!=="false"),ke(gn!=="false"),Xe(rr!=="false")},Zr=()=>{localStorage.setItem("enableGazette",Oe.toString()),localStorage.setItem("useAIForLetter",D.toString()),localStorage.setItem("useAIForTianjiProfile",Mt.toString()),localStorage.setItem("acceptChildLetters",xe.toString()),localStorage.setItem("acceptLoverLetters",Ee.toString()),window.showResult&&window.showResult("","",!0,null,!1)},ld=()=>{const G=localStorage.getItem("game_api_key")||"",Fe=localStorage.getItem("game_api_url")||"https://api.deepseek.com/chat/completions",rn=localStorage.getItem("game_api_model")||"deepseek-chat";Ke(G),de(Fe),re(rn)},cd=()=>{localStorage.setItem("game_api_key",Pe),localStorage.setItem("game_api_url",q),localStorage.setItem("game_api_model",Z),window.showResult&&window.showResult("AI ","AI ",!0,null,!1),Ue(null)},za=async()=>{if(!Pe||!q){window.showResult&&window.showResult(""," API Key  URL",!1,null,!1);return}le(!0),Ue(null);try{const G=await BE(Pe,q);Ue(G?{success:!0,message:" API "}:{success:!1,message:" "})}catch(G){Ue({success:!1,message:` : ${G.message}`})}finally{le(!1)}},Da=G=>{const Fe=t(G);window.showResult&&(Fe.success?(window.showResult("",` : ${G}
: ${Fe.time}
: ${Fe.size} KB`,!0,null,!1),Tr()):Fe.error==="QUOTA_EXCEEDED"?window.showResult("",` 


1. 
2. 
3. 

: ${Fe.size||""} KB`,!1,null,!1):Fe.error==="STORAGE_TOO_LARGE"?window.showResult("",` ${Fe.size} KB



`,!1,null,!1):window.showResult("",` 

: ${Fe.error||""}
: ${Fe.message||""}


1. 
2. 
3. `,!1,null,!1))},Fa=G=>{window.showConfirm&&window.showConfirm(` ${G} `,()=>n(G))},dd=G=>{window.showConfirm&&window.showConfirm(` ${G} `,()=>{Zy(G),Tr(),window.showResult&&window.showResult("",` ${G} `,!0,null,!1)})},fo=(G=1)=>{try{if(!k){window.showResult&&window.showResult(""," ",!1,null,!1);return}const Fe=JSON.stringify(k).length/1024,rn=ah(k),gn=Qb(k,rn),rr=JSON.stringify(rn).length/1024;console.log(" :",gn),console.log(` : ${Fe.toFixed(2)} KB -> ${rr.toFixed(2)} KB ( ${(Fe-rr).toFixed(2)} KB)`);const Os=t(G,rn);if(Os&&Os.success){const go=` 

:
- :  ${gn.mainLogsRemoved}  ${gn.mainLogsKept} 
- NPC:  ${gn.npcLogsRemoved}  ${gn.npcLogsKept} 
- : ${gn.totalRemoved} 

: ${rr.toFixed(2)} KB
: ${(Fe-rr).toFixed(2)} KB`;window.showResult&&window.showResult("",go,!0,null,!1),Tr(),Bs()}else window.showResult&&window.showResult("",` 
${(Os==null?void 0:Os.message)||""}`,!1,null,!1)}catch(Fe){console.error(":",Fe),window.showResult&&window.showResult("",` : ${Fe.message}`,!1,null,!1)}},ud=G=>{window.showConfirm&&window.showConfirm(` ${G} `,()=>{try{const Fe=n1(G);Fe?(n(null,Fe),window.showResult&&window.showResult("",`  ${G} 
: ${Fe.gameTime||""}`,!0,null,!1)):window.showResult&&window.showResult(""," ",!1,null,!1)}catch(Fe){console.error(":",Fe),window.showResult&&window.showResult(""," "+Fe.message,!1,null,!1)}})},fi=()=>{window.showConfirm&&window.showConfirm(`

`,()=>{r1(),$s(),window.showResult&&window.showResult(""," ",!0,null,!1)})},pd=()=>{window.showConfirm&&window.showConfirm(" ",()=>{s(),Tr()})},mo=async G=>{if(!z.enabled){window.showResult&&window.showResult("",` 
 TapTap `,!1,null,!1);return}window.showConfirm&&window.showConfirm(` ${G} `,async()=>{try{Me(!0);const Fe=await s1(G);window.showResult&&window.showResult("",` 

: ${Fe.action==="create"?"":""}
UUID: ${Fe.uuid}`,!0,null,!1),await Ls()}catch(Fe){window.showResult&&window.showResult("",` 

${Fe.message}


 65
 
 5MB`,!1,null,!1)}finally{Me(!1)}})},Ha=async G=>{if(!z.enabled){window.showResult&&window.showResult("",` 
 TapTap `,!1,null,!1);return}window.showConfirm&&window.showConfirm(` ${G} `,async()=>{var Fe,rn;try{Me(!0);const gn=await o1(G);window.showResult&&window.showResult("",` 

: ${((Fe=gn.player)==null?void 0:Fe.name)||""}
: ${((rn=gn.player)==null?void 0:rn.cultivation)||0} `,!0,null,!1),Tr()}catch(gn){window.showResult&&window.showResult("",` 

${gn.message}`,!1,null,!1)}finally{Me(!1)}})};return r.jsxs("div",{style:{padding:"20px"},children:[r.jsx("h3",{style:{borderBottom:"1px solid #ccc",paddingBottom:"10px"},children:" "}),r.jsxs("div",{style:U.collapsibleCard,children:[r.jsxs("button",{type:"button",style:U.collapsibleHeader,onClick:()=>en(G=>!G),children:[r.jsxs("div",{style:U.collapsibleTitleRow,children:[r.jsx("span",{children:" "}),r.jsx("span",{style:U.collapsibleHint,children:fn?"":""})]}),r.jsxs("div",{style:U.collapsibleSummary,children:["",po]})]}),fn&&r.jsxs("div",{style:U.collapseBody,children:[r.jsx("p",{style:{...U.info,marginBottom:"10px"},children:""}),r.jsx("div",{style:U.optionGroup,children:Xr.map(G=>r.jsxs("div",{style:U.optionCard,children:[r.jsxs("div",{style:U.optionRow,children:[r.jsxs("label",{style:U.optionToggle,children:[r.jsx("input",{type:"checkbox",checked:G.checked,onChange:Fe=>G.onChange&&G.onChange(Fe.target.checked)}),r.jsx("span",{children:G.checked?"":""})]}),r.jsxs("button",{type:"button",style:U.optionText,onClick:()=>nd(G.key),children:[r.jsxs("div",{style:U.optionTitleRow,children:[r.jsx("span",{children:G.label}),r.jsx("span",{style:U.detailHint,children:qr===G.key?"":""})]}),r.jsx("div",{style:U.optionBrief,children:G.brief})]})]}),qr===G.key&&r.jsx("div",{style:U.optionDetail,children:G.detail})]},G.key))}),r.jsxs("div",{style:U.familyActionCard,children:[r.jsxs("div",{style:U.familyActionHeader,children:[r.jsx("span",{children:" "}),r.jsx("span",{style:{fontSize:"11px",color:"#8d6e63"},children:""})]}),r.jsx("p",{style:U.familyActionDesc,children:" 500 "}),r.jsx("button",{type:"button",style:U.familyActionBtn,onClick:()=>_&&_(),children:" "}),r.jsx("small",{style:U.hint,children:""})]})]})]}),r.jsxs("div",{style:U.collapsibleCard,children:[r.jsxs("button",{type:"button",style:U.collapsibleHeader,onClick:()=>Zc(G=>!G),children:[r.jsxs("div",{style:U.collapsibleTitleRow,children:[r.jsx("span",{children:" "}),r.jsx("span",{style:U.collapsibleHint,children:_s?"":""})]}),r.jsxs("div",{style:U.collapsibleSummary,children:["",td]})]}),_s&&r.jsxs("div",{style:U.collapseBody,children:[r.jsx("p",{style:{...U.info,marginBottom:"10px"},children:""}),r.jsx("div",{style:U.optionGroup,children:ed.map(G=>r.jsxs("div",{style:U.optionCard,children:[r.jsxs("div",{style:U.optionRow,children:[r.jsxs("label",{style:U.optionToggle,children:[r.jsx("input",{type:"checkbox",checked:G.checked,onChange:Fe=>G.onChange&&G.onChange(Fe.target.checked)}),r.jsx("span",{children:G.checked?"":""})]}),r.jsxs("button",{type:"button",style:U.optionText,onClick:()=>rd(G.key),children:[r.jsxs("div",{style:U.optionTitleRow,children:[r.jsx("span",{children:G.label}),r.jsx("span",{style:U.detailHint,children:La===G.key?"":""})]}),r.jsx("div",{style:U.optionBrief,children:G.brief})]})]}),La===G.key&&r.jsx("div",{style:U.optionDetail,children:G.detail})]},G.key))})]})]}),r.jsxs("div",{style:U.collapsibleCard,children:[r.jsxs("button",{type:"button",style:U.collapsibleHeader,onClick:()=>Xc(G=>!G),children:[r.jsxs("div",{style:U.collapsibleTitleRow,children:[r.jsx("span",{children:" "}),r.jsx("span",{style:U.collapsibleHint,children:Rs?"":""})]}),r.jsx("div",{style:U.collapsibleSummary,children:Pa})]}),Rs&&r.jsxs("div",{style:U.collapseBody,children:[r.jsx("p",{style:U.info,children:" UI "}),r.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"10px"},children:[r.jsx("button",{onClick:R,style:{...U.saveBtn,width:"100%"},children:" "}),r.jsx("button",{onClick:b,style:{...U.btn,width:"100%",border:"1px solid #d32f2f",color:"#d32f2f"},disabled:!j,children:" "})]}),r.jsx("small",{style:U.hint,children:""})]})]}),r.jsxs("div",{style:U.collapsibleCard,children:[r.jsxs("button",{type:"button",style:U.collapsibleHeader,onClick:()=>fr(G=>!G),children:[r.jsxs("div",{style:U.collapsibleTitleRow,children:[r.jsx("span",{children:" AI "}),r.jsx("span",{style:U.collapsibleHint,children:co?"":""})]}),r.jsx("div",{style:U.collapsibleSummary,children:Ns})]}),co&&r.jsxs("div",{style:U.collapseBody,children:[r.jsxs("p",{style:U.info,children:[" API NPC ",r.jsx("br",{}),r.jsx("small",{style:{color:"#999"},children:" DeepSeek "})]}),r.jsxs("div",{style:U.formGroup,children:[r.jsx("label",{style:U.label,children:":"}),r.jsxs("select",{onChange:G=>{G.target.value==="deepseek"&&(de("https://api.deepseek.com/chat/completions"),re("deepseek-chat")),G.target.value=""},style:U.select,children:[r.jsx("option",{value:"",children:"..."}),r.jsx("option",{value:"deepseek",children:" DeepSeek"})]}),r.jsx("small",{style:U.hint,children:" URL  API Key"})]}),r.jsxs("div",{style:U.formGroup,children:[r.jsx("label",{style:U.label,children:"API Key:"}),r.jsx("input",{type:"password",value:Pe,onChange:G=>Ke(G.target.value),placeholder:"sk-xxxxxxxxxxxxxxxx",style:U.input}),r.jsxs("small",{style:U.hint,children:[" Key:",r.jsx("a",{href:"https://platform.deepseek.com/",target:"_blank",rel:"noopener",children:" DeepSeek"})]})]}),r.jsxs("div",{style:U.formGroup,children:[r.jsx("label",{style:U.label,children:"API URL:"}),r.jsx("input",{type:"text",value:q,onChange:G=>de(G.target.value),placeholder:"https://api.deepseek.com/chat/completions",style:U.input}),r.jsx("small",{style:U.hint,children:"DeepSeek: https://api.deepseek.com/chat/completions"})]}),r.jsxs("div",{style:U.formGroup,children:[r.jsx("label",{style:U.label,children:":"}),r.jsx("input",{type:"text",value:Z,onChange:G=>re(G.target.value),placeholder:"deepseek-chat",style:U.input}),r.jsx("small",{style:U.hint,children:"DeepSeek: deepseek-chat"})]}),we&&r.jsx("div",{style:{...U.statusBox,background:we.success?"#e8f5e9":"#ffebee",color:we.success?"#2e7d32":"#c62828"},children:we.message}),r.jsxs("div",{style:U.btnGroup,children:[r.jsx("button",{onClick:cd,style:U.saveBtn,children:" "}),r.jsx("button",{onClick:za,style:{...U.btn,background:"#2196f3",color:"white",border:"none"},disabled:ce,children:ce?"...":" "})]})]})]}),r.jsxs("div",{style:U.collapsibleCard,children:[r.jsxs("button",{type:"button",style:U.collapsibleHeader,onClick:()=>mn(G=>!G),children:[r.jsxs("div",{style:U.collapsibleTitleRow,children:[r.jsx("span",{children:" "}),r.jsx("span",{style:U.collapsibleHint,children:Qr?"":""})]}),r.jsx("div",{style:U.collapsibleSummary,children:sd})]}),Qr&&r.jsxs("div",{style:U.collapseBody,children:[r.jsxs("p",{style:U.info,children:["NPC",r.jsx("br",{}),r.jsx("small",{style:{color:"#999"},children:""})]}),r.jsxs("div",{style:U.formGroup,children:[r.jsxs("label",{style:U.checkboxLabel,children:[r.jsx("input",{type:"checkbox",checked:Oe,onChange:G=>ze(G.target.checked),style:U.checkbox}),r.jsx("span",{children:""})]}),r.jsx("small",{style:U.hint,children:""})]}),r.jsx("button",{onClick:Zr,style:U.saveBtn,children:" "})]})]}),r.jsxs("div",{style:U.collapsibleCard,children:[r.jsxs("button",{type:"button",style:U.collapsibleHeader,onClick:()=>Qc(G=>!G),children:[r.jsxs("div",{style:U.collapsibleTitleRow,children:[r.jsx("span",{children:" "}),r.jsx("span",{style:U.collapsibleHint,children:tn?"":""})]}),r.jsx("div",{style:U.collapsibleSummary,children:ui})]}),tn&&r.jsxs("div",{style:U.collapseBody,children:[r.jsxs("p",{style:U.info,children:["NPC",r.jsx("br",{}),r.jsx("small",{style:{color:"#999"},children:"AI"})]}),r.jsxs("div",{style:U.formGroup,children:[r.jsxs("label",{style:U.checkboxLabel,children:[r.jsx("input",{type:"checkbox",checked:D,onChange:G=>me(G.target.checked),style:U.checkbox}),r.jsx("span",{children:"AI"})]}),r.jsx("small",{style:U.hint,children:"API Key"})]}),r.jsxs("div",{style:U.formGroup,children:[r.jsxs("label",{style:U.checkboxLabel,children:[r.jsx("input",{type:"checkbox",checked:xe,onChange:G=>ke(G.target.checked),style:U.checkbox}),r.jsx("span",{children:""})]}),r.jsx("small",{style:U.hint,children:""})]}),r.jsxs("div",{style:U.formGroup,children:[r.jsxs("label",{style:U.checkboxLabel,children:[r.jsx("input",{type:"checkbox",checked:Ee,onChange:G=>Xe(G.target.checked),style:U.checkbox}),r.jsx("span",{children:""})]}),r.jsx("small",{style:U.hint,children:""})]}),r.jsx("button",{onClick:Zr,style:U.saveBtn,children:" "})]})]}),r.jsxs("div",{style:U.collapsibleCard,children:[r.jsxs("button",{type:"button",style:U.collapsibleHeader,onClick:()=>Na(G=>!G),children:[r.jsxs("div",{style:U.collapsibleTitleRow,children:[r.jsx("span",{children:" "}),r.jsx("span",{style:U.collapsibleHint,children:mr?"":""})]}),r.jsx("div",{style:U.collapsibleSummary,children:pi})]}),mr&&r.jsxs("div",{style:U.collapseBody,children:[r.jsxs("p",{style:U.info,children:[" AI ",r.jsx("br",{}),r.jsx("small",{style:{color:"#999"},children:""}),r.jsx("br",{}),r.jsx("small",{style:{color:"#999"},children:"/ AI "})]}),r.jsxs("div",{style:U.formGroup,children:[r.jsxs("label",{style:U.checkboxLabel,children:[r.jsx("input",{type:"checkbox",checked:Mt,onChange:G=>pn(G.target.checked),style:U.checkbox}),r.jsx("span",{children:" AI "})]}),r.jsx("small",{style:U.hint,children:" API Key"})]}),r.jsx("button",{onClick:Zr,style:U.saveBtn,children:" "})]})]}),r.jsxs("div",{style:U.collapsibleCard,children:[r.jsxs("button",{type:"button",style:U.collapsibleHeader,onClick:()=>Is(G=>!G),children:[r.jsxs("div",{style:U.collapsibleTitleRow,children:[r.jsx("span",{children:" "}),r.jsx("span",{style:U.collapsibleHint,children:uo?"":""})]}),r.jsx("div",{style:U.collapsibleSummary,children:od})]}),uo&&r.jsxs("div",{style:U.collapseBody,children:[r.jsxs("p",{style:U.info,children:["",z.enabled&&r.jsx("span",{style:{color:"#4caf50",fontWeight:"bold"},children:"  "})]}),r.jsxs("div",{style:{background:"linear-gradient(135deg, #667eea 0%, #764ba2 100%)",borderRadius:"8px",padding:"15px",marginBottom:"20px",color:"white"},children:[r.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"10px"},children:[r.jsx("h5",{style:{margin:0,fontSize:"16px"},children:" 3"}),K.some(G=>G.exists)&&r.jsx("button",{onClick:fi,style:{background:"rgba(255,255,255,0.2)",border:"1px solid rgba(255,255,255,0.3)",color:"white",padding:"4px 10px",borderRadius:"4px",fontSize:"11px",cursor:"pointer"},children:" "})]}),r.jsx("p",{style:{fontSize:"12px",margin:"0 0 15px 0",opacity:.9},children:" 3"}),K.length===0?r.jsx("div",{style:{background:"rgba(255,255,255,0.1)",borderRadius:"5px",padding:"15px",textAlign:"center",fontSize:"13px"},children:""}):r.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"10px"},children:[K.filter(G=>G.exists).map(G=>r.jsxs("div",{style:{background:"rgba(255,255,255,0.15)",borderRadius:"6px",padding:"12px",backdropFilter:"blur(10px)"},children:[r.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"8px"},children:[r.jsxs("div",{style:{fontSize:"13px",fontWeight:"bold"},children:["#",G.slot," - ",G.gameTime||""]}),r.jsx("div",{style:{background:"rgba(76, 175, 80, 0.8)",padding:"2px 8px",borderRadius:"10px",fontSize:"11px"},children:G.tier||""})]}),r.jsxs("div",{style:{fontSize:"11px",opacity:.9,marginBottom:"8px"},children:[r.jsxs("div",{children:[": ",G.playerName||""," | : ",G.cultivation||0," | : ",G.age||0,""]}),r.jsxs("div",{children:[": ",G.saveDate||""]})]}),r.jsx("button",{onClick:()=>ud(G.slot),style:{background:"rgba(33, 150, 243, 0.9)",border:"none",color:"white",padding:"6px 15px",borderRadius:"4px",fontSize:"12px",cursor:"pointer",width:"100%",fontWeight:"bold"},children:" "})]},G.slot)),K.filter(G=>G.exists).length===0&&r.jsx("div",{style:{background:"rgba(255,255,255,0.1)",borderRadius:"5px",padding:"15px",textAlign:"center",fontSize:"13px"},children:""})]})]}),r.jsxs("div",{style:{background:"#fff3cd",border:"1px solid #ffc107",borderRadius:"8px",padding:"12px",marginBottom:"15px"},children:[r.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"10px"},children:[r.jsx("div",{style:{fontSize:"14px",fontWeight:"bold",color:"#856404"},children:" "}),r.jsx("span",{style:{fontSize:"11px",color:"#856404",opacity:.8},children:"3+"})]}),r.jsxs("div",{style:{fontSize:"12px",color:"#856404",marginBottom:"10px",lineHeight:"1.5"},children:[" 3",r.jsx("br",{}),' ""',r.jsx("br",{})," ",r.jsx("br",{})," NPC"]}),r.jsx("button",{onClick:()=>{window.showConfirm&&window.showConfirm(`

- 3
- 
- 

""`,()=>{fo()})},style:{background:"#ffc107",border:"none",color:"#000",padding:"8px 16px",borderRadius:"4px",fontSize:"13px",fontWeight:"bold",cursor:"pointer",width:"100%"},children:" "})]}),z.enabled&&r.jsxs("div",{style:{background:"#e8f5e9",border:"1px solid #4caf50",borderRadius:"5px",padding:"10px",marginBottom:"15px",fontSize:"12px"},children:[r.jsx("div",{style:{fontWeight:"bold",marginBottom:"5px",color:"#2e7d32"},children:" TapTap "}),r.jsxs("div",{style:{color:"#555"},children:[" ",r.jsx("br",{})," ",r.jsx("br",{})," ",r.jsx("br",{})," 1/"]}),z.syncing&&r.jsx("div",{style:{marginTop:"8px",color:"#ff9800"},children:" ..."})]}),r.jsxs("div",{style:{background:"#f5f5f5",padding:"10px",borderRadius:"5px",marginBottom:"15px",fontSize:"12px"},children:[r.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:"5px"},children:[r.jsx("span",{children:" :"}),r.jsxs("span",{children:[r.jsxs("strong",{children:[B.usedMB," MB"]})," / 100 MB"]})]}),r.jsx("div",{style:{height:"8px",background:"#ddd",borderRadius:"4px",overflow:"hidden"},children:r.jsx("div",{style:{height:"100%",background:B.usedMB>80?"#f44336":B.usedMB>60?"#ff9800":"#4caf50",width:`${Math.min(B.usedMB/100*100,100)}%`,transition:"width 0.3s"}})}),B.usedMB>80&&r.jsx("div",{style:{color:"#f44336",marginTop:"5px",fontSize:"11px"},children:" "})]}),r.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"15px"},children:T.length===0?r.jsx("div",{style:{padding:"20px",textAlign:"center",color:"#999",background:"#f5f5f5",borderRadius:"5px"},children:"..."}):T.map(G=>r.jsxs("div",{style:U.slotCard,children:[r.jsxs("div",{style:U.slotHeader,children:[r.jsxs("span",{style:U.slotTitle,children:[" ",G.slot]}),G.exists&&r.jsx("span",{style:U.slotBadge,children:""})]}),G.exists?r.jsxs("div",{style:U.slotInfo,children:[r.jsxs("div",{style:{fontSize:"12px",color:"#666",marginBottom:"8px"},children:[r.jsxs("div",{children:[": ",G.playerName]}),G.cultivation>0&&r.jsxs("div",{children:[": ",G.cultivation," "]}),r.jsxs("div",{children:[": ",G.saveDate]})]}),r.jsxs("div",{style:{...U.btnGroup,gap:"8px",flexWrap:"wrap"},children:[r.jsx("button",{onClick:()=>Da(G.slot),style:{...U.slotBtn,background:"#4caf50",color:"white"},children:" "}),r.jsx("button",{onClick:()=>Fa(G.slot),style:{...U.slotBtn,background:"#2196f3",color:"white"},children:" "}),r.jsx("button",{onClick:()=>dd(G.slot),style:{...U.slotBtn,background:"#f44336",color:"white"},children:" "}),z.enabled&&r.jsxs(r.Fragment,{children:[r.jsx("button",{onClick:()=>mo(G.slot),style:{...U.slotBtn,background:"#ff9800",color:"white"},disabled:ye,children:" "}),r.jsx("button",{onClick:()=>Ha(G.slot),style:{...U.slotBtn,background:"#9c27b0",color:"white"},disabled:ye,children:" "})]})]})]}):r.jsxs("div",{style:U.slotInfo,children:[r.jsx("div",{style:{fontSize:"13px",color:"#999",marginBottom:"10px"},children:""}),r.jsxs("div",{style:{...U.btnGroup,gap:"8px"},children:[r.jsx("button",{onClick:()=>Da(G.slot),style:{...U.slotBtn,background:"#4caf50",color:"white",flex:1},children:" "}),z.enabled&&r.jsx("button",{onClick:()=>Ha(G.slot),style:{...U.slotBtn,background:"#9c27b0",color:"white",flex:1},disabled:ye,children:" "})]})]})]},G.slot))})]})]}),r.jsxs("div",{style:U.collapsibleCard,children:[r.jsxs("button",{type:"button",style:U.collapsibleHeader,onClick:()=>Be(G=>!G),children:[r.jsxs("div",{style:U.collapsibleTitleRow,children:[r.jsx("span",{children:" /"}),r.jsx("span",{style:U.collapsibleHint,children:li?"":""})]}),r.jsx("div",{style:U.collapsibleSummary,children:""})]}),li&&r.jsx("div",{style:U.collapseBody,children:r.jsx(iC,{gameState:k||{player:e,children:[],fallenChildren:[],activeNpcs:[],deadNpcs:[],inventory:[],logs:[],messages:{},lastMessageCheck:{},gameStage:"MAIN",pendingSectChoices:null,testQueue:[],worldEvents:[],newsBuffer:[]},onLoadGame:n,playerName:(e==null?void 0:e.name)||""})})]}),r.jsxs("div",{style:U.collapsibleCard,children:[r.jsxs("button",{type:"button",style:U.collapsibleHeader,onClick:()=>Jc(G=>!G),children:[r.jsxs("div",{style:U.collapsibleTitleRow,children:[r.jsx("span",{children:" "}),r.jsx("span",{style:U.collapsibleHint,children:tr?"":""})]}),r.jsx("div",{style:U.collapsibleSummary,children:""})]}),tr&&r.jsxs("div",{style:U.collapseBody,children:[r.jsxs("div",{style:U.formGroup,children:[r.jsx("label",{style:U.label,children:""}),r.jsx("input",{type:"text",value:Ms,onChange:G=>$a(G.target.value),placeholder:"",style:U.input}),r.jsx("span",{style:U.hint,children:""})]}),r.jsx("button",{onClick:Ba,style:{...U.btn,background:"#ffb74d",color:"#4e342e",border:"none",width:"100%"},children:" "}),Jr&&r.jsx("div",{style:{...U.statusBox,background:Jr.success?"#e8f5e9":"#ffebee",color:Jr.success?"#2e7d32":"#c62828",marginTop:"12px"},children:Jr.message})]})]}),r.jsxs("div",{style:U.collapsibleCard,children:[r.jsxs("button",{type:"button",style:U.collapsibleHeader,onClick:()=>nr(G=>!G),children:[r.jsxs("div",{style:U.collapsibleTitleRow,children:[r.jsx("span",{children:" "}),r.jsx("span",{style:U.collapsibleHint,children:nn?"":""})]}),r.jsx("div",{style:U.collapsibleSummary,children:Oa})]}),nn&&r.jsxs("div",{style:U.collapseBody,children:[r.jsx("p",{style:U.info,children:""}),r.jsx("button",{onClick:o,style:{...U.btn,background:"#2196f3",color:"white",border:"none",width:"100%"},children:" "})]})]}),r.jsxs("div",{style:{...U.card,borderColor:"#d32f2f",background:"#ffebee"},children:[r.jsx("h4",{style:{color:"#d32f2f"},children:" "}),r.jsx("p",{style:{fontSize:"12px",color:"#666"},children:"Bug"}),r.jsx("button",{onClick:pd,style:U.resetBtn,children:" "})]}),r.jsxs("div",{style:{textAlign:"center",marginTop:"30px",color:"#999",fontSize:"12px"},children:[r.jsx("p",{children:": v1.2.0 Alpha"}),r.jsxs("p",{children:["5MB",r.jsx("br",{}),z.enabled?" ":"  TapTap "]}),r.jsxs("p",{style:{marginTop:"8px",fontSize:"11px"},children:[" ",r.jsx("br",{}),"100"]})]})]})},U={card:{background:"white",padding:"15px",borderRadius:"8px",border:"1px solid #ddd",marginBottom:"20px"},info:{marginBottom:"15px",fontSize:"14px",color:"#555"},btnGroup:{display:"flex",gap:"10px"},btn:{flex:1,padding:"10px",cursor:"pointer",borderRadius:"5px",border:"1px solid #ccc",background:"#f5f5f5"},saveBtn:{flex:1,padding:"10px",cursor:"pointer",borderRadius:"5px",border:"none",background:"#4caf50",color:"white",fontWeight:"bold"},resetBtn:{width:"100%",padding:"10px",cursor:"pointer",borderRadius:"5px",border:"none",background:"#d32f2f",color:"white"},formGroup:{marginBottom:"15px"},label:{display:"block",marginBottom:"5px",fontSize:"13px",fontWeight:"bold",color:"#333"},checkboxLabel:{display:"flex",alignItems:"center",gap:"8px",fontSize:"14px",color:"#333",cursor:"pointer"},checkbox:{width:"18px",height:"18px",cursor:"pointer"},input:{width:"100%",padding:"10px",borderRadius:"5px",border:"1px solid #ddd",fontSize:"14px",boxSizing:"border-box"},select:{width:"100%",padding:"10px",borderRadius:"5px",border:"1px solid #ddd",fontSize:"14px",boxSizing:"border-box",cursor:"pointer",background:"white"},hint:{display:"block",marginTop:"5px",fontSize:"11px",color:"#999",lineHeight:"1.4"},statusBox:{padding:"10px",borderRadius:"5px",marginBottom:"15px",fontSize:"13px",fontWeight:"bold"},slotCard:{background:"#f9f9f9",padding:"12px",borderRadius:"6px",border:"1px solid #e0e0e0"},slotHeader:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"10px"},slotTitle:{fontSize:"14px",fontWeight:"bold",color:"#333"},slotBadge:{fontSize:"11px",padding:"3px 8px",borderRadius:"10px",background:"#4caf50",color:"white"},slotInfo:{marginTop:"8px"},slotBtn:{flex:1,padding:"8px",cursor:"pointer",borderRadius:"4px",border:"none",fontSize:"12px",fontWeight:"bold"},collapsibleCard:{background:"white",border:"1px solid #ddd",borderRadius:"10px",marginBottom:"20px",overflow:"hidden",boxShadow:"0 4px 12px rgba(0,0,0,0.04)"},collapsibleHeader:{width:"100%",background:"linear-gradient(120deg, #f5efe6, #fff)",border:"none",padding:"14px",textAlign:"left",cursor:"pointer"},collapsibleTitleRow:{display:"flex",justifyContent:"space-between",alignItems:"center",fontWeight:"bold",color:"#4e342e"},collapsibleHint:{fontSize:"12px",color:"#8d6e63"},collapsibleSummary:{marginTop:"6px",fontSize:"12px",color:"#6d4c41"},collapseBody:{padding:"14px",borderTop:"1px solid #f0e0d6",background:"#fff"},optionGroup:{display:"flex",flexDirection:"column",gap:"8px"},optionCard:{background:"rgba(249, 246, 243, 0.9)",borderRadius:"8px",border:"1px solid #efe0d4",padding:"8px"},optionRow:{display:"flex",gap:"10px",alignItems:"center"},optionToggle:{display:"flex",alignItems:"center",gap:"6px",fontSize:"12px",color:"#5d4037"},optionText:{flex:1,border:"none",background:"transparent",textAlign:"left",padding:0,cursor:"pointer",color:"#4e342e"},optionTitleRow:{display:"flex",justifyContent:"space-between",alignItems:"center",fontSize:"13px",fontWeight:600},detailHint:{fontSize:"12px",color:"#8d6e63"},optionBrief:{fontSize:"11px",color:"#6d4c41",marginTop:"2px"},optionDetail:{marginTop:"6px",padding:"8px",borderRadius:"6px",background:"#fff",border:"1px dashed #e0c5b4",fontSize:"11px",color:"#5d4037",lineHeight:1.5,whiteSpace:"pre-line"},familyActionCard:{marginTop:"12px",padding:"14px",borderRadius:"10px",border:"1px solid #e0c5b4",background:"linear-gradient(135deg, #fff7ec 0%, #fde2cf 100%)"},familyActionHeader:{display:"flex",justifyContent:"space-between",alignItems:"center",fontSize:"13px",fontWeight:600,color:"#4e342e",marginBottom:"6px"},familyActionDesc:{fontSize:"12px",color:"#6d4c41",lineHeight:1.5,margin:"8px 0 12px 0"},familyActionBtn:{width:"100%",padding:"10px",border:"none",borderRadius:"999px",cursor:"pointer",background:"linear-gradient(120deg, #ff9a62, #ff6f3c)",color:"#fff",fontWeight:"bold",fontSize:"14px",boxShadow:"0 4px 10px rgba(255, 111, 60, 0.3)"}},lC=(e,t)=>{var n;if(Hm[t]){const s=Hm[t];e.cultivationMethod=s;const o=((n=vn[s])==null?void 0:n.name)||s;return`${e.name}  ${t}${o}`}return null},Wg=(e,t)=>{const n=vn[t];if(!n)return{success:!1,message:""};const s=e.cultivationMethod,o=vn[s];e.cultivationMethod=t;const i=jf(t,e.spiritRoot);return{success:!0,message:`${e.name} ${(o==null?void 0:o.name)||""}${n.name}`,compatibility:i}},Ic=(e,t)=>{const n=$2(e);if(!n)return{manual:null,compatibility:null};const s=jf(e,t);return{manual:n,compatibility:s,speedBonus:`${(s.compatibility*n.baseBuff*100).toFixed(0)}%`}},cC=({player:e,childFeedback:t=0,onOpenInventory:n,onAllocateSkillPoint:s})=>{var k,T,N,K;const[o,i]=y.useState(!1);if(!e||!e.stats||!e.resources)return r.jsx("div",{style:{padding:"20px",textAlign:"center",color:"#999"},children:"..."});const a=_f(e.stats.aptitude),l=ka(e,!0),d=l+t,u=An(e.tier),p=(u==null?void 0:u.chance)??0,c=(e.breakthroughBonus||0)/100,f=Math.min(.95,p+c);e.currentExp>=e.maxExp&&!u&&console.warn(` "${e.tier}" `);const C=((e.stats.aptitude||50)/50).toFixed(2),w=((k=e.spiritRoot)==null?void 0:k.multiplier)||1,S=((N=(T=e.trait)==null?void 0:T.bonuses)==null?void 0:N.speedMultiplier)??((K=e.trait)==null?void 0:K.effect)??1,h=e.sect&&e.sect.level!=="NONE"?1.5:1,g=e.cultivationMethod&&e.spiritRoot?Cf(e.cultivationMethod,e.spiritRoot):1,v=e.cultivationMethod||"basic_breath",j=e.spiritRoot?Ic(v,e.spiritRoot):null,R=zn(e||{}),b=Math.floor(e.currentExp||0),_=Math.max(1,Math.floor(e.maxExp||1)),I=Math.min(100,Math.round(b/_*100));return r.jsxs("div",{style:ve.container,children:[r.jsx("h3",{style:ve.title,children:" "}),r.jsxs("div",{style:ve.content,children:[r.jsxs("div",{style:ve.topSection,children:[r.jsx("div",{style:ve.avatarContainer,children:r.jsx(Vr,{dna:e.avatar,gender:e.gender,size:80})}),r.jsxs("div",{style:ve.basicInfo,children:[r.jsx("h2",{style:ve.playerName,children:e.name}),r.jsx("div",{style:ve.tierBadge,children:e.tier}),r.jsx("div",{style:{display:"flex",gap:"8px",alignItems:"center"},children:r.jsxs("div",{style:ve.ageText,children:[Math.floor(e.age),""]})}),(()=>{const L=J2(e.tier);return L?r.jsxs("div",{style:{marginTop:"6px",fontSize:"12px",color:"#ffffff"},children:[r.jsx("span",{style:{fontWeight:"bold"},children:" :"})," ",L]}):null})()]})]}),r.jsxs("div",{style:ve.resourceStatsBox,children:[r.jsxs("div",{style:ve.resourceRow,children:[r.jsxs("div",{style:ve.resourceStatItem,children:[r.jsx("span",{style:ve.resourceIcon,children:""}),r.jsxs("div",{style:ve.resourceInfo,children:[r.jsx("div",{style:ve.resourceLabel,children:""}),r.jsx("div",{style:ve.resourceValue,children:e.resources.spiritStones})]})]}),r.jsxs("div",{style:ve.resourceStatItem,children:[r.jsx("span",{style:ve.resourceIcon,children:""}),r.jsxs("div",{style:ve.resourceInfo,children:[r.jsx("div",{style:ve.resourceLabel,children:""}),r.jsx("div",{style:ve.resourceValue,children:R.total})]})]})]}),r.jsxs("div",{style:ve.expSection,children:[r.jsx("div",{style:ve.expLabel,children:""}),r.jsxs("div",{style:ve.expBarWrapper,children:[r.jsx("div",{style:{...ve.expBarFill,width:`${I}%`}}),r.jsxs("div",{style:ve.expText,children:[b,"/",_]})]})]})]}),r.jsxs("div",{style:ve.mainSection,children:[r.jsxs("div",{style:ve.section,children:[r.jsx("h4",{children:" "}),e.spiritRoot?r.jsxs(r.Fragment,{children:[r.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"10px",marginBottom:"10px"},children:[r.jsx("strong",{style:{color:a.color,fontSize:"16px"},children:e.spiritRoot.type}),r.jsx("div",{style:{display:"flex",gap:"4px"},children:e.spiritRoot.elements.map(L=>{const B=W=>({:"#FFD700",:"#4CAF50",:"#2196F3",:"#F44336",:"#795548",:"#673AB7",:"#00BCD4",:"#009688"})[W]||"#9e9e9e";return r.jsx("span",{style:{padding:"2px 6px",borderRadius:"10px",color:"white",fontWeight:"bold",fontSize:"10px",background:B(L)},children:L},L)})})]}),r.jsxs("div",{style:ve.barContainer,children:[r.jsxs("span",{children:[" (",e.stats.aptitude,")"]}),r.jsx("div",{style:ve.barBg,children:r.jsx("div",{style:{...ve.barFill,width:`${e.stats.aptitude}%`,background:a.color}})})]}),r.jsx("p",{style:{fontSize:"12px",color:"#666",marginTop:"5px"},children:e.spiritRoot.desc})]}):r.jsx("div",{style:{padding:"10px",background:"rgba(0,0,0,0.2)",borderRadius:"8px",fontSize:"13px",color:"rgba(255,255,255,0.75)"},children:""})]}),r.jsxs("div",{style:ve.section,children:[r.jsx("h4",{children:" "}),e.spiritRoot?j!=null&&j.manual?r.jsxs("div",{style:ve.manualCard,children:[r.jsxs("div",{style:ve.manualHeader,children:[r.jsxs("div",{style:ve.manualName,children:[j.manual.name,r.jsx("span",{style:{...ve.manualTierBadge,background:j.manual.tierColor},children:j.manual.tierName})]}),j.manual.element!=="NONE"&&r.jsx("span",{style:ve.manualElementBadge,children:j.manual.element})]}),r.jsx("p",{style:ve.manualDesc,children:j.manual.desc}),j.compatibility&&r.jsxs("div",{style:ve.manualMetaRow,children:[r.jsxs("span",{children:["",r.jsx("strong",{style:{color:j.compatibility.color},children:j.compatibility.desc})]}),r.jsxs("span",{children:["",r.jsxs("strong",{style:{color:"#64ffda"},children:["+",j.speedBonus]})]})]}),r.jsxs("div",{style:ve.manualMetaRow,children:[r.jsxs("span",{children:["",j.manual.source||""]}),r.jsxs("span",{children:["",j.manual.element==="NONE"?"":j.manual.element]})]})]}):r.jsx("div",{style:ve.manualPlaceholder,children:""}):r.jsx("div",{style:ve.manualPlaceholder,children:""})]}),r.jsxs("div",{style:ve.section,children:[r.jsx("h4",{children:" "}),r.jsxs("div",{style:ve.barContainer,children:[r.jsxs("span",{children:[" (",b,"/",_,")"]}),r.jsx("div",{style:ve.barBg,children:r.jsx("div",{style:{...ve.barFill,width:`${I}%`,background:"#4CAF50"}})})]}),e.currentExp>=e.maxExp&&r.jsx("div",{style:{marginTop:"10px",padding:"10px",background:"rgba(255,193,7,0.15)",borderRadius:"8px",border:"1px solid #FFC107"},children:u?r.jsxs(r.Fragment,{children:[r.jsxs("div",{style:{fontSize:"13px",color:"#F57C00",fontWeight:"bold",marginBottom:"4px"},children:[" : ",(f*100).toFixed(1),"%"]}),r.jsxs("div",{style:{fontSize:"11px",color:"rgba(245,124,0,0.8)"},children:[": ",(p*100).toFixed(1),"%",c>0&&` | : +${(c*100).toFixed(1)}%`]})]}):r.jsx("div",{style:{fontSize:"12px",color:"#f44336"},children:" "})}),r.jsxs("div",{style:ve.speedInfo,children:[r.jsxs("div",{style:ve.speedHeader,children:[r.jsxs("span",{style:{fontWeight:"bold",color:"#4CAF50"},children:[" : ",d,"/"]}),t>0&&r.jsxs("span",{style:{fontSize:"12px",color:"#666",marginLeft:"8px"},children:["( ",l," +  ",t,")"]})]}),r.jsxs("div",{style:ve.speedFormula,children:[r.jsx("div",{style:{fontSize:"11px",color:"#666",marginBottom:"4px"},children:": (10/)          "}),r.jsxs("div",{style:ve.speedBreakdown,children:[r.jsxs("span",{style:ve.speedItem,children:[r.jsx("span",{style:{color:"#888"},children:":"})," ",C]}),r.jsxs("span",{style:ve.speedItem,children:[r.jsx("span",{style:{color:"#888"},children:":"})," ",w]}),r.jsxs("span",{style:ve.speedItem,children:[r.jsx("span",{style:{color:"#888"},children:":"})," ",g.toFixed(2)]}),r.jsxs("span",{style:ve.speedItem,children:[r.jsx("span",{style:{color:"#888"},children:":"})," ",S]}),r.jsxs("span",{style:ve.speedItem,children:[r.jsx("span",{style:{color:"#888"},children:":"})," ",h]})]}),r.jsxs("div",{style:{fontSize:"10px",color:"#999",marginTop:"4px",fontStyle:"italic"},children:["= 10  ",C,"  ",w,"  ",g.toFixed(2),"  ",S,"  ",h," = ",l]}),t>0&&r.jsxs("div",{style:{fontSize:"11px",color:"#4CAF50",marginTop:"6px",paddingTop:"6px",borderTop:"1px dashed #ddd"},children:[" : +",t,"/"]})]})]})]}),r.jsxs("div",{style:ve.section,children:[r.jsx("h4",{children:" "}),r.jsxs("div",{style:ve.statsGrid,children:[r.jsxs("div",{style:ve.statItem,children:[r.jsx("div",{style:ve.statLabel,children:""}),r.jsx("div",{style:ve.statValue,children:e.stats.looks}),r.jsx("div",{style:ve.statBar,children:r.jsx("div",{style:{...ve.statBarFill,width:`${e.stats.looks}%`,background:"#FF6B6B"}})})]}),r.jsxs("div",{style:ve.statItem,children:[r.jsx("div",{style:ve.statLabel,children:""}),r.jsx("div",{style:ve.statValue,children:e.stats.cunning}),r.jsx("div",{style:ve.statBar,children:r.jsx("div",{style:{...ve.statBarFill,width:`${e.stats.cunning}%`,background:"#4ECDC4"}})})]}),r.jsxs("div",{style:ve.statItem,children:[r.jsx("div",{style:ve.statLabel,children:""}),r.jsx("div",{style:ve.statValue,children:e.stats.health}),r.jsx("div",{style:ve.statBar,children:r.jsx("div",{style:{...ve.statBarFill,width:`${e.stats.health}%`,background:e.stats.health<30?"#F44336":e.stats.health<60?"#FFC107":"#45B7D1"}})}),r.jsxs("div",{style:{fontSize:"10px",color:"#ccc",marginTop:"4px",opacity:.8},children:[": ",zt(e.stats.health).toFixed(1),"/20"]})]}),r.jsxs("div",{style:ve.statItem,children:[r.jsx("div",{style:ve.statLabel,children:""}),r.jsx("div",{style:ve.statValue,children:e.stats.intelligence}),r.jsx("div",{style:ve.statBar,children:r.jsx("div",{style:{...ve.statBarFill,width:`${e.stats.intelligence}%`,background:"#96CEB4"}})})]})]}),r.jsx("div",{style:{display:"flex",justifyContent:"center",marginTop:"12px"},children:r.jsx("button",{onClick:()=>i(L=>!L),style:ve.detailsBtn,children:o?" ":" "})}),o&&r.jsx("div",{style:{marginTop:"15px",padding:"12px",background:"rgba(0,0,0,0.3)",borderRadius:"8px",border:"1px solid rgba(255,255,255,0.1)"},children:r.jsxs("div",{style:{fontSize:"12px",color:"#eee",lineHeight:1.8},children:[["looks","cunning","health","intelligence"].map(L=>{const B=fw(L),W=e.stats[L];let z=`${B.desc}`;if(L==="health"){const ne=zt(W);z+=` (: ${ne.toFixed(1)}/20)`}return r.jsxs("div",{style:{marginBottom:"8px",padding:"8px",background:"rgba(255,255,255,0.05)",borderRadius:"6px"},children:[r.jsxs("div",{style:{fontWeight:"bold",color:"#64ffda",marginBottom:"4px"},children:[B.name," (",W,"/100)"]}),r.jsx("div",{style:{opacity:.85,fontSize:"11px"},children:z}),B.trainable&&r.jsxs("div",{style:{opacity:.7,fontSize:"10px",marginTop:"4px",color:"#4CAF50"},children:[" ",B.howToIncrease]})]},L)}),r.jsx("div",{style:{marginTop:"12px",paddingTop:"12px",borderTop:"1px dashed rgba(255,255,255,0.2)",opacity:.75,fontSize:"11px"},children:r.jsxs("div",{style:{marginBottom:"4px"},children:["  ",e.stats.aptitude," ",e.stats.luck," ",e.stats.lifespan]})})]})})]}),r.jsxs("div",{style:ve.section,children:[r.jsx("h4",{children:" "}),r.jsxs("div",{style:ve.resourcesGrid,children:[r.jsxs("div",{style:ve.resourceItem,children:[r.jsx("span",{children:":"})," ",r.jsx("span",{style:{fontWeight:"bold"},children:e.resources.spiritStones})]}),r.jsxs("div",{style:ve.resourceItem,children:[r.jsx("span",{children:":"}),r.jsx("span",{style:{fontWeight:"bold",color:"#FF9800"},children:e.skillPoints||0})]})]}),(e.skillPoints||0)>0&&r.jsxs("div",{style:{marginTop:"10px",padding:"10px",background:"#FFF3E0",borderRadius:"8px",border:"1px solid #FFB74D"},children:[r.jsxs("div",{style:{fontSize:"12px",color:"#E65100",marginBottom:"8px"},children:[" : ",e.skillPoints]}),r.jsxs("div",{style:{display:"flex",gap:"8px"},children:[r.jsx("button",{onClick:()=>s&&s("aptitude"),style:{...ve.allocateBtn,background:"#9C27B0"},children:"+"}),r.jsx("button",{onClick:()=>s&&s("combatPower"),style:{...ve.allocateBtn,background:"#F44336"},children:"+"}),r.jsx("button",{onClick:()=>s&&s("breakthrough"),style:{...ve.allocateBtn,background:"#FF9800"},children:"+"})]})]}),e.breakthroughBonus>0&&r.jsx("div",{style:{marginTop:"10px",padding:"8px",background:"rgba(255,152,0,0.1)",borderRadius:"8px",border:"1px solid #FF9800"},children:r.jsxs("div",{style:{fontSize:"12px",color:"#F57C00"},children:[" : +",e.breakthroughBonus,"%",e.breakthroughFailCount>0&&r.jsxs("span",{style:{marginLeft:"8px",opacity:.8},children:["(: ",e.breakthroughFailCount,")"]})]})})]}),r.jsxs("div",{style:ve.section,children:[r.jsx("h4",{children:" "}),r.jsx("button",{onClick:n,style:ve.inventoryBtn,children:""})]})]})]})]})},ve={container:{background:"linear-gradient(135deg, #667eea 0%, #764ba2 100%)",borderRadius:"16px",padding:"20px",color:"white",boxShadow:"0 8px 32px rgba(0,0,0,0.3)",marginBottom:"20px"},title:{margin:"0 0 20px 0",fontSize:"24px",textAlign:"center",textShadow:"2px 2px 4px rgba(0,0,0,0.3)"},content:{display:"flex",flexDirection:"column",gap:"16px"},topSection:{display:"flex",alignItems:"center",gap:"16px",padding:"16px",background:"rgba(255,255,255,0.1)",borderRadius:"12px",backdropFilter:"blur(10px)"},mainSection:{display:"flex",flexDirection:"column",gap:"15px"},avatarContainer:{background:"rgba(255,255,255,0.15)",borderRadius:"50%",padding:"8px",boxShadow:"0 4px 12px rgba(0,0,0,0.3)",flexShrink:0},basicInfo:{flex:1,display:"flex",flexDirection:"column",gap:"6px"},playerName:{margin:0,fontSize:"20px",fontWeight:"bold"},tierBadge:{background:"rgba(255,255,255,0.25)",padding:"4px 12px",borderRadius:"16px",fontSize:"13px",display:"inline-block",border:"1px solid rgba(255,255,255,0.3)",fontWeight:"600"},ageText:{fontSize:"14px",opacity:.9},section:{background:"rgba(255,255,255,0.1)",borderRadius:"12px",padding:"15px",backdropFilter:"blur(10px)"},barContainer:{marginBottom:"10px"},barBg:{background:"rgba(0,0,0,0.3)",borderRadius:"10px",height:"20px",marginTop:"5px",overflow:"hidden",position:"relative"},barFill:{height:"100%",borderRadius:"10px",transition:"width 0.5s ease",position:"relative",overflow:"hidden"},speedInfo:{marginTop:"10px",padding:"10px",background:"rgba(255,255,255,0.1)",borderRadius:"8px",fontSize:"12px"},speedHeader:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"8px"},statsGrid:{display:"grid",gridTemplateColumns:"1fr",gap:"12px"},statItem:{display:"grid",gridTemplateColumns:"60px 40px 1fr",gap:"8px",alignItems:"center"},statLabel:{fontSize:"14px"},statValue:{fontWeight:"bold",fontSize:"14px"},statBar:{background:"rgba(0,0,0,0.3)",borderRadius:"10px",height:"16px",overflow:"hidden"},statBarFill:{height:"100%",borderRadius:"10px",transition:"width 0.5s ease"},resourcesGrid:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"10px"},resourceItem:{display:"flex",justifyContent:"space-between",padding:"8px",background:"rgba(255,255,255,0.1)",borderRadius:"8px"},allocateBtn:{flex:1,padding:"8px 16px",border:"none",borderRadius:"8px",color:"white",fontWeight:"bold",cursor:"pointer",fontSize:"14px",transition:"transform 0.2s, box-shadow 0.2s",boxShadow:"0 2px 8px rgba(0,0,0,0.2)"},inventoryBtn:{width:"100%",padding:"10px",background:"rgba(255,255,255,0.2)",border:"1px solid rgba(255,255,255,0.3)",borderRadius:"8px",color:"white",cursor:"pointer",fontWeight:"bold",transition:"all 0.3s"},speedFormula:{fontSize:"12px"},speedBreakdown:{display:"flex",flexWrap:"wrap",gap:"8px",marginTop:"6px",marginBottom:"4px"},speedItem:{fontSize:"11px",padding:"2px 6px",backgroundColor:"rgba(255,255,255,0.1)",borderRadius:"3px",border:"1px solid rgba(255,255,255,0.2)"},detailsBtn:{padding:"8px 16px",borderRadius:"8px",border:"1px solid rgba(255,255,255,0.3)",background:"rgba(100,255,218,0.1)",color:"#64ffda",cursor:"pointer",fontSize:"13px",fontWeight:"500",transition:"all 0.3s ease",hover:{background:"rgba(100,255,218,0.2)"}},resourceStatsBox:{background:"linear-gradient(135deg, rgba(76,175,80,0.15) 0%, rgba(129,199,132,0.1) 100%)",borderRadius:"12px",padding:"15px",marginBottom:"15px",border:"1px solid rgba(255,255,255,0.2)",backdropFilter:"blur(10px)"},resourceRow:{display:"flex",gap:"15px",marginBottom:"12px"},resourceStatItem:{flex:1,display:"flex",alignItems:"center",padding:"10px",background:"rgba(255,255,255,0.1)",borderRadius:"8px"},resourceInfo:{display:"flex",flexDirection:"column",gap:"2px"},resourceLabel:{fontSize:"11px",color:"rgba(255,255,255,0.7)",fontWeight:"500"},resourceIcon:{fontSize:"24px",marginRight:"8px"},expSection:{marginTop:"8px"},expLabel:{fontSize:"12px",color:"rgba(255,255,255,0.8)",marginBottom:"6px",fontWeight:"500"},expBarWrapper:{position:"relative",height:"24px",backgroundColor:"rgba(0,0,0,0.3)",borderRadius:"12px",overflow:"hidden",border:"1px solid rgba(255,255,255,0.1)"},expBarFill:{position:"absolute",left:0,top:0,height:"100%",background:"linear-gradient(90deg, #4CAF50, #81C784)",transition:"width 0.3s ease",borderRadius:"12px"},expText:{position:"absolute",left:"50%",top:"50%",transform:"translate(-50%, -50%)",fontSize:"11px",fontWeight:"bold",color:"#fff",textShadow:"1px 1px 2px rgba(0,0,0,0.5)",zIndex:1},manualCard:{background:"rgba(255,255,255,0.08)",borderRadius:"12px",padding:"12px 14px",border:"1px solid rgba(255,255,255,0.2)",display:"flex",flexDirection:"column",gap:"8px"},manualHeader:{display:"flex",justifyContent:"space-between",alignItems:"center",gap:"16px"},manualName:{fontSize:"18px",fontWeight:"bold",display:"flex",alignItems:"center",gap:"8px"},manualTierBadge:{padding:"2px 8px",borderRadius:"999px",fontSize:"11px",color:"#fff",fontWeight:"bold"},manualElementBadge:{padding:"4px 12px",background:"rgba(255,255,255,0.2)",borderRadius:"999px",fontSize:"12px",fontWeight:"bold"},manualDesc:{fontSize:"13px",color:"rgba(255,255,255,0.85)",lineHeight:1.6},manualMetaRow:{display:"flex",justifyContent:"space-between",fontSize:"13px",color:"rgba(255,255,255,0.9)"},manualPlaceholder:{padding:"10px 14px",borderRadius:"10px",background:"rgba(0,0,0,0.2)",fontSize:"13px",color:"rgba(255,255,255,0.75)"}},dC={common:"#9e9e9e",uncommon:"#4caf50",rare:"#2196f3",epic:"#9c27b0",legendary:"#ff9800"},uC=e=>!e||!Array.isArray(e.usageTargets)||e.usageTargets.length===0||e.resourceCategory==="PILL"?!0:e.usageTargets.includes(ht.NPC),pC=({npc:e,inventory:t=[],onClose:n,onGift:s})=>{const o=t.filter(u=>["consumable","weapon","armor","accessory"].includes(u.type)&&uC(u)),[i,a]=y.useState({}),l=y.useMemo(()=>{const u=Object.entries(i).filter(([,f])=>f>0),p=u.length,c=u.reduce((f,[,x])=>f+x,0);return{totalKinds:p,totalCount:c}},[i]),d={consumable:"",weapon:"",armor:"",accessory:""};return r.jsx("div",{style:St.overlay,children:r.jsxs("div",{style:St.modal,children:[r.jsxs("div",{style:St.header,children:[r.jsxs("h3",{children:["  ",e.name," "]}),r.jsx("button",{onClick:n,style:St.closeIcon,children:""})]}),r.jsx("p",{style:{fontSize:"12px",color:"#666",marginBottom:"10px",padding:"0 10px"},children:""}),r.jsx("div",{style:St.itemList,children:o.length===0?r.jsx("div",{style:St.empty,children:""}):o.map(u=>r.jsxs("div",{style:St.itemCard,children:[r.jsxs("div",{style:St.itemHeader,children:[r.jsxs("label",{style:St.itemSelect,children:[r.jsx("input",{type:"checkbox",checked:!!i[u.instanceId],onChange:p=>{const c=p.target.checked;a(f=>({...f,[u.instanceId]:c?1:0}))}}),r.jsx("span",{children:""})]}),r.jsx("span",{style:{...St.itemName,color:dC[u.rarity]||"#333"},children:u.name}),r.jsx("span",{style:St.itemType,children:d[u.type]||u.type})]}),r.jsx("div",{style:St.itemDesc,children:u.desc}),r.jsxs("div",{style:St.itemMetaRow,children:[r.jsxs("span",{style:St.itemStock,children:[": ",u.quantity||1]}),r.jsxs("div",{style:St.qtyControls,children:[r.jsx("button",{type:"button",onClick:()=>{const p=i[u.instanceId]||0;if(p<=1){a(c=>({...c,[u.instanceId]:0}));return}a(c=>({...c,[u.instanceId]:p-1}))},disabled:!i[u.instanceId],style:St.qtyBtn,children:"-"}),r.jsx("input",{type:"number",min:"1",max:u.quantity||1,value:i[u.instanceId]||"",onChange:p=>{const c=parseInt(p.target.value,10);if(Number.isNaN(c)){a(x=>({...x,[u.instanceId]:0}));return}const f=Math.max(1,Math.min(u.quantity||1,c));a(x=>({...x,[u.instanceId]:f}))},placeholder:"",style:St.qtyInput}),r.jsx("button",{type:"button",onClick:()=>{const p=i[u.instanceId]||0,c=u.quantity||1,f=Math.min(c,p>0?p+1:1);a(x=>({...x,[u.instanceId]:f}))},style:St.qtyBtn,children:"+"})]})]}),u.stats&&r.jsxs("div",{style:St.itemStats,children:[u.stats.atk&&r.jsxs("span",{children:["+",u.stats.atk]}),u.stats.hp&&r.jsxs("span",{children:["+",u.stats.hp]}),u.stats.def&&r.jsxs("span",{children:["+",u.stats.def]}),u.stats.mp&&r.jsxs("span",{children:["+",u.stats.mp]})]}),u.effect&&r.jsxs("div",{style:St.itemEffect,children:[u.effect.kind==="heal"&&`${u.effect.amount}`,u.effect.kind==="exp"&&`+${u.effect.amount}`,u.effect.kind==="aptitude"&&`+${u.effect.amount}`]})]},u.instanceId))}),r.jsxs("div",{style:St.footer,children:[r.jsxs("div",{style:St.summary,children:[" ",l.totalKinds,"  /  ",l.totalCount," "]}),r.jsxs("div",{style:St.footerActions,children:[r.jsx("button",{onClick:n,style:St.closeBtn,children:""}),r.jsx("button",{onClick:()=>{const u=Object.entries(i).filter(([,p])=>p>0).map(([p,c])=>({instanceId:p,quantity:c}));u.length!==0&&s&&s(u)},disabled:l.totalKinds===0,style:{...St.primaryBtn,opacity:l.totalKinds===0?.5:1,cursor:l.totalKinds===0?"not-allowed":"pointer"},children:""})]})]})]})})},St={overlay:{position:"fixed",top:0,left:0,right:0,bottom:0,background:"rgba(0,0,0,0.6)",display:"flex",justifyContent:"center",alignItems:"center",zIndex:200},modal:{width:"450px",maxHeight:"80vh",background:"#fff",borderRadius:"12px",padding:"20px",boxShadow:"0 8px 30px rgba(0,0,0,0.3)",display:"flex",flexDirection:"column"},header:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"15px"},closeIcon:{border:"none",background:"transparent",fontSize:"24px",cursor:"pointer",color:"#666",lineHeight:1},itemList:{flex:1,overflowY:"auto",maxHeight:"400px",marginBottom:"15px"},empty:{textAlign:"center",padding:"40px 20px",color:"#999",fontSize:"14px"},itemCard:{padding:"12px",marginBottom:"8px",background:"#fafafa",borderRadius:"8px",cursor:"pointer",border:"1px solid #eee",transition:"all 0.2s",":hover":{background:"#f5f5f5",borderColor:"#8d6e63"}},itemHeader:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"6px"},itemName:{fontWeight:"bold",fontSize:"14px"},itemType:{fontSize:"11px",padding:"2px 8px",background:"#e0e0e0",borderRadius:"10px",color:"#666"},itemDesc:{fontSize:"12px",color:"#666",marginBottom:"6px"},itemStats:{fontSize:"11px",color:"#1976d2",display:"flex",gap:"8px",flexWrap:"wrap"},itemEffect:{fontSize:"11px",color:"#388e3c",marginTop:"4px"},itemSelect:{display:"flex",alignItems:"center",gap:"6px",fontSize:"11px",color:"#666"},itemMetaRow:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"6px"},itemStock:{fontSize:"11px",color:"#999"},qtyControls:{display:"flex",alignItems:"center",gap:"6px"},qtyBtn:{width:"24px",height:"24px",border:"none",borderRadius:"4px",background:"#e0e0e0",cursor:"pointer",fontSize:"14px"},qtyInput:{width:"56px",padding:"4px",textAlign:"center",border:"1px solid #ddd",borderRadius:"4px",fontSize:"12px"},footer:{display:"flex",justifyContent:"space-between",alignItems:"center",gap:"12px"},summary:{fontSize:"12px",color:"#666"},footerActions:{display:"flex",gap:"8px"},closeBtn:{padding:"10px 16px",background:"#e0e0e0",border:"none",borderRadius:"8px",cursor:"pointer",fontSize:"14px"},primaryBtn:{padding:"10px 16px",background:"#ff9800",border:"none",borderRadius:"8px",color:"#fff",fontSize:"14px"}},fC=[{id:"EMOTION",label:"",desc:"",strongAgainst:["",""],weakAgainst:["",""]},{id:"PROFIT",label:"",desc:"",strongAgainst:["",""],weakAgainst:["",""]},{id:"REASON",label:"",desc:"",strongAgainst:["",""],weakAgainst:["",""]}],mC=({npc:e,onClose:t,onNegotiate:n})=>{var s;return r.jsx("div",{style:zi.overlay,children:r.jsxs("div",{style:zi.modal,children:[r.jsx("h3",{children:" "}),r.jsxs("p",{style:{color:"#555",fontSize:"14px"},children:[" ",r.jsx("strong",{style:{color:"#d81b60"},children:(s=e.personality)==null?void 0:s.label}),"  ",e.name,"",r.jsx("br",{}),""]}),r.jsx("div",{style:zi.list,children:fC.map(o=>r.jsxs("button",{onClick:()=>n(o),style:zi.btn,children:[r.jsx("div",{style:{fontWeight:"bold"},children:o.label}),r.jsx("small",{style:{color:"#666"},children:o.desc})]},o.id))}),r.jsx("button",{onClick:t,style:zi.cancel,children:""})]})})},zi={overlay:{position:"fixed",top:0,left:0,right:0,bottom:0,background:"rgba(0,0,0,0.7)",display:"flex",justifyContent:"center",alignItems:"center",zIndex:200},modal:{width:"300px",background:"#fff8e1",borderRadius:"12px",padding:"20px",border:"2px solid #8d6e63"},list:{display:"flex",flexDirection:"column",gap:"10px",margin:"20px 0"},btn:{padding:"15px",background:"#fff",border:"1px solid #d7ccc8",borderRadius:"8px",cursor:"pointer",textAlign:"left",":hover":{background:"#efebe9"}},cancel:{width:"100%",padding:"10px",background:"transparent",border:"none",color:"#888",cursor:"pointer"}},gC=({items:e,playerSpiritStones:t,onPurchase:n,onClose:s})=>{const[o,i]=y.useState({}),[a,l]=y.useState(null),d=(p,c)=>{const f=p.price*c;if(t<f){l(` ${p.name} x${c}  ${f}  ${t} `),setTimeout(()=>l(null),3e3);return}n(p,c,f),l(` ${p.name} x${c} ${f} `),setTimeout(()=>l(null),2e3)},u={common:"#9e9e9e",uncommon:"#4caf50",rare:"#2196f3",epic:"#9c27b0",legendary:"#ff9800"};return r.jsx("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0,0,0,0.5)",display:"flex",justifyContent:"center",alignItems:"center",zIndex:1e3},children:r.jsxs("div",{style:{backgroundColor:"#fff",padding:"25px",borderRadius:"16px",maxWidth:"600px",maxHeight:"80vh",width:"90%",boxShadow:"0 8px 30px rgba(0,0,0,0.3)",border:"2px solid #8d6e63",display:"flex",flexDirection:"column"},children:[r.jsx("h2",{style:{marginTop:0,color:"#5d4037",textAlign:"center",marginBottom:"10px"},children:" "}),r.jsx("p",{style:{color:"#666",textAlign:"center",fontSize:"13px",marginBottom:"15px"},children:""}),r.jsx("div",{style:{flex:1,overflowY:"auto",marginBottom:"15px"},children:e.length===0?r.jsx("div",{style:{textAlign:"center",padding:"40px",color:"#999"},children:""}):r.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"10px"},children:e.map(p=>{const c=o[p.instanceId]||1,f=p.price*c,x=t>=f;return r.jsxs("div",{style:{padding:"12px",border:`2px solid ${u[p.rarity]||"#ddd"}`,borderRadius:"10px",backgroundColor:x?"#fafafa":"#f5f5f5",opacity:x?1:.6,transition:"all 0.2s"},children:[r.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"6px"},children:[r.jsx("span",{style:{fontSize:"15px",fontWeight:"bold",color:u[p.rarity]},children:p.name}),r.jsxs("span",{style:{fontSize:"14px",color:"#f57c00",fontWeight:"bold"},children:[" ",p.price," "]})]}),r.jsx("div",{style:{fontSize:"12px",color:"#666",marginBottom:"8px"},children:p.desc}),p.stats&&r.jsxs("div",{style:{fontSize:"11px",color:"#1976d2",display:"flex",gap:"8px",flexWrap:"wrap",marginBottom:"8px"},children:[p.stats.atk&&r.jsxs("span",{children:["+",p.stats.atk]}),p.stats.hp&&r.jsxs("span",{children:["+",p.stats.hp]}),p.stats.def&&r.jsxs("span",{children:["+",p.stats.def]}),p.stats.mp&&r.jsxs("span",{children:["+",p.stats.mp]})]}),p.effect&&r.jsxs("div",{style:{fontSize:"11px",color:"#388e3c",marginBottom:"8px"},children:[p.effect.kind==="heal"&&`${p.effect.amount}`,p.effect.kind==="exp"&&`+${p.effect.amount}`,p.effect.kind==="aptitude"&&`+${p.effect.amount}`]}),r.jsxs("div",{style:{display:"flex",gap:"8px",alignItems:"center",marginBottom:"8px"},children:[r.jsxs("div",{style:{display:"flex",alignItems:"center",gap:6},children:[r.jsx("label",{style:{fontSize:12,color:"#555"},children:""}),r.jsx("input",{type:"number",min:1,value:c,onChange:C=>{const w=Math.max(1,parseInt(C.target.value||"1",10));i(S=>({...S,[p.instanceId]:w}))},style:{width:60,padding:6,borderRadius:6,border:"1px solid #ddd"}})]}),r.jsx("div",{style:{flex:1}})]}),r.jsxs("button",{onClick:()=>d(p,c),disabled:!x,style:{width:"100%",padding:"8px",border:"none",borderRadius:"6px",backgroundColor:x?"#8d6e63":"#ccc",color:"white",cursor:x?"pointer":"not-allowed",fontSize:"13px",fontWeight:"bold"},children:[" x",c,"  ",f,""]})]},p.instanceId)})})}),a&&r.jsx("div",{style:{marginBottom:15,padding:"10px 15px",textAlign:"center",backgroundColor:a.includes("")?"#ffebee":"#e8f5e9",color:a.includes("")?"#c62828":"#2e7d32",fontWeight:"bold",borderRadius:"8px",border:`2px solid ${a.includes("")?"#ef5350":"#66bb6a"}`},children:a}),r.jsxs("div",{style:{marginTop:"10px",padding:"10px",backgroundColor:"#fff3e0",borderRadius:"8px",fontSize:"12px",color:"#666",textAlign:"center"},children:[" "," ",r.jsx("span",{style:{fontWeight:"bold",color:"#f57c00"},children:t})," ",""]}),r.jsx("button",{onClick:s,style:{marginTop:"15px",padding:"10px",border:"1px solid #ccc",borderRadius:"8px",backgroundColor:"white",cursor:"pointer",fontSize:"14px"},children:""})]})})},hC=({result:e,onClose:t})=>{if(y.useEffect(()=>{if(e&&e.autoClose!==!1){const s=setTimeout(t,3e3);return()=>clearTimeout(s)}},[t,e]),!e)return null;const n=()=>{e.autoClose!==!1&&t()};return r.jsx("div",{style:ss.overlay,onClick:n,children:r.jsxs("div",{style:ss.card,onClick:s=>s.stopPropagation(),children:[r.jsx("div",{style:ss.icon,children:e.success?"":""}),r.jsx("h3",{style:{margin:"10px 0"},children:e.title}),r.jsx("div",{style:ss.scrollText,children:e.msg}),e.changes&&r.jsx("div",{style:ss.changes,children:Object.entries(e.changes).map(([s,o])=>r.jsxs("span",{style:ss.badge,children:[s,": ",o>0?"+":"",o]},s))}),e.autoClose===!1?r.jsx("button",{onClick:t,style:ss.confirmBtn,children:""}):r.jsx("div",{style:ss.tip,children:"[  ]"})]})})},ss={overlay:{position:"fixed",top:0,left:0,right:0,bottom:0,background:"rgba(0,0,0,0.5)",display:"flex",justifyContent:"center",alignItems:"center",zIndex:2200,animation:"fadeIn 0.2s",backdropFilter:"blur(2px)"},card:{width:"85%",maxWidth:"500px",background:"#f5f0e8",padding:"25px",borderRadius:"16px",textAlign:"center",boxShadow:"0 8px 30px rgba(0,0,0,0.2)",animation:"fadeIn 0.3s ease-out",maxHeight:"80vh",display:"flex",flexDirection:"column",border:"2px solid #d7ccc8"},scrollText:{maxHeight:"250px",overflowY:"auto",lineHeight:"1.8",color:"#5d4037",textAlign:"left",background:"#faf8f5",padding:"20px",borderRadius:"12px",margin:"15px 0",border:"1px solid #e0e0e0",boxShadow:"0 2px 8px rgba(0,0,0,0.05)",fontFamily:"Microsoft YaHei, SimSun, serif"},confirmBtn:{marginTop:"20px",padding:"12px 25px",background:"linear-gradient(135deg, #8d6e63 0%, #6d4c41 100%)",color:"white",border:"none",borderRadius:"25px",cursor:"pointer",fontSize:"15px",transition:"all 0.3s ease",boxShadow:"0 2px 8px rgba(0,0,0,0.15)",":hover":{background:"linear-gradient(135deg, #6d4c41 0%, #5d4037 100%)",transform:"translateY(-2px)",boxShadow:"0 4px 12px rgba(0,0,0,0.2)"}},icon:{fontSize:"48px",marginBottom:"15px"},changes:{marginTop:"20px",display:"flex",gap:"8px",justifyContent:"center",flexWrap:"wrap"},badge:{background:"linear-gradient(135deg, #f1f8e9 0%, #e8f5e8 100%)",color:"#5d4037",padding:"4px 12px",borderRadius:"15px",fontSize:"13px",border:"1px solid #d7ccc8",boxShadow:"0 2px 4px rgba(0,0,0,0.05)"},tip:{marginTop:"15px",fontSize:"12px",color:"#8d6e63",fontStyle:"italic"}},xC=({message:e,onConfirm:t,onCancel:n,input:s})=>{const[o,i]=y.useState((s==null?void 0:s.defaultValue)??"");return r.jsx("div",{style:br.overlay,onClick:n,children:r.jsxs("div",{style:br.card,onClick:a=>a.stopPropagation(),children:[r.jsx("div",{style:br.icon,children:""}),r.jsx("h3",{style:{margin:"10px 0"},children:""}),r.jsx("div",{style:br.message,children:e}),s&&r.jsxs("div",{style:br.inputWrap,children:[s.label&&r.jsx("div",{style:br.inputLabel,children:s.label}),r.jsx("input",{type:s.type||"text",value:o,min:s.min,max:s.max,step:s.step,placeholder:s.placeholder,onChange:a=>i(a.target.value),style:br.input})]}),r.jsxs("div",{style:br.buttons,children:[r.jsx("button",{onClick:n,style:br.cancelBtn,children:""}),r.jsx("button",{onClick:()=>t(s?o:void 0),style:br.confirmBtn,children:""})]})]})})},br={overlay:{position:"fixed",top:0,left:0,right:0,bottom:0,background:"rgba(0, 0, 0, 0.5)",display:"flex",justifyContent:"center",alignItems:"center",zIndex:2200,animation:"fadeIn 0.2s",backdropFilter:"blur(2px)"},card:{width:"85%",maxWidth:"400px",background:"linear-gradient(135deg, #F4EEE6 0%, #EFE6D8 100%)",borderRadius:"12px",padding:"30px",textAlign:"center",boxShadow:"0 20px 60px rgba(0, 0, 0, 0.3)",border:"2px solid #D4AF37"},icon:{fontSize:"48px",marginBottom:"10px"},message:{margin:"20px 0",lineHeight:"1.6",whiteSpace:"pre-wrap"},inputWrap:{marginTop:"10px"},inputLabel:{fontSize:"12px",color:"#555",marginBottom:"6px"},input:{width:"100%",padding:"8px 10px",border:"1px solid #ccc",borderRadius:"6px",fontSize:"14px"},buttons:{display:"flex",gap:"15px",justifyContent:"center",marginTop:"20px"},cancelBtn:{padding:"10px 20px",background:"#666",color:"white",border:"none",borderRadius:"8px",cursor:"pointer",fontSize:"16px"},confirmBtn:{padding:"10px 20px",background:"#4CAF50",color:"white",border:"none",borderRadius:"8px",cursor:"pointer",fontSize:"16px"}},yC=({event:e,npc:t,onClose:n,onOptionSelect:s})=>{const o=l=>{try{s((t==null?void 0:t.id)||null,l)}catch(d){console.error("EventModal option select error",d)}},i=(e==null?void 0:e.title)||(t?`${t.name} - `:""),a=(e==null?void 0:e.text)||(e==null?void 0:e.desc)||(e==null?void 0:e.description)||"";return r.jsx("div",{style:$r.overlay,children:r.jsxs("div",{style:$r.modalWrapper,children:[r.jsx("button",{onClick:n,style:$r.closeBtn,"aria-label":"",children:""}),r.jsxs("div",{style:$r.modal,children:[r.jsx("h2",{style:$r.title,children:i}),r.jsxs("div",{style:$r.content,children:[r.jsx("p",{style:$r.eventText,children:a}),r.jsx("div",{style:$r.options,children:((e==null?void 0:e.options)||[]).map((l,d)=>r.jsx("button",{style:$r.optionBtn,onClick:()=>o(l),children:l.label},d))})]})]})]})})},$r={overlay:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0, 0, 0, 0.5)",display:"flex",justifyContent:"center",alignItems:"center",zIndex:1e3,backdropFilter:"blur(2px)"},modalWrapper:{position:"relative",width:"min(600px, calc(100vw - 32px))"},modal:{width:"90%",maxWidth:"600px",backgroundColor:"#f5f0e8",borderRadius:"16px",padding:"25px",position:"relative",boxShadow:"0 8px 30px rgba(0, 0, 0, 0.2)",border:"2px solid #d7ccc8",animation:"fadeIn 0.3s ease-out"},closeBtn:{position:"absolute",top:"-18px",left:"-18px",border:"none",background:"#fff",fontSize:"22px",cursor:"pointer",color:"#8d6e63",width:"42px",height:"42px",borderRadius:"50%",display:"flex",alignItems:"center",justifyContent:"center",boxShadow:"0 10px 24px rgba(0,0,0,0.2)"},title:{fontSize:"20px",marginBottom:"25px",color:"#5d4037",textAlign:"center",fontWeight:"bold",paddingBottom:"15px",borderBottom:"2px solid #d7ccc8",fontFamily:"Microsoft YaHei, SimSun, serif"},content:{maxHeight:"70vh",overflowY:"auto",paddingRight:"10px"},eventText:{fontSize:"16px",lineHeight:"1.8",marginBottom:"35px",color:"#5d4037",padding:"20px",background:"#faf8f5",borderRadius:"12px",border:"1px solid #e0e0e0",boxShadow:"0 2px 8px rgba(0, 0, 0, 0.05)",fontFamily:"Microsoft YaHei, SimSun, serif"},options:{display:"flex",flexDirection:"column",gap:"12px"},optionBtn:{padding:"18px",border:"2px solid #d7ccc8",borderRadius:"12px",background:"linear-gradient(135deg, #ffffff 0%, #f5f0e8 100%)",cursor:"pointer",textAlign:"left",transition:"all 0.3s ease",fontSize:"15px",color:"#5d4037",boxShadow:"0 2px 8px rgba(0, 0, 0, 0.05)",":hover":{background:"linear-gradient(135deg, #f5f0e8 0%, #e8e0d8 100%)",transform:"translateY(-2px)",boxShadow:"0 4px 12px rgba(0, 0, 0, 0.1)",borderColor:"#bcaaa4"},":active":{transform:"translateY(0)",boxShadow:"0 2px 6px rgba(0, 0, 0, 0.05)"}}},Ug=e=>Math.max(0,Math.min(100,Number(e)||0)),bC=({event:e,player:t,onClose:n,onOptionSelect:s})=>{const[o,i]=y.useState(null),a=d=>{i(d),setTimeout(()=>{s(d),n()},300)},l=()=>e.participants.map((d,u)=>{var C,w;const p=((C=d.relationship)==null?void 0:C.jealousy)||0,c=((w=d.relationship)==null?void 0:w.affection)||0,f=Ug(c),x=Ug(p);return r.jsxs("div",{style:tt.npcCard,children:[r.jsxs("div",{style:tt.npcHeader,children:[r.jsx("span",{style:tt.npcName,children:d.name}),r.jsx("span",{style:tt.npcRealm,children:d.tierTitle||""})]}),r.jsxs("div",{style:tt.npcStats,children:[r.jsxs("div",{style:tt.statBar,children:[r.jsx("span",{style:tt.statLabel,children:""}),r.jsx("div",{style:tt.barContainer,children:r.jsx("div",{style:{...tt.barFill,width:`${f}%`,background:"#ff6b9d"}})}),r.jsx("span",{style:tt.statValue,children:f})]}),r.jsxs("div",{style:tt.statBar,children:[r.jsx("span",{style:tt.statLabel,children:""}),r.jsx("div",{style:tt.barContainer,children:r.jsx("div",{style:{...tt.barFill,width:`${x}%`,background:x>=80?"#d32f2f":x>=60?"#f44336":"#ff9800"}})}),r.jsx("span",{style:tt.statValue,children:x})]})]})]},d.id)});return r.jsx("div",{style:tt.overlay,children:r.jsxs("div",{style:tt.modalWrapper,children:[r.jsx("button",{onClick:n,style:tt.closeBtn,"aria-label":"",children:""}),r.jsxs("div",{style:tt.modal,children:[r.jsxs("h2",{style:tt.title,children:[r.jsx("span",{style:tt.titleIcon,children:""}),"",r.jsx("span",{style:tt.titleIcon,children:""})]}),r.jsxs("div",{style:tt.content,children:[r.jsx("div",{style:tt.sceneDescription,children:r.jsx("p",{style:tt.mainText,children:e.description})}),r.jsxs("div",{style:tt.participants,children:[r.jsx("h3",{style:tt.sectionTitle,children:""}),r.jsx("div",{style:tt.npcList,children:l()})]}),e.dialogues&&e.dialogues.length>0&&r.jsx("div",{style:tt.dialogues,children:e.dialogues.map((d,u)=>r.jsxs("div",{style:tt.dialogueItem,children:[r.jsxs("span",{style:tt.dialogueSpeaker,children:[d.speaker,""]}),r.jsxs("span",{style:tt.dialogueText,children:['"',d.text,'"']})]},u))}),r.jsx("div",{style:tt.options,children:e.options.map((d,u)=>r.jsxs("button",{style:{...tt.optionBtn,...o===d?tt.optionBtnSelected:{}},onClick:()=>a(d),children:[r.jsx("div",{style:tt.optionLabel,children:d.label}),d.hint&&r.jsx("div",{style:tt.optionHint,children:d.hint})]},u))})]})]})]})})},tt={overlay:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0, 0, 0, 0.7)",display:"flex",justifyContent:"center",alignItems:"center",zIndex:1100,backdropFilter:"blur(3px)",animation:"fadeIn 0.3s ease-out"},modalWrapper:{position:"relative",width:"min(700px, calc(100vw - 32px))"},modal:{width:"90%",maxWidth:"700px",maxHeight:"90vh",backgroundColor:"#fff5f5",borderRadius:"20px",padding:"30px",position:"relative",boxShadow:"0 10px 40px rgba(211, 47, 47, 0.3)",border:"3px solid #ffcdd2",overflowY:"auto",animation:"slideIn 0.4s ease-out"},closeBtn:{position:"absolute",top:"-20px",left:"-20px",border:"none",background:"#fff5f5",fontSize:"26px",cursor:"pointer",color:"#d32f2f",width:"48px",height:"48px",borderRadius:"50%",display:"flex",alignItems:"center",justifyContent:"center",boxShadow:"0 12px 30px rgba(211,47,47,0.25)"},title:{fontSize:"28px",marginBottom:"25px",color:"#d32f2f",textAlign:"center",fontWeight:"bold",paddingBottom:"15px",borderBottom:"3px solid #ffcdd2",fontFamily:"Microsoft YaHei, serif",textShadow:"2px 2px 4px rgba(211, 47, 47, 0.2)",display:"flex",alignItems:"center",justifyContent:"center",gap:"15px"},titleIcon:{fontSize:"24px",animation:"pulse 2s infinite"},content:{maxHeight:"calc(90vh - 120px)",overflowY:"auto",paddingRight:"10px"},sceneDescription:{marginBottom:"25px",padding:"20px",background:"linear-gradient(135deg, #fff 0%, #ffebee 100%)",borderRadius:"15px",border:"2px solid #ffcdd2",boxShadow:"0 4px 12px rgba(211, 47, 47, 0.1)"},mainText:{fontSize:"17px",lineHeight:"1.9",color:"#5d4037",margin:0,fontFamily:"Microsoft YaHei, serif",textAlign:"justify"},participants:{marginBottom:"25px"},sectionTitle:{fontSize:"18px",color:"#d32f2f",marginBottom:"15px",fontWeight:"bold",paddingLeft:"10px",borderLeft:"4px solid #d32f2f"},npcList:{display:"flex",flexDirection:"column",gap:"12px"},npcCard:{padding:"15px",background:"#fff",borderRadius:"12px",border:"2px solid #ffcdd2",boxShadow:"0 2px 8px rgba(211, 47, 47, 0.1)"},npcHeader:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"10px"},npcName:{fontSize:"16px",fontWeight:"bold",color:"#d32f2f"},npcRealm:{fontSize:"13px",color:"#666",background:"#f5f5f5",padding:"4px 10px",borderRadius:"8px"},npcStats:{display:"flex",flexDirection:"column",gap:"8px"},statBar:{display:"flex",alignItems:"center",gap:"10px"},statLabel:{fontSize:"13px",color:"#666",minWidth:"40px"},barContainer:{flex:1,height:"8px",background:"#e0e0e0",borderRadius:"4px",overflow:"hidden"},barFill:{height:"100%",transition:"width 0.5s ease"},statValue:{fontSize:"13px",color:"#666",minWidth:"30px",textAlign:"right"},dialogues:{marginBottom:"25px",padding:"20px",background:"#fafafa",borderRadius:"12px",border:"1px solid #e0e0e0"},dialogueItem:{marginBottom:"12px",fontSize:"15px",lineHeight:"1.8",color:"#5d4037"},dialogueSpeaker:{fontWeight:"bold",color:"#d32f2f"},dialogueText:{color:"#5d4037",fontStyle:"italic"},options:{display:"flex",flexDirection:"column",gap:"12px",marginTop:"20px"},optionBtn:{padding:"18px 20px",border:"2px solid #ffcdd2",borderRadius:"12px",background:"linear-gradient(135deg, #ffffff 0%, #fff5f5 100%)",cursor:"pointer",textAlign:"left",transition:"all 0.3s ease",fontSize:"15px",color:"#5d4037",boxShadow:"0 2px 8px rgba(211, 47, 47, 0.1)"},optionBtnSelected:{background:"linear-gradient(135deg, #ffebee 0%, #ffcdd2 100%)",borderColor:"#d32f2f",transform:"translateY(-2px)",boxShadow:"0 4px 12px rgba(211, 47, 47, 0.2)"},optionLabel:{fontSize:"15px",fontWeight:"bold",marginBottom:"5px"},optionHint:{fontSize:"13px",color:"#999",marginTop:"5px"}},vC=(e="")=>{switch(e){case"":return"#c62828";case"":return"#ef6c00";case"":return"#fb8c00";case"":return"#fdd835";default:return"#8d6e63"}},SC=({event:e,onClose:t})=>{if(!e)return null;const{alerts:n=[],summary:s,actionLabel:o,timestamp:i={},targetName:a}=e,l=`${i.year||"???"}${i.month||"??"}  ${o||""}`;return r.jsx("div",{style:qt.overlay,children:r.jsxs("div",{style:qt.modal,children:[r.jsx("button",{type:"button","aria-label":"",onClick:t,style:qt.closeBtn,children:""}),r.jsx("h2",{style:qt.title,children:" "}),r.jsx("p",{style:qt.subtitle,children:l}),r.jsx("div",{style:qt.summaryBox,children:r.jsx("p",{style:qt.summaryText,children:s})}),r.jsx("div",{style:qt.alertList,children:n.map(d=>r.jsxs("div",{style:qt.alertCard,children:[r.jsxs("div",{style:qt.alertHeader,children:[r.jsxs("div",{style:qt.alertNameRow,children:[r.jsx("span",{style:qt.alertName,children:d.witnessName}),r.jsx("span",{style:{...qt.levelBadge,backgroundColor:vC(d.level)},children:d.level})]}),r.jsxs("span",{style:qt.targetTip,children:["",d.targetName||a]})]}),r.jsxs("div",{style:qt.alertMeta,children:["",o]}),r.jsxs("div",{style:qt.alertMeta,children:["+",d.increase,"  ",d.newJealousy]})]},`${d.witnessName}-${d.targetName}-${d.newJealousy}`))}),r.jsx("button",{type:"button",onClick:t,style:qt.primaryBtn,children:""})]})})},qt={overlay:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0,0,0,0.65)",display:"flex",justifyContent:"center",alignItems:"center",zIndex:2300,padding:"16px"},modal:{width:"min(640px, 100%)",background:"#fffdf7",borderRadius:"18px",padding:"28px 26px 32px",position:"relative",boxShadow:"0 18px 40px rgba(93,64,55,0.3)",border:"2px solid #ffe0b2",maxHeight:"92vh",overflowY:"auto"},closeBtn:{position:"absolute",top:"14px",right:"14px",border:"none",background:"transparent",fontSize:"26px",cursor:"pointer",color:"#8d6e63"},title:{margin:0,fontSize:"26px",color:"#c62828",textAlign:"center"},subtitle:{textAlign:"center",margin:"6px 0 18px",color:"#795548",fontSize:"14px"},summaryBox:{background:"#fff8e1",borderRadius:"12px",border:"1px solid #ffe0b2",padding:"16px",marginBottom:"18px"},summaryText:{margin:0,fontSize:"15px",lineHeight:1.7,color:"#5d4037",whiteSpace:"pre-line"},alertList:{display:"flex",flexDirection:"column",gap:"12px",marginBottom:"24px"},alertCard:{border:"1px solid #ffe0b2",borderRadius:"12px",padding:"14px 16px",background:"#fff"},alertHeader:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"8px"},alertNameRow:{display:"flex",alignItems:"center",gap:"8px"},alertName:{fontWeight:"bold",fontSize:"16px",color:"#5d4037"},levelBadge:{padding:"2px 10px",borderRadius:"999px",color:"#fff",fontSize:"12px"},targetTip:{fontSize:"13px",color:"#8d6e63"},alertMeta:{fontSize:"14px",color:"#6d4c41"},primaryBtn:{width:"100%",padding:"12px",borderRadius:"10px",border:"none",background:"linear-gradient(120deg, #ffb300, #ff7043)",color:"#fff",fontSize:"16px",fontWeight:"bold",cursor:"pointer"}},wC=["","","","","",""],Gg={COMMON:"",UNCOMMON:"",RARE:"",EPIC:"",LEGENDARY:"",MYTHIC:"",UNIQUE:"",SPECIAL:""},kC=e=>{var n;if(!e)return"";const t=e.toString().trim().toUpperCase();return(n=J[t])!=null&&n.label?J[t].label:Gg[t]?Gg[t]:/^[A-Z]+$/.test(t)?"":e},Vg=(e=[])=>{const t={};return e.forEach(n=>{n!=null&&n.id&&(t[n.id]=[{bidder:"",amount:Math.max(1,n.basePrice||0),time:Date.now()}])}),t},EC=({auction:e,playerResources:t,onClose:n,onBuy:s,onShowPlot:o,playerSoldAuctionItems:i=[]})=>{if(!e)return null;const a=y.useMemo(()=>e.items||[],[e]),l=()=>typeof window>"u"?!1:window.innerWidth<=768,[d,u]=y.useState(l),[p,c]=y.useState(()=>Vg(a)),[f,x]=y.useState(null),[C,w]=y.useState(a[0]||null),[S,h]=y.useState({}),[g,v]=y.useState(null),[j,R]=y.useState({}),b=y.useRef(p),_=(q,de)=>d?de:q;y.useEffect(()=>{b.current=p},[p]),y.useEffect(()=>{if(typeof window>"u")return;const q=()=>u(l());return window.addEventListener("resize",q),()=>window.removeEventListener("resize",q)},[]),y.useEffect(()=>{const q=Vg(a);c(q),b.current=q,x(null),w(a[0]||null),h({}),v(null),R({})},[a]);const I=q=>{q&&v({...q,id:Date.now()})},k=q=>b.current[q]||[],T=q=>{const de=k(q);return de.length===0?0:de[de.length-1].amount},N=q=>{const de=k(q);return de.length===0?null:de[de.length-1].bidder},K=(q,de,Z)=>{c(re=>{const ce=re[q]?[...re[q]]:[];ce.push({bidder:de,amount:Z,time:Date.now()});const le={...re,[q]:ce};return b.current=le,le})},L=(q,de)=>{c(Z=>{const re=[...Z[q]||[]];for(let le=re.length-1;le>=0;le-=1)if(re[le].bidder===""&&(!de||re[le].amount===de)){re.splice(le,1);break}const ce={...Z,[q]:re};return b.current=ce,ce})},B=q=>Math.max(1,Math.floor(((q==null?void 0:q.basePrice)||0)*.05)),W=q=>Math.max(1,Math.floor((q==null?void 0:q.basePrice)||0))*2,z=(q,de)=>{R(Z=>({...Z,[q]:{enabled:!1,ceiling:"",...Z[q]||{},...de}}))},ne=q=>{const de=j[q.id];if(!(de!=null&&de.enabled))return;const Z=Number(de.ceiling)||0,re=T(q.id);if(N(q.id)===""||Z<=0||re>=Z)return;const le=Math.min(Z,re+B(q));if(((t==null?void 0:t.spiritStones)||0)<le){I({type:"error",title:"",message:`${q.name} `}),z(q.id,{enabled:!1});return}K(q.id,"",le)},Q=q=>{for(let de=0;de<2;de+=1)wC.forEach(Z=>{if(Math.random()<.35){const re=T(q.id),ce=(q==null?void 0:q.basePrice)||0,le=Math.max(1,Math.floor(ce*(.02+Math.random()*.12))||1),we=W(q),Ue=Math.min(re+le,we);Ue>re&&(K(q.id,Z,Ue),ne(q))}})},se=(q,de,Z)=>{Z!=null&&Z.success?(h(re=>({...re,[q.id]:{status:"won",price:de,bidder:""}})),z(q.id,{enabled:!1}),I({type:"success",title:Z.title||"",message:Z.message||`${q.name} `})):(L(q.id,de),I({type:"error",title:(Z==null?void 0:Z.title)||"",message:(Z==null?void 0:Z.message)||""}))},ye=q=>{const de=`INSTANCE:${q.id}`,Z=!!S[q.id]||i.includes(de)||i.includes(q.id);if(!q||Z)return;const re=T(q.id);try{const ce=s(q,re);ce&&typeof ce.then=="function"?ce.then(le=>se(q,re,le)).catch(()=>{se(q,re,{success:!1,title:"",message:""})}):se(q,re,ce)}catch{se(q,re,{success:!1,title:"",message:""})}},Me=(q,de,Z)=>{const re=`INSTANCE:${q.id}`,ce=!!S[q.id]||i.includes(re)||i.includes(q.id);if(!q||ce){I({type:"error",title:"",message:""});return}const le=T(q.id)+B(q),we=Math.max(Number(de)||0,le);if(((t==null?void 0:t.spiritStones)||0)<we){I({type:"error",title:"",message:""});return}K(q.id,"",we),Z(""),Q(q),setTimeout(()=>{N(q.id)===""&&ye(q)},60)},Pe=q=>{x(q)},Ke=()=>v(null);return r.jsxs("div",{style:{...Ge.overlay,alignItems:d?"flex-start":"center",padding:d?"12px":"20px"},children:[r.jsx("div",{style:{...Ge.modalWrapper,width:d?"100%":Ge.modalWrapper.width,maxHeight:d?"none":Ge.modalWrapper.maxHeight},children:r.jsxs("div",{style:{...Ge.modalShell,borderRadius:d?16:Ge.modalShell.borderRadius,padding:d?"18px":Ge.modalShell.padding,maxHeight:d?"none":Ge.modalShell.maxHeight},children:[r.jsxs("header",{style:{...Ge.header,paddingTop:d?"40px":"30px"},children:[r.jsx("button",{onClick:n,style:{...Ge.closeBtn,fontSize:_("14px","12px"),padding:_("6px 16px","4px 12px"),position:"absolute",top:d?"12px":"16px",left:d?"12px":"16px"},"aria-label":"",children:""}),r.jsxs("div",{style:{flex:1},children:[r.jsx("h2",{style:{...Ge.title,fontSize:_("24px","18px")},children:e.title}),r.jsx("p",{style:{...Ge.message,fontSize:_("14px","12px")},children:e.message})]}),r.jsx("div",{style:Ge.headerActions,children:r.jsxs("div",{style:{...Ge.resourceChip,fontSize:_("14px","12px"),padding:_("6px 14px","4px 10px")},children:["  ",(t==null?void 0:t.spiritStones)||0]})})]}),r.jsx("div",{style:{...Ge.body,flexDirection:"column",gap:"16px"},children:f?r.jsxs("div",{style:{...Ge.plotCard,padding:_("20px","16px")},children:[r.jsx("h3",{style:{...Ge.plotTitle,fontSize:_("18px","16px")},children:f.name}),r.jsx("div",{style:{...Ge.plotContent,fontSize:_("14px","13px")},children:o(f)}),r.jsx("button",{style:{...Ge.backBtn,fontSize:_("13px","12px"),padding:_("10px","8px")},onClick:()=>x(null),children:""})]}):r.jsx("section",{style:{...Ge.catalogPanel,gridTemplateColumns:d?"1fr":Ge.catalogPanel.gridTemplateColumns,maxHeight:d?"none":Ge.catalogPanel.maxHeight,paddingRight:d?0:Ge.catalogPanel.paddingRight,gap:_(Ge.catalogPanel.gap,"12px")},children:a.map(q=>{const de=`INSTANCE:${q.id}`,Z=!!S[q.id]||i.includes(de)||i.includes(q.id);return r.jsx(jC,{item:q,bids:k(q.id),currentHighest:T(q.id),highestBidder:N(q.id),onPlayerBid:Me,onShowPlot:()=>Pe(q),sold:Z,autoBidConfig:j[q.id],onAutoBidConfigChange:z,isMobile:d},q.id)})})})]})}),g&&r.jsx("div",{style:Ge.feedbackOverlay,children:r.jsxs("div",{style:{...Ge.feedbackCard,borderColor:g.type==="success"?"#66bb6a":"#ef5350"},children:[r.jsx("h3",{style:{marginTop:0,color:g.type==="success"?"#1b5e20":"#b71c1c"},children:g.title}),r.jsx("p",{style:{whiteSpace:"pre-wrap",color:"#333"},children:g.message}),r.jsx("button",{style:Ge.feedbackBtn,onClick:Ke,children:""})]})})]})},jC=({item:e,bids:t,currentHighest:n,highestBidder:s,onPlayerBid:o,onShowPlot:i,sold:a,autoBidConfig:l,onAutoBidConfigChange:d,isMobile:u})=>{const[p,c]=y.useState("");y.useEffect(()=>c(""),[e.id]);const f=(b,_)=>u?_:b,x=y.useMemo(()=>kC(e.rarity),[e.rarity]),C=y.useMemo(()=>[{label:"+5%",value:Math.max(1,Math.floor((e.basePrice||0)*.05))},{label:"+10%",value:Math.max(1,Math.floor((e.basePrice||0)*.1))},{label:"+50",value:50}],[e.basePrice]),w=n+Math.max(1,Math.floor((e.basePrice||0)*.05)),S=l||{enabled:!1,ceiling:""},h=b=>{const _=Number(p)||n;c(String(_+b))},g=()=>{o(e,p,c)},v=()=>{d(e.id,{enabled:!S.enabled})},j=b=>{const _=Number(b.replace(/[^0-9]/g,""));d(e.id,{ceiling:Number.isNaN(_)?"":_})},R=t.slice(-3).reverse();return r.jsxs("div",{style:{...Ge.item,borderColor:a?"#66bb6a":"#f5deb3",opacity:a?.6:1,padding:f("14px","12px"),gap:f("8px","6px")},children:[r.jsxs("div",{style:{...Ge.itemHeader,flexDirection:u?"column":"row",gap:u?"4px":"0"},children:[r.jsx("div",{style:{fontWeight:"bold",color:"#4e342e",fontSize:f("14px","13px")},children:e.name}),r.jsxs("div",{style:{color:"#ffb300",fontWeight:"bold",fontSize:f("14px","13px")},children:[n," "]})]}),r.jsx("div",{style:{...Ge.desc,fontSize:f("13px","12px")},children:e.description}),r.jsxs("div",{style:{...Ge.chipRow,gap:f("6px","4px")},children:[r.jsx("span",{style:{...Ge.chip,fontSize:f("11px","10px")},children:x}),r.jsxs("span",{style:{...Ge.chip,fontSize:f("11px","10px")},children:[" ",Math.max(1,Math.floor((e.basePrice||0)*.05))]}),a&&r.jsx("span",{style:{...Ge.chip,background:"#ef5350",color:"#fff",fontSize:f("11px","10px"),fontWeight:"bold"},children:""})]}),r.jsxs("div",{style:{...Ge.bidRow,flexDirection:u?"column":"row",gap:u?"4px":"0"},children:[r.jsxs("div",{style:{...Ge.bidMeta,fontSize:f("12px","11px")},children:["",s||""]}),r.jsxs("div",{style:{...Ge.bidMeta,fontSize:f("12px","11px")},children:["",w]})]}),r.jsxs("div",{style:{...Ge.inputRow,flexDirection:u?"column":"row"},children:[r.jsx("input",{value:p,onChange:b=>c(b.target.value),placeholder:` ${w}`,style:{...Ge.input,fontSize:f("13px","12px"),padding:f("8px","6px")},disabled:!!a}),r.jsx("button",{style:{...Ge.bidBtn,fontSize:f("13px","12px"),padding:f("8px 14px","6px 12px")},onClick:g,disabled:!!a,children:""}),r.jsx("button",{style:{...Ge.plotBtn,fontSize:f("13px","12px"),padding:f("8px 12px","6px 10px")},onClick:i,children:""})]}),r.jsx("div",{style:{...Ge.quickRow,flexWrap:u?"wrap":"nowrap"},children:C.map(b=>r.jsx("button",{style:{...Ge.quickBtn,flex:u?"1 1 30%":"1",fontSize:f("12px","11px")},disabled:!!a,onClick:()=>h(b.value),children:b.label},b.label))}),r.jsxs("div",{style:{...Ge.autoBidRow,flexDirection:u?"column":"row",alignItems:u?"flex-start":"center"},children:[r.jsxs("label",{style:{display:"flex",alignItems:"center",gap:8,fontSize:f("12px","11px")},children:[r.jsx("input",{type:"checkbox",checked:!!S.enabled,onChange:v,disabled:!!a}),r.jsx("span",{children:""})]}),r.jsx("input",{value:S.ceiling,onChange:b=>j(b.target.value),placeholder:"",style:{...Ge.input,width:f("120px","100%"),fontSize:f("13px","12px"),padding:f("8px","6px")},disabled:!S.enabled||a})]}),r.jsx("div",{style:{...Ge.history,fontSize:f("12px","11px")},children:R.map((b,_)=>r.jsxs("div",{style:{...Ge.historyRow,fontSize:f("12px","11px")},children:[r.jsx("span",{children:b.bidder}),r.jsxs("span",{children:[b.amount," "]})]},`${b.bidder}-${_}`))})]})},Ge={overlay:{position:"fixed",inset:0,backgroundColor:"rgba(0,0,0,0.7)",display:"flex",justifyContent:"center",alignItems:"center",zIndex:1200,padding:"20px",overflowY:"auto"},modalWrapper:{position:"relative",width:"min(1080px, 96vw)",maxHeight:"92vh"},modalShell:{position:"relative",background:"linear-gradient(160deg, rgba(29,24,18,0.95), rgba(36,28,22,0.92))",borderRadius:"24px",border:"1px solid rgba(255,255,255,0.08)",boxShadow:"0 25px 80px rgba(0,0,0,0.55)",padding:"24px",color:"#fcefdc",maxHeight:"92vh",overflow:"hidden",display:"flex",flexDirection:"column"},header:{position:"relative",display:"flex",justifyContent:"space-between",gap:"16px",borderBottom:"1px solid rgba(255,255,255,0.08)",paddingBottom:"16px"},headerActions:{display:"flex",alignItems:"center",gap:"12px"},title:{margin:0,fontSize:"24px",letterSpacing:"1px"},message:{margin:"6px 0 0",color:"#f5d7a0"},resourceChip:{background:"rgba(0,0,0,0.35)",padding:"6px 14px",borderRadius:"999px",fontWeight:"bold",border:"1px solid rgba(255,255,255,0.15)"},closeBtn:{border:"1px solid rgba(255,255,255,0.35)",background:"transparent",color:"#fff",borderRadius:"999px",padding:"6px 16px",cursor:"pointer"},body:{marginTop:"20px",overflow:"hidden"},catalogPanel:{flex:1,maxHeight:"60vh",overflowY:"auto",display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(260px, 1fr))",gap:"14px",paddingRight:"6px"},plotCard:{borderRadius:"18px",padding:"20px",background:"rgba(0,0,0,0.35)",border:"1px solid rgba(255,255,255,0.06)",flex:1,display:"flex",flexDirection:"column"},plotTitle:{margin:0,color:"#ffe0b2"},plotContent:{marginTop:"12px",whiteSpace:"pre-wrap",lineHeight:1.6,color:"#f8f0dd",overflowY:"auto"},backBtn:{marginTop:"auto",border:"1px solid rgba(255,255,255,0.4)",borderRadius:"12px",padding:"10px",background:"transparent",color:"#fff",cursor:"pointer"},item:{borderRadius:"16px",border:"1px solid #f5deb3",background:"rgba(255,252,247,0.9)",padding:"14px",display:"flex",flexDirection:"column",gap:"8px"},itemHeader:{display:"flex",justifyContent:"space-between"},desc:{fontSize:"13px",color:"#654321"},chipRow:{display:"flex",gap:"6px",flexWrap:"wrap"},chip:{padding:"2px 10px",borderRadius:"999px",background:"rgba(255,193,7,0.15)",border:"1px solid rgba(255,193,7,0.3)",fontSize:"11px",color:"#a15c00"},bidRow:{display:"flex",justifyContent:"space-between",fontSize:"12px",color:"#775c44"},bidMeta:{fontSize:"12px"},inputRow:{display:"flex",gap:"8px"},input:{flex:1,borderRadius:"10px",border:"1px solid #d7ccc8",padding:"8px"},bidBtn:{padding:"8px 14px",borderRadius:"10px",border:"none",background:"#8d6e63",color:"#fff",cursor:"pointer"},plotBtn:{padding:"8px 12px",borderRadius:"10px",border:"1px solid #d7ccc8",background:"transparent",cursor:"pointer"},quickRow:{display:"flex",gap:"8px"},quickBtn:{flex:1,padding:"6px 0",borderRadius:"8px",border:"1px dashed #c7b8a3",background:"transparent",cursor:"pointer"},autoBidRow:{display:"flex",alignItems:"center",justifyContent:"space-between",gap:"10px"},history:{marginTop:"8px",borderTop:"1px dashed #d7ccc8",paddingTop:"8px"},historyRow:{display:"flex",justifyContent:"space-between",fontSize:"12px"},feedbackOverlay:{position:"fixed",inset:0,background:"rgba(0,0,0,0.55)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1300,padding:"20px"},feedbackCard:{background:"#fffef8",borderRadius:"18px",padding:"24px",maxWidth:"420px",width:"100%",border:"2px solid",boxShadow:"0 18px 45px rgba(0,0,0,0.3)"},feedbackBtn:{marginTop:"16px",width:"100%",padding:"10px 12px",borderRadius:"12px",border:"none",background:"#6d4c41",color:"#fff",cursor:"pointer"}},bu={common:"#9e9e9e",uncommon:"#4caf50",rare:"#2196f3",epic:"#9c27b0",legendary:"#ff9800"},Yg=[{id:"ALL",label:"",matcher:()=>!0},{id:"CONSUMABLE",label:"",matcher:e=>e.type==="consumable"},{id:"EQUIPMENT",label:"",matcher:e=>["weapon","armor","accessory"].includes(e.type)},{id:"MANUAL",label:"",matcher:e=>e.type==="manual"},{id:"OTHER",label:"",matcher:e=>!["consumable","manual","weapon","armor","accessory"].includes(e.type)}],CC=({items:e=[],mode:t="VIEW",slot:n=null,childId:s=null,children:o=[],batchUseItems:i=[],onClose:a,onEquip:l,onUse:d,onBatchUse:u,onGiveToChild:p,onBatchGive:c,onSell:f,onDiscard:x,onAutoAssignManual:C,getMarketPrice:w})=>{const[S,h]=y.useState([]),[g,v]=y.useState(!1),[j,R]=y.useState("grid"),[b,_]=y.useState("ALL"),[I,k]=y.useState(!1),[T,N]=y.useState({}),[K,L]=y.useState(!1),[B,W]=y.useState({}),z=t==="VIEW",ne=e.some(D=>D.type==="manual");y.useEffect(()=>{t!=="VIEW"&&b!=="ALL"&&_("ALL")},[t,b]);const Q=D=>D.type!=="manual"?null:r.jsxs("div",{style:De.manualInfo,children:[D.tier&&r.jsx("span",{style:{...De.manualBadge,background:D.tierColor||"#999",marginRight:"8px"},children:D.tier}),D.element&&r.jsxs("span",{style:{...De.manualBadge,background:"#e3f2fd",color:"#1976d2",marginRight:"8px"},children:[": ",D.element]}),D.baseBonus&&r.jsxs("span",{style:{...De.manualBadge,background:"#e8f5e9",color:"#2e7d32"},children:[": ",D.baseBonus]})]}),se=t==="SELECT"&&n?e.filter(D=>D.slot===n):t==="MANUAL_SELECT"?e.filter(D=>D.type==="manual"):e,Me=(D=>{if(!z||b==="ALL")return D;const me=Yg.find(xe=>xe.id===b);return me?D.filter(me.matcher):D})(se),Pe={legendary:5,epic:4,rare:3,uncommon:2,common:1},Ke=[...Me].sort((D,me)=>{const xe=Pe[D.rarity]||0,ke=Pe[me.rarity]||0;return ke!==xe?ke-xe:(me.name||"")!==(D.name||"")?(D.name||"").localeCompare(me.name||""):(me.quantity||0)-(D.quantity||0)}),q=D=>!D||!Array.isArray(D.usageTargets)||D.usageTargets.length===0?!0:D.usageTargets.includes(ht.CHILD),de=D=>q(D)?D.type==="manual"?{allowed:!1,reason:""}:D.type==="consumable"?{allowed:!0,reason:""}:D.type==="weapon"||D.type==="armor"||D.type==="accessory"?{allowed:!0,reason:""}:{allowed:!1,reason:""}:{allowed:!1,reason:""},Z=D=>{S.includes(D)?h(S.filter(me=>me!==D)):h([...S,D])},re=()=>{if(S.length===0){window.showResult&&window.showResult("","",!1,null,!1);return}const D=S.filter(xe=>{const ke=e.find(Ee=>Ee.instanceId===xe);return ke&&de(ke).allowed});if(D.length===0){window.showResult&&window.showResult("","",!1,null,!1);return}L(!0),v(!1);const me={};D.forEach(xe=>{e.find(Ee=>Ee.instanceId===xe)&&(me[xe]=1)}),W(me)},ce={consumable:"",weapon:"",armor:"",accessory:"",manual:""},le={consumable:"",weapon:"",armor:"",accessory:"",manual:""},we={weapon:"",armor:"",accessory:""},Ue=D=>D.icon||D.emoji||le[D.type]||"",Oe=D=>{if(D.type==="consumable"&&D.effect){const ke=D.effect;if(ke.kind==="exp")return` +${ke.amount}`;if(ke.kind==="aptitude")return` +${ke.amount}`;if(ke.kind==="intelligence")return` +${ke.amount}`;if(ke.kind==="heal")return` +${ke.amount}`}if(D.type==="manual"&&D.manualIds)return` ${D.manualIds.length} `;const me=D.stats||{},xe=[];return me.atk&&xe.push(` +${me.atk}`),me.hp&&xe.push(` +${me.hp}`),me.mp&&xe.push(` +${me.mp}`),xe.join(" / ")},ze=D=>{if(g)return null;const me=[];return t==="SELECT"&&D.slot===n&&me.push(r.jsx("button",{style:De.btnPrimary,onClick:xe=>{xe.stopPropagation(),l&&l(D.instanceId)},children:""},"equip")),t==="MANUAL_SELECT"&&D.type==="manual"&&me.push(r.jsx("button",{style:De.btnPrimary,onClick:xe=>{xe.stopPropagation(),d&&d(D.instanceId)},children:""},"manual")),t==="VIEW"&&D.type==="consumable"&&me.push(r.jsx("button",{style:De.btnPrimary,onClick:xe=>{xe.stopPropagation(),d&&d(D.instanceId)},children:s?"":""},"use")),t==="VIEW"&&D.type==="manual"&&me.push(r.jsx("button",{style:De.btnPrimary,onClick:xe=>{xe.stopPropagation(),d&&d(D.instanceId)},children:s?"":""},"study")),t==="VIEW"&&!s&&me.push(r.jsx("button",{style:{...De.btnSecondary,background:"#e53935"},onClick:xe=>{xe.stopPropagation(),window.showConfirm?window.showConfirm(` ${D.name}${D.quantity&&D.quantity>1?" () ":""}`,()=>{x&&x(D.instanceId)}):x&&x(D.instanceId)},children:""},"discard")),t==="VIEW"&&!s&&o&&o.length>0&&me.push(r.jsx("button",{style:De.btnSecondary,onClick:xe=>{xe.stopPropagation(),p&&p(D.instanceId)},children:""},"give")),t==="SELL"&&me.push(r.jsx("button",{style:{...De.btnPrimary,background:"#f57c00"},onClick:xe=>{if(xe.stopPropagation(),!!f){if(D.quantity&&D.quantity>1&&window.showConfirm){window.showConfirm(`1-${D.quantity}`,ke=>{const Ee=parseInt(ke||`${D.quantity}`,10);if(!Ee||Ee<=0){window.showResult&&window.showResult("","",!1,null,!1);return}f(D.instanceId,Math.min(Ee,D.quantity||1))},{input:{type:"number",min:1,max:D.quantity||1,step:1,defaultValue:`${D.quantity}`}});return}f(D.instanceId,1)}},children:""},"sell")),me.length?me:null};return r.jsx("div",{style:De.overlay,children:r.jsxs("div",{style:De.modal,children:[r.jsxs("div",{style:De.header,children:[r.jsx("h3",{style:{margin:0},children:t==="SELECT"?"":""}),r.jsx("button",{style:De.close,onClick:a,children:""})]}),r.jsx("div",{style:De.tip,children:t==="SELECT"&&n?`${we[n]||n}`:t==="MANUAL_SELECT"?"":t==="SELL"?"":""}),r.jsxs("div",{style:De.toolbar,children:[r.jsxs("span",{style:De.toolbarMeta,children:[" ",Ke.length,"   ",j==="grid"?"":""]}),r.jsxs("div",{style:De.viewSwitch,children:[r.jsx("button",{type:"button",style:j==="grid"?{...De.viewBtn,...De.viewBtnActive}:De.viewBtn,onClick:()=>R("grid"),children:" "}),r.jsx("button",{type:"button",style:j==="list"?{...De.viewBtn,...De.viewBtnActive}:De.viewBtn,onClick:()=>R("list"),children:" "})]})]}),z&&r.jsxs("div",{style:De.categoryBar,children:[r.jsx("div",{style:De.categoryGroup,children:Yg.map(D=>r.jsx("button",{type:"button",onClick:()=>_(D.id),style:b===D.id?{...De.categoryBtn,...De.categoryBtnActive}:De.categoryBtn,children:D.label},D.id))}),C&&r.jsx("button",{type:"button",onClick:C,disabled:!ne||!(o&&o.length),style:{...De.autoAssignBtn,opacity:!ne||!(o&&o.length)?.5:1,cursor:!ne||!(o&&o.length)?"not-allowed":"pointer"},children:" "})]}),t==="VIEW"&&!s&&r.jsxs("div",{style:{padding:"10px 16px",borderBottom:"1px solid #eee",background:g?"#e3f2fd":"#f5f5f5",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[r.jsx("button",{onClick:()=>{v(!g),h([])},style:{padding:"6px 12px",border:"none",borderRadius:"6px",background:g?"#1976d2":"#757575",color:"#fff",cursor:"pointer",fontSize:"12px"},children:g?" ":" "}),g&&r.jsxs("div",{style:{display:"flex",gap:"8px",alignItems:"center"},children:[r.jsxs("span",{style:{fontSize:"12px",color:"#666"},children:[" ",S.length," "]}),!s&&r.jsx("button",{onClick:()=>{if(S.length===0){window.showResult&&window.showResult("","",!1,null,!1);return}k(!0),v(!1);const D={};S.forEach(me=>{const xe=e.find(ke=>ke.instanceId===me);xe&&xe.type==="consumable"&&(D[me]=1)}),N(D)},disabled:S.length===0,style:{padding:"6px 12px",border:"none",borderRadius:"6px",background:S.length>0?"#4caf50":"#ccc",color:"#fff",cursor:S.length>0?"pointer":"not-allowed",fontSize:"12px"},children:""}),o&&o.length>0&&r.jsx("button",{onClick:re,disabled:S.length===0,style:{padding:"6px 12px",border:"none",borderRadius:"6px",background:S.length>0?"#7b1fa2":"#ccc",color:"#fff",cursor:S.length>0?"pointer":"not-allowed",fontSize:"12px"},children:""}),t==="SELL"&&r.jsx("button",{onClick:()=>{if(!f)return;if(S.length===0){window.showResult&&window.showResult("","",!1,null,!1);return}const D=S.map(ke=>{const Ee=e.find(Xe=>Xe.instanceId===ke);return Ee?{instanceId:ke,qty:Ee.quantity||1}:null}).filter(Boolean);let me=0;const xe=()=>{if(me>=D.length){h([]),v(!1);return}const{instanceId:ke,qty:Ee}=D[me];f(ke,Ee),me++,setTimeout(xe,50)};xe()},disabled:S.length===0,style:{padding:"6px 12px",border:"none",borderRadius:"6px",background:S.length>0?"#f57c00":"#ccc",color:"#fff",cursor:S.length>0?"pointer":"not-allowed",fontSize:"12px"},children:""}),o&&o.length>0&&r.jsx("button",{onClick:()=>{const D=Me.filter(me=>de(me).allowed).map(me=>me.instanceId);h(D)},style:{padding:"6px 12px",border:"none",borderRadius:"6px",background:"#00897b",color:"#fff",cursor:"pointer",fontSize:"12px"},children:""})]})]}),I&&r.jsxs("div",{style:{padding:"16px",background:"#e8f5e9",borderBottom:"1px solid #c8e6c9",borderRadius:"8px",margin:"8px"},children:[r.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"12px"},children:[r.jsx("h4",{style:{margin:0,color:"#2e7d32"},children:" "}),r.jsx("button",{onClick:()=>{k(!1),N({}),h([])},style:{padding:"4px 8px",border:"none",borderRadius:"4px",background:"#757575",color:"#fff",cursor:"pointer",fontSize:"11px"},children:""})]}),r.jsx("div",{style:{maxHeight:"200px",overflowY:"auto",marginBottom:"12px"},children:Object.keys(T).map(D=>{const me=e.find(Ee=>Ee.instanceId===D);if(!me)return null;const xe=me.quantity||1,ke=T[D]||1;return r.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",padding:"8px",background:"#fff",borderRadius:"6px",marginBottom:"8px",border:"1px solid #c8e6c9"},children:[r.jsxs("span",{style:{fontSize:"13px",flex:1},children:[Ue(me)," ",me.name,r.jsxs("span",{style:{color:"#999",marginLeft:"8px"},children:["(: ",xe,")"]})]}),r.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[r.jsx("button",{onClick:()=>{const Ee=Math.max(1,ke-1);N(Xe=>({...Xe,[D]:Ee}))},disabled:ke<=1,style:{width:"24px",height:"24px",border:"none",borderRadius:"4px",background:ke<=1?"#e0e0e0":"#4caf50",color:"#fff",cursor:ke<=1?"not-allowed":"pointer",fontSize:"16px",lineHeight:"1"},children:"-"}),r.jsx("input",{type:"number",min:"1",max:xe,value:ke,onChange:Ee=>{const Xe=parseInt(Ee.target.value)||1,Mt=Math.max(1,Math.min(xe,Xe));N(pn=>({...pn,[D]:Mt}))},style:{width:"50px",padding:"4px",textAlign:"center",border:"1px solid #c8e6c9",borderRadius:"4px",fontSize:"13px"}}),r.jsx("button",{onClick:()=>{const Ee=Math.min(xe,ke+1);N(Xe=>({...Xe,[D]:Ee}))},disabled:ke>=xe,style:{width:"24px",height:"24px",border:"none",borderRadius:"4px",background:ke>=xe?"#e0e0e0":"#4caf50",color:"#fff",cursor:ke>=xe?"not-allowed":"pointer",fontSize:"16px",lineHeight:"1"},children:"+"}),r.jsx("button",{onClick:()=>{const Ee={...T};delete Ee[D],N(Ee),h(Xe=>Xe.filter(Mt=>Mt!==D))},style:{padding:"4px 8px",border:"none",borderRadius:"4px",background:"#f44336",color:"#fff",cursor:"pointer",fontSize:"11px"},children:""})]})]},D)})}),r.jsx("div",{style:{display:"flex",gap:"8px",justifyContent:"flex-end"},children:r.jsx("button",{onClick:()=>{const D=Object.keys(T).map(me=>({instanceId:me,quantity:T[me]}));if(D.length===0){window.showResult&&window.showResult("","",!1,null,!1);return}u&&u(s||null,D),k(!1),N({}),h([])},style:{padding:"8px 16px",border:"none",borderRadius:"6px",background:"#4caf50",color:"#fff",cursor:"pointer",fontSize:"13px",fontWeight:"bold"},children:" "})})]}),K&&r.jsxs("div",{style:{padding:"16px",background:"#f3e5f5",borderBottom:"1px solid #e1bee7",borderRadius:"8px",margin:"8px"},children:[r.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"12px"},children:[r.jsx("h4",{style:{margin:0,color:"#7b1fa2"},children:" "}),r.jsx("button",{onClick:()=>{L(!1),W({}),h([])},style:{padding:"4px 8px",border:"none",borderRadius:"4px",background:"#757575",color:"#fff",cursor:"pointer",fontSize:"11px"},children:""})]}),r.jsx("div",{style:{maxHeight:"200px",overflowY:"auto",marginBottom:"12px"},children:Object.keys(B).map(D=>{const me=e.find(Ee=>Ee.instanceId===D);if(!me)return null;const xe=me.quantity||1,ke=B[D]||1;return r.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",padding:"8px",background:"#fff",borderRadius:"6px",marginBottom:"8px",border:"1px solid #e1bee7"},children:[r.jsxs("span",{style:{fontSize:"13px",flex:1},children:[Ue(me)," ",me.name,r.jsxs("span",{style:{color:"#999",marginLeft:"8px"},children:["(: ",xe,")"]})]}),r.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[r.jsx("button",{onClick:()=>{const Ee=Math.max(1,ke-1);W(Xe=>({...Xe,[D]:Ee}))},disabled:ke<=1,style:{width:"24px",height:"24px",border:"none",borderRadius:"4px",background:ke<=1?"#e0e0e0":"#7b1fa2",color:"#fff",cursor:ke<=1?"not-allowed":"pointer",fontSize:"16px",lineHeight:"1"},children:"-"}),r.jsx("input",{type:"number",min:"1",max:xe,value:ke,onChange:Ee=>{const Xe=parseInt(Ee.target.value)||1,Mt=Math.max(1,Math.min(xe,Xe));W(pn=>({...pn,[D]:Mt}))},style:{width:"50px",padding:"4px",textAlign:"center",border:"1px solid #e1bee7",borderRadius:"4px",fontSize:"13px"}}),r.jsx("button",{onClick:()=>{const Ee=Math.min(xe,ke+1);W(Xe=>({...Xe,[D]:Ee}))},disabled:ke>=xe,style:{width:"24px",height:"24px",border:"none",borderRadius:"4px",background:ke>=xe?"#e0e0e0":"#7b1fa2",color:"#fff",cursor:ke>=xe?"not-allowed":"pointer",fontSize:"16px",lineHeight:"1"},children:"+"}),r.jsx("button",{onClick:()=>{const Ee={...B};delete Ee[D],W(Ee),h(Xe=>Xe.filter(Mt=>Mt!==D))},style:{padding:"4px 8px",border:"none",borderRadius:"4px",background:"#f44336",color:"#fff",cursor:"pointer",fontSize:"11px"},children:""})]})]},D)})}),r.jsx("div",{style:{display:"flex",gap:"8px",justifyContent:"flex-end"},children:r.jsx("button",{onClick:()=>{const D=Object.keys(B).map(xe=>({instanceId:xe,quantity:B[xe]}));if(D.length===0){window.showResult&&window.showResult("","",!1,null,!1);return}const me=D.map(({instanceId:xe,quantity:ke})=>({instanceId:xe,quantity:ke}));c&&c(me),L(!1),W({}),h([])},style:{padding:"8px 16px",border:"none",borderRadius:"6px",background:"#7b1fa2",color:"#fff",cursor:"pointer",fontSize:"13px",fontWeight:"bold"},children:" "})})]}),r.jsxs("div",{style:De.list,children:[Ke.length===0&&r.jsx("div",{style:De.empty,children:""}),Ke.length>0&&r.jsx("div",{style:j==="grid"?De.gridContainer:De.listContainer,children:Ke.map(D=>{const me=S.includes(D.instanceId),xe=de(D),ke=ze(D),Ee=t==="SELL"?Math.floor((w?w(D):D.sellPrice||D.price||0)*.7):null;return j==="grid"?r.jsxs("div",{style:{...De.gridCard,borderColor:me?"#1976d2":"rgba(0,0,0,0.05)",borderWidth:"2px",boxShadow:me?"0 0 0 1px #1976d2":"0 6px 16px rgba(0,0,0,0.08)",cursor:g?"pointer":"default"},onClick:()=>{g&&Z(D.instanceId)},children:[g&&r.jsx("input",{type:"checkbox",checked:me,onChange:Xe=>{Xe.stopPropagation(),Z(D.instanceId)},style:De.gridCheckbox}),r.jsxs("div",{style:De.gridMain,children:[r.jsx("div",{style:{...De.gridIcon,borderColor:bu[D.rarity]||"#d7ccc8",borderWidth:"2px",borderStyle:"solid"},children:r.jsx("span",{children:Ue(D)})}),r.jsxs("div",{style:De.gridBody,children:[r.jsxs("div",{style:De.gridTitleRow,children:[r.jsx("span",{style:{color:bu[D.rarity]||"#333",fontWeight:"bold"},children:D.name}),D.quantity&&D.quantity>1&&r.jsxs("span",{style:De.gridQty,children:["x",D.quantity]})]}),r.jsxs("div",{style:De.gridMeta,children:[r.jsx("span",{style:De.gridTag,children:ce[D.type]||D.type}),r.jsx("span",{style:{fontSize:"11px",color:"#5d4037"},children:Oe(D)||""})]}),r.jsx("div",{style:De.gridDesc,children:D.desc}),Q(D),Ee!==null&&r.jsxs("div",{style:De.gridPrice,children:[": ",Ee," "]}),g&&!xe.allowed&&r.jsxs("div",{style:De.gridWarning,children:[" ",xe.reason]})]})]}),ke&&r.jsx("div",{style:De.gridActions,children:ke})]},D.instanceId):r.jsxs("div",{style:{...De.card,borderColor:me?"#1976d2":"#eee",borderWidth:me?"2px":"1px",background:me?"#e3f2fd":"#fafafa",cursor:g?"pointer":"default"},onClick:()=>{g&&Z(D.instanceId)},children:[r.jsxs("div",{style:De.rowBetween,children:[r.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[g&&r.jsx("input",{type:"checkbox",checked:me,onChange:Xe=>{Xe.stopPropagation(),Z(D.instanceId)},style:{cursor:"pointer"}}),r.jsx("span",{style:{color:bu[D.rarity]||"#333",fontWeight:"bold"},children:D.name}),D.quantity&&D.quantity>1&&r.jsxs("span",{style:{fontSize:"12px",color:"#666",marginLeft:"6px"},children:["x",D.quantity]})]}),r.jsx("span",{style:De.tag,children:ce[D.type]||D.type})]}),Q(D),r.jsx("div",{style:De.desc,children:D.desc}),r.jsx("div",{style:De.stats,children:Oe(D)||""}),Ee!==null&&r.jsxs("div",{style:{fontSize:"12px",color:"#f57c00",marginTop:6},children:[": ",Ee," "]}),g&&!xe.allowed&&r.jsxs("div",{style:{fontSize:"11px",color:"#f44336",marginTop:"4px",padding:"4px 8px",background:"rgba(244, 67, 54, 0.1)",borderRadius:"4px"},children:[" ",xe.reason]}),ke&&r.jsx("div",{style:De.actions,children:ke})]},D.instanceId)})})]})]})})},De={overlay:{position:"fixed",inset:0,background:"rgba(0,0,0,0.5)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:2e3},modal:{width:"520px",maxHeight:"80vh",background:"#fff",borderRadius:"12px",boxShadow:"0 10px 25px rgba(0,0,0,0.2)",display:"flex",flexDirection:"column"},header:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"12px 16px",borderBottom:"1px solid #eee"},close:{border:"none",background:"transparent",fontSize:"20px",cursor:"pointer",color:"#888"},tip:{padding:"8px 16px",fontSize:"12px",color:"#666",borderBottom:"1px dashed #eee"},toolbar:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"10px 16px",borderBottom:"1px solid #f0e0d6",background:"#fffbe6"},toolbarMeta:{fontSize:"12px",color:"#8d6e63"},viewSwitch:{display:"flex",gap:"6px"},viewBtn:{fontSize:"12px",padding:"4px 10px",borderRadius:"999px",border:"1px solid #d7ccc8",background:"#fff",cursor:"pointer",color:"#6d4c41"},viewBtnActive:{background:"#6d4c41",color:"#fff",borderColor:"#6d4c41"},categoryBar:{display:"flex",justifyContent:"space-between",alignItems:"center",gap:"12px",padding:"8px 16px",borderBottom:"1px solid #f0f0f0",background:"#fff"},categoryGroup:{display:"flex",flexWrap:"wrap",gap:"8px"},categoryBtn:{fontSize:"12px",padding:"4px 12px",borderRadius:"12px",border:"1px solid #d7ccc8",background:"#fff",color:"#6d4c41",cursor:"pointer",transition:"all 0.2s"},categoryBtnActive:{background:"#6d4c41",color:"#fff",borderColor:"#6d4c41",boxShadow:"0 2px 6px rgba(0,0,0,0.1)"},autoAssignBtn:{fontSize:"12px",padding:"6px 14px",borderRadius:"16px",border:"none",background:"linear-gradient(120deg, #ff9800, #ff5722)",color:"#fff",fontWeight:"bold"},list:{padding:"12px",overflowY:"auto"},listContainer:{display:"flex",flexDirection:"column",gap:"10px"},gridContainer:{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(180px, 1fr))",gap:"12px"},empty:{textAlign:"center",color:"#999",padding:"20px"},card:{borderWidth:"1px",borderStyle:"solid",borderColor:"#eee",borderRadius:"8px",padding:"10px",marginBottom:"10px",background:"#fafafa"},gridCard:{position:"relative",borderRadius:"12px",padding:"14px",background:"#fff",display:"flex",flexDirection:"column",gap:"10px",borderStyle:"solid",borderColor:"rgba(0,0,0,0.05)"},gridMain:{display:"flex",gap:"10px",alignItems:"flex-start"},rowBetween:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"6px"},tag:{fontSize:"10px",padding:"2px 6px",borderRadius:"6px",background:"#e0e0e0",color:"#555",textTransform:"uppercase"},desc:{fontSize:"12px",color:"#555",marginBottom:"6px"},stats:{fontSize:"12px",color:"#333",marginBottom:"8px"},actions:{display:"flex",gap:"8px",flexWrap:"wrap"},gridIcon:{width:"54px",height:"54px",borderRadius:"12px",borderWidth:"2px",borderStyle:"solid",borderColor:"#d7ccc8",display:"flex",alignItems:"center",justifyContent:"center",fontSize:"24px",color:"#4e342e"},gridBody:{display:"flex",flexDirection:"column",gap:"6px"},gridTitleRow:{display:"flex",justifyContent:"space-between",alignItems:"center"},gridQty:{fontSize:"12px",color:"#6d4c41"},gridMeta:{display:"flex",flexDirection:"column",alignItems:"flex-start",gap:"4px"},gridTag:{fontSize:"10px",padding:"2px 6px",borderRadius:"999px",background:"#f3e5f5",color:"#6a1b9a"},gridDesc:{fontSize:"11px",color:"#5d4037",lineHeight:1.4,minHeight:"32px"},gridActions:{display:"flex",flexWrap:"wrap",gap:"6px"},gridCheckbox:{position:"absolute",top:"10px",left:"10px",cursor:"pointer"},gridWarning:{fontSize:"11px",color:"#c62828",background:"rgba(198,40,40,0.08)",padding:"4px 8px",borderRadius:"6px"},gridPrice:{fontSize:"11px",color:"#f57c00",fontWeight:"bold"},btnPrimary:{padding:"6px 12px",border:"none",borderRadius:"6px",background:"#1976d2",color:"#fff",cursor:"pointer"},btnSecondary:{padding:"6px 12px",border:"none",borderRadius:"6px",background:"#7b1fa2",color:"#fff",cursor:"pointer",fontSize:"12px"},manualInfo:{display:"flex",flexWrap:"wrap",gap:"6px",marginTop:"8px",marginBottom:"8px"},manualBadge:{fontSize:"11px",padding:"3px 8px",borderRadius:"12px",color:"#fff",fontWeight:"bold",whiteSpace:"nowrap"}},TC=({child:e,onClose:t,onFinish:n})=>{const[s,o]=y.useState("INIT"),i=()=>{o("ANIMATING"),setTimeout(()=>{o("REVEAL")},2e3)},a=()=>{n(e),t()},l=d=>({:"#FFD700",:"#4CAF50",:"#2196F3",:"#F44336",:"#795548",:"#673AB7",:"#00BCD4",:"#009688"})[d]||"#ccc";return r.jsx("div",{style:vr.overlay,children:r.jsxs("div",{style:vr.card,children:[r.jsx("h2",{style:{color:"#3e2723"},children:" "}),s==="INIT"&&r.jsxs("div",{style:{textAlign:"center"},children:[r.jsx("h3",{style:{margin:"0 0 15px 0",color:"#3e2723"},children:e.name}),r.jsx("p",{children:""}),r.jsxs("p",{children:["",e.gender===""?"":"",""]}),r.jsx("div",{style:vr.childIcon,children:e.gender===""?"":""}),r.jsx("button",{onClick:i,style:vr.btn,children:" "})]}),s==="ANIMATING"&&r.jsxs("div",{style:{textAlign:"center"},children:[r.jsx("h3",{style:{margin:"0 0 15px 0",color:"#3e2723"},children:e.name}),r.jsx("div",{style:vr.orb}),r.jsx("p",{children:"..."})]}),s==="REVEAL"&&r.jsxs("div",{style:{textAlign:"center",animation:"fadeIn 0.5s"},children:[r.jsx("h3",{style:{margin:"0 0 15px 0",color:"#3e2723"},children:e.name}),r.jsx("h3",{children:"  "}),r.jsxs("div",{style:vr.resultBox,children:[r.jsx("div",{style:{color:e.spiritRoot.color,fontSize:"24px",fontWeight:"bold"},children:e.spiritRoot.type}),r.jsx("div",{style:vr.elements,children:e.spiritRoot.elements.map(d=>r.jsx("span",{style:{...vr.elBadge,background:l(d)},children:d},d))}),r.jsxs("div",{style:{marginTop:"15px"},children:[r.jsx("span",{style:{fontSize:"12px",color:"#666"},children:""}),r.jsxs("div",{style:{fontSize:"40px",fontWeight:"bold",color:"#333"},children:[e.stats.aptitude,r.jsx("span",{style:{fontSize:"14px",color:"#999"},children:"/100"})]})]}),r.jsx("p",{style:{fontSize:"12px",color:"#666",marginTop:"10px"},children:e.spiritRoot.desc})]}),r.jsxs("div",{style:vr.stats,children:[r.jsxs("p",{children:[": ",r.jsx("strong",{children:e.stats.aptitude})]}),r.jsxs("p",{children:[": ",r.jsx("strong",{children:e.combatStats.mp})]})]}),r.jsx("button",{onClick:a,style:vr.confirmBtn,children:""})]})]})})},vr={overlay:{position:"fixed",top:0,left:0,right:0,bottom:0,background:"rgba(0,0,0,0.8)",display:"flex",justifyContent:"center",alignItems:"center",zIndex:400},card:{width:"320px",background:"#fff",borderRadius:"15px",padding:"30px",textAlign:"center",boxShadow:"0 0 20px rgba(255, 215, 0, 0.3)"},btn:{padding:"15px 30px",fontSize:"18px",background:"#3e2723",color:"white",border:"none",borderRadius:"25px",cursor:"pointer",marginTop:"20px"},confirmBtn:{padding:"10px 20px",background:"#4caf50",color:"white",border:"none",borderRadius:"5px",marginTop:"20px",cursor:"pointer"},orb:{width:"80px",height:"80px",borderRadius:"50%",background:"radial-gradient(circle, #fff, #2196f3, #000)",margin:"20px auto",animation:"pulse 1s infinite"},childIcon:{fontSize:"50px",margin:"20px 0"},resultBox:{background:"#f5f5f5",padding:"15px",borderRadius:"10px",margin:"20px 0"},elements:{display:"flex",justifyContent:"center",gap:"5px",marginBottom:"10px"},elBadge:{padding:"4px 8px",borderRadius:"50%",color:"white",fontWeight:"bold",width:"24px",height:"24px",lineHeight:"24px"},stats:{display:"flex",justifyContent:"space-around",fontSize:"14px",borderTop:"1px dashed #ccc",paddingTop:"15px"}},IC=["","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","",""],qg=(e="")=>{if(!e)return 0;const t=IC.indexOf(e);return t>=0?t:0},vu=8,RC=({children:e,item:t,items:n,isBatch:s=!1,onSelect:o,onClose:i})=>{const[a,l]=y.useState(null),[d,u]=y.useState("age"),[p,c]=y.useState(1),f=y.useMemo(()=>{const w=[...e];return w.sort((S,h)=>{var g,v;switch(d){case"age":return S.age-h.age;case"aptitude":return(((g=h.stats)==null?void 0:g.aptitude)||0)-(((v=S.stats)==null?void 0:v.aptitude)||0);case"cultivation":const j=qg(S.tier||""),R=qg(h.tier||"");if(j!==R)return R-j;const b=S.currentExp||0;return(h.currentExp||0)-b;case"name":return S.name.localeCompare(h.name,"zh-CN");default:return 0}}),w},[e,d]),x=Math.max(1,Math.ceil(f.length/vu)),C=y.useMemo(()=>{const w=(p-1)*vu;return f.slice(w,w+vu)},[f,p]);return _c.useEffect(()=>{c(1)},[d]),r.jsx("div",{style:ft.overlay,children:r.jsxs("div",{style:ft.modal,children:[r.jsxs("div",{style:ft.header,children:[r.jsx("h3",{style:{margin:0},children:""}),r.jsx("button",{style:ft.close,onClick:i,children:""})]}),r.jsx("div",{style:ft.tip,children:s?r.jsxs(r.Fragment,{children:[" ",r.jsx("strong",{style:{color:"#1976d2"},children:(n==null?void 0:n.length)||0})," ",r.jsxs("div",{style:{marginTop:"6px",fontSize:"11px",color:"#666"},children:[n==null?void 0:n.slice(0,3).map((w,S)=>r.jsxs("span",{style:{marginRight:"8px"},children:[" ",w.name]},S)),(n==null?void 0:n.length)>3&&`...${n.length}`]})]}):r.jsxs(r.Fragment,{children:[" ",r.jsx("strong",{style:{color:"#1976d2"},children:t==null?void 0:t.name})," "]})}),r.jsx("div",{style:ft.controlBar,children:r.jsxs("div",{style:ft.sortButtons,children:[r.jsx("button",{style:{...ft.sortBtn,...d==="age"?ft.sortBtnActive:{}},onClick:()=>u("age"),children:""}),r.jsx("button",{style:{...ft.sortBtn,...d==="cultivation"?ft.sortBtnActive:{}},onClick:()=>u("cultivation"),children:""}),r.jsx("button",{style:{...ft.sortBtn,...d==="aptitude"?ft.sortBtnActive:{}},onClick:()=>u("aptitude"),children:""}),r.jsx("button",{style:{...ft.sortBtn,...d==="name"?ft.sortBtnActive:{}},onClick:()=>u("name"),children:""})]})}),r.jsxs("div",{style:ft.list,children:[e.length===0&&r.jsx("div",{style:ft.empty,children:""}),C.map((w,S)=>{var h;return r.jsxs("div",{style:{...ft.childCard,...a===w.id?ft.childCardHover:{}},onClick:()=>o(w),onMouseEnter:()=>l(w.id),onMouseLeave:()=>l(null),children:[r.jsxs("div",{style:ft.childInfo,children:[r.jsxs("div",{style:ft.childHeader,children:[r.jsx("span",{style:ft.childName,children:w.name}),r.jsx("span",{style:ft.childTier,children:w.tierTitle||""})]}),r.jsxs("div",{style:ft.childStats,children:[r.jsxs("span",{children:[" ",Math.floor(w.age),""]}),r.jsxs("span",{children:[" ",w.gender]}),r.jsxs("span",{children:["  ",((h=w.stats)==null?void 0:h.aptitude)||50]})]})]}),r.jsx("div",{style:ft.arrow,children:""})]},w.id)})]}),x>1&&r.jsxs("div",{style:ft.pagination,children:[r.jsx("button",{style:{...ft.pageBtn,opacity:p===1?.5:1},disabled:p===1,onClick:()=>c(Math.max(1,p-1)),children:""}),r.jsxs("span",{style:ft.pageInfo,children:[" ",p," / ",x," "]}),r.jsx("button",{style:{...ft.pageBtn,opacity:p>=x?.5:1},disabled:p>=x,onClick:()=>c(Math.min(x,p+1)),children:""})]})]})})},ft={overlay:{position:"fixed",inset:0,background:"rgba(0,0,0,0.5)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:2100},modal:{width:"450px",maxHeight:"70vh",background:"#fff",borderRadius:"12px",boxShadow:"0 10px 25px rgba(0,0,0,0.2)",display:"flex",flexDirection:"column"},header:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"12px 16px",borderBottom:"1px solid #eee"},close:{border:"none",background:"transparent",fontSize:"20px",cursor:"pointer",color:"#888"},tip:{padding:"12px 16px",fontSize:"13px",color:"#555",background:"#f5f5f5",borderBottom:"1px solid #eee"},controlBar:{padding:"12px 12px",borderBottom:"1px solid #eee",backgroundColor:"#fafafa"},sortButtons:{display:"flex",gap:"6px",flexWrap:"wrap"},sortBtn:{padding:"6px 12px",fontSize:"11px",backgroundColor:"#f0f0f0",color:"#666",border:"1px solid #ddd",borderRadius:"4px",cursor:"pointer",transition:"all 0.2s"},sortBtnActive:{backgroundColor:"#1976d2",color:"#fff",borderColor:"#1976d2"},list:{padding:"12px",overflowY:"auto",flex:1},empty:{textAlign:"center",color:"#999",padding:"20px"},childCard:{borderWidth:"1px",borderStyle:"solid",borderColor:"#e0e0e0",borderRadius:"8px",padding:"12px",marginBottom:"10px",background:"#fafafa",cursor:"pointer",display:"flex",justifyContent:"space-between",alignItems:"center",transition:"all 0.2s"},childCardHover:{background:"#e3f2fd",borderColor:"#1976d2",borderWidth:"1px",borderStyle:"solid"},childInfo:{flex:1},childHeader:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"6px"},childName:{fontSize:"15px",fontWeight:"bold",color:"#333"},childTier:{fontSize:"11px",padding:"2px 8px",borderRadius:"10px",background:"#3e2723",color:"#fff"},childStats:{display:"flex",gap:"12px",fontSize:"12px",color:"#666"},arrow:{fontSize:"20px",color:"#1976d2",marginLeft:"10px"},pagination:{display:"flex",justifyContent:"center",alignItems:"center",gap:"8px",padding:"12px 16px",borderTop:"1px solid #eee",backgroundColor:"#fafafa"},pageBtn:{padding:"6px 12px",fontSize:"11px",backgroundColor:"#f0f0f0",color:"#666",border:"1px solid #ddd",borderRadius:"4px",cursor:"pointer",transition:"all 0.2s"},pageInfo:{color:"#666",fontSize:"12px",minWidth:"70px",textAlign:"center"}},_C=({child:e,onChangeManual:t})=>{if(!e.spiritRoot||!e.spiritRoot.elements)return r.jsxs("div",{style:Kt.section,children:[r.jsx("h4",{style:Kt.secTitle,children:" "}),r.jsx("p",{style:{color:"#999",fontSize:"12px"},children:"(6)"})]});const n=e.cultivationMethod||"basic_breath",s=Ic(n,e.spiritRoot);if(!s.manual)return r.jsxs("div",{style:Kt.section,children:[r.jsx("h4",{style:Kt.secTitle,children:" "}),r.jsx("p",{style:{color:"#999",fontSize:"12px"},children:""})]});const{manual:o,compatibility:i,speedBonus:a}=s,l=i.color||"#999";return r.jsxs("div",{style:Kt.section,children:[r.jsx("h4",{style:Kt.secTitle,children:" "}),r.jsxs("div",{style:Kt.manualCard,children:[r.jsxs("div",{style:Kt.manualHeader,children:[r.jsxs("div",{style:Kt.manualName,children:[o.name,r.jsx("span",{style:{...Kt.tierBadge,background:o.tierColor,marginLeft:"8px"},children:o.tierName})]}),o.element!=="NONE"&&r.jsx("div",{style:Kt.elementBadge,children:o.element})]}),r.jsx("div",{style:Kt.manualDesc,children:o.desc}),r.jsxs("div",{style:{...Kt.compatibilityBox,borderColor:l},children:[r.jsxs("div",{style:Kt.compatibilityRow,children:[r.jsx("span",{children:""}),r.jsx("span",{style:{color:l,fontWeight:"bold"},children:i.desc})]}),r.jsxs("div",{style:Kt.compatibilityRow,children:[r.jsx("span",{children:""}),r.jsxs("span",{style:{color:"#2196F3",fontWeight:"bold"},children:["+",a]})]})]}),r.jsx("div",{style:Kt.actionRow,children:r.jsx("button",{style:Kt.changeBtn,onClick:()=>{t&&t(e)},children:" "})})]})]})},Kt={section:{marginBottom:"20px",paddingBottom:"15px",borderBottom:"1px dashed #e0e0e0"},secTitle:{fontSize:"14px",fontWeight:"bold",marginBottom:"10px",color:"#333"},manualCard:{background:"#f9f9f9",borderRadius:"8px",padding:"12px",border:"1px solid #e0e0e0"},manualHeader:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"8px"},manualName:{fontSize:"16px",fontWeight:"bold",color:"#333",display:"flex",alignItems:"center"},tierBadge:{display:"inline-block",padding:"2px 8px",borderRadius:"4px",fontSize:"11px",color:"white",fontWeight:"bold"},elementBadge:{padding:"4px 10px",background:"#FF6B6B",color:"white",borderRadius:"12px",fontSize:"12px",fontWeight:"bold"},manualDesc:{fontSize:"12px",color:"#666",marginBottom:"10px",lineHeight:"1.5"},compatibilityBox:{background:"white",borderLeft:"3px solid",padding:"8px 10px",marginBottom:"10px",borderRadius:"4px"},compatibilityRow:{display:"flex",justifyContent:"space-between",fontSize:"13px",marginBottom:"4px"},actionRow:{display:"flex",justifyContent:"flex-end"},changeBtn:{padding:"6px 16px",background:"#2196F3",color:"white",border:"none",borderRadius:"6px",cursor:"pointer",fontSize:"13px",fontWeight:"bold",transition:"background 0.2s"}},u1=({child:e,onClose:t,onAction:n,navigation:s,onNavigate:o,player:i,isTianjiMode:a=!1})=>{var B,W,z,ne,Q,se,ye,Me,Pe,Ke,q,de,Z,re,ce;const[l,d]=y.useState(!1),[u,p]=y.useState(e.name),[c,f]=y.useState(""),[x,C]=y.useState(""),[w,S]=y.useState(!1);y.useEffect(()=>{p(e.name),d(!1)},[e.id,e.name]),y.useEffect(()=>{a&&i&&!c&&!w&&h()},[a,e==null?void 0:e.id,i==null?void 0:i.name]);const h=async()=>{if(a){S(!0);try{const le=await o5(e,i);f(le.summary||""),C(le.bio||"");const we=`child_profile_${e.id||e.name}`;localStorage.setItem(we,JSON.stringify(le))}catch(le){console.error("Error generating profile:",le),f("")}finally{S(!1)}}};y.useEffect(()=>{if(typeof window>"u"||!o)return;const le=we=>{we.key==="ArrowLeft"&&(s!=null&&s.hasPrev)&&(we.preventDefault(),o("PREV")),we.key==="ArrowRight"&&(s!=null&&s.hasNext)&&(we.preventDefault(),o("NEXT"))};return window.addEventListener("keydown",le),()=>window.removeEventListener("keydown",le)},[s,o]);const g=le=>({:"#FFD700",:"#4CAF50",:"#2196F3",:"#F44336",:"#795548",:"#673AB7",:"#00BCD4",:"#009688"})[le]||"#9e9e9e",v=le=>({WHITE:"#9e9e9e",GREEN:"#4caf50",BLUE:"#2196f3",PURPLE:"#9c27b0",ORANGE:"#ff9800",RED:"#f44336"})[le]||"#333",j=()=>{n("RENAME",u),d(!1)},R=Math.floor(e.age*12),b=e.isTested&&R>=72&&!!e.spiritRoot,_=((B=e.stats)==null?void 0:B.aptitude)||0,I=_f(_),k=Math.min(100,_),T=Math.max(0,Math.floor(e.currentExp||0)),N=Math.max(1,Math.floor(e.maxExp||1)),K=Math.min(100,Math.round(T/N*100)),L=(le,we,Ue)=>r.jsxs("div",{style:Se.fractionWrapper,"aria-label":`${Ue} ${le}/${we}`,children:[r.jsx("span",{style:Se.fractionCaption,children:Ue}),r.jsxs("div",{style:Se.fractionBox,children:[r.jsx("span",{style:Se.fractionNumerator,children:le}),r.jsx("span",{style:Se.fractionDivider}),r.jsx("span",{style:Se.fractionDenominator,children:we})]})]});return r.jsx("div",{style:Se.overlay,children:r.jsxs("div",{style:Se.modalWrapper,children:[r.jsx("button",{onClick:t,style:Se.closeBtn,"aria-label":"",children:""}),r.jsxs("div",{style:Se.modal,children:[a&&r.jsxs("div",{style:Se.tianjiContent,children:[r.jsxs("div",{style:Se.tianjiHeader,children:[r.jsx("h2",{style:Se.tianjiTitle,children:e.name}),r.jsxs("div",{style:Se.tianjiSubtitle,children:[e.generation&&`${e.generation}  `,e.tier||e.tierTitle||""," ",typeof e.sect=="string"?e.sect:((W=e.sect)==null?void 0:W.name)||""]})]}),r.jsxs("div",{style:Se.tianjiSection,children:[r.jsx("h3",{style:Se.tianjiSectionTitle,children:" "}),r.jsx("p",{style:Se.tianjiDescription,children:c||""}),w&&r.jsx("div",{style:Se.tianjiLoadingHint,children:"AI "})]}),r.jsxs("div",{style:Se.tianjiSection,children:[r.jsx("h3",{style:Se.tianjiSectionTitle,children:" "}),r.jsx("p",{style:Se.tianjiDescription,children:x||""}),r.jsx("p",{style:Se.tianjiHintText,children:"/ AI "})]}),r.jsx("button",{style:Se.tianjiCloseBtn,onClick:t,children:""})]}),!a&&r.jsxs(r.Fragment,{children:[s&&r.jsxs("div",{style:Se.navBar,children:[r.jsxs("button",{type:"button","aria-label":"",onClick:()=>s.hasPrev&&o&&o("PREV"),disabled:!s.hasPrev,style:{...Se.navBtn,...s.hasPrev?{}:Se.navBtnDisabled},children:[" ",s.prevName||""]}),r.jsx("span",{style:Se.navLabel,children:s.label||"--/--"}),r.jsxs("button",{type:"button","aria-label":"",onClick:()=>s.hasNext&&o&&o("NEXT"),disabled:!s.hasNext,style:{...Se.navBtn,...s.hasNext?{}:Se.navBtnDisabled},children:[s.nextName||""," "]})]}),r.jsx("div",{style:Se.content,children:r.jsxs("div",{style:Se.singleCol,children:[r.jsxs("div",{style:{display:"flex",gap:"20px",alignItems:"center",marginBottom:"20px",paddingBottom:"15px",borderBottom:"1px dashed #e0e0e0"},children:[r.jsx("div",{style:{marginBottom:"15px"},children:e.age===0?r.jsx("div",{style:{fontSize:"48px"},children:""}):e.age<15?r.jsx("div",{style:{fontSize:"48px"},children:""}):r.jsx(Vr,{dna:e.avatar,gender:e.gender,size:100})}),r.jsxs("div",{style:Se.nameBox,children:[l?r.jsxs("div",{style:{display:"flex",gap:"5px"},children:[r.jsx("input",{value:u,onChange:le=>p(le.target.value),style:Se.input}),r.jsx("button",{onClick:j,style:Se.smallBtn,children:""})]}):r.jsxs("h2",{style:{margin:0},children:[e.name,r.jsx("span",{onClick:()=>d(!0),style:Se.editIcon,children:""})]}),r.jsx("div",{style:Se.tierBadge,children:e.tierTitle||""}),(e.sect||e.rank)&&r.jsx("div",{style:{marginTop:"8px",fontSize:"13px",color:"#d7a574",fontWeight:"bold"},children:e.sect?r.jsxs(r.Fragment,{children:[e.sect.name,e.rank&&`  ${e.rank}`]}):e.rank&&e.rank}),r.jsxs("div",{style:{marginTop:"10px",fontSize:"13px",color:"#555"},children:[r.jsxs("div",{style:{display:"flex",gap:"15px",marginBottom:"5px",flexWrap:"wrap"},children:[r.jsxs("div",{children:[" ",Math.floor(e.age),"",Math.floor(e.age%1*12),""]}),r.jsxs("div",{children:[" ",e.fatherName]}),r.jsxs("div",{children:[" ",e.gender]}),((z=e.stats)==null?void 0:z.lifespan)&&r.jsxs("div",{children:["  ",Math.floor(Math.max(0,Dr(e))),"/",Math.floor(e.stats.lifespan),""]})]}),e.trait&&r.jsxs("div",{style:{...Se.traitBox,borderColor:v(e.trait.rarity),marginTop:"5px",display:"inline-block"},children:[r.jsx("span",{style:{color:v(e.trait.rarity),fontWeight:"bold"},children:e.trait.name}),r.jsx("p",{style:{margin:"5px 0 0",fontSize:"10px",color:"#666"},children:e.trait.desc})]}),e.influenceProfile&&r.jsxs("div",{style:Se.influencePanel,children:[r.jsxs("div",{style:{...Se.influenceHeader,color:e.influenceProfile.color},children:[e.influenceProfile.label,r.jsx("span",{style:Se.influenceScore,children:e.influenceProfile.score})]}),r.jsx("p",{style:Se.influenceTagline,children:e.influenceProfile.tagline}),r.jsx("div",{style:Se.influenceProgress,children:r.jsx("div",{style:{...Se.influenceProgressFill,width:`${Math.min(100,Math.round((e.influenceProfile.progress||0)*100))}%`,background:e.influenceProfile.color}})}),r.jsxs("div",{style:Se.influenceFooter,children:["",e.influenceProfile.nextLabel]})]})]})]})]}),r.jsxs("div",{style:Se.section,children:[r.jsx("h4",{style:Se.secTitle,children:" "}),e.spouse?r.jsxs("div",{style:Se.spouseCard,children:[r.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"10px"},children:[r.jsx("div",{style:Se.miniAvatar,children:e.spouse.gender===""?"":""}),r.jsxs("div",{children:[r.jsx("div",{style:{fontWeight:"bold",color:"#e91e63"},children:e.spouse.name}),r.jsx("div",{style:{fontSize:"12px",color:"#666"},children:e.spouse.gender===""?" ":" "}),r.jsx("div",{style:{fontSize:"12px"},children:e.spouse.tierTitle||""})]})]}),r.jsxs("div",{style:{marginTop:"8px",fontSize:"13px",display:"grid",gridTemplateColumns:"1fr 1fr 1fr",gap:"8px"},children:[r.jsxs("div",{children:[": ",r.jsx("span",{style:{color:"purple"},children:((ne=e.spouse.stats)==null?void 0:ne.aptitude)||e.spouse.aptitude})]}),r.jsxs("div",{children:[": ",((Q=e.spouse.stats)==null?void 0:Q.looks)||e.spouse.looks]}),r.jsxs("div",{children:[": ",((se=e.spouse.stats)==null?void 0:se.intelligence)||e.spouse.intelligence]}),r.jsxs("div",{style:{gridColumn:"span 3",color:"#d81b60"},children:[(ye=e.spouse.spiritRoot)==null?void 0:ye.type," ",(Pe=(Me=e.spouse.spiritRoot)==null?void 0:Me.elements)==null?void 0:Pe.join(", ")]})]})]}):r.jsxs("div",{style:{color:"#999",fontSize:"12px",textAlign:"center",padding:"15px",background:"#f5f5f5",borderRadius:"8px"},children:["",r.jsx("br",{}),r.jsx("button",{style:Se.marryBtn,onClick:()=>{console.log("Marriage button clicked for child:",e.name,"id:",e.id),n("MARRY")},children:" "})]})]}),r.jsxs("div",{style:Se.section,children:[r.jsx("h4",{style:Se.secTitle,children:" "}),b?r.jsxs(r.Fragment,{children:[r.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"10px",marginBottom:"10px"},children:[r.jsx("strong",{style:{fontSize:"16px"},children:e.spiritRoot.type}),r.jsx("div",{style:{display:"flex",gap:"4px"},children:e.spiritRoot.elements.map(le=>r.jsx("span",{style:{...Se.elBadge,background:g(le)},children:le},le))})]}),r.jsxs("div",{style:Se.barContainer,children:[r.jsxs("span",{children:[" (",_,")"]}),r.jsx("div",{style:Se.barBg,children:r.jsx("div",{style:{...Se.barFill,width:`${k}%`,background:I.color}})})]}),r.jsx("p",{style:{fontSize:"12px",color:"#666",marginTop:"5px"},children:e.spiritRoot.desc})]}):r.jsx("p",{style:{color:"#999",fontStyle:"italic"},children:"6"})]}),r.jsxs("div",{style:Se.section,children:[r.jsx("h4",{style:Se.secTitle,children:" "}),r.jsx("div",{style:Se.equipGrid,children:["weapon","armor","accessory"].map(le=>{var Oe;const we=(Oe=e.equipment)==null?void 0:Oe[le],Ue={weapon:"",armor:"",accessory:""};return r.jsxs("div",{style:Se.equipSlot,children:[r.jsx("div",{style:{fontWeight:"bold"},children:Ue[le]}),r.jsx("div",{style:{fontSize:"12px",color:"#555",minHeight:"18px"},children:we?we.name:""}),r.jsxs("div",{style:{display:"flex",gap:"6px"},children:[r.jsx("button",{style:Se.smallBtn,onClick:()=>n("OPEN_INVENTORY",{mode:"SELECT",slot:le}),children:""}),we&&r.jsx("button",{style:Se.smallBtn,onClick:()=>n("UNEQUIP",{slot:le}),children:""})]})]},le)})}),r.jsxs("div",{style:{marginTop:"8px",textAlign:"right"},children:[r.jsx("button",{style:Se.smallBtn,onClick:()=>n("OPEN_INVENTORY",{mode:"VIEW"}),children:" "}),r.jsx(_C,{child:e,onChangeManual:le=>n("CHANGE_MANUAL",le)})]})]}),r.jsxs("div",{style:Se.section,children:[r.jsx("h4",{style:Se.secTitle,children:" "}),r.jsxs("div",{style:Se.traitGrid,children:[r.jsxs("div",{style:Se.traitRow,children:[r.jsx("span",{style:Se.label,children:":"}),r.jsx(Ec,{trait:kc(((Ke=e.stats)==null?void 0:Ke.looks)||50,"LOOKS",e.gender),showValue:!0})]}),r.jsxs("div",{style:Se.traitRow,children:[r.jsx("span",{style:Se.label,children:":"}),r.jsx(Ec,{trait:kc(((q=e.stats)==null?void 0:q.intelligence)||50,"INT"),showValue:!0})]}),r.jsxs("div",{style:Se.traitRow,children:[r.jsx("span",{style:Se.label,children:":"}),r.jsx("div",{style:{flex:1,height:"8px",background:"#eee",borderRadius:"4px",overflow:"hidden"},children:r.jsx("div",{style:{height:"100%",width:`${_}%`,background:_>=90?"#d50000":_>=80?"#aa00ff":"#4caf50"}})}),r.jsx("span",{style:{fontSize:"12px",marginLeft:"5px"},children:_})]})]})]}),r.jsxs("div",{style:Se.section,children:[r.jsx("h4",{style:Se.secTitle,children:" "}),r.jsxs("div",{style:Se.combatGrid,children:[r.jsxs("div",{style:Se.statItem,children:[r.jsx("span",{style:{color:"#d32f2f"},children:""}),r.jsx("strong",{children:((de=e.combatStats)==null?void 0:de.hp)||100})]}),r.jsxs("div",{style:Se.statItem,children:[r.jsx("span",{style:{color:"#1976d2"},children:""}),r.jsx("strong",{children:((Z=e.combatStats)==null?void 0:Z.mp)||0})]}),r.jsxs("div",{style:Se.statItem,children:[r.jsx("span",{style:{color:"#f57c00"},children:""}),r.jsx("strong",{children:((re=e.combatStats)==null?void 0:re.atk)||5})]})]})]}),((ce=e.stats)==null?void 0:ce.lifespan)&&r.jsxs("div",{style:Se.section,children:[r.jsx("h4",{style:Se.secTitle,children:" "}),r.jsxs("div",{style:{fontSize:"12px",color:"#666",lineHeight:"1.6"},children:[r.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:"4px"},children:[r.jsx("span",{children:":"}),r.jsxs("span",{style:{fontWeight:"bold"},children:[Math.floor(e.age||0)," "]})]}),r.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:"4px"},children:[r.jsx("span",{children:":"}),r.jsxs("span",{style:{fontWeight:"bold"},children:[Math.floor(e.stats.lifespan)," "]})]}),r.jsxs("div",{style:{display:"flex",justifyContent:"space-between"},children:[r.jsx("span",{children:":"}),r.jsxs("span",{style:{fontWeight:"bold",color:(()=>{const le=Dr(e);return le<10?"#f44336":le<30?"#ff9800":"#4caf50"})()},children:[Math.floor(Dr(e))," "]})]}),Dr(e)<10&&r.jsx("div",{style:{marginTop:"8px",padding:"8px",background:"rgba(244, 67, 54, 0.1)",borderRadius:"4px",color:"#f44336",fontSize:"11px"},children:" "})]})]}),e.tierTitle&&r.jsxs("div",{style:Se.section,children:[r.jsx("h4",{style:Se.secTitle,children:" "}),r.jsxs("div",{style:{fontSize:"12px",marginBottom:"8px"},children:[r.jsx("span",{style:{color:"#666"},children:": "}),r.jsx("span",{style:{fontWeight:"bold",color:"#9c27b0"},children:e.tierTitle||""})]}),e.currentExp!==void 0&&e.maxExp&&r.jsxs("div",{children:[r.jsxs("div",{style:{marginBottom:"4px"},children:[r.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",marginBottom:"4px"},children:[r.jsx("span",{style:{fontSize:"11px",color:"#666"},children:""}),r.jsxs("span",{style:{fontSize:"11px",color:"#666",fontWeight:"bold"},children:[K,"%"]})]}),r.jsx("div",{style:{width:"100%",height:"14px",background:"linear-gradient(to right, #f0f0f0, #e0e0e0)",borderRadius:"7px",overflow:"hidden",position:"relative",boxShadow:"inset 0 2px 4px rgba(0,0,0,0.1)"},children:r.jsx("div",{style:{width:`${K}%`,height:"100%",background:"linear-gradient(90deg, #9c27b0 0%, #d05ce3 100%)",borderRadius:"7px",transition:"width 0.3s ease",boxShadow:"0 0 10px rgba(156, 39, 176, 0.5)",position:"relative",overflow:"hidden"},children:r.jsx("div",{style:{position:"absolute",top:0,left:"-100%",width:"100%",height:"100%",background:"linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent)",animation:"shimmer 2s infinite"}})})})]}),L(T,N,""),e.cultivationSpeed&&r.jsxs("div",{style:{marginTop:"8px",padding:"6px 10px",background:"rgba(156, 39, 176, 0.05)",borderRadius:"6px",border:"1px solid rgba(156, 39, 176, 0.1)"},children:[r.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"4px"},children:[r.jsx("span",{style:{fontSize:"11px",color:"#666"},children:":"}),r.jsxs("span",{style:{fontSize:"11px",fontWeight:"bold",color:"#9c27b0"},children:[Math.floor(e.cultivationSpeed)," /"]})]}),(()=>{const le=Math.max(0,N-T),we=Math.ceil(le/e.cultivationSpeed);return r.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[r.jsx("span",{style:{fontSize:"11px",color:"#666"},children:":"}),r.jsx("span",{style:{fontSize:"11px",fontWeight:"bold",color:we>12?"#ff9800":"#4caf50"},children:we>12?`${Math.floor(we/12)}`:`${we}`})]})})()]})]})]}),r.jsxs("div",{style:Se.section,children:[r.jsx("h4",{style:Se.secTitle,children:" "}),e.sect?r.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[r.jsxs("div",{children:[r.jsx("div",{style:{fontWeight:"bold",color:"#00695c"},children:e.sect.name}),r.jsx("div",{style:{fontSize:"12px"},children:e.rank})]}),r.jsx("div",{style:{textAlign:"right",fontSize:"12px"},children:r.jsxs("div",{children:[": ",Math.floor(e.age*12)>=192?"":""]})})]}):r.jsxs("div",{children:[r.jsx("p",{style:{color:"#666",fontSize:"12px",marginBottom:"8px"},children:" / "}),Math.floor(e.age*12)>=144&&e.isTested&&r.jsxs("div",{style:{display:"flex",gap:"8px",alignItems:"center"},children:[r.jsx("button",{style:Se.smallBtn,onClick:()=>n("SELECT_SECT"),children:" "}),r.jsxs("label",{style:{display:"flex",alignItems:"center",gap:8,fontSize:12,color:"#555"},children:[r.jsx("input",{type:"checkbox",checked:!!e.autoJoinBestSect,onChange:le=>n("TOGGLE_AUTO_JOIN_SECT",le.target.checked)}),""]})]})]})]}),r.jsxs("div",{style:{...Se.actionArea,gridTemplateColumns:"1fr 1fr 1fr"},children:[r.jsxs("button",{onClick:()=>n("CHAT"),style:{...Se.actionBtn,background:"#7e57c2"},children:[" ",r.jsx("br",{}),r.jsx("small",{style:{fontSize:"10px",opacity:.8},children:""})]}),r.jsxs("button",{onClick:()=>{window.showConfirm&&window.showConfirm(` ${e.name} `,()=>n("EXPEL"))},style:{...Se.actionBtn,background:"#d32f2f"},children:[" ",r.jsx("br",{}),r.jsx("small",{style:{fontSize:"10px",opacity:.9},children:""})]})]})]})})]})]})]})})},Se={tianjiContent:{padding:"24px",height:"100%",overflowY:"auto"},tianjiHeader:{marginBottom:"24px",borderBottom:"2px solid #d4a574",paddingBottom:"16px"},tianjiTitle:{fontSize:"28px",fontWeight:"bold",color:"#8b4513",margin:"0 0 8px 0",textShadow:"1px 1px 2px rgba(0, 0, 0, 0.2)"},tianjiSubtitle:{fontSize:"14px",color:"#666",fontStyle:"italic"},tianjiSection:{marginBottom:"24px"},tianjiSectionTitle:{fontSize:"16px",fontWeight:"bold",color:"#8b4513",marginBottom:"12px",borderLeft:"4px solid #d4a574",paddingLeft:"10px"},tianjiDescription:{fontSize:"14px",lineHeight:"1.8",color:"#333",margin:"0",padding:"12px",background:"rgba(255, 255, 255, 0.6)",borderRadius:"8px",border:"1px solid rgba(139, 69, 19, 0.2)"},tianjiLoadingHint:{fontSize:"12px",color:"#999",marginTop:"8px",fontStyle:"italic"},tianjiHintText:{fontSize:"12px",color:"#999",marginTop:"8px",fontStyle:"italic"},tianjiCloseBtn:{marginTop:"20px",padding:"12px 24px",background:"linear-gradient(135deg, #8b4513, #a0522d)",color:"white",border:"none",borderRadius:"8px",fontSize:"14px",fontWeight:"bold",cursor:"pointer",width:"100%",transition:"transform 0.2s"},overlay:{position:"fixed",top:0,left:0,right:0,bottom:0,background:"rgba(0,0,0,0.6)",display:"flex",justifyContent:"center",alignItems:"center",zIndex:1e3},modalWrapper:{position:"relative",width:"min(600px, calc(100vw - 32px))"},modal:{width:"100%",height:"600px",background:"#fff",borderRadius:"12px",overflow:"hidden",position:"relative",boxShadow:"0 10px 25px rgba(0,0,0,0.2)",display:"flex",flexDirection:"column"},closeBtn:{position:"absolute",top:"-18px",left:"-18px",border:"none",background:"#ffffff",fontSize:"22px",cursor:"pointer",color:"#888",width:"44px",height:"44px",display:"flex",alignItems:"center",justifyContent:"center",borderRadius:"22px",boxShadow:"0 12px 30px rgba(0,0,0,0.25)"},content:{flex:1,height:"100%",overflow:"hidden"},navBar:{flex:"0 0 auto",padding:"12px 20px",borderBottom:"1px solid #f0f0f0",background:"#fafafa",display:"flex",alignItems:"center",justifyContent:"space-between"},navBtn:{border:"none",background:"transparent",cursor:"pointer",color:"#333",fontSize:"13px",display:"flex",alignItems:"center",gap:"6px",padding:"6px 10px",borderRadius:"6px"},navBtnDisabled:{color:"#bbb",cursor:"not-allowed"},navLabel:{fontSize:"12px",color:"#666",fontWeight:"bold"},singleCol:{width:"100%",padding:"25px 25px 90px 25px",overflowY:"auto",height:"100%",boxSizing:"border-box"},nameBox:{textAlign:"left"},editIcon:{fontSize:"12px",cursor:"pointer",marginLeft:"5px",opacity:.5},input:{width:"120px",padding:"5px",borderRadius:"4px",border:"1px solid #ccc"},smallBtn:{padding:"5px 10px",cursor:"pointer",borderRadius:"4px",border:"1px solid #ccc",backgroundColor:"#f5f5f5"},tierBadge:{fontSize:"12px",background:"#3e2723",color:"#fff",padding:"2px 8px",borderRadius:"10px",marginTop:"5px",display:"inline-block"},traitBox:{padding:"10px",background:"#fff",border:"1px solid",borderRadius:"8px",textAlign:"center",display:"inline-block"},influencePanel:{marginTop:"10px",padding:"12px",borderRadius:"10px",background:"linear-gradient(135deg, rgba(255,255,255,0.8), rgba(240,240,240,0.9))",border:"1px solid #e0e0e0"},influenceHeader:{fontWeight:"bold",fontSize:"16px",display:"flex",justifyContent:"space-between",alignItems:"center"},influenceScore:{fontSize:"18px"},influenceTagline:{fontSize:"11px",margin:"4px 0",color:"#666"},influenceProgress:{height:"8px",borderRadius:"999px",background:"#e0e0e0",overflow:"hidden"},influenceProgressFill:{height:"100%"},influenceFooter:{marginTop:"4px",fontSize:"11px",color:"#888"},spouseCard:{background:"#fff8e1",padding:"15px",borderRadius:"8px",border:"1px solid #ffecb3",boxShadow:"0 2px 4px rgba(0,0,0,0.05)"},miniAvatar:{fontSize:"24px",width:"40px",height:"40px",borderRadius:"50%",background:"#fff",display:"flex",alignItems:"center",justifyContent:"center",boxShadow:"0 1px 3px rgba(0,0,0,0.1)"},marryBtn:{marginTop:"10px",padding:"5px 15px",fontSize:"12px",cursor:"pointer",borderRadius:"15px",border:"1px solid #e91e63",backgroundColor:"#fff",color:"#e91e63",transition:"all 0.2s",":hover":{backgroundColor:"#fce4ec",transform:"translateY(-1px)"}},section:{marginBottom:"25px"},secTitle:{margin:"0 0 15px 0",fontSize:"14px",color:"#333",borderBottom:"1px dashed #ccc",paddingBottom:"8px"},elBadge:{padding:"2px 6px",borderRadius:"4px",color:"#fff",fontSize:"10px",fontWeight:"bold"},barContainer:{display:"flex",alignItems:"center",gap:"10px",fontSize:"12px",marginBottom:"10px"},barBg:{flex:1,height:"8px",background:"#eee",borderRadius:"4px"},barFill:{height:"100%",borderRadius:"4px"},combatGrid:{display:"grid",gridTemplateColumns:"1fr 1fr 1fr",gap:"10px",textAlign:"center"},statItem:{background:"#fafafa",padding:"10px",borderRadius:"8px",display:"flex",flexDirection:"column",gap:"5px"},actionArea:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"10px",marginTop:"20px"},actionBtn:{padding:"12px",border:"none",borderRadius:"8px",background:"#ff9800",color:"white",cursor:"pointer",textAlign:"center",fontSize:"14px",transition:"all 0.2s",":hover":{transform:"translateY(-1px)",boxShadow:"0 4px 8px rgba(0,0,0,0.15)"}},traitGrid:{display:"flex",flexDirection:"column",gap:"15px"},traitRow:{display:"flex",alignItems:"center",gap:"10px"},label:{width:"60px",fontSize:"13px",color:"#555",fontWeight:"bold"},equipGrid:{display:"grid",gridTemplateColumns:"1fr 1fr 1fr",gap:"10px"},equipSlot:{border:"1px dashed #ccc",borderRadius:"8px",padding:"10px",background:"#fafafa",textAlign:"center"},fractionWrapper:{display:"flex",flexDirection:"column",alignItems:"flex-end",marginTop:"6px",color:"#4a148c"},fractionCaption:{fontSize:"11px",color:"#777",marginBottom:"2px"},fractionBox:{display:"flex",flexDirection:"column",alignItems:"center",minWidth:"60px",lineHeight:1.2},fractionNumerator:{fontWeight:"bold",fontSize:"15px"},fractionDivider:{width:"100%",borderBottom:"1px solid rgba(0,0,0,0.2)",margin:"2px 0"},fractionDenominator:{fontWeight:"bold",fontSize:"13px"}},MC=({child:e,candidates:t,onSelect:n,onClose:s})=>{if(!t||t.length===0)return null;const o=a=>{switch(a){case"talented":return" ";case"beautiful":return" ";case"wise":return" ";case"buddha":return" ";default:return" "}},i=a=>{switch(a){case"talented":return"";case"beautiful":return"";case"wise":return"";case"buddha":return"";default:return""}};return r.jsx("div",{style:nt.overlay,children:r.jsxs("div",{style:nt.modalWrapper,children:[r.jsx("button",{style:nt.closeBtn,onClick:s,"aria-label":"",children:""}),r.jsxs("div",{style:nt.modal,children:[r.jsx("div",{style:nt.header,children:r.jsxs("h2",{style:nt.title,children:["  ",e.name," "]})}),r.jsxs("div",{style:nt.subtitle,children:[" ",e.name," "]}),r.jsx("div",{style:nt.candidatesContainer,children:t.map((a,l)=>{var d,u,p;return r.jsxs("div",{style:nt.candidateCard,children:[r.jsx("div",{style:nt.cardHeader,children:r.jsx("div",{style:nt.archetypeBadge,children:o(a.archetype)})}),r.jsxs("div",{style:nt.avatarSection,children:[r.jsx(Vr,{avatar:a.avatar,gender:a.gender,size:80}),r.jsxs("div",{style:nt.nameSection,children:[r.jsx("div",{style:nt.candidateName,children:a.name}),r.jsx("div",{style:nt.candidateGender,children:a.gender===""?" ":" "}),a.identity&&r.jsx("div",{style:nt.identity,children:a.identity})]})]}),r.jsx("div",{style:nt.archetypeDesc,children:i(a.archetype)}),r.jsxs("div",{style:nt.statsSection,children:[r.jsxs("div",{style:nt.statRow,children:[r.jsx("span",{style:nt.statLabel,children:""}),r.jsx("span",{style:{...nt.statValue,color:a.stats.aptitude>=80?"#ff4081":a.stats.aptitude>=60?"#9c27b0":"#666"},children:a.stats.aptitude})]}),r.jsxs("div",{style:nt.statRow,children:[r.jsx("span",{style:nt.statLabel,children:""}),r.jsx("span",{style:{...nt.statValue,color:a.stats.looks>=80?"#ff4081":a.stats.looks>=60?"#9c27b0":"#666"},children:a.stats.looks})]}),r.jsxs("div",{style:nt.statRow,children:[r.jsx("span",{style:nt.statLabel,children:""}),r.jsx("span",{style:{...nt.statValue,color:a.stats.intelligence>=80?"#ff4081":a.stats.intelligence>=60?"#9c27b0":"#666"},children:a.stats.intelligence})]})]}),r.jsxs("div",{style:nt.spiritRootSection,children:[r.jsx("div",{style:nt.spiritRootLabel,children:""}),r.jsxs("div",{style:nt.spiritRootValue,children:[(d=a.spiritRoot)==null?void 0:d.type,((p=(u=a.spiritRoot)==null?void 0:u.elements)==null?void 0:p.length)>0&&` (${a.spiritRoot.elements.join("")})`]})]}),r.jsxs("div",{style:nt.cultivationSection,children:[r.jsx("div",{style:nt.tierLabel,children:a.tierTitle}),r.jsxs("div",{style:nt.cultivationValue,children:[": ",a.cultivation]})]}),r.jsxs("button",{style:nt.selectBtn,onClick:()=>n(a),onMouseEnter:c=>c.target.style.background="#d81b60",onMouseLeave:c=>c.target.style.background="#e91e63",children:[" ",a.name]})]},a.id)})}),r.jsxs("div",{style:nt.footer,children:[r.jsx("div",{style:nt.costInfo,children:" 500 "}),r.jsx("button",{style:nt.cancelBtn,onClick:s,children:""})]})]})]})})},nt={overlay:{position:"fixed",top:0,left:0,right:0,bottom:0,background:"rgba(0, 0, 0, 0.7)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:2e3,padding:"20px"},modalWrapper:{position:"relative",width:"min(1100px, calc(100vw - 40px))"},modal:{background:"linear-gradient(135deg, #fff8e1 0%, #ffe0b2 100%)",borderRadius:"16px",maxWidth:"1100px",width:"100%",maxHeight:"90vh",overflow:"auto",boxShadow:"0 8px 32px rgba(0,0,0,0.3)",border:"2px solid #ffb74d",position:"relative"},header:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"20px 24px",borderBottom:"2px solid #ffb74d",background:"linear-gradient(90deg, #ffe0b2, #ffcc80)"},title:{margin:0,fontSize:"24px",color:"#d84315",fontWeight:"bold"},closeBtn:{position:"absolute",top:"-18px",left:"-18px",background:"#fff",border:"2px solid rgba(0,0,0,0.08)",fontSize:"20px",cursor:"pointer",color:"#bf360c",width:"44px",height:"44px",display:"flex",alignItems:"center",justifyContent:"center",borderRadius:"50%",boxShadow:"0 10px 24px rgba(0,0,0,0.2)",zIndex:5},subtitle:{padding:"16px 24px",fontSize:"16px",color:"#5d4037",textAlign:"center",background:"#fff3e0"},candidatesContainer:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(300px, 1fr))",gap:"20px",padding:"24px"},candidateCard:{background:"white",borderRadius:"12px",padding:"20px",border:"2px solid #ffb74d",boxShadow:"0 4px 12px rgba(0,0,0,0.1)",display:"flex",flexDirection:"column",transition:"transform 0.2s, box-shadow 0.2s",cursor:"pointer"},cardHeader:{marginBottom:"12px",display:"flex",justifyContent:"center"},archetypeBadge:{background:"linear-gradient(135deg, #e91e63, #f06292)",color:"white",padding:"6px 16px",borderRadius:"20px",fontSize:"14px",fontWeight:"bold",textAlign:"center"},avatarSection:{display:"flex",alignItems:"center",gap:"16px",marginBottom:"12px",paddingBottom:"12px",borderBottom:"1px solid #ffe0b2"},nameSection:{flex:1},candidateName:{fontSize:"20px",fontWeight:"bold",color:"#d84315",marginBottom:"4px"},candidateGender:{fontSize:"14px",color:"#666",marginBottom:"4px"},identity:{fontSize:"12px",color:"#ff6f00",fontWeight:"bold",background:"#fff3e0",padding:"2px 8px",borderRadius:"4px",display:"inline-block"},archetypeDesc:{fontSize:"13px",color:"#795548",fontStyle:"italic",marginBottom:"16px",textAlign:"center",padding:"8px",background:"#fff8e1",borderRadius:"6px"},statsSection:{display:"flex",flexDirection:"column",gap:"8px",marginBottom:"12px",padding:"12px",background:"#fafafa",borderRadius:"8px"},statRow:{display:"flex",justifyContent:"space-between",alignItems:"center"},statLabel:{fontSize:"14px",color:"#666",fontWeight:"500"},statValue:{fontSize:"16px",fontWeight:"bold"},spiritRootSection:{marginBottom:"12px",padding:"10px",background:"#e3f2fd",borderRadius:"6px",border:"1px solid #90caf9"},spiritRootLabel:{fontSize:"12px",color:"#1565c0",marginBottom:"4px"},spiritRootValue:{fontSize:"14px",color:"#0d47a1",fontWeight:"bold"},cultivationSection:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"16px",padding:"10px",background:"#f3e5f5",borderRadius:"6px"},tierLabel:{fontSize:"14px",color:"#6a1b9a",fontWeight:"bold"},cultivationValue:{fontSize:"13px",color:"#4a148c"},selectBtn:{background:"#e91e63",color:"white",border:"none",padding:"12px",borderRadius:"8px",fontSize:"16px",fontWeight:"bold",cursor:"pointer",transition:"background 0.2s",boxShadow:"0 2px 8px rgba(233, 30, 99, 0.3)"},footer:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"16px 24px",borderTop:"2px solid #ffb74d",background:"#fff3e0"},costInfo:{fontSize:"16px",color:"#d84315",fontWeight:"bold"},cancelBtn:{background:"#9e9e9e",color:"white",border:"none",padding:"10px 24px",borderRadius:"6px",fontSize:"14px",cursor:"pointer",transition:"background 0.2s"}},AC=({giftEvents:e,onConfirm:t,onClose:n})=>{const[s,o]=y.useState(new Set),i=p=>{const c=new Set(s);c.has(p)?c.delete(p):c.add(p),o(c)},a=()=>{s.size===e.length?o(new Set):o(new Set(e.map(p=>p.npcId)))},l=()=>{const p=e.filter(c=>s.has(c.npcId));t(p)},d=p=>fs(p)||{name:"",rarity:"common"},u={common:"#9e9e9e",uncommon:"#4caf50",rare:"#2196f3",epic:"#9c27b0",legendary:"#ff9800"};return r.jsx("div",{style:Et.overlay,children:r.jsxs("div",{style:Et.modal,children:[r.jsxs("div",{style:Et.header,children:[r.jsxs("h3",{style:Et.title,children:[" ",e.length,""]}),r.jsx("button",{onClick:n,style:Et.closeIcon,children:""})]}),r.jsx("div",{style:Et.subtitle,children:""}),r.jsxs("div",{style:Et.toolbar,children:[r.jsx("button",{onClick:a,style:Et.selectAllBtn,children:s.size===e.length?" ":""}),r.jsxs("div",{style:Et.selectionInfo,children:[" ",s.size," / ",e.length]})]}),r.jsx("div",{style:Et.giftList,children:e.map((p,c)=>{const f=d(p.giftItemId),x=s.has(p.npcId);return r.jsxs("div",{style:{...Et.giftCard,borderColor:x?"#4caf50":"#e0e0e0",background:x?"#f1f8f4":"#fff"},onClick:()=>i(p.npcId),children:[r.jsx("div",{style:Et.checkbox,children:r.jsx("input",{type:"checkbox",checked:x,onChange:()=>i(p.npcId),style:Et.checkboxInput})}),r.jsxs("div",{style:Et.cardContent,children:[r.jsxs("div",{style:Et.giftHeader,children:[r.jsx("span",{style:Et.npcName,children:p.npcName}),r.jsx("span",{style:{...Et.itemName,color:u[f.rarity]||"#666"},children:f.name})]}),r.jsx("div",{style:Et.message,children:p.message}),f.desc&&r.jsxs("div",{style:Et.itemDesc,children:[" ",f.desc]}),f.stats&&r.jsxs("div",{style:Et.itemStats,children:[f.stats.atk&&r.jsxs("span",{children:["+",f.stats.atk]}),f.stats.hp&&r.jsxs("span",{children:["+",f.stats.hp]}),f.stats.def&&r.jsxs("span",{children:["+",f.stats.def]})]}),f.effect&&r.jsxs("div",{style:Et.itemEffect,children:[" ",typeof f.effect=="object"?`${f.effect.kind==="heal"?"":f.effect.kind==="exp"?"":f.effect.kind==="aptitude"?"":""} +${f.effect.amount}`:f.effect]})]})]},p.npcId||c)})}),r.jsxs("div",{style:Et.footer,children:[r.jsxs("button",{style:Et.confirmBtn,onClick:l,disabled:s.size===0,children:[" (",s.size,")"]}),r.jsx("button",{style:Et.cancelBtn,onClick:n,children:""})]})]})})},Et={overlay:{position:"fixed",top:0,left:0,right:0,bottom:0,background:"rgba(0, 0, 0, 0.75)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:3e3,padding:"20px"},modal:{background:"linear-gradient(135deg, #fff 0%, #f5f5f5 100%)",borderRadius:"16px",width:"90%",maxWidth:"800px",maxHeight:"85vh",display:"flex",flexDirection:"column",boxShadow:"0 10px 40px rgba(0,0,0,0.3)",overflow:"hidden"},header:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"20px 24px",borderBottom:"2px solid #e91e63",background:"linear-gradient(90deg, #fce4ec, #f8bbd0)",flexShrink:0},title:{margin:0,fontSize:"22px",color:"#c2185b",fontWeight:"bold"},closeIcon:{background:"none",border:"none",fontSize:"28px",cursor:"pointer",color:"#c2185b",padding:"0",lineHeight:"1"},subtitle:{padding:"16px 24px",fontSize:"14px",color:"#666",borderBottom:"1px solid #e0e0e0",flexShrink:0},toolbar:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"12px 24px",background:"#fafafa",borderBottom:"1px solid #e0e0e0",flexShrink:0},selectAllBtn:{padding:"6px 16px",background:"#e0e0e0",border:"none",borderRadius:"6px",cursor:"pointer",fontSize:"13px",transition:"all 0.2s"},selectionInfo:{fontSize:"13px",color:"#666"},giftList:{flex:1,overflowY:"auto",padding:"16px 24px",display:"flex",flexDirection:"column",gap:"12px"},giftCard:{display:"flex",gap:"12px",padding:"16px",border:"2px solid #e0e0e0",borderRadius:"12px",cursor:"pointer",transition:"all 0.2s",background:"#fff"},checkbox:{flexShrink:0,display:"flex",alignItems:"flex-start",paddingTop:"2px"},checkboxInput:{width:"18px",height:"18px",cursor:"pointer"},cardContent:{flex:1,display:"flex",flexDirection:"column",gap:"8px"},giftHeader:{display:"flex",justifyContent:"space-between",alignItems:"center",gap:"12px"},npcName:{fontSize:"16px",fontWeight:"bold",color:"#e91e63"},itemName:{fontSize:"15px",fontWeight:"600"},message:{fontSize:"14px",color:"#444",lineHeight:"1.5",background:"#fff8e1",padding:"8px 12px",borderRadius:"8px",border:"1px solid #fff176"},itemDesc:{fontSize:"12px",color:"#666",fontStyle:"italic"},itemStats:{display:"flex",gap:"12px",fontSize:"12px",color:"#2196f3",fontWeight:"500"},itemEffect:{fontSize:"12px",color:"#4caf50",fontStyle:"italic"},footer:{display:"flex",gap:"12px",padding:"16px 24px",borderTop:"2px solid #e0e0e0",background:"#fafafa",flexShrink:0},confirmBtn:{flex:1,padding:"12px",background:"#4caf50",color:"#fff",border:"none",borderRadius:"8px",cursor:"pointer",fontSize:"15px",fontWeight:"bold",transition:"all 0.2s"},cancelBtn:{padding:"12px 24px",background:"#e0e0e0",border:"none",borderRadius:"8px",cursor:"pointer",fontSize:"15px"}},NC=({promotionEvents:e,onConfirm:t,onClose:n})=>{const[s,o]=y.useState(new Set(e.map(c=>c.child.id))),i=c=>{const f=new Set(s);f.has(c)?f.delete(c):f.add(c),o(f)},a=()=>{s.size===e.length?o(new Set):o(new Set(e.map(c=>c.child.id)))},l=()=>{const c=e.filter(f=>s.has(f.child.id));t(c)},d=c=>fs(c)||{name:"",rarity:"common"},u={common:"#9e9e9e",uncommon:"#4caf50",rare:"#2196f3",epic:"#9c27b0",legendary:"#ff9800"},p={:"#9e9e9e",:"#4caf50",:"#2196f3",:"#9c27b0",:"#ff9800"};return r.jsx("div",{style:Je.overlay,children:r.jsxs("div",{style:Je.modal,children:[r.jsxs("div",{style:Je.header,children:[r.jsx("h3",{style:Je.title,children:" "}),r.jsx("button",{onClick:n,style:Je.closeIcon,children:""})]}),r.jsxs("div",{style:Je.subtitle,children:["",e.length," "]}),r.jsxs("div",{style:Je.toolbar,children:[r.jsx("button",{onClick:a,style:Je.selectAllBtn,children:s.size===e.length?" ":""}),r.jsxs("div",{style:Je.selectionInfo,children:[" ",s.size," / ",e.length]})]}),r.jsx("div",{style:Je.eventList,children:e.map(c=>{var w;const f=c.child,x=d(c.giftItemId),C=s.has(f.id);return r.jsxs("div",{style:{...Je.eventCard,borderColor:C?"#4caf50":"#e0e0e0",background:C?"#f1f8f4":"#fff"},onClick:()=>i(f.id),children:[r.jsx("div",{style:Je.checkbox,children:r.jsx("input",{type:"checkbox",checked:C,onChange:()=>i(f.id),style:Je.checkboxInput})}),r.jsxs("div",{style:Je.cardContent,children:[r.jsxs("div",{style:Je.promotionHeader,children:[r.jsxs("div",{style:Je.childInfo,children:[r.jsx("span",{style:Je.childName,children:f.name}),r.jsx("span",{style:Je.childGender,children:f.gender===""?"":""})]}),r.jsxs("div",{style:Je.promotionBadge,children:[r.jsx("span",{style:Je.promotionLabel,children:""}),r.jsx("span",{style:{...Je.rankBadge,background:p[c.rank]||"#666"},children:c.rank})]})]}),r.jsxs("div",{style:Je.sectInfo,children:[r.jsx("span",{style:Je.sectIcon,children:""}),r.jsx("span",{style:Je.sectName,children:((w=c.sect)==null?void 0:w.name)||""})]}),r.jsxs("div",{style:Je.giftSection,children:[r.jsxs("div",{style:Je.giftHeader,children:[r.jsx("span",{style:Je.giftLabel,children:""}),r.jsx("span",{style:{...Je.giftName,color:u[x.rarity]||"#666"},children:x.name})]}),x.desc&&r.jsx("div",{style:Je.giftDesc,children:x.desc}),x.stats&&r.jsxs("div",{style:Je.giftStats,children:[x.stats.atk&&r.jsxs("span",{style:Je.statBadge,children:[" +",x.stats.atk]}),x.stats.hp&&r.jsxs("span",{style:Je.statBadge,children:[" +",x.stats.hp]}),x.stats.def&&r.jsxs("span",{style:Je.statBadge,children:[" +",x.stats.def]})]}),x.effect&&r.jsxs("div",{style:Je.giftEffect,children:[" ",typeof x.effect=="object"?`${x.effect.kind==="heal"?"":x.effect.kind==="exp"?"":x.effect.kind==="aptitude"?"":""} +${x.effect.amount}`:x.effect]})]}),r.jsx("div",{style:Je.message,children:typeof c.message=="string"?c.message:JSON.stringify(c.message)})]})]},f.id)})}),r.jsxs("div",{style:Je.footer,children:[r.jsxs("button",{style:Je.confirmBtn,onClick:l,disabled:s.size===0,children:[" (",s.size,")"]}),r.jsx("button",{style:Je.cancelBtn,onClick:n,children:""})]})]})})},Je={overlay:{position:"fixed",top:0,left:0,right:0,bottom:0,background:"rgba(0, 0, 0, 0.75)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:3e3,padding:"20px"},modal:{background:"linear-gradient(135deg, #fff9c4 0%, #fff59d 100%)",borderRadius:"16px",width:"90%",maxWidth:"850px",maxHeight:"85vh",display:"flex",flexDirection:"column",boxShadow:"0 10px 40px rgba(0,0,0,0.3)",overflow:"hidden",border:"2px solid #fdd835"},header:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"20px 24px",borderBottom:"2px solid #fdd835",background:"linear-gradient(90deg, #fff9c4, #fff176)",flexShrink:0},title:{margin:0,fontSize:"22px",color:"#f57f17",fontWeight:"bold"},closeIcon:{background:"none",border:"none",fontSize:"28px",cursor:"pointer",color:"#f57f17",padding:"0",lineHeight:"1"},subtitle:{padding:"16px 24px",fontSize:"14px",color:"#666",borderBottom:"1px solid #fdd835",flexShrink:0},toolbar:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"12px 24px",background:"#fffde7",borderBottom:"1px solid #e0e0e0",flexShrink:0},selectAllBtn:{padding:"6px 16px",background:"#fdd835",color:"#333",border:"none",borderRadius:"6px",cursor:"pointer",fontSize:"13px",fontWeight:"500"},selectionInfo:{fontSize:"13px",color:"#666"},eventList:{flex:1,overflowY:"auto",padding:"16px 24px",display:"flex",flexDirection:"column",gap:"16px"},eventCard:{display:"flex",gap:"12px",padding:"16px",border:"2px solid #e0e0e0",borderRadius:"12px",cursor:"pointer",transition:"all 0.2s",background:"#fff"},checkbox:{flexShrink:0,display:"flex",alignItems:"flex-start",paddingTop:"4px"},checkboxInput:{width:"18px",height:"18px",cursor:"pointer"},cardContent:{flex:1,display:"flex",flexDirection:"column",gap:"12px"},promotionHeader:{display:"flex",justifyContent:"space-between",alignItems:"center",paddingBottom:"12px",borderBottom:"1px dashed #e0e0e0"},childInfo:{display:"flex",alignItems:"center",gap:"8px"},childName:{fontSize:"18px",fontWeight:"bold",color:"#333"},childGender:{fontSize:"14px",color:"#999"},promotionBadge:{display:"flex",alignItems:"center",gap:"8px"},promotionLabel:{fontSize:"12px",color:"#666"},rankBadge:{padding:"4px 12px",borderRadius:"12px",color:"#fff",fontSize:"13px",fontWeight:"bold"},sectInfo:{display:"flex",alignItems:"center",gap:"8px",padding:"8px 12px",background:"#e3f2fd",borderRadius:"8px"},sectIcon:{fontSize:"16px"},sectName:{fontSize:"14px",color:"#1976d2",fontWeight:"600"},giftSection:{display:"flex",flexDirection:"column",gap:"8px",padding:"12px",background:"#f3e5f5",borderRadius:"8px",border:"1px solid #ce93d8"},giftHeader:{display:"flex",alignItems:"center",gap:"8px"},giftLabel:{fontSize:"13px",color:"#666",fontWeight:"500"},giftName:{fontSize:"15px",fontWeight:"bold"},giftDesc:{fontSize:"12px",color:"#666",fontStyle:"italic"},giftStats:{display:"flex",gap:"8px",flexWrap:"wrap"},statBadge:{padding:"3px 8px",background:"#fff",borderRadius:"8px",fontSize:"11px",color:"#666",fontWeight:"500",border:"1px solid #e0e0e0"},giftEffect:{fontSize:"12px",color:"#4caf50",fontWeight:"500"},message:{fontSize:"13px",color:"#555",lineHeight:"1.5",padding:"8px 12px",background:"#fff8e1",borderRadius:"8px",border:"1px solid #fff176"},footer:{display:"flex",gap:"12px",padding:"16px 24px",borderTop:"2px solid #fdd835",background:"#fffde7",flexShrink:0},confirmBtn:{flex:1,padding:"12px",background:"#4caf50",color:"#fff",border:"none",borderRadius:"8px",cursor:"pointer",fontSize:"15px",fontWeight:"bold",transition:"all 0.2s"},cancelBtn:{padding:"12px 24px",background:"#e0e0e0",border:"none",borderRadius:"8px",cursor:"pointer",fontSize:"15px"}},LC=({marriagePlans:e,onConfirm:t,onClose:n,onModify:s})=>{const[o,i]=y.useState(new Set(e.map(c=>c.childId))),a=c=>{const f=new Set(o);f.has(c)?f.delete(c):f.add(c),i(f)},l=()=>{o.size===e.length?i(new Set):i(new Set(e.map(c=>c.childId)))},d=()=>{const c=e.filter(f=>o.has(f.childId));t(c)},u=o.size*500,p=c=>{switch(c){case"talented":return" ";case"beautiful":return" ";case"wise":return" ";case"buddha":return" ";default:return" "}};return r.jsx("div",{style:He.overlay,children:r.jsxs("div",{style:He.modal,children:[r.jsxs("div",{style:He.header,children:[r.jsx("h3",{style:He.title,children:" "}),r.jsx("button",{onClick:n,style:He.closeIcon,children:""})]}),r.jsxs("div",{style:He.summary,children:[r.jsxs("div",{style:He.summaryItem,children:[r.jsx("span",{style:He.summaryLabel,children:""}),r.jsxs("span",{style:He.summaryValue,children:[e.length," "]})]}),r.jsxs("div",{style:He.summaryItem,children:[r.jsx("span",{style:He.summaryLabel,children:""}),r.jsxs("span",{style:{...He.summaryValue,color:"#4caf50"},children:[o.size," "]})]}),r.jsxs("div",{style:He.summaryItem,children:[r.jsx("span",{style:He.summaryLabel,children:""}),r.jsxs("span",{style:{...He.summaryValue,color:"#ff9800"},children:[u," "]})]})]}),r.jsxs("div",{style:He.toolbar,children:[r.jsx("button",{onClick:l,style:He.selectAllBtn,children:o.size===e.length?" ":""}),r.jsx("div",{style:He.hint,children:""})]}),r.jsx("div",{style:He.planList,children:e.map(c=>{var w,S,h,g,v,j,R,b,_,I,k,T;const f=o.has(c.childId),x=c.childRef,C=c.spouse;return r.jsxs("div",{style:{...He.planCard,borderColor:f?"#4caf50":"#e0e0e0",background:f?"#f1f8f4":"#fff",opacity:f?1:.6},onClick:()=>a(c.childId),children:[r.jsx("div",{style:He.checkbox,children:r.jsx("input",{type:"checkbox",checked:f,onChange:()=>a(c.childId),style:He.checkboxInput})}),r.jsxs("div",{style:He.cardContent,children:[r.jsxs("div",{style:He.personSection,children:[r.jsx("div",{style:He.avatarWrapper,children:r.jsx(Vr,{avatar:x.avatar,gender:x.gender,size:60})}),r.jsxs("div",{style:He.personInfo,children:[r.jsx("div",{style:He.personName,children:x.name}),r.jsxs("div",{style:He.personDetail,children:[x.gender===""?"":""," | ",x.tierTitle||""]}),r.jsxs("div",{style:He.stats,children:[r.jsxs("span",{style:He.statItem,children:[" ",((w=x.stats)==null?void 0:w.aptitude)||0]}),r.jsxs("span",{style:He.statItem,children:[" ",((S=x.stats)==null?void 0:S.looks)||0]}),r.jsxs("span",{style:He.statItem,children:[" ",((h=x.stats)==null?void 0:h.intelligence)||0]})]})]})]}),r.jsxs("div",{style:He.arrow,children:[r.jsx("div",{style:He.arrowIcon,children:""}),r.jsx("div",{style:He.arrowLine})]}),r.jsxs("div",{style:He.personSection,children:[r.jsx("div",{style:He.avatarWrapper,children:r.jsx(Vr,{avatar:C.avatar,gender:C.gender,size:60})}),r.jsxs("div",{style:He.personInfo,children:[r.jsxs("div",{style:He.personName,children:[C.name,r.jsx("span",{style:He.archetypeBadge,children:p(C.archetype)})]}),r.jsxs("div",{style:He.personDetail,children:[C.gender===""?"":""," | ",C.tierTitle||""]}),r.jsxs("div",{style:He.stats,children:[r.jsxs("span",{style:{...He.statItem,color:((g=C.stats)==null?void 0:g.aptitude)>=80?"#e91e63":"#666"},children:[" ",((v=C.stats)==null?void 0:v.aptitude)||0]}),r.jsxs("span",{style:{...He.statItem,color:((j=C.stats)==null?void 0:j.looks)>=80?"#e91e63":"#666"},children:[" ",((R=C.stats)==null?void 0:R.looks)||0]}),r.jsxs("span",{style:{...He.statItem,color:((b=C.stats)==null?void 0:b.intelligence)>=80?"#e91e63":"#666"},children:[" ",((_=C.stats)==null?void 0:_.intelligence)||0]})]})]})]}),r.jsx("div",{style:He.spiritRootSection,children:r.jsxs("div",{style:He.spiritRoot,children:["",((I=C.spiritRoot)==null?void 0:I.type)||"",((T=(k=C.spiritRoot)==null?void 0:k.elements)==null?void 0:T.length)>0&&` (${C.spiritRoot.elements.join("")})`]})})]})]},c.childId)})}),r.jsxs("div",{style:He.footer,children:[r.jsxs("button",{style:He.confirmBtn,onClick:d,disabled:o.size===0,children:[" (",o.size,"   ",u," )"]}),r.jsx("button",{style:He.cancelBtn,onClick:n,children:""})]})]})})},He={overlay:{position:"fixed",top:0,left:0,right:0,bottom:0,background:"rgba(0, 0, 0, 0.75)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:3e3,padding:"20px"},modal:{background:"linear-gradient(135deg, #fff8e1 0%, #ffe0b2 100%)",borderRadius:"16px",width:"90%",maxWidth:"1000px",maxHeight:"85vh",display:"flex",flexDirection:"column",boxShadow:"0 10px 40px rgba(0,0,0,0.3)",overflow:"hidden",border:"2px solid #ffb74d"},header:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"20px 24px",borderBottom:"2px solid #ffb74d",background:"linear-gradient(90deg, #ffe0b2, #ffcc80)",flexShrink:0},title:{margin:0,fontSize:"22px",color:"#d84315",fontWeight:"bold"},closeIcon:{background:"none",border:"none",fontSize:"28px",cursor:"pointer",color:"#d84315",padding:"0",lineHeight:"1"},summary:{display:"flex",justifyContent:"space-around",padding:"16px 24px",background:"#fff8e1",borderBottom:"1px solid #ffb74d",flexShrink:0},summaryItem:{display:"flex",flexDirection:"column",alignItems:"center",gap:"4px"},summaryLabel:{fontSize:"12px",color:"#666"},summaryValue:{fontSize:"16px",fontWeight:"bold",color:"#d84315"},toolbar:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"12px 24px",background:"#fafafa",borderBottom:"1px solid #e0e0e0",flexShrink:0},selectAllBtn:{padding:"6px 16px",background:"#ff9800",color:"#fff",border:"none",borderRadius:"6px",cursor:"pointer",fontSize:"13px",fontWeight:"500"},hint:{fontSize:"12px",color:"#999",fontStyle:"italic"},planList:{flex:1,overflowY:"auto",padding:"16px 24px",display:"flex",flexDirection:"column",gap:"16px"},planCard:{display:"flex",gap:"12px",padding:"16px",border:"2px solid #e0e0e0",borderRadius:"16px",cursor:"pointer",transition:"all 0.2s",background:"#fff"},checkbox:{flexShrink:0,display:"flex",alignItems:"center"},checkboxInput:{width:"20px",height:"20px",cursor:"pointer"},cardContent:{flex:1,display:"flex",alignItems:"center",gap:"20px"},personSection:{flex:1,display:"flex",gap:"12px",alignItems:"center"},avatarWrapper:{flexShrink:0},personInfo:{flex:1,display:"flex",flexDirection:"column",gap:"6px"},personName:{fontSize:"16px",fontWeight:"bold",color:"#333",display:"flex",alignItems:"center",gap:"8px"},archetypeBadge:{fontSize:"11px",padding:"2px 8px",background:"#e91e63",color:"#fff",borderRadius:"10px",fontWeight:"500"},personDetail:{fontSize:"13px",color:"#666"},stats:{display:"flex",gap:"12px",fontSize:"12px"},statItem:{color:"#666"},arrow:{display:"flex",flexDirection:"column",alignItems:"center",gap:"4px",flexShrink:0},arrowIcon:{fontSize:"20px"},arrowLine:{width:"2px",height:"40px",background:"linear-gradient(to bottom, #e91e63, #f06292)",borderRadius:"1px"},spiritRootSection:{width:"100%",padding:"8px 12px",background:"#fff3e0",borderRadius:"8px",fontSize:"12px",color:"#e65100",marginTop:"8px"},spiritRoot:{fontWeight:"500"},footer:{display:"flex",gap:"12px",padding:"16px 24px",borderTop:"2px solid #ffb74d",background:"#fff8e1",flexShrink:0},confirmBtn:{flex:1,padding:"12px",background:"#4caf50",color:"#fff",border:"none",borderRadius:"8px",cursor:"pointer",fontSize:"15px",fontWeight:"bold",transition:"all 0.2s"},cancelBtn:{padding:"12px 24px",background:"#e0e0e0",border:"none",borderRadius:"8px",cursor:"pointer",fontSize:"15px"}},$C=({manualItems:e,children:t,onAssign:n,onClose:s})=>{const[o,i]=y.useState([]),[a,l]=y.useState("AUTO"),u=(()=>{const S=[];return e.forEach(h=>{(h.manualIds&&h.manualIds.length?h.manualIds:h.manualId?[h.manualId]:[]).forEach(v=>{const j=vn[v];j&&t.forEach(R=>{var k,T,N;if(!R||!R.spiritRoot||R.cultivationMethod===v)return;const b=Ic(v,R.spiritRoot);if(!(b!=null&&b.compatibility))return;const I=(b.compatibility.compatibility||0)+(((k=R.stats)==null?void 0:k.aptitude)||0)/200;S.push({manualId:v,manualName:j.name,childId:R.id,childName:R.name,childTier:R.tierTitle||"",childAptitude:((T=R.stats)==null?void 0:T.aptitude)||0,currentManual:R.cultivationMethod,currentManualName:((N=vn[R.cultivationMethod])==null?void 0:N.name)||"",compatibility:b.compatibility,score:I,itemInstanceId:h.instanceId})})})}),S.sort((h,g)=>g.score-h.score)})(),c=(()=>{const S=new Map;return u.forEach(h=>{const g=S.get(h.childId);(!g||h.score>g.score)&&S.set(h.childId,h)}),Array.from(S.values()).filter(h=>{var v,j,R;const g=((R=(j=Ic(h.currentManual,(v=t.find(b=>b.id===h.childId))==null?void 0:v.spiritRoot))==null?void 0:j.compatibility)==null?void 0:R.compatibility)||0;return h.compatibility.compatibility>g}).slice(0,10)})(),f=S=>{const h=`${S.childId}-${S.manualId}`,g=o.findIndex(v=>`${v.childId}-${v.manualId}`===h);g>=0?i(v=>v.filter((j,R)=>R!==g)):i(v=>[...v.filter(j=>j.childId!==S.childId),S])},x=()=>{i(c)},C=()=>{n(o)},w=S=>{switch(S){case"":return"#4caf50";case"":return"#8bc34a";case"":return"#ffc107";case"":return"#ff9800";case"":return"#f44336";default:return"#9e9e9e"}};return r.jsx("div",{style:We.overlay,children:r.jsxs("div",{style:We.modal,children:[r.jsxs("div",{style:We.header,children:[r.jsx("h3",{style:We.title,children:" "}),r.jsx("button",{onClick:s,style:We.closeIcon,children:""})]}),r.jsxs("div",{style:We.modeSwitch,children:[r.jsx("button",{style:{...We.modeBtn,...a==="AUTO"?We.modeBtnActive:{}},onClick:()=>l("AUTO"),children:" "}),r.jsx("button",{style:{...We.modeBtn,...a==="MANUAL"?We.modeBtnActive:{}},onClick:()=>l("MANUAL"),children:" "})]}),a==="AUTO"?r.jsxs("div",{style:We.content,children:[r.jsxs("div",{style:We.recommendHeader,children:[r.jsxs("div",{style:We.recommendTitle,children:[" ",c.length," "]}),c.length>0&&r.jsx("button",{onClick:x,style:We.quickSelectBtn,children:" "})]}),c.length===0?r.jsx("div",{style:We.empty,children:" "}):r.jsx("div",{style:We.optionList,children:c.map((S,h)=>{const g=o.some(v=>v.childId===S.childId&&v.manualId===S.manualId);return r.jsxs("div",{style:{...We.optionCard,borderColor:g?"#4caf50":"#e0e0e0",background:g?"#f1f8f4":"#fff"},onClick:()=>f(S),children:[r.jsxs("div",{style:We.optionHeader,children:[r.jsx("input",{type:"checkbox",checked:g,onChange:()=>f(S),style:We.checkbox}),r.jsxs("div",{style:We.optionInfo,children:[r.jsxs("div",{style:We.childInfo,children:[S.childName," (",S.childTier,")"]}),r.jsxs("div",{style:We.manualChange,children:[r.jsx("span",{style:We.oldManual,children:S.currentManualName}),r.jsx("span",{style:We.arrow,children:""}),r.jsx("span",{style:We.newManual,children:S.manualName})]})]})]}),r.jsxs("div",{style:We.compatibilityRow,children:[r.jsx("span",{style:We.compatibilityLabel,children:""}),r.jsxs("span",{style:{...We.compatibilityValue,color:w(S.compatibility.level)},children:[S.compatibility.level," (",S.compatibility.compatibility,"%)"]}),r.jsxs("span",{style:We.speedBonus,children:[" ",S.compatibility.speedMultiplier]})]}),S.compatibility.desc&&r.jsxs("div",{style:We.compatibilityDesc,children:[" ",S.compatibility.desc]})]},`${S.childId}-${S.manualId}`)})})]}):r.jsxs("div",{style:We.content,children:[r.jsxs("div",{style:We.allOptionsHeader,children:[" ",u.length," "]}),u.length===0?r.jsx("div",{style:We.empty,children:""}):r.jsx("div",{style:We.optionList,children:u.slice(0,50).map(S=>{const h=o.some(g=>g.childId===S.childId&&g.manualId===S.manualId);return r.jsxs("div",{style:{...We.optionCard,borderColor:h?"#4caf50":"#e0e0e0",background:h?"#f1f8f4":"#fff"},onClick:()=>f(S),children:[r.jsxs("div",{style:We.optionHeader,children:[r.jsx("input",{type:"checkbox",checked:h,onChange:()=>f(S),style:We.checkbox}),r.jsxs("div",{style:We.optionInfo,children:[r.jsxs("div",{style:We.childInfo,children:[S.childName," (",S.childTier,", ",S.childAptitude,")"]}),r.jsx("div",{style:We.manualName,children:S.manualName})]})]}),r.jsxs("div",{style:We.compatibilityRow,children:[r.jsx("span",{style:{...We.compatibilityBadge,background:w(S.compatibility.level)},children:S.compatibility.level}),r.jsxs("span",{style:We.speedBonus,children:["",S.compatibility.speedMultiplier]})]})]},`${S.childId}-${S.manualId}`)})})]}),r.jsxs("div",{style:We.footer,children:[r.jsxs("div",{style:We.selectionInfo,children:[" ",o.length," "]}),r.jsxs("div",{style:We.footerActions,children:[r.jsxs("button",{style:We.confirmBtn,onClick:C,disabled:o.length===0,children:[" (",o.length,")"]}),r.jsx("button",{style:We.cancelBtn,onClick:s,children:""})]})]})]})})},We={overlay:{position:"fixed",top:0,left:0,right:0,bottom:0,background:"rgba(0, 0, 0, 0.75)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:3e3,padding:"20px"},modal:{background:"#fff",borderRadius:"16px",width:"90%",maxWidth:"900px",maxHeight:"85vh",display:"flex",flexDirection:"column",boxShadow:"0 10px 40px rgba(0,0,0,0.3)",overflow:"hidden"},header:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"20px 24px",borderBottom:"2px solid #7e57c2",background:"linear-gradient(90deg, #ede7f6, #d1c4e9)",flexShrink:0},title:{margin:0,fontSize:"22px",color:"#5e35b1",fontWeight:"bold"},closeIcon:{background:"none",border:"none",fontSize:"28px",cursor:"pointer",color:"#5e35b1",padding:"0",lineHeight:"1"},modeSwitch:{display:"flex",gap:"8px",padding:"16px 24px",background:"#f5f5f5",borderBottom:"1px solid #e0e0e0",flexShrink:0},modeBtn:{flex:1,padding:"10px",background:"#fff",border:"2px solid #e0e0e0",borderRadius:"8px",cursor:"pointer",fontSize:"14px",fontWeight:"500",transition:"all 0.2s"},modeBtnActive:{background:"#7e57c2",color:"#fff",borderColor:"#7e57c2"},content:{flex:1,overflowY:"auto",display:"flex",flexDirection:"column"},recommendHeader:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"16px 24px",background:"#f5f5f5",borderBottom:"1px solid #e0e0e0"},recommendTitle:{fontSize:"14px",color:"#666",fontWeight:"500"},quickSelectBtn:{padding:"6px 16px",background:"#4caf50",color:"#fff",border:"none",borderRadius:"6px",cursor:"pointer",fontSize:"13px"},allOptionsHeader:{padding:"16px 24px",fontSize:"14px",color:"#666",background:"#f5f5f5",borderBottom:"1px solid #e0e0e0"},empty:{padding:"60px 24px",textAlign:"center",fontSize:"15px",color:"#999"},optionList:{padding:"16px 24px",display:"flex",flexDirection:"column",gap:"12px"},optionCard:{padding:"16px",border:"2px solid #e0e0e0",borderRadius:"12px",cursor:"pointer",transition:"all 0.2s",display:"flex",flexDirection:"column",gap:"12px"},optionHeader:{display:"flex",gap:"12px",alignItems:"flex-start"},checkbox:{width:"18px",height:"18px",cursor:"pointer",marginTop:"2px",flexShrink:0},optionInfo:{flex:1,display:"flex",flexDirection:"column",gap:"6px"},childInfo:{fontSize:"15px",fontWeight:"bold",color:"#333"},manualChange:{display:"flex",alignItems:"center",gap:"8px",fontSize:"14px"},oldManual:{color:"#999",textDecoration:"line-through"},arrow:{color:"#666"},newManual:{color:"#7e57c2",fontWeight:"600"},manualName:{fontSize:"14px",color:"#7e57c2",fontWeight:"600"},compatibilityRow:{display:"flex",gap:"12px",alignItems:"center",fontSize:"13px"},compatibilityLabel:{color:"#666"},compatibilityValue:{fontWeight:"600"},compatibilityBadge:{padding:"4px 10px",borderRadius:"12px",color:"#fff",fontSize:"12px",fontWeight:"bold"},speedBonus:{color:"#2196f3",fontWeight:"500"},compatibilityDesc:{fontSize:"12px",color:"#666",fontStyle:"italic",paddingLeft:"30px"},footer:{padding:"16px 24px",borderTop:"2px solid #e0e0e0",background:"#f5f5f5",display:"flex",justifyContent:"space-between",alignItems:"center",flexShrink:0},selectionInfo:{fontSize:"14px",color:"#666"},footerActions:{display:"flex",gap:"12px"},confirmBtn:{padding:"10px 24px",background:"#7e57c2",color:"#fff",border:"none",borderRadius:"8px",cursor:"pointer",fontSize:"15px",fontWeight:"bold",transition:"all 0.2s"},cancelBtn:{padding:"10px 24px",background:"#e0e0e0",border:"none",borderRadius:"8px",cursor:"pointer",fontSize:"15px"}},BC=({modalState:e,closeModal:t,player:n,inventory:s,handleGiftConfirm:o,handleNegotiateConfirm:i,handleShopPurchase:a,handleOptionSelect:l,handleShuraFieldSelect:d,handleBuyAuctionItem:u,handleShowAuctionPlot:p,modalMgr:c,allChildren:f,visibleChildren:x,handleEquipToChild:C,handleUseConsumable:w,handleBatchUseConsumables:S,handleDiscardFromInventory:h,handleGiveToChild:g,handleBatchGiveToChildren:v,handleSell:j,handleAutoAssignManualToChild:R,getMarketPrice:b,testQueue:_,handleTestFinish:I,handleTestQueueClose:k,childSelectorModal:T,handleChildSelectorSelect:N,closeChildSelectorModal:K,selectedChild:L,childNavigationMeta:B,handleNavigateChild:W,handleChildAction:z,setSelectedChild:ne,showSpouseSelection:Q,marryingChild:se,spouseCandidates:ye,handleSpouseSelect:Me,resetSpouseSelection:Pe,batchGiftEvents:Ke,handleBatchGiftConfirm:q,handleBatchGiftClose:de,batchPromotionEvents:Z,handleBatchPromotionConfirm:re,handleBatchPromotionClose:ce,batchMarriagePlans:le,handleBatchMarriageConfirm:we,handleBatchMarriageClose:Ue,handleBatchManualAssign:Oe})=>r.jsxs(r.Fragment,{children:[e.type==="GIFT"&&r.jsx(pC,{npc:e.data,inventory:s,onGift:o,onClose:t}),e.type==="NEGOTIATE"&&r.jsx(mC,{npc:e.data,onNegotiate:i,onClose:t}),e.type==="SHOP"&&r.jsx(gC,{items:e.data.items,playerSpiritStones:n.resources.spiritStones||0,onPurchase:a,onClose:t}),e.type==="RESULT"&&r.jsx(hC,{result:e.data,onClose:t}),e.type==="CONFIRM"&&r.jsx(xC,{message:e.data.message,input:e.data.input,onConfirm:ze=>{e.data.onConfirm(ze),t()},onCancel:t}),e.type==="EVENT"&&r.jsx(yC,{event:e.data.event,npc:e.data.npc,onClose:t,onOptionSelect:l}),e.type==="SHURA_FIELD"&&r.jsx(bC,{event:e.data,player:n,onClose:t,onOptionSelect:d}),e.type==="JEALOUSY"&&r.jsx(SC,{event:e.data,onClose:t}),e.type==="AUCTION"&&r.jsx(EC,{auction:e.data,playerResources:n.resources,onClose:t,onBuy:u,onShowPlot:p,playerSoldAuctionItems:n.soldAuctionItems||[]}),c.inventoryModal.open&&r.jsx(CC,{items:s,mode:c.inventoryModal.mode,slot:c.inventoryModal.slot,childId:c.inventoryModal.childId,children:f,batchUseItems:c.inventoryModal.batchUseItems||[],onClose:()=>c.closeInventory(),onEquip:ze=>C(c.inventoryModal.childId,c.inventoryModal.slot,ze),onUse:ze=>w(c.inventoryModal.childId,ze),onBatchUse:(ze,D)=>S(ze,D),onDiscard:ze=>h(ze),onGiveToChild:g,onBatchGive:v,onSell:(ze,D)=>j(ze,D),onAutoAssignManual:R,getMarketPrice:b}),_.length>0&&r.jsx(TC,{child:_[0],onFinish:I,onClose:k}),T.open&&r.jsx(RC,{children:x,item:T.item,items:T.items,isBatch:T.isBatch,onSelect:N,onClose:K}),L&&r.jsx(u1,{child:L,navigation:B,onNavigate:W,onClose:()=>ne(null),onAction:(ze,D)=>z(L.id,ze,D)}),Q&&se&&r.jsx(MC,{child:se,candidates:ye,onSelect:Me,onClose:Pe}),c.showBatchGiftModal&&Ke.length>0&&r.jsx(AC,{giftEvents:Ke,onConfirm:q,onClose:de}),c.showBatchPromotionModal&&Z.length>0&&r.jsx(NC,{promotionEvents:Z,onConfirm:re,onClose:ce}),c.showBatchMarriageModal&&le.length>0&&r.jsx(LC,{marriagePlans:le,onConfirm:we,onClose:Ue}),c.showBatchManualModal&&r.jsx($C,{manualItems:s.filter(ze=>ze.type==="manual"&&(ze.manualIds&&ze.manualIds.length||ze.manualId)),children:x.length?x:f,onAssign:Oe,onClose:()=>c.closeBatchManualModal()})]});function OC({npc:e,onClose:t,playerAffection:n=0}){var S,h;const[s,o]=y.useState("ALL"),[i,a]=y.useState(0),l=20;if(y.useEffect(()=>{const g=v=>{v.key==="Escape"&&t()};return window.addEventListener("keydown",g),()=>window.removeEventListener("keydown",g)},[t]),y.useEffect(()=>{a(0)},[s]),!e)return null;const d=Number(n)||0,u=Math.max(0,Math.min(100,d));if(d<30)return r.jsx("div",{className:"modal-overlay",onClick:t,children:r.jsxs("div",{className:"npc-log-modal",onClick:g=>g.stopPropagation(),children:[r.jsxs("div",{className:"log-modal-header",children:[r.jsx("div",{className:"log-modal-title",children:r.jsxs("h2",{children:[e.name," "]})}),r.jsx("button",{className:"close-btn",onClick:t,children:""})]}),r.jsxs("div",{className:"log-empty",style:{padding:"80px 20px"},children:[r.jsx("p",{style:{fontSize:"64px",margin:"0 0 20px 0"},children:""}),r.jsx("h3",{style:{color:"#ffd700",marginBottom:"12px"},children:""}),r.jsxs("p",{style:{color:"rgba(255,255,255,0.7)",fontSize:"16px"},children:[" ",e.name," ",r.jsx("br",{})," ",r.jsx("span",{style:{color:"#ffd700",fontWeight:"bold"},children:"30"})," ",e.gender===""?"":"",""]}),r.jsxs("p",{style:{color:"rgba(255,255,255,0.5)",fontSize:"14px",marginTop:"20px"},children:["",r.jsx("span",{style:{color:d<10?"#f44336":"#ff9800"},children:u})," / 30"]})]})]})});const p=Rk(e,d),c=s==="ALL"?p:p.filter(g=>g.type===s),f=Math.max(1,Math.ceil(c.length/l)),x=c.slice(i*l,(i+1)*l),C={all:p.length,interaction:p.filter(g=>g.type===xt.INTERACTION).length,stateChange:p.filter(g=>g.type===xt.STATE_CHANGE).length,daily:p.filter(g=>g.type===xt.DAILY).length},w=g=>{switch(g){case xt.INTERACTION:return{icon:"",color:"#4CAF50",label:""};case xt.STATE_CHANGE:return{icon:"",color:"#FF5722",label:""};case xt.DAILY:return{icon:"",color:"#2196F3",label:""};default:return{icon:"",color:"#9E9E9E",label:""}}};return r.jsx("div",{className:"modal-overlay",onClick:t,children:r.jsxs("div",{className:"npc-log-modal",onClick:g=>g.stopPropagation(),children:[r.jsxs("div",{className:"log-modal-header",children:[r.jsxs("div",{className:"log-modal-title",children:[r.jsxs("h2",{children:[e.name," "]}),r.jsxs("p",{className:"log-modal-subtitle",children:[e.gender===""?"":"","..."]})]}),r.jsx("button",{className:"close-btn",onClick:t,children:""})]}),r.jsxs("div",{className:"log-filter-bar",children:[r.jsxs("button",{className:`filter-btn ${s==="ALL"?"active":""}`,onClick:()=>o("ALL"),children:["  (",C.all,")"]}),r.jsxs("button",{className:`filter-btn ${s===xt.INTERACTION?"active":""}`,onClick:()=>o(xt.INTERACTION),children:["  (",C.interaction,")"]}),r.jsxs("button",{className:`filter-btn ${s===xt.STATE_CHANGE?"active":""}`,onClick:()=>o(xt.STATE_CHANGE),children:["  (",C.stateChange,")"]}),r.jsxs("button",{className:`filter-btn ${s===xt.DAILY?"active":""}`,onClick:()=>o(xt.DAILY),children:["  (",C.daily,")"]})]}),r.jsx("div",{className:"log-content",children:c.length===0?r.jsxs("div",{className:"log-empty",children:[r.jsx("p",{children:""}),r.jsx("p",{children:""}),d<80&&p.length<((S=e.logs)==null?void 0:S.length)&&r.jsx("p",{className:"log-hint",children:" "})]}):r.jsx("div",{className:"log-list",children:x.map((g,v)=>{const j=w(g.type);return r.jsxs("div",{className:`log-entry ${g.isSecret?"secret":""}`,children:[r.jsxs("div",{className:"log-header",children:[r.jsxs("span",{className:"log-type-badge",style:{backgroundColor:j.color},children:[j.icon," ",j.label]}),r.jsxs("span",{className:"log-date",children:[" ",g.year,"  ",g.month," "]}),g.isSecret&&r.jsx("span",{className:"secret-badge",title:"",children:""})]}),r.jsx("div",{className:"log-text",children:g.content})]},`${g.timestamp}-${v}`)})})}),c.length>l&&r.jsxs("div",{className:"log-pagination",children:[r.jsx("button",{className:"page-btn",onClick:()=>a(g=>Math.max(0,g-1)),disabled:i<=0,children:""}),r.jsxs("span",{className:"page-info",children:[" ",i+1," / ",f," "]}),r.jsx("button",{className:"page-btn",onClick:()=>a(g=>Math.min(f-1,g+1)),disabled:i>=f-1,children:""})]}),r.jsxs("div",{className:"log-record-count",children:[" ",c.length," "]}),d<80&&((h=e.logs)==null?void 0:h.length)>p.length&&r.jsx("div",{className:"log-footer-hint",children:"  80+ "})]})})}const PC=({player:e,enemy:t,result:n,onClose:s})=>{var d,u;const o=y.useRef(null),[i,a]=y.useState(0),l=y.useMemo(()=>zC((n==null?void 0:n.logs)||[],e),[n==null?void 0:n.logs,e,t]);return y.useEffect(()=>{if(a(0),!l.length)return;const p=setInterval(()=>{a(c=>c>=l.length?(clearInterval(p),c):c+1)},300);return()=>clearInterval(p)},[l.length]),y.useEffect(()=>{o.current&&(o.current.scrollTop=o.current.scrollHeight)},[i]),r.jsx("div",{style:xn.overlay,children:r.jsxs("div",{style:xn.window,children:[r.jsx("div",{style:xn.header,children:" "}),r.jsxs("div",{style:xn.statusBar,children:[r.jsxs("div",{style:xn.fighter,children:[r.jsx("div",{style:xn.avatar,children:""}),r.jsx("div",{children:e.name}),r.jsxs("div",{style:{color:"#d32f2f"},children:["HP: ",((d=e.combatStats)==null?void 0:d.hp)||0]}),r.jsxs("div",{style:{marginTop:6,fontSize:12,color:"#666"},children:[": ",zn(e).total]})]}),r.jsx("div",{style:xn.vs,children:"VS"}),r.jsxs("div",{style:xn.fighter,children:[r.jsx("div",{style:{...xn.avatar,background:"#d32f2f"},children:""}),r.jsx("div",{children:t.name}),r.jsxs("div",{style:{color:"#d32f2f"},children:["HP: ",((u=t.combatStats)==null?void 0:u.hp)||0]}),r.jsxs("div",{style:{marginTop:6,fontSize:12,color:"#666"},children:[": ",zn(t).total]})]})]}),r.jsx("div",{style:{padding:"10px 15px",fontSize:12,color:"#444",background:"#fff8",borderBottom:"1px solid #eee"},children:""}),r.jsx("div",{style:xn.logBox,ref:o,children:l.slice(0,i).map((p,c)=>r.jsxs("div",{style:xn.entryRow,children:[r.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8},children:[r.jsx("div",{style:{fontSize:16},children:p.icon}),r.jsxs("div",{children:[r.jsx("div",{style:{fontSize:13,color:p.isDamage?p.byPlayer?"#2e7d32":"#d32f2f":"#444",fontWeight:600},children:p.text}),p.damage!=null&&r.jsxs("div",{style:{fontSize:12,color:"#666",marginTop:4},children:[": ",r.jsx("strong",{style:{color:p.byPlayer?"#2e7d32":"#d32f2f"},children:p.damage}),p.defended?"":""]})]})]}),p.maxHp!=null&&r.jsxs("div",{style:xn.hpBarWrap,children:[r.jsx("div",{style:xn.hpBarBg,children:r.jsx("div",{style:{...xn.hpBarFill,width:`${Math.max(0,Math.min(100,Math.floor(p.remaining/p.maxHp*100)))}%`,background:p.byPlayer?"#2e7d32":"#d32f2f"}})}),r.jsxs("div",{style:{fontSize:12,color:"#333",marginLeft:8},children:[p.remaining,"/",p.maxHp," HP"]})]})]},c))}),r.jsx("button",{onClick:s,style:{...xn.btn,background:n.success?"#4caf50":"#d32f2f"},children:n.success?"":""})]})})},xn={overlay:{position:"fixed",top:0,left:0,right:0,bottom:0,background:"rgba(0,0,0,0.85)",zIndex:2200,display:"flex",alignItems:"center",justifyContent:"center"},window:{width:"90%",maxWidth:"400px",background:"#fff",borderRadius:"8px",overflow:"hidden",display:"flex",flexDirection:"column",boxShadow:"0 0 20px rgba(255,0,0,0.5)"},header:{background:"#212121",color:"#fff",padding:"15px",textAlign:"center",fontSize:"18px",fontWeight:"bold"},statusBar:{display:"flex",justifyContent:"space-between",padding:"15px",background:"#f5f5f5",borderBottom:"1px solid #ddd"},fighter:{textAlign:"center",fontSize:"12px"},avatar:{width:"40px",height:"40px",borderRadius:"50%",background:"#333",color:"white",display:"flex",alignItems:"center",justifyContent:"center",margin:"0 auto 5px"},vs:{fontSize:"24px",fontStyle:"italic",fontWeight:"bold",color:"#999",alignSelf:"center"},logBox:{padding:"15px",height:"250px",overflowY:"auto",background:"#fff",fontSize:"13px",lineHeight:"1.6"},entryRow:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"8px 0",borderBottom:"1px dashed #eee"},hpBarWrap:{display:"flex",alignItems:"center",gap:8},hpBarBg:{width:140,height:10,background:"#eee",borderRadius:6,overflow:"hidden"},hpBarFill:{height:"100%",borderRadius:6,transition:"width 0.3s ease"},btn:{padding:"15px",border:"none",color:"#fff",fontSize:"16px",cursor:"pointer",fontWeight:"bold"}};function zC(e=[],t,n){const s=[],o=/(.+)  (.+)  (\d+) ()?/,i=/(.+)  (.+)  (\d+) ()?/,a=/(.+)  HP: (\d+)\/(\d+)/;for(let l=0;l<e.length;l++){const d=e[l];let u=d.match(o)||d.match(i);if(u){const p=u[1],c=u[2],f=Number(u[3]),x=!!u[4];let C=null,w=null;if(l+1<e.length){const h=e[l+1].match(a);h&&h[1]===c&&(C=Number(h[2]),w=Number(h[3]),l++)}const S=p===t.name;s.push({icon:S?"":"",text:`${p}  ${c}`,damage:f,remaining:C,maxHp:w,defended:x,isDamage:!0,byPlayer:S});continue}s.push({icon:"",text:d,isDamage:!1})}return s}const DC=({open:e,realmName:t,progress:n,total:s,event:o,log:i,optionContext:a,onSelectOption:l,onNext:d,onStartCombat:u,onClose:p})=>{const[c,f]=y.useState(null),[x,C]=y.useState(null),[w,S]=y.useState(!1),[h,g]=y.useState(!1),[v,j]=y.useState("");if(y.useEffect(()=>{e&&S(!0)},[e]),!e)return null;const R=()=>{if(!o)return"";switch(o.kind){case"COMBAT":return"";case"BOSS":return"";case"TREASURE":return"";case"MYSTERY":return"";default:return""}},b=()=>{if(!o)return"#4a5568";switch(o.kind){case"COMBAT":return"#d32f2f";case"BOSS":return"#7b1fa2";case"TREASURE":return"#f57c00";case"MYSTERY":return"#1976d2";default:return"#388e3c"}},_=(n/s*100).toFixed(0),I=N=>{j(N.label),g(!0),l(N)},k=()=>{g(!1),j(""),setTimeout(()=>{d()},300)},T=()=>{j(""),g(!0),u()};return r.jsxs("div",{style:rt.overlay,children:[r.jsxs("div",{style:{...rt.window,animation:w?"slideIn 0.3s ease-out":"none"},children:[r.jsxs("div",{style:{...rt.header,background:`linear-gradient(135deg, ${b()}, ${b()}dd)`},children:[r.jsxs("div",{style:rt.headerTop,children:[r.jsxs("span",{style:rt.realmTitle,children:[R()," ",t]}),r.jsx("button",{style:rt.closeIconBtn,onClick:p,onMouseEnter:()=>C("close"),onMouseLeave:()=>C(null),children:""})]}),r.jsxs("div",{style:rt.progressContainer,children:[r.jsx("div",{style:{...rt.progressBar,width:`${_}%`,background:"linear-gradient(90deg, #ffd54f, #ffb300)"}}),r.jsxs("span",{style:rt.progressText,children:[n," / ",s]})]})]}),r.jsxs("div",{style:rt.body,children:[r.jsxs("div",{style:{...rt.eventCard,borderLeft:`4px solid ${b()}`},children:[r.jsxs("div",{style:rt.eventHeader,children:[r.jsx("span",{style:{...rt.eventBadge,background:b()},children:(o==null?void 0:o.kind)||""}),r.jsx("h3",{style:rt.eventTitle,children:(o==null?void 0:o.title)||""})]}),r.jsx("p",{style:rt.eventDesc,children:(o==null?void 0:o.desc)||""})]}),(o==null?void 0:o.options)&&o.options.length>0&&r.jsxs("div",{style:rt.optionsContainer,children:[r.jsx("div",{style:rt.optionsLabel,children:" "}),r.jsx("div",{style:rt.options,children:o.options.map((N,K)=>{const L=a||{},B=!N.condition||N.condition(L);return r.jsxs("button",{style:{...rt.optionBtn,...c===K&&B?rt.optionBtnHover:{},...B?{}:rt.optionBtnDisabled},onMouseEnter:()=>f(K),onMouseLeave:()=>f(null),onClick:()=>{B&&I(N)},disabled:!B,"aria-disabled":!B,children:[r.jsx("span",{style:rt.optionIcon,children:""}),r.jsx("span",{style:rt.optionLabel,children:N.label})]},K)})})]}),((o==null?void 0:o.kind)==="COMBAT"||(o==null?void 0:o.kind)==="BOSS")&&r.jsxs("button",{style:{...rt.fightBtn,...x==="fight"?rt.fightBtnHover:{}},onMouseEnter:()=>C("fight"),onMouseLeave:()=>C(null),onClick:T,children:[r.jsx("span",{style:rt.fightIcon,children:""}),r.jsx("span",{children:""})]})]}),r.jsx("div",{style:rt.footer,children:r.jsx("button",{style:{...rt.actionBtn,...rt.exitBtn,...x==="exit"?rt.exitBtnHover:{}},onMouseEnter:()=>C("exit"),onMouseLeave:()=>C(null),onClick:p,children:r.jsx("span",{children:""})})})]}),h&&r.jsx("div",{style:rt.resultOverlay,children:r.jsxs("div",{style:rt.resultBox,children:[r.jsx("div",{style:rt.resultIcon,children:""}),r.jsx("div",{style:rt.resultTitle,children:""}),r.jsx("div",{style:rt.resultMessage,children:i&&i.length>0?i[i.length-1]:v}),r.jsx("button",{style:{...rt.resultBtn,...x==="result"?rt.resultBtnHover:{}},onMouseEnter:()=>C("result"),onMouseLeave:()=>C(null),onClick:k,children:""})]})}),r.jsx("style",{children:`
        @keyframes slideIn {
          from {
            opacity: 0;
            transform: translateY(-30px) scale(0.95);
          }
          to {
            opacity: 1;
            transform: translateY(0) scale(1);
          }
        }
        @keyframes fadeIn {
          from {
            opacity: 0;
            transform: translateX(-10px);
          }
          to {
            opacity: 1;
            transform: translateX(0);
          }
        }
        @keyframes popIn {
          0% {
            opacity: 0;
            transform: scale(0.8);
          }
          50% {
            transform: scale(1.05);
          }
          100% {
            opacity: 1;
            transform: scale(1);
          }
        }
        @keyframes bounce {
          0%, 100% {
            transform: translateY(0);
          }
          50% {
            transform: translateY(-10px);
          }
        }
      `})]})},rt={overlay:{position:"fixed",top:0,left:0,right:0,bottom:0,background:"rgba(0, 0, 0, 0.75)",backdropFilter:"blur(4px)",zIndex:2100,display:"flex",alignItems:"center",justifyContent:"center",padding:"20px"},window:{width:"100%",maxWidth:"600px",background:"linear-gradient(to bottom, #ffffff, #f8f9fa)",borderRadius:"16px",boxShadow:"0 20px 60px rgba(0, 0, 0, 0.4)",overflow:"hidden",display:"flex",flexDirection:"column",maxHeight:"90vh"},header:{color:"#fff",padding:"16px 20px",position:"relative"},headerTop:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"12px"},realmTitle:{fontSize:"18px",fontWeight:"bold",textShadow:"0 2px 4px rgba(0,0,0,0.2)"},closeIconBtn:{background:"rgba(255,255,255,0.2)",border:"none",color:"#fff",width:"32px",height:"32px",borderRadius:"50%",cursor:"pointer",fontSize:"20px",display:"flex",alignItems:"center",justifyContent:"center",transition:"all 0.2s ease",":hover":{background:"rgba(255,255,255,0.3)"}},progressContainer:{position:"relative",background:"rgba(0,0,0,0.2)",height:"24px",borderRadius:"12px",overflow:"hidden"},progressBar:{height:"100%",transition:"width 0.5s ease",borderRadius:"12px",boxShadow:"inset 0 2px 4px rgba(0,0,0,0.1)"},progressText:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",fontSize:"13px",fontWeight:"bold",textShadow:"0 1px 2px rgba(0,0,0,0.3)"},body:{padding:"20px",flex:1,overflowY:"auto"},eventCard:{background:"#fff",borderRadius:"12px",padding:"16px",marginBottom:"16px",boxShadow:"0 2px 8px rgba(0,0,0,0.08)"},eventHeader:{display:"flex",alignItems:"center",gap:"10px",marginBottom:"10px"},eventBadge:{padding:"4px 12px",borderRadius:"12px",color:"#fff",fontSize:"11px",fontWeight:"bold",textTransform:"uppercase",letterSpacing:"0.5px"},eventTitle:{fontSize:"18px",fontWeight:"bold",color:"#1a202c",margin:0},eventDesc:{fontSize:"14px",color:"#4a5568",lineHeight:1.7,margin:0},optionsContainer:{marginBottom:"16px"},optionsLabel:{fontSize:"13px",fontWeight:"600",color:"#2d3748",marginBottom:"10px"},options:{display:"grid",gridTemplateColumns:"1fr",gap:"10px"},optionBtn:{display:"flex",alignItems:"center",gap:"10px",padding:"14px 16px",border:"2px solid #e2e8f0",borderRadius:"10px",background:"#fff",cursor:"pointer",fontSize:"14px",fontWeight:"500",color:"#2d3748",transition:"all 0.2s ease",textAlign:"left"},optionBtnHover:{border:"2px solid #4299e1",background:"#ebf8ff",transform:"translateX(4px)",boxShadow:"0 4px 12px rgba(66, 153, 225, 0.15)"},optionBtnDisabled:{borderColor:"#cbd5e1",background:"#f8fafc",color:"#94a3b8",cursor:"not-allowed",opacity:.7},optionIcon:{fontSize:"16px"},optionLabel:{flex:1},fightBtn:{width:"100%",display:"flex",alignItems:"center",justifyContent:"center",gap:"10px",padding:"16px",border:"none",borderRadius:"10px",background:"linear-gradient(135deg, #dc2626, #b91c1c)",color:"#fff",fontWeight:"bold",fontSize:"16px",cursor:"pointer",marginBottom:"16px",transition:"all 0.3s ease",boxShadow:"0 4px 12px rgba(220, 38, 38, 0.3)"},fightBtnHover:{transform:"translateY(-2px)",boxShadow:"0 6px 20px rgba(220, 38, 38, 0.4)"},fightIcon:{fontSize:"20px",animation:"pulse 1.5s ease-in-out infinite"},footer:{display:"flex",gap:"12px",padding:"16px 20px",background:"#fff",borderTop:"1px solid #e2e8f0"},actionBtn:{flex:1,display:"flex",alignItems:"center",justifyContent:"center",gap:"8px",padding:"14px 20px",border:"none",borderRadius:"10px",cursor:"pointer",fontWeight:"600",fontSize:"15px",transition:"all 0.2s ease"},exitBtn:{background:"#f1f5f9",color:"#475569",border:"1px solid #cbd5e1"},exitBtnHover:{background:"#e2e8f0",border:"1px solid #94a3b8"},resultOverlay:{position:"absolute",top:0,left:0,right:0,bottom:0,background:"rgba(0, 0, 0, 0.6)",backdropFilter:"blur(2px)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:10,borderRadius:"16px"},resultBox:{background:"linear-gradient(135deg, #ffffff, #f0f9ff)",borderRadius:"16px",padding:"32px",maxWidth:"400px",width:"90%",boxShadow:"0 20px 60px rgba(0, 0, 0, 0.3)",textAlign:"center",animation:"popIn 0.3s ease-out",border:"2px solid #3b82f6"},resultIcon:{fontSize:"48px",marginBottom:"16px",animation:"bounce 0.6s ease-in-out"},resultTitle:{fontSize:"20px",fontWeight:"bold",color:"#1e40af",marginBottom:"16px"},resultMessage:{fontSize:"15px",color:"#475569",lineHeight:1.8,marginBottom:"24px",padding:"16px",background:"rgba(59, 130, 246, 0.08)",borderRadius:"8px",border:"1px solid rgba(59, 130, 246, 0.2)"},resultBtn:{padding:"12px 32px",background:"linear-gradient(135deg, #3b82f6, #2563eb)",color:"#fff",border:"none",borderRadius:"8px",fontSize:"16px",fontWeight:"600",cursor:"pointer",transition:"all 0.2s ease",boxShadow:"0 4px 12px rgba(59, 130, 246, 0.3)"},resultBtnHover:{transform:"translateY(-2px)",boxShadow:"0 6px 20px rgba(59, 130, 246, 0.4)"}},FC=({event:e,onClose:t,onAssign:n})=>{var f,x,C,w;if(!e)return null;const{child:s,selectableSects:o=[],otherSectOptions:i=[],title:a,message:l}=e,[d,u]=y.useState(!1),p=S=>{if(typeof S.compatibility=="number")return S.compatibility;const h=S.sect||S;return Ey(s,h)},c=S=>{if(S.admission&&S.admission.qualified===!1)return;const h=S.sect||S,g=S.predictedRank||"";n(s.id,h.id,g)};return r.jsx("div",{style:Gn.overlay,children:r.jsxs("div",{style:Gn.card,children:[r.jsx("h2",{children:a||""}),r.jsx("p",{style:{color:"#444"},children:l}),r.jsxs("div",{style:Gn.content,children:[r.jsxs("div",{style:Gn.childBox,children:[r.jsxs("h3",{children:[s.name," (",s.gender,")"]}),r.jsxs("p",{children:[": ",((f=s.stats)==null?void 0:f.aptitude)||0]}),r.jsxs("p",{children:[": ",r.jsx("strong",{style:{color:((x=s.spiritRoot)==null?void 0:x.color)||"#666"},children:((C=s.spiritRoot)==null?void 0:C.type)||""})]}),r.jsx("div",{style:{display:"flex",gap:6},children:(((w=s.spiritRoot)==null?void 0:w.elements)||[]).map(S=>r.jsx("span",{style:{padding:"4px 8px",background:"#eee",borderRadius:6},children:S},S))})]}),r.jsx("div",{style:Gn.listBox,children:o.map(S=>{var I;const h=S.sect||S,g=S.predictedRank,v=S.resources||[],j=S.admission||{},R=j.qualified!==!1,b=j.summary||j.notes||"",_=R?j.notes||"":((I=j.reasons)==null?void 0:I.join(""))||"";return r.jsxs("div",{style:Gn.sectRow,children:[r.jsxs("div",{children:[r.jsx("div",{style:{fontWeight:"bold"},children:h.name}),r.jsx("div",{style:{fontSize:12,color:"#666"},children:h.desc}),r.jsxs("div",{style:{fontSize:12,color:"#444",marginTop:6},children:[": ",v.join(", ")||""]}),r.jsxs("div",{style:{fontSize:12,color:"#888",marginTop:4},children:[": ",b]}),r.jsx("div",{style:{fontSize:12,color:R?"#1b5e20":"#a00"},children:_})]}),r.jsxs("div",{style:{textAlign:"right"},children:[r.jsxs("div",{style:{marginBottom:6},children:[": ",p(S)]}),r.jsxs("div",{style:{fontSize:12,color:"#333",marginBottom:6},children:[": ",g||""]}),r.jsx("button",{disabled:!R,onClick:()=>c(S),style:{...Gn.btn,opacity:R?1:.4,cursor:R?"pointer":"not-allowed"},children:R?"":""})]})]},h.id)})}),i.length>0&&r.jsxs("div",{style:{marginTop:12},children:[r.jsx("button",{onClick:()=>u(S=>!S),style:Gn.secondaryBtn,children:d?"":""}),d&&r.jsx("div",{style:Gn.otherList,children:i.map(S=>{var R;const h=S.sect||S,g=S.admission||{},v=g.qualified!==!1,j=((R=g.reasons)==null?void 0:R.join(""))||"";return r.jsxs("div",{style:Gn.otherRow,children:[r.jsxs("div",{children:[r.jsx("div",{style:{fontWeight:"bold"},children:h.name}),r.jsx("div",{style:{fontSize:12,color:"#666"},children:g.summary||h.desc}),r.jsx("div",{style:{fontSize:12,color:v?"#1b5e20":"#a00"},children:v?` ${p(S)}  `:`${j}`})]}),r.jsx("button",{disabled:!v,onClick:()=>c(S),style:{...Gn.btn,opacity:v?1:.35,cursor:v?"pointer":"not-allowed"},children:v?"":""})]},h.id)})})]})]}),r.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginTop:12},children:[r.jsx("button",{onClick:t,style:Gn.cancel,children:""}),r.jsx("p",{style:{fontSize:"11px",color:"#999",marginTop:"6px",marginLeft:"10px"},children:""})]})]})})},Gn={overlay:{position:"fixed",inset:0,background:"rgba(0,0,0,0.7)",display:"flex",justifyContent:"center",alignItems:"center",zIndex:500,padding:"10px",overflowY:"auto"},card:{width:"100%",maxWidth:"640px",background:"#fff",borderRadius:12,padding:"16px",maxHeight:"90vh",overflowY:"auto",margin:"auto"},content:{display:"flex",gap:12,flexDirection:window.innerWidth<=768?"column":"row"},childBox:{width:window.innerWidth<=768?"100%":"220px",padding:12,background:"#fafafa",borderRadius:8},listBox:{flex:1,display:"flex",flexDirection:"column",gap:8},sectRow:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:10,borderRadius:8,background:"#fff",boxShadow:"0 1px 4px rgba(0,0,0,0.05)",flexDirection:window.innerWidth<=480?"column":"row",gap:window.innerWidth<=480?"10px":"0"},btn:{padding:"8px 12px",background:"#3e2723",color:"white",border:"none",borderRadius:6,cursor:"pointer",fontSize:"clamp(12px, 3vw, 14px)",whiteSpace:"nowrap"},cancel:{padding:"8px 12px",background:"#ddd",border:"none",borderRadius:6,cursor:"pointer",fontSize:"clamp(12px, 3vw, 14px)"},secondaryBtn:{marginTop:8,padding:"6px 10px",background:"#f5f5f5",border:"1px solid #ccc",borderRadius:6,cursor:"pointer",fontSize:"clamp(12px, 3vw, 13px)"},otherList:{marginTop:10,display:"flex",flexDirection:"column",gap:8},otherRow:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"8px 10px",borderRadius:8,background:"#fafafa"}},Di=[{id:1,title:"",content:`
      <p> </p>
      <p><strong></strong><strong></strong></p>
      <p><strong></strong></p>
      <br/>
      <p> <strong></strong></p>
      <ul>
        <li> </li>
        <li> </li>
        <li> </li>
        <li> </li>
      </ul>
    `},{id:2,title:"",content:`
      <p> <strong></strong></p>
      <br/>
      <p> <strong></strong></p>
      <ul>
        <li><strong> </strong>NPC</li>
        <li><strong> </strong></li>
        <li><strong> </strong></li>
        <li><strong> </strong></li>
        <li><strong> </strong></li>
        <li><strong> </strong></li>
      </ul>
    `},{id:3,title:"",content:`
      <p> <strong></strong></p>
      <br/>
      <p><strong></strong></p>
      <p><strong></strong>10%</p>
      <br/>
      <p> <strong></strong></p>
      <ul>
        <li> /10% </li>
        <li> 50% </li>
        <li> 100% </li>
      </ul>
      <br/>
      <p> <strong></strong></p>
      <ul>
        <li>></li>
        <li></li>
        <li></li>
      </ul>
    `},{id:4,title:"",content:`
      <p> <strong></strong></p>
      <br/>
      <p><strong></strong></p>
      <ul>
        <li></li>
        <li> <strong>100</strong> </li>
        <li><strong>""</strong></li>
      </ul>
      <br/>
      <p> <strong></strong></p>
      <ul>
        <li> HP()  ATK()</li>
        <li></li>
      </ul>
    `},{id:5,title:"",content:`
      <p> <strong></strong></p>
      <br/>
      <p> <strong></strong></p>
      <p></p>
      <br/>
      <p> <strong></strong></p>
      <ul>
        <li>NPC</li>
        <li> </li>
        <li>6</li>
        <li></li>
      </ul>
      <br/>
      <p style="text-align:center; color:#d32f2f; font-weight:bold;">
        
      </p>
    `}],HC=({onClose:e,onComplete:t})=>{const[n,s]=y.useState(0),o=()=>{n<Di.length-1?s(n+1):(t&&t(),e())},i=()=>{t&&t(),e()},a=Di[n],l=(n+1)/Di.length*100;return r.jsx("div",{style:En.overlay,children:r.jsxs("div",{style:En.modal,children:[r.jsxs("div",{style:En.header,children:[r.jsxs("div",{style:En.headerContent,children:[r.jsxs("span",{style:En.stepIndicator,children:[" ",n+1," / ",Di.length]}),r.jsx("h3",{style:En.title,children:a.title})]}),r.jsx("button",{onClick:i,style:En.skipBtn,children:""})]}),r.jsx("div",{style:En.progressBar,children:r.jsx("div",{style:{...En.progressFill,width:`${l}%`}})}),r.jsx("div",{style:En.content,children:r.jsx("div",{style:En.contentText,dangerouslySetInnerHTML:{__html:a.content}})}),r.jsxs("div",{style:En.footer,children:[n>0&&r.jsx("button",{onClick:()=>s(n-1),style:En.prevBtn,children:""}),r.jsx("div",{style:{flex:1}}),r.jsx("button",{onClick:o,style:En.nextBtn,children:n===Di.length-1?"":""})]})]})})},En={overlay:{position:"fixed",top:0,left:0,right:0,bottom:0,background:"rgba(0, 0, 0, 0.85)",zIndex:9999,display:"flex",alignItems:"center",justifyContent:"center",animation:"fadeIn 0.3s ease-in"},modal:{width:"90%",maxWidth:"550px",maxHeight:"85vh",background:"linear-gradient(135deg, #ffffff 0%, #f5f5f5 100%)",borderRadius:"16px",boxShadow:"0 20px 60px rgba(0,0,0,0.5)",display:"flex",flexDirection:"column",overflow:"hidden",border:"2px solid #d4af37"},header:{padding:"20px",background:"linear-gradient(135deg, #5d4037 0%, #3e2723 100%)",color:"#fff",display:"flex",justifyContent:"space-between",alignItems:"flex-start"},headerContent:{flex:1},stepIndicator:{display:"inline-block",background:"rgba(255, 255, 255, 0.2)",padding:"4px 12px",borderRadius:"12px",fontSize:"12px",marginBottom:"8px"},title:{margin:0,fontSize:"20px",fontWeight:"bold"},skipBtn:{background:"transparent",border:"1px solid rgba(255, 255, 255, 0.5)",color:"#fff",padding:"6px 12px",borderRadius:"4px",cursor:"pointer",fontSize:"13px",transition:"all 0.3s"},progressBar:{width:"100%",height:"4px",background:"#e0e0e0"},progressFill:{height:"100%",background:"linear-gradient(90deg, #d4af37 0%, #f4e4a6 100%)",transition:"width 0.3s ease"},content:{flex:1,padding:"30px",overflowY:"auto",fontSize:"14px",lineHeight:"1.8"},contentText:{color:"#333"},footer:{padding:"15px 20px",borderTop:"1px solid #e0e0e0",background:"#fff",display:"flex",justifyContent:"space-between",gap:"10px"},prevBtn:{padding:"10px 20px",background:"#9e9e9e",color:"#fff",border:"none",borderRadius:"6px",cursor:"pointer",fontSize:"14px",fontWeight:"bold",transition:"all 0.3s"},nextBtn:{padding:"10px 24px",background:"linear-gradient(135deg, #d4af37 0%, #f4e4a6 100%)",color:"#3e2723",border:"none",borderRadius:"6px",cursor:"pointer",fontSize:"14px",fontWeight:"bold",transition:"all 0.3s",boxShadow:"0 2px 8px rgba(212, 175, 55, 0.4)"}},Tl=[{id:"INTRO",title:"  ()",content:`
      <p><strong></strong><strong></strong></p>
      <p><strong></strong></p>
      <ul>
        <li><strong></strong></li>
        <li><strong></strong></li>
        <li><strong></strong><strong></strong></li>
        <li><strong></strong></li>
      </ul>
    `},{id:"FEEDBACK",title:"  ()",content:`
      <p><strong></strong></p>
      <div style="background:#eee; padding:10px; border-radius:5px; margin:10px 0;">
        <strong></strong><br/>
            <strong></strong>  <strong></strong>
      </div>
      <p><strong></strong></p>
      <ul>
        <li> <strong>/</strong> (10%)</li>
        <li> <strong></strong> (50%)</li>
        <li> <strong></strong> (100%)</li>
      </ul>
      
      <p><strong style="color:#D32F2F;"> ()</strong></p>
      <div style="background:#fff3e0; padding:12px; border-radius:5px; margin:10px 0; border-left: 4px solid #FF9800;">
        <p style="margin:0 0 8px 0;"><strong></strong></p>
        <ul style="margin:5px 0; padding-left:20px;">
          <li> <strong></strong>1.0 ()</li>
          <li> <strong></strong>1.5 (+50%)</li>
          <li> <strong></strong>3.0 (+200%)</li>
          <li> <strong></strong>6.0 (+500%)</li>
          <li> <strong></strong>12.0 (+1100%)</li>
          <li> <strong></strong>25.0 (+2400%)</li>
          <li> <strong></strong>100.0 (<strong style="color:#D32F2F;">+9900%</strong>)</li>
        </ul>
      </div>
      
      <p><strong></strong>""""100</p>
      <ol style="background:#f5f5f5; padding:12px; border-radius:5px;">
        <li></li>
        <li></li>
        <li><strong></strong></li>
        <li>""</li>
      </ol>
    `},{id:"COMBAT",title:" ",content:`
      <p><strong></strong><strong></strong></p>
      <ul>
        <li><strong></strong></li>
        <li><strong></strong> <strong>100</strong> </li>
        <li><strong></strong> <strong>HP()</strong>  <strong>ATK()</strong></li>
      </ul>
      <p><strong></strong><br/>1. <strong></strong><br/>2. </p>
    `},{id:"COMBAT_RULES",title:" ",content:`
      <p><strong></strong></p>
      <ul>
        <li><strong></strong></li>
        <li><strong></strong> <strong></strong> </li>
        <li><strong></strong></li>
      </ul>
      <div style="background:#fff3e0; padding:12px; border-radius:6px; margin:10px 0; border-left:4px solid #FF9800;">
        <strong></strong>
        <ul style="margin:6px 0 0 16px;">
          <li></li>
          <li></li>
          <li> 10</li>
        </ul>
        <p style="margin:8px 0 0 0;"><strong></strong><strong></strong></p>
      </div>
    `},{id:"ROOTS",title:" ",content:`
      <p>6</p>
      <ul>
        <li><span style="color:#FFD700"> (90-100)</span></li>
        <li><span style="color:#00BCD4"> (80-89)</span>//</li>
        <li><span style="color:#9C27B0">/</span></li>
        <li><span style="color:#9E9E9E">/</span></li>
      </ul>
    `}],WC=({onClose:e,initialTab:t=0})=>{const[n,s]=y.useState(t);return r.jsx("div",{style:Vn.overlay,children:r.jsxs("div",{style:Vn.modalWrapper,children:[r.jsx("button",{onClick:e,style:Vn.closeBtn,"aria-label":"",children:""}),r.jsxs("div",{style:Vn.modal,children:[r.jsx("div",{style:Vn.header,children:r.jsx("h3",{children:" "})}),r.jsxs("div",{style:Vn.body,children:[r.jsx("div",{style:Vn.sidebar,children:Tl.map((o,i)=>r.jsx("div",{onClick:()=>s(i),style:{...Vn.menuItem,background:n===i?"#e0e0e0":"transparent",fontWeight:n===i?"bold":"normal",color:n===i?"#3e2723":"#666"},children:o.title},o.id))}),r.jsxs("div",{style:Vn.content,children:[r.jsx("h4",{style:{marginTop:0,borderBottom:"1px solid #eee",paddingBottom:"10px"},children:Tl[n].title}),r.jsx("div",{style:{lineHeight:"1.6",fontSize:"14px",color:"#444"},dangerouslySetInnerHTML:{__html:Tl[n].content}})]})]}),r.jsx("div",{style:Vn.footer,children:n<Tl.length-1?r.jsx("button",{onClick:()=>s(n+1),style:Vn.nextBtn,children:""}):r.jsx("button",{onClick:e,style:Vn.finishBtn,children:""})})]})]})})},Vn={overlay:{position:"fixed",top:0,left:0,right:0,bottom:0,background:"rgba(0,0,0,0.7)",zIndex:3e3,display:"flex",alignItems:"center",justifyContent:"center"},modalWrapper:{position:"relative",width:"min(600px, calc(100vw - 32px))"},modal:{width:"100%",height:"450px",background:"#fff",borderRadius:"12px",display:"flex",flexDirection:"column",overflow:"hidden",boxShadow:"0 10px 30px rgba(0,0,0,0.3)",position:"relative"},header:{padding:"15px 20px",background:"#3e2723",color:"#fff",display:"flex",justifyContent:"center",alignItems:"center"},closeBtn:{position:"absolute",top:"-18px",left:"-18px",background:"#3e2723",border:"none",color:"#fff",fontSize:"22px",cursor:"pointer",width:"44px",height:"44px",display:"flex",alignItems:"center",justifyContent:"center",borderRadius:"22px",boxShadow:"0 12px 30px rgba(0,0,0,0.25)"},body:{flex:1,display:"flex",overflow:"hidden"},sidebar:{width:"180px",background:"#f5f5f5",borderRight:"1px solid #ddd",overflowY:"auto"},menuItem:{padding:"15px",cursor:"pointer",borderBottom:"1px solid #eee",fontSize:"13px"},content:{flex:1,padding:"20px",overflowY:"auto"},footer:{padding:"10px 20px",borderTop:"1px solid #eee",display:"flex",justifyContent:"flex-end",background:"#fafafa"},nextBtn:{padding:"8px 20px",background:"#2196f3",color:"white",border:"none",borderRadius:"4px",cursor:"pointer"},finishBtn:{padding:"8px 20px",background:"#4caf50",color:"white",border:"none",borderRadius:"4px",cursor:"pointer"}},UC=({gazette:e,onClose:t,history:n=[],playerName:s="",onWorldNpcClick:o,onChildClick:i})=>{var C;const[a,l]=y.useState("current"),[d,u]=y.useState(null);console.log("GazetteModal props:",{gazette:e,history:n,hasGazette:!!e,historyLength:n.length});const p=w=>{if(!w||!s)return w;const S=new RegExp(`(${s})`,"g");return w.split(S).map((g,v)=>g===s?r.jsx("span",{style:{color:"#b33",fontWeight:"bold"},children:g},v):g)};y.useEffect(()=>{!e&&n.length>0&&l("history")},[e,n]);const f=(a==="current"?e:d)||{issue:"-",year:0,month:"-",headlines:[],powerRanking:[],sectRanking:[],rumors:[]},x=!e&&n.length===0;return r.jsx("div",{style:Ae.overlay,children:r.jsxs("div",{style:Ae.modalWrapper,children:[r.jsx("button",{onClick:t,style:Ae.closeBtn,"aria-label":"",children:""}),r.jsx("div",{style:Ae.modal,children:x?r.jsxs("div",{style:Ae.emptyState,children:[r.jsx("div",{style:Ae.emptyIcon,children:""}),r.jsx("h3",{style:Ae.emptyTitle,children:""}),r.jsx("p",{style:Ae.emptyText,children:"36912"}),r.jsx("button",{onClick:t,style:Ae.emptyBtn,children:""})]}):r.jsxs(r.Fragment,{children:[r.jsxs("div",{style:Ae.tabBar,children:[r.jsx("button",{onClick:()=>l("current"),style:{...Ae.tab,background:a==="current"?Ie.colors.primary:Ie.colors.parchment,color:a==="current"?"#fff":Ie.colors.ink,opacity:e?1:.5,cursor:e?"pointer":"not-allowed"},disabled:!e,children:" "}),r.jsxs("button",{onClick:()=>l("history"),style:{...Ae.tab,background:a==="history"?Ie.colors.primary:Ie.colors.parchment,color:a==="history"?"#fff":Ie.colors.ink},children:["  (",n.length,")"]})]}),r.jsx("div",{style:Ae.content,children:a==="current"?r.jsxs("div",{style:Ae.newspaper,children:[r.jsxs("div",{style:Ae.header,children:[r.jsx("h1",{style:Ae.title,children:""}),r.jsxs("div",{style:Ae.subtitle,children:["   ",f.issue," "]}),r.jsxs("div",{style:Ae.date,children:[" ",f.year," ",f.month,""]})]}),f.powerRanking&&f.powerRanking.length>0&&r.jsxs("div",{style:Ae.section,children:[r.jsx("h3",{style:Ae.sectionTitle,children:" - "}),r.jsx("div",{style:Ae.ranking,children:f.powerRanking.map((w,S)=>{const h=typeof w=="string"?w:w.displayText,g=typeof w=="object"&&w.worldNpcData&&!w.isPlayer,v=typeof w=="object"&&w.childData&&!w.isPlayer,j=g||v;return r.jsx("div",{style:{...Ae.rankItem,...j?Ae.clickableRankItem:{}},onClick:()=>{g&&o?o(w.worldNpcData):v&&i&&i(w.childData)},children:h},S)})})]}),f.sectRanking&&f.sectRanking.length>0&&r.jsxs("div",{style:Ae.section,children:[r.jsx("h3",{style:Ae.sectionTitle,children:" - "}),r.jsx("div",{style:Ae.ranking,children:f.sectRanking.map((w,S)=>{const h=typeof w=="string"?w:w.displayText,g=typeof w=="object"&&w.worldNpcData;return r.jsxs("div",{style:{...Ae.rankItem,...g?Ae.clickableRankItem:{}},onClick:()=>{g&&o&&o(w.worldNpcData)},children:[r.jsx("div",{children:h}),g&&r.jsx("div",{style:Ae.clickHint,children:""})]},S)})})]}),r.jsxs("div",{style:Ae.section,children:[r.jsx("h3",{style:Ae.sectionTitle,children:""}),r.jsx("div",{style:Ae.newsContent,children:f.headlines&&f.headlines.length>0?f.headlines.map((w,S)=>r.jsxs("p",{style:Ae.newsItem,children:[" ",p(w)]},S)):r.jsx("p",{style:Ae.placeholder,children:""})})]}),f.rumors&&f.rumors.length>0&&r.jsxs("div",{style:Ae.section,children:[r.jsx("h3",{style:Ae.sectionTitle,children:""}),r.jsx("div",{style:Ae.newsContent,children:f.rumors.map((w,S)=>r.jsxs("p",{style:Ae.newsItem,children:[" ",p(w)]},S))})]}),r.jsxs("div",{style:Ae.adSection,children:[r.jsx("div",{style:Ae.ad,children:" "}),r.jsx("div",{style:Ae.ad,children:" "})]})]}):r.jsx("div",{style:Ae.historyView,children:n.length===0?r.jsx("div",{style:Ae.emptyHistory,children:""}):d?r.jsxs("div",{children:[r.jsx("button",{onClick:()=>u(null),style:Ae.backBtn,children:" "}),r.jsxs("div",{style:Ae.newspaper,children:[r.jsxs("div",{style:Ae.header,children:[r.jsx("h1",{style:Ae.title,children:""}),r.jsxs("div",{style:Ae.subtitle,children:[" ",d.issue," "]}),r.jsxs("div",{style:Ae.date,children:[" ",d.year," ",d.month,""]})]}),d.powerRanking&&d.powerRanking.length>0&&r.jsxs("div",{style:Ae.section,children:[r.jsx("h3",{style:Ae.sectionTitle,children:" - "}),r.jsx("div",{style:Ae.ranking,children:d.powerRanking.map((w,S)=>r.jsx("div",{style:Ae.rankItem,children:typeof w=="string"?w:w.displayText},S))})]}),d.sectRanking&&d.sectRanking.length>0&&r.jsxs("div",{style:Ae.section,children:[r.jsx("h3",{style:Ae.sectionTitle,children:" - "}),r.jsx("div",{style:Ae.ranking,children:d.sectRanking.map((w,S)=>r.jsx("div",{style:Ae.rankItem,children:typeof w=="string"?w:w.displayText},S))})]}),r.jsxs("div",{style:Ae.section,children:[r.jsx("h3",{style:Ae.sectionTitle,children:""}),r.jsx("div",{style:Ae.newsContent,children:(C=d.headlines)==null?void 0:C.map((w,S)=>r.jsxs("p",{style:Ae.newsItem,children:[" ",w]},S))})]})]})]}):r.jsx("div",{style:Ae.historyList,children:n.map((w,S)=>r.jsxs("div",{style:Ae.historyItem,onClick:()=>u(w),children:[r.jsxs("div",{style:Ae.historyTitle,children:[" ",w.issue," "]}),r.jsxs("div",{style:Ae.historyDate,children:[Math.floor(w.year)," ",w.month,""]})]},S))})})})]})})]})})},Ae={overlay:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0, 0, 0, 0.7)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e3},modalWrapper:{position:"relative",width:"min(800px, calc(100vw - 32px))"},modal:{background:Ie.gradients.warm,borderRadius:"16px",maxWidth:"800px",width:"100%",maxHeight:"85vh",overflow:"hidden",position:"relative",boxShadow:"0 8px 32px rgba(0,0,0,0.3)",border:`3px solid ${Ie.colors.border}`},clickHint:{fontSize:"12px",color:"#8d6e63",marginTop:"4px"},closeBtn:{position:"absolute",top:"-20px",left:"-20px",width:"48px",height:"48px",borderRadius:"50%",border:"none",background:"#b33",color:"white",fontSize:"24px",cursor:"pointer",boxShadow:"0 12px 32px rgba(0,0,0,0.25)",fontWeight:"bold"},tabBar:{display:"flex",gap:"10px",padding:"15px 20px",borderBottom:`2px solid ${Ie.colors.border}`},tab:{padding:"10px 20px",border:"none",borderRadius:"8px",cursor:"pointer",fontWeight:"bold",fontSize:"14px",transition:"all 0.3s"},content:{padding:"20px",maxHeight:"calc(85vh - 100px)",overflowY:"auto"},newspaper:{background:Ie.colors.paper,padding:"30px",borderRadius:"8px",boxShadow:`inset 0 0 20px ${Ie.colors.shadow}`,fontFamily:'"Noto Serif SC", "KaiTi", serif'},header:{textAlign:"center",borderBottom:`3px double ${Ie.colors.border}`,paddingBottom:"20px",marginBottom:"25px"},title:{fontSize:"36px",color:Ie.colors.primary,margin:"0 0 10px 0",letterSpacing:"8px",textShadow:"2px 2px 4px rgba(0,0,0,0.1)"},subtitle:{fontSize:"14px",color:Ie.colors.primary,marginBottom:"5px"},date:{fontSize:"12px",color:Ie.colors.muted},section:{marginBottom:"25px",padding:"15px",background:Ie.gradients.subtle,borderRadius:"8px",border:`1px solid ${Ie.colors.border}`},sectionTitle:{fontSize:"20px",color:Ie.colors.primary,marginBottom:"15px",borderBottom:`2px solid ${Ie.colors.border}`,paddingBottom:"8px"},ranking:{display:"flex",flexDirection:"column",gap:"10px"},rankItem:{fontSize:"16px",padding:"8px",background:Ie.colors.paper,borderRadius:"4px",border:`1px solid ${Ie.colors.border}`},clickableRankItem:{cursor:"pointer",transition:"all 0.3s",":hover":{background:Ie.gradients.subtle,transform:"translateX(5px)",borderColor:Ie.colors.primary}},newsContent:{fontSize:"15px",lineHeight:"1.8",color:Ie.colors.ink},newsItem:{margin:"10px 0",paddingLeft:"15px",textIndent:"0"},placeholder:{color:"#999",fontStyle:"italic",textAlign:"center"},adSection:{marginTop:"30px",padding:"15px",background:Ie.gradients.subtle,borderRadius:"8px",border:`2px dashed ${Ie.colors.border}`},ad:{fontSize:"12px",color:Ie.colors.primary,marginBottom:"5px"},historyView:{minHeight:"400px"},historyList:{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(150px, 1fr))",gap:"15px"},historyItem:{padding:"20px",background:Ie.colors.paper,borderRadius:"8px",border:`2px solid ${Ie.colors.border}`,cursor:"pointer",textAlign:"center",transition:"all 0.3s",":hover":{transform:"translateY(-5px)",boxShadow:`0 4px 12px ${Ie.colors.shadow}`}},historyTitle:{fontSize:"16px",fontWeight:"bold",color:Ie.colors.primary,marginBottom:"8px"},historyDate:{fontSize:"12px",color:Ie.colors.primary},emptyHistory:{textAlign:"center",padding:"50px",color:"#999",fontSize:"16px"},backBtn:{marginBottom:"15px",padding:"8px 16px",background:"#8d6e63",color:"white",border:"none",borderRadius:"8px",cursor:"pointer",fontWeight:"bold"},emptyState:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",padding:"80px 40px",minHeight:"400px"},emptyIcon:{fontSize:"80px",marginBottom:"20px",opacity:.5},emptyTitle:{fontSize:"24px",color:Ie.colors.primary,marginBottom:"10px"},emptyText:{fontSize:"14px",color:Ie.colors.muted,textAlign:"center",lineHeight:"1.6",marginBottom:"30px"},emptyBtn:{padding:"10px 30px",background:Ie.colors.primary,color:"white",border:"none",borderRadius:"8px",cursor:"pointer",fontSize:"14px",fontWeight:"bold",transition:"all 0.3s"}},GC=({worldNpc:e,onClose:t,onInvite:n,onChallenge:s,player:o})=>{var b,_,I;if(!e)return null;const[i,a]=y.useState(""),[l,d]=y.useState(""),[u,p]=y.useState(!1),c=k=>k==="male"||k===""?"":k==="female"||k===""?"":k,f=k=>k?typeof k=="string"?k:typeof k=="object"&&k.name?k.name:"":"",x=()=>{var T;if((T=e.appearance)!=null&&T.description&&typeof e.appearance.description=="string")return e.appearance.description;if(e.gender==="female"||e.gender===""){const N=["","","","",""];return N[Math.floor(Math.random()*N.length)]}else{const N=["","","","",""];return N[Math.floor(Math.random()*N.length)]}},C=y.useMemo(()=>x(),[e==null?void 0:e.id]),w=k=>{if(!k)return"";if(typeof k=="string")return k;if(typeof k=="object"){if(k.label)return k.label;if(k.desc)return k.desc;const T=[k.temperament,k.alignment,k.attitude].filter(Boolean);return T.length>0?T[0]:""}return""},S=k=>{if(!k)return"";const T=k.rootType||k.type;return T||(Array.isArray(k.elements)&&k.elements.length>0?k.elements.map(N=>typeof N=="object"?N.element:N).join("")+"":"")},h=(k,T)=>{if(typeof k!="number")return"";const N=T==="female"||T==="";return k>=90?N?"":"":k>=80?N?"":"":k>=70?N?"":"":k>=60?"":""},g=y.useMemo(()=>e!=null&&e.id?`tianji_profile_${e.id}`:"",[e==null?void 0:e.id]),v=()=>{var ye;const k=e.name||"",T=e.title||"",N=e.tier||"",K=f(e.sect),L=e.sectRank?`${K}${e.sectRank}`:null,B=S(e.spiritRoot),W=w(e.personality);h((ye=e.stats)==null?void 0:ye.looks,e.gender);const z=C,ne=K===""?"":L||`${K}`,Q=`${k}${N}${ne}${T}${B}${z}${W}${e.signature||""}`,se=`${k}${T}${N}${ne}${B}${K===""?"":K}${W}"${e.signature||""}"`;return{summary:Q,bio:se}},j=(k,T)=>{if(!k)return T;const N=k.match(/\{[\s\S]*\}/);if(N)try{const L=JSON.parse(N[0]);if(L&&(L.summary||L.bio))return{summary:L.summary||T.summary,bio:L.bio||T.bio}}catch{}const K=k.split(`
`).map(L=>L.trim()).filter(Boolean);if(K.length>=2){const L=K[0].replace(/^[:]\s*/,""),B=K.slice(1).join(`
`).replace(/^[:]\s*/,"");return{summary:L||T.summary,bio:B||T.bio}}return{summary:k.trim().slice(0,80)||T.summary,bio:T.bio}};y.useEffect(()=>{var W;if(!e)return;const k=v();try{if(g){const z=localStorage.getItem(g);if(z){const ne=JSON.parse(z);if(ne!=null&&ne.summary&&ne.summary.includes(e.name)){a(ne.summary||k.summary),d(ne.bio||k.bio);return}}}}catch{}if(a(k.summary),d(k.bio),!(localStorage.getItem("useAIForTianjiProfile")!=="false")){try{g&&localStorage.setItem(g,JSON.stringify(k))}catch{}return}const N=localStorage.getItem("game_api_key")||"",K=localStorage.getItem("game_api_url")||"",L=localStorage.getItem("game_api_model")||"deepseek-chat";if(!N||!K)return;const B={name:e.name,title:e.title||"",tier:e.tier,sect:f(e.sect),spiritRoot:S(e.spiritRoot),personality:w(e.personality),appearance:C,looks:((W=e.stats)==null?void 0:W.looks)||0,signature:e.signature||""};p(!0),Aa([{role:"system",content:`""""JSON{"summary":"...","bio":"..."}80160


1. nametitletier
2. name
3. """"
4. 
5. 
6. `},{role:"user",content:`
${B.name}
${B.title}
${B.tier}
${B.sect}
${B.spiritRoot}
${B.personality}
${B.appearance}
${B.signature}


1. "${B.name}${B.tier}""${B.title}"
2. 
3. 
4. `}],N,K,{model:L,temperature:.7,maxTokens:260}).then(z=>{const ne=j(z,k),Q=ne.summary.includes(e.name)?ne.summary:k.summary,se=ne.bio.includes(e.name)?ne.bio:k.bio;a(Q),d(se);try{g&&localStorage.setItem(g,JSON.stringify({summary:Q,bio:se}))}catch{}}).catch(()=>{a(k.summary),d(k.bio)}).finally(()=>p(!1))},[e,g]),e.gender!==o.gender&&e.hasMetPlayer;const R=e.sectRank===""&&e.status!=="DEAD";return r.jsx("div",{style:Ye.overlay,onClick:t,children:r.jsxs("div",{style:Ye.modalWrapper,onClick:k=>k.stopPropagation(),children:[r.jsx("button",{onClick:t,style:Ye.closeBtn,"aria-label":"",children:""}),r.jsxs("div",{style:Ye.modal,children:[r.jsxs("div",{style:Ye.header,children:[r.jsxs("h2",{style:Ye.title,children:[e.title&&`${e.title}`,e.name]}),r.jsxs("div",{style:Ye.subtitle,children:["  ",e.tier,"  ",c(e.gender)]})]}),r.jsxs("div",{style:Ye.content,children:[r.jsxs("div",{style:Ye.section,children:[r.jsx("h3",{style:Ye.sectionTitle,children:" "}),r.jsxs("div",{style:Ye.infoGrid,children:[r.jsx(Hs,{label:"",value:e.name}),r.jsx(Hs,{label:"",value:e.title||""}),r.jsx(Hs,{label:"",value:c(e.gender)}),r.jsx(Hs,{label:"",value:e.tier}),r.jsx(Hs,{label:"",value:f(e.sect)}),e.sectRank&&r.jsx(Hs,{label:"",value:e.sectRank}),r.jsx(Hs,{label:"",value:((b=e.spiritRoot)==null?void 0:b.rootType)||((_=e.spiritRoot)==null?void 0:_.type)||""})]})]}),r.jsxs("div",{style:Ye.section,children:[r.jsx("h3",{style:Ye.sectionTitle,children:" "}),r.jsx("div",{style:Ye.statsGrid,children:e.stats&&Object.entries(e.stats).map(([k,T])=>r.jsxs("div",{style:Ye.statItem,children:[r.jsx("span",{style:Ye.statLabel,children:VC(k)}),r.jsx("span",{style:Ye.statValue,children:Math.floor(T)})]},k))})]}),r.jsxs("div",{style:Ye.section,children:[r.jsx("h3",{style:Ye.sectionTitle,children:" "}),r.jsx("p",{style:Ye.description,children:C})]}),r.jsxs("div",{style:Ye.section,children:[r.jsx("h3",{style:Ye.sectionTitle,children:" "}),r.jsx("p",{style:Ye.description,children:i||""}),u&&r.jsx("div",{style:Ye.hintText,children:"AI "})]}),r.jsxs("div",{style:Ye.section,children:[r.jsx("h3",{style:Ye.sectionTitle,children:" "}),r.jsx("p",{style:Ye.description,children:l||""}),r.jsx("p",{style:Ye.hintText,children:"/ AI "})]}),e.personality&&typeof e.personality=="string"&&r.jsxs("div",{style:Ye.section,children:[r.jsx("h3",{style:Ye.sectionTitle,children:" "}),r.jsx("p",{style:Ye.description,children:e.personality})]}),((I=e.spiritRoot)==null?void 0:I.elements)&&Array.isArray(e.spiritRoot.elements)&&r.jsxs("div",{style:Ye.section,children:[r.jsx("h3",{style:Ye.sectionTitle,children:" "}),r.jsx("div",{style:Ye.elementsGrid,children:e.spiritRoot.elements.map((k,T)=>r.jsx("div",{style:Ye.elementTag,children:typeof k=="object"?`${k.element} ${k.value}`:k},T))})]}),e.gender!==o.gender&&!e.hasMetPlayer&&(e.gender==="male"||e.gender==="")&&r.jsxs("div",{style:Ye.hintBox,children:[r.jsx("div",{style:Ye.hintIcon,children:""}),r.jsx("p",{style:Ye.hintText,children:""})]}),e.hasMetPlayer&&r.jsx("div",{style:Ye.metHint,children:" "}),R&&r.jsxs("div",{style:Ye.actionSection,children:[r.jsx("button",{style:Ye.challengeBtn,onClick:()=>s&&s(e),children:" "}),r.jsx("div",{style:Ye.hintText,children:""})]})]})]})]})})},Hs=({label:e,value:t})=>{const n=typeof t=="object"&&t!==null?JSON.stringify(t):t??"";return r.jsxs("div",{style:Ye.infoItem,children:[r.jsxs("span",{style:Ye.infoLabel,children:[e,""]}),r.jsx("span",{style:Ye.infoValue,children:n})]})},VC=e=>({attack:"",defense:"",speed:"",hp:"",cultivation:"",atk:"",def:"",spd:"",maxHp:"",aptitude:"",looks:"",intelligence:"",health:""})[e]||e,Ye={overlay:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0, 0, 0, 0.7)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:2e3},modalWrapper:{position:"relative",width:"min(600px, calc(100vw - 32px))",maxHeight:"85vh"},modal:{background:Ie.gradients.warm,borderRadius:"16px",width:"100%",maxHeight:"85vh",overflow:"hidden",boxShadow:"0 8px 32px rgba(0,0,0,0.3)",border:`3px solid ${Ie.colors.border}`},closeBtn:{position:"absolute",top:"-20px",right:"-20px",width:"48px",height:"48px",borderRadius:"50%",border:"none",background:"#b33",color:"white",fontSize:"24px",cursor:"pointer",boxShadow:"0 4px 12px rgba(0,0,0,0.3)",fontWeight:"bold",zIndex:1},header:{textAlign:"center",padding:"25px 20px",background:"linear-gradient(135deg, #8d6e63 0%, #6d4c41 100%)",color:"white",borderBottom:`3px solid ${Ie.colors.border}`},title:{fontSize:"24px",margin:"0 0 8px 0",fontWeight:"bold",textShadow:"2px 2px 4px rgba(0,0,0,0.3)"},subtitle:{fontSize:"14px",opacity:.9},content:{padding:"20px",maxHeight:"calc(85vh - 120px)",overflowY:"auto"},section:{marginBottom:"20px",padding:"15px",background:Ie.colors.paper,borderRadius:"8px",border:`1px solid ${Ie.colors.border}`},sectionTitle:{fontSize:"16px",color:Ie.colors.primary,marginBottom:"12px",paddingBottom:"8px",borderBottom:`2px solid ${Ie.colors.border}`},infoGrid:{display:"grid",gridTemplateColumns:"repeat(2, 1fr)",gap:"10px"},infoItem:{fontSize:"14px",padding:"5px"},infoLabel:{color:"#666",marginRight:"5px"},infoValue:{color:Ie.colors.ink,fontWeight:"bold"},statsGrid:{display:"grid",gridTemplateColumns:"repeat(3, 1fr)",gap:"10px"},statItem:{display:"flex",flexDirection:"column",alignItems:"center",padding:"10px",background:Ie.gradients.subtle,borderRadius:"6px"},statLabel:{fontSize:"12px",color:"#666",marginBottom:"5px"},statValue:{fontSize:"18px",fontWeight:"bold",color:Ie.colors.primary},description:{fontSize:"14px",lineHeight:"1.6",color:Ie.colors.ink},elementsGrid:{display:"flex",flexWrap:"wrap",gap:"8px"},elementTag:{padding:"6px 12px",background:"linear-gradient(135deg, #fff9e6 0%, #ffe5b4 100%)",border:"1px solid #d4a574",borderRadius:"12px",fontSize:"13px",fontWeight:"bold",color:"#8d6e63"},hintBox:{textAlign:"center",padding:"20px",background:"linear-gradient(135deg, #fff9e6 0%, #ffe5b4 100%)",borderRadius:"12px",border:"2px dashed #d4a574"},hintIcon:{fontSize:"32px",marginBottom:"10px"},hintText:{fontSize:"14px",color:"#8d6e63",lineHeight:"1.6",margin:0},metHint:{textAlign:"center",padding:"15px",background:"#e8f5e9",border:"1px solid #81c784",borderRadius:"8px",color:"#2e7d32",fontSize:"14px",fontWeight:"bold"},actionSection:{marginTop:"12px",display:"flex",flexDirection:"column",gap:"8px"},challengeBtn:{padding:"10px 14px",borderRadius:"10px",border:"none",background:"linear-gradient(135deg, #d84315, #ff7043)",color:"#fff",fontWeight:"bold",cursor:"pointer",boxShadow:"0 6px 14px rgba(216, 67, 21, 0.25)"}},YC=({selectedNpc:e,setSelectedNpc:t,handleOptionSelect:n,player:s,visibleChildren:o,visibleNpcs:i,activeNpcs:a,modalMgr:l,addLog:d,showResult:u,cutTiesWithNpc:p,handleToggleNpcLetterAcceptance:c,messages:f,messageManager:x,setMessages:C,handleSendMessageReply:w,combatData:S,handleCombatClose:h,isExploring:g,exploreRealmState:v,exploreProgress:j,currentExploreEvent:R,exploreLog:b,inventory:_,setExploreLog:I,handleExplorationOption:k,handleStartCombat:T,setExploreProgress:N,setCurrentExploreEvent:K,setIsExploring:L,getBossEvent:B,getRandomExplorationEvent:W,pendingSectChoices:z,setPendingSectChoices:ne,handleAssignSect:Q,handleCloseTutorial:se,handleCompleteTutorial:ye,handleCloseGuide:Me,currentGazette:Pe,setSelectedWorldNpc:Ke,selectedWorldNpc:q,handleInviteWorldNpc:de,handleChallengeWorldNpc:Z,selectedTianjiChild:re,setSelectedTianjiChild:ce})=>{var le;return r.jsxs(r.Fragment,{children:[e&&r.jsx(YE,{npc:e,onClose:()=>t(null),onOptionSelect:n,player:s,children:o,npcs:i,onViewLog:we=>l.openNpcLog(we),onCutTies:we=>{const Ue=a.find(Oe=>Oe.id===we);Ue&&(p(we),t(null),d(`  ${Ue.name} `),u("",` ${Ue.name} `,!0))},onToggleLetterAcceptance:c}),l.npcLogModal.open&&l.npcLogModal.npc&&r.jsx(OC,{npc:l.npcLogModal.npc,playerAffection:((le=l.npcLogModal.npc.relationship)==null?void 0:le.affection)||0,onClose:()=>l.closeNpcLog()}),r.jsx(i5,{isOpen:l.showMessageCenter,onClose:()=>l.closeMessageCenter(),messages:f,onMarkAsRead:we=>{x.markAsRead(we),C(x.getAllMessages())},onDeleteMessage:we=>{x.deleteMessage(we),C(x.getAllMessages())},onSendReply:w}),S&&r.jsx(PC,{player:s,enemy:S.enemy,result:S.result,onClose:h}),g&&r.jsx(DC,{open:g,realmName:v.name,progress:j,total:v.total,event:R,log:b,optionContext:{player:s,inventory:_,realmId:v.id,progress:j},onSelectOption:k,onStartCombat:T,onNext:()=>{if(j>=v.total){I(Oe=>[...Oe,""]),L(!1),u("","",!0,null,!1);return}const we=j+1;N(we);const Ue=we===v.total?B(v.id):W({realmId:v.id,progress:we});K(Ue),I(Oe=>[...Oe,` (${we}/${v.total})`])},onClose:()=>{L(!1),I(we=>[...we,""])}}),z.length>0&&r.jsx(FC,{event:z[0],onClose:()=>ne(we=>we.slice(1)),onAssign:Q}),l.showTutorial&&r.jsx(HC,{onClose:se,onComplete:ye}),l.showGuide&&r.jsx(WC,{onClose:Me}),l.showGazette&&r.jsx(UC,{gazette:Pe,history:s.gazetteHistory||[],playerName:s.name,onClose:()=>l.closeGazette(),onWorldNpcClick:we=>{Ke(we)},onChildClick:we=>{ce(we)}}),q&&r.jsx(GC,{worldNpc:q,player:s,onClose:()=>Ke(null),onInvite:de,onChallenge:Z}),re&&r.jsx(u1,{child:re,player:s,onClose:()=>ce(null),isTianjiMode:!0})]})};class qC extends _c.Component{constructor(n){super(n);R0(this,"handleReset",()=>{this.setState({hasError:!1,error:null,errorInfo:null})});this.state={hasError:!1,error:null,errorInfo:null}}static getDerivedStateFromError(n){return{hasError:!0}}componentDidCatch(n,s){console.error("[] :",n),console.error("[] :",s),this.setState({error:n,errorInfo:s})}render(){var n;return this.state.hasError?r.jsxs("div",{style:{padding:"20px",margin:"20px",backgroundColor:"#ffebee",border:"2px solid #f44336",borderRadius:"8px",textAlign:"center",fontFamily:"Arial, sans-serif"},children:[r.jsx("h2",{style:{color:"#c62828",margin:"0 0 12px 0"},children:" "}),r.jsx("p",{style:{color:"#d32f2f",margin:"8px 0",fontSize:"14px"},children:((n=this.state.error)==null?void 0:n.message)||""}),!1,r.jsx("button",{onClick:this.handleReset,style:{marginTop:"12px",padding:"8px 16px",backgroundColor:"#2196f3",color:"#fff",border:"none",borderRadius:"4px",cursor:"pointer",fontSize:"14px",fontWeight:"bold"},children:" "})]}):this.props.children}}const KC=({options:e,currentSort:t,onSortChange:n})=>{const s=o=>{typeof n=="function"?n(o):console.warn("SortBar: onSortChange is not a function",{onSortChange:n,value:o})};return r.jsxs("div",{style:Fi.container,children:[r.jsx("span",{style:Fi.label,children:" :"}),r.jsx("div",{style:Fi.buttonGroup,children:e.map(o=>r.jsx("button",{type:"button",onClick:()=>s(o.value),style:{...Fi.button,...t===o.value?Fi.buttonActive:{}},children:o.label},o.value))})]})},Fi={container:{display:"flex",alignItems:"center",justifyContent:"flex-end",padding:"5px 10px",marginBottom:"10px",background:"#f5f5f5",borderRadius:"4px",fontSize:"12px"},label:{color:"#666",marginRight:"8px",fontWeight:"bold"},buttonGroup:{display:"flex",gap:"6px",flexWrap:"wrap"},button:{border:"1px solid #ccc",borderRadius:"999px",padding:"4px 10px",fontSize:"12px",cursor:"pointer",backgroundColor:"white",color:"#333",transition:"all 0.2s ease"},buttonActive:{backgroundColor:"#1976d2",color:"#fff",borderColor:"#1976d2",boxShadow:"0 2px 6px rgba(25,118,210,0.4)"}};function QC({player:e,inventory:t,children:n,exploreRealmState:s,exploreProgress:o,exploreTeamIds:i,setPlayer:a,setExploreLog:l,setCombatData:d,addNpc:u,addItemsToInventory:p,inventoryMgr:c,calculateDynamicCombatStats:f,simulateCombat:x,generateRealmEnemy:C}){const w=y.useCallback(()=>{var _,I;const b=Af(e);if(!b.canExplore){if(((_=e.stats)==null?void 0:_.health)<20)return l(k=>[...k,` ${Math.floor(e.stats.health)}/100`]),!1;((I=e.stats)==null?void 0:I.health)<30&&l(k=>[...k,` 30${Math.floor(e.stats.health)}/100`])}return b.canExplore},[e,l]),S=y.useCallback(b=>{if(!w())return;const _={player:e,inventory:t,realmId:s.id,progress:o};if(b.condition&&!b.condition(_)){l(k=>[...k,""]);return}const I=b.action?b.action(_):{type:"LOG",msg:""};switch(typeof I.spiritStonesDelta=="number"&&I.spiritStonesDelta!==0&&a(k=>{var T;return{...k,resources:{...k.resources,spiritStones:Math.max(0,(((T=k.resources)==null?void 0:T.spiritStones)||0)+I.spiritStonesDelta)}}}),I.type){case"START_COMBAT":h();break;case"LOOT":g(I);break;case"NPC_JOIN":v(I);break;case"HP_CHANGE":j(I);break;case"EXP_GAIN":R(I);break;case"LOG":case"NONE":default:l(k=>[...k,I.msg||""]);break}},[e,t,s.id,o,l,a]),h=y.useCallback(()=>{const b=C(s.id,o),_={...e,combatStats:e.combatStats||{maxHp:100,maxMp:50,atk:10,def:5,hp:100,mp:50}},I=i.map(T=>n.find(N=>N.id===T)).filter(Boolean).map(T=>({...T,combatStats:T.combatStats||{maxHp:100,maxMp:50,atk:10,def:5,hp:100,mp:50}})),k=x(_,b,I);d({enemy:b,result:k,context:"exploration"})},[e,n,i,s.id,o,C,x,d]),g=y.useCallback(b=>{const I=p(b.items||[]).map(T=>T.name).filter(Boolean).join(", "),k=[];b.msg&&k.push(b.msg),I&&k.push(`${I}`),k.length>0&&l(T=>[...T,...k])},[p,l]),v=y.useCallback(b=>{if(u(b.npc,b.msg),b.removeItemId){const _=t.find(I=>I.id===b.removeItemId);_&&c.removeItemFromInventory(_.instanceId,_.stackable?1:void 0)}l(_=>[..._,b.msg||""])},[u,t,c,l]),j=y.useCallback(b=>{const _=b.hpDelta||0;if(_<0){const I=Math.abs(_),k=ti(e,I,"EXPLORATION");a(N=>({...N,stats:{...N.stats,health:k.newHealth}}));const T=[];T.push(k.message),b.msg&&b.msg!==""&&T.push(b.msg),l(N=>[...N,...T])}else a(I=>{var k,T;return{...I,stats:{...I.stats,health:Math.max(1,Math.min(100,(((k=I.stats)==null?void 0:k.health)||50)+Math.floor(_/(((T=I.combatStats)==null?void 0:T.maxHp)||100)*100)))}}}),l(I=>[...I,b.msg||(_<0?"":"")])},[e,a,l]),R=y.useCallback(b=>{a(_=>{const I={..._,currentExp:(_.currentExp||0)+(b.amount||0)};return{...I,combatStats:f(I)}}),l(_=>[..._,b.msg||""])},[a,f,l]);return{handleExplorationOption:S,handleStartCombat:h,checkExplorationHealth:w}}function JC({player:e,children:t,exploreRealmState:n,applyCombatResult:s,addLog:o,setCombatData:i,setExploreLog:a,batchUpdateChildren:l,archiveChildDeaths:d,addItemsToInventory:u,setIsExploring:p}){const c=y.useCallback(S=>{var j,R;if(!S)return;const{success:h,remainingHp:g}=S.result,v=S.context||"rival";if(typeof S.onVictory=="function"||typeof S.onDefeat=="function"){h?(j=S.onVictory)==null||j.call(S,S):(R=S.onDefeat)==null||R.call(S,S),i(null);return}if(v==="rival"){f(h,g),i(null);return}h?x(S):C(S),i(null)},[e,t,n,i]),f=y.useCallback((S,h)=>{var g;if(S){const v=Math.floor((1-h/(((g=e.combatStats)==null?void 0:g.maxHp)||100))*100),j=Math.max(5,Math.floor(v/5));s({won:!0,spiritStones:500,healthDamage:j,injurySource:"DUEL"}),o("  500 ")}else{const v=ti(e,40,"DUEL");s({won:!1,expGain:-e.currentExp,spiritStones:-Math.floor(e.resources.spiritStones*.5),health:v.newHealth}),o(` ...
`+v.message)}},[e,s,o]),x=y.useCallback(S=>{var b,_;const h=((b=S.enemy)==null?void 0:b.drops)||[],g=(_=S.enemy)==null?void 0:_.isBoss;let v=[];if(h.length){const I=g?2+Math.floor(Math.random()*2):1;for(let k=0;k<I&&k<h.length;k++){const T=h[Math.floor(Math.random()*h.length)];v.push(T)}}const j=v.length?u(v):[],R=j.length?`${j.map(I=>I.name).join(", ")}`:"";if(a(g?I=>[...I,` ${R}`]:I=>[...I,`${R}`]),S.result.party&&Array.isArray(S.result.party)){const I=[];S.result.party.forEach(k=>{k.currentHp<=0&&I.push({id:k.id,name:k.name,deathReason:`${n.name}`})}),I.length>0&&w(I)}},[u,a,n.name]),C=y.useCallback(S=>{const h=ti(e,35,"EXPLORATION");if(a(g=>[...g,"",h.message," ..."]),s({won:!1,expGain:-e.currentExp,spiritStones:-Math.floor(e.resources.spiritStones*.5),health:h.newHealth}),S.result.party&&Array.isArray(S.result.party)){const g=[];S.result.party.forEach(v=>{var R;const j=v.currentHp/(((R=v.combatStats)==null?void 0:R.maxHp)||100);(j<=0||j<.3&&Math.random()<.5)&&g.push({id:v.id,name:v.name,deathReason:`${n.name}`})}),g.length>0&&w(g)}p(!1)},[e,a,n.name,p,s,l]),w=y.useCallback(S=>{const h=S.map(v=>v.id);l(v=>h.includes(v.id)?null:v),S.forEach(v=>{const j=t.find(R=>R.id===v.id);j&&(d([{...j,deathReason:v.deathReason}],t),o(` ${v.name} ${v.deathReason} ${Math.floor(j.age||0)} `))});const g=S.map(v=>v.name).join("");a(v=>[...v,` ${g} `])},[t,l,d,o,a]);return{handleCombatClose:c}}function XC({player:e,inventory:t,activeNpcs:n,modalState:s,setModalState:o,removeItemFromInventory:i,updateNpc:a,setActiveNpcs:l,batchUpdateNpcsByMap:d,setSelectedNpc:u,showResult:p,addLog:c,handleWitnessCheck:f,pushToNewsBuffer:x,isUsageAllowedForTarget:C,RESOURCE_USAGE:w,formatUsageTargets:S}){const h=y.useCallback(R=>{var ce,le,we,Ue,Oe;const b=s.data;if(!b){console.warn("No NPC found in modalState.data");return}const _=Array.isArray(R)?R:R?[{instanceId:R.instanceId,quantity:R.quantity||1}]:[];if(_.length===0){p("","",!1,null,!1,{category:"",type:"GIFT",title:"",message:"",details:"",forceManual:!0});return}const I={common:5,uncommon:10,rare:20,epic:35,legendary:50},k=b.identity==="",T=b.identity==="",N=b.identity==="";let K=0,L=0,B=0,W=0;const z=[],ne=[],Q=[];if(_.forEach(({instanceId:ze,quantity:D})=>{const me=t.find(fn=>fn.instanceId===ze);if(!me||!C(me,w.NPC))return;const xe=me.quantity||1,ke=Math.max(1,Math.min(xe,parseInt(D,10)||1));i(me.instanceId,me.stackable?ke:void 0);const Ee={...me};let Xe=I[Ee.rarity]||5;Ee.type==="consumable"&&(Xe+=5),(Ee.type==="weapon"||Ee.type==="armor")&&(Xe+=3),(k||T||N)&&(Ee.rarity==="common"||Ee.rarity==="uncommon")&&(Xe=0);const pn=Math.min(Xe,50)*ke;if(K+=pn,z.push(`${Ee.name} x${ke}`),ne.push(` ${Ee.name} x${ke} +${pn}`),Ee.type==="consumable"&&Ee.effect){const fn=Ee.effect||{},en=(fn.amount||0)*ke;fn.kind==="exp"&&(L+=en),fn.kind==="aptitude"&&(B+=en),fn.kind,fn.kind==="heal"&&(W+=en)}}),K<=0){p("","",!1,null,!1,{category:"",type:"GIFT",title:"",message:"",details:"",forceManual:!0});return}const se=b.gender===""?"":"",ye=K>15?"":K>8?"":"",Me=` ${z.join("")}  ${b.name}${se}${ye}`,Pe=_.length===1&&z.length===1?((ce=_j(b,t.find(ze=>ze.instanceId===_[0].instanceId)))==null?void 0:ce.description)||Me:`${Me}

${ne.join(`
`)}`,Ke=b.relationship||{affection:0,trust:0};let q={...b,relationship:{...Ke,affection:Math.min(100,(Ke.affection||0)+K)}},de=null;if(L>0){const ze=An(q.tier||""),D=q.maxExp||(ze==null?void 0:ze.maxExp)||0;if(q={...q,currentExp:(q.currentExp||0)+L,maxExp:D||q.maxExp},q.combatStats=Cn(q),Q.push(`${b.name} +${L}`),de={...de||{},:L},q.maxExp&&q.currentExp>=q.maxExp){const me=Py(q,e,e.time.year,e.time.month);q=me.npc,q.combatStats=Cn(q),me.events&&me.events.length>0&&Q.push(me.events[0].message)}}if(B>0){try{q=$f(q,Math.min(100,(((le=q.stats)==null?void 0:le.aptitude)||50)+B))}catch{q={...q,stats:{...q.stats,aptitude:Math.min(100,(((we=q.stats)==null?void 0:we.aptitude)||50)+B)}}}q.combatStats=Cn(q),Q.push(`${b.name} +${B}`),de={...de||{},:B}}if(W>0){const ze=Math.min(100,(((Ue=q.stats)==null?void 0:Ue.health)||100)+W);q={...q,stats:{...q.stats,health:ze}},Q.push(`${b.name} +${W}`),de={...de||{},:W}}const Z=z.join("");q=bk(q,e,Math.floor(e.age),e.time.month,Z),q=Vi(q),ls.onReceiveGift(q,{name:Z},K),a(b.id,q);const re=Q.length>0?`${Pe}

${Q.join("")}`:Pe;p("",re,!0,{:K,...de||{}},!1,{category:"",type:"GIFT",title:`-${b.name}`,message:`${b.name}`,details:re,forceManual:!0}),f(b,"GIFT"),((Oe=b.relationship)==null?void 0:Oe.affection)>=60&&Math.random()<.3&&x(e.newsBuffer,"NPC_PURSUIT",{actor:e.name,target:b.name}),o({type:null,data:null})},[s,t,e,i,a,p,f,x,o,C,w]),g=y.useCallback(R=>{var K,L,B;const b=s.data;if(!b){console.warn("No NPC found in modalState.data");return}const _=b.identity==="",I=(b.dualCultivationCount||0)>0;if(_&&!I){const W=`${b.name}"..."`;p("",W,!1,null,!1);return}let k=((K=b.relationship)==null?void 0:K.affection)||0;R.strongAgainst.includes(((L=b.personality)==null?void 0:L.label)||"")?k+=30:R.weakAgainst.includes(((B=b.personality)==null?void 0:B.label)||"")&&(k-=20);const T=Math.random()*100<k,N=Uj(b,R,T);if(T){const W=kk(b,e,Math.floor(e.age),e.time.month);ls.onPregnancyStart(W),l(z=>z.map(ne=>ne.id===b.id?{...W,isPregnant:!0,pregnancyProgress:0}:ne)),p("",N,!0,null,!1)}else p("",N,!1,null,!1)},[s,e,l,p]),v=y.useCallback((R,b)=>{let _=b;b.check&&(_=b.check(e)?b.success:b.fail);const I=(_==null?void 0:_.change)||{},k=(_==null?void 0:_.result)||b.result,T=n.find(K=>K.id===R);if(T){const K=T.relationship||{affection:0,trust:0,jealousy:0,stage:0},L={...K};I.affection!==void 0&&(L.affection=Math.min(100,Math.max(0,(L.affection||0)+I.affection))),I.trust!==void 0&&(L.trust=Math.min(100,Math.max(0,(L.trust||0)+I.trust))),I.jealousy!==void 0&&(L.jealousy=Math.min(100,Math.max(0,(L.jealousy||0)+I.jealousy)));let B=K.stage||0;if(I.stageUp){const W=L.affection||0;W>=80?B=3:W>=50?B=2:W>=20?B=1:B=0}a(R,{relationship:{...L,stage:B}})}const N=(_==null?void 0:_.msg)||"";c(`${N}`),p("",N,k==="good",{:I.affection||0,:I.trust||0,:I.jealousy||0},!1),u(null)},[e,n,a,c,p,u]),j=y.useCallback(R=>{const b=s.data;if(!b)return;const _=Zj(b,R,e),I=new Map;_.changes.forEach(k=>{var ne,Q,se;const T=n.find(ye=>ye.id===k.npcId);if(!T)return;const N=((ne=T.relationship)==null?void 0:ne.jealousy)||0,K=((Q=T.relationship)==null?void 0:Q.affection)||0,L=Math.min(100,Math.max(0,N+k.jealousyChange)),B=Math.min(100,Math.max(0,K+k.affectionChange)),W=(se=_.npcLogs)==null?void 0:se.find(ye=>ye.npcId===T.id);let z={...T,relationship:{...T.relationship,jealousy:L,affection:B}};if(W){const ye=z.logs||[],Me={year:e.time.year,month:e.time.month,content:W.content,type:W.type||"DAILY",isSecret:W.isSecret||!1,timestamp:Date.now()};z={...z,logs:[Me,...ye].slice(0,50)}}I.set(k.npcId,z)}),d(I),c(` ${_.message}`),p("",_.message,!0,{},!1),o({type:null,data:null})},[s,e,n,d,c,p,o]);return{handleGiftConfirm:h,handleNegotiateConfirm:g,handleOptionSelect:v,handleShuraFieldSelect:j}}function ZC({player:e,onBreakthroughClick:t}){const n=Math.min(100,e.currentExp/e.maxExp*100),s=Math.min(100,(e.energy||0)/20*100),o=e.currentExp>=e.maxExp&&e.maxExp>0;return r.jsxs("div",{style:Sr.cultivationSection,children:[r.jsxs("div",{style:Sr.expContainer,children:[r.jsx("div",{style:Sr.expLabel,children:""}),r.jsxs("div",{style:Sr.expBar,children:[r.jsx("div",{style:{...Sr.expBarFill,width:`${n}%`,background:o?"linear-gradient(90deg, #ff6f00 0%, #ff8f00 100%)":"linear-gradient(90deg, #76ff03 0%, #64dd17 100%)"}}),r.jsxs("span",{style:Sr.expText,children:[e.currentExp," / ",e.maxExp]})]}),r.jsxs("div",{style:{marginTop:8},children:[r.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:6},children:[r.jsx("div",{style:{fontSize:12,color:"#666"},children:""}),r.jsxs("div",{style:Sr.energyText,children:[e.energy||0," / 20"]})]}),r.jsx("div",{style:Sr.energyBar,children:r.jsx("div",{style:{...Sr.energyFill,width:`${s}%`}})})]})]}),o&&r.jsx("button",{onClick:t,style:Sr.breakthroughBtn,children:" "})]})}const Sr={cultivationSection:{display:"flex",alignItems:"center",gap:"15px",padding:"15px 20px",background:"linear-gradient(135deg, #ffffff 0%, #f5f5f5 100%)",borderBottom:"2px solid #e0e0e0",boxShadow:"0 2px 4px rgba(0,0,0,0.05)"},expContainer:{flex:1,minWidth:0},expLabel:{fontSize:"13px",fontWeight:"600",color:"#555",marginBottom:"6px"},expBar:{position:"relative",height:"24px",background:"#e0e0e0",borderRadius:"12px",overflow:"hidden",boxShadow:"inset 0 2px 4px rgba(0,0,0,0.1)"},expBarFill:{position:"absolute",top:0,left:0,height:"100%",transition:"width 0.3s ease, background 0.3s ease",boxShadow:"0 0 8px rgba(118, 255, 3, 0.4)"},expText:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",fontSize:"11px",fontWeight:"700",color:"#333",textShadow:"0 1px 2px rgba(255,255,255,0.8)",zIndex:1},energyBar:{position:"relative",height:"14px",background:"#e0e0e0",borderRadius:"7px",overflow:"hidden",boxShadow:"inset 0 1px 3px rgba(0,0,0,0.1)"},energyFill:{height:"100%",background:"linear-gradient(90deg, #29b6f6 0%, #0288d1 100%)",borderRadius:"7px",transition:"width 0.3s ease",boxShadow:"0 0 6px rgba(41, 182, 246, 0.3)"},energyText:{fontSize:"11px",color:"#666",fontWeight:"500"},breakthroughBtn:{padding:"10px 20px",background:"linear-gradient(135deg, #ff6f00 0%, #ff8f00 100%)",color:"white",border:"none",borderRadius:"8px",fontSize:"14px",fontWeight:"600",cursor:"pointer",boxShadow:"0 4px 8px rgba(255, 111, 0, 0.3)",transition:"all 0.2s",animation:"pulse 2s infinite",whiteSpace:"nowrap"}};function eT({player:e,visibleChildren:t,pregnantNpcs:n,fallenChildren:s,exiledChildren:o=[],onChildClick:i,onToggleFavorite:a,onMemorialClick:l,generation3Plus:d=[]}){return r.jsxs("div",{style:Kg.tabContent,children:[r.jsx(tj,{player:e,children:t,pregnantNpcs:n,fallenChildren:s,exiledChildren:o,onChildClick:i,onToggleFavorite:a,onMemorialClick:l,generation3Plus:d}),r.jsxs("div",{style:Kg.statsBar,children:[": ",t.length+1," | : ",t.filter(u=>u.generation>1).length]})]})}const Kg={tabContent:{flex:1,overflow:"auto",background:"#fafafa"},statsBar:{padding:"15px",textAlign:"center",fontSize:"13px",color:"#555",borderTop:"1px dashed #e0e0e0",marginTop:"15px"}};function tT({isAuto:e,autoSpeed:t,player:n,messageUnreadCount:s,onToggleAuto:o,onSetAutoSpeed:i,onNextMonth:a,onOpenGazette:l,onOpenMessageCenter:d,onMarkGazetteRead:u}){return r.jsxs(r.Fragment,{children:[r.jsxs("div",{style:Yn.fabContainer,children:[e&&r.jsxs("div",{style:Yn.speedSelector,children:[r.jsx("button",{onClick:()=>i(.3),style:{...Yn.speedBtn,backgroundColor:t===.3?"#4CAF50":"#e0e0e0",color:t===.3?"white":"#666"},children:"0.3"}),r.jsx("button",{onClick:()=>i(1),style:{...Yn.speedBtn,backgroundColor:t===1?"#4CAF50":"#e0e0e0",color:t===1?"white":"#666"},children:"1"}),r.jsx("button",{onClick:()=>i(3),style:{...Yn.speedBtn,backgroundColor:t===3?"#4CAF50":"#e0e0e0",color:t===3?"white":"#666"},children:"3"})]}),r.jsx("button",{onClick:o,style:{...Yn.autoBtn,backgroundColor:e?"#76ff03":"#e0e0e0",color:e?"#33691e":"#757575"},children:e?" ":" "}),r.jsx("button",{onClick:()=>a(!1),style:{...Yn.fabBtn,transform:e?"scale(0.9)":"scale(1)",opacity:e?.8:1},disabled:e,children:e?r.jsx("div",{style:Yn.spinner,children:""}):r.jsxs(r.Fragment,{children:[r.jsx("span",{style:{fontSize:"18px"},children:""}),r.jsx("span",{style:{fontSize:"9px"},children:""})]})})]}),r.jsxs("button",{onClick:()=>{l(),u()},style:Yn.gazetteBtn,title:"",children:["",n.hasUnreadGazette&&r.jsx("span",{style:Yn.redDot})]}),r.jsxs("button",{onClick:d,style:Yn.messageCenterBtn,title:" - ",children:["",s>0&&r.jsx("span",{style:Yn.redDot,children:s})]})]})}const Yn={fabContainer:{position:"fixed",bottom:"76px",right:"20px",display:"flex",flexDirection:"column",alignItems:"flex-end",gap:"12px",zIndex:99},speedSelector:{display:"flex",gap:"6px",padding:"8px",background:"rgba(255,255,255,0.95)",borderRadius:"20px",boxShadow:"0 4px 12px rgba(0,0,0,0.15)"},speedBtn:{padding:"6px 12px",border:"none",borderRadius:"12px",fontSize:"12px",fontWeight:"600",cursor:"pointer",transition:"all 0.2s",minWidth:"45px"},autoBtn:{padding:"10px 18px",border:"none",borderRadius:"20px",fontSize:"13px",fontWeight:"600",cursor:"pointer",boxShadow:"0 4px 12px rgba(0,0,0,0.15)",transition:"all 0.2s"},fabBtn:{width:"60px",height:"60px",borderRadius:"50%",border:"none",background:"linear-gradient(135deg, #8b7355 0%, #a0826d 100%)",color:"#fff",fontSize:"14px",fontWeight:"600",cursor:"pointer",boxShadow:"0 6px 20px rgba(139, 115, 85, 0.3)",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",gap:"2px",transition:"all 0.2s"},spinner:{fontSize:"24px",animation:"spin 2s linear infinite"},gazetteBtn:{position:"fixed",bottom:"76px",left:"20px",width:"50px",height:"50px",borderRadius:"50%",border:"none",background:"linear-gradient(135deg, #8b6f47 0%, #a0916f 100%)",color:"#fff",fontSize:"24px",cursor:"pointer",boxShadow:"0 4px 12px rgba(139, 111, 71, 0.3)",zIndex:99,transition:"all 0.2s"},messageCenterBtn:{position:"fixed",bottom:"136px",left:"20px",width:"50px",height:"50px",borderRadius:"50%",border:"none",background:"linear-gradient(135deg, #c9b5a0 0%, #d4c9c1 100%)",color:"#4a3728",fontSize:"24px",cursor:"pointer",boxShadow:"0 4px 12px rgba(201, 181, 160, 0.3)",zIndex:99,transition:"all 0.2s"},redDot:{position:"absolute",top:"0",right:"0",width:"18px",height:"18px",background:"#f44336",color:"white",borderRadius:"50%",fontSize:"10px",fontWeight:"700",display:"flex",alignItems:"center",justifyContent:"center",border:"2px solid white",boxShadow:"0 2px 4px rgba(0,0,0,0.2)"}},nT=[{value:"DEFAULT",label:" ()"},{value:"AFFECTION_DESC",label:" ()"},{value:"APTITUDE_DESC",label:" ()"},{value:"TRUST_DESC",label:" ()"}],rT=({sortedNpcs:e,pagedNpcs:t,deadNpcs:n,npcSort:s,npcPage:o,npcPageCount:i,hasNpcPagination:a,showFollowedOnly:l,onExplore:d,onSortChange:u,onToggleFollowedOnly:p,onPrevPage:c,onNextPage:f,onNpcInteract:x,onNpcAction:C,isRomanceLimitReached:w=!1})=>r.jsxs("div",{style:{padding:"15px",maxWidth:"800px",margin:"0 auto",paddingBottom:"80px"},children:[r.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"15px"},children:[r.jsxs("h2",{style:{margin:0,color:"#5d4037"},children:[" ",e.length,""]}),r.jsx("button",{onClick:d,style:{padding:"8px 16px",backgroundColor:w?"#c0c0c0":"#8d6e63",color:"white",border:w?"2px solid #d32f2f":"none",borderRadius:"8px",cursor:w?"not-allowed":"pointer",fontSize:"14px",fontWeight:w?"bold":"normal",opacity:w?.7:1},children:" "})]}),w&&r.jsx("div",{style:{padding:"12px",marginBottom:"15px",backgroundColor:"#fff3e0",borderLeft:"4px solid #ff9800",borderRadius:"4px",color:"#e65100",fontSize:"13px",fontWeight:"500"},children:" "}),r.jsxs("div",{style:{marginBottom:"15px"},children:[r.jsx(KC,{options:nT,currentSort:s,onSortChange:u}),r.jsx("div",{style:{marginTop:"10px"},children:r.jsxs("label",{style:{fontSize:"14px",color:"#666",cursor:"pointer",userSelect:"none"},children:[r.jsx("input",{type:"checkbox",checked:l,onChange:S=>p(S.target.checked),style:{marginRight:"6px"}})," NPC"]})})]}),r.jsxs("div",{children:[t.length===0?r.jsx("div",{style:{textAlign:"center",padding:"40px",color:"#999",fontSize:"14px"},children:""}):r.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(280px, 1fr))",gap:"12px"},children:t.map(S=>r.jsx(Cg,{npc:S,onInteract:(h,g)=>{C?C(h,g):g==="DETAIL"&&x(S)}},S.id))}),a&&r.jsxs("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",gap:"15px",marginTop:"20px"},children:[r.jsx("button",{onClick:c,disabled:o===0,style:{padding:"8px 16px",border:"1px solid #ccc",borderRadius:"8px",backgroundColor:o===0?"#f5f5f5":"white",cursor:o===0?"not-allowed":"pointer",fontSize:"14px"},children:""}),r.jsxs("span",{style:{fontSize:"14px",color:"#666"},children:[" ",o+1," / ",i," "]}),r.jsx("button",{onClick:f,disabled:o>=i-1,style:{padding:"8px 16px",border:"1px solid #ccc",borderRadius:"8px",backgroundColor:o>=i-1?"#f5f5f5":"white",cursor:o>=i-1?"not-allowed":"pointer",fontSize:"14px"},children:""})]})]}),n.length>0&&r.jsxs("div",{style:{marginTop:"30px"},children:[r.jsxs("h3",{style:{color:"#999",fontSize:"16px",marginBottom:"15px"},children:[" ",n.length,""]}),r.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(280px, 1fr))",gap:"12px",opacity:.6},children:n.map(S=>r.jsx(Cg,{npc:S,actions:r.jsx("button",{onClick:()=>x(S),style:{width:"100%",padding:"8px",border:"1px solid #ccc",borderRadius:"6px",backgroundColor:"#f5f5f5",color:"#999",cursor:"pointer",fontSize:"14px"},children:""})},S.id))})]})]}),sT=({player:e,children:t,showBizPanel:n,showChallengePanel:s,idleManagerOptions:o,onDailyAction:i,onShopping:a,onOpenInventory:l,onBuyBusiness:d,onExploreRealm:u,onOpenAuction:p,onCloseBizPanel:c,onCloseChallengePanel:f,onOpenBizPanel:x,onOpenChallengePanel:C,isRomanceLimitReached:w=!1})=>{const S=((e.time.year-3572)*12+e.time.month)%36===0;return r.jsx("div",{style:{padding:"15px",maxWidth:"800px",margin:"0 auto",paddingBottom:"80px"},children:n?r.jsxs("div",{children:[r.jsx("button",{onClick:c,style:{padding:"8px 16px",marginBottom:"15px",border:"1px solid #ccc",borderRadius:"8px",backgroundColor:"white",cursor:"pointer",fontSize:"14px"},children:" "}),r.jsx(v5,{player:e,children:t,managerOptions:o,onBuy:d})]}):s?r.jsxs("div",{children:[r.jsx("button",{onClick:f,style:{padding:"8px 16px",marginBottom:"15px",border:"1px solid #ccc",borderRadius:"8px",backgroundColor:"white",cursor:"pointer",fontSize:"14px"},children:" "}),r.jsx(S5,{player:e,children:t,onChallenge:u,isRomanceLimitReached:w})]}):r.jsxs("div",{children:[r.jsx("h2",{style:{margin:"0 0 20px 0",color:"#5d4037"},children:""}),r.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"10px",marginBottom:"30px"},children:[r.jsx("button",{onClick:()=>i("CULTIVATE"),style:{padding:"12px 20px",border:"none",borderRadius:"8px",backgroundColor:"#8d6e63",color:"white",cursor:"pointer",fontSize:"16px",fontWeight:"bold"},children:" (+10-15)"}),r.jsx("button",{onClick:()=>i("WORK"),style:{padding:"12px 20px",border:"none",borderRadius:"8px",backgroundColor:"#8d6e63",color:"white",cursor:"pointer",fontSize:"16px",fontWeight:"bold"},children:" (+15)"}),r.jsx("button",{onClick:a,style:{padding:"12px 20px",border:"none",borderRadius:"8px",backgroundColor:"#8d6e63",color:"white",cursor:"pointer",fontSize:"16px",fontWeight:"bold"},children:" (-10)"}),r.jsx("button",{onClick:()=>l("SELL"),style:{padding:"12px 20px",border:"none",borderRadius:"8px",backgroundColor:"#8d6e63",color:"white",cursor:"pointer",fontSize:"16px",fontWeight:"bold"},children:" ()"})]}),r.jsxs("div",{style:{marginTop:"30px",borderTop:"1px dashed #ccc",paddingTop:"20px"},children:[r.jsx("h3",{style:{margin:"0 0 15px 0",color:"#5d4037"},children:" "}),r.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(140px, 1fr))",gap:"15px"},children:[r.jsxs("button",{onClick:x,style:{padding:"20px",border:"2px solid #8d6e63",borderRadius:"12px",backgroundColor:"white",cursor:"pointer",display:"flex",flexDirection:"column",alignItems:"center",gap:"10px",transition:"all 0.2s"},children:[r.jsx("div",{style:{fontSize:"36px"},children:""}),r.jsx("div",{style:{fontSize:"14px",fontWeight:"bold",color:"#5d4037"},children:""})]}),r.jsxs("button",{onClick:C,style:{padding:"20px",border:"2px solid #8d6e63",borderRadius:"12px",backgroundColor:"white",cursor:"pointer",display:"flex",flexDirection:"column",alignItems:"center",gap:"10px",transition:"all 0.2s"},children:[r.jsx("div",{style:{fontSize:"36px"},children:""}),r.jsx("div",{style:{fontSize:"14px",fontWeight:"bold",color:"#5d4037"},children:""})]}),r.jsxs("button",{onClick:p,style:{padding:"20px",border:"2px solid #8d6e63",borderRadius:"12px",backgroundColor:"white",cursor:"pointer",display:"flex",flexDirection:"column",alignItems:"center",gap:"10px",transition:"all 0.2s",opacity:S?1:.6},children:[r.jsx("div",{style:{fontSize:"36px"},children:""}),r.jsx("div",{style:{fontSize:"14px",fontWeight:"bold",color:"#5d4037"},children:""}),r.jsx("div",{style:{fontSize:"10px",color:"#999"},children:""})]})]})]})]})})},Qg=["","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","",""],oT=["","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","",""],iT=["","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","",""],Jg=["","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","",""],Xg=["","","","","","","","","","","","","","","","","","","",""];function p1(e){const t=Qg[Math.floor(Math.random()*Qg.length)],n=e==="male"?oT:iT;if(Math.random()>.3){const o=n[Math.floor(Math.random()*n.length)],i=n[Math.floor(Math.random()*n.length)];return t+o+i}else{const o=n[Math.floor(Math.random()*n.length)];return t+o}}function f1(e){const t=Jg[Math.floor(Math.random()*Jg.length)],n=Xg[Math.floor(Math.random()*Xg.length)];if(e.includes("")||e.includes("")){const s=["","","","",""];return s[Math.floor(Math.random()*s.length)]+n}else if(e.includes("")||e.includes("")){const s=["","","","",""];return s[Math.floor(Math.random()*s.length)]+n}return t+n}function m1(e,t={}){const{ensureAllSects:n=!1,preserveExisting:s=!0}=t,o=Er.filter(u=>u&&u.id&&u.id!=="SECT_NONE"),i=new Map,a=new Map,l=e.reduce((u,p)=>{const c=Number.isFinite(p==null?void 0:p.tierIndex)?p.tierIndex:-1;return c>u?c:u},-1);if(o.forEach(u=>i.set(u.id,[])),e.forEach(u=>{var c,f;const p=(c=u.sect)==null?void 0:c.id;p&&i.has(p)&&i.get(p).push(u),u.sectRank===""&&((f=u.sect)!=null&&f.id)&&u.status!=="DEAD"&&a.set(u.sect.id,u)}),n){const u=e.filter(c=>!c.sect),p=c=>!c||c.length===0?null:(c.sort((f,x)=>f.tierIndex!==x.tierIndex?f.tierIndex-x.tierIndex:(f.combatPower||0)-(x.combatPower||0)),c.shift());o.forEach(c=>{var C;if((i.get(c.id)||[]).length>0)return;let x=u.pop();if(!x){const w=[...i.entries()].filter(([,S])=>S.length>1).sort((S,h)=>h[1].length-S[1].length)[0];w&&(x=p(w[1]))}if(x){const w=(C=x.sect)==null?void 0:C.id;if(w&&i.has(w)){const S=i.get(w),h=S.indexOf(x);h>=0&&S.splice(h,1)}x.sect={id:c.id,name:c.name},i.get(c.id).push(x)}})}const d=u=>{if(!u||u.length===0)return null;const p=l>=0?u.filter(f=>f.tierIndex===l):[];return(p.length>0?p:u).reduce((f,x)=>f?x.tierIndex!==f.tierIndex?x.tierIndex>f.tierIndex?x:f:(x.combatPower||0)>(f.combatPower||0)?x:f:x,null)};o.forEach(u=>{const p=i.get(u.id)||[];if(p.length===0)return;const f=(s?a.get(u.id):null)||d(p);p.forEach(x=>{x===f?(x.sectRank="",x.isSectLeader=!0):x.sectRank===""&&(x.sectRank=void 0,x.isSectLeader=!1)})})}function aT(e=30){const t=[],n=new Set,s={:.22,:.16,:.14,:.14,:.12,:.1,:.06,:.04,:.02},o={};let i=0;Object.entries(s).forEach(([u,p])=>{const c=Math.floor(e*p);o[u]=c,i+=c});const a=Math.max(0,e-i);a>0&&(o.=(o.||0)+a);let l=1;return["","","","","","","","",""].forEach(u=>{const p=o[u]||1;for(let c=0;c<p;c++){const f=Math.random()>.7?"female":"male";let x,C=0;do x=p1(f),C++;while(n.has(x)&&C<100);n.has(x)&&(x=x+l),n.add(x);const w=f1(u);let S=null;if(Math.random()>.3){const T=Er.filter(N=>N.id!=="SECT_NONE");S=T[Math.floor(Math.random()*T.length)]}const h=Qe.findIndex(T=>T.name===u);if(h===-1){console.error(`: ${u}`);return}const g=Qe[h],j=g.maxExp*2*(.8+Math.random()*.4),b=Math.random()<.8?90+Math.floor(Math.random()*11):80+Math.floor(Math.random()*10),_=oi(b),I=50+Math.floor(Math.random()*50),k={id:`world_npc_${l}`,name:x,title:w,gender:f,tier:u,tierIndex:h,sect:S?{id:S.id,name:S.name}:null,status:"ALIVE",location:"Unknown",hasMetPlayer:!1,firstMetYear:null,currentExp:Math.floor(Math.random()*g.maxExp*.8)+g.maxExp*.2,maxExp:g.maxExp,stats:{aptitude:b,looks:I,intelligence:60+Math.floor(Math.random()*40),health:80},spiritRoot:_,combatPower:Math.floor(j),age:30+(Qe.length-h)*50+Math.floor(Math.random()*100),personality:g1(),signature:h1(u),appearance:{description:x1(f,u,I)},relationships:{allies:[],enemies:[],disciples:[]},majorEvents:[`${w}`],lastActiveYear:3572};t.push(k),l++}}),lT(t),m1(t,{ensureAllSects:!0,preserveExisting:!1}),t}function g1(){const e=[{label:"",desc:""},{label:"",desc:""},{label:"",desc:""},{label:"",desc:""},{label:"",desc:""},{label:"",desc:""},{label:"",desc:""},{label:"",desc:""},{label:"",desc:""},{label:"",desc:""},{label:"",desc:""},{label:"",desc:""},{label:"",desc:""},{label:"",desc:""},{label:"",desc:""}];return e[Math.floor(Math.random()*e.length)]}function h1(e){const t={:["","","",""],:["","","",""],:["","","",""],:["","","",""],:["","","",""],:["","","",""]},n=t[e]||t.;return n[Math.floor(Math.random()*n.length)]}function x1(e,t,n=60){const s=Number.isFinite(n)?n:60,o={high:["","",""],mid:["","",""],low:["","",""]},i={high:["","",""],mid:["","",""],low:["","",""]},a=s>=85?"high":s>=60?"mid":"low",l=e==="male"?o[a]:i[a];return l[Math.floor(Math.random()*l.length)]}function lT(e){const t=e.filter(s=>["","",""].includes(s.tier));e.filter(s=>["",""].includes(s.tier)).forEach(s=>{if(Math.random()>.5&&t.length>0){const o=t[Math.floor(Math.random()*t.length)];o.sect&&s.sect&&o.sect.id===s.sect.id&&(o.relationships.disciples.push(s.id),s.majorEvents.push(`${o.name}`))}});for(let s=0;s<Math.min(5,e.length/3);s++){const o=e[Math.floor(Math.random()*e.length)],i=e[Math.floor(Math.random()*e.length)];o.id!==i.id&&!o.relationships.enemies.includes(i.id)&&Math.abs(o.tierIndex-i.tierIndex)<=2&&(o.relationships.enemies.push(i.id),i.relationships.enemies.push(o.id),o.majorEvents.push(`${i.name}`),i.majorEvents.push(`${o.name}`))}}function Zg(e,t){const n=e.map(a=>{if(a.status==="DEAD")return a;const l={...a};l.age=(a.age||100)+1;const d=Qe.findIndex(w=>w.name===a.tier);if(d===-1)return console.warn(`: ${a.tier}`),a;const u=1/Math.max(1,d*.5),p=Math.floor(a.maxExp*.05*u*(.8+Math.random()*.4));l.currentExp=Math.min(a.maxExp,a.currentExp+p);const c=l.currentExp>=l.maxExp,f=Math.max(.02,.1-d*.01);if(c&&Math.random()<f&&d<Qe.length-1){const w=d+1,S=Qe[w].name;l.tier=S,l.tierIndex=w,l.currentExp=0,l.maxExp=Qe[w].maxExp,l.combatPower=Math.floor(l.combatPower*1.5),l.majorEvents.push(`${t}${S}`)}const C=.005/Math.max(1,d*.3);if(Math.random()<C){l.status="DEAD",l.deathYear=t;const w=["","","","",""];l.deathReason=w[Math.floor(Math.random()*w.length)],l.majorEvents.push(`${t}${l.deathReason}`)}return l.lastActiveYear=t,l}),s=n.filter(a=>a.status==="DEAD"&&a.deathYear===t).length,o=[];for(let a=0;a<s;a++)if(Math.random()<.2){const l=Math.random()>.5?"male":"female",d=p1(l),u=f1(""),p=Qe.findIndex(C=>C.name===""),c=Qe[p],f=55+Math.floor(Math.random()*40),x={id:`world_npc_new_${t}_${a}`,name:d,title:u,gender:l,tier:"",tierIndex:p,sect:null,status:"ALIVE",location:"Unknown",hasMetPlayer:!1,firstMetYear:null,currentExp:Math.floor(c.maxExp*.5),maxExp:c.maxExp,combatPower:Math.floor(c.maxExp*1.5),age:50+Math.floor(Math.random()*50),stats:{aptitude:80+Math.floor(Math.random()*16),looks:f,intelligence:60+Math.floor(Math.random()*30),health:80},personality:g1(),signature:h1(""),appearance:{description:x1(l,"",f)},relationships:{allies:[],enemies:[],disciples:[]},majorEvents:[`${t}`],lastActiveYear:t};o.push(x)}const i=[...n,...o];return m1(i,{ensureAllSects:!1,preserveExisting:!0}),i}const Ff=[{id:"dawn_breaker",name:"",epithet:"",element:"",basePrice:2600,desc:"",auctionFlavor:"",blessing:""},{id:"dusk_ember",name:"",epithet:"",element:"",basePrice:2750,desc:"",auctionFlavor:"",blessing:""},{id:"frost_pulse",name:"",epithet:"",element:"",basePrice:2900,desc:"",auctionFlavor:"",blessing:""},{id:"abyssal_flare",name:"",epithet:"",element:"",basePrice:3100,desc:"",auctionFlavor:"",blessing:""}],cT=[{key:"sword_saint",name:"",alias:"",gender:"",identity:"",tier:"",expRatio:.86,age:230,stats:{aptitude:98,looks:92,intelligence:90,health:95},baseAffection:45,baseTrust:25,spiritRoot:{type:"",elements:["",""],color:"#8ad3ff",desc:""},constitutionKey:"fumo_frost_thunder_body",inheritance:{bloodline:"",desc:""},cultivationMethod:"wanjian_heart",personality:{label:"",tag:"",desc:""},appearance:"",desc:"",title:"",trait:{name:"",desc:""},likes:["",""],dislikes:[""],world:{rankHint:"",combatPower:36e4,location:""}},{key:"demon_sage",name:"",alias:"",gender:"",identity:"",tier:"",expRatio:.78,age:210,stats:{aptitude:96,looks:95,intelligence:93,health:90},baseAffection:50,baseTrust:28,spiritRoot:{type:"",elements:["",""],color:"#ff7c8a",desc:""},constitutionKey:"fumo_abyssal_flame_core",inheritance:{bloodline:"",desc:""},cultivationMethod:"wanmo_heart",personality:{label:"",tag:"",desc:""},appearance:"",desc:"",title:"",trait:{name:"",desc:""},likes:["",""],dislikes:[""],world:{rankHint:"",combatPower:345e3,location:""}}],Su=Ff.length,wu=cT,eh=e=>Ff.find(t=>t.id===e),Tp=(e=[])=>{const t=new Set(e||[]);return Ff.filter(n=>!t.has(n.id))},dT=e=>e?{id:`FUMO_${e.id}_${Date.now()}`,type:"FUMO_SWORD",swordId:e.id,name:e.name,basePrice:e.basePrice,description:`${e.epithet}  ${e.desc}`,rarity:"legendary",plot:e.auctionFlavor}:null,uT=e=>e?{instanceId:`fumo_sword_${e.id}_${Date.now()}`,name:e.name,type:"weapon",rarity:"legendary",desc:`${e.epithet}  ${e.desc}

${e.blessing}`,tags:["",""],bound:!0,effect:{kind:"artifact",stat:"atk",amount:800}}:null,pT=e=>{var i;if(!e)return null;const t=An(e.tier)||{maxExp:12e4},n=Math.floor((e.expRatio||.8)*t.maxExp),s=e.constitution?Wl(e.constitution):e.constitutionKey?wy(e.constitutionKey):null,o={id:`legend_${e.key}`,name:e.name,alias:e.alias,gender:e.gender,identity:e.identity,title:e.title,tier:e.tier,currentExp:n,maxExp:t.maxExp,stats:{...e.stats},spiritRoot:e.spiritRoot?{...e.spiritRoot}:null,cultivationMethod:e.cultivationMethod,constitution:s,personality:e.personality,appearance:e.appearance,desc:e.desc,trait:e.trait,likes:e.likes,dislikes:e.dislikes,relationship:{stage:0,affection:e.baseAffection??40,trust:e.baseTrust??20,jealousy:10},logs:[],status:"AVAILABLE",customFlags:{isFumoLegend:!0,legendKey:e.key,inheritanceTag:(i=e.inheritance)==null?void 0:i.bloodline}};return o.combatStats=Cn(o),o},fT=(e,t)=>{var o,i,a,l;if(!e)return null;const n=Qe.findIndex(d=>d.name===e.tier),s=An(e.tier)||{maxExp:12e4};return{id:`world_${e.key}`,name:e.name,title:e.title||e.identity,gender:e.gender===""?"female":"male",tier:e.tier,tierIndex:n>=0?n:Qe.length-1,status:"ALIVE",location:((o=e.world)==null?void 0:o.location)||"",hasMetPlayer:!0,firstMetYear:t,currentExp:Math.floor((e.expRatio||.8)*s.maxExp),maxExp:s.maxExp,combatPower:((i=e.world)==null?void 0:i.combatPower)||s.maxExp*2,age:e.age||200,personality:e.personality,appearance:{description:e.appearance},relationships:{allies:[],enemies:[],disciples:[]},majorEvents:[`${t}${e.name} `],lastActiveYear:t,customFlags:{isFumoLegend:!0,legendKey:e.key,rankHint:(a=e.world)==null?void 0:a.rankHint,inheritanceTag:(l=e.inheritance)==null?void 0:l.bloodline}}},mT=["","",""],gT=e=>e[Math.floor(Math.random()*e.length)],Ip=Object.values(J).reduce((e,t)=>(e[t.key]=t.order,e),{}),hT={common:80,uncommon:160,rare:420,epic:900,legendary:2200},xT=e=>{const t=Ip[e.resourceLevel]||1,n=hT[e.rarity]||300;return Math.floor(n*(1+t*.55))},yT=Object.values(Vc).filter(e=>e.resourceLevel&&Ip[e.resourceLevel]>=2).map(e=>{var t;return{itemId:e.id,name:e.name,description:e.desc,rarity:e.rarity,resourceLevel:e.resourceLevel,resourceOrder:Ip[e.resourceLevel]||1,basePrice:xT(e),type:e.type,plot:`${e.source||""}${((t=J[e.resourceLevel])==null?void 0:t.label)||""}`}}),th=(e,t={})=>{const{ownedFumoSwords:n=[],soldAuctionItems:s=[]}=t,o=new Set(s||[]),i=S=>o.has(`ITEM:${S}`)||o.has(S),a=S=>o.has(`FUMO:${S}`)||o.has(S),l=yT.filter(S=>!i(S.itemId)),d=3+Math.floor(Math.random()*3),u=[],p=()=>{if(!l.length)return null;const S=l.map(v=>({entry:v,weight:Math.max(1,10-v.resourceOrder*2)})),h=S.reduce((v,{weight:j})=>v+j,0);let g=Math.random()*h;for(const{entry:v,weight:j}of S)if(g-=j,g<=0)return v;return S[S.length-1].entry},c=new Set;for(let S=0;S<d;S++){let h=0,g=null;for(;h<10&&(g=p(),!(!g||!c.has(g.itemId)));)h++;g&&!c.has(g.itemId)&&(c.add(g.itemId),u.push({id:`ITEM_${Date.now()}_${S}`,type:"ITEM",itemId:g.itemId,name:g.name,basePrice:g.basePrice,description:g.description||`${g.name}`,resourceLevel:g.resourceLevel,rarity:g.rarity,plot:g.plot}))}if(Math.random()<.5){const S=gT(mT)+Ew(),h=150+Math.floor(Math.random()*300);u.push({id:`SLAVE_${Date.now()}_${Math.floor(Math.random()*999)}`,type:"SLAVE",name:S,basePrice:h,description:"",plot:""})}const x=Tp(n).filter(S=>!a(S.id));if(x.length>0){const S=Math.random()<.25?2:1,h=[...x];for(let g=0;g<S&&h.length>0;g++){const v=Math.floor(Math.random()*h.length),j=h.splice(v,1)[0],R=dT(j);R&&u.push(R)}}const C=` ${e} `,w=` ${u.length} `;return{title:C,message:w,items:u}},Il=10,os=60,nh=e=>e?typeof e=="string"?{contextMessage:e}:e:{},rh=(e=3572,t=1)=>{const n=Math.max(1,Math.min(12,t||1));return(e-3572)*12+n},bT={[ht.PLAYER]:"",[ht.CHILD]:"",[ht.NPC]:""},y1=e=>e&&Array.isArray(e.usageTargets)&&e.usageTargets.length>0?e.usageTargets:Sy,ko=e=>y1(e).map(n=>bT[n]||I2[n]||n).join(""),Ws=(e,t)=>e?t===ht.NPC&&e.resourceCategory==="PILL"?!0:y1(e).includes(t):!1,vT=()=>`log-${Date.now()}-${Math.random().toString(16).slice(2)}`,ST=[{id:"init-log-2",turn:0,message:"",category:"",type:null,title:null,details:null},{id:"init-log-3",turn:0,message:"",category:"",type:null,title:null,details:null}],wT=Bo!=null&&Bo.avatar?{...Bo.avatar}:{base:0,skinColor:0,hair:1,hairColor:0,eye:0,eyeColor:1,mouth:0},sh=e=>!e||typeof e!="object"?!1:["hair","hairId","faceId","eye","tZoneId"].some(t=>typeof e[t]<"u"&&e[t]!==null),kT=250,ku="forcePortraitUI",oh=()=>typeof window>"u"?!0:window.innerHeight>=window.innerWidth,ET=e=>e?!!(e.status==="DEAD"||e.state==="DEAD"||e.isDeceased||e.deathYear||e.deathReason||typeof e.lifespan=="number"&&e.lifespan<=0||typeof e.health=="number"&&e.health<=0||typeof e.currentHp=="number"&&e.currentHp<=0):!1;function jT(){var i0,a0,l0,c0,d0,u0,p0,f0,m0,g0,h0;const e=T2(),{modalState:t,setModalState:n,openModal:s,closeModal:o}=e,i=y.useCallback(m=>{m.type===null?o():s(m.type,m.data)},[s,o]),a=_2(),{inventory:l,addItemsToInventory:d,removeItemFromInventory:u}=a,p=bw(),{player:c,setPlayer:f,updatePlayer:x,addResources:C,consumeResources:w,consumeEnergy:S,purchaseBusiness:h,applyCombatResult:g,updateWorldNpc:v,updateWorldNpcs:j,clearNewsBuffer:R,addToSpecialCollection:b,applyDefeatPenalty:_}=p,I=hE(),{activeNpcs:k,deadNpcs:T,selectedNpc:N,selectedWorldNpc:K,visibleNpcs:L,setActiveNpcs:B,setDeadNpcs:W,setSelectedNpc:z,setSelectedWorldNpc:ne,updateNpc:Q,addNpc:se,toggleNpcFollow:ye,batchUpdateNpcs:Me,replaceAllNpcs:Pe,batchUpdateNpcsByMap:Ke,cutTiesWithNpc:q}=I,de=xE(),{children:Z,fallenChildren:re,selectedChild:ce,enhancedChildren:le,setChildren:we,setFallenChildren:Ue,setSelectedChild:Oe,updateChild:ze,removeChild:D,toggleChildFavorite:me,batchUpdateChildren:xe,replaceAllChildren:ke,batchUpdateChildrenIf:Ee}=de,[Xe,Mt]=y.useState(!0),[pn,fn]=y.useState(!0),[en,qr]=y.useState("PROLOGUE");y.useEffect(()=>{const m=qy();console.log(":",m?"":"")},[]),y.useMemo(()=>_y.map(m=>{var E;const M=(E=m.stats)==null?void 0:E.aptitude;return typeof M=="number"?{...m,spiritRoot:oi(M)}:m}),[]);const[Kr,co]=y.useState(()=>oh()),[fr,Qr]=y.useState(()=>typeof window>"u"?!1:localStorage.getItem(ku)==="true"),mn=y.useMemo(()=>{const m=((c==null?void 0:c.exiledChildren)||[]).map(M=>M.id);return le.filter(M=>!m.includes(M.id))},[le,c==null?void 0:c.exiledChildren]),tn=y.useMemo(()=>[...mn].sort((m,M)=>{var A,O;const E=m.age-M.age;if(E!==0)return E;const P=(((A=M.stats)==null?void 0:A.aptitude)||0)-(((O=m.stats)==null?void 0:O.aptitude)||0);return P!==0?P:m.name.localeCompare(M.name,"zh-CN")}),[mn]),Qc=y.useMemo(()=>mn.filter(m=>m.age>=16&&!m.job).map(m=>{var M;return{id:m.id,name:m.name,age:Math.max(16,Math.floor(m.age||0)),gender:m.gender,tierTitle:m.tierTitle||"",intelligence:((M=m.stats)==null?void 0:M.intelligence)??0}}).sort((m,M)=>(M.intelligence??0)-(m.intelligence??0)),[mn]),mr=y.useMemo(()=>{var m;return[...((m=c.specialCollections)==null?void 0:m.fumoSwords)||[]]},[(i0=c.specialCollections)==null?void 0:i0.fumoSwords]),Na=y.useMemo(()=>Tp(mr),[mr]),uo=y.useMemo(()=>{var m,M;return(m=c.specialFlags)!=null&&m.fumoDuoMet?!1:(M=c.specialFlags)!=null&&M.fumoDuoUnlocked?!0:Su>0&&Na.length===0},[(a0=c.specialFlags)==null?void 0:a0.fumoDuoMet,(l0=c.specialFlags)==null?void 0:l0.fumoDuoUnlocked,Na.length]);y.useEffect(()=>{if(typeof window>"u")return;const m=()=>{co(oh())};return m(),window.addEventListener("resize",m),window.addEventListener("orientationchange",m),()=>{window.removeEventListener("resize",m),window.removeEventListener("orientationchange",m)}},[]),y.useEffect(()=>{typeof document<"u"&&document.body.classList.toggle("force-portrait-ui",fr),typeof window<"u"&&(fr?localStorage.setItem(ku,"true"):localStorage.removeItem(ku))},[fr]),y.useEffect(()=>()=>{typeof document<"u"&&document.body.classList.remove("force-portrait-ui")},[]);const[Is,li]=y.useState(ST),Be=y.useCallback((m,M="",E=null,P=null,A=null)=>{var F,oe;const O=((F=c==null?void 0:c.time)==null?void 0:F.year)??3572,$=((oe=c==null?void 0:c.time)==null?void 0:oe.month)??1,H=(O-3572)*12+$,Y={id:vT(),turn:H,message:m,category:M,type:E,title:P,details:A};li(ie=>[Y,...ie])},[(c0=c==null?void 0:c.time)==null?void 0:c0.year,(d0=c==null?void 0:c.time)==null?void 0:d0.month]),[tr,Jc]=y.useState("FAMILY"),[nn,nr]=y.useState(!1),[Rs,Xc]=y.useState(1),[_s,Zc]=y.useState(!1),[La,Hf]=y.useState("AGE_DESC"),[Ms,$a]=y.useState("DEFAULT"),[Jr,As]=y.useState(0),Xr=y.useMemo(()=>{const m=k.filter(M=>{var E;return!((E=M.relationship)!=null&&E.cutTies)&&(!_s||M.isFollowed)});switch(Ms){case"AFFECTION_DESC":return m.sort((M,E)=>{var O,$;const P=((O=M.relationship)==null?void 0:O.affection)||0;return((($=E.relationship)==null?void 0:$.affection)||0)-P});case"TRUST_DESC":return m.sort((M,E)=>{var O,$;const P=((O=M.relationship)==null?void 0:O.trust)||0;return((($=E.relationship)==null?void 0:$.trust)||0)-P});case"APTITUDE_DESC":return m.sort((M,E)=>{var O,$;const P=((O=M.stats)==null?void 0:O.aptitude)||0;return((($=E.stats)==null?void 0:$.aptitude)||0)-P});default:return m}},[k,Ms,_s]),po=y.useMemo(()=>Math.max(1,Math.ceil(Xr.length/Il)),[Xr.length]);y.useEffect(()=>{As(0)},[Ms,_s]),y.useEffect(()=>{As(m=>Math.min(m,Math.max(0,po-1)))},[po]);const ed=y.useMemo(()=>{const m=Jr*Il;return Xr.slice(m,m+Il)},[Xr,Jr]),td=Xr.length>Il,nd=y.useMemo(()=>{if(!ce||tn.length===0)return null;const m=tn.findIndex(M=>M.id===ce.id);return m===-1?null:{hasPrev:m>0,hasNext:m<tn.length-1,prevName:m>0?tn[m-1].name:null,nextName:m<tn.length-1?tn[m+1].name:null,label:`${m+1}/${tn.length}`}},[tn,ce]),rd=y.useCallback(m=>{if(!ce)return;const M=tn.findIndex(E=>E.id===ce.id);M!==-1&&(m==="PREV"&&M>0?Oe(tn[M-1]):m==="NEXT"&&M<tn.length-1&&Oe(tn[M+1]))},[tn,ce,Oe]),Ba=y.useCallback((m,M={})=>{var O,$,H,Y,F;if(!m)return"";const E=[],P=m.gender===""?"":"",A=((O=m.stats)==null?void 0:O.aptitude)??"--";return E.push(`${P} ${A} ${m.tierTitle||""}`),($=m.sect)!=null&&$.name&&E.push(` ${m.sect.name}${m.rank?`  ${m.rank}`:""}`),(H=m.spouse)!=null&&H.name&&E.push(` ${m.spouse.name} `),(Y=m.trait)!=null&&Y.name&&E.push(`${m.trait.name}`),(F=m.influenceProfile)!=null&&F.label&&E.push(`${m.influenceProfile.label}`),typeof M.descendantCount=="number"&&M.descendantCount>0&&E.push(` ${M.descendantCount} `),`${E.join("")}`},[]),ci=y.useCallback((m,M=[])=>{var A,O;if(!Array.isArray(m)||m.length===0)return;const E=((A=c==null?void 0:c.time)==null?void 0:A.year)??0,P=((O=c==null?void 0:c.time)==null?void 0:O.month)??1;Ue($=>{const H=new Set($.map(F=>F.id)),Y=[];return m.forEach(F=>{var ae;if(!F||H.has(F.id))return;const oe=M.filter(te=>te.parentId===F.id).length,ie=F.deathReason||(typeof F.lifespan=="number"&&F.lifespan<=0?"":"");Y.push({id:F.id,name:F.name,gender:F.gender,avatar:F.avatar,tierTitle:F.tierTitle,generation:F.generation||1,ageAtDeath:Math.max(0,Math.floor(F.age||0)),deathYear:E,deathMonth:P,deathReason:ie,sect:F.sect?{...F.sect}:null,rank:F.rank||null,trait:F.trait||null,influenceLabel:((ae=F.influenceProfile)==null?void 0:ae.label)||null,descendants:oe,epitaph:Ba(F,{descendantCount:oe})})}),Y.length?[...Y,...$]:$}),m.forEach($=>{if(!$)return;const H=$.deathReason||(typeof $.lifespan=="number"&&$.lifespan<=0?"":"");Be(` ${$.name} ${H} ${Math.max(0,Math.floor($.age||0))} `)})},[(u0=c==null?void 0:c.time)==null?void 0:u0.year,(p0=c==null?void 0:c.time)==null?void 0:p0.month,Ba,Be]),[di,Ns]=y.useState(null),[sd,ui]=y.useState(!1),[pi,od]=y.useState({id:null,name:"",total:0}),[Oa,Pa]=y.useState(0),[id,Ls]=y.useState([]),[Tr,$s]=y.useState(null),[Bs,ad]=y.useState([]),Zr=y.useRef(null),{handleExplorationOption:ld,handleStartCombat:cd}=QC({player:c,inventory:l,children:Z,exploreRealmState:pi,exploreProgress:Oa,exploreTeamIds:Bs,setPlayer:f,setExploreLog:Ls,setCombatData:Ns,addNpc:(m,M)=>{var E;return(E=Zr.current)==null?void 0:E.call(Zr,m,M)},addItemsToInventory:d,inventoryMgr:a,calculateDynamicCombatStats:Cn,simulateCombat:qi,generateRealmEnemy:iE}),{handleCombatClose:za}=JC({player:c,children:Z,exploreRealmState:pi,applyCombatResult:g,addLog:Be,setCombatData:Ns,setExploreLog:Ls,batchUpdateChildren:xe,archiveChildDeaths:ci,addItemsToInventory:d,setIsExploring:ui}),Da=y.useCallback(()=>{za(di)},[za,di]),[Fa,dd]=y.useState(null),[fo,ud]=y.useState(!1),[fi,pd]=y.useState(!1),[mo,Ha]=y.useState(!1),[G,Fe]=y.useState(!1),[rn,gn]=y.useState(!1),[rr,Os]=y.useState(!1),[go,b1]=y.useState(!1),[Ct]=y.useState(()=>new e5),[v1,Ps]=y.useState([]),[mi,Wf]=y.useState({}),Wa=y.useCallback(()=>{const m=vi.current;m&&(m.type==="idle"&&typeof window<"u"&&typeof window.cancelIdleCallback=="function"?window.cancelIdleCallback(m.id):clearTimeout(m.id),vi.current=null,Va.current=null)},[]),Ua=y.useCallback((m,M)=>{try{const E=e1(m);E.success&&(Vf.current=M,console.log(` : ${E.gameTime}`),window.dispatchEvent(new CustomEvent("autoSaveCompleted",{detail:{gameTime:E.gameTime}})))}catch(E){console.error(":",E)}finally{Va.current=null}},[]),Uf=y.useCallback((m,M)=>{if(typeof window<"u"){if(typeof window.requestIdleCallback=="function"){window.requestIdleCallback(()=>Ua(m,M),{timeout:1e3});return}if(typeof window.requestAnimationFrame=="function"){window.requestAnimationFrame(()=>Ua(m,M));return}}setTimeout(()=>Ua(m,M),0)},[Ua]),Gf=y.useCallback((m,M)=>{Wa();const E=()=>{vi.current=null,Uf(m,M)};if(typeof window<"u"&&typeof window.requestIdleCallback=="function"){const P=window.requestIdleCallback(E,{timeout:1500});vi.current={type:"idle",id:P}}else{const P=setTimeout(E,kT);vi.current={type:"timeout",id:P}}Va.current=M},[Wa,Uf]);y.useEffect(()=>()=>{Wa()},[Wa]);const[zs,fd]=y.useState([]),[gi,hi]=y.useState([]),[S1,md]=y.useState(!1),[w1,gd]=y.useState([]),[Ga,hd]=y.useState(null),[k1,xi]=y.useState([]),[E1,yi]=y.useState([]),[j1,bi]=y.useState([]),vi=y.useRef(null),Vf=y.useRef(null),Va=y.useRef(null),Yf=y.useMemo(()=>{if(typeof navigator>"u")return!1;const m=navigator.userAgent||"";return/Android|Adr|OPPO|VIVO|MIUI|HONOR|HUAWEI/i.test(m)},[]);y.useEffect(()=>{Array.isArray(c==null?void 0:c.newsBuffer)&&(c.newsBuffer.length<=Ea||f(m=>({...m,newsBuffer:mu(m.newsBuffer)})))},[c==null?void 0:c.newsBuffer,f]),y.useEffect(()=>{var P;const m=!c.specialCollections||!Array.isArray(c.specialCollections.fumoSwords),M=!c.specialFlags||typeof c.specialFlags.fumoDuoUnlocked>"u"||typeof c.specialFlags.fumoDuoMet>"u";if(m||M){f(A=>{var H,Y,F;const O=!A.specialCollections||!Array.isArray(A.specialCollections.fumoSwords),$=!A.specialFlags||typeof A.specialFlags.fumoDuoUnlocked>"u"||typeof A.specialFlags.fumoDuoMet>"u";return!O&&!$?A:{...A,specialCollections:O?{...A.specialCollections||{},fumoSwords:[...((H=A.specialCollections)==null?void 0:H.fumoSwords)||[]]}:A.specialCollections,specialFlags:$?{...A.specialFlags||{},fumoDuoUnlocked:((Y=A.specialFlags)==null?void 0:Y.fumoDuoUnlocked)||!1,fumoDuoMet:((F=A.specialFlags)==null?void 0:F.fumoDuoMet)||!1}:A.specialFlags}});return}if(c&&!c.familyRating&&f(A=>A.familyRating?A:{...A,familyRating:{currentId:oo[0].id,history:[]}}),c&&!c.combatStats){console.log("...");const A=c.stats||{aptitude:50,luck:50,lifespan:100},O=((P=c.spiritRoot)==null?void 0:P.type)||"",$=ei(c.tier||"",A.aptitude,O);f(H=>({...H,stats:H.stats||A,spiritRoot:H.spiritRoot||{type:"",elements:["","","","",""],color:"#9E9E9E",multiplier:.5},combatStats:$}))}if(c&&!sh(c.avatar)&&f(A=>sh(A.avatar)?A:{...A,avatar:{...wT,...A.gender?{gender:A.gender}:{}}}),k.some(A=>!A.relationship||A.currentExp===void 0)&&(console.log(" NPC ..."),Me(A=>{const O={...A};if(O.relationship||(O.relationship={stage:0,affection:0,trust:0,jealousy:0}),O.currentExp===void 0){const $=O.tier||"",H=An($);O.tier=$,O.currentExp=Math.floor(Math.random()*H.maxExp*.3),O.maxExp=H.maxExp}return O})),k.some(A=>{var $;if(!A)return!1;const O=wc(A);return!(($=A.stats)!=null&&$.lifespan)||A.stats.lifespan<O})&&Me(A=>{if(!A)return A;const O=A.stats||{},$=wc(A);return O.lifespan&&O.lifespan>=$?A:{...A,stats:{...O,lifespan:$}}}),k.some(A=>!A.memories)){console.log(" NPC ...");const A=k.map(O=>{ls.initializeAllNpcs([O]);const $=Z.filter(H=>H.fatherName===O.name||H.motherName===O.name);return $.length>0&&ls.backfillChildrenMemories(O,$),O});Pe(A)}Z.some(A=>!A.equipment)&&xe(A=>Rr(A)),Z.some(A=>A.spiritRoot&&!A.spiritRoot.elements)&&(console.log("..."),xe(A=>A.spiritRoot&&!A.spiritRoot.elements?{...A,spiritRoot:{type:"",elements:["","","","",""],desc:"",color:"#9E9E9E",multiplier:.5}}:A))},[c,k,Z]),y.useEffect(()=>{if(!Array.isArray(c.worldNpcs)||c.worldNpcs.length===0){console.log("...");const m=aT(30);f(M=>({...M,worldNpcs:m}))}},[c.worldNpcs]),y.useEffect(()=>{const m=localStorage.getItem("has_read_tutorial_v2");en==="MAIN"&&!m&&setTimeout(()=>{e.openTutorial()},1e3)},[en,e]);const C1=()=>{var m;e.closeTutorial(),localStorage.setItem("has_read_tutorial_v2","true"),y.useEffect(()=>{var M;((M=c==null?void 0:c.childrenStrategy)==null?void 0:M.skipZhaozhou)!==void 0&&Fe(!!c.childrenStrategy.skipZhaozhou)},[(m=c==null?void 0:c.childrenStrategy)==null?void 0:m.skipZhaozhou])};y.useEffect(()=>{if(!fo)return;const m=Z.filter(E=>Math.floor(E.age*12)>=144&&E.isTested&&!E.sect);if(m.length===0)return;let M=0;xe(E=>{if(!m.some(O=>O.id===E.id))return E;const A=wd(E);return A?(M++,{...E,sect:A,rank:sa(E,A)}):E}),M>0&&ee("",` ${M} `,!0)},[Z,fo]);const T1=()=>{localStorage.setItem("has_read_tutorial_v2","true")},I1=()=>{e.closeGuide()},qf=(f0=t.data)==null?void 0:f0.autoClose,[CT,TT]=y.useState(null),[IT,RT]=y.useState({}),[xd,Si]=y.useState(null);y.useEffect(()=>{if(!xd)return;const m=setTimeout(()=>Si(null),3200);return()=>clearTimeout(m)},[xd]);const[ho,wi]=y.useState([]),[Ya,yd]=y.useState([]),[Ds,bd]=y.useState({open:!1,item:null}),R1=y.useCallback(({messageId:m,targetNpcId:M,relation:E,content:P,tone:A})=>{var Y;const O=(P||"").trim();if(!O)return{success:!1,error:""};const $={year:c.time.year,month:c.time.month},H=Ct.addReplyToMessage(m,{content:O,tone:A==null?void 0:A.id,toneLabel:A==null?void 0:A.label,sentiment:A==null?void 0:A.desc,timestamp:$,from:c.name,affectionDelta:(A==null?void 0:A.affectionDelta)||0});if(!H)return{success:!1,error:""};if(Ps(Ct.getAllMessages()),Be(`${H.message.senderName}`,""),A!=null&&A.affectionDelta&&E!=="child"){const F=k.find(oe=>oe.id===M);if(F){const oe=((Y=F.relationship)==null?void 0:Y.affection)||0,ie=Math.max(0,Math.min(100,oe+A.affectionDelta));Q(M,{relationship:{...F.relationship||{},affection:ie}})}}return{success:!0}},[Ct,c.time.year,c.time.month,c.name,Be]),qa=y.useMemo(()=>{var m;return nw((m=c==null?void 0:c.familyRating)==null?void 0:m.currentId)},[(m0=c==null?void 0:c.familyRating)==null?void 0:m0.currentId]),_1=y.useMemo(()=>{let m=0;return Z.forEach(M=>{m+=bc(M,{familyRatingMultiplier:qa})}),m},[Z,qa]),ki=y.useMemo(()=>dw(Z,c),[Z,c]),M1=y.useCallback(()=>i({type:null,data:null}),[i]),ee=y.useCallback((m,M,E=!0,P=null,A=!0,O=null)=>{const $=O||{},H=$.forceManual?!1:A;if(i({type:"RESULT",data:{title:m,msg:M,success:E,changes:P,autoClose:H}}),$.skipLog)return;const Y=typeof M=="string"?M:"",F=m||"",oe=Y.length>20,ie=$.message||(oe?`${F}`:Y||F),ae=$.details!==void 0?$.details:oe?Y:null,te=$.title??F,ue=$.category||"",X=$.type??null;Be(ie,ue,X,te,ae)},[Be]),Ei=y.useCallback((m,M,E=null)=>{i({type:"CONFIRM",data:{message:m,onConfirm:M,input:(E==null?void 0:E.input)||null}})},[]),vd=y.useRef(0);y.useEffect(()=>{vd.current=0},[L.length]);const gr=y.useCallback(()=>L.length+vd.current,[L.length]),Kf=y.useCallback(m=>{const M=m?`${m}

`:"";ee("",`${M}${ROMANCE_LIMIT_MESSAGE}`,!1),Be("","")},[ee,Be]),ji=y.useCallback(m=>{const M=nh(m);return gr()>=os?(M.silent||Kf(M.contextMessage),!1):!0},[gr,Kf]),Ir=y.useCallback((m,M)=>{if(!m)return!1;const E=nh(M);return ji(E)?(vd.current+=1,se(m),!0):!1},[se,ji]);y.useEffect(()=>{Zr.current=(m,M)=>Ir(m,M||"")},[Ir]);const Qf=y.useCallback(()=>Math.max(0,os-gr()),[gr]),A1={"XMZM-TEST-2026":{spiritStones:1e5},"XMZM-SKILL-5000-2026":{skillPoints:5e3},"XMZM-SPECIAL-MANUAL-2026":{items:["yin_yang_harmony_manual","blood_demon_manual","chaos_origin_manual","five_elements_supreme_manual","emperor_scripture_manual","deep_ocean_scripture_manual"]},"XMZM-POWER-1324845222862419919-2026":{combatPower:132484522286242e4}},Jf=y.useCallback(()=>new Set((c==null?void 0:c.usedRedeemCodes)||[]),[c==null?void 0:c.usedRedeemCodes]),Xf=y.useCallback(m=>{f(M=>({...M,usedRedeemCodes:[...m]}))},[f]),N1=y.useCallback(m=>{const M=(m||"").trim();if(!M)return{success:!1,message:""};const E=A1[M];if(!E)return{success:!1,message:""};const P=Jf();if(P.has(M))return{success:!1,message:""};if(P.add(M),Xf(P),E.spiritStones&&C({spiritStones:E.spiritStones}),E.skillPoints&&f(H=>({...H,skillPoints:(H.skillPoints||0)+E.skillPoints})),E.items&&E.items.length&&d(E.items),E.combatPower){const H=E.combatPower;f(Y=>{var ie,ae,te;const F=zn(Y).total,oe=H-F;if(oe>0){const ue=Math.ceil(oe/45),X={...Y.combatStats,atk:(((ie=Y.combatStats)==null?void 0:ie.atk)||0)+ue,maxHp:(((ae=Y.combatStats)==null?void 0:ae.maxHp)||0)+Math.ceil(oe/2),hp:(((te=Y.combatStats)==null?void 0:te.hp)||0)+Math.ceil(oe/2)};return{...Y,combatStats:X}}return Y})}const A=[];if(E.spiritStones&&A.push(` ${E.spiritStones} `),E.skillPoints&&A.push(` ${E.skillPoints} `),E.combatPower&&A.push(`  ${E.combatPower}`),E.items&&E.items.length){const H=E.items.reduce((Y,F)=>(Y[F]=(Y[F]||0)+1,Y),{});Object.entries(H).forEach(([Y,F])=>{var ie;const oe=((ie=fs(Y))==null?void 0:ie.name)||Y;A.push(` ${oe} ${F}`)})}const O=`
${A.join(`
`)}`,$={...E.spiritStones?{:E.spiritStones}:{},...E.skillPoints?{:E.skillPoints}:{},...E.combatPower?{:E.combatPower}:{},...E.items&&E.items.length?E.items.reduce((H,Y)=>{var oe;const F=((oe=fs(Y))==null?void 0:oe.name)||Y;return H[F]=(H[F]||0)+1,H},{}):{}};return ee("",O,!0,$),{success:!0,message:""}},[Jf,Xf,C,d,f,ee]),L1=y.useCallback(async()=>{var M,E;let m=!1;if(typeof window<"u"&&((E=(M=window.screen)==null?void 0:M.orientation)!=null&&E.lock))try{await window.screen.orientation.lock("portrait"),m=!0}catch(P){console.warn(":",P)}Qr(!0),!m&&typeof window<"u"&&setTimeout(()=>window.dispatchEvent(new Event("resize")),80),ee("",m?"":"",!0)},[ee]),$1=y.useCallback(()=>{var m,M;if(typeof window<"u"&&((M=(m=window.screen)==null?void 0:m.orientation)!=null&&M.unlock))try{window.screen.orientation.unlock()}catch(E){console.warn(":",E)}Qr(!1),ee("","",!0)},[ee]),B1=y.useCallback(()=>{if(!ki.nextTier){ee("","",!0);return}if(!ki.canUpgrade){ee("","",!1);return}const m=ki.nextTier;f(E=>{var P;return{...E,familyRating:{currentId:m.id,history:[...((P=E.familyRating)==null?void 0:P.history)||[],{id:m.id,name:m.name,year:E.time.year,month:E.time.month}]}}});const M=`${m.name}`;Be(` ${M}`,""),ee("",`${M}

${m.desc}`,!0)},[ki,f,Be,ee]);y.useEffect(()=>{window.showResult=ee,window.showConfirm=Ei},[ee,Ei]),y.useEffect(()=>{if(!c.currentAuction||!c.auctionWindowStart||!c.auctionWindowEnd)return;rh(c.time.year,c.time.month)>=c.auctionWindowEnd&&x({currentAuction:null,auctionWindowStart:null,auctionWindowEnd:null})},[c.currentAuction,c.auctionWindowStart,c.auctionWindowEnd,c.time.year,c.time.month,x]);const O1=(m,M)=>{if(!m)return{success:!1,title:"",message:""};const E=Math.max(0,M||m.basePrice||0);if((c.resources.spiritStones||0)<E)return{success:!1,title:"",message:""};if(m.type==="SLAVE"&&!ji({contextMessage:"",silent:!0}))return{success:!1,title:"",message:ROMANCE_LIMIT_MESSAGE};w({spiritStones:E});let A="";if(m.type==="SLAVE"){const $=wp(c.tier);$.name=m.name,$.identity="",$.relationship=$.relationship||{},$.relationship.owner=c.name,$.relationship.affection=-20,$.relationship.trust=0,$.relationship.stage=0;const H=D1(m,$);if($.slavePlot=H,!Ir($,{contextMessage:`${m.name}`,silent:!0}))return C({spiritStones:E}),{success:!1,title:"",message:ROMANCE_LIMIT_MESSAGE};A=` ${E}  ${m.name}Ta 

${H.intro}`,Be(" "+E+"  "+m.name)}else if(m.type==="ITEM"&&m.itemId){const $=or(m.itemId);if(!$)return{success:!1,title:"",message:""};m.description&&($.desc=m.description),d([$]),A=` ${E}  ${m.name}`,Be(` ${E}  ${m.name}`)}else if(m.type==="FUMO_SWORD"){const $=eh(m.swordId)||{id:m.swordId,name:m.name},H=uT($)||{instanceId:`fumo_${m.swordId||Date.now()}`,name:m.name,type:"weapon",rarity:"legendary",desc:m.description||m.plot||""};d([H]);const F=$.id&&mr.includes($.id)?mr.length:mr.length+1,oe=Math.max(0,Su-F),ie=$.blessing||"",ae=oe===0?"":` ${oe} `;A=` ${E}  ${m.name}
${ie}

${ae}`,Be(` ${m.name}`,""),W1($.id||m.swordId)}else{const $={instanceId:"auction_"+Date.now()+"_"+Math.floor(Math.random()*1e4),name:m.name,type:"consumable",rarity:m.rarity||"rare",desc:m.description||m.plot||"",effect:{kind:"exp",amount:3e3}};d([$]),A=` ${E}  ${m.name}`,Be(` ${E}  ${m.name}`)}const O=[];return m!=null&&m.id&&O.push(`INSTANCE:${m.id}`),(m==null?void 0:m.type)==="ITEM"&&m.itemId&&O.push(`ITEM:${m.itemId}`),(m==null?void 0:m.type)==="FUMO_SWORD"&&m.swordId&&O.push(`FUMO:${m.swordId}`),(m==null?void 0:m.type)==="SLAVE"&&m.id&&O.push(`SLAVE:${m.id}`),O.length===0&&(m!=null&&m.itemId||m!=null&&m.swordId||m!=null&&m.id)&&O.push(m.itemId||m.swordId||m.id),x({soldAuctionItems:[...c.soldAuctionItems||[],...O]}),{success:!0,title:"",message:A}},P1=m=>m.plot||m.description,z1=()=>{const m=rh(c.time.year,c.time.month),E=c.auctionWindowStart&&c.auctionWindowEnd&&m>=c.auctionWindowStart&&m<c.auctionWindowEnd;if(c.currentAuction){if(!E){x({currentAuction:null,auctionWindowStart:null,auctionWindowEnd:null}),Si(null),ee("","",!1);return}Si(null),i({type:"AUCTION",data:c.currentAuction});return}if(m%36!==0){ee("","",!1);return}const P=th(c.time.year,{ownedFumoSwords:mr,soldAuctionItems:c.soldAuctionItems||[]});x({currentAuction:P,lastAuctionYear:c.time.year,auctionWindowStart:m,auctionWindowEnd:m+12}),Si(null),i({type:"AUCTION",data:P})},D1=(m,M)=>{const E=[{intro:`${M.name}Ta`,trauma:"",hope:""},{intro:`${M.name}Ta`,trauma:"",hope:""},{intro:`${M.name}Ta`,trauma:"",hope:""},{intro:`${M.name}Ta`,trauma:"",hope:""}];return{...E[Math.floor(Math.random()*E.length)],unlockStage:2}},Rr=m=>{const M=m.equipment||{weapon:null,armor:null,accessory:null};return{...m,equipment:M}},bt=m=>{const M=Rr(m);return{...M,combatStats:Cn(M)}},F1={:30,:30,:30,:30,:50,:50,:50,:50,:200,:200,:200,:200,:300,:300,:300,:300,:500,:500,:500,:500},H1=(m=0)=>{for(let M=0;M<Qe.length;M++)if(m<Qe[M].maxExp)return Qe[M];return Qe[Qe.length-1]},sn=(m,M=0)=>{var oe;const E=(m.cultivation||0)+M,P=m.tierTitle,A=H1(E),O=Qe.findIndex(ie=>ie.name===A.name),$=O>0?Qe[O-1].maxExp:0;let H={...m,cultivation:E,tierTitle:A.name,currentExp:E-$,maxExp:A.maxExp-$},Y=0;const F=!!P&&P!==A.name;return F&&(Y=F1[A.name]||50,H={...H,stats:{...H.stats,lifespan:(((oe=H.stats)==null?void 0:oe.lifespan)??100)+Y}}),{updated:H,tierChanged:F,lifespanIncrease:Y,newTier:A.name,prevTier:P}},W1=y.useCallback(m=>{var $,H;if(!m)return;const M=Array.isArray(($=c.specialCollections)==null?void 0:$.fumoSwords)?c.specialCollections.fumoSwords:[];if(M.includes(m))return;b("fumoSwords",m);const E=[...M,m];Tp(E).length===0&&Su>0&&!((H=c.specialFlags)!=null&&H.fumoDuoUnlocked)&&x({specialFlags:{...c.specialFlags||{},fumoDuoUnlocked:!0}});const O=eh(m);O&&Be(` ${O.name} `,"")},[c.specialCollections,c.specialFlags,b,x,Be]),Zf=m=>{if(!m)return 0;const E={common:10,uncommon:50,rare:200,epic:800,legendary:3e3,mythic:8e3}[m.rarity]||10,P=m.type==="weapon"||m.type==="armor"||m.type==="accessory"?2:1;return Math.max(1,Math.floor(E*P))},U1=(m,M)=>{const E=l.find(F=>F.instanceId===m);if(!E){ee("","",!1);return}const P=typeof M=="number"?Math.min(M,E.quantity||1):E.quantity||1,A=u(m,P);if(!A){ee("","",!1);return}const O=Zf(E),H=Math.floor(O*.7*(A.quantity||1)),Y=A.quantity&&A.quantity>1?" x"+A.quantity:"";C({spiritStones:H}),ee(""," "+H+"  "+A.name+Y+"",!0,{:H}),Be(""+A.name+Y+" "+H+" ")},G1=m=>{if(!l.find(P=>P.instanceId===m)){ee("","",!1);return}const E=u(m);if(!E){ee("","",!1);return}ee("",` ${E.name}${E.quantity&&E.quantity>1?` x${E.quantity}`:""}`,!0),Be(`${E.name}${E.quantity&&E.quantity>1?` x${E.quantity}`:""}`)},e0=(m,M)=>{var P;const E=k.find(A=>A.id===m);if(M==="TOGGLE_FOLLOW"){ye(m);return}if(M==="GIFT"){i({type:"GIFT",data:E});return}if(M==="PROPOSE"){const A=au(E,"PERSUADE");if(!A.allowed){ee("",A.reason,!1,null,!1,{category:"",type:"PERSUADE",title:"",message:"",details:A.reason,forceManual:!0});return}i({type:"NEGOTIATE",data:E});return}if(M==="SPAR"){const A=au(E,"SPAR");if(!A.allowed){ee("",A.reason,!1,null,!1,{category:"",type:"SPAR",title:"",message:"",details:A.reason,forceManual:!0});return}if((c.energy||0)<=0){ee("","",!1,null,!1,{category:"",type:"SPAR",title:"",message:"",details:"",forceManual:!0});return}S(1);const O={...c,combatStats:c.combatStats||{maxHp:100,maxMp:50,atk:10,def:5,hp:100,mp:50}},$={...E,combatStats:E.combatStats||{maxHp:100,maxMp:50,atk:10,def:5,hp:100,mp:50}},Y=qi(O,$).winner==="player";let F=0;const oe=E.identity==="",ie=E.identity==="",ae=E.identity==="";oe||ie||ae||Math.random()<.3&&(F=Y?2:3);const ue=k.find(Le=>Le.id===m);if(ue){const Le=ue.relationship||{},ot=Le.affection||0;let it={...ue,relationship:{...Le,affection:Math.min(100,ot+F)}};it=vk(it,c,Math.floor(c.age),c.time.month,!Y),it=Vi(it),Q(m,it)}f(Le=>{const ot={...Le,currentExp:(Le.currentExp||0)+(Y?3:5)};return{...ot,combatStats:Cn(ot)}});const X=uu(E,c),Ce=(X==null?void 0:X.title)||(Y?"":""),ge=(X==null?void 0:X.description)||(Y?` ${E.name}${E.gender===""?"":""}`:` ${E.name}`);ee(Ce,ge,!0,{:F,:Y?3:5},!1,{category:"",type:"SPAR",title:Ce,message:`${Ce}`,details:ge,forceManual:!0}),Ka(E,"SPAR");return}if(M==="DUAL_CULTIVATION"){const A=au(E,"DUAL_CULTIVATION");if(!A.allowed){ee("",A.reason,!1,null,!1,{category:"",type:"DUAL_CULTIVATION",title:"",message:"",details:A.reason,forceManual:!0});return}if((c.energy||0)<=0){ee("","",!1,null,!1,{category:"",type:"DUAL_CULTIVATION",title:"",message:"",details:"",forceManual:!0});return}const O=A.requiresCheck;if(O&&!(Math.random()<A.checkRate)){ee("",`${E.name}"..."${E.gender===""?"":""}`,!1,null,!1,{category:"",type:"DUAL_CULTIVATION",title:"",message:"",details:`${E.name}${E.gender===""?"":""}`,forceManual:!0});return}const $=50;if(c.resources.spiritStones<$){ee("",` ${$} : ${c.resources.spiritStones}`,!1,null,!1,{category:"",type:"DUAL_CULTIVATION",title:"",message:"",details:` ${$}  ${c.resources.spiritStones??0}`,forceManual:!0});return}const H=((P=E.relationship)==null?void 0:P.affection)||0;let Y=20,F=1;H>=80?(F=2,Y=30):H>=60?(F=1.5,Y=25):H>=40&&(F=1.2,Y=22);const oe=Math.floor(Y*F);f(X=>{const Ce={...X,resources:{...X.resources,spiritStones:Math.max(0,X.resources.spiritStones-$)},currentExp:(X.currentExp||0)+Y,energy:Math.max(0,(X.energy||0)-1)};return{...Ce,combatStats:Cn(Ce)}});const ie=k.find(X=>X.id===m);if(ie){const X=ie.relationship||{},Ce=X.affection||0;let ge={...ie,currentExp:(ie.currentExp||0)+oe,relationship:{...X,affection:Math.min(100,Ce+5)},dualCultivationCount:(ie.dualCultivationCount||0)+1};ge=Sk(ge,c,Math.floor(c.age),c.time.month),ge=Vi(ge),Q(m,ge)}let ae;O?ae=`${E.name}${E.gender===""?"":""}

${E.gender===""?"":""}

""${E.gender===""?"":""}""`:ae=` ${E.name} ${H>=80?"":H>=60?"":""}`;const te=O?"":"",ue=O?"BUDDHA_FIRST_DUAL":"DUAL_CULTIVATION";ee(te,ae,!0,{:5,:Y,[`${E.name}`]:oe,:-$,:-1},!1,{category:"",type:ue,title:te,message:`${te}`,details:ae,forceManual:!0}),H>=70&&Math.random()<.3&&Wt(c.newsBuffer,"DUAL_CULTIVATION",{actor:c.name,target:E.name}),Ka(E,"DUAL_CULTIVATION");return}if(M==="CHAT"){if((c.energy||0)<=0){ee("","",!1,null,!1,{category:"",type:"CHAT",title:"",message:"",details:"",forceManual:!0});return}S(1);const A=E.identity==="",O=E.identity==="",$=E.identity==="",H=A||O||$,F=(H?Math.random()<.05:!0)?uu(E,c):null;if(F){const X=E.relationship||{},Ce=X.affection||0;Q(m,{relationship:{...X,affection:Math.min(100,Ce+(F.affectionBonus||2))}});const ge=(F==null?void 0:F.title)||"",Le=(F==null?void 0:F.text)||"";ee(ge,Le,!0,{:(F==null?void 0:F.affectionBonus)||2},!1,{category:"",type:"CHAT_EVENT",title:ge,message:`${ge}`,details:Le,forceManual:!0});return}const oe=H?.05:.15;if(Math.random()<oe){const X=ME(E);if(X){i({type:"EVENT",data:{npc:E,event:X}});return}}const ie=Rj(E),te=E.identity===""||A||O||$;if(te){let X=fg(E,c,Math.floor(c.age),c.time.month);X=Vi(X),Q(m,X)}else{const X=E.relationship||{},Ce=X.affection||0;let ge={...E,relationship:{...X,affection:Ce+2}};ge=fg(ge,c,Math.floor(c.age),c.time.month),ge=Vi(ge),Q(m,ge)}const ue=` ${E.name} ${E.gender===""?"":""}
"${ie}"`;ee("",ue,!0,te?{}:{:2},!1,{category:"",type:"CHAT",title:`${E.name}`,message:`${E.name}`,details:ue,forceManual:!0}),Ka(E,"CHAT")}M==="DETAIL"&&z(E)},Ka=(m,M)=>{const E=Kj(c,m,k,M);if(E.length>0){const P=new Set(E.map(H=>H.id)),A=[],O={CHAT:"",GIFT:"",SPAR:"",DUAL_CULTIVATION:""};if(B(H=>H.map(Y=>{var ue,X;if(!P.has(Y.id))return Y;const F=qj(Y,m,M);if(F===0)return Y;const oe=((ue=Y.relationship)==null?void 0:ue.jealousy)||0,ie=Math.min(100,oe+F),ae=new Set([...((X=Y.relationship)==null?void 0:X.rivalNpcs)||[],m.id]);let te={...Y,relationship:{...Y.relationship||{},jealousy:ie,rivalNpcs:Array.from(ae),lastInteraction:c.time.month}};return A.push({witnessName:Y.name,targetName:m.name,increase:F,newJealousy:ie,level:Yj(ie).label,actionLabel:O[M]||""}),te=mg(te,c,c.time.year,c.time.month,m,ie),ie>=41&&Math.random()<.3&&(te=wk(te,c,c.time.year,c.time.month)),ie>=60&&Math.random()<.25&&Wt(c.newsBuffer,"NPC_JEALOUSY",{actor:Y.name,target:c.name,rival:m.name}),te})),A.length>0){const H=A.map(Y=>`${Y.level}${Y.witnessName}${Y.targetName}${Y.actionLabel} +${Y.increase}  ${Y.newJealousy}`).join(`

`);Be(`${A[0].witnessName} ${A[0].newJealousy}`,"","JEALOUSY","",H),go||yd(Y=>[...Y,{id:`${c.time.year}-${c.time.month}-${Date.now()}`,alerts:A,summary:H,actionLabel:O[M]||"",timestamp:{year:c.time.year,month:c.time.month},targetName:m.name}])}E.find(H=>{var F;return(((F=H.relationship)==null?void 0:F.jealousy)||0)>=60})&&Be("...")}},{handleGiftConfirm:V1,handleNegotiateConfirm:Y1,handleOptionSelect:t0,handleShuraFieldSelect:q1}=XC({player:c,inventory:l,activeNpcs:k,modalState:t,setModalState:i,removeItemFromInventory:u,updateNpc:Q,setActiveNpcs:B,batchUpdateNpcsByMap:Ke,setSelectedNpc:z,showResult:ee,addLog:Be,handleWitnessCheck:Ka,pushToNewsBuffer:Wt,isUsageAllowedForTarget:Ws,RESOURCE_USAGE:ht,formatUsageTargets:ko}),K1=m=>{if(m==="CULTIVATE"){if((c.energy||0)<=0){ee("","",!1);return}const M=10+Math.floor(Math.random()*5);f(E=>{const P={...E,currentExp:E.currentExp+M,energy:Math.max(0,(E.energy||0)-1)};return{...P,combatStats:Cn(P)}}),ee("","",!0,{:M})}if(m==="WORK"){if((c.energy||0)<=0){ee("","",!1);return}const M=15;C({spiritStones:M}),S(1),ee("","",!0,{:M})}},Q1=()=>{if(c.resources.spiritStones<10){ee("",` 10 : ${c.resources.spiritStones}`,!1);return}w({spiritStones:10});const M=3+Math.floor(Math.random()*3),E=[],P={common:[{id:"herb_bandage",basePrice:15},{id:"rice_ball",basePrice:10}],uncommon:[{id:"beast_fang",basePrice:80},{id:"beast_core",basePrice:120},{id:"iron_sword",basePrice:100}],rare:[{id:"foundation_pill",basePrice:350},{id:"thunder_wood",basePrice:400},{id:"iron_armor",basePrice:450}],epic:[{id:"core_pill",basePrice:800},{id:"artifact_supreme",basePrice:1200},{id:"marrow_wash",basePrice:900}],legendary:[{id:"nascent_fruit",basePrice:2500},{id:"heaven_manual",basePrice:3e3}]},A=X2(c.tier);let O={common:60,uncommon:25,rare:10,epic:4,legendary:1};A>=6&&A<20?O={common:50,uncommon:27,rare:14,epic:7,legendary:2}:A>=20&&(O={common:45,uncommon:25,rare:18,epic:9,legendary:3});for(let $=0;$<M;$++){const H=X1(O),Y=P[H];if(Y&&Y.length>0){const F=Y[Math.floor(Math.random()*Y.length)],oe=or(F.id);if(oe){const ie=.8+Math.random()*.4;oe.price=Math.floor(F.basePrice*ie),E.push(oe)}}}i({type:"SHOP",data:{items:E}})},J1=y.useCallback((m,M=1,E)=>{var H;if(!m)return;const P=Math.max(1,parseInt(M,10)||1),A=typeof E=="number"?E:(m.price||0)*P;if((((H=c==null?void 0:c.resources)==null?void 0:H.spiritStones)||0)<A)return;const $=[];if(m.stackable)$.push({...m,quantity:P,instanceId:`${m.id}_${Date.now()}_${Math.floor(Math.random()*1e4)}`});else for(let Y=0;Y<P;Y++){const F=or(m.id);F&&$.push(F)}$.length!==0&&(w({spiritStones:A}),d($))},[(g0=c==null?void 0:c.resources)==null?void 0:g0.spiritStones,w,d]),X1=m=>{const M=Object.values(m).reduce((P,A)=>P+A,0);let E=Math.random()*M;for(const[P,A]of Object.entries(m)){if(E<A)return P;E-=A}return"common"},Z1=y.useCallback(()=>{const m=wu.map(pT).filter(Boolean);if(m.length===0)return;const M=new Set(k.map(A=>A.id)),E=m.filter(A=>!M.has(A.id)).map(A=>pg(A,c,c.time.year,c.time.month));if(E.length>0){if(Qf()<E.length){ji({contextMessage:""});return}E.forEach(O=>Ir(O,""))}f(A=>{const O=new Set((A.worldNpcs||[]).map(H=>H.id)),$=wu.map(H=>fT(H,c.time.year)).filter(H=>H&&!O.has(H.id));return{...A,specialFlags:{...A.specialFlags||{},fumoDuoUnlocked:!0,fumoDuoMet:!0},worldNpcs:[...A.worldNpcs||[],...$]}}),wu.forEach(A=>{var O;Be(` ${((O=A.world)==null?void 0:O.rankHint)||""}${A.name}`,"")});const P="";ee("",P,!0,null,!1,{category:"",type:"FUMO_LEGEND",title:"",message:P})},[Be,c,c.time.year,c.time.month,f,ee,Qf,ji,Ir]),eb=y.useCallback(m=>{if(k.some(P=>P.id===m.id)){Be(`${m.name}`,"");return}const E=n0(m);Ir(E,`${m.name} `)&&(v(m.id,{hasMetPlayer:!0}),Be(` ${m.name}`,""))},[k,Be,Ir,v]),tb=y.useCallback(m=>{var F;if(!m)return;if(m.status==="DEAD"){ee("","",!1);return}if(c.tier===""){ee("","",!1);return}const M=((F=m.sect)==null?void 0:F.name)||"",E={...c,combatStats:c.combatStats||{maxHp:100,maxMp:50,atk:10,def:5,hp:100,mp:50}},P=m.combatStats?m:{...m,combatStats:Cn(m)},A=zn(E).total,O=zn(P).total,{prob:$}=My(E,P),H=Math.max(1,Math.min(99,Math.round($*100))),Y=`${M}${m.name}

${A}
${O}
${H}%

`;Ei(Y,()=>{const oe=qi(E,P);Ns({enemy:P,result:oe,context:"sectLeader",worldNpc:P,onVictory:()=>{Be(` ${M}${m.name}`,"");const ie=`${M}${m.name}

`;Ei(ie,()=>{var te;const ae=((te=c.time)==null?void 0:te.year)??c.age??0;v(m.id,{status:"DEAD",deathYear:ae,deathReason:""}),ne(ue=>ue&&ue.id===m.id?{...ue,status:"DEAD",deathYear:ae,deathReason:""}:ue),ee("",`${M}${m.name}`,!0,null,!1,{category:"",title:"",message:`${M}${m.name}`})})},onDefeat:()=>{_(),ee("",`${M}${m.name}`,!1,null,!1,{category:"",title:"",message:`${M}${m.name}`})}})})},[Be,c,Ei,ee,v,ne,_,Cn,Ns]),n0=m=>{var E;return{id:m.id,name:m.name,gender:m.gender,identity:m.title||"",appearance:((E=m.appearance)==null?void 0:E.description)||"",desc:m.signature||"",tier:m.tier,currentExp:m.currentExp||0,maxExp:m.maxExp||500,stats:m.stats||{aptitude:85,looks:80,intelligence:85,health:90},spiritRoot:m.spiritRoot||{type:"",elements:[""],multiplier:1.8},relationship:{stage:0,affection:0,trust:0,jealousy:0},trait:{name:"",bonuses:{speedMultiplier:1.2}},sect:m.sect,sectId:m.sectId,sectRank:m.sectRank,sectStatus:m.sectStatus||"active",combatStats:m.combatStats||{hp:1e3,maxHp:1e3,atk:100,def:50,mp:500,maxMp:500},isTested:!0,isWorldElite:!0,isFollowed:!1,age:m.age||100,personality:m.personality,acceptsLetters:!0,isPregnant:!1,cultivationMethod:"basic_breath",constitution:m.constitution,avatar:m.avatar||{base:Math.floor(Math.random()*3),skinColor:Math.floor(Math.random()*5),eye:Math.floor(Math.random()*3),eyeColor:Math.floor(Math.random()*5),mouth:Math.floor(Math.random()*3),hair:Math.floor(Math.random()*3),hairColor:Math.floor(Math.random()*5)}}},nb=()=>{var P;if(c.resources.spiritStones<5){ee("",` 5 : ${c.resources.spiritStones}`,!1);return}if(gr()>=os){ee("",`

(: ${gr()}/${os})`,!1,null,!1,{skipLog:!0});return}if(w({spiritStones:5}),uo){Z1();return}const E=(c.worldNpcs||[]).filter(A=>A.status==="ALIVE"&&A.gender!==c.gender&&!A.hasMetPlayer);if(Math.random()<.05&&E.length>0){const A=E[Math.floor(Math.random()*E.length)],O=n0(A);if(!k.find(Y=>Y.id===O.id)&&!Ir(O,` ${A.name}

${A.gender===""?"":""}`))return;v(A.id,{hasMetPlayer:!0,firstMetYear:c.age});const H=`${A.gender===""?"":""}

${A.title} ${A.name}${A.gender===""?"":""}${A.tier}${A.gender===""?"":""}${((P=A.appearance)==null?void 0:P.description)||""}

${A.gender===""?"":""}...

 ${A.name}`;ee(` ${A.name}`,H,!0,null,!1),Be(` ${A.title} ${A.name}`,"");return}if(Math.random()<.4){const A=wp(c.tier);let O="";if(A.identity===""?O=`${A.identity}${A.appearance}`:A.identity===""?O=`${A.identity}${A.appearance}`:A.identity===""?O=`${A.identity}${A.appearance}`:O=`${A.identity}${A.appearance}${A.desc.includes("")?"":""}`,!Ir(A,O))return;ee(`${A.name}`,O,!0,null,!1)}else ee("","",!1,{:-5})},rb=y.useCallback((m,M)=>{var P;Q(m,{acceptsLetters:M}),z(A=>A&&A.id===m?{...A,acceptsLetters:M}:A);const E=((P=k.find(A=>A.id===m))==null?void 0:P.name)||"";Be(M?`  ${E} `:`  ${E} `,"")},[k,Be,Q]),sb=()=>{Be("..."),Me(m=>m.id===1||m.id===2?pg(m,c,c.time.year,c.time.month):m),qr("MAIN")},ob=(m=1,M=null)=>{let E;if(M)E=M;else{const A=mu(c.newsBuffer);E={player:c,children:Z,fallenChildren:re,activeNpcs:k,deadNpcs:T,gameStage:en,logs:Is,inventory:l,messages:Ct.toJSON(),lastMessageCheck:mi,pendingSectChoices:gi,testQueue:zs,worldEvents:c.worldEvents||[],newsBuffer:A}}return Xy(E,m)},r0=async(m=1,M=null)=>{try{let E;if(M)E=M;else try{E=await Of(m)}catch(O){console.warn(":",O),E=Go(m)}if(!E||!E.player)throw new Error("");E=g5(E);const P=y5(E.player);f(O=>{var $;return{...E.player,businesses:(($=E.player)==null?void 0:$.businesses)||[]}}),we(E.children||[]),B(E.activeNpcs||[]),W(E.deadNpcs||[]);const A=Array.isArray(E.inventory)?E.inventory:[];if(a&&a.setInventory(A),qr(E.gameStage||"MAIN"),li(E.logs||[]),E.messages&&Ps(Array.isArray(E.messages)?E.messages:[]),Wf(E.lastMessageCheck||{}),E.pendingSectChoices&&hi(E.pendingSectChoices),E.testQueue&&fd(E.testQueue),Ue(E.fallenChildren||[]),nr(!1),Oe(null),i({type:null,data:null}),M){let O=`
${E.gameTime||""}
${E.saveDate||""}`;P&&(O=P+`

`+O),ee("",O,!0,null,!1)}else{let O=`
: ${m}
${E.saveDate||""}`;P&&(O=P+`

`+O),ee("",O,!0,null,!1)}}catch(E){console.error(":",E),ee("","",!1,null,!1)}},ib=()=>{C2(async()=>{const{clearAllSaves:m}=await Promise.resolve().then(()=>u5);return{clearAllSaves:m}},void 0,import.meta.url).then(({clearAllSaves:m})=>{m(),ee("","",!0,null,!1)})},ab=(m,M)=>{if(c.resources.spiritStones<m.cost){ee("","",!1);return}if(c.resources.spiritStones<m.cost){ee("",`${m.name} ${m.cost} : ${c.resources.spiritStones}`,!1);return}const E=Z.find(A=>A.id===M),P=Math.floor(m.baseIncome*(1+E.stats.intelligence/100));h({id:`${m.id}-${Date.now()}`,name:m.name,managerId:M,baseIncome:m.baseIncome,income:P,type:m.id,cost:m.cost}),ze(M,{job:m.id}),ee("",`${m.cost}${m.name}${E.name}: ${P}`,!0)},lb=(m,M,E={})=>{const{batchCount:P=1,isFastMode:A=!1}=E,O=m.cost*P,$=5*P;if(c.resources.spiritStones<O){ee("",`${m.name} ${O} : ${c.resources.spiritStones}`,!1);return}if((c.energy||0)<$){ee("",`${m.name} ${$} : ${c.energy||0}`,!1);return}if(!A&&gr()>=os){ee("",`

(: ${gr()}/${os})

`,!1);return}if(A&&P>1){w({spiritStones:O}),S($),M.map(Ce=>{var ge;return(ge=Z.find(Le=>Le.id===Ce))==null?void 0:ge.name}).filter(Boolean).join("");let oe=[],ie=[];for(let Ce=0;Ce<P;Ce++){const ge=(m.drops||["herb_bandage"]).filter(it=>{const Bt=fs(it);return Bt&&(!Bt.resourceLevel||Bt.resourceLevel===m.resourceLevel||Bt.resourceLevel==="MORTAL")}),Le=ge.length>0?ge:["herb_bandage"],ot=1+Math.floor(Math.random()*3);for(let it=0;it<ot;it++){const Bt=Le[Math.floor(Math.random()*Le.length)];ie.push(Bt)}}const ae={};ie.forEach(Ce=>{ae[Ce]=(ae[Ce]||0)+1});const te=Object.entries(ae).flatMap(([Ce,ge])=>{const Le=[];for(let ot=0;ot<ge;ot++){const it=or(Ce);it&&Le.push(it)}return Le});d(te);const ue=Object.entries(ae).map(([Ce,ge])=>{var ot;const Le=((ot=fs(Ce))==null?void 0:ot.name)||Ce;return ge>1?`${Le}${ge}`:Le}).join("");oe.push(` ${m.name}${P}`),oe.push(` ${ue}`);const X=`${m.name}${P}


${ue}

${O}
${$}`;ee("",X,!0),oe.forEach(Ce=>Be(Ce,"exploration"));return}w({spiritStones:m.cost}),S(5),od({id:m.id,name:m.name,total:10}),ad(M),Pa(1);const H=M.map(oe=>{var ie;return(ie=Z.find(ae=>ae.id===oe))==null?void 0:ie.name}).filter(Boolean).join(""),Y=`${m.name}${H||""}`;Ls([Y,`${m.name}`,`${m.difficulty}${m.recommendCP}`]);const F=kg({realmId:m.id,progress:1});$s(F),ui(!0),Be(Y,"exploration")},cb=y.useCallback(m=>{var E;if(!m)return;const M=[m.tierTitle?`${m.tierTitle}`:null,typeof m.ageAtDeath=="number"?`${m.ageAtDeath}`:null,m.deathYear?` ${m.deathYear} ${m.deathMonth||1}`:null,m.deathReason?`${m.deathReason}`:null,(E=m.sect)!=null&&E.name?`${m.sect.name}${m.rank?`  ${m.rank}`:""}`:null,typeof m.descendants=="number"?`${m.descendants}`:null,m.influenceLabel?`${m.influenceLabel}`:null].filter(Boolean).join(`
`);ee(`  ${m.name}`,`${m.epitaph||""}

${M}`,!0,null,!1)},[ee]),db=m=>{Ee(M=>M.id===m.id,M=>{const E={...M,isTested:!0,spiritRoot:m.spiritRoot};return bt(E)})},Sd=y.useCallback((m=!1)=>{var S0,w0,k0,E0,j0,C0,T0,I0;let M=[];const E=V=>m?!V.includes(""):!0;let P=[],A=0;const O=k.map(V=>{if(V.isPregnant){const be=V.pregnancyProgress+1;if(be>=9){const pe=pE(c,V,Math.floor(c.age));P.push(pe),M.push(`${V.name}${pe.name}${pe.gender}${pe.tier}`),Wt(c.newsBuffer||[],"BIRTH",{actor:c.name,target:pe.name,detail:pe.gender}),A+=1;let Ne=jk(V,c,Math.floor(c.age),c.time.month,pe.name);const Ve=Math.random()>.7?"":"",$e=Math.random()>.85;return ls.onChildBirth(Ne,pe,{difficulty:Ve,sacrifice:$e}),{...Ne,isPregnant:!1,pregnancyProgress:0}}return{...V,pregnancyProgress:be}}return V});Pe(O),O.some(V=>{var pe;return(((pe=V.customFlags)==null?void 0:pe.isFumoLegend)||V.identity===""||V.identity==="")&&V.isPregnant&&V.pregnancyProgress===8})&&console.log(" NPC8 - ");const H=((S0=c.stats)==null?void 0:S0.health)||50,Y=zt(H);x({energy:Y});const F=((w0=c==null?void 0:c.time)==null?void 0:w0.year)??3572,{newChildren:oe,generation3Plus:ie,totalCost:ae,logs:te,events:ue}=fE(Z||[],c.resources,{familyRatingMultiplier:qa,playerStrategy:c,childrenStrategy:c==null?void 0:c.childrenStrategy,generation3Plus:(c==null?void 0:c.generation3Plus)||[],currentYear:F,worldNpcs:c.worldNpcs||[]});f(V=>({...V,generation3Plus:ie}));let X=[...oe];const Ce=new Set(((c==null?void 0:c.exiledChildren)||[]).map(V=>V.id)),ge=X.filter(V=>{const be=Math.floor(V.age*12);return be>=72&&be<78&&!V.isTested&&!Ce.has(V.id)});if(ge.length>0){const V=new Set(ge.map(pe=>pe.id));X=X.map(pe=>{var Ne,Ve,$e;if(V.has(pe.id)){const Ze=((Ne=pe.stats)==null?void 0:Ne.aptitude)||50,at=k.find(At=>At.name===pe.fatherName);let dt=null;if(at&&(((Ve=at.customFlags)==null?void 0:Ve.isFumoLegend)||at.identity===""||at.identity==="")&&($e=at.spiritRoot)!=null&&$e.type){let hn=0;Ze>=75?hn=.85:Ze>=70?hn=.75:Ze>=65?hn=.6:Ze>=60?hn=.45:hn=.2,Math.random()<hn&&(dt={...at.spiritRoot,multiplier:(at.spiritRoot.multiplier||1)*.9})}dt||(dt=ir(Ze,pe.spiritRoot,null,{constitution:pe.constitution}));const vt={...pe,spiritRoot:dt,isTested:!0};if(fi||(pe.generation||1)>1){const At=bt(vt);return M.push({message:` ${pe.name} ${dt.type}${Ze}`,category:""}),At}return vt}return pe});const be=fi?[]:X.filter(pe=>ge.some(Ne=>Ne.id===pe.id)&&(pe.generation||1)===1);be.length>0&&(fd(pe=>[...pe,...be]),nn&&nr(!1))}P.length>0&&(X=[...X,...P]);const Le=X.reduce((V,be)=>(ET(be)?V.casualties.push(be):V.survivors.push(be),V),{survivors:[],casualties:[]});Le.casualties.length>0&&(ci(Le.casualties,X),ce&&Le.casualties.some(V=>V.id===ce.id)&&Oe(null));const ot=Le.survivors.filter(V=>{var be;return V.rank===""&&((be=V.sect)==null?void 0:be.id)});if(ot.length>0){const V=ot.map(pe=>({id:pe.id,name:pe.name,gender:pe.gender,sect:pe.sect,sectRank:"",status:"ALIVE",age:pe.age,cultivation:pe.cultivation,tier:pe.tier||pe.tierTitle||"",stats:pe.stats||{},children:[],source:"child"}));c.worldNpcs=c.worldNpcs?c.worldNpcs:[];const be=c.worldNpcs.filter(pe=>pe.sectRank===""?!V.some(Ve=>{var $e,Ze;return(($e=Ve.sect)==null?void 0:$e.id)===((Ze=pe.sect)==null?void 0:Ze.id)}):!0);c.worldNpcs=[...be,...V],j(pe=>[...pe.filter(Ve=>Ve.sectRank===""?!V.some(Ze=>{var at,dt;return((at=Ze.sect)==null?void 0:at.id)===((dt=Ve.sect)==null?void 0:dt.id)}):!0),...V]),ot.forEach(pe=>{M.push(` ${pe.name}  ${pe.sect.name}  `)})}ke(Le.survivors);const it=ue.filter(V=>V.type==="GRANDCHILD_BIRTH");if(A+=it.length,A>0&&M.push(` ${A}${A}`),M=[...M,...te],ue.length>0){ue.filter(pe=>pe.type==="ZHAOZHOU").forEach(pe=>{ee(pe.title,pe.message,!0,null,!1)});const V=ue.filter(pe=>pe.type==="CHILD_PROMOTION_GIFT");if(V.length>0){const pe=V.map(Ne=>{const Ve=typeof Ne.message=="string"?Ne.message:String(Ne.message||"");return{...Ne,message:Ve}});pe.length>=2&&!mo?(yi(pe),e.openBatchPromotionModal()):pe.forEach(Ne=>{const Ve=Ne.giftItemId?or(Ne.giftItemId):null;Ve&&d([Ve]);const $e=Ne.title||"";mo||ee($e,Ne.message,!0,null,!1)})}const be=ue.filter(pe=>{var Ne;return pe.type==="JOIN_SECT"&&!Ce.has((Ne=pe.child)==null?void 0:Ne.id)});if(be.length>0)if(fo){let pe=0;xe(Ne=>{if(!be.find(at=>{var dt;return((dt=at.child)==null?void 0:dt.id)===Ne.id})||!(Math.floor(Ne.age*12)>=144)||!Ne.isTested||Ne.sect||Ce.has(Ne.id))return Ne;const Ze=wd(Ne);return Ze?(pe++,{...Ne,sect:Ze,rank:sa(Ne,Ze)}):Ne}),pe>0&&ee("",` ${pe} `,!0)}else hi(pe=>{const Ne=[...pe,...be];return Ne.sort((Ve,$e)=>{var at,dt;return(((at=Ve.child)==null?void 0:at.name)||"").localeCompare(((dt=$e.child)==null?void 0:dt.name)||"")}),Ne}),nn&&nr(!1)}if(c.businesses&&c.businesses.length>0&&X){const{income:V,logs:be}=jg(c.businesses,X);M=[...M,...be],V>0&&M.push(` : ${V} `)}let Bt=0;if(X.forEach(V=>{try{const be=bc(V,{familyRatingMultiplier:qa});typeof be=="number"&&!isNaN(be)&&isFinite(be)?Bt+=be:console.warn("Invalid feedback for child:",V.name,be)}catch(be){console.error("Error calculating feedback for child:",V.name,be)}}),c.rival&&!c.rival.isDead){const V=U5(c),be=c.rival.threatLevel||0,pe=Math.min(100,be+V);c.rival.threatLevel=pe,c.rival._threatChangeThisMonth={from:be,to:pe,increased:V};const Ne=H5(c);if(Ne){const{survived:Ve,message:$e,type:Ze,hpLoss:at}=Ne,dt=Ve?"":"";m&&nr(!1),M.push(`${dt}${$e}`);let vt="";if(at&&at>0){const _r=Math.max(10,Math.floor(at*.2+Math.random()*at*.2)),At=ti(c,_r,"ASSASSINATION");if(c.stats.health=At.newHealth,At.energyPenalty>0){const hn=zt(At.newHealth);c.energy=Math.min(c.energy||20,hn)}vt=At.message,At.isSerious&&M.push(" ")}Wt(c.newsBuffer||[],Ze||(Ve?"ASSASSINATION_SURVIVED":"ASSASSINATION_INJURED"),{actor:c.name}),ee("",vt?`${$e}
${vt}`:$e,Ve,null,!1)}if(c.time.month===12){const Ve=W5(c);Ve&&Wt(c.newsBuffer||[],Ve.type,Ve.data)}}if(!((k0=c.rival)!=null&&k0.isDead)){const V=(E0=c.rival)==null?void 0:E0._threatChangeThisMonth,be=(V==null?void 0:V.from)||0,pe=((j0=c.rival)==null?void 0:j0.threatLevel)||0;if(be<100&&pe>=100){m&&nr(!1),console.log("100%",{previousThreat:be,currentThreat:pe});const Ve={currentExp:((C0=c.rival)==null?void 0:C0.currentExp)||300,stats:{aptitude:80}},$e=zn(Ve),Ze={name:"",combatStats:{hp:Math.floor($e*2.5),atk:Math.floor($e*.4),def:Math.floor($e*.2),mp:0,maxHp:Math.floor($e*2.5),maxMp:0}},at={...c,combatStats:c.combatStats||{maxHp:100,maxMp:50,atk:10,def:5,hp:100,mp:50}},dt=qi(at,Ze);Ns({enemy:Ze,result:dt,context:"rival"}),f(vt=>({...vt,rival:{...vt.rival,threatLevel:0}}))}}f(V=>{var ts;const be={...V.time};be.month+=1,be.month>12&&(be.month=1,be.year+=1);const pe=(V.age||16)+1/12,Ne=hw(V);let Ve=((ts=V.stats)==null?void 0:ts.health)||50,$e=V.energy||20;if(Ne&&Ne.recovered>0){Ve=Ne.newHealth,M.push(Ne.message);const Xa=zt(Ve);Xa>$e&&($e=Xa)}const Ze={...V,energy:$e,stats:{...V.stats,health:Ve},resources:V.resources||{spiritStones:0,spiritualAwareness:0}},at=An(Ze.tier),dt=ka(Ze,!0),vt=typeof dt=="number"&&isFinite(dt)?dt:0,_r=typeof Bt=="number"&&isFinite(Bt)?Bt:0;let At=Ze.currentExp+vt+_r;(!isFinite(At)||isNaN(At))&&(console.error("Invalid newExp calculation:",{currentExp:Ze.currentExp,playerSpeed:vt,totalFeedback:_r}),At=Ze.currentExp),At>=at.maxExp&&(At=at.maxExp);const{income:hn}=jg(Ze.businesses||[],X),hr={...Ze,age:pe,skillPoints:(Ze.skillPoints||0)+A,time:be,currentExp:At,maxExp:(at==null?void 0:at.maxExp)||5e5,resources:{...Ze.resources,spiritStones:Math.max(0,Ze.resources.spiritStones-ae+10+hn)}};try{return{...hr,combatStats:Cn(hr)}}catch(Xa){return console.error("Error calculating combat stats:",Xa),hr}}),M.length===0&&M.push("..."),M.forEach(V=>{E(V)&&Be(V)});const Tt=c.time.month===12?1:c.time.month+1,$n=c.time.month===12?c.time.year+1:c.time.year;try{const be=(c.time.year-3572)*12+c.time.month+1;if(be%36===0){const pe=c.time.year+(Tt===1?1:0),Ne=th(pe,{ownedFumoSwords:mr,soldAuctionItems:c.soldAuctionItems||[]}),Ve=be,$e=Ve+12;f(Ze=>({...Ze,lastAuctionYear:pe,currentAuction:Ne,auctionWindowStart:Ve,auctionWindowEnd:$e})),Si({id:`${pe}-${Date.now()}`,message:""}),Be(" ")}}catch(V){console.warn("",V)}let es;try{es=Uk(O,c,$n,Tt)}catch(V){console.error("Error processing NPC lifecycles:",V),es={npcs:O,events:[]}}const x0=(es==null?void 0:es.npcs)||O,Ed=(es==null?void 0:es.events)||[],y0=Ed.filter(V=>V.type==="NPC_LIFESPAN_ALERT");if(y0.length>0){const V=y0.map(be=>{const pe=Math.max(0,Math.floor(be.remainingYears));return`${be.npcName} ${pe} `});ee("",V.join(`
`),!1,null,!1,{title:"",category:"",type:"WARNING"}),nn&&nr(!1)}const Ja=Ed.filter(V=>V.type==="NPC_GIFT");if(Ja.length>0)if(Ja.length>=2&&!rr)xi(Ja),e.openBatchGiftModal();else{const V=[];if(Ja.forEach(be=>{const pe=or(be.giftItemId);if(pe){d([pe]);const Ne=`${be.message}${pe.name}`;Be(Ne),V.push(`${be.message}
${pe.name}`)}}),!rr&&V.length>0){const be=V.join(`

`);ee("",be,!0,null,!1,{category:"",type:"NPC_GIFT",title:"",message:be,details:be,forceManual:!0})}}const Ci=x0.filter(V=>!V.isDead),jd=x0.filter(V=>V.isDead);jd.length>0&&(W(V=>[...V,...jd]),jd.forEach(V=>{const be=s5(V,c,{year:$n,month:Tt});Ct.addMessage(be)}),Ps(Ct.getAllMessages())),Tt%3===0&&(Ci.forEach(V=>{var At,hn;if(!(V.sect||V.status==="away"))return;const pe=localStorage.getItem("acceptChildLetters")!=="false",Ne=localStorage.getItem("acceptLoverLetters")!=="false",Ve=V.fatherName||V.motherName||V.generation||V.parent||V.parentId||((At=c.children)==null?void 0:At.some(hr=>hr.id===V.id)),$e=V.id===((hn=c.spouse)==null?void 0:hn.id)||V.affection>60&&!Ve;if(Ve&&!pe||$e&&!Ne)return;const Ze=mi[V.id]||0,at=$n*12+Tt,dt=at-Ze,_r=Ct.getAllMessages().find(hr=>hr.senderId===V.id&&hr.type===Lt.LETTER);if(r5(V,dt,_r)){const hr=Ct.getRecentRepliesForNpc(V.id,3);zg(V,c,{year:$n,month:Tt},!0,{apiKey:localStorage.getItem("game_api_key")||"",apiUrl:localStorage.getItem("game_api_url")||"https://api.deepseek.com/chat/completions",apiModel:localStorage.getItem("game_api_model")||"deepseek-chat",useAIForLetter:localStorage.getItem("useAIForLetter")!=="false"},{children:Z,exiledChildren:c.exiledChildren||[],dualCultivationCount:V.dualCultivationCount||0,replyHistory:hr}).then(ts=>{Ct.addMessage(ts),Ps(Ct.getAllMessages())}).catch(ts=>{console.error(":",ts)}),Wf(ts=>({...ts,[V.id]:at}))}}),Ps(Ct.getAllMessages())),Ed.forEach(V=>{var be;if(V.type==="NPC_DEATH")M.push(` ${V.message}`),Wt(c.newsBuffer||[],"DEATH",{actor:V.npcName,detail:V.age||0,location:""});else if(V.type==="NPC_BREAKTHROUGH"){M.push(` ${V.message}`),Wt(c.newsBuffer||[],"NPC_BREAKTHROUGH",{actor:V.npcName,detail:V.newTier});const pe=Ci.find(Ne=>Ne.name===V.npcName);pe&&((be=pe.relationship)==null?void 0:be.affection)>=70&&Math.random()<.4&&Wt(c.newsBuffer||[],"NPC_AFFECTION_HIGH",{actor:c.name,target:pe.name})}else V.type==="NPC_BREAKTHROUGH_FAIL"&&Wt(c.newsBuffer||[],"BREAKTHROUGH_FAIL",{actor:V.npcName,detail:V.tier})});const Cd=Ik(Ci,c,$n,Tt),Pb=$n*12+Tt,zb=Cd.map(V=>{V.jealousy||(V.jealousy=0),V.lastInteraction||(V.lastInteraction={year:$n,month:Tt});const be=V.lastInteraction.year*12+V.lastInteraction.month,pe=Pb-be;if(pe<3){if(V.jealousy>0){const $e=$g(V);V.jealousy=Math.max(0,V.jealousy-$e)}return V}const{jealousyGain:Ne,shouldLog:Ve}=Qj(V,pe);if(Ne>0&&(V.jealousy=Math.min(100,(V.jealousy||0)+Ne),Ve)){const $e=mg(V,V.jealousy,{year:$n,month:Tt},c.name,"neglect");$e&&(V.logs=[...V.logs||[],$e])}if(V.jealousy>0){const $e=$g(V);V.jealousy=Math.max(0,V.jealousy-$e)}return V});Pe(zb);const b0=fj($n,Tt,c,Cd),v0=bj(c,X,$n,Tt);v0&&b0.push(v0),b0.forEach(V=>{Be(V.message,V.category,V.type,V.title)});let Ti=c.worldNpcs||[];if(Tt%3===0&&Ti.length>0&&(Ti=Zg(Ti,$n),x({worldNpcs:Ti})),Tt%3===0)if(localStorage.getItem("enableGazette")!=="false"){const be=c.newsBuffer||[],pe=be.length>0?be:[{type:"FILLER",data:{},timestamp:Date.now()}];localStorage.getItem("game_api_key"),localStorage.getItem("game_api_url"),localStorage.getItem("game_api_model"),localStorage.getItem("useAIForGazette");const Ne={},Ve={...c,worldNpcs:Ti};x({newsBuffer:[],hasUnreadGazette:!1}),Promise.resolve(R5(pe,Ve,Cd,(Ve.gazetteIssue||0)+1,Ne,Z)).then($e=>{$e&&(x({gazetteHistory:[...Ve.gazetteHistory||[],$e],gazetteIssue:$e.issue,hasUnreadGazette:!0}),dd($e))}).catch($e=>{console.error(":",$e),R()})}else x({newsBuffer:[]});if(Tt===1&&Tt!==3){const V=Zg(c.worldNpcs||[],$n);x({worldNpcs:V}),V.forEach(be=>{be.status==="DEAD"&&be.deathYear===$n&&(Wt(c.newsBuffer||[],"DEATH",{actor:`${be.title} ${be.name}`,detail:be.age,location:be.deathReason||""}),Be(` ${be.rank?`${be.rank}`:""}${be.title} ${be.name}${be.deathReason}`))})}if(Tt%3===0)if(rn)ho.length>0&&wi([]);else{const V=Jj(Ci);if(V){const be=Xj(V.participants,c),pe=be.participants.map($e=>$e.name),Ne=pe[0]||"",Ve=pe[1]||"";Wt(c.newsBuffer,"SHURA_FIELD",{actor:c.name,dominant:Ne,rival:Ve,participants:pe.join(""),count:pe.length}),Me($e=>{if(!be.participants.find(hn=>hn.id===$e.id))return $e;const at=typeof $e.personality=="object"&&$e.personality!==null&&"label"in $e.personality?$e.personality.label:Array.isArray($e.personality)?$e.personality[0]:"",dt=c.gender===""?"":"";let vt="";switch(at){case"":vt=`...${c.name}${c.name}`;break;case"":vt=`...${c.name}${dt}${dt}`;break;case"":vt=`${c.name}...`;break;case"":vt=`${c.name}.........`;break;case"":vt=`${c.name}${dt}...`;break;case"":vt=`${c.name}...`;break;case"":vt=`...${c.name}""...`;break;case"":vt=`${c.name}......`;break;case"":vt=`${c.name}${dt}...`;break;default:vt=`...${c.name}${dt}...`}const _r=$e.logs||[],At={year:c.time.year,month:c.time.month,content:vt,type:"DAILY",isSecret:!0,timestamp:Date.now()};return{...$e,logs:[At,..._r].slice(0,50)}}),wi($e=>[...$e,be]),nn&&nr(!1),Be(" ...")}}const Db=((T0=c==null?void 0:c.time)==null?void 0:T0.year)??0,Td=((I0=c==null?void 0:c.time)==null?void 0:I0.month)??0,Id=`${Db}-${Td}`,Fb=Vf.current===Id,Hb=Va.current===Id,Wb=Yf&&Td%2===0;if(!Fb&&!Hb&&Td>0&&!Wb)try{const V=mu(c.newsBuffer),be={player:c,children:Z,fallenChildren:re,activeNpcs:Ci,deadNpcs:T,gameStage:en,logs:Is,inventory:l,messages:Ct.toJSON(),lastMessageCheck:mi,pendingSectChoices:gi,testQueue:zs,worldEvents:c.worldEvents||[],newsBuffer:V};Gf(be,Id)}catch(V){console.error(":",V)}},[Z,c,k,zs,mo,rn,rr,nn,ho,ci,ce,Oe,en,Is,l,Ct,mi,gi,Gf,Yf]);y.useEffect(()=>{k.some(M=>M.isPregnant&&M.pregnancyProgress===8)&&nn&&console.warn(" NPC8")},[k,nn]);const ub=(m,M,E="")=>{var H,Y;const P=ky(M),A=Z.find(F=>F.id===m);if(!A)return;const O=jy(A,P);if(!O.qualified){ee("",((H=O.reasons)==null?void 0:H.join(""))||"",!1);return}Ee(F=>F.id===m,F=>{const oe={...F,sect:P,rank:E},ie=k.find(ue=>ue.name===F.fatherName||ue.name===F.motherName);ie&&ls.onChildJoinSect(ie,F,P.name),localStorage.getItem("acceptChildLetters")!=="false"&&zg({id:F.id,name:F.name,gender:F.gender,sect:P.name,tier:F.tierTitle,fatherName:F.fatherName,generation:F.generation,affection:100,relationship:{affection:100,stage:0}},c,{year:Math.floor(c.age),month:c.time.month},!0,{apiKey:localStorage.getItem("game_api_key")||"",apiUrl:localStorage.getItem("game_api_url")||"https://api.deepseek.com/chat/completions",apiModel:localStorage.getItem("game_api_model")||"deepseek-chat",useAIForLetter:localStorage.getItem("useAIForLetter")!=="false"},{children:Z,exiledChildren:c.exiledChildren||[],replyHistory:Ct.getRecentRepliesForNpc(F.id,3)}).then(ue=>{Ct.addMessage(ue),Ps(Ct.getAllMessages())}).catch(ue=>{console.error(":",ue)}),Wt(c.newsBuffer||[],"JOIN_SECT",{actor:c.name,target:F.name,detail:P.name});const te=lC(oe,P.name);return te&&Be(te,"cultivation"),bt(oe)}),hi(F=>F.filter(oe=>oe.child.id!==m));const $=((Y=Z.find(F=>F.id===m))==null?void 0:Y.name)||"";Be(` ${$} ${P.name}`,"")};y.useEffect(()=>{let m;if(nn){const M=()=>{Sd(!0),m=setTimeout(M,1e3/Rs)};m=setTimeout(M,1e3/Rs)}return()=>clearTimeout(m)},[nn,Rs,Sd]),y.useEffect(()=>{if(go){Ya.length>0&&yd([]);return}if(Ya.length>0&&!t.type){const m=Ya[0];i({type:"JEALOUSY",data:m}),yd(M=>M.slice(1))}},[Ya,t.type,go]),y.useEffect(()=>{if(rn){ho.length>0&&wi([]);return}if(ho.length!==0){if(t.type==="RESULT"&&qf!==!1){i({type:null,data:null});return}if(!t.type){const m=ho[0];i({type:"SHURA_FIELD",data:m}),wi(M=>M.slice(1))}}},[ho,t.type,qf,rn]),y.useEffect(()=>{var M,E,P,A;if(!ce)return;const m=le.find(O=>O.id===ce.id);m&&(m.name!==ce.name||m.cultivation!==ce.cultivation||((M=m.stats)==null?void 0:M.aptitude)!==((E=ce.stats)==null?void 0:E.aptitude)||((P=m.influenceProfile)==null?void 0:P.tierId)!==((A=ce.influenceProfile)==null?void 0:A.tierId)||m.isFavorite!==ce.isFavorite)&&Oe(m)},[La,le,ce,Oe]);const pb=m=>{const M=Z.find(P=>P.id===m);if(!M)return;if(Math.floor(M.age*12)<216){ee("","18",!1,null,!1);return}if(c.resources.spiritStones<500){ee("",` 500 : ${c.resources.spiritStones}`,!1);return}const E=Eg(M.tierTitle||"",M.gender);gd(E),hd(M),md(!0)},fb=m=>{if(!Ga)return;Ee(E=>E.id===Ga.id,E=>{const P=k.find(A=>A.name===E.fatherName||A.name===E.motherName);if(P){ls.onChildMarriage(P,E,m.name);const A=gg(P,c,Math.floor(c.age),c.time.month,m.name);Q(P.id,A)}return{...E,spouse:m}}),w({spiritStones:500}),Be(` 500 ${Ga.name}  ${m.name} `),md(!1),gd([]),hd(null)},mb=(m,M,E)=>{var P,A;if(M==="CHAT"){const O=Z.find(F=>F.id===m);if(!O)return;if((c.energy||0)<=0){ee("","",!1);return}S(1);const $={...O,isChild:!0,relationship:{affection:100}},H=uu($,c);if(H){ee((H==null?void 0:H.title)||"",(H==null?void 0:H.text)||"",!0,null);return}const Y=[`${O.name}`,`${O.name}`,`${O.name}${O.gender===""?"":""}`,`${O.name}"${c.gender===""?"":""}"`,`${O.name}`];ee("",Y[Math.floor(Math.random()*Y.length)],!0,null);return}if(M==="MARRY"){pb(m);return}if(M==="RENAME"&&(ze(m,{name:E}),Oe(O=>O&&O.id===m?{...O,name:E}:O),ee("","",!0)),M==="FEED_PILL"){if(c.resources.spiritStones<100){ee("",` 100 : ${c.resources.spiritStones}`,!1);return}const $=Z.find(oe=>oe.id===m);if(!$)return;const H=500*(1+(((P=$.stats)==null?void 0:P.aptitude)||0)/100),Y=sn($,H);w({spiritStones:100}),Ee(oe=>oe.id===m,oe=>{var te;const ie=500*(1+(((te=oe.stats)==null?void 0:te.aptitude)||0)/100),ae=sn(oe,ie);return bt(ae.updated)}),Oe(oe=>{var ie;if(oe&&oe.id===m){const ae=500*(1+(((ie=oe.stats)==null?void 0:ie.aptitude)||0)/100),te=sn(oe,ae);return bt(te.updated)}return oe});const F=Y.tierChanged?`

 ${$.name} ${Y.newTier} ${Y.lifespanIncrease} `:"";ee("",`${F}`,!0)}if(M==="EDUCATE"){if(c.resources.spiritStones<50){ee("",` 50 : ${c.resources.spiritStones}`,!1);return}w({spiritStones:50});const $=Z.find(F=>F.id===m),H=$?sn($,Math.floor((((A=$.stats)==null?void 0:A.aptitude)||50)*5)):null;Ee(F=>F.id===m,F=>{var ae;const oe=Math.floor((((ae=F.stats)==null?void 0:ae.aptitude)||50)*5),ie=sn(F,oe);return bt(ie.updated)}),Oe(F=>{var oe;if(F&&F.id===m){const ie=Math.floor((((oe=F.stats)==null?void 0:oe.aptitude)||50)*5),ae=sn(F,ie);return bt(ae.updated)}return F});const Y=H!=null&&H.tierChanged?`

 ${($==null?void 0:$.name)||""} ${H.newTier} ${H.lifespanIncrease} `:"";ee("",`${(ce==null?void 0:ce.name)||""} ${Y}

 `,!0)}if(M==="OPEN_INVENTORY"&&e.openInventory((E==null?void 0:E.mode)||"VIEW",(E==null?void 0:E.slot)||null,m),M==="UNEQUIP"){const O=E==null?void 0:E.slot;if(!O)return;const $=Z.find(F=>F.id===m);if(!$)return;const H=Rr($),Y=H.equipment[O];if(!Y)return;a.setInventory(F=>[Y,...F]),Ee(F=>F.id===m,F=>{const oe={...H,equipment:{...H.equipment,[O]:null}};return bt(oe)}),Oe(F=>{if(F&&F.id===m){const oe={...H,equipment:{...H.equipment,[O]:null}};return bt(oe)}return F})}if(M==="CHANGE_MANUAL"){if(!Z.find(H=>H.id===m))return;if(l.filter(H=>H.type==="manual").length===0){ee("","",!1);return}e.openInventory("MANUAL_SELECT",null,m)}if(M==="SELECT_SECT"){const O=Z.find(Y=>Y.id===m);if(!O)return;if(Math.floor(O.age*12)<144){ee("","12",!1);return}if(!O.isTested){ee("","",!1);return}const{recommended:$,others:H}=kp(O);if(!$.length&&!H.length){ee("","",!1);return}hi([{type:"JOIN_SECT",title:"",message:`${O.name} `,child:O,selectableSects:$,otherSectOptions:H,showModal:!0}]),nn&&nr(!1)}if(M==="TOGGLE_AUTO_JOIN_SECT"){const O=!!E;ze(m,{autoJoinBestSect:O}),Oe($=>$&&$.id===m?{...$,autoJoinBestSect:O}:$),ee("",O?"":"",!0);return}if(M==="EXPEL"){const O=Z.find($=>$.id===m);if(!O)return;D(m),x({exiledChildren:[...c.exiledChildren||[],O]}),Oe(null),Be(` ${O.name} `),ee("",`${O.name} `,!0);return}},wd=m=>{const{recommended:M,others:E}=kp(m),P=[...M,...E],A=P.filter(O=>{var $;return($=O.admission)==null?void 0:$.qualified});return A.length?A[0].sect:P.length?P[0].sect:null},gb=m=>{if(ud(!!m),!m){ee("","",!0);return}let M=0;xe(E=>{if(!(Math.floor(E.age*12)>=144)||!E.isTested||E.sect)return E;const A=wd(E);return A?(M++,{...E,sect:A,rank:sa(E,A)}):E}),ee("",` ${M} `,!0)},hb=()=>{var $;const M=(($=c==null?void 0:c.resources)==null?void 0:$.spiritStones)||0,E=Z.filter(H=>!H.spouse&&Math.floor((H.age||0)*12)>=216).sort((H,Y)=>{var F,oe;return(((F=Y.stats)==null?void 0:F.aptitude)||0)-(((oe=H.stats)==null?void 0:oe.aptitude)||0)});if(!E.length){ee("","18",!1);return}const P=Math.min(E.length,Math.floor(M/500));if(P<=0){ee(""," 500 ",!1);return}const O=E.slice(0,P).map(H=>{const F=(Eg(H.tierTitle||"",H.gender)||[]).reduce((oe,ie)=>{var ue,X,Ce,ge;if(!oe)return ie;const ae=((ue=ie.stats)==null?void 0:ue.aptitude)||0,te=((X=oe.stats)==null?void 0:X.aptitude)||0;return ae===te?(((Ce=ie.stats)==null?void 0:Ce.intelligence)||0)>(((ge=oe.stats)==null?void 0:ge.intelligence)||0)?ie:oe:ae>te?ie:oe},null)||mE(H.tierTitle||"",H.gender);return{childId:H.id,childName:H.name,spouse:F,childRef:H}});if(!O.length){ee("","",!1);return}bi(O),e.openBatchMarriageModal()},xb=m=>{var H;if(!m||m.length===0){e.closeBatchMarriageModal(),bi([]);return}const M=new Map(m.map(Y=>[Y.childId,Y]));xe(Y=>{const F=M.get(Y.id);return F?{...Y,spouse:F.spouse}:Y}),Oe(Y=>Y&&M.has(Y.id)?{...Y,spouse:M.get(Y.id).spouse}:Y);const E=Math.floor((c==null?void 0:c.age)||0),P=((H=c==null?void 0:c.time)==null?void 0:H.month)??1,A=new Map;m.forEach(Y=>{var ie,ae;const F=Y.childRef,oe=k.find(te=>te.name===F.fatherName||te.name===F.motherName);if(oe&&!A.has(oe.id)){ls.onChildMarriage(oe,F,(ie=Y.spouse)==null?void 0:ie.name);const te=gg(oe,c,E,P,(ae=Y.spouse)==null?void 0:ae.name);A.set(oe.id,te)}}),A.size&&Ke(A);const O=m.length*500;w({spiritStones:O});const $=m.map(Y=>{var F,oe,ie;return` ${Y.childName}  ${((F=Y.spouse)==null?void 0:F.name)||""}${((ie=(oe=Y.spouse)==null?void 0:oe.stats)==null?void 0:ie.aptitude)??"?"}`}).join(`
`);Be(`  ${m.length} 
${$}`),ee("",` ${O}  ${m.length} 
${$}`,!0),e.closeBatchMarriageModal(),bi([])},yb=m=>{pd(!!m),ee(m?"":"",m?"":"",!0)},bb=m=>{Ha(!!m),ee(m?"":"",m?"":"",!0)},vb=m=>{Fe(!!m),x({childrenStrategy:{...c.childrenStrategy,skipZhaozhou:!!m}}),ee(m?"":"",m?"":"",!0)},Sb=m=>{gn(!!m),m&&wi([]),ee(m?"":"",m?"":"",!0)},wb=m=>{Os(!!m),ee(m?"":"",m?"":"",!0)},kb=m=>{b1(!!m),ee(m?"":"",m?"":"",!0)},s0=(m,M,E)=>{const P=l.find(H=>H.instanceId===E);if(!P)return ee("","",!1);if(P.slot!==M)return ee("","",!1);const A=Z.find(H=>H.id===m);if(!A)return;const O=Rr(A),$=O.equipment[M];Ee(H=>H.id===m,H=>{const Y={...O,equipment:{...O.equipment,[M]:P}};return bt(Y)}),Oe(H=>{if(H&&H.id===m){const Y={...O,equipment:{...O.equipment,[M]:P}};return bt(Y)}return H}),a.setInventory(H=>{const Y=H.filter(F=>F.instanceId!==E);return $?[$,...Y]:Y}),e.closeInventory(),ee("",`${A.name}  ${P.name}`,!0)},kd=(m,M)=>{var oe;const E=l.find(ie=>ie.instanceId===M);if(!E)return ee("","",!1);const P=!m,A=P?null:Z.find(ie=>ie.id===m);if(!P&&!A)return ee("","",!1);const O=P?ht.PLAYER:ht.CHILD;if(!Ws(E,O)){ee("",`${E.name||""}  ${ko(E)} `,!1);return}if(E.type==="manual"){const ie=E.manualIds||[];if(ie.length===0)return ee("","",!1);const ae=ie[Math.floor(Math.random()*ie.length)],te=vn[ae];if(!te)return ee("","",!1);if(P){f(X=>{const Ce={...X,cultivationMethod:ae};return bt(Ce)}),e.closeInventory(),ee("",` ${te.name||ae}`,!0);return}const ue=Wg(A,ae);if(!ue.success)return ee("",ue.message,!1);Ee(X=>X.id===m,X=>{const Ce={...X,cultivationMethod:ae};return bt(Ce)}),Oe(X=>{if(X&&X.id===m){const Ce={...X,cultivationMethod:ae};return bt(Ce)}return X}),e.closeInventory(),Be(ue.message),ee("",ue.message+"",!0,{:((oe=ue.compatibility)==null?void 0:oe.desc)||""});return}if(["weapon","armor","accessory"].includes(E.type)){if(P){f(ie=>{const ae=Rr(ie),te={...ae,equipment:{...ae.equipment,[E.slot]:E}};return bt(te)}),a.setInventory(ie=>ie.filter(ae=>ae.instanceId!==M)),e.closeInventory(),ee("",` ${E.name}`,!0);return}s0(m,E.slot,M);return}if(E.type!=="consumable")return ee("","",!1);const $=E.effect||{};if(P){f(ae=>{var ue,X,Ce;let te={...ae};if($.kind==="exp")te.currentExp=(te.currentExp||0)+($.amount||0);else if($.kind==="aptitude"){const ge=Math.min(100,(((ue=te.stats)==null?void 0:ue.aptitude)||50)+($.amount||0));te={...te,stats:{...te.stats,aptitude:ge}};try{const Le=ir(ge,te.spiritRoot,null,{constitution:te.constitution});te={...te,spiritRoot:Le}}catch{}}else if($.kind==="intelligence"){const ge=Math.min(100,(((X=te.stats)==null?void 0:X.intelligence)||50)+($.amount||0));te={...te,stats:{...te.stats,intelligence:ge}}}else if($.kind==="heal"){const ge=((Ce=te.stats)==null?void 0:Ce.health)||100,Le=Math.min(100,ge+($.amount||0));te={...te,stats:{...te.stats,health:Le}};const ot=zt(ge),it=zt(Le),Bt=it-ot;Bt>0&&(te.energy=Math.min(it,(te.energy||0)+Bt))}return bt(te)}),u(M,E.stackable?1:void 0),e.closeInventory();let ie=`  ${E.name}`;$.kind==="exp"&&(ie+=` +${$.amount}`),$.kind==="aptitude"&&(ie+=` +${$.amount}`),$.kind==="intelligence"&&(ie+=` +${$.amount}`),$.kind==="heal"&&(ie+=""),ee("",ie,!0);return}const H=$.kind==="exp"?$.amount||0:$.kind==="heal"?Math.floor(($.amount||0)*2):0,Y=H>0?sn(A,H):null;Ee(ie=>ie.id===m,ie=>{var te,ue;let ae={...ie};if($.kind==="exp"||$.kind==="heal")ae=sn(ae,H).updated;else if($.kind==="aptitude"){const X=Math.min(100,(((te=ae.stats)==null?void 0:te.aptitude)||50)+($.amount||0));if(ae={...ae,stats:{...ae.stats,aptitude:X}},ae.isTested||ae.spiritRoot&&Array.isArray(ae.spiritRoot.elements))try{const Ce=ir(X,ae.spiritRoot,null,{constitution:ae.constitution});ae={...ae,spiritRoot:Ce}}catch{}}else if($.kind==="intelligence"){const X=Math.min(100,(((ue=ae.stats)==null?void 0:ue.intelligence)||50)+($.amount||0));ae={...ae,stats:{...ae.stats,intelligence:X}}}return bt(ae)}),Oe(ie=>{var ae,te;if(ie&&ie.id===m){let ue={...ie};if($.kind==="exp"||$.kind==="heal")ue=sn(ue,H).updated;else if($.kind==="aptitude"){const X=Math.min(100,(((ae=ue.stats)==null?void 0:ae.aptitude)||50)+($.amount||0));if(ue={...ue,stats:{...ue.stats,aptitude:X}},ue.isTested||ue.spiritRoot&&Array.isArray(ue.spiritRoot.elements))try{const Ce=ir(X,ue.spiritRoot,null,{constitution:ue.constitution});ue={...ue,spiritRoot:Ce}}catch{}}else if($.kind==="intelligence"){const X=Math.min(100,(((te=ue.stats)==null?void 0:te.intelligence)||50)+($.amount||0));ue={...ue,stats:{...ue.stats,intelligence:X}}}return bt(ue)}return ie}),u(M,E.stackable?1:void 0),e.closeInventory();let F=`${A.name}  ${E.name}`;$.kind==="exp"&&(F+=`+${$.amount}`),$.kind==="aptitude"&&(F+=`+${$.amount}`),$.kind==="intelligence"&&(F+=`+${$.amount}`),$.kind==="heal"&&(F+=""),Y!=null&&Y.tierChanged&&(F+=`

 ${A.name} ${Y.newTier} ${Y.lifespanIncrease} `),ee("",F,!0)},Eb=(m,M)=>{if(!M||M.length===0){ee("","",!1);return}const E=!m,P=E?c:Z.find(ae=>ae.id===m);if(!E&&!P){ee("","",!1);return}let A=0,O=0,$=0,H=0,Y=[];M.forEach(ae=>{const te=l.find(ot=>ot.instanceId===ae.instanceId);if(!te||!te.effect)return;const ue=Math.min(ae.quantity||1,te.quantity||1);if(ue<=0)return;const X=E?ht.PLAYER:ht.CHILD;if(!Ws(te,X))return;const Ce=te.effect,Le=(Ce.amount||0)*ue;Ce.kind==="exp"?A+=Le:Ce.kind==="aptitude"?O+=Le:Ce.kind==="intelligence"?$+=Le:Ce.kind==="heal"&&(H+=Le),Y.push({name:te.name,quantity:ue,effect:Ce.kind}),u(te.instanceId,ue)});const F=E?0:A+Math.floor(H*2),oe=!E&&F>0?sn(P,F):null;E?f(ae=>{var ue,X,Ce;let te={...ae};if(A>0&&(te.currentExp=(te.currentExp||0)+A),O>0){const ge=Math.min(100,(((ue=te.stats)==null?void 0:ue.aptitude)||50)+O);te={...te,stats:{...te.stats,aptitude:ge}};try{const Le=ir(ge,te.spiritRoot,null,{constitution:te.constitution});te={...te,spiritRoot:Le}}catch{}}if($>0){const ge=Math.min(100,(((X=te.stats)==null?void 0:X.intelligence)||50)+$);te={...te,stats:{...te.stats,intelligence:ge}}}if(H>0){const ge=((Ce=te.stats)==null?void 0:Ce.health)||100,Le=Math.min(100,ge+H);te={...te,stats:{...te.stats,health:Le}};const ot=zt(ge),it=zt(Le),Bt=it-ot;Bt>0&&(te.energy=Math.min(it,(te.energy||0)+Bt))}return bt(te)}):(Ee(ae=>ae.id===m,ae=>{var ue,X;let te={...ae};if(F>0&&(te=sn(te,F).updated),O>0){const Ce=Math.min(100,(((ue=te.stats)==null?void 0:ue.aptitude)||50)+O);if(te={...te,stats:{...te.stats,aptitude:Ce}},te.isTested||te.spiritRoot&&Array.isArray(te.spiritRoot.elements))try{const ge=ir(Ce,te.spiritRoot,null,{constitution:te.constitution});te={...te,spiritRoot:ge}}catch{}}if($>0){const Ce=Math.min(100,(((X=te.stats)==null?void 0:X.intelligence)||50)+$);te={...te,stats:{...te.stats,intelligence:Ce}}}return bt(te)}),Oe(ae=>{var te,ue;if(ae&&ae.id===m){let X={...ae};if(F>0&&(X=sn(X,F).updated),O>0){const Ce=Math.min(100,(((te=X.stats)==null?void 0:te.aptitude)||50)+O);if(X={...X,stats:{...X.stats,aptitude:Ce}},X.isTested||X.spiritRoot&&Array.isArray(X.spiritRoot.elements))try{const ge=ir(Ce,X.spiritRoot,null,{constitution:X.constitution});X={...X,spiritRoot:ge}}catch{}}if($>0){const Ce=Math.min(100,(((ue=X.stats)==null?void 0:ue.intelligence)||50)+$);X={...X,stats:{...X.stats,intelligence:Ce}}}return bt(X)}return ae}));let ie=`${E?"":P.name}  ${Y.length} 
`;Y.forEach(ae=>{ie+=`
 ${ae.name} x${ae.quantity}`}),A>0&&(ie+=`

+${A}`),O>0&&(ie+=`
+${O}`),$>0&&(ie+=`
+${$}`),H>0&&(ie+=`
+${H}`),oe!=null&&oe.tierChanged&&(ie+=`

 ${P.name} ${oe.newTier} ${oe.lifespanIncrease} `),ee("",ie,!0),e.closeInventory()},Qa=y.useCallback(()=>{bd({open:!1,item:null,items:null,isBatch:!1})},[]),jb=y.useCallback(()=>{md(!1),gd([]),hd(null)},[]),Cb=y.useCallback(m=>{m.forEach(M=>{const E=or(M.giftItemId);E&&(d([E]),Be(`${M.message}${E.name}`))}),e.closeBatchGiftModal(),xi([]),ee("",` ${m.length} `,!0)},[or,d,Be,e,xi,ee]),Tb=y.useCallback(()=>{e.closeBatchGiftModal(),xi([])},[e,xi]),Ib=y.useCallback(m=>{m.forEach(M=>{const E=M.giftItemId?or(M.giftItemId):null;E&&d([E])}),e.closeBatchPromotionModal(),yi([]),ee("",` ${m.length} `,!0)},[or,d,e,yi,ee]),Rb=y.useCallback(()=>{e.closeBatchPromotionModal(),yi([])},[e,yi]),_b=y.useCallback(()=>{e.closeBatchMarriageModal(),bi([])},[e,bi]),Mb=y.useCallback(m=>{if(Ds.isBatch&&Ds.items){let M=0,E=0,P=0,A=0,O=0,$=[],Y={...Rr(m).equipment||{}},F=!1,oe=[],ie=[];Ds.items.forEach(ue=>{const X=typeof ue=="object"?ue.instanceId:ue,Ce=typeof ue=="object"&&ue.quantity?ue.quantity:1,ge=l.find(ot=>ot.instanceId===X);if(!ge){E++;return}if(["weapon","armor","accessory"].includes(ge.type)){const ot=ge.slot||ge.type,it=Y[ot];Y={...Y,[ot]:ge},F=!0,oe.push(ge.name||""),it&&it.instanceId!==ge.instanceId&&ie.push(it),u(X,ge.stackable?1:void 0),M++,E++;return}for(let ot=0;ot<Ce;ot++){const it=ge.effect||{};if(it.kind==="exp"||it.kind==="heal"){const Bt=it.kind==="exp"?it.amount||0:Math.floor((it.amount||0)*2);P+=Bt;const Tt=sn(m,Bt);Tt!=null&&Tt.tierChanged&&$.push({newTier:Tt.newTier,lifespanIncrease:Tt.lifespanIncrease})}else it.kind==="aptitude"?A+=it.amount||0:it.kind==="intelligence"&&(O+=it.amount||0);u(X,ge.stackable?1:void 0),M++}E++}),ie.length>0&&d(ie),Ee(ue=>ue.id===m.id,ue=>{var Ce,ge;let X={...ue};if(F&&(X={...Rr(X),equipment:{...Y}}),P>0&&(X=sn(X,P).updated),A>0){const Le=Math.min(100,(((Ce=X.stats)==null?void 0:Ce.aptitude)||50)+A);if(X={...X,stats:{...X.stats,aptitude:Le}},X.isTested||X.spiritRoot&&Array.isArray(X.spiritRoot.elements))try{const ot=ir(Le,X.spiritRoot,null,{constitution:X.constitution});X={...X,spiritRoot:ot}}catch{}}if(O>0){const Le=Math.min(100,(((ge=X.stats)==null?void 0:ge.intelligence)||50)+O);X={...X,stats:{...X.stats,intelligence:Le}}}return bt(X)}),Oe(ue=>{var X,Ce;if(ue&&ue.id===m.id){let ge={...ue};if(F&&(ge={...Rr(ge),equipment:{...Y}}),P>0&&(ge=sn(ge,P).updated),A>0){const Le=Math.min(100,(((X=ge.stats)==null?void 0:X.aptitude)||50)+A);if(ge={...ge,stats:{...ge.stats,aptitude:Le}},ge.isTested||ge.spiritRoot&&Array.isArray(ge.spiritRoot.elements))try{const ot=ir(Le,ge.spiritRoot,null,{constitution:ge.constitution});ge={...ge,spiritRoot:ot}}catch{}}if(O>0){const Le=Math.min(100,(((Ce=ge.stats)==null?void 0:Ce.intelligence)||50)+O);ge={...ge,stats:{...ge.stats,intelligence:Le}}}return bt(ge)}return ue});let ae=` ${E}  ${M}  ${m.name}`,te={};if(P>0&&(ae+=`
 +${P}`,te.=`+${P}`),A>0&&(ae+=`
 +${A}`,te.=`+${A}`),O>0&&(ae+=`
 +${O}`,te.=`+${O}`),oe.length>0&&(ae+=`
${oe.join("")}`,te.=oe.join("")),$.length>0){const ue=$[$.length-1];ae+=`

 ${m.name} ${ue.newTier} ${ue.lifespanIncrease} `}ee("",ae,!0,Object.keys(te).length>0?te:null),Qa(),e.closeInventory()}else Ds.item&&(kd(m.id,Ds.item.instanceId),Qa(),e.closeInventory())},[Ds,kd,ee,Qa,e,l,u,Ee,Oe,sn,bt,ir,Rr,d]),Ab=y.useCallback(m=>{const M=l.find(E=>E.instanceId===m);if(M){if(!Ws(M,ht.CHILD)){ee("",`${M.name||""}  ${ko(M)} `,!1);return}bd({open:!0,item:M})}},[l,Ws,ht,ee,ko]),Nb=y.useCallback(m=>{if(m.length===0)return;const M=m.map(P=>{const A=typeof P=="object"?P.instanceId:P,O=typeof P=="object"&&P.quantity?P.quantity:1,$=l.find(H=>H.instanceId===A);return $?{...$,giveQuantity:O}:null}).filter(Boolean);if(M.length===0)return;const E=M.filter(P=>!Ws(P,ht.CHILD));if(E.length>0){const P=E.slice(0,3).map(O=>O.name).join(""),A=E.length>3?" ":"";ee("",`${P}${A}  ${ko(E[0])} `,!1);return}bd({open:!0,items:M.map(P=>({instanceId:P.instanceId,quantity:P.giveQuantity||1})),isBatch:!0})},[l,Ws,ht,ee,ko]),Lb=y.useCallback(()=>{const m=zs[0];m&&ze(m.id,{isTested:!0}),fd(M=>M.slice(1))},[zs,ze]),$b=()=>{if(l.filter(E=>E.type==="manual"&&(E.manualIds&&E.manualIds.length||E.manualId)).length===0){ee("","",!1);return}if(!(mn.length?mn:Z).length){ee("","",!1);return}e.openBatchManualModal()},Bb=m=>{if(!m||m.length===0){e.closeBatchManualModal();return}let M=0;const E=[];m.forEach(P=>{const A=Z.find(H=>H.id===P.childId);if(!A)return;const O={...A},$=Wg(O,P.manualId);if($.success){const H=bt({...O});E.push(H),M++,Be($.message)}}),E.length>0&&(xe(P=>E.find(O=>O.id===P.id)||P),Oe(P=>P&&(E.find(O=>O.id===P.id)||P))),ee("",` ${M} `,!0),e.closeBatchManualModal()},o0=()=>{const m=gE(c);m.success?(f(M=>{var O,$;const E=((O=M.stats)==null?void 0:O.aptitude)||50,P=(($=M.spiritRoot)==null?void 0:$.type)||"",A=ei(m.newTier,E,P,M.equipment);return{...M,tier:m.newTier,currentExp:0,maxExp:m.newMaxExp,breakthroughBonus:0,breakthroughFailCount:0,combatStats:A}}),Wt(c.newsBuffer||[],"LEVEL_UP",{actor:c.name,detail:m.newTier}),ee("",m.msg,!0,{:""},!1)):(f(M=>{const E=(M.breakthroughFailCount||0)+1,P=(M.breakthroughBonus||0)+5;return{...M,currentExp:Math.max(0,M.currentExp-m.penalty),breakthroughFailCount:E,breakthroughBonus:P}}),ee("",m.msg,!1,{:-m.penalty},!1))},Ob=m=>{if((c.skillPoints||0)<=0){Be(" ");return}f(M=>{const E={...M,skillPoints:M.skillPoints-1};if(m==="aptitude"){const P=Math.min(100,(E.stats.aptitude||20)+1),A=Jk(E,P);return Be(` 1 ${A.stats.aptitude}`),A}else m==="combatPower"?(E.combatStats={...E.combatStats,maxHp:E.combatStats.maxHp+50,hp:E.combatStats.maxHp+50,atk:E.combatStats.atk+5,def:(E.combatStats.def||0)+3},Be(" 1+50+5+3")):m==="breakthrough"&&(E.breakthroughBonus=(E.breakthroughBonus||0)+5,Be(` 15%: ${E.breakthroughBonus}%`));return E})};return r.jsxs("div",{style:Dm.appContainer,children:[Xe&&r.jsx(m5,{onComplete:()=>Mt(!1)}),pn&&r.jsx(f5,{onConfirm:()=>fn(!1),onExit:()=>{window.location.href="about:blank"}}),r.jsx(CE,{player:c,isAuto:nn,onBreakthrough:o0,auctionBanner:xd}),en==="PROLOGUE"?r.jsx(p5,{onFinish:sb,onLoadGame:r0}):r.jsxs("div",{style:Dm.mainContent,children:[r.jsx(ZC,{player:c,onBreakthroughClick:o0}),tr==="FAMILY"&&r.jsx(eT,{player:c,visibleChildren:mn,pregnantNpcs:k.filter(m=>{var M;return m.isPregnant&&!((M=m.relationship)!=null&&M.cutTies)}),fallenChildren:re,exiledChildren:(c==null?void 0:c.exiledChildren)||[],generation3Plus:(c==null?void 0:c.generation3Plus)||[],onChildClick:m=>{m.isEmbryo?ee("",`${m.npc.name} ...

 

: ${m.npc.pregnancyProgress||0}/9`,!0,null,!1):Oe(m)},onToggleFavorite:me,onMemorialClick:cb}),tr==="NPC"&&r.jsx(rT,{sortedNpcs:Xr,pagedNpcs:ed,deadNpcs:T,npcSort:Ms,npcPage:Jr,npcPageCount:po,hasNpcPagination:td,showFollowedOnly:_s,isRomanceLimitReached:gr()>=os,onExplore:nb,onSortChange:$a,onToggleFollowedOnly:Zc,onPrevPage:()=>As(m=>Math.max(0,m-1)),onNextPage:()=>As(m=>Math.min(Math.max(0,po-1),m+1)),onNpcInteract:m=>e0(m.id,"DETAIL"),onNpcAction:e0}),tr==="ACTION"&&r.jsx(sT,{player:c,children:mn,showBizPanel:e.showBizPanel,showChallengePanel:e.showChallengePanel,idleManagerOptions:Qc,onDailyAction:K1,onShopping:Q1,onOpenInventory:e.openInventory,onBuyBusiness:ab,onExploreRealm:lb,onOpenAuction:z1,onCloseBizPanel:e.closeBizPanel,onCloseChallengePanel:e.closeChallengePanel,onOpenBizPanel:e.openBizPanel,onOpenChallengePanel:e.openChallengePanel,isRomanceLimitReached:gr()>=os}),tr==="REVENGE"&&r.jsx(qC,{children:r.jsx(K5,{player:c,setPlayer:f,addLog:Be})}),tr==="SYSTEM"&&r.jsx(aC,{player:c,onSave:ob,onLoad:r0,onReset:ib,onRedeemCode:N1,onOpenGuide:()=>e.openGuide(),autoAssignEnabled:fo,onToggleAutoAssign:gb,autoSkipSpiritTest:fi,onToggleAutoSkip:yb,skipChildGiftPopups:mo,onToggleSkipChildGiftPopups:bb,skipZhaozhou:G,onToggleSkipZhaozhou:vb,skipShuraFieldEvents:rn,onToggleSkipShuraFieldEvents:Sb,skipRomanceGiftPopups:rr,onToggleSkipRomanceGiftPopups:wb,skipJealousyPopups:go,onToggleSkipJealousyPopups:kb,isPortraitViewport:Kr,isOrientationFixApplied:fr,onRequestPortraitFix:L1,onReleasePortraitFix:$1,onAutoAssignSpouses:hb,gameState:{player:c,children:Z,fallenChildren:re,activeNpcs:k,deadNpcs:T,gameStage:en,logs:Is,inventory:l,messages:((h0=Ct==null?void 0:Ct.toJSON)==null?void 0:h0.call(Ct))||{},lastMessageCheck:mi,pendingSectChoices:gi,testQueue:zs,worldEvents:(c==null?void 0:c.worldEvents)||[],newsBuffer:(c==null?void 0:c.newsBuffer)||[]}}),tr==="LOG"&&r.jsx(Ij,{logs:Is,ratingSummary:ki,onUpgradeRating:B1}),tr==="PLAYER"&&r.jsx(cC,{player:c,childFeedback:_1,onOpenInventory:()=>e.openInventory("VIEW"),onAllocateSkillPoint:Ob})]}),r.jsx(BC,{modalState:t,closeModal:M1,player:c,inventory:l,handleGiftConfirm:V1,handleNegotiateConfirm:Y1,handleShopPurchase:J1,handleOptionSelect:t0,handleShuraFieldSelect:q1,handleBuyAuctionItem:O1,handleShowAuctionPlot:P1,modalMgr:e,allChildren:Z,visibleChildren:mn,handleEquipToChild:s0,handleUseConsumable:kd,handleBatchUseConsumables:Eb,handleDiscardFromInventory:G1,handleGiveToChild:Ab,handleBatchGiveToChildren:Nb,handleSell:U1,handleAutoAssignManualToChild:$b,getMarketPrice:Zf,testQueue:zs,handleTestFinish:db,handleTestQueueClose:Lb,childSelectorModal:Ds,handleChildSelectorSelect:Mb,closeChildSelectorModal:Qa,selectedChild:ce,childNavigationMeta:nd,handleNavigateChild:rd,handleChildAction:mb,setSelectedChild:Oe,showSpouseSelection:S1,marryingChild:Ga,spouseCandidates:w1,handleSpouseSelect:fb,resetSpouseSelection:jb,batchGiftEvents:k1,handleBatchGiftConfirm:Cb,handleBatchGiftClose:Tb,batchPromotionEvents:E1,handleBatchPromotionConfirm:Ib,handleBatchPromotionClose:Rb,batchMarriagePlans:j1,handleBatchMarriageConfirm:xb,handleBatchMarriageClose:_b,handleBatchManualAssign:Bb}),r.jsx(IE,{activeTab:tr,onTabChange:Jc}),r.jsx(tT,{isAuto:nn,autoSpeed:Rs,player:c,messageUnreadCount:Ct.getUnreadCount(),onToggleAuto:()=>nr(!nn),onSetAutoSpeed:Xc,onNextMonth:Sd,onOpenGazette:()=>{console.log(":",{currentGazette:Fa,gazetteHistory:c.gazetteHistory,hasUnreadGazette:c.hasUnreadGazette}),e.openGazette()},onOpenMessageCenter:()=>e.openMessageCenter(),onMarkGazetteRead:()=>x({hasUnreadGazette:!1})}),r.jsx(YC,{selectedNpc:N,setSelectedNpc:z,handleOptionSelect:t0,player:c,visibleChildren:mn,visibleNpcs:L,activeNpcs:k,modalMgr:e,addLog:Be,showResult:ee,cutTiesWithNpc:q,handleToggleNpcLetterAcceptance:rb,messages:v1,messageManager:Ct,setMessages:Ps,handleSendMessageReply:R1,combatData:di,handleCombatClose:Da,isExploring:sd,exploreRealmState:pi,exploreProgress:Oa,currentExploreEvent:Tr,exploreLog:id,inventory:l,setExploreLog:Ls,handleExplorationOption:ld,handleStartCombat:cd,setExploreProgress:Pa,setCurrentExploreEvent:$s,setIsExploring:ui,getBossEvent:cE,getRandomExplorationEvent:kg,pendingSectChoices:gi,setPendingSectChoices:hi,handleAssignSect:ub,handleCloseTutorial:C1,handleCompleteTutorial:T1,handleCloseGuide:I1,currentGazette:Fa,setSelectedWorldNpc:ne,selectedWorldNpc:K,handleInviteWorldNpc:eb,handleChallengeWorldNpc:tb})]})}Eu.createRoot(document.getElementById("root")).render(r.jsx(_c.StrictMode,{children:r.jsx(jT,{})}));
