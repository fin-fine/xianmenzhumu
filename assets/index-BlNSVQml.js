var ev=Object.defineProperty;var tv=(e,t,n)=>t in e?ev(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n;var B0=(e,t,n)=>tv(e,typeof t!="symbol"?t+"":t,n);import{g as qo,a as Bp,i as nv,c as mh,b as rv,d as sv,e as gh,f as ov,h as iv}from"./saveSystem-D2VifvcS.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))s(o);new MutationObserver(o=>{for(const i of o)if(i.type==="childList")for(const a of i.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&s(a)}).observe(document,{childList:!0,subtree:!0});function n(o){const i={};return o.integrity&&(i.integrity=o.integrity),o.referrerPolicy&&(i.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?i.credentials="include":o.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function s(o){if(o.ep)return;o.ep=!0;const i=n(o);fetch(o.href,i)}})();function av(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var hh={exports:{}},Lc={},xh={exports:{}},ot={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var _a=Symbol.for("react.element"),lv=Symbol.for("react.portal"),cv=Symbol.for("react.fragment"),dv=Symbol.for("react.strict_mode"),uv=Symbol.for("react.profiler"),pv=Symbol.for("react.provider"),fv=Symbol.for("react.context"),mv=Symbol.for("react.forward_ref"),gv=Symbol.for("react.suspense"),hv=Symbol.for("react.memo"),xv=Symbol.for("react.lazy"),O0=Symbol.iterator;function yv(e){return e===null||typeof e!="object"?null:(e=O0&&e[O0]||e["@@iterator"],typeof e=="function"?e:null)}var yh={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},bh=Object.assign,vh={};function si(e,t,n){this.props=e,this.context=t,this.refs=vh,this.updater=n||yh}si.prototype.isReactComponent={};si.prototype.setState=function(e,t){if(typeof e!="object"&&typeof e!="function"&&e!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,e,t,"setState")};si.prototype.forceUpdate=function(e){this.updater.enqueueForceUpdate(this,e,"forceUpdate")};function Sh(){}Sh.prototype=si.prototype;function Op(e,t,n){this.props=e,this.context=t,this.refs=vh,this.updater=n||yh}var Pp=Op.prototype=new Sh;Pp.constructor=Op;bh(Pp,si.prototype);Pp.isPureReactComponent=!0;var P0=Array.isArray,wh=Object.prototype.hasOwnProperty,zp={current:null},Eh={key:!0,ref:!0,__self:!0,__source:!0};function kh(e,t,n){var s,o={},i=null,a=null;if(t!=null)for(s in t.ref!==void 0&&(a=t.ref),t.key!==void 0&&(i=""+t.key),t)wh.call(t,s)&&!Eh.hasOwnProperty(s)&&(o[s]=t[s]);var l=arguments.length-2;if(l===1)o.children=n;else if(1<l){for(var d=Array(l),u=0;u<l;u++)d[u]=arguments[u+2];o.children=d}if(e&&e.defaultProps)for(s in l=e.defaultProps,l)o[s]===void 0&&(o[s]=l[s]);return{$$typeof:_a,type:e,key:i,ref:a,props:o,_owner:zp.current}}function bv(e,t){return{$$typeof:_a,type:e.type,key:t,ref:e.ref,props:e.props,_owner:e._owner}}function Dp(e){return typeof e=="object"&&e!==null&&e.$$typeof===_a}function vv(e){var t={"=":"=0",":":"=2"};return"$"+e.replace(/[=:]/g,function(n){return t[n]})}var z0=/\/+/g;function Ld(e,t){return typeof e=="object"&&e!==null&&e.key!=null?vv(""+e.key):t.toString(36)}function Nl(e,t,n,s,o){var i=typeof e;(i==="undefined"||i==="boolean")&&(e=null);var a=!1;if(e===null)a=!0;else switch(i){case"string":case"number":a=!0;break;case"object":switch(e.$$typeof){case _a:case lv:a=!0}}if(a)return a=e,o=o(a),e=s===""?"."+Ld(a,0):s,P0(o)?(n="",e!=null&&(n=e.replace(z0,"$&/")+"/"),Nl(o,t,n,"",function(u){return u})):o!=null&&(Dp(o)&&(o=bv(o,n+(!o.key||a&&a.key===o.key?"":(""+o.key).replace(z0,"$&/")+"/")+e)),t.push(o)),1;if(a=0,s=s===""?".":s+":",P0(e))for(var l=0;l<e.length;l++){i=e[l];var d=s+Ld(i,l);a+=Nl(i,t,n,d,o)}else if(d=yv(e),typeof d=="function")for(e=d.call(e),l=0;!(i=e.next()).done;)i=i.value,d=s+Ld(i,l++),a+=Nl(i,t,n,d,o);else if(i==="object")throw t=String(e),Error("Objects are not valid as a React child (found: "+(t==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":t)+"). If you meant to render a collection of children, use an array instead.");return a}function rl(e,t,n){if(e==null)return e;var s=[],o=0;return Nl(e,s,"","",function(i){return t.call(n,i,o++)}),s}function Sv(e){if(e._status===-1){var t=e._result;t=t(),t.then(function(n){(e._status===0||e._status===-1)&&(e._status=1,e._result=n)},function(n){(e._status===0||e._status===-1)&&(e._status=2,e._result=n)}),e._status===-1&&(e._status=0,e._result=t)}if(e._status===1)return e._result.default;throw e._result}var Sn={current:null},Ll={transition:null},wv={ReactCurrentDispatcher:Sn,ReactCurrentBatchConfig:Ll,ReactCurrentOwner:zp};function jh(){throw Error("act(...) is not supported in production builds of React.")}ot.Children={map:rl,forEach:function(e,t,n){rl(e,function(){t.apply(this,arguments)},n)},count:function(e){var t=0;return rl(e,function(){t++}),t},toArray:function(e){return rl(e,function(t){return t})||[]},only:function(e){if(!Dp(e))throw Error("React.Children.only expected to receive a single React element child.");return e}};ot.Component=si;ot.Fragment=cv;ot.Profiler=uv;ot.PureComponent=Op;ot.StrictMode=dv;ot.Suspense=gv;ot.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=wv;ot.act=jh;ot.cloneElement=function(e,t,n){if(e==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+e+".");var s=bh({},e.props),o=e.key,i=e.ref,a=e._owner;if(t!=null){if(t.ref!==void 0&&(i=t.ref,a=zp.current),t.key!==void 0&&(o=""+t.key),e.type&&e.type.defaultProps)var l=e.type.defaultProps;for(d in t)wh.call(t,d)&&!Eh.hasOwnProperty(d)&&(s[d]=t[d]===void 0&&l!==void 0?l[d]:t[d])}var d=arguments.length-2;if(d===1)s.children=n;else if(1<d){l=Array(d);for(var u=0;u<d;u++)l[u]=arguments[u+2];s.children=l}return{$$typeof:_a,type:e.type,key:o,ref:i,props:s,_owner:a}};ot.createContext=function(e){return e={$$typeof:fv,_currentValue:e,_currentValue2:e,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},e.Provider={$$typeof:pv,_context:e},e.Consumer=e};ot.createElement=kh;ot.createFactory=function(e){var t=kh.bind(null,e);return t.type=e,t};ot.createRef=function(){return{current:null}};ot.forwardRef=function(e){return{$$typeof:mv,render:e}};ot.isValidElement=Dp;ot.lazy=function(e){return{$$typeof:xv,_payload:{_status:-1,_result:e},_init:Sv}};ot.memo=function(e,t){return{$$typeof:hv,type:e,compare:t===void 0?null:t}};ot.startTransition=function(e){var t=Ll.transition;Ll.transition={};try{e()}finally{Ll.transition=t}};ot.unstable_act=jh;ot.useCallback=function(e,t){return Sn.current.useCallback(e,t)};ot.useContext=function(e){return Sn.current.useContext(e)};ot.useDebugValue=function(){};ot.useDeferredValue=function(e){return Sn.current.useDeferredValue(e)};ot.useEffect=function(e,t){return Sn.current.useEffect(e,t)};ot.useId=function(){return Sn.current.useId()};ot.useImperativeHandle=function(e,t,n){return Sn.current.useImperativeHandle(e,t,n)};ot.useInsertionEffect=function(e,t){return Sn.current.useInsertionEffect(e,t)};ot.useLayoutEffect=function(e,t){return Sn.current.useLayoutEffect(e,t)};ot.useMemo=function(e,t){return Sn.current.useMemo(e,t)};ot.useReducer=function(e,t,n){return Sn.current.useReducer(e,t,n)};ot.useRef=function(e){return Sn.current.useRef(e)};ot.useState=function(e){return Sn.current.useState(e)};ot.useSyncExternalStore=function(e,t,n){return Sn.current.useSyncExternalStore(e,t,n)};ot.useTransition=function(){return Sn.current.useTransition()};ot.version="18.3.1";xh.exports=ot;var b=xh.exports;const $c=av(b);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Ev=b,kv=Symbol.for("react.element"),jv=Symbol.for("react.fragment"),Cv=Object.prototype.hasOwnProperty,Tv=Ev.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,Iv={key:!0,ref:!0,__self:!0,__source:!0};function Ch(e,t,n){var s,o={},i=null,a=null;n!==void 0&&(i=""+n),t.key!==void 0&&(i=""+t.key),t.ref!==void 0&&(a=t.ref);for(s in t)Cv.call(t,s)&&!Iv.hasOwnProperty(s)&&(o[s]=t[s]);if(e&&e.defaultProps)for(s in t=e.defaultProps,t)o[s]===void 0&&(o[s]=t[s]);return{$$typeof:kv,type:e,key:i,ref:a,props:o,_owner:Tv.current}}Lc.Fragment=jv;Lc.jsx=Ch;Lc.jsxs=Ch;hh.exports=Lc;var r=hh.exports,Ru={},Th={exports:{}},Fn={},Ih={exports:{}},_h={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(e){function t(J,de){var Ee=J.length;J.push(de);e:for(;0<Ee;){var $e=Ee-1>>>1,De=J[$e];if(0<o(De,de))J[$e]=de,J[Ee]=De,Ee=$e;else break e}}function n(J){return J.length===0?null:J[0]}function s(J){if(J.length===0)return null;var de=J[0],Ee=J.pop();if(Ee!==de){J[0]=Ee;e:for(var $e=0,De=J.length,Qe=De>>>1;$e<Qe;){var Y=2*($e+1)-1,ue=J[Y],ne=Y+1,ce=J[ne];if(0>o(ue,Ee))ne<De&&0>o(ce,ue)?(J[$e]=ce,J[ne]=Ee,$e=ne):(J[$e]=ue,J[Y]=Ee,$e=Y);else if(ne<De&&0>o(ce,Ee))J[$e]=ce,J[ne]=Ee,$e=ne;else break e}}return de}function o(J,de){var Ee=J.sortIndex-de.sortIndex;return Ee!==0?Ee:J.id-de.id}if(typeof performance=="object"&&typeof performance.now=="function"){var i=performance;e.unstable_now=function(){return i.now()}}else{var a=Date,l=a.now();e.unstable_now=function(){return a.now()-l}}var d=[],u=[],p=1,c=null,m=3,v=!1,w=!1,E=!1,S=typeof setTimeout=="function"?setTimeout:null,g=typeof clearTimeout=="function"?clearTimeout:null,h=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function x(J){for(var de=n(u);de!==null;){if(de.callback===null)s(u);else if(de.startTime<=J)s(u),de.sortIndex=de.expirationTime,t(d,de);else break;de=n(u)}}function k(J){if(E=!1,x(J),!w)if(n(d)!==null)w=!0,F(_);else{var de=n(u);de!==null&&se(k,de.startTime-J)}}function _(J,de){w=!1,E&&(E=!1,g(C),C=-1),v=!0;var Ee=m;try{for(x(de),c=n(d);c!==null&&(!(c.expirationTime>de)||J&&!L());){var $e=c.callback;if(typeof $e=="function"){c.callback=null,m=c.priorityLevel;var De=$e(c.expirationTime<=de);de=e.unstable_now(),typeof De=="function"?c.callback=De:c===n(d)&&s(d),x(de)}else s(d);c=n(d)}if(c!==null)var Qe=!0;else{var Y=n(u);Y!==null&&se(k,Y.startTime-de),Qe=!1}return Qe}finally{c=null,m=Ee,v=!1}}var y=!1,R=null,C=-1,I=5,T=-1;function L(){return!(e.unstable_now()-T<I)}function ee(){if(R!==null){var J=e.unstable_now();T=J;var de=!0;try{de=R(!0,J)}finally{de?$():(y=!1,R=null)}}else y=!1}var $;if(typeof h=="function")$=function(){h(ee)};else if(typeof MessageChannel<"u"){var O=new MessageChannel,H=O.port2;O.port1.onmessage=ee,$=function(){H.postMessage(null)}}else $=function(){S(ee,0)};function F(J){R=J,y||(y=!0,$())}function se(J,de){C=S(function(){J(e.unstable_now())},de)}e.unstable_IdlePriority=5,e.unstable_ImmediatePriority=1,e.unstable_LowPriority=4,e.unstable_NormalPriority=3,e.unstable_Profiling=null,e.unstable_UserBlockingPriority=2,e.unstable_cancelCallback=function(J){J.callback=null},e.unstable_continueExecution=function(){w||v||(w=!0,F(_))},e.unstable_forceFrameRate=function(J){0>J||125<J?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):I=0<J?Math.floor(1e3/J):5},e.unstable_getCurrentPriorityLevel=function(){return m},e.unstable_getFirstCallbackNode=function(){return n(d)},e.unstable_next=function(J){switch(m){case 1:case 2:case 3:var de=3;break;default:de=m}var Ee=m;m=de;try{return J()}finally{m=Ee}},e.unstable_pauseExecution=function(){},e.unstable_requestPaint=function(){},e.unstable_runWithPriority=function(J,de){switch(J){case 1:case 2:case 3:case 4:case 5:break;default:J=3}var Ee=m;m=J;try{return de()}finally{m=Ee}},e.unstable_scheduleCallback=function(J,de,Ee){var $e=e.unstable_now();switch(typeof Ee=="object"&&Ee!==null?(Ee=Ee.delay,Ee=typeof Ee=="number"&&0<Ee?$e+Ee:$e):Ee=$e,J){case 1:var De=-1;break;case 2:De=250;break;case 5:De=1073741823;break;case 4:De=1e4;break;default:De=5e3}return De=Ee+De,J={id:p++,callback:de,priorityLevel:J,startTime:Ee,expirationTime:De,sortIndex:-1},Ee>$e?(J.sortIndex=Ee,t(u,J),n(d)===null&&J===n(u)&&(E?(g(C),C=-1):E=!0,se(k,Ee-$e))):(J.sortIndex=De,t(d,J),w||v||(w=!0,F(_))),J},e.unstable_shouldYield=L,e.unstable_wrapCallback=function(J){var de=m;return function(){var Ee=m;m=de;try{return J.apply(this,arguments)}finally{m=Ee}}}})(_h);Ih.exports=_h;var _v=Ih.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Rv=b,Dn=_v;function be(e){for(var t="https://reactjs.org/docs/error-decoder.html?invariant="+e,n=1;n<arguments.length;n++)t+="&args[]="+encodeURIComponent(arguments[n]);return"Minified React error #"+e+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var Rh=new Set,aa={};function io(e,t){Ko(e,t),Ko(e+"Capture",t)}function Ko(e,t){for(aa[e]=t,e=0;e<t.length;e++)Rh.add(t[e])}var Fr=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),Mu=Object.prototype.hasOwnProperty,Mv=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,D0={},F0={};function Av(e){return Mu.call(F0,e)?!0:Mu.call(D0,e)?!1:Mv.test(e)?F0[e]=!0:(D0[e]=!0,!1)}function Nv(e,t,n,s){if(n!==null&&n.type===0)return!1;switch(typeof t){case"function":case"symbol":return!0;case"boolean":return s?!1:n!==null?!n.acceptsBooleans:(e=e.toLowerCase().slice(0,5),e!=="data-"&&e!=="aria-");default:return!1}}function Lv(e,t,n,s){if(t===null||typeof t>"u"||Nv(e,t,n,s))return!0;if(s)return!1;if(n!==null)switch(n.type){case 3:return!t;case 4:return t===!1;case 5:return isNaN(t);case 6:return isNaN(t)||1>t}return!1}function wn(e,t,n,s,o,i,a){this.acceptsBooleans=t===2||t===3||t===4,this.attributeName=s,this.attributeNamespace=o,this.mustUseProperty=n,this.propertyName=e,this.type=t,this.sanitizeURL=i,this.removeEmptyString=a}var sn={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(e){sn[e]=new wn(e,0,!1,e,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(e){var t=e[0];sn[t]=new wn(t,1,!1,e[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(e){sn[e]=new wn(e,2,!1,e.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(e){sn[e]=new wn(e,2,!1,e,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(e){sn[e]=new wn(e,3,!1,e.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(e){sn[e]=new wn(e,3,!0,e,null,!1,!1)});["capture","download"].forEach(function(e){sn[e]=new wn(e,4,!1,e,null,!1,!1)});["cols","rows","size","span"].forEach(function(e){sn[e]=new wn(e,6,!1,e,null,!1,!1)});["rowSpan","start"].forEach(function(e){sn[e]=new wn(e,5,!1,e.toLowerCase(),null,!1,!1)});var Fp=/[\-:]([a-z])/g;function Hp(e){return e[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(e){var t=e.replace(Fp,Hp);sn[t]=new wn(t,1,!1,e,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(e){var t=e.replace(Fp,Hp);sn[t]=new wn(t,1,!1,e,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(e){var t=e.replace(Fp,Hp);sn[t]=new wn(t,1,!1,e,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(e){sn[e]=new wn(e,1,!1,e.toLowerCase(),null,!1,!1)});sn.xlinkHref=new wn("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(e){sn[e]=new wn(e,1,!1,e.toLowerCase(),null,!0,!0)});function Wp(e,t,n,s){var o=sn.hasOwnProperty(t)?sn[t]:null;(o!==null?o.type!==0:s||!(2<t.length)||t[0]!=="o"&&t[0]!=="O"||t[1]!=="n"&&t[1]!=="N")&&(Lv(t,n,o,s)&&(n=null),s||o===null?Av(t)&&(n===null?e.removeAttribute(t):e.setAttribute(t,""+n)):o.mustUseProperty?e[o.propertyName]=n===null?o.type===3?!1:"":n:(t=o.attributeName,s=o.attributeNamespace,n===null?e.removeAttribute(t):(o=o.type,n=o===3||o===4&&n===!0?"":""+n,s?e.setAttributeNS(s,t,n):e.setAttribute(t,n))))}var Vr=Rv.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,sl=Symbol.for("react.element"),To=Symbol.for("react.portal"),Io=Symbol.for("react.fragment"),Up=Symbol.for("react.strict_mode"),Au=Symbol.for("react.profiler"),Mh=Symbol.for("react.provider"),Ah=Symbol.for("react.context"),Gp=Symbol.for("react.forward_ref"),Nu=Symbol.for("react.suspense"),Lu=Symbol.for("react.suspense_list"),Vp=Symbol.for("react.memo"),ns=Symbol.for("react.lazy"),Nh=Symbol.for("react.offscreen"),H0=Symbol.iterator;function Ri(e){return e===null||typeof e!="object"?null:(e=H0&&e[H0]||e["@@iterator"],typeof e=="function"?e:null)}var Nt=Object.assign,$d;function Ui(e){if($d===void 0)try{throw Error()}catch(n){var t=n.stack.trim().match(/\n( *(at )?)/);$d=t&&t[1]||""}return`
`+$d+e}var Bd=!1;function Od(e,t){if(!e||Bd)return"";Bd=!0;var n=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(t)if(t=function(){throw Error()},Object.defineProperty(t.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(t,[])}catch(u){var s=u}Reflect.construct(e,[],t)}else{try{t.call()}catch(u){s=u}e.call(t.prototype)}else{try{throw Error()}catch(u){s=u}e()}}catch(u){if(u&&s&&typeof u.stack=="string"){for(var o=u.stack.split(`
`),i=s.stack.split(`
`),a=o.length-1,l=i.length-1;1<=a&&0<=l&&o[a]!==i[l];)l--;for(;1<=a&&0<=l;a--,l--)if(o[a]!==i[l]){if(a!==1||l!==1)do if(a--,l--,0>l||o[a]!==i[l]){var d=`
`+o[a].replace(" at new "," at ");return e.displayName&&d.includes("<anonymous>")&&(d=d.replace("<anonymous>",e.displayName)),d}while(1<=a&&0<=l);break}}}finally{Bd=!1,Error.prepareStackTrace=n}return(e=e?e.displayName||e.name:"")?Ui(e):""}function $v(e){switch(e.tag){case 5:return Ui(e.type);case 16:return Ui("Lazy");case 13:return Ui("Suspense");case 19:return Ui("SuspenseList");case 0:case 2:case 15:return e=Od(e.type,!1),e;case 11:return e=Od(e.type.render,!1),e;case 1:return e=Od(e.type,!0),e;default:return""}}function $u(e){if(e==null)return null;if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e;switch(e){case Io:return"Fragment";case To:return"Portal";case Au:return"Profiler";case Up:return"StrictMode";case Nu:return"Suspense";case Lu:return"SuspenseList"}if(typeof e=="object")switch(e.$$typeof){case Ah:return(e.displayName||"Context")+".Consumer";case Mh:return(e._context.displayName||"Context")+".Provider";case Gp:var t=e.render;return e=e.displayName,e||(e=t.displayName||t.name||"",e=e!==""?"ForwardRef("+e+")":"ForwardRef"),e;case Vp:return t=e.displayName||null,t!==null?t:$u(e.type)||"Memo";case ns:t=e._payload,e=e._init;try{return $u(e(t))}catch{}}return null}function Bv(e){var t=e.type;switch(e.tag){case 24:return"Cache";case 9:return(t.displayName||"Context")+".Consumer";case 10:return(t._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return e=t.render,e=e.displayName||e.name||"",t.displayName||(e!==""?"ForwardRef("+e+")":"ForwardRef");case 7:return"Fragment";case 5:return t;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return $u(t);case 8:return t===Up?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof t=="function")return t.displayName||t.name||null;if(typeof t=="string")return t}return null}function bs(e){switch(typeof e){case"boolean":case"number":case"string":case"undefined":return e;case"object":return e;default:return""}}function Lh(e){var t=e.type;return(e=e.nodeName)&&e.toLowerCase()==="input"&&(t==="checkbox"||t==="radio")}function Ov(e){var t=Lh(e)?"checked":"value",n=Object.getOwnPropertyDescriptor(e.constructor.prototype,t),s=""+e[t];if(!e.hasOwnProperty(t)&&typeof n<"u"&&typeof n.get=="function"&&typeof n.set=="function"){var o=n.get,i=n.set;return Object.defineProperty(e,t,{configurable:!0,get:function(){return o.call(this)},set:function(a){s=""+a,i.call(this,a)}}),Object.defineProperty(e,t,{enumerable:n.enumerable}),{getValue:function(){return s},setValue:function(a){s=""+a},stopTracking:function(){e._valueTracker=null,delete e[t]}}}}function ol(e){e._valueTracker||(e._valueTracker=Ov(e))}function $h(e){if(!e)return!1;var t=e._valueTracker;if(!t)return!0;var n=t.getValue(),s="";return e&&(s=Lh(e)?e.checked?"true":"false":e.value),e=s,e!==n?(t.setValue(e),!0):!1}function Xl(e){if(e=e||(typeof document<"u"?document:void 0),typeof e>"u")return null;try{return e.activeElement||e.body}catch{return e.body}}function Bu(e,t){var n=t.checked;return Nt({},t,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:n??e._wrapperState.initialChecked})}function W0(e,t){var n=t.defaultValue==null?"":t.defaultValue,s=t.checked!=null?t.checked:t.defaultChecked;n=bs(t.value!=null?t.value:n),e._wrapperState={initialChecked:s,initialValue:n,controlled:t.type==="checkbox"||t.type==="radio"?t.checked!=null:t.value!=null}}function Bh(e,t){t=t.checked,t!=null&&Wp(e,"checked",t,!1)}function Ou(e,t){Bh(e,t);var n=bs(t.value),s=t.type;if(n!=null)s==="number"?(n===0&&e.value===""||e.value!=n)&&(e.value=""+n):e.value!==""+n&&(e.value=""+n);else if(s==="submit"||s==="reset"){e.removeAttribute("value");return}t.hasOwnProperty("value")?Pu(e,t.type,n):t.hasOwnProperty("defaultValue")&&Pu(e,t.type,bs(t.defaultValue)),t.checked==null&&t.defaultChecked!=null&&(e.defaultChecked=!!t.defaultChecked)}function U0(e,t,n){if(t.hasOwnProperty("value")||t.hasOwnProperty("defaultValue")){var s=t.type;if(!(s!=="submit"&&s!=="reset"||t.value!==void 0&&t.value!==null))return;t=""+e._wrapperState.initialValue,n||t===e.value||(e.value=t),e.defaultValue=t}n=e.name,n!==""&&(e.name=""),e.defaultChecked=!!e._wrapperState.initialChecked,n!==""&&(e.name=n)}function Pu(e,t,n){(t!=="number"||Xl(e.ownerDocument)!==e)&&(n==null?e.defaultValue=""+e._wrapperState.initialValue:e.defaultValue!==""+n&&(e.defaultValue=""+n))}var Gi=Array.isArray;function zo(e,t,n,s){if(e=e.options,t){t={};for(var o=0;o<n.length;o++)t["$"+n[o]]=!0;for(n=0;n<e.length;n++)o=t.hasOwnProperty("$"+e[n].value),e[n].selected!==o&&(e[n].selected=o),o&&s&&(e[n].defaultSelected=!0)}else{for(n=""+bs(n),t=null,o=0;o<e.length;o++){if(e[o].value===n){e[o].selected=!0,s&&(e[o].defaultSelected=!0);return}t!==null||e[o].disabled||(t=e[o])}t!==null&&(t.selected=!0)}}function zu(e,t){if(t.dangerouslySetInnerHTML!=null)throw Error(be(91));return Nt({},t,{value:void 0,defaultValue:void 0,children:""+e._wrapperState.initialValue})}function G0(e,t){var n=t.value;if(n==null){if(n=t.children,t=t.defaultValue,n!=null){if(t!=null)throw Error(be(92));if(Gi(n)){if(1<n.length)throw Error(be(93));n=n[0]}t=n}t==null&&(t=""),n=t}e._wrapperState={initialValue:bs(n)}}function Oh(e,t){var n=bs(t.value),s=bs(t.defaultValue);n!=null&&(n=""+n,n!==e.value&&(e.value=n),t.defaultValue==null&&e.defaultValue!==n&&(e.defaultValue=n)),s!=null&&(e.defaultValue=""+s)}function V0(e){var t=e.textContent;t===e._wrapperState.initialValue&&t!==""&&t!==null&&(e.value=t)}function Ph(e){switch(e){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function Du(e,t){return e==null||e==="http://www.w3.org/1999/xhtml"?Ph(t):e==="http://www.w3.org/2000/svg"&&t==="foreignObject"?"http://www.w3.org/1999/xhtml":e}var il,zh=function(e){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(t,n,s,o){MSApp.execUnsafeLocalFunction(function(){return e(t,n,s,o)})}:e}(function(e,t){if(e.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in e)e.innerHTML=t;else{for(il=il||document.createElement("div"),il.innerHTML="<svg>"+t.valueOf().toString()+"</svg>",t=il.firstChild;e.firstChild;)e.removeChild(e.firstChild);for(;t.firstChild;)e.appendChild(t.firstChild)}});function la(e,t){if(t){var n=e.firstChild;if(n&&n===e.lastChild&&n.nodeType===3){n.nodeValue=t;return}}e.textContent=t}var Ji={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},Pv=["Webkit","ms","Moz","O"];Object.keys(Ji).forEach(function(e){Pv.forEach(function(t){t=t+e.charAt(0).toUpperCase()+e.substring(1),Ji[t]=Ji[e]})});function Dh(e,t,n){return t==null||typeof t=="boolean"||t===""?"":n||typeof t!="number"||t===0||Ji.hasOwnProperty(e)&&Ji[e]?(""+t).trim():t+"px"}function Fh(e,t){e=e.style;for(var n in t)if(t.hasOwnProperty(n)){var s=n.indexOf("--")===0,o=Dh(n,t[n],s);n==="float"&&(n="cssFloat"),s?e.setProperty(n,o):e[n]=o}}var zv=Nt({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function Fu(e,t){if(t){if(zv[e]&&(t.children!=null||t.dangerouslySetInnerHTML!=null))throw Error(be(137,e));if(t.dangerouslySetInnerHTML!=null){if(t.children!=null)throw Error(be(60));if(typeof t.dangerouslySetInnerHTML!="object"||!("__html"in t.dangerouslySetInnerHTML))throw Error(be(61))}if(t.style!=null&&typeof t.style!="object")throw Error(be(62))}}function Hu(e,t){if(e.indexOf("-")===-1)return typeof t.is=="string";switch(e){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var Wu=null;function Yp(e){return e=e.target||e.srcElement||window,e.correspondingUseElement&&(e=e.correspondingUseElement),e.nodeType===3?e.parentNode:e}var Uu=null,Do=null,Fo=null;function Y0(e){if(e=Aa(e)){if(typeof Uu!="function")throw Error(be(280));var t=e.stateNode;t&&(t=Dc(t),Uu(e.stateNode,e.type,t))}}function Hh(e){Do?Fo?Fo.push(e):Fo=[e]:Do=e}function Wh(){if(Do){var e=Do,t=Fo;if(Fo=Do=null,Y0(e),t)for(e=0;e<t.length;e++)Y0(t[e])}}function Uh(e,t){return e(t)}function Gh(){}var Pd=!1;function Vh(e,t,n){if(Pd)return e(t,n);Pd=!0;try{return Uh(e,t,n)}finally{Pd=!1,(Do!==null||Fo!==null)&&(Gh(),Wh())}}function ca(e,t){var n=e.stateNode;if(n===null)return null;var s=Dc(n);if(s===null)return null;n=s[t];e:switch(t){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(s=!s.disabled)||(e=e.type,s=!(e==="button"||e==="input"||e==="select"||e==="textarea")),e=!s;break e;default:e=!1}if(e)return null;if(n&&typeof n!="function")throw Error(be(231,t,typeof n));return n}var Gu=!1;if(Fr)try{var Mi={};Object.defineProperty(Mi,"passive",{get:function(){Gu=!0}}),window.addEventListener("test",Mi,Mi),window.removeEventListener("test",Mi,Mi)}catch{Gu=!1}function Dv(e,t,n,s,o,i,a,l,d){var u=Array.prototype.slice.call(arguments,3);try{t.apply(n,u)}catch(p){this.onError(p)}}var Xi=!1,Zl=null,ec=!1,Vu=null,Fv={onError:function(e){Xi=!0,Zl=e}};function Hv(e,t,n,s,o,i,a,l,d){Xi=!1,Zl=null,Dv.apply(Fv,arguments)}function Wv(e,t,n,s,o,i,a,l,d){if(Hv.apply(this,arguments),Xi){if(Xi){var u=Zl;Xi=!1,Zl=null}else throw Error(be(198));ec||(ec=!0,Vu=u)}}function ao(e){var t=e,n=e;if(e.alternate)for(;t.return;)t=t.return;else{e=t;do t=e,t.flags&4098&&(n=t.return),e=t.return;while(e)}return t.tag===3?n:null}function Yh(e){if(e.tag===13){var t=e.memoizedState;if(t===null&&(e=e.alternate,e!==null&&(t=e.memoizedState)),t!==null)return t.dehydrated}return null}function q0(e){if(ao(e)!==e)throw Error(be(188))}function Uv(e){var t=e.alternate;if(!t){if(t=ao(e),t===null)throw Error(be(188));return t!==e?null:e}for(var n=e,s=t;;){var o=n.return;if(o===null)break;var i=o.alternate;if(i===null){if(s=o.return,s!==null){n=s;continue}break}if(o.child===i.child){for(i=o.child;i;){if(i===n)return q0(o),e;if(i===s)return q0(o),t;i=i.sibling}throw Error(be(188))}if(n.return!==s.return)n=o,s=i;else{for(var a=!1,l=o.child;l;){if(l===n){a=!0,n=o,s=i;break}if(l===s){a=!0,s=o,n=i;break}l=l.sibling}if(!a){for(l=i.child;l;){if(l===n){a=!0,n=i,s=o;break}if(l===s){a=!0,s=i,n=o;break}l=l.sibling}if(!a)throw Error(be(189))}}if(n.alternate!==s)throw Error(be(190))}if(n.tag!==3)throw Error(be(188));return n.stateNode.current===n?e:t}function qh(e){return e=Uv(e),e!==null?Kh(e):null}function Kh(e){if(e.tag===5||e.tag===6)return e;for(e=e.child;e!==null;){var t=Kh(e);if(t!==null)return t;e=e.sibling}return null}var Qh=Dn.unstable_scheduleCallback,K0=Dn.unstable_cancelCallback,Gv=Dn.unstable_shouldYield,Vv=Dn.unstable_requestPaint,zt=Dn.unstable_now,Yv=Dn.unstable_getCurrentPriorityLevel,qp=Dn.unstable_ImmediatePriority,Jh=Dn.unstable_UserBlockingPriority,tc=Dn.unstable_NormalPriority,qv=Dn.unstable_LowPriority,Xh=Dn.unstable_IdlePriority,Bc=null,kr=null;function Kv(e){if(kr&&typeof kr.onCommitFiberRoot=="function")try{kr.onCommitFiberRoot(Bc,e,void 0,(e.current.flags&128)===128)}catch{}}var dr=Math.clz32?Math.clz32:Xv,Qv=Math.log,Jv=Math.LN2;function Xv(e){return e>>>=0,e===0?32:31-(Qv(e)/Jv|0)|0}var al=64,ll=4194304;function Vi(e){switch(e&-e){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return e&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return e}}function nc(e,t){var n=e.pendingLanes;if(n===0)return 0;var s=0,o=e.suspendedLanes,i=e.pingedLanes,a=n&268435455;if(a!==0){var l=a&~o;l!==0?s=Vi(l):(i&=a,i!==0&&(s=Vi(i)))}else a=n&~o,a!==0?s=Vi(a):i!==0&&(s=Vi(i));if(s===0)return 0;if(t!==0&&t!==s&&!(t&o)&&(o=s&-s,i=t&-t,o>=i||o===16&&(i&4194240)!==0))return t;if(s&4&&(s|=n&16),t=e.entangledLanes,t!==0)for(e=e.entanglements,t&=s;0<t;)n=31-dr(t),o=1<<n,s|=e[n],t&=~o;return s}function Zv(e,t){switch(e){case 1:case 2:case 4:return t+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function eS(e,t){for(var n=e.suspendedLanes,s=e.pingedLanes,o=e.expirationTimes,i=e.pendingLanes;0<i;){var a=31-dr(i),l=1<<a,d=o[a];d===-1?(!(l&n)||l&s)&&(o[a]=Zv(l,t)):d<=t&&(e.expiredLanes|=l),i&=~l}}function Yu(e){return e=e.pendingLanes&-1073741825,e!==0?e:e&1073741824?1073741824:0}function Zh(){var e=al;return al<<=1,!(al&4194240)&&(al=64),e}function zd(e){for(var t=[],n=0;31>n;n++)t.push(e);return t}function Ra(e,t,n){e.pendingLanes|=t,t!==536870912&&(e.suspendedLanes=0,e.pingedLanes=0),e=e.eventTimes,t=31-dr(t),e[t]=n}function tS(e,t){var n=e.pendingLanes&~t;e.pendingLanes=t,e.suspendedLanes=0,e.pingedLanes=0,e.expiredLanes&=t,e.mutableReadLanes&=t,e.entangledLanes&=t,t=e.entanglements;var s=e.eventTimes;for(e=e.expirationTimes;0<n;){var o=31-dr(n),i=1<<o;t[o]=0,s[o]=-1,e[o]=-1,n&=~i}}function Kp(e,t){var n=e.entangledLanes|=t;for(e=e.entanglements;n;){var s=31-dr(n),o=1<<s;o&t|e[s]&t&&(e[s]|=t),n&=~o}}var xt=0;function ex(e){return e&=-e,1<e?4<e?e&268435455?16:536870912:4:1}var tx,Qp,nx,rx,sx,qu=!1,cl=[],ds=null,us=null,ps=null,da=new Map,ua=new Map,os=[],nS="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function Q0(e,t){switch(e){case"focusin":case"focusout":ds=null;break;case"dragenter":case"dragleave":us=null;break;case"mouseover":case"mouseout":ps=null;break;case"pointerover":case"pointerout":da.delete(t.pointerId);break;case"gotpointercapture":case"lostpointercapture":ua.delete(t.pointerId)}}function Ai(e,t,n,s,o,i){return e===null||e.nativeEvent!==i?(e={blockedOn:t,domEventName:n,eventSystemFlags:s,nativeEvent:i,targetContainers:[o]},t!==null&&(t=Aa(t),t!==null&&Qp(t)),e):(e.eventSystemFlags|=s,t=e.targetContainers,o!==null&&t.indexOf(o)===-1&&t.push(o),e)}function rS(e,t,n,s,o){switch(t){case"focusin":return ds=Ai(ds,e,t,n,s,o),!0;case"dragenter":return us=Ai(us,e,t,n,s,o),!0;case"mouseover":return ps=Ai(ps,e,t,n,s,o),!0;case"pointerover":var i=o.pointerId;return da.set(i,Ai(da.get(i)||null,e,t,n,s,o)),!0;case"gotpointercapture":return i=o.pointerId,ua.set(i,Ai(ua.get(i)||null,e,t,n,s,o)),!0}return!1}function ox(e){var t=Hs(e.target);if(t!==null){var n=ao(t);if(n!==null){if(t=n.tag,t===13){if(t=Yh(n),t!==null){e.blockedOn=t,sx(e.priority,function(){nx(n)});return}}else if(t===3&&n.stateNode.current.memoizedState.isDehydrated){e.blockedOn=n.tag===3?n.stateNode.containerInfo:null;return}}}e.blockedOn=null}function $l(e){if(e.blockedOn!==null)return!1;for(var t=e.targetContainers;0<t.length;){var n=Ku(e.domEventName,e.eventSystemFlags,t[0],e.nativeEvent);if(n===null){n=e.nativeEvent;var s=new n.constructor(n.type,n);Wu=s,n.target.dispatchEvent(s),Wu=null}else return t=Aa(n),t!==null&&Qp(t),e.blockedOn=n,!1;t.shift()}return!0}function J0(e,t,n){$l(e)&&n.delete(t)}function sS(){qu=!1,ds!==null&&$l(ds)&&(ds=null),us!==null&&$l(us)&&(us=null),ps!==null&&$l(ps)&&(ps=null),da.forEach(J0),ua.forEach(J0)}function Ni(e,t){e.blockedOn===t&&(e.blockedOn=null,qu||(qu=!0,Dn.unstable_scheduleCallback(Dn.unstable_NormalPriority,sS)))}function pa(e){function t(o){return Ni(o,e)}if(0<cl.length){Ni(cl[0],e);for(var n=1;n<cl.length;n++){var s=cl[n];s.blockedOn===e&&(s.blockedOn=null)}}for(ds!==null&&Ni(ds,e),us!==null&&Ni(us,e),ps!==null&&Ni(ps,e),da.forEach(t),ua.forEach(t),n=0;n<os.length;n++)s=os[n],s.blockedOn===e&&(s.blockedOn=null);for(;0<os.length&&(n=os[0],n.blockedOn===null);)ox(n),n.blockedOn===null&&os.shift()}var Ho=Vr.ReactCurrentBatchConfig,rc=!0;function oS(e,t,n,s){var o=xt,i=Ho.transition;Ho.transition=null;try{xt=1,Jp(e,t,n,s)}finally{xt=o,Ho.transition=i}}function iS(e,t,n,s){var o=xt,i=Ho.transition;Ho.transition=null;try{xt=4,Jp(e,t,n,s)}finally{xt=o,Ho.transition=i}}function Jp(e,t,n,s){if(rc){var o=Ku(e,t,n,s);if(o===null)Kd(e,t,s,sc,n),Q0(e,s);else if(rS(o,e,t,n,s))s.stopPropagation();else if(Q0(e,s),t&4&&-1<nS.indexOf(e)){for(;o!==null;){var i=Aa(o);if(i!==null&&tx(i),i=Ku(e,t,n,s),i===null&&Kd(e,t,s,sc,n),i===o)break;o=i}o!==null&&s.stopPropagation()}else Kd(e,t,s,null,n)}}var sc=null;function Ku(e,t,n,s){if(sc=null,e=Yp(s),e=Hs(e),e!==null)if(t=ao(e),t===null)e=null;else if(n=t.tag,n===13){if(e=Yh(t),e!==null)return e;e=null}else if(n===3){if(t.stateNode.current.memoizedState.isDehydrated)return t.tag===3?t.stateNode.containerInfo:null;e=null}else t!==e&&(e=null);return sc=e,null}function ix(e){switch(e){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(Yv()){case qp:return 1;case Jh:return 4;case tc:case qv:return 16;case Xh:return 536870912;default:return 16}default:return 16}}var as=null,Xp=null,Bl=null;function ax(){if(Bl)return Bl;var e,t=Xp,n=t.length,s,o="value"in as?as.value:as.textContent,i=o.length;for(e=0;e<n&&t[e]===o[e];e++);var a=n-e;for(s=1;s<=a&&t[n-s]===o[i-s];s++);return Bl=o.slice(e,1<s?1-s:void 0)}function Ol(e){var t=e.keyCode;return"charCode"in e?(e=e.charCode,e===0&&t===13&&(e=13)):e=t,e===10&&(e=13),32<=e||e===13?e:0}function dl(){return!0}function X0(){return!1}function Hn(e){function t(n,s,o,i,a){this._reactName=n,this._targetInst=o,this.type=s,this.nativeEvent=i,this.target=a,this.currentTarget=null;for(var l in e)e.hasOwnProperty(l)&&(n=e[l],this[l]=n?n(i):i[l]);return this.isDefaultPrevented=(i.defaultPrevented!=null?i.defaultPrevented:i.returnValue===!1)?dl:X0,this.isPropagationStopped=X0,this}return Nt(t.prototype,{preventDefault:function(){this.defaultPrevented=!0;var n=this.nativeEvent;n&&(n.preventDefault?n.preventDefault():typeof n.returnValue!="unknown"&&(n.returnValue=!1),this.isDefaultPrevented=dl)},stopPropagation:function(){var n=this.nativeEvent;n&&(n.stopPropagation?n.stopPropagation():typeof n.cancelBubble!="unknown"&&(n.cancelBubble=!0),this.isPropagationStopped=dl)},persist:function(){},isPersistent:dl}),t}var oi={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(e){return e.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},Zp=Hn(oi),Ma=Nt({},oi,{view:0,detail:0}),aS=Hn(Ma),Dd,Fd,Li,Oc=Nt({},Ma,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:ef,button:0,buttons:0,relatedTarget:function(e){return e.relatedTarget===void 0?e.fromElement===e.srcElement?e.toElement:e.fromElement:e.relatedTarget},movementX:function(e){return"movementX"in e?e.movementX:(e!==Li&&(Li&&e.type==="mousemove"?(Dd=e.screenX-Li.screenX,Fd=e.screenY-Li.screenY):Fd=Dd=0,Li=e),Dd)},movementY:function(e){return"movementY"in e?e.movementY:Fd}}),Z0=Hn(Oc),lS=Nt({},Oc,{dataTransfer:0}),cS=Hn(lS),dS=Nt({},Ma,{relatedTarget:0}),Hd=Hn(dS),uS=Nt({},oi,{animationName:0,elapsedTime:0,pseudoElement:0}),pS=Hn(uS),fS=Nt({},oi,{clipboardData:function(e){return"clipboardData"in e?e.clipboardData:window.clipboardData}}),mS=Hn(fS),gS=Nt({},oi,{data:0}),em=Hn(gS),hS={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},xS={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},yS={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function bS(e){var t=this.nativeEvent;return t.getModifierState?t.getModifierState(e):(e=yS[e])?!!t[e]:!1}function ef(){return bS}var vS=Nt({},Ma,{key:function(e){if(e.key){var t=hS[e.key]||e.key;if(t!=="Unidentified")return t}return e.type==="keypress"?(e=Ol(e),e===13?"Enter":String.fromCharCode(e)):e.type==="keydown"||e.type==="keyup"?xS[e.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:ef,charCode:function(e){return e.type==="keypress"?Ol(e):0},keyCode:function(e){return e.type==="keydown"||e.type==="keyup"?e.keyCode:0},which:function(e){return e.type==="keypress"?Ol(e):e.type==="keydown"||e.type==="keyup"?e.keyCode:0}}),SS=Hn(vS),wS=Nt({},Oc,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),tm=Hn(wS),ES=Nt({},Ma,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:ef}),kS=Hn(ES),jS=Nt({},oi,{propertyName:0,elapsedTime:0,pseudoElement:0}),CS=Hn(jS),TS=Nt({},Oc,{deltaX:function(e){return"deltaX"in e?e.deltaX:"wheelDeltaX"in e?-e.wheelDeltaX:0},deltaY:function(e){return"deltaY"in e?e.deltaY:"wheelDeltaY"in e?-e.wheelDeltaY:"wheelDelta"in e?-e.wheelDelta:0},deltaZ:0,deltaMode:0}),IS=Hn(TS),_S=[9,13,27,32],tf=Fr&&"CompositionEvent"in window,Zi=null;Fr&&"documentMode"in document&&(Zi=document.documentMode);var RS=Fr&&"TextEvent"in window&&!Zi,lx=Fr&&(!tf||Zi&&8<Zi&&11>=Zi),nm=" ",rm=!1;function cx(e,t){switch(e){case"keyup":return _S.indexOf(t.keyCode)!==-1;case"keydown":return t.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function dx(e){return e=e.detail,typeof e=="object"&&"data"in e?e.data:null}var _o=!1;function MS(e,t){switch(e){case"compositionend":return dx(t);case"keypress":return t.which!==32?null:(rm=!0,nm);case"textInput":return e=t.data,e===nm&&rm?null:e;default:return null}}function AS(e,t){if(_o)return e==="compositionend"||!tf&&cx(e,t)?(e=ax(),Bl=Xp=as=null,_o=!1,e):null;switch(e){case"paste":return null;case"keypress":if(!(t.ctrlKey||t.altKey||t.metaKey)||t.ctrlKey&&t.altKey){if(t.char&&1<t.char.length)return t.char;if(t.which)return String.fromCharCode(t.which)}return null;case"compositionend":return lx&&t.locale!=="ko"?null:t.data;default:return null}}var NS={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function sm(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t==="input"?!!NS[e.type]:t==="textarea"}function ux(e,t,n,s){Hh(s),t=oc(t,"onChange"),0<t.length&&(n=new Zp("onChange","change",null,n,s),e.push({event:n,listeners:t}))}var ea=null,fa=null;function LS(e){wx(e,0)}function Pc(e){var t=Ao(e);if($h(t))return e}function $S(e,t){if(e==="change")return t}var px=!1;if(Fr){var Wd;if(Fr){var Ud="oninput"in document;if(!Ud){var om=document.createElement("div");om.setAttribute("oninput","return;"),Ud=typeof om.oninput=="function"}Wd=Ud}else Wd=!1;px=Wd&&(!document.documentMode||9<document.documentMode)}function im(){ea&&(ea.detachEvent("onpropertychange",fx),fa=ea=null)}function fx(e){if(e.propertyName==="value"&&Pc(fa)){var t=[];ux(t,fa,e,Yp(e)),Vh(LS,t)}}function BS(e,t,n){e==="focusin"?(im(),ea=t,fa=n,ea.attachEvent("onpropertychange",fx)):e==="focusout"&&im()}function OS(e){if(e==="selectionchange"||e==="keyup"||e==="keydown")return Pc(fa)}function PS(e,t){if(e==="click")return Pc(t)}function zS(e,t){if(e==="input"||e==="change")return Pc(t)}function DS(e,t){return e===t&&(e!==0||1/e===1/t)||e!==e&&t!==t}var pr=typeof Object.is=="function"?Object.is:DS;function ma(e,t){if(pr(e,t))return!0;if(typeof e!="object"||e===null||typeof t!="object"||t===null)return!1;var n=Object.keys(e),s=Object.keys(t);if(n.length!==s.length)return!1;for(s=0;s<n.length;s++){var o=n[s];if(!Mu.call(t,o)||!pr(e[o],t[o]))return!1}return!0}function am(e){for(;e&&e.firstChild;)e=e.firstChild;return e}function lm(e,t){var n=am(e);e=0;for(var s;n;){if(n.nodeType===3){if(s=e+n.textContent.length,e<=t&&s>=t)return{node:n,offset:t-e};e=s}e:{for(;n;){if(n.nextSibling){n=n.nextSibling;break e}n=n.parentNode}n=void 0}n=am(n)}}function mx(e,t){return e&&t?e===t?!0:e&&e.nodeType===3?!1:t&&t.nodeType===3?mx(e,t.parentNode):"contains"in e?e.contains(t):e.compareDocumentPosition?!!(e.compareDocumentPosition(t)&16):!1:!1}function gx(){for(var e=window,t=Xl();t instanceof e.HTMLIFrameElement;){try{var n=typeof t.contentWindow.location.href=="string"}catch{n=!1}if(n)e=t.contentWindow;else break;t=Xl(e.document)}return t}function nf(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t&&(t==="input"&&(e.type==="text"||e.type==="search"||e.type==="tel"||e.type==="url"||e.type==="password")||t==="textarea"||e.contentEditable==="true")}function FS(e){var t=gx(),n=e.focusedElem,s=e.selectionRange;if(t!==n&&n&&n.ownerDocument&&mx(n.ownerDocument.documentElement,n)){if(s!==null&&nf(n)){if(t=s.start,e=s.end,e===void 0&&(e=t),"selectionStart"in n)n.selectionStart=t,n.selectionEnd=Math.min(e,n.value.length);else if(e=(t=n.ownerDocument||document)&&t.defaultView||window,e.getSelection){e=e.getSelection();var o=n.textContent.length,i=Math.min(s.start,o);s=s.end===void 0?i:Math.min(s.end,o),!e.extend&&i>s&&(o=s,s=i,i=o),o=lm(n,i);var a=lm(n,s);o&&a&&(e.rangeCount!==1||e.anchorNode!==o.node||e.anchorOffset!==o.offset||e.focusNode!==a.node||e.focusOffset!==a.offset)&&(t=t.createRange(),t.setStart(o.node,o.offset),e.removeAllRanges(),i>s?(e.addRange(t),e.extend(a.node,a.offset)):(t.setEnd(a.node,a.offset),e.addRange(t)))}}for(t=[],e=n;e=e.parentNode;)e.nodeType===1&&t.push({element:e,left:e.scrollLeft,top:e.scrollTop});for(typeof n.focus=="function"&&n.focus(),n=0;n<t.length;n++)e=t[n],e.element.scrollLeft=e.left,e.element.scrollTop=e.top}}var HS=Fr&&"documentMode"in document&&11>=document.documentMode,Ro=null,Qu=null,ta=null,Ju=!1;function cm(e,t,n){var s=n.window===n?n.document:n.nodeType===9?n:n.ownerDocument;Ju||Ro==null||Ro!==Xl(s)||(s=Ro,"selectionStart"in s&&nf(s)?s={start:s.selectionStart,end:s.selectionEnd}:(s=(s.ownerDocument&&s.ownerDocument.defaultView||window).getSelection(),s={anchorNode:s.anchorNode,anchorOffset:s.anchorOffset,focusNode:s.focusNode,focusOffset:s.focusOffset}),ta&&ma(ta,s)||(ta=s,s=oc(Qu,"onSelect"),0<s.length&&(t=new Zp("onSelect","select",null,t,n),e.push({event:t,listeners:s}),t.target=Ro)))}function ul(e,t){var n={};return n[e.toLowerCase()]=t.toLowerCase(),n["Webkit"+e]="webkit"+t,n["Moz"+e]="moz"+t,n}var Mo={animationend:ul("Animation","AnimationEnd"),animationiteration:ul("Animation","AnimationIteration"),animationstart:ul("Animation","AnimationStart"),transitionend:ul("Transition","TransitionEnd")},Gd={},hx={};Fr&&(hx=document.createElement("div").style,"AnimationEvent"in window||(delete Mo.animationend.animation,delete Mo.animationiteration.animation,delete Mo.animationstart.animation),"TransitionEvent"in window||delete Mo.transitionend.transition);function zc(e){if(Gd[e])return Gd[e];if(!Mo[e])return e;var t=Mo[e],n;for(n in t)if(t.hasOwnProperty(n)&&n in hx)return Gd[e]=t[n];return e}var xx=zc("animationend"),yx=zc("animationiteration"),bx=zc("animationstart"),vx=zc("transitionend"),Sx=new Map,dm="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function Ss(e,t){Sx.set(e,t),io(t,[e])}for(var Vd=0;Vd<dm.length;Vd++){var Yd=dm[Vd],WS=Yd.toLowerCase(),US=Yd[0].toUpperCase()+Yd.slice(1);Ss(WS,"on"+US)}Ss(xx,"onAnimationEnd");Ss(yx,"onAnimationIteration");Ss(bx,"onAnimationStart");Ss("dblclick","onDoubleClick");Ss("focusin","onFocus");Ss("focusout","onBlur");Ss(vx,"onTransitionEnd");Ko("onMouseEnter",["mouseout","mouseover"]);Ko("onMouseLeave",["mouseout","mouseover"]);Ko("onPointerEnter",["pointerout","pointerover"]);Ko("onPointerLeave",["pointerout","pointerover"]);io("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));io("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));io("onBeforeInput",["compositionend","keypress","textInput","paste"]);io("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));io("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));io("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Yi="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),GS=new Set("cancel close invalid load scroll toggle".split(" ").concat(Yi));function um(e,t,n){var s=e.type||"unknown-event";e.currentTarget=n,Wv(s,t,void 0,e),e.currentTarget=null}function wx(e,t){t=(t&4)!==0;for(var n=0;n<e.length;n++){var s=e[n],o=s.event;s=s.listeners;e:{var i=void 0;if(t)for(var a=s.length-1;0<=a;a--){var l=s[a],d=l.instance,u=l.currentTarget;if(l=l.listener,d!==i&&o.isPropagationStopped())break e;um(o,l,u),i=d}else for(a=0;a<s.length;a++){if(l=s[a],d=l.instance,u=l.currentTarget,l=l.listener,d!==i&&o.isPropagationStopped())break e;um(o,l,u),i=d}}}if(ec)throw e=Vu,ec=!1,Vu=null,e}function kt(e,t){var n=t[np];n===void 0&&(n=t[np]=new Set);var s=e+"__bubble";n.has(s)||(Ex(t,e,2,!1),n.add(s))}function qd(e,t,n){var s=0;t&&(s|=4),Ex(n,e,s,t)}var pl="_reactListening"+Math.random().toString(36).slice(2);function ga(e){if(!e[pl]){e[pl]=!0,Rh.forEach(function(n){n!=="selectionchange"&&(GS.has(n)||qd(n,!1,e),qd(n,!0,e))});var t=e.nodeType===9?e:e.ownerDocument;t===null||t[pl]||(t[pl]=!0,qd("selectionchange",!1,t))}}function Ex(e,t,n,s){switch(ix(t)){case 1:var o=oS;break;case 4:o=iS;break;default:o=Jp}n=o.bind(null,t,n,e),o=void 0,!Gu||t!=="touchstart"&&t!=="touchmove"&&t!=="wheel"||(o=!0),s?o!==void 0?e.addEventListener(t,n,{capture:!0,passive:o}):e.addEventListener(t,n,!0):o!==void 0?e.addEventListener(t,n,{passive:o}):e.addEventListener(t,n,!1)}function Kd(e,t,n,s,o){var i=s;if(!(t&1)&&!(t&2)&&s!==null)e:for(;;){if(s===null)return;var a=s.tag;if(a===3||a===4){var l=s.stateNode.containerInfo;if(l===o||l.nodeType===8&&l.parentNode===o)break;if(a===4)for(a=s.return;a!==null;){var d=a.tag;if((d===3||d===4)&&(d=a.stateNode.containerInfo,d===o||d.nodeType===8&&d.parentNode===o))return;a=a.return}for(;l!==null;){if(a=Hs(l),a===null)return;if(d=a.tag,d===5||d===6){s=i=a;continue e}l=l.parentNode}}s=s.return}Vh(function(){var u=i,p=Yp(n),c=[];e:{var m=Sx.get(e);if(m!==void 0){var v=Zp,w=e;switch(e){case"keypress":if(Ol(n)===0)break e;case"keydown":case"keyup":v=SS;break;case"focusin":w="focus",v=Hd;break;case"focusout":w="blur",v=Hd;break;case"beforeblur":case"afterblur":v=Hd;break;case"click":if(n.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":v=Z0;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":v=cS;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":v=kS;break;case xx:case yx:case bx:v=pS;break;case vx:v=CS;break;case"scroll":v=aS;break;case"wheel":v=IS;break;case"copy":case"cut":case"paste":v=mS;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":v=tm}var E=(t&4)!==0,S=!E&&e==="scroll",g=E?m!==null?m+"Capture":null:m;E=[];for(var h=u,x;h!==null;){x=h;var k=x.stateNode;if(x.tag===5&&k!==null&&(x=k,g!==null&&(k=ca(h,g),k!=null&&E.push(ha(h,k,x)))),S)break;h=h.return}0<E.length&&(m=new v(m,w,null,n,p),c.push({event:m,listeners:E}))}}if(!(t&7)){e:{if(m=e==="mouseover"||e==="pointerover",v=e==="mouseout"||e==="pointerout",m&&n!==Wu&&(w=n.relatedTarget||n.fromElement)&&(Hs(w)||w[Hr]))break e;if((v||m)&&(m=p.window===p?p:(m=p.ownerDocument)?m.defaultView||m.parentWindow:window,v?(w=n.relatedTarget||n.toElement,v=u,w=w?Hs(w):null,w!==null&&(S=ao(w),w!==S||w.tag!==5&&w.tag!==6)&&(w=null)):(v=null,w=u),v!==w)){if(E=Z0,k="onMouseLeave",g="onMouseEnter",h="mouse",(e==="pointerout"||e==="pointerover")&&(E=tm,k="onPointerLeave",g="onPointerEnter",h="pointer"),S=v==null?m:Ao(v),x=w==null?m:Ao(w),m=new E(k,h+"leave",v,n,p),m.target=S,m.relatedTarget=x,k=null,Hs(p)===u&&(E=new E(g,h+"enter",w,n,p),E.target=x,E.relatedTarget=S,k=E),S=k,v&&w)t:{for(E=v,g=w,h=0,x=E;x;x=bo(x))h++;for(x=0,k=g;k;k=bo(k))x++;for(;0<h-x;)E=bo(E),h--;for(;0<x-h;)g=bo(g),x--;for(;h--;){if(E===g||g!==null&&E===g.alternate)break t;E=bo(E),g=bo(g)}E=null}else E=null;v!==null&&pm(c,m,v,E,!1),w!==null&&S!==null&&pm(c,S,w,E,!0)}}e:{if(m=u?Ao(u):window,v=m.nodeName&&m.nodeName.toLowerCase(),v==="select"||v==="input"&&m.type==="file")var _=$S;else if(sm(m))if(px)_=zS;else{_=OS;var y=BS}else(v=m.nodeName)&&v.toLowerCase()==="input"&&(m.type==="checkbox"||m.type==="radio")&&(_=PS);if(_&&(_=_(e,u))){ux(c,_,n,p);break e}y&&y(e,m,u),e==="focusout"&&(y=m._wrapperState)&&y.controlled&&m.type==="number"&&Pu(m,"number",m.value)}switch(y=u?Ao(u):window,e){case"focusin":(sm(y)||y.contentEditable==="true")&&(Ro=y,Qu=u,ta=null);break;case"focusout":ta=Qu=Ro=null;break;case"mousedown":Ju=!0;break;case"contextmenu":case"mouseup":case"dragend":Ju=!1,cm(c,n,p);break;case"selectionchange":if(HS)break;case"keydown":case"keyup":cm(c,n,p)}var R;if(tf)e:{switch(e){case"compositionstart":var C="onCompositionStart";break e;case"compositionend":C="onCompositionEnd";break e;case"compositionupdate":C="onCompositionUpdate";break e}C=void 0}else _o?cx(e,n)&&(C="onCompositionEnd"):e==="keydown"&&n.keyCode===229&&(C="onCompositionStart");C&&(lx&&n.locale!=="ko"&&(_o||C!=="onCompositionStart"?C==="onCompositionEnd"&&_o&&(R=ax()):(as=p,Xp="value"in as?as.value:as.textContent,_o=!0)),y=oc(u,C),0<y.length&&(C=new em(C,e,null,n,p),c.push({event:C,listeners:y}),R?C.data=R:(R=dx(n),R!==null&&(C.data=R)))),(R=RS?MS(e,n):AS(e,n))&&(u=oc(u,"onBeforeInput"),0<u.length&&(p=new em("onBeforeInput","beforeinput",null,n,p),c.push({event:p,listeners:u}),p.data=R))}wx(c,t)})}function ha(e,t,n){return{instance:e,listener:t,currentTarget:n}}function oc(e,t){for(var n=t+"Capture",s=[];e!==null;){var o=e,i=o.stateNode;o.tag===5&&i!==null&&(o=i,i=ca(e,n),i!=null&&s.unshift(ha(e,i,o)),i=ca(e,t),i!=null&&s.push(ha(e,i,o))),e=e.return}return s}function bo(e){if(e===null)return null;do e=e.return;while(e&&e.tag!==5);return e||null}function pm(e,t,n,s,o){for(var i=t._reactName,a=[];n!==null&&n!==s;){var l=n,d=l.alternate,u=l.stateNode;if(d!==null&&d===s)break;l.tag===5&&u!==null&&(l=u,o?(d=ca(n,i),d!=null&&a.unshift(ha(n,d,l))):o||(d=ca(n,i),d!=null&&a.push(ha(n,d,l)))),n=n.return}a.length!==0&&e.push({event:t,listeners:a})}var VS=/\r\n?/g,YS=/\u0000|\uFFFD/g;function fm(e){return(typeof e=="string"?e:""+e).replace(VS,`
`).replace(YS,"")}function fl(e,t,n){if(t=fm(t),fm(e)!==t&&n)throw Error(be(425))}function ic(){}var Xu=null,Zu=null;function ep(e,t){return e==="textarea"||e==="noscript"||typeof t.children=="string"||typeof t.children=="number"||typeof t.dangerouslySetInnerHTML=="object"&&t.dangerouslySetInnerHTML!==null&&t.dangerouslySetInnerHTML.__html!=null}var tp=typeof setTimeout=="function"?setTimeout:void 0,qS=typeof clearTimeout=="function"?clearTimeout:void 0,mm=typeof Promise=="function"?Promise:void 0,KS=typeof queueMicrotask=="function"?queueMicrotask:typeof mm<"u"?function(e){return mm.resolve(null).then(e).catch(QS)}:tp;function QS(e){setTimeout(function(){throw e})}function Qd(e,t){var n=t,s=0;do{var o=n.nextSibling;if(e.removeChild(n),o&&o.nodeType===8)if(n=o.data,n==="/$"){if(s===0){e.removeChild(o),pa(t);return}s--}else n!=="$"&&n!=="$?"&&n!=="$!"||s++;n=o}while(n);pa(t)}function fs(e){for(;e!=null;e=e.nextSibling){var t=e.nodeType;if(t===1||t===3)break;if(t===8){if(t=e.data,t==="$"||t==="$!"||t==="$?")break;if(t==="/$")return null}}return e}function gm(e){e=e.previousSibling;for(var t=0;e;){if(e.nodeType===8){var n=e.data;if(n==="$"||n==="$!"||n==="$?"){if(t===0)return e;t--}else n==="/$"&&t++}e=e.previousSibling}return null}var ii=Math.random().toString(36).slice(2),wr="__reactFiber$"+ii,xa="__reactProps$"+ii,Hr="__reactContainer$"+ii,np="__reactEvents$"+ii,JS="__reactListeners$"+ii,XS="__reactHandles$"+ii;function Hs(e){var t=e[wr];if(t)return t;for(var n=e.parentNode;n;){if(t=n[Hr]||n[wr]){if(n=t.alternate,t.child!==null||n!==null&&n.child!==null)for(e=gm(e);e!==null;){if(n=e[wr])return n;e=gm(e)}return t}e=n,n=e.parentNode}return null}function Aa(e){return e=e[wr]||e[Hr],!e||e.tag!==5&&e.tag!==6&&e.tag!==13&&e.tag!==3?null:e}function Ao(e){if(e.tag===5||e.tag===6)return e.stateNode;throw Error(be(33))}function Dc(e){return e[xa]||null}var rp=[],No=-1;function ws(e){return{current:e}}function jt(e){0>No||(e.current=rp[No],rp[No]=null,No--)}function vt(e,t){No++,rp[No]=e.current,e.current=t}var vs={},gn=ws(vs),_n=ws(!1),Zs=vs;function Qo(e,t){var n=e.type.contextTypes;if(!n)return vs;var s=e.stateNode;if(s&&s.__reactInternalMemoizedUnmaskedChildContext===t)return s.__reactInternalMemoizedMaskedChildContext;var o={},i;for(i in n)o[i]=t[i];return s&&(e=e.stateNode,e.__reactInternalMemoizedUnmaskedChildContext=t,e.__reactInternalMemoizedMaskedChildContext=o),o}function Rn(e){return e=e.childContextTypes,e!=null}function ac(){jt(_n),jt(gn)}function hm(e,t,n){if(gn.current!==vs)throw Error(be(168));vt(gn,t),vt(_n,n)}function kx(e,t,n){var s=e.stateNode;if(t=t.childContextTypes,typeof s.getChildContext!="function")return n;s=s.getChildContext();for(var o in s)if(!(o in t))throw Error(be(108,Bv(e)||"Unknown",o));return Nt({},n,s)}function lc(e){return e=(e=e.stateNode)&&e.__reactInternalMemoizedMergedChildContext||vs,Zs=gn.current,vt(gn,e),vt(_n,_n.current),!0}function xm(e,t,n){var s=e.stateNode;if(!s)throw Error(be(169));n?(e=kx(e,t,Zs),s.__reactInternalMemoizedMergedChildContext=e,jt(_n),jt(gn),vt(gn,e)):jt(_n),vt(_n,n)}var Br=null,Fc=!1,Jd=!1;function jx(e){Br===null?Br=[e]:Br.push(e)}function ZS(e){Fc=!0,jx(e)}function Es(){if(!Jd&&Br!==null){Jd=!0;var e=0,t=xt;try{var n=Br;for(xt=1;e<n.length;e++){var s=n[e];do s=s(!0);while(s!==null)}Br=null,Fc=!1}catch(o){throw Br!==null&&(Br=Br.slice(e+1)),Qh(qp,Es),o}finally{xt=t,Jd=!1}}return null}var Lo=[],$o=0,cc=null,dc=0,qn=[],Kn=0,eo=null,Or=1,Pr="";function Ds(e,t){Lo[$o++]=dc,Lo[$o++]=cc,cc=e,dc=t}function Cx(e,t,n){qn[Kn++]=Or,qn[Kn++]=Pr,qn[Kn++]=eo,eo=e;var s=Or;e=Pr;var o=32-dr(s)-1;s&=~(1<<o),n+=1;var i=32-dr(t)+o;if(30<i){var a=o-o%5;i=(s&(1<<a)-1).toString(32),s>>=a,o-=a,Or=1<<32-dr(t)+o|n<<o|s,Pr=i+e}else Or=1<<i|n<<o|s,Pr=e}function rf(e){e.return!==null&&(Ds(e,1),Cx(e,1,0))}function sf(e){for(;e===cc;)cc=Lo[--$o],Lo[$o]=null,dc=Lo[--$o],Lo[$o]=null;for(;e===eo;)eo=qn[--Kn],qn[Kn]=null,Pr=qn[--Kn],qn[Kn]=null,Or=qn[--Kn],qn[Kn]=null}var zn=null,On=null,It=!1,cr=null;function Tx(e,t){var n=Jn(5,null,null,0);n.elementType="DELETED",n.stateNode=t,n.return=e,t=e.deletions,t===null?(e.deletions=[n],e.flags|=16):t.push(n)}function ym(e,t){switch(e.tag){case 5:var n=e.type;return t=t.nodeType!==1||n.toLowerCase()!==t.nodeName.toLowerCase()?null:t,t!==null?(e.stateNode=t,zn=e,On=fs(t.firstChild),!0):!1;case 6:return t=e.pendingProps===""||t.nodeType!==3?null:t,t!==null?(e.stateNode=t,zn=e,On=null,!0):!1;case 13:return t=t.nodeType!==8?null:t,t!==null?(n=eo!==null?{id:Or,overflow:Pr}:null,e.memoizedState={dehydrated:t,treeContext:n,retryLane:1073741824},n=Jn(18,null,null,0),n.stateNode=t,n.return=e,e.child=n,zn=e,On=null,!0):!1;default:return!1}}function sp(e){return(e.mode&1)!==0&&(e.flags&128)===0}function op(e){if(It){var t=On;if(t){var n=t;if(!ym(e,t)){if(sp(e))throw Error(be(418));t=fs(n.nextSibling);var s=zn;t&&ym(e,t)?Tx(s,n):(e.flags=e.flags&-4097|2,It=!1,zn=e)}}else{if(sp(e))throw Error(be(418));e.flags=e.flags&-4097|2,It=!1,zn=e}}}function bm(e){for(e=e.return;e!==null&&e.tag!==5&&e.tag!==3&&e.tag!==13;)e=e.return;zn=e}function ml(e){if(e!==zn)return!1;if(!It)return bm(e),It=!0,!1;var t;if((t=e.tag!==3)&&!(t=e.tag!==5)&&(t=e.type,t=t!=="head"&&t!=="body"&&!ep(e.type,e.memoizedProps)),t&&(t=On)){if(sp(e))throw Ix(),Error(be(418));for(;t;)Tx(e,t),t=fs(t.nextSibling)}if(bm(e),e.tag===13){if(e=e.memoizedState,e=e!==null?e.dehydrated:null,!e)throw Error(be(317));e:{for(e=e.nextSibling,t=0;e;){if(e.nodeType===8){var n=e.data;if(n==="/$"){if(t===0){On=fs(e.nextSibling);break e}t--}else n!=="$"&&n!=="$!"&&n!=="$?"||t++}e=e.nextSibling}On=null}}else On=zn?fs(e.stateNode.nextSibling):null;return!0}function Ix(){for(var e=On;e;)e=fs(e.nextSibling)}function Jo(){On=zn=null,It=!1}function of(e){cr===null?cr=[e]:cr.push(e)}var e2=Vr.ReactCurrentBatchConfig;function $i(e,t,n){if(e=n.ref,e!==null&&typeof e!="function"&&typeof e!="object"){if(n._owner){if(n=n._owner,n){if(n.tag!==1)throw Error(be(309));var s=n.stateNode}if(!s)throw Error(be(147,e));var o=s,i=""+e;return t!==null&&t.ref!==null&&typeof t.ref=="function"&&t.ref._stringRef===i?t.ref:(t=function(a){var l=o.refs;a===null?delete l[i]:l[i]=a},t._stringRef=i,t)}if(typeof e!="string")throw Error(be(284));if(!n._owner)throw Error(be(290,e))}return e}function gl(e,t){throw e=Object.prototype.toString.call(t),Error(be(31,e==="[object Object]"?"object with keys {"+Object.keys(t).join(", ")+"}":e))}function vm(e){var t=e._init;return t(e._payload)}function _x(e){function t(g,h){if(e){var x=g.deletions;x===null?(g.deletions=[h],g.flags|=16):x.push(h)}}function n(g,h){if(!e)return null;for(;h!==null;)t(g,h),h=h.sibling;return null}function s(g,h){for(g=new Map;h!==null;)h.key!==null?g.set(h.key,h):g.set(h.index,h),h=h.sibling;return g}function o(g,h){return g=xs(g,h),g.index=0,g.sibling=null,g}function i(g,h,x){return g.index=x,e?(x=g.alternate,x!==null?(x=x.index,x<h?(g.flags|=2,h):x):(g.flags|=2,h)):(g.flags|=1048576,h)}function a(g){return e&&g.alternate===null&&(g.flags|=2),g}function l(g,h,x,k){return h===null||h.tag!==6?(h=su(x,g.mode,k),h.return=g,h):(h=o(h,x),h.return=g,h)}function d(g,h,x,k){var _=x.type;return _===Io?p(g,h,x.props.children,k,x.key):h!==null&&(h.elementType===_||typeof _=="object"&&_!==null&&_.$$typeof===ns&&vm(_)===h.type)?(k=o(h,x.props),k.ref=$i(g,h,x),k.return=g,k):(k=Ul(x.type,x.key,x.props,null,g.mode,k),k.ref=$i(g,h,x),k.return=g,k)}function u(g,h,x,k){return h===null||h.tag!==4||h.stateNode.containerInfo!==x.containerInfo||h.stateNode.implementation!==x.implementation?(h=ou(x,g.mode,k),h.return=g,h):(h=o(h,x.children||[]),h.return=g,h)}function p(g,h,x,k,_){return h===null||h.tag!==7?(h=Ys(x,g.mode,k,_),h.return=g,h):(h=o(h,x),h.return=g,h)}function c(g,h,x){if(typeof h=="string"&&h!==""||typeof h=="number")return h=su(""+h,g.mode,x),h.return=g,h;if(typeof h=="object"&&h!==null){switch(h.$$typeof){case sl:return x=Ul(h.type,h.key,h.props,null,g.mode,x),x.ref=$i(g,null,h),x.return=g,x;case To:return h=ou(h,g.mode,x),h.return=g,h;case ns:var k=h._init;return c(g,k(h._payload),x)}if(Gi(h)||Ri(h))return h=Ys(h,g.mode,x,null),h.return=g,h;gl(g,h)}return null}function m(g,h,x,k){var _=h!==null?h.key:null;if(typeof x=="string"&&x!==""||typeof x=="number")return _!==null?null:l(g,h,""+x,k);if(typeof x=="object"&&x!==null){switch(x.$$typeof){case sl:return x.key===_?d(g,h,x,k):null;case To:return x.key===_?u(g,h,x,k):null;case ns:return _=x._init,m(g,h,_(x._payload),k)}if(Gi(x)||Ri(x))return _!==null?null:p(g,h,x,k,null);gl(g,x)}return null}function v(g,h,x,k,_){if(typeof k=="string"&&k!==""||typeof k=="number")return g=g.get(x)||null,l(h,g,""+k,_);if(typeof k=="object"&&k!==null){switch(k.$$typeof){case sl:return g=g.get(k.key===null?x:k.key)||null,d(h,g,k,_);case To:return g=g.get(k.key===null?x:k.key)||null,u(h,g,k,_);case ns:var y=k._init;return v(g,h,x,y(k._payload),_)}if(Gi(k)||Ri(k))return g=g.get(x)||null,p(h,g,k,_,null);gl(h,k)}return null}function w(g,h,x,k){for(var _=null,y=null,R=h,C=h=0,I=null;R!==null&&C<x.length;C++){R.index>C?(I=R,R=null):I=R.sibling;var T=m(g,R,x[C],k);if(T===null){R===null&&(R=I);break}e&&R&&T.alternate===null&&t(g,R),h=i(T,h,C),y===null?_=T:y.sibling=T,y=T,R=I}if(C===x.length)return n(g,R),It&&Ds(g,C),_;if(R===null){for(;C<x.length;C++)R=c(g,x[C],k),R!==null&&(h=i(R,h,C),y===null?_=R:y.sibling=R,y=R);return It&&Ds(g,C),_}for(R=s(g,R);C<x.length;C++)I=v(R,g,C,x[C],k),I!==null&&(e&&I.alternate!==null&&R.delete(I.key===null?C:I.key),h=i(I,h,C),y===null?_=I:y.sibling=I,y=I);return e&&R.forEach(function(L){return t(g,L)}),It&&Ds(g,C),_}function E(g,h,x,k){var _=Ri(x);if(typeof _!="function")throw Error(be(150));if(x=_.call(x),x==null)throw Error(be(151));for(var y=_=null,R=h,C=h=0,I=null,T=x.next();R!==null&&!T.done;C++,T=x.next()){R.index>C?(I=R,R=null):I=R.sibling;var L=m(g,R,T.value,k);if(L===null){R===null&&(R=I);break}e&&R&&L.alternate===null&&t(g,R),h=i(L,h,C),y===null?_=L:y.sibling=L,y=L,R=I}if(T.done)return n(g,R),It&&Ds(g,C),_;if(R===null){for(;!T.done;C++,T=x.next())T=c(g,T.value,k),T!==null&&(h=i(T,h,C),y===null?_=T:y.sibling=T,y=T);return It&&Ds(g,C),_}for(R=s(g,R);!T.done;C++,T=x.next())T=v(R,g,C,T.value,k),T!==null&&(e&&T.alternate!==null&&R.delete(T.key===null?C:T.key),h=i(T,h,C),y===null?_=T:y.sibling=T,y=T);return e&&R.forEach(function(ee){return t(g,ee)}),It&&Ds(g,C),_}function S(g,h,x,k){if(typeof x=="object"&&x!==null&&x.type===Io&&x.key===null&&(x=x.props.children),typeof x=="object"&&x!==null){switch(x.$$typeof){case sl:e:{for(var _=x.key,y=h;y!==null;){if(y.key===_){if(_=x.type,_===Io){if(y.tag===7){n(g,y.sibling),h=o(y,x.props.children),h.return=g,g=h;break e}}else if(y.elementType===_||typeof _=="object"&&_!==null&&_.$$typeof===ns&&vm(_)===y.type){n(g,y.sibling),h=o(y,x.props),h.ref=$i(g,y,x),h.return=g,g=h;break e}n(g,y);break}else t(g,y);y=y.sibling}x.type===Io?(h=Ys(x.props.children,g.mode,k,x.key),h.return=g,g=h):(k=Ul(x.type,x.key,x.props,null,g.mode,k),k.ref=$i(g,h,x),k.return=g,g=k)}return a(g);case To:e:{for(y=x.key;h!==null;){if(h.key===y)if(h.tag===4&&h.stateNode.containerInfo===x.containerInfo&&h.stateNode.implementation===x.implementation){n(g,h.sibling),h=o(h,x.children||[]),h.return=g,g=h;break e}else{n(g,h);break}else t(g,h);h=h.sibling}h=ou(x,g.mode,k),h.return=g,g=h}return a(g);case ns:return y=x._init,S(g,h,y(x._payload),k)}if(Gi(x))return w(g,h,x,k);if(Ri(x))return E(g,h,x,k);gl(g,x)}return typeof x=="string"&&x!==""||typeof x=="number"?(x=""+x,h!==null&&h.tag===6?(n(g,h.sibling),h=o(h,x),h.return=g,g=h):(n(g,h),h=su(x,g.mode,k),h.return=g,g=h),a(g)):n(g,h)}return S}var Xo=_x(!0),Rx=_x(!1),uc=ws(null),pc=null,Bo=null,af=null;function lf(){af=Bo=pc=null}function cf(e){var t=uc.current;jt(uc),e._currentValue=t}function ip(e,t,n){for(;e!==null;){var s=e.alternate;if((e.childLanes&t)!==t?(e.childLanes|=t,s!==null&&(s.childLanes|=t)):s!==null&&(s.childLanes&t)!==t&&(s.childLanes|=t),e===n)break;e=e.return}}function Wo(e,t){pc=e,af=Bo=null,e=e.dependencies,e!==null&&e.firstContext!==null&&(e.lanes&t&&(In=!0),e.firstContext=null)}function Zn(e){var t=e._currentValue;if(af!==e)if(e={context:e,memoizedValue:t,next:null},Bo===null){if(pc===null)throw Error(be(308));Bo=e,pc.dependencies={lanes:0,firstContext:e}}else Bo=Bo.next=e;return t}var Ws=null;function df(e){Ws===null?Ws=[e]:Ws.push(e)}function Mx(e,t,n,s){var o=t.interleaved;return o===null?(n.next=n,df(t)):(n.next=o.next,o.next=n),t.interleaved=n,Wr(e,s)}function Wr(e,t){e.lanes|=t;var n=e.alternate;for(n!==null&&(n.lanes|=t),n=e,e=e.return;e!==null;)e.childLanes|=t,n=e.alternate,n!==null&&(n.childLanes|=t),n=e,e=e.return;return n.tag===3?n.stateNode:null}var rs=!1;function uf(e){e.updateQueue={baseState:e.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function Ax(e,t){e=e.updateQueue,t.updateQueue===e&&(t.updateQueue={baseState:e.baseState,firstBaseUpdate:e.firstBaseUpdate,lastBaseUpdate:e.lastBaseUpdate,shared:e.shared,effects:e.effects})}function Dr(e,t){return{eventTime:e,lane:t,tag:0,payload:null,callback:null,next:null}}function ms(e,t,n){var s=e.updateQueue;if(s===null)return null;if(s=s.shared,lt&2){var o=s.pending;return o===null?t.next=t:(t.next=o.next,o.next=t),s.pending=t,Wr(e,n)}return o=s.interleaved,o===null?(t.next=t,df(s)):(t.next=o.next,o.next=t),s.interleaved=t,Wr(e,n)}function Pl(e,t,n){if(t=t.updateQueue,t!==null&&(t=t.shared,(n&4194240)!==0)){var s=t.lanes;s&=e.pendingLanes,n|=s,t.lanes=n,Kp(e,n)}}function Sm(e,t){var n=e.updateQueue,s=e.alternate;if(s!==null&&(s=s.updateQueue,n===s)){var o=null,i=null;if(n=n.firstBaseUpdate,n!==null){do{var a={eventTime:n.eventTime,lane:n.lane,tag:n.tag,payload:n.payload,callback:n.callback,next:null};i===null?o=i=a:i=i.next=a,n=n.next}while(n!==null);i===null?o=i=t:i=i.next=t}else o=i=t;n={baseState:s.baseState,firstBaseUpdate:o,lastBaseUpdate:i,shared:s.shared,effects:s.effects},e.updateQueue=n;return}e=n.lastBaseUpdate,e===null?n.firstBaseUpdate=t:e.next=t,n.lastBaseUpdate=t}function fc(e,t,n,s){var o=e.updateQueue;rs=!1;var i=o.firstBaseUpdate,a=o.lastBaseUpdate,l=o.shared.pending;if(l!==null){o.shared.pending=null;var d=l,u=d.next;d.next=null,a===null?i=u:a.next=u,a=d;var p=e.alternate;p!==null&&(p=p.updateQueue,l=p.lastBaseUpdate,l!==a&&(l===null?p.firstBaseUpdate=u:l.next=u,p.lastBaseUpdate=d))}if(i!==null){var c=o.baseState;a=0,p=u=d=null,l=i;do{var m=l.lane,v=l.eventTime;if((s&m)===m){p!==null&&(p=p.next={eventTime:v,lane:0,tag:l.tag,payload:l.payload,callback:l.callback,next:null});e:{var w=e,E=l;switch(m=t,v=n,E.tag){case 1:if(w=E.payload,typeof w=="function"){c=w.call(v,c,m);break e}c=w;break e;case 3:w.flags=w.flags&-65537|128;case 0:if(w=E.payload,m=typeof w=="function"?w.call(v,c,m):w,m==null)break e;c=Nt({},c,m);break e;case 2:rs=!0}}l.callback!==null&&l.lane!==0&&(e.flags|=64,m=o.effects,m===null?o.effects=[l]:m.push(l))}else v={eventTime:v,lane:m,tag:l.tag,payload:l.payload,callback:l.callback,next:null},p===null?(u=p=v,d=c):p=p.next=v,a|=m;if(l=l.next,l===null){if(l=o.shared.pending,l===null)break;m=l,l=m.next,m.next=null,o.lastBaseUpdate=m,o.shared.pending=null}}while(!0);if(p===null&&(d=c),o.baseState=d,o.firstBaseUpdate=u,o.lastBaseUpdate=p,t=o.shared.interleaved,t!==null){o=t;do a|=o.lane,o=o.next;while(o!==t)}else i===null&&(o.shared.lanes=0);no|=a,e.lanes=a,e.memoizedState=c}}function wm(e,t,n){if(e=t.effects,t.effects=null,e!==null)for(t=0;t<e.length;t++){var s=e[t],o=s.callback;if(o!==null){if(s.callback=null,s=n,typeof o!="function")throw Error(be(191,o));o.call(s)}}}var Na={},jr=ws(Na),ya=ws(Na),ba=ws(Na);function Us(e){if(e===Na)throw Error(be(174));return e}function pf(e,t){switch(vt(ba,t),vt(ya,e),vt(jr,Na),e=t.nodeType,e){case 9:case 11:t=(t=t.documentElement)?t.namespaceURI:Du(null,"");break;default:e=e===8?t.parentNode:t,t=e.namespaceURI||null,e=e.tagName,t=Du(t,e)}jt(jr),vt(jr,t)}function Zo(){jt(jr),jt(ya),jt(ba)}function Nx(e){Us(ba.current);var t=Us(jr.current),n=Du(t,e.type);t!==n&&(vt(ya,e),vt(jr,n))}function ff(e){ya.current===e&&(jt(jr),jt(ya))}var Mt=ws(0);function mc(e){for(var t=e;t!==null;){if(t.tag===13){var n=t.memoizedState;if(n!==null&&(n=n.dehydrated,n===null||n.data==="$?"||n.data==="$!"))return t}else if(t.tag===19&&t.memoizedProps.revealOrder!==void 0){if(t.flags&128)return t}else if(t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break;for(;t.sibling===null;){if(t.return===null||t.return===e)return null;t=t.return}t.sibling.return=t.return,t=t.sibling}return null}var Xd=[];function mf(){for(var e=0;e<Xd.length;e++)Xd[e]._workInProgressVersionPrimary=null;Xd.length=0}var zl=Vr.ReactCurrentDispatcher,Zd=Vr.ReactCurrentBatchConfig,to=0,At=null,Ft=null,qt=null,gc=!1,na=!1,va=0,t2=0;function dn(){throw Error(be(321))}function gf(e,t){if(t===null)return!1;for(var n=0;n<t.length&&n<e.length;n++)if(!pr(e[n],t[n]))return!1;return!0}function hf(e,t,n,s,o,i){if(to=i,At=t,t.memoizedState=null,t.updateQueue=null,t.lanes=0,zl.current=e===null||e.memoizedState===null?o2:i2,e=n(s,o),na){i=0;do{if(na=!1,va=0,25<=i)throw Error(be(301));i+=1,qt=Ft=null,t.updateQueue=null,zl.current=a2,e=n(s,o)}while(na)}if(zl.current=hc,t=Ft!==null&&Ft.next!==null,to=0,qt=Ft=At=null,gc=!1,t)throw Error(be(300));return e}function xf(){var e=va!==0;return va=0,e}function Sr(){var e={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return qt===null?At.memoizedState=qt=e:qt=qt.next=e,qt}function er(){if(Ft===null){var e=At.alternate;e=e!==null?e.memoizedState:null}else e=Ft.next;var t=qt===null?At.memoizedState:qt.next;if(t!==null)qt=t,Ft=e;else{if(e===null)throw Error(be(310));Ft=e,e={memoizedState:Ft.memoizedState,baseState:Ft.baseState,baseQueue:Ft.baseQueue,queue:Ft.queue,next:null},qt===null?At.memoizedState=qt=e:qt=qt.next=e}return qt}function Sa(e,t){return typeof t=="function"?t(e):t}function eu(e){var t=er(),n=t.queue;if(n===null)throw Error(be(311));n.lastRenderedReducer=e;var s=Ft,o=s.baseQueue,i=n.pending;if(i!==null){if(o!==null){var a=o.next;o.next=i.next,i.next=a}s.baseQueue=o=i,n.pending=null}if(o!==null){i=o.next,s=s.baseState;var l=a=null,d=null,u=i;do{var p=u.lane;if((to&p)===p)d!==null&&(d=d.next={lane:0,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null}),s=u.hasEagerState?u.eagerState:e(s,u.action);else{var c={lane:p,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null};d===null?(l=d=c,a=s):d=d.next=c,At.lanes|=p,no|=p}u=u.next}while(u!==null&&u!==i);d===null?a=s:d.next=l,pr(s,t.memoizedState)||(In=!0),t.memoizedState=s,t.baseState=a,t.baseQueue=d,n.lastRenderedState=s}if(e=n.interleaved,e!==null){o=e;do i=o.lane,At.lanes|=i,no|=i,o=o.next;while(o!==e)}else o===null&&(n.lanes=0);return[t.memoizedState,n.dispatch]}function tu(e){var t=er(),n=t.queue;if(n===null)throw Error(be(311));n.lastRenderedReducer=e;var s=n.dispatch,o=n.pending,i=t.memoizedState;if(o!==null){n.pending=null;var a=o=o.next;do i=e(i,a.action),a=a.next;while(a!==o);pr(i,t.memoizedState)||(In=!0),t.memoizedState=i,t.baseQueue===null&&(t.baseState=i),n.lastRenderedState=i}return[i,s]}function Lx(){}function $x(e,t){var n=At,s=er(),o=t(),i=!pr(s.memoizedState,o);if(i&&(s.memoizedState=o,In=!0),s=s.queue,yf(Px.bind(null,n,s,e),[e]),s.getSnapshot!==t||i||qt!==null&&qt.memoizedState.tag&1){if(n.flags|=2048,wa(9,Ox.bind(null,n,s,o,t),void 0,null),Kt===null)throw Error(be(349));to&30||Bx(n,t,o)}return o}function Bx(e,t,n){e.flags|=16384,e={getSnapshot:t,value:n},t=At.updateQueue,t===null?(t={lastEffect:null,stores:null},At.updateQueue=t,t.stores=[e]):(n=t.stores,n===null?t.stores=[e]:n.push(e))}function Ox(e,t,n,s){t.value=n,t.getSnapshot=s,zx(t)&&Dx(e)}function Px(e,t,n){return n(function(){zx(t)&&Dx(e)})}function zx(e){var t=e.getSnapshot;e=e.value;try{var n=t();return!pr(e,n)}catch{return!0}}function Dx(e){var t=Wr(e,1);t!==null&&ur(t,e,1,-1)}function Em(e){var t=Sr();return typeof e=="function"&&(e=e()),t.memoizedState=t.baseState=e,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:Sa,lastRenderedState:e},t.queue=e,e=e.dispatch=s2.bind(null,At,e),[t.memoizedState,e]}function wa(e,t,n,s){return e={tag:e,create:t,destroy:n,deps:s,next:null},t=At.updateQueue,t===null?(t={lastEffect:null,stores:null},At.updateQueue=t,t.lastEffect=e.next=e):(n=t.lastEffect,n===null?t.lastEffect=e.next=e:(s=n.next,n.next=e,e.next=s,t.lastEffect=e)),e}function Fx(){return er().memoizedState}function Dl(e,t,n,s){var o=Sr();At.flags|=e,o.memoizedState=wa(1|t,n,void 0,s===void 0?null:s)}function Hc(e,t,n,s){var o=er();s=s===void 0?null:s;var i=void 0;if(Ft!==null){var a=Ft.memoizedState;if(i=a.destroy,s!==null&&gf(s,a.deps)){o.memoizedState=wa(t,n,i,s);return}}At.flags|=e,o.memoizedState=wa(1|t,n,i,s)}function km(e,t){return Dl(8390656,8,e,t)}function yf(e,t){return Hc(2048,8,e,t)}function Hx(e,t){return Hc(4,2,e,t)}function Wx(e,t){return Hc(4,4,e,t)}function Ux(e,t){if(typeof t=="function")return e=e(),t(e),function(){t(null)};if(t!=null)return e=e(),t.current=e,function(){t.current=null}}function Gx(e,t,n){return n=n!=null?n.concat([e]):null,Hc(4,4,Ux.bind(null,t,e),n)}function bf(){}function Vx(e,t){var n=er();t=t===void 0?null:t;var s=n.memoizedState;return s!==null&&t!==null&&gf(t,s[1])?s[0]:(n.memoizedState=[e,t],e)}function Yx(e,t){var n=er();t=t===void 0?null:t;var s=n.memoizedState;return s!==null&&t!==null&&gf(t,s[1])?s[0]:(e=e(),n.memoizedState=[e,t],e)}function qx(e,t,n){return to&21?(pr(n,t)||(n=Zh(),At.lanes|=n,no|=n,e.baseState=!0),t):(e.baseState&&(e.baseState=!1,In=!0),e.memoizedState=n)}function n2(e,t){var n=xt;xt=n!==0&&4>n?n:4,e(!0);var s=Zd.transition;Zd.transition={};try{e(!1),t()}finally{xt=n,Zd.transition=s}}function Kx(){return er().memoizedState}function r2(e,t,n){var s=hs(e);if(n={lane:s,action:n,hasEagerState:!1,eagerState:null,next:null},Qx(e))Jx(t,n);else if(n=Mx(e,t,n,s),n!==null){var o=bn();ur(n,e,s,o),Xx(n,t,s)}}function s2(e,t,n){var s=hs(e),o={lane:s,action:n,hasEagerState:!1,eagerState:null,next:null};if(Qx(e))Jx(t,o);else{var i=e.alternate;if(e.lanes===0&&(i===null||i.lanes===0)&&(i=t.lastRenderedReducer,i!==null))try{var a=t.lastRenderedState,l=i(a,n);if(o.hasEagerState=!0,o.eagerState=l,pr(l,a)){var d=t.interleaved;d===null?(o.next=o,df(t)):(o.next=d.next,d.next=o),t.interleaved=o;return}}catch{}finally{}n=Mx(e,t,o,s),n!==null&&(o=bn(),ur(n,e,s,o),Xx(n,t,s))}}function Qx(e){var t=e.alternate;return e===At||t!==null&&t===At}function Jx(e,t){na=gc=!0;var n=e.pending;n===null?t.next=t:(t.next=n.next,n.next=t),e.pending=t}function Xx(e,t,n){if(n&4194240){var s=t.lanes;s&=e.pendingLanes,n|=s,t.lanes=n,Kp(e,n)}}var hc={readContext:Zn,useCallback:dn,useContext:dn,useEffect:dn,useImperativeHandle:dn,useInsertionEffect:dn,useLayoutEffect:dn,useMemo:dn,useReducer:dn,useRef:dn,useState:dn,useDebugValue:dn,useDeferredValue:dn,useTransition:dn,useMutableSource:dn,useSyncExternalStore:dn,useId:dn,unstable_isNewReconciler:!1},o2={readContext:Zn,useCallback:function(e,t){return Sr().memoizedState=[e,t===void 0?null:t],e},useContext:Zn,useEffect:km,useImperativeHandle:function(e,t,n){return n=n!=null?n.concat([e]):null,Dl(4194308,4,Ux.bind(null,t,e),n)},useLayoutEffect:function(e,t){return Dl(4194308,4,e,t)},useInsertionEffect:function(e,t){return Dl(4,2,e,t)},useMemo:function(e,t){var n=Sr();return t=t===void 0?null:t,e=e(),n.memoizedState=[e,t],e},useReducer:function(e,t,n){var s=Sr();return t=n!==void 0?n(t):t,s.memoizedState=s.baseState=t,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:e,lastRenderedState:t},s.queue=e,e=e.dispatch=r2.bind(null,At,e),[s.memoizedState,e]},useRef:function(e){var t=Sr();return e={current:e},t.memoizedState=e},useState:Em,useDebugValue:bf,useDeferredValue:function(e){return Sr().memoizedState=e},useTransition:function(){var e=Em(!1),t=e[0];return e=n2.bind(null,e[1]),Sr().memoizedState=e,[t,e]},useMutableSource:function(){},useSyncExternalStore:function(e,t,n){var s=At,o=Sr();if(It){if(n===void 0)throw Error(be(407));n=n()}else{if(n=t(),Kt===null)throw Error(be(349));to&30||Bx(s,t,n)}o.memoizedState=n;var i={value:n,getSnapshot:t};return o.queue=i,km(Px.bind(null,s,i,e),[e]),s.flags|=2048,wa(9,Ox.bind(null,s,i,n,t),void 0,null),n},useId:function(){var e=Sr(),t=Kt.identifierPrefix;if(It){var n=Pr,s=Or;n=(s&~(1<<32-dr(s)-1)).toString(32)+n,t=":"+t+"R"+n,n=va++,0<n&&(t+="H"+n.toString(32)),t+=":"}else n=t2++,t=":"+t+"r"+n.toString(32)+":";return e.memoizedState=t},unstable_isNewReconciler:!1},i2={readContext:Zn,useCallback:Vx,useContext:Zn,useEffect:yf,useImperativeHandle:Gx,useInsertionEffect:Hx,useLayoutEffect:Wx,useMemo:Yx,useReducer:eu,useRef:Fx,useState:function(){return eu(Sa)},useDebugValue:bf,useDeferredValue:function(e){var t=er();return qx(t,Ft.memoizedState,e)},useTransition:function(){var e=eu(Sa)[0],t=er().memoizedState;return[e,t]},useMutableSource:Lx,useSyncExternalStore:$x,useId:Kx,unstable_isNewReconciler:!1},a2={readContext:Zn,useCallback:Vx,useContext:Zn,useEffect:yf,useImperativeHandle:Gx,useInsertionEffect:Hx,useLayoutEffect:Wx,useMemo:Yx,useReducer:tu,useRef:Fx,useState:function(){return tu(Sa)},useDebugValue:bf,useDeferredValue:function(e){var t=er();return Ft===null?t.memoizedState=e:qx(t,Ft.memoizedState,e)},useTransition:function(){var e=tu(Sa)[0],t=er().memoizedState;return[e,t]},useMutableSource:Lx,useSyncExternalStore:$x,useId:Kx,unstable_isNewReconciler:!1};function ar(e,t){if(e&&e.defaultProps){t=Nt({},t),e=e.defaultProps;for(var n in e)t[n]===void 0&&(t[n]=e[n]);return t}return t}function ap(e,t,n,s){t=e.memoizedState,n=n(s,t),n=n==null?t:Nt({},t,n),e.memoizedState=n,e.lanes===0&&(e.updateQueue.baseState=n)}var Wc={isMounted:function(e){return(e=e._reactInternals)?ao(e)===e:!1},enqueueSetState:function(e,t,n){e=e._reactInternals;var s=bn(),o=hs(e),i=Dr(s,o);i.payload=t,n!=null&&(i.callback=n),t=ms(e,i,o),t!==null&&(ur(t,e,o,s),Pl(t,e,o))},enqueueReplaceState:function(e,t,n){e=e._reactInternals;var s=bn(),o=hs(e),i=Dr(s,o);i.tag=1,i.payload=t,n!=null&&(i.callback=n),t=ms(e,i,o),t!==null&&(ur(t,e,o,s),Pl(t,e,o))},enqueueForceUpdate:function(e,t){e=e._reactInternals;var n=bn(),s=hs(e),o=Dr(n,s);o.tag=2,t!=null&&(o.callback=t),t=ms(e,o,s),t!==null&&(ur(t,e,s,n),Pl(t,e,s))}};function jm(e,t,n,s,o,i,a){return e=e.stateNode,typeof e.shouldComponentUpdate=="function"?e.shouldComponentUpdate(s,i,a):t.prototype&&t.prototype.isPureReactComponent?!ma(n,s)||!ma(o,i):!0}function Zx(e,t,n){var s=!1,o=vs,i=t.contextType;return typeof i=="object"&&i!==null?i=Zn(i):(o=Rn(t)?Zs:gn.current,s=t.contextTypes,i=(s=s!=null)?Qo(e,o):vs),t=new t(n,i),e.memoizedState=t.state!==null&&t.state!==void 0?t.state:null,t.updater=Wc,e.stateNode=t,t._reactInternals=e,s&&(e=e.stateNode,e.__reactInternalMemoizedUnmaskedChildContext=o,e.__reactInternalMemoizedMaskedChildContext=i),t}function Cm(e,t,n,s){e=t.state,typeof t.componentWillReceiveProps=="function"&&t.componentWillReceiveProps(n,s),typeof t.UNSAFE_componentWillReceiveProps=="function"&&t.UNSAFE_componentWillReceiveProps(n,s),t.state!==e&&Wc.enqueueReplaceState(t,t.state,null)}function lp(e,t,n,s){var o=e.stateNode;o.props=n,o.state=e.memoizedState,o.refs={},uf(e);var i=t.contextType;typeof i=="object"&&i!==null?o.context=Zn(i):(i=Rn(t)?Zs:gn.current,o.context=Qo(e,i)),o.state=e.memoizedState,i=t.getDerivedStateFromProps,typeof i=="function"&&(ap(e,t,i,n),o.state=e.memoizedState),typeof t.getDerivedStateFromProps=="function"||typeof o.getSnapshotBeforeUpdate=="function"||typeof o.UNSAFE_componentWillMount!="function"&&typeof o.componentWillMount!="function"||(t=o.state,typeof o.componentWillMount=="function"&&o.componentWillMount(),typeof o.UNSAFE_componentWillMount=="function"&&o.UNSAFE_componentWillMount(),t!==o.state&&Wc.enqueueReplaceState(o,o.state,null),fc(e,n,o,s),o.state=e.memoizedState),typeof o.componentDidMount=="function"&&(e.flags|=4194308)}function ei(e,t){try{var n="",s=t;do n+=$v(s),s=s.return;while(s);var o=n}catch(i){o=`
Error generating stack: `+i.message+`
`+i.stack}return{value:e,source:t,stack:o,digest:null}}function nu(e,t,n){return{value:e,source:null,stack:n??null,digest:t??null}}function cp(e,t){try{console.error(t.value)}catch(n){setTimeout(function(){throw n})}}var l2=typeof WeakMap=="function"?WeakMap:Map;function ey(e,t,n){n=Dr(-1,n),n.tag=3,n.payload={element:null};var s=t.value;return n.callback=function(){yc||(yc=!0,bp=s),cp(e,t)},n}function ty(e,t,n){n=Dr(-1,n),n.tag=3;var s=e.type.getDerivedStateFromError;if(typeof s=="function"){var o=t.value;n.payload=function(){return s(o)},n.callback=function(){cp(e,t)}}var i=e.stateNode;return i!==null&&typeof i.componentDidCatch=="function"&&(n.callback=function(){cp(e,t),typeof s!="function"&&(gs===null?gs=new Set([this]):gs.add(this));var a=t.stack;this.componentDidCatch(t.value,{componentStack:a!==null?a:""})}),n}function Tm(e,t,n){var s=e.pingCache;if(s===null){s=e.pingCache=new l2;var o=new Set;s.set(t,o)}else o=s.get(t),o===void 0&&(o=new Set,s.set(t,o));o.has(n)||(o.add(n),e=w2.bind(null,e,t,n),t.then(e,e))}function Im(e){do{var t;if((t=e.tag===13)&&(t=e.memoizedState,t=t!==null?t.dehydrated!==null:!0),t)return e;e=e.return}while(e!==null);return null}function _m(e,t,n,s,o){return e.mode&1?(e.flags|=65536,e.lanes=o,e):(e===t?e.flags|=65536:(e.flags|=128,n.flags|=131072,n.flags&=-52805,n.tag===1&&(n.alternate===null?n.tag=17:(t=Dr(-1,1),t.tag=2,ms(n,t,1))),n.lanes|=1),e)}var c2=Vr.ReactCurrentOwner,In=!1;function yn(e,t,n,s){t.child=e===null?Rx(t,null,n,s):Xo(t,e.child,n,s)}function Rm(e,t,n,s,o){n=n.render;var i=t.ref;return Wo(t,o),s=hf(e,t,n,s,i,o),n=xf(),e!==null&&!In?(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~o,Ur(e,t,o)):(It&&n&&rf(t),t.flags|=1,yn(e,t,s,o),t.child)}function Mm(e,t,n,s,o){if(e===null){var i=n.type;return typeof i=="function"&&!Tf(i)&&i.defaultProps===void 0&&n.compare===null&&n.defaultProps===void 0?(t.tag=15,t.type=i,ny(e,t,i,s,o)):(e=Ul(n.type,null,s,t,t.mode,o),e.ref=t.ref,e.return=t,t.child=e)}if(i=e.child,!(e.lanes&o)){var a=i.memoizedProps;if(n=n.compare,n=n!==null?n:ma,n(a,s)&&e.ref===t.ref)return Ur(e,t,o)}return t.flags|=1,e=xs(i,s),e.ref=t.ref,e.return=t,t.child=e}function ny(e,t,n,s,o){if(e!==null){var i=e.memoizedProps;if(ma(i,s)&&e.ref===t.ref)if(In=!1,t.pendingProps=s=i,(e.lanes&o)!==0)e.flags&131072&&(In=!0);else return t.lanes=e.lanes,Ur(e,t,o)}return dp(e,t,n,s,o)}function ry(e,t,n){var s=t.pendingProps,o=s.children,i=e!==null?e.memoizedState:null;if(s.mode==="hidden")if(!(t.mode&1))t.memoizedState={baseLanes:0,cachePool:null,transitions:null},vt(Po,Bn),Bn|=n;else{if(!(n&1073741824))return e=i!==null?i.baseLanes|n:n,t.lanes=t.childLanes=1073741824,t.memoizedState={baseLanes:e,cachePool:null,transitions:null},t.updateQueue=null,vt(Po,Bn),Bn|=e,null;t.memoizedState={baseLanes:0,cachePool:null,transitions:null},s=i!==null?i.baseLanes:n,vt(Po,Bn),Bn|=s}else i!==null?(s=i.baseLanes|n,t.memoizedState=null):s=n,vt(Po,Bn),Bn|=s;return yn(e,t,o,n),t.child}function sy(e,t){var n=t.ref;(e===null&&n!==null||e!==null&&e.ref!==n)&&(t.flags|=512,t.flags|=2097152)}function dp(e,t,n,s,o){var i=Rn(n)?Zs:gn.current;return i=Qo(t,i),Wo(t,o),n=hf(e,t,n,s,i,o),s=xf(),e!==null&&!In?(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~o,Ur(e,t,o)):(It&&s&&rf(t),t.flags|=1,yn(e,t,n,o),t.child)}function Am(e,t,n,s,o){if(Rn(n)){var i=!0;lc(t)}else i=!1;if(Wo(t,o),t.stateNode===null)Fl(e,t),Zx(t,n,s),lp(t,n,s,o),s=!0;else if(e===null){var a=t.stateNode,l=t.memoizedProps;a.props=l;var d=a.context,u=n.contextType;typeof u=="object"&&u!==null?u=Zn(u):(u=Rn(n)?Zs:gn.current,u=Qo(t,u));var p=n.getDerivedStateFromProps,c=typeof p=="function"||typeof a.getSnapshotBeforeUpdate=="function";c||typeof a.UNSAFE_componentWillReceiveProps!="function"&&typeof a.componentWillReceiveProps!="function"||(l!==s||d!==u)&&Cm(t,a,s,u),rs=!1;var m=t.memoizedState;a.state=m,fc(t,s,a,o),d=t.memoizedState,l!==s||m!==d||_n.current||rs?(typeof p=="function"&&(ap(t,n,p,s),d=t.memoizedState),(l=rs||jm(t,n,l,s,m,d,u))?(c||typeof a.UNSAFE_componentWillMount!="function"&&typeof a.componentWillMount!="function"||(typeof a.componentWillMount=="function"&&a.componentWillMount(),typeof a.UNSAFE_componentWillMount=="function"&&a.UNSAFE_componentWillMount()),typeof a.componentDidMount=="function"&&(t.flags|=4194308)):(typeof a.componentDidMount=="function"&&(t.flags|=4194308),t.memoizedProps=s,t.memoizedState=d),a.props=s,a.state=d,a.context=u,s=l):(typeof a.componentDidMount=="function"&&(t.flags|=4194308),s=!1)}else{a=t.stateNode,Ax(e,t),l=t.memoizedProps,u=t.type===t.elementType?l:ar(t.type,l),a.props=u,c=t.pendingProps,m=a.context,d=n.contextType,typeof d=="object"&&d!==null?d=Zn(d):(d=Rn(n)?Zs:gn.current,d=Qo(t,d));var v=n.getDerivedStateFromProps;(p=typeof v=="function"||typeof a.getSnapshotBeforeUpdate=="function")||typeof a.UNSAFE_componentWillReceiveProps!="function"&&typeof a.componentWillReceiveProps!="function"||(l!==c||m!==d)&&Cm(t,a,s,d),rs=!1,m=t.memoizedState,a.state=m,fc(t,s,a,o);var w=t.memoizedState;l!==c||m!==w||_n.current||rs?(typeof v=="function"&&(ap(t,n,v,s),w=t.memoizedState),(u=rs||jm(t,n,u,s,m,w,d)||!1)?(p||typeof a.UNSAFE_componentWillUpdate!="function"&&typeof a.componentWillUpdate!="function"||(typeof a.componentWillUpdate=="function"&&a.componentWillUpdate(s,w,d),typeof a.UNSAFE_componentWillUpdate=="function"&&a.UNSAFE_componentWillUpdate(s,w,d)),typeof a.componentDidUpdate=="function"&&(t.flags|=4),typeof a.getSnapshotBeforeUpdate=="function"&&(t.flags|=1024)):(typeof a.componentDidUpdate!="function"||l===e.memoizedProps&&m===e.memoizedState||(t.flags|=4),typeof a.getSnapshotBeforeUpdate!="function"||l===e.memoizedProps&&m===e.memoizedState||(t.flags|=1024),t.memoizedProps=s,t.memoizedState=w),a.props=s,a.state=w,a.context=d,s=u):(typeof a.componentDidUpdate!="function"||l===e.memoizedProps&&m===e.memoizedState||(t.flags|=4),typeof a.getSnapshotBeforeUpdate!="function"||l===e.memoizedProps&&m===e.memoizedState||(t.flags|=1024),s=!1)}return up(e,t,n,s,i,o)}function up(e,t,n,s,o,i){sy(e,t);var a=(t.flags&128)!==0;if(!s&&!a)return o&&xm(t,n,!1),Ur(e,t,i);s=t.stateNode,c2.current=t;var l=a&&typeof n.getDerivedStateFromError!="function"?null:s.render();return t.flags|=1,e!==null&&a?(t.child=Xo(t,e.child,null,i),t.child=Xo(t,null,l,i)):yn(e,t,l,i),t.memoizedState=s.state,o&&xm(t,n,!0),t.child}function oy(e){var t=e.stateNode;t.pendingContext?hm(e,t.pendingContext,t.pendingContext!==t.context):t.context&&hm(e,t.context,!1),pf(e,t.containerInfo)}function Nm(e,t,n,s,o){return Jo(),of(o),t.flags|=256,yn(e,t,n,s),t.child}var pp={dehydrated:null,treeContext:null,retryLane:0};function fp(e){return{baseLanes:e,cachePool:null,transitions:null}}function iy(e,t,n){var s=t.pendingProps,o=Mt.current,i=!1,a=(t.flags&128)!==0,l;if((l=a)||(l=e!==null&&e.memoizedState===null?!1:(o&2)!==0),l?(i=!0,t.flags&=-129):(e===null||e.memoizedState!==null)&&(o|=1),vt(Mt,o&1),e===null)return op(t),e=t.memoizedState,e!==null&&(e=e.dehydrated,e!==null)?(t.mode&1?e.data==="$!"?t.lanes=8:t.lanes=1073741824:t.lanes=1,null):(a=s.children,e=s.fallback,i?(s=t.mode,i=t.child,a={mode:"hidden",children:a},!(s&1)&&i!==null?(i.childLanes=0,i.pendingProps=a):i=Vc(a,s,0,null),e=Ys(e,s,n,null),i.return=t,e.return=t,i.sibling=e,t.child=i,t.child.memoizedState=fp(n),t.memoizedState=pp,e):vf(t,a));if(o=e.memoizedState,o!==null&&(l=o.dehydrated,l!==null))return d2(e,t,a,s,l,o,n);if(i){i=s.fallback,a=t.mode,o=e.child,l=o.sibling;var d={mode:"hidden",children:s.children};return!(a&1)&&t.child!==o?(s=t.child,s.childLanes=0,s.pendingProps=d,t.deletions=null):(s=xs(o,d),s.subtreeFlags=o.subtreeFlags&14680064),l!==null?i=xs(l,i):(i=Ys(i,a,n,null),i.flags|=2),i.return=t,s.return=t,s.sibling=i,t.child=s,s=i,i=t.child,a=e.child.memoizedState,a=a===null?fp(n):{baseLanes:a.baseLanes|n,cachePool:null,transitions:a.transitions},i.memoizedState=a,i.childLanes=e.childLanes&~n,t.memoizedState=pp,s}return i=e.child,e=i.sibling,s=xs(i,{mode:"visible",children:s.children}),!(t.mode&1)&&(s.lanes=n),s.return=t,s.sibling=null,e!==null&&(n=t.deletions,n===null?(t.deletions=[e],t.flags|=16):n.push(e)),t.child=s,t.memoizedState=null,s}function vf(e,t){return t=Vc({mode:"visible",children:t},e.mode,0,null),t.return=e,e.child=t}function hl(e,t,n,s){return s!==null&&of(s),Xo(t,e.child,null,n),e=vf(t,t.pendingProps.children),e.flags|=2,t.memoizedState=null,e}function d2(e,t,n,s,o,i,a){if(n)return t.flags&256?(t.flags&=-257,s=nu(Error(be(422))),hl(e,t,a,s)):t.memoizedState!==null?(t.child=e.child,t.flags|=128,null):(i=s.fallback,o=t.mode,s=Vc({mode:"visible",children:s.children},o,0,null),i=Ys(i,o,a,null),i.flags|=2,s.return=t,i.return=t,s.sibling=i,t.child=s,t.mode&1&&Xo(t,e.child,null,a),t.child.memoizedState=fp(a),t.memoizedState=pp,i);if(!(t.mode&1))return hl(e,t,a,null);if(o.data==="$!"){if(s=o.nextSibling&&o.nextSibling.dataset,s)var l=s.dgst;return s=l,i=Error(be(419)),s=nu(i,s,void 0),hl(e,t,a,s)}if(l=(a&e.childLanes)!==0,In||l){if(s=Kt,s!==null){switch(a&-a){case 4:o=2;break;case 16:o=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:o=32;break;case 536870912:o=268435456;break;default:o=0}o=o&(s.suspendedLanes|a)?0:o,o!==0&&o!==i.retryLane&&(i.retryLane=o,Wr(e,o),ur(s,e,o,-1))}return Cf(),s=nu(Error(be(421))),hl(e,t,a,s)}return o.data==="$?"?(t.flags|=128,t.child=e.child,t=E2.bind(null,e),o._reactRetry=t,null):(e=i.treeContext,On=fs(o.nextSibling),zn=t,It=!0,cr=null,e!==null&&(qn[Kn++]=Or,qn[Kn++]=Pr,qn[Kn++]=eo,Or=e.id,Pr=e.overflow,eo=t),t=vf(t,s.children),t.flags|=4096,t)}function Lm(e,t,n){e.lanes|=t;var s=e.alternate;s!==null&&(s.lanes|=t),ip(e.return,t,n)}function ru(e,t,n,s,o){var i=e.memoizedState;i===null?e.memoizedState={isBackwards:t,rendering:null,renderingStartTime:0,last:s,tail:n,tailMode:o}:(i.isBackwards=t,i.rendering=null,i.renderingStartTime=0,i.last=s,i.tail=n,i.tailMode=o)}function ay(e,t,n){var s=t.pendingProps,o=s.revealOrder,i=s.tail;if(yn(e,t,s.children,n),s=Mt.current,s&2)s=s&1|2,t.flags|=128;else{if(e!==null&&e.flags&128)e:for(e=t.child;e!==null;){if(e.tag===13)e.memoizedState!==null&&Lm(e,n,t);else if(e.tag===19)Lm(e,n,t);else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===t)break e;for(;e.sibling===null;){if(e.return===null||e.return===t)break e;e=e.return}e.sibling.return=e.return,e=e.sibling}s&=1}if(vt(Mt,s),!(t.mode&1))t.memoizedState=null;else switch(o){case"forwards":for(n=t.child,o=null;n!==null;)e=n.alternate,e!==null&&mc(e)===null&&(o=n),n=n.sibling;n=o,n===null?(o=t.child,t.child=null):(o=n.sibling,n.sibling=null),ru(t,!1,o,n,i);break;case"backwards":for(n=null,o=t.child,t.child=null;o!==null;){if(e=o.alternate,e!==null&&mc(e)===null){t.child=o;break}e=o.sibling,o.sibling=n,n=o,o=e}ru(t,!0,n,null,i);break;case"together":ru(t,!1,null,null,void 0);break;default:t.memoizedState=null}return t.child}function Fl(e,t){!(t.mode&1)&&e!==null&&(e.alternate=null,t.alternate=null,t.flags|=2)}function Ur(e,t,n){if(e!==null&&(t.dependencies=e.dependencies),no|=t.lanes,!(n&t.childLanes))return null;if(e!==null&&t.child!==e.child)throw Error(be(153));if(t.child!==null){for(e=t.child,n=xs(e,e.pendingProps),t.child=n,n.return=t;e.sibling!==null;)e=e.sibling,n=n.sibling=xs(e,e.pendingProps),n.return=t;n.sibling=null}return t.child}function u2(e,t,n){switch(t.tag){case 3:oy(t),Jo();break;case 5:Nx(t);break;case 1:Rn(t.type)&&lc(t);break;case 4:pf(t,t.stateNode.containerInfo);break;case 10:var s=t.type._context,o=t.memoizedProps.value;vt(uc,s._currentValue),s._currentValue=o;break;case 13:if(s=t.memoizedState,s!==null)return s.dehydrated!==null?(vt(Mt,Mt.current&1),t.flags|=128,null):n&t.child.childLanes?iy(e,t,n):(vt(Mt,Mt.current&1),e=Ur(e,t,n),e!==null?e.sibling:null);vt(Mt,Mt.current&1);break;case 19:if(s=(n&t.childLanes)!==0,e.flags&128){if(s)return ay(e,t,n);t.flags|=128}if(o=t.memoizedState,o!==null&&(o.rendering=null,o.tail=null,o.lastEffect=null),vt(Mt,Mt.current),s)break;return null;case 22:case 23:return t.lanes=0,ry(e,t,n)}return Ur(e,t,n)}var ly,mp,cy,dy;ly=function(e,t){for(var n=t.child;n!==null;){if(n.tag===5||n.tag===6)e.appendChild(n.stateNode);else if(n.tag!==4&&n.child!==null){n.child.return=n,n=n.child;continue}if(n===t)break;for(;n.sibling===null;){if(n.return===null||n.return===t)return;n=n.return}n.sibling.return=n.return,n=n.sibling}};mp=function(){};cy=function(e,t,n,s){var o=e.memoizedProps;if(o!==s){e=t.stateNode,Us(jr.current);var i=null;switch(n){case"input":o=Bu(e,o),s=Bu(e,s),i=[];break;case"select":o=Nt({},o,{value:void 0}),s=Nt({},s,{value:void 0}),i=[];break;case"textarea":o=zu(e,o),s=zu(e,s),i=[];break;default:typeof o.onClick!="function"&&typeof s.onClick=="function"&&(e.onclick=ic)}Fu(n,s);var a;n=null;for(u in o)if(!s.hasOwnProperty(u)&&o.hasOwnProperty(u)&&o[u]!=null)if(u==="style"){var l=o[u];for(a in l)l.hasOwnProperty(a)&&(n||(n={}),n[a]="")}else u!=="dangerouslySetInnerHTML"&&u!=="children"&&u!=="suppressContentEditableWarning"&&u!=="suppressHydrationWarning"&&u!=="autoFocus"&&(aa.hasOwnProperty(u)?i||(i=[]):(i=i||[]).push(u,null));for(u in s){var d=s[u];if(l=o!=null?o[u]:void 0,s.hasOwnProperty(u)&&d!==l&&(d!=null||l!=null))if(u==="style")if(l){for(a in l)!l.hasOwnProperty(a)||d&&d.hasOwnProperty(a)||(n||(n={}),n[a]="");for(a in d)d.hasOwnProperty(a)&&l[a]!==d[a]&&(n||(n={}),n[a]=d[a])}else n||(i||(i=[]),i.push(u,n)),n=d;else u==="dangerouslySetInnerHTML"?(d=d?d.__html:void 0,l=l?l.__html:void 0,d!=null&&l!==d&&(i=i||[]).push(u,d)):u==="children"?typeof d!="string"&&typeof d!="number"||(i=i||[]).push(u,""+d):u!=="suppressContentEditableWarning"&&u!=="suppressHydrationWarning"&&(aa.hasOwnProperty(u)?(d!=null&&u==="onScroll"&&kt("scroll",e),i||l===d||(i=[])):(i=i||[]).push(u,d))}n&&(i=i||[]).push("style",n);var u=i;(t.updateQueue=u)&&(t.flags|=4)}};dy=function(e,t,n,s){n!==s&&(t.flags|=4)};function Bi(e,t){if(!It)switch(e.tailMode){case"hidden":t=e.tail;for(var n=null;t!==null;)t.alternate!==null&&(n=t),t=t.sibling;n===null?e.tail=null:n.sibling=null;break;case"collapsed":n=e.tail;for(var s=null;n!==null;)n.alternate!==null&&(s=n),n=n.sibling;s===null?t||e.tail===null?e.tail=null:e.tail.sibling=null:s.sibling=null}}function un(e){var t=e.alternate!==null&&e.alternate.child===e.child,n=0,s=0;if(t)for(var o=e.child;o!==null;)n|=o.lanes|o.childLanes,s|=o.subtreeFlags&14680064,s|=o.flags&14680064,o.return=e,o=o.sibling;else for(o=e.child;o!==null;)n|=o.lanes|o.childLanes,s|=o.subtreeFlags,s|=o.flags,o.return=e,o=o.sibling;return e.subtreeFlags|=s,e.childLanes=n,t}function p2(e,t,n){var s=t.pendingProps;switch(sf(t),t.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return un(t),null;case 1:return Rn(t.type)&&ac(),un(t),null;case 3:return s=t.stateNode,Zo(),jt(_n),jt(gn),mf(),s.pendingContext&&(s.context=s.pendingContext,s.pendingContext=null),(e===null||e.child===null)&&(ml(t)?t.flags|=4:e===null||e.memoizedState.isDehydrated&&!(t.flags&256)||(t.flags|=1024,cr!==null&&(wp(cr),cr=null))),mp(e,t),un(t),null;case 5:ff(t);var o=Us(ba.current);if(n=t.type,e!==null&&t.stateNode!=null)cy(e,t,n,s,o),e.ref!==t.ref&&(t.flags|=512,t.flags|=2097152);else{if(!s){if(t.stateNode===null)throw Error(be(166));return un(t),null}if(e=Us(jr.current),ml(t)){s=t.stateNode,n=t.type;var i=t.memoizedProps;switch(s[wr]=t,s[xa]=i,e=(t.mode&1)!==0,n){case"dialog":kt("cancel",s),kt("close",s);break;case"iframe":case"object":case"embed":kt("load",s);break;case"video":case"audio":for(o=0;o<Yi.length;o++)kt(Yi[o],s);break;case"source":kt("error",s);break;case"img":case"image":case"link":kt("error",s),kt("load",s);break;case"details":kt("toggle",s);break;case"input":W0(s,i),kt("invalid",s);break;case"select":s._wrapperState={wasMultiple:!!i.multiple},kt("invalid",s);break;case"textarea":G0(s,i),kt("invalid",s)}Fu(n,i),o=null;for(var a in i)if(i.hasOwnProperty(a)){var l=i[a];a==="children"?typeof l=="string"?s.textContent!==l&&(i.suppressHydrationWarning!==!0&&fl(s.textContent,l,e),o=["children",l]):typeof l=="number"&&s.textContent!==""+l&&(i.suppressHydrationWarning!==!0&&fl(s.textContent,l,e),o=["children",""+l]):aa.hasOwnProperty(a)&&l!=null&&a==="onScroll"&&kt("scroll",s)}switch(n){case"input":ol(s),U0(s,i,!0);break;case"textarea":ol(s),V0(s);break;case"select":case"option":break;default:typeof i.onClick=="function"&&(s.onclick=ic)}s=o,t.updateQueue=s,s!==null&&(t.flags|=4)}else{a=o.nodeType===9?o:o.ownerDocument,e==="http://www.w3.org/1999/xhtml"&&(e=Ph(n)),e==="http://www.w3.org/1999/xhtml"?n==="script"?(e=a.createElement("div"),e.innerHTML="<script><\/script>",e=e.removeChild(e.firstChild)):typeof s.is=="string"?e=a.createElement(n,{is:s.is}):(e=a.createElement(n),n==="select"&&(a=e,s.multiple?a.multiple=!0:s.size&&(a.size=s.size))):e=a.createElementNS(e,n),e[wr]=t,e[xa]=s,ly(e,t,!1,!1),t.stateNode=e;e:{switch(a=Hu(n,s),n){case"dialog":kt("cancel",e),kt("close",e),o=s;break;case"iframe":case"object":case"embed":kt("load",e),o=s;break;case"video":case"audio":for(o=0;o<Yi.length;o++)kt(Yi[o],e);o=s;break;case"source":kt("error",e),o=s;break;case"img":case"image":case"link":kt("error",e),kt("load",e),o=s;break;case"details":kt("toggle",e),o=s;break;case"input":W0(e,s),o=Bu(e,s),kt("invalid",e);break;case"option":o=s;break;case"select":e._wrapperState={wasMultiple:!!s.multiple},o=Nt({},s,{value:void 0}),kt("invalid",e);break;case"textarea":G0(e,s),o=zu(e,s),kt("invalid",e);break;default:o=s}Fu(n,o),l=o;for(i in l)if(l.hasOwnProperty(i)){var d=l[i];i==="style"?Fh(e,d):i==="dangerouslySetInnerHTML"?(d=d?d.__html:void 0,d!=null&&zh(e,d)):i==="children"?typeof d=="string"?(n!=="textarea"||d!=="")&&la(e,d):typeof d=="number"&&la(e,""+d):i!=="suppressContentEditableWarning"&&i!=="suppressHydrationWarning"&&i!=="autoFocus"&&(aa.hasOwnProperty(i)?d!=null&&i==="onScroll"&&kt("scroll",e):d!=null&&Wp(e,i,d,a))}switch(n){case"input":ol(e),U0(e,s,!1);break;case"textarea":ol(e),V0(e);break;case"option":s.value!=null&&e.setAttribute("value",""+bs(s.value));break;case"select":e.multiple=!!s.multiple,i=s.value,i!=null?zo(e,!!s.multiple,i,!1):s.defaultValue!=null&&zo(e,!!s.multiple,s.defaultValue,!0);break;default:typeof o.onClick=="function"&&(e.onclick=ic)}switch(n){case"button":case"input":case"select":case"textarea":s=!!s.autoFocus;break e;case"img":s=!0;break e;default:s=!1}}s&&(t.flags|=4)}t.ref!==null&&(t.flags|=512,t.flags|=2097152)}return un(t),null;case 6:if(e&&t.stateNode!=null)dy(e,t,e.memoizedProps,s);else{if(typeof s!="string"&&t.stateNode===null)throw Error(be(166));if(n=Us(ba.current),Us(jr.current),ml(t)){if(s=t.stateNode,n=t.memoizedProps,s[wr]=t,(i=s.nodeValue!==n)&&(e=zn,e!==null))switch(e.tag){case 3:fl(s.nodeValue,n,(e.mode&1)!==0);break;case 5:e.memoizedProps.suppressHydrationWarning!==!0&&fl(s.nodeValue,n,(e.mode&1)!==0)}i&&(t.flags|=4)}else s=(n.nodeType===9?n:n.ownerDocument).createTextNode(s),s[wr]=t,t.stateNode=s}return un(t),null;case 13:if(jt(Mt),s=t.memoizedState,e===null||e.memoizedState!==null&&e.memoizedState.dehydrated!==null){if(It&&On!==null&&t.mode&1&&!(t.flags&128))Ix(),Jo(),t.flags|=98560,i=!1;else if(i=ml(t),s!==null&&s.dehydrated!==null){if(e===null){if(!i)throw Error(be(318));if(i=t.memoizedState,i=i!==null?i.dehydrated:null,!i)throw Error(be(317));i[wr]=t}else Jo(),!(t.flags&128)&&(t.memoizedState=null),t.flags|=4;un(t),i=!1}else cr!==null&&(wp(cr),cr=null),i=!0;if(!i)return t.flags&65536?t:null}return t.flags&128?(t.lanes=n,t):(s=s!==null,s!==(e!==null&&e.memoizedState!==null)&&s&&(t.child.flags|=8192,t.mode&1&&(e===null||Mt.current&1?Wt===0&&(Wt=3):Cf())),t.updateQueue!==null&&(t.flags|=4),un(t),null);case 4:return Zo(),mp(e,t),e===null&&ga(t.stateNode.containerInfo),un(t),null;case 10:return cf(t.type._context),un(t),null;case 17:return Rn(t.type)&&ac(),un(t),null;case 19:if(jt(Mt),i=t.memoizedState,i===null)return un(t),null;if(s=(t.flags&128)!==0,a=i.rendering,a===null)if(s)Bi(i,!1);else{if(Wt!==0||e!==null&&e.flags&128)for(e=t.child;e!==null;){if(a=mc(e),a!==null){for(t.flags|=128,Bi(i,!1),s=a.updateQueue,s!==null&&(t.updateQueue=s,t.flags|=4),t.subtreeFlags=0,s=n,n=t.child;n!==null;)i=n,e=s,i.flags&=14680066,a=i.alternate,a===null?(i.childLanes=0,i.lanes=e,i.child=null,i.subtreeFlags=0,i.memoizedProps=null,i.memoizedState=null,i.updateQueue=null,i.dependencies=null,i.stateNode=null):(i.childLanes=a.childLanes,i.lanes=a.lanes,i.child=a.child,i.subtreeFlags=0,i.deletions=null,i.memoizedProps=a.memoizedProps,i.memoizedState=a.memoizedState,i.updateQueue=a.updateQueue,i.type=a.type,e=a.dependencies,i.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext}),n=n.sibling;return vt(Mt,Mt.current&1|2),t.child}e=e.sibling}i.tail!==null&&zt()>ti&&(t.flags|=128,s=!0,Bi(i,!1),t.lanes=4194304)}else{if(!s)if(e=mc(a),e!==null){if(t.flags|=128,s=!0,n=e.updateQueue,n!==null&&(t.updateQueue=n,t.flags|=4),Bi(i,!0),i.tail===null&&i.tailMode==="hidden"&&!a.alternate&&!It)return un(t),null}else 2*zt()-i.renderingStartTime>ti&&n!==1073741824&&(t.flags|=128,s=!0,Bi(i,!1),t.lanes=4194304);i.isBackwards?(a.sibling=t.child,t.child=a):(n=i.last,n!==null?n.sibling=a:t.child=a,i.last=a)}return i.tail!==null?(t=i.tail,i.rendering=t,i.tail=t.sibling,i.renderingStartTime=zt(),t.sibling=null,n=Mt.current,vt(Mt,s?n&1|2:n&1),t):(un(t),null);case 22:case 23:return jf(),s=t.memoizedState!==null,e!==null&&e.memoizedState!==null!==s&&(t.flags|=8192),s&&t.mode&1?Bn&1073741824&&(un(t),t.subtreeFlags&6&&(t.flags|=8192)):un(t),null;case 24:return null;case 25:return null}throw Error(be(156,t.tag))}function f2(e,t){switch(sf(t),t.tag){case 1:return Rn(t.type)&&ac(),e=t.flags,e&65536?(t.flags=e&-65537|128,t):null;case 3:return Zo(),jt(_n),jt(gn),mf(),e=t.flags,e&65536&&!(e&128)?(t.flags=e&-65537|128,t):null;case 5:return ff(t),null;case 13:if(jt(Mt),e=t.memoizedState,e!==null&&e.dehydrated!==null){if(t.alternate===null)throw Error(be(340));Jo()}return e=t.flags,e&65536?(t.flags=e&-65537|128,t):null;case 19:return jt(Mt),null;case 4:return Zo(),null;case 10:return cf(t.type._context),null;case 22:case 23:return jf(),null;case 24:return null;default:return null}}var xl=!1,mn=!1,m2=typeof WeakSet=="function"?WeakSet:Set,Le=null;function Oo(e,t){var n=e.ref;if(n!==null)if(typeof n=="function")try{n(null)}catch(s){Bt(e,t,s)}else n.current=null}function gp(e,t,n){try{n()}catch(s){Bt(e,t,s)}}var $m=!1;function g2(e,t){if(Xu=rc,e=gx(),nf(e)){if("selectionStart"in e)var n={start:e.selectionStart,end:e.selectionEnd};else e:{n=(n=e.ownerDocument)&&n.defaultView||window;var s=n.getSelection&&n.getSelection();if(s&&s.rangeCount!==0){n=s.anchorNode;var o=s.anchorOffset,i=s.focusNode;s=s.focusOffset;try{n.nodeType,i.nodeType}catch{n=null;break e}var a=0,l=-1,d=-1,u=0,p=0,c=e,m=null;t:for(;;){for(var v;c!==n||o!==0&&c.nodeType!==3||(l=a+o),c!==i||s!==0&&c.nodeType!==3||(d=a+s),c.nodeType===3&&(a+=c.nodeValue.length),(v=c.firstChild)!==null;)m=c,c=v;for(;;){if(c===e)break t;if(m===n&&++u===o&&(l=a),m===i&&++p===s&&(d=a),(v=c.nextSibling)!==null)break;c=m,m=c.parentNode}c=v}n=l===-1||d===-1?null:{start:l,end:d}}else n=null}n=n||{start:0,end:0}}else n=null;for(Zu={focusedElem:e,selectionRange:n},rc=!1,Le=t;Le!==null;)if(t=Le,e=t.child,(t.subtreeFlags&1028)!==0&&e!==null)e.return=t,Le=e;else for(;Le!==null;){t=Le;try{var w=t.alternate;if(t.flags&1024)switch(t.tag){case 0:case 11:case 15:break;case 1:if(w!==null){var E=w.memoizedProps,S=w.memoizedState,g=t.stateNode,h=g.getSnapshotBeforeUpdate(t.elementType===t.type?E:ar(t.type,E),S);g.__reactInternalSnapshotBeforeUpdate=h}break;case 3:var x=t.stateNode.containerInfo;x.nodeType===1?x.textContent="":x.nodeType===9&&x.documentElement&&x.removeChild(x.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(be(163))}}catch(k){Bt(t,t.return,k)}if(e=t.sibling,e!==null){e.return=t.return,Le=e;break}Le=t.return}return w=$m,$m=!1,w}function ra(e,t,n){var s=t.updateQueue;if(s=s!==null?s.lastEffect:null,s!==null){var o=s=s.next;do{if((o.tag&e)===e){var i=o.destroy;o.destroy=void 0,i!==void 0&&gp(t,n,i)}o=o.next}while(o!==s)}}function Uc(e,t){if(t=t.updateQueue,t=t!==null?t.lastEffect:null,t!==null){var n=t=t.next;do{if((n.tag&e)===e){var s=n.create;n.destroy=s()}n=n.next}while(n!==t)}}function hp(e){var t=e.ref;if(t!==null){var n=e.stateNode;switch(e.tag){case 5:e=n;break;default:e=n}typeof t=="function"?t(e):t.current=e}}function uy(e){var t=e.alternate;t!==null&&(e.alternate=null,uy(t)),e.child=null,e.deletions=null,e.sibling=null,e.tag===5&&(t=e.stateNode,t!==null&&(delete t[wr],delete t[xa],delete t[np],delete t[JS],delete t[XS])),e.stateNode=null,e.return=null,e.dependencies=null,e.memoizedProps=null,e.memoizedState=null,e.pendingProps=null,e.stateNode=null,e.updateQueue=null}function py(e){return e.tag===5||e.tag===3||e.tag===4}function Bm(e){e:for(;;){for(;e.sibling===null;){if(e.return===null||py(e.return))return null;e=e.return}for(e.sibling.return=e.return,e=e.sibling;e.tag!==5&&e.tag!==6&&e.tag!==18;){if(e.flags&2||e.child===null||e.tag===4)continue e;e.child.return=e,e=e.child}if(!(e.flags&2))return e.stateNode}}function xp(e,t,n){var s=e.tag;if(s===5||s===6)e=e.stateNode,t?n.nodeType===8?n.parentNode.insertBefore(e,t):n.insertBefore(e,t):(n.nodeType===8?(t=n.parentNode,t.insertBefore(e,n)):(t=n,t.appendChild(e)),n=n._reactRootContainer,n!=null||t.onclick!==null||(t.onclick=ic));else if(s!==4&&(e=e.child,e!==null))for(xp(e,t,n),e=e.sibling;e!==null;)xp(e,t,n),e=e.sibling}function yp(e,t,n){var s=e.tag;if(s===5||s===6)e=e.stateNode,t?n.insertBefore(e,t):n.appendChild(e);else if(s!==4&&(e=e.child,e!==null))for(yp(e,t,n),e=e.sibling;e!==null;)yp(e,t,n),e=e.sibling}var tn=null,lr=!1;function Xr(e,t,n){for(n=n.child;n!==null;)fy(e,t,n),n=n.sibling}function fy(e,t,n){if(kr&&typeof kr.onCommitFiberUnmount=="function")try{kr.onCommitFiberUnmount(Bc,n)}catch{}switch(n.tag){case 5:mn||Oo(n,t);case 6:var s=tn,o=lr;tn=null,Xr(e,t,n),tn=s,lr=o,tn!==null&&(lr?(e=tn,n=n.stateNode,e.nodeType===8?e.parentNode.removeChild(n):e.removeChild(n)):tn.removeChild(n.stateNode));break;case 18:tn!==null&&(lr?(e=tn,n=n.stateNode,e.nodeType===8?Qd(e.parentNode,n):e.nodeType===1&&Qd(e,n),pa(e)):Qd(tn,n.stateNode));break;case 4:s=tn,o=lr,tn=n.stateNode.containerInfo,lr=!0,Xr(e,t,n),tn=s,lr=o;break;case 0:case 11:case 14:case 15:if(!mn&&(s=n.updateQueue,s!==null&&(s=s.lastEffect,s!==null))){o=s=s.next;do{var i=o,a=i.destroy;i=i.tag,a!==void 0&&(i&2||i&4)&&gp(n,t,a),o=o.next}while(o!==s)}Xr(e,t,n);break;case 1:if(!mn&&(Oo(n,t),s=n.stateNode,typeof s.componentWillUnmount=="function"))try{s.props=n.memoizedProps,s.state=n.memoizedState,s.componentWillUnmount()}catch(l){Bt(n,t,l)}Xr(e,t,n);break;case 21:Xr(e,t,n);break;case 22:n.mode&1?(mn=(s=mn)||n.memoizedState!==null,Xr(e,t,n),mn=s):Xr(e,t,n);break;default:Xr(e,t,n)}}function Om(e){var t=e.updateQueue;if(t!==null){e.updateQueue=null;var n=e.stateNode;n===null&&(n=e.stateNode=new m2),t.forEach(function(s){var o=k2.bind(null,e,s);n.has(s)||(n.add(s),s.then(o,o))})}}function sr(e,t){var n=t.deletions;if(n!==null)for(var s=0;s<n.length;s++){var o=n[s];try{var i=e,a=t,l=a;e:for(;l!==null;){switch(l.tag){case 5:tn=l.stateNode,lr=!1;break e;case 3:tn=l.stateNode.containerInfo,lr=!0;break e;case 4:tn=l.stateNode.containerInfo,lr=!0;break e}l=l.return}if(tn===null)throw Error(be(160));fy(i,a,o),tn=null,lr=!1;var d=o.alternate;d!==null&&(d.return=null),o.return=null}catch(u){Bt(o,t,u)}}if(t.subtreeFlags&12854)for(t=t.child;t!==null;)my(t,e),t=t.sibling}function my(e,t){var n=e.alternate,s=e.flags;switch(e.tag){case 0:case 11:case 14:case 15:if(sr(t,e),hr(e),s&4){try{ra(3,e,e.return),Uc(3,e)}catch(E){Bt(e,e.return,E)}try{ra(5,e,e.return)}catch(E){Bt(e,e.return,E)}}break;case 1:sr(t,e),hr(e),s&512&&n!==null&&Oo(n,n.return);break;case 5:if(sr(t,e),hr(e),s&512&&n!==null&&Oo(n,n.return),e.flags&32){var o=e.stateNode;try{la(o,"")}catch(E){Bt(e,e.return,E)}}if(s&4&&(o=e.stateNode,o!=null)){var i=e.memoizedProps,a=n!==null?n.memoizedProps:i,l=e.type,d=e.updateQueue;if(e.updateQueue=null,d!==null)try{l==="input"&&i.type==="radio"&&i.name!=null&&Bh(o,i),Hu(l,a);var u=Hu(l,i);for(a=0;a<d.length;a+=2){var p=d[a],c=d[a+1];p==="style"?Fh(o,c):p==="dangerouslySetInnerHTML"?zh(o,c):p==="children"?la(o,c):Wp(o,p,c,u)}switch(l){case"input":Ou(o,i);break;case"textarea":Oh(o,i);break;case"select":var m=o._wrapperState.wasMultiple;o._wrapperState.wasMultiple=!!i.multiple;var v=i.value;v!=null?zo(o,!!i.multiple,v,!1):m!==!!i.multiple&&(i.defaultValue!=null?zo(o,!!i.multiple,i.defaultValue,!0):zo(o,!!i.multiple,i.multiple?[]:"",!1))}o[xa]=i}catch(E){Bt(e,e.return,E)}}break;case 6:if(sr(t,e),hr(e),s&4){if(e.stateNode===null)throw Error(be(162));o=e.stateNode,i=e.memoizedProps;try{o.nodeValue=i}catch(E){Bt(e,e.return,E)}}break;case 3:if(sr(t,e),hr(e),s&4&&n!==null&&n.memoizedState.isDehydrated)try{pa(t.containerInfo)}catch(E){Bt(e,e.return,E)}break;case 4:sr(t,e),hr(e);break;case 13:sr(t,e),hr(e),o=e.child,o.flags&8192&&(i=o.memoizedState!==null,o.stateNode.isHidden=i,!i||o.alternate!==null&&o.alternate.memoizedState!==null||(Ef=zt())),s&4&&Om(e);break;case 22:if(p=n!==null&&n.memoizedState!==null,e.mode&1?(mn=(u=mn)||p,sr(t,e),mn=u):sr(t,e),hr(e),s&8192){if(u=e.memoizedState!==null,(e.stateNode.isHidden=u)&&!p&&e.mode&1)for(Le=e,p=e.child;p!==null;){for(c=Le=p;Le!==null;){switch(m=Le,v=m.child,m.tag){case 0:case 11:case 14:case 15:ra(4,m,m.return);break;case 1:Oo(m,m.return);var w=m.stateNode;if(typeof w.componentWillUnmount=="function"){s=m,n=m.return;try{t=s,w.props=t.memoizedProps,w.state=t.memoizedState,w.componentWillUnmount()}catch(E){Bt(s,n,E)}}break;case 5:Oo(m,m.return);break;case 22:if(m.memoizedState!==null){zm(c);continue}}v!==null?(v.return=m,Le=v):zm(c)}p=p.sibling}e:for(p=null,c=e;;){if(c.tag===5){if(p===null){p=c;try{o=c.stateNode,u?(i=o.style,typeof i.setProperty=="function"?i.setProperty("display","none","important"):i.display="none"):(l=c.stateNode,d=c.memoizedProps.style,a=d!=null&&d.hasOwnProperty("display")?d.display:null,l.style.display=Dh("display",a))}catch(E){Bt(e,e.return,E)}}}else if(c.tag===6){if(p===null)try{c.stateNode.nodeValue=u?"":c.memoizedProps}catch(E){Bt(e,e.return,E)}}else if((c.tag!==22&&c.tag!==23||c.memoizedState===null||c===e)&&c.child!==null){c.child.return=c,c=c.child;continue}if(c===e)break e;for(;c.sibling===null;){if(c.return===null||c.return===e)break e;p===c&&(p=null),c=c.return}p===c&&(p=null),c.sibling.return=c.return,c=c.sibling}}break;case 19:sr(t,e),hr(e),s&4&&Om(e);break;case 21:break;default:sr(t,e),hr(e)}}function hr(e){var t=e.flags;if(t&2){try{e:{for(var n=e.return;n!==null;){if(py(n)){var s=n;break e}n=n.return}throw Error(be(160))}switch(s.tag){case 5:var o=s.stateNode;s.flags&32&&(la(o,""),s.flags&=-33);var i=Bm(e);yp(e,i,o);break;case 3:case 4:var a=s.stateNode.containerInfo,l=Bm(e);xp(e,l,a);break;default:throw Error(be(161))}}catch(d){Bt(e,e.return,d)}e.flags&=-3}t&4096&&(e.flags&=-4097)}function h2(e,t,n){Le=e,gy(e)}function gy(e,t,n){for(var s=(e.mode&1)!==0;Le!==null;){var o=Le,i=o.child;if(o.tag===22&&s){var a=o.memoizedState!==null||xl;if(!a){var l=o.alternate,d=l!==null&&l.memoizedState!==null||mn;l=xl;var u=mn;if(xl=a,(mn=d)&&!u)for(Le=o;Le!==null;)a=Le,d=a.child,a.tag===22&&a.memoizedState!==null?Dm(o):d!==null?(d.return=a,Le=d):Dm(o);for(;i!==null;)Le=i,gy(i),i=i.sibling;Le=o,xl=l,mn=u}Pm(e)}else o.subtreeFlags&8772&&i!==null?(i.return=o,Le=i):Pm(e)}}function Pm(e){for(;Le!==null;){var t=Le;if(t.flags&8772){var n=t.alternate;try{if(t.flags&8772)switch(t.tag){case 0:case 11:case 15:mn||Uc(5,t);break;case 1:var s=t.stateNode;if(t.flags&4&&!mn)if(n===null)s.componentDidMount();else{var o=t.elementType===t.type?n.memoizedProps:ar(t.type,n.memoizedProps);s.componentDidUpdate(o,n.memoizedState,s.__reactInternalSnapshotBeforeUpdate)}var i=t.updateQueue;i!==null&&wm(t,i,s);break;case 3:var a=t.updateQueue;if(a!==null){if(n=null,t.child!==null)switch(t.child.tag){case 5:n=t.child.stateNode;break;case 1:n=t.child.stateNode}wm(t,a,n)}break;case 5:var l=t.stateNode;if(n===null&&t.flags&4){n=l;var d=t.memoizedProps;switch(t.type){case"button":case"input":case"select":case"textarea":d.autoFocus&&n.focus();break;case"img":d.src&&(n.src=d.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(t.memoizedState===null){var u=t.alternate;if(u!==null){var p=u.memoizedState;if(p!==null){var c=p.dehydrated;c!==null&&pa(c)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(be(163))}mn||t.flags&512&&hp(t)}catch(m){Bt(t,t.return,m)}}if(t===e){Le=null;break}if(n=t.sibling,n!==null){n.return=t.return,Le=n;break}Le=t.return}}function zm(e){for(;Le!==null;){var t=Le;if(t===e){Le=null;break}var n=t.sibling;if(n!==null){n.return=t.return,Le=n;break}Le=t.return}}function Dm(e){for(;Le!==null;){var t=Le;try{switch(t.tag){case 0:case 11:case 15:var n=t.return;try{Uc(4,t)}catch(d){Bt(t,n,d)}break;case 1:var s=t.stateNode;if(typeof s.componentDidMount=="function"){var o=t.return;try{s.componentDidMount()}catch(d){Bt(t,o,d)}}var i=t.return;try{hp(t)}catch(d){Bt(t,i,d)}break;case 5:var a=t.return;try{hp(t)}catch(d){Bt(t,a,d)}}}catch(d){Bt(t,t.return,d)}if(t===e){Le=null;break}var l=t.sibling;if(l!==null){l.return=t.return,Le=l;break}Le=t.return}}var x2=Math.ceil,xc=Vr.ReactCurrentDispatcher,Sf=Vr.ReactCurrentOwner,Xn=Vr.ReactCurrentBatchConfig,lt=0,Kt=null,Dt=null,rn=0,Bn=0,Po=ws(0),Wt=0,Ea=null,no=0,Gc=0,wf=0,sa=null,Tn=null,Ef=0,ti=1/0,$r=null,yc=!1,bp=null,gs=null,yl=!1,ls=null,bc=0,oa=0,vp=null,Hl=-1,Wl=0;function bn(){return lt&6?zt():Hl!==-1?Hl:Hl=zt()}function hs(e){return e.mode&1?lt&2&&rn!==0?rn&-rn:e2.transition!==null?(Wl===0&&(Wl=Zh()),Wl):(e=xt,e!==0||(e=window.event,e=e===void 0?16:ix(e.type)),e):1}function ur(e,t,n,s){if(50<oa)throw oa=0,vp=null,Error(be(185));Ra(e,n,s),(!(lt&2)||e!==Kt)&&(e===Kt&&(!(lt&2)&&(Gc|=n),Wt===4&&is(e,rn)),Mn(e,s),n===1&&lt===0&&!(t.mode&1)&&(ti=zt()+500,Fc&&Es()))}function Mn(e,t){var n=e.callbackNode;eS(e,t);var s=nc(e,e===Kt?rn:0);if(s===0)n!==null&&K0(n),e.callbackNode=null,e.callbackPriority=0;else if(t=s&-s,e.callbackPriority!==t){if(n!=null&&K0(n),t===1)e.tag===0?ZS(Fm.bind(null,e)):jx(Fm.bind(null,e)),KS(function(){!(lt&6)&&Es()}),n=null;else{switch(ex(s)){case 1:n=qp;break;case 4:n=Jh;break;case 16:n=tc;break;case 536870912:n=Xh;break;default:n=tc}n=Ey(n,hy.bind(null,e))}e.callbackPriority=t,e.callbackNode=n}}function hy(e,t){if(Hl=-1,Wl=0,lt&6)throw Error(be(327));var n=e.callbackNode;if(Uo()&&e.callbackNode!==n)return null;var s=nc(e,e===Kt?rn:0);if(s===0)return null;if(s&30||s&e.expiredLanes||t)t=vc(e,s);else{t=s;var o=lt;lt|=2;var i=yy();(Kt!==e||rn!==t)&&($r=null,ti=zt()+500,Vs(e,t));do try{v2();break}catch(l){xy(e,l)}while(!0);lf(),xc.current=i,lt=o,Dt!==null?t=0:(Kt=null,rn=0,t=Wt)}if(t!==0){if(t===2&&(o=Yu(e),o!==0&&(s=o,t=Sp(e,o))),t===1)throw n=Ea,Vs(e,0),is(e,s),Mn(e,zt()),n;if(t===6)is(e,s);else{if(o=e.current.alternate,!(s&30)&&!y2(o)&&(t=vc(e,s),t===2&&(i=Yu(e),i!==0&&(s=i,t=Sp(e,i))),t===1))throw n=Ea,Vs(e,0),is(e,s),Mn(e,zt()),n;switch(e.finishedWork=o,e.finishedLanes=s,t){case 0:case 1:throw Error(be(345));case 2:Fs(e,Tn,$r);break;case 3:if(is(e,s),(s&130023424)===s&&(t=Ef+500-zt(),10<t)){if(nc(e,0)!==0)break;if(o=e.suspendedLanes,(o&s)!==s){bn(),e.pingedLanes|=e.suspendedLanes&o;break}e.timeoutHandle=tp(Fs.bind(null,e,Tn,$r),t);break}Fs(e,Tn,$r);break;case 4:if(is(e,s),(s&4194240)===s)break;for(t=e.eventTimes,o=-1;0<s;){var a=31-dr(s);i=1<<a,a=t[a],a>o&&(o=a),s&=~i}if(s=o,s=zt()-s,s=(120>s?120:480>s?480:1080>s?1080:1920>s?1920:3e3>s?3e3:4320>s?4320:1960*x2(s/1960))-s,10<s){e.timeoutHandle=tp(Fs.bind(null,e,Tn,$r),s);break}Fs(e,Tn,$r);break;case 5:Fs(e,Tn,$r);break;default:throw Error(be(329))}}}return Mn(e,zt()),e.callbackNode===n?hy.bind(null,e):null}function Sp(e,t){var n=sa;return e.current.memoizedState.isDehydrated&&(Vs(e,t).flags|=256),e=vc(e,t),e!==2&&(t=Tn,Tn=n,t!==null&&wp(t)),e}function wp(e){Tn===null?Tn=e:Tn.push.apply(Tn,e)}function y2(e){for(var t=e;;){if(t.flags&16384){var n=t.updateQueue;if(n!==null&&(n=n.stores,n!==null))for(var s=0;s<n.length;s++){var o=n[s],i=o.getSnapshot;o=o.value;try{if(!pr(i(),o))return!1}catch{return!1}}}if(n=t.child,t.subtreeFlags&16384&&n!==null)n.return=t,t=n;else{if(t===e)break;for(;t.sibling===null;){if(t.return===null||t.return===e)return!0;t=t.return}t.sibling.return=t.return,t=t.sibling}}return!0}function is(e,t){for(t&=~wf,t&=~Gc,e.suspendedLanes|=t,e.pingedLanes&=~t,e=e.expirationTimes;0<t;){var n=31-dr(t),s=1<<n;e[n]=-1,t&=~s}}function Fm(e){if(lt&6)throw Error(be(327));Uo();var t=nc(e,0);if(!(t&1))return Mn(e,zt()),null;var n=vc(e,t);if(e.tag!==0&&n===2){var s=Yu(e);s!==0&&(t=s,n=Sp(e,s))}if(n===1)throw n=Ea,Vs(e,0),is(e,t),Mn(e,zt()),n;if(n===6)throw Error(be(345));return e.finishedWork=e.current.alternate,e.finishedLanes=t,Fs(e,Tn,$r),Mn(e,zt()),null}function kf(e,t){var n=lt;lt|=1;try{return e(t)}finally{lt=n,lt===0&&(ti=zt()+500,Fc&&Es())}}function ro(e){ls!==null&&ls.tag===0&&!(lt&6)&&Uo();var t=lt;lt|=1;var n=Xn.transition,s=xt;try{if(Xn.transition=null,xt=1,e)return e()}finally{xt=s,Xn.transition=n,lt=t,!(lt&6)&&Es()}}function jf(){Bn=Po.current,jt(Po)}function Vs(e,t){e.finishedWork=null,e.finishedLanes=0;var n=e.timeoutHandle;if(n!==-1&&(e.timeoutHandle=-1,qS(n)),Dt!==null)for(n=Dt.return;n!==null;){var s=n;switch(sf(s),s.tag){case 1:s=s.type.childContextTypes,s!=null&&ac();break;case 3:Zo(),jt(_n),jt(gn),mf();break;case 5:ff(s);break;case 4:Zo();break;case 13:jt(Mt);break;case 19:jt(Mt);break;case 10:cf(s.type._context);break;case 22:case 23:jf()}n=n.return}if(Kt=e,Dt=e=xs(e.current,null),rn=Bn=t,Wt=0,Ea=null,wf=Gc=no=0,Tn=sa=null,Ws!==null){for(t=0;t<Ws.length;t++)if(n=Ws[t],s=n.interleaved,s!==null){n.interleaved=null;var o=s.next,i=n.pending;if(i!==null){var a=i.next;i.next=o,s.next=a}n.pending=s}Ws=null}return e}function xy(e,t){do{var n=Dt;try{if(lf(),zl.current=hc,gc){for(var s=At.memoizedState;s!==null;){var o=s.queue;o!==null&&(o.pending=null),s=s.next}gc=!1}if(to=0,qt=Ft=At=null,na=!1,va=0,Sf.current=null,n===null||n.return===null){Wt=1,Ea=t,Dt=null;break}e:{var i=e,a=n.return,l=n,d=t;if(t=rn,l.flags|=32768,d!==null&&typeof d=="object"&&typeof d.then=="function"){var u=d,p=l,c=p.tag;if(!(p.mode&1)&&(c===0||c===11||c===15)){var m=p.alternate;m?(p.updateQueue=m.updateQueue,p.memoizedState=m.memoizedState,p.lanes=m.lanes):(p.updateQueue=null,p.memoizedState=null)}var v=Im(a);if(v!==null){v.flags&=-257,_m(v,a,l,i,t),v.mode&1&&Tm(i,u,t),t=v,d=u;var w=t.updateQueue;if(w===null){var E=new Set;E.add(d),t.updateQueue=E}else w.add(d);break e}else{if(!(t&1)){Tm(i,u,t),Cf();break e}d=Error(be(426))}}else if(It&&l.mode&1){var S=Im(a);if(S!==null){!(S.flags&65536)&&(S.flags|=256),_m(S,a,l,i,t),of(ei(d,l));break e}}i=d=ei(d,l),Wt!==4&&(Wt=2),sa===null?sa=[i]:sa.push(i),i=a;do{switch(i.tag){case 3:i.flags|=65536,t&=-t,i.lanes|=t;var g=ey(i,d,t);Sm(i,g);break e;case 1:l=d;var h=i.type,x=i.stateNode;if(!(i.flags&128)&&(typeof h.getDerivedStateFromError=="function"||x!==null&&typeof x.componentDidCatch=="function"&&(gs===null||!gs.has(x)))){i.flags|=65536,t&=-t,i.lanes|=t;var k=ty(i,l,t);Sm(i,k);break e}}i=i.return}while(i!==null)}vy(n)}catch(_){t=_,Dt===n&&n!==null&&(Dt=n=n.return);continue}break}while(!0)}function yy(){var e=xc.current;return xc.current=hc,e===null?hc:e}function Cf(){(Wt===0||Wt===3||Wt===2)&&(Wt=4),Kt===null||!(no&268435455)&&!(Gc&268435455)||is(Kt,rn)}function vc(e,t){var n=lt;lt|=2;var s=yy();(Kt!==e||rn!==t)&&($r=null,Vs(e,t));do try{b2();break}catch(o){xy(e,o)}while(!0);if(lf(),lt=n,xc.current=s,Dt!==null)throw Error(be(261));return Kt=null,rn=0,Wt}function b2(){for(;Dt!==null;)by(Dt)}function v2(){for(;Dt!==null&&!Gv();)by(Dt)}function by(e){var t=wy(e.alternate,e,Bn);e.memoizedProps=e.pendingProps,t===null?vy(e):Dt=t,Sf.current=null}function vy(e){var t=e;do{var n=t.alternate;if(e=t.return,t.flags&32768){if(n=f2(n,t),n!==null){n.flags&=32767,Dt=n;return}if(e!==null)e.flags|=32768,e.subtreeFlags=0,e.deletions=null;else{Wt=6,Dt=null;return}}else if(n=p2(n,t,Bn),n!==null){Dt=n;return}if(t=t.sibling,t!==null){Dt=t;return}Dt=t=e}while(t!==null);Wt===0&&(Wt=5)}function Fs(e,t,n){var s=xt,o=Xn.transition;try{Xn.transition=null,xt=1,S2(e,t,n,s)}finally{Xn.transition=o,xt=s}return null}function S2(e,t,n,s){do Uo();while(ls!==null);if(lt&6)throw Error(be(327));n=e.finishedWork;var o=e.finishedLanes;if(n===null)return null;if(e.finishedWork=null,e.finishedLanes=0,n===e.current)throw Error(be(177));e.callbackNode=null,e.callbackPriority=0;var i=n.lanes|n.childLanes;if(tS(e,i),e===Kt&&(Dt=Kt=null,rn=0),!(n.subtreeFlags&2064)&&!(n.flags&2064)||yl||(yl=!0,Ey(tc,function(){return Uo(),null})),i=(n.flags&15990)!==0,n.subtreeFlags&15990||i){i=Xn.transition,Xn.transition=null;var a=xt;xt=1;var l=lt;lt|=4,Sf.current=null,g2(e,n),my(n,e),FS(Zu),rc=!!Xu,Zu=Xu=null,e.current=n,h2(n),Vv(),lt=l,xt=a,Xn.transition=i}else e.current=n;if(yl&&(yl=!1,ls=e,bc=o),i=e.pendingLanes,i===0&&(gs=null),Kv(n.stateNode),Mn(e,zt()),t!==null)for(s=e.onRecoverableError,n=0;n<t.length;n++)o=t[n],s(o.value,{componentStack:o.stack,digest:o.digest});if(yc)throw yc=!1,e=bp,bp=null,e;return bc&1&&e.tag!==0&&Uo(),i=e.pendingLanes,i&1?e===vp?oa++:(oa=0,vp=e):oa=0,Es(),null}function Uo(){if(ls!==null){var e=ex(bc),t=Xn.transition,n=xt;try{if(Xn.transition=null,xt=16>e?16:e,ls===null)var s=!1;else{if(e=ls,ls=null,bc=0,lt&6)throw Error(be(331));var o=lt;for(lt|=4,Le=e.current;Le!==null;){var i=Le,a=i.child;if(Le.flags&16){var l=i.deletions;if(l!==null){for(var d=0;d<l.length;d++){var u=l[d];for(Le=u;Le!==null;){var p=Le;switch(p.tag){case 0:case 11:case 15:ra(8,p,i)}var c=p.child;if(c!==null)c.return=p,Le=c;else for(;Le!==null;){p=Le;var m=p.sibling,v=p.return;if(uy(p),p===u){Le=null;break}if(m!==null){m.return=v,Le=m;break}Le=v}}}var w=i.alternate;if(w!==null){var E=w.child;if(E!==null){w.child=null;do{var S=E.sibling;E.sibling=null,E=S}while(E!==null)}}Le=i}}if(i.subtreeFlags&2064&&a!==null)a.return=i,Le=a;else e:for(;Le!==null;){if(i=Le,i.flags&2048)switch(i.tag){case 0:case 11:case 15:ra(9,i,i.return)}var g=i.sibling;if(g!==null){g.return=i.return,Le=g;break e}Le=i.return}}var h=e.current;for(Le=h;Le!==null;){a=Le;var x=a.child;if(a.subtreeFlags&2064&&x!==null)x.return=a,Le=x;else e:for(a=h;Le!==null;){if(l=Le,l.flags&2048)try{switch(l.tag){case 0:case 11:case 15:Uc(9,l)}}catch(_){Bt(l,l.return,_)}if(l===a){Le=null;break e}var k=l.sibling;if(k!==null){k.return=l.return,Le=k;break e}Le=l.return}}if(lt=o,Es(),kr&&typeof kr.onPostCommitFiberRoot=="function")try{kr.onPostCommitFiberRoot(Bc,e)}catch{}s=!0}return s}finally{xt=n,Xn.transition=t}}return!1}function Hm(e,t,n){t=ei(n,t),t=ey(e,t,1),e=ms(e,t,1),t=bn(),e!==null&&(Ra(e,1,t),Mn(e,t))}function Bt(e,t,n){if(e.tag===3)Hm(e,e,n);else for(;t!==null;){if(t.tag===3){Hm(t,e,n);break}else if(t.tag===1){var s=t.stateNode;if(typeof t.type.getDerivedStateFromError=="function"||typeof s.componentDidCatch=="function"&&(gs===null||!gs.has(s))){e=ei(n,e),e=ty(t,e,1),t=ms(t,e,1),e=bn(),t!==null&&(Ra(t,1,e),Mn(t,e));break}}t=t.return}}function w2(e,t,n){var s=e.pingCache;s!==null&&s.delete(t),t=bn(),e.pingedLanes|=e.suspendedLanes&n,Kt===e&&(rn&n)===n&&(Wt===4||Wt===3&&(rn&130023424)===rn&&500>zt()-Ef?Vs(e,0):wf|=n),Mn(e,t)}function Sy(e,t){t===0&&(e.mode&1?(t=ll,ll<<=1,!(ll&130023424)&&(ll=4194304)):t=1);var n=bn();e=Wr(e,t),e!==null&&(Ra(e,t,n),Mn(e,n))}function E2(e){var t=e.memoizedState,n=0;t!==null&&(n=t.retryLane),Sy(e,n)}function k2(e,t){var n=0;switch(e.tag){case 13:var s=e.stateNode,o=e.memoizedState;o!==null&&(n=o.retryLane);break;case 19:s=e.stateNode;break;default:throw Error(be(314))}s!==null&&s.delete(t),Sy(e,n)}var wy;wy=function(e,t,n){if(e!==null)if(e.memoizedProps!==t.pendingProps||_n.current)In=!0;else{if(!(e.lanes&n)&&!(t.flags&128))return In=!1,u2(e,t,n);In=!!(e.flags&131072)}else In=!1,It&&t.flags&1048576&&Cx(t,dc,t.index);switch(t.lanes=0,t.tag){case 2:var s=t.type;Fl(e,t),e=t.pendingProps;var o=Qo(t,gn.current);Wo(t,n),o=hf(null,t,s,e,o,n);var i=xf();return t.flags|=1,typeof o=="object"&&o!==null&&typeof o.render=="function"&&o.$$typeof===void 0?(t.tag=1,t.memoizedState=null,t.updateQueue=null,Rn(s)?(i=!0,lc(t)):i=!1,t.memoizedState=o.state!==null&&o.state!==void 0?o.state:null,uf(t),o.updater=Wc,t.stateNode=o,o._reactInternals=t,lp(t,s,e,n),t=up(null,t,s,!0,i,n)):(t.tag=0,It&&i&&rf(t),yn(null,t,o,n),t=t.child),t;case 16:s=t.elementType;e:{switch(Fl(e,t),e=t.pendingProps,o=s._init,s=o(s._payload),t.type=s,o=t.tag=C2(s),e=ar(s,e),o){case 0:t=dp(null,t,s,e,n);break e;case 1:t=Am(null,t,s,e,n);break e;case 11:t=Rm(null,t,s,e,n);break e;case 14:t=Mm(null,t,s,ar(s.type,e),n);break e}throw Error(be(306,s,""))}return t;case 0:return s=t.type,o=t.pendingProps,o=t.elementType===s?o:ar(s,o),dp(e,t,s,o,n);case 1:return s=t.type,o=t.pendingProps,o=t.elementType===s?o:ar(s,o),Am(e,t,s,o,n);case 3:e:{if(oy(t),e===null)throw Error(be(387));s=t.pendingProps,i=t.memoizedState,o=i.element,Ax(e,t),fc(t,s,null,n);var a=t.memoizedState;if(s=a.element,i.isDehydrated)if(i={element:s,isDehydrated:!1,cache:a.cache,pendingSuspenseBoundaries:a.pendingSuspenseBoundaries,transitions:a.transitions},t.updateQueue.baseState=i,t.memoizedState=i,t.flags&256){o=ei(Error(be(423)),t),t=Nm(e,t,s,n,o);break e}else if(s!==o){o=ei(Error(be(424)),t),t=Nm(e,t,s,n,o);break e}else for(On=fs(t.stateNode.containerInfo.firstChild),zn=t,It=!0,cr=null,n=Rx(t,null,s,n),t.child=n;n;)n.flags=n.flags&-3|4096,n=n.sibling;else{if(Jo(),s===o){t=Ur(e,t,n);break e}yn(e,t,s,n)}t=t.child}return t;case 5:return Nx(t),e===null&&op(t),s=t.type,o=t.pendingProps,i=e!==null?e.memoizedProps:null,a=o.children,ep(s,o)?a=null:i!==null&&ep(s,i)&&(t.flags|=32),sy(e,t),yn(e,t,a,n),t.child;case 6:return e===null&&op(t),null;case 13:return iy(e,t,n);case 4:return pf(t,t.stateNode.containerInfo),s=t.pendingProps,e===null?t.child=Xo(t,null,s,n):yn(e,t,s,n),t.child;case 11:return s=t.type,o=t.pendingProps,o=t.elementType===s?o:ar(s,o),Rm(e,t,s,o,n);case 7:return yn(e,t,t.pendingProps,n),t.child;case 8:return yn(e,t,t.pendingProps.children,n),t.child;case 12:return yn(e,t,t.pendingProps.children,n),t.child;case 10:e:{if(s=t.type._context,o=t.pendingProps,i=t.memoizedProps,a=o.value,vt(uc,s._currentValue),s._currentValue=a,i!==null)if(pr(i.value,a)){if(i.children===o.children&&!_n.current){t=Ur(e,t,n);break e}}else for(i=t.child,i!==null&&(i.return=t);i!==null;){var l=i.dependencies;if(l!==null){a=i.child;for(var d=l.firstContext;d!==null;){if(d.context===s){if(i.tag===1){d=Dr(-1,n&-n),d.tag=2;var u=i.updateQueue;if(u!==null){u=u.shared;var p=u.pending;p===null?d.next=d:(d.next=p.next,p.next=d),u.pending=d}}i.lanes|=n,d=i.alternate,d!==null&&(d.lanes|=n),ip(i.return,n,t),l.lanes|=n;break}d=d.next}}else if(i.tag===10)a=i.type===t.type?null:i.child;else if(i.tag===18){if(a=i.return,a===null)throw Error(be(341));a.lanes|=n,l=a.alternate,l!==null&&(l.lanes|=n),ip(a,n,t),a=i.sibling}else a=i.child;if(a!==null)a.return=i;else for(a=i;a!==null;){if(a===t){a=null;break}if(i=a.sibling,i!==null){i.return=a.return,a=i;break}a=a.return}i=a}yn(e,t,o.children,n),t=t.child}return t;case 9:return o=t.type,s=t.pendingProps.children,Wo(t,n),o=Zn(o),s=s(o),t.flags|=1,yn(e,t,s,n),t.child;case 14:return s=t.type,o=ar(s,t.pendingProps),o=ar(s.type,o),Mm(e,t,s,o,n);case 15:return ny(e,t,t.type,t.pendingProps,n);case 17:return s=t.type,o=t.pendingProps,o=t.elementType===s?o:ar(s,o),Fl(e,t),t.tag=1,Rn(s)?(e=!0,lc(t)):e=!1,Wo(t,n),Zx(t,s,o),lp(t,s,o,n),up(null,t,s,!0,e,n);case 19:return ay(e,t,n);case 22:return ry(e,t,n)}throw Error(be(156,t.tag))};function Ey(e,t){return Qh(e,t)}function j2(e,t,n,s){this.tag=e,this.key=n,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=t,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=s,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Jn(e,t,n,s){return new j2(e,t,n,s)}function Tf(e){return e=e.prototype,!(!e||!e.isReactComponent)}function C2(e){if(typeof e=="function")return Tf(e)?1:0;if(e!=null){if(e=e.$$typeof,e===Gp)return 11;if(e===Vp)return 14}return 2}function xs(e,t){var n=e.alternate;return n===null?(n=Jn(e.tag,t,e.key,e.mode),n.elementType=e.elementType,n.type=e.type,n.stateNode=e.stateNode,n.alternate=e,e.alternate=n):(n.pendingProps=t,n.type=e.type,n.flags=0,n.subtreeFlags=0,n.deletions=null),n.flags=e.flags&14680064,n.childLanes=e.childLanes,n.lanes=e.lanes,n.child=e.child,n.memoizedProps=e.memoizedProps,n.memoizedState=e.memoizedState,n.updateQueue=e.updateQueue,t=e.dependencies,n.dependencies=t===null?null:{lanes:t.lanes,firstContext:t.firstContext},n.sibling=e.sibling,n.index=e.index,n.ref=e.ref,n}function Ul(e,t,n,s,o,i){var a=2;if(s=e,typeof e=="function")Tf(e)&&(a=1);else if(typeof e=="string")a=5;else e:switch(e){case Io:return Ys(n.children,o,i,t);case Up:a=8,o|=8;break;case Au:return e=Jn(12,n,t,o|2),e.elementType=Au,e.lanes=i,e;case Nu:return e=Jn(13,n,t,o),e.elementType=Nu,e.lanes=i,e;case Lu:return e=Jn(19,n,t,o),e.elementType=Lu,e.lanes=i,e;case Nh:return Vc(n,o,i,t);default:if(typeof e=="object"&&e!==null)switch(e.$$typeof){case Mh:a=10;break e;case Ah:a=9;break e;case Gp:a=11;break e;case Vp:a=14;break e;case ns:a=16,s=null;break e}throw Error(be(130,e==null?e:typeof e,""))}return t=Jn(a,n,t,o),t.elementType=e,t.type=s,t.lanes=i,t}function Ys(e,t,n,s){return e=Jn(7,e,s,t),e.lanes=n,e}function Vc(e,t,n,s){return e=Jn(22,e,s,t),e.elementType=Nh,e.lanes=n,e.stateNode={isHidden:!1},e}function su(e,t,n){return e=Jn(6,e,null,t),e.lanes=n,e}function ou(e,t,n){return t=Jn(4,e.children!==null?e.children:[],e.key,t),t.lanes=n,t.stateNode={containerInfo:e.containerInfo,pendingChildren:null,implementation:e.implementation},t}function T2(e,t,n,s,o){this.tag=t,this.containerInfo=e,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=zd(0),this.expirationTimes=zd(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=zd(0),this.identifierPrefix=s,this.onRecoverableError=o,this.mutableSourceEagerHydrationData=null}function If(e,t,n,s,o,i,a,l,d){return e=new T2(e,t,n,l,d),t===1?(t=1,i===!0&&(t|=8)):t=0,i=Jn(3,null,null,t),e.current=i,i.stateNode=e,i.memoizedState={element:s,isDehydrated:n,cache:null,transitions:null,pendingSuspenseBoundaries:null},uf(i),e}function I2(e,t,n){var s=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:To,key:s==null?null:""+s,children:e,containerInfo:t,implementation:n}}function ky(e){if(!e)return vs;e=e._reactInternals;e:{if(ao(e)!==e||e.tag!==1)throw Error(be(170));var t=e;do{switch(t.tag){case 3:t=t.stateNode.context;break e;case 1:if(Rn(t.type)){t=t.stateNode.__reactInternalMemoizedMergedChildContext;break e}}t=t.return}while(t!==null);throw Error(be(171))}if(e.tag===1){var n=e.type;if(Rn(n))return kx(e,n,t)}return t}function jy(e,t,n,s,o,i,a,l,d){return e=If(n,s,!0,e,o,i,a,l,d),e.context=ky(null),n=e.current,s=bn(),o=hs(n),i=Dr(s,o),i.callback=t??null,ms(n,i,o),e.current.lanes=o,Ra(e,o,s),Mn(e,s),e}function Yc(e,t,n,s){var o=t.current,i=bn(),a=hs(o);return n=ky(n),t.context===null?t.context=n:t.pendingContext=n,t=Dr(i,a),t.payload={element:e},s=s===void 0?null:s,s!==null&&(t.callback=s),e=ms(o,t,a),e!==null&&(ur(e,o,a,i),Pl(e,o,a)),a}function Sc(e){if(e=e.current,!e.child)return null;switch(e.child.tag){case 5:return e.child.stateNode;default:return e.child.stateNode}}function Wm(e,t){if(e=e.memoizedState,e!==null&&e.dehydrated!==null){var n=e.retryLane;e.retryLane=n!==0&&n<t?n:t}}function _f(e,t){Wm(e,t),(e=e.alternate)&&Wm(e,t)}function _2(){return null}var Cy=typeof reportError=="function"?reportError:function(e){console.error(e)};function Rf(e){this._internalRoot=e}qc.prototype.render=Rf.prototype.render=function(e){var t=this._internalRoot;if(t===null)throw Error(be(409));Yc(e,t,null,null)};qc.prototype.unmount=Rf.prototype.unmount=function(){var e=this._internalRoot;if(e!==null){this._internalRoot=null;var t=e.containerInfo;ro(function(){Yc(null,e,null,null)}),t[Hr]=null}};function qc(e){this._internalRoot=e}qc.prototype.unstable_scheduleHydration=function(e){if(e){var t=rx();e={blockedOn:null,target:e,priority:t};for(var n=0;n<os.length&&t!==0&&t<os[n].priority;n++);os.splice(n,0,e),n===0&&ox(e)}};function Mf(e){return!(!e||e.nodeType!==1&&e.nodeType!==9&&e.nodeType!==11)}function Kc(e){return!(!e||e.nodeType!==1&&e.nodeType!==9&&e.nodeType!==11&&(e.nodeType!==8||e.nodeValue!==" react-mount-point-unstable "))}function Um(){}function R2(e,t,n,s,o){if(o){if(typeof s=="function"){var i=s;s=function(){var u=Sc(a);i.call(u)}}var a=jy(t,s,e,0,null,!1,!1,"",Um);return e._reactRootContainer=a,e[Hr]=a.current,ga(e.nodeType===8?e.parentNode:e),ro(),a}for(;o=e.lastChild;)e.removeChild(o);if(typeof s=="function"){var l=s;s=function(){var u=Sc(d);l.call(u)}}var d=If(e,0,!1,null,null,!1,!1,"",Um);return e._reactRootContainer=d,e[Hr]=d.current,ga(e.nodeType===8?e.parentNode:e),ro(function(){Yc(t,d,n,s)}),d}function Qc(e,t,n,s,o){var i=n._reactRootContainer;if(i){var a=i;if(typeof o=="function"){var l=o;o=function(){var d=Sc(a);l.call(d)}}Yc(t,a,e,o)}else a=R2(n,t,e,o,s);return Sc(a)}tx=function(e){switch(e.tag){case 3:var t=e.stateNode;if(t.current.memoizedState.isDehydrated){var n=Vi(t.pendingLanes);n!==0&&(Kp(t,n|1),Mn(t,zt()),!(lt&6)&&(ti=zt()+500,Es()))}break;case 13:ro(function(){var s=Wr(e,1);if(s!==null){var o=bn();ur(s,e,1,o)}}),_f(e,1)}};Qp=function(e){if(e.tag===13){var t=Wr(e,134217728);if(t!==null){var n=bn();ur(t,e,134217728,n)}_f(e,134217728)}};nx=function(e){if(e.tag===13){var t=hs(e),n=Wr(e,t);if(n!==null){var s=bn();ur(n,e,t,s)}_f(e,t)}};rx=function(){return xt};sx=function(e,t){var n=xt;try{return xt=e,t()}finally{xt=n}};Uu=function(e,t,n){switch(t){case"input":if(Ou(e,n),t=n.name,n.type==="radio"&&t!=null){for(n=e;n.parentNode;)n=n.parentNode;for(n=n.querySelectorAll("input[name="+JSON.stringify(""+t)+'][type="radio"]'),t=0;t<n.length;t++){var s=n[t];if(s!==e&&s.form===e.form){var o=Dc(s);if(!o)throw Error(be(90));$h(s),Ou(s,o)}}}break;case"textarea":Oh(e,n);break;case"select":t=n.value,t!=null&&zo(e,!!n.multiple,t,!1)}};Uh=kf;Gh=ro;var M2={usingClientEntryPoint:!1,Events:[Aa,Ao,Dc,Hh,Wh,kf]},Oi={findFiberByHostInstance:Hs,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},A2={bundleType:Oi.bundleType,version:Oi.version,rendererPackageName:Oi.rendererPackageName,rendererConfig:Oi.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:Vr.ReactCurrentDispatcher,findHostInstanceByFiber:function(e){return e=qh(e),e===null?null:e.stateNode},findFiberByHostInstance:Oi.findFiberByHostInstance||_2,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var bl=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!bl.isDisabled&&bl.supportsFiber)try{Bc=bl.inject(A2),kr=bl}catch{}}Fn.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=M2;Fn.createPortal=function(e,t){var n=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!Mf(t))throw Error(be(200));return I2(e,t,null,n)};Fn.createRoot=function(e,t){if(!Mf(e))throw Error(be(299));var n=!1,s="",o=Cy;return t!=null&&(t.unstable_strictMode===!0&&(n=!0),t.identifierPrefix!==void 0&&(s=t.identifierPrefix),t.onRecoverableError!==void 0&&(o=t.onRecoverableError)),t=If(e,1,!1,null,null,n,!1,s,o),e[Hr]=t.current,ga(e.nodeType===8?e.parentNode:e),new Rf(t)};Fn.findDOMNode=function(e){if(e==null)return null;if(e.nodeType===1)return e;var t=e._reactInternals;if(t===void 0)throw typeof e.render=="function"?Error(be(188)):(e=Object.keys(e).join(","),Error(be(268,e)));return e=qh(t),e=e===null?null:e.stateNode,e};Fn.flushSync=function(e){return ro(e)};Fn.hydrate=function(e,t,n){if(!Kc(t))throw Error(be(200));return Qc(null,e,t,!0,n)};Fn.hydrateRoot=function(e,t,n){if(!Mf(e))throw Error(be(405));var s=n!=null&&n.hydratedSources||null,o=!1,i="",a=Cy;if(n!=null&&(n.unstable_strictMode===!0&&(o=!0),n.identifierPrefix!==void 0&&(i=n.identifierPrefix),n.onRecoverableError!==void 0&&(a=n.onRecoverableError)),t=jy(t,null,e,1,n??null,o,!1,i,a),e[Hr]=t.current,ga(e),s)for(e=0;e<s.length;e++)n=s[e],o=n._getVersion,o=o(n._source),t.mutableSourceEagerHydrationData==null?t.mutableSourceEagerHydrationData=[n,o]:t.mutableSourceEagerHydrationData.push(n,o);return new qc(t)};Fn.render=function(e,t,n){if(!Kc(t))throw Error(be(200));return Qc(null,e,t,!1,n)};Fn.unmountComponentAtNode=function(e){if(!Kc(e))throw Error(be(40));return e._reactRootContainer?(ro(function(){Qc(null,null,e,!1,function(){e._reactRootContainer=null,e[Hr]=null})}),!0):!1};Fn.unstable_batchedUpdates=kf;Fn.unstable_renderSubtreeIntoContainer=function(e,t,n,s){if(!Kc(n))throw Error(be(200));if(e==null||e._reactInternals===void 0)throw Error(be(38));return Qc(e,t,n,!1,s)};Fn.version="18.3.1-next-f1338f8080-20240426";function Ty(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(Ty)}catch(e){console.error(e)}}Ty(),Th.exports=Fn;var N2=Th.exports,Gm=N2;Ru.createRoot=Gm.createRoot,Ru.hydrateRoot=Gm.hydrateRoot;const L2="modulepreload",$2=function(e,t){return new URL(e,t).href},Vm={},B2=function(t,n,s){let o=Promise.resolve();if(n&&n.length>0){const a=document.getElementsByTagName("link"),l=document.querySelector("meta[property=csp-nonce]"),d=(l==null?void 0:l.nonce)||(l==null?void 0:l.getAttribute("nonce"));o=Promise.allSettled(n.map(u=>{if(u=$2(u,s),u in Vm)return;Vm[u]=!0;const p=u.endsWith(".css"),c=p?'[rel="stylesheet"]':"";if(!!s)for(let w=a.length-1;w>=0;w--){const E=a[w];if(E.href===u&&(!p||E.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${u}"]${c}`))return;const v=document.createElement("link");if(v.rel=p?"stylesheet":L2,p||(v.as="script"),v.crossOrigin="",v.href=u,d&&v.setAttribute("nonce",d),document.head.appendChild(v),p)return new Promise((w,E)=>{v.addEventListener("load",w),v.addEventListener("error",()=>E(new Error(`Unable to preload CSS for ${u}`)))})}))}function i(a){const l=new Event("vite:preloadError",{cancelable:!0});if(l.payload=a,window.dispatchEvent(l),!l.defaultPrevented)throw a}return o.then(a=>{for(const l of a||[])l.status==="rejected"&&i(l.reason);return t().catch(i)})},Ie={colors:{background:"#F8F3EE",paper:"#F4EEE6",ink:"#2E2B26",primary:"#6B513A",accent:"#7AA893",muted:"#A59786",parchment:"#EDE3D6",border:"#B8A895",shadow:"rgba(34,28,22,0.12)"},gradients:{subtle:"linear-gradient(135deg, rgba(255,255,255,0.6), rgba(240,235,230,0.6))",warm:"linear-gradient(135deg, #EDE3D6 0%, #F4EEE6 100%)"},sizes:{navHeight:"56px"}},Ym={appContainer:{display:"flex",flexDirection:"column",height:"100vh",fontFamily:"'Noto Serif SC', serif",backgroundColor:Ie.colors.background,backgroundImage:"linear-gradient(rgba(245, 240, 232, 0.6), rgba(245, 240, 232, 0.6))",backgroundSize:"100% 100%"},mainContent:{flex:1,padding:"15px",paddingBottom:"70px",overflowY:"auto"}};function O2(){const[e,t]=b.useState({type:null,data:null}),[n,s]=b.useState(!1),[o,i]=b.useState(!1),[a,l]=b.useState(!1),[d,u]=b.useState(!1),[p,c]=b.useState(!1),[m,v]=b.useState(!1),[w,E]=b.useState({open:!1,npc:null}),[S,g]=b.useState({open:!1,mode:"VIEW",slot:null,childId:null}),[h,x]=b.useState(!1),[k,_]=b.useState(!1),[y,R]=b.useState(!1),[C,I]=b.useState(!1),T=b.useCallback((ke,ve=null)=>{t({type:ke,data:ve})},[]),L=b.useCallback(()=>{t({type:null,data:null})},[]),ee=b.useCallback(()=>s(!0),[]),$=b.useCallback(()=>s(!1),[]),O=b.useCallback(()=>i(!0),[]),H=b.useCallback(()=>i(!1),[]),F=b.useCallback(()=>l(!0),[]),se=b.useCallback(()=>l(!1),[]),J=b.useCallback(()=>u(!0),[]),de=b.useCallback(()=>u(!1),[]),Ee=b.useCallback(()=>c(!0),[]),$e=b.useCallback(()=>c(!1),[]),De=b.useCallback(()=>v(!0),[]),Qe=b.useCallback(()=>v(!1),[]),Y=b.useCallback(ke=>{E({open:!0,npc:ke})},[]),ue=b.useCallback(()=>{E({open:!1,npc:null})},[]),ne=b.useCallback((ke="VIEW",ve=null,Ge=null)=>{g({open:!0,mode:ke,slot:ve,childId:Ge})},[]),ce=b.useCallback(()=>{g({open:!1,mode:"VIEW",slot:null,childId:null})},[]),ae=b.useCallback(()=>x(!0),[]),je=b.useCallback(()=>x(!1),[]),X=b.useCallback(()=>_(!0),[]),Me=b.useCallback(()=>_(!1),[]),Ae=b.useCallback(()=>R(!0),[]),_e=b.useCallback(()=>R(!1),[]),z=b.useCallback(()=>I(!0),[]),he=b.useCallback(()=>I(!1),[]),ye=b.useCallback(()=>{L(),s(!1),i(!1),l(!1),u(!1),c(!1),v(!1),E({open:!1,npc:null}),g({open:!1,mode:"VIEW",slot:null,childId:null}),x(!1),_(!1),R(!1),I(!1)},[L]);return b.useMemo(()=>({modalState:e,openModal:T,closeModal:L,showGazette:n,setShowGazette:s,openGazette:ee,closeGazette:$,showMessageCenter:o,setShowMessageCenter:i,openMessageCenter:O,closeMessageCenter:H,showGuide:a,setShowGuide:l,openGuide:F,closeGuide:se,showTutorial:d,setShowTutorial:u,openTutorial:J,closeTutorial:de,showBizPanel:p,setShowBizPanel:c,openBizPanel:Ee,closeBizPanel:$e,showChallengePanel:m,setShowChallengePanel:v,openChallengePanel:De,closeChallengePanel:Qe,npcLogModal:w,setNpcLogModal:E,openNpcLog:Y,closeNpcLog:ue,inventoryModal:S,showBatchGiftModal:h,setShowBatchGiftModal:x,openBatchGiftModal:ae,closeBatchGiftModal:je,showBatchPromotionModal:k,setShowBatchPromotionModal:_,openBatchPromotionModal:X,closeBatchPromotionModal:Me,showBatchMarriageModal:y,setShowBatchMarriageModal:R,openBatchMarriageModal:Ae,closeBatchMarriageModal:_e,showBatchManualModal:C,setShowBatchManualModal:I,openBatchManualModal:z,closeBatchManualModal:he,openInventory:ne,closeInventory:ce,closeAllModals:ye}),[e,n,o,a,d,p,m,w,S,h,k,y,C])}const yt={PLAYER:"player",CHILD:"child",NPC:"npc"},Iy=[yt.PLAYER,yt.CHILD,yt.NPC],Q={MORTAL:{key:"MORTAL",label:"",color:"#a1887f",order:1,desc:""},SPIRIT:{key:"SPIRIT",label:"",color:"#00897b",order:2,desc:""},EARTH:{key:"EARTH",label:"",color:"#7cb342",order:3,desc:""},HEAVEN:{key:"HEAVEN",label:"",color:"#5e35b1",order:4,desc:""},DIVINE:{key:"DIVINE",label:"",color:"#ffa000",order:5,desc:""}},Te={GENERAL:{id:"GENERAL"},ELEMENTAL:{id:"ELEMENTAL"},VARIANT:{id:"VARIANT"},DUAL:{id:"DUAL"},DEVIL:{id:"DEVIL"}},vl={SABER:{id:"SABER"},SPEAR:{id:"SPEAR"},RELIC:{id:"RELIC"}},it={BODY:{id:"BODY"},FOUNDATION:{id:"FOUNDATION"},CORE:{id:"CORE"},NASCENT:{id:"NASCENT"},ASCENSION:{id:"ASCENSION"}},P2={[yt.PLAYER]:"",[yt.CHILD]:"",[yt.NPC]:""},Sl=()=>[...Iy],pe=()=>[yt.PLAYER,yt.CHILD],z2=()=>[yt.CHILD],Jc={herb_bandage:{id:"herb_bandage",name:"",type:"consumable",rarity:"common",desc:"",effect:{kind:"heal",amount:100},resourceCategory:"PILL",resourceLevel:Q.MORTAL.key,pillTier:it.BODY.id,usageTargets:Sl(),tags:["",""]},rice_ball:{id:"rice_ball",name:"",type:"consumable",rarity:"common",desc:"",effect:{kind:"heal",amount:60},resourceCategory:"PILL",resourceLevel:Q.MORTAL.key,pillTier:it.BODY.id,usageTargets:Sl(),tags:["",""]},iron_sword:{id:"iron_sword",name:"",type:"weapon",slot:"weapon",rarity:"common",desc:"",stats:{atk:25},resourceCategory:"WEAPON",resourceLevel:Q.MORTAL.key,weaponClass:vl.SABER.id,usageTargets:pe(),tags:["",""]},beast_fang:{id:"beast_fang",name:"",type:"accessory",slot:"accessory",rarity:"uncommon",desc:"",stats:{atk:35},resourceCategory:"ACCESSORY",resourceLevel:Q.SPIRIT.key,usageTargets:pe(),tags:["",""]},beast_core:{id:"beast_core",name:"",type:"consumable",rarity:"uncommon",desc:"",effect:{kind:"exp",amount:1200},resourceCategory:"PILL",resourceLevel:Q.MORTAL.key,pillTier:it.BODY.id,usageTargets:Sl(),tags:["",""]},foundation_pill:{id:"foundation_pill",name:"",type:"consumable",rarity:"rare",desc:"",effect:{kind:"exp",amount:4e3},resourceCategory:"PILL",resourceLevel:Q.SPIRIT.key,pillTier:it.FOUNDATION.id,usageTargets:pe(),tags:["",""]},thunder_wood:{id:"thunder_wood",name:"",type:"accessory",slot:"accessory",rarity:"rare",desc:"",stats:{atk:60,mp:200},resourceCategory:"ACCESSORY",resourceLevel:Q.SPIRIT.key,usageTargets:pe(),tags:["",""]},iron_armor:{id:"iron_armor",name:"",type:"armor",slot:"armor",rarity:"rare",desc:"",stats:{hp:600},resourceCategory:"ARMOR",resourceLevel:Q.SPIRIT.key,usageTargets:pe(),tags:["",""]},core_pill:{id:"core_pill",name:"",type:"consumable",rarity:"epic",desc:"",effect:{kind:"exp",amount:9e3},resourceCategory:"PILL",resourceLevel:Q.EARTH.key,pillTier:it.CORE.id,usageTargets:pe(),tags:["",""]},artifact_supreme:{id:"artifact_supreme",name:"",type:"weapon",slot:"weapon",rarity:"epic",desc:"",stats:{atk:180,hp:300},resourceCategory:"WEAPON",resourceLevel:Q.HEAVEN.key,weaponClass:vl.RELIC.id,usageTargets:pe(),tags:["","",""]},milk_millennium:{id:"milk_millennium",name:"",type:"consumable",rarity:"epic",desc:"",effect:{kind:"heal",amount:500},resourceCategory:"PILL",resourceLevel:Q.EARTH.key,pillTier:it.FOUNDATION.id,usageTargets:Sl(),tags:["",""]},marrow_wash:{id:"marrow_wash",name:"",type:"consumable",rarity:"epic",desc:"",effect:{kind:"aptitude",amount:2},resourceCategory:"PILL",resourceLevel:Q.EARTH.key,pillTier:it.FOUNDATION.id,usageTargets:pe(),tags:["",""]},nascent_fruit:{id:"nascent_fruit",name:"",type:"consumable",rarity:"legendary",desc:"",effect:{kind:"exp",amount:2e4},resourceCategory:"PILL",resourceLevel:Q.HEAVEN.key,pillTier:it.NASCENT.id,usageTargets:pe(),tags:["",""]},heaven_manual:{id:"heaven_manual",name:"",type:"accessory",slot:"accessory",rarity:"legendary",desc:"",stats:{mp:800,atk:120},resourceCategory:"ACCESSORY",resourceLevel:Q.HEAVEN.key,usageTargets:pe(),tags:["","",""]},divine_egg:{id:"divine_egg",name:"",type:"armor",slot:"armor",rarity:"legendary",desc:"",stats:{hp:1200},resourceCategory:"ARMOR",resourceLevel:Q.HEAVEN.key,usageTargets:pe(),tags:["",""]},moonshadow_saber:{id:"moonshadow_saber",name:"",type:"weapon",slot:"weapon",rarity:"epic",desc:"",stats:{atk:160,mp:60},resourceCategory:"WEAPON",resourceLevel:Q.EARTH.key,weaponClass:vl.SABER.id,usageTargets:pe(),tags:["",""]},storm_piercer:{id:"storm_piercer",name:"",type:"weapon",slot:"weapon",rarity:"legendary",desc:"",stats:{atk:190,mp:120,hp:200},resourceCategory:"WEAPON",resourceLevel:Q.HEAVEN.key,weaponClass:vl.SPEAR.id,usageTargets:pe(),tags:["",""]},meridian_pill:{id:"meridian_pill",name:"",type:"consumable",rarity:"uncommon",desc:"",effect:{kind:"exp",amount:1500},resourceCategory:"PILL",resourceLevel:Q.MORTAL.key,pillTier:it.BODY.id,usageTargets:z2(),tags:["",""]},dragon_heart_pill:{id:"dragon_heart_pill",name:"",type:"consumable",rarity:"epic",desc:"",effect:{kind:"exp",amount:12e3},resourceCategory:"PILL",resourceLevel:Q.EARTH.key,pillTier:it.CORE.id,usageTargets:pe(),tags:["",""]},communication_pill:{id:"communication_pill",name:"",type:"consumable",rarity:"uncommon",desc:"",effect:{kind:"intelligence",amount:2},resourceCategory:"PILL",resourceLevel:Q.MORTAL.key,pillTier:it.FOUNDATION.id,usageTargets:pe(),tags:["",""]},awakening_pill:{id:"awakening_pill",name:"",type:"consumable",rarity:"epic",desc:"",effect:{kind:"intelligence",amount:5},resourceCategory:"PILL",resourceLevel:Q.SPIRIT.key,pillTier:it.FOUNDATION.id,usageTargets:pe(),tags:["",""]},wisdom_pill:{id:"wisdom_pill",name:"",type:"consumable",rarity:"legendary",desc:"",effect:{kind:"intelligence",amount:8},resourceCategory:"PILL",resourceLevel:Q.EARTH.key,pillTier:it.CORE.id,usageTargets:pe(),tags:[""]},starlight_pill:{id:"starlight_pill",name:"",type:"consumable",rarity:"legendary",desc:"",effect:{kind:"intelligence",amount:18},resourceCategory:"PILL",resourceLevel:Q.HEAVEN.key,pillTier:it.ASCENSION.id,usageTargets:pe(),tags:["","",""]},longevity_pill:{id:"longevity_pill",name:"",type:"consumable",rarity:"epic",desc:"",effect:{kind:"lifespan",amount:50},resourceCategory:"PILL",resourceLevel:Q.EARTH.key,pillTier:it.FOUNDATION.id,usageTargets:pe(),tags:["","",""]},supreme_longevity_pill:{id:"supreme_longevity_pill",name:"",type:"consumable",rarity:"legendary",desc:"",effect:{kind:"lifespan",amount:200},resourceCategory:"PILL",resourceLevel:Q.HEAVEN.key,pillTier:it.ASCENSION.id,usageTargets:pe(),tags:["","",""]},beauty_pill:{id:"beauty_pill",name:"",type:"consumable",rarity:"epic",desc:"",effect:{kind:"looks",amount:15},resourceCategory:"PILL",resourceLevel:Q.EARTH.key,pillTier:it.FOUNDATION.id,usageTargets:pe(),tags:["","",""]},supreme_beauty_pill:{id:"supreme_beauty_pill",name:"",type:"consumable",rarity:"legendary",desc:"",effect:{kind:"looks",amount:30},resourceCategory:"PILL",resourceLevel:Q.HEAVEN.key,pillTier:it.ASCENSION.id,usageTargets:pe(),tags:["","",""]},god_transformation_pill:{id:"god_transformation_pill",name:"",type:"consumable",rarity:"mythic",desc:"",effect:{kind:"exp",amount:3e5},resourceCategory:"PILL",resourceLevel:Q.DIVINE.key,pillTier:it.ASCENSION.id,usageTargets:pe(),tags:["","",""]},divine_soul_pill:{id:"divine_soul_pill",name:"",type:"consumable",rarity:"mythic",desc:"",effect:{kind:"exp",amount:5e5},resourceCategory:"PILL",resourceLevel:Q.DIVINE.key,pillTier:it.ASCENSION.id,usageTargets:pe(),tags:["","",""]},void_condensing_pill:{id:"void_condensing_pill",name:"",type:"consumable",rarity:"mythic",desc:"",effect:{kind:"exp",amount:8e5},resourceCategory:"PILL",resourceLevel:Q.DIVINE.key,pillTier:it.ASCENSION.id,usageTargets:pe(),tags:["","",""]},immortal_marrow_pill:{id:"immortal_marrow_pill",name:"",type:"consumable",rarity:"mythic",desc:"",effect:{kind:"aptitude",amount:8},resourceCategory:"PILL",resourceLevel:Q.DIVINE.key,pillTier:it.ASCENSION.id,usageTargets:pe(),tags:["","",""]},heaven_defying_pill:{id:"heaven_defying_pill",name:"",type:"consumable",rarity:"mythic",desc:"",effect:{kind:"exp",amount:1e6},resourceCategory:"PILL",resourceLevel:Q.DIVINE.key,pillTier:it.ASCENSION.id,usageTargets:pe(),tags:["","",""]},void_refining_pill:{id:"void_refining_pill",name:"",type:"consumable",rarity:"mythic",desc:"",effect:{kind:"exp",amount:2e6},resourceCategory:"PILL",resourceLevel:Q.DIVINE.key,pillTier:it.ASCENSION.id,usageTargets:pe(),tags:["","",""]},space_law_pill:{id:"space_law_pill",name:"",type:"consumable",rarity:"mythic",desc:"",effect:{kind:"exp",amount:3e6},resourceCategory:"PILL",resourceLevel:Q.DIVINE.key,pillTier:it.ASCENSION.id,usageTargets:pe(),tags:["","",""]},void_stabilization_pill:{id:"void_stabilization_pill",name:"",type:"consumable",rarity:"mythic",desc:"",effect:{kind:"exp",amount:5e6},resourceCategory:"PILL",resourceLevel:Q.DIVINE.key,pillTier:it.ASCENSION.id,usageTargets:pe(),tags:["","",""]},unity_pill:{id:"unity_pill",name:"",type:"consumable",rarity:"mythic",desc:"",effect:{kind:"exp",amount:8e6},resourceCategory:"PILL",resourceLevel:Q.DIVINE.key,pillTier:it.ASCENSION.id,usageTargets:pe(),tags:["","",""]},dao_comprehension_pill:{id:"dao_comprehension_pill",name:"",type:"consumable",rarity:"mythic",desc:"",effect:{kind:"exp",amount:12e6},resourceCategory:"PILL",resourceLevel:Q.DIVINE.key,pillTier:it.ASCENSION.id,usageTargets:pe(),tags:["","",""]},harmony_pill:{id:"harmony_pill",name:"",type:"consumable",rarity:"mythic",desc:"",effect:{kind:"exp",amount:18e6},resourceCategory:"PILL",resourceLevel:Q.DIVINE.key,pillTier:it.ASCENSION.id,usageTargets:pe(),tags:["","",""]},mahayana_pill:{id:"mahayana_pill",name:"",type:"consumable",rarity:"mythic",desc:"",effect:{kind:"exp",amount:3e7},resourceCategory:"PILL",resourceLevel:Q.DIVINE.key,pillTier:it.ASCENSION.id,usageTargets:pe(),tags:["","",""]},immortal_foundation_pill:{id:"immortal_foundation_pill",name:"",type:"consumable",rarity:"mythic",desc:"",effect:{kind:"exp",amount:5e7},resourceCategory:"PILL",resourceLevel:Q.DIVINE.key,pillTier:it.ASCENSION.id,usageTargets:pe(),tags:["","",""]},semi_immortal_pill:{id:"semi_immortal_pill",name:"",type:"consumable",rarity:"mythic",desc:"",effect:{kind:"exp",amount:8e7},resourceCategory:"PILL",resourceLevel:Q.DIVINE.key,pillTier:it.ASCENSION.id,usageTargets:pe(),tags:["","",""]},tribulation_pill:{id:"tribulation_pill",name:"",type:"consumable",rarity:"mythic",desc:"",effect:{kind:"exp",amount:1e8},resourceCategory:"PILL",resourceLevel:Q.DIVINE.key,pillTier:it.ASCENSION.id,usageTargets:pe(),tags:["","",""]},anti_tribulation_pill:{id:"anti_tribulation_pill",name:"",type:"consumable",rarity:"mythic",desc:"",effect:{kind:"heal",amount:5e4},resourceCategory:"PILL",resourceLevel:Q.DIVINE.key,pillTier:it.ASCENSION.id,usageTargets:pe(),tags:["","",""]},ascension_pill:{id:"ascension_pill",name:"",type:"consumable",rarity:"mythic",desc:"",effect:{kind:"exp",amount:2e8},resourceCategory:"PILL",resourceLevel:Q.DIVINE.key,pillTier:it.ASCENSION.id,usageTargets:pe(),tags:["","",""]},basic_manual:{id:"basic_manual",name:"",type:"manual",rarity:"common",tier:"",tierColor:"#D4AF37",element:"",baseBonus:"+20%",desc:"",manualIds:["basic_breath","cloud_breath"],resourceCategory:"MANUAL",resourceLevel:Q.MORTAL.key,manualSchool:Te.GENERAL.id,usageTargets:pe(),tags:["",""]},advanced_manual:{id:"advanced_manual",name:"",type:"manual",rarity:"rare",tier:"",tierColor:"#4A4A4A",element:"",baseBonus:"+50%",desc:"",manualIds:["azure_sword_art","water_flow","fire_control","mountain_body"],resourceCategory:"MANUAL",resourceLevel:Q.SPIRIT.key,manualSchool:Te.ELEMENTAL.id,usageTargets:pe(),tags:["",""]},expert_manual:{id:"expert_manual",name:"",type:"manual",rarity:"epic",tier:"",tierColor:"#8B4513",element:"",baseBonus:"+100%",desc:"",manualIds:["yin_yang_harmony","five_elements_supreme"],resourceCategory:"MANUAL",resourceLevel:Q.EARTH.key,manualSchool:Te.DUAL.id,usageTargets:pe(),tags:["",""]},yin_yang_harmony_manual:{id:"yin_yang_harmony_manual",name:"",type:"manual",rarity:"rare",tier:"",tierColor:"#4A4A4A",element:"",baseBonus:"+60%",desc:"",manualIds:["yin_yang_harmony"],resourceCategory:"MANUAL",resourceLevel:Q.SPIRIT.key,manualSchool:Te.DUAL.id,usageTargets:pe(),tags:["",""]},blood_demon_manual:{id:"blood_demon_manual",name:"",type:"manual",rarity:"epic",tier:"",tierColor:"#8B4513",element:"",baseBonus:"+120%",desc:"",manualIds:["blood_demon"],resourceCategory:"MANUAL",resourceLevel:Q.EARTH.key,manualSchool:Te.DEVIL.id,usageTargets:pe(),tags:["",""]},chaos_origin_manual:{id:"chaos_origin_manual",name:"",type:"manual",rarity:"legendary",tier:"",tierColor:"#6A5ACD",element:"",baseBonus:"+220%",desc:"",manualIds:["chaos_origin"],resourceCategory:"MANUAL",resourceLevel:Q.HEAVEN.key,manualSchool:Te.GENERAL.id,usageTargets:pe(),tags:["",""]},five_elements_supreme_manual:{id:"five_elements_supreme_manual",name:"",type:"manual",rarity:"legendary",tier:"",tierColor:"#6A5ACD",element:"",baseBonus:"+220%",desc:"",manualIds:["five_elements_supreme"],resourceCategory:"MANUAL",resourceLevel:Q.HEAVEN.key,manualSchool:Te.ELEMENTAL.id,usageTargets:pe(),tags:["",""]},emperor_scripture_manual:{id:"emperor_scripture_manual",name:"",type:"manual",rarity:"legendary",tier:"",tierColor:"#6A5ACD",element:"",baseBonus:"+240%",desc:"",manualIds:["emperor_scripture"],resourceCategory:"MANUAL",resourceLevel:Q.HEAVEN.key,manualSchool:Te.GENERAL.id,usageTargets:pe(),tags:["",""]},deep_ocean_scripture_manual:{id:"deep_ocean_scripture_manual",name:"",type:"manual",rarity:"epic",tier:"",tierColor:"#8B4513",element:"",baseBonus:"+140%",desc:"",manualIds:["deep_ocean_scripture"],resourceCategory:"MANUAL",resourceLevel:Q.EARTH.key,manualSchool:Te.ELEMENTAL.id,usageTargets:pe(),tags:["",""]},gold_manual_1:{id:"gold_manual_1",name:"",type:"manual",rarity:"common",tier:"",tierColor:"#FFD700",element:"",baseBonus:"+20%",desc:"",manualIds:["golden_light"],resourceCategory:"MANUAL",resourceLevel:Q.MORTAL.key,manualSchool:Te.ELEMENTAL.id,usageTargets:pe(),tags:["",""]},gold_manual_2:{id:"gold_manual_2",name:"",type:"manual",rarity:"uncommon",tier:"",tierColor:"#FFD700",element:"",baseBonus:"+50%",desc:"",manualIds:["azure_sword_art"],resourceCategory:"MANUAL",resourceLevel:Q.SPIRIT.key,manualSchool:Te.ELEMENTAL.id,usageTargets:pe(),tags:["",""]},gold_manual_3:{id:"gold_manual_3",name:"",type:"manual",rarity:"rare",tier:"",tierColor:"#FFD700",element:"",baseBonus:"+100%",desc:"",manualIds:["golden_light","azure_sword_art"],resourceCategory:"MANUAL",resourceLevel:Q.EARTH.key,manualSchool:Te.ELEMENTAL.id,usageTargets:pe(),tags:["",""]},gold_manual_4:{id:"gold_manual_4",name:"",type:"manual",rarity:"epic",tier:"",tierColor:"#FFD700",element:"",baseBonus:"+100%",desc:"",manualIds:["azure_sword_art"],resourceCategory:"MANUAL",resourceLevel:Q.EARTH.key,manualSchool:Te.ELEMENTAL.id,usageTargets:pe(),tags:["",""]},gold_manual_5:{id:"gold_manual_5",name:"",type:"manual",rarity:"legendary",tier:"",tierColor:"#FFD700",element:"",baseBonus:"+200%",desc:"",manualIds:["azure_sword_art"],resourceCategory:"MANUAL",resourceLevel:Q.HEAVEN.key,manualSchool:Te.ELEMENTAL.id,usageTargets:pe(),tags:["",""]},wood_manual_1:{id:"wood_manual_1",name:"",type:"manual",rarity:"common",tier:"",tierColor:"#228B22",element:"",baseBonus:"+20%",desc:"",manualIds:["evergreen_art"],resourceCategory:"MANUAL",resourceLevel:Q.MORTAL.key,manualSchool:Te.ELEMENTAL.id,usageTargets:pe(),tags:["",""]},wood_manual_2:{id:"wood_manual_2",name:"",type:"manual",rarity:"uncommon",tier:"",tierColor:"#228B22",element:"",baseBonus:"+50%",desc:"",manualIds:["spring_birth"],resourceCategory:"MANUAL",resourceLevel:Q.SPIRIT.key,manualSchool:Te.ELEMENTAL.id,usageTargets:pe(),tags:["",""]},wood_manual_3:{id:"wood_manual_3",name:"",type:"manual",rarity:"rare",tier:"",tierColor:"#228B22",element:"",baseBonus:"+100%",desc:"",manualIds:["evergreen_art","spring_birth"],resourceCategory:"MANUAL",resourceLevel:Q.EARTH.key,manualSchool:Te.ELEMENTAL.id,usageTargets:pe(),tags:["",""]},wood_manual_4:{id:"wood_manual_4",name:"",type:"manual",rarity:"epic",tier:"",tierColor:"#228B22",element:"",baseBonus:"+100%",desc:"",manualIds:["spring_birth"],resourceCategory:"MANUAL",resourceLevel:Q.EARTH.key,manualSchool:Te.ELEMENTAL.id,usageTargets:pe(),tags:["",""]},wood_manual_5:{id:"wood_manual_5",name:"",type:"manual",rarity:"legendary",tier:"",tierColor:"#228B22",element:"",baseBonus:"+200%",desc:"",manualIds:["spring_birth"],resourceCategory:"MANUAL",resourceLevel:Q.HEAVEN.key,manualSchool:Te.ELEMENTAL.id,usageTargets:pe(),tags:["",""]},water_manual_1:{id:"water_manual_1",name:"",type:"manual",rarity:"common",tier:"",tierColor:"#4169E1",element:"",baseBonus:"+20%",desc:"",manualIds:["water_flow"],resourceCategory:"MANUAL",resourceLevel:Q.MORTAL.key,manualSchool:Te.ELEMENTAL.id,usageTargets:pe(),tags:["",""]},water_manual_2:{id:"water_manual_2",name:"",type:"manual",rarity:"uncommon",tier:"",tierColor:"#4169E1",element:"",baseBonus:"+50%",desc:"",manualIds:["ocean_heart"],resourceCategory:"MANUAL",resourceLevel:Q.SPIRIT.key,manualSchool:Te.ELEMENTAL.id,usageTargets:pe(),tags:["",""]},water_manual_3:{id:"water_manual_3",name:"",type:"manual",rarity:"rare",tier:"",tierColor:"#4169E1",element:"",baseBonus:"+100%",desc:"",manualIds:["water_flow","ocean_heart"],resourceCategory:"MANUAL",resourceLevel:Q.EARTH.key,manualSchool:Te.ELEMENTAL.id,usageTargets:pe(),tags:["",""]},water_manual_4:{id:"water_manual_4",name:"",type:"manual",rarity:"epic",tier:"",tierColor:"#4169E1",element:"",baseBonus:"+100%",desc:"",manualIds:["ocean_heart"],resourceCategory:"MANUAL",resourceLevel:Q.EARTH.key,manualSchool:Te.ELEMENTAL.id,usageTargets:pe(),tags:["",""]},water_manual_5:{id:"water_manual_5",name:"",type:"manual",rarity:"legendary",tier:"",tierColor:"#4169E1",element:"",baseBonus:"+200%",desc:"",manualIds:["ocean_heart"],resourceCategory:"MANUAL",resourceLevel:Q.HEAVEN.key,manualSchool:Te.ELEMENTAL.id,usageTargets:pe(),tags:["",""]},fire_manual_1:{id:"fire_manual_1",name:"",type:"manual",rarity:"common",tier:"",tierColor:"#FF6347",element:"",baseBonus:"+20%",desc:"",manualIds:["basic_breath"],resourceCategory:"MANUAL",resourceLevel:Q.MORTAL.key,manualSchool:Te.ELEMENTAL.id,usageTargets:pe(),tags:["",""]},fire_manual_2:{id:"fire_manual_2",name:"",type:"manual",rarity:"uncommon",tier:"",tierColor:"#FF6347",element:"",baseBonus:"+50%",desc:"",manualIds:["fire_control"],resourceCategory:"MANUAL",resourceLevel:Q.SPIRIT.key,manualSchool:Te.ELEMENTAL.id,usageTargets:pe(),tags:["",""]},fire_manual_3:{id:"fire_manual_3",name:"",type:"manual",rarity:"rare",tier:"",tierColor:"#FF6347",element:"",baseBonus:"+100%",desc:"",manualIds:["nine_turns_fire"],resourceCategory:"MANUAL",resourceLevel:Q.EARTH.key,manualSchool:Te.ELEMENTAL.id,usageTargets:pe(),tags:["",""]},fire_manual_4:{id:"fire_manual_4",name:"",type:"manual",rarity:"epic",tier:"",tierColor:"#FF6347",element:"",baseBonus:"+100%",desc:"",manualIds:["vermillion_bird"],resourceCategory:"MANUAL",resourceLevel:Q.EARTH.key,manualSchool:Te.ELEMENTAL.id,usageTargets:pe(),tags:["",""]},fire_manual_5:{id:"fire_manual_5",name:"",type:"manual",rarity:"legendary",tier:"",tierColor:"#FF6347",element:"",baseBonus:"+200%",desc:"",manualIds:["nine_turns_fire","vermillion_bird"],resourceCategory:"MANUAL",resourceLevel:Q.HEAVEN.key,manualSchool:Te.ELEMENTAL.id,usageTargets:pe(),tags:["",""]},earth_manual_1:{id:"earth_manual_1",name:"",type:"manual",rarity:"common",tier:"",tierColor:"#8B4513",element:"",baseBonus:"+20%",desc:"",manualIds:["earth_shield"],resourceCategory:"MANUAL",resourceLevel:Q.MORTAL.key,manualSchool:Te.ELEMENTAL.id,usageTargets:pe(),tags:["",""]},earth_manual_2:{id:"earth_manual_2",name:"",type:"manual",rarity:"uncommon",tier:"",tierColor:"#8B4513",element:"",baseBonus:"+50%",desc:"",manualIds:["mountain_body"],resourceCategory:"MANUAL",resourceLevel:Q.SPIRIT.key,manualSchool:Te.ELEMENTAL.id,usageTargets:pe(),tags:["",""]},earth_manual_3:{id:"earth_manual_3",name:"",type:"manual",rarity:"rare",tier:"",tierColor:"#8B4513",element:"",baseBonus:"+100%",desc:"",manualIds:["earth_shield","mountain_body"],resourceCategory:"MANUAL",resourceLevel:Q.EARTH.key,manualSchool:Te.ELEMENTAL.id,usageTargets:pe(),tags:["",""]},earth_manual_4:{id:"earth_manual_4",name:"",type:"manual",rarity:"epic",tier:"",tierColor:"#8B4513",element:"",baseBonus:"+100%",desc:"",manualIds:["mountain_body"],resourceCategory:"MANUAL",resourceLevel:Q.EARTH.key,manualSchool:Te.ELEMENTAL.id,usageTargets:pe(),tags:["",""]},earth_manual_5:{id:"earth_manual_5",name:"",type:"manual",rarity:"legendary",tier:"",tierColor:"#8B4513",element:"",baseBonus:"+200%",desc:"",manualIds:["mountain_body"],resourceCategory:"MANUAL",resourceLevel:Q.HEAVEN.key,manualSchool:Te.ELEMENTAL.id,usageTargets:pe(),tags:["",""]},thunder_manual_1:{id:"thunder_manual_1",name:"",type:"manual",rarity:"uncommon",tier:"",tierColor:"#9B30FF",element:"",baseBonus:"+50%",desc:"",manualIds:["basic_breath"],resourceCategory:"MANUAL",resourceLevel:Q.SPIRIT.key,manualSchool:Te.VARIANT.id,usageTargets:pe(),tags:["",""]},thunder_manual_2:{id:"thunder_manual_2",name:"",type:"manual",rarity:"rare",tier:"",tierColor:"#9B30FF",element:"",baseBonus:"+100%",desc:"",manualIds:["basic_breath"],resourceCategory:"MANUAL",resourceLevel:Q.EARTH.key,manualSchool:Te.VARIANT.id,usageTargets:pe(),tags:["",""]},thunder_manual_3:{id:"thunder_manual_3",name:"",type:"manual",rarity:"epic",tier:"",tierColor:"#9B30FF",element:"",baseBonus:"+100%",desc:"",manualIds:["basic_breath"],resourceCategory:"MANUAL",resourceLevel:Q.EARTH.key,manualSchool:Te.VARIANT.id,usageTargets:pe(),tags:["",""]},thunder_manual_4:{id:"thunder_manual_4",name:"",type:"manual",rarity:"epic",tier:"",tierColor:"#9B30FF",element:"",baseBonus:"+200%",desc:"",manualIds:["thunder_guide"],resourceCategory:"MANUAL",resourceLevel:Q.EARTH.key,manualSchool:Te.VARIANT.id,usageTargets:pe(),tags:["",""]},thunder_manual_5:{id:"thunder_manual_5",name:"",type:"manual",rarity:"legendary",tier:"",tierColor:"#9B30FF",element:"",baseBonus:"+200%",desc:"",manualIds:["thunder_guide","heavenly_demon"],resourceCategory:"MANUAL",resourceLevel:Q.HEAVEN.key,manualSchool:Te.VARIANT.id,usageTargets:pe(),tags:["",""]},ice_manual_1:{id:"ice_manual_1",name:"",type:"manual",rarity:"uncommon",tier:"",tierColor:"#87CEEB",element:"",baseBonus:"+20%",desc:"",manualIds:["water_flow"],resourceCategory:"MANUAL",resourceLevel:Q.SPIRIT.key,manualSchool:Te.VARIANT.id,usageTargets:pe(),tags:["",""]},ice_manual_2:{id:"ice_manual_2",name:"",type:"manual",rarity:"rare",tier:"",tierColor:"#87CEEB",element:"",baseBonus:"+50%",desc:"",manualIds:["ice_heart"],resourceCategory:"MANUAL",resourceLevel:Q.SPIRIT.key,manualSchool:Te.VARIANT.id,usageTargets:pe(),tags:["",""]},ice_manual_3:{id:"ice_manual_3",name:"",type:"manual",rarity:"rare",tier:"",tierColor:"#87CEEB",element:"",baseBonus:"+100%",desc:"",manualIds:["ice_heart"],resourceCategory:"MANUAL",resourceLevel:Q.EARTH.key,manualSchool:Te.VARIANT.id,usageTargets:pe(),tags:["",""]},ice_manual_4:{id:"ice_manual_4",name:"",type:"manual",rarity:"epic",tier:"",tierColor:"#87CEEB",element:"",baseBonus:"+100%",desc:"",manualIds:["ice_heart"],resourceCategory:"MANUAL",resourceLevel:Q.EARTH.key,manualSchool:Te.VARIANT.id,usageTargets:pe(),tags:["",""]},ice_manual_5:{id:"ice_manual_5",name:"",type:"manual",rarity:"legendary",tier:"",tierColor:"#87CEEB",element:"",baseBonus:"+200%",desc:"",manualIds:["ice_heart"],resourceCategory:"MANUAL",resourceLevel:Q.HEAVEN.key,manualSchool:Te.VARIANT.id,usageTargets:pe(),tags:["",""]},wind_manual_1:{id:"wind_manual_1",name:"",type:"manual",rarity:"uncommon",tier:"",tierColor:"#E0E0E0",element:"",baseBonus:"+20%",desc:"",manualIds:["cloud_breath"],resourceCategory:"MANUAL",resourceLevel:Q.SPIRIT.key,manualSchool:Te.VARIANT.id,usageTargets:pe(),tags:["",""]},wind_manual_2:{id:"wind_manual_2",name:"",type:"manual",rarity:"rare",tier:"",tierColor:"#E0E0E0",element:"",baseBonus:"+50%",desc:"",manualIds:["wind_freedom"],resourceCategory:"MANUAL",resourceLevel:Q.SPIRIT.key,manualSchool:Te.VARIANT.id,usageTargets:pe(),tags:["",""]},wind_manual_3:{id:"wind_manual_3",name:"",type:"manual",rarity:"rare",tier:"",tierColor:"#E0E0E0",element:"",baseBonus:"+100%",desc:"",manualIds:["wind_freedom"],resourceCategory:"MANUAL",resourceLevel:Q.EARTH.key,manualSchool:Te.VARIANT.id,usageTargets:pe(),tags:["",""]},wind_manual_4:{id:"wind_manual_4",name:"",type:"manual",rarity:"epic",tier:"",tierColor:"#E0E0E0",element:"",baseBonus:"+100%",desc:"",manualIds:["wind_freedom"],resourceCategory:"MANUAL",resourceLevel:Q.EARTH.key,manualSchool:Te.VARIANT.id,usageTargets:pe(),tags:["",""]},wind_manual_5:{id:"wind_manual_5",name:"",type:"manual",rarity:"legendary",tier:"",tierColor:"#E0E0E0",element:"",baseBonus:"+200%",desc:"",manualIds:["wind_freedom"],resourceCategory:"MANUAL",resourceLevel:Q.HEAVEN.key,manualSchool:Te.VARIANT.id,usageTargets:pe(),tags:["",""]},cosmic_crystal:{id:"cosmic_crystal",name:"",type:"consumable",rarity:"legendary",desc:"",effect:{kind:"exp",amount:5e4},resourceCategory:"PILL",resourceLevel:Q.HEAVEN.key,usageTargets:pe(),tags:["",""]},void_silk:{id:"void_silk",name:"",type:"consumable",rarity:"legendary",desc:"",effect:{kind:"exp",amount:4e4},resourceCategory:"PILL",resourceLevel:Q.HEAVEN.key,usageTargets:pe(),tags:["",""]},heavenly_jade:{id:"heavenly_jade",name:"",type:"consumable",rarity:"mythic",desc:"",effect:{kind:"exp",amount:2e5},resourceCategory:"PILL",resourceLevel:Q.DIVINE.key,usageTargets:pe(),tags:["",""]},soul_essence_crystal:{id:"soul_essence_crystal",name:"",type:"consumable",rarity:"mythic",desc:"",effect:{kind:"exp",amount:18e4},resourceCategory:"PILL",resourceLevel:Q.DIVINE.key,usageTargets:pe(),tags:["",""]},star_core_fragment:{id:"star_core_fragment",name:"",type:"consumable",rarity:"mythic",desc:"",effect:{kind:"exp",amount:35e4},resourceCategory:"PILL",resourceLevel:Q.DIVINE.key,usageTargets:pe(),tags:["",""]},celestial_silk_cloth:{id:"celestial_silk_cloth",name:"",type:"consumable",rarity:"mythic",desc:"",effect:{kind:"exp",amount:3e5},resourceCategory:"PILL",resourceLevel:Q.DIVINE.key,usageTargets:pe(),tags:["",""]},abyss_stone:{id:"abyss_stone",name:"",type:"consumable",rarity:"mythic",desc:"",effect:{kind:"exp",amount:5e5},resourceCategory:"PILL",resourceLevel:Q.DIVINE.key,usageTargets:pe(),tags:["",""]},abyssal_essence:{id:"abyssal_essence",name:"",type:"consumable",rarity:"mythic",desc:"",effect:{kind:"exp",amount:55e4},resourceCategory:"PILL",resourceLevel:Q.DIVINE.key,usageTargets:pe(),tags:["",""]},divine_tribulation_stone:{id:"divine_tribulation_stone",name:"",type:"consumable",rarity:"mythic",desc:"",effect:{kind:"exp",amount:6e5},resourceCategory:"PILL",resourceLevel:Q.DIVINE.key,usageTargets:pe(),tags:["",""]},god_marrow:{id:"god_marrow",name:"",type:"consumable",rarity:"mythic",desc:"",effect:{kind:"exp",amount:65e4},resourceCategory:"PILL",resourceLevel:Q.DIVINE.key,usageTargets:pe(),tags:["",""]},divine_essence_core:{id:"divine_essence_core",name:"",type:"consumable",rarity:"mythic",desc:"",effect:{kind:"exp",amount:8e5},resourceCategory:"PILL",resourceLevel:Q.DIVINE.key,usageTargets:pe(),tags:["",""]},soul_tempering_stone:{id:"soul_tempering_stone",name:"",type:"consumable",rarity:"mythic",desc:"",effect:{kind:"exp",amount:75e4},resourceCategory:"PILL",resourceLevel:Q.DIVINE.key,usageTargets:pe(),tags:["",""]},void_manifold_crystal:{id:"void_manifold_crystal",name:"",type:"consumable",rarity:"mythic",desc:"",effect:{kind:"exp",amount:1e6},resourceCategory:"PILL",resourceLevel:Q.DIVINE.key,usageTargets:pe(),tags:["",""]},condensed_void_essence:{id:"condensed_void_essence",name:"",type:"consumable",rarity:"mythic",desc:"",effect:{kind:"exp",amount:105e4},resourceCategory:"PILL",resourceLevel:Q.DIVINE.key,usageTargets:pe(),tags:["",""]},celestial_ascension_token:{id:"celestial_ascension_token",name:"",type:"consumable",rarity:"mythic",desc:"",effect:{kind:"exp",amount:2e6},resourceCategory:"PILL",resourceLevel:Q.DIVINE.key,usageTargets:pe(),tags:["",""]},immortal_transformation_essence:{id:"immortal_transformation_essence",name:"",type:"consumable",rarity:"mythic",desc:"",effect:{kind:"exp",amount:22e5},resourceCategory:"PILL",resourceLevel:Q.DIVINE.key,usageTargets:pe(),tags:["",""]}},or=e=>{const t=Jc[e];if(!t)return null;const n=t.type==="consumable"||t.type==="manual";return{...t,id:e,instanceId:`${e}_${Date.now()}_${Math.floor(Math.random()*1e4)}`,quantity:1,stackable:n,maxStack:n?99:1}},cs=e=>Jc[e];function D2(){const[e,t]=b.useState([]),n=b.useRef(e);b.useEffect(()=>{n.current=e},[e]);const s=b.useCallback(p=>{if(typeof p=="function"){t(c=>{const m=p(c);return n.current=m,m});return}n.current=p,t(p)},[]),o=b.useCallback((p=[])=>{const c=p.map(g=>{if(!g)return null;if(typeof g=="string")return or(g);if(typeof g=="object"){const h=g.type==="weapon"||g.type==="armor"||g.type==="accessory",x=g.type==="consumable"||g.type==="manual";return{...g,instanceId:g.instanceId||(g.id||"item")+"_"+Date.now()+"_"+Math.floor(Math.random()*1e4),quantity:g.quantity||g.quantity===0?g.quantity:1,stackable:h?!1:g.stackable??x,maxStack:h?1:g.maxStack||(x?99:1)}}return null}).filter(Boolean);if(c.length===0)return[];const v=[...n.current||[]],w=g=>(g==null?void 0:g.type)==="weapon"||(g==null?void 0:g.type)==="armor"||(g==null?void 0:g.type)==="accessory"?!1:(g==null?void 0:g.stackable)===!0||(g==null?void 0:g.type)==="consumable"||(g==null?void 0:g.type)==="manual",E=g=>{if(!g||typeof g!="object")return"";const h=Object.keys(g).sort(),x={};return h.forEach(k=>{x[k]=g[k]}),JSON.stringify(x)},S=g=>(g==null?void 0:g.type)==="weapon"||(g==null?void 0:g.type)==="armor"||(g==null?void 0:g.type)==="accessory";return c.forEach(g=>{if(w(g)){let x=Number(g.quantity??1)||0;const k=Math.max(1,Number(g.maxStack??99)||99);if(x<=0)return;const _=y=>y.id===g.id&&y.name===g.name&&y.rarity===g.rarity&&w(y)&&(!S(g)||y.slot===g.slot&&E(y.stats)===E(g.stats));for(let y=0;y<v.length&&x>0;y+=1){const R=v[y];if(!_(R))continue;const C=Number(R.quantity??1)||1;if(C>=k)continue;const I=k-C,T=Math.min(x,I);R.quantity=C+T,x-=T}for(;x>0;){const y=Math.min(x,k);v.unshift({...g,quantity:y,instanceId:(g.id||"item")+"_"+Date.now()+"_"+Math.floor(Math.random()*1e4)}),x-=y}return}const h=Number(g.quantity??1)||1;if(h>1){for(let x=0;x<h;x+=1)v.unshift({...g,quantity:1,instanceId:(g.id||"item")+"_"+Date.now()+"_"+Math.floor(Math.random()*1e4)});return}v.unshift({...g,quantity:1,stackable:!1,maxStack:1})}),n.current=v,t(v),c},[]),i=b.useCallback((p,c)=>{const m=n.current||[];let v=[],w=typeof c=="number"?c:void 0,E=[...m];for(let S=0;S<E.length;){const g=E[S];if(String(g.instanceId)!==String(p)){S++;continue}const h=g.quantity||1;if(w===void 0||w>=h){if(v.push({...g}),w=w===void 0?void 0:w-h,E.splice(S,1),w===0)break}else{v.push({...g,quantity:w}),E[S]={...g,quantity:h-w},w=0;break}}return v.length>0&&(n.current=E,t(E)),v.length===0?null:v.length===1?v[0]:v.reduce((S,g)=>S?{...S,quantity:(S.quantity||1)+(g.quantity||1)}:{...g},null)},[]),a=b.useCallback(()=>{n.current=[],t([])},[]),l=b.useCallback(p=>e.find(p),[e]),d=b.useCallback(p=>e.filter(p),[e]),u=b.useCallback(p=>e.filter(c=>c.templateId===p).length,[e]);return{inventory:e,setInventory:s,addItemsToInventory:o,removeItemFromInventory:i,clearInventory:a,findItem:l,filterItems:d,getItemCount:u}}const wc={PLAYER:"player",NPC_ROMANCE:"npc_romance",CHILD:"child"},F2={ALIVE:"ALIVE"},H2={FIRST_MEET:0},W2={MALE:""},U2={HEAVEN:"HEAVEN"},qm={ROGUE:""},vo={BASE_HP_PER_HEALTH:5,HP_HEALTH_BONUS:.3,BASE_ATK_BONUS:10,ATK_APTITUDE_BONUS:1,ATK_INTELLIGENCE_BONUS:.5,BASE_DEF_BONUS:5};function _y(e=wc.NPC_ROMANCE){return{id:"",name:"",gender:W2.MALE,age:20,avatar:null,identity:"",status:F2.ALIVE,tier:"",tierIndex:0,currentExp:0,maxExp:100,cultivation:0,stats:{aptitude:50,looks:75,intelligence:50,health:80},spiritRoot:{type:U2.HEAVEN,id:"HEAVEN",elements:[],elementCount:0,multiplier:.5,color:"#FF0000",desc:""},constitution:null,combatStats:{hp:100,maxHp:100,atk:10,def:5,mp:20,maxMp:20},combatPower:0,sect:null,sectId:"",sectName:"",rank:qm.ROGUE,sectRank:qm.ROGUE,relationship:{affection:0,trust:0,stage:H2.FIRST_MEET},trait:null,personality:null,appearance:null,signature:null,generation:e===wc.CHILD?1:void 0,fatherName:void 0,motherName:void 0,birthYear:void 0,lifespan:void 0}}function G2(e,t=wc.NPC_ROMANCE){const n=_y(t),s={...n,...e};return e.stats&&(s.stats={...n.stats,...e.stats}),e.spiritRoot&&(s.spiritRoot={...n.spiritRoot,...e.spiritRoot}),e.combatStats&&(s.combatStats={...n.combatStats,...e.combatStats}),e.relationship&&(s.relationship={...n.relationship,...e.relationship}),s}const ka=[{id:"stage_chu_qingyao",name:"",title:"",role:"",status:"ALIVE",tier:"",rank:"",gender:"",baseThreat:25,baseExp:7200,powerMultiplier:1,flavor:"",defeatLog:"",unlockNextLog:"",combatStats:{hp:800,maxHp:800,atk:85,def:40},combatPower:25,storyBeats:[{delay:1,type:"RIVAL_RISE",tier:"",exp:9e3,detail:"",description:""},{delay:1,type:"RIVAL_ENGAGED",target:"",detail:"",description:""},{delay:1,type:"RIVAL_MARRIAGE",target:"",tier:"",exp:15e3,detail:"",description:""},{delay:1,type:"RIVAL_HEIR",target:"",tier:"",exp:2e4,detail:"",description:""},{delay:1,type:"RIVAL_STAGE_EVENT",tier:"",exp:23e3,detail:"",description:""},{delay:1,type:"RIVAL_STAGE_EVENT",tier:"",exp:25e3,detail:"",description:""}]},{id:"stage_fiance",name:"",title:"",role:"",status:"ALIVE",tier:"",rank:"",gender:"",baseThreat:40,baseExp:2e5,powerMultiplier:2.2,flavor:"",defeatLog:'""',unlockNextLog:"",combatStats:{hp:1e5,maxHp:1e5,atk:1e4,def:4e3},combatPower:40,storyBeats:[{delay:1,type:"RIVAL_STAGE_EVENT",tier:"",exp:5e5,detail:"",description:""},{delay:1,type:"RIVAL_STAGE_EVENT",tier:"",exp:8e5,detail:"",description:""},{delay:1,type:"RIVAL_STAGE_EVENT",tier:"",exp:2e6,detail:"",description:""}]},{id:"stage_family_elder",name:"",title:"",role:"",status:"ALIVE",tier:"",rank:"",gender:"",baseThreat:55,baseExp:2e6,powerMultiplier:3.5,flavor:'""',defeatLog:"",unlockNextLog:"",combatStats:{hp:1e6,maxHp:1e6,atk:1e5,def:4e4},combatPower:55,storyBeats:[{delay:1,type:"RIVAL_STAGE_EVENT",tier:"",exp:5e6,detail:"",description:""},{delay:1,type:"RIVAL_STAGE_EVENT",tier:"",exp:1e7,detail:"",description:""},{delay:1,type:"RIVAL_STAGE_EVENT",tier:"",exp:2e7,detail:"",description:""}]},{id:"stage_sect_elder",name:"",title:"",role:"",status:"ALIVE",tier:"",rank:"",gender:"",baseThreat:70,baseExp:1e8,powerMultiplier:6,flavor:"",defeatLog:"",unlockNextLog:"",combatStats:{hp:4e7,maxHp:4e7,atk:4e6,def:16e5},combatPower:70,storyBeats:[{delay:1,type:"RIVAL_STAGE_EVENT",tier:"",exp:2e8,detail:"",description:""},{delay:1,type:"RIVAL_STAGE_EVENT",tier:"",exp:5e8,detail:"",description:""},{delay:1,type:"RIVAL_STAGE_EVENT",tier:"",exp:2e9,detail:"",description:""}]}],Gl=ka.length-1,Ec=(e=0)=>ka[Math.max(0,Math.min(e,Gl))],ht=[yt.PLAYER,yt.CHILD],Xc={YELLOW:{name:"",baseBuff:.2,color:"#D4AF37"},BLACK:{name:"",baseBuff:.5,color:"#4A4A4A"},EARTH:{name:"",baseBuff:1,color:"#8B4513"},HEAVEN:{name:"",baseBuff:2,color:"#9B30FF"}},Km={:"",:"",:"",:"",:"",:"",:"",:"",ALL:"",NONE:"",OMNI:"","":""},V2=e=>!e||e==="NONE"?"OMNI":e,Y2=(e,t)=>`${e}_${V2(t)}`,vn={basic_breath:{id:"basic_breath",name:"",tier:"YELLOW",element:"NONE",desc:"",rarity:"common",source:""},cloud_breath:{id:"cloud_breath",name:"",tier:"YELLOW",element:"NONE",desc:"",rarity:"common",source:""},golden_light:{id:"golden_light",name:"",tier:"YELLOW",element:"",desc:"",rarity:"common",source:""},azure_sword_art:{id:"azure_sword_art",name:"",tier:"BLACK",element:"",desc:"",rarity:"rare",source:""},evergreen_art:{id:"evergreen_art",name:"",tier:"YELLOW",element:"",desc:"",rarity:"common",source:""},spring_birth:{id:"spring_birth",name:"",tier:"BLACK",element:"",desc:"",rarity:"rare",source:""},water_flow:{id:"water_flow",name:"",tier:"YELLOW",element:"",desc:"",rarity:"common",source:""},ocean_heart:{id:"ocean_heart",name:"",tier:"BLACK",element:"",desc:"",rarity:"rare",source:""},fire_control:{id:"fire_control",name:"",tier:"BLACK",element:"",desc:"",rarity:"rare",source:""},nine_turns_fire:{id:"nine_turns_fire",name:"",tier:"EARTH",element:"",desc:"",rarity:"epic",source:""},vermillion_bird:{id:"vermillion_bird",name:"",tier:"EARTH",element:"",desc:"",rarity:"epic",source:""},earth_shield:{id:"earth_shield",name:"",tier:"YELLOW",element:"",desc:"",rarity:"common",source:""},mountain_body:{id:"mountain_body",name:"",tier:"BLACK",element:"",desc:"",rarity:"rare",source:""},thunder_guide:{id:"thunder_guide",name:"",tier:"HEAVEN",element:"",desc:"",rarity:"legendary",source:""},heavenly_demon:{id:"heavenly_demon",name:"",tier:"HEAVEN",element:"",desc:"",rarity:"legendary",source:""},ice_heart:{id:"ice_heart",name:"",tier:"BLACK",element:"",desc:"",rarity:"rare",source:""},wind_freedom:{id:"wind_freedom",name:"",tier:"BLACK",element:"",desc:"",rarity:"rare",source:""},yin_yang_harmony:{id:"yin_yang_harmony",name:"",tier:"BLACK",element:"NONE",desc:"",rarity:"rare",source:""},blood_demon:{id:"blood_demon",name:"",tier:"EARTH",element:"NONE",desc:"",rarity:"epic",source:""},chaos_origin:{id:"chaos_origin",name:"",tier:"HEAVEN",element:"NONE",desc:"",rarity:"legendary",source:""},five_elements_supreme:{id:"five_elements_supreme",name:"",tier:"HEAVEN",element:"ALL",desc:"",rarity:"legendary",source:""},emperor_scripture:{id:"emperor_scripture",name:"",tier:"HEAVEN",element:"NONE",desc:"",rarity:"legendary",source:""},deep_ocean_scripture:{id:"deep_ocean_scripture",name:"",tier:"EARTH",element:"",desc:"",rarity:"epic",source:""},nine_star_formation:{id:"nine_star_formation",name:"",tier:"BLACK",element:"",desc:"",rarity:"rare",source:""},grass_valley_healing:{id:"grass_valley_healing",name:"",tier:"YELLOW",element:"",desc:"",rarity:"common",source:""},stone_refining:{id:"stone_refining",name:"",tier:"YELLOW",element:"",desc:"",rarity:"common",source:""},ghost_cultivation:{id:"ghost_cultivation",name:"",tier:"EARTH",element:"",desc:"",rarity:"epic",source:""},blood_river:{id:"blood_river",name:"",tier:"BLACK",element:"NONE",desc:"",rarity:"rare",source:""}},q2={basic_breath:{resourceLevel:Q.MORTAL.key,school:Te.GENERAL.id,stage:"",focus:["",""],usageTargets:ht},cloud_breath:{resourceLevel:Q.MORTAL.key,school:Te.GENERAL.id,stage:"",focus:["",""],usageTargets:ht},golden_light:{resourceLevel:Q.MORTAL.key,school:Te.ELEMENTAL.id,stage:"",focus:["",""],usageTargets:ht},azure_sword_art:{resourceLevel:Q.SPIRIT.key,school:Te.ELEMENTAL.id,stage:"",focus:["",""],usageTargets:ht},evergreen_art:{resourceLevel:Q.MORTAL.key,school:Te.ELEMENTAL.id,stage:"",focus:["",""],usageTargets:ht},spring_birth:{resourceLevel:Q.SPIRIT.key,school:Te.ELEMENTAL.id,stage:"",focus:["",""],usageTargets:ht},water_flow:{resourceLevel:Q.MORTAL.key,school:Te.ELEMENTAL.id,stage:"",focus:["",""],usageTargets:ht},ocean_heart:{resourceLevel:Q.SPIRIT.key,school:Te.ELEMENTAL.id,stage:"",focus:["",""],usageTargets:ht},fire_control:{resourceLevel:Q.SPIRIT.key,school:Te.ELEMENTAL.id,stage:"",focus:["",""],usageTargets:ht},nine_turns_fire:{resourceLevel:Q.EARTH.key,school:Te.ELEMENTAL.id,stage:"",focus:["",""],usageTargets:ht},vermillion_bird:{resourceLevel:Q.HEAVEN.key,school:Te.ELEMENTAL.id,stage:"",focus:["",""],usageTargets:ht},earth_shield:{resourceLevel:Q.MORTAL.key,school:Te.ELEMENTAL.id,stage:"",focus:["",""],usageTargets:ht},mountain_body:{resourceLevel:Q.SPIRIT.key,school:Te.ELEMENTAL.id,stage:"",focus:["",""],usageTargets:ht},thunder_guide:{resourceLevel:Q.HEAVEN.key,school:Te.VARIANT.id,stage:"",focus:["",""],usageTargets:ht},heavenly_demon:{resourceLevel:Q.DIVINE.key,school:Te.VARIANT.id,stage:"",focus:["",""],usageTargets:ht},ice_heart:{resourceLevel:Q.SPIRIT.key,school:Te.VARIANT.id,stage:"",focus:["",""],usageTargets:ht},wind_freedom:{resourceLevel:Q.SPIRIT.key,school:Te.VARIANT.id,stage:"",focus:["",""],usageTargets:ht},yin_yang_harmony:{resourceLevel:Q.SPIRIT.key,school:Te.DUAL.id,stage:"",focus:["",""],usageTargets:ht},blood_demon:{resourceLevel:Q.EARTH.key,school:Te.DEVIL.id,stage:"",focus:["",""],usageTargets:ht},chaos_origin:{resourceLevel:Q.DIVINE.key,school:Te.GENERAL.id,stage:"",focus:["",""],usageTargets:ht},five_elements_supreme:{resourceLevel:Q.DIVINE.key,school:Te.ELEMENTAL.id,stage:"",focus:["",""],usageTargets:ht},emperor_scripture:{resourceLevel:Q.DIVINE.key,school:Te.GENERAL.id,stage:"",focus:["",""],usageTargets:ht},deep_ocean_scripture:{resourceLevel:Q.EARTH.key,school:Te.ELEMENTAL.id,stage:"",focus:["",""],usageTargets:ht},nine_star_formation:{resourceLevel:Q.SPIRIT.key,school:Te.ELEMENTAL.id,stage:"",focus:["",""],usageTargets:ht},grass_valley_healing:{resourceLevel:Q.MORTAL.key,school:Te.ELEMENTAL.id,stage:"",focus:["",""],usageTargets:ht},stone_refining:{resourceLevel:Q.MORTAL.key,school:Te.ELEMENTAL.id,stage:"",focus:["",""],usageTargets:ht},ghost_cultivation:{resourceLevel:Q.EARTH.key,school:Te.DEVIL.id,stage:"",focus:["",""],usageTargets:ht},blood_river:{resourceLevel:Q.SPIRIT.key,school:Te.DEVIL.id,stage:"",focus:["",""],usageTargets:ht}};Object.entries(q2).forEach(([e,t])=>{vn[e]&&(vn[e]={...vn[e],resourceCategory:"MANUAL",...t,usageTargets:t.usageTargets?[...t.usageTargets]:[...ht]})});const Vl={};Object.entries(vn).forEach(([e,t])=>{var s;const n=Y2(t.tier,t.element);if(!Vl[n]){const o=((s=Xc[t.tier])==null?void 0:s.name)||t.tier,i=Km[t.element]||t.element||Km.NONE;Vl[n]={key:n,tier:t.tier,element:t.element,label:`${o}${i}`,manualIds:[]}}Vl[n].manualIds.push(e),vn[e].categoryKey=n});const K2=Vl,Qm={:"azure_sword_art",:"emperor_scripture",:"fire_control",:"deep_ocean_scripture",:"thunder_guide",:"spring_birth",:"nine_star_formation",:"wind_freedom",:"yin_yang_harmony",:"mountain_body",:"grass_valley_healing",:"stone_refining",:"heavenly_demon",:"ghost_cultivation",:"blood_river"};function Af(e,t){const n=vn[e];if(!n)return{compatibility:.5,level:"poor",desc:""};if(!t||!t.elements)return{compatibility:.8,level:"neutral",desc:"",color:"#999"};const{element:s}=n,{elements:o,type:i}=t;return s==="NONE"?{compatibility:.8,level:"neutral",desc:"",color:"#FFFFFF"}:n.id==="five_elements_supreme"?o.length===5?{compatibility:1.5,level:"perfect",desc:"",color:"#FFD700"}:{compatibility:.1,level:"impossible",desc:"",color:"#FF0000"}:o.includes(s)?o.length===1&&o[0]===s?{compatibility:1.5,level:"perfect",desc:"",color:"#4CAF50"}:{compatibility:1,level:"good",desc:"",color:"#2196F3"}:{compatibility:.5,level:"poor",desc:"",color:"#FF6B6B"}}function Nf(e,t){const n=vn[e];if(!n)return 1;const s=Xc[n.tier],{compatibility:o}=Af(e,t);return 1+s.baseBuff*o}function Q2(e){const t=vn[e];if(!t)return null;const n=Xc[t.tier];return{...t,tierName:n.name,tierColor:n.color,baseBuff:n.baseBuff}}const Lf=e=>e?JSON.parse(JSON.stringify(e)):null,Ep=[{name:"",key:"chaos_dao",rarity:"UR",desc:"",effects:{statBonus:{aptitude:10},speedMultiplier:2.5,feedbackBonus:.15,sectAffinity:{levels:["TOP","HIGH"],bonus:25}}},{name:"",key:"pure_yang",rarity:"SR",desc:"",effects:{statBonus:{aptitude:5},speedMultiplier:1.1,feedbackBonus:.05,preferredRoots:["",""],sectAffinity:{ids:["HEAVEN_EMPEROR","THUNDER"],bonus:25}}},{name:"",key:"innate_dao",rarity:"SSR",desc:"",effects:{statBonus:{looks:12,intelligence:5},speedMultiplier:1.15,feedbackBonus:.08,sectAffinity:{levels:["TOP","HIGH"],bonus:20}}},{name:"",key:"ancient_sage",rarity:"UR",desc:"",effects:{statBonus:{aptitude:8,health:25},speedMultiplier:1.2,feedbackBonus:.1,sectAffinity:{ids:["SWORD","HEAVEN_EMPEROR"],bonus:30}}},{name:"",key:"lunar_meridian",rarity:"SSR",desc:"",effects:{statBonus:{aptitude:4,intelligence:4},speedMultiplier:1.08,preferredRoots:["",""],sectAffinity:{ids:["GHOST","FLOWER"],bonus:20}}},{name:"",key:"stellar_bone",rarity:"SSR",desc:"",effects:{statBonus:{aptitude:6},speedMultiplier:1.12,preferredRoots:["",""],feedbackBonus:.06,sectAffinity:{ids:["NINE_STAR","STONE"],bonus:22}}},{name:"",key:"wood_spirit",rarity:"SR",desc:"",effects:{statBonus:{intelligence:6},speedMultiplier:1.05,preferredRoots:["",""],businessBonus:.25,feedbackBonus:.04,sectAffinity:{ids:["GRASS","FLOWER","DAN"],bonus:18}}},{name:"",key:"dragon_blood",rarity:"SR",desc:"",effects:{statBonus:{aptitude:5,health:18},speedMultiplier:1.1,feedbackBonus:.06,sectAffinity:{ids:["SWORD","IRON","BLOOD"],bonus:20}}},{name:"",key:"nether_core",rarity:"UR",desc:"",effects:{statBonus:{aptitude:7},speedMultiplier:1.18,preferredRoots:["",""],feedbackBonus:.09,sectAffinity:{ids:["GHOST","BLOOD"],bonus:28}}},{name:"",key:"fumo_frost_thunder_body",rarity:"UR",desc:"",effects:{statBonus:{aptitude:9,health:12},speedMultiplier:1.22,feedbackBonus:.12,preferredRoots:["",""],sectAffinity:{ids:["SWORD","HEAVEN_EMPEROR"],bonus:35}}},{name:"",key:"fumo_abyssal_flame_core",rarity:"UR",desc:"",effects:{statBonus:{aptitude:7,looks:8},speedMultiplier:1.18,feedbackBonus:.11,preferredRoots:["",""],sectAffinity:{ids:["BLOOD","GHOST"],bonus:30}}}],J2=()=>{const e=Ep[Math.floor(Math.random()*Ep.length)];return Lf(e)},ja=e=>{if(!e)return null;const t=Ep.find(n=>n.key===e);return Lf(t)},Yl=e=>Lf(e),$f=(e={},t)=>{var a;if(!((a=t==null?void 0:t.effects)!=null&&a.statBonus))return e;const{aptitude:n=0,looks:s=0,intelligence:o=0,health:i=0}=t.effects.statBonus;return{...e,aptitude:Math.max(1,Math.min(100,(e.aptitude||0)+n)),looks:Math.max(1,Math.min(120,(e.looks||0)+s)),intelligence:Math.max(1,Math.min(100,(e.intelligence||0)+o)),health:Math.max(1,Math.min(150,(e.health||0)+i))}},X2=e=>{var t;return((t=e==null?void 0:e.effects)==null?void 0:t.speedMultiplier)||1},Z2=e=>{var t;return((t=e==null?void 0:e.effects)==null?void 0:t.feedbackBonus)||0},ew=e=>{var t;return((t=e==null?void 0:e.effects)==null?void 0:t.businessBonus)||0},tw=e=>{var t;return((t=e==null?void 0:e.effects)==null?void 0:t.sectAffinity)||null},nw=e=>{var t;return((t=e==null?void 0:e.effects)==null?void 0:t.preferredRoots)||null},Bf=[{id:0,name:"",level:"JUNIOR",isManagement:!1,description:"",powerScore:4,permissions:[]},{id:1,name:"",level:"JUNIOR",isManagement:!1,description:"",powerScore:8,permissions:[]},{id:2,name:"",level:"MID",isManagement:!1,description:"",powerScore:16,permissions:["access_advanced_techniques"]},{id:3,name:"",level:"HIGH",isManagement:!1,description:"",powerScore:28,permissions:["access_secret_techniques","participate_selection"]},{id:4,name:"",level:"MANAGEMENT",isManagement:!0,description:"",powerScore:36,permissions:["manage_disciples","resource_distribution"]},{id:5,name:"",level:"ELDER",isManagement:!0,description:"",powerScore:48,permissions:["manage_disciples","resource_distribution","recruitment","policy_making"]},{id:6,name:"",level:"SUPREME",isManagement:!0,description:"",powerScore:65,permissions:["manage_all","final_decision","sect_succession"]},{id:100,name:"",level:"SPECIAL",isManagement:!1,description:"",powerScore:32,permissions:["religious_authority"]},{id:101,name:"",level:"ROGUE",isManagement:!1,description:"",powerScore:12,permissions:[]},{id:102,name:"",level:"SOVEREIGN",isManagement:!0,description:"",powerScore:85,permissions:["manage_all","final_decision","sect_succession","declare_war"]}],rw=e=>Bf.find(t=>t.name===e)||null,sw=e=>{const t=rw(e);return t?t.powerScore:0},ow={:["meridian_pill","herb_bandage","rice_ball"],:["meridian_pill","beast_core","iron_armor"],:["foundation_pill","thunder_wood","iron_armor","milk_millennium"],:["core_pill","artifact_supreme","marrow_wash","dragon_heart_pill"],:["dragon_heart_pill","moonshadow_saber","thunder_wood","nascent_fruit","core_pill"],:["nascent_fruit","god_transformation_pill","divine_soul_pill","dragon_heart_pill","core_pill"],:["divine_soul_pill","void_condensing_pill","immortal_marrow_pill","heaven_defying_pill","starlight_pill","nascent_fruit"],:["void_refining_pill","space_law_pill","immortal_marrow_pill","divine_soul_pill","void_condensing_pill","heaven_defying_pill"],:["unity_pill","dao_comprehension_pill","harmony_pill","void_stabilization_pill"],:["mahayana_pill","immortal_foundation_pill","semi_immortal_pill"],:["temple_relic","buddhist_scripture"],:["meridian_pill","herb_bandage"]},iw=e=>ow[e]||null,aw=e=>{const t=iw(e);return!t||t.length===0?null:t[Math.floor(Math.random()*t.length)]},lw=()=>Bf.map(e=>e.name),Pt={HEAVEN:{id:"HEAVEN",name:"",color:"#FFD700",min:90,max:100,elementCount:1,multiplier:2.5,desc:""},MUTANT_HEAVEN:{id:"MUTANT_HEAVEN",name:"",color:"#FF00FF",min:100,max:100,elementCount:1,multiplier:2.8,desc:""},MUTANT:{id:"MUTANT",name:"",color:"#00BCD4",min:80,max:89,elementCount:1,multiplier:2,desc:"(//)"},SINGLE:{id:"SINGLE",name:"",color:"#9C27B0",min:80,max:89,elementCount:1,multiplier:1.8,desc:""},DOUBLE:{id:"DOUBLE",name:"",color:"#2196F3",min:60,max:79,elementCount:2,multiplier:1.5,desc:""},TRIPLE:{id:"TRIPLE",name:"",color:"#4CAF50",min:40,max:59,elementCount:3,multiplier:1,desc:""},QUAD:{id:"QUAD",name:"",color:"#FF9800",min:20,max:39,elementCount:4,multiplier:.8,desc:""},WASTE:{id:"WASTE",name:"",color:"#9E9E9E",min:0,max:19,elementCount:5,multiplier:.5,desc:""},NONE:{id:"NONE",name:"",color:"#000000",min:0,max:0,elementCount:0,multiplier:0,desc:""}},cw=["","","","",""],Jm=["","",""],kp=e=>e<0?Pt.NONE:e===100?Pt.HEAVEN:e>=80&&e<90?Pt.SINGLE:e>=0&&e<=19?Pt.WASTE:Object.values(Pt).find(t=>e>=t.min&&e<=t.max)||Pt.NONE,dw=e=>{if(e<0)return Pt.NONE;if(e===100){const t=Math.random();return t<.005?Pt.WASTE:t<.02?Pt.MUTANT_HEAVEN:Pt.HEAVEN}if(e>=80&&e<90){const t=Math.random();return t<.01||t<.21?Pt.MUTANT:Pt.SINGLE}return e>0&&e<80&&Math.random()<.01?Pt.MUTANT:e>=0&&e<=19?Pt.WASTE:Object.values(Pt).find(t=>e>=t.min&&e<=t.max)||Pt.NONE},Je=[{name:"",maxExp:100,feedback:0,chance:1,desc:""},{name:"",maxExp:500,feedback:1,chance:.95,desc:""},{name:"",maxExp:1e3,feedback:2,chance:.9,desc:""},{name:"",maxExp:2e3,feedback:3,chance:.85,desc:""},{name:"",maxExp:5e3,feedback:5,chance:.8,desc:""},{name:"",maxExp:2e4,feedback:20,chance:.6,desc:""},{name:"",maxExp:5e4,feedback:30,chance:.5,desc:""},{name:"",maxExp:8e4,feedback:40,chance:.4,desc:""},{name:"",maxExp:2e5,feedback:100,chance:.3,desc:""},{name:"",maxExp:5e5,feedback:150,chance:.25,desc:""},{name:"",maxExp:1e6,feedback:200,chance:.2,desc:""},{name:"",maxExp:2e6,feedback:500,chance:.1,desc:""},{name:"",maxExp:5e6,feedback:800,chance:.08,desc:""},{name:"",maxExp:1e7,feedback:1200,chance:.06,desc:""},{name:"",maxExp:2e7,feedback:2e3,chance:.05,desc:""},{name:"",maxExp:5e7,feedback:3500,chance:.04,desc:""},{name:"",maxExp:1e8,feedback:5e3,chance:.03,desc:""},{name:"",maxExp:2e8,feedback:8e3,chance:.025,desc:""},{name:"",maxExp:5e8,feedback:12e3,chance:.02,desc:""},{name:"",maxExp:1e9,feedback:18e3,chance:.015,desc:""},{name:"",maxExp:2e9,feedback:25e3,chance:.012,desc:""},{name:"",maxExp:5e9,feedback:4e4,chance:.01,desc:""},{name:"",maxExp:1e10,feedback:6e4,chance:.008,desc:""},{name:"",maxExp:2e10,feedback:1e5,chance:.006,desc:""},{name:"",maxExp:5e10,feedback:15e4,chance:.005,desc:""},{name:"",maxExp:1e11,feedback:25e4,chance:.004,desc:""},{name:"",maxExp:2e11,feedback:4e5,chance:.003,desc:""},{name:"",maxExp:5e11,feedback:6e5,chance:.002,desc:""},{name:"",maxExp:1e12,feedback:1e6,chance:.001,desc:""}],uw={:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:""},iu=["","","","","","","","","",""],pw=e=>uw[e]||"",fw=e=>{const t=pw(e),n=iu.indexOf(t);return n===-1||n===iu.length-1?null:iu[n+1]},Of=e=>{const t=Je.findIndex(n=>n.name===e);return t===-1||t===Je.length-1?null:Je[t+1]},An=e=>Je.find(t=>t.name===e)||Je[0],mw=e=>{const t=Je.findIndex(n=>n.name===e);return t>=0?t:0},ni=(e,t,n,s=null,o=0,i=1)=>{const a={:{hp:100,atk:5,mp:0,def:2},:{hp:500,atk:50,mp:200,def:20},:{hp:800,atk:80,mp:400,def:35},:{hp:1200,atk:120,mp:600,def:50},:{hp:2e3,atk:200,mp:1e3,def:80},:{hp:1e4,atk:1e3,mp:5e3,def:400},:{hp:15e3,atk:1500,mp:8e3,def:600},:{hp:2e4,atk:2e3,mp:12e3,def:800},:{hp:1e5,atk:1e4,mp:5e4,def:4e3},:{hp:2e5,atk:2e4,mp:1e5,def:8e3},:{hp:4e5,atk:4e4,mp:2e5,def:16e3},:{hp:1e6,atk:1e5,mp:5e5,def:4e4},:{hp:2e6,atk:2e5,mp:1e6,def:8e4},:{hp:4e6,atk:4e5,mp:2e6,def:16e4},:{hp:1e7,atk:1e6,mp:5e6,def:4e5},:{hp:2e7,atk:2e6,mp:1e7,def:8e5},:{hp:4e7,atk:4e6,mp:2e7,def:16e5},:{hp:1e8,atk:1e7,mp:5e7,def:4e6},:{hp:2e8,atk:2e7,mp:1e8,def:8e6},:{hp:4e8,atk:4e7,mp:2e8,def:16e6},:{hp:1e9,atk:1e8,mp:5e8,def:4e7},:{hp:2e9,atk:2e8,mp:1e9,def:8e7},:{hp:4e9,atk:4e8,mp:2e9,def:16e7},:{hp:1e10,atk:1e9,mp:5e9,def:4e8},:{hp:2e10,atk:2e9,mp:1e10,def:8e8},:{hp:4e10,atk:4e9,mp:2e10,def:16e8},:{hp:1e11,atk:1e10,mp:5e10,def:4e9},:{hp:2e11,atk:2e10,mp:1e11,def:8e9},:{hp:4e11,atk:4e10,mp:2e11,def:16e9}},l=a[e]||a.;let d=1;Object.values(Pt).forEach(g=>{g.name===n&&(d=g.multiplier)});const u=1+t/100,c=1+(i>0?Math.min(1,o/i):0)*.3;let m=Math.floor(l.hp*d*u*c),v=Math.floor(l.atk*d*u*c),w=Math.floor((l.def||0)*d*u*c),E=Math.floor(l.mp*d*u*c);return(s?Object.values(s).filter(Boolean):[]).forEach(g=>{const h=g.stats||{};m+=h.hp||0,v+=h.atk||0,w+=h.def||0,E+=h.mp||0}),{hp:m,maxHp:m,atk:v,def:w||Math.floor(v*.4),mp:E,maxMp:E}},Cn=e=>{var l,d;if(!e)return{hp:100,maxHp:100,atk:10,def:5,mp:50,maxMp:50};const t=e.tier||e.tierTitle||"",n=((l=e.stats)==null?void 0:l.aptitude)||50,s=((d=e.spiritRoot)==null?void 0:d.type)||"",o=e.equipment||null,i=e.currentExp||e.cultivation||0,a=e.maxExp||1;return ni(t,n,s,o,i,a)},Xm=[{name:"",rarity:"RED",effect:3,desc:"+200%",cost:0,bonuses:{speedMultiplier:3,feedbackMultiplier:1.5,sectAffinity:{levels:["TOP"],bonus:35}}},{name:"",rarity:"RED",effect:2.5,desc:"",cost:0,bonuses:{speedMultiplier:2.5,feedbackMultiplier:1.3,flatFeedbackBonus:5}},{name:"",rarity:"RED",effect:2.2,desc:"",cost:0,bonuses:{speedMultiplier:2.2,feedbackMultiplier:1.2,sectAffinity:{ids:["NINE_STAR","HEAVEN_EMPEROR"],bonus:30}}},{name:"",rarity:"ORANGE",effect:2,desc:"+100%",cost:0,bonuses:{speedMultiplier:2,sectAffinity:{ids:["NINE_STAR"],bonus:18}}},{name:"",rarity:"ORANGE",effect:1.8,desc:"100%",cost:0,bonuses:{speedMultiplier:1.8,sectAffinity:{ids:["SWORD"],bonus:28}}},{name:"",rarity:"ORANGE",effect:1.4,desc:"+40%",cost:0,bonuses:{speedMultiplier:1.4,businessBonus:.4,feedbackMultiplier:1.15}},{name:"",rarity:"ORANGE",effect:1.6,desc:"",cost:0,bonuses:{speedMultiplier:1.6,feedbackMultiplier:1.1,sectAffinity:{ids:["HEAVEN_EMPEROR","THUNDER"],bonus:22}}},{name:"",rarity:"PURPLE",effect:1.5,desc:"+50%",cost:0,bonuses:{speedMultiplier:1.5,sectAffinity:{ids:["IRON","STONE"],bonus:15}}},{name:"",rarity:"PURPLE",effect:1.5,desc:"",cost:0,bonuses:{speedMultiplier:1.5,feedbackMultiplier:1.05}},{name:"",rarity:"PURPLE",effect:1.3,desc:"",cost:0,bonuses:{speedMultiplier:1.3,businessBonus:.25,sectAffinity:{ids:["GRASS","DAN"],bonus:16}}},{name:"",rarity:"PURPLE",effect:1.4,desc:"",cost:0,bonuses:{speedMultiplier:1.4,sectAffinity:{ids:["THUNDER","DEMON"],bonus:18}}},{name:"",rarity:"BLUE",effect:1.2,desc:"+20%",cost:0,bonuses:{speedMultiplier:1.2}},{name:"",rarity:"BLUE",effect:1.2,desc:"",cost:0,bonuses:{speedMultiplier:1.2,feedbackMultiplier:1.05}},{name:"",rarity:"BLUE",effect:1.15,desc:"",cost:0,bonuses:{speedMultiplier:1.15,sectAffinity:{ids:["IRON"],bonus:12}}},{name:"",rarity:"GREEN",effect:1.1,desc:"",cost:0,bonuses:{speedMultiplier:1.1}},{name:"",rarity:"GREEN",effect:1.1,desc:"",cost:0,bonuses:{speedMultiplier:1.1,sectAffinity:{levels:["MID"],bonus:8}}},{name:"",rarity:"GREEN",effect:1.08,desc:"",cost:0,bonuses:{speedMultiplier:1.08,feedbackMultiplier:1.05}},{name:"",rarity:"WHITE",effect:.9,desc:"",cost:5,bonuses:{speedMultiplier:.9,feedbackMultiplier:.9}},{name:"",rarity:"WHITE",effect:.8,desc:"-20%",cost:0,bonuses:{speedMultiplier:.8}},{name:"",rarity:"WHITE",effect:.85,desc:"",cost:0,bonuses:{speedMultiplier:.85,feedbackMultiplier:.9}}],Er=[{id:"SWORD",name:"",level:"TOP",minApt:80,tuition:500,prefElements:[""],buff:1.5,risk:.02,resourceTypes:["",""],initialRankProb:{:.15,:.35,:.5},desc:"",scale:"",promotionEase:.85,requirements:{minApt:80,requiredElements:[""],allowedRootTypes:["","",""],notes:""}},{id:"HEAVEN_EMPEROR",name:"",level:"TOP",minApt:85,tuition:600,prefElements:["",""],buff:1.6,risk:.03,resourceTypes:["",""],initialRankProb:{:.2,:.4,:.4},desc:"",scale:"",promotionEase:.75,requirements:{minApt:85,allowedRootTypes:["",""],notes:""}},{id:"STAR_PALACE",name:"",level:"TOP",minApt:82,tuition:520,prefElements:["",""],buff:1.55,risk:.025,resourceTypes:["",""],initialRankProb:{:.18,:.37,:.45},desc:"",scale:"",promotionEase:.82,requirements:{minApt:82,allowedRootTypes:["","",""],notes:""}},{id:"VOID_TEMPLE",name:"",level:"TOP",minApt:83,tuition:480,prefElements:["",""],buff:1.52,risk:.028,resourceTypes:["",""],initialRankProb:{:.17,:.33,:.5},desc:"",scale:"",promotionEase:.8,requirements:{minApt:83,requiredElements:["",""],allowedRootTypes:["","",""],notes:""}},{id:"DAN",name:"",level:"HIGH",minApt:60,tuition:300,prefElements:["",""],buff:1.25,risk:.03,resourceTypes:["",""],initialRankProb:{:.1,:.4,:.5},desc:"",scale:"",promotionEase:1,requirements:{minApt:60,requiredElements:["",""],notes:""}},{id:"OCEAN_PALACE",name:"",level:"HIGH",minApt:65,tuition:350,prefElements:[""],buff:1.3,risk:.02,resourceTypes:["",""],initialRankProb:{:.12,:.38,:.5},desc:"",scale:"",promotionEase:.95,requirements:{minApt:65,requiredElements:[""],notes:""}},{id:"THUNDER",name:"",level:"HIGH",minApt:70,tuition:400,prefElements:[""],buff:1.4,risk:.04,resourceTypes:["",""],initialRankProb:{:.15,:.35,:.5},desc:"",scale:"",promotionEase:.9,requirements:{minApt:70,requiredElements:[""],notes:""}},{id:"GLACIER",name:"",level:"HIGH",minApt:68,tuition:320,prefElements:["",""],buff:1.28,risk:.03,resourceTypes:["",""],initialRankProb:{:.13,:.34,:.53},desc:"",scale:"",promotionEase:.97,requirements:{minApt:68,requiredElements:["",""],notes:""}},{id:"FLOWER",name:"",level:"MID",minApt:40,tuition:100,prefElements:["",""],buff:1.15,risk:.01,resourceTypes:["",""],initialRankProb:{:.05,:.25,:.7},desc:"",scale:"",promotionEase:1.05,requirements:{minApt:40,minLooks:75,requiredElements:["",""],notes:""}},{id:"NINE_STAR",name:"",level:"MID",minApt:45,tuition:120,prefElements:["",""],buff:1.18,risk:.02,resourceTypes:["",""],initialRankProb:{:.06,:.24,:.7},desc:"",scale:"",promotionEase:1,requirements:{minApt:45,requiredElements:["",""],notes:""}},{id:"WIND",name:"",level:"MID",minApt:50,tuition:150,prefElements:[""],buff:1.2,risk:.015,resourceTypes:["",""],initialRankProb:{:.08,:.27,:.65},desc:"",scale:"",promotionEase:1.1,requirements:{minApt:50,requiredElements:[""],notes:""}},{id:"HARMONY",name:"",level:"MID",minApt:35,tuition:80,prefElements:["",""],buff:1.12,risk:.01,resourceTypes:["",""],initialRankProb:{:.04,:.21,:.75},desc:"",scale:"",promotionEase:1.08,requirements:{minApt:35,minLooks:70,notes:""}},{id:"IRON",name:"",level:"LOW",minApt:20,tuition:50,prefElements:[""],buff:1.1,risk:.005,resourceTypes:["",""],initialRankProb:{:.02,:.15,:.83},desc:"",scale:"",promotionEase:1.2,requirements:{minApt:20,notes:""}},{id:"GRASS",name:"",level:"LOW",minApt:25,tuition:60,prefElements:[""],buff:1.08,risk:.005,resourceTypes:["",""],initialRankProb:{:.03,:.17,:.8},desc:"",scale:"",promotionEase:1.25,requirements:{minApt:25,requiredElements:[""],notes:""}},{id:"STONE",name:"",level:"LOW",minApt:20,tuition:40,prefElements:["",""],buff:1.05,risk:.003,resourceTypes:["",""],initialRankProb:{:.01,:.12,:.87},desc:"",scale:"",promotionEase:1.18,requirements:{minApt:20,requiredElements:["",""],notes:""}},{id:"EMBER",name:"",level:"LOW",minApt:18,tuition:30,prefElements:[""],buff:1.02,risk:.004,resourceTypes:["",""],initialRankProb:{:.01,:.1,:.89},desc:"",scale:"",promotionEase:1.3,requirements:{minApt:18,requiredElements:["",""],notes:""}},{id:"DEMON",name:"",level:"RECKLESS",minApt:30,tuition:0,prefElements:["",""],buff:2,risk:.1,resourceTypes:["",""],initialRankProb:{:.08,:.22,:.7},desc:"",scale:"",promotionEase:1.2,requirements:{minApt:30,allowedRootTypes:["","",""],notes:""}},{id:"GHOST",name:"",level:"RECKLESS",minApt:35,tuition:0,prefElements:[""],buff:1.8,risk:.08,resourceTypes:["",""],initialRankProb:{:.1,:.25,:.65},desc:"",scale:"",promotionEase:1.1,requirements:{minApt:35,requiredElements:["",""],notes:""}},{id:"BLOOD",name:"",level:"RECKLESS",minApt:25,tuition:0,prefElements:["",""],buff:1.7,risk:.12,resourceTypes:["",""],initialRankProb:{:.05,:.2,:.75},desc:"",scale:"",promotionEase:1.15,requirements:{minApt:25,requiredElements:["",""],notes:""}},{id:"SHADOW_PAVILION",name:"",level:"RECKLESS",minApt:28,tuition:0,prefElements:["",""],buff:1.65,risk:.09,resourceTypes:["",""],initialRankProb:{:.07,:.23,:.7},desc:"",scale:"",promotionEase:1.18,requirements:{minApt:28,requiredElements:["",""],notes:""}},{id:"NONE",name:"",level:"NONE",minApt:0,tuition:0,prefElements:[],buff:.8,risk:0,resourceTypes:[""],initialRankProb:{:1},desc:"",scale:"",promotionEase:1,requirements:{minApt:0,notes:""}}],Ry=e=>Er.find(t=>t.id===e)||Er.find(t=>t.id==="NONE"),ia=(e,t)=>{var u,p;if(!t||!t.initialRankProb)return"";const n={...t.initialRankProb};if((((u=e.stats)==null?void 0:u.aptitude)||50)>=(t.minApt||0)+20&&n.!==void 0){const c=Math.min(n.,.3);n.-=c,n.=(n.||0)+c*.6,n.=(n.||0)+c*.4}Array.isArray((p=e.spiritRoot)==null?void 0:p.elements)&&Array.isArray(t.prefElements)&&e.spiritRoot.elements.forEach(c=>{t.prefElements.includes(c)&&(n.=(n.||0)+.05,n.=(n.||0)+.03,n.&&(n.=Math.max(0,n.-.08)))});const o=t.promotionEase??1;if(o!==1){const c=Math.max(.3,Math.min(2,o));n.&&(n.*=c),n.&&(n.*=c),n.&&(n./=c),n.&&(n./=c)}const i=Object.keys(n);let a=i.reduce((c,m)=>c+(n[m]||0),0);if(a<=0)return"";i.forEach(c=>n[c]=(n[c]||0)/a);const l=Math.random();let d=0;for(const c of i)if(d+=n[c],l<=d)return c;return i[i.length-1]},gw=e=>e?e.resourceTypes||[]:[];lw();const My=(e,t)=>{var l,d,u,p,c;if(!e||!t)return 0;let n=0;Array.isArray((l=e.spiritRoot)==null?void 0:l.elements)&&(e.spiritRoot.elements.forEach(m=>{t.prefElements&&t.prefElements.includes(m)&&(n+=50,e.spiritRoot.elements.length===1&&(n+=30))}),e.spiritRoot.type===""&&t.level==="TOP"&&(n+=50),e.spiritRoot.type===""&&(t.id==="DEMON"&&(n+=60),t.id==="THUNDER"&&(n+=50),t.id==="GHOST"&&e.spiritRoot.elements.includes("")&&(n+=50),t.id==="WIND"&&e.spiritRoot.elements.includes("")&&(n+=50),t.id==="HEAVEN_EMPEROR"&&(n+=40)));const s=((d=e.stats)==null?void 0:d.aptitude)||0,o=(t.minApt||0)-s;if(o<=0){const m=s-(t.minApt||0);n+=Math.min(40,m),m>=20&&t.level==="TOP"&&(n+=20)}else n-=o*2;if(t.level==="TOP"?n-=5:t.level==="RECKLESS"?n+=15:t.level==="LOW"&&(n-=10),t.id==="FLOWER"||t.id==="HARMONY"){const m=((u=e.stats)==null?void 0:u.looks)||50;m>=80?n+=30:m>=60&&(n+=15)}const i=tw(e.constitution);if(i){const m=i.bonus||15;i.ids&&i.ids.includes(t.id)?n+=m:i.levels&&i.levels.includes(t.level)&&(n+=Math.max(8,m*.6))}const a=(c=(p=e.trait)==null?void 0:p.bonuses)==null?void 0:c.sectAffinity;if(a){const m=a.bonus||12;a.ids&&a.ids.includes(t.id)?n+=m:a.levels&&a.levels.includes(t.level)&&(n+=Math.max(6,m*.5))}return Math.round(n)},Ay=(e,t)=>{var p,c,m,v,w,E,S,g;if(!e||!t)return{qualified:!1,reasons:[""],summary:"",notes:""};const n=t.requirements||{},s=((p=e.stats)==null?void 0:p.aptitude)??0,o=((c=e.stats)==null?void 0:c.looks)??0,i=(m=e.spiritRoot)==null?void 0:m.type,a=((v=e.spiritRoot)==null?void 0:v.elements)||[],l=n.minApt??t.minApt??0,d=[],u=[];return l>0&&d.push(`${l}`),(w=n.requiredElements)!=null&&w.length&&d.push(`${n.requiredElements.join("")}`),(E=n.allowedRootTypes)!=null&&E.length&&d.push(`${n.allowedRootTypes.join("")}`),n.minLooks&&d.push(`${n.minLooks}`),n.customText&&d.push(n.customText),s<l&&u.push(`${l}`),n.minLooks&&o<n.minLooks&&u.push(`${n.minLooks}`),(S=n.allowedRootTypes)!=null&&S.length&&i&&(n.allowedRootTypes.includes(i)||u.push(`${n.allowedRootTypes.join("")}`)),(g=n.requiredElements)!=null&&g.length&&(a.some(x=>n.requiredElements.includes(x))||u.push(`${n.requiredElements.join("")}`)),{qualified:u.length===0,reasons:u,summary:d.join(""),notes:n.notes||""}},Ca=(e,t=!1)=>{var n,s,o,i,a,l,d,u;try{let p=t?10:120;const c=((n=e.stats)==null?void 0:n.aptitude)||50,v=.5+Math.max(0,Math.min(100,c))/100*2.5;p*=v;const w=((s=e.stats)==null?void 0:s.intelligence)||50,S=.6+Math.max(0,Math.min(100,w))/100*1.4;p*=S;const g=Je.findIndex(k=>k.name===e.tier);if(g>=0){const k=1+g/Je.length*1.5;p*=k}if((o=e.spiritRoot)!=null&&o.multiplier){const k=e.spiritRoot.multiplier;typeof k=="number"&&isFinite(k)&&(p*=k)}if(e.cultivationMethod&&e.spiritRoot)try{const k=Nf(e.cultivationMethod,e.spiritRoot);typeof k=="number"&&isFinite(k)&&(p*=k)}catch(k){console.error("Error calculating manual multiplier:",k)}const h=((a=(i=e.trait)==null?void 0:i.bonuses)==null?void 0:a.speedMultiplier)??((l=e.trait)==null?void 0:l.effect)??1;typeof h=="number"&&isFinite(h)&&(p*=h),(u=(d=e.trait)==null?void 0:d.bonuses)!=null&&u.flatSpeedBonus&&typeof e.trait.bonuses.flatSpeedBonus=="number"&&(p+=e.trait.bonuses.flatSpeedBonus);const x=X2(e.constitution);return typeof x=="number"&&isFinite(x)&&(p*=x),e.sect&&e.sect.level!=="NONE"&&(p*=1.5),!isFinite(p)||isNaN(p)?(console.error("Invalid cultivation speed calculated:",p),t?10:120):Math.floor(p)}catch(p){return console.error("Error in calculateCultivationSpeed:",p),t?10:120}},kc=(e,t={})=>{var n,s,o,i,a;try{if(e.age<6)return 0;const l=e.tierTitle||e.tier||"";if(l==="")return 0;const d=An(l);if(!d)return 0;let u=d.feedback||0;if(u===0)return 0;let p=0;l.includes("")?p=e.age<16?1:2:l.includes("")?p=u*.7:l.includes("")||l.includes("")?p=u*1:p=u*.5,e.age<16&&!l.includes("")&&(p*=.5);const c=((s=(n=e.trait)==null?void 0:n.bonuses)==null?void 0:s.feedbackMultiplier)??1,m=((i=(o=e.trait)==null?void 0:o.bonuses)==null?void 0:i.flatFeedbackBonus)||0,v=1+Z2(e.constitution);p=p*c*v+m;const w=((a=e.stats)==null?void 0:a.aptitude)||50,E=Math.max(.1,(w||50)/50);p*=E;let S=1;e.rank===""&&(S=1.2),e.rank===""&&(S=1.5),e.rank===""&&(S=2),p*=S;let g=1;if(e.cultivationMethod&&e.spiritRoot)try{g=Nf(e.cultivationMethod,e.spiritRoot),isFinite(g)||(g=1)}catch(k){console.error("Error calculating manual multiplier for child:",e.name,k),g=1}p*=g;const h=t.familyRatingMultiplier??1;p*=h;const x=Math.max(0,Math.floor(p));return isFinite(x)?x:0}catch(l){return console.error("Error in calculateChildFeedback:",l),0}},hw={:4,:8,:16,:28,:36,:48,:65,:85},xw={TOP:32,HIGH:22,MID:14,LOW:9,RECKLESS:18,NONE:0},Rr=[{id:"SEED",label:"",minScore:0,color:"#9e9e9e",tagline:""},{id:"BACKBONE",label:"",minScore:80,color:"#4caf50",tagline:""},{id:"ELITE",label:"",minScore:140,color:"#2196f3",tagline:""},{id:"ELDER",label:"",minScore:200,color:"#ff9800",tagline:""},{id:"SOVEREIGN",label:"",minScore:280,color:"#e91e63",tagline:""}],so=[{id:"CLAN_SEED",name:"",desc:"",requirements:{minMembers:1,minPower:0,minStones:0},feedbackMultiplier:1,feedbackDesc:"1.0 ()"},{id:"LOCAL_CLAN",name:"",desc:"",requirements:{minMembers:5,minPower:100,minStones:500,minOuterDoor:2},feedbackMultiplier:1.5,feedbackDesc:"1.5 (+50%)"},{id:"CITY_NOBLE",name:"",desc:"",requirements:{minMembers:8,minPower:200,minStones:1500,minInnerDoor:2},feedbackMultiplier:3,feedbackDesc:"3.0 (+200%)"},{id:"REGION_PILLAR",name:"",desc:"",requirements:{minMembers:12,minPower:350,minStones:5e3,minDiscipleRank:2},feedbackMultiplier:6,feedbackDesc:"6.0 (+500%)"},{id:"SECT_ALLY",name:"",desc:"",requirements:{minMembers:18,minPower:600,minStones:1e4,minSteward:1},feedbackMultiplier:12,feedbackDesc:"12.0 (+1100%)"},{id:"IMMORTAL_DYNASTY",name:"",desc:"",requirements:{minMembers:22,minPower:900,minStones:2e4,minElders:1},feedbackMultiplier:25,feedbackDesc:"25.0 (+2400%)"},{id:"HEAVENLY_HEGEMONY",name:"",desc:"",requirements:{minMembers:28,minPower:1400,minStones:4e4,minElders:2,minSovereigns:1},feedbackMultiplier:100,feedbackDesc:"100.0 (+9900%)"}],yw=e=>{const t=so.find(n=>n.id===e);return(t==null?void 0:t.feedbackMultiplier)??1},bw=e=>{const t=Je.findIndex(n=>n.name===e);return Math.max(0,t)*8},vw=(e,t)=>{if(!e)return t?6:0;const n=sw(e);return n>0?n:hw[e]??(t?6:0)},Sw=e=>e?xw[e.level]??10:0,ww=e=>e?e.includes("")?18:e===""?8:e===""?40:0:0,Ny=e=>Math.max(0,Math.min(1,e)),Ly=(e={})=>{if(!e)return{score:0,tierId:Rr[0].id,label:Rr[0].label,color:Rr[0].color,progress:0,tagline:Rr[0].tagline,tierStart:0,nextThreshold:Rr[1].minScore,isElder:!1,isSovereign:!1};const t=e.tierTitle||e.tier||"",n=bw(t),s=vw(e.rank,!!e.sect),o=Sw(e.sect),i=ww(e.rank),a=e.cultivationManual?8:0,l=e.spouse?5:0,d=Math.round(n+s+o+i+a+l),u=[...Rr].reverse().find(S=>d>=S.minScore)||Rr[0],p=Rr.findIndex(S=>S.id===u.id),c=Rr[p+1]||null,m=c?Math.max(1,c.minScore-u.minScore):1,v=c?Ny((d-u.minScore)/m):1,w=e.rank&&(e.rank.includes("")||e.rank===""),E=e.rank==="";return{score:d,tierId:u.id,label:u.label,color:u.color,tagline:u.tagline,tierStart:u.minScore,nextThreshold:(c==null?void 0:c.minScore)??d,progress:v,nextLabel:(c==null?void 0:c.label)||"",isElder:w||u.id==="ELDER"||u.id==="SOVEREIGN",isSovereign:E||u.id==="SOVEREIGN"}},$y=so[0],Ew=e=>{const t=so.findIndex(n=>n.id===e);return t>=0?{tier:so[t],index:t}:{tier:$y,index:0}},Mr=(e,t,n)=>({label:e,current:t,required:n,met:t>=n}),kw={:7,:6,:5,:4,:3,:2,:1,:0},jw=e=>e?kw[e]??-1:-1,wl=(e,t)=>e.filter(n=>jw(n.rank)>=t).length,Cw=(e=[],t={})=>{var I,T,L,ee;const n=((I=t.familyRating)==null?void 0:I.currentId)||$y.id,{tier:s,index:o}=Ew(n),i=so[o+1]||null,a=e.filter($=>($.generation||1)<=2),l=a.map($=>({id:$.id,name:$.name,generation:$.generation,influence:Ly($)})),d=l.reduce(($,O)=>$+O.influence.score,0),u=l.filter($=>$.influence.isElder).length,p=l.filter($=>$.influence.isSovereign).length,c=(t.worldNpcs||[]).filter($=>($==null?void 0:$.status)!=="DEAD"&&($==null?void 0:$.sectRank)===""&&($==null?void 0:$.source)==="child").length,m=p+c,v=wl(a,1),w=wl(a,2),E=wl(a,3),S=wl(a,4),g=e.length+1,h=((T=t.resources)==null?void 0:T.spiritStones)||0,x=Math.round(d+g*5+h/200),k=((L=s.requirements)==null?void 0:L.minPower)??0,_=((ee=i==null?void 0:i.requirements)==null?void 0:ee.minPower)??x,y=i?Ny((x-k)/Math.max(1,_-k)):1,R=[];if(i){const $=i.requirements||{};$.minMembers!==void 0&&R.push(Mr("",g,$.minMembers)),$.minPower!==void 0&&R.push(Mr("",x,$.minPower)),$.minStones!==void 0&&R.push(Mr("",h,$.minStones)),$.minOuterDoor!==void 0&&R.push(Mr("",v,$.minOuterDoor)),$.minInnerDoor!==void 0&&R.push(Mr("",w,$.minInnerDoor)),$.minDiscipleRank!==void 0&&R.push(Mr("",E,$.minDiscipleRank)),$.minSteward!==void 0&&R.push(Mr("",S,$.minSteward)),$.minElders!==void 0&&R.push(Mr("",u,$.minElders)),$.minSovereigns!==void 0&&R.push(Mr("",m,$.minSovereigns))}const C=i?R.every($=>$.met):!1;return{enrichedChildren:l,childInfluenceMap:l.reduce(($,O)=>($[O.id]=O.influence,$),{}),totals:{population:g,stones:h,totalPower:d,elderCount:u,sovereignCount:m,outerDoorCount:v,innerDoorCount:w,discipleRankCount:E,stewardCount:S,ratingScore:x,powerProgress:y},currentTier:s,currentIndex:o,nextTier:i,requirements:R,canUpgrade:C}},Ar=ka[0],ql=qo(),Tw={...ql.spiritRoot},Gs={id:"player_main",name:"",age:16,gender:"",avatar:{base:0,skinColor:0,hair:1,hairColor:0,eye:0,eyeColor:1,mouth:0},tier:ql.tier,currentExp:ql.currentExp,maxExp:ql.maxExp,resources:{spiritStones:100,money:50},stats:{looks:80,cunning:60,aptitude:15,intelligence:60,health:80},familyRating:{currentId:so[0].id,history:[]},skillPoints:0,usedRedeemCodes:[],breakthroughBonus:0,breakthroughFailCount:0,newsBuffer:[],gazetteHistory:[],gazetteIssue:0,hasUnreadGazette:!1,worldNpcs:[],specialCollections:{fumoSwords:[]},specialFlags:{fumoDuoUnlocked:!1,fumoDuoMet:!1},rival:{name:Ar.name,stageId:Ar.id,state:"NORMAL",lifeStage:0,storyTimer:0,threatLevel:Ar.baseThreat??0,rumorCount:0,hiddenTurns:0,isDead:!1,relationValue:-100,tier:Ar.tier,currentExp:Ar.baseExp,stats:{aptitude:95,looks:80,intelligence:90,health:80},combatStats:{hp:Ar.combatStats.hp,maxHp:Ar.combatStats.maxHp,atk:Ar.combatStats.atk,def:Ar.combatStats.def}},revengeProgress:{currentStageIndex:0,completedStages:[],sagaComplete:!1},revengeActions:{lastRumorMonth:0,totalRumors:0,assassinationAttempts:0,hidingMonths:0},spiritRoot:Tw,cultivationMethod:"basic_breath",combatStats:{hp:300,maxHp:300,atk:25,def:8,mp:120,maxMp:120},time:{year:3572,month:9,season:""},status:["",""],childrenStrategy:{skipZhaozhou:!1},generation3Plus:[]};G2(Gs,wc.PLAYER);const Iw={aptitude:{name:"",desc:"",trainable:!0,howToIncrease:"",howToRestore:"",effect:""},luck:{name:"",desc:"",trainable:!0,howToIncrease:"NPC",howToRestore:"",effect:""},lifespan:{name:"",desc:"",trainable:!1,howToIncrease:"",effect:""},looks:{name:"",desc:"",trainable:!0,howToIncrease:"",howToRestore:"",effect:""},cunning:{name:"",desc:"",trainable:!0,howToIncrease:"",howToRestore:"/",effect:""},health:{name:"",desc:"0-100",trainable:!1,howToIncrease:"NPC",howToRestore:"5-10",effect:"4020",energyLimitFormula:"max(5, 20 - (100 - health) * 0.15)  // "},intelligence:{name:"",desc:"",trainable:!0,howToIncrease:"",howToRestore:"",effect:""}};function _w(e){return Iw[e]||{name:e,desc:"",trainable:!1,howToIncrease:"",howToRestore:"",effect:""}}function Ht(e,t=20){if(e==null)return t;const s=(100-Math.max(0,Math.min(100,e)))*.15;return Math.max(5,t-s)}function Rw(e,t){const n=Math.max(0,e-t),s=e-n;let o="";return s>30?o="":s>15&&(o=""),{newHealth:n,healthLost:s,severity:o,damageDisplay:`${o} ${s} ${e}  ${n}`}}const Zm={EXPLORATION:{name:"",icon:"",minDamage:5,maxDamage:20,severity:""},ASSASSINATION:{name:"",icon:"",minDamage:15,maxDamage:40,severity:""},DUEL:{name:"",icon:"",minDamage:20,maxDamage:50,severity:""},ROMANCE:{name:"",icon:"",minDamage:3,maxDamage:10,severity:""},DISASTER:{name:"",icon:"",minDamage:10,maxDamage:30,severity:""}};function ri(e,t,n="EXPLORATION"){var p;const s=((p=e.stats)==null?void 0:p.health)||50,o=Zm[n]||Zm.EXPLORATION,i=Rw(s,t),a=Ht(s),l=Ht(i.newHealth),d=a-l,u=`
${o.icon} ${o.name}
${i.damageDisplay}

${i.newHealth<20?" ":""}
${d>0?`  ${d.toFixed(1)}  ${a.toFixed(1)}  ${l.toFixed(1)}`:""}
  `.trim();return{newHealth:i.newHealth,healthLost:i.healthLost,severity:i.severity,message:u,energyPenalty:Math.max(0,d),isSerious:i.newHealth<20}}function Mw(e,t,n="REST"){var m;const s=((m=e.stats)==null?void 0:m.health)||50,o=Ht(s),i=Math.min(100,s+t),a=i-s,l=Ht(i),d=l-o;let u="",p="";n==="MEDICINE"?(u="",p=""):n==="HEALER"&&(u="",p="");const c=`
${u} ${p}
 ${a} ${s}  ${i}

${d>0?`  ${d.toFixed(1)}  ${o.toFixed(1)}  ${l.toFixed(1)}`:""}
${i===100?" ":""}
  `.trim();return{newHealth:i,recovered:a,message:c,energyBonus:Math.max(0,d)}}function Aw(e){var d;const t=((d=e.stats)==null?void 0:d.health)||50,n=5+Math.floor(Math.random()*6),s=e.currentExp||0,o=Math.floor(s/1e3*.5),i=n+o,a=Math.min(100,t+i),l=a-t;return{newHealth:a,recovered:l,message:l>0?` +${l}${t}  ${a}`:null}}function Pf(e){var n;const t=((n=e.stats)==null?void 0:n.health)||50;return{canExplore:t>=20,canDuel:t>=30,canAssassinate:t>=25,health:t,reason:t<20?"":t<30?"":""}}const Nw=10,By=e=>{var o;if(!e)return e;const t=Nw,n=Ht(t),s=Math.floor((((o=e.resources)==null?void 0:o.spiritStones)||0)*.5);return{...e,currentExp:0,stats:{...e.stats,health:t},energy:Math.min(e.energy||20,n),resources:{...e.resources,spiritStones:s}}},Lw=e=>{const t=By(e);return!t||t===e||Object.assign(e,t),e};function $w(){const[e,t]=b.useState({...Gs,businesses:[],gazetteHistory:[],gazetteIssue:0,hasUnreadGazette:!1,newsBuffer:[],lastAuctionYear:null,currentAuction:null,auctionWindowStart:null,auctionWindowEnd:null,energy:Gs.energy??20,soldAuctionItems:[]}),n=b.useCallback(C=>{t(I=>({...I,...C}))},[]),s=b.useCallback(C=>{t(I=>{const T={...I.stats,...C};let L=I.energy;if(typeof C.health=="number"){const ee=Ht(C.health);L=Math.min(I.energy,ee)}return{...I,stats:T,energy:L}})},[]),o=b.useCallback(C=>{t(I=>({...I,time:{...I.time,...C}}))},[]),i=b.useCallback(C=>{t(I=>({...I,cultivation:typeof C=="function"?C(I.cultivation):C}))},[]),a=b.useCallback(C=>{t(I=>{const T={...I.resources};return C.spirit&&(T.spirit=(I.resources.spirit||0)+C.spirit),C.spirit2&&(T.spirit2=(I.resources.spirit2||0)+C.spirit2),C.spiritStones!==void 0&&(T.spiritStones=(I.resources.spiritStones||0)+C.spiritStones),{...I,resources:T}})},[]),l=b.useCallback(C=>{t(I=>{const T={...I.resources};return C.spirit&&(T.spirit=Math.max(0,(I.resources.spirit||0)-C.spirit)),C.spirit2&&(T.spirit2=Math.max(0,(I.resources.spirit2||0)-C.spirit2)),C.spiritStones!==void 0&&(T.spiritStones=Math.max(0,(I.resources.spiritStones||0)-C.spiritStones)),{...I,resources:T}})},[]),d=b.useCallback(C=>{t(I=>({...I,energy:typeof C=="function"?C(I.energy||0):Math.max(0,(I.energy||0)+C)}))},[]),u=b.useCallback((C=1)=>{t(I=>({...I,energy:Math.max(0,(I.energy||0)-C)}))},[]),p=b.useCallback(C=>{t(I=>({...I,resources:{...I.resources,spiritStones:Math.max(0,I.resources.spiritStones-C.cost)},businesses:[...I.businesses||[],C]}))},[]),c=b.useCallback(({won:C,expGain:I=0,spiritStones:T=0,health:L,healthDamage:ee,injurySource:$,onNotify:O})=>{t(H=>{const F={...H};if(I&&(F.currentExp=(H.currentExp||0)+I),T!==0&&(F.resources={...H.resources,spiritStones:T>0?H.resources.spiritStones+T:Math.max(0,H.resources.spiritStones+T)}),L!==void 0){F.stats={...H.stats,health:L};const se=Ht(L);F.energy=Math.min(H.energy||20,se)}else if(ee&&ee>0){const se=ri(H,ee,$||"EXPLORATION");if(F.stats={...H.stats,health:se.newHealth},se.energyPenalty>0){const J=Ht(se.newHealth);F.energy=Math.min(H.energy||20,J)}O&&O({type:"health_damage",message:se.message,severity:se.severity,isSerious:se.isSerious})}return F})},[]),m=b.useCallback((C,I="EXPLORATION",T)=>{t(L=>{const ee=ri(L,C,I);T&&T({type:"health_damage",message:ee.message,severity:ee.severity,isSerious:ee.isSerious,energyPenalty:ee.energyPenalty});let $=L.energy||20;if(ee.energyPenalty>0){const O=Ht(ee.newHealth);$=Math.min($,O)}return{...L,stats:{...L.stats,health:ee.newHealth},energy:$}})},[]),v=b.useCallback((C,I="REST",T)=>{t(L=>{const ee=Mw(L,C,I);return T&&ee.message&&T({type:"health_recovery",message:ee.message,energyBonus:ee.energyBonus}),{...L,stats:{...L.stats,health:ee.newHealth}}})},[]),w=b.useCallback((C="explore")=>Pf(e),[e]),E=b.useCallback(()=>{var C;return Ht(((C=e.stats)==null?void 0:C.health)||50)},[e]),S=b.useCallback((C,I)=>{t(T=>({...T,worldNpcs:(T.worldNpcs||[]).map(L=>L.id===C?{...L,...I}:L)}))},[]),g=b.useCallback(C=>{t(I=>({...I,worldNpcs:C(I.worldNpcs||[])}))},[]),h=b.useCallback(C=>{t(I=>({...I,newsBuffer:[...I.newsBuffer||[],C]}))},[]),x=b.useCallback(()=>{t(C=>({...C,newsBuffer:[]}))},[]),k=b.useCallback((C,I)=>{t(T=>{var ee;const L=Array.isArray((ee=T.specialCollections)==null?void 0:ee[C])?T.specialCollections[C]:[];return L.includes(I)?T:{...T,specialCollections:{...T.specialCollections||{},[C]:[...L,I]}}})},[]),_=b.useCallback(()=>{t(C=>By(C))},[]),y=b.useCallback(C=>{t(I=>({...I,inventory:[...I.inventory||[],C]}))},[]),R=b.useCallback(C=>{t(I=>({...I,inventory:(I.inventory||[]).filter(T=>T.id!==C)}))},[]);return{player:e,setPlayer:t,updatePlayer:n,updatePlayerStats:s,updatePlayerTime:o,updatePlayerCultivation:i,addResources:a,consumeResources:l,updateEnergy:d,consumeEnergy:u,purchaseBusiness:p,applyCombatResult:c,applyHealthDamageWithNotify:m,applyHealthRecovery:v,checkHealthStatus:w,getEnergyLimit:E,updateWorldNpc:S,updateWorldNpcs:g,addNewsToBuffer:h,clearNewsBuffer:x,addToSpecialCollection:k,applyDefeatPenalty:_,addInventoryItem:y,removeInventoryItem:R}}const Bw={aptitude:85,looks:90,intelligence:80},Oy=[{id:1,name:"",gender:"",age:25,identity:"",desc:"",avatar:{base:0,skinColor:1,hair:0,hairColor:0,eye:0,eyeColor:0,mouth:1},...(()=>{const e=qo();return{tier:e.tier,currentExp:e.currentExp,maxExp:e.maxExp,spiritRoot:e.spiritRoot}})(),stats:Bw,combatStats:{hp:2e3,maxHp:2e3,atk:180,mp:800},sect:Ry("SWORD"),sectId:"SWORD",sectRank:"",sectStatus:"defected",appearance:"...",personality:{label:"",tag:"",desc:""},relationship:{stage:1,affection:10,trust:20,jealousy:0},likes:["",""],dislikes:[""],isPregnant:!1},{id:2,name:"",gender:"",age:38,identity:"",desc:"",avatar:{base:0,skinColor:2,hair:-1,hairColor:null,eye:0,eyeColor:0,mouth:1},...(()=>{const e=qo();return{tier:e.tier,currentExp:e.currentExp,maxExp:e.maxExp,spiritRoot:e.spiritRoot}})(),stats:{aptitude:95,looks:40,intelligence:95},combatStats:{hp:1800,maxHp:1800,atk:200,mp:1200},sect:null,sectId:null,sectRank:"",sectStatus:"mysterious",personality:{label:"",tag:"",desc:""},relationship:{stage:1,affection:5,trust:10,jealousy:0},likes:[""],dislikes:[],isPregnant:!1}];function Pn(e={}){var g,h,x,k;const t=e.currentExp||e.cultivation||0,n=e.combatStats||{},s=n.atk||Math.floor((((g=e.stats)==null?void 0:g.aptitude)||50)*.8),o=n.def||Math.floor((((h=e.stats)==null?void 0:h.aptitude)||50)*.4),i=n.maxHp||Math.floor(t+(((x=e.stats)==null?void 0:x.health)||50)*10),a=45,l=1,d=22,u=.08,p=18,c=Math.floor(s*a),m=Math.floor(i*l),v=Math.floor(o*d),w=Math.floor(t*u),E=Math.floor((((k=e.stats)==null?void 0:k.aptitude)||50)*p);return{total:Math.max(1,c+m+v+w+E),breakdown:{atk:c,hp:m,def:v,exp:w,aptitude:E},details:{atk:s,def:o,maxHp:i}}}function Py(e={},t={}){var S,g,h,x,k,_;const n=e.combatStats||{},s=t.combatStats||{},o=n.atk||Math.max(1,Math.floor((((S=e.stats)==null?void 0:S.aptitude)||50)*.8)),i=n.def||Math.max(0,Math.floor((((g=e.stats)==null?void 0:g.aptitude)||50)*.4)),a=n.maxHp||Math.max(1,Math.floor((e.currentExp||e.cultivation||0)+(((h=e.stats)==null?void 0:h.health)||50)*10)),l=s.atk||Math.max(1,Math.floor((((x=t.stats)==null?void 0:x.aptitude)||50)*.8)),d=s.def||Math.max(0,Math.floor((((k=t.stats)==null?void 0:k.aptitude)||50)*.4)),u=s.maxHp||Math.max(1,Math.floor((t.currentExp||t.cultivation||0)+(((_=t.stats)==null?void 0:_.health)||50)*10)),p=Math.max(1,o-Math.floor(d/2)),c=Math.max(1,l-Math.floor(i/2)),m=Math.ceil(u/p),v=Math.ceil(a/c),w=v-m;let E;return w>=3?E=.98:w===2?E=.92:w===1?E=.78:w===0?E=.55:w===-1?E=.28:w===-2?E=.12:E=.03,{prob:E,roundsToKillEnemy:m,roundsToDie:v,pDpr:p,eDpr:c}}const El=[{id:"farm",name:"",cost:500,baseIncome:50,desc:"",minTier:""},{id:"mine",name:"",cost:2e3,baseIncome:200,desc:"",minTier:""},{id:"auction",name:"",cost:1e4,baseIncome:1500,desc:"",minTier:""},{id:"sect_branch",name:"",cost:5e4,baseIncome:8e3,desc:"",minTier:""}],zy=[{id:"peach_island",name:"",reqTier:"",recommendCP:300,cost:10,drops:["herb_bandage","iron_sword","rice_ball","beast_core"],risk:.05,desc:"",resourceLevel:"MORTAL",dropTable:[{item:"herb_bandage",weight:.25},{item:"iron_sword",weight:.25},{item:"rice_ball",weight:.3},{item:"beast_core",weight:.2}]},{id:"snake_valley",name:"",reqTier:"",recommendCP:5e3,cost:50,drops:["beast_core","beast_fang","herb_bandage"],risk:.15,desc:"",resourceLevel:"SPIRIT",dropTable:[{item:"beast_core",weight:.3},{item:"beast_fang",weight:.4},{item:"herb_bandage",weight:.3}]},{id:"thunder_peak",name:"",reqTier:"",recommendCP:8e4,cost:300,drops:["thunder_wood","iron_armor","foundation_pill","beast_fang"],risk:.25,desc:"",resourceLevel:"SPIRIT",dropTable:[{item:"thunder_wood",weight:.3},{item:"iron_armor",weight:.3},{item:"foundation_pill",weight:.2},{item:"beast_fang",weight:.2}]},{id:"ancient_tomb",name:"",reqTier:"",recommendCP:15e4,cost:500,drops:["core_pill","milk_millennium","marrow_wash","moonshadow_saber"],risk:.4,desc:"",resourceLevel:"EARTH",dropTable:[{item:"core_pill",weight:.25},{item:"milk_millennium",weight:.25},{item:"marrow_wash",weight:.25},{item:"moonshadow_saber",weight:.25}]},{id:"demon_domain",name:"",reqTier:"",recommendCP:8e5,cost:2e3,drops:["nascent_fruit","heaven_manual","divine_egg","storm_piercer","core_pill"],risk:.6,desc:"",resourceLevel:"HEAVEN",dropTable:[{item:"nascent_fruit",weight:.25},{item:"heaven_manual",weight:.25},{item:"divine_egg",weight:.25},{item:"storm_piercer",weight:.15},{item:"core_pill",weight:.1}]},{id:"star_sea_realm",name:"",reqTier:"",recommendCP:16e5,cost:5e3,drops:["starlight_pill","cosmic_crystal","void_silk","nascent_fruit"],risk:.7,desc:"",resourceLevel:"HEAVEN",dropTable:[{item:"starlight_pill",weight:.3},{item:"cosmic_crystal",weight:.3},{item:"void_silk",weight:.2},{item:"nascent_fruit",weight:.2}]},{id:"immortal_cave",name:"",reqTier:"",recommendCP:8e6,cost:2e4,drops:["primordial_spirit_pill","heavenly_jade","soul_essence_crystal"],risk:.75,desc:"",resourceLevel:"DIVINE",dropTable:[{item:"primordial_spirit_pill",weight:.3},{item:"heavenly_jade",weight:.35},{item:"soul_essence_crystal",weight:.35}]},{id:"celestial_pagoda",name:"",reqTier:"",recommendCP:16e6,cost:5e4,drops:["nine_heaven_pill","star_core_fragment","celestial_silk_cloth"],risk:.8,desc:"",resourceLevel:"DIVINE",dropTable:[{item:"nine_heaven_pill",weight:.25},{item:"star_core_fragment",weight:.35},{item:"celestial_silk_cloth",weight:.4}]},{id:"abyss_deeps",name:"",reqTier:"",recommendCP:32e6,cost:1e5,drops:["soul_splitting_pill","abyss_stone","abyssal_essence"],risk:.85,desc:"",resourceLevel:"DIVINE",dropTable:[{item:"soul_splitting_pill",weight:.2},{item:"abyss_stone",weight:.4},{item:"abyssal_essence",weight:.4}]},{id:"divine_transformation_realm",name:"",reqTier:"",recommendCP:8e7,cost:3e5,drops:["god_transformation_pill","divine_tribulation_stone","god_marrow"],risk:.8,desc:"",resourceLevel:"DIVINE",dropTable:[{item:"god_transformation_pill",weight:.2},{item:"divine_tribulation_stone",weight:.4},{item:"god_marrow",weight:.4}]},{id:"soul_refining_abyss",name:"",reqTier:"",recommendCP:16e7,cost:5e5,drops:["divine_soul_pill","divine_essence_core","soul_tempering_stone"],risk:.82,desc:"",resourceLevel:"DIVINE",dropTable:[{item:"divine_soul_pill",weight:.2},{item:"divine_essence_core",weight:.4},{item:"soul_tempering_stone",weight:.4}]},{id:"void_condensing_heaven",name:"",reqTier:"",recommendCP:32e7,cost:8e5,drops:["void_condensing_pill","void_manifold_crystal","condensed_void_essence"],risk:.85,desc:"",resourceLevel:"DIVINE",dropTable:[{item:"void_condensing_pill",weight:.15},{item:"void_manifold_crystal",weight:.42},{item:"condensed_void_essence",weight:.43}]},{id:"immortal_ascension_peak",name:"",reqTier:"",recommendCP:4e8,cost:15e5,drops:["heaven_defying_pill","celestial_ascension_token","immortal_transformation_essence"],risk:.9,desc:"",resourceLevel:"DIVINE",dropTable:[{item:"heaven_defying_pill",weight:.15},{item:"celestial_ascension_token",weight:.42},{item:"immortal_transformation_essence",weight:.43}]}],au=e=>Pn(e).total||0,La={single:["","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","",""],compound:["","","","","","","","","","","","","","","","","","","","","","","","",""]},qs={single:["","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","",""],double:["","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","",""]},Ks={single:["","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","",""],double:["","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","",""]},Ow=["","","","","","","","","","","","","","","","","","","",""],Pw=["","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","",""],Dy={prefixes:["","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","",""],suffixes:["","","","","","","","","","","","","","","","","","","",""]},jc=(e=[])=>e[Math.floor(Math.random()*e.length)],Fy=La.compound,zw=La.single,lu={male:qs.double.length>0?qs.double:qs.single,female:Ks.double.length>0?Ks.double:Ks.single,neutral:Ow},Dw=new Set(Fy);function Fw(){return jc(Pw)}function eg(e=""){const t=(e||"").replace(/\s+/g,"");if(!t)return"";const n=t.slice(0,2);return Dw.has(n)?n:t.charAt(0)}const Hw=()=>Math.random()<.15?jc(Fy):jc(zw),Ww=(e="")=>{const t=e===""?lu.female:lu.male,n=[...lu.neutral,...t];return jc(n)};function zf(e="",t={}){const{motherName:n="",fatherName:s="",preferSurname:o=""}=t,i=o||eg(n)||eg(s)||Hw(),a=Ww(e);return`${i}${a}`}function Zc(e){var p;if(!e.stats)return _y().combatStats;const{stats:t,spiritRoot:n,constitution:s}=e,o=t.health||80,i=100+o*vo.BASE_HP_PER_HEALTH,a=vo.BASE_ATK_BONUS+(t.aptitude||50)*vo.ATK_APTITUDE_BONUS+(t.intelligence||50)*vo.ATK_INTELLIGENCE_BONUS,l=vo.BASE_DEF_BONUS+o*vo.HP_HEALTH_BONUS,d=(n==null?void 0:n.multiplier)||.5;let u=1;return(p=s==null?void 0:s.effects)!=null&&p.speedMultiplier&&(u=s.effects.speedMultiplier),{hp:Math.floor(i),maxHp:Math.floor(i),atk:Math.floor(a*d*u),def:Math.floor(l),mp:Math.floor((e.maxExp||100)/5),maxMp:Math.floor((e.maxExp||100)/5)}}const Uw=[{base:"#FFDFC4",shadow:"#F0D5B1"},{base:"#F0D5B1",shadow:"#E0B87E"},{base:"#E0B87E",shadow:"#C59D74"},{base:"#A16E4B",shadow:"#815336"}],jp=["#2C2C2C","#5C3A21","#A88B45","#8D2323","#F2F2F2"],Gw=["#333333","#4A90E2","#50E3C2","#F5A623","#D0021B"],Vw=[{skinPixels:[[4,2],[5,2],[6,2],[7,2],[8,2],[9,2],[10,2],[11,2],[3,3],[4,3],[5,3],[6,3],[7,3],[8,3],[9,3],[10,3],[11,3],[12,3],[3,4],[4,4],[5,4],[6,4],[7,4],[8,4],[9,4],[10,4],[11,4],[12,4],[3,5],[4,5],[5,5],[6,5],[7,5],[8,5],[9,5],[10,5],[11,5],[12,5],[3,6],[4,6],[5,6],[6,6],[7,6],[8,6],[9,6],[10,6],[11,6],[12,6],[3,7],[4,7],[5,7],[6,7],[7,7],[8,7],[9,7],[10,7],[11,7],[12,7],[3,8],[4,8],[5,8],[6,8],[7,8],[8,8],[9,8],[10,8],[11,8],[12,8],[3,9],[4,9],[5,9],[6,9],[7,9],[8,9],[9,9],[10,9],[11,9],[12,9],[4,10],[5,10],[6,10],[7,10],[8,10],[9,10],[10,10],[11,10],[5,11],[6,11],[7,11],[8,11],[9,11],[10,11],[6,12],[7,12],[8,12],[9,12]],shadowPixels:[[3,4],[3,5],[3,6],[3,7],[3,8],[3,9],[12,4],[12,5],[12,6],[12,7],[12,8],[12,9],[4,10],[11,10],[5,11],[10,11],[6,12],[9,12],[7,9],[8,9]]}],Yw=[{whitePixels:[[5,7],[6,7],[9,7],[10,7]],pupilPixels:[[6,7],[9,7]],browPixels:[[5,6],[6,6],[9,6],[10,6]]},{whitePixels:[[4,7],[5,7],[6,7],[9,7],[10,7],[11,7]],pupilPixels:[[5,7],[10,7]],browPixels:[[4,6],[5,6],[10,6],[11,6]]},{whitePixels:[[5,7],[6,7],[5,8],[9,7],[10,7],[10,8]],pupilPixels:[[6,7],[6,8],[9,7],[9,8]],browPixels:[[5,6],[6,6],[9,6],[10,6]]}],qw=[[[6,11],[9,11],[7,12],[8,12]],[[6,11],[7,11],[8,11],[9,11]],[[7,11],[8,11],[9,11],[10,10]]],Kw=[[[6,0],[7,0],[8,0],[9,0],[5,1],[6,1],[7,1],[8,1],[9,1],[10,1],[4,2],[5,2],[6,2],[7,2],[8,2],[9,2],[10,2],[11,2],[3,3],[4,3],[11,3],[12,3],[3,4],[12,4],[2,5],[3,5],[12,5],[13,5],[2,6],[13,6],[2,7],[13,7],[1,8],[2,8],[13,8],[14,8],[7,3],[8,3],[7,4],[8,4]],[[5,1],[6,1],[7,1],[8,1],[9,1],[10,1],[4,2],[5,2],[6,2],[7,2],[8,2],[9,2],[10,2],[11,2],[3,3],[4,3],[5,3],[6,3],[7,3],[8,3],[9,3],[10,3],[11,3],[12,3],[2,4],[3,4],[4,4],[11,4],[12,4],[13,4],[2,5],[3,5],[12,5],[13,5],[1,6],[2,6],[3,6],[12,6],[13,6],[14,6],[1,7],[2,7],[13,7],[14,7],[1,8],[2,8],[13,8],[14,8],[2,9],[3,9],[12,9],[13,9],[2,10],[3,10],[12,10],[13,10]],[[6,0],[7,0],[8,0],[9,0],[5,1],[6,1],[9,1],[10,1],[6,2],[7,2],[8,2],[9,2],[5,3],[6,3],[7,3],[8,3],[9,3],[10,3],[4,4],[5,4],[10,4],[11,4],[4,5],[5,5],[10,5],[11,5],[3,6],[4,6],[11,6],[12,6],[7,1],[8,1]]],Ke=e=>!e||e.length===0?null:e[Math.floor(Math.random()*e.length)],Qw={low:["{playerName}","{playerName}","{playerName}{gender_ta}","{playerName}"],medium:["{playerName}{gender_ta}","{playerName}","{playerName}","{playerName}{gender_ta}"],high:["{playerName}","{playerName}{gender_ta}","{playerName}","{playerName}{gender_ta}{gender_ta}..."]},tg={:{low:["{playerName}","{playerName}...","{playerName}"],medium:["{playerName}{gender_ta}","{playerName}","{playerName}{gender_ta}"],high:["{playerName}{gender_ta}","{playerName}...","{playerName}"]},:{low:["{playerName}","{playerName}{gender_ta}","{playerName}{gender_ta}"],medium:["{playerName}{gender_ta}","{playerName}{gender_ta}","{playerName}"],high:["{playerName}{gender_ta}{gender_ta}","{playerName}","{playerName}{gender_ta}{gender_ta}"]},:{low:["{playerName}{gender_ta}...","{playerName}{gender_ta}","{playerName}"],medium:["{playerName}......","{playerName}{gender_ta}","{playerName}"],high:["{playerName}.........{gender_ta}...","{playerName}{gender_ta}","{playerName}{gender_ta}"]},:{low:["{playerName}...{gender_ta}","{playerName}{gender_ta}...","{playerName}...{gender_ta}"],medium:["{playerName}{gender_ta}...","{playerName}...","{playerName}{gender_ta}..."],high:["{playerName}...{gender_ta}{gender_ta}...","{playerName}{gender_ta}...","{playerName}..."]},:{low:["{playerName}","{playerName}","{playerName}{gender_ta}"],medium:["{playerName}{gender_ta}","{playerName}","{playerName}{gender_ta}"],high:["{playerName}","{playerName}{gender_ta}","{playerName}{gender_ta}"]},:{low:["{playerName}","{playerName}","{playerName}{gender_ta}"],medium:["{playerName}{gender_ta}","{playerName}","{playerName}{gender_ta}"],high:["{playerName}","{playerName}{gender_ta}","{playerName}...~"]},:{low:["{playerName}{gender_ta}","{playerName}{gender_ta}","{playerName}"],medium:["{playerName}{gender_ta}","{playerName}{gender_ta}","{playerName}{gender_ta}"],high:["{playerName}{gender_ta}","{playerName}{gender_ta}","{playerName}{gender_ta}"]},:{low:["{playerName}","{playerName}","{playerName}"],medium:["{playerName}{gender_ta}","{playerName}{gender_ta}","{playerName}{gender_ta}"],high:["{playerName}","{playerName}","{playerName}{gender_ta}"]}},Jw=["{playerName}{giftName}{gender_ta}","{playerName}{giftName}{gender_ta}","{playerName}{giftName}{gender_ta}","{giftName}{playerName}{gender_ta}"],ng={:["{playerName}{giftName}......{gender_ta}","{giftName}{playerName}","{playerName}{giftName}...{gender_ta}"],:["{playerName}{giftName}...{gender_ta}","{playerName}{giftName}{gender_ta}","{giftName}{playerName}..."],:["{playerName}{giftName}......","{giftName}...{playerName}","{playerName}{giftName}{gender_ta}"],:["{playerName}{giftName}...{gender_ta}...","{playerName}{giftName}{gender_ta}...","{giftName}...{playerName}{gender_ta}..."],:["{playerName}{giftName}","{playerName}{giftName}{gender_ta}","{giftName}{playerName}"],:["{playerName}{giftName}{gender_ta}","{giftName}{playerName}","{playerName}{giftName}"],:["{playerName}{giftName}{gender_ta}","{playerName}{giftName}{gender_ta}","{giftName}...{playerName}"],:["{playerName}{giftName}","{playerName}{giftName}","{giftName}...{playerName}"]},Xw=["{playerName},{gender_ta},","{playerName},{gender_ta},,","{playerName},,",",{playerName}{gender_ta}"],rg={:["{playerName},","{playerName},,",",{playerName},"],:["{playerName},...{gender_ta},","{playerName},{gender_ta}","{playerName},{gender_ta}"],:["!{playerName}!!()","{playerName}~{gender_ta}!!()","~,{playerName}!{gender_ta}!"],:["{playerName}...{gender_ta},{gender_ta}...","{playerName}{gender_ta}?...{gender_ta},{gender_ta}...","{playerName},{gender_ta},..."],:["{playerName},!!","{playerName},!",",{playerName}!!"],:["!{playerName}!!!","!{playerName}!,{gender_ta}!","{playerName}!,!!"],:["{playerName},","{playerName},",",{playerName}"],:["{playerName},,","{playerName},,",",{playerName},,"]},Zw=["{playerName},...{gender_ta}!","{playerName},,...!{gender_ta},","{playerName},,{gender_ta}","{playerName},{gender_ta},..."],sg={:["{playerName}...,","{playerName}...,","{playerName},,"],:["{playerName}...{gender_ta},","{playerName},,{gender_ta}","{playerName},{gender_ta}{gender_ta}..."],:["{playerName}...!()","{playerName}!!!!()","!!{playerName}!!"],:["{playerName}...{gender_ta}{gender_ta}...,{gender_ta}...","{playerName},{gender_ta}...{gender_ta}...","...{playerName},{gender_ta}......"],:["{playerName},{gender_ta}!","{playerName},!!",",{playerName},,{gender_ta}!"],:["!{playerName}!!{gender_ta}!","!{playerName}!!!!","{playerName}!{gender_ta}!!"],:["{playerName},,","{playerName},","!{playerName},!"],:["{playerName},,","{playerName},",",{playerName},"]},eE=["{playerName},,{gender_ta}...",",{playerName},","{playerName},{gender_ta},",",{playerName},..."],og={:["{playerName},,{gender_ta}",",{playerName}...{gender_ta}","{playerName},{gender_ta},"],:["{playerName},...{gender_ta},",",{playerName},,...","{playerName},{gender_ta}..."],:["{playerName}!{gender_ta}!!","!,!{playerName}...()","{playerName}!{gender_ta}!...(){gender_ta}..."],:["{playerName}...,{gender_ta},...",",{playerName}......","{playerName},{gender_ta},......"],:["{playerName},,{gender_ta},",",{playerName},","{playerName},,"],:["!{playerName}!!","{playerName}!{gender_ta}!!","{playerName}!!!"],:["{playerName},,{gender_ta}",",{playerName},","{playerName},"],:["{playerName},,",",{playerName},","{playerName},,,"]},tE=["{playerName}...","{playerName}...","...{playerName}","{playerName}...","{playerName}"],cu={early:["...","","{playerName}","...''",""],mid:["...{playerName}","...","{playerName}","","","..."],late:["...","{playerName}","...","...","{playerName}","''..."]},nE=["...{childName}","{childName}","...{playerName}","{gender_ta}{childName}{playerName}","{childName}"],rE=["{newTier}","{newTier}","{newTier}","{newTier}","{newTier}"],ig={:["{newTier}","{newTier}","{newTier}"],:["{newTier}...{playerName}","{newTier}","{newTier}"],:["{newTier}","{newTier}...","{newTier}{playerName}"],:["{newTier}...{playerName}...","{newTier}{playerName}...","...{playerName}{gender_ta}..."],:["{newTier}","{newTier}","{newTier}"],:["{newTier}","{newTier}","{newTier}"],:["...{newTier}","{newTier}","{newTier}"],:["{newTier}","{newTier}","{newTier}"]},sE=["...","","...","{targetTier}"],ag={:["...","",""],:["...","...","..."],:["","...","......"],:["...{playerName}...","...{playerName}...","...{playerName}..."],:["","...",""],:["","~","......"],:["...","...",""],:["","",""]},oE=["{spouseName}","{spouseName}{gender_ta}","{spouseName}","{spouseName}{gender_ta}"],iE=["...","","...","","{playerName}..."],du={:["''","","",""],:["{playerName}","","",""],:["","",""],:["","",""],:["","","...",""],:["...","","","..."],:["","","",""],:["","","",""],:["","","",""],:["","","","{gender_ta}"]},aE={:["","","","''"],:["","","",""],:["","{playerName}...{gender_ta}","{playerName}{gender_ta}","{playerName}..."],:["{playerName}{gender_ta}...","{playerName}{gender_ta}{gender_ta}","{playerName}...","{playerName}...{gender_ta}"],:["","","",""],:["","...","","{gender_ta}"]},uu={stranger:["","","",""],crush:["{playerName}","{playerName}{gender_ta}","{playerName}...","{playerName}{gender_ta}{gender_ta}...","{playerName}{gender_ta}"],spouse:["{playerName}{gender_ta}...","{playerName}{gender_ta}","{playerName}","{playerName}{gender_ta}{gender_ta}"]},lE=["","","",""],cE=["","","...",""],dE=["...","","",""],uE=["","","{gender_ta}",""],pE=["","","",""],Df=["","","","",""],lg={:["",""],:["",""],:["{playerName}{playerName}","",""],:["{playerName}","",""]},cg={:{low:["",""],medium:["","{gender_ta}"],high:["",""]},:{low:["",""],medium:["",""],high:["","{gender_ta}"]},:{low:["","",""],medium:["...","",""],high:["","",""]},:{low:["","",""],medium:["","",""],high:["","",""]}},dg={:["",""]},ug={:[""]},pg={:[""]},fg={:[""],:["{playerName}",""],:["",""]},mg={:[""]},gg={:[""]},hg={:[""]},xg={:[""]};function fE(e){if(!e)return null;const t=Object.keys(lg).find(n=>e.includes(n));return t?Ke(lg[t]):null}function mE(e,t){if(!e)return null;const n=Object.keys(cg).find(i=>e.includes(i));if(!n)return null;let s="low";t<30?s="low":t<70?s="medium":s="high";const o=cg[n][s];return o?Ke(o):null}function gE(e){if(!e)return null;const t=Object.keys(dg).find(n=>e.includes(n));return t?Ke(dg[t]):null}function hE(e){if(!e)return null;const t=Object.keys(ug).find(n=>e.includes(n));return t?Ke(ug[t]):null}function xE(e){if(!e)return null;const t=Object.keys(pg).find(n=>e.includes(n));return t?Ke(pg[t]):null}function yE(e){if(!e)return null;const t=Object.keys(fg).find(n=>e.includes(n));return t?Ke(fg[t]):null}function bE(e){if(!e)return null;const t=Object.keys(mg).find(n=>e.includes(n));return t?Ke(mg[t]):null}function vE(e){if(!e)return null;const t=Object.keys(gg).find(n=>e.includes(n));return t?Ke(gg[t]):null}function SE(e){if(!e)return null;const t=Object.keys(hg).find(n=>e.includes(n));return t?Ke(hg[t]):null}function wE(e){if(!e)return null;const t=Object.keys(xg).find(n=>e.includes(n));return t?Ke(xg[t]):null}function EE(e,t=null){let n="low";if(e<30?n="low":e<70?n="medium":n="high",t&&tg[t]){const s=tg[t][n];if(s&&s.length>0)return Ke(s)}return Ke(Qw[n])}function kE(e=null){if(e&&ng[e]){const t=ng[e];if(t&&t.length>0)return Ke(t)}return Ke(Jw)}function jE(e=null){if(e&&rg[e]){const t=rg[e];if(t&&t.length>0)return Ke(t)}return Ke(Xw)}function CE(e=null){if(e&&sg[e]){const t=sg[e];if(t&&t.length>0)return Ke(t)}return Ke(Zw)}function TE(e=null){if(e&&og[e]){const t=og[e];if(t&&t.length>0)return Ke(t)}return Ke(eE)}function IE(e=null){if(e&&ig[e]){const t=ig[e];if(t&&t.length>0)return Ke(t)}return Ke(rE)}function _E(e=null){if(e&&ag[e]){const t=ag[e];if(t&&t.length>0)return Ke(t)}return Ke(sE)}function RE(e){let t=du[e];return t||(e.includes("")||e.includes(""))&&(t=du.||du.),!t||t.length===0?Ke(Df):Ke(t)}function ME(e){const t=aE[e];return Ke(t||Df)}function AE(e,t,n){return n?Ke(uu.spouse):t<20?Ke(uu.stranger):t>=80?Ke(uu.crush):null}const yg={LOW:{:["{playerName}{targetName}...{playerName}{gender_ta}","{playerName}{targetName}...{gender_ta}{gender_ta}"],:["{playerName}{targetName}...{gender_ta}...","{targetName}{playerName}......"],:["{playerName}{targetName}","{playerName}{targetName}..."],:["{playerName}{targetName}...","{playerName}{targetName}...{gender_ta}"],:["{playerName}{targetName}",""],:["{targetName}{playerName}","{playerName}{targetName}"],:["{targetName}...","{targetName}..."],:["{playerName}{targetName}","{playerName}{targetName}"]},MEDIUM:{:["{playerName}{targetName}...{gender_ta}...","{playerName}{targetName}...","{targetName}...{playerName}{playerName}"],:["{playerName}{gender_ta}{targetName}","{playerName}{targetName}...","{playerName}...{gender_ta}"],:["{playerName}{targetName}...","{playerName}...{gender_ta}{targetName}"],:["{playerName}{targetName}...{gender_ta}...","{playerName}{targetName}...{playerName}","{playerName}{gender_ta}..."],:["{playerName}","{playerName}"],:["{playerName}{gender_ta}","{playerName}"],:["{targetName}''...","{targetName}...","..."],:["{playerName}{targetName}","{playerName}{gender_ta}..."]},HIGH:{:["...{playerName}{gender_ta}{targetName}.........","{targetName}{playerName}","...{targetName}{playerName}..."],:["{playerName}{gender_ta}.........","{playerName}{targetName}............","......{playerName}..."],:["{playerName}","{playerName}","..."],:["{playerName}{targetName}...{gender_ta}...","{playerName}......","......"],:["{playerName}{targetName}{gender_ta}","{playerName}{gender_ta}","{playerName}"],:["{playerName}{gender_ta}{gender_ta}","",""],:["...{targetName}.........","...","......"],:["{playerName}{targetName}{gender_ta}","{playerName}..."]},EXTREME:{:["{targetName}{playerName}...{playerName}......","{playerName}...{targetName}","{playerName}{gender_ta}..."],:["{playerName}{targetName}","{playerName}","{playerName}{gender_ta}{targetName}......{gender_ta}"],:["{playerName}{targetName}","{playerName}","{playerName}..."],:["{playerName}.........","{playerName}......","{playerName}{targetName}......{gender_ta}..."],:["{playerName}{gender_ta}{gender_ta}","{playerName}{gender_ta}"],:["{playerName}","{playerName}{targetName}{gender_ta}{gender_ta}"],:["......","...","{gender_ta}..."],:["{playerName}{targetName}","{playerName}"]}},bg={:["{playerName}{favoriteItem}{gender_ta}...","{playerName}{gender_ta}..."],:["{playerName}...{gender_ta}","{playerName}......{gender_ta}"],:["{playerName}...{gender_ta}","{playerName}..."],:["{playerName}{gender_ta}...","{playerName}{gender_ta}..."],:["...","{gender_ta}"],:["{playerName}{gender_ta}","{playerName}"]};class Hy{constructor(t=50){this.maxSize=t,this.cache=new Map}get(t){if(!this.cache.has(t))return null;const n=this.cache.get(t);return this.cache.delete(t),this.cache.set(t,n),n}set(t,n){if(this.cache.has(t)&&this.cache.delete(t),this.cache.set(t,n),this.cache.size>this.maxSize){const s=this.cache.keys().next().value;this.cache.delete(s)}}clear(){this.cache.clear()}has(t){return this.cache.has(t)}size(){return this.cache.size}}function NE(e,t={}){const{maxSize:n=100,keyGenerator:s=(...l)=>JSON.stringify(l),ttl:o=null}=t,i=new Hy(n),a=new Map;return function(...d){const u=s(...d);o&&a.has(u)&&Date.now()-a.get(u)>o&&(i.set(u,null),a.delete(u));const p=i.get(u);if(p!==null)return p;const c=e(...d);return i.set(u,c),o&&a.set(u,Date.now()),c}}class LE{constructor(){this.caches=new Map,this.stats={hits:0,misses:0,sets:0}}createCache(t,n=100){const s=new Hy(n);return this.caches.set(t,s),s}getCache(t){return this.caches.get(t)}get(t,n){const s=this.caches.get(t);if(!s)return this.stats.misses++,null;const o=s.get(n);return o!==null?this.stats.hits++:this.stats.misses++,o}set(t,n,s){const o=this.caches.get(t);if(!o){console.warn(` ${t} `);return}o.set(n,s),this.stats.sets++}clearCache(t){const n=this.caches.get(t);n&&n.clear()}clearAll(){this.caches.forEach(t=>t.clear()),this.stats={hits:0,misses:0,sets:0}}getStats(){const t=this.stats.hits+this.stats.misses>0?(this.stats.hits/(this.stats.hits+this.stats.misses)*100).toFixed(2):0;return{...this.stats,hitRate:`${t}%`,totalCaches:this.caches.size}}}const $a=new LE;$a.createCache("npcLifecycle",200);$a.createCache("combatStats",200);$a.createCache("cultivationProgress",100);$a.createCache("monthlyLogs",50);$a.createCache("sortedLists",20);const bt={INTERACTION:"INTERACTION",STATE_CHANGE:"STATE_CHANGE",DAILY:"DAILY"},$E=50;NE((e,t,n,s)=>null,{maxSize:200,ttl:6e4});function Nn(e,t,n,s,o=bt.DAILY,i=!1){if(!e)return e;const a=e.logs||[],u=[{year:t,month:n,content:s,type:o,isSecret:i,timestamp:Date.now()},...a].slice(0,$E);return{...e,logs:u}}function Ln(e,t,n,s={}){if(!e)return"";let o=e;o=o.replace(/{playerName}/g,(n==null?void 0:n.name)||""),o=o.replace(/{npcName}/g,(t==null?void 0:t.name)||"");const i=(n==null?void 0:n.gender)||"";return t!=null&&t.gender,o=o.replace(/{gender_ta}/g,i===""?"":""),o=o.replace(/{gender_Ta}/g,i===""?"":""),Object.keys(s).forEach(a=>{const l=new RegExp(`{${a}}`,"g");o=o.replace(l,s[a])}),o}function vg(e,t,n,s){const o=e.identity||"",i=fE(o);let a="";return i?a=Ln(i,e,t):e.name===""?a=`${t.name}${t.gender===""?"":""}...`:e.name===""?a=`${t.name}`:a=`${t.name}${t.gender===""?"":""}`,Nn(e,n,s,a,bt.INTERACTION)}function Sg(e,t,n,s){var p,c;const o=((p=e.relationship)==null?void 0:p.affection)||0,i=((c=e.personality)==null?void 0:c.label)||null,a=e.identity||"",d=mE(a,o)||EE(o,i),u=Ln(d,e,t);return Nn(e,n,s,u,bt.INTERACTION)}function BE(e,t,n,s,o,i){var p;const a=((p=e.personality)==null?void 0:p.label)||null,l=e.identity||"";let d=null;d=gE(l)||kE(a);const u=Ln(d,e,t,{giftName:o});return Nn(e,n,s,u,bt.INTERACTION)}function OE(e,t,n,s,o){var p;const i=((p=e.personality)==null?void 0:p.label)||null,a=e.identity||"",d=(o?hE(a):xE(a))||(o?jE(i):CE(i)),u=Ln(d,e,t);return Nn(e,n,s,u,bt.INTERACTION)}function PE(e,t,n,s){var u;const o=((u=e.personality)==null?void 0:u.label)||null,i=e.identity||"",l=yE(i)||TE(o),d=Ln(l,e,t);return Nn(e,n,s,d,bt.INTERACTION,!0)}function wg(e,t,n,s,o,i){var c,m;let a="LOW";if(i>=81)a="EXTREME";else if(i>=61)a="HIGH";else if(i>=41)a="MEDIUM";else if(i>=21)a="LOW";else return e;const l=typeof e.personality=="object"&&e.personality!==null&&"label"in e.personality?e.personality.label:Array.isArray(e.personality)?e.personality[0]:"",d=((c=yg[a])==null?void 0:c[l])||((m=yg[a])==null?void 0:m.);if(!d||d.length===0)return e;const u=Ke(d),p=Ln(u,e,t,{targetName:(o==null?void 0:o.name)||""});return Nn(e,n,s,p,bt.DAILY,!0)}function zE(e,t,n,s){var u;const o=typeof e.personality=="object"&&e.personality!==null&&"label"in e.personality?e.personality.label:Array.isArray(e.personality)?e.personality[0]:"",i=bg[o]||bg.;if(!i||i.length===0)return e;const a=Ke(i),l=((u=e.likes)==null?void 0:u[0])||"",d=Ln(a,e,t,{favoriteItem:l});return Nn(e,n,s,d,bt.DAILY,!0)}function DE(e,t,n,s){const o=Ke(tE),i=Ln(o,e,t);return Nn(e,n,s,i,bt.STATE_CHANGE,!0)}function FE(e,t,n,s,o){let i;o<=3?i=cu.early:o<=6?i=cu.mid:i=cu.late;const a=Ke(i),l=Ln(a,e,t);return Nn(e,n,s,l,bt.STATE_CHANGE,!0)}function HE(e,t,n,s,o){const i=Ke(nE),a=Ln(i,e,t,{childName:o});return Nn(e,n,s,a,bt.STATE_CHANGE,!0)}function Cp(e,t,n,s,o,i){var c;const a=((c=e.personality)==null?void 0:c.label)||null,l=e.identity||"",u=(o?bE(l):vE(l))||(o?IE(a):_E(a)),p=Ln(u,e,t,{newTier:i||"",targetTier:i||""});return Nn(e,n,s,p,bt.STATE_CHANGE)}function Eg(e,t,n,s,o){const i=e.identity||"",l=SE(i)||Ke(oE),d=o===(t==null?void 0:t.name),u=Ln(l,e,t,{spouseName:o||""});return Nn(e,n,s,u,bt.STATE_CHANGE,d)}function WE(e,t,n,s){const o=e.identity||"",a=wE(o)||Ke(iE),l=Ln(a,e,t);return Nn(e,n,s,l,bt.STATE_CHANGE,!0)}function UE(e,t,n,s){var E,S,g,h;if(!e)return e;if(e.isPregnant&&e.pregnancyProgress>0)return FE(e,t,n,s,e.pregnancyProgress);const o=((E=e.relationship)==null?void 0:E.affection)||0,i=e.identity||"",a=((S=e.personality)==null?void 0:S.label)||"",l=((g=e.relationship)==null?void 0:g.stage)>=3,d={relationship:0,identity:20,personality:35,event:10,scenery:35};l?(d.relationship=60,d.scenery=10):o>=80?d.relationship=40:o>=50?d.relationship=20:o<20&&(d.relationship=0);const u=Math.random()*100;let p=0,c="scenery";for(const[x,k]of Object.entries(d))if(p+=k,u<=p){c=x;break}let m=null,v=!1;switch(c){case"relationship":m=AE((h=e.relationship)==null?void 0:h.stage,o,l),v=o>=80;break;case"identity":m=RE(i);break;case"personality":m=ME(a),v=a==="";break;case"event":m=Ke(Ke([lE,cE,dE,uE,pE]));break;case"scenery":default:m=Ke(Df);break}m||(m="");const w=Ln(m,e,t);return Nn(e,n,s,w,bt.DAILY,v)}function GE(e,t,n,s){if(!e||!Array.isArray(e))return e;const o=e.length>50;return e.map(i=>{if(o&&i.logs&&i.logs.length>0&&i._lastLogMonth===s)return i;if(i._hasLogThisMonth){const{_hasLogThisMonth:l,...d}=i;return d}const a=UE(i,t,n,s);return o&&(a._lastLogMonth=s),a})}function qi(e){return{...e,_hasLogThisMonth:!0}}function VE(e,t=0){return!e||!e.logs?[]:t<30?[]:e.logs.filter(n=>n.isSecret?t>=80:!0)}const YE={MORTAL:100,EXPONENTIAL_BASE:1.8},xr={WASTE:.55,FIVE:.6,FOUR:.68,THREE:.78,DOUBLE:1.1,SINGLE:1.35,MUTANT:1.5,HEAVEN:1.65},Wy=(e=50)=>1+Math.max(-.5,(e-50)*.012),Go={longevity_body:1.3,immortal_marrow:1.5,void_spirit_body:1.25,ancient_bloodline:1.2,cursed_body:.75,demonic_enhancement:.85,phoenix_reborn:1.1,common_body:1},Tp={BASE_PROBABILITY:.01,DIFFICULTY_MULTIPLIER:{:10,:5,:4,:3.5,:2.5,:2,:1.8,:1.5,:1.2,:.8,:.6,:.5,:.4,:.3,:.25,:.2,:.15,:.1,:.08,:.06,:.04,:.02,:.015,:.01,:.008,:.006,:.004,:.002,:.0015,:.001,:5e-4,:3e-4,:1e-4},FACTORS:{aptitudeBonus:e=>1+Math.max(-.5,(e-50)*.015),spiritRootBonus:e=>({WASTE:.5,FIVE:.7,FOUR:.85,THREE:1,DOUBLE:1.2,SINGLE:1.5,MUTANT:1.8,HEAVEN:2.2})[e]||1,ageBonus:(e,t)=>{if(!t)return 1;const n=Math.abs(e-t);return n<=10?1+(10-n)*.05:Math.max(.3,1-(n-10)/20)},expProgress:(e,t)=>.5+Math.max(0,Math.min(1,e/t))*1.5,healthBonus:e=>.8+e*.004},LIFESPAN_GAIN_MULTIPLIER:.35};function Cc(e=0,t=1,n=1,s=1){const{MORTAL:o,EXPONENTIAL_BASE:i}=YE,a=Math.pow(i,e/5),d=o*a*t*n*s;return Math.floor(d)}function qE(e,t=1){var d,u,p;const n=Tp;let s=n.BASE_PROBABILITY/t;const o=n.FACTORS.aptitudeBonus(((d=e.stats)==null?void 0:d.aptitude)||50);s*=o;const i=n.FACTORS.spiritRootBonus(((u=e.spiritRoot)==null?void 0:u.id)||"FOUR");s*=i;const a=n.FACTORS.expProgress(e.currentExp||0,e.maxExp||100);s*=a;const l=n.FACTORS.healthBonus(((p=e.stats)==null?void 0:p.health)||50);return s*=l,Math.min(.5,s)}const KE=Object.values(Q).reduce((e,t)=>(e[t.key]=t.order,e),{}),QE=["","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","",""],JE=120,XE=20,ZE=5,ek=8,tk=50,Ip=(e="")=>An(e)?Je.findIndex(n=>n.name===e):0,nk=(e="")=>{if(!e)return 0;const t=QE.indexOf(e);return t>=0?t:0},Tc=(e,t=XE)=>{var u,p,c;if(!e)return JE+t;const n=Ip(e.tier||"");let s=xr.FOUR;(u=e.spiritRoot)!=null&&u.id&&(s={HEAVEN:xr.HEAVEN,MUTANT:xr.MUTANT,SINGLE:xr.SINGLE,DOUBLE:xr.DOUBLE,THREE:xr.THREE,FOUR:xr.FOUR,FIVE:xr.FIVE,WASTE:xr.WASTE}[e.spiritRoot.id]||xr.FOUR);const o=Wy(((p=e.stats)==null?void 0:p.aptitude)||50);let i=Go.common_body;(c=e.constitution)!=null&&c.key&&Go[e.constitution.key]&&(i=Go[e.constitution.key]);const a=Cc(n,s,o,i),l=e.age||18,d=Math.max(a,l+t);return Math.round(d)},Uy=(e,t)=>{if(!t)return 0;const n=Ip(e.name||""),s=Ip(t.name||""),o=Cc(n),a=Cc(s)-o;Math.pow(t.maxExp,.2);const l=a*.15+5;return Math.round(Math.max(5,l))},Gy=e=>{if(!e)return e;const t=e.stats||{},n=Tc(e);return t.lifespan&&t.lifespan>=n?e:{...e,stats:{...t,lifespan:n}}},rk=["herb_bandage","beast_fang","beast_core","foundation_pill","thunder_wood","core_pill","artifact_supreme","dragon_heart_pill","marrow_wash","milk_millennium","nascent_fruit","starlight_pill","heaven_manual","god_transformation_pill","divine_soul_pill","void_condensing_pill","immortal_marrow_pill","heaven_defying_pill","void_refining_pill","space_law_pill","void_stabilization_pill","unity_pill","dao_comprehension_pill","harmony_pill","mahayana_pill","immortal_foundation_pill","semi_immortal_pill","tribulation_pill","ascension_pill"].map(e=>{const t=Jc[e];if(!t)return null;const n=KE[t.resourceLevel]||1,s=n>=5?80:55;return{itemId:e,affectionRequirement:s+n*5,tierRequirement:Math.max(0,n-1),rarity:t.rarity,resourceOrder:n}}).filter(Boolean);function zr(e){if(!e||!e.stats)return 0;const t=e.stats.lifespan||100,n=e.age||18,s=t-n;return Math.max(0,s)}function sk(e,t,n,s){if(!e)return e;const o=(e.age||18)+1;let i=Gy({...e,age:o});const a=zr(i);return a<=0?i={...i,isDead:!0,status:"DEAD",deathReason:""}:a<10&&!e._nearDeathLogged&&(i=WE(i,t,n,s),i._nearDeathLogged=!0),i.status||(i.status=i.isDead?"DEAD":"ALIVE"),i}function ok(e,t,n,s){var S,g,h,x;if(!e||e.isDead)return{npc:e,events:[]};const o=[];let i={...e};i.currentExp||(i.currentExp=0),i.tier||(i.tier="");const a=An(i.tier);if(!a)return{npc:i,events:o};let l=10;const u=.5+(((S=i.stats)==null?void 0:S.aptitude)||50)/100*2.5;l*=u;const c=.6+(((g=i.stats)==null?void 0:g.intelligence)||50)/100*1.4;l*=c;const m=Je.findIndex(k=>k.name===i.tier);if(m>=0&&Je.length>0){const k=1+m/Je.length*1.5;l*=k}const v=((h=i.spiritRoot)==null?void 0:h.multiplier)||.5;l*=v,i.sect&&i.sect.level!=="NONE"&&i.sectStatus==="active"&&(l*=1.5);const w=((x=i.relationship)==null?void 0:x.affection)||0;w>=20&&(w<40?l*=1.1:w<60?l*=1.2:w<80?l*=1.3:l*=1.5),l=Math.max(2,l);const E=Math.floor(l);if(i.currentExp=(i.currentExp||0)+E,i.combatStats=Cn(i),i.cultivationSpeed=l,i.currentExp>=a.maxExp){const k=ik(i,t,n,s);if(i=k.npc,o.push(...k.events),i.currentExp>=a.maxExp){const _=Vy(i,t,n,s);i=_.npc,o.push(..._.events)}}return{npc:i,events:o}}function Vy(e,t,n,s){var m,v;const o=[];let i={...e};const a=An(i.tier),l=Of(i.tier);if(!a||!l)return{npc:i,events:o};const d=((m=i.stats)==null?void 0:m.aptitude)||50,u=((v=i.spiritRoot)==null?void 0:v.multiplier)||.5;let p=a.chance||.3;if(p+=d/10*.03,p+=u*.2,p=Math.max(.05,Math.min(.95,p)),Math.random()<p){if(i.tier=l.name,i.tierTitle=l.name,i.currentExp=0,i.maxExp=l.maxExp,i.stats){const w=Uy(a,l);i.stats={...i.stats,lifespan:(i.stats.lifespan||100)+w},i._lastBreakthroughLifespanGain=w,i._lastBreakthroughType="normal"}if(i.combatStats){const w=Math.floor(i.combatStats.maxHp*.5),E=Math.floor(i.combatStats.atk*.3),S=Math.floor((i.combatStats.def||0)*.2);i.combatStats={...i.combatStats,maxHp:i.combatStats.maxHp+w,hp:i.combatStats.maxHp+w,atk:i.combatStats.atk+E,def:(i.combatStats.def||0)+S}}i=Cp(i,t,n,s,!0,l.name),o.push({type:"NPC_BREAKTHROUGH",npcName:i.name,newTier:l.name,message:`${i.name}  ${l.name} ${i._lastBreakthroughLifespanGain||0} `})}else i.currentExp=0,i=Cp(i,t,n,s,!1,l.name),o.push({type:"NPC_BREAKTHROUGH_FAIL",npcName:i.name,tier:i.tier,message:`${i.name} `});return{npc:i,events:o}}function ik(e,t,n,s){const o=[];let i={...e};if(!i.tier||!i.stats)return{npc:i,events:o};const a=i.currentExp/(i.maxExp||100);if(a<.75||a>=1)return{npc:i,events:o};const l=An(i.tier),d=Tp.DIFFICULTY_MULTIPLIER[i.tier]||1,u=qE(i,d);if(Math.random()<u){const c=Of(i.tier);if(!c)return{npc:i,events:o};if(i.tier=c.name,i.tierTitle=c.name,i.currentExp=0,i.maxExp=c.maxExp,i.stats){const v=Uy(l,c),w=Math.floor(v*Tp.LIFESPAN_GAIN_MULTIPLIER);i.stats={...i.stats,lifespan:(i.stats.lifespan||100)+w},i._lastBreakthroughLifespanGain=w,i._lastBreakthroughType="natural"}if(i.combatStats){const v=Math.floor(i.combatStats.maxHp*.4),w=Math.floor(i.combatStats.atk*.25);i.combatStats={...i.combatStats,maxHp:i.combatStats.maxHp+v,hp:i.combatStats.maxHp+v,atk:i.combatStats.atk+w}}i=Cp(i,t,n,s,!0,c.name);const m=i._lastBreakthroughLifespanGain||0;o.push({type:"NPC_NATURAL_BREAKTHROUGH",npcName:i.name,newTier:c.name,message:`${i.name}  ${c.name} ${m} `})}return{npc:i,events:o}}function ak(e,t,n,s){if(!e||!Array.isArray(e))return{npcs:e||[],events:[]};const o=[],i=s===1;return{npcs:e.map(l=>{var d,u,p;try{let c=Gy(l);if(c.status||(c.status=c.isDead?"DEAD":"ALIVE"),c.isDead)return c;if(i&&(c=sk(c,t,n,s),c.isDead))return c.status="DEAD",o.push({type:"NPC_DEATH",npcName:c.name,reason:c.deathReason,message:`${c.name} ${c.deathReason}`}),c;if(!c.isDead){c.status="ALIVE";const v=zr(c);(((d=c.relationship)==null?void 0:d.affection)||0)>=tk&&v>0&&v<=ZE&&!c._lifespanAlerted?(c={...c,_lifespanAlerted:!0},o.push({type:"NPC_LIFESPAN_ALERT",npcId:c.id,npcName:c.name,remainingYears:v})):c._lifespanAlerted&&v>ek&&(c={...c,_lifespanAlerted:!1})}if(s%6===0){const v=((u=c.relationship)==null?void 0:u.affection)||0,w=((p=c.relationship)==null?void 0:p.stage)||0;if(v>=60&&w>=1&&Math.random()<.2){const E=lk(c,t);E&&o.push(E)}}const m=ok(c,t,n,s);return c=(m==null?void 0:m.npc)||c,m!=null&&m.events&&Array.isArray(m.events)&&o.push(...m.events),c}catch(c){return console.error("Error processing NPC lifecycle for:",l==null?void 0:l.name,c),l}}),events:o}}const Qn={HOSTILE:"HOSTILE",NEUTRAL:"NEUTRAL",FRIENDLY:"FRIENDLY",INTIMATE:"INTIMATE"};function lk(e,t){var m,v,w;const n=((m=e.relationship)==null?void 0:m.affection)||0,s=e.tier||"",o=nk(s);if((((v=e.relationship)==null?void 0:v.stage)||0)<1)return null;const a=rk.filter(E=>{const S=n>=E.affectionRequirement,g=o>=E.tierRequirement;return S&&g});if(!a.length)return null;const l=a.map(E=>({option:E,weight:Math.max(1,8-E.resourceOrder*2)})),d=l.reduce((E,S)=>E+S.weight,0);if(d===0||!l.length)return null;let u=Math.random()*d,p=(w=l[0])==null?void 0:w.option;if(!p)return null;for(const{option:E,weight:S}of l)if(u-=S,u<=0){p=E;break}if(!p||!p.itemId)return null;const c=[`${e.name}""`,`${e.name}`,`${e.name}""`,`${e.name}Ta`];return{type:"NPC_GIFT",npcName:e.name,npcId:e.id,giftItemId:p.itemId,message:c[Math.floor(Math.random()*c.length)]}}function Yy(e=0){return e<0?Qn.HOSTILE:e<50?Qn.NEUTRAL:e<80?Qn.FRIENDLY:Qn.INTIMATE}function ck(e){const t={[Qn.HOSTILE]:{text:"",color:"#f44336",icon:""},[Qn.NEUTRAL]:{text:"",color:"#9e9e9e",icon:""},[Qn.FRIENDLY]:{text:"",color:"#4caf50",icon:""},[Qn.INTIMATE]:{text:"",color:"#e91e63",icon:""}};return t[e]||t[Qn.NEUTRAL]}function pu(e,t){var o;const n=((o=e.relationship)==null?void 0:o.affection)||0,s=Yy(n);switch(t){case"DUAL_CULTIVATION":if(s!==Qn.INTIMATE)return{allowed:!1,reason:" >= 80"};if(e.identity===""&&(e.dualCultivationCount||0)===0)return{allowed:!0,requiresCheck:!0,checkRate:.05};break;case"GIFT":if(s===Qn.HOSTILE)return{allowed:!1,reason:""};break;case"SPAR":if(s===Qn.HOSTILE)return{allowed:!1,reason:""};break}return{allowed:!0}}const dk=[...qs.single,...qs.double],uk=[...Ks.single,...Ks.double],kg=La.single,jg=La.compound,Cg=[{label:"",baseApt:20,desc:""},{label:"",baseApt:40,desc:""},{label:"",baseApt:80,desc:""},{label:"",baseApt:75,desc:""},{label:"",baseApt:70,desc:""},{label:"",baseApt:65,desc:""},{label:"",baseApt:60,desc:""},{label:"",baseApt:70,desc:""},{label:"",baseApt:70,desc:""},{label:"",baseApt:75,desc:""},{label:"",baseApt:65,desc:""},{label:"",baseApt:10,desc:""},{label:"",baseApt:80,desc:""},{label:"",baseApt:85,desc:""},{label:"",baseApt:70,desc:""},{label:"",baseApt:65,desc:""},{label:"",baseApt:60,desc:""},{label:"",baseApt:65,desc:""},{label:"",baseApt:55,desc:""}],kl=[{label:"",tag:"",desc:""},{label:"",tag:"",desc:""},{label:"",tag:"",desc:""},{label:"",tag:"",desc:""},{label:"",tag:"",desc:""},{label:"",tag:"",desc:""},{label:"",tag:"",desc:""},{label:"",tag:"",desc:""},{label:"",tag:"",desc:""},{label:"",tag:"",desc:""},{label:"",tag:"",desc:""},{label:"",tag:"",desc:""},{label:"",tag:"",desc:""},{label:"",tag:"",desc:""},{label:"",tag:"",desc:""},{label:"",tag:"",desc:""},{label:"",tag:"",desc:""}],pk=e=>{const{stats:t,spiritRoot:n,identity:s}=e,o=(t==null?void 0:t.aptitude)||50,i=(n==null?void 0:n.elements)||[];let l={:["SWORD","HEAVEN_EMPEROR","THUNDER"],:["SWORD"],:["DAN"],:["NINE_STAR"],:["NINE_STAR","FLOWER"],:null,:["DEMON"],:["BLOOD"],:["DEMON","GHOST"],:["GHOST"],:["STONE"],:["GRASS"],:["GHOST","BLOOD"],:["FLOWER"],:null,:null,:"NONE",:Math.random()<.3?"random":"NONE",:"random",:null}[s.label];if(l==="random"&&(l=Er.filter(m=>!(m.id==="NONE"||o<m.minApt||m.prefElements&&m.prefElements.length>0&&!i.some(w=>m.prefElements.includes(w))&&o<m.minApt+10)).map(m=>m.id),l.length===0&&(l="NONE")),l===null)return{sect:null,sectId:null,rank:null,status:"mysterious"};if(l==="NONE")return{sect:Er.find(m=>m.id==="NONE"),sectId:"NONE",rank:"",status:"rogue"};const d=Array.isArray(l)?l[Math.floor(Math.random()*l.length)]:l,u=Er.find(m=>m.id===d);if(!u)return{sect:Er.find(m=>m.id==="NONE"),sectId:"NONE",rank:"",status:"rogue"};const p=ia(e,u);let c="active";return Math.random()<.1?c="defected":Math.random()<.05&&(u.level==="RECKLESS"||s.label.includes(""))&&(c="hidden"),{sect:u,sectId:u.id,rank:p,status:c}},fk=()=>({base:Math.floor(Math.random()*Vw.length),skinColor:Math.floor(Math.random()*Uw.length),eye:Math.floor(Math.random()*Yw.length),eyeColor:Math.floor(Math.random()*Gw.length),mouth:Math.floor(Math.random()*qw.length),hair:Math.floor(Math.random()*Kw.length),hairColor:Math.floor(Math.random()*jp.length)}),_p=(e,t="")=>{const n=Date.now()+Math.random().toString().slice(2,6),s=qo(),o=s.tier||e||"",i=Je.find(ee=>ee.name===o)||Je[1],a=s.maxExp??i.maxExp,l=Math.min(s.currentExp??0,a),d=18+Math.floor(Math.random()*100),p=Math.random()<.15?jg[Math.floor(Math.random()*jg.length)]:kg[Math.floor(Math.random()*kg.length)],c=t===""?uk:dk,m=c[Math.floor(Math.random()*c.length)];let v=Math.floor(Math.random()*80)+10;Math.random()<.05&&(v=90+Math.floor(Math.random()*10));let w={aptitude:v,looks:50+Math.floor(Math.random()*50),intelligence:40+Math.floor(Math.random()*60),health:80},E;v===100&&Math.random()<.005?E=ja("chaos_dao"):E=J2(),w=$f(w,E);const S=fk();let g="";S.eye===1&&(g=""),S.eye===2&&(g="");const h=`${S.skin===0?"":""}${g}`,x=ai(v,{constitution:E}),_=Cn({tier:o,currentExp:l,maxExp:a,stats:w,spiritRoot:x,equipment:null}),y=Cg[Math.floor(Math.random()*Cg.length)],C=pk({stats:w,spiritRoot:x,identity:y});let I=y.desc;C.status==="mysterious"?I+=" ":C.status==="rogue"?I+=" ":C.status==="defected"?I+=` ${C.sect.name}${C.rank}`:C.status==="hidden"?I+=` ${C.rank}`:C.status==="active"&&C.sect&&(I+=` ${C.sect.name}${C.rank}`);const L=Tc({age:d,stats:w,tier:o,spiritRoot:x});return w={...w,lifespan:L},{id:n,name:p+m,gender:t,age:d,identity:y.label,status:"ALIVE",desc:I,avatar:S,appearance:h,tier:o,currentExp:l,maxExp:a,cultivation:l,stats:w,spiritRoot:x,constitution:E,combatStats:_,combatPower:Zc({stats:w,spiritRoot:x,constitution:E,maxExp:a}).hp*2,cultivationMethod:"basic_breath",personality:kl[Math.floor(Math.random()*kl.length)],sect:C.sect,sectId:C.sectId,rank:C.rank,sectStatus:C.status,relationship:{stage:0,affection:0,trust:0,jealousy:0},trait:kl[Math.floor(Math.random()*kl.length)],acceptsLetters:!0,isPregnant:!1}};function Ff(e,t){if(!e)return e;const n={...e,stats:{...e.stats||{},aptitude:t}};try{if(n.isTested||n.spiritRoot&&Array.isArray(n.spiritRoot.elements)){const s=ir(t,n.spiritRoot,null,{constitution:n.constitution});n.spiritRoot=s}}catch{}return n}function mk(e,t){return Ff(e,t)}const gk=e=>{const t=e.reduce((s,o)=>s+(o.weight||1),0);let n=Math.random()*t;for(const s of e)if(n-=s.weight||1,n<=0)return s;return e[e.length-1]},hk=[yt.PLAYER,yt.CHILD],xk={YELLOW:"common",BLACK:"uncommon",EARTH:"rare",HEAVEN:"epic",DIVINE:"legendary"},yk={YELLOW:Q.MORTAL.key,BLACK:Q.SPIRIT.key,EARTH:Q.EARTH.key,HEAVEN:Q.HEAVEN.key,DIVINE:Q.DIVINE.key},bk={basic:["YELLOW","BLACK"],advanced:["EARTH"],apex:["HEAVEN","DIVINE"]},Tg={[Q.MORTAL.key]:1,[Q.SPIRIT.key]:2,[Q.EARTH.key]:3,[Q.HEAVEN.key]:4,[Q.DIVINE.key]:5},vk=(e,t)=>{const n=Tg[t]||1;return e.filter(s=>{const o=cs(s);return o?(Tg[o.resourceLevel]||1)<=n:!0})},Sk=(e=["YELLOW"],t)=>{var i,a;let n=Object.values(K2).filter(l=>e.includes(l.tier));if(!n.length)return null;const s=((a=(i=t==null?void 0:t.player)==null?void 0:i.spiritRoot)==null?void 0:a.elements)||[],o=n.filter(l=>s.includes(l.element));return o.length&&(n=o),n[Math.floor(Math.random()*n.length)]},wk=e=>{const t=vn[e];if(!t)return null;const n=Xc[t.tier]||{};return{id:`manual_scroll_${e}`,name:`${t.name}`,type:"manual",rarity:xk[t.tier]||"rare",tier:n.name||t.tier,tierColor:n.color,element:t.element,baseBonus:`${Math.round((n.baseBuff||0)*100)}%`,desc:t.desc,manualIds:[e],resourceCategory:"MANUAL",resourceLevel:t.resourceLevel||yk[t.tier]||Q.MORTAL.key,manualSchool:t.school,usageTargets:hk,tags:[t.element||"",t.tier]}},Ig=(e,t)=>{const n=bk[e]||["YELLOW"],s=Sk(n,t);if(!s)return null;const o=s.manualIds[Math.floor(Math.random()*s.manualIds.length)];return wk(o)},_g=(e,t)=>{const n=Hf(e);if(!n)return Ig("basic",t);const s=n.resourceLevel||"MORTAL";let o="basic";return s==="DIVINE"?o="apex":s==="HEAVEN"?o=Math.random()<.8?"advanced":"apex":s==="EARTH"&&(o=Math.random()<.6?"basic":"advanced"),Ig(o,t)},Hf=e=>zy.find(t=>t.id===e),Ek=(e,t=1)=>{const n=Hf(e)||{recommendCP:300,drops:["herb_bandage"],resourceLevel:"MORTAL"},s=n.recommendCP||300,o=t>=10,i=o?1.5:.6+t*.06,a=Math.floor(s*i),l=o?"":"",d=o?.02:.012,u=vk(n.drops||["herb_bandage"],n.resourceLevel||"MORTAL");return{name:l,combatStats:{hp:Math.floor(a*.3),atk:Math.floor(a*d),def:Math.floor(a*.0073),mp:0,maxHp:Math.floor(a*.3),maxMp:0},drops:u.length>0?u:["herb_bandage"],isBoss:o}},kk=(e,t)=>!!(e!=null&&e.find(n=>n.id===t)),jk=[{id:"combat_beast",kind:"COMBAT",realm:"ANY",weight:3,title:"",desc:"",options:[{label:"",action:e=>({type:"START_COMBAT"})},{label:"",action:()=>({type:"LOG",msg:""})}]},{id:"loot_array",kind:"LOOT",realm:"ANY",weight:2,title:"",desc:"",options:[{label:" ()",action:e=>{var n,s;return(((s=(n=e.player)==null?void 0:n.combatStats)==null?void 0:s.atk)||10)>80?{type:"LOOT",items:["beast_core"],msg:""}:{type:"HP_CHANGE",hpDelta:-150,msg:""}}},{label:" ()",action:e=>{var n,s;return(((s=(n=e.player)==null?void 0:n.stats)==null?void 0:s.intelligence)||40)>=70?{type:"LOOT",items:["foundation_pill"],msg:""}:{type:"LOG",msg:""}}}]},{id:"encounter_injured",kind:"ENCOUNTER",realm:"ANY",weight:1,title:"",desc:"",options:[{label:" (-1 )",condition:e=>kk(e.inventory,"herb_bandage"),action:e=>{let t=_p("");try{t=Ff(t,Math.max(t.stats.aptitude||0,90))}catch{t.stats.aptitude=Math.max(t.stats.aptitude||0,90)}return{type:"NPC_JOIN",npc:t,removeItemId:"herb_bandage",msg:""}}},{label:"",action:()=>({type:"LOOT",items:["spirit_stones_500"],msg:""})},{label:"",action:()=>({type:"LOG",msg:""})}]},{id:"fruit_unknown",kind:"LOOT",realm:"ANY",weight:1,title:"",desc:"",options:[{label:"",action:()=>{const e=Math.random();return e<.4?{type:"EXP_GAIN",amount:1200,msg:""}:e<.8?{type:"HP_CHANGE",hpDelta:-120,msg:""}:{type:"LOG",msg:""}}},{label:"",action:()=>({type:"LOG",msg:""})}]},{id:"story_two_beasts",kind:"STORY",realm:"ANY",weight:1,title:"",desc:"",options:[{label:"",action:()=>({type:"LOOT",items:["beast_fang"],msg:""})},{label:"",action:()=>({type:"LOG",msg:""})}]},{id:"manual_cave",kind:"LOOT",realm:"ANY",weight:1,title:"",desc:"",options:[{label:"",action:e=>{const t=_g(e.realmId,e);return t?{type:"LOOT",items:[t],msg:""}:{type:"LOG",msg:""}}},{label:"",action:()=>({type:"LOG",msg:""})}]},{id:"fortune_telling",kind:"ENCOUNTER",realm:"ANY",weight:1,title:"",desc:'""',options:[{label:" (100)",condition:e=>{var t,n;return(((n=(t=e.player)==null?void 0:t.resources)==null?void 0:n.spiritStones)||0)>=100},action:e=>{const t=[{type:"EXP_GAIN",amount:2e3,msg:""},{type:"LOG",msg:""},{type:"LOG",msg:""},{type:"LOOT",items:["spirit_stones_200"],msg:""}];return{...t[Math.floor(Math.random()*t.length)],spiritStonesDelta:-100}}},{label:"",action:()=>({type:"LOG",msg:'""'})}]},{id:"spirit_fruit_grove",kind:"LOOT",realm:"ANY",weight:1,title:"",desc:"",options:[{label:"",action:()=>{const e=[{items:["spirit_stones_300"],msg:""},{items:["foundation_pill"],msg:""},{type:"EXP_GAIN",amount:1500,msg:""}],t=e[Math.floor(Math.random()*e.length)];return{type:t.type||"LOOT",...t}}},{label:"",action:()=>({type:"LOG",msg:""})}]},{id:"ancient_script",kind:"LOOT",realm:"ANY",weight:1,title:"",desc:"",options:[{label:"",action:e=>{var s,o;const t=((o=(s=e.player)==null?void 0:s.stats)==null?void 0:o.intelligence)||40,n=[40,60,80][Math.floor(Math.random()*3)];return t>=n?{type:"LOOT",items:["wisdom_pill"],msg:""}:{type:"HP_CHANGE",hpDelta:-80,msg:""}}},{label:"",action:()=>({type:"LOG",msg:""})}]},{id:"spirit_pool",kind:"LOOT",realm:"ANY",weight:1,title:"",desc:"",options:[{label:"",action:()=>{const e=[{type:"EXP_GAIN",amount:3e3,msg:""},{type:"LOOT",items:["primordial_spirit_pill"],msg:""},{type:"LOG",msg:""}];return e[Math.floor(Math.random()*e.length)]}},{label:"",action:()=>({type:"LOG",msg:""})}]},{id:"treasure_chest",kind:"LOOT",realm:"ANY",weight:.8,title:"",desc:"",options:[{label:"",action:e=>{var n,s;const t=((s=(n=e.player)==null?void 0:n.combatStats)==null?void 0:s.atk)||30;return t>100?{type:"LOOT",items:["cosmic_crystal","spirit_stones_500"],msg:""}:t>50?{type:"LOOT",items:["spirit_stones_300"],msg:""}:{type:"HP_CHANGE",hpDelta:-50,msg:""}}},{label:"",action:()=>({type:"LOOT",items:["spirit_stones_200"],msg:""})},{label:"",action:()=>({type:"LOG",msg:""})}]},{id:"meditation_spot",kind:"ENCOUNTER",realm:"ANY",weight:1,title:"",desc:"",options:[{label:"",action:()=>{const e=[{type:"EXP_GAIN",amount:2500,msg:""},{type:"LOOT",items:["awakening_pill"],msg:""},{type:"LOG",msg:""}];return e[Math.floor(Math.random()*e.length)]}},{label:"",action:()=>({type:"LOG",msg:""})}]},{id:"rival_encounter",kind:"ENCOUNTER",realm:"ANY",weight:.8,title:"",desc:"",options:[{label:"",action:()=>({type:"LOG",msg:Math.random()<.5?" ":" "})},{label:"",action:()=>({type:"LOG",msg:""})},{label:"",action:()=>({type:"LOOT",items:["spirit_stones_250"],msg:""})}]},{id:"demonic_lair",kind:"ENCOUNTER",realm:"ANY",weight:.5,title:"",desc:"",options:[{label:"",action:e=>{const t=Math.random();return t<.3?{type:"LOOT",items:["void_silk"],msg:""}:t<.6?{type:"HP_CHANGE",hpDelta:-150,msg:""}:{type:"LOG",msg:""}}},{label:"",action:()=>({type:"LOG",msg:""})}]},{id:"celestial_lake",kind:"ENCOUNTER",realm:"ANY",weight:1,title:"",desc:"",options:[{label:"",action:()=>{const e=[{type:"LOOT",items:["spirit_stones_400"],msg:""},{type:"EXP_GAIN",amount:1e3,msg:""},{type:"LOG",msg:""}];return e[Math.floor(Math.random()*e.length)]}},{label:"",action:()=>({type:"LOG",msg:""})}]},{id:"manual_library",kind:"LOOT",realm:"ANY",weight:1,title:"",desc:"",options:[{label:"",action:e=>{const t=_g(e.realmId,e);return t?{type:"LOOT",items:[t],msg:""}:{type:"LOG",msg:""}}},{label:"",action:()=>({type:"LOG",msg:""})}]}],Ck=e=>{const t=Hf(e),n=t!=null&&t.name?`${t.name}  `:"";return{id:"boss_guard",kind:"BOSS",realm:e,weight:1,title:n,desc:"",options:[{label:"",action:()=>({type:"START_COMBAT"})},{label:"",action:()=>({type:"LOG",msg:""})}]}},Rg=e=>{const{realmId:t,progress:n}=e,o=jk.filter(i=>i.realm==="ANY"||i.realm===t).map(i=>{let a=i.weight||1;return n<=3&&(i.kind==="LOOT"||i.kind==="ENCOUNTER")&&(a*=1.5),n>=7&&i.kind==="COMBAT"&&(a*=1.5),{...i,weight:a}});return gk(o)},Tk=e=>{const t=aw(e);if(!t)return null;const n=cs(t);if(!n)return null;const s=typeof n.name=="string"?n.name:"";return{giftItemId:t,giftName:s}},So=(e,t)=>Math.random()>.5?e:t,Ik=(e={},t=null)=>{const s=Wy(e.aptitude||50);let o=Go.common_body;t!=null&&t.key&&Go[t.key]&&(o=Go[t.key]);const a=Cc(0,1,s,o);return Math.floor(a)},ai=(e,t={})=>{const n=nw(t.constitution);if(n&&n.length>0){const l=n[Math.floor(Math.random()*n.length)];return{type:"",elements:[l],desc:`${l}`,color:"#FFD700",multiplier:1}}const s=dw(e);let o=[],i=s.name,a=s.desc;if(s.id==="NONE")o=[];else if(s.id==="MUTANT"||s.id==="MUTANT_HEAVEN")o=[Jm[Math.floor(Math.random()*Jm.length)]];else{const l=[...cw];for(let d=l.length-1;d>0;d--){const u=Math.floor(Math.random()*(d+1));[l[d],l[u]]=[l[u],l[d]]}o=l.slice(0,s.elementCount)}return{type:i,elements:o,desc:a,color:s.color,multiplier:s.multiplier}},ir=(e,t,n,s={})=>ai(e,s),Rp=e=>{if(!e)return{recommended:[],others:[]};const t=Er.map(l=>({sect:l,score:My(e,l),admission:Ay(e,l)})),n=[...t].sort((l,d)=>d.score-l.score),s=[];if(n.forEach(l=>{l.sect.id!=="NONE"&&(s.length>=3||l.admission.qualified&&s.push(l))}),s.length<3&&n.forEach(l=>{l.sect.id!=="NONE"&&(s.includes(l)||s.length<3&&s.push(l))}),s.length===0&&n.length){const l=n.find(d=>d.sect.id!=="NONE")||n[0];l&&s.push(l)}const o=l=>({sect:l.sect,predictedRank:l.admission.qualified?ia(e,l.sect):null,resources:gw(l.sect),compatibility:l.score,admission:l.admission}),i=s.map(o),a=t.filter(l=>!s.includes(l)).sort((l,d)=>d.score-l.score).map(o);return{recommended:i,others:a}},_k=(e,t,n)=>{var C,I,T,L,ee,$,O;const s={base:0,skinColor:0,eye:2,eyeColor:0,mouth:0,hairColor:0},o=(e==null?void 0:e.avatar)||s,i=(t==null?void 0:t.avatar)||s,a=Math.random()>.5?"":"",l={base:So(o.base,i.base),skinColor:So(o.skinColor,i.skinColor),eye:So(o.eye,i.eye),eyeColor:So(o.eyeColor,i.eyeColor),mouth:So(o.mouth,i.mouth),hair:Math.floor(a===""?Math.random()*2:Math.random()*4),hairColor:So(o.hairColor,i.hairColor)};let d=((((C=e.stats)==null?void 0:C.aptitude)||50)+(((I=t.stats)==null?void 0:I.aptitude)||50))/2,u=Math.floor(Math.random()*31)-15;Math.random()<.05&&(u+=Math.random()>.5?20:-20),t.constitution&&(u+=5);const p=((T=e.spiritRoot)==null?void 0:T.type)==="",c=((L=t.spiritRoot)==null?void 0:L.type)==="";(p&&Math.random()<.2||c&&Math.random()<.2)&&(u+=30);const m=Math.max(1,Math.min(100,Math.floor(d+u))),v=Math.floor((e.stats.looks+t.stats.looks)/2+(Math.random()*10-5));let w=null;const E=Math.random(),S=e.constitution&&e.constitution.name,g=t.constitution&&t.constitution.name,h=((ee=t.customFlags)==null?void 0:ee.isFumoLegend)||t.identity===""||t.identity==="";if(m===100&&Math.random()<.005)w=ja("chaos_dao");else if(S&&g){if(E<.8){const H=Math.random()>.5?t.constitution:e.constitution;w=Yl(H)}}else g?E<(h?1:.6)&&(w=Yl(t.constitution)):S&&E<.6&&(w=Yl(e.constitution));!w&&m!==100&&Math.random()<.01&&(w=ja("innate_dao")||{name:"",desc:"",rarity:"UR"});const x={weapon:null,armor:null,accessory:null};let k={aptitude:m,looks:v,intelligence:Math.floor((e.stats.cunning+t.stats.intelligence)/2)};k=$f(k,w);const _=ni("",k.aptitude,null,x),y=zf(a,{motherName:e==null?void 0:e.name,fatherName:t==null?void 0:t.name,preferSurname:""}),R=Bp({id:`child_${Date.now()}_${Math.floor(Math.random()*1e5)}`,name:y,fatherName:t.name,motherName:e.name,birthYear:n,generation:1,age:0,gender:a,status:"ALIVE",tier:"",stats:{...k,lifespan:Ik(k,w)},constitution:w,cultivationMethod:"basic_breath",equipment:x,combatStats:_,combatPower:0,avatar:l,isTested:!1,cultivation:0,maxExp:((O=Je[0])==null?void 0:O.maxExp)||100,currentExp:0,isAdult:!1});$=Zc(R);R.combatPower=($==null?void 0:$.power)||0;return R},qy=e=>{for(let t=0;t<Je.length;t++)if(e<Je[t].maxExp)return Je[t];return Je[Je.length-1]},Rk=(e,t,n={})=>{var k;let s=0,o=0,i=[],a=[];const l=n.familyRatingMultiplier??1,u=(((k=n.playerStrategy)==null?void 0:k.childrenStrategy)||n.childrenStrategy||{}).skipZhaozhou===!0,p=n.currentYear||0;if(!e||!Array.isArray(e)||e.length===0)return{newChildren:[],generation3Plus:n.generation3Plus||[],totalFeedback:0,totalCost:0,logs:[],events:[]};const c=[],m=[],v=[];e.forEach(_=>{(_.generation||1)<=2?m.push(_):v.push(_)});let w=n.generation3Plus||[];const E=new Set(w.map(_=>_.id));v.forEach(_=>{E.has(_.id)||(w.push({id:_.id,generation:_.generation||3,birthYear:p-(_.age||0),parentGeneration:(_.generation||3)-1}),E.add(_.id))});const S=[];let g=0;for(let _=0;_<w.length;_++){const y=w[_],R=p-y.birthYear;Math.floor(R)===20&&y.generation<6&&S.push({id:`child_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,generation:y.generation+1,birthYear:p,parentGeneration:y.generation}),R>.5&&(g+=1),S.push(y)}return w=S,s+=g,{newChildren:[...m.map(_=>{var I,T,L,ee,$,O,H,F,se,J,de,Ee,$e,De,Qe,Y,ue,ne,ce;let y={..._};y.age+=1/12;const R=y.generation||1;if(R>2){if(y.age>6){const ae=Ca(y,!0);y.cultivation=Math.floor((y.cultivation||0)+ae)}return y}if(y.stats||(y.stats={}),!y.stats.lifespan){const ae=((I=y.spiritRoot)==null?void 0:I.multiplier)||1,je=100;y.stats.lifespan=Math.floor(je*(1+ae))}if(Math.floor(y.age*12)===12&&!y.trait){const ae=Math.random()*100;let je="WHITE";ae>99?je="RED":ae>95?je="ORANGE":ae>85?je="PURPLE":ae>65?je="BLUE":ae>35&&(je="GREEN");const X=Xm.filter(_e=>_e.rarity===je),Me=X[Math.floor(Math.random()*X.length)]||Xm[0];y.trait=Me;const Ae=` ${y.name} ${Me.name}(${Me.desc})`;i.push(Ae),u||a.push({type:"ZHAOZHOU",title:"",message:Ae,child:y,trait:Me,showModal:!0})}if(Math.floor(y.age*12)===144&&y.isTested&&!y.sect){const{recommended:ae,others:je}=Rp(y),X=` ${y.name} 12`;i.push(X),a.push({type:"JOIN_SECT",title:"",message:X,child:y,selectableSects:ae,otherSectOptions:je,showModal:!0})}if(y.age>6){const ae=Ca(y,!0);y.cultivation=Math.floor(y.cultivation+ae);const je=qy(y.cultivation),X=y.tierTitle;y.tierTitle=je.name;const Me=Je.findIndex(_e=>_e.name===je.name),Ae=Me>0?Je[Me-1].maxExp:0;if(y.currentExp=y.cultivation-Ae,y.maxExp=je.maxExp-Ae,X&&X!==y.tierTitle){const z={:30,:30,:30,:30,:50,:50,:50,:50,:200,:200,:200,:200,:300,:300,:300,:300,:500,:500,:500,:500}[y.tierTitle]||50;y.stats||(y.stats={}),typeof y.stats.lifespan!="number"&&(y.stats.lifespan=100),y.stats.lifespan+=z,i.push(` ${y.name} ${y.tierTitle} ${z} `)}if((y.generation||1)>2)return s+=kc(y,{familyRatingMultiplier:l})/12,y;if(s+=kc(y,{familyRatingMultiplier:l})/12,Math.floor(y.age*12)%6===0&&y.sect&&y.sect.level!=="NONE"){const _e=["","","","","","","",""],z=_e.indexOf(y.rank),he=Math.max(.3,Math.min(2,((T=y.sect)==null?void 0:T.promotionEase)||1)),ye=ve=>ve/he;let ke=0;if(y.cultivation>ye(500)&&(ke=1),y.cultivation>ye(2e3)&&(((L=y.stats)==null?void 0:L.aptitude)||0)>50&&(ke=2),y.cultivation>ye(2e4)&&(((ee=y.stats)==null?void 0:ee.aptitude)||0)>80&&(ke=3),y.cultivation>ye(1e5)&&(ke=5),y.cultivation>ye(2e5)&&((($=y.stats)==null?void 0:$.aptitude)||0)>90&&(ke=6),y.cultivation>ye(35e4)&&(((O=y.stats)==null?void 0:O.aptitude)||0)>95&&(ke=7),ke===7&&((H=y.sect)!=null&&H.id)){const ve=[...Array.isArray(n.worldNpcs)?n.worldNpcs:[],...Array.isArray(n.activeNpcs)?n.activeNpcs:[]],Ge=pt=>pt?typeof pt.status=="string"?pt.status!=="DEAD":typeof pt.isDead=="boolean"?!pt.isDead:!0:!1;ve.some(pt=>{var Ct;return((Ct=pt==null?void 0:pt.sect)==null?void 0:Ct.id)===y.sect.id&&((pt==null?void 0:pt.sectRank)===""||(pt==null?void 0:pt.rank)==="")&&Ge(pt)})&&(ke=6)}if(ke>z){y.rank=_e[ke];let ve=` ${y.name} ${y.sect.name}  ${y.rank}`;const Ge=Tk(y.rank);Ge&&(ve+=` ${Ge.giftName}${y.name} `,a.push({type:"CHILD_PROMOTION_GIFT",title:"",message:ve,child:y,rank:y.rank,sect:y.sect,giftItemId:Ge.giftItemId,giftName:Ge.giftName,showModal:!0})),i.push(ve)}}}if(Math.floor(y.age*12)===216&&(i.push(` ${y.name} `),y.isAdult=!0),R<=2&&y.isAdult&&y.spouse&&y.age<60&&Math.random()<.1&&e.filter(je=>je.parentId===y.id).length<3){const je=((F=y.stats)==null?void 0:F.aptitude)||50,X=((J=(se=y.spouse)==null?void 0:se.stats)==null?void 0:J.aptitude)||((de=y.spouse)==null?void 0:de.aptitude)||50,Me=(je+X)/2;let Ae=Math.floor(Math.random()*31)-15;const _e=((Ee=y.spiritRoot)==null?void 0:Ee.type)==="",z=((De=($e=y.spouse)==null?void 0:$e.spiritRoot)==null?void 0:De.type)==="";(_e&&Math.random()<.2||z&&Math.random()<.2)&&(Ae+=30);const he=Math.max(1,Math.min(100,Math.floor(Me+Ae))),ye=y.stats.looks||50,ke=((Qe=y.spouse.stats)==null?void 0:Qe.looks)||y.spouse.looks||50,ve=Math.max(1,Math.min(100,Math.floor((ye+ke)/2+(Math.random()*10-5)))),Ge=y.stats.intelligence||50,on=((Y=y.spouse.stats)==null?void 0:Y.intelligence)||y.spouse.intelligence||50,pt=Math.max(1,Math.min(100,Math.floor((Ge+on)/2+(Math.random()*10-5))));let Ct=null;const Qt=Math.random(),Yr=y.constitution&&y.constitution.name,lo=((ue=y.spouse)==null?void 0:ue.constitution)&&y.spouse.constitution.name;he===100&&Math.random()<.005?Ct=ja("chaos_dao"):Yr&&lo?Qt<.8&&(Ct=Math.random()>.5?y.constitution:y.spouse.constitution):Yr?Qt<.6&&(Ct=y.constitution):lo&&Qt<.6&&(Ct=y.spouse.constitution),!Ct&&he!==100&&Math.random()<.01&&(Ct={name:"",desc:"",rarity:"UR"});const ks={weapon:null,armor:null,accessory:null};let tr={aptitude:he,looks:ve,intelligence:pt};tr=$f(tr,Ct);const js=ni("",tr.aptitude,null,ks),an=Math.random()>.5?"":"",Lt=Bp({id:Date.now()+Math.random().toString().slice(2,10),name:zf(an,{preferSurname:""}),fatherName:y.name,motherName:y.spouse.name,parentId:y.id,birthYear:Math.floor(y.age*12/12),generation:(y.generation||1)+1,age:0,gender:an,status:"ALIVE",tier:"",stats:tr,constitution:Ct,cultivationMethod:"basic_breath",equipment:ks,combatStats:js,combatPower:((ne=Zc(Lt))==null?void 0:ne.power)||0,avatar:{base:Math.floor(Math.random()*3),skinColor:Math.floor(Math.random()*5),eye:Math.floor(Math.random()*3),eyeColor:Math.floor(Math.random()*5),mouth:Math.floor(Math.random()*3),hair:Math.floor(an===""?Math.random()*2:Math.random()*4),hairColor:Math.floor(Math.random()*5)},isTested:!1,cultivation:0,maxExp:((ce=Je[0])==null?void 0:ce.maxExp)||100,currentExp:0,isAdult:!1});c.push(Lt);const co=` ${y.name}  ${y.spouse.name} /${Lt.name}`;i.push(co),a.push({type:"GRANDCHILD_BIRTH",title:"",message:co,child:y,grandchildCount:1})}return y}),...c],generation3Plus:w,totalFeedback:s,totalCost:o,logs:i,events:a}},Kl=(e,t,n="random")=>{const s=t===""?"":"",o=zf(s);let i,a,l,d=null;switch(n){case"talented":i=75+Math.floor(Math.random()*20),a=40+Math.floor(Math.random()*30),l=60+Math.floor(Math.random()*30);break;case"beautiful":i=50+Math.floor(Math.random()*30),a=80+Math.floor(Math.random()*20),l=50+Math.floor(Math.random()*30);break;case"wise":i=60+Math.floor(Math.random()*25),a=55+Math.floor(Math.random()*30),l=80+Math.floor(Math.random()*20);break;case"buddha":i=90+Math.floor(Math.random()*10),a=30+Math.floor(Math.random()*30),l=80+Math.floor(Math.random()*20),d="";break;default:i=40+Math.floor(Math.random()*50),a=50+Math.floor(Math.random()*40),l=40+Math.floor(Math.random()*40)}const u=ai(i),p={weapon:null,armor:null,accessory:null},c=ni("",i,u.type,p),m=500+Math.floor(Math.random()*1500),v=qy(m).name,w=n==="buddha"?{base:0,skinColor:2,hair:-1,hairColor:null,eye:0,eyeColor:0,mouth:1}:{base:Math.floor(Math.random()*3),skinColor:Math.floor(Math.random()*5),eye:Math.floor(Math.random()*3),eyeColor:Math.floor(Math.random()*5),mouth:Math.floor(Math.random()*3),hair:Math.floor(Math.random()*3),hairColor:Math.floor(Math.random()*5)},E=n==="buddha"?"":s;return{id:Date.now()+Math.random().toString().slice(2,8),name:o,gender:E,identity:d,aptitude:i,looks:a,intelligence:l,spiritRoot:u,cultivationMethod:"basic_breath",equipment:p,combatStats:c,cultivation:m,tierTitle:v,isTested:!0,isAdult:!0,avatar:w,stats:{aptitude:i,looks:a,intelligence:l},relationship:n==="buddha"?{stage:1,affection:0,trust:0}:void 0,likes:n==="buddha"?[""]:void 0,isSpouse:!0,archetype:n}},Mg=(e,t)=>[Kl(e,t,"talented"),Kl(e,t,"beautiful"),Kl(e,t,"wise")],Mk=(e,t)=>Kl(e,t,"random"),Ak=e=>{const t=An(e.tier),n=Of(e.tier);if(!n)return{success:!1,msg:""};const s=t.chance,o=(e.breakthroughBonus||0)/100,i=Math.min(.95,s+o);if(Math.random()<i)return{success:!0,newTier:n.name,newMaxExp:n.maxExp,baseChance:s,finalChance:i,resetFailCount:!0,msg:`${n.name}()`};{const d=Math.floor(t.maxExp*.2);return{success:!1,penalty:d,baseChance:s,finalChance:i,addFailBonus:!0,msg:` ${d} 5%`}}},Ag=(e,t)=>{let n=0,s=[];return e.forEach(o=>{var p,c;const i=t.find(m=>m.id===o.managerId);if(!i){s.push(` ${o.name}`);return}const a=Math.floor(o.baseIncome*(1+i.stats.intelligence/100)),l=((c=(p=i.trait)==null?void 0:p.bonuses)==null?void 0:c.businessBonus)||0,d=ew(i.constitution),u=Math.floor(a*(1+l+d));n+=u}),{income:n,logs:s}};function Nk(){const e=b.useMemo(()=>Oy.map(k=>{var y;const _=(y=k.stats)==null?void 0:y.aptitude;return typeof _=="number"?{...k,spiritRoot:ai(_)}:k}),[]),[t,n]=b.useState(e),[s,o]=b.useState([]),[i,a]=b.useState(null),[l,d]=b.useState(null),u=b.useMemo(()=>t.filter(k=>{var _;return!((_=k.relationship)!=null&&_.cutTies)}),[t]),p=b.useCallback((k,_)=>{n(y=>y.map(R=>R.id===k?{...R,relationship:{...R.relationship,..._}}:R))},[]),c=b.useCallback((k,_)=>{n(y=>y.map(R=>R.id===k?{...R,..._}:R))},[]),m=b.useCallback(k=>{n(_=>[..._,k])},[]),v=b.useCallback(k=>{n(_=>{const y=_.find(R=>R.id===k);return y&&o(R=>[...R,y]),_.filter(R=>R.id!==k)})},[]),w=b.useCallback(k=>{n(_=>_.map(y=>y.id===k?{...y,isFollowed:!y.isFollowed}:y))},[]),E=b.useCallback(k=>{n(_=>_.map(k))},[]),S=b.useCallback(k=>{n(k)},[]),g=b.useCallback(k=>{n(_=>_.map(y=>k.get(y.id)||y))},[]),h=b.useCallback(k=>{const _=t.find(y=>y.id===k);_&&(o(y=>[...y,_]),n(y=>y.filter(R=>R.id!==k)))},[t]),x=b.useCallback(k=>{n(_=>_.map(y=>y.id===k?{...y,relationship:{...y.relationship||{},affection:0,trust:0,cutTies:!0}}:y))},[]);return{activeNpcs:t,deadNpcs:s,selectedNpc:i,selectedWorldNpc:l,visibleNpcs:u,setActiveNpcs:n,setDeadNpcs:o,setSelectedNpc:a,setSelectedWorldNpc:d,updateNpcRelationship:p,updateNpc:c,addNpc:m,removeNpc:v,toggleNpcFollow:w,batchUpdateNpcs:E,replaceAllNpcs:S,batchUpdateNpcsByMap:g,killNpc:h,cutTiesWithNpc:x}}function Lk(){const[e,t]=b.useState([]),[n,s]=b.useState([]),[o,i]=b.useState(null),a=b.useCallback(g=>g?{...g,influenceProfile:Ly(g)}:null,[]),l=b.useMemo(()=>e.map(a),[e,a]),d=b.useCallback(g=>{const h=((g==null?void 0:g.exiledChildren)||[]).map(x=>x.id);return l.filter(x=>!h.includes(x.id))},[l]),u=b.useCallback(g=>{i(typeof g=="function"?h=>a(g(h)):a(g))},[a]),p=b.useCallback((g,h)=>{t(x=>x.map(k=>k.id===g?{...k,...h}:k)),i(x=>!x||x.id!==g?x:a({...x,...h}))},[a]),c=b.useCallback(g=>{t(h=>[...h,g])},[]),m=b.useCallback(g=>{t(h=>{const x=h.find(k=>k.id===g);return x&&s(k=>[...k,x]),h.filter(k=>k.id!==g)})},[]),v=b.useCallback(g=>{t(h=>h.map(x=>x.id===g?{...x,isFavorite:!x.isFavorite}:x)),i(h=>{if(!h||h.id!==g)return h;const x={...h,isFavorite:!h.isFavorite};return a(x)})},[a]),w=b.useCallback(g=>{t(h=>h.map(g).filter(x=>x!==null))},[]),E=b.useCallback(g=>{t(g)},[]),S=b.useCallback((g,h)=>{t(x=>x.map(k=>g(k)?h(k):k))},[]);return{children:e,fallenChildren:n,selectedChild:o,enhancedChildren:l,setChildren:t,setFallenChildren:s,setSelectedChild:u,enhanceChild:a,visibleChildren:d,updateChild:p,addChild:c,removeChild:m,toggleChildFavorite:v,batchUpdateChildren:w,replaceAllChildren:E,batchUpdateChildrenIf:S}}const $k={},jl="./",Bk=-.04,Ok=0,Pk=e=>typeof e=="string"&&e.startsWith("#")?e:typeof e=="number"?jp[e]||jp[0]:"#2C2C2C",zk=e=>{const t=e.replace("#",""),n=parseInt(t.substring(0,2),16)/255,s=parseInt(t.substring(2,4),16)/255,o=parseInt(t.substring(4,6),16)/255,i=Math.max(n,s,o),a=Math.min(n,s,o);let l=0,d=0,u=(i+a)/2;if(i!==a){const p=i-a;switch(d=u>.5?p/(2-i-a):p/(i+a),i){case n:l=(s-o)/p+(s<o?6:0);break;case s:l=(o-n)/p+2;break;case o:l=(n-s)/p+4;break}l/=6}return d=Math.max(0,Math.min(1,d*.9)),u=Math.max(0,Math.min(1,u*1.05)),`hsl(${Math.round(l*360)} ${Math.round(d*100)}% ${Math.round(u*100)}%)`},Dk=e=>new Promise((t,n)=>{if(!e){n(new Error("Missing asset source"));return}const s=new Image;s.crossOrigin="anonymous",s.onload=()=>t(s),s.onerror=o=>n(o),s.src=e}),Fk=(e,t,n)=>{const s=Math.min(t/e.width,n/e.height);let o=e.width*s,i=e.height*s,a=(t-o)/2,l=(n-i)/2;return o=Math.round(o),i=Math.round(i),a=Math.round(a),l=Math.round(l),{offsetX:a,offsetY:l,drawWidth:o,drawHeight:i}},Hk=(e,t,n,s)=>{const o=e.canvas.width,i=e.canvas.height,a=document.createElement("canvas");a.width=o,a.height=i;const l=a.getContext("2d");l.imageSmoothingEnabled=!0,l.imageSmoothingQuality="high",l.drawImage(t,n.offsetX,n.offsetY,n.drawWidth,n.drawHeight);const d=document.createElement("canvas");d.width=o,d.height=i;const u=d.getContext("2d");u.imageSmoothingEnabled=!0,u.imageSmoothingQuality="high",u.fillStyle=zk(s),u.fillRect(n.offsetX,n.offsetY,n.drawWidth,n.drawHeight),u.globalCompositeOperation="destination-in",u.drawImage(a,0,0),e.drawImage(a,0,0),e.globalCompositeOperation="multiply",e.drawImage(d,0,0),e.globalCompositeOperation="source-over"},Gr=({dna:e,size:t=64,gender:n})=>{const s=b.useRef(null),o=e||{eye:0,mouth:0,hair:0,hairColor:0},i=o.hair??o.hairId??0,a=o.tZoneId??o.eye??0,l=o.mouth??o.mouthId??0,d=n||o.gender,u=d==="female"||d===""||d==="F",p=Pk(o.hairColor),c=typeof o.centerBiasX=="number"?o.centerBiasX:Bk*t,m=typeof o.centerBiasY=="number"?o.centerBiasY:Ok*t,v={width:t,height:t,borderRadius:"8px",border:"3px solid #3e2723",background:"#8d6e63",position:"relative",overflow:"hidden",boxSizing:"border-box"},w={width:"100%",height:"100%",display:"block"},E=(g,h)=>{if(g==="base")return`${jl}assets/male/base_face.png`;if(h==null||h<0)return null;const x=String((h||0)+1).padStart(2,"0");return`${jl}assets/male/${g}/${g}_${x}.png`},S=(g,h)=>{if(g==="base")return`${jl}assets/female/base_face.png`;if(h==null||h<0)return null;const x=String((h||0)+1).padStart(2,"0");return`${jl}assets/female/${g}/${g}${x}.png`};return b.useEffect(()=>{let g=!1;const h=s.current;if(!h)return()=>{g=!0};const x=h.getContext("2d");if(!x)return()=>{g=!0};const k=Math.round(t),_=typeof window<"u"&&window.devicePixelRatio?window.devicePixelRatio:1,y=Math.max(1,Math.round(k*_)),R=Math.round(c*_),C=Math.round(m*_);h.width=y,h.height=y,h.style.width=`${k}px`,h.style.height=`${k}px`,x.imageSmoothingEnabled=!0,x.imageSmoothingQuality="high",x.clearRect(0,0,h.width,h.height);const I=S("hair",i),T=E("hair",i),L=u?[{src:S("base")},{src:S("tzone",a)},{src:S("mouth",l)},I?{src:I,tint:p}:null].filter(Boolean):[{src:E("base")},{src:E("tzone",a)},{src:E("mouth",l)},T?{src:T,tint:p}:null].filter(Boolean);return(async()=>{for(const $ of L)try{const O=await Dk($.src);if(g)return;const H=Fk(O,h.width,h.height);H.offsetX+=R,H.offsetY+=C,$.tint?Hk(x,O,H,$.tint):x.drawImage(O,H.offsetX,H.offsetY,H.drawWidth,H.drawHeight)}catch(O){console.warn("Avatar asset failed to load:",$.src,O)}})(),()=>{g=!0}},[t,u,i,l,a,p,c,m]),r.jsx("div",{style:v,children:r.jsx("canvas",{ref:s,style:w})})},Wk=({player:e,isAuto:t,onBreakthrough:n,auctionBanner:s})=>{const[o,i]=b.useState(!1),a=Math.floor(e.currentExp||0),l=Math.max(1,Math.floor(e.maxExp||1)),d=a/l,u=Math.min(100,Math.round(d*100)),p=a>=l,c=(e==null?void 0:e.avatar)||{base:0,skinColor:0,hair:0,hairColor:0,eye:0,eyeColor:1,mouth:0};return r.jsxs("div",{style:Jt.container,children:[r.jsxs("div",{style:Jt.left,children:[r.jsx("div",{style:Jt.avatarColumn,children:r.jsx("div",{style:{...Jt.avatar,border:t?"2px solid #76ff03":"none",animation:t?"pulse 1.5s infinite":"none"},children:t?r.jsx("div",{style:{fontSize:"24px"},children:""}):r.jsx(Gr,{dna:c,gender:e.gender,size:44})})}),r.jsxs("div",{style:Jt.info,children:[r.jsx("div",{style:Jt.name,children:e.name}),r.jsx("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:r.jsxs("div",{style:Jt.tier,children:[e.tier,t&&r.jsx("span",{style:Jt.meditateStatus,children:" "})]})})]})]}),r.jsx("div",{style:Jt.expBarContainer,children:r.jsxs("div",{style:Jt.expBarWrapper,children:[r.jsx("div",{style:{...Jt.expBarFill,width:`${u}%`,background:p?"linear-gradient(90deg, #FFD700, #FFA500)":"linear-gradient(90deg, #4CAF50, #81C784)"}}),r.jsxs("div",{style:Jt.expText,children:[a,"/",l]})]})}),r.jsx("div",{style:{flex:1}}),r.jsx("div",{style:Jt.right,children:r.jsxs("div",{style:Jt.statusColumn,children:[r.jsx("div",{style:Jt.timeIcon,children:""}),r.jsxs("div",{style:Jt.timeValue,children:[" ",e.time.year," ",e.time.month,""]})]})}),s&&r.jsx("div",{style:Jt.auctionBanner,className:"auction-alert-chip",children:s.message})]})},Jt={container:{height:"calc(60px + env(safe-area-inset-top, 0px))",paddingTop:"env(safe-area-inset-top, 0px)",background:"linear-gradient(135deg, #3e2723 0%, #2c1810 100%)",color:"#fff",display:"flex",alignItems:"center",justifyContent:"space-between",padding:"0 10px",position:"relative",boxShadow:"0 4px 15px rgba(0,0,0,0.3)",borderRadius:"0 0 16px 16px",paddingBottom:"12px"},left:{display:"flex",alignItems:"center",gap:"12px"},avatarColumn:{display:"flex",flexDirection:"column",alignItems:"center",gap:"4px"},avatar:{width:"44px",height:"44px",borderRadius:"50%",background:"linear-gradient(135deg, #a1887f 0%, #8d6e63 100%)",display:"flex",alignItems:"center",justifyContent:"center",overflow:"hidden",imageRendering:"pixelated",boxShadow:"0 2px 8px rgba(0,0,0,0.2)"},info:{display:"flex",flexDirection:"column",justifyContent:"center"},name:{fontSize:"15px",fontWeight:"bold",textShadow:"1px 1px 2px rgba(0,0,0,0.3)"},tier:{fontSize:"12px",color:"#ffecb3",textShadow:"1px 1px 2px rgba(0,0,0,0.3)"},meditateStatus:{color:"#76ff03",marginLeft:"5px",fontSize:"10px"},right:{display:"flex",gap:"8px",alignItems:"center",flexShrink:0},timeIcon:{fontSize:"16px"},timeValue:{fontSize:"13px",fontWeight:"bold",color:"#fff"},expBarContainer:{flex:1,maxWidth:"300px",marginLeft:"20px",marginRight:"20px"},expBarWrapper:{position:"relative",height:"24px",backgroundColor:"rgba(0,0,0,0.3)",borderRadius:"12px",overflow:"hidden",border:"1px solid rgba(255,255,255,0.1)"},expBarFill:{position:"absolute",left:0,top:0,height:"100%",transition:"width 0.3s ease",borderRadius:"12px"},expText:{position:"absolute",left:"50%",top:"50%",transform:"translate(-50%, -50%)",fontSize:"11px",fontWeight:"bold",color:"#fff",textShadow:"1px 1px 2px rgba(0,0,0,0.5)",zIndex:1},statusColumn:{display:"flex",flexDirection:"column",alignItems:"center",gap:"2px",backgroundColor:"rgba(255,255,255,0.06)",padding:"4px 8px",borderRadius:"12px"},auctionBanner:{position:"absolute",left:"50%",bottom:"-14px",transform:"translateX(-50%)",background:"rgba(255, 255, 255, 0.16)",padding:"4px 16px",borderRadius:"20px",color:"#ff5252",fontWeight:"bold",fontSize:"12px",letterSpacing:"0.5px",boxShadow:"0 6px 18px rgba(0,0,0,0.35)",animation:"auctionFlash 0.8s ease-in-out 3"}},Uk=()=>{if(typeof document>"u"||document.getElementById("top-status-animations"))return;const e=document.createElement("style");e.id="top-status-animations",e.innerHTML=`
    @keyframes pulse {
      0% { transform: scale(1); box-shadow: 0 0 0 0 rgba(118, 255, 3, 0.4); }
      70% { transform: scale(1.05); box-shadow: 0 0 0 8px rgba(118, 255, 3, 0); }
      100% { transform: scale(1); box-shadow: 0 0 0 0 rgba(118, 255, 3, 0); }
    }
    @keyframes auctionFlash {
      0% { opacity: 0; transform: translate(-50%, 8px) scale(0.95); }
      30% { opacity: 1; transform: translate(-50%, 0) scale(1); }
      70% { opacity: 1; }
      100% { opacity: 0; transform: translate(-50%, -6px) scale(0.96); }
    }
  `,document.head.appendChild(e)};typeof window<"u"&&typeof document<"u"&&Uk();const Gk=({activeTab:e,onTabChange:t})=>{const n=[{id:"FAMILY",label:"",icon:""},{id:"NPC",label:"",icon:""},{id:"ACTION",label:"",icon:""},{id:"REVENGE",label:"",icon:""},{id:"PLAYER",label:"",icon:""},{id:"SYSTEM",label:"",icon:""},{id:"LOG",label:"",icon:""}];return r.jsx("div",{style:Cl.container,children:n.map(s=>r.jsxs("button",{onClick:()=>t(s.id),style:{...Cl.btn,backgroundColor:e===s.id?"rgba(255,193,7,0.2)":"transparent",fontWeight:e===s.id?"bold":"normal"},children:[r.jsx("div",{style:Cl.icon,children:s.icon}),r.jsx("div",{style:Cl.label,children:s.label})]},s.id))})},Cl={container:{height:Ie.sizes.navHeight,background:Ie.gradients.warm,borderTop:`2px solid ${Ie.colors.border}`,display:"flex",justifyContent:"space-around",alignItems:"center",position:"fixed",bottom:0,left:0,right:0,zIndex:100,boxShadow:`0 -6px 18px ${Ie.colors.shadow}`,borderRadius:"16px 16px 0 0"},btn:{background:"none",border:"none",display:"flex",flexDirection:"column",alignItems:"center",cursor:"pointer",padding:"6px 3px",borderRadius:"10px",transition:"all 0.2s ease"},icon:{fontSize:"16px",marginBottom:"2px",color:Ie.colors.ink},label:{fontSize:"10px",color:Ie.colors.muted,fontFamily:"Microsoft YaHei, SimSun, serif"}},Vk=e=>Math.max(0,Math.min(100,Number(e)||0)),Ng=({npc:e,onInteract:t,actions:n})=>{var l;const s=((l=e.relationship)==null?void 0:l.affection)??0,o=Vk(s),a=(()=>{const d=o;return d>=80?"#b03a3a":d>=40?Ie.colors.accent:Ie.colors.muted})();return r.jsxs("div",{style:Xt.card,children:[t&&r.jsx("button",{onClick:()=>t(e.id,"TOGGLE_FOLLOW"),style:{...Xt.followBtn,background:e.isFollowed?"#ffd54f":Xt.followBtn.background},title:e.isFollowed?"":"",children:e.isFollowed?"":""}),r.jsxs("div",{style:Xt.header,children:[r.jsx(Gr,{dna:e.avatar,gender:e.gender,size:60}),r.jsxs("div",{style:{flex:1},children:[r.jsxs("h3",{style:{margin:0},children:[e.name,r.jsx("span",{style:Xt.tag,children:e.identity})]}),r.jsx("small",{style:{color:Ie.colors.muted},children:e.cultivation}),e.sect&&e.sectStatus!=="mysterious"&&e.sectStatus!=="rogue"&&r.jsx("div",{style:{marginTop:"2px"},children:r.jsx("span",{style:{fontSize:"9px",padding:"2px 6px",borderRadius:"8px",color:"white",background:e.sectStatus==="defected"?"#a65a5a":e.sectStatus==="hidden"?Ie.colors.primary:e.sect.level==="TOP"?"#c9a84a":e.sect.level==="HIGH"?Ie.colors.accent:e.sect.level==="RECKLESS"?"#a65a5a":Ie.colors.muted,fontWeight:"bold"},children:e.sect.name})}),e.sectStatus==="mysterious"&&r.jsx("div",{style:{marginTop:"2px"},children:r.jsx("span",{style:{fontSize:"9px",padding:"2px 6px",borderRadius:"8px",color:"white",background:Ie.colors.muted,fontWeight:"bold"},children:""})}),e.sectStatus==="rogue"&&r.jsx("div",{style:{marginTop:"2px"},children:r.jsx("span",{style:{fontSize:"9px",padding:"2px 6px",borderRadius:"8px",color:"white",background:Ie.colors.primary,fontWeight:"bold"},children:""})})]})]}),r.jsxs("p",{style:Xt.desc,children:["",e.desc,""]}),r.jsxs("div",{style:Xt.statRow,children:[r.jsx("span",{children:":"}),r.jsx("div",{style:Xt.progressBar,children:r.jsx("div",{style:{...Xt.progressFill,width:`${o}%`,backgroundColor:a}})}),r.jsxs("span",{style:{color:a},children:[" ",o]})]}),n?r.jsx("div",{style:Xt.actions,children:n}):t?r.jsxs("div",{style:Xt.actions,children:[r.jsx("button",{onClick:()=>t(e.id,"DETAIL"),style:Xt.btn,children:" "}),r.jsx("button",{onClick:()=>t(e.id,"CHAT"),style:Xt.btn,children:" "}),r.jsx("button",{onClick:()=>t(e.id,"GIFT"),style:Xt.btn,children:" "}),r.jsx("button",{onClick:()=>t(e.id,"SPAR"),disabled:s<0,style:{...Xt.btn,opacity:s<0?.5:1,backgroundColor:Ie.colors.primary,color:"white"},title:"",children:" "}),!e.isChild&&r.jsx("button",{onClick:()=>t(e.id,"DUAL_CULTIVATION"),style:{...Xt.btn,opacity:s<80?.5:1,backgroundColor:Ie.colors.accent,color:"white"},title:"80+",children:" "}),!e.isChild&&r.jsx("button",{onClick:()=>t(e.id,"PROPOSE"),disabled:s<80,style:{...Xt.btn,opacity:s<80?.5:1,backgroundColor:Ie.colors.primary,color:"white",cursor:s<80?"not-allowed":"pointer"},title:"80+",children:" "})]}):null]})},Xt={card:{border:`1px solid ${Ie.colors.border}`,borderRadius:"8px",padding:"15px",backgroundColor:Ie.colors.paper,boxShadow:`0 2px 6px ${Ie.colors.shadow}`,marginBottom:"10px",position:"relative"},header:{display:"flex",gap:"10px",alignItems:"center",marginBottom:"10px"},tag:{fontSize:"12px",background:Ie.colors.parchment,padding:"2px 6px",borderRadius:"4px",color:Ie.colors.ink},desc:{fontStyle:"italic",color:Ie.colors.ink,fontSize:"14px",margin:"5px 0 15px 0"},statRow:{display:"flex",alignItems:"center",gap:"10px",marginBottom:"15px",fontSize:"14px"},progressBar:{flex:1,height:"10px",background:Ie.colors.parchment,borderRadius:"5px",overflow:"hidden"},progressFill:{height:"100%",transition:"width 0.3s ease"},actions:{display:"grid",gridTemplateColumns:"1fr 1fr 1fr",gap:"8px"},btn:{padding:"8px",border:`1px solid ${Ie.colors.border}`,borderRadius:"4px",background:Ie.colors.parchment,cursor:"pointer",fontSize:"12px",color:Ie.colors.ink},followBtn:{position:"absolute",top:8,right:8,padding:"6px 8px",borderRadius:"6px",border:`1px solid ${Ie.colors.border}`,background:Ie.colors.parchment,cursor:"pointer",fontSize:"13px",lineHeight:"1"}},Yk=[{id:"meet_normal_1",stage:0,text:"{name} ",options:[{label:"",result:"neutral",msg:"(+5)",change:{affection:5}},{label:"",result:"neutral",msg:"",change:{}}]},{id:"meet_normal_2",stage:0,text:"{name} ",options:[{label:"",check:e=>e.stats.intelligence>60,success:{msg:"(+8)",change:{affection:8}},fail:{msg:"(+2)",change:{affection:2}}},{label:"",result:"neutral",msg:"",change:{}}]},{id:"meet_normal_3",stage:0,text:"{name} ",options:[{label:"",check:e=>e.combatStats.atk>50,success:{msg:"(+10)",change:{affection:10}},fail:{msg:"(+3)",change:{affection:3}}},{label:"",result:"neutral",msg:"",change:{}}]},{id:"meet_normal_4",stage:0,text:"{name} ",options:[{label:"",result:"neutral",msg:"(+6)",change:{affection:6}},{label:"",result:"neutral",msg:"",change:{}}]},{id:"meet_normal_5",stage:0,text:"{name} ",options:[{label:"",result:"neutral",msg:"(+7)",change:{affection:7}},{label:"",result:"neutral",msg:"",change:{}}]},{id:"meet_normal_6",stage:0,text:"{name} ",options:[{label:"",result:"neutral",msg:"(+4)",change:{affection:4}},{label:"",result:"neutral",msg:"",change:{}}]},{id:"meet_cold_1",stage:0,reqTrait:"",text:"{name} ",options:[{label:"",result:"neutral",msg:"(+1)",change:{affection:1}},{label:"",result:"neutral",msg:"",change:{}}]},{id:"meet_cold_2",stage:0,reqTrait:"",text:"{name} ",options:[{label:"",check:e=>e.stats.luck>50,success:{msg:"(+5)",change:{affection:5}},fail:{msg:"",change:{}}},{label:"",result:"neutral",msg:"",change:{}}]},{id:"meet_cold_3",stage:0,reqTrait:"",text:"{name} ",options:[{label:"",result:"neutral",msg:"(+3)",change:{affection:3}},{label:"",result:"neutral",msg:"",change:{}}]},{id:"meet_cold_4",stage:0,reqTrait:"",text:"{name} ",options:[{label:"",result:"neutral",msg:"(+2)",change:{affection:2}},{label:"",result:"neutral",msg:"",change:{}}]},{id:"meet_cold_5",stage:0,reqTrait:"",text:"{name} ",options:[{label:"",check:e=>e.combatStats.atk>60,success:{msg:"(+7)",change:{affection:7}},fail:{msg:"(+1)",change:{affection:1}}},{label:"",result:"neutral",msg:"",change:{}}]},{id:"meet_cold_6",stage:0,reqTrait:"",text:"{name} ",options:[{label:"",check:e=>e.stats.intelligence>70,success:{msg:"(+8)",change:{affection:8}},fail:{msg:"(+0)",change:{affection:0}}},{label:"",result:"neutral",msg:"",change:{}}]},{id:"meet_gentle_1",stage:0,reqTrait:"",text:"{name} ",options:[{label:"",result:"neutral",msg:"(+7)",change:{affection:7}},{label:"",result:"neutral",msg:"(+3)",change:{affection:3}}]},{id:"meet_gentle_2",stage:0,reqTrait:"",text:"{name} ",options:[{label:"",result:"neutral",msg:"(+6)",change:{affection:6}},{label:"",result:"neutral",msg:"",change:{}}]},{id:"meet_gentle_3",stage:0,reqTrait:"",text:"{name} ",options:[{label:"",result:"neutral",msg:"(+9)",change:{affection:9}},{label:"",result:"neutral",msg:"(+2)",change:{affection:2}}]},{id:"meet_gentle_4",stage:0,reqTrait:"",text:"{name} ",options:[{label:"",result:"neutral",msg:"(+5)",change:{affection:5}},{label:"",result:"neutral",msg:"",change:{}}]},{id:"meet_gentle_5",stage:0,reqTrait:"",text:"{name} ",options:[{label:"",result:"neutral",msg:"(+8)",change:{affection:8}},{label:"",result:"neutral",msg:"",change:{}}]},{id:"meet_gentle_6",stage:0,reqTrait:"",text:"{name} ",options:[{label:"",result:"neutral",msg:"(+6)",change:{affection:6}},{label:"",result:"neutral",msg:"(+3)",change:{affection:3}}]},{id:"phase1_normal_1",stage:1,text:"{name} ",options:[{label:"",result:"good",msg:"(+10+5)",change:{affection:10,trust:5}},{label:"",result:"neutral",msg:"(+2)",change:{affection:2}}]},{id:"phase1_normal_2",stage:1,text:"{name} ",options:[{label:"",check:e=>e.stats.intelligence>65,success:{msg:"(+8+8)",change:{affection:8,trust:8}},fail:{msg:"(+4+3)",change:{affection:4,trust:3}}},{label:"",result:"neutral",msg:"(+1)",change:{affection:1}}]},{id:"phase1_normal_3",stage:1,text:"{name} ",options:[{label:"",result:"good",msg:"(+12+10)",change:{affection:12,trust:10}},{label:"",result:"neutral",msg:"(-1)",change:{affection:-1}}]},{id:"phase1_normal_4",stage:1,text:"{name} ",options:[{label:"",result:"good",msg:"(+7+4)",change:{affection:7,trust:4}},{label:"",result:"neutral",msg:"(+1)",change:{affection:1}}]},{id:"phase1_normal_5",stage:1,text:"{name} ",options:[{label:"",check:e=>e.combatStats.atk>70,success:{msg:"(+15+12)",change:{affection:15,trust:12}},fail:{msg:"(+8+6)",change:{affection:8,trust:6}}},{label:"",result:"bad",msg:"(-2)",change:{affection:-2}}]},{id:"phase1_normal_6",stage:1,text:"{name} ",options:[{label:"",result:"good",msg:"(+9+7)",change:{affection:9,trust:7}},{label:"",result:"neutral",msg:"(+0)",change:{affection:0}}]},{id:"phase1_tsundere_1",stage:1,reqTrait:"",text:'{name} ""',options:[{label:"",result:"good",msg:"(+10+5)",change:{affection:10,trust:5}},{label:"",result:"neutral",msg:"(+8)",change:{affection:8}}]},{id:"phase1_tsundere_2",stage:1,reqTrait:"",text:"{name} ",options:[{label:"",result:"good",msg:"(+9+4)",change:{affection:9,trust:4}},{label:"",result:"neutral",msg:"(+5)",change:{affection:5}}]},{id:"phase1_tsundere_3",stage:1,reqTrait:"",text:"{name} ",options:[{label:"",result:"good",msg:"(+12+6)",change:{affection:12,trust:6}},{label:"",result:"neutral",msg:"(+7)",change:{affection:7}}]},{id:"phase1_tsundere_4",stage:1,reqTrait:"",text:"{name} ",options:[{label:"",result:"good",msg:"(+11+8)",change:{affection:11,trust:8}},{label:"",result:"neutral",msg:"(+6)",change:{affection:6}}]},{id:"phase1_tsundere_5",stage:1,reqTrait:"",text:"{name} ",options:[{label:"",check:e=>e.combatStats.atk>75,success:{msg:"(+15+10)",change:{affection:15,trust:10}},fail:{msg:"(+8+5)",change:{affection:8,trust:5}}},{label:"",result:"bad",msg:"(-3)",change:{affection:-3}}]},{id:"phase1_tsundere_6",stage:1,reqTrait:"",text:"{name} ",options:[{label:"",result:"good",msg:"(+10+7)",change:{affection:10,trust:7}},{label:"",result:"neutral",msg:"(+9)",change:{affection:9}}]},{id:"phase1_greedy_1",stage:1,reqTrait:"",text:"{name} ",options:[{label:"",result:"good",msg:"(+12+3)",change:{affection:12,trust:3}},{label:"",result:"neutral",msg:"(+2)",change:{affection:2}}]},{id:"phase1_greedy_2",stage:1,reqTrait:"",text:"{name} ",options:[{label:"",check:e=>e.resources.spiritStones>500,success:{msg:"(+15+5)",change:{affection:15,trust:5}},fail:{msg:"(+1)",change:{affection:1}}},{label:"",result:"neutral",msg:"(+0)",change:{affection:0}}]},{id:"phase1_greedy_3",stage:1,reqTrait:"",text:"{name} ",options:[{label:"",check:e=>e.resources.spiritStones>300,success:{msg:"(+10+8)",change:{affection:10,trust:8}},fail:{msg:"(+1)",change:{affection:1}}},{label:"",result:"bad",msg:"(-2)",change:{affection:-2}}]},{id:"phase1_greedy_4",stage:1,reqTrait:"",text:"{name} ",options:[{label:"",result:"good",msg:"(+12+6)",change:{affection:12,trust:6}},{label:"",result:"neutral",msg:"(+5)",change:{affection:5}}]},{id:"phase1_greedy_5",stage:1,reqTrait:"",text:"{name} ",options:[{label:"",result:"good",msg:"(+15+4)",change:{affection:15,trust:4}},{label:"",result:"neutral",msg:"(+2)",change:{affection:2}}]},{id:"phase1_greedy_6",stage:1,reqTrait:"",text:"{name} ",options:[{label:"",result:"good",msg:"(+10+5)",change:{affection:10,trust:5}},{label:"",result:"neutral",msg:"(+0)",change:{affection:0}}]},{id:"phase2_normal_1",stage:2,text:"{name} ",options:[{label:"",result:"good",msg:"(+15+10)",change:{affection:15,trust:10}},{label:"",result:"neutral",msg:"(+8)",change:{affection:8}}]},{id:"phase2_normal_2",stage:2,text:"{name} ",options:[{label:"",result:"good",msg:"(+20+15)",change:{affection:20,trust:15}},{label:"",result:"neutral",msg:"(+10+5)",change:{affection:10,trust:5}}]},{id:"phase2_normal_3",stage:2,text:"{name} ",options:[{label:"",result:"good",msg:"(+25+20)",change:{affection:25,trust:20}},{label:"",result:"neutral",msg:"(+10)",change:{affection:10}}]},{id:"phase2_normal_4",stage:2,text:"{name} ",options:[{label:"",result:"good",msg:"(+30+25)",change:{affection:30,trust:25}},{label:"",result:"neutral",msg:"(+15+10)",change:{affection:15,trust:10}}]},{id:"phase2_normal_5",stage:2,text:"{name} ",options:[{label:"",result:"good",msg:"(+20+15)",change:{affection:20,trust:15}},{label:"",result:"neutral",msg:"(+5)",change:{affection:5}}]},{id:"phase2_normal_6",stage:2,text:"{name} ",options:[{label:"",result:"good",msg:"(+18+12)",change:{affection:18,trust:12}},{label:"",result:"bad",msg:"(-5)",change:{affection:-5}}]},{id:"phase2_yandere_1",stage:2,reqTrait:"",text:'{name} ""',options:[{label:"",result:"good",msg:"(+20+15)",change:{affection:20,trust:15}},{label:"",result:"bad",msg:"(-10-5)",change:{affection:-10,trust:-5}}]},{id:"phase2_yandere_2",stage:2,reqTrait:"",text:'{name} ""',options:[{label:"",result:"good",msg:"(+25+20)",change:{affection:25,trust:20}},{label:"",result:"neutral",msg:"(+10+5)",change:{affection:10,trust:5}}]},{id:"phase2_yandere_3",stage:2,reqTrait:"",text:'{name} ""',options:[{label:"",result:"good",msg:"(+15+10)",change:{affection:15,trust:10}},{label:"",result:"bad",msg:"(-15-10)",change:{affection:-15,trust:-10}}]},{id:"phase2_yandere_4",stage:2,reqTrait:"",text:'{name} ""',options:[{label:"",result:"good",msg:"(+30+25)",change:{affection:30,trust:25}},{label:"",result:"bad",msg:"(-5+10)",change:{affection:-5,trust:10}}]},{id:"phase2_yandere_5",stage:2,reqTrait:"",text:"{name} ",options:[{label:"",result:"good",msg:"(+35+30)",change:{affection:35,trust:30}},{label:"",result:"neutral",msg:"(+10+5)",change:{affection:10,trust:5}}]},{id:"phase2_yandere_6",stage:2,reqTrait:"",text:'{name} ""',options:[{label:"",result:"good",msg:"(+25+20)",change:{affection:25,trust:20}},{label:"",result:"neutral",msg:"(+15+10)",change:{affection:15,trust:10}}]},{id:"phase2_justice_1",stage:2,reqTrait:"",text:"{name} ",options:[{label:"",result:"good",msg:"(+25+20)",change:{affection:25,trust:20}},{label:"",result:"neutral",msg:"(+15+15)",change:{affection:15,trust:15}}]},{id:"phase2_justice_2",stage:2,reqTrait:"",text:"{name} ",options:[{label:"",result:"good",msg:"(+30+25)",change:{affection:30,trust:25}},{label:"",result:"neutral",msg:"(+10+5)",change:{affection:10,trust:5}}]},{id:"phase2_justice_3",stage:2,reqTrait:"",text:"{name} ",options:[{label:"",result:"good",msg:"(+20+18)",change:{affection:20,trust:18}},{label:"",result:"neutral",msg:"(+12+10)",change:{affection:12,trust:10}}]},{id:"phase2_justice_4",stage:2,reqTrait:"",text:"{name} ",options:[{label:"",result:"good",msg:"(+22+20)",change:{affection:22,trust:20}},{label:"",result:"neutral",msg:"(+15+15)",change:{affection:15,trust:15}}]},{id:"phase2_justice_5",stage:2,reqTrait:"",text:"{name} ",options:[{label:"",result:"good",msg:"(+28+25)",change:{affection:28,trust:25}},{label:"",result:"neutral",msg:"(+10+8)",change:{affection:10,trust:8}}]},{id:"phase2_justice_6",stage:2,reqTrait:"",text:"{name} ",options:[{label:"",result:"good",msg:"(+30+30)",change:{affection:30,trust:30}},{label:"",result:"neutral",msg:"(+15+12)",change:{affection:15,trust:12}}]}],qk=(e,t)=>{const n=Yk.filter(o=>{var l;let i=0;const a=((l=e.relationship)==null?void 0:l.affection)||0;return a>=20&&(i=1),a>=60&&(i=2),!(o.stage!==i||o.reqTrait&&!(typeof e.personality=="object"&&e.personality!==null&&"label"in e.personality?[e.personality.label]:Array.isArray(e.personality)?e.personality:[]).includes(o.reqTrait)||o.condition&&!o.condition(e))});if(n.length===0)return null;const s=n[Math.floor(Math.random()*n.length)];return{...s,text:s.text.replace(/{name}/g,e.name)}},Kk={GRAY:{color:"#9e9e9e",bg:"#eeeeee",border:"#bdbdbd",label:""},WHITE:{color:"#616161",bg:"#f5f5f5",border:"#e0e0e0",label:""},GREEN:{color:"#2e7d32",bg:"#e8f5e9",border:"#a5d6a7",label:""},BLUE:{color:"#1565c0",bg:"#e3f2fd",border:"#90caf9",label:""},PURPLE:{color:"#7b1fa2",bg:"#f3e5f5",border:"#ce93d8",label:""},ORANGE:{color:"#ef6c00",bg:"#fff3e0",border:"#ffcc80",label:""},RED:{color:"#c62828",bg:"#ffebee",border:"#ef9a9a",label:"",shadow:"0 0 5px rgba(198, 40, 40, 0.5)"}},Qk=[{min:0,max:20,text:"",rarity:"GRAY"},{min:21,max:40,text:"",rarity:"WHITE"},{min:41,max:60,text:"",rarity:"GREEN"},{min:61,max:79,text:"",rarity:"BLUE"},{min:80,max:89,text:"",rarity:"PURPLE"},{min:90,max:99,text:"",rarity:"ORANGE"},{min:100,max:999,text:"",rarity:"RED"}],Jk=[{min:0,max:20,text:"",rarity:"GRAY"},{min:21,max:40,text:"",rarity:"WHITE"},{min:41,max:60,text:"",rarity:"GREEN"},{min:61,max:79,text:"",rarity:"BLUE"},{min:80,max:89,text:"",rarity:"PURPLE"},{min:90,max:99,text:"",rarity:"ORANGE"},{min:100,max:999,text:"",rarity:"RED"}],Ic=(e,t,n="")=>{let s=t==="INT"?Jk:Qk,o=s.find(a=>e>=a.min&&e<=a.max)||s[0],i=o.text;return t==="LOOKS"&&n===""&&(i===""&&(i=""),i===""&&(i="")),{text:i,rarity:o.rarity,value:e,style:Kk[o.rarity]}},_c=({trait:e,showValue:t=!1})=>{const{style:n,text:s,value:o}=e;return r.jsxs("div",{style:{display:"inline-flex",alignItems:"center",padding:"2px 8px",borderRadius:"12px",backgroundColor:n.bg,border:`1px solid ${n.border}`,color:n.color,fontSize:"12px",fontWeight:"bold",boxShadow:n.shadow||"none",marginRight:"5px"},children:[r.jsx("span",{children:s}),t&&r.jsx("span",{style:{marginLeft:"5px",fontSize:"10px",opacity:.7,borderLeft:`1px solid ${n.color}`,paddingLeft:"5px"},children:o})]})},Xk=e=>{if(!e)return e;try{const t=new URL(e),n=t.pathname.replace(/\/+$|^\/+/g,"");return!n||n==="v1"?(t.pathname="/v1/chat/completions",t.toString()):n.includes("v1/chat")||n.includes("v1/completions")?t.toString():e}catch{return e}},Wf=async(e,t,n,s={})=>{var d;if(!t)throw new Error(" API Key");if(!n)throw new Error(" API URL");const{model:o="deepseek-chat",temperature:i=.85,maxTokens:a=200}=s,l=Xk(n);l!==n&&console.info(`[AI]  API URL : ${l}`);try{const u=await fetch(l,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${t}`},body:JSON.stringify({model:o,messages:e,temperature:i,max_tokens:a,stream:!1})});if(!u.ok){const c=await u.text().catch(()=>"");let m={};try{m=c?JSON.parse(c):{}}catch{m={raw:c}}const v=((d=m.error)==null?void 0:d.message)||m.message||m.raw||u.statusText;throw u.status===401?new Error("API  (401):  API Key Key"):u.status===404?new Error(`API  (404): Invalid URL (POST ${l}) API URL  https://api.gemai.cc/v1/chat/completions`):u.status===503?new Error(`API  (503): ${v||""}`):new Error(`API  (${u.status}): ${v}`)}const p=await u.json().catch(()=>null);if(!p||!p.choices||!p.choices[0]||!p.choices[0].message)throw new Error("API ");return p.choices[0].message.content}catch(u){throw console.error("AI :",u),u.message&&u.message.includes("Failed to fetch")?new Error(" API URL  CORS "):u}},Zk=async(e,t)=>{try{return await Wf([{role:"system",content:""},{role:"user",content:""}],e,t,{maxTokens:10}),!0}catch(n){return console.error("API :",n),!1}},Qs={UNFORGETTABLE:"",PROFOUND:"",SIGNIFICANT:""},jn=e=>{var t;return e.memories||(e.memories={profile:{name:e.name,personality:((t=e.personality)==null?void 0:t.label)||"",identity:e.identity||"",firstMeet:new Date().toISOString()},milestones:[],recentEvents:[],longTermSummary:"",meta:{totalEvents:0,lastSummaryTime:null,needsSummary:!1}}),e},Vo=(e,t)=>{jn(e);const n={id:Date.now(),event:t.event,time:t.time||tj(),detail:t.detail,emotionalImpact:t.emotionalImpact||Qs.SIGNIFICANT,category:t.category||"other",tags:t.tags||[],createdAt:new Date().toISOString()};return e.memories.milestones.push(n),console.log(`[] ${e.name} : ${t.event}`),n},wo=(e,t)=>{jn(e);const n={id:Date.now(),description:t.description,time:new Date().toISOString(),affectionChange:t.affectionChange||0,context:t.context||""};return e.memories.recentEvents.push(n),e.memories.meta.totalEvents++,e.memories.recentEvents.length>20&&e.memories.recentEvents.shift(),e.memories.meta.totalEvents%50===0&&(e.memories.meta.needsSummary=!0),n},Ky=(e,t={})=>{const{includeMilestones:n=!0,includeRecent:s=!0,maxRecent:o=5,contextKeywords:i=[]}=t;jn(e);let a="";if(n&&e.memories.milestones.length>0&&(a+=`


`,[...e.memories.milestones].sort((d,u)=>{const p={:4,:3,:2,:1};return(p[u.emotionalImpact]||0)-(p[d.emotionalImpact]||0)}).forEach((d,u)=>{a+=`${u+1}. **${d.event}**${d.time}
   ${d.detail}
   ${d.emotionalImpact}
`})),s&&e.memories.recentEvents.length>0&&(a+=`

`,e.memories.recentEvents.slice(-o).forEach(d=>{const u=rj(d.time);a+=`- ${u}: ${d.description}`,d.affectionChange!==0&&(a+=` (${d.affectionChange>0?"+":""}${d.affectionChange})`),a+=`
`})),i.length>0){const l=e.memories.milestones.filter(d=>i.some(u=>d.event.includes(u)||d.detail.includes(u)||d.tags.includes(u)));l.length>0&&(a+=`

`,l.forEach(d=>{a+=`${d.time}${d.event}...${d.detail}
`}))}return e.memories.longTermSummary&&(a+=`

${e.memories.longTermSummary}
`),a},ej=e=>{const t={family:["","","","","","","","","","",""],relationship:["","","","","","","",""],cultivation:["","","","","","",""],combat:["","","","","","",""],emotion:["","","","","","","",""]},n=[];for(const[s,o]of Object.entries(t))o.some(i=>e.includes(i))&&n.push(...o.filter(i=>e.includes(i)));return[...new Set(n)]},tj=()=>`5${["","","",""][Math.floor(Math.random()*4)]}`,nj=e=>new Date(e).toLocaleDateString("zh-CN",{year:"numeric",month:"long",day:"numeric"}),rj=e=>{const t=new Date,n=new Date(e),s=t-n,o=Math.floor(s/6e4),i=Math.floor(s/36e5),a=Math.floor(s/864e5);return o<1?"":o<60?`${o}`:i<24?`${i}`:a<7?`${a}`:nj(e)},Lg=(e,t,n={})=>{const{difficulty:s="",sacrifice:o=!1}=n;let i=`${t.name}`;return s===""?(i+="",o&&(i+="")):i+="",i+=`${o?"":""}`,Vo(e,{event:"",detail:i,emotionalImpact:Qs.UNFORGETTABLE,category:"family",tags:["","",t.name,o?"":""]})},sj=(e,t="")=>Vo(e,{event:"",detail:`${t}`,emotionalImpact:Qs.UNFORGETTABLE,category:"relationship",tags:["","","",""]}),oj=(e,t)=>Vo(e,{event:"",detail:t,emotionalImpact:Qs.UNFORGETTABLE,category:"combat",tags:["","",""]}),$g=(e,t,n={},s="")=>{var h,x,k,_,y,R,C;const o=((h=e.relationship)==null?void 0:h.affection)||0;let i="";o>=80?i="":o>=60?i="":o>=40?i="":o>=20&&(i="");const a=((x=e.relationship)==null?void 0:x.jealousy)||e.jealousy||0;let l="",d="";a>=81?(l="",d=""):a>=61?(l="",d=""):a>=41?(l="",d=""):a>=21&&(l="",d="");const u=((k=e.personality)==null?void 0:k.label)||"",p=((_=e.personality)==null?void 0:_.desc)||e.desc||"",c=e.identity||"",m=e.tierTitle||"";let v="";(((y=n.npcs)==null?void 0:y.some(I=>{var T;return I.id===e.id&&((T=I.relationship)==null?void 0:T.stage)>=3}))||o>=90)&&(v+=`
`);const E=((R=n.children)==null?void 0:R.filter(I=>I.parentId===e.id||I.fatherId===e.id||I.motherId===e.id||I.fatherName===e.name||I.motherName===e.name))||[];if(E.length>0){const I=E.map(L=>`${L.name}${L.age}${L.tierTitle||""}`).join("");e.gender===""?v+=`
${E.length}${I}
${e.name}`:v+=`
${E.length}${I}
${t.name}`;const T=E.map(L=>{let ee=`${L.name}`;return L.sect&&(ee+=`${L.sect.name}`),L.spouse&&(ee+=`${L.spouse.name}`),L.trait&&(ee+=`${L.trait.name}`),ee}).join("");T&&(v+=`
${T}`)}const S=((C=e.relationship)==null?void 0:C.stage)||1;if(S>=2&&S<3&&(v+=`
`),e.isPregnant){const I=e.pregnancyProgress||0;v+=`
${I}`}if(n.eventHistory&&n.eventHistory.length>0){const I=n.eventHistory.filter(T=>T.npcId===e.id).slice(-3).map(T=>T.description).join("");I&&(v+=`


${I}`)}let g="";if(e.memories){const I=s?ej(s):[];g=Ky(e,{includeMilestones:!0,includeRecent:!0,maxRecent:5,contextKeywords:I}),I.some(T=>["","","",""].includes(T))&&(g+=`

 `),I.some(T=>["","","",""].includes(T))&&(g+=`

 `),I.some(T=>["",""].includes(T))&&(g+=`

 `)}return`
  

  /

  
  ${e.name}
  ${c}
  ${e.gender||""}
  ${m}
  ${e.age||""}
  ${u}${p}

  
  ${t.name}
  ${t.gender||""}
  ${t.tierTitle||""}
  ${i}${o}/100
  ${a>0?`${l}${a}/100- ${d}`:""}
  ${v?`
`+v:""}
  ${g?`
`+g:""}

  
  1. "${u}"
    - 
    - 
    - 
    - 
    - 

  2. /
    - 
    - 
    - 

  3. 
    - 30-50
    - 80
    - 

  4. 
    - <30
    - 30-60
    - 60-80
    - >80
    ${E.length>0?"- ":""}
    ${a>=21?`
    ${l}${d.replace("","").replace("","").replace("","")}`:""}

  5. 
    - 
    - "AI"""
    - 
    - 

  
  ${E.length>0?"":""}`},ij=({npc:e,player:t,apiKey:n,apiUrl:s,gameState:o={}})=>{const[i,a]=b.useState([]),[l,d]=b.useState(""),[u,p]=b.useState(!1),[c,m]=b.useState(null),v=b.useRef(null),[w,E]=b.useState(typeof window<"u"?window.innerHeight:600);b.useEffect(()=>{const k={role:"system",content:$g(e,t,o)},_=lj(e.id);_&&_.length>0?a([k,..._.filter(y=>y.role!=="system")]):a([k])},[e.id,e,t,o]),b.useEffect(()=>{v.current&&(v.current.scrollTop=v.current.scrollHeight)},[i]),b.useEffect(()=>{const k=()=>{typeof window<"u"&&window.innerHeight&&E(window.innerHeight)};return k(),window.addEventListener("resize",k),window.addEventListener("orientationchange",k),()=>{window.removeEventListener("resize",k),window.removeEventListener("orientationchange",k)}},[]),b.useEffect(()=>{i.length>1&&aj(e.id,i.filter(k=>k.role!=="system"))},[i,e.id]);const S=async()=>{if(!l.trim()||u)return;const k={role:"user",content:l.trim()},_=l.trim(),y={role:"system",content:$g(e,t,o,_)},R=i.filter(I=>I.role!=="system"),C=[y,...R,k];a(C),d(""),p(!0),m(null);try{const T={role:"assistant",content:await Wf(C,n,s)};a(L=>[...L,T])}catch(I){m(I.message);const T={role:"system",content:`${I.message}`};a(L=>[...L,T])}finally{p(!1)}},g=()=>{const k=i[0];a([k]),cj(e.id)},h=w?Math.max(360,w-120):null,x={...En.container,height:"100%",minHeight:"320px",maxHeight:h?`${h}px`:"100%"};return r.jsxs("div",{style:x,children:[r.jsxs("div",{style:En.toolbar,children:[r.jsxs("div",{style:En.npcName,children:[" ",e.name," "]}),r.jsx("button",{onClick:g,style:En.clearBtn,title:"",children:""})]}),r.jsxs("div",{style:En.chatBox,ref:v,children:[i.filter(k=>k.role!=="system").map((k,_)=>{const y=k.role==="user";return k.role==="system"?r.jsx("div",{style:En.systemMsg,children:k.content},_):r.jsxs("div",{style:{...En.bubbleRow,justifyContent:y?"flex-end":"flex-start"},children:[!y&&r.jsx("div",{style:En.avatar,title:e.name,children:e.name[0]}),r.jsx("div",{style:{...En.bubble,background:y?"linear-gradient(135deg, #d4af37 0%, #c5a028 100%)":"#fff",color:y?"#fff":"#333",border:y?"none":"2px solid #d4af37",boxShadow:y?"0 2px 8px rgba(212, 175, 55, 0.3)":"0 2px 8px rgba(0, 0, 0, 0.1)"},children:k.content}),y&&r.jsx("div",{style:{...En.avatar,background:"#4e6a5d"},title:"",children:t.name[0]})]},_)}),u&&r.jsx("div",{style:En.loading,children:r.jsx("span",{className:"loading-dots",children:""})})]}),r.jsxs("div",{style:En.inputArea,children:[r.jsx("input",{style:En.input,value:l,onChange:k=>d(k.target.value),onKeyDown:k=>{k.key==="Enter"&&!k.shiftKey&&(k.preventDefault(),S())},placeholder:" Enter ...",disabled:u}),r.jsx("button",{onClick:S,style:{...En.sendBtn,opacity:u||!l.trim()?.5:1,cursor:u||!l.trim()?"not-allowed":"pointer"},disabled:u||!l.trim(),children:u?"...":""})]})]})},Rc="npc_chat_history_",fu=50,aj=(e,t)=>{try{const n=t.slice(-fu);localStorage.setItem(`${Rc}${e}`,JSON.stringify(n)),t.length>fu&&console.log(`${t.length} -> ${fu} `)}catch(n){if(console.error(":",n),n.name==="QuotaExceededError"){console.warn("...");try{const s=t.slice(-20);localStorage.setItem(`${Rc}${e}`,JSON.stringify(s))}catch(s){console.error(":",s)}}}},lj=e=>{try{const t=localStorage.getItem(`${Rc}${e}`);return t?JSON.parse(t):[]}catch(t){return console.error(":",t),[]}},cj=e=>{try{localStorage.removeItem(`${Rc}${e}`)}catch(t){console.error(":",t)}},En={container:{display:"flex",flexDirection:"column",background:"rgba(255, 250, 240, 0.95)",borderRadius:"12px",border:"2px solid #d4af37",overflow:"hidden",boxShadow:"0 4px 12px rgba(0, 0, 0, 0.15)",position:"relative"},toolbar:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"12px 16px",background:"linear-gradient(135deg, #4e6a5d 0%, #3d5549 100%)",borderBottom:"2px solid #d4af37"},npcName:{fontSize:"16px",fontWeight:"bold",color:"#d4af37",textShadow:"0 1px 2px rgba(0, 0, 0, 0.3)"},clearBtn:{padding:"6px 12px",background:"rgba(255, 255, 255, 0.1)",border:"1px solid rgba(255, 255, 255, 0.3)",borderRadius:"6px",color:"#fff",fontSize:"12px",cursor:"pointer",transition:"all 0.2s"},chatBox:{flex:1,overflowY:"auto",padding:"20px",paddingBottom:"28px",display:"flex",flexDirection:"column",gap:"16px",background:`url("data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none' fill-rule='evenodd'%3E%3Cg fill='%23d4af37' fill-opacity='0.05'%3E%3Cpath d='M36 34v-4h-2v4h-4v2h4v4h2v-4h4v-2h-4zm0-30V0h-2v4h-4v2h4v4h2V6h4V4h-4zM6 34v-4H4v4H0v2h4v4h2v-4h4v-2H6zM6 4V0H4v4H0v2h4v4h2V6h4V4H6z'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E")`},bubbleRow:{display:"flex",gap:"10px",alignItems:"flex-start",animation:"fadeIn 0.3s ease-in"},avatar:{minWidth:"36px",width:"36px",height:"36px",borderRadius:"50%",background:"linear-gradient(135deg, #d4af37 0%, #c5a028 100%)",color:"#fff",display:"flex",alignItems:"center",justifyContent:"center",fontSize:"14px",fontWeight:"bold",boxShadow:"0 2px 6px rgba(0, 0, 0, 0.2)",border:"2px solid rgba(255, 255, 255, 0.5)"},bubble:{maxWidth:"70%",padding:"12px 16px",borderRadius:"16px",fontSize:"14px",lineHeight:"1.6",wordWrap:"break-word",whiteSpace:"pre-wrap"},systemMsg:{textAlign:"center",fontSize:"12px",color:"#999",padding:"8px 16px",background:"rgba(0, 0, 0, 0.05)",borderRadius:"8px",fontStyle:"italic"},loading:{fontSize:"13px",color:"#666",textAlign:"center",padding:"12px",fontStyle:"italic"},inputArea:{padding:"16px",paddingBottom:"calc(16px + env(safe-area-inset-bottom, 0px))",borderTop:"2px solid #d4af37",display:"flex",gap:"12px",background:"linear-gradient(180deg, rgba(255, 250, 240, 0.95) 0%, rgba(245, 240, 230, 0.95) 100%)",flexShrink:0},input:{flex:1,padding:"12px 16px",borderRadius:"24px",border:"2px solid #d4af37",outline:"none",fontSize:"14px",background:"#fff",transition:"all 0.2s"},sendBtn:{padding:"10px 24px",borderRadius:"24px",background:"linear-gradient(135deg, #4e6a5d 0%, #3d5549 100%)",color:"#fff",border:"none",fontWeight:"bold",fontSize:"14px",transition:"all 0.2s",boxShadow:"0 2px 6px rgba(0, 0, 0, 0.2)"}},dj=({npc:e,onClose:t,onOptionSelect:n,player:s,children:o=[],npcs:i=[],onViewLog:a,onCutTies:l,onToggleLetterAcceptance:d})=>{var S,g,h,x,k;const[u,p]=b.useState(null),[c,m]=b.useState("INFO"),v=e.acceptsLetters!==!1;b.useEffect(()=>{const _=y=>{y.key==="Escape"&&t&&t()};return window.addEventListener("keydown",_),()=>window.removeEventListener("keydown",_)},[t]);const w={children:o,npcs:i},E=({label:_,value:y,max:R=100,color:C})=>{const I=Number(R)||100,T=Number(y)||0,L=Math.max(0,Math.min(I,T)),ee=I===0?0:Math.min(100,Math.round(L/I*100));return r.jsxs("div",{style:{display:"flex",alignItems:"center",marginBottom:"5px",fontSize:"12px"},children:[r.jsx("span",{style:{width:"30px",color:"#666"},children:_}),r.jsx("div",{style:{flex:1,height:"6px",background:"#eee",borderRadius:"3px",margin:"0 8px"},children:r.jsx("div",{style:{width:`${ee}%`,background:C,height:"100%",borderRadius:"3px"}})}),r.jsx("span",{style:{width:"25px",textAlign:"right",fontWeight:"bold"},children:Math.floor(L)})]})};return r.jsx("div",{style:ft.overlay,children:r.jsxs("div",{style:ft.modalWrapper,children:[r.jsx("button",{onClick:t,style:ft.closeBtn,"aria-label":"",children:""}),r.jsxs("div",{style:ft.modal,children:[r.jsxs("div",{style:ft.tabBar,children:[r.jsx("button",{onClick:()=>m("INFO"),style:{...ft.tab,background:c==="INFO"?"linear-gradient(135deg, #4e6a5d 0%, #3d5549 100%)":"#f5f5f5",color:c==="INFO"?"#fff":"#333",fontWeight:c==="INFO"?"bold":"normal"},children:" "}),r.jsx("button",{onClick:()=>m("CHAT"),style:{...ft.tab,background:c==="CHAT"?"linear-gradient(135deg, #4e6a5d 0%, #3d5549 100%)":"#f5f5f5",color:c==="CHAT"?"#fff":"#333",fontWeight:c==="CHAT"?"bold":"normal"},children:" "})]}),r.jsx("div",{style:ft.content,children:c==="INFO"?r.jsxs("div",{style:ft.leftCol,children:[r.jsx("div",{style:{marginBottom:"15px"},children:r.jsx(Gr,{dna:e.avatar,gender:e.gender,size:120})}),r.jsxs("div",{style:ft.nameBlock,children:[r.jsx("h2",{style:{margin:"10px 0 5px"},children:e.name}),r.jsx("span",{style:ft.identityTag,children:e.identity}),e.constitution&&r.jsx("span",{style:ft.rareTag,children:e.constitution.name}),e.sect&&e.sectStatus!=="mysterious"&&e.sectStatus!=="rogue"&&r.jsx("div",{style:{marginTop:"8px",display:"flex",flexDirection:"column",gap:"4px"},children:r.jsxs("span",{style:{...ft.identityTag,background:e.sectStatus==="defected"?"linear-gradient(135deg, #e53935 0%, #c62828 100%)":e.sectStatus==="hidden"?"linear-gradient(135deg, #9c27b0 0%, #7b1fa2 100%)":e.sect.level==="TOP"?"linear-gradient(135deg, #ffd700 0%, #ffb300 100%)":e.sect.level==="HIGH"?"linear-gradient(135deg, #00bcd4 0%, #0097a7 100%)":e.sect.level==="RECKLESS"?"linear-gradient(135deg, #d32f2f 0%, #b71c1c 100%)":"linear-gradient(135deg, #66bb6a 0%, #43a047 100%)",fontSize:"11px"},children:[e.sectStatus==="defected"?" ":e.sectStatus==="hidden"?" ":"","",e.sect.name,"",e.sectRank]})}),e.sectStatus==="mysterious"&&r.jsx("span",{style:{...ft.identityTag,background:"linear-gradient(135deg, #616161 0%, #424242 100%)",fontSize:"11px"},children:" "}),e.sectStatus==="rogue"&&r.jsx("span",{style:{...ft.identityTag,background:"linear-gradient(135deg, #8d6e63 0%, #6d4c41 100%)",fontSize:"11px"},children:" "})]}),r.jsxs("p",{style:ft.desc,children:['"',e.desc||e.appearance||"",'"']}),r.jsxs("div",{style:ft.attrBox,children:[r.jsx("h4",{children:" "}),r.jsxs("div",{style:{marginBottom:"8px",display:"flex",alignItems:"center"},children:[r.jsx("span",{style:{fontSize:"12px",width:"40px"},children:":"}),r.jsx(_c,{trait:Ic(e.stats.looks,"LOOKS","")})]}),r.jsxs("div",{style:{marginBottom:"8px",display:"flex",alignItems:"center"},children:[r.jsx("span",{style:{fontSize:"12px",width:"40px"},children:":"}),r.jsx(_c,{trait:Ic(e.stats.intelligence,"INT")})]}),e.spiritRoot&&r.jsxs("div",{style:{marginBottom:"8px"},children:[r.jsxs("div",{style:{display:"flex",alignItems:"center",marginBottom:"4px"},children:[r.jsx("span",{style:{fontSize:"12px",width:"40px"},children:":"}),r.jsx("span",{style:{fontSize:"12px",fontWeight:"bold",color:e.spiritRoot.color||"#d81b60"},children:e.spiritRoot.type})]}),e.spiritRoot.elements&&r.jsx("div",{style:{display:"flex",alignItems:"center",marginLeft:"40px"},children:r.jsx("div",{style:{display:"flex",gap:"4px"},children:e.spiritRoot.elements.map(_=>{const y=R=>({:"#FFD700",:"#4CAF50",:"#2196F3",:"#F44336",:"#795548",:"#673AB7",:"#00BCD4",:"#009688"})[R]||"#ccc";return r.jsx("span",{style:{padding:"2px 6px",borderRadius:"10px",color:"white",fontWeight:"bold",fontSize:"10px",background:y(_)},children:_},_)})})}),r.jsx("div",{style:{display:"flex",alignItems:"center",marginLeft:"40px",marginTop:"4px"},children:r.jsxs("span",{style:{fontSize:"11px",color:"#666"},children:[": ",(S=e.stats)==null?void 0:S.aptitude," (",((g=e.stats)==null?void 0:g.aptitude)>=80?"":"",")"]})}),e.spiritRoot.desc&&r.jsx("div",{style:{marginLeft:"40px",marginTop:"2px"},children:r.jsx("span",{style:{fontSize:"11px",color:"#666"},children:e.spiritRoot.desc})})]})]}),r.jsxs("div",{style:ft.attrBox,children:[r.jsx("h4",{children:" "}),r.jsx(E,{label:"",value:((h=e.relationship)==null?void 0:h.affection)||0,max:100,color:"#f50057"}),r.jsx(E,{label:"",value:((x=e.relationship)==null?void 0:x.trust)||0,max:100,color:"#00e5ff"}),(()=>{var C;const _=((C=e.relationship)==null?void 0:C.affection)||0,y=Yy(_),R=ck(y);return r.jsxs("div",{style:{marginTop:"8px",display:"flex",alignItems:"center",gap:"8px"},children:[r.jsx("span",{style:{fontSize:"12px",color:"#666"},children:":"}),r.jsxs("span",{style:{padding:"4px 12px",borderRadius:"12px",fontSize:"12px",fontWeight:"bold",color:"white",backgroundColor:R.color},children:[R.icon," ",R.text]})]})})(),(()=>{var C;const _=((C=e.relationship)==null?void 0:C.jealousy)??e.jealousy??0,y=I=>I>=81?"#d32f2f":I>=61?"#f44336":I>=41?"#ff9800":I>=21?"#ffc107":"#4caf50",R=I=>I>=81?"":I>=61?"":I>=41?"":I>=21?"":"";return r.jsxs("div",{style:{marginTop:"8px"},children:[r.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",marginBottom:"4px"},children:[r.jsx("span",{style:{fontSize:"12px",color:"#666"},children:":"}),r.jsxs("span",{style:{fontSize:"11px",fontWeight:"bold",color:y(_)},children:[R(_)," (",_,")"]})]}),r.jsx("div",{style:{width:"100%",height:"8px",background:"#e0e0e0",borderRadius:"4px",overflow:"hidden"},children:r.jsx("div",{style:{width:`${_}%`,height:"100%",background:`linear-gradient(90deg, ${y(_)}, ${y(_)}dd)`,borderRadius:"4px",transition:"width 0.3s ease, background 0.3s ease"}})})]})})(),r.jsxs("div",{style:ft.letterToggleRow,children:[r.jsxs("div",{children:[r.jsx("span",{style:{fontSize:"12px",color:"#666"},children:""}),r.jsx("span",{style:{fontSize:"12px",fontWeight:"bold",color:v?"#2e7d32":"#b71c1c"},children:v?"":""})]}),r.jsx("button",{type:"button",style:{...ft.letterToggleBtn,background:v?"linear-gradient(135deg, #4caf50 0%, #2e7d32 100%)":"linear-gradient(135deg, #b0bec5 0%, #90a4ae 100%)"},onClick:()=>d&&d(e.id,!v),children:v?"":""})]}),r.jsx("p",{style:ft.letterToggleHint,children:v?"Ta":"Ta"})]}),r.jsxs("div",{style:ft.attrBox,children:[r.jsx("h4",{children:" "}),r.jsxs("div",{style:{fontSize:"12px",color:"#666",lineHeight:"1.6"},children:[r.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:"4px"},children:[r.jsx("span",{children:":"}),r.jsxs("span",{style:{fontWeight:"bold"},children:[Math.floor(e.age||18)," "]})]}),r.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:"4px"},children:[r.jsx("span",{children:":"}),r.jsxs("span",{style:{fontWeight:"bold"},children:[((k=e.stats)==null?void 0:k.lifespan)||100," "]})]}),r.jsxs("div",{style:{display:"flex",justifyContent:"space-between"},children:[r.jsx("span",{children:":"}),r.jsxs("span",{style:{fontWeight:"bold",color:(()=>{const _=zr(e);return _<10?"#f44336":_<30?"#ff9800":"#4caf50"})()},children:[zr(e)," "]})]}),zr(e)<10&&r.jsx("div",{style:{marginTop:"8px",padding:"8px",background:"rgba(244, 67, 54, 0.1)",borderRadius:"4px",color:"#f44336",fontSize:"11px"},children:" "})]})]}),e.tier&&r.jsxs("div",{style:ft.attrBox,children:[r.jsx("h4",{children:" "}),r.jsxs("div",{style:{fontSize:"12px",marginBottom:"8px"},children:[r.jsx("span",{style:{color:"#666"},children:": "}),r.jsx("span",{style:{fontWeight:"bold",color:"#9c27b0"},children:e.tier||""})]}),e.currentExp!==void 0&&e.maxExp&&r.jsxs("div",{children:[r.jsxs("div",{style:{marginBottom:"4px"},children:[r.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",marginBottom:"4px"},children:[r.jsx("span",{style:{fontSize:"11px",color:"#666"},children:""}),r.jsxs("span",{style:{fontSize:"11px",color:"#666",fontWeight:"bold"},children:[Math.round(Math.floor(e.currentExp||0)/Math.max(1,Math.floor(e.maxExp||1))*100),"%"]})]}),r.jsx("div",{style:{width:"100%",height:"14px",background:"linear-gradient(to right, #f0f0f0, #e0e0e0)",borderRadius:"7px",overflow:"hidden",position:"relative",boxShadow:"inset 0 2px 4px rgba(0,0,0,0.1)"},children:r.jsx("div",{style:{width:`${Math.min(100,Math.round(Math.floor(e.currentExp||0)/Math.max(1,Math.floor(e.maxExp||1))*100))}%`,height:"100%",background:"linear-gradient(90deg, #9c27b0 0%, #d05ce3 100%)",borderRadius:"7px",transition:"width 0.3s ease",boxShadow:"0 0 10px rgba(156, 39, 176, 0.5)",position:"relative",overflow:"hidden"},children:r.jsx("div",{style:{position:"absolute",top:0,left:"-100%",width:"100%",height:"100%",background:"linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent)",animation:"shimmer 2s infinite"}})})})]}),r.jsxs("div",{style:{fontSize:"11px",color:"#666",textAlign:"right",marginTop:"2px"},children:[Math.floor(e.currentExp||0)," / ",Math.floor(e.maxExp||100)]}),e.cultivationSpeed&&r.jsxs("div",{style:{marginTop:"8px",padding:"6px 10px",background:"rgba(156, 39, 176, 0.05)",borderRadius:"6px",border:"1px solid rgba(156, 39, 176, 0.1)"},children:[r.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"4px"},children:[r.jsx("span",{style:{fontSize:"11px",color:"#666"},children:":"}),r.jsxs("span",{style:{fontSize:"11px",fontWeight:"bold",color:"#9c27b0"},children:[Math.floor(e.cultivationSpeed)," /"]})]}),(()=>{const _=e.maxExp-e.currentExp,y=Math.ceil(_/e.cultivationSpeed);return r.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[r.jsx("span",{style:{fontSize:"11px",color:"#666"},children:":"}),r.jsx("span",{style:{fontSize:"11px",fontWeight:"bold",color:y>12?"#ff9800":"#4caf50"},children:y>12?`${Math.floor(y/12)}`:`${y}`})]})})()]}),(()=>{var C;const _=((C=e.relationship)==null?void 0:C.affection)||0;let y=0,R="";return _>=80?(y=50,R=""):_>=60?(y=30,R=""):_>=40?(y=20,R=""):_>=20&&(y=10,R=""),y>0?r.jsxs("div",{style:{marginTop:"8px",padding:"6px 10px",background:"linear-gradient(135deg, rgba(244, 81, 108, 0.1), rgba(240, 98, 146, 0.1))",borderRadius:"6px",border:"1px solid rgba(244, 81, 108, 0.2)",fontSize:"11px",color:"#f4516c",display:"flex",alignItems:"center",justifyContent:"space-between"},children:[r.jsxs("span",{children:[" ",R,""]}),r.jsxs("span",{style:{fontWeight:"bold"},children:["+",y,"% "]})]}):null})()]})]}),r.jsxs("div",{style:ft.personalityBox,children:[r.jsx("span",{children:""}),typeof e.personality=="object"&&e.personality!==null&&"label"in e.personality?r.jsxs("span",{style:ft.tag,children:[e.personality.label," (",e.personality.desc,")"]}):Array.isArray(e.personality)?r.jsx("div",{style:{display:"flex",gap:"5px",marginTop:"5px"},children:e.personality.map((_,y)=>r.jsx("span",{style:ft.tag,children:_},y))}):r.jsx("span",{style:ft.tag,children:""})]}),a&&r.jsxs("button",{onClick:()=>a(e),style:{width:"100%",padding:"12px",marginTop:"15px",background:"linear-gradient(135deg, #667eea 0%, #764ba2 100%)",color:"white",border:"none",borderRadius:"8px",fontSize:"14px",fontWeight:"bold",cursor:"pointer",transition:"all 0.3s",boxShadow:"0 4px 12px rgba(102, 126, 234, 0.3)"},onMouseOver:_=>{_.currentTarget.style.transform="translateY(-2px)",_.currentTarget.style.boxShadow="0 6px 16px rgba(102, 126, 234, 0.4)"},onMouseOut:_=>{_.currentTarget.style.transform="translateY(0)",_.currentTarget.style.boxShadow="0 4px 12px rgba(102, 126, 234, 0.3)"},children:[" ",e.name,""]}),r.jsx("div",{style:{marginTop:"10px"},children:r.jsx("button",{onClick:()=>{l&&window.showConfirm&&window.showConfirm(` ${e.name} `,()=>l(e.id))},style:{width:"100%",padding:"12px",marginTop:"10px",background:"linear-gradient(135deg, #e53935 0%, #c62828 100%)",color:"white",border:"none",borderRadius:"8px",fontSize:"14px",cursor:"pointer"},children:" "})})]}):c==="CHAT"?r.jsx("div",{style:ft.chatWrapper,children:(()=>{const _=localStorage.getItem("game_api_key"),y=localStorage.getItem("game_api_url");return!_||!y?r.jsxs("div",{style:ft.noApiHint,children:[r.jsx("div",{style:{fontSize:"48px",marginBottom:"20px"},children:""}),r.jsx("h3",{children:""}),r.jsxs("p",{children:[" AI API  ",e.name," "]}),r.jsxs("div",{style:{marginTop:"20px",padding:"15px",background:"rgba(255, 255, 255, 0.7)",borderRadius:"8px",fontSize:"13px",lineHeight:"1.6"},children:[r.jsx("strong",{children:""}),r.jsx("br",{}),"1. ",r.jsx("br",{}),"2. AI  API Key  URL",r.jsx("br",{}),"3.  DeepSeek",r.jsx("br",{}),"4. ",r.jsx("br",{}),"5.  NPC "]})]}):r.jsx(ij,{npc:e,player:s,apiKey:_,apiUrl:y,gameState:w})})()}):null})]})]})})},ft={overlay:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0,0,0,0.5)",display:"flex",justifyContent:"center",alignItems:"center",zIndex:1e3,backdropFilter:"blur(2px)"},modalWrapper:{position:"relative",width:"min(600px, calc(100vw - 32px))"},modal:{width:"100%",maxWidth:"600px",height:"80vh",backgroundColor:"#f5f0e8",borderRadius:"16px",overflow:"hidden",display:"flex",flexDirection:"column",position:"relative",boxShadow:"0 8px 30px rgba(0,0,0,0.2)",border:"2px solid #d7ccc8"},closeBtn:{position:"absolute",top:"-18px",left:"-18px",border:"none",background:"#ffffff",fontSize:"24px",cursor:"pointer",color:"#8d6e63",width:"44px",height:"44px",borderRadius:"50%",display:"flex",alignItems:"center",justifyContent:"center",boxShadow:"0 12px 30px rgba(0,0,0,0.25)",zIndex:5},content:{display:"flex",flex:1,height:"calc(100% - 40px)",overflow:"hidden"},leftCol:{width:"100%",backgroundColor:"#faf8f5",padding:"25px",display:"flex",flexDirection:"column",overflowY:"auto"},desc:{fontSize:"14px",color:"#5d4037",fontStyle:"italic",marginBottom:"20px",lineHeight:"1.8",padding:"15px",background:"#f5f0e8",borderRadius:"10px",border:"1px solid #e0e0e0",fontFamily:"Microsoft YaHei, SimSun, serif"},tag:{fontSize:"13px",background:"linear-gradient(135deg, #d7ccc8 0%, #bcaaa4 100%)",padding:"4px 12px",borderRadius:"15px",color:"#3e2723",boxShadow:"0 2px 4px rgba(0,0,0,0.05)"},identityTag:{background:"linear-gradient(135deg, #795548 0%, #5d4037 100%)",color:"white",padding:"4px 10px",borderRadius:"8px",fontSize:"11px",marginRight:"8px",boxShadow:"0 2px 4px rgba(0,0,0,0.1)"},rareTag:{background:"linear-gradient(45deg, #FFD700, #FFA500)",color:"white",padding:"4px 10px",borderRadius:"8px",fontSize:"11px",marginLeft:"5px",fontWeight:"bold",boxShadow:"0 2px 4px rgba(0,0,0,0.1)"},attrBox:{background:"linear-gradient(135deg, #ffffff 0%, #f5f0e8 100%)",padding:"18px",borderRadius:"12px",marginBottom:"20px",border:"1px solid #e0e0e0",boxShadow:"0 2px 8px rgba(0,0,0,0.05)"},letterToggleRow:{marginTop:"14px",padding:"10px 0",borderTop:"1px dashed rgba(0,0,0,0.08)",display:"flex",alignItems:"center",justifyContent:"space-between",gap:"12px"},letterToggleBtn:{border:"none",color:"#fff",padding:"6px 14px",borderRadius:"999px",fontSize:"12px",fontWeight:"bold",cursor:"pointer",transition:"transform 0.2s ease",boxShadow:"0 2px 6px rgba(0,0,0,0.15)"},letterToggleHint:{fontSize:"11px",color:"#8d6e63",marginTop:"4px"},personalityBox:{marginTop:"auto",padding:"15px",background:"linear-gradient(135deg, #ffffff 0%, #f5f0e8 100%)",borderRadius:"12px",fontSize:"13px",border:"1px solid #e0e0e0",boxShadow:"0 2px 8px rgba(0,0,0,0.05)"},tabBar:{display:"flex",borderBottom:"2px solid #d7ccc8",background:"linear-gradient(180deg, #f5f0e8 0%, #ebe6dd 100%)"},tab:{flex:1,padding:"15px",border:"none",cursor:"pointer",fontSize:"14px",transition:"all 0.3s",borderRadius:"0"},chatWrapper:{width:"100%",height:"100%",display:"flex",flexDirection:"column",padding:"20px",boxSizing:"border-box"},noApiHint:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",height:"100%",textAlign:"center",padding:"40px",color:"#5d4037"}},uj=e=>e>=90?"#FFD700":e>=80?"#9C27B0":e>=60?"#2196F3":"#4CAF50",pj=e=>({:"#FFD700",:"#9C27B0",:"#2196F3",:"#4CAF50",:"#9E9E9E",:"#00BCD4"})[e]||"#9E9E9E",Qy=(e,t,n={})=>e==="PLAYER"?0:n[e]==="PLAYER"||!t.find(o=>o.id===n[e])?1:1+Qy(n[e],t,n),Jy=({node:e,allChildren:t,onNodeClick:n,generation:s=0,parentMap:o={}})=>{var d;const i=t.filter(u=>u.parentId===e.id),a=s+1,l=a<=2;return r.jsxs("div",{style:nn.nodeWrapper,children:[r.jsxs("div",{style:{...nn.card,borderColor:e.id==="PLAYER"||((d=e.stats)==null?void 0:d.aptitude)>=80?"#d4af37":"#dcd6cc",cursor:e.isPregnant?"default":"pointer"},onClick:()=>{e.isPregnant||n(e)},children:[r.jsx("div",{style:nn.avatar,children:e.gender===""?"":""}),r.jsx("div",{style:nn.name,children:e.name}),e.id!=="PLAYER"&&r.jsxs(r.Fragment,{children:[r.jsx("div",{style:nn.tier,children:e.tierTitle||""}),e.spouse&&r.jsx("div",{style:nn.spouseTag,children:" "}),e.isPregnant&&r.jsxs("div",{style:nn.pregnantTag,children:[" ",e.gender===""&&r.jsx("span",{style:{fontSize:"9px"},children:"()"})]})]})]}),i.length>0&&r.jsx("div",{style:nn.lineDown}),i.length>0&&r.jsx("div",{style:nn.childrenContainer,children:l?i.map((u,p)=>r.jsxs("div",{style:nn.childWrapper,children:[r.jsx("div",{style:{...nn.lineTop,left:p===0?"50%":"0",width:p===0||p===i.length-1?"50%":"100%",display:i.length===1?"none":"block"}}),r.jsx(Jy,{node:u,allChildren:t,onNodeClick:n,generation:a,parentMap:o})]},u.id)):r.jsxs("div",{style:nn.generationCounter,children:[" ",i.length,""]})})]})},fj=({player:e,children:t,pregnantNpcs:n=[],onChildClick:s,generation3Plus:o=[]})=>{const i=Array.isArray(o)?o:[],[a,l]=b.useState(1),[d,u]=b.useState({x:0,y:0}),[p,c]=b.useState(!1),[m,v]=b.useState({x:0,y:0}),[w,E]=b.useState(null),[S,g]=b.useState(null),h=b.useRef(null),x=F=>{F.cancelable&&F.preventDefault();const se=F.deltaY*-.001,J=Math.min(Math.max(.2,a+se),3);l(J)},k=F=>{c(!0),v({x:F.clientX-d.x,y:F.clientY-d.y})},_=F=>{p&&u({x:F.clientX-m.x,y:F.clientY-m.y})},y=()=>{c(!1)},R=F=>{const se=F[0].clientX-F[1].clientX,J=F[0].clientY-F[1].clientY;return Math.sqrt(se*se+J*J)},C=F=>{F.touches.length===1?(c(!0),E({x:F.touches[0].clientX-d.x,y:F.touches[0].clientY-d.y})):F.touches.length===2&&g(R(F.touches))},I=F=>{if(F.cancelable&&F.preventDefault(),F.touches.length===1&&p&&w)u({x:F.touches[0].clientX-w.x,y:F.touches[0].clientY-w.y});else if(F.touches.length===2&&S){const se=R(F.touches),J=se/S,de=Math.min(Math.max(.2,a*J),3);l(de),g(se)}},T=()=>{c(!1),E(null),g(null)},L={id:"PLAYER",name:e.name+" ()",gender:e.gender,parentId:null},ee=n.map((F,se)=>({id:`embryo-${F.id||se}`,name:`${F.name}`,gender:F.gender||"",parentId:"PLAYER",generation:1,tierTitle:"",isPregnant:!0})),$=[...t,...ee].map(F=>({...F,parentId:F.parentId||"PLAYER"})),O={};$.forEach(F=>{F.id&&(O[F.id]=F.parentId)});const H={};return $.forEach(F=>{if(!F.isPregnant){const se=Qy(F.id,$,O);H[se]=(H[se]||0)+1}}),i.forEach(F=>{const se=F.generation;H[se]=(H[se]||0)+1}),r.jsxs("div",{ref:h,style:nn.viewport,onWheel:x,onMouseDown:k,onMouseMove:_,onMouseUp:y,onMouseLeave:y,onTouchStart:C,onTouchMove:I,onTouchEnd:T,onTouchCancel:T,children:[Object.keys(H).length>0&&r.jsx("div",{style:nn.statsPanel,children:Object.keys(H).sort((F,se)=>F-se).map(F=>r.jsxs("span",{style:nn.statItem,children:["",F,": ",r.jsx("strong",{children:H[F]}),""]},F))}),r.jsxs("div",{style:nn.controls,children:[r.jsx("button",{onClick:()=>l(Math.min(3,a+.1)),children:""}),r.jsx("button",{onClick:()=>l(Math.max(.2,a-.1)),children:""}),r.jsx("button",{onClick:()=>{l(1),u({x:0,y:0})},children:""})]}),r.jsx("div",{style:{transform:`translate(${d.x}px, ${d.y}px) scale(${a})`,transformOrigin:"top center",transition:p?"none":"transform 0.1s ease-out",...nn.treeCanvas},children:r.jsx(Jy,{node:L,allChildren:$,onNodeClick:F=>F.id!=="PLAYER"&&s(F),generation:0,parentMap:O})})]})},nn={viewport:{width:"100%",height:"650px",overflow:"hidden",background:"#f0f4f8",position:"relative",border:"3px double #dcd6cc",borderRadius:"12px",cursor:"grab"},controls:{position:"absolute",top:10,right:10,zIndex:10,display:"flex",gap:"5px"},statsPanel:{position:"absolute",top:10,left:10,zIndex:10,background:"rgba(255,255,255,0.95)",padding:"8px 12px",borderRadius:"8px",border:"2px solid #dcd6cc",boxShadow:"0 2px 6px rgba(0,0,0,0.1)",display:"flex",flexDirection:"column",gap:"4px",fontSize:"14px",maxHeight:"200px",overflowY:"auto"},statItem:{display:"block",color:"#333",lineHeight:"1.4"},treeCanvas:{display:"flex",justifyContent:"center",paddingTop:"50px",width:"max-content",minWidth:"100%"},nodeWrapper:{display:"flex",flexDirection:"column",alignItems:"center"},card:{width:"100px",padding:"8px",background:"#fff",border:"2px solid #ccc",borderRadius:"8px",textAlign:"center",cursor:"pointer",boxShadow:"0 2px 5px rgba(0,0,0,0.1)",position:"relative",zIndex:2},childrenContainer:{display:"flex",paddingTop:"20px"},childWrapper:{display:"flex",flexDirection:"column",alignItems:"center",position:"relative",padding:"0 10px"},lineDown:{width:"2px",height:"20px",background:"#ccc"},lineTop:{position:"absolute",top:0,height:"20px",borderTop:"2px solid #ccc",zIndex:1},avatar:{fontSize:"24px"},name:{fontSize:"12px",fontWeight:"bold",margin:"2px 0"},tier:{fontSize:"10px",color:"#666"},spouseTag:{fontSize:"10px",color:"#e91e63",marginTop:"2px"},pregnantTag:{fontSize:"10px",color:"#ff9800",marginTop:"2px"},generationCounter:{fontSize:"14px",fontWeight:"bold",color:"#2e7d32",padding:"10px 15px",backgroundColor:"#e8f5e9",borderRadius:"8px",marginTop:"10px",border:"2px dashed #2e7d32",display:"flex",alignItems:"center",justifyContent:"center"}},mj=[{value:"age",label:""},{value:"aptitude",label:""},{value:"cultivation",label:""},{value:"rank",label:""},{value:"name",label:""}],Tl=10,gj=["","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","",""],Bg=(e="")=>{if(!e)return 0;const t=gj.indexOf(e);return t>=0?t:0},Og=e=>{if(!e)return 999;const t=Bf.find(n=>n.name===e);return t?t.id:999},hj=({children:e,pregnantNpcs:t=[],onChildClick:n,onToggleFavorite:s})=>{const[o,i]=b.useState("age"),[a,l]=b.useState("all"),[d,u]=b.useState("all"),[p,c]=b.useState("all"),[m,v]=b.useState(!1),[w,E]=b.useState(1),[S,g]=b.useTransition(),h=b.useCallback(T=>{g(()=>i(T))},[g]);b.useEffect(()=>{E(1)},[o,a,d,p,m,e.length]);const x=b.useMemo(()=>new Set(t.map(T=>T.id)),[t]),k=b.useMemo(()=>{const T=new Map,L=new Map(e.map($=>[$.id,$])),ee=$=>{if(!$)return 1;if(T.has($.id))return T.get($.id);if(!$.parentId||$.parentId==="PLAYER")return T.set($.id,1),1;const O=L.get($.parentId),H=O?ee(O):0,F=Math.max(1,H+1);return T.set($.id,F),F};return e.forEach($=>ee($)),T},[e]),_=b.useCallback(T=>T&&k.get(T.id)||1,[k]),y=b.useMemo(()=>{let T=[...e];return m&&(T=T.filter(L=>L.isFavorite)),a!=="all"&&(T=T.filter(L=>L.gender===a)),d!=="all"&&(T=T.filter(L=>{const ee=_(L);return d==="3+"?ee>=3:ee===parseInt(d)})),p!=="all"&&(T=T.filter(L=>p==="married"?L.spouse:p==="single"?!L.spouse:p==="pregnant"?x.has(L.id):p==="cultivating"?L.sect:!0)),T.sort((L,ee)=>{var $,O;switch(o){case"age":return L.age-ee.age;case"aptitude":return((($=ee.stats)==null?void 0:$.aptitude)||0)-(((O=L.stats)==null?void 0:O.aptitude)||0);case"cultivation":const H=Bg(L.tier||""),F=Bg(ee.tier||"");if(H!==F)return F-H;const se=L.currentExp||0;return(ee.currentExp||0)-se;case"rank":const de=Og(L.rank),Ee=Og(ee.rank);return de===999&&Ee===999?0:de===999?1:Ee===999?-1:Ee-de;case"name":return L.name.localeCompare(ee.name,"zh-CN");default:return 0}}),T},[e,o,a,d,p,x,m,k]),R=b.useMemo(()=>Math.max(1,Math.ceil(y.length/Tl)),[y.length]);b.useEffect(()=>{E(T=>Math.min(T,R))},[R]);const C=b.useMemo(()=>{const T=(w-1)*Tl;return y.filter(ee=>_(ee)<=2).slice(T,T+Tl)},[y,w]),I=b.useMemo(()=>({total:e.length,male:e.filter(T=>T.gender==="").length,female:e.filter(T=>T.gender==="").length,married:e.filter(T=>T.spouse).length,pregnant:x.size,cultivating:e.filter(T=>T.sect).length,genius:e.filter(T=>{var L;return(((L=T.stats)==null?void 0:L.aptitude)||0)>=80}).length,favorite:e.filter(T=>T.isFavorite).length}),[e,x]);return r.jsxs("div",{style:Ce.container,children:[r.jsxs("div",{style:Ce.header,children:[r.jsxs("h3",{style:Ce.title,children:[" (1-2: ",y.filter(T=>_(T)<=2).length," / : ",I.total,")"]}),r.jsx("div",{style:Ce.statsBar,children:r.jsxs("span",{style:Ce.statItem,children:[": ",y.filter(T=>_(T)>2).length]})}),r.jsxs("div",{style:Ce.statsBar,children:[r.jsxs("span",{style:Ce.statItem,children:[" ",I.male]}),r.jsxs("span",{style:Ce.statItem,children:[" ",I.female]}),r.jsxs("span",{style:Ce.statItem,children:[" ",I.married]}),r.jsxs("span",{style:Ce.statItem,children:[" ",I.pregnant]}),r.jsxs("span",{style:Ce.statItem,children:[" ",I.cultivating]}),r.jsxs("span",{style:Ce.statItem,children:[" ",I.genius]}),r.jsxs("span",{style:Ce.statItem,children:[" ",I.favorite]})]})]}),r.jsxs("div",{style:Ce.controls,children:[r.jsxs("div",{style:Ce.sortRow,children:[r.jsx("span",{style:Ce.label,children:":"}),r.jsx("div",{style:Ce.segmentedRow,children:mj.map(T=>r.jsx("button",{type:"button",onClick:()=>h(T.value),style:{...Ce.segmentButton,...o===T.value?Ce.segmentButtonActive:{}},children:T.label},T.value))}),S&&r.jsx("span",{style:Ce.pendingHint,children:"..."}),r.jsx("button",{type:"button",onClick:()=>v(T=>!T),style:{...Ce.favoriteToggle,...m?Ce.favoriteToggleActive:{}},children:m?" ":" "})]}),r.jsxs("div",{style:Ce.filterRow,children:[r.jsxs("div",{style:Ce.controlGroup,children:[r.jsx("label",{style:Ce.label,children:":"}),r.jsxs("select",{value:a,onChange:T=>l(T.target.value),style:Ce.select,children:[r.jsx("option",{value:"all",children:""}),r.jsx("option",{value:"",children:""}),r.jsx("option",{value:"",children:""})]})]}),r.jsxs("div",{style:Ce.controlGroup,children:[r.jsx("label",{style:Ce.label,children:":"}),r.jsxs("select",{value:d,onChange:T=>u(T.target.value),style:Ce.select,children:[r.jsx("option",{value:"all",children:""}),r.jsx("option",{value:"1",children:""}),r.jsx("option",{value:"2",children:""}),r.jsx("option",{value:"3+",children:"+"})]})]}),r.jsxs("div",{style:Ce.controlGroup,children:[r.jsx("label",{style:Ce.label,children:":"}),r.jsxs("select",{value:p,onChange:T=>c(T.target.value),style:Ce.select,children:[r.jsx("option",{value:"all",children:""}),r.jsx("option",{value:"married",children:""}),r.jsx("option",{value:"single",children:""}),r.jsx("option",{value:"pregnant",children:""}),r.jsx("option",{value:"cultivating",children:""})]})]})]})]}),t.length>0&&p!=="single"&&p!=="cultivating"&&r.jsxs("div",{style:Ce.section,children:[r.jsxs("h4",{style:Ce.sectionTitle,children:["  (",t.length,")"]}),r.jsx("div",{style:Ce.embryoList,children:t.map(T=>r.jsxs("div",{style:Ce.embryoCard,children:[r.jsx("div",{style:Ce.embryoIcon,children:""}),r.jsxs("div",{style:Ce.embryoInfo,children:[r.jsx("div",{style:Ce.embryoName,children:"..."}),r.jsxs("div",{style:Ce.embryoDetail,children:[": ",T.name," ",T.gender===""&&r.jsx("span",{style:{fontSize:"10px",color:"#ff6b6b"},children:"()"})]}),r.jsx("div",{style:Ce.progressBar,children:r.jsx("div",{style:{...Ce.progressFill,width:`${(T.pregnancyProgress||0)*10}%`}})}),r.jsxs("div",{style:Ce.embryoProgress,children:[T.pregnancyProgress||0,"/9"]})]})]},`embryo-${T.id}`))})]}),r.jsx("div",{style:Ce.listContainer,children:y.length===0?r.jsxs("div",{style:Ce.emptyState,children:[r.jsx("div",{style:Ce.emptyIcon,children:""}),r.jsx("div",{style:Ce.emptyText,children:""})]}):C.map(T=>{var O,H,F;const L=_(T),ee=x.has(T.id),$=T.influenceProfile;return r.jsxs("div",{style:Ce.childCard,onClick:()=>n(T),children:[s&&r.jsx("button",{type:"button",title:T.isFavorite?"":"",style:{...Ce.favoriteButton,...T.isFavorite?Ce.favoriteButtonActive:{}},onClick:se=>{se.stopPropagation(),s(T.id)},children:T.isFavorite?"":""}),r.jsxs("div",{style:Ce.avatarSection,children:[T.age===0?r.jsx("div",{style:Ce.babyIcon,children:""}):T.age<15?r.jsx("div",{style:Ce.babyIcon,children:""}):r.jsx(Gr,{dna:T.avatar,gender:T.gender,size:60}),r.jsx("div",{style:Ce.genderBadge,"data-gender":T.gender,children:T.gender===""?"":""})]}),r.jsxs("div",{style:Ce.infoSection,children:[r.jsxs("div",{style:Ce.childName,children:[r.jsx("span",{style:{color:uj(((O=T.stats)==null?void 0:O.aptitude)||0)},children:T.name}),r.jsxs("span",{style:Ce.generationBadge,children:["",L,""]}),(((H=T.stats)==null?void 0:H.aptitude)||0)>=80&&r.jsx("span",{style:Ce.geniusBadge,children:""}),T.isFavorite&&r.jsx("span",{style:Ce.favoriteBadge,children:" "})]}),r.jsxs("div",{style:Ce.infoRow,children:[r.jsxs("span",{style:Ce.infoItem,children:[": ",Math.floor(T.age),""]}),r.jsx("span",{style:Ce.infoItem,children:T.tierTitle||""}),T.isTested&&T.spiritRoot&&r.jsx("span",{style:{...Ce.infoItem,color:pj(T.spiritRoot.type)},children:T.spiritRoot.type})]}),r.jsxs("div",{style:Ce.infoRow,children:[r.jsxs("span",{style:Ce.infoItem,children:[": ",Math.floor(((F=T.stats)==null?void 0:F.aptitude)||0)]}),T.rank&&r.jsxs("span",{style:Ce.rankBadge,children:[" ",T.rank]}),T.sect&&r.jsxs("span",{style:Ce.sectBadge,children:[" ",T.sect.name]}),T.spouse&&r.jsxs("span",{style:Ce.spouseBadge,children:[" ",T.spouse.name]}),ee&&r.jsx("span",{style:Ce.pregnantBadge,children:" "})]}),$&&r.jsxs("div",{style:Ce.influenceRow,children:[r.jsx("span",{style:{...Ce.influenceBadge,borderColor:$.color},children:$.label}),r.jsx("div",{style:Ce.influenceMeter,children:r.jsx("div",{style:{...Ce.influenceMeterFill,width:`${Math.min(100,Math.round(($.progress||0)*100))}%`,background:$.color}})}),r.jsx("span",{style:Ce.influenceScore,children:Math.floor($.score)})]}),T.cultivationManual&&r.jsxs("div",{style:Ce.manualInfo,children:[" ",T.cultivationManual.name]})]}),r.jsx("div",{style:Ce.arrowSection,children:""})]},T.id)})}),y.length>Tl&&r.jsxs("div",{style:Ce.pagination,children:[r.jsx("button",{style:{...Ce.pageBtn,opacity:w===1?.6:1},onClick:()=>E(T=>Math.max(1,T-1)),disabled:w===1,children:""}),r.jsxs("span",{style:Ce.pageInfo,children:[" ",w," / ",R," "]}),r.jsx("button",{style:{...Ce.pageBtn,opacity:w>=R?.6:1},onClick:()=>E(T=>Math.min(R,T+1)),disabled:w>=R,children:""})]})]})},Ce={container:{padding:"15px",backgroundColor:"#f5f0e8",borderRadius:"12px",border:"2px solid #8d6e63",maxHeight:"800px",height:"100%",display:"flex",flexDirection:"column",overflow:"hidden"},header:{marginBottom:"15px"},title:{margin:"0 0 10px 0",fontSize:"18px",fontWeight:"bold",color:"#5d4037"},statsBar:{display:"flex",gap:"12px",flexWrap:"wrap"},controls:{display:"flex",flexDirection:"column",gap:"12px",marginBottom:"15px",padding:"10px",backgroundColor:"rgba(255,255,255,0.5)",borderRadius:"8px"},sortRow:{display:"flex",flexWrap:"wrap",alignItems:"center",gap:"10px"},segmentedRow:{display:"flex",flexWrap:"wrap",gap:"6px"},pendingHint:{fontSize:"11px",color:"#5d4037",fontStyle:"italic"},segmentButton:{border:"1px solid #8d6e63",borderRadius:"16px",padding:"4px 10px",fontSize:"12px",backgroundColor:"white",color:"#5d4037",cursor:"pointer",transition:"all 0.2s ease"},segmentButtonActive:{backgroundColor:"#8d6e63",color:"white",boxShadow:"0 2px 6px rgba(0,0,0,0.2)"},favoriteToggle:{border:"1px dashed #c2185b",borderRadius:"16px",padding:"4px 12px",fontSize:"12px",cursor:"pointer",backgroundColor:"white",color:"#c2185b",fontWeight:"bold"},favoriteToggleActive:{backgroundColor:"#c2185b",color:"white"},filterRow:{display:"flex",flexWrap:"wrap",gap:"10px"},controlGroup:{display:"flex",alignItems:"center",gap:"5px"},label:{fontSize:"12px",fontWeight:"bold",color:"#5d4037"},select:{padding:"4px 8px",borderRadius:"4px",border:"1px solid #8d6e63",backgroundColor:"white",fontSize:"12px",cursor:"pointer"},influenceRow:{display:"flex",alignItems:"center",gap:"8px",marginTop:"6px"},influenceBadge:{borderRadius:"999px",border:"1px solid #ccc",padding:"2px 8px",fontSize:"11px",fontWeight:600},influenceMeter:{flex:1,height:"6px",backgroundColor:"#e0e0e0",borderRadius:"999px",overflow:"hidden"},influenceMeterFill:{height:"100%"},influenceScore:{fontSize:"12px",fontWeight:700,color:"#37474f"},section:{marginBottom:"15px"},sectionTitle:{margin:"0 0 10px 0",fontSize:"14px",fontWeight:"bold",color:"#d81b60"},embryoList:{display:"flex",gap:"10px",flexWrap:"wrap",marginBottom:"10px"},embryoCard:{display:"flex",alignItems:"center",gap:"10px",padding:"10px",backgroundColor:"white",borderRadius:"8px",border:"2px dashed #d81b60",minWidth:"200px"},embryoIcon:{fontSize:"32px"},embryoInfo:{flex:1},embryoName:{fontWeight:"bold",color:"#d81b60",marginBottom:"4px"},embryoDetail:{fontSize:"11px",color:"#666",marginBottom:"4px"},progressBar:{height:"6px",backgroundColor:"#e0e0e0",borderRadius:"3px",overflow:"hidden",marginBottom:"4px"},progressFill:{height:"100%",backgroundColor:"#d81b60",transition:"width 0.3s ease"},embryoProgress:{fontSize:"10px",color:"#666"},listContainer:{flex:1,overflowY:"auto",WebkitOverflowScrolling:"touch",display:"flex",flexDirection:"column",gap:"10px",minHeight:0},childCard:{display:"flex",gap:"12px",padding:"12px",backgroundColor:"white",borderRadius:"10px",border:"2px solid #e0e0e0",cursor:"pointer",transition:"all 0.2s ease",boxShadow:"0 2px 4px rgba(0,0,0,0.05)",position:"relative"},favoriteButton:{position:"absolute",top:"10px",right:"10px",border:"none",background:"transparent",fontSize:"18px",cursor:"pointer",color:"#d7ccc8",transition:"transform 0.2s ease, color 0.2s ease"},favoriteButtonActive:{color:"#ffb300",textShadow:"0 0 6px rgba(255,179,0,0.6)"},avatarSection:{position:"relative",flexShrink:0},babyIcon:{width:"60px",height:"60px",display:"flex",alignItems:"center",justifyContent:"center",fontSize:"40px",backgroundColor:"#f5f5f5",borderRadius:"50%"},genderBadge:{position:"absolute",bottom:"-4px",right:"-4px",width:"20px",height:"20px",borderRadius:"50%",display:"flex",alignItems:"center",justifyContent:"center",fontSize:"12px",fontWeight:"bold",color:"white",backgroundColor:"#4285F4",border:"2px solid white"},infoSection:{flex:1,display:"flex",flexDirection:"column",gap:"6px",minWidth:0},childName:{display:"flex",alignItems:"center",gap:"6px",fontSize:"14px",fontWeight:"bold",flexWrap:"wrap"},generationBadge:{fontSize:"10px",padding:"2px 6px",backgroundColor:"#e3f2fd",color:"#1976d2",borderRadius:"10px",fontWeight:"normal"},geniusBadge:{fontSize:"10px",padding:"2px 6px",backgroundColor:"#fff3e0",color:"#f57c00",borderRadius:"10px",fontWeight:"normal"},favoriteBadge:{fontSize:"10px",padding:"2px 6px",backgroundColor:"#fff8e1",color:"#ff8f00",borderRadius:"10px",fontWeight:"bold"},infoRow:{display:"flex",gap:"8px",flexWrap:"wrap",alignItems:"center"},infoItem:{fontSize:"11px",color:"#666"},sectBadge:{fontSize:"10px",padding:"2px 6px",backgroundColor:"#e8f5e9",color:"#2e7d32",borderRadius:"10px",fontWeight:"bold"},rankBadge:{fontSize:"10px",padding:"2px 6px",backgroundColor:"#f3e5f5",color:"#6a1b9a",borderRadius:"10px",fontWeight:"bold"},spouseBadge:{fontSize:"10px",padding:"2px 6px",backgroundColor:"#fce4ec",color:"#c2185b",borderRadius:"10px",fontWeight:"bold"},pregnantBadge:{fontSize:"10px",padding:"2px 6px",backgroundColor:"#fff3e0",color:"#f57c00",borderRadius:"10px",fontWeight:"bold"},manualInfo:{fontSize:"11px",color:"#7b1fa2",fontWeight:"bold"},arrowSection:{display:"flex",alignItems:"center",fontSize:"20px",color:"#bbb",flexShrink:0},emptyState:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",padding:"40px",color:"#999"},emptyIcon:{fontSize:"48px",marginBottom:"10px"},emptyText:{fontSize:"14px"}},Xy=document.createElement("style");Xy.textContent=`
  [data-gender=""] {
    background-color: #4285F4 !important;
  }
  [data-gender=""] {
    background-color: #EA4335 !important;
  }
  .childCard:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(0,0,0,0.15);
    border-color: #8d6e63;
  }
  
  /*  */
  @media (max-width: 768px) {
    /*  */
    .listContainer {
      max-height: calc(100vh - 300px) !important;
      -webkit-overflow-scrolling: touch;
    }
  }
`;document.head.appendChild(Xy);const xj=({records:e=[],onMemorialClick:t})=>{const n=b.useMemo(()=>{if(!e.length)return{avgAge:0,maxGeneration:0};const s=e.reduce((i,a)=>i+(a.ageAtDeath||0),0),o=Math.max(...e.map(i=>i.generation||1));return{avgAge:Math.round(s/e.length*10)/10,maxGeneration:o}},[e]);return r.jsxs("div",{style:pn.container,children:[r.jsxs("div",{style:pn.banner,children:[r.jsxs("div",{children:["   ",e.length," "]}),e.length>0&&r.jsxs("div",{style:pn.bannerStats,children:[r.jsxs("span",{children:[" ",n.avgAge||""," "]}),r.jsxs("span",{children:[" ",n.maxGeneration||1,""]})]})]}),e.length===0?r.jsx("div",{style:pn.empty,children:""}):r.jsx("div",{style:pn.grid,children:e.map(s=>{var o;return r.jsxs("button",{type:"button",style:{...pn.tomb,...s.isExiled?pn.tombExiled:{}},onClick:()=>t&&t(s),children:[r.jsxs("div",{style:pn.tombHeader,children:[r.jsx("span",{style:pn.icon,children:s.isExiled?"":""}),r.jsxs("div",{children:[r.jsx("div",{style:pn.name,children:s.name}),r.jsxs("div",{style:pn.meta,children:[s.isExiled?"":`${s.generation||1}`,"  ",s.tierTitle||""]})]})]}),!s.isExiled&&r.jsxs("div",{style:pn.detail,children:[" ",s.deathYear||""," ",s.deathMonth||1,"   ",s.ageAtDeath??""," "]}),s.deathReason&&r.jsxs("div",{style:pn.detail,children:[s.isExiled?"":"",s.deathReason]}),((o=s.sect)==null?void 0:o.name)&&!s.isExiled&&r.jsxs("div",{style:pn.detail,children:[s.sect.name,s.rank?`  ${s.rank}`:""]}),r.jsx("p",{style:pn.epitaph,children:s.epitaph||""}),typeof s.descendants=="number"&&!s.isExiled&&r.jsxs("div",{style:pn.descendants,children:["",s.descendants]})]},s.id)})})]})},pn={container:{width:"100%",height:"100%",background:"#fdf7f2",borderRadius:"12px",border:"2px solid #8d6e63",padding:"15px",display:"flex",flexDirection:"column",gap:"12px"},banner:{background:"linear-gradient(90deg, #efebe9, #f5f0e8)",borderRadius:"10px",padding:"12px 16px",fontWeight:"bold",display:"flex",justifyContent:"space-between",alignItems:"center",color:"#5d4037"},bannerStats:{display:"flex",gap:"16px",fontSize:"12px",color:"#6d4c41"},empty:{flex:1,display:"flex",alignItems:"center",justifyContent:"center",color:"#9e9e9e",fontStyle:"italic"},grid:{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(220px, 1fr))",gap:"12px",overflowY:"auto"},tomb:{display:"flex",flexDirection:"column",alignItems:"stretch",padding:"12px",borderRadius:"10px",border:"1px solid #d7ccc8",background:"#fffefd",textAlign:"left",cursor:"pointer",transition:"transform 0.2s ease, box-shadow 0.2s ease",outline:"none"},tombExiled:{background:"#f5f5f5",border:"1px solid #ccc",opacity:.8},tombHeader:{display:"flex",alignItems:"center",gap:"10px",marginBottom:"8px"},icon:{fontSize:"24px"},name:{fontWeight:"bold",color:"#4e342e"},meta:{fontSize:"12px",color:"#8d6e63"},detail:{fontSize:"12px",color:"#5d4037",marginTop:"4px"},epitaph:{marginTop:"10px",fontSize:"12px",color:"#4e342e",lineHeight:1.5},descendants:{marginTop:"8px",fontSize:"11px",color:"#6d4c41"}},yj=({player:e,children:t,fallenChildren:n=[],exiledChildren:s=[],pregnantNpcs:o=[],onChildClick:i,onToggleFavorite:a,onMemorialClick:l,generation3Plus:d=[]})=>{const[u,p]=b.useState("tree"),c=[...n,...s.map(m=>({...m,isExiled:!0,deathReason:"",epitaph:""}))];return r.jsxs("div",{style:Un.container,children:[r.jsxs("div",{style:Un.viewSwitcher,children:[r.jsx("button",{style:{...Un.viewButton,...u==="tree"?Un.viewButtonActive:{}},onClick:()=>p("tree"),children:" "}),r.jsx("button",{style:{...Un.viewButton,...u==="list"?Un.viewButtonActive:{}},onClick:()=>p("list"),children:" "}),r.jsx("button",{style:{...Un.viewButton,...u==="cemetery"?Un.viewButtonActive:{}},onClick:()=>p("cemetery"),children:" "})]}),r.jsxs("div",{style:{...Un.viewContent,position:"relative"},children:[u==="tree"&&r.jsx(fj,{player:e,children:t,pregnantNpcs:o,onChildClick:i,generation3Plus:d}),u==="list"&&r.jsx(hj,{children:t,pregnantNpcs:o,onChildClick:i,onToggleFavorite:a}),u==="cemetery"&&r.jsx(xj,{records:c,onMemorialClick:l})]}),u==="tree"&&r.jsx("div",{style:Un.hint,children:" : ,/,/"}),u==="list"&&r.jsx("div",{style:Un.hint,children:" : "}),u==="cemetery"&&r.jsx("div",{style:Un.hint,children:" : "})]})},Un={container:{display:"flex",flexDirection:"column",gap:"15px"},viewSwitcher:{display:"flex",gap:"10px",justifyContent:"center",padding:"10px",backgroundColor:"rgba(255,255,255,0.5)",borderRadius:"12px",border:"2px solid #8d6e63"},viewButton:{padding:"10px 20px",fontSize:"14px",fontWeight:"bold",border:"2px solid #8d6e63",borderRadius:"20px",backgroundColor:"white",color:"#5d4037",cursor:"pointer",transition:"all 0.3s ease",outline:"none",boxShadow:"0 2px 4px rgba(0,0,0,0.1)"},viewButtonActive:{backgroundColor:"#8d6e63",color:"white",transform:"scale(1.05)",boxShadow:"0 4px 8px rgba(0,0,0,0.2)"},viewContent:{flex:1},hint:{textAlign:"center",fontSize:"12px",color:"#666",padding:"8px",backgroundColor:"rgba(255,255,255,0.7)",borderRadius:"8px",border:"1px solid #e0e0e0"}},Mp=document.createElement("style");Mp.textContent=`
  button:hover {
    transform: translateY(-2px);
  }
  button:active {
    transform: translateY(0);
  }
`;document.querySelector("#family-view-wrapper-styles")||(Mp.id="family-view-wrapper-styles",document.head.appendChild(Mp));const bj=e=>{if(!e||!e.sect||!e.sectId||e.sectId==="NONE")return null;const t=e.sect.name,n=e.name,s=e.sectRank||"",o=e.sectStatus||"active",i=[];return o==="active"?(i.push(`${t}${s}${n}`,`${t}${n}`,`${t}${n}`,`${t}${n}`,`${t}${n}`,`${t}${n}`,`${t}${n}`,`${t}${n}`,`${t}${n}`,`${t}${n}`),(s===""||s==="")&&i.push(`${t}${n}`,`${t}${n}`,`${t}${n}`,`${t}${n}`),(t.includes("")||t.includes("")||t.includes(""))&&i.push(`${t}${n}`,`${t}${n}`,`${n}(${t})`)):o==="defected"?i.push(`${t}${n}`,`${t}${s}${n}`,`${t}${n}`,`${n}`,`${t}${n}`,`${n}${t}`):o==="hidden"&&i.push(`${t}${n}`,`${t}${n}`),i.length>0?i[Math.floor(Math.random()*i.length)]:null},vj=e=>{if(!e||e.length<2)return null;const t=e.filter(a=>a.sect&&a.sectId&&a.sectId!=="NONE"&&a.sectStatus==="active");if(t.length<2)return null;const n=t[Math.floor(Math.random()*t.length)];let s=t[Math.floor(Math.random()*t.length)],o=0;for(;s.sectId===n.sectId&&o<10;)s=t[Math.floor(Math.random()*t.length)],o++;if(n.sectId===s.sectId)return null;const i=[`${n.sect.name}${n.name}${s.sect.name}${s.name}`,`${n.name}(${n.sect.name})${s.name}(${s.sect.name})`,`${n.sect.name}${n.name}${s.sect.name}${s.name}`];return i[Math.floor(Math.random()*i.length)]},Sj=[{type:"SECT",title:"",templates:["","","","","","","","","",""],probability:.15},{type:"SECT",title:"",templates:["","","","","","","",""],probability:.1},{type:"SECT",title:"",templates:["","","","","","","",""],probability:.12},{type:"SECT",title:"",templates:["","","","","","",""],probability:.08}],wj=[{type:"GENIUS",title:"",templates:["''","''","","''","","","''"],probability:.1},{type:"GENIUS",title:"",templates:["''","","","","",""],probability:.08},{type:"GENIUS",title:"",templates:["''''","''","","","",""],probability:.07},{type:"GENIUS",title:"",templates:["''","","","''","''",""],probability:.05}],Ej=[{type:"TREASURE",title:"",templates:["","","","","","","","",""],probability:.12}],kj=[{type:"REALM",title:"",templates:["","","","","","","",""],probability:.1}],jj=[{type:"DISASTER",title:"",templates:["","","","","","","","",""],probability:.08}],Cj=[{type:"POLITICS",title:"",templates:["","","","","","","",""],probability:.07}],Tj=[{type:"DAILY",title:"",templates:["","","","","","",""],probability:.15}],Ij=[{type:"FAMOUS",title:"",templates:["''","","","","''","","",""],probability:.06}],_j=()=>[...Sj,...wj,...Ej,...kj,...jj,...Cj,...Tj,...Ij],Rj=(e,t,n=null,s=[])=>{const o=[],i=Lj(e,t);for(let a=0;a<i;a++){const l=Aj(e,t);l&&o.push(l)}if(s&&s.length>0&&Math.random()<.3){const a=Mj(e,t,s);a&&o.push(a)}return o},Mj=(e,t,n)=>{const s=Math.random();let o=null,i=null;if(s<.7){const a=n[Math.floor(Math.random()*n.length)];o=bj(a),i=[a.id]}else o=vj(n);return o?{type:"NPC_RELATED",category:"",title:"",message:o,year:e,month:t,importance:"MEDIUM",timestamp:Date.now(),npcIds:i}:null},Aj=(e,t,n)=>{const s=_j(),o=Nj(s);if(!o||!o.templates||o.templates.length===0)return null;const i=Ke(o.templates);return i?{type:o.type,category:"",title:o.title,message:i,year:e,month:t,importance:$j(o.type),timestamp:Date.now()}:null},Nj=e=>{const t=e.reduce((s,o)=>s+(o.probability||0),0);let n=Math.random()*t;for(const s of e)if(n-=s.probability||0,n<=0)return s;return e[0]},Lj=(e,t)=>{if(t===1||t===7){const s=Math.random();return s<.3?3:s<.7?2:1}const n=Math.random();return n<.5?1:n<.8?2:0},$j=e=>({DISASTER:5,POLITICS:4,GENIUS:4,SECT:3,REALM:3,TREASURE:3,FAMOUS:2,DAILY:1})[e]||2,Bj=(e,t,n,s)=>{const o=t.filter(i=>i.sect&&["TOP","HIGH"].includes(i.sect.level));if(o.length>0&&Math.random()<.2){const i=Ke(o),a=i.sect.name,l=[`${a}${i.name}`,`${a}${i.name}`,`${a}${i.name}`];return{type:"SECT",category:"",title:"",message:Ke(l),year:n,month:s,importance:3,relatedChild:i.id,timestamp:Date.now()}}return null},Oj=e=>({SECT:"",GENIUS:"",TREASURE:"",REALM:"",DISASTER:"",POLITICS:"",DAILY:"",FAMOUS:""})[e]||"",Pj=e=>({SECT:"#4A90E2",GENIUS:"#E74C3C",TREASURE:"#F39C12",REALM:"#9B59B6",DISASTER:"#E67E22",POLITICS:"#16A085",DAILY:"#95A5A6",FAMOUS:"#D4AF37"})[e]||"#7F8C8D",Pg={ready:"#43a047",pending:"#fb8c00"},zj=({summary:e,onUpgrade:t})=>{if(!e)return null;const{currentTier:n,nextTier:s,requirements:o,totals:i,canUpgrade:a,enrichedChildren:l}=e,d=Math.round((i.powerProgress||0)*100),u=[...l].filter(p=>(p.generation||1)<=2).sort((p,c)=>{var m,v;return(((m=c.influence)==null?void 0:m.score)||0)-(((v=p.influence)==null?void 0:v.score)||0)}).slice(0,3);return r.jsxs("div",{style:tt.wrapper,children:[r.jsxs("div",{style:tt.headerRow,children:[r.jsxs("div",{children:[r.jsx("div",{style:tt.label,children:""}),r.jsx("div",{style:tt.currentTier,children:(n==null?void 0:n.name)||""}),r.jsx("div",{style:tt.desc,children:n==null?void 0:n.desc})]}),r.jsxs("div",{style:tt.metricsBox,children:[r.jsxs("div",{style:tt.metricItem,children:[r.jsx("span",{style:tt.metricLabel,children:""}),r.jsx("strong",{style:tt.metricValue,children:i.population})]}),r.jsxs("div",{style:tt.metricItem,children:[r.jsx("span",{style:tt.metricLabel,children:""}),r.jsx("strong",{style:tt.metricValue,children:i.ratingScore})]}),r.jsxs("div",{style:tt.metricItem,children:[r.jsx("span",{style:tt.metricLabel,children:""}),r.jsx("strong",{style:tt.metricValue,children:i.sovereignCount})]}),r.jsxs("div",{style:tt.metricItem,children:[r.jsx("span",{style:tt.metricLabel,children:""}),r.jsx("strong",{style:tt.metricValue,children:i.population-l.length})]})]})]}),s?r.jsxs("div",{style:tt.progressSection,children:[r.jsxs("div",{style:tt.progressHeader,children:[r.jsxs("div",{children:[r.jsxs("div",{style:tt.nextLabel,children:["",s.name]}),r.jsx("small",{style:{color:"#cfd8dc"},children:s.desc})]}),r.jsxs("span",{style:{fontWeight:"bold",color:"#fff"},children:[d,"%"]})]}),r.jsx("div",{style:tt.progressBarBg,children:r.jsx("div",{style:{...tt.progressBarFill,width:`${Math.min(100,d)}%`}})})]}):r.jsx("div",{style:tt.progressSection,children:r.jsx("div",{style:tt.nextLabel,children:""})}),(o==null?void 0:o.length)>0&&r.jsx("div",{style:tt.requirementsGrid,children:o.map(p=>{const c=p.met;return r.jsxs("div",{style:tt.requirementCard,children:[r.jsx("div",{style:{...tt.requirementBadge,backgroundColor:c?Pg.ready:Pg.pending},children:c?"":""}),r.jsxs("div",{children:[r.jsx("div",{style:tt.requirementLabel,children:p.label}),r.jsxs("div",{style:tt.requirementValue,children:[p.current," / ",p.required]})]})]},p.label)})}),u.length>0&&r.jsxs("div",{children:[r.jsx("div",{style:tt.label,children:""}),r.jsx("div",{style:tt.contributorRow,children:u.map(p=>{var c,m,v;return r.jsxs("div",{style:tt.contributorCard,children:[r.jsx("div",{style:{...tt.contributorBadge,color:((c=p.influence)==null?void 0:c.color)||"#fff"},children:(m=p.influence)==null?void 0:m.label}),r.jsx("div",{style:tt.contributorName,children:p.name}),r.jsx("div",{style:tt.contributorScore,children:((v=p.influence)==null?void 0:v.score)||0})]},p.id)})})]}),r.jsx("button",{onClick:t,disabled:!a,style:{...tt.actionBtn,background:a?"linear-gradient(120deg, #ffb300, #ff7043)":"#455a64"},children:s?a?` ${s.name}`:"":""})]})},tt={wrapper:{background:"linear-gradient(135deg, #1f1f2b 0%, #2f2f44 100%)",borderRadius:16,padding:20,color:"#eceff1",marginBottom:20,border:"1px solid rgba(255,255,255,0.1)"},headerRow:{display:"flex",justifyContent:"space-between",gap:20,flexWrap:"wrap"},label:{fontSize:12,letterSpacing:1,textTransform:"uppercase",color:"#90a4ae"},currentTier:{fontSize:24,fontWeight:700},desc:{marginTop:4,fontSize:13,color:"#b0bec5"},metricsBox:{display:"flex",gap:12,flexWrap:"wrap",justifyContent:"flex-end"},metricItem:{minWidth:90,padding:"8px 12px",borderRadius:10,background:"rgba(255,255,255,0.08)",textAlign:"center",fontSize:12,display:"flex",flexDirection:"column",gap:4},metricLabel:{color:"#cfd8dc",fontSize:11,letterSpacing:1},metricValue:{fontSize:20,fontWeight:700,color:"#fff"},progressSection:{marginTop:16},nextLabel:{fontSize:14,fontWeight:600},progressHeader:{display:"flex",justifyContent:"space-between",marginBottom:6},progressBarBg:{width:"100%",height:10,borderRadius:999,background:"rgba(255,255,255,0.15)",overflow:"hidden"},progressBarFill:{height:"100%",background:"linear-gradient(90deg, #42a5f5, #7e57c2)"},requirementsGrid:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(150px, 1fr))",gap:12,marginTop:16},requirementCard:{display:"flex",gap:10,alignItems:"center",padding:"10px 12px",borderRadius:12,background:"rgba(255,255,255,0.08)"},requirementBadge:{width:32,height:32,borderRadius:10,display:"flex",alignItems:"center",justifyContent:"center",fontWeight:700,color:"#fff"},requirementLabel:{fontSize:12,color:"#cfd8dc"},requirementValue:{fontSize:14,fontWeight:600},contributorRow:{display:"flex",gap:12,marginTop:8,flexWrap:"wrap"},contributorCard:{flex:"1 1 120px",minWidth:120,background:"rgba(0,0,0,0.25)",borderRadius:12,padding:12},contributorBadge:{fontSize:12,fontWeight:700},contributorName:{marginTop:4,fontSize:16,fontWeight:600},contributorScore:{fontSize:13,color:"#b0bec5"},actionBtn:{width:"100%",marginTop:16,border:"none",borderRadius:999,padding:"12px 0",fontSize:14,fontWeight:600,color:"#1f1f2b",cursor:"pointer"}},Dj=["","","",""],Fj=["","","","","","","","","","","","","",""],Hj=["","","","","","","","","","","","","","","",""],Wj=["","","","","",""],Uj="init-log",mu=10,Il=(e="",t=[])=>{if(!e)return!1;const n=String(e);return t.some(s=>s&&n.includes(s))},gu=e=>{if(!e||typeof e!="object")return"DAILY";const t=String(e.category||""),n=String(e.title||""),s=String(e.message||""),o=`${n}${s}`,i=String(e.type||"DAILY"),a=String(e.id||""),l=typeof e.turn=="number"?e.turn:-1;return Il(t,Dj)?"WORLD":i==="DAILY"||Il(o,Wj)?"DAILY":a&&a.startsWith(Uj)||l===0||Il(t,Fj)||Il(o,Hj)||i&&i!=="DAILY"?"MAJOR":"DAILY"},Gj=({logs:e,ratingSummary:t,onUpgradeRating:n})=>{const[s,o]=b.useState("ALL"),[i,a]=b.useState(()=>new Set),[l,d]=b.useState(0),u=b.useMemo(()=>Array.isArray(e)?e.map((w,E)=>({...w,id:w.id||`log-${E}-${w.turn||0}`,message:w.message||w.summary||"",title:w.title||"",turn:typeof w.turn=="number"?w.turn:0,type:w.type||"DAILY",category:w.category||"",details:w.details||"",timestamp:w.timestamp||Date.now()})):[],[e]),p=b.useMemo(()=>s==="ALL"?u:u.filter(w=>gu(w)===s),[u,s]),c=b.useMemo(()=>Math.max(1,Math.ceil(p.length/mu)),[p.length]),m=b.useMemo(()=>{const w=l*mu;return p.slice(w,w+mu)},[p,l]),v=b.useMemo(()=>{const w={all:u.length,daily:0,major:0,world:0};return u.forEach(E=>{const S=gu(E);S==="WORLD"?w.world+=1:S==="MAJOR"?w.major+=1:w.daily+=1}),w},[u]);return b.useEffect(()=>{d(0)},[s,e.length]),r.jsxs("div",{style:mt.container,children:[t&&r.jsx("div",{style:mt.ratingSection,children:r.jsx(zj,{summary:t,onUpgrade:n})}),r.jsx("h3",{style:mt.title,children:" "}),r.jsxs("div",{style:mt.filterBar,children:[r.jsxs("button",{style:{...mt.filterBtn,...s==="ALL"?mt.filterBtnActive:{}},onClick:()=>o("ALL"),children:["  (",v.all,")"]}),r.jsxs("button",{style:{...mt.filterBtn,...s==="DAILY"?mt.filterBtnActive:{}},onClick:()=>o("DAILY"),children:["  (",v.daily,")"]}),r.jsxs("button",{style:{...mt.filterBtn,...s==="MAJOR"?mt.filterBtnActive:{}},onClick:()=>o("MAJOR"),children:["  (",v.major,")"]}),r.jsxs("button",{style:{...mt.filterBtn,...s==="WORLD"?mt.filterBtnActive:{}},onClick:()=>o("WORLD"),children:["  (",v.world,")"]})]}),r.jsxs("div",{style:mt.logWindow,children:[p.length===0?r.jsx("p",{style:{color:"#999"},children:"..."}):null,m.map((w,E)=>{const S=gu(w),g=S==="WORLD",h=S==="MAJOR";let x="",k="#8B4513";g?(x=Oj(w.type),k=Pj(w.type)):h&&(x="",k="#b45309");const _=w.id||`log-${w.timestamp||Date.now()}-${w.turn||0}`,y=!!w.details,R=y&&i.has(_),C=w.title||w.message||"",I=()=>{y&&a(O=>{const H=new Set(O);return H.has(_)?H.delete(_):H.add(_),H})},T=3572,L=typeof w.turn=="number"&&w.turn>=0?w.turn:0,ee=T+Math.floor(L/12),$=L%12||12;return r.jsxs("div",{style:mt.logItem,children:[r.jsxs("div",{style:mt.logHeader,children:[r.jsxs("span",{style:{...mt.turn,color:k},children:[x," [ ",ee," ",$,"]"]}),(g||h)&&w.title&&r.jsx("span",{style:mt.eventTag,children:String(w.title).substring(0,40)})]}),y?r.jsxs(r.Fragment,{children:[r.jsxs("div",{style:mt.summaryRow,children:[r.jsx("span",{style:mt.summaryText,children:String(C).substring(0,100)}),r.jsx("button",{style:mt.toggleBtn,onClick:I,children:R?"":""})]}),R&&r.jsx("div",{style:mt.detailContent,children:String(w.details||"")})]}):r.jsx("div",{style:mt.logContent,children:String(w.message||"")})]},_)})]}),r.jsxs("div",{style:mt.footer,children:[r.jsxs("div",{style:mt.paginationBar,children:[r.jsx("button",{style:{...mt.pageBtn,...l<=0?mt.pageBtnDisabled:{}},onClick:()=>d(w=>Math.max(0,w-1)),disabled:l<=0,children:""}),r.jsxs("span",{style:mt.pageInfo,children:[" ",l+1," / ",c," "]}),r.jsx("button",{style:{...mt.pageBtn,...l>=c-1?mt.pageBtnDisabled:{}},onClick:()=>d(w=>Math.min(c-1,w+1)),disabled:l>=c-1,children:""})]}),r.jsxs("span",{style:{fontSize:"11px",color:"#666"},children:[" ",p.length," "]})]})]})},mt={container:{width:"calc(100% - 30px)",maxWidth:"800px",margin:"20px auto 150px auto",border:"1px solid #ccc",borderRadius:"8px",backgroundColor:"#fff",fontFamily:'"KaiTi", serif',display:"flex",flexDirection:"column",minHeight:"500px",pointerEvents:"auto"},ratingSection:{padding:"12px",borderBottom:"1px solid rgba(0,0,0,0.05)"},title:{margin:"0",padding:"10px",backgroundColor:"#f5f5f5",borderBottom:"1px solid #eee",fontSize:"16px"},filterBar:{display:"flex",gap:"5px",padding:"8px",backgroundColor:"#fafafa",borderBottom:"1px solid #eee",pointerEvents:"auto"},filterBtn:{flex:1,padding:"6px 8px",fontSize:"12px",border:"1px solid #ddd",borderRadius:"4px",backgroundColor:"#fff",cursor:"pointer",transition:"all 0.2s",fontFamily:"inherit",pointerEvents:"auto"},filterBtnActive:{backgroundColor:"#4A90E2",color:"#fff",border:"1px solid #4A90E2",fontWeight:"bold"},logWindow:{flex:1,minHeight:"300px",maxHeight:"500px",overflowY:"auto",padding:"10px",fontSize:"13px",pointerEvents:"auto"},logItem:{marginBottom:"10px",borderBottom:"1px dashed #eee",paddingBottom:"6px",pointerEvents:"auto"},logHeader:{display:"flex",alignItems:"center",gap:"6px",marginBottom:"3px",pointerEvents:"auto"},turn:{fontWeight:"bold",fontSize:"12px"},eventTag:{fontSize:"10px",padding:"2px 6px",backgroundColor:"#f0f0f0",borderRadius:"3px",color:"#666"},logContent:{lineHeight:"1.5",color:"#333",whiteSpace:"pre-wrap"},summaryRow:{display:"flex",justifyContent:"space-between",alignItems:"center",gap:"8px",padding:"4px 0",pointerEvents:"auto"},summaryText:{fontWeight:600,fontSize:"13px",flex:1,color:"#333",pointerEvents:"auto"},toggleBtn:{border:"1px solid #ccc",borderRadius:"999px",padding:"2px 10px",backgroundColor:"#fff",fontSize:"11px",cursor:"pointer",pointerEvents:"auto"},detailContent:{lineHeight:"1.6",color:"#444",backgroundColor:"#fafafa",borderRadius:"6px",padding:"8px 10px",border:"1px solid rgba(0,0,0,0.05)",whiteSpace:"pre-wrap",pointerEvents:"auto"},footer:{padding:"12px 10px",backgroundColor:"#f5f5f5",borderTop:"2px solid #d32f2f",textAlign:"center",pointerEvents:"auto",flexShrink:0,minHeight:"60px",display:"flex",flexDirection:"column",justifyContent:"center",gap:"6px"},paginationBar:{display:"flex",justifyContent:"center",alignItems:"center",gap:"10px",marginBottom:"6px"},pageBtn:{padding:"6px 14px",border:"2px solid #d32f2f",borderRadius:"6px",backgroundColor:"#fff",cursor:"pointer",fontSize:"13px",fontWeight:"bold",color:"#d32f2f",transition:"all 0.2s",pointerEvents:"auto"},pageBtnDisabled:{backgroundColor:"#f0f0f0",cursor:"not-allowed",color:"#999",borderColor:"#ccc"},pageInfo:{fontSize:"12px",color:"#666"}};class ss{static onChildBirth(t,n,s={}){jn(t);const o=Lg(t,n,s);return wo(t,{description:`${n.name}`,affectionChange:0,context:`${s.difficulty===""?"":""}`}),console.log(`[] ${t.name} : ${n.name}`),o}static onMarriage(t,n=""){jn(t);const s=sj(t,n);return wo(t,{description:"",affectionChange:30,context:""}),console.log(`[] ${t.name} `),s}static onReceiveGift(t,n,s){jn(t);const o=wo(t,{description:`${n.name}`,affectionChange:s,context:n.tier>=3?"":""});return Math.abs(s)>=20&&Vo(t,{event:`${n.name}`,detail:`${n.name}`,emotionalImpact:Qs.SIGNIFICANT,category:"relationship",tags:["",n.name,""]}),o}static onCombatTogether(t,n,s=!1){return jn(t),s?oj(t,`${n}`):wo(t,{description:`${n}`,affectionChange:5,context:""})}static onBreakthrough(t,n){return jn(t),Vo(t,{event:`${n}`,detail:`${n}`,emotionalImpact:Qs.PROFOUND,category:"cultivation",tags:["","",n]})}static onPregnancyStart(t){return jn(t),wo(t,{description:"",affectionChange:15,context:""})}static onChildJoinSect(t,n,s){return jn(t),wo(t,{description:`${n.name}${s}`,affectionChange:0,context:""})}static onChildMarriage(t,n,s){return jn(t),Vo(t,{event:`${n.name}`,detail:`${n.name}${s}`,emotionalImpact:Qs.SIGNIFICANT,category:"family",tags:["","",n.name]})}static initializeAllNpcs(t){t.forEach(n=>{jn(n)}),console.log(`[]  ${t.length}  NPC `)}static backfillChildrenMemories(t,n){jn(t),n.forEach(s=>{t.memories.milestones.some(i=>i.tags.includes(s.name))||(Lg(t,s,{difficulty:"",sacrifice:!1}),console.log(`[]  ${t.name}  ${s.name} `))})}static getMemorySummary(t){return t.memories||jn(t),{milestoneCount:t.memories.milestones.length,milestones:t.memories.milestones,recentEventCount:t.memories.recentEvents.length,recentEvents:t.memories.recentEvents,longTermSummary:t.memories.longTermSummary,totalEvents:t.memories.meta.totalEvents}}static clearAllMemories(t){t.memories&&(t.memories.milestones=[],t.memories.recentEvents=[],t.memories.longTermSummary="",t.memories.meta.totalEvents=0,console.log(`[]  ${t.name} `))}}const Vj=e=>{const{identity:t,personality:n,stats:s,relationship:o}=e,i=typeof n=="object"&&n!==null&&"label"in n?n.label:Array.isArray(n)?n[0]:"",a=s.aptitude&&s.aptitude>=90,l=(o==null?void 0:o.jealousy)||0;if(l>=60)return yu(e,l,i);if(l>=40&&Math.random()<.5)return yu(e,l,i);if(l>=20&&Math.random()<.2)return yu(e,l,i);if(a){const p=["","",""];return p[Math.floor(Math.random()*p.length)]}const d={:["","","",""],:["","","",""],:["","","",""],:["","","",""],:["","","",""],:["","","",""],:["","","",""],:["","","",""],:["","","",""],:["","","",""],:["","","",""],:["","","",""],:["","","",""],:["","","",""],:["","","",""],:["","","",""],:["","","",""],:["","","",""],:["","","",""],:["","","",""]};if(Math.random()>.5||!d[t])switch(i){case"":return"";case"":return"";case"":return"";case"":return"";case"":return"";case"":return"";default:return""}const u=d[t]||[""];return u[Math.floor(Math.random()*u.length)]},Yj=(e,t)=>{const n=typeof e.personality=="object"&&e.personality!==null&&"label"in e.personality?e.personality.label:Array.isArray(e.personality)?e.personality[0]:"",s=e.likes&&e.likes.includes(t.name);let o=t.value,i="";if(e.identity==="")return t.name&&/|||/i.test(t.name)||t.tags&&t.tags.includes("scripture")?(o=Math.floor(t.value*3),i=`${e.name} `,{msg:i,change:o}):{msg:`${e.name} `,change:0};if(t.value<10&&(["","",""].includes(n)||[""].includes(e.identity)))return{msg:`${e.name} ${t.name}`,change:-5};if(s)o*=2,i=`${e.name} ${t.name}`;else if(n===""&&t.cost>=300)o*=1.5,i=`${e.name} ${t.name}`;else switch(n){case"":i=`${e.name} `;break;case"":i=`${e.name} `;break;case"":i=`${e.name} `;break;default:i=`${e.name} ${t.name}`}return{msg:i,change:Math.floor(o)}},qj=[{title:"",text:e=>`${e}${e}""`,affectionBonus:5},{title:"",text:e=>`${e}${e}""`,affectionBonus:5},{title:"",text:e=>`${e}${e}""`,affectionBonus:8},{title:"",text:e=>`${e}${e}""`,affectionBonus:6},{title:"",text:e=>`${e}${e}${e}""`,affectionBonus:10},{title:"",text:e=>`${e}"......"${e}""`,affectionBonus:12,requirePregnant:!0},{title:"",text:e=>`${e}${e}"..."${e}"..."`,affectionBonus:13,requirePregnant:!0}],Kj=[{title:"",text:e=>`${e}${e}""`,affectionBonus:6},{title:"",text:e=>`${e}${e}${e}""`,affectionBonus:7},{title:"",text:e=>`""${e}""`,affectionBonus:8},{title:"",text:e=>`${e}${e}""`,affectionBonus:7},{title:"",text:e=>`${e}""${e}""`,affectionBonus:5},{title:"",text:e=>`${e}"......"`,affectionBonus:10,requirePregnant:!0},{title:"",text:e=>`${e}"..."${e}"..."`,affectionBonus:11,requirePregnant:!0}],zg=[{title:"",text:e=>`${e}${e}""`,affectionBonus:6},{title:"",text:e=>`${e}""`,affectionBonus:7},{title:"",text:e=>`${e}""`,affectionBonus:8},{title:"",text:e=>`${e}""`,affectionBonus:5},{title:"",text:e=>`${e}${e}""`,affectionBonus:9},{title:"",text:e=>`${e}"..."`,affectionBonus:12,requirePregnant:!0},{title:"",text:e=>`${e}"..."${e}"..."`,affectionBonus:14,requirePregnant:!0}],Qj=[{title:"",text:e=>`${e}${e}""`,affectionBonus:6},{title:"",text:e=>`${e}""`,affectionBonus:7},{title:"",text:e=>`${e}""${e}`,affectionBonus:6},{title:"",text:e=>`${e}${e}""`,affectionBonus:5},{title:"",text:e=>`${e}${e}""`,affectionBonus:8},{title:"",text:e=>`${e}"......"`,affectionBonus:13,requirePregnant:!0},{title:"",text:e=>`${e}"...""..."`,affectionBonus:12,requirePregnant:!0}],Dg=[{title:"",text:(e,t)=>`${e}""`,affectionBonus:8},{title:"",text:(e,t)=>`${e}""`,affectionBonus:10},{title:"",text:(e,t)=>`${e}${e}""`,affectionBonus:7},{title:"",text:(e,t)=>`${e}""`,affectionBonus:6},{title:"",text:(e,t)=>`${e}${e}""`,affectionBonus:9}],Jj=[{title:"",text:(e,t)=>`${e}${e}""`,affectionBonus:8},{title:"",text:(e,t)=>`${e}${e}"${t===""?"":""}"`,affectionBonus:6},{title:"",text:(e,t)=>`${e}""`,affectionBonus:10},{title:"",text:(e,t)=>`${e}""${e}`,affectionBonus:4},{title:"",text:(e,t)=>`${e}""`,affectionBonus:9}],Xj=[{title:"",text:(e,t)=>`${e}${e}""`,affectionBonus:10},{title:"",text:(e,t)=>`${e}""`,affectionBonus:12},{title:"",text:(e,t)=>`${e}${e}${e}""`,affectionBonus:15},{title:"",text:(e,t)=>`${e}""`,affectionBonus:11},{title:"",text:(e,t)=>`${e}""`,affectionBonus:10}],Fg=(e,t)=>{let n=zg;switch(e){case"COLD":n=qj;break;case"YANDERE":n=Kj;break;case"GENTLE":n=zg;break;case"FLIRTY":n=Qj;break}const s=n.filter(i=>!(i.requirePregnant&&!t.isPregnant));if(s.length===0)return null;const o=s[Math.floor(Math.random()*s.length)];return{title:o.title,text:o.text(t.name),affectionBonus:o.affectionBonus}},Zj=(e,t,n="")=>{let s=Dg;switch(e){case"TODDLER":s=Dg;break;case"TEEN":s=Jj;break;case"ADULT":s=Xj;break}const o=s[Math.floor(Math.random()*s.length)];return{title:o.title,text:o.text(t.name,n),affectionBonus:o.affectionBonus}},e5=[{title:"",text:e=>`${e}""`,affectionBonus:5},{title:"",text:e=>`${e}""`,affectionBonus:7},{title:"",text:e=>`${e}${e}${e}""`,affectionBonus:10}],t5=[{title:"",text:e=>`${e}${e}""`,affectionBonus:4},{title:"",text:e=>`${e}""`,affectionBonus:8},{title:"",text:e=>`${e}${e}${e}""`,affectionBonus:9}],n5=[{title:"",text:e=>`${e}${e}${e}""`,affectionBonus:10},{title:"",text:e=>`${e}""`,affectionBonus:12},{title:"",text:e=>`${e}${e}""`,affectionBonus:8}],r5=[{title:"",text:e=>`${e}${e}""`,affectionBonus:6},{title:"",text:e=>`${e}${e}"..."`,affectionBonus:5,minAffection:40},{title:"",text:e=>`${e}""`,affectionBonus:10,minAffection:60},{title:"",text:e=>`${e}${e}"..."`,affectionBonus:8,minAffection:70},{title:"",text:e=>`${e}""${e}""`,affectionBonus:15,minAffection:80},{title:"",text:e=>`${e}"..."${e}`,affectionBonus:12,minAffection:85},{title:"",text:e=>`${e}${e}"......"${e}`,affectionBonus:20,minAffection:90},{title:"",text:e=>`${e}"..."${e}`,affectionBonus:15,minAffection:95}],s5=[{title:"",text:e=>`${e}${e}${e}""`,affectionBonus:10},{title:"",text:e=>`${e}${e}${e}${e}""`,affectionBonus:8},{title:"",text:e=>`${e}""${e}`,affectionBonus:15}],o5=[{title:"",text:e=>`${e}${e}""`,affectionBonus:5},{title:"",text:e=>`${e}${e}${e}""`,affectionBonus:9},{title:"",text:e=>`${e}${e}""`,affectionBonus:11}],i5=[{title:"",text:e=>`${e}${e}""`,affectionBonus:12},{title:"",text:e=>`${e}${e}""`,affectionBonus:10},{title:"",text:e=>`${e}${e}${e}${e}""`,affectionBonus:8}],hu=(e,t)=>{var a;let n=[];switch(e){case"":n=e5;break;case"":n=t5;break;case"":case"":n=n5;break;case"":n=r5;break;case"":n=s5;break;case"":n=o5;break;case"":n=i5;break;default:return null}if(n.length===0)return null;const s=((a=t.relationship)==null?void 0:a.affection)||0,o=n.filter(l=>!(l.minAffection&&s<l.minAffection));if(o.length===0)return null;const i=o[Math.floor(Math.random()*o.length)];return{title:i.title,text:i.text(t.name),affectionBonus:i.affectionBonus}},xu=(e,t)=>{var a;if(e.isChild){if(Math.random()<.25){let l="TODDLER";return e.age>=18?l="ADULT":e.age>=11&&(l="TEEN"),Zj(l,e,(t==null?void 0:t.gender)||"")}return null}if(Math.random()>=.3)return null;const s=((a=e.relationship)==null?void 0:a.affection)||0,o=typeof e.personality=="object"&&e.personality!==null&&"label"in e.personality?e.personality.label:Array.isArray(e.personality)?e.personality[0]:"";if(s>=80){if(Math.random()<.7){let d="GENTLE";return["","","",""].includes(o)?d="COLD":["","","",""].includes(o)?d="YANDERE":["","","",""].includes(o)?d="FLIRTY":["","","","",""].includes(o)&&(d="GENTLE"),Fg(d,e)}const l=hu(e.identity,e);return l||null}if(s>=60){if(Math.random()<.5){let d="GENTLE";return["","","",""].includes(o)?d="COLD":["","","",""].includes(o)?d="YANDERE":["","","",""].includes(o)?d="FLIRTY":["","","","",""].includes(o)&&(d="GENTLE"),Fg(d,e)}const l=hu(e.identity,e);return l||null}const i=hu(e.identity,e);return i||null};function yu(e,t,n){if(e.name,t>=61){const i={:["...","...","..."],:["","...",""],:["...","",""],:["......","...","......"],:["...","...","..."],:["...","","..."]},a=i[n]||i.;return a[Math.floor(Math.random()*a.length)]}if(t>=41){const i={:["...","...","..."],:["","","..."],:["...","","..."],:["...","","......"],:["...","...","..."],:["","...","..."]},a=i[n]||i.;return a[Math.floor(Math.random()*a.length)]}const s={:["...","...","..."],:["","","..."],:["...","","..."],:["...","......","..."],:["","","..."],:["","","..."]},o=s[n]||s.;return o[Math.floor(Math.random()*o.length)]}const a5=(e,t,n)=>{const s=typeof e.personality=="object"&&e.personality!==null&&"label"in e.personality?e.personality.label:Array.isArray(e.personality)?e.personality[0]:"",o=e.identity||"",i=e.name;return n?l5(i,s,o,t):c5(i,s,o,t)};function l5(e,t,n,s){var d;const o=`${t}_${n}_${s.id}`,i=Eo[o];if(i)return i(e);const a=Eo[`${t}_${s.id}`];if(a)return a(e);const l=Eo[`${n}_${s.id}`];return l?l(e):((d=Eo[`default_${s.id}`])==null?void 0:d.call(Eo,e))||`${e} ""`}const Eo={_PROFIT:e=>`${e} ""`,__PROFIT:e=>`${e} ""`,__PROFIT:e=>`${e} ""`,__PROFIT:e=>`${e} ""`,_PROFIT:e=>`${e} ""`,__PROFIT:e=>`${e} ""`,__PROFIT:e=>`${e} ""`,__PROFIT:e=>`${e} ""`,_PROFIT:e=>`${e} ""`,__PROFIT:e=>`${e} ""`,__PROFIT:e=>`${e} ""`,_PROFIT:e=>`${e} ""`,__PROFIT:e=>`${e} ""`,_PROFIT:e=>`${e} ""`,__PROFIT:e=>`${e} "~"`,_PROFIT:e=>`${e} ""`,__PROFIT:e=>`${e} ""`,_PROFIT:e=>`${e} ""`,__PROFIT:e=>`${e} ""`,_PROFIT:e=>`${e} "''"`,__PROFIT:e=>`${e} ""`,_PROFIT:e=>`${e} ""`,__PROFIT:e=>`${e} ""`,_PROFIT:e=>`${e} ""`,_PROFIT:e=>`${e} "~"`,_PROFIT:e=>`${e} ""`,_PROFIT:e=>`${e} "~"`,_PROFIT:e=>`${e} ""`,_PROFIT:e=>`${e} ""`,_PROFIT:e=>`${e} ""`,_PROFIT:e=>`${e} "~"`,_EMOTION:e=>`${e} """"`,__EMOTION:e=>`${e} ""`,__EMOTION:e=>`${e} ""`,_EMOTION:e=>`${e} ""`,__EMOTION:e=>`${e} ""`,__EMOTION:e=>`${e} ""`,_EMOTION:e=>`${e} ""`,__EMOTION:e=>`${e} ""`,_EMOTION:e=>`${e} ""`,__EMOTION:e=>`${e} ""`,_EMOTION:e=>`${e} ""`,__EMOTION:e=>`${e} ""`,_EMOTION:e=>`${e} ""`,__EMOTION:e=>`${e} ""`,_EMOTION:e=>`${e} ""`,__EMOTION:e=>`${e} ""`,_EMOTION:e=>`${e} ""`,_EMOTION:e=>`${e} ""`,_EMOTION:e=>`${e} ""`,_EMOTION:e=>`${e} "~"`,_EMOTION:e=>`${e} ""`,_EMOTION:e=>`${e} "~"`,_EMOTION:e=>`${e} ""`,_EMOTION:e=>`${e} ""`,_EMOTION:e=>`${e} ""`,_REASON:e=>`${e} ""`,__REASON:e=>`${e} ""`,_REASON:e=>`${e} ""`,__REASON:e=>`${e} ""`,__REASON:e=>`${e} ""`,_REASON:e=>`${e} ""`,__REASON:e=>`${e} ""`,_REASON:e=>`${e} ""`,_REASON:e=>`${e} ""`,_REASON:e=>`${e} ""`,_REASON:e=>`${e} "~"`,_REASON:e=>`${e} ""`,_REASON:e=>`${e} ""`,_REASON:e=>`${e} ""`,_REASON:e=>`${e} "~"`,_REASON:e=>`${e} ""`,_REASON:e=>`${e} ""`,_REASON:e=>`${e} ""`,_REASON:e=>`${e} ""`,_EMOTION:e=>`${e} ""`,_REASON:e=>`${e} ""`,_EMOTION:e=>`${e} ""`,_REASON:e=>`${e} ""`,_EMOTION:e=>`${e} ""`,_REASON:e=>`${e} ""`,_EMOTION:e=>`${e} ""`,_REASON:e=>`${e} ""`,_EMOTION:e=>`${e} ""`,_PROFIT:e=>`${e} ""`,_EMOTION:e=>`${e} ""`,_REASON:e=>`${e} ""`,_EMOTION:e=>`${e} ""`,_REASON:e=>`${e} ""`,_EMOTION:e=>`${e} ""`,_EMOTION:e=>`${e} ""`,_REASON:e=>`${e} ""`,_REASON:e=>`${e} ""`,_EMOTION:e=>`${e} ""`,default_PROFIT:e=>`${e} ""`,default_EMOTION:e=>`${e} ""`,default_REASON:e=>`${e} ""`};function c5(e,t,n,s){var d;const o=`${t}_${n}_${s.id}`,i=ko[o];if(i)return i(e);const a=ko[`${t}_${s.id}`];if(a)return a(e);const l=ko[`${n}_${s.id}`];return l?l(e):((d=ko[`default_${s.id}`])==null?void 0:d.call(ko,e))||`${e} ""`}const ko={_PROFIT:e=>`${e} ""`,__PROFIT:e=>`${e} ""`,__PROFIT:e=>`${e} ""`,_PROFIT:e=>`${e} ""`,__PROFIT:e=>`${e} ""`,_PROFIT:e=>`${e} ""`,__PROFIT:e=>`${e} ""`,_PROFIT:e=>`${e} ""`,__PROFIT:e=>`${e} ""`,_PROFIT:e=>`${e} ""`,_REASON:e=>`${e} ""`,_PROFIT:e=>`${e} ""`,_PROFIT:e=>`${e} ""`,_PROFIT:e=>`${e} ""`,_PROFIT:e=>`${e} "~~"`,_PROFIT:e=>`${e} ""`,_PROFIT:e=>`${e} ""`,_PROFIT:e=>`${e} ""`,_PROFIT:e=>`${e} ""`,_PROFIT:e=>`${e} ""`,_PROFIT:e=>`${e} :""`,_PROFIT:e=>`${e} :""`,_PROFIT:e=>`${e} :"~"`,_EMOTION:e=>`${e} ""`,__EMOTION:e=>`${e} ""`,__EMOTION:e=>`${e} ""`,_EMOTION:e=>`${e} ""`,__EMOTION:e=>`${e} ""`,_EMOTION:e=>`${e} ""`,__EMOTION:e=>`${e} ""`,_EMOTION:e=>`${e} ""`,__EMOTION:e=>`${e} ""`,_EMOTION:e=>`${e} ""`,__EMOTION:e=>`${e} ""`,_EMOTION:e=>`${e} ""`,__EMOTION:e=>`${e} ""`,_EMOTION:e=>`${e} ""`,_EMOTION:e=>`${e} ""`,_EMOTION:e=>`${e} ""`,_EMOTION:e=>`${e} "~"`,_EMOTION:e=>`${e} ""`,_EMOTION:e=>`${e} ""`,_EMOTION:e=>`${e} ""`,_EMOTION:e=>`${e} ""`,_EMOTION:e=>`${e} ""`,_EMOTION:e=>`${e} ""`,_EMOTION:e=>`${e} "~"`,_REASON:e=>`${e} ""`,__REASON:e=>`${e} ""`,_REASON:e=>`${e} ""`,__REASON:e=>`${e} ""`,_REASON:e=>`${e} ""`,_REASON:e=>`${e} ""`,_REASON:e=>`${e} ""`,_REASON:e=>`${e} ""`,_REASON:e=>`${e} ""`,_EMOTION:e=>`${e} ""`,_REASON:e=>`${e} ""`,_REASON:e=>`${e} "~"`,_REASON:e=>`${e} ""`,_REASON:e=>`${e} ""`,_REASON:e=>`${e} ""`,_REASON:e=>`${e} ""`,_REASON:e=>`${e} ""`,_REASON:e=>`${e} :""`,_REASON:e=>`${e} "~"`,_PROFIT:e=>`${e} ""`,_REASON:e=>`${e} ""`,_PROFIT:e=>`${e} ""`,_REASON:e=>`${e} ""`,_EMOTION:e=>`${e} ""`,_REASON:e=>`${e} ""`,_PROFIT:e=>`${e} ""`,_EMOTION:e=>`${e} ""`,_EMOTION:e=>`${e} ""`,_PROFIT:e=>`${e} ""`,default_PROFIT:e=>`${e} ""`,default_EMOTION:e=>`${e} ""`,default_REASON:e=>`${e} ""`},Pi={NONE:{min:0,max:20,label:"",color:"#4caf50"},LOW:{min:21,max:40,label:"",color:"#8bc34a"},MEDIUM:{min:41,max:60,label:"",color:"#ff9800"},HIGH:{min:61,max:80,label:"",color:"#ff5722"},EXTREME:{min:81,max:100,label:"",color:"#f44336"}};function d5(e=0){return e<=20?Pi.NONE:e<=40?Pi.LOW:e<=60?Pi.MEDIUM:e<=80?Pi.HIGH:Pi.EXTREME}function u5(e,t,n){var u,p;const s=((u=e.relationship)==null?void 0:u.affection)||0;if(s<50)return 0;let i={CHAT:5,GIFT:10,SPAR:8,DUAL_CULTIVATION:30}[n]||5;s>=80?i*=2:s>=70?i*=1.5:s>=60&&(i*=1.2);const a=typeof e.personality=="object"&&e.personality!==null&&"label"in e.personality?e.personality.label:Array.isArray(e.personality)?e.personality[0]:"";return i*={:1.8,:1.6,:1.3,:.8,:1.1,:1.2}[a]||1,(((p=e.relationship)==null?void 0:p.jealousy)||0)>=60&&(i*=1.3),Math.floor(i)}function p5(e,t,n,s){const o=[],a={CHAT:.12,GIFT:.18,SPAR:.15,DUAL_CULTIVATION:.08}[s]||.05;return n.forEach(l=>{var c;if(l.id===t.id||l.isDead)return;const d=((c=l.relationship)==null?void 0:c.affection)||0;if(d<50)return;let u=a;d>=80?u*=2:d>=70?u*=1.6:d>=60&&(u*=1.3);const p=typeof l.personality=="object"&&l.personality!==null&&"label"in l.personality?l.personality.label:Array.isArray(l.personality)?l.personality[0]:"";(p===""||p==="")&&(u*=1.3),Math.random()<u&&o.push(l)}),o}function f5(e,t){var i,a;const n=((i=e.relationship)==null?void 0:i.affection)||0;if(n<70)return 0;const s=((a=e.relationship)==null?void 0:a.lastInteraction)||0;if(t-s>=3){let l=5;return n>=90?l=10:n>=80&&(l=8),l}return 0}function Hg(e,t){var l;const n=((l=e.relationship)==null?void 0:l.jealousy)||0;if(n===0)return 0;const s=2,o=typeof e.personality=="object"&&e.personality!==null&&"label"in e.personality?e.personality.label:Array.isArray(e.personality)?e.personality[0]:"",a=Math.floor(s*({:.5,:.6,:1.2,:1.5,:.8}[o]||1));return Math.min(a,n)}function m5(e){const t=e.filter(a=>{var u,p;if(a.isDead)return!1;const l=((u=a.relationship)==null?void 0:u.jealousy)||0,d=((p=a.relationship)==null?void 0:p.affection)||0;return l>=60&&d>=70});if(t.length<2)return null;const i=Math.min(.2,.05+t.length*.05);return Math.random()<i?{type:"SHURA_FIELD",participants:t,triggerChance:i}:null}function g5(e,t){const n=t.name;t.gender;const s=[...e].sort((m,v)=>{var S,g;const w=((S=m.relationship)==null?void 0:S.jealousy)||0;return(((g=v.relationship)==null?void 0:g.jealousy)||0)-w}),o=s[0],i=s[1],a=s.slice(2),l=typeof o.personality=="object"&&o.personality!==null&&"label"in o.personality?o.personality.label:Array.isArray(o.personality)?o.personality[0]:"",d=typeof i.personality=="object"&&i.personality!==null&&"label"in i.personality?i.personality.label:Array.isArray(i.personality)?i.personality[0]:"";let u="";e.length===2?u=`

${o.name}${i.name}...`:u=`

${o.name}${i.name}${a.length>0?""+a.map(m=>m.name).join(""):""}...`;const p=[];l===""?p.push({speaker:o.name,text:`${n}...`}):l===""?p.push({speaker:o.name,text:`${n}`}):l===""?p.push({speaker:o.name,text:`${n}`}):p.push({speaker:o.name,text:`${n}${i.name}...`}),d===""?p.push({speaker:i.name,text:`${o.name}${n}...`}):d===""?p.push({speaker:i.name,text:`${o.name}${n}`}):d===""?p.push({speaker:i.name,text:`.........${n}...`}):p.push({speaker:i.name,text:`${n}`}),a.length>0&&p.push({speaker:a[0].name,text:`${n}`});const c=[{label:`${o.name}`,hint:`${o.name}`,effect:"FAVOR_NPC1"},{label:`${i.name}`,hint:`${i.name}`,effect:"FAVOR_NPC2"},{label:"",hint:"",effect:"MEDIATE"},{label:"",hint:"",effect:"HONEST"},{label:"",hint:"",effect:"AVOID"}];return{type:"SHURA_FIELD",participants:s,description:u,dialogues:p,options:c}}function Nr(e,t,n,s={}){const o=typeof e.personality=="object"&&e.personality!==null&&"label"in e.personality?e.personality.label:Array.isArray(e.personality)?e.personality[0]:"";e.identity;const i=t.name,a=t.gender===""?"":"",l={:`...${i}${i}`,:`...${i}${a}${a}`,:`${i}...`,:`${i}.........`,:`${i}${a}...`,:`${i}...`,:`...${i}""...`,:`${i}......`,:`${i}${a}...`,:`...${i}${a}...`},d={:`${i}...${a}`,:`...${i}...`,:`${i}...${a}`,:`${i}.........`,:`${i}${a}${a}`,:`${i}...`,:`${i}...`,:`${i}...${a}`,:`...${i}...`},u={:`${i}${s.favoredName}...${a}...`,:`${i}${s.favoredName}`,:`${i}${a}...${a}`,:`${i}${s.favoredName}......`,:`${i}${s.favoredName}`,:`${i}......`,:`${i}${s.favoredName}...`,:`${i}...${a}${a}...`,:`${i}${a}${a}`,:`...${i}${s.favoredName}${a}${s.favoredGender===""?"":""}`},p={:`${i}...${a}`,:`${i}...${a}`,:`${i}...`,:`${i}...${a}...`,:`${i}${a}`,:`${i}...`,:`${i}...${a}...`,:`${i}...`},c={:`${i}${a}...${a}`,:`${i}...${a}`,:`${i}...${a}`,:`${i}${a}`,:`${i}${a}...${a}`},m={:`${i}${a}${a}...`,:`${i}${a}`,:`${i}...${a}`,:`${i}${a}${a}`,:`${i}...`,:`${i}...${a}${a}...`},v={:`${i}${a}...${a}`,:`${i}...`,:`${i}...${a}`,:`${i}...${a}...`,:`${i}${a}`,:`${i}......`,:`${i}...${a}...`,:`${i}...${a}...`,:`${i}${a}`,:`${i}...${a}`,:`${i}...${a}${a}...`};let w="";switch(n){case"trigger":w=l[o]||l.;break;case"favored":w=d[o]||d.;break;case"neglected":w=u[o]||u.;break;case"mediate":w=p[o]||p.;break;case"honest_understand":w=c[o]||c.;break;case"honest_angry":w=m[o]||m.;break;case"avoid":w=v[o]||v.;break}return w}function h5(e,t,n){const s={changes:[],message:"",npcLogs:[]};switch(t.effect){case"FAVOR_NPC1":s.changes.push({npcId:e.participants[0].id,jealousyChange:-20,affectionChange:5}),s.changes.push({npcId:e.participants[1].id,jealousyChange:10,affectionChange:-5}),e.participants.slice(2).forEach(o=>{s.changes.push({npcId:o.id,jealousyChange:10,affectionChange:-3})}),s.message=`${e.participants[0].name}${e.participants[0].gender===""?"":""}...`,s.npcLogs.push({npcId:e.participants[0].id,content:Nr(e.participants[0],n,"favored"),type:"DAILY",isSecret:!0}),s.npcLogs.push({npcId:e.participants[1].id,content:Nr(e.participants[1],n,"neglected",{favoredName:e.participants[0].name,favoredGender:e.participants[0].gender}),type:"DAILY",isSecret:!0}),e.participants.slice(2).forEach(o=>{s.npcLogs.push({npcId:o.id,content:Nr(o,n,"neglected",{favoredName:e.participants[0].name,favoredGender:e.participants[0].gender}),type:"DAILY",isSecret:!0})});break;case"FAVOR_NPC2":s.changes.push({npcId:e.participants[1].id,jealousyChange:-20,affectionChange:5}),s.changes.push({npcId:e.participants[0].id,jealousyChange:10,affectionChange:-5}),e.participants.slice(2).forEach(o=>{s.changes.push({npcId:o.id,jealousyChange:10,affectionChange:-3})}),s.message=`${e.participants[1].name}${e.participants[1].gender===""?"":""}...`,s.npcLogs.push({npcId:e.participants[1].id,content:Nr(e.participants[1],n,"favored"),type:"DAILY",isSecret:!0}),s.npcLogs.push({npcId:e.participants[0].id,content:Nr(e.participants[0],n,"neglected",{favoredName:e.participants[1].name,favoredGender:e.participants[1].gender}),type:"DAILY",isSecret:!0}),e.participants.slice(2).forEach(o=>{s.npcLogs.push({npcId:o.id,content:Nr(o,n,"neglected",{favoredName:e.participants[1].name,favoredGender:e.participants[1].gender}),type:"DAILY",isSecret:!0})});break;case"MEDIATE":e.participants.forEach(o=>{s.changes.push({npcId:o.id,jealousyChange:-10,affectionChange:0})}),s.message="...",e.participants.forEach(o=>{s.npcLogs.push({npcId:o.id,content:Nr(o,n,"mediate"),type:"DAILY",isSecret:!0})});break;case"HONEST":e.participants.forEach(o=>{var a;(((a=o.relationship)==null?void 0:a.jealousy)||0)>=80?s.changes.push({npcId:o.id,jealousyChange:5,affectionChange:-3}):s.changes.push({npcId:o.id,jealousyChange:-15,affectionChange:3})}),s.message="...",e.participants.forEach(o=>{var l;const a=(((l=o.relationship)==null?void 0:l.jealousy)||0)>=80?"honest_angry":"honest_understand";s.npcLogs.push({npcId:o.id,content:Nr(o,n,a),type:"DAILY",isSecret:!0})});break;case"AVOID":e.participants.forEach(o=>{s.changes.push({npcId:o.id,jealousyChange:5,affectionChange:-8})}),s.message="...",e.participants.forEach(o=>{s.npcLogs.push({npcId:o.id,content:Nr(o,n,"avoid"),type:"DAILY",isSecret:!0})});break}return s}const Wg={1:{relation:"",address:""},2:{relation:"",address:""},3:{relation:"",address:""},default:{relation:"",address:""}},Zy=(e={},t={})=>{const n=Math.max(1,(e==null?void 0:e.generation)||1);return{...Wg[n]||Wg.default,gender:"female",generation:n}},Ot={LETTER:"LETTER",OBITUARY:"OBITUARY",DEPARTURE:"DEPARTURE",ACHIEVEMENT:"ACHIEVEMENT"},oo={PENDING:"PENDING",READY:"READY",READ:"READ"};function e1({type:e,senderId:t,senderName:n,title:s,content:o="",timestamp:i,extras:a={},status:l=oo.READY,replies:d=[]}){return{id:`msg_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,type:e,senderId:t,senderName:n,title:s,content:o,isRead:l===oo.READ,status:l,timestamp:i,extras:a,createdAt:Date.now(),replies:d,lastRepliedAt:null}}class x5{constructor(t=100,n=50){this.messages=[],this.maxMessages=t,this.maxLetters=n,this.recentContents=new Map}addMessage(t){if(t.type===Ot.LETTER&&t.senderId){if(this.recentContents.get(t.senderId)===t.content)return console.log(`[MessageManager] : ${t.senderName}`),!1;this.recentContents.set(t.senderId,t.content)}return this.messages.unshift(t),this.cleanup(),!0}addReplyToMessage(t,n){const s=this.messages.find(i=>i.id===t);if(!s)return null;const o={id:`reply_${Date.now()}_${Math.random().toString(36).substr(2,6)}`,content:n.content,tone:n.tone||"warm",toneLabel:n.toneLabel||"",sentiment:n.sentiment||"",timestamp:n.timestamp,from:n.from||"",affectionDelta:n.affectionDelta||0,createdAt:Date.now()};return Array.isArray(s.replies)||(s.replies=[]),s.replies.push(o),s.lastRepliedAt=o.timestamp,s.extras&&(s.extras.hasNpcRespondedToReply=!1),{message:s,reply:o}}markAsRead(t){const n=this.messages.find(s=>s.id===t);n&&(n.isRead=!0,n.status=oo.READ)}getUnreadCount(){return this.messages.filter(t=>!t.isRead&&t.status===oo.READY).length}getRecentRepliesForNpc(t,n=3){if(!t)return[];const s=[];return this.messages.forEach(o=>{o.senderId===t&&(!Array.isArray(o.replies)||o.replies.length===0||o.replies.forEach(i=>{s.push({messageId:o.id,messageTitle:o.title,content:i.content||"",tone:i.tone,toneLabel:i.toneLabel,timestamp:i.timestamp,createdAt:i.createdAt||0})}))}),s.sort((o,i)=>(i.createdAt||0)-(o.createdAt||0)),s.slice(0,n)}getMessagesByType(t){return this.messages.filter(n=>n.type===t)}getAllMessages(){return[...this.messages]}cleanup(){const t=this.messages.filter(s=>s.type===Ot.OBITUARY),n=this.messages.filter(s=>s.type!==Ot.OBITUARY);if(n.length>this.maxLetters){const s=n.slice(0,this.maxLetters);this.messages=[...t,...s]}this.messages.length>this.maxMessages&&(this.messages=this.messages.slice(0,this.maxMessages))}deleteMessage(t){this.messages=this.messages.filter(n=>n.id!==t)}loadFromData(t){this.messages=t||[]}toJSON(){return this.messages}}const Ug={child:(e,t,n)=>{const s=e.age||0,o=Math.floor(s*12),i=e.sect&&e.sect.name,a=e.spouse!==null&&e.spouse!==void 0,l=e.tierTitle||"",{address:d}=Zy(e,t),u=d||t.name||"";let p="";if(o<216)i?p=`${e.sect.name}${l}`:p=`${l}`;else if(a&&i){const m=e.sect.name,v=e.spouse.name;p=`${m}${v}${l}`}else if(a){const m=e.spouse.name;p=`${m}${m}`}else i?p=`${e.sect.name}${l}`:p=`${l}`;const c=o<216?"":"";return`${u}

${p}

${e.name} ${c}
 ${n.year} ${n.month}`},spouse:(e,t,n)=>{var u,p,c,m,v;const s=((u=e.relationship)==null?void 0:u.affection)||60,o=((p=e.relationship)==null?void 0:p.jealousy)||0,i=((c=e.trait)==null?void 0:c.name)||"";let a=e.gender==="male"?"":"",l="";o>=60?i.includes("")||i.includes("")?l="...":i.includes("")?l="......":l="":s>=80?i.includes("")||i.includes("")?l="":i.includes("")||i.includes("")?l="...":i.includes("")?l="":l=`${e.tier||""}`:s>=50?l="":l="",(m=e.identity)!=null&&m.includes("")?l+=`

`:(v=e.identity)!=null&&v.includes("")&&(l+=`

`);const d=s>=70?"":"";return`${a}

${l}

${e.name} ${d}
 ${n.year} ${n.month}`},friend:(e,t,n)=>{var l,d;const s=((l=e.relationship)==null?void 0:l.affection)||50,o=((d=e.trait)==null?void 0:d.name)||"";let i="";s>=70?o.includes("")||o.includes("")?i="":o.includes("")||o.includes("")?i="":i="":i="";const a=s>=60?"":"";return`${t.name}

${i}

${e.name} ${a}
 ${n.year} ${n.month}`},default:(e,t,n)=>{var T,L,ee,$,O;const s=typeof((T=e.relationship)==null?void 0:T.affection)=="number"?e.relationship.affection:typeof e.affection=="number"?e.affection:50,o=((L=e.trait)==null?void 0:L.name)||"",i=e.identity||"",a=e.tier||"",l=((ee=e.sect)==null?void 0:ee.name)||e.sect||"",d=(t==null?void 0:t.name)||"",u=(($=e.travelLog)==null?void 0:$.currentPlace)||((O=e.activity)==null?void 0:O.location)||e.currentResidence||l||"",p=s>=60?d:`${d}`,c=s>=85?"":s>=65?"":s>=45?"":"",v=`${u===""?"":`${u}`}${a}`,w=(()=>{const F=[{keywords:[""],text:""},{keywords:["",""],text:""},{keywords:[""],text:""},{keywords:["",""],text:""},{keywords:[""],text:""},{keywords:[""],text:""},{keywords:["",""],text:""},{keywords:[""],text:""}].find(se=>se.keywords.some(J=>i.includes(J)));return F?F.text:""})(),E=(()=>{var se;const H=(se=e.memories)==null?void 0:se.recentEvents;if(!Array.isArray(H)||H.length===0)return"";const F=H.slice(-2).map(J=>((J==null?void 0:J.description)||"").trim()).filter(Boolean);return F.length===0?"":`${F.join("")}`})(),S=(()=>{var se;const H=(se=e.memories)==null?void 0:se.milestones;if(!Array.isArray(H)||H.length===0)return"";const F=H[H.length-1];return F!=null&&F.event?`${F.event}`:""})(),g=s>=85?"":s>=65?"":s>=45?"":"",h=o.includes("")?"":o.includes("")||o.includes("")?"":o.includes("")||o.includes("")?"":o.includes("")?"":o.includes("")?"":o.includes("")||o.includes("")?"":o.includes("")?"":"",x=s>=70?"":s>=50?"":"",k=[c,v,w,E,S].filter(Boolean).join(""),_=[g,h,x].filter(Boolean).join(""),y=[k,_].filter(H=>H&&H.trim().length>0).join(`

`),R=s>=80?"":s>=60?"":s>=45?"":"",C=(n==null?void 0:n.year)??"",I=(n==null?void 0:n.month)??"";return`${p}

${y}

${e.name} ${R}
 ${C} ${I}`}},Gg={child:(e,t,n)=>{const s=e.age||0,o=Math.floor(s*12),i=e.sect&&e.sect.name,a=e.spouse!==null&&e.spouse!==void 0,l=e.gender===""?e.motherName?"":"":e.fatherName?"":"";let d="";return o<216?d="......":a?d=`${e.spouse.name}/...`:i?d=`${e.sect.name}...`:d="...",`${l}

${d}

${e.name} 
 ${n.year} ${n.month}`},spouse:(e,t,n)=>{var l,d;const s=((l=e.trait)==null?void 0:l.name)||"",o=((d=e.relationship)==null?void 0:d.affection)||80,i=e.gender==="male"?"":"";let a="";return o>=90?s.includes("")||s.includes("")?a="......":s.includes("")||s.includes("")?a=".........":s.includes("")?a="......":a="...":o>=60?a="...":a="",`${i}

${a}

${e.name} 
 ${n.year} ${n.month}`},friend:(e,t,n)=>{var a,l;const s=((a=e.trait)==null?void 0:a.name)||"",o=((l=e.relationship)==null?void 0:l.affection)||60;let i="";return o>=70?s.includes("")||s.includes("")?i="":s.includes("")||s.includes("")?i="":i="":o>=40?i="":i="",`${t.name}

${i}

${e.name} 
 ${n.year} ${n.month}`},default:(e,t,n)=>{var i;const s=e.affection||((i=e.relationship)==null?void 0:i.affection)||50;let o="";return s>=60?o="":o="",`${t.name}

${o}

${e.name} 
 ${n.year} ${n.month}`}};async function y5(e,t,n,s="default",o,i={}){var a,l,d,u,p,c,m,v,w,E;try{console.log(" []",{:e.name,ID:e.id,:s,:{fatherName:e.fatherName||"",motherName:e.motherName||"",generation:e.generation||""},children:((a=i.children)==null?void 0:a.some(ce=>ce.id===e.id))||!1,:t.name});let S="",g="",h="";const x=e.relationship||{},k=x.affection||0,_=x.jealousy||0,y=x.stage||0,R=x.cutTies||!1,C=((l=i.exiledChildren)==null?void 0:l.some(ce=>ce.id===e.id))||!1;let I="";if((u=(d=e.memories)==null?void 0:d.profile)!=null&&u.firstMeet){const ce=new Date(e.memories.profile.firstMeet),je=Math.floor((new Date-ce)/(365.25*24*60*60*1e3));je>0?I=`
${je}`:I=`
`}let T="",L="";k>=90?(T="",L=""):k>=70?(T="",L=""):k>=50?(T="",L=""):k>=30?(T="",L=""):(T="",L="");let ee="";if(s!=="child"&&e.memories)try{const ce=Ky(e,{includeMilestones:!0,includeRecent:!0,maxRecent:5});ce&&ce.trim().length>0&&(ee=`
`+ce)}catch(ce){console.warn(":",ce)}let $="";const O=Array.isArray(i.replyHistory)?i.replyHistory:[];O.length>0&&($=`

${O.map((ae,je)=>{const X=ae.timestamp,Me=X&&X.year?` ${X.year} ${X.month}`:"",Ae=ae.toneLabel||"",_e=(ae.content||"").replace(/\s+/g," ").trim(),z=_e.length>60?`${_e.slice(0,60)}`:_e||"";return`${je+1}. ${Me}  ${Ae}${z}`}).join(`
`)}
`);let H="";const F=((p=e.trait)==null?void 0:p.name)||"";F.includes("")?H="":F.includes("")?H="":F.includes("")?H="":F.includes("")?H="":F.includes("")?H="":F.includes("")?H="":F.includes("")?H="":F.includes("")?H="":F.includes("")?H="":F.includes("")?H="":F.includes("")?H="":F.includes("")?H="":F.includes("")?H="":F.includes("")?H="":F.includes("")?H="":F.includes("")?H="":F.includes("")?H="":F.includes("")?H="":F.includes("")?H="":F.includes("")||F.includes("")?H="":F.includes("")?H="":H="";let se="";const J=e.identity||"";J.includes("")?se=`
`:J.includes("")?se=`
`:J.includes("")||J.includes("")?se=`
`:J.includes("")?se=`
`:J.includes("")?se=`
`:J.includes("")?se=`
`:J.includes("")?se=`
`:J.includes("")?se=`
`:J.includes("")?se=`
`:J.includes("")?se=`
`:J.includes("")||J.includes("")?se=`
`:J.includes("")?se=`
`:J.includes("")||J.includes("")?se=`
`:J.includes("")?se=`
`:J.includes("")?se=`
`:J.includes("")?se=`
`:J.includes("")?se=`
`:J.includes("")?se=`
`:J.includes("")?se=`
`:J.includes("")&&(se=`
`);let de="normal",Ee="";switch(R||C?(de="farewell",h=`

`,R&&(h+=`${t.name}`),C&&(h+="")):_>=80&&s!=="child"?(de="jealous",h=`

${_}${t.name}

""""""""`):_>=60&&s!=="child"?(de="normal",Ee="slight_jealous",h=`

${_}`):k>=70&&s==="spouse"?(de="missing",Ee="longing",h=`

${k>=90?"":""}`):s==="spouse"&&De?(de="normal",Ee="family"):s==="friend"?(de="normal",Ee="sharing"):(de="normal",Ee="general"),s){case"child":const ce=Math.floor((e.age||0)*12),ae=((c=e.sect)==null?void 0:c.name)||e.sect||"",je=e.tierTitle||e.tier||"",X=e.spouse!==null&&e.spouse!==void 0,Me=((m=e.spouse)==null?void 0:m.name)||"",Ae=Math.max(1,e.generation||1),{relation:_e}=Zy(e,t),z=e.fatherName||e.motherName||"",he=!!e.fatherName;let ye=`${e.name}${Math.floor(e.age||0)}${je}
${t.name}${_e}`;z&&z!==""&&(ye+=`
${z}${he?"":""}`),ae&&(ye+=`
${ae}`),X&&(ye+=`
${Me}`),S=ye,C?g=`${_e}`:ce<216?g=`${_e}`:g=`${_e}`;break;case"spouse":S=`${t.name}${e.name}${e.tier||""}`,R?g="":de==="jealous"?g="":g="";break;case"friend":if(e.fatherName||e.motherName||e.generation||e.parent||e.parentId||((v=t.children)==null?void 0:v.some(ve=>ve.id===e.id))){const ve=(n.year-(e.birthYear||0))*12+(n.month-(e.birthMonth||1)),Ge=t.gender===""?"":"";S=`${t.name}${Math.floor(ve/12)}`,ve<216?g=""+Ge+"":g=""}else S=`${t.name}${e.name}${e.tier||""}`,R?g="":g="";break;default:S=`${e.name}${e.tier||""}${t.name}`,g=""}let $e="",De=!1,Qe="";if(y>=3&&s==="spouse"&&($e+=`
`),i.dualCultivationCount>0&&s==="spouse"&&($e+=`
${i.dualCultivationCount}`),i.children&&i.children.length>0){const ce=i.children.filter(ae=>ae.fatherName===e.name||ae.motherName===e.name||s==="child"&&ae.parentId===e.id);if(ce.length>0){De=!0;const ae=ce.map(je=>je.name).join("");if(s==="spouse")Qe=`
${ce.length}${ae}`,e.gender===""&&(Qe+=`
${k>=80?"":k>=60?"":""}`);else if(s==="child"){const je=ce.filter(X=>X.id!==e.id);je.length>0&&(Qe=`
${je.length}${je.map(X=>X.name).join("")}`)}$e+=Qe}}let Y="";if(s==="child")Y=`${e.name}${t.name}${de==="farewell"?"":""}


${S}

${g?`
${g}`:""}

${$?`${$}
`:""}


- 
- ${e.name}
- ${t.name}${playerRelation}
- ${generation===1?"":generation===2?"":""}
- ${de==="farewell"?"":""}
- 250
- """"""""""
- ${e.name} ${childAge<216?"":""}
 ${n.year} ${n.month}`;else{let ce="";De&&e.gender===""&&(ce=""),Y=`${e.name}${t.name}${de==="farewell"?"":""}


${ce}${t.name}


${S}
${e.identity||""}
${e.tier||""}
${e.sect?`${e.sect}`:""}


${((w=e.trait)==null?void 0:w.name)||""}${((E=e.trait)==null?void 0:E.description)||""}
${H}


${se||""}


${k}${T}
${I}${$e}

${$}${ee}${h}


1. 1-2""""
2. ${L}${g}
3. 120-180
4. 
   ${de==="farewell"?"- //":de==="jealous"?'- """"':de==="missing"?"- ":Ee==="slight_jealous"?`- 
   - `:Ee==="family"?"- ":Ee==="sharing"?"- ":`- 
   - `}
   ${De&&de!=="jealous"?"- ":""}
   ${de!=="jealous"&&de!=="farewell"?`- 
   - `:""}
5. 
6. "${e.name}\\n ${n.year} ${n.month}"`}const ue=[{role:"system",content:Y},{role:"user",content:s==="child"?`${e.name}${t.name}${de==="farewell"?"":""} ${n.year} ${n.month}
          

1. """"""""
2. 
3. `:`${e.name}${t.name}${de==="farewell"?"":de==="jealous"?"":de==="missing"?"":""} ${n.year} ${n.month}`}];return await Wf(ue,o.apiKey,o.apiUrl||"https://api.deepseek.com/chat/completions",{model:o.apiModel||"deepseek-chat",temperature:.9,maxTokens:350})}catch(S){return console.error("AI:",S),Ap(e,t,n,s)}}function Ap(e,t,n,s="default"){var i;return s==="friend"&&(e.fatherName||e.motherName||e.generation||e.parent||e.parentId||(i=t.children)!=null&&i.some(l=>l.id===e.id))&&(s="child"),(Ug[s]||Ug.default)(e,t,n)}function b5(e,t,n,s="default"){var i;return s==="friend"&&(e.fatherName||e.motherName||e.generation||e.parent||e.parentId||(i=t.children)!=null&&i.some(l=>l.id===e.id))&&(s="child"),(Gg[s]||Gg.default)(e,t,n)}function v5(e,t=3,n=null){var l,d,u,p,c,m;if(!e||e.acceptsLetters===!1)return!1;const s=typeof((l=e.relationship)==null?void 0:l.affection)=="number"?e.relationship.affection:void 0,o=typeof e.affection=="number"?e.affection:s;if(!e.isChild&&typeof o=="number"&&o<100||n&&((d=n.extras)==null?void 0:d.hasNpcRespondedToReply)===!0&&(!(n.replies&&n.replies.length>0)||n.extras.hasNpcRespondedToReply===!0)||t<3)return!1;let i=.3;const a=typeof o=="number"?o:0;return a>80?i+=.3:a>60?i+=.2:a>40&&(i+=.1),((u=e.traits)!=null&&u.includes("")||(p=e.traits)!=null&&p.includes(""))&&(i+=.2),((c=e.traits)!=null&&c.includes("")||(m=e.traits)!=null&&m.includes(""))&&(i-=.2),Math.random()<Math.max(.1,Math.min(.9,i))}function t1(e,t){var n,s;return e.id===((n=t.spouse)==null?void 0:n.id)?"spouse":(s=t.children)!=null&&s.some(o=>o.id===e.id)||e.isChild===!0||e.fatherName||e.motherName||e.generation||e.parent||e.parentId?"child":e.affection>60?"friend":"default"}function S5(e,t,n){const s=t1(e,t),o=b5(e,t,n,s);let i="";return s==="child"?i=`${e.name}`:s==="spouse"?i=`${e.name}`:s==="friend"&&(i=`${e.name}`),e1({type:Ot.OBITUARY,senderId:e.id,senderName:e.name,title:i,content:o,timestamp:{...n},extras:{npcId:e.id,relation:s,deathCause:e.deathCause||""},status:oo.READY})}async function Vg(e,t,n,s=!0,o={},i={}){const a=t1(e,t),l=Array.isArray(i.replyHistory)?i.replyHistory:[],d=l[0],u=l.length>0,p=u&&((d==null?void 0:d.content)||"").replace(/\s+/g," ").trim().slice(0,40)||"";let c="";a==="child"?c="":a==="spouse"?c="":a==="friend"&&(c="");let m="";if(s)if(o.useAIForLetter&&o.apiKey&&o.apiKey.trim().length>0)try{m=await y5(e,t,n,a,o,i)}catch(E){console.error("AI:",E),m=Ap(e,t,n,a)}else m=Ap(e,t,n,a);return e1({type:Ot.LETTER,senderId:e.id,senderName:e.name,title:`${e.name}${c}`,content:m,timestamp:{...n},extras:{npcId:e.id,relation:a,...u?{isReplyToPlayer:!0,replySourceCount:l.length,replySourceTone:(d==null?void 0:d.toneLabel)||"",replySourceSnippet:p,replySourceTimestamp:(d==null?void 0:d.timestamp)||null,hasNpcRespondedToReply:!0}:{}},status:s?oo.READY:oo.PENDING})}const zi=[{id:"warm",label:"",desc:"",affectionDelta:5},{id:"calm",label:"",desc:"",affectionDelta:3},{id:"firm",label:"",desc:"",affectionDelta:-2}],w5=({isOpen:e,onClose:t,messages:n,onMarkAsRead:s,onDeleteMessage:o,onSendReply:i})=>{var L,ee,$;const[a,l]=b.useState(null),[d,u]=b.useState("all"),[p,c]=b.useState(""),[m,v]=b.useState(zi[0].id),[w,E]=b.useState(!1),[S,g]=b.useState(null),h=b.useMemo(()=>{const O=Array.isArray(n)?n:[];return d==="all"?O:d==="letter"?O.filter(H=>H.type===Ot.LETTER||H.type===Ot.DEPARTURE||H.type===Ot.ACHIEVEMENT):d==="obituary"?O.filter(H=>H.type===Ot.OBITUARY):O},[n,d]),x=b.useMemo(()=>h.find(O=>O.id===a),[h,a]);b.useEffect(()=>{c(""),v(zi[0].id),g(null)},[a]);const k=O=>{l(O.id),O.isRead||s(O.id)},_=()=>{l(null),t()};b.useEffect(()=>{const O=H=>{H.key==="Escape"&&_()};return window.addEventListener("keydown",O),()=>window.removeEventListener("keydown",O)},[_]);const y=O=>{if(!O)return"";if(typeof O=="object"&&O.year)return` ${Math.floor(O.year)}${O.month}`;const H=new Date(O);return Number.isNaN(H.getTime())?"":`${H.getFullYear()}${H.getMonth()+1}${H.getDate()}`},R=x&&x.type!==Ot.OBITUARY&&typeof i=="function",C=async()=>{var F;if(!R)return;const O=p.trim();if(!O){g("");return}const H=zi.find(se=>se.id===m)||zi[0];E(!0);try{const se=await Promise.resolve(i({messageId:x.id,targetNpcId:x.senderId,relation:(F=x.extras)==null?void 0:F.relation,content:O,tone:H}));se&&se.success?(c(""),g(""),setTimeout(()=>g(null),1800)):g((se==null?void 0:se.error)||"")}finally{E(!1)}},I=O=>{switch(O){case Ot.OBITUARY:return"";case Ot.LETTER:return"";case Ot.DEPARTURE:return"";case Ot.ACHIEVEMENT:return"";default:return""}},T=O=>O===Ot.OBITUARY?"message-background-obituary":"message-background-letter";return e?r.jsx("div",{className:"message-center-overlay",onClick:_,children:r.jsxs("div",{className:"message-center-modal",onClick:O=>O.stopPropagation(),children:[r.jsxs("div",{className:"message-center-header",children:[r.jsx("h2",{children:" "}),r.jsx("button",{className:"close-btn",onClick:_,children:""})]}),r.jsxs("div",{className:"message-filters",children:[r.jsxs("button",{className:`filter-btn ${d==="all"?"active":""}`,onClick:()=>u("all"),children:[" (",n.length,")"]}),r.jsxs("button",{className:`filter-btn ${d==="letter"?"active":""}`,onClick:()=>u("letter"),children:[" (",n.filter(O=>O.type!==Ot.OBITUARY).length,")"]}),r.jsxs("button",{className:`filter-btn ${d==="obituary"?"active":""}`,onClick:()=>u("obituary"),children:[" (",n.filter(O=>O.type===Ot.OBITUARY).length,")"]}),n.some(O=>!O.isRead)&&r.jsx("button",{className:"filter-btn mark-all-read-btn",onClick:()=>{n.forEach(O=>{O.isRead||s(O.id)})},style:{marginLeft:"auto",background:"#7AA893",color:"white"},children:" "})]}),r.jsxs("div",{className:"message-center-content",children:[r.jsx("div",{className:"message-list",children:h.length===0?r.jsxs("div",{className:"empty-message",children:[r.jsx("p",{children:""}),r.jsx("p",{children:""})]}):h.map(O=>{var H,F;return r.jsxs("div",{className:`message-item ${a===O.id?"selected":""} ${O.isRead?"":"unread"} ${O.type===Ot.OBITUARY?"obituary":""}`,onClick:()=>k(O),children:[!O.isRead&&r.jsx("span",{className:"unread-dot"}),r.jsx("div",{className:"message-avatar",children:O.type===Ot.OBITUARY?"":""}),r.jsxs("div",{className:"message-info",children:[r.jsxs("div",{className:"message-sender",children:[O.senderName,r.jsx("span",{className:"message-type-label",children:I(O.type)}),((H=O.extras)==null?void 0:H.isReplyToPlayer)&&r.jsx("span",{className:"message-reply-badge",children:""}),((F=O.replies)==null?void 0:F.length)>0&&r.jsxs("span",{className:"message-replied-flag",children:["",O.replies.length]})]}),r.jsx("div",{className:"message-title",children:O.title}),r.jsxs("div",{className:"message-time",children:[" ",O.timestamp.year," ",O.timestamp.month,""]})]})]},O.id)})}),r.jsx("div",{className:`message-reader ${x?T(x.type):""}`,children:x?r.jsxs("div",{className:"reader-content",children:[r.jsxs("div",{className:"reader-header",children:[r.jsx("h3",{children:x.title}),r.jsxs("div",{className:"reader-meta",children:[r.jsx("span",{children:x.senderName}),r.jsx("span",{children:""}),r.jsxs("span",{children:[" ",x.timestamp.year," ",x.timestamp.month,""]})]})]}),r.jsx("div",{className:"reader-body",children:x.content?r.jsx("pre",{className:"message-content",children:x.content}):r.jsx("p",{className:"content-loading",children:"..."})}),((L=x.extras)==null?void 0:L.isReplyToPlayer)&&r.jsxs("div",{className:"reply-context-banner",children:[r.jsxs("div",{children:[" ",((ee=x.extras)==null?void 0:ee.replySourceTimestamp)&&r.jsx("span",{className:"reply-context-time",children:y(x.extras.replySourceTimestamp)})]}),(($=x.extras)==null?void 0:$.replySourceSnippet)&&r.jsxs("div",{className:"reply-context-snippet",children:["",x.extras.replySourceSnippet,""]})]}),x.replies&&x.replies.length>0&&r.jsxs("div",{className:"reply-thread",children:[r.jsx("h4",{children:" "}),r.jsx("div",{className:"reply-list",children:x.replies.map(O=>r.jsxs("div",{className:"reply-entry",children:[r.jsxs("div",{className:"reply-meta",children:[r.jsx("span",{children:O.from||""}),O.toneLabel&&r.jsx("span",{className:"reply-tone-label",children:O.toneLabel}),r.jsx("span",{children:y(O.timestamp)})]}),r.jsx("pre",{className:"reply-content",children:O.content})]},O.id))})]}),r.jsx("div",{className:"reader-actions",children:x.type===Ot.OBITUARY?r.jsxs(r.Fragment,{children:[r.jsx("button",{className:"action-btn secondary",children:" "}),r.jsx("button",{className:"action-btn danger",onClick:()=>{window.showConfirm&&window.showConfirm("",()=>{o(x.id),l(null)})},children:""})]}):r.jsx(r.Fragment,{children:r.jsx("button",{className:"action-btn",onClick:()=>{o(x.id),l(null)},children:""})})}),R&&r.jsxs("div",{className:"reply-composer",children:[r.jsxs("h4",{children:["  ",x.senderName]}),r.jsx("div",{className:"reply-tone-options",children:zi.map(O=>r.jsxs("button",{type:"button",className:`tone-btn ${m===O.id?"active":""}`,onClick:()=>v(O.id),children:[r.jsx("div",{className:"tone-header",children:r.jsx("span",{children:O.label})}),r.jsx("p",{children:O.desc})]},O.id))}),r.jsx("textarea",{className:"reply-input",placeholder:"120",maxLength:120,value:p,onChange:O=>c(O.target.value)}),r.jsxs("div",{className:"reply-actions",children:[S&&r.jsx("span",{className:"reply-feedback",children:S}),r.jsx("button",{type:"button",className:"action-btn primary",onClick:C,disabled:w,children:w?"...":""})]})]})]}):r.jsxs("div",{className:"reader-placeholder",children:[r.jsx("p",{children:""}),r.jsx("p",{children:""})]})})]})]})}):null},E5="cultivation_save_v1_slot_",k5="cultivation_autosave_",Ql=5,ed=3,bu=100,Yg=20;let ys=!1,Ki=!1;const td=()=>{try{const e="__localStorage_test__";return localStorage.setItem(e,"test"),localStorage.removeItem(e),!0}catch(e){return console.error("localStorage :",e),!1}},n1=()=>(ys=nv(),console.log(ys?" TapTap ":"  TapTap "),ys),Js=e=>`${k5}${e}`,li=(e=1)=>`${E5}${e}`,r1=e=>new Blob([JSON.stringify(e)]).size/1024,s1=()=>{let e=0;for(let t in localStorage)localStorage.hasOwnProperty(t)&&(e+=localStorage[t].length+t.length);return{used:(e/1024).toFixed(2),usedMB:(e/1024/1024).toFixed(2)}},Np=e=>!e||typeof e!="object"?e:Bp(e),Jl=e=>Array.isArray(e)?e.map(t=>Np(t)):e,j5=e=>{if(!e||typeof e!="object")return e;const t=Np(e);return Array.isArray(e.worldNpcs)&&(t.worldNpcs=Jl(e.worldNpcs)),e.rival&&(t.rival=Np(e.rival)),Array.isArray(e.spouses)&&(t.spouses=Jl(e.spouses)),Array.isArray(e.followers)&&(t.followers=Jl(e.followers)),Array.isArray(e.generation3Plus)?t.generation3Plus=e.generation3Plus:t.generation3Plus=[],t},Mc=e=>{if(!e||typeof e!="object")return e;const t={...e};return t.player=j5(e.player),["activeNpcs","children","deadNpcs","worldNpcs"].forEach(n=>{Array.isArray(e[n])&&(t[n]=Jl(e[n]))}),Array.isArray(t.inventory)||(console.warn(" "),t.inventory=[]),t},o1=e=>{let t={...e};return t=mh(t),t.logs&&t.logs.length>bu&&(console.log(` ${t.logs.length} -> ${bu}`),t.logs=t.logs.slice(0,bu)),t.activeNpcs&&(t.activeNpcs=t.activeNpcs.map(n=>n.logs&&n.logs.length>Yg?{...n,logs:n.logs.slice(-Yg)}:n)),t.deadNpcs&&(t.deadNpcs=t.deadNpcs.map(n=>({id:n.id,name:n.name,deathYear:n.deathYear,deathReason:n.deathReason}))),t.messages&&Object.keys(t.messages).forEach(n=>{const s=t.messages[n];s&&s.length>30&&(t.messages[n]=s.slice(-30))}),t.player&&Array.isArray(t.player.generation3Plus)&&(t.player.generation3Plus=t.player.generation3Plus.map(n=>({id:n.id,generation:n.generation,birthYear:n.birthYear,parentGeneration:n.parentGeneration}))),t},i1=(e,t=1)=>{var n,s,o,i,a,l;if(!td())return{success:!1,error:"STORAGE_UNAVAILABLE",message:"localStorage "};try{const d=o1(e),u=((s=(n=d.player)==null?void 0:n.time)==null?void 0:s.year)||((o=d.player)==null?void 0:o.age)||3572,p=((a=(i=d.player)==null?void 0:i.time)==null?void 0:a.month)||((l=d.player)==null?void 0:l.month)||1,c={...d,timestamp:Date.now(),saveDate:new Date().toLocaleString(),slotNumber:t,gameTime:` ${u} ${p}`,year:u,month:p},m=JSON.stringify(c),v=r1(c);return console.log(`: ${v.toFixed(2)} KB`),v>5120?(console.warn(""),{success:!1,error:"STORAGE_TOO_LARGE",size:v.toFixed(2)}):(localStorage.setItem(li(t),m),ys&&!Ki&&(Ki=!0,gh(t,c).then(w=>{console.log(`  [${t}]:`,w.action),Ki=!1}).catch(w=>{console.warn(`  [${t}]:`,w.message),Ki=!1})),{success:!0,time:c.saveDate,slot:t,size:v.toFixed(2)})}catch(d){return console.error("Save failed:",d),d.name==="QuotaExceededError"||d.code===22?{success:!1,error:"QUOTA_EXCEEDED",message:""}:{success:!1,error:d.name||"UNKNOWN_ERROR",message:d.message}}},Yo=(e=1)=>{try{const t=localStorage.getItem(li(e));if(!t)return null;const n=JSON.parse(t);return Mc(n)}catch(t){return console.error("Load failed:",t),null}},Uf=async(e=1)=>{if(!ys)return console.log(""),Yo(e);try{const t=Yo(e),n=(t==null?void 0:t.timestamp)||0,s=await rv(e,n);if(!s)return console.log(` [${e}]`),t;console.log(` [${e}]...`);const o=await sv(s.uuid,s.fileId,e);if(o){const i=Mc(o);return localStorage.setItem(li(e),JSON.stringify(i)),console.log(`  [${e}]`),i}return Mc(o)}catch(t){return console.error(` [${e}]:`,t),console.log(""),Yo(e)}},Gf=()=>{var t,n;const e=[];if(!td()){console.warn("localStorage ");for(let s=1;s<=Ql;s++)e.push({slot:s,exists:!1,error:"localStorage"});return e}try{for(let s=1;s<=Ql;s++){const o=li(s),i=localStorage.getItem(o);if(i)try{const a=JSON.parse(i);e.push({slot:s,exists:!0,saveDate:a.saveDate||"",playerName:((t=a.player)==null?void 0:t.name)||"",cultivation:((n=a.player)==null?void 0:n.cultivation)||0,timestamp:a.timestamp||0})}catch(a){console.error(` ${s} :`,a),e.push({slot:s,exists:!1})}else e.push({slot:s,exists:!1})}}catch(s){console.error(":",s);for(let o=1;o<=Ql;o++)e.push({slot:o,exists:!1})}return e},a1=(e=1)=>{localStorage.removeItem(li(e))},C5=()=>{for(let e=1;e<=Ql;e++)localStorage.removeItem(li(e));for(let e=1;e<=ed;e++)localStorage.removeItem(Js(e))},l1=e=>{var t,n,s,o,i,a;if(!td())return console.warn("localStorage "),{success:!1,error:"STORAGE_UNAVAILABLE"};try{const l=o1(e),d=((n=(t=l.player)==null?void 0:t.time)==null?void 0:n.year)||Math.floor(((s=l.player)==null?void 0:s.age)||0)||3572,u=((i=(o=l.player)==null?void 0:o.time)==null?void 0:i.month)||1,p=Math.floor(((a=l.player)==null?void 0:a.age)||0),c={...l,player:{...l.player,age:p},timestamp:Date.now(),saveDate:new Date().toLocaleString(),isAutoSave:!0,gameTime:` ${d} ${u}`,year:d,month:u},m=JSON.stringify(c),v=r1(c);if(v>4096)return console.warn(""),{success:!1,error:"STORAGE_TOO_LARGE"};for(let w=ed;w>1;w--){const E=Js(w-1),S=localStorage.getItem(E);S&&localStorage.setItem(Js(w),S)}return localStorage.setItem(Js(1),m),console.log(`  [ ${d} ${u}] : ${v.toFixed(2)} KB`),l.logs&&console.log(` :  ${l.logs.length||0} `),{success:!0,time:c.saveDate,gameTime:c.gameTime,size:v.toFixed(2)}}catch(l){return console.error(":",l),{success:!1,error:l.message}}},c1=()=>{var t,n,s,o;const e=[];if(!td())return console.warn("localStorage "),e;try{for(let i=1;i<=ed;i++){const a=Js(i),l=localStorage.getItem(a);if(l)try{const d=JSON.parse(l);e.push({slot:i,exists:!0,saveDate:d.saveDate||"",gameTime:d.gameTime||"",year:d.year||0,month:d.month||0,playerName:((t=d.player)==null?void 0:t.name)||"",cultivation:((n=d.player)==null?void 0:n.cultivation)||0,age:Math.floor(((s=d.player)==null?void 0:s.age)||0),tier:((o=d.player)==null?void 0:o.tierTitle)||""})}catch(d){console.error(` ${i} :`,d),e.push({slot:i,exists:!1,error:""})}else e.push({slot:i,exists:!1})}}catch(i){console.error(":",i)}return e},d1=(e=1)=>{try{const t=localStorage.getItem(Js(e));if(!t)return null;const n=JSON.parse(t);return console.log(` [${e}]: ${n.gameTime}`),Mc(n)}catch(t){return console.error(` ${e} :`,t),null}},u1=()=>{for(let e=1;e<=ed;e++)localStorage.removeItem(Js(e));console.log("")},p1=async(e=1)=>{if(!ys)throw new Error("");const t=Yo(e);if(!t)throw new Error(` ${e} `);return await gh(e,t)},f1=async(e=1)=>{if(!ys)throw new Error("");const t=await Uf(e);if(!t)throw new Error("");return t},m1=()=>({enabled:ys,syncing:Ki}),T5=Object.freeze(Object.defineProperty({__proto__:null,autoSaveGame:l1,clearAllAutoSaves:u1,clearAllSaves:C5,clearSave:a1,getAllAutoSaves:c1,getAllSaveSlots:Gf,getCloudSaveStatus:m1,getStorageInfo:s1,initCloudSaveSystem:n1,loadAutoSave:d1,loadGameFromCloud:Uf,loadGameFromStorage:Yo,manualDownloadFromCloud:f1,manualUploadToCloud:p1,saveGameToStorage:i1},Symbol.toStringTag,{value:"Module"})),I5=({onFinish:e,onLoadGame:t})=>{const[n,s]=b.useState(0),[o,i]=b.useState([]),[a,l]=b.useState(!1);b.useEffect(()=>{const p=Gf();i(p)},[]);const d=[{text:"",sub:""},{text:"",sub:""},{text:"",sub:""},{text:"",sub:"..."},{text:"",sub:`

`}],u=o.some(p=>p.exists);return a?r.jsxs(r.Fragment,{children:[r.jsx("div",{style:Gt.overlay}),r.jsxs("div",{style:Gt.container,children:[r.jsx("h2",{style:{color:"#d4af37",marginBottom:"clamp(15px, 4vw, 30px)",fontSize:"clamp(18px, 5vw, 24px)"},children:""}),r.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"clamp(10px, 2vw, 15px)",width:"100%",maxWidth:"500px",marginBottom:"10px"},children:o.map(p=>r.jsxs("div",{style:{...Gt.slotCard,opacity:p.exists?1:.5,cursor:p.exists?"pointer":"not-allowed"},onClick:()=>{p.exists&&t(p.slot)},children:[r.jsxs("div",{style:Gt.slotHeader,children:[r.jsxs("span",{style:Gt.slotTitle,children:[" ",p.slot]}),p.exists&&r.jsx("span",{style:Gt.slotBadge,children:""})]}),p.exists?r.jsxs("div",{style:{fontSize:"clamp(11px, 2.8vw, 13px)",color:"#ccc",marginTop:"8px",lineHeight:"1.5"},children:[r.jsxs("div",{children:[": ",p.playerName]}),p.cultivation>0&&r.jsxs("div",{children:[": ",p.cultivation," "]}),r.jsxs("div",{style:{fontSize:"clamp(10px, 2.5vw, 12px)",marginTop:"4px",opacity:.8},children:[": ",p.saveDate]})]}):r.jsx("div",{style:{fontSize:"clamp(12px, 3vw, 13px)",color:"#999",marginTop:"8px"},children:""})]},p.slot))}),r.jsx("button",{onClick:()=>l(!1),style:{...Gt.btn,background:"#666",marginTop:"clamp(10px, 2vw, 20px)",width:"clamp(150px, 40vw, 200px)",padding:"clamp(10px, 2.5vw, 12px)",minHeight:"auto"},children:" "})]})]}):n<d.length?r.jsxs(r.Fragment,{children:[r.jsx("div",{style:Gt.overlay,onClick:()=>s(n+1)}),r.jsxs("div",{style:Gt.container,children:[r.jsx("h1",{style:Gt.title,children:d[n].text}),r.jsx("p",{style:Gt.sub,children:d[n].sub}),u&&n===0&&r.jsx("button",{onClick:p=>{p.stopPropagation(),l(!0)},style:{...Gt.btn,background:"#4caf50",marginBottom:"clamp(15px, 3vw, 20px)",width:"clamp(160px, 45vw, 200px)",textAlign:"center",border:"2px solid #45a049",minHeight:"auto",padding:"clamp(10px, 2.5vw, 12px)"},children:" "}),r.jsx("div",{style:Gt.tip,children:"[  ]"}),r.jsx("button",{onClick:()=>s(n+1),style:Gt.continueBtn,children:" "})]})]}):r.jsxs(r.Fragment,{children:[r.jsx("div",{style:Gt.overlay}),r.jsxs("div",{style:Gt.container,children:[r.jsx("h2",{style:{color:"#d4af37",marginBottom:"clamp(20px, 5vw, 30px)",fontSize:"clamp(20px, 5vw, 28px)"},children:""}),r.jsx("p",{style:Gt.sub,children:"..."}),r.jsx("button",{style:{...Gt.continueBtn,background:"#d4af37",fontSize:"clamp(15px, 4vw, 18px)",padding:"clamp(12px, 3vw, 15px) clamp(30px, 8vw, 40px)",marginTop:"clamp(15px, 4vw, 25px)"},onClick:()=>e(),children:" "})]})]})},Gt={overlay:{position:"fixed",top:0,left:0,width:"100%",height:"100%",background:"rgba(0, 0, 0, 0.85)",zIndex:2499,backdropFilter:"blur(8px)"},container:{position:"fixed",top:"50%",left:"50%",transform:"translate(-50%, -50%)",width:"90%",maxWidth:"600px",maxHeight:"90vh",background:"linear-gradient(135deg, #1a1a1a 0%, #2d2d2d 100%)",color:"white",display:"flex",flexDirection:"column",justifyContent:"flex-start",alignItems:"center",zIndex:2500,padding:"clamp(15px, 4vw, 30px)",textAlign:"center",overflowY:"auto",overflowX:"hidden",borderRadius:"clamp(8px, 2vw, 16px)",boxShadow:"0 20px 60px rgba(0, 0, 0, 0.8)",border:"2px solid rgba(211, 47, 47, 0.5)",WebkitOverflowScrolling:"touch"},title:{fontSize:"clamp(18px, 5vw, 32px)",marginBottom:"clamp(12px, 3vw, 20px)",animation:"fadeIn 1s",lineHeight:"1.3",wordBreak:"break-word"},sub:{fontSize:"clamp(13px, 3.5vw, 16px)",color:"#ccc",lineHeight:"1.6",maxWidth:"100%",animation:"slideUp 1s",padding:"0 5px",wordBreak:"break-word",marginBottom:"clamp(10px, 2vw, 15px)"},tip:{fontSize:"clamp(10px, 2.5vw, 12px)",color:"#888",marginTop:"clamp(8px, 2vw, 10px)",marginBottom:"5px"},continueBtn:{padding:"clamp(8px, 2vw, 10px) clamp(20px, 5vw, 30px)",background:"#d32f2f",border:"none",color:"#fff",borderRadius:"clamp(6px, 1.5vw, 8px)",cursor:"pointer",fontSize:"clamp(13px, 3vw, 14px)",fontWeight:"bold",transition:"all 0.3s",marginTop:"clamp(10px, 2vw, 15px)",minHeight:"40px",width:"auto"},btn:{padding:"clamp(12px, 3vw, 15px) clamp(10px, 2vw, 12px)",background:"#1a1a1a",border:"2px solid #666",color:"#fff",borderRadius:"clamp(8px, 2vw, 12px)",cursor:"pointer",textAlign:"center",transition:"all 0.3s",fontSize:"clamp(12px, 3vw, 15px)",lineHeight:"1.5",whiteSpace:"normal",wordWrap:"break-word",minHeight:"clamp(50px, 12vw, 70px)",display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",gap:"6px",width:"100%"},slotCard:{background:"rgba(255, 255, 255, 0.05)",padding:"clamp(12px, 3vw, 15px)",borderRadius:"clamp(6px, 1.5vw, 8px)",border:"2px solid rgba(255, 255, 255, 0.1)",transition:"all 0.3s",marginBottom:"8px"},slotHeader:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"8px",flexWrap:"wrap",gap:"5px"},slotTitle:{fontSize:"clamp(14px, 3.5vw, 16px)",fontWeight:"bold",color:"#d4af37"},slotBadge:{fontSize:"clamp(16px, 4vw, 18px)",color:"#4caf50"}},_5=({onConfirm:e,onExit:t})=>{const[n,s]=b.useState("warning"),[o,i]=b.useState(!1),a=()=>{const d=` 


 bug


 
/

 
1. ""
2. " "
3. " "
4. 

 
1. ""
2. " "
3. 
   -  
   -  
   -  
4. 

 
- 
- 50000 10 10 

 
1. 
2. Base64
3. 
4. 

`;navigator.clipboard.writeText(d).then(()=>{i(!0),setTimeout(()=>i(!1),2e3)}).catch(()=>{const u=document.createElement("textarea");u.value=d,document.body.appendChild(u),u.select(),document.execCommand("copy"),document.body.removeChild(u),i(!0),setTimeout(()=>i(!1),2e3)})},l={overlay:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0, 0, 0, 0.7)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:9999,padding:"20px"},container:{background:"linear-gradient(135deg, #f5ecd5 0%, #e0c9a6 100%)",borderRadius:"28px 28px 22px 22px/36px 36px 18px 18px",border:"2.5px solid #bfa76a",color:"#5b4322",boxShadow:"0 12px 48px rgba(191, 167, 106, 0.18)",maxWidth:"600px",width:"100%",maxHeight:"80vh",display:"flex",flexDirection:"column",overflow:"hidden"},header:{padding:"20px",borderBottom:"1px solid #d4af37",background:"linear-gradient(90deg, #f5ecd5 60%, #e0c9a6 100%)",textAlign:"center"},warningBanner:{backgroundColor:"#ff6b6b",color:"#fff",padding:"8px 16px",borderRadius:"12px",marginBottom:"12px",fontSize:"13px",fontWeight:"bold",display:"inline-block",letterSpacing:"0.5px",boxShadow:"0 4px 12px rgba(255, 107, 107, 0.3)"},title:{fontSize:"24px",fontWeight:"bold",color:"#a67c2d",margin:0,marginBottom:"5px"},subtitle:{fontSize:"14px",color:"#8c6b3b",margin:0},tabs:{display:"flex",borderBottom:"1px solid #d4af37",padding:"0 20px",gap:"20px",backgroundColor:"#f5ecd5",justifyContent:"center"},tab:{padding:"10px 28px",cursor:"pointer",fontSize:"15px",color:"#8c6b3b",border:"none",borderRadius:"18px 18px 0 0/22px 22px 0 0",background:"linear-gradient(90deg, #f5ecd5 60%, #e0c9a6 100%)",marginBottom:"-1px",boxShadow:"0 2px 8px rgba(191,167,106,0.08)",transition:"all 0.3s",outline:"none",fontWeight:500,borderBottom:"2.5px solid transparent"},tabActive:{color:"#a67c2d",background:"linear-gradient(90deg, #f9f5e6 60%, #f3e2c2 100%)",borderBottom:"2.5px solid #a67c2d",boxShadow:"0 4px 16px rgba(191,167,106,0.13)",fontWeight:700},content:{flex:1,overflowY:"auto",padding:"28px 24px",fontSize:"15px",lineHeight:"1.7",background:"linear-gradient(135deg, #fffbe9 0%, #f5ecd5 100%)",color:"#181818",borderRadius:"18px",boxShadow:"0 2px 12px rgba(191,167,106,0.10)",border:"1.5px solid #e0c9a6",margin:"18px 0 0 0"},section:{marginBottom:"15px"},sectionTitle:{color:"#d4af37",fontWeight:"bold",marginBottom:"8px",fontSize:"16px"},warningBox:{backgroundColor:"rgba(191, 167, 106, 0.13)",borderLeft:"4px solid #bfa76a",padding:"14px",borderRadius:"10px",marginBottom:"14px",color:"#7c5c2a",fontWeight:500},infoBox:{backgroundColor:"rgba(191, 167, 106, 0.09)",borderLeft:"4px solid #a67c2d",padding:"14px",borderRadius:"10px",marginBottom:"14px",color:"#5b4322",fontWeight:500},list:{marginLeft:"20px",marginTop:"8px"},listItem:{marginBottom:"6px",color:"#181818"},guide:{backgroundColor:"#fffbe9",border:"1px solid #e0c9a6",borderRadius:"10px",padding:"14px",fontSize:"14px",lineHeight:"1.7",color:"#181818",maxHeight:"300px",overflowY:"auto",marginBottom:"14px",whiteSpace:"pre-wrap",wordBreak:"break-word"},footer:{display:"flex",gap:"12px",padding:"20px",borderTop:"1px solid #333",justifyContent:"flex-end"},button:{padding:"10px 20px",borderRadius:"4px",border:"none",fontSize:"14px",fontWeight:"bold",cursor:"pointer",transition:"all 0.3s"},buttonPrimary:{backgroundColor:"#a67c2d",color:"#fff",minWidth:"120px"},buttonSecondary:{backgroundColor:"#e0c9a6",color:"#7c5c2a",border:"1px solid #d4af37"},buttonWarning:{backgroundColor:"#bfa76a",color:"#fff"},buttonCopy:{backgroundColor:o?"#bfa76a":"#e0c9a6",color:o?"#fff":"#7c5c2a",border:`1.5px solid ${o?"#bfa76a":"#a67c2d"}`,width:"100%"}};return r.jsx("div",{style:l.overlay,children:r.jsxs("div",{style:l.container,children:[r.jsxs("div",{style:l.header,children:[r.jsx("div",{style:l.warningBanner,children:" "}),r.jsx("h1",{style:l.title,children:" "}),r.jsx("p",{style:l.subtitle,children:""})]}),r.jsxs("div",{style:l.tabs,children:[r.jsx("button",{style:{...l.tab,...n==="warning"?l.tabActive:{}},onClick:()=>s("warning"),children:""}),r.jsx("button",{style:{...l.tab,...n==="guide"?l.tabActive:{}},onClick:()=>s("guide"),children:""})]}),r.jsxs("div",{style:l.content,children:[n==="warning"&&r.jsxs(r.Fragment,{children:[r.jsxs("div",{style:l.warningBox,children:[r.jsx("div",{style:l.sectionTitle,children:" "}),r.jsxs("p",{children:["",r.jsx("strong",{children:""})," "]})]}),r.jsxs("div",{style:l.section,children:[r.jsx("div",{style:l.sectionTitle,children:" "}),r.jsxs("ul",{style:l.list,children:[r.jsx("li",{style:l.listItem,children:""}),r.jsx("li",{style:l.listItem,children:""}),r.jsx("li",{style:l.listItem,children:""}),r.jsx("li",{style:l.listItem,children:""}),r.jsx("li",{style:l.listItem,children:""})]})]}),r.jsxs("div",{style:l.section,children:[r.jsx("div",{style:l.sectionTitle,children:" "}),r.jsxs("p",{children:["",r.jsx("strong",{children:'""'}),""]}),r.jsxs("p",{children:["",r.jsx("strong",{children:'""'}),""]})]}),r.jsxs("div",{style:l.infoBox,children:[r.jsx("div",{style:l.sectionTitle,children:" "}),r.jsxs("p",{children:["",r.jsx("strong",{children:""}),""]}),r.jsx("p",{children:'""'}),r.jsxs("p",{children:["  ",r.jsx("b",{children:"100000 "}),""]}),r.jsx("p",{style:{color:"#a67c2d",fontWeight:"bold"},children:""})]})]}),n==="guide"&&r.jsxs(r.Fragment,{children:[r.jsxs("div",{style:l.section,children:[r.jsx("div",{style:l.sectionTitle,children:" "}),r.jsx("p",{children:""})]}),r.jsx("div",{style:l.guide,children:'    bug    ""   1. "" 2. " " 3. " " 4.    1. "" 2. " " 3.  -   -   -   4.    -  - 100000    1.  2. Base64 3.  4.  '}),r.jsx("button",{style:{...l.button,...l.buttonCopy},onClick:a,children:o?" ":" "}),r.jsxs("div",{style:{...l.infoBox,marginTop:"15px"},children:[r.jsxs("p",{children:[" ",r.jsx("strong",{children:""})]}),r.jsxs("ul",{style:l.list,children:[r.jsx("li",{style:l.listItem,children:""}),r.jsx("li",{style:l.listItem,children:""}),r.jsx("li",{style:l.listItem,children:""}),r.jsx("li",{style:l.listItem,children:""})]})]})]})]}),r.jsxs("div",{style:l.footer,children:[r.jsx("button",{style:{...l.button,...l.buttonSecondary,...l.buttonWarning},onClick:t,children:""}),r.jsx("button",{style:{...l.button,...l.buttonPrimary},onClick:e,children:""})]})]})})},R5=({onComplete:e})=>{const[t,n]=b.useState(0),[s,o]=b.useState(!1);b.useEffect(()=>{const a=setInterval(()=>{n(l=>l>=100?(clearInterval(a),setTimeout(()=>{o(!0)},300),100):l+2)},30);return()=>clearInterval(a)},[]);const i=()=>{e()};return s?r.jsx("div",{style:Vt.overlay,children:r.jsxs("div",{style:Vt.warningContainer,children:[r.jsx("h2",{style:Vt.warningTitle,children:""}),r.jsxs("div",{style:Vt.warningContent,children:[r.jsx("p",{style:Vt.warningText,children:""}),r.jsx("p",{style:Vt.warningText,children:""}),r.jsx("p",{style:Vt.warningText,children:""}),r.jsx("p",{style:Vt.warningText,children:""})]}),r.jsx("button",{onClick:i,style:Vt.continueBtn,children:" "})]})}):r.jsx("div",{style:Vt.overlay,children:r.jsxs("div",{style:Vt.container,children:[r.jsx("h1",{style:Vt.title,children:""}),r.jsx("p",{style:Vt.subtitle,children:""}),r.jsxs("div",{style:Vt.progressContainer,children:[r.jsx("div",{style:Vt.progressBar,children:r.jsx("div",{style:{...Vt.progressFill,width:`${t}%`}})}),r.jsxs("p",{style:Vt.progressText,children:[t,"%"]})]}),r.jsx("p",{style:Vt.loadingText,children:"..."})]})})},Vt={overlay:{position:"fixed",top:0,left:0,width:"100%",height:"100%",background:"linear-gradient(135deg, #1a1a2e 0%, #16213e 100%)",zIndex:9999,display:"flex",justifyContent:"center",alignItems:"center"},container:{textAlign:"center",color:"white",padding:"40px",maxWidth:"600px",width:"90%"},title:{fontSize:"clamp(32px, 8vw, 48px)",marginBottom:"10px",color:"#d4af37",textShadow:"0 0 20px rgba(212, 175, 55, 0.5)",fontWeight:"bold",letterSpacing:"4px"},subtitle:{fontSize:"clamp(14px, 3vw, 18px)",color:"#ccc",marginBottom:"60px",letterSpacing:"2px"},progressContainer:{marginBottom:"30px"},progressBar:{width:"100%",height:"8px",background:"rgba(255, 255, 255, 0.1)",borderRadius:"4px",overflow:"hidden",marginBottom:"10px"},progressFill:{height:"100%",background:"linear-gradient(90deg, #d4af37 0%, #ffd700 100%)",transition:"width 0.3s ease",boxShadow:"0 0 10px rgba(212, 175, 55, 0.5)"},progressText:{fontSize:"14px",color:"#d4af37",fontWeight:"bold"},loadingText:{fontSize:"14px",color:"#888",animation:"pulse 1.5s ease-in-out infinite"},warningContainer:{background:"linear-gradient(135deg, #2d2d2d 0%, #1a1a1a 100%)",padding:"clamp(30px, 6vw, 50px)",borderRadius:"16px",maxWidth:"600px",width:"90%",border:"2px solid #d4af37",boxShadow:"0 20px 60px rgba(0, 0, 0, 0.8)"},warningTitle:{fontSize:"clamp(24px, 5vw, 32px)",color:"#d4af37",marginBottom:"30px",textAlign:"center",fontWeight:"bold"},warningContent:{marginBottom:"30px"},warningText:{fontSize:"clamp(14px, 3vw, 16px)",color:"#fff",lineHeight:"2",marginBottom:"10px",textAlign:"center"},continueBtn:{width:"100%",padding:"clamp(12px, 3vw, 15px)",background:"#d4af37",border:"none",borderRadius:"8px",color:"#1a1a1a",fontSize:"clamp(14px, 3vw, 16px)",fontWeight:"bold",cursor:"pointer",transition:"all 0.3s",boxShadow:"0 4px 15px rgba(212, 175, 55, 0.3)"}},M5=e=>{if(!e||!e.player)return e;const{player:t,children:n=[],activeNpcs:s=[],deadNpcs:o=[]}=e;return A5(t)?(console.warn(" ..."),N5(e)):e};function A5(e){const t=[];(!e.combatStats||typeof e.combatStats!="object")&&t.push("combatStats"),e.rival||t.push("rival"),e.time||t.push("time"),e.manuals!==void 0&&typeof e.manuals!="object"&&t.push("manuals");const n=t.length>=4;return n&&console.warn(" ",t),n}function N5(e){var E,S;const{player:t,children:n=[],activeNpcs:s=[],deadNpcs:o=[]}=e,i={name:t.name,age:t.age,gender:t.gender,avatar:t.avatar,tier:t.tier,currentExp:t.currentExp,maxExp:t.maxExp,time:t.time,cultivation:t.cultivation||0},a={spiritStones:((E=t.resources)==null?void 0:E.spiritStones)||0,money:((S=t.resources)==null?void 0:S.money)||0},l=t.affectionRecords||{},d=t.cultivationMethod||null,u=t.manuals||{},p=t.familyRating||{currentId:"CLAN_SEED",history:[]},c=t.skillPoints||0,m=Array.isArray(t.generation3Plus)?t.generation3Plus:[],v={...i,resources:a,affectionRecords:l,cultivationMethod:d,manuals:u,familyRating:p,skillPoints:c,generation3Plus:m,compensationApplied:!0,compensationTime:new Date().toISOString()};let w=[];return v.resources.spiritStones=(v.resources.spiritStones||0)+1e5,console.log(" "),console.log(" 100000 "),console.log(" ",{cultivationMethod:d,manualsCount:Object.keys(u).length}),console.log(" ",{currentRating:p.currentId,historyCount:p.history.length}),console.log(" ",{skillPoints:c}),console.log(" ",{cultivation:i.cultivation}),{...e,player:v,children:n||[],activeNpcs:qg(s),deadNpcs:qg(o),inventory:w,logs:[]}}function qg(e){return Array.isArray(e)?e.map(t=>({id:t.id,name:t.name,personality:t.personality,identity:t.identity,affection:t.affection||0,favorabilityLevel:t.favorabilityLevel||0,...t})):[]}const L5=e=>e.compensationApplied?`

 100000 `:null,$5=({player:e,children:t,managerOptions:n=[],onBuy:s,onAssign:o})=>{var R;const[i,a]=b.useState({}),[l,d]=b.useState(new Set),[u,p]=b.useState(1),[c,m]=b.useState(1),v=5,w=5,E=[...n].sort((C,I)=>{var ee,$;const T=((ee=C.stats)==null?void 0:ee.intelligence)||C.intelligence||0;return((($=I.stats)==null?void 0:$.intelligence)||I.intelligence||0)-T}),S=b.useCallback((C,I)=>{const T=Math.max(0,parseInt(I)||0);a(L=>{const ee={...L};return T===0?delete ee[C]:ee[C]=T,ee})},[]),g=b.useCallback(()=>{var ee,$,O,H;const C=Object.entries(i).filter(([F,se])=>se>0).map(([F,se])=>({biz:El.find(de=>de.id===F),quantity:se}));if(C.length===0){(ee=window.showResult)==null||ee.call(window,"","",!1,null,!1);return}if(l.size===0){($=window.showResult)==null||$.call(window,"","",!1,null,!1);return}const I=C.reduce((F,se)=>F+se.quantity,0);if(I>l.size){(O=window.showResult)==null||O.call(window,"",` ${I}  ${l.size} `,!1,null,!1);return}const T=Array.from(l).map(F=>E.find(se=>se.id===F));let L=0;C.forEach(({biz:F,quantity:se})=>{var J;for(let de=0;de<se;de++){if(T.length===0){(J=window.showResult)==null||J.call(window,"","",!1,null,!1);break}const Ee=Math.floor(Math.random()*T.length),$e=T[Ee];s(F,$e.id),L++,T.splice(Ee,1)}}),(H=window.showResult)==null||H.call(window,"",` ${L} `,!0,null,!0),a({})},[i,l,E,s]),h=b.useCallback(()=>{const C={};El.forEach(I=>{C[I.id]=1}),a(C)},[]),x=b.useCallback(()=>{a({})},[]),k=b.useCallback(C=>{d(I=>{const T=new Set(I);return T.has(C)?T.delete(C):T.add(C),T})},[]),_=b.useCallback(()=>{d(new Set(E.map(C=>C.id)))},[E]),y=b.useCallback(()=>{d(new Set)},[]);return r.jsxs("div",{style:{padding:"10px"},children:[r.jsx("h3",{children:" "}),r.jsxs("p",{style:{fontSize:"12px",color:"#666"},children:["",r.jsx("br",{}),": ",((R=e.businesses)==null?void 0:R.reduce((C,I)=>C+I.income,0))||0," "]}),r.jsx("h4",{children:" "}),r.jsx("div",{style:fn.grid,children:El.map(C=>r.jsxs("div",{style:fn.card,children:[r.jsx("div",{style:{fontWeight:"bold"},children:C.name}),r.jsx("div",{style:{fontSize:"10px",color:"#555",height:"30px"},children:C.desc}),r.jsxs("div",{style:{fontSize:"12px",margin:"5px 0"},children:[": ",C.minTier," | : ",C.cost]}),r.jsxs("div",{style:{marginTop:"8px",display:"flex",alignItems:"center",gap:"6px"},children:[r.jsx("label",{style:{fontSize:"12px",fontWeight:"bold",color:"#666"},children:":"}),r.jsx("input",{type:"number",min:"0",max:"10",value:i[C.id]||0,onChange:I=>S(C.id,I.target.value),style:{width:"50px",padding:"4px",borderRadius:"4px",border:"1px solid #ccc",textAlign:"center",fontSize:"12px"}})]})]},C.id))}),r.jsx("hr",{style:{margin:"15px 0",borderColor:"#ddd"}}),r.jsx("h4",{children:" "}),r.jsxs("div",{style:fn.batchBuyContainer,children:[r.jsxs("div",{style:fn.batchControlRow,children:[r.jsx("button",{onClick:h,style:fn.controlBtn,children:" (1)"}),r.jsx("button",{onClick:x,style:fn.controlBtn,children:" "}),r.jsxs("span",{style:{fontSize:"13px",fontWeight:"bold",color:"#d32f2f"},children:[": ",Object.values(i).reduce((C,I)=>C+I,0)," "]})]}),r.jsxs("div",{style:fn.purchaseInfo,children:[r.jsxs("div",{style:{fontSize:"12px",color:"#666",marginBottom:"8px"},children:[" : ",Object.keys(i).length," "]}),Object.keys(i).length>0&&r.jsx("div",{style:{maxHeight:"100px",overflowY:"auto",fontSize:"12px",background:"white",padding:"6px",borderRadius:"4px",border:"1px solid #e0e0e0"},children:Object.entries(i).filter(([C,I])=>I>0).map(([C,I])=>{const T=El.find(L=>L.id===C);return r.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:"4px"},children:[r.jsx("span",{children:T==null?void 0:T.name}),r.jsxs("span",{style:{fontWeight:"bold",color:"#ff9800"},children:["",I]})]},C)})})]}),r.jsxs("div",{style:{...fn.managerSelectContainer,marginBottom:"12px",marginTop:"12px"},children:[r.jsx("div",{style:{fontSize:"13px",fontWeight:"bold",marginBottom:"8px",color:"#333"},children:"  ()"}),r.jsxs("div",{style:fn.batchControlRow,children:[r.jsx("button",{onClick:_,style:fn.controlBtn,children:" "}),r.jsx("button",{onClick:y,style:fn.controlBtn,children:" "}),r.jsxs("span",{style:{fontSize:"13px",fontWeight:"bold",color:"#1976d2"},children:[": ",l.size," / ",E.length]})]}),E.length===0?r.jsx("div",{style:{fontSize:"12px",color:"#999",padding:"10px"},children:""}):r.jsxs(r.Fragment,{children:[r.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(120px, 1fr))",gap:"8px",marginBottom:"10px"},children:E.slice((u-1)*v,u*v).map(C=>{var L;const I=l.has(C.id),T=((L=C.stats)==null?void 0:L.intelligence)||C.intelligence||0;return r.jsxs("label",{style:{...fn.managerCheckbox,...I?fn.managerCheckboxSelected:{}},children:[r.jsx("input",{type:"checkbox",checked:I,onChange:()=>k(C.id),style:{marginRight:"6px"}}),r.jsxs("div",{style:{flex:1},children:[r.jsx("div",{style:{fontSize:"12px",fontWeight:"bold",color:"#333"},children:C.name}),r.jsxs("div",{style:{fontSize:"11px",color:"#666"},children:[": ",T]})]})]},C.id)})}),Math.ceil(E.length/v)>1&&r.jsxs("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",gap:"8px",fontSize:"12px"},children:[r.jsx("button",{onClick:()=>p(Math.max(1,u-1)),disabled:u===1,style:{padding:"4px 8px",borderRadius:"4px",border:"1px solid #ccc",background:u===1?"#f0f0f0":"#fff",cursor:u===1?"not-allowed":"pointer",opacity:u===1?.6:1},children:""}),r.jsxs("span",{style:{color:"#666"},children:[u," / ",Math.ceil(E.length/v)]}),r.jsx("button",{onClick:()=>p(Math.min(Math.ceil(E.length/v),u+1)),disabled:u===Math.ceil(E.length/v),style:{padding:"4px 8px",borderRadius:"4px",border:"1px solid #ccc",background:u===Math.ceil(E.length/v)?"#f0f0f0":"#fff",cursor:u===Math.ceil(E.length/v)?"not-allowed":"pointer",opacity:u===Math.ceil(E.length/v)?.6:1},children:""})]})]})]}),r.jsx("button",{onClick:g,disabled:Object.values(i).reduce((C,I)=>C+I,0)===0,style:{...fn.batchPurchaseBtn,...Object.values(i).reduce((C,I)=>C+I,0)===0?fn.batchPurchaseBtnDisabled:{}},children:" "}),l.size>0&&r.jsxs("div",{style:{fontSize:"12px",color:"#666",marginTop:"8px",padding:"8px",background:"white",borderRadius:"4px",border:"1px solid #e0e0e0"},children:["  ",l.size," "]})]}),r.jsx("hr",{style:{margin:"15px 0",borderColor:"#ddd"}}),r.jsx("h4",{children:" "}),r.jsx("div",{style:{marginBottom:"20px"},children:!e.businesses||e.businesses.length===0?r.jsx("div",{style:{fontSize:"12px",color:"#999",padding:"10px"},children:""}):r.jsx(r.Fragment,{children:r.jsx("div",{style:{marginBottom:"10px"},children:(()=>{const C=e.businesses.length,I=Math.ceil(C/w),T=(c-1)*w,L=Math.min(T+w,C),ee=e.businesses.slice(T,L);return r.jsxs(r.Fragment,{children:[ee.map(($,O)=>{const H=t.find(F=>F.id===$.managerId);return r.jsxs("div",{style:fn.bizCard,children:[r.jsx("div",{style:{fontWeight:"bold"},children:$.name}),r.jsxs("div",{style:{fontSize:"12px"},children:[": ",H?H.name:r.jsx("span",{style:{color:"red"},children:""}),H&&` (:${H.stats.intelligence})`]}),r.jsxs("div",{style:{color:"#2e7d32"},children:[": ",$.income]})]},O)}),I>1&&r.jsxs("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",gap:"8px",marginTop:"10px",fontSize:"12px"},children:[r.jsx("button",{onClick:()=>m(Math.max(1,c-1)),disabled:c===1,style:{padding:"4px 8px",borderRadius:"4px",border:"1px solid #ccc",background:c===1?"#f0f0f0":"#fff",cursor:c===1?"not-allowed":"pointer",opacity:c===1?.6:1},children:""}),r.jsxs("span",{style:{color:"#666"},children:[c," / ",I]}),r.jsx("button",{onClick:()=>m(Math.min(I,c+1)),disabled:c===I,style:{padding:"4px 8px",borderRadius:"4px",border:"1px solid #ccc",background:c===I?"#f0f0f0":"#fff",cursor:c===I?"not-allowed":"pointer",opacity:c===I?.6:1},children:""}),r.jsxs("span",{style:{color:"#999",marginLeft:"8px"},children:[" ",C," "]})]})]})})()})})})]})},fn={grid:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"10px"},card:{border:"1px solid #ddd",padding:"10px",borderRadius:"8px",background:"white"},bizCard:{border:"1px solid #81c784",background:"#e8f5e9",padding:"10px",borderRadius:"8px",marginBottom:"5px"},batchBuyContainer:{background:"#f5f5f5",padding:"12px",borderRadius:"8px",border:"1px solid #e0e0e0",marginBottom:"15px"},batchControlRow:{display:"flex",gap:"8px",alignItems:"center",marginBottom:"12px",flexWrap:"wrap"},controlBtn:{padding:"6px 12px",fontSize:"12px",border:"1px solid #999",borderRadius:"4px",background:"#fff",cursor:"pointer",fontWeight:"bold"},purchaseInfo:{background:"white",padding:"8px",borderRadius:"4px",border:"1px solid #e0e0e0",marginBottom:"10px"},batchPurchaseBtn:{width:"100%",padding:"10px",background:"#2196f3",color:"white",border:"none",borderRadius:"4px",fontWeight:"bold",cursor:"pointer",fontSize:"14px"},batchPurchaseBtnDisabled:{background:"#ccc",cursor:"not-allowed"},managerSelectContainer:{background:"#e3f2fd",padding:"12px",borderRadius:"8px",border:"1px solid #90caf9"},managerCheckbox:{display:"flex",alignItems:"center",gap:"6px",padding:"8px",backgroundColor:"white",borderRadius:"6px",border:"1px solid #ddd",cursor:"pointer",transition:"all 0.2s",fontSize:"12px"},managerCheckboxSelected:{borderColor:"#1976d2",background:"#e3f2fd",boxShadow:"0 0 4px rgba(25, 118, 210, 0.3)"}},B5=$c.memo($5),O5=({player:e,children:t,onChallenge:n,isRomanceLimitReached:s=!1})=>{var _;const[o,i]=b.useState(null),[a,l]=b.useState([]),[d,u]=b.useState(!1),[p,c]=b.useState(10),[m,v]=b.useState(!1),w=t.filter(y=>y.age>=16),E=y=>{if(a.includes(y))l(R=>R.filter(C=>C!==y));else{if(a.length>=3){window.showResult&&window.showResult("","3",!1,null,!1);return}l(R=>[...R,y])}},S=au(e)+a.reduce((y,R)=>{const C=w.find(I=>I.id===R);return y+(C?au(C):0)},0),g=o&&S>=o.recommendCP*1.5,h=((e==null?void 0:e.energy)!==void 0?e.energy:((_=e==null?void 0:e.resources)==null?void 0:_.energy)||20)||20,x=Math.floor(h/5);o&&console.log(" ChallengePanel :",{playerEnergy:h,maxBatchCount:x});const k=()=>{var I;if(a.length===0){window.showResult&&window.showResult("","",!1,null,!1);return}if(!g){window.showResult&&window.showResult("","150%",!1,null,!1);return}const y=Math.min(p,x);if(y<=0){window.showResult&&window.showResult("","5",!1,null,!1);return}v(!0);const R=o.cost*y,C=((I=e.resources)==null?void 0:I.spiritStones)||0;if(C<R){window.showResult&&window.showResult("",` ${R}  ${C} `,!1,null,!1),v(!1);return}setTimeout(()=>{n(o,a,{batchCount:y,isFastMode:!0}),v(!1),i(null),u(!1),c(10)},500)};return r.jsx("div",{style:{padding:"10px"},children:o?r.jsxs("div",{children:[r.jsx("button",{onClick:()=>i(null),children:" "}),r.jsxs("h3",{children:[" ",o.name]}),r.jsx("p",{children:o.desc}),r.jsxs("div",{style:Os.statBox,children:[r.jsxs("div",{children:[": ",o.recommendCP]}),r.jsxs("div",{children:[": ",r.jsx("span",{style:{color:S>=o.recommendCP?"green":"red"},children:S})]}),r.jsxs("div",{children:[": ",(o.risk*100).toFixed(0),"%"]})]}),r.jsx("h4",{children:" (3)"}),r.jsx("div",{style:Os.list,children:w.map(y=>r.jsxs("div",{onClick:()=>E(y.id),style:{...Os.fighterRow,background:a.includes(y.id)?"#ffe0b2":"white"},children:[r.jsxs("span",{children:[y.name," (",y.tierTitle,")"]}),r.jsxs("span",{children:["CP: ",au(y)]})]},y.id))}),r.jsxs("button",{style:Os.startBtn,onClick:()=>n(o,a),children:[" ( ",o.cost," )"]}),g&&r.jsxs("div",{style:{marginTop:"15px"},children:[r.jsx("div",{style:{padding:"10px",background:"#e8f5e9",borderRadius:"5px",marginBottom:"10px",fontSize:"13px",color:"#2e7d32",fontWeight:"500"},children:" "}),d?r.jsxs("div",{style:{border:"1px solid #1976d2",padding:"15px",borderRadius:"8px",background:"#f5f5f5"},children:[r.jsx("div",{style:{marginBottom:"10px",fontWeight:"bold"},children:" "}),r.jsxs("div",{style:{marginBottom:"10px"},children:[r.jsx("label",{style:{fontSize:"13px"},children:""}),r.jsx("input",{type:"number",min:"1",max:x,value:p,onChange:y=>c(Math.max(1,Math.min(x,parseInt(y.target.value)||1))),disabled:m||x===0,style:{width:"60px",padding:"5px",marginLeft:"5px",border:"1px solid #999",borderRadius:"4px"}}),r.jsxs("span",{style:{marginLeft:"10px",fontSize:"12px",color:"#666"},children:[" ",x,"  |  ",o.cost*Math.min(p,x)," ",Math.min(p,x)*5," "]})]}),r.jsxs("div",{style:{display:"flex",gap:"10px"},children:[r.jsx("button",{style:{flex:1,padding:"10px",background:m||x===0?"#999":"#1976d2",color:"white",border:"none",borderRadius:"5px",cursor:m||x===0?"not-allowed":"pointer",fontWeight:"bold"},onClick:k,disabled:m||x===0,children:m?"...":x===0?"":""}),r.jsx("button",{style:{flex:1,padding:"10px",background:"#999",color:"white",border:"none",borderRadius:"5px",cursor:m?"not-allowed":"pointer"},onClick:()=>u(!1),disabled:m,children:""})]})]}):r.jsx("button",{style:{...Os.startBtn,background:"#1976d2"},onClick:()=>u(!0),children:" "})]})]}):r.jsxs("div",{children:[r.jsx("h3",{children:" "}),r.jsx("p",{style:{fontSize:"12px",color:"#666"},children:""}),s&&r.jsx("div",{style:{padding:"12px",marginBottom:"15px",backgroundColor:"#fff3e0",borderLeft:"4px solid #ff9800",borderRadius:"4px",color:"#e65100",fontSize:"13px",fontWeight:"500"},children:" "}),r.jsx("div",{style:Os.list,children:zy.map(y=>r.jsxs("div",{onClick:()=>i(y),style:Os.realmCard,children:[r.jsx("div",{style:{fontWeight:"bold"},children:y.name}),r.jsxs("div",{style:{fontSize:"12px",color:"#d81b60"},children:[": ",y.reqTier]}),r.jsxs("div",{style:{fontSize:"12px"},children:[": ",y.cost]})]},y.id))})]})})},Os={list:{display:"flex",flexDirection:"column",gap:"8px",maxHeight:"300px",overflowY:"auto"},realmCard:{border:"1px solid #ddd",padding:"15px",borderRadius:"8px",cursor:"pointer",background:"white",display:"flex",justifyContent:"space-between",alignItems:"center"},fighterRow:{padding:"10px",borderBottom:"1px solid #eee",display:"flex",justifyContent:"space-between",cursor:"pointer"},statBox:{background:"#eee",padding:"10px",borderRadius:"5px",margin:"10px 0",fontSize:"14px"},startBtn:{width:"100%",padding:"15px",background:"#d32f2f",color:"white",border:"none",borderRadius:"8px",fontSize:"16px",marginTop:"20px",cursor:"pointer"}},P5={LEVEL_UP:[" {actor} {detail}","{actor} {detail}","{actor} {detail}","{actor} {detail}"],NPC_BREAKTHROUGH:[" {actor} {detail}"," {actor} {detail}","{actor} {detail}"],BREAKTHROUGH_FAIL:["{actor} {detail}","{actor} {detail}","{actor} {detail}"],MARRIAGE:["{actor}  {target} ","{actor}  {target} ","{actor}  {target} ","{actor}  {target} ","{actor}{target}/","{target}{actor}","{actor}{target}","{actor}{target}"],BIRTH:["{actor}  {target}","{actor}  {target}","{actor}  {target} "],DEATH:["{actor}  {location} ","{actor}  {detail} ","{actor} "],COMBAT:["{actor}  {location}  {target}","{actor}  {target}  {actor} "," {actor}  {location}  {target}","{location}{actor}{target}{actor}","{actor}{target}","{actor}{target}{location}"],JOIN_SECT:["{actor}  {target}  {detail} ","{target}  {detail}","{target}  {detail} "],GRANDCHILD:["{actor} ","{actor} {detail}"],EXPLORATION:["{actor}  {location}  {detail}"," {actor}  {location}"],FILLER:["","","","","","","","","","","","30%","","","","''","''","","","''","","","",""],RIVAL_RISE:["{actor}","{actor}{detail}''"],RIVAL_BREAKTHROUGH:["{actor}{tier}","{actor}{tier}","{actor}{tier}"],RIVAL_ENGAGED:["{actor}{target}","{target}{actor}"],RIVAL_MARRIAGE:["{target}{actor}","{actor}{target}{target}"],RIVAL_HEIR:["{actor}{target}","{actor}"],RIVAL_STAGE_EVENT:["{actor}{stageTitle}{description}","{actor}{stageTier}{description}","{actor}{stageRole}{description}"],REVENGE_STAGE_ADVANCE:["{actor}{clearedStage}{nextStage}","{actor}{clearedStage}","{actor}{clearedStage}"],REVENGE_SAGA_COMPLETE:["{actor}{finalTarget}","{actor}{finalTarget}","{actor}{finalTarget}"],REVENGE_DUEL_FAILED:["{actor}{rival}","{actor}{rival}","{stageTitle}{actor}"],RIVAL_LIGHT_RUMOR:["{actor}","{actor}''","{actor}"],RIVAL_HEAVY_RUMOR:["{actor}","{actor}","{actor}"],RIVAL_THREAT_MEDIUM:["{playerName}","{actor}..."],RIVAL_THREAT_HIGH:["{actor}''","{actor}"],RIVAL_THREAT_CRITICAL:["","{actor}","..."],RIVAL_HIDE_SUCCESS:["{actor}","{actor}{months}","{actor}"],ASSASSINATION_SURVIVED:["{actor}","{actor}","{actor}"],ASSASSINATION_INJURED:["{actor}","{actor}","{actor}"],RIVAL_DEFEATED:["{target}{actor}","{actor}{target}","{target}...{actor}"],RIVAL_VICTORY:["{target}{actor}","{target}{actor}"],NPC_AFFECTION_HIGH:["{actor}{target}","{target}{actor}","{actor}{target}"],NPC_JEALOUSY:["{actor}{target}{rival}","{actor}{target}","{actor}{target}'{rival}'","{actor}{rival}{target}"],SHURA_FIELD:["{actor}{participants}","{dominant}{rival}{actor}","{actor}{count}"],DUAL_CULTIVATION:["{actor}{target}","{actor}{target}","{actor}{target}"],NPC_PURSUIT:["{actor}{target}{target}","{actor}{target}","{target}{actor}","{actor}{target}"],NPC_ANGRY:["{actor}{target}{target}''","{actor}{target}","{target}{actor}''{actor}"],CHILD_TALENT:["{actor}{target}","{target}{actor}","{actor}{target}"],SECT_PROMOTION:["{actor}","{actor}{detail}","{actor}"],TREASURE_FIND:["{actor}{detail}","{actor}","{actor}{detail}"],RETREAT:["{actor}{detail}","{actor}","{actor}"],TOURNAMENT:["{actor}","{actor}''","{target}{actor}"],INJURED:["{actor}{target}","{actor}{target}","{actor}"],APPRENTICE:["{actor}{target}","{target}{actor}","{actor}{detail}"]};function jo(e,t){const n=P5[e];if(!n||n.length===0)return null;let o=n[Math.floor(Math.random()*n.length)];return Object.keys(t).forEach(i=>{const a=`{${i}}`;o=o.replace(new RegExp(a,"g"),t[i])}),o}function z5(e,t,n=[]){const s=[],o=new Set,i=a=>a?typeof a.status=="string"?a.status!=="DEAD":typeof a.isDead=="boolean"?!a.isDead:!0:!1;return s.push({name:t.name,cultivation:t.currentExp||0,tier:t.tier||"",isPlayer:!0}),o.add(t.name),t.worldNpcs&&t.worldNpcs.length>0&&t.worldNpcs.filter(i).forEach(a=>{o.has(a.name)||(s.push({name:a.name,title:a.title,cultivation:a.currentExp||0,tier:a.tier||"",isPlayer:!1,worldNpcData:a}),o.add(a.name))}),n&&Array.isArray(n)&&n.filter(i).forEach(a=>{var l,d;if(!o.has(a.name)){const u=a.currentExp||a.cultivation||0;s.push({name:a.name,title:a.rank?`${((l=a.sect)==null?void 0:l.name)||""}${a.rank}`:((d=a.sect)==null?void 0:d.name)||"",cultivation:u,tier:a.tierTitle||a.tier||"",isPlayer:!1,isChild:!0,childData:a}),o.add(a.name)}}),e&&e.length>0&&e.filter(i).forEach(a=>{o.has(a.name)||(s.push({name:a.name,cultivation:a.currentExp||0,tier:a.tier||"",isPlayer:!1}),o.add(a.name))}),s.sort((a,l)=>{if(l.cultivation!==a.cultivation)return l.cultivation-a.cultivation;const d=["","","","","","","","","",""];return d.indexOf(a.tier)-d.indexOf(l.tier)}),s.slice(0,3).map((a,l)=>{var w,E,S;const d=["","",""],u=a.isPlayer?"":"",p=a.isChild?"":"",c=!a.isPlayer&&((w=a.worldNpcData)==null?void 0:w.sectRank)===""&&((S=(E=a.worldNpcData)==null?void 0:E.sect)!=null&&S.name)?`${a.worldNpcData.sect.name}`:"",m=a.title?`${a.title}`:"";return{displayText:`${d[l]} ${u}${p}${c}${m}${a.name} - ${a.tier}`,name:a.name,title:a.title,tier:a.tier,isPlayer:a.isPlayer,isChild:a.isChild,worldNpcData:a.worldNpcData,childData:a.childData}})}const Ta=50,vu=(e=[])=>Array.isArray(e)?e.length<=Ta?e:e.slice(-Ta):[];function D5(e){if(!Array.isArray(e)||e.length===0)return e;const t=e.filter(o=>o.type==="MARRIAGE"||o.type==="RIVAL_MARRIAGE"),n=e.filter(o=>o.type==="BIRTH"||o.type==="GRANDCHILD"||o.type==="RIVAL_HEIR");return t.length===0||n.length===0?e:e.filter(o=>{var i;if(o.type==="BIRTH"||o.type==="GRANDCHILD"||o.type==="RIVAL_HEIR"){const a=(i=o.data)==null?void 0:i.actor,l=o.timestamp||Date.now();if(a){const d=t.filter(u=>{var p,c;return((p=u.data)==null?void 0:p.actor)===a||((c=u.data)==null?void 0:c.target)===a});for(const u of d){const p=u.timestamp||Date.now(),c=(l-p)/(1e3*60*60*24*30);if(c>=0&&c<12)return!1}}}return!0})}function F5(e,t){if(!t||t.length===0)return[];const n=[],s=new Map,o=new Map;return t.forEach((i,a)=>{o.set(i.name,a+1)}),e.forEach((i,a)=>{const l=a+1,d=o.get(i.name);if(d){if(d!==l){if(i.isPlayer)return;const u=l<d?"":"",p=Math.abs(l-d),c=u===""?"":"",m=i.isChild?"[]":"",v=`${c} ${m}${i.name}${u}${p}(${d}${l})`;s.has(v)||(n.push(v),s.set(v,!0))}}else{if(i.isPlayer)return;const u=i.isChild?"":"",p=i.isChild?"[]":"",c=`${u} ${p}${i.name}`;s.has(c)||(n.push(c),s.set(c,!0))}}),o.forEach((i,a)=>{if(!e.some(d=>d.name===a)){const d=` ${a}`;s.has(d)||(n.push(d),s.set(d,!0))}}),n}function H5(e,t,n){if(!t||t.length===0)return[];const s=[],o=new Map,i=new Map;return t.forEach(a=>{a.worldNpcData&&i.set(a.sectId,{name:a.worldNpcData.name,tier:a.worldNpcData.tier,npcId:a.worldNpcData.id})}),e.forEach(a=>{const l=i.get(a.sectId);if(a.worldNpcData)if(l){if(l.name!==a.worldNpcData.name){let d=!0;if(n!=null&&n.worldNpcs&&l.npcId){const u=n.worldNpcs.find(p=>p.id===l.npcId);if(u&&u.status==="DEAD"){const p=` ${a.sectName}${l.name}${a.worldNpcData.name}`;o.has(p)||(s.push(p),o.set(p,!0)),d=!1}}if(d){const u=` ${a.sectName}${l.name}${a.worldNpcData.name}`;o.has(u)||(s.push(u),o.set(u,!0))}}}else{const d=a.worldNpcData.status==="ALIVE"?"":"[]",u=` ${a.sectName}${d}${a.worldNpcData.name}`;o.has(u)||(s.push(u),o.set(u,!0))}else if(l){let d=!0;if(n!=null&&n.worldNpcs&&l.npcId){const u=n.worldNpcs.find(p=>p.id===l.npcId);u&&u.status==="ALIVE"&&(d=!1)}if(d){const u=` ${a.sectName}${l.name}`;o.has(u)||(s.push(u),o.set(u,!0))}}}),s}function W5(e){const n=((e==null?void 0:e.worldNpcs)||[]).filter(o=>{var i;return(o==null?void 0:o.status)!=="DEAD"&&(o==null?void 0:o.sectRank)===""&&((i=o==null?void 0:o.sect)==null?void 0:i.id)}),s=new Map;return n.forEach(o=>{s.has(o.sect.id)||s.set(o.sect.id,o)}),Er.filter(o=>o&&o.id&&o.id!=="SECT_NONE").map(o=>{const i=s.get(o.id),a=i!=null&&i.title?`${i.title}`:"";return{displayText:i?`${o.name}${a}${i.name} - ${i.tier}`:`${o.name}`,sectId:o.id,sectName:o.name,worldNpcData:i||null}}).slice(0,10)}function U5(e,t,n,s,o=[],i=null){var _,y;const a=[],l=[];if(t.rival){const R=aC(t.rival);if(R){const C=jo(R.type,R.data);C&&a.unshift(C)}}e.filter(R=>R.type==="RIVAL_BREAKTHROUGH").forEach(R=>{const C=jo(R.type,R.data);C&&a.unshift(C)});const u=[];let p=[];e.forEach(R=>{R.type.startsWith("RIVAL_")?u.push(R):p.push(R)}),p=D5(p),u.forEach(R=>{const C=jo(R.type,R.data);C&&a.push(C)});const c=[],m=[];p.forEach(R=>{R.data.actor===t.name||R.data.target===t.name||R.type==="LEVEL_UP"||R.type==="MARRIAGE"||R.type==="BIRTH"||R.type==="COMBAT"?c.push(R):m.push(R)});const v=8,w=Math.ceil(v*.25),E=Math.ceil(v*.75);let S=0;c.forEach(R=>{if(S<w){const C=jo(R.type,R.data);C&&(a.push(C),S++)}}),m.forEach(R=>{const C=jo(R.type,R.data);C&&(a.length<5?a.push(C):l.push(C))});const g=a.length+l.length,h=Math.max(0,E-(g-S));for(let R=0;R<h;R++){const C=jo("FILLER",{});a.length<5?a.push(C):l.push(C)}const x=z5(n,t,o),k=W5(t);if(i&&i.powerRanking&&i.sectRanking){const R=F5(x,i.powerRanking),C=H5(k,i.sectRanking,t);R.length>0&&R.forEach(I=>{a.length<3?a.unshift(I):l.unshift(I)}),C.length>0&&C.forEach(I=>{a.length<5?a.push(I):l.push(I)})}return{issue:s,year:((_=t.time)==null?void 0:_.year)||t.age||0,month:((y=t.time)==null?void 0:y.month)||t.month||1,headlines:a,rumors:l,powerRanking:x,sectRanking:k,timestamp:Date.now()}}function G5(e,t,n,s,o,i=[]){const a=t.gazetteHistory&&t.gazetteHistory.length>0?t.gazetteHistory[t.gazetteHistory.length-1]:null;return U5(e,t,n,s,i,a)}function Yt(e,t,n){Array.isArray(e)&&(e.push({type:t,data:n,timestamp:Date.now()}),e.length>Ta&&e.splice(0,e.length-Ta))}const V5=(e,t,n=[])=>{const s=t.combatStats||{maxHp:100,maxMp:50},o=a=>{const l=a.combatStats||{maxHp:100,maxMp:50,atk:10,def:5};return{...a,combatStats:l,currentHp:l.maxHp,currentMp:l.maxMp,isDefending:!1}},i=[o(e),...n.map(o)];return{player:i[0],party:i,enemy:{...t,currentHp:s.maxHp,currentMp:s.maxMp,combatStats:s},turn:0,logs:[],result:null}},Y5=(e,t,n=null)=>{const{party:s,enemy:o}=e,i=[...e.logs];let a=s.map(w=>({...w})),l={...o},d=null;const u=e.turn+1;i.push(`===  ${u}  ===`);for(let w=0;w<a.length;w++){const E=a[w];if(E.currentHp<=0)continue;const S=q5(E,l,t);if(a[w]=S.player,l=S.enemy,i.push(...S.logs),l.currentHp<=0)return i.push(`${l.name} `),d="win",{party:a,player:a[0],enemy:l,turn:u,logs:i,result:d}}if(a.filter(w=>w.currentHp>0).length===0)return i.push(""),d="lose",{party:a,player:a[0],enemy:l,turn:u,logs:i,result:d};const c=a.findIndex(w=>w.currentHp>0),m=K5(l,a[c]);return l=m.enemy,a[c]=m.player,i.push(...m.logs),a.some(w=>w.currentHp>0)?{party:a,player:a[0],enemy:l,turn:u,logs:i,result:d}:(i.push(""),d="lose",{party:a,player:a[0],enemy:l,turn:u,logs:i,result:d})},q5=(e,t,n,s)=>{var i,a,l;const o=[];switch(n){case"attack":const d=Su(e,t);t.currentHp-=d,t.currentHp=Math.max(0,Math.floor(t.currentHp)),o.push(`${e.name}  ${t.name}  ${d} `),o.push(`${t.name}  HP: ${t.currentHp}/${((i=t.combatStats)==null?void 0:i.maxHp)||0}`);break;case"defend":e.isDefending=!0,o.push(`${e.name} `);break;case"skill":const u=Math.floor(Su(e,t)*1.5);t.currentHp-=u,t.currentHp=Math.max(0,Math.floor(t.currentHp)),e.currentMp-=50,o.push(`${e.name}  ${t.name}  ${u} `),o.push(`${t.name}  HP: ${t.currentHp}/${((a=t.combatStats)==null?void 0:a.maxHp)||0}`);break;default:const p=Su(e,t);t.currentHp-=p,t.currentHp=Math.max(0,Math.floor(t.currentHp)),o.push(`${e.name}  ${t.name}  ${p} `),o.push(`${t.name}  HP: ${t.currentHp}/${((l=t.combatStats)==null?void 0:l.maxHp)||0}`)}return{player:e,enemy:t,logs:o}},K5=(e,t)=>{var c,m,v;const n=[],s=((c=e.combatStats)==null?void 0:c.atk)||10,o=((m=t.combatStats)==null?void 0:m.def)||5,i=s-Math.floor(o/2),a=Math.max(1,i),l=t.isDefending?Math.floor(a*.5):a,d=i<=0,u=t.isDefending&&l<a,p=d||u?"":"";return t.currentHp-=l,t.isDefending=!1,t.currentHp=Math.max(0,Math.floor(t.currentHp)),n.push(`${e.name}  ${t.name}  ${l} ${p}`),n.push(`${t.name}  HP: ${t.currentHp}/${((v=t.combatStats)==null?void 0:v.maxHp)||0}`),{enemy:e,player:t,logs:n}},Su=(e,t)=>{var a,l;const n=((a=e.combatStats)==null?void 0:a.atk)||10,s=((l=t.combatStats)==null?void 0:l.def)||5,o=n-Math.floor(s/2);return Math.max(1,o)},Qi=(e,t,n=[])=>{let s=V5(e,t,n);for(;!s.result;)s=Y5(s,"attack");return{success:s.result==="win",logs:s.logs,remainingHp:s.player.currentHp,party:s.party}};let Xs=1.3;const g1={aptitude:92,looks:95,intelligence:90,health:85,cunning:88};var fh;const wu={type:"",name:"",multiplier:((fh=Pt==null?void 0:Pt.SINGLE)==null?void 0:fh.multiplier)||1.8,elements:[""]},Q5={id:"CHU_CLAN",name:"",level:"HIGH"},J5={name:"",bonuses:{speedMultiplier:1.15}},Vf=e=>{if(!e)return e;e.stats={...g1,...e.stats||{}};const t=e.spiritRoot||wu;e.spiritRoot={...wu,...t,elements:Array.isArray(t.elements)?[...t.elements]:[...wu.elements]},e.sect=e.sect?{...e.sect}:{...Q5};const n=e.trait||J5;return e.trait={...n,bonuses:n.bonuses?{...n.bonuses}:void 0},e},Ac=(e,t=e==null?void 0:e.tier)=>{if(!e)return;const n=An(t||(e==null?void 0:e.tier));n!=null&&n.maxExp&&(e.maxExp=n.maxExp)},X5=e=>{const t=Math.min(.8,((e==null?void 0:e.baseThreat)||0)/100),n=(e==null?void 0:e.powerMultiplier)||1;return 1+t+(n-1)*.5},Z5=(e,t,n=!1)=>{if(!e)return 0;Vf(e),Ac(e);const s=Ca({...e,stats:e.stats,spiritRoot:e.spiritRoot,trait:e.trait,sect:e.sect},n)||0,o=n?1.8:1,i=X5(t),a=Math.max(n?10:120,Math.floor(s*i*o*Xs));return e.currentExp=Math.max(0,(e.currentExp||0)+a),a},Yf=e=>(e.revengeProgress||(e.revengeProgress={currentStageIndex:0,completedStages:[],sagaComplete:!1}),Array.isArray(e.revengeProgress.completedStages)||(e.revengeProgress.completedStages=[]),e.revengeProgress),eC=e=>(Array.isArray(e.newsBuffer)||(e.newsBuffer=[]),e.newsBuffer),h1=(e,t,{resetProgress:n=!0}={})=>{const s=e.rival||{},o=typeof t.baseThreat=="number"?t.baseThreat:0,i=An(t.tier);return e.rival={...s,name:t.name,stageId:t.id,tier:t.tier,maxExp:(i==null?void 0:i.maxExp)||s.maxExp||t.baseExp,state:n?"NORMAL":s.state||"NORMAL",lifeStage:n?0:s.lifeStage||0,storyTimer:n?0:s.storyTimer||0,isDead:n?!1:s.isDead||!1,rumorCount:n?0:s.rumorCount||0,threatLevel:n?o:s.threatLevel??o,hiddenTurns:0,currentExp:t.baseExp,stats:{...g1,...s.stats||{}},combatStats:{...s.combatStats||{},hp:t.combatStats.hp,maxHp:t.combatStats.maxHp,atk:t.combatStats.atk,def:t.combatStats.def}},Vf(e.rival),Ac(e.rival,t.tier),e.rival},ci=e=>{const t=Yf(e),n=Ec(t.currentStageIndex||0);return!e.rival||e.rival.stageId!==n.id?h1(e,n,{resetProgress:!0}):e.rival};function tC(e,t=50){const n=ci(e);if(e.resources.spiritStones<t)return{success:!1,message:""};const s=e.time.year*12+e.time.month;if(e.revengeActions.lastRumorMonth===s)return{success:!1,message:""};e.resources.spiritStones=Math.max(0,e.resources.spiritStones-t);const o=Math.min(.9,.6+t/200);if(!(Math.random()<o))return n.threatLevel=Math.min(100,n.threatLevel+15),e.revengeActions.lastRumorMonth=s,{success:!0,effectType:"FAILED",message:`${n.name}...`,threatIncrease:15};let a="",l=0;return t>=100?(a="HEAVY",l=200,n.state="FURIOUS",n.threatLevel=Math.min(100,n.threatLevel+25),n.currentExp=Math.max(0,n.currentExp-l),n.rumorCount+=2):(a="LIGHT",l=100,n.state="ANXIOUS",n.threatLevel=Math.min(100,n.threatLevel+10),n.currentExp=Math.max(0,n.currentExp-l),n.rumorCount+=1),e.revengeActions.lastRumorMonth=s,e.revengeActions.totalRumors+=1,{success:!0,effectType:a,message:a==="HEAVY"?`${n.name}`:`${n.name}...`,damage:l,threatIncrease:a==="HEAVY"?25:10,newsEvent:{type:a==="HEAVY"?"RIVAL_HEAVY_RUMOR":"RIVAL_LIGHT_RUMOR",data:{actor:n.name,rumorCount:n.rumorCount}}}}function nC(e,t=1,n=30){const s=ci(e),o=t*n;if(e.resources.spiritStones<o)return{success:!1,message:`${t}${o}`};e.resources.spiritStones=Math.max(0,e.resources.spiritStones-o);const i=40*t;return s.threatLevel=Math.max(0,s.threatLevel-i),s.threatLevel<30&&(s.state="NORMAL"),s.hiddenTurns=t,e.revengeActions.hidingMonths+=t,{success:!0,message:`${t}${s.name}`,threatReduction:i,months:t,newsEvent:{type:"RIVAL_HIDE_SUCCESS",data:{actor:s.name,months:t}}}}function rC(e){const t=ci(e),n=Yf(e),s=Ec(n.currentStageIndex||0),o=eC(e);if(e.tier==="")return{success:!1,message:`${t.name}`};const a=Pn(e).total,l=(s==null?void 0:s.powerMultiplier)??1,d=1-t.rumorCount*.05,u=Math.max(.5,Xs*l*Math.max(.5,d)),p=(g={})=>{const h=Math.max(1,Math.floor((g.maxHp||100)*u)),x=Math.max(1,Math.floor((g.maxMp||50)*u));return{...g,maxHp:h,maxMp:x,hp:Math.max(1,Math.floor((g.hp||g.maxHp||100)*u)),mp:Math.max(1,Math.floor((g.mp||g.maxMp||50)*u)),atk:Math.max(1,Math.floor((g.atk||10)*u)),def:Math.max(0,Math.floor((g.def||5)*u))}},c={...e,combatStats:e.combatStats||{maxHp:100,maxMp:50,atk:10,def:5,hp:100,mp:50}},m={...t,combatStats:p(t.combatStats||{maxHp:120,maxMp:60,atk:12,def:6,hp:120,mp:60})},w=Qi(c,m).success,E=Pn(m).total,S=a/(a+E);if(console.log(":",{:s==null?void 0:s.name,:a,:Pn(t).total,:Math.floor(E),:l,:`${t.rumorCount} (-${t.rumorCount*5}%)`,:`${(S*100).toFixed(1)}%`,:w?"":""}),w){const g=n.currentStageIndex>=Gl;if(t.isDead=!0,t.state="DEAD",t.threatLevel=0,n.completedStages.includes(s.id)||n.completedStages.push(s.id),g)return n.sagaComplete=!0,n.currentStageIndex=Gl,console.log("[] REVENGE_SAGA_COMPLETE"),Yt(o,"REVENGE_SAGA_COMPLETE",{actor:e.name,finalTarget:t.name}),{success:!0,victory:!0,sagaComplete:!0,message:(s==null?void 0:s.defeatLog)||`${t.name}...`,playerPower:a,rivalPower:Math.floor(E),newsEvent:{type:"RIVAL_DEFEATED",data:{actor:e.name,target:t.name}}};const h=Math.min(n.currentStageIndex+1,Gl);n.currentStageIndex=h;const x=Ec(h);return h1(e,x,{resetProgress:!0}),console.log("[] REVENGE_STAGE_ADVANCERIVAL_DEFEATED"),Yt(o,"REVENGE_STAGE_ADVANCE",{actor:e.name,clearedStage:s.name,nextStage:x.name}),Yt(o,"RIVAL_DEFEATED",{actor:e.name,target:t.name}),{success:!0,victory:!0,stageCleared:s.id,nextStageUnlocked:!0,nextStage:x,message:(s==null?void 0:s.defeatLog)||`${t.name}`,transitionLog:s==null?void 0:s.unlockNextLog,playerPower:a,rivalPower:Math.floor(E),newsEvent:{type:"RIVAL_DEFEATED",data:{actor:e.name,target:t.name}}}}else return Lw(e),Yt(o,"REVENGE_DUEL_FAILED",{actor:e.name,rival:t.name,stageTitle:s==null?void 0:s.title}),{success:!0,victory:!1,message:`${t.name}...`,playerPower:a,rivalPower:Math.floor(E),newsEvent:{type:"RIVAL_VICTORY",data:{actor:t.name,target:e.name}}}}function sC(e){const t=ci(e);if(t.hiddenTurns>0)return t.hiddenTurns-=1,null;if(t.threatLevel>=100){const n="",s=e.combatStats=e.combatStats||{},o=s.hp??s.maxHp??100,i=s.maxHp||Math.max(100,o),a=.3+e.stats.cunning/200,l=Math.random()<a,d=Math.floor(i*.4),u=Math.floor(i*.75);return e.revengeActions=e.revengeActions||{},e.revengeActions.assassinationAttempts=(e.revengeActions.assassinationAttempts||0)+1,l?(e.combatStats.hp=Math.max(10,o-d),t.threatLevel=Math.max(35,t.threatLevel-35),{type:"ASSASSINATION_SURVIVED",survived:!0,message:`${n}`,hpLoss:d}):(e.combatStats.hp=Math.max(5,o-u),e.currentExp=Math.max(0,Math.floor(e.currentExp*.6)),t.threatLevel=Math.max(40,t.threatLevel-45),{type:"ASSASSINATION_INJURED",survived:!1,message:`${n}`,hpLoss:u})}return null}function oC(e){const t=ci(e),n=Yf(e),s=Ec(n.currentStageIndex||0);if(Vf(t),Ac(t),t.isDead)return null;Z5(t,s),t.storyTimer=(t.storyTimer||0)+1;const o=(s==null?void 0:s.storyBeats)||[],i=t.lifeStage||0,a=o[i];if(!a)return null;const l=Math.max(1,a.delay||1);if(t.storyTimer<l||!(!(typeof a.exp=="number")||(t.currentExp||0)>=a.exp*.95))return null;if(t.lifeStage=i+1,t.storyTimer=0,a.tier&&(t.tier=a.tier,Ac(t,a.tier)),typeof a.exp=="number"){const c=Math.floor(a.exp*Xs);t.currentExp=Math.max(t.currentExp,c)}const p={actor:t.name,detail:a.detail||a.tier||(s==null?void 0:s.title),target:a.target,stageTitle:s==null?void 0:s.title,stageRole:s==null?void 0:s.role,stageTier:a.tier||(s==null?void 0:s.tier),description:a.description};return Object.keys(p).forEach(c=>{(p[c]===void 0||p[c]===null)&&delete p[c]}),{type:a.type||"RIVAL_STAGE_EVENT",data:p}}function iC(e){const t=ci(e);if(t.isDead||t.hiddenTurns>0)return 0;const n=Math.ceil(2*Xs);let s=1;return t.threatLevel>=60?s=1.5*Xs:t.threatLevel>=30&&(s=1.2*Xs),Math.ceil(n*s)}function aC(e){return e.isDead?null:e.threatLevel>=80?{type:"RIVAL_THREAT_CRITICAL",data:{actor:e.name}}:e.threatLevel>=60?{type:"RIVAL_THREAT_HIGH",data:{actor:e.name}}:e.threatLevel>=30?{type:"RIVAL_THREAT_MEDIUM",data:{actor:e.name,playerName:""}}:null}const lC={currentStageIndex:0,completedStages:[],sagaComplete:!1},cC={lastRumorMonth:0,totalRumors:0,assassinationAttempts:0,hidingMonths:0},dC=e=>e&&{...e,resources:{...e.resources||{}},rival:e.rival?{...e.rival,stats:{...e.rival.stats||{}},combatStats:{...e.rival.combatStats||{}},revengeProgress:e.rival.revengeProgress?{...e.rival.revengeProgress}:void 0}:e.rival,revengeActions:{...cC,...e.revengeActions||{}},revengeProgress:e.revengeProgress?{...e.revengeProgress,completedStages:Array.isArray(e.revengeProgress.completedStages)?[...e.revengeProgress.completedStages]:[]}:{...lC},newsBuffer:Array.isArray(e.newsBuffer)?[...e.newsBuffer]:[],combatStats:e.combatStats?{...e.combatStats}:e.combatStats},uC=({player:e,setPlayer:t,addLog:n})=>{var $e,De,Qe,Y;const[s,o]=b.useState(50),[i,a]=b.useState(1),[l,d]=b.useState(null),[u,p]=b.useState(null),[c,m]=b.useState(!1),v=i*30,w=b.useMemo(()=>c?"":e!=null&&e.resources?e.resources.spiritStones<v?`${i}${v}`:"":"",[c,e==null?void 0:e.resources,($e=e==null?void 0:e.resources)==null?void 0:$e.spiritStones,v,i]),E=!w,S=b.useCallback((ue,...ne)=>{const ce=dC(e),ae=ue(ce,...ne);return console.log(" [executeRevengeAction] :",ae),ae!=null&&ae.success&&t(ce),ae},[e,t]),g=b.useCallback((ue,ne=5e3)=>{ue&&(d(ue),setTimeout(()=>d(null),ne))},[]),h=e.rival||{name:"",state:"NORMAL",lifeStage:0,threatLevel:0,rumorCount:0,isDead:!1,tier:"",currentExp:300},x=e.revengeProgress||{currentStageIndex:0,sagaComplete:!1},k=Math.min(x.currentStageIndex||0,ka.length-1),_=ka[k],y=!!x.sagaComplete,R=y?"":"",C=Pn(e).total,I=Pn(h).total,T=Math.max(.5,1-h.rumorCount*.05),L=Xs*((_==null?void 0:_.powerMultiplier)||1),ee=Math.floor(I*L*T),$=(ue,ne=50)=>Math.floor((ue??ne)*T*L),O=ue=>ue>=80?"#ff4444":ue>=60?"#ff8800":ue>=30?"#ffbb00":"#44ff44",H=ue=>ue>=80?"":ue>=60?"":ue>=30?"":"",F=ue=>({NORMAL:"",ANXIOUS:"",FURIOUS:"",DEAD:""})[ue]||"",se=b.useCallback(()=>{if(c)return;m(!0);const ue=Math.floor(I*L*T),ne=S(tC,s);if(ne!=null&&ne.success&&ne.effectType!=="FAILED"){const ce=Math.max(.5,1-(h.rumorCount+(s>=100?2:1))*.05),ae=Math.floor(I*L*ce),je=ue-ae;ne.actualPowerLoss=je}g(ne),m(!1)},[S,g,c,s,I,L,T,h.rumorCount]),J=b.useCallback(()=>{if(!E){g({success:!1,message:w});return}m(!0);const ue=S(nC,i,30);g(ue),m(!1)},[E,S,w,i,g]),de=()=>{var ne,ce;if(console.log("handleDuel:",e.tier),console.log(":",e),!Pf(e).canDuel){if(((ne=e.stats)==null?void 0:ne.health)<20){window.showResult?window.showResult(" ",`${Math.floor(e.stats.health)}/100`,!1,null,!1):p({title:" ",message:`${Math.floor(e.stats.health)}/100`});return}else if(((ce=e.stats)==null?void 0:ce.health)<30&&window.showConfirm){window.showConfirm(` 30${Math.floor(e.stats.health)}/100`,()=>{Ee()});return}}Ee()},Ee=()=>{const ue=h.name,ne=(_==null?void 0:_.title)||"";window.showConfirm&&window.showConfirm(`${ne}${ue}`,()=>{const ce=S(rC);if(console.log(" [RevengePanel] :",ce),ce!=null&&ce.success)if(console.log("  - :",ce.victory),ce.victory){const ae=ce.sagaComplete?" ":` ${ue}`,je=ce.message||`${ue}`;if(console.log(" :",ae),g({success:!0,message:je,transitionLog:ce.transitionLog,nextStage:ce.nextStage,sagaComplete:ce.sagaComplete},ce.sagaComplete?8e3:6e3),p({title:ae,message:je,type:"victory"}),window.showResult&&typeof window.showResult=="function"?window.showResult(ae,je,!0,null,!1):(console.warn(" window.showResult "),p({title:ae,message:je,type:"victory"})),n){const X=ce.sagaComplete?` ${ue}`:` ${ue}${_==null?void 0:_.title}`;n(X,"","")}}else{const ae=ce.message||`${ue}...`;if(console.log(" :"," ",ae),console.log(" window.showResult :",{exists:!!window.showResult,isFunction:typeof window.showResult=="function"}),g({success:!1,message:ae,damage:"",newsEvent:ce.newsEvent},6e3),p({title:" ",message:ae,type:"defeat"}),window.showResult&&typeof window.showResult=="function")try{console.log("  window.showResult"),window.showResult(" ",ae,!1,null,!1)}catch(je){console.error(" window.showResult :",je),p({title:" ",message:ae,type:"defeat"})}else console.warn(" window.showResult "+typeof window.showResult+""),p({title:" ",message:ae,type:"defeat"});n&&n(` ${ue}`,"","")}else{console.error(" :",ce);const ae=ce&&ce.message||`${ue}`;window.showResult&&typeof window.showResult=="function"?window.showResult(" ",ae,!1,null,!1):p({title:" ",message:ae})}})};return h.isDead&&y?r.jsx("div",{style:Re.panel,children:r.jsxs("div",{style:Re.completed,children:[r.jsx("h2",{children:"  "}),r.jsxs("p",{children:[h.name,""]}),r.jsx("p",{children:"..."})]})}):r.jsxs("div",{style:Re.panel,children:[r.jsxs("div",{style:Re.header,children:[r.jsx("h2",{style:Re.title,children:" "}),r.jsxs("p",{style:Re.subtitle,children:["",h.name]})]}),r.jsxs("div",{style:Re.stageNarrative,children:[r.jsxs("div",{style:Re.stageFocusHeader,children:[r.jsxs("span",{style:Re.stageBadge,children:["",k+1,""]}),r.jsx("span",{style:Re.stageStatus,children:R})]}),r.jsx("div",{style:Re.stageFocusName,children:h.name}),r.jsx("div",{style:Re.stageFocusTitle,children:(_==null?void 0:_.title)||""}),r.jsx("p",{style:Re.stageNarrativeText,children:(_==null?void 0:_.flavor)||""}),y&&r.jsx("p",{style:Re.stageNarrativeNext,children:""})]}),r.jsxs("div",{style:Re.rivalStatus,children:[r.jsx("h3",{style:Re.sectionTitle,children:""}),r.jsxs("div",{style:Re.statusGrid,children:[r.jsxs("div",{style:Re.statusItem,children:[r.jsx("span",{style:Re.statusLabel,children:""}),r.jsx("span",{style:Re.statusValue,children:h.tier})]}),r.jsxs("div",{style:Re.statusItem,children:[r.jsx("span",{style:Re.statusLabel,children:""}),r.jsx("span",{style:Re.statusValue,children:F(h.state)})]}),r.jsxs("div",{style:Re.statusItem,children:[r.jsx("span",{style:Re.statusLabel,children:""}),r.jsxs("span",{style:{...Re.statusValue,color:O(h.threatLevel)},children:[H(h.threatLevel)," ",h.threatLevel,"%"]})]}),r.jsxs("div",{style:Re.statusItem,children:[r.jsx("span",{style:Re.statusLabel,children:""}),r.jsxs("span",{style:Re.statusValue,children:[" ",h.rumorCount*5,"%"]})]})]}),r.jsx("div",{style:Re.threatBar,children:r.jsx("div",{style:{...Re.threatFill,width:`${h.threatLevel}%`,backgroundColor:O(h.threatLevel)}})}),h.threatLevel>=80&&r.jsx("div",{style:Re.dangerWarning,children:" "})]}),r.jsxs("div",{style:Re.actions,children:[r.jsx("h3",{style:Re.sectionTitle,children:""}),r.jsxs("div",{style:Re.actionCard,children:[r.jsxs("div",{style:Re.actionHeader,children:[r.jsx("h4",{style:Re.actionTitle,children:" "}),r.jsxs("span",{style:Re.actionCost,children:["",i*30," "]})]}),r.jsxs("p",{style:Re.actionDesc,children:["",h.name,"80%"]}),r.jsxs("div",{style:Re.actionControlsVertical,children:[r.jsxs("select",{value:i,onChange:ue=>a(Number(ue.target.value)),style:Re.select,children:[r.jsx("option",{value:"1",children:"1-40%"}),r.jsx("option",{value:"2",children:"2-80%"}),r.jsx("option",{value:"3",children:"3-100%"})]}),r.jsxs("button",{style:{...Re.hideBtn,...E?{}:{opacity:.6,cursor:"not-allowed"}},onClick:J,"aria-disabled":!E,title:E?"":w,children:[" (",i*30,")"]})]})]}),r.jsxs("div",{style:Re.actionCard,children:[r.jsxs("div",{style:Re.actionHeader,children:[r.jsx("h4",{style:Re.actionTitle,children:" "}),r.jsxs("span",{style:Re.actionCost,children:["",s," "]})]}),r.jsxs("p",{style:Re.actionDesc,children:["",h.name,"",r.jsx("br",{}),""]}),r.jsx("div",{style:Re.actionControls,children:r.jsx("input",{type:"range",min:"50",max:"150",step:"10",value:s,onChange:ue=>o(Number(ue.target.value)),style:Re.slider})}),r.jsxs("button",{style:Re.rumorBtn,onClick:se,disabled:c||!(e!=null&&e.resources)||e.resources.spiritStones<s,children:[" (",s,")"]}),r.jsxs("div",{style:Re.actionInfo,children:["",Math.min(90,60+s/2),"% | +",s>=100?25:10]})]}),r.jsxs("div",{style:{...Re.actionCard,...Re.finalDuelCard},children:[r.jsxs("div",{style:Re.actionHeader,children:[r.jsx("h4",{style:Re.actionTitle,children:" "}),r.jsx("span",{style:Re.actionWarning,children:""})]}),r.jsxs("p",{style:Re.actionDesc,children:["",h.name,"",r.jsx("br",{}),r.jsx("strong",{children:""}),""]}),r.jsxs("div",{style:Re.powerComparison,children:[r.jsxs("div",{style:Re.powerItem,children:[r.jsx("span",{children:""}),r.jsx("span",{children:C})]}),r.jsxs("div",{style:Re.powerItem,children:[r.jsx("span",{children:""}),r.jsx("span",{children:ee})]})]}),r.jsx("div",{style:{fontSize:"12px",color:"#666",marginTop:"8px"},children:""}),r.jsx("button",{style:Re.duelBtn,onClick:de,disabled:e.tier==="",children:""}),r.jsxs("div",{style:{fontSize:"16px",fontWeight:"bold",color:"#d4af37",marginTop:12,textAlign:"center",backgroundColor:"rgba(212, 175, 55, 0.1)",padding:"8px",borderRadius:"4px"},children:[" ",Math.round(Py(e,{...h,combatStats:{...h.combatStats||{},atk:$((De=h.combatStats)==null?void 0:De.atk,50),def:$((Qe=h.combatStats)==null?void 0:Qe.def,20),maxHp:$((Y=h.combatStats)==null?void 0:Y.maxHp,500)}}).prob*100),"%"]}),e.tier===""&&r.jsx("div",{style:Re.actionWarningText,children:" "})]})]}),l&&r.jsxs("div",{style:{...Re.resultToast,backgroundColor:l.success?"#4caf50":"#f44336"},children:[r.jsx("p",{children:l.message}),l.damage&&r.jsxs("p",{children:["",l.damage]}),l.actualPowerLoss&&r.jsxs("p",{children:["-",l.actualPowerLoss," (-",Math.round(l.actualPowerLoss/ee*100),"%)"]}),l.threatIncrease&&r.jsxs("p",{children:["+",l.threatIncrease,"%"]}),l.threatReduction&&r.jsxs("p",{children:["-",l.threatReduction,"%"]}),l.transitionLog&&r.jsx("p",{children:l.transitionLog}),l.nextStage&&r.jsxs("p",{children:["",l.nextStage.name,"",l.nextStage.title,""]})]}),u&&r.jsx("div",{style:Re.modalOverlay,children:r.jsxs("div",{style:Re.modalCard,children:[r.jsx("div",{style:Re.modalIcon,children:u.type==="victory"?"":u.type==="defeat"?"":""}),r.jsx("h3",{style:{marginBottom:10},children:u.title}),r.jsx("p",{style:Re.modalText,children:u.message}),r.jsx("button",{style:Re.modalButton,onClick:()=>p(null),children:u.type==="victory"?"":""})]})})]})},Re={panel:{padding:"20px",maxWidth:"900px",margin:"0 auto",color:"#e0d5c7"},header:{textAlign:"center",marginBottom:"30px",borderBottom:"2px solid #8b4513",paddingBottom:"15px"},stageFocusHeader:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"10px"},stageBadge:{fontSize:"12px",letterSpacing:"2px",padding:"4px 10px",borderRadius:"999px",border:"1px solid #ffd700",color:"#ffd700"},stageStatus:{fontSize:"12px",padding:"4px 12px",borderRadius:"999px",background:"rgba(255,255,255,0.08)",color:"#fff"},stageFocusName:{fontSize:"22px",fontWeight:"bold",color:"#ffe4c4"},stageFocusTitle:{fontSize:"14px",color:"#ffcc80",marginTop:"4px"},stageNarrative:{border:"1px solid rgba(255,255,255,0.1)",borderRadius:"10px",padding:"16px",marginBottom:"20px",background:"rgba(0,0,0,0.25)"},stageNarrativeText:{fontSize:"14px",color:"#f0e1c3",marginTop:"6px"},stageNarrativeNext:{fontSize:"13px",color:"#ffd700",marginTop:"8px"},title:{color:"#ff6b6b",fontSize:"28px",marginBottom:"8px",textShadow:"2px 2px 4px rgba(0,0,0,0.5)"},subtitle:{color:"#ffd700",fontSize:"18px",fontStyle:"italic"},rivalStatus:{background:"linear-gradient(135deg, rgba(40, 20, 20, 0.8), rgba(60, 30, 30, 0.8))",border:"2px solid #8b4513",borderRadius:"12px",padding:"20px",marginBottom:"25px",boxShadow:"0 4px 12px rgba(0,0,0,0.4)"},sectionTitle:{color:"#ffd700",marginBottom:"15px",fontSize:"20px"},statusGrid:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(140px, 1fr))",gap:"12px",marginBottom:"15px"},statusItem:{display:"flex",justifyContent:"space-between",padding:"8px 12px",background:"rgba(0,0,0,0.3)",borderRadius:"6px"},statusLabel:{color:"#bbb",fontWeight:"500"},statusValue:{color:"#fff",fontWeight:"bold"},threatBar:{width:"100%",height:"30px",background:"rgba(0,0,0,0.5)",borderRadius:"15px",overflow:"hidden",border:"2px solid #666",marginTop:"15px",position:"relative"},threatFill:{height:"100%",transition:"width 0.5s ease, background-color 0.5s ease",display:"flex",alignItems:"center",justifyContent:"center",fontWeight:"bold",color:"white",textShadow:"1px 1px 2px rgba(0,0,0,0.8)"},dangerWarning:{marginTop:"15px",padding:"12px",background:"linear-gradient(90deg, #ff4444, #ff6b6b)",border:"2px solid #ff0000",borderRadius:"8px",color:"white",fontWeight:"bold",textAlign:"center",boxShadow:"0 0 20px rgba(255, 68, 68, 0.6)"},actions:{marginTop:"30px"},actionCard:{background:"linear-gradient(135deg, rgba(30, 30, 40, 0.9), rgba(50, 40, 60, 0.9))",border:"2px solid #8b4513",borderRadius:"12px",padding:"20px",marginBottom:"20px",boxShadow:"0 4px 12px rgba(0,0,0,0.4)"},finalDuelCard:{background:"linear-gradient(135deg, rgba(60, 20, 20, 0.9), rgba(80, 30, 30, 0.9))",borderColor:"#ff4444"},actionHeader:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"12px",borderBottom:"1px solid rgba(255, 255, 255, 0.2)",paddingBottom:"10px"},actionTitle:{color:"#ffd700",fontSize:"18px",margin:0},actionCost:{color:"#66ff66",fontWeight:"bold",fontSize:"14px"},actionWarning:{color:"#ff6b6b",fontWeight:"bold",fontSize:"14px"},actionDesc:{color:"#ccc",lineHeight:"1.6",marginBottom:"15px",fontSize:"14px"},actionControls:{display:"flex",flexDirection:"column",gap:"12px",marginBottom:"12px"},actionControlsVertical:{display:"flex",flexDirection:"column",gap:"12px"},slider:{width:"100%",height:"8px"},select:{width:"100%",padding:"12px",background:"rgba(0, 0, 0, 0.5)",color:"#fff",border:"2px solid #8b4513",borderRadius:"6px",fontSize:"14px",cursor:"pointer"},rumorBtn:{width:"100%",padding:"14px 24px",border:"none",borderRadius:"8px",background:"linear-gradient(135deg, #6a5acd, #8b7ad8)",color:"white",fontWeight:"bold",fontSize:"15px",cursor:"pointer",boxShadow:"0 4px 8px rgba(0,0,0,0.3)",transition:"transform 0.2s"},hideBtn:{width:"100%",padding:"14px 24px",border:"none",borderRadius:"8px",background:"linear-gradient(135deg, #4a90e2, #5ba3f5)",color:"white",fontWeight:"bold",fontSize:"15px",cursor:"pointer",boxShadow:"0 4px 8px rgba(0,0,0,0.3)",transition:"transform 0.2s"},duelBtn:{width:"100%",background:"linear-gradient(135deg, #ff4444, #ff6b6b)",color:"white",fontSize:"16px",padding:"14px",border:"none",borderRadius:"8px",fontWeight:"bold",cursor:"pointer",boxShadow:"0 4px 8px rgba(0,0,0,0.3)"},actionInfo:{color:"#aaa",fontSize:"12px",marginTop:"5px"},actionWarningText:{color:"#ff6b6b",fontSize:"13px",textAlign:"center",marginTop:"10px",fontWeight:"bold"},powerComparison:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"15px",margin:"15px 0",padding:"15px",background:"rgba(0, 0, 0, 0.3)",borderRadius:"8px"},powerItem:{display:"flex",flexDirection:"column",alignItems:"center",gap:"5px",color:"#bbb",fontSize:"13px"},completed:{textAlign:"center",padding:"60px 40px",background:"linear-gradient(135deg, rgba(40, 80, 40, 0.8), rgba(60, 100, 60, 0.8))",border:"3px solid #4caf50",borderRadius:"16px",boxShadow:"0 8px 24px rgba(0,0,0,0.5)"},resultToast:{position:"fixed",bottom:"30px",left:"50%",transform:"translateX(-50%)",padding:"20px 30px",borderRadius:"12px",boxShadow:"0 8px 24px rgba(0,0,0,0.5)",zIndex:9999,minWidth:"300px",maxWidth:"500px",color:"white"},modalOverlay:{position:"fixed",inset:0,background:"rgba(0,0,0,0.65)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:99999},modalCard:{width:"90%",maxWidth:420,background:"rgba(24,17,13,0.95)",border:"1px solid rgba(255,255,255,0.2)",borderRadius:18,padding:"24px 24px 28px",textAlign:"center",boxShadow:"0 20px 45px rgba(0,0,0,0.45)"},modalIcon:{fontSize:42,marginBottom:12},modalText:{lineHeight:1.7,fontSize:15,color:"#f7d8b4",marginBottom:18},modalButton:{padding:"10px 20px",borderRadius:999,border:"none",background:"linear-gradient(120deg, #f06292, #f7b733)",color:"#fff",fontWeight:"bold",cursor:"pointer",boxShadow:"0 6px 18px rgba(240,98,146,0.45)"}},Ia=(e="")=>({base:0,skinColor:0,hair:1,hairColor:0,eye:0,eyeColor:1,mouth:0,gender:e}),pC=(e,t)=>!e||!t?!1:e.base===t.base&&e.skinColor===t.skinColor&&e.hair===t.hair&&e.hairColor===t.hairColor&&e.eye===t.eye&&e.eyeColor===t.eyeColor&&e.mouth===t.mouth&&e.gender===t.gender,x1=(e,t)=>{const n=e?{...e,gender:e.gender??t}:Ia(t);return pC(n,Ia(t))?null:n},y1=(e,t)=>e?{...Ia(t),...e,gender:e.gender??t}:Ia(t),_l=e=>{if(!e)return e;const t=e.gender;return{...e,avatar:x1(e.avatar,t),currentExp:Math.max(0,Math.floor((e==null?void 0:e.currentExp)||0)),maxExp:Math.max(1,Math.floor((e==null?void 0:e.maxExp)||1))}},Rl=e=>{if(!e)return e;const t=e.gender;return{...e,avatar:y1(e.avatar,t),currentExp:Math.max(0,Math.floor(Number(e.currentExp)||0)),maxExp:Math.max(1,Math.floor(Number(e.maxExp)||1))}},Eu=2e6,ku=(e,t)=>!Array.isArray(e)||e.length<=t?e:e.slice(-t),fC=(e,t=200,n=30)=>{if(!e||typeof e!="object")return e;const o=Object.keys(e).slice(-t),i={};for(const a of o){const l=e[a];i[a]=Array.isArray(l)?l.slice(-n):l}return i},mC=(e=[])=>{if(!Array.isArray(e))return e;const t=new Map,n=[];return e.forEach(s=>{if(!s)return;const o=s.id||s.itemId;if(!(s.stackable===!0&&o)){n.push(s);return}const a=o;if(!t.has(a)){const d={...s};d.quantity=0,d.instanceId=`${o}_stack`,t.set(a,d)}const l=t.get(a);l.quantity+=Number(s.quantity||1)}),[...n,...t.values()]},gC=(e=[])=>{const t=[],n={};let s=0;e.forEach(a=>{if(!a)return;if((a.generation||1)<=2){t.push(a);return}s+=1;const d=a.tierTitle||a.tier||"";n[d]=(n[d]||0)+1});const o=Object.entries(n).map(([a,l])=>({t:a,c:l})),i=s>0?{c:s,t:o}:void 0;return{mainlineChildren:t,descendantsSummary:i}},hC=e=>{if(!e||!e.c)return[];const t=Array.isArray(e.t)?e.t:[{t:"",c:e.c}],n=[];let s=0;return t.forEach(({t:o,c:i})=>{const a=Number(i||0);for(let l=0;l<a;l+=1){s+=1;const d=s%2===0?"":"";n.push({id:`desc_${s}`,name:`${s}`,generation:3,age:20,gender:d,avatar:Ia(d),stats:{aptitude:50,looks:50,intelligence:50,lifespan:100},isTested:!0,isAdult:!0,cultivation:0,tierTitle:o||"",currentExp:0,maxExp:1})}}),n},Kg=(e,t={})=>{const{aggressive:n=!1}=t,s=e.player||{},o=s.rival,i=s.revengeProgress,a=s.revengeActions,{mainlineChildren:l,descendantsSummary:d}=gC(e.children||[]),u=n?void 0:ku(s.worldEvents,200),p=n?void 0:ku(s.newsBuffer,200),c=n?[]:Array.isArray(e.messages)?ku(e.messages,200):fC(e.messages,200,30),m=n?{}:e.lastMessageCheck||{},v=mC(e.inventory||[]),w=Array.isArray(e.logs)?e.logs.filter(E=>E&&E.category===""):[];return{v:2,p:{n:s.name,a:s.age,hp:s.hp,mhp:s.maxHp,cv:s.cultivation,ce:Math.max(0,Math.floor(s.currentExp||0)),me:Math.max(1,Math.floor(s.maxExp||1)),t:s.tier,tt:s.tierTitle,w:s.wealth,m:s.mood,tm:s.time,av:x1(s.avatar,s.gender),g:s.gender,ps:s.personality,ap:s.appearance,we:u,nb:p,fr:s.familyRatingSummary,frc:s.familyRating,bs:s.businesses||[],rs:s.resources||{spiritStones:0,money:0},sp:s.skillPoints||0,st:s.stats||{},cs:s.combatStats||{},sr:s.spiritRoot||null,pcs:s.childrenStrategy||{skipZhaozhou:!1},rv:o?{n:o.name,sid:o.stageId,t:o.tier,st:o.state,ls:o.lifeStage||0,tl:o.threatLevel||0,d:o.isDead||!1,rc:o.rumorCount||0,ht:o.hiddenTurns||0,ce:o.currentExp||0,stt:o.stats||{},cst:o.combatStats||{}}:void 0,rp:i?{si:i.currentStageIndex||0,cs:i.completedStages||[],sc:i.sagaComplete||!1}:void 0,ra:a?{lr:a.lastRumorMonth||0,tr:a.totalRumors||0,aa:a.assassinationAttempts||0,hm:a.hidingMonths||0}:void 0},ch:l.map(_l),d3:d,fc:(e.fallenChildren||[]).map(_l),an:(e.activeNpcs||[]).map(_l),dn:(e.deadNpcs||[]).map(_l),inv:v,lg:w,gs:e.gameStage,msg:c,lmc:m,psc:e.pendingSectChoices,tq:e.testQueue}},xC=e=>{const t=e.p||{},n=t.rv,s=t.rp,o=t.ra,i=qo(),a=(e.ch||[]).map(Rl),l=hC(e.d3);return{player:{name:t.n,age:t.a,hp:t.hp,maxHp:t.mhp,cultivation:t.cv,currentExp:Math.max(0,Math.floor(Number(t.ce)||0)),maxExp:Math.max(1,Math.floor(Number(t.me)||1)),tier:t.t,tierTitle:t.tt,wealth:t.w,mood:t.m,time:t.tm,avatar:y1(t.av,t.g),gender:t.g,personality:t.ps,appearance:t.ap,worldEvents:t.we,newsBuffer:t.nb,familyRatingSummary:t.fr,familyRating:t.frc,businesses:t.bs||[],resources:t.rs||{spiritStones:0,money:0},skillPoints:t.sp||0,stats:t.st||{},combatStats:t.cs||{},spiritRoot:t.sr?{...i.spiritRoot,...t.sr}:{...i.spiritRoot},childrenStrategy:t.pcs||{skipZhaozhou:!1},rival:n?{name:n.n,stageId:n.sid,tier:n.t,state:n.st,lifeStage:n.ls||0,threatLevel:n.tl||0,isDead:n.d||!1,rumorCount:n.rc||0,hiddenTurns:n.ht||0,currentExp:n.ce||0,stats:n.stt||{},combatStats:n.cst||{}}:void 0,revengeProgress:s?{currentStageIndex:s.si||0,completedStages:s.cs||[],sagaComplete:s.sc||!1}:void 0,revengeActions:o?{lastRumorMonth:o.lr||0,totalRumors:o.tr||0,assassinationAttempts:o.aa||0,hidingMonths:o.hm||0}:void 0},children:[...a,...l],fallenChildren:(e.fc||[]).map(Rl),activeNpcs:(e.an||[]).map(Rl),deadNpcs:(e.dn||[]).map(Rl),inventory:e.inv||[],logs:e.lg||[],gameStage:e.gs,messages:Array.isArray(e.msg)?e.msg:[],lastMessageCheck:e.lmc||{},pendingSectChoices:e.psc,testQueue:e.tq}},yC=(e,t="")=>{try{let n=Kg(e),s=JSON.stringify(n),o=btoa(unescape(encodeURIComponent(s)));if(o.length>Eu&&(n=Kg(e,{aggressive:!0}),s=JSON.stringify(n),o=btoa(unescape(encodeURIComponent(s))),console.warn(" //")),o.length>Eu)return console.error(` ${Eu.toLocaleString()} `),null;const i=(o.length/1024).toFixed(2);return console.log(` : ${i} KB (C)`),o}catch(n){return console.error(" :",n),null}},Zr=(e="")=>{const t=e===""?[0,1,2]:[0,1,2,3],n=[0,1,2,3,4,5],s=[0,1,2,3,4,5,6,7],o=[0,1,2,3,4,5,6],i=[0,1,2,3,4,5],a=[0,1,2,3,4,5],l=[0,1,2,3,4],d=u=>u[Math.floor(Math.random()*u.length)];return{base:d(t),skinColor:d(n),hair:d(s),hairColor:d(o),eye:d(i),eyeColor:d(a),mouth:d(l)}},Di=(e,t="")=>{if(!e||typeof e!="object"||Object.keys(e).length===0)return console.log(" ..."),Zr(t);const n={...e};return!n.base&&n.base!==0&&(n.base=Zr(t).base),!n.skinColor&&n.skinColor!==0&&(n.skinColor=Zr(t).skinColor),!n.hair&&n.hair!==0&&(n.hair=Zr(t).hair),!n.hairColor&&n.hairColor!==0&&(n.hairColor=Zr(t).hairColor),!n.eye&&n.eye!==0&&(n.eye=Zr(t).eye),!n.eyeColor&&n.eyeColor!==0&&(n.eyeColor=Zr(t).eyeColor),!n.mouth&&n.mouth!==0&&(n.mouth=Zr(t).mouth),n},bC=e=>{var t;try{const n=e.trim();if(!n)return console.error(" "),null;let s;try{s=decodeURIComponent(escape(atob(n)))}catch(l){return console.error(" Base64 :",l.message),null}let o;try{o=JSON.parse(s)}catch(l){return console.error(" JSON :",l.message),null}let i=o;if(o&&o.v===2&&o.p&&(i=xC(o)),!i.player)return console.error("  player "),null;!i.player.rival&&(o!=null&&o.rival)&&(i.player.rival=o.rival),!i.player.revengeProgress&&(o!=null&&o.revengeProgress)&&(i.player.revengeProgress=o.revengeProgress),!i.player.revengeActions&&(o!=null&&o.revengeActions)&&(i.player.revengeActions=o.revengeActions);const a=i.player;if(a){if(a.cultivation!==void 0){const l=Number(a.cultivation);a.cultivation=isNaN(l)?0:l}else a.cultivation=0;if(a.currentExp=Math.max(0,Math.floor(Number(a.currentExp)||0)),a.maxExp=Math.max(1,Math.floor(Number(a.maxExp)||1)),a.avatar=Di(a.avatar,a.gender),!a.spiritRoot){const l=qo();a.spiritRoot={...l.spiritRoot}}a.childrenStrategy?a.childrenStrategy.skipZhaozhou=a.childrenStrategy.skipZhaozhou??!1:a.childrenStrategy={skipZhaozhou:!1}}return Array.isArray(i.children)&&(i.children=i.children.map(l=>l&&(l.currentExp=Math.max(0,Math.floor(Number(l.currentExp)||0)),l.maxExp=Math.max(1,Math.floor(Number(l.maxExp)||1)),l.avatar=Di(l.avatar,l.gender),l))),Array.isArray(i.activeNpcs)&&(i.activeNpcs=i.activeNpcs.map(l=>l&&(l.currentExp=Math.max(0,Math.floor(Number(l.currentExp)||0)),l.maxExp=Math.max(1,Math.floor(Number(l.maxExp)||1)),l.avatar=Di(l.avatar,l.gender),l))),Array.isArray(i.deadNpcs)&&(i.deadNpcs=i.deadNpcs.map(l=>l&&(l.avatar=Di(l.avatar,l.gender),l))),Array.isArray(i.fallenChildren)&&(i.fallenChildren=i.fallenChildren.map(l=>l&&(l.avatar=Di(l.avatar,l.gender),l))),i.player.revengeProgress||(i.player.revengeProgress={currentStageIndex:0,completedStages:[],sagaComplete:!1}),i.player.revengeActions||(i.player.revengeActions={lastRumorMonth:0,totalRumors:0,assassinationAttempts:0,hidingMonths:0}),i.player.rival&&(i.player.rival.threatLevel=Math.max(0,Math.min(100,i.player.rival.threatLevel||0)),i.player.rival.isDead=i.player.rival.isDead||!1),console.log(" "),console.log(` : ${i.player.name}, : ${i.player.cultivation}`),console.log(` : ${i.player.currentExp}/${i.player.maxExp}`),console.log(` : ${(i.activeNpcs||[]).length}, : ${(i.children||[]).length}`),i.player.rival&&console.log(` :  ${(((t=i.player.revengeProgress)==null?void 0:t.currentStageIndex)||0)+1} , : ${i.player.rival.name}, : ${i.player.rival.threatLevel||0}`),i}catch(n){return console.error(" :",n),null}},vC=(e,t="save.txt")=>{try{const n=new Blob([e],{type:"text/plain;charset=utf-8"}),s=URL.createObjectURL(n),o=document.createElement("a");o.href=s,o.download=t,document.body.appendChild(o),o.click(),document.body.removeChild(o),URL.revokeObjectURL(s)}catch(n){console.error(":",n)}},SC=e=>new Promise((t,n)=>{const s=new FileReader;s.onload=o=>t(o.target.result),s.onerror=o=>n(o),s.readAsText(e)}),wC=({gameState:e,onLoadGame:t,playerName:n=""})=>{const[s,o]=b.useState("export"),[i,a]=b.useState(""),[l,d]=b.useState(""),[u,p]=b.useState(""),[c,m]=b.useState("info"),v=3e3,[w,E]=b.useState("whole"),[S,g]=b.useState(1),[h,x]=b.useState(1),k=($,O="info")=>{p($),m(O),setTimeout(()=>p(""),5e3)},_=()=>{if(!e){k("","error");return}try{const $=yC(e,n);if(!$){k("","error");return}a($);const O=Math.ceil($.length/v);x(O),g(1),E(O>1?"paginated":"whole");const H=($.length/1024).toFixed(2),F=O>1?`${O}`:"";k(` : ${H} KB${F}`,"success")}catch($){console.error(":",$),k(": "+$.message,"error")}},y=()=>{if(!i){k("","error");return}let $=i;if(w==="paginated"&&h>1){const O=(S-1)*v,H=Math.min(O+v,i.length);$=i.substring(O,H)}navigator.clipboard.writeText($).then(()=>{w==="paginated"&&h>1?k(`  ${S}/${h} `,"success"):k(" ","success")}).catch(()=>{k("","error")})},R=()=>{if(!i){k("","error");return}const $=new Date().toISOString().replace(/[:.]/g,"-"),O=`save_${n}_${$}.txt`;vC(i,O),k(" ","success")},C=async $=>{var H;const O=(H=$.target.files)==null?void 0:H[0];if(O)try{const F=await SC(O);d(F),k(" ","success")}catch(F){console.error(":",F),k("","error")}},I=async()=>{try{const $=await navigator.clipboard.readText();d($),k(" ","success")}catch($){console.error(":",$),k("","error")}},T=()=>{var $,O;if(!l.trim()){k("","error");return}try{console.log(" ..."),console.log(":",l.trim().length),console.log(":",l.trim().substring(0,30));const H=bC(l.trim());if(!H){console.error(" "),k(` 

 
  (F12) 
 
 `,"error");return}const F=`
${(($=H.player)==null?void 0:$.name)||""}
${((O=H.player)==null?void 0:O.cultivation)||0}`;window.showConfirm&&window.showConfirm(F,()=>{t&&t(null,H),k(" ","success"),d("")})}catch(H){console.error(":",H),k(" : "+H.message,"error")}},L={container:{padding:"20px",background:"linear-gradient(135deg, rgba(76, 175, 80, 0.1) 0%, rgba(76, 175, 80, 0.05) 100%)",borderRadius:"8px",border:"1px solid rgba(76, 175, 80, 0.3)",pointerEvents:"auto"},tabButtons:{display:"flex",gap:"10px",marginBottom:"20px"},tabButton:$=>({padding:"8px 16px",border:"none",borderRadius:"4px",background:$?"#4caf50":"#ddd",color:$?"white":"#333",cursor:"pointer",fontWeight:"bold",fontSize:"14px",transition:"all 0.3s"}),section:{marginBottom:"20px"},label:{display:"block",marginBottom:"8px",fontWeight:"bold",color:"#333"},input:{width:"100%",padding:"8px 12px",border:"1px solid #ccc",borderRadius:"4px",fontSize:"14px",fontFamily:"monospace",boxSizing:"border-box"},textarea:{width:"100%",minHeight:"150px",padding:"12px",border:"1px solid #ccc",borderRadius:"4px",fontSize:"12px",fontFamily:"monospace",boxSizing:"border-box",background:"#f9f9f9",color:"#333"},button:{padding:"8px 16px",margin:"5px 5px 5px 0",border:"none",borderRadius:"4px",background:"#4caf50",color:"white",cursor:"pointer",fontSize:"14px",fontWeight:"bold",transition:"background 0.3s",pointerEvents:"auto",position:"relative",zIndex:1},buttonSecondary:{background:"#2196F3"},buttonDanger:{background:"#ff9800"},buttonDisabled:{background:"#ccc",cursor:"not-allowed"},message:{padding:"12px",borderRadius:"4px",marginBottom:"15px",fontSize:"14px",fontWeight:"bold"},messageSuccess:{background:"#c8e6c9",color:"#2e7d32",border:"1px solid #81c784"},messageError:{background:"#ffcdd2",color:"#c62828",border:"1px solid #ef5350"},messageInfo:{background:"#bbdefb",color:"#1565c0",border:"1px solid #64b5f6"},passwordContainer:{display:"flex",gap:"10px",alignItems:"center"},passwordInput:{flex:1},checkbox:{width:"18px",height:"18px",cursor:"pointer"},info:{fontSize:"12px",color:"#666",marginTop:"8px",padding:"8px",background:"#f0f0f0",borderRadius:"4px",borderLeft:"3px solid #2196F3"},fileInput:{display:"none"},fileInputLabel:{padding:"8px 16px",background:"#2196F3",color:"white",borderRadius:"4px",cursor:"pointer",fontSize:"14px",fontWeight:"bold",display:"inline-block",transition:"background 0.3s",pointerEvents:"auto",position:"relative",zIndex:1}},ee=()=>{const $=L.message;return c==="success"?{...$,...L.messageSuccess}:c==="error"?{...$,...L.messageError}:{...$,...L.messageInfo}};return r.jsxs("div",{style:L.container,children:[r.jsx("h3",{style:{marginTop:0,color:"#2e7d32"},children:" /"}),r.jsxs("div",{style:L.tabButtons,children:[r.jsx("button",{style:L.tabButton(s==="export"),onClick:()=>o("export"),children:" "}),r.jsx("button",{style:L.tabButton(s==="import"),onClick:()=>o("import"),children:" "})]}),u&&r.jsx("div",{style:ee(),children:u}),s==="export"&&r.jsxs("div",{children:[r.jsx("div",{style:L.section,children:r.jsx("button",{style:L.button,onClick:_,children:" "})}),i&&r.jsxs("div",{style:L.section,children:[r.jsxs("label",{style:L.label,children:[" ",r.jsxs("span",{style:{marginLeft:"10px",color:"#2196F3",fontSize:"13px",fontWeight:"normal"},children:[": ",i.length.toLocaleString()]})]}),r.jsxs("div",{style:{marginBottom:"12px",padding:"10px",background:h>1?"#fff3e0":"#f5f5f5",borderRadius:"4px",border:h>1?"1px solid #ffe0b2":"1px solid #ddd"},children:[r.jsx("div",{style:{marginBottom:"8px",fontWeight:"bold",color:h>1?"#e65100":"#666"},children:h>1?" ":"  ("+i.length+")"}),r.jsxs("div",{style:{display:"flex",gap:"10px",alignItems:"center",flexWrap:"wrap"},children:[r.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"5px",cursor:"pointer"},children:[r.jsx("input",{type:"radio",name:"copyMode",value:"whole",checked:w==="whole",onChange:$=>E($.target.value),style:{cursor:"pointer"}}),r.jsxs("span",{children:[" ",h===1?"()":"()"]})]}),r.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"5px",cursor:"pointer"},children:[r.jsx("input",{type:"radio",name:"copyMode",value:"paginated",checked:w==="paginated",onChange:$=>E($.target.value),style:{cursor:"pointer"}}),r.jsxs("span",{children:[" ",h>1?"()":"()"]})]})]})]}),w==="paginated"&&h>1&&r.jsxs("div",{style:{marginBottom:"12px",padding:"10px",background:"#e3f2fd",borderRadius:"4px",border:"1px solid #bbdefb"},children:[r.jsxs("div",{style:{marginBottom:"8px",fontWeight:"bold",color:"#1565c0"},children:["  ",S,"/",h]}),r.jsxs("div",{style:{display:"flex",gap:"8px",alignItems:"center",flexWrap:"wrap"},children:[r.jsx("button",{style:{...L.button,...L.buttonSecondary,opacity:S===1?.5:1,cursor:S===1?"not-allowed":"pointer"},onClick:()=>g(Math.max(1,S-1)),disabled:S===1,children:" "}),r.jsx("select",{value:S,onChange:$=>g(parseInt($.target.value)),style:{padding:"6px 10px",border:"1px solid #ccc",borderRadius:"4px",fontSize:"14px",cursor:"pointer"},children:Array.from({length:h},($,O)=>r.jsxs("option",{value:O+1,children:[" ",O+1," "]},O+1))}),r.jsx("button",{style:{...L.button,...L.buttonSecondary,opacity:S===h?.5:1,cursor:S===h?"not-allowed":"pointer"},onClick:()=>g(Math.min(h,S+1)),disabled:S===h,children:" "})]}),r.jsx("div",{style:{fontSize:"12px",color:"#666",marginTop:"8px"},children:" "})]}),r.jsx("textarea",{value:w==="paginated"&&h>1?i.substring((S-1)*v,Math.min(S*v,i.length)):i,readOnly:!0,style:L.textarea}),r.jsxs("div",{style:{marginTop:"10px"},children:[r.jsxs("button",{style:L.button,onClick:y,children:[" ",w==="paginated"&&h>1?` ${S} `:""]}),r.jsx("button",{style:{...L.button,...L.buttonSecondary},onClick:R,children:" "})]}),r.jsxs("div",{style:L.info,children:[" ",h>1&&r.jsxs(r.Fragment,{children:[r.jsx("br",{}),"  ",h,' ""']})]})]})]}),s==="import"&&r.jsxs("div",{children:[r.jsxs("div",{style:L.section,children:[r.jsx("label",{style:L.label,children:" "}),r.jsx("input",{type:"file",accept:".txt,.json",onChange:C,style:L.fileInput,id:"saveFileInput"}),r.jsx("label",{htmlFor:"saveFileInput",style:L.fileInputLabel,children:" "}),r.jsx("button",{style:{...L.button,...L.buttonSecondary,marginLeft:"10px"},onClick:I,children:" "})]}),r.jsxs("div",{style:L.section,children:[r.jsx("label",{style:L.label,children:" "}),r.jsx("textarea",{value:l,onChange:$=>d($.target.value),placeholder:"...",style:L.textarea})]}),r.jsxs("div",{style:L.section,children:[r.jsx("button",{style:L.button,onClick:T,children:" "}),r.jsx("button",{style:{...L.button,...L.buttonDanger},onClick:()=>{d("")},children:" "})]}),r.jsx("div",{style:L.info,children:" "})]})]})},EC=({player:e,onSave:t,onLoad:n,onReset:s,onOpenGuide:o,autoAssignEnabled:i=!1,onToggleAutoAssign:a,autoSkipSpiritTest:l=!1,onToggleAutoSkip:d,skipChildGiftPopups:u=!1,onToggleSkipChildGiftPopups:p,skipShuraFieldEvents:c=!1,onToggleSkipShuraFieldEvents:m,skipRomanceGiftPopups:v=!1,onToggleSkipRomanceGiftPopups:w,skipJealousyPopups:E=!1,onToggleSkipJealousyPopups:S,skipZhaozhou:g=!1,onToggleSkipZhaozhou:h,isPortraitViewport:x=!0,isOrientationFixApplied:k=!1,onRequestPortraitFix:_=()=>{},onReleasePortraitFix:y=()=>{},onAutoAssignSpouses:R=()=>{},onRedeemCode:C=null,gameState:I=null})=>{const[T,L]=b.useState([]),[ee,$]=b.useState([]),[O,H]=b.useState({used:"0",usedMB:"0"}),[F,se]=b.useState({enabled:!1,syncing:!1}),[J,de]=b.useState([]),[Ee,$e]=b.useState(!1),[De,Qe]=b.useState(""),[Y,ue]=b.useState(""),[ne,ce]=b.useState(""),[ae,je]=b.useState(!1),[X,Me]=b.useState(null),[Ae,_e]=b.useState(!0),[z,he]=b.useState(!0),[ye,ke]=b.useState(!0),[ve,Ge]=b.useState(!0),[on,pt]=b.useState(!1),[Ct,Qt]=b.useState(null),[Yr,lo]=b.useState(!1),[ks,tr]=b.useState(!1),[js,an]=b.useState(!1),[Lt,co]=b.useState(!1),[fr,Ba]=b.useState(!1),[Oa,Cs]=b.useState(!1),[di,ze]=b.useState(!1),[nr,nd]=b.useState(!1),[ln,rr]=b.useState(!1),[Ts,rd]=b.useState(null),[Is,Pa]=b.useState(""),[uo,sd]=b.useState(null),po=[{key:"autoAssign",label:"",brief:"12",detail:["","1)  12 ","2) ","3) "].join(`
`),checked:!!i,onChange:a},{key:"autoSpirit",label:"",brief:"",detail:["","1) ","2) ","3) "].join(`
`),checked:!!l,onChange:d},{key:"skipGiftModal",label:"",brief:"",detail:["","1) ","2) ","3) "].join(`
`),checked:!!u,onChange:p},{key:"skipZhaozhou",label:"",brief:"",detail:["","1) ",'2) ""',"3) "].join(`
`),checked:!!g,onChange:h}],od=[i?"":"",l?"":"",u?"":"",g?"":""].join("  "),ui=[{key:"skipShura",label:"",brief:"",detail:["","1) ","2) ","3) "].join(`
`),checked:!!c,onChange:m},{key:"skipRomanceGift",label:"",brief:"NPC ",detail:["","1) ","2) ","3) "].join(`
`),checked:!!v,onChange:w},{key:"skipJealousy",label:"",brief:"",detail:["","1) ","2) ","3) "].join(`
`),checked:!!E,onChange:S}],fo=[c?"":"",v?"":"",E?"":""].join("  "),qr=V=>{Qt(Fe=>Fe===V?null:V)},mo=V=>{rd(Fe=>Fe===V?null:V)},id=()=>{if(typeof C!="function"){sd({success:!1,message:""});return}const V=C(Is);V!=null&&V.success&&Pa(""),sd(V||{success:!1,message:""})},ad=T.filter(V=>V.exists).length,ld=ee.filter(V=>V.exists).length,cd=`${De?"API Key ":"API Key "}   ${ne||""}`,za=Ae?"":"",pi=`${z?"AI":""}  ${ye?"":""}  ${ve?"":""}`,fi=` ${ad}    ${ld}   ${O.usedMB} MB`,_s="",dd=`${x?"":""}  ${k?"":""}`;b.useEffect(()=>{Cr(),Rs(),pd(),ud(),Kr(),mi();const V=Fe=>{console.log(""),Rs(),Kr()};window.addEventListener("autoSaveCompleted",V);try{const Fe="__test__";localStorage.setItem(Fe,"test"),localStorage.removeItem(Fe)}catch(Fe){console.error("localStorage :",Fe),window.showResult&&window.showResult("",` 


1. 
2. 
3. 

`,!1,null,!1)}return()=>{window.removeEventListener("autoSaveCompleted",V)}},[]),b.useEffect(()=>{Lt&&(console.log(""),Cr(),Rs(),Kr())},[Lt]);const mi=()=>{const V=m1();se(V),V.enabled&&go()},go=async()=>{try{$e(!0);const V=await ov();de(V)}catch(V){console.error(":",V)}finally{$e(!1)}},Cr=()=>{try{const V=Gf();console.log(":",V),L(V),Kr()}catch(V){console.error(":",V),L([{slot:1,exists:!1},{slot:2,exists:!1},{slot:3,exists:!1}])}},Rs=()=>{try{const V=c1();console.log(":",V),$(V)}catch(V){console.error(":",V),$([])}},Kr=()=>{const V=s1();H(V)},ud=()=>{const V=localStorage.getItem("enableGazette"),Fe=localStorage.getItem("useAIForLetter"),Wn=localStorage.getItem("acceptChildLetters"),Ut=localStorage.getItem("acceptLoverLetters");_e(V!=="false"),he(Fe!=="false"),ke(Wn!=="false"),Ge(Ut!=="false")},Ms=()=>{localStorage.setItem("enableGazette",Ae.toString()),localStorage.setItem("useAIForLetter",z.toString()),localStorage.setItem("acceptChildLetters",ye.toString()),localStorage.setItem("acceptLoverLetters",ve.toString()),window.showResult&&window.showResult("","",!0,null,!1)},pd=()=>{const V=localStorage.getItem("game_api_key")||"",Fe=localStorage.getItem("game_api_url")||"https://api.deepseek.com/chat/completions",Wn=localStorage.getItem("game_api_model")||"deepseek-chat";Qe(V),ue(Fe),ce(Wn)},Da=()=>{localStorage.setItem("game_api_key",De),localStorage.setItem("game_api_url",Y),localStorage.setItem("game_api_model",ne),window.showResult&&window.showResult("AI ","AI ",!0,null,!1),Me(null)},fd=async()=>{if(!De||!Y){window.showResult&&window.showResult(""," API Key  URL",!1,null,!1);return}je(!0),Me(null);try{const V=await Zk(De,Y);Me(V?{success:!0,message:" API "}:{success:!1,message:" "})}catch(V){Me({success:!1,message:` : ${V.message}`})}finally{je(!1)}},Fa=V=>{const Fe=t(V);window.showResult&&(Fe.success?(window.showResult("",` : ${V}
: ${Fe.time}
: ${Fe.size} KB`,!0,null,!1),Cr()):Fe.error==="QUOTA_EXCEEDED"?window.showResult("",` 


1. 
2. 
3. 

: ${Fe.size||""} KB`,!1,null,!1):Fe.error==="STORAGE_TOO_LARGE"?window.showResult("",` ${Fe.size} KB



`,!1,null,!1):window.showResult("",` 

: ${Fe.error||""}
: ${Fe.message||""}


1. 
2. 
3. `,!1,null,!1))},ho=V=>{window.showConfirm&&window.showConfirm(` ${V} `,()=>n(V))},md=V=>{window.showConfirm&&window.showConfirm(` ${V} `,()=>{a1(V),Cr(),window.showResult&&window.showResult("",` ${V} `,!0,null,!1)})},gd=(V=1)=>{try{if(!I){window.showResult&&window.showResult(""," ",!1,null,!1);return}const Fe=JSON.stringify(I).length/1024,Wn=mh(I),Ut=iv(I,Wn),xo=JSON.stringify(Wn).length/1024;console.log(" :",Ut),console.log(` : ${Fe.toFixed(2)} KB -> ${xo.toFixed(2)} KB ( ${(Fe-xo).toFixed(2)} KB)`);const Ns=t(V,Wn);if(Ns&&Ns.success){const Ua=` 

:
- :  ${Ut.mainLogsRemoved}  ${Ut.mainLogsKept} 
- NPC:  ${Ut.npcLogsRemoved}  ${Ut.npcLogsKept} 
- : ${Ut.totalRemoved} 

: ${xo.toFixed(2)} KB
: ${(Fe-xo).toFixed(2)} KB`;window.showResult&&window.showResult("",Ua,!0,null,!1),Cr(),Kr()}else window.showResult&&window.showResult("",` 
${(Ns==null?void 0:Ns.message)||""}`,!1,null,!1)}catch(Fe){console.error(":",Fe),window.showResult&&window.showResult("",` : ${Fe.message}`,!1,null,!1)}},Ha=V=>{window.showConfirm&&window.showConfirm(` ${V} `,()=>{try{const Fe=d1(V);Fe?(n(null,Fe),window.showResult&&window.showResult("",`  ${V} 
: ${Fe.gameTime||""}`,!0,null,!1)):window.showResult&&window.showResult(""," ",!1,null,!1)}catch(Fe){console.error(":",Fe),window.showResult&&window.showResult(""," "+Fe.message,!1,null,!1)}})},hd=()=>{window.showConfirm&&window.showConfirm(`

`,()=>{u1(),Rs(),window.showResult&&window.showResult(""," ",!0,null,!1)})},Wa=()=>{window.showConfirm&&window.showConfirm(" ",()=>{s(),Cr()})},xd=async V=>{if(!F.enabled){window.showResult&&window.showResult("",` 
 TapTap `,!1,null,!1);return}window.showConfirm&&window.showConfirm(` ${V} `,async()=>{try{$e(!0);const Fe=await p1(V);window.showResult&&window.showResult("",` 

: ${Fe.action==="create"?"":""}
UUID: ${Fe.uuid}`,!0,null,!1),await go()}catch(Fe){window.showResult&&window.showResult("",` 

${Fe.message}


 65
 
 5MB`,!1,null,!1)}finally{$e(!1)}})},As=async V=>{if(!F.enabled){window.showResult&&window.showResult("",` 
 TapTap `,!1,null,!1);return}window.showConfirm&&window.showConfirm(` ${V} `,async()=>{var Fe,Wn;try{$e(!0);const Ut=await f1(V);window.showResult&&window.showResult("",` 

: ${((Fe=Ut.player)==null?void 0:Fe.name)||""}
: ${((Wn=Ut.player)==null?void 0:Wn.cultivation)||0} `,!0,null,!1),Cr()}catch(Ut){window.showResult&&window.showResult("",` 

${Ut.message}`,!1,null,!1)}finally{$e(!1)}})};return r.jsxs("div",{style:{padding:"20px"},children:[r.jsx("h3",{style:{borderBottom:"1px solid #ccc",paddingBottom:"10px"},children:" "}),r.jsxs("div",{style:K.collapsibleCard,children:[r.jsxs("button",{type:"button",style:K.collapsibleHeader,onClick:()=>pt(V=>!V),children:[r.jsxs("div",{style:K.collapsibleTitleRow,children:[r.jsx("span",{children:" "}),r.jsx("span",{style:K.collapsibleHint,children:on?"":""})]}),r.jsxs("div",{style:K.collapsibleSummary,children:["",od]})]}),on&&r.jsxs("div",{style:K.collapseBody,children:[r.jsx("p",{style:{...K.info,marginBottom:"10px"},children:""}),r.jsx("div",{style:K.optionGroup,children:po.map(V=>r.jsxs("div",{style:K.optionCard,children:[r.jsxs("div",{style:K.optionRow,children:[r.jsxs("label",{style:K.optionToggle,children:[r.jsx("input",{type:"checkbox",checked:V.checked,onChange:Fe=>V.onChange&&V.onChange(Fe.target.checked)}),r.jsx("span",{children:V.checked?"":""})]}),r.jsxs("button",{type:"button",style:K.optionText,onClick:()=>qr(V.key),children:[r.jsxs("div",{style:K.optionTitleRow,children:[r.jsx("span",{children:V.label}),r.jsx("span",{style:K.detailHint,children:Ct===V.key?"":""})]}),r.jsx("div",{style:K.optionBrief,children:V.brief})]})]}),Ct===V.key&&r.jsx("div",{style:K.optionDetail,children:V.detail})]},V.key))}),r.jsxs("div",{style:K.familyActionCard,children:[r.jsxs("div",{style:K.familyActionHeader,children:[r.jsx("span",{children:" "}),r.jsx("span",{style:{fontSize:"11px",color:"#8d6e63"},children:""})]}),r.jsx("p",{style:K.familyActionDesc,children:" 500 "}),r.jsx("button",{type:"button",style:K.familyActionBtn,onClick:()=>R&&R(),children:" "}),r.jsx("small",{style:K.hint,children:""})]})]})]}),r.jsxs("div",{style:K.collapsibleCard,children:[r.jsxs("button",{type:"button",style:K.collapsibleHeader,onClick:()=>rr(V=>!V),children:[r.jsxs("div",{style:K.collapsibleTitleRow,children:[r.jsx("span",{children:" "}),r.jsx("span",{style:K.collapsibleHint,children:ln?"":""})]}),r.jsxs("div",{style:K.collapsibleSummary,children:["",fo]})]}),ln&&r.jsxs("div",{style:K.collapseBody,children:[r.jsx("p",{style:{...K.info,marginBottom:"10px"},children:""}),r.jsx("div",{style:K.optionGroup,children:ui.map(V=>r.jsxs("div",{style:K.optionCard,children:[r.jsxs("div",{style:K.optionRow,children:[r.jsxs("label",{style:K.optionToggle,children:[r.jsx("input",{type:"checkbox",checked:V.checked,onChange:Fe=>V.onChange&&V.onChange(Fe.target.checked)}),r.jsx("span",{children:V.checked?"":""})]}),r.jsxs("button",{type:"button",style:K.optionText,onClick:()=>mo(V.key),children:[r.jsxs("div",{style:K.optionTitleRow,children:[r.jsx("span",{children:V.label}),r.jsx("span",{style:K.detailHint,children:Ts===V.key?"":""})]}),r.jsx("div",{style:K.optionBrief,children:V.brief})]})]}),Ts===V.key&&r.jsx("div",{style:K.optionDetail,children:V.detail})]},V.key))})]})]}),r.jsxs("div",{style:K.collapsibleCard,children:[r.jsxs("button",{type:"button",style:K.collapsibleHeader,onClick:()=>nd(V=>!V),children:[r.jsxs("div",{style:K.collapsibleTitleRow,children:[r.jsx("span",{children:" "}),r.jsx("span",{style:K.collapsibleHint,children:nr?"":""})]}),r.jsx("div",{style:K.collapsibleSummary,children:dd})]}),nr&&r.jsxs("div",{style:K.collapseBody,children:[r.jsx("p",{style:K.info,children:" UI "}),r.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"10px"},children:[r.jsx("button",{onClick:_,style:{...K.saveBtn,width:"100%"},children:" "}),r.jsx("button",{onClick:y,style:{...K.btn,width:"100%",border:"1px solid #d32f2f",color:"#d32f2f"},disabled:!k,children:" "})]}),r.jsx("small",{style:K.hint,children:""})]})]}),r.jsxs("div",{style:K.collapsibleCard,children:[r.jsxs("button",{type:"button",style:K.collapsibleHeader,onClick:()=>lo(V=>!V),children:[r.jsxs("div",{style:K.collapsibleTitleRow,children:[r.jsx("span",{children:" AI "}),r.jsx("span",{style:K.collapsibleHint,children:Yr?"":""})]}),r.jsx("div",{style:K.collapsibleSummary,children:cd})]}),Yr&&r.jsxs("div",{style:K.collapseBody,children:[r.jsxs("p",{style:K.info,children:[" API NPC ",r.jsx("br",{}),r.jsx("small",{style:{color:"#999"},children:" DeepSeek "})]}),r.jsxs("div",{style:K.formGroup,children:[r.jsx("label",{style:K.label,children:":"}),r.jsxs("select",{onChange:V=>{V.target.value==="deepseek"&&(ue("https://api.deepseek.com/chat/completions"),ce("deepseek-chat")),V.target.value=""},style:K.select,children:[r.jsx("option",{value:"",children:"..."}),r.jsx("option",{value:"deepseek",children:" DeepSeek"})]}),r.jsx("small",{style:K.hint,children:" URL  API Key"})]}),r.jsxs("div",{style:K.formGroup,children:[r.jsx("label",{style:K.label,children:"API Key:"}),r.jsx("input",{type:"password",value:De,onChange:V=>Qe(V.target.value),placeholder:"sk-xxxxxxxxxxxxxxxx",style:K.input}),r.jsxs("small",{style:K.hint,children:[" Key:",r.jsx("a",{href:"https://platform.deepseek.com/",target:"_blank",rel:"noopener",children:" DeepSeek"})]})]}),r.jsxs("div",{style:K.formGroup,children:[r.jsx("label",{style:K.label,children:"API URL:"}),r.jsx("input",{type:"text",value:Y,onChange:V=>ue(V.target.value),placeholder:"https://api.deepseek.com/chat/completions",style:K.input}),r.jsx("small",{style:K.hint,children:"DeepSeek: https://api.deepseek.com/chat/completions"})]}),r.jsxs("div",{style:K.formGroup,children:[r.jsx("label",{style:K.label,children:":"}),r.jsx("input",{type:"text",value:ne,onChange:V=>ce(V.target.value),placeholder:"deepseek-chat",style:K.input}),r.jsx("small",{style:K.hint,children:"DeepSeek: deepseek-chat"})]}),X&&r.jsx("div",{style:{...K.statusBox,background:X.success?"#e8f5e9":"#ffebee",color:X.success?"#2e7d32":"#c62828"},children:X.message}),r.jsxs("div",{style:K.btnGroup,children:[r.jsx("button",{onClick:Da,style:K.saveBtn,children:" "}),r.jsx("button",{onClick:fd,style:{...K.btn,background:"#2196f3",color:"white",border:"none"},disabled:ae,children:ae?"...":" "})]})]})]}),r.jsxs("div",{style:K.collapsibleCard,children:[r.jsxs("button",{type:"button",style:K.collapsibleHeader,onClick:()=>tr(V=>!V),children:[r.jsxs("div",{style:K.collapsibleTitleRow,children:[r.jsx("span",{children:" "}),r.jsx("span",{style:K.collapsibleHint,children:ks?"":""})]}),r.jsx("div",{style:K.collapsibleSummary,children:za})]}),ks&&r.jsxs("div",{style:K.collapseBody,children:[r.jsxs("p",{style:K.info,children:["NPC",r.jsx("br",{}),r.jsx("small",{style:{color:"#999"},children:""})]}),r.jsxs("div",{style:K.formGroup,children:[r.jsxs("label",{style:K.checkboxLabel,children:[r.jsx("input",{type:"checkbox",checked:Ae,onChange:V=>_e(V.target.checked),style:K.checkbox}),r.jsx("span",{children:""})]}),r.jsx("small",{style:K.hint,children:""})]}),r.jsx("button",{onClick:Ms,style:K.saveBtn,children:" "})]})]}),r.jsxs("div",{style:K.collapsibleCard,children:[r.jsxs("button",{type:"button",style:K.collapsibleHeader,onClick:()=>an(V=>!V),children:[r.jsxs("div",{style:K.collapsibleTitleRow,children:[r.jsx("span",{children:" "}),r.jsx("span",{style:K.collapsibleHint,children:js?"":""})]}),r.jsx("div",{style:K.collapsibleSummary,children:pi})]}),js&&r.jsxs("div",{style:K.collapseBody,children:[r.jsxs("p",{style:K.info,children:["NPC",r.jsx("br",{}),r.jsx("small",{style:{color:"#999"},children:"AI"})]}),r.jsxs("div",{style:K.formGroup,children:[r.jsxs("label",{style:K.checkboxLabel,children:[r.jsx("input",{type:"checkbox",checked:z,onChange:V=>he(V.target.checked),style:K.checkbox}),r.jsx("span",{children:"AI"})]}),r.jsx("small",{style:K.hint,children:"API Key"})]}),r.jsxs("div",{style:K.formGroup,children:[r.jsxs("label",{style:K.checkboxLabel,children:[r.jsx("input",{type:"checkbox",checked:ye,onChange:V=>ke(V.target.checked),style:K.checkbox}),r.jsx("span",{children:""})]}),r.jsx("small",{style:K.hint,children:""})]}),r.jsxs("div",{style:K.formGroup,children:[r.jsxs("label",{style:K.checkboxLabel,children:[r.jsx("input",{type:"checkbox",checked:ve,onChange:V=>Ge(V.target.checked),style:K.checkbox}),r.jsx("span",{children:""})]}),r.jsx("small",{style:K.hint,children:""})]}),r.jsx("button",{onClick:Ms,style:K.saveBtn,children:" "})]})]}),r.jsxs("div",{style:K.collapsibleCard,children:[r.jsxs("button",{type:"button",style:K.collapsibleHeader,onClick:()=>co(V=>!V),children:[r.jsxs("div",{style:K.collapsibleTitleRow,children:[r.jsx("span",{children:" "}),r.jsx("span",{style:K.collapsibleHint,children:Lt?"":""})]}),r.jsx("div",{style:K.collapsibleSummary,children:fi})]}),Lt&&r.jsxs("div",{style:K.collapseBody,children:[r.jsxs("p",{style:K.info,children:["",F.enabled&&r.jsx("span",{style:{color:"#4caf50",fontWeight:"bold"},children:"  "})]}),r.jsxs("div",{style:{background:"linear-gradient(135deg, #667eea 0%, #764ba2 100%)",borderRadius:"8px",padding:"15px",marginBottom:"20px",color:"white"},children:[r.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"10px"},children:[r.jsx("h5",{style:{margin:0,fontSize:"16px"},children:" 3"}),ee.some(V=>V.exists)&&r.jsx("button",{onClick:hd,style:{background:"rgba(255,255,255,0.2)",border:"1px solid rgba(255,255,255,0.3)",color:"white",padding:"4px 10px",borderRadius:"4px",fontSize:"11px",cursor:"pointer"},children:" "})]}),r.jsx("p",{style:{fontSize:"12px",margin:"0 0 15px 0",opacity:.9},children:" 3"}),ee.length===0?r.jsx("div",{style:{background:"rgba(255,255,255,0.1)",borderRadius:"5px",padding:"15px",textAlign:"center",fontSize:"13px"},children:""}):r.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"10px"},children:[ee.filter(V=>V.exists).map(V=>r.jsxs("div",{style:{background:"rgba(255,255,255,0.15)",borderRadius:"6px",padding:"12px",backdropFilter:"blur(10px)"},children:[r.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"8px"},children:[r.jsxs("div",{style:{fontSize:"13px",fontWeight:"bold"},children:["#",V.slot," - ",V.gameTime||""]}),r.jsx("div",{style:{background:"rgba(76, 175, 80, 0.8)",padding:"2px 8px",borderRadius:"10px",fontSize:"11px"},children:V.tier||""})]}),r.jsxs("div",{style:{fontSize:"11px",opacity:.9,marginBottom:"8px"},children:[r.jsxs("div",{children:[": ",V.playerName||""," | : ",V.cultivation||0," | : ",V.age||0,""]}),r.jsxs("div",{children:[": ",V.saveDate||""]})]}),r.jsx("button",{onClick:()=>Ha(V.slot),style:{background:"rgba(33, 150, 243, 0.9)",border:"none",color:"white",padding:"6px 15px",borderRadius:"4px",fontSize:"12px",cursor:"pointer",width:"100%",fontWeight:"bold"},children:" "})]},V.slot)),ee.filter(V=>V.exists).length===0&&r.jsx("div",{style:{background:"rgba(255,255,255,0.1)",borderRadius:"5px",padding:"15px",textAlign:"center",fontSize:"13px"},children:""})]})]}),r.jsxs("div",{style:{background:"#fff3cd",border:"1px solid #ffc107",borderRadius:"8px",padding:"12px",marginBottom:"15px"},children:[r.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"10px"},children:[r.jsx("div",{style:{fontSize:"14px",fontWeight:"bold",color:"#856404"},children:" "}),r.jsx("span",{style:{fontSize:"11px",color:"#856404",opacity:.8},children:"3+"})]}),r.jsxs("div",{style:{fontSize:"12px",color:"#856404",marginBottom:"10px",lineHeight:"1.5"},children:[" 3",r.jsx("br",{}),' ""',r.jsx("br",{})," ",r.jsx("br",{})," NPC"]}),r.jsx("button",{onClick:()=>{window.showConfirm&&window.showConfirm(`

- 3
- 
- 

""`,()=>{gd()})},style:{background:"#ffc107",border:"none",color:"#000",padding:"8px 16px",borderRadius:"4px",fontSize:"13px",fontWeight:"bold",cursor:"pointer",width:"100%"},children:" "})]}),F.enabled&&r.jsxs("div",{style:{background:"#e8f5e9",border:"1px solid #4caf50",borderRadius:"5px",padding:"10px",marginBottom:"15px",fontSize:"12px"},children:[r.jsx("div",{style:{fontWeight:"bold",marginBottom:"5px",color:"#2e7d32"},children:" TapTap "}),r.jsxs("div",{style:{color:"#555"},children:[" ",r.jsx("br",{})," ",r.jsx("br",{})," ",r.jsx("br",{})," 1/"]}),F.syncing&&r.jsx("div",{style:{marginTop:"8px",color:"#ff9800"},children:" ..."})]}),r.jsxs("div",{style:{background:"#f5f5f5",padding:"10px",borderRadius:"5px",marginBottom:"15px",fontSize:"12px"},children:[r.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:"5px"},children:[r.jsx("span",{children:" :"}),r.jsxs("span",{children:[r.jsxs("strong",{children:[O.usedMB," MB"]})," / 100 MB"]})]}),r.jsx("div",{style:{height:"8px",background:"#ddd",borderRadius:"4px",overflow:"hidden"},children:r.jsx("div",{style:{height:"100%",background:O.usedMB>80?"#f44336":O.usedMB>60?"#ff9800":"#4caf50",width:`${Math.min(O.usedMB/100*100,100)}%`,transition:"width 0.3s"}})}),O.usedMB>80&&r.jsx("div",{style:{color:"#f44336",marginTop:"5px",fontSize:"11px"},children:" "})]}),r.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"15px"},children:T.length===0?r.jsx("div",{style:{padding:"20px",textAlign:"center",color:"#999",background:"#f5f5f5",borderRadius:"5px"},children:"..."}):T.map(V=>r.jsxs("div",{style:K.slotCard,children:[r.jsxs("div",{style:K.slotHeader,children:[r.jsxs("span",{style:K.slotTitle,children:[" ",V.slot]}),V.exists&&r.jsx("span",{style:K.slotBadge,children:""})]}),V.exists?r.jsxs("div",{style:K.slotInfo,children:[r.jsxs("div",{style:{fontSize:"12px",color:"#666",marginBottom:"8px"},children:[r.jsxs("div",{children:[": ",V.playerName]}),V.cultivation>0&&r.jsxs("div",{children:[": ",V.cultivation," "]}),r.jsxs("div",{children:[": ",V.saveDate]})]}),r.jsxs("div",{style:{...K.btnGroup,gap:"8px",flexWrap:"wrap"},children:[r.jsx("button",{onClick:()=>Fa(V.slot),style:{...K.slotBtn,background:"#4caf50",color:"white"},children:" "}),r.jsx("button",{onClick:()=>ho(V.slot),style:{...K.slotBtn,background:"#2196f3",color:"white"},children:" "}),r.jsx("button",{onClick:()=>md(V.slot),style:{...K.slotBtn,background:"#f44336",color:"white"},children:" "}),F.enabled&&r.jsxs(r.Fragment,{children:[r.jsx("button",{onClick:()=>xd(V.slot),style:{...K.slotBtn,background:"#ff9800",color:"white"},disabled:Ee,children:" "}),r.jsx("button",{onClick:()=>As(V.slot),style:{...K.slotBtn,background:"#9c27b0",color:"white"},disabled:Ee,children:" "})]})]})]}):r.jsxs("div",{style:K.slotInfo,children:[r.jsx("div",{style:{fontSize:"13px",color:"#999",marginBottom:"10px"},children:""}),r.jsxs("div",{style:{...K.btnGroup,gap:"8px"},children:[r.jsx("button",{onClick:()=>Fa(V.slot),style:{...K.slotBtn,background:"#4caf50",color:"white",flex:1},children:" "}),F.enabled&&r.jsx("button",{onClick:()=>As(V.slot),style:{...K.slotBtn,background:"#9c27b0",color:"white",flex:1},disabled:Ee,children:" "})]})]})]},V.slot))})]})]}),r.jsxs("div",{style:K.collapsibleCard,children:[r.jsxs("button",{type:"button",style:K.collapsibleHeader,onClick:()=>Ba(V=>!V),children:[r.jsxs("div",{style:K.collapsibleTitleRow,children:[r.jsx("span",{children:" /"}),r.jsx("span",{style:K.collapsibleHint,children:fr?"":""})]}),r.jsx("div",{style:K.collapsibleSummary,children:""})]}),fr&&r.jsx("div",{style:K.collapseBody,children:r.jsx(wC,{gameState:I||{player:e,children:[],fallenChildren:[],activeNpcs:[],deadNpcs:[],inventory:[],logs:[],messages:{},lastMessageCheck:{},gameStage:"MAIN",pendingSectChoices:null,testQueue:[],worldEvents:[],newsBuffer:[]},onLoadGame:n,playerName:(e==null?void 0:e.name)||""})})]}),r.jsxs("div",{style:K.collapsibleCard,children:[r.jsxs("button",{type:"button",style:K.collapsibleHeader,onClick:()=>Cs(V=>!V),children:[r.jsxs("div",{style:K.collapsibleTitleRow,children:[r.jsx("span",{children:" "}),r.jsx("span",{style:K.collapsibleHint,children:Oa?"":""})]}),r.jsx("div",{style:K.collapsibleSummary,children:""})]}),Oa&&r.jsxs("div",{style:K.collapseBody,children:[r.jsxs("div",{style:K.formGroup,children:[r.jsx("label",{style:K.label,children:""}),r.jsx("input",{type:"text",value:Is,onChange:V=>Pa(V.target.value),placeholder:"",style:K.input}),r.jsx("span",{style:K.hint,children:""})]}),r.jsx("button",{onClick:id,style:{...K.btn,background:"#ffb74d",color:"#4e342e",border:"none",width:"100%"},children:" "}),uo&&r.jsx("div",{style:{...K.statusBox,background:uo.success?"#e8f5e9":"#ffebee",color:uo.success?"#2e7d32":"#c62828",marginTop:"12px"},children:uo.message})]})]}),r.jsxs("div",{style:K.collapsibleCard,children:[r.jsxs("button",{type:"button",style:K.collapsibleHeader,onClick:()=>ze(V=>!V),children:[r.jsxs("div",{style:K.collapsibleTitleRow,children:[r.jsx("span",{children:" "}),r.jsx("span",{style:K.collapsibleHint,children:di?"":""})]}),r.jsx("div",{style:K.collapsibleSummary,children:_s})]}),di&&r.jsxs("div",{style:K.collapseBody,children:[r.jsx("p",{style:K.info,children:""}),r.jsx("button",{onClick:o,style:{...K.btn,background:"#2196f3",color:"white",border:"none",width:"100%"},children:" "})]})]}),r.jsxs("div",{style:{...K.card,borderColor:"#d32f2f",background:"#ffebee"},children:[r.jsx("h4",{style:{color:"#d32f2f"},children:" "}),r.jsx("p",{style:{fontSize:"12px",color:"#666"},children:"Bug"}),r.jsx("button",{onClick:Wa,style:K.resetBtn,children:" "})]}),r.jsxs("div",{style:{textAlign:"center",marginTop:"30px",color:"#999",fontSize:"12px"},children:[r.jsx("p",{children:": v1.2.0 Alpha"}),r.jsxs("p",{children:["5MB",r.jsx("br",{}),F.enabled?" ":"  TapTap "]}),r.jsxs("p",{style:{marginTop:"8px",fontSize:"11px"},children:[" ",r.jsx("br",{}),"100"]})]})]})},K={card:{background:"white",padding:"15px",borderRadius:"8px",border:"1px solid #ddd",marginBottom:"20px"},info:{marginBottom:"15px",fontSize:"14px",color:"#555"},btnGroup:{display:"flex",gap:"10px"},btn:{flex:1,padding:"10px",cursor:"pointer",borderRadius:"5px",border:"1px solid #ccc",background:"#f5f5f5"},saveBtn:{flex:1,padding:"10px",cursor:"pointer",borderRadius:"5px",border:"none",background:"#4caf50",color:"white",fontWeight:"bold"},resetBtn:{width:"100%",padding:"10px",cursor:"pointer",borderRadius:"5px",border:"none",background:"#d32f2f",color:"white"},formGroup:{marginBottom:"15px"},label:{display:"block",marginBottom:"5px",fontSize:"13px",fontWeight:"bold",color:"#333"},checkboxLabel:{display:"flex",alignItems:"center",gap:"8px",fontSize:"14px",color:"#333",cursor:"pointer"},checkbox:{width:"18px",height:"18px",cursor:"pointer"},input:{width:"100%",padding:"10px",borderRadius:"5px",border:"1px solid #ddd",fontSize:"14px",boxSizing:"border-box"},select:{width:"100%",padding:"10px",borderRadius:"5px",border:"1px solid #ddd",fontSize:"14px",boxSizing:"border-box",cursor:"pointer",background:"white"},hint:{display:"block",marginTop:"5px",fontSize:"11px",color:"#999",lineHeight:"1.4"},statusBox:{padding:"10px",borderRadius:"5px",marginBottom:"15px",fontSize:"13px",fontWeight:"bold"},slotCard:{background:"#f9f9f9",padding:"12px",borderRadius:"6px",border:"1px solid #e0e0e0"},slotHeader:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"10px"},slotTitle:{fontSize:"14px",fontWeight:"bold",color:"#333"},slotBadge:{fontSize:"11px",padding:"3px 8px",borderRadius:"10px",background:"#4caf50",color:"white"},slotInfo:{marginTop:"8px"},slotBtn:{flex:1,padding:"8px",cursor:"pointer",borderRadius:"4px",border:"none",fontSize:"12px",fontWeight:"bold"},collapsibleCard:{background:"white",border:"1px solid #ddd",borderRadius:"10px",marginBottom:"20px",overflow:"visible",boxShadow:"0 4px 12px rgba(0,0,0,0.04)",pointerEvents:"auto",position:"relative"},collapsibleHeader:{width:"100%",background:"linear-gradient(120deg, #f5efe6, #fff)",border:"none",padding:"14px",textAlign:"left",cursor:"pointer",pointerEvents:"auto",position:"relative",zIndex:10},collapsibleTitleRow:{display:"flex",justifyContent:"space-between",alignItems:"center",fontWeight:"bold",color:"#4e342e"},collapsibleHint:{fontSize:"12px",color:"#8d6e63"},collapsibleSummary:{marginTop:"6px",fontSize:"12px",color:"#6d4c41"},collapseBody:{padding:"14px",borderTop:"1px solid #f0e0d6",background:"#fff",pointerEvents:"auto",position:"relative",zIndex:1},optionGroup:{display:"flex",flexDirection:"column",gap:"8px"},optionCard:{background:"rgba(249, 246, 243, 0.9)",borderRadius:"8px",border:"1px solid #efe0d4",padding:"8px"},optionRow:{display:"flex",gap:"10px",alignItems:"center"},optionToggle:{display:"flex",alignItems:"center",gap:"6px",fontSize:"12px",color:"#5d4037"},optionText:{flex:1,border:"none",background:"transparent",textAlign:"left",padding:0,cursor:"pointer",color:"#4e342e"},optionTitleRow:{display:"flex",justifyContent:"space-between",alignItems:"center",fontSize:"13px",fontWeight:600},detailHint:{fontSize:"12px",color:"#8d6e63"},optionBrief:{fontSize:"11px",color:"#6d4c41",marginTop:"2px"},optionDetail:{marginTop:"6px",padding:"8px",borderRadius:"6px",background:"#fff",border:"1px dashed #e0c5b4",fontSize:"11px",color:"#5d4037",lineHeight:1.5,whiteSpace:"pre-line"},familyActionCard:{marginTop:"12px",padding:"14px",borderRadius:"10px",border:"1px solid #e0c5b4",background:"linear-gradient(135deg, #fff7ec 0%, #fde2cf 100%)"},familyActionHeader:{display:"flex",justifyContent:"space-between",alignItems:"center",fontSize:"13px",fontWeight:600,color:"#4e342e",marginBottom:"6px"},familyActionDesc:{fontSize:"12px",color:"#6d4c41",lineHeight:1.5,margin:"8px 0 12px 0"},familyActionBtn:{width:"100%",padding:"10px",border:"none",borderRadius:"999px",cursor:"pointer",background:"linear-gradient(120deg, #ff9a62, #ff6f3c)",color:"#fff",fontWeight:"bold",fontSize:"14px",boxShadow:"0 4px 10px rgba(255, 111, 60, 0.3)"}},kC=(e,t)=>{var n;if(Qm[t]){const s=Qm[t];e.cultivationMethod=s;const o=((n=vn[s])==null?void 0:n.name)||s;return`${e.name}  ${t}${o}`}return null},Qg=(e,t)=>{const n=vn[t];if(!n)return{success:!1,message:""};const s=e.cultivationMethod,o=vn[s];e.cultivationMethod=t;const i=Af(t,e.spiritRoot);return{success:!0,message:`${e.name} ${(o==null?void 0:o.name)||""}${n.name}`,compatibility:i}},Nc=(e,t)=>{const n=Q2(e);if(!n)return{manual:null,compatibility:null};const s=Af(e,t);return{manual:n,compatibility:s,speedBonus:`${(s.compatibility*n.baseBuff*100).toFixed(0)}%`}},jC=({player:e,childFeedback:t=0,onOpenInventory:n,onAllocateSkillPoint:s})=>{var I,T,L,ee;const[o,i]=b.useState(!1);if(!e||!e.stats||!e.resources)return r.jsx("div",{style:{padding:"20px",textAlign:"center",color:"#999"},children:"..."});const a=kp(e.stats.aptitude),l=Ca(e,!0),d=l+t,u=An(e.tier),p=(u==null?void 0:u.chance)??0,c=(e.breakthroughBonus||0)/100,m=Math.min(.95,p+c);e.currentExp>=e.maxExp&&!u&&console.warn(` "${e.tier}" `);const w=((e.stats.aptitude||50)/50).toFixed(2),E=((I=e.spiritRoot)==null?void 0:I.multiplier)||1,S=((L=(T=e.trait)==null?void 0:T.bonuses)==null?void 0:L.speedMultiplier)??((ee=e.trait)==null?void 0:ee.effect)??1,g=e.sect&&e.sect.level!=="NONE"?1.5:1,h=e.cultivationMethod&&e.spiritRoot?Nf(e.cultivationMethod,e.spiritRoot):1,x=e.cultivationMethod||"basic_breath",k=e.spiritRoot?Nc(x,e.spiritRoot):null,_=Pn(e||{}),y=Math.floor(e.currentExp||0),R=Math.max(1,Math.floor(e.maxExp||1)),C=Math.min(100,Math.round(y/R*100));return r.jsxs("div",{style:we.container,children:[r.jsx("h3",{style:we.title,children:" "}),r.jsxs("div",{style:we.content,children:[r.jsxs("div",{style:we.topSection,children:[r.jsx("div",{style:we.avatarContainer,children:r.jsx(Gr,{dna:e.avatar,gender:e.gender,size:80})}),r.jsxs("div",{style:we.basicInfo,children:[r.jsx("h2",{style:we.playerName,children:e.name}),r.jsx("div",{style:we.tierBadge,children:e.tier}),r.jsx("div",{style:{display:"flex",gap:"8px",alignItems:"center"},children:r.jsxs("div",{style:we.ageText,children:[Math.floor(e.age),""]})}),(()=>{const $=fw(e.tier);return $?r.jsxs("div",{style:{marginTop:"6px",fontSize:"12px",color:"#ffffff"},children:[r.jsx("span",{style:{fontWeight:"bold"},children:" :"})," ",$]}):null})()]})]}),r.jsxs("div",{style:we.resourceStatsBox,children:[r.jsxs("div",{style:we.resourceRow,children:[r.jsxs("div",{style:we.resourceStatItem,children:[r.jsx("span",{style:we.resourceIcon,children:""}),r.jsxs("div",{style:we.resourceInfo,children:[r.jsx("div",{style:we.resourceLabel,children:""}),r.jsx("div",{style:we.resourceValue,children:e.resources.spiritStones})]})]}),r.jsxs("div",{style:we.resourceStatItem,children:[r.jsx("span",{style:we.resourceIcon,children:""}),r.jsxs("div",{style:we.resourceInfo,children:[r.jsx("div",{style:we.resourceLabel,children:""}),r.jsx("div",{style:we.resourceValue,children:_.total})]})]})]}),r.jsxs("div",{style:we.expSection,children:[r.jsx("div",{style:we.expLabel,children:""}),r.jsxs("div",{style:we.expBarWrapper,children:[r.jsx("div",{style:{...we.expBarFill,width:`${C}%`}}),r.jsxs("div",{style:we.expText,children:[y,"/",R]})]})]})]}),r.jsxs("div",{style:we.mainSection,children:[r.jsxs("div",{style:we.section,children:[r.jsx("h4",{children:" "}),e.spiritRoot?r.jsxs(r.Fragment,{children:[r.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"10px",marginBottom:"10px"},children:[r.jsx("strong",{style:{color:a.color,fontSize:"16px"},children:e.spiritRoot.type}),r.jsx("div",{style:{display:"flex",gap:"4px"},children:e.spiritRoot.elements.map($=>{const O=H=>({:"#FFD700",:"#4CAF50",:"#2196F3",:"#F44336",:"#795548",:"#673AB7",:"#00BCD4",:"#009688"})[H]||"#9e9e9e";return r.jsx("span",{style:{padding:"2px 6px",borderRadius:"10px",color:"white",fontWeight:"bold",fontSize:"10px",background:O($)},children:$},$)})})]}),r.jsxs("div",{style:we.barContainer,children:[r.jsxs("span",{children:[" (",e.stats.aptitude,")"]}),r.jsx("div",{style:we.barBg,children:r.jsx("div",{style:{...we.barFill,width:`${e.stats.aptitude}%`,background:a.color}})})]}),r.jsx("p",{style:{fontSize:"12px",color:"#666",marginTop:"5px"},children:e.spiritRoot.desc})]}):r.jsx("div",{style:{padding:"10px",background:"rgba(0,0,0,0.2)",borderRadius:"8px",fontSize:"13px",color:"rgba(255,255,255,0.75)"},children:""})]}),r.jsxs("div",{style:we.section,children:[r.jsx("h4",{children:" "}),e.spiritRoot?k!=null&&k.manual?r.jsxs("div",{style:we.manualCard,children:[r.jsxs("div",{style:we.manualHeader,children:[r.jsxs("div",{style:we.manualName,children:[k.manual.name,r.jsx("span",{style:{...we.manualTierBadge,background:k.manual.tierColor},children:k.manual.tierName})]}),k.manual.element!=="NONE"&&r.jsx("span",{style:we.manualElementBadge,children:k.manual.element})]}),r.jsx("p",{style:we.manualDesc,children:k.manual.desc}),k.compatibility&&r.jsxs("div",{style:we.manualMetaRow,children:[r.jsxs("span",{children:["",r.jsx("strong",{style:{color:k.compatibility.color},children:k.compatibility.desc})]}),r.jsxs("span",{children:["",r.jsxs("strong",{style:{color:"#64ffda"},children:["+",k.speedBonus]})]})]}),r.jsxs("div",{style:we.manualMetaRow,children:[r.jsxs("span",{children:["",k.manual.source||""]}),r.jsxs("span",{children:["",k.manual.element==="NONE"?"":k.manual.element]})]})]}):r.jsx("div",{style:we.manualPlaceholder,children:""}):r.jsx("div",{style:we.manualPlaceholder,children:""})]}),r.jsxs("div",{style:we.section,children:[r.jsx("h4",{children:" "}),r.jsxs("div",{style:we.barContainer,children:[r.jsxs("span",{children:[" (",y,"/",R,")"]}),r.jsx("div",{style:we.barBg,children:r.jsx("div",{style:{...we.barFill,width:`${C}%`,background:"#4CAF50"}})})]}),e.currentExp>=e.maxExp&&r.jsx("div",{style:{marginTop:"10px",padding:"10px",background:"rgba(255,193,7,0.15)",borderRadius:"8px",border:"1px solid #FFC107"},children:u?r.jsxs(r.Fragment,{children:[r.jsxs("div",{style:{fontSize:"13px",color:"#F57C00",fontWeight:"bold",marginBottom:"4px"},children:[" : ",(m*100).toFixed(1),"%"]}),r.jsxs("div",{style:{fontSize:"11px",color:"rgba(245,124,0,0.8)"},children:[": ",(p*100).toFixed(1),"%",c>0&&` | : +${(c*100).toFixed(1)}%`]})]}):r.jsx("div",{style:{fontSize:"12px",color:"#f44336"},children:" "})}),r.jsxs("div",{style:we.speedInfo,children:[r.jsxs("div",{style:we.speedHeader,children:[r.jsxs("span",{style:{fontWeight:"bold",color:"#4CAF50"},children:[" : ",d,"/"]}),t>0&&r.jsxs("span",{style:{fontSize:"12px",color:"#666",marginLeft:"8px"},children:["( ",l," +  ",t,")"]})]}),r.jsxs("div",{style:we.speedFormula,children:[r.jsx("div",{style:{fontSize:"11px",color:"#666",marginBottom:"4px"},children:": (10/)          "}),r.jsxs("div",{style:we.speedBreakdown,children:[r.jsxs("span",{style:we.speedItem,children:[r.jsx("span",{style:{color:"#888"},children:":"})," ",w]}),r.jsxs("span",{style:we.speedItem,children:[r.jsx("span",{style:{color:"#888"},children:":"})," ",E]}),r.jsxs("span",{style:we.speedItem,children:[r.jsx("span",{style:{color:"#888"},children:":"})," ",h.toFixed(2)]}),r.jsxs("span",{style:we.speedItem,children:[r.jsx("span",{style:{color:"#888"},children:":"})," ",S]}),r.jsxs("span",{style:we.speedItem,children:[r.jsx("span",{style:{color:"#888"},children:":"})," ",g]})]}),r.jsxs("div",{style:{fontSize:"10px",color:"#999",marginTop:"4px",fontStyle:"italic"},children:["= 10  ",w,"  ",E,"  ",h.toFixed(2),"  ",S,"  ",g," = ",l]}),t>0&&r.jsxs("div",{style:{fontSize:"11px",color:"#4CAF50",marginTop:"6px",paddingTop:"6px",borderTop:"1px dashed #ddd"},children:[" : +",t,"/"]})]})]})]}),r.jsxs("div",{style:we.section,children:[r.jsx("h4",{children:" "}),r.jsxs("div",{style:we.statsGrid,children:[r.jsxs("div",{style:we.statItem,children:[r.jsx("div",{style:we.statLabel,children:""}),r.jsx("div",{style:we.statValue,children:e.stats.looks}),r.jsx("div",{style:we.statBar,children:r.jsx("div",{style:{...we.statBarFill,width:`${e.stats.looks}%`,background:"#FF6B6B"}})})]}),r.jsxs("div",{style:we.statItem,children:[r.jsx("div",{style:we.statLabel,children:""}),r.jsx("div",{style:we.statValue,children:e.stats.cunning}),r.jsx("div",{style:we.statBar,children:r.jsx("div",{style:{...we.statBarFill,width:`${e.stats.cunning}%`,background:"#4ECDC4"}})})]}),r.jsxs("div",{style:we.statItem,children:[r.jsx("div",{style:we.statLabel,children:""}),r.jsx("div",{style:we.statValue,children:e.stats.health}),r.jsx("div",{style:we.statBar,children:r.jsx("div",{style:{...we.statBarFill,width:`${e.stats.health}%`,background:e.stats.health<30?"#F44336":e.stats.health<60?"#FFC107":"#45B7D1"}})}),r.jsxs("div",{style:{fontSize:"10px",color:"#ccc",marginTop:"4px",opacity:.8},children:[": ",Ht(e.stats.health).toFixed(1),"/20"]})]}),r.jsxs("div",{style:we.statItem,children:[r.jsx("div",{style:we.statLabel,children:""}),r.jsx("div",{style:we.statValue,children:e.stats.intelligence}),r.jsx("div",{style:we.statBar,children:r.jsx("div",{style:{...we.statBarFill,width:`${e.stats.intelligence}%`,background:"#96CEB4"}})})]})]}),r.jsx("div",{style:{display:"flex",justifyContent:"center",marginTop:"12px"},children:r.jsx("button",{onClick:()=>i($=>!$),style:we.detailsBtn,children:o?" ":" "})}),o&&r.jsx("div",{style:{marginTop:"15px",padding:"12px",background:"rgba(0,0,0,0.3)",borderRadius:"8px",border:"1px solid rgba(255,255,255,0.1)"},children:r.jsxs("div",{style:{fontSize:"12px",color:"#eee",lineHeight:1.8},children:[["looks","cunning","health","intelligence"].map($=>{const O=_w($),H=e.stats[$];let F=`${O.desc}`;if($==="health"){const se=Ht(H);F+=` (: ${se.toFixed(1)}/20)`}return r.jsxs("div",{style:{marginBottom:"8px",padding:"8px",background:"rgba(255,255,255,0.05)",borderRadius:"6px"},children:[r.jsxs("div",{style:{fontWeight:"bold",color:"#64ffda",marginBottom:"4px"},children:[O.name," (",H,"/100)"]}),r.jsx("div",{style:{opacity:.85,fontSize:"11px"},children:F}),O.trainable&&r.jsxs("div",{style:{opacity:.7,fontSize:"10px",marginTop:"4px",color:"#4CAF50"},children:[" ",O.howToIncrease]})]},$)}),r.jsx("div",{style:{marginTop:"12px",paddingTop:"12px",borderTop:"1px dashed rgba(255,255,255,0.2)",opacity:.75,fontSize:"11px"},children:r.jsxs("div",{style:{marginBottom:"4px"},children:["  ",e.stats.aptitude," ",e.stats.luck," ",e.stats.lifespan]})})]})})]}),r.jsxs("div",{style:we.section,children:[r.jsx("h4",{children:" "}),r.jsxs("div",{style:we.resourcesGrid,children:[r.jsxs("div",{style:we.resourceItem,children:[r.jsx("span",{children:":"})," ",r.jsx("span",{style:{fontWeight:"bold"},children:e.resources.spiritStones})]}),r.jsxs("div",{style:we.resourceItem,children:[r.jsx("span",{children:":"}),r.jsx("span",{style:{fontWeight:"bold",color:"#FF9800"},children:e.skillPoints||0})]})]}),(e.skillPoints||0)>0&&r.jsxs("div",{style:{marginTop:"10px",padding:"10px",background:"#FFF3E0",borderRadius:"8px",border:"1px solid #FFB74D"},children:[r.jsxs("div",{style:{fontSize:"12px",color:"#E65100",marginBottom:"8px"},children:[" : ",e.skillPoints]}),r.jsxs("div",{style:{display:"flex",gap:"8px"},children:[r.jsx("button",{onClick:()=>s&&s("aptitude"),style:{...we.allocateBtn,background:"#9C27B0"},children:"+"}),r.jsx("button",{onClick:()=>s&&s("combatPower"),style:{...we.allocateBtn,background:"#F44336"},children:"+"}),r.jsx("button",{onClick:()=>s&&s("breakthrough"),style:{...we.allocateBtn,background:"#FF9800"},children:"+"})]})]}),e.breakthroughBonus>0&&r.jsx("div",{style:{marginTop:"10px",padding:"8px",background:"rgba(255,152,0,0.1)",borderRadius:"8px",border:"1px solid #FF9800"},children:r.jsxs("div",{style:{fontSize:"12px",color:"#F57C00"},children:[" : +",e.breakthroughBonus,"%",e.breakthroughFailCount>0&&r.jsxs("span",{style:{marginLeft:"8px",opacity:.8},children:["(: ",e.breakthroughFailCount,")"]})]})})]}),r.jsxs("div",{style:we.section,children:[r.jsx("h4",{children:" "}),r.jsx("button",{onClick:n,style:we.inventoryBtn,children:""})]})]})]})]})},we={container:{background:"linear-gradient(135deg, #667eea 0%, #764ba2 100%)",borderRadius:"16px",padding:"20px",color:"white",boxShadow:"0 8px 32px rgba(0,0,0,0.3)",marginBottom:"20px"},title:{margin:"0 0 20px 0",fontSize:"24px",textAlign:"center",textShadow:"2px 2px 4px rgba(0,0,0,0.3)"},content:{display:"flex",flexDirection:"column",gap:"16px"},topSection:{display:"flex",alignItems:"center",gap:"16px",padding:"16px",background:"rgba(255,255,255,0.1)",borderRadius:"12px",backdropFilter:"blur(10px)"},mainSection:{display:"flex",flexDirection:"column",gap:"15px"},avatarContainer:{background:"rgba(255,255,255,0.15)",borderRadius:"50%",padding:"8px",boxShadow:"0 4px 12px rgba(0,0,0,0.3)",flexShrink:0},basicInfo:{flex:1,display:"flex",flexDirection:"column",gap:"6px"},playerName:{margin:0,fontSize:"20px",fontWeight:"bold"},tierBadge:{background:"rgba(255,255,255,0.25)",padding:"4px 12px",borderRadius:"16px",fontSize:"13px",display:"inline-block",border:"1px solid rgba(255,255,255,0.3)",fontWeight:"600"},ageText:{fontSize:"14px",opacity:.9},section:{background:"rgba(255,255,255,0.1)",borderRadius:"12px",padding:"15px",backdropFilter:"blur(10px)"},barContainer:{marginBottom:"10px"},barBg:{background:"rgba(0,0,0,0.3)",borderRadius:"10px",height:"20px",marginTop:"5px",overflow:"hidden",position:"relative"},barFill:{height:"100%",borderRadius:"10px",transition:"width 0.5s ease",position:"relative",overflow:"hidden"},speedInfo:{marginTop:"10px",padding:"10px",background:"rgba(255,255,255,0.1)",borderRadius:"8px",fontSize:"12px"},speedHeader:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"8px"},statsGrid:{display:"grid",gridTemplateColumns:"1fr",gap:"12px"},statItem:{display:"grid",gridTemplateColumns:"60px 40px 1fr",gap:"8px",alignItems:"center"},statLabel:{fontSize:"14px"},statValue:{fontWeight:"bold",fontSize:"14px"},statBar:{background:"rgba(0,0,0,0.3)",borderRadius:"10px",height:"16px",overflow:"hidden"},statBarFill:{height:"100%",borderRadius:"10px",transition:"width 0.5s ease"},resourcesGrid:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"10px"},resourceItem:{display:"flex",justifyContent:"space-between",padding:"8px",background:"rgba(255,255,255,0.1)",borderRadius:"8px"},allocateBtn:{flex:1,padding:"8px 16px",border:"none",borderRadius:"8px",color:"white",fontWeight:"bold",cursor:"pointer",fontSize:"14px",transition:"transform 0.2s, box-shadow 0.2s",boxShadow:"0 2px 8px rgba(0,0,0,0.2)"},inventoryBtn:{width:"100%",padding:"10px",background:"rgba(255,255,255,0.2)",border:"1px solid rgba(255,255,255,0.3)",borderRadius:"8px",color:"white",cursor:"pointer",fontWeight:"bold",transition:"all 0.3s"},speedFormula:{fontSize:"12px"},speedBreakdown:{display:"flex",flexWrap:"wrap",gap:"8px",marginTop:"6px",marginBottom:"4px"},speedItem:{fontSize:"11px",padding:"2px 6px",backgroundColor:"rgba(255,255,255,0.1)",borderRadius:"3px",border:"1px solid rgba(255,255,255,0.2)"},detailsBtn:{padding:"8px 16px",borderRadius:"8px",border:"1px solid rgba(255,255,255,0.3)",background:"rgba(100,255,218,0.1)",color:"#64ffda",cursor:"pointer",fontSize:"13px",fontWeight:"500",transition:"all 0.3s ease",hover:{background:"rgba(100,255,218,0.2)"}},resourceStatsBox:{background:"linear-gradient(135deg, rgba(76,175,80,0.15) 0%, rgba(129,199,132,0.1) 100%)",borderRadius:"12px",padding:"15px",marginBottom:"15px",border:"1px solid rgba(255,255,255,0.2)",backdropFilter:"blur(10px)"},resourceRow:{display:"flex",gap:"15px",marginBottom:"12px"},resourceStatItem:{flex:1,display:"flex",alignItems:"center",padding:"10px",background:"rgba(255,255,255,0.1)",borderRadius:"8px"},resourceInfo:{display:"flex",flexDirection:"column",gap:"2px"},resourceLabel:{fontSize:"11px",color:"rgba(255,255,255,0.7)",fontWeight:"500"},resourceIcon:{fontSize:"24px",marginRight:"8px"},expSection:{marginTop:"8px"},expLabel:{fontSize:"12px",color:"rgba(255,255,255,0.8)",marginBottom:"6px",fontWeight:"500"},expBarWrapper:{position:"relative",height:"24px",backgroundColor:"rgba(0,0,0,0.3)",borderRadius:"12px",overflow:"hidden",border:"1px solid rgba(255,255,255,0.1)"},expBarFill:{position:"absolute",left:0,top:0,height:"100%",background:"linear-gradient(90deg, #4CAF50, #81C784)",transition:"width 0.3s ease",borderRadius:"12px"},expText:{position:"absolute",left:"50%",top:"50%",transform:"translate(-50%, -50%)",fontSize:"11px",fontWeight:"bold",color:"#fff",textShadow:"1px 1px 2px rgba(0,0,0,0.5)",zIndex:1},manualCard:{background:"rgba(255,255,255,0.08)",borderRadius:"12px",padding:"12px 14px",border:"1px solid rgba(255,255,255,0.2)",display:"flex",flexDirection:"column",gap:"8px"},manualHeader:{display:"flex",justifyContent:"space-between",alignItems:"center",gap:"16px"},manualName:{fontSize:"18px",fontWeight:"bold",display:"flex",alignItems:"center",gap:"8px"},manualTierBadge:{padding:"2px 8px",borderRadius:"999px",fontSize:"11px",color:"#fff",fontWeight:"bold"},manualElementBadge:{padding:"4px 12px",background:"rgba(255,255,255,0.2)",borderRadius:"999px",fontSize:"12px",fontWeight:"bold"},manualDesc:{fontSize:"13px",color:"rgba(255,255,255,0.85)",lineHeight:1.6},manualMetaRow:{display:"flex",justifyContent:"space-between",fontSize:"13px",color:"rgba(255,255,255,0.9)"},manualPlaceholder:{padding:"10px 14px",borderRadius:"10px",background:"rgba(0,0,0,0.2)",fontSize:"13px",color:"rgba(255,255,255,0.75)"}},CC={common:"#9e9e9e",uncommon:"#4caf50",rare:"#2196f3",epic:"#9c27b0",legendary:"#ff9800"},TC=e=>!e||!Array.isArray(e.usageTargets)||e.usageTargets.length===0||e.resourceCategory==="PILL"?!0:e.usageTargets.includes(yt.NPC),IC=({npc:e,inventory:t=[],onClose:n,onGift:s})=>{const o=t.filter(u=>["consumable","weapon","armor","accessory"].includes(u.type)&&TC(u)),[i,a]=b.useState({}),l=b.useMemo(()=>{const u=Object.entries(i).filter(([,m])=>m>0),p=u.length,c=u.reduce((m,[,v])=>m+v,0);return{totalKinds:p,totalCount:c}},[i]),d={consumable:"",weapon:"",armor:"",accessory:""};return r.jsx("div",{style:Et.overlay,children:r.jsxs("div",{style:Et.modal,children:[r.jsxs("div",{style:Et.header,children:[r.jsxs("h3",{children:["  ",e.name," "]}),r.jsx("button",{onClick:n,style:Et.closeIcon,children:""})]}),r.jsx("p",{style:{fontSize:"12px",color:"#666",marginBottom:"10px",padding:"0 10px"},children:""}),r.jsx("div",{style:Et.itemList,children:o.length===0?r.jsx("div",{style:Et.empty,children:""}):o.map(u=>r.jsxs("div",{style:Et.itemCard,children:[r.jsxs("div",{style:Et.itemHeader,children:[r.jsxs("label",{style:Et.itemSelect,children:[r.jsx("input",{type:"checkbox",checked:!!i[u.instanceId],onChange:p=>{const c=p.target.checked;a(m=>({...m,[u.instanceId]:c?1:0}))}}),r.jsx("span",{children:""})]}),r.jsx("span",{style:{...Et.itemName,color:CC[u.rarity]||"#333"},children:u.name}),r.jsx("span",{style:Et.itemType,children:d[u.type]||u.type})]}),r.jsx("div",{style:Et.itemDesc,children:u.desc}),r.jsxs("div",{style:Et.itemMetaRow,children:[r.jsxs("span",{style:Et.itemStock,children:[": ",u.quantity||1]}),r.jsxs("div",{style:Et.qtyControls,children:[r.jsx("button",{type:"button",onClick:()=>{const p=i[u.instanceId]||0;if(p<=1){a(c=>({...c,[u.instanceId]:0}));return}a(c=>({...c,[u.instanceId]:p-1}))},disabled:!i[u.instanceId],style:Et.qtyBtn,children:"-"}),r.jsx("input",{type:"number",min:"1",max:u.quantity||1,value:i[u.instanceId]||"",onChange:p=>{const c=parseInt(p.target.value,10);if(Number.isNaN(c)){a(v=>({...v,[u.instanceId]:0}));return}const m=Math.max(1,Math.min(u.quantity||1,c));a(v=>({...v,[u.instanceId]:m}))},placeholder:"",style:Et.qtyInput}),r.jsx("button",{type:"button",onClick:()=>{const p=i[u.instanceId]||0,c=u.quantity||1,m=Math.min(c,p>0?p+1:1);a(v=>({...v,[u.instanceId]:m}))},style:Et.qtyBtn,children:"+"})]})]}),u.stats&&r.jsxs("div",{style:Et.itemStats,children:[u.stats.atk&&r.jsxs("span",{children:["+",u.stats.atk]}),u.stats.hp&&r.jsxs("span",{children:["+",u.stats.hp]}),u.stats.def&&r.jsxs("span",{children:["+",u.stats.def]}),u.stats.mp&&r.jsxs("span",{children:["+",u.stats.mp]})]}),u.effect&&r.jsxs("div",{style:Et.itemEffect,children:[u.effect.kind==="heal"&&`${u.effect.amount}`,u.effect.kind==="exp"&&`+${u.effect.amount}`,u.effect.kind==="aptitude"&&`+${u.effect.amount}`]})]},u.instanceId))}),r.jsxs("div",{style:Et.footer,children:[r.jsxs("div",{style:Et.summary,children:[" ",l.totalKinds,"  /  ",l.totalCount," "]}),r.jsxs("div",{style:Et.footerActions,children:[r.jsx("button",{onClick:n,style:Et.closeBtn,children:""}),r.jsx("button",{onClick:()=>{const u=Object.entries(i).filter(([,p])=>p>0).map(([p,c])=>({instanceId:p,quantity:c}));u.length!==0&&s&&s(u)},disabled:l.totalKinds===0,style:{...Et.primaryBtn,opacity:l.totalKinds===0?.5:1,cursor:l.totalKinds===0?"not-allowed":"pointer"},children:""})]})]})]})})},Et={overlay:{position:"fixed",top:0,left:0,right:0,bottom:0,background:"rgba(0,0,0,0.6)",display:"flex",justifyContent:"center",alignItems:"center",zIndex:200},modal:{width:"450px",maxHeight:"80vh",background:"#fff",borderRadius:"12px",padding:"20px",boxShadow:"0 8px 30px rgba(0,0,0,0.3)",display:"flex",flexDirection:"column"},header:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"15px"},closeIcon:{border:"none",background:"transparent",fontSize:"24px",cursor:"pointer",color:"#666",lineHeight:1},itemList:{flex:1,overflowY:"auto",maxHeight:"400px",marginBottom:"15px"},empty:{textAlign:"center",padding:"40px 20px",color:"#999",fontSize:"14px"},itemCard:{padding:"12px",marginBottom:"8px",background:"#fafafa",borderRadius:"8px",cursor:"pointer",border:"1px solid #eee",transition:"all 0.2s",":hover":{background:"#f5f5f5",borderColor:"#8d6e63"}},itemHeader:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"6px"},itemName:{fontWeight:"bold",fontSize:"14px"},itemType:{fontSize:"11px",padding:"2px 8px",background:"#e0e0e0",borderRadius:"10px",color:"#666"},itemDesc:{fontSize:"12px",color:"#666",marginBottom:"6px"},itemStats:{fontSize:"11px",color:"#1976d2",display:"flex",gap:"8px",flexWrap:"wrap"},itemEffect:{fontSize:"11px",color:"#388e3c",marginTop:"4px"},itemSelect:{display:"flex",alignItems:"center",gap:"6px",fontSize:"11px",color:"#666"},itemMetaRow:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"6px"},itemStock:{fontSize:"11px",color:"#999"},qtyControls:{display:"flex",alignItems:"center",gap:"6px"},qtyBtn:{width:"24px",height:"24px",border:"none",borderRadius:"4px",background:"#e0e0e0",cursor:"pointer",fontSize:"14px"},qtyInput:{width:"56px",padding:"4px",textAlign:"center",border:"1px solid #ddd",borderRadius:"4px",fontSize:"12px"},footer:{display:"flex",justifyContent:"space-between",alignItems:"center",gap:"12px"},summary:{fontSize:"12px",color:"#666"},footerActions:{display:"flex",gap:"8px"},closeBtn:{padding:"10px 16px",background:"#e0e0e0",border:"none",borderRadius:"8px",cursor:"pointer",fontSize:"14px"},primaryBtn:{padding:"10px 16px",background:"#ff9800",border:"none",borderRadius:"8px",color:"#fff",fontSize:"14px"}},_C=[{id:"EMOTION",label:"",desc:"",strongAgainst:["",""],weakAgainst:["",""]},{id:"PROFIT",label:"",desc:"",strongAgainst:["",""],weakAgainst:["",""]},{id:"REASON",label:"",desc:"",strongAgainst:["",""],weakAgainst:["",""]}],RC=({npc:e,onClose:t,onNegotiate:n})=>{var s;return r.jsx("div",{style:Fi.overlay,children:r.jsxs("div",{style:Fi.modal,children:[r.jsx("h3",{children:" "}),r.jsxs("p",{style:{color:"#555",fontSize:"14px"},children:[" ",r.jsx("strong",{style:{color:"#d81b60"},children:(s=e.personality)==null?void 0:s.label}),"  ",e.name,"",r.jsx("br",{}),""]}),r.jsx("div",{style:Fi.list,children:_C.map(o=>r.jsxs("button",{onClick:()=>n(o),style:Fi.btn,children:[r.jsx("div",{style:{fontWeight:"bold"},children:o.label}),r.jsx("small",{style:{color:"#666"},children:o.desc})]},o.id))}),r.jsx("button",{onClick:t,style:Fi.cancel,children:""})]})})},Fi={overlay:{position:"fixed",top:0,left:0,right:0,bottom:0,background:"rgba(0,0,0,0.7)",display:"flex",justifyContent:"center",alignItems:"center",zIndex:200},modal:{width:"300px",background:"#fff8e1",borderRadius:"12px",padding:"20px",border:"2px solid #8d6e63"},list:{display:"flex",flexDirection:"column",gap:"10px",margin:"20px 0"},btn:{padding:"15px",background:"#fff",border:"1px solid #d7ccc8",borderRadius:"8px",cursor:"pointer",textAlign:"left",":hover":{background:"#efebe9"}},cancel:{width:"100%",padding:"10px",background:"transparent",border:"none",color:"#888",cursor:"pointer"}},MC=({items:e,playerSpiritStones:t,onPurchase:n,onClose:s})=>{const[o,i]=b.useState({}),[a,l]=b.useState(null),d=(p,c)=>{const m=p.price*c;if(t<m){l(` ${p.name} x${c}  ${m}  ${t} `),setTimeout(()=>l(null),3e3);return}n(p,c,m),l(` ${p.name} x${c} ${m} `),setTimeout(()=>l(null),2e3)},u={common:"#9e9e9e",uncommon:"#4caf50",rare:"#2196f3",epic:"#9c27b0",legendary:"#ff9800"};return r.jsx("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0,0,0,0.5)",display:"flex",justifyContent:"center",alignItems:"center",zIndex:1e3},children:r.jsxs("div",{style:{backgroundColor:"#fff",padding:"25px",borderRadius:"16px",maxWidth:"600px",maxHeight:"80vh",width:"90%",boxShadow:"0 8px 30px rgba(0,0,0,0.3)",border:"2px solid #8d6e63",display:"flex",flexDirection:"column"},children:[r.jsx("h2",{style:{marginTop:0,color:"#5d4037",textAlign:"center",marginBottom:"10px"},children:" "}),r.jsx("p",{style:{color:"#666",textAlign:"center",fontSize:"13px",marginBottom:"15px"},children:""}),r.jsx("div",{style:{flex:1,overflowY:"auto",marginBottom:"15px"},children:e.length===0?r.jsx("div",{style:{textAlign:"center",padding:"40px",color:"#999"},children:""}):r.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"10px"},children:e.map(p=>{const c=o[p.instanceId]||1,m=p.price*c,v=t>=m;return r.jsxs("div",{style:{padding:"12px",border:`2px solid ${u[p.rarity]||"#ddd"}`,borderRadius:"10px",backgroundColor:v?"#fafafa":"#f5f5f5",opacity:v?1:.6,transition:"all 0.2s"},children:[r.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"6px"},children:[r.jsx("span",{style:{fontSize:"15px",fontWeight:"bold",color:u[p.rarity]},children:p.name}),r.jsxs("span",{style:{fontSize:"14px",color:"#f57c00",fontWeight:"bold"},children:[" ",p.price," "]})]}),r.jsx("div",{style:{fontSize:"12px",color:"#666",marginBottom:"8px"},children:p.desc}),p.stats&&r.jsxs("div",{style:{fontSize:"11px",color:"#1976d2",display:"flex",gap:"8px",flexWrap:"wrap",marginBottom:"8px"},children:[p.stats.atk&&r.jsxs("span",{children:["+",p.stats.atk]}),p.stats.hp&&r.jsxs("span",{children:["+",p.stats.hp]}),p.stats.def&&r.jsxs("span",{children:["+",p.stats.def]}),p.stats.mp&&r.jsxs("span",{children:["+",p.stats.mp]})]}),p.effect&&r.jsxs("div",{style:{fontSize:"11px",color:"#388e3c",marginBottom:"8px"},children:[p.effect.kind==="heal"&&`${p.effect.amount}`,p.effect.kind==="exp"&&`+${p.effect.amount}`,p.effect.kind==="aptitude"&&`+${p.effect.amount}`]}),r.jsxs("div",{style:{display:"flex",gap:"8px",alignItems:"center",marginBottom:"8px"},children:[r.jsxs("div",{style:{display:"flex",alignItems:"center",gap:6},children:[r.jsx("label",{style:{fontSize:12,color:"#555"},children:""}),r.jsx("input",{type:"number",min:1,value:c,onChange:w=>{const E=Math.max(1,parseInt(w.target.value||"1",10));i(S=>({...S,[p.instanceId]:E}))},style:{width:60,padding:6,borderRadius:6,border:"1px solid #ddd"}})]}),r.jsx("div",{style:{flex:1}})]}),r.jsxs("button",{onClick:()=>d(p,c),disabled:!v,style:{width:"100%",padding:"8px",border:"none",borderRadius:"6px",backgroundColor:v?"#8d6e63":"#ccc",color:"white",cursor:v?"pointer":"not-allowed",fontSize:"13px",fontWeight:"bold"},children:[" x",c,"  ",m,""]})]},p.instanceId)})})}),a&&r.jsx("div",{style:{marginBottom:15,padding:"10px 15px",textAlign:"center",backgroundColor:a.includes("")?"#ffebee":"#e8f5e9",color:a.includes("")?"#c62828":"#2e7d32",fontWeight:"bold",borderRadius:"8px",border:`2px solid ${a.includes("")?"#ef5350":"#66bb6a"}`},children:a}),r.jsxs("div",{style:{marginTop:"10px",padding:"10px",backgroundColor:"#fff3e0",borderRadius:"8px",fontSize:"12px",color:"#666",textAlign:"center"},children:[" "," ",r.jsx("span",{style:{fontWeight:"bold",color:"#f57c00"},children:t})," ",""]}),r.jsx("button",{onClick:s,style:{marginTop:"15px",padding:"10px",border:"1px solid #ccc",borderRadius:"8px",backgroundColor:"white",cursor:"pointer",fontSize:"14px"},children:""})]})})},AC=({result:e,onClose:t})=>{if(b.useEffect(()=>{if(e&&e.autoClose!==!1){const s=setTimeout(t,3e3);return()=>clearTimeout(s)}},[t,e]),!e)return null;const n=()=>{e.autoClose!==!1&&t()};return r.jsx("div",{style:es.overlay,onClick:n,children:r.jsxs("div",{style:es.card,onClick:s=>s.stopPropagation(),children:[r.jsx("div",{style:es.icon,children:e.success?"":""}),r.jsx("h3",{style:{margin:"10px 0"},children:e.title}),r.jsx("div",{style:es.scrollText,children:e.msg}),e.changes&&r.jsx("div",{style:es.changes,children:Object.entries(e.changes).map(([s,o])=>r.jsxs("span",{style:es.badge,children:[s,": ",o>0?"+":"",o]},s))}),e.autoClose===!1?r.jsx("button",{onClick:t,style:es.confirmBtn,children:""}):r.jsx("div",{style:es.tip,children:"[  ]"})]})})},es={overlay:{position:"fixed",top:0,left:0,right:0,bottom:0,background:"rgba(0,0,0,0.5)",display:"flex",justifyContent:"center",alignItems:"center",zIndex:2200,animation:"fadeIn 0.2s",backdropFilter:"blur(2px)"},card:{width:"85%",maxWidth:"500px",background:"#f5f0e8",padding:"25px",borderRadius:"16px",textAlign:"center",boxShadow:"0 8px 30px rgba(0,0,0,0.2)",animation:"fadeIn 0.3s ease-out",maxHeight:"80vh",display:"flex",flexDirection:"column",border:"2px solid #d7ccc8"},scrollText:{maxHeight:"250px",overflowY:"auto",lineHeight:"1.8",color:"#5d4037",textAlign:"left",background:"#faf8f5",padding:"20px",borderRadius:"12px",margin:"15px 0",border:"1px solid #e0e0e0",boxShadow:"0 2px 8px rgba(0,0,0,0.05)",fontFamily:"Microsoft YaHei, SimSun, serif"},confirmBtn:{marginTop:"20px",padding:"12px 25px",background:"linear-gradient(135deg, #8d6e63 0%, #6d4c41 100%)",color:"white",border:"none",borderRadius:"25px",cursor:"pointer",fontSize:"15px",transition:"all 0.3s ease",boxShadow:"0 2px 8px rgba(0,0,0,0.15)",":hover":{background:"linear-gradient(135deg, #6d4c41 0%, #5d4037 100%)",transform:"translateY(-2px)",boxShadow:"0 4px 12px rgba(0,0,0,0.2)"}},icon:{fontSize:"48px",marginBottom:"15px"},changes:{marginTop:"20px",display:"flex",gap:"8px",justifyContent:"center",flexWrap:"wrap"},badge:{background:"linear-gradient(135deg, #f1f8e9 0%, #e8f5e8 100%)",color:"#5d4037",padding:"4px 12px",borderRadius:"15px",fontSize:"13px",border:"1px solid #d7ccc8",boxShadow:"0 2px 4px rgba(0,0,0,0.05)"},tip:{marginTop:"15px",fontSize:"12px",color:"#8d6e63",fontStyle:"italic"}},NC=({message:e,onConfirm:t,onCancel:n,input:s})=>{const[o,i]=b.useState((s==null?void 0:s.defaultValue)??"");return r.jsx("div",{style:yr.overlay,onClick:n,children:r.jsxs("div",{style:yr.card,onClick:a=>a.stopPropagation(),children:[r.jsx("div",{style:yr.icon,children:""}),r.jsx("h3",{style:{margin:"10px 0"},children:""}),r.jsx("div",{style:yr.message,children:e}),s&&r.jsxs("div",{style:yr.inputWrap,children:[s.label&&r.jsx("div",{style:yr.inputLabel,children:s.label}),r.jsx("input",{type:s.type||"text",value:o,min:s.min,max:s.max,step:s.step,placeholder:s.placeholder,onChange:a=>i(a.target.value),style:yr.input})]}),r.jsxs("div",{style:yr.buttons,children:[r.jsx("button",{onClick:n,style:yr.cancelBtn,children:""}),r.jsx("button",{onClick:()=>t(s?o:void 0),style:yr.confirmBtn,children:""})]})]})})},yr={overlay:{position:"fixed",top:0,left:0,right:0,bottom:0,background:"rgba(0, 0, 0, 0.5)",display:"flex",justifyContent:"center",alignItems:"center",zIndex:2200,animation:"fadeIn 0.2s",backdropFilter:"blur(2px)"},card:{width:"85%",maxWidth:"400px",background:"linear-gradient(135deg, #F4EEE6 0%, #EFE6D8 100%)",borderRadius:"12px",padding:"30px",textAlign:"center",boxShadow:"0 20px 60px rgba(0, 0, 0, 0.3)",border:"2px solid #D4AF37"},icon:{fontSize:"48px",marginBottom:"10px"},message:{margin:"20px 0",lineHeight:"1.6",whiteSpace:"pre-wrap"},inputWrap:{marginTop:"10px"},inputLabel:{fontSize:"12px",color:"#555",marginBottom:"6px"},input:{width:"100%",padding:"8px 10px",border:"1px solid #ccc",borderRadius:"6px",fontSize:"14px"},buttons:{display:"flex",gap:"15px",justifyContent:"center",marginTop:"20px"},cancelBtn:{padding:"10px 20px",background:"#666",color:"white",border:"none",borderRadius:"8px",cursor:"pointer",fontSize:"16px"},confirmBtn:{padding:"10px 20px",background:"#4CAF50",color:"white",border:"none",borderRadius:"8px",cursor:"pointer",fontSize:"16px"}},LC=({event:e,npc:t,onClose:n,onOptionSelect:s})=>{const o=l=>{try{s((t==null?void 0:t.id)||null,l)}catch(d){console.error("EventModal option select error",d)}},i=(e==null?void 0:e.title)||(t?`${t.name} - `:""),a=(e==null?void 0:e.text)||(e==null?void 0:e.desc)||(e==null?void 0:e.description)||"";return r.jsx("div",{style:Lr.overlay,children:r.jsxs("div",{style:Lr.modalWrapper,children:[r.jsx("button",{onClick:n,style:Lr.closeBtn,"aria-label":"",children:""}),r.jsxs("div",{style:Lr.modal,children:[r.jsx("h2",{style:Lr.title,children:i}),r.jsxs("div",{style:Lr.content,children:[r.jsx("p",{style:Lr.eventText,children:a}),r.jsx("div",{style:Lr.options,children:((e==null?void 0:e.options)||[]).map((l,d)=>r.jsx("button",{style:Lr.optionBtn,onClick:()=>o(l),children:l.label},d))})]})]})]})})},Lr={overlay:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0, 0, 0, 0.5)",display:"flex",justifyContent:"center",alignItems:"center",zIndex:1e3,backdropFilter:"blur(2px)"},modalWrapper:{position:"relative",width:"min(600px, calc(100vw - 32px))"},modal:{width:"90%",maxWidth:"600px",backgroundColor:"#f5f0e8",borderRadius:"16px",padding:"25px",position:"relative",boxShadow:"0 8px 30px rgba(0, 0, 0, 0.2)",border:"2px solid #d7ccc8",animation:"fadeIn 0.3s ease-out"},closeBtn:{position:"absolute",top:"-18px",left:"-18px",border:"none",background:"#fff",fontSize:"22px",cursor:"pointer",color:"#8d6e63",width:"42px",height:"42px",borderRadius:"50%",display:"flex",alignItems:"center",justifyContent:"center",boxShadow:"0 10px 24px rgba(0,0,0,0.2)"},title:{fontSize:"20px",marginBottom:"25px",color:"#5d4037",textAlign:"center",fontWeight:"bold",paddingBottom:"15px",borderBottom:"2px solid #d7ccc8",fontFamily:"Microsoft YaHei, SimSun, serif"},content:{maxHeight:"70vh",overflowY:"auto",paddingRight:"10px"},eventText:{fontSize:"16px",lineHeight:"1.8",marginBottom:"35px",color:"#5d4037",padding:"20px",background:"#faf8f5",borderRadius:"12px",border:"1px solid #e0e0e0",boxShadow:"0 2px 8px rgba(0, 0, 0, 0.05)",fontFamily:"Microsoft YaHei, SimSun, serif"},options:{display:"flex",flexDirection:"column",gap:"12px"},optionBtn:{padding:"18px",border:"2px solid #d7ccc8",borderRadius:"12px",background:"linear-gradient(135deg, #ffffff 0%, #f5f0e8 100%)",cursor:"pointer",textAlign:"left",transition:"all 0.3s ease",fontSize:"15px",color:"#5d4037",boxShadow:"0 2px 8px rgba(0, 0, 0, 0.05)",":hover":{background:"linear-gradient(135deg, #f5f0e8 0%, #e8e0d8 100%)",transform:"translateY(-2px)",boxShadow:"0 4px 12px rgba(0, 0, 0, 0.1)",borderColor:"#bcaaa4"},":active":{transform:"translateY(0)",boxShadow:"0 2px 6px rgba(0, 0, 0, 0.05)"}}},Jg=e=>Math.max(0,Math.min(100,Number(e)||0)),$C=({event:e,player:t,onClose:n,onOptionSelect:s})=>{const[o,i]=b.useState(null),a=d=>{i(d),setTimeout(()=>{s(d),n()},300)},l=()=>e.participants.map((d,u)=>{var w,E;const p=((w=d.relationship)==null?void 0:w.jealousy)||0,c=((E=d.relationship)==null?void 0:E.affection)||0,m=Jg(c),v=Jg(p);return r.jsxs("div",{style:nt.npcCard,children:[r.jsxs("div",{style:nt.npcHeader,children:[r.jsx("span",{style:nt.npcName,children:d.name}),r.jsx("span",{style:nt.npcRealm,children:d.tierTitle||""})]}),r.jsxs("div",{style:nt.npcStats,children:[r.jsxs("div",{style:nt.statBar,children:[r.jsx("span",{style:nt.statLabel,children:""}),r.jsx("div",{style:nt.barContainer,children:r.jsx("div",{style:{...nt.barFill,width:`${m}%`,background:"#ff6b9d"}})}),r.jsx("span",{style:nt.statValue,children:m})]}),r.jsxs("div",{style:nt.statBar,children:[r.jsx("span",{style:nt.statLabel,children:""}),r.jsx("div",{style:nt.barContainer,children:r.jsx("div",{style:{...nt.barFill,width:`${v}%`,background:v>=80?"#d32f2f":v>=60?"#f44336":"#ff9800"}})}),r.jsx("span",{style:nt.statValue,children:v})]})]})]},d.id)});return r.jsx("div",{style:nt.overlay,children:r.jsxs("div",{style:nt.modalWrapper,children:[r.jsx("button",{onClick:n,style:nt.closeBtn,"aria-label":"",children:""}),r.jsxs("div",{style:nt.modal,children:[r.jsxs("h2",{style:nt.title,children:[r.jsx("span",{style:nt.titleIcon,children:""}),"",r.jsx("span",{style:nt.titleIcon,children:""})]}),r.jsxs("div",{style:nt.content,children:[r.jsx("div",{style:nt.sceneDescription,children:r.jsx("p",{style:nt.mainText,children:e.description})}),r.jsxs("div",{style:nt.participants,children:[r.jsx("h3",{style:nt.sectionTitle,children:""}),r.jsx("div",{style:nt.npcList,children:l()})]}),e.dialogues&&e.dialogues.length>0&&r.jsx("div",{style:nt.dialogues,children:e.dialogues.map((d,u)=>r.jsxs("div",{style:nt.dialogueItem,children:[r.jsxs("span",{style:nt.dialogueSpeaker,children:[d.speaker,""]}),r.jsxs("span",{style:nt.dialogueText,children:['"',d.text,'"']})]},u))}),r.jsx("div",{style:nt.options,children:e.options.map((d,u)=>r.jsxs("button",{style:{...nt.optionBtn,...o===d?nt.optionBtnSelected:{}},onClick:()=>a(d),children:[r.jsx("div",{style:nt.optionLabel,children:d.label}),d.hint&&r.jsx("div",{style:nt.optionHint,children:d.hint})]},u))})]})]})]})})},nt={overlay:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0, 0, 0, 0.7)",display:"flex",justifyContent:"center",alignItems:"center",zIndex:1100,backdropFilter:"blur(3px)",animation:"fadeIn 0.3s ease-out"},modalWrapper:{position:"relative",width:"min(700px, calc(100vw - 32px))"},modal:{width:"90%",maxWidth:"700px",maxHeight:"90vh",backgroundColor:"#fff5f5",borderRadius:"20px",padding:"30px",position:"relative",boxShadow:"0 10px 40px rgba(211, 47, 47, 0.3)",border:"3px solid #ffcdd2",overflowY:"auto",animation:"slideIn 0.4s ease-out"},closeBtn:{position:"absolute",top:"-20px",left:"-20px",border:"none",background:"#fff5f5",fontSize:"26px",cursor:"pointer",color:"#d32f2f",width:"48px",height:"48px",borderRadius:"50%",display:"flex",alignItems:"center",justifyContent:"center",boxShadow:"0 12px 30px rgba(211,47,47,0.25)"},title:{fontSize:"28px",marginBottom:"25px",color:"#d32f2f",textAlign:"center",fontWeight:"bold",paddingBottom:"15px",borderBottom:"3px solid #ffcdd2",fontFamily:"Microsoft YaHei, serif",textShadow:"2px 2px 4px rgba(211, 47, 47, 0.2)",display:"flex",alignItems:"center",justifyContent:"center",gap:"15px"},titleIcon:{fontSize:"24px",animation:"pulse 2s infinite"},content:{maxHeight:"calc(90vh - 120px)",overflowY:"auto",paddingRight:"10px"},sceneDescription:{marginBottom:"25px",padding:"20px",background:"linear-gradient(135deg, #fff 0%, #ffebee 100%)",borderRadius:"15px",border:"2px solid #ffcdd2",boxShadow:"0 4px 12px rgba(211, 47, 47, 0.1)"},mainText:{fontSize:"17px",lineHeight:"1.9",color:"#5d4037",margin:0,fontFamily:"Microsoft YaHei, serif",textAlign:"justify"},participants:{marginBottom:"25px"},sectionTitle:{fontSize:"18px",color:"#d32f2f",marginBottom:"15px",fontWeight:"bold",paddingLeft:"10px",borderLeft:"4px solid #d32f2f"},npcList:{display:"flex",flexDirection:"column",gap:"12px"},npcCard:{padding:"15px",background:"#fff",borderRadius:"12px",border:"2px solid #ffcdd2",boxShadow:"0 2px 8px rgba(211, 47, 47, 0.1)"},npcHeader:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"10px"},npcName:{fontSize:"16px",fontWeight:"bold",color:"#d32f2f"},npcRealm:{fontSize:"13px",color:"#666",background:"#f5f5f5",padding:"4px 10px",borderRadius:"8px"},npcStats:{display:"flex",flexDirection:"column",gap:"8px"},statBar:{display:"flex",alignItems:"center",gap:"10px"},statLabel:{fontSize:"13px",color:"#666",minWidth:"40px"},barContainer:{flex:1,height:"8px",background:"#e0e0e0",borderRadius:"4px",overflow:"hidden"},barFill:{height:"100%",transition:"width 0.5s ease"},statValue:{fontSize:"13px",color:"#666",minWidth:"30px",textAlign:"right"},dialogues:{marginBottom:"25px",padding:"20px",background:"#fafafa",borderRadius:"12px",border:"1px solid #e0e0e0"},dialogueItem:{marginBottom:"12px",fontSize:"15px",lineHeight:"1.8",color:"#5d4037"},dialogueSpeaker:{fontWeight:"bold",color:"#d32f2f"},dialogueText:{color:"#5d4037",fontStyle:"italic"},options:{display:"flex",flexDirection:"column",gap:"12px",marginTop:"20px"},optionBtn:{padding:"18px 20px",border:"2px solid #ffcdd2",borderRadius:"12px",background:"linear-gradient(135deg, #ffffff 0%, #fff5f5 100%)",cursor:"pointer",textAlign:"left",transition:"all 0.3s ease",fontSize:"15px",color:"#5d4037",boxShadow:"0 2px 8px rgba(211, 47, 47, 0.1)"},optionBtnSelected:{background:"linear-gradient(135deg, #ffebee 0%, #ffcdd2 100%)",borderColor:"#d32f2f",transform:"translateY(-2px)",boxShadow:"0 4px 12px rgba(211, 47, 47, 0.2)"},optionLabel:{fontSize:"15px",fontWeight:"bold",marginBottom:"5px"},optionHint:{fontSize:"13px",color:"#999",marginTop:"5px"}},BC=(e="")=>{switch(e){case"":return"#c62828";case"":return"#ef6c00";case"":return"#fb8c00";case"":return"#fdd835";default:return"#8d6e63"}},OC=({event:e,onClose:t})=>{if(!e)return null;const{alerts:n=[],summary:s,actionLabel:o,timestamp:i={},targetName:a}=e,l=`${i.year||"???"}${i.month||"??"}  ${o||""}`;return r.jsx("div",{style:Zt.overlay,children:r.jsxs("div",{style:Zt.modal,children:[r.jsx("button",{type:"button","aria-label":"",onClick:t,style:Zt.closeBtn,children:""}),r.jsx("h2",{style:Zt.title,children:" "}),r.jsx("p",{style:Zt.subtitle,children:l}),r.jsx("div",{style:Zt.summaryBox,children:r.jsx("p",{style:Zt.summaryText,children:s})}),r.jsx("div",{style:Zt.alertList,children:n.map(d=>r.jsxs("div",{style:Zt.alertCard,children:[r.jsxs("div",{style:Zt.alertHeader,children:[r.jsxs("div",{style:Zt.alertNameRow,children:[r.jsx("span",{style:Zt.alertName,children:d.witnessName}),r.jsx("span",{style:{...Zt.levelBadge,backgroundColor:BC(d.level)},children:d.level})]}),r.jsxs("span",{style:Zt.targetTip,children:["",d.targetName||a]})]}),r.jsxs("div",{style:Zt.alertMeta,children:["",o]}),r.jsxs("div",{style:Zt.alertMeta,children:["+",d.increase,"  ",d.newJealousy]})]},`${d.witnessName}-${d.targetName}-${d.newJealousy}`))}),r.jsx("button",{type:"button",onClick:t,style:Zt.primaryBtn,children:""})]})})},Zt={overlay:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0,0,0,0.65)",display:"flex",justifyContent:"center",alignItems:"center",zIndex:2300,padding:"16px"},modal:{width:"min(640px, 100%)",background:"#fffdf7",borderRadius:"18px",padding:"28px 26px 32px",position:"relative",boxShadow:"0 18px 40px rgba(93,64,55,0.3)",border:"2px solid #ffe0b2",maxHeight:"92vh",overflowY:"auto"},closeBtn:{position:"absolute",top:"14px",right:"14px",border:"none",background:"transparent",fontSize:"26px",cursor:"pointer",color:"#8d6e63"},title:{margin:0,fontSize:"26px",color:"#c62828",textAlign:"center"},subtitle:{textAlign:"center",margin:"6px 0 18px",color:"#795548",fontSize:"14px"},summaryBox:{background:"#fff8e1",borderRadius:"12px",border:"1px solid #ffe0b2",padding:"16px",marginBottom:"18px"},summaryText:{margin:0,fontSize:"15px",lineHeight:1.7,color:"#5d4037",whiteSpace:"pre-line"},alertList:{display:"flex",flexDirection:"column",gap:"12px",marginBottom:"24px"},alertCard:{border:"1px solid #ffe0b2",borderRadius:"12px",padding:"14px 16px",background:"#fff"},alertHeader:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"8px"},alertNameRow:{display:"flex",alignItems:"center",gap:"8px"},alertName:{fontWeight:"bold",fontSize:"16px",color:"#5d4037"},levelBadge:{padding:"2px 10px",borderRadius:"999px",color:"#fff",fontSize:"12px"},targetTip:{fontSize:"13px",color:"#8d6e63"},alertMeta:{fontSize:"14px",color:"#6d4c41"},primaryBtn:{width:"100%",padding:"12px",borderRadius:"10px",border:"none",background:"linear-gradient(120deg, #ffb300, #ff7043)",color:"#fff",fontSize:"16px",fontWeight:"bold",cursor:"pointer"}},PC=["","","","","",""],Xg={COMMON:"",UNCOMMON:"",RARE:"",EPIC:"",LEGENDARY:"",MYTHIC:"",UNIQUE:"",SPECIAL:""},zC=e=>{var n;if(!e)return"";const t=e.toString().trim().toUpperCase();return(n=Q[t])!=null&&n.label?Q[t].label:Xg[t]?Xg[t]:/^[A-Z]+$/.test(t)?"":e},Zg=(e=[])=>{const t={};return e.forEach(n=>{n!=null&&n.id&&(t[n.id]=[{bidder:"",amount:Math.max(1,n.basePrice||0),time:Date.now()}])}),t},DC=({auction:e,playerResources:t,onClose:n,onBuy:s,onShowPlot:o,playerSoldAuctionItems:i=[]})=>{if(!e)return null;const a=b.useMemo(()=>e.items||[],[e]),l=()=>typeof window>"u"?!1:window.innerWidth<=768,[d,u]=b.useState(l),[p,c]=b.useState(()=>Zg(a)),[m,v]=b.useState(null),[w,E]=b.useState(a[0]||null),[S,g]=b.useState({}),[h,x]=b.useState(null),[k,_]=b.useState({}),y=b.useRef(p),R=(Y,ue)=>d?ue:Y;b.useEffect(()=>{y.current=p},[p]),b.useEffect(()=>{if(typeof window>"u")return;const Y=()=>u(l());return window.addEventListener("resize",Y),()=>window.removeEventListener("resize",Y)},[]),b.useEffect(()=>{const Y=Zg(a);c(Y),y.current=Y,v(null),E(a[0]||null),g({}),x(null),_({})},[a]);const C=Y=>{Y&&x({...Y,id:Date.now()})},I=Y=>y.current[Y]||[],T=Y=>{const ue=I(Y);return ue.length===0?0:ue[ue.length-1].amount},L=Y=>{const ue=I(Y);return ue.length===0?null:ue[ue.length-1].bidder},ee=(Y,ue,ne)=>{c(ce=>{const ae=ce[Y]?[...ce[Y]]:[];ae.push({bidder:ue,amount:ne,time:Date.now()});const je={...ce,[Y]:ae};return y.current=je,je})},$=(Y,ue)=>{c(ne=>{const ce=[...ne[Y]||[]];for(let je=ce.length-1;je>=0;je-=1)if(ce[je].bidder===""&&(!ue||ce[je].amount===ue)){ce.splice(je,1);break}const ae={...ne,[Y]:ce};return y.current=ae,ae})},O=Y=>Math.max(1,Math.floor(((Y==null?void 0:Y.basePrice)||0)*.05)),H=Y=>Math.max(1,Math.floor((Y==null?void 0:Y.basePrice)||0))*2,F=(Y,ue)=>{_(ne=>({...ne,[Y]:{enabled:!1,ceiling:"",...ne[Y]||{},...ue}}))},se=Y=>{const ue=k[Y.id];if(!(ue!=null&&ue.enabled))return;const ne=Number(ue.ceiling)||0,ce=T(Y.id);if(L(Y.id)===""||ne<=0||ce>=ne)return;const je=Math.min(ne,ce+O(Y));if(((t==null?void 0:t.spiritStones)||0)<je){C({type:"error",title:"",message:`${Y.name} `}),F(Y.id,{enabled:!1});return}ee(Y.id,"",je)},J=Y=>{for(let ue=0;ue<2;ue+=1)PC.forEach(ne=>{if(Math.random()<.35){const ce=T(Y.id),ae=(Y==null?void 0:Y.basePrice)||0,je=Math.max(1,Math.floor(ae*(.02+Math.random()*.12))||1),X=H(Y),Me=Math.min(ce+je,X);Me>ce&&(ee(Y.id,ne,Me),se(Y))}})},de=(Y,ue,ne)=>{ne!=null&&ne.success?(g(ce=>({...ce,[Y.id]:{status:"won",price:ue,bidder:""}})),F(Y.id,{enabled:!1}),C({type:"success",title:ne.title||"",message:ne.message||`${Y.name} `})):($(Y.id,ue),C({type:"error",title:(ne==null?void 0:ne.title)||"",message:(ne==null?void 0:ne.message)||""}))},Ee=Y=>{const ue=`INSTANCE:${Y.id}`,ne=!!S[Y.id]||i.includes(ue)||i.includes(Y.id);if(!Y||ne)return;const ce=T(Y.id);try{const ae=s(Y,ce);ae&&typeof ae.then=="function"?ae.then(je=>de(Y,ce,je)).catch(()=>{de(Y,ce,{success:!1,title:"",message:""})}):de(Y,ce,ae)}catch{de(Y,ce,{success:!1,title:"",message:""})}},$e=(Y,ue,ne)=>{const ce=`INSTANCE:${Y.id}`,ae=!!S[Y.id]||i.includes(ce)||i.includes(Y.id);if(!Y||ae){C({type:"error",title:"",message:""});return}const je=T(Y.id)+O(Y),X=Math.max(Number(ue)||0,je);if(((t==null?void 0:t.spiritStones)||0)<X){C({type:"error",title:"",message:""});return}ee(Y.id,"",X),ne(""),J(Y),setTimeout(()=>{L(Y.id)===""&&Ee(Y)},60)},De=Y=>{v(Y)},Qe=()=>x(null);return r.jsxs("div",{style:{...Ve.overlay,alignItems:d?"flex-start":"center",padding:d?"12px":"20px"},children:[r.jsx("div",{style:{...Ve.modalWrapper,width:d?"100%":Ve.modalWrapper.width,maxHeight:d?"none":Ve.modalWrapper.maxHeight},children:r.jsxs("div",{style:{...Ve.modalShell,borderRadius:d?16:Ve.modalShell.borderRadius,padding:d?"18px":Ve.modalShell.padding,maxHeight:d?"none":Ve.modalShell.maxHeight},children:[r.jsxs("header",{style:{...Ve.header,paddingTop:d?"40px":"30px"},children:[r.jsx("button",{onClick:n,style:{...Ve.closeBtn,fontSize:R("14px","12px"),padding:R("6px 16px","4px 12px"),position:"absolute",top:d?"12px":"16px",left:d?"12px":"16px"},"aria-label":"",children:""}),r.jsxs("div",{style:{flex:1},children:[r.jsx("h2",{style:{...Ve.title,fontSize:R("24px","18px")},children:e.title}),r.jsx("p",{style:{...Ve.message,fontSize:R("14px","12px")},children:e.message})]}),r.jsx("div",{style:Ve.headerActions,children:r.jsxs("div",{style:{...Ve.resourceChip,fontSize:R("14px","12px"),padding:R("6px 14px","4px 10px")},children:["  ",(t==null?void 0:t.spiritStones)||0]})})]}),r.jsx("div",{style:{...Ve.body,flexDirection:"column",gap:"16px"},children:m?r.jsxs("div",{style:{...Ve.plotCard,padding:R("20px","16px")},children:[r.jsx("h3",{style:{...Ve.plotTitle,fontSize:R("18px","16px")},children:m.name}),r.jsx("div",{style:{...Ve.plotContent,fontSize:R("14px","13px")},children:o(m)}),r.jsx("button",{style:{...Ve.backBtn,fontSize:R("13px","12px"),padding:R("10px","8px")},onClick:()=>v(null),children:""})]}):r.jsx("section",{style:{...Ve.catalogPanel,gridTemplateColumns:d?"1fr":Ve.catalogPanel.gridTemplateColumns,maxHeight:d?"none":Ve.catalogPanel.maxHeight,paddingRight:d?0:Ve.catalogPanel.paddingRight,gap:R(Ve.catalogPanel.gap,"12px")},children:a.map(Y=>{const ue=`INSTANCE:${Y.id}`,ne=!!S[Y.id]||i.includes(ue)||i.includes(Y.id);return r.jsx(FC,{item:Y,bids:I(Y.id),currentHighest:T(Y.id),highestBidder:L(Y.id),onPlayerBid:$e,onShowPlot:()=>De(Y),sold:ne,autoBidConfig:k[Y.id],onAutoBidConfigChange:F,isMobile:d},Y.id)})})})]})}),h&&r.jsx("div",{style:Ve.feedbackOverlay,children:r.jsxs("div",{style:{...Ve.feedbackCard,borderColor:h.type==="success"?"#66bb6a":"#ef5350"},children:[r.jsx("h3",{style:{marginTop:0,color:h.type==="success"?"#1b5e20":"#b71c1c"},children:h.title}),r.jsx("p",{style:{whiteSpace:"pre-wrap",color:"#333"},children:h.message}),r.jsx("button",{style:Ve.feedbackBtn,onClick:Qe,children:""})]})})]})},FC=({item:e,bids:t,currentHighest:n,highestBidder:s,onPlayerBid:o,onShowPlot:i,sold:a,autoBidConfig:l,onAutoBidConfigChange:d,isMobile:u})=>{const[p,c]=b.useState("");b.useEffect(()=>c(""),[e.id]);const m=(y,R)=>u?R:y,v=b.useMemo(()=>zC(e.rarity),[e.rarity]),w=b.useMemo(()=>[{label:"+5%",value:Math.max(1,Math.floor((e.basePrice||0)*.05))},{label:"+10%",value:Math.max(1,Math.floor((e.basePrice||0)*.1))},{label:"+50",value:50}],[e.basePrice]),E=n+Math.max(1,Math.floor((e.basePrice||0)*.05)),S=l||{enabled:!1,ceiling:""},g=y=>{const R=Number(p)||n;c(String(R+y))},h=()=>{o(e,p,c)},x=()=>{d(e.id,{enabled:!S.enabled})},k=y=>{const R=Number(y.replace(/[^0-9]/g,""));d(e.id,{ceiling:Number.isNaN(R)?"":R})},_=t.slice(-3).reverse();return r.jsxs("div",{style:{...Ve.item,borderColor:a?"#66bb6a":"#f5deb3",opacity:a?.6:1,padding:m("14px","12px"),gap:m("8px","6px")},children:[r.jsxs("div",{style:{...Ve.itemHeader,flexDirection:u?"column":"row",gap:u?"4px":"0"},children:[r.jsx("div",{style:{fontWeight:"bold",color:"#4e342e",fontSize:m("14px","13px")},children:e.name}),r.jsxs("div",{style:{color:"#ffb300",fontWeight:"bold",fontSize:m("14px","13px")},children:[n," "]})]}),r.jsx("div",{style:{...Ve.desc,fontSize:m("13px","12px")},children:e.description}),r.jsxs("div",{style:{...Ve.chipRow,gap:m("6px","4px")},children:[r.jsx("span",{style:{...Ve.chip,fontSize:m("11px","10px")},children:v}),r.jsxs("span",{style:{...Ve.chip,fontSize:m("11px","10px")},children:[" ",Math.max(1,Math.floor((e.basePrice||0)*.05))]}),a&&r.jsx("span",{style:{...Ve.chip,background:"#ef5350",color:"#fff",fontSize:m("11px","10px"),fontWeight:"bold"},children:""})]}),r.jsxs("div",{style:{...Ve.bidRow,flexDirection:u?"column":"row",gap:u?"4px":"0"},children:[r.jsxs("div",{style:{...Ve.bidMeta,fontSize:m("12px","11px")},children:["",s||""]}),r.jsxs("div",{style:{...Ve.bidMeta,fontSize:m("12px","11px")},children:["",E]})]}),r.jsxs("div",{style:{...Ve.inputRow,flexDirection:u?"column":"row"},children:[r.jsx("input",{value:p,onChange:y=>c(y.target.value),placeholder:` ${E}`,style:{...Ve.input,fontSize:m("13px","12px"),padding:m("8px","6px")},disabled:!!a}),r.jsx("button",{style:{...Ve.bidBtn,fontSize:m("13px","12px"),padding:m("8px 14px","6px 12px")},onClick:h,disabled:!!a,children:""}),r.jsx("button",{style:{...Ve.plotBtn,fontSize:m("13px","12px"),padding:m("8px 12px","6px 10px")},onClick:i,children:""})]}),r.jsx("div",{style:{...Ve.quickRow,flexWrap:u?"wrap":"nowrap"},children:w.map(y=>r.jsx("button",{style:{...Ve.quickBtn,flex:u?"1 1 30%":"1",fontSize:m("12px","11px")},disabled:!!a,onClick:()=>g(y.value),children:y.label},y.label))}),r.jsxs("div",{style:{...Ve.autoBidRow,flexDirection:u?"column":"row",alignItems:u?"flex-start":"center"},children:[r.jsxs("label",{style:{display:"flex",alignItems:"center",gap:8,fontSize:m("12px","11px")},children:[r.jsx("input",{type:"checkbox",checked:!!S.enabled,onChange:x,disabled:!!a}),r.jsx("span",{children:""})]}),r.jsx("input",{value:S.ceiling,onChange:y=>k(y.target.value),placeholder:"",style:{...Ve.input,width:m("120px","100%"),fontSize:m("13px","12px"),padding:m("8px","6px")},disabled:!S.enabled||a})]}),r.jsx("div",{style:{...Ve.history,fontSize:m("12px","11px")},children:_.map((y,R)=>r.jsxs("div",{style:{...Ve.historyRow,fontSize:m("12px","11px")},children:[r.jsx("span",{children:y.bidder}),r.jsxs("span",{children:[y.amount," "]})]},`${y.bidder}-${R}`))})]})},Ve={overlay:{position:"fixed",inset:0,backgroundColor:"rgba(0,0,0,0.7)",display:"flex",justifyContent:"center",alignItems:"center",zIndex:1200,padding:"20px",overflowY:"auto"},modalWrapper:{position:"relative",width:"min(1080px, 96vw)",maxHeight:"92vh"},modalShell:{position:"relative",background:"linear-gradient(160deg, rgba(29,24,18,0.95), rgba(36,28,22,0.92))",borderRadius:"24px",border:"1px solid rgba(255,255,255,0.08)",boxShadow:"0 25px 80px rgba(0,0,0,0.55)",padding:"24px",color:"#fcefdc",maxHeight:"92vh",overflow:"hidden",display:"flex",flexDirection:"column"},header:{position:"relative",display:"flex",justifyContent:"space-between",gap:"16px",borderBottom:"1px solid rgba(255,255,255,0.08)",paddingBottom:"16px"},headerActions:{display:"flex",alignItems:"center",gap:"12px"},title:{margin:0,fontSize:"24px",letterSpacing:"1px"},message:{margin:"6px 0 0",color:"#f5d7a0"},resourceChip:{background:"rgba(0,0,0,0.35)",padding:"6px 14px",borderRadius:"999px",fontWeight:"bold",border:"1px solid rgba(255,255,255,0.15)"},closeBtn:{border:"1px solid rgba(255,255,255,0.35)",background:"transparent",color:"#fff",borderRadius:"999px",padding:"6px 16px",cursor:"pointer"},body:{marginTop:"20px",overflow:"hidden"},catalogPanel:{flex:1,maxHeight:"60vh",overflowY:"auto",display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(260px, 1fr))",gap:"14px",paddingRight:"6px"},plotCard:{borderRadius:"18px",padding:"20px",background:"rgba(0,0,0,0.35)",border:"1px solid rgba(255,255,255,0.06)",flex:1,display:"flex",flexDirection:"column"},plotTitle:{margin:0,color:"#ffe0b2"},plotContent:{marginTop:"12px",whiteSpace:"pre-wrap",lineHeight:1.6,color:"#f8f0dd",overflowY:"auto"},backBtn:{marginTop:"auto",border:"1px solid rgba(255,255,255,0.4)",borderRadius:"12px",padding:"10px",background:"transparent",color:"#fff",cursor:"pointer"},item:{borderRadius:"16px",border:"1px solid #f5deb3",background:"rgba(255,252,247,0.9)",padding:"14px",display:"flex",flexDirection:"column",gap:"8px"},itemHeader:{display:"flex",justifyContent:"space-between"},desc:{fontSize:"13px",color:"#654321"},chipRow:{display:"flex",gap:"6px",flexWrap:"wrap"},chip:{padding:"2px 10px",borderRadius:"999px",background:"rgba(255,193,7,0.15)",border:"1px solid rgba(255,193,7,0.3)",fontSize:"11px",color:"#a15c00"},bidRow:{display:"flex",justifyContent:"space-between",fontSize:"12px",color:"#775c44"},bidMeta:{fontSize:"12px"},inputRow:{display:"flex",gap:"8px"},input:{flex:1,borderRadius:"10px",border:"1px solid #d7ccc8",padding:"8px"},bidBtn:{padding:"8px 14px",borderRadius:"10px",border:"none",background:"#8d6e63",color:"#fff",cursor:"pointer"},plotBtn:{padding:"8px 12px",borderRadius:"10px",border:"1px solid #d7ccc8",background:"transparent",cursor:"pointer"},quickRow:{display:"flex",gap:"8px"},quickBtn:{flex:1,padding:"6px 0",borderRadius:"8px",border:"1px dashed #c7b8a3",background:"transparent",cursor:"pointer"},autoBidRow:{display:"flex",alignItems:"center",justifyContent:"space-between",gap:"10px"},history:{marginTop:"8px",borderTop:"1px dashed #d7ccc8",paddingTop:"8px"},historyRow:{display:"flex",justifyContent:"space-between",fontSize:"12px"},feedbackOverlay:{position:"fixed",inset:0,background:"rgba(0,0,0,0.55)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1300,padding:"20px"},feedbackCard:{background:"#fffef8",borderRadius:"18px",padding:"24px",maxWidth:"420px",width:"100%",border:"2px solid",boxShadow:"0 18px 45px rgba(0,0,0,0.3)"},feedbackBtn:{marginTop:"16px",width:"100%",padding:"10px 12px",borderRadius:"12px",border:"none",background:"#6d4c41",color:"#fff",cursor:"pointer"}},ju={common:"#9e9e9e",uncommon:"#4caf50",rare:"#2196f3",epic:"#9c27b0",legendary:"#ff9800"},eh=[{id:"ALL",label:"",matcher:()=>!0},{id:"CONSUMABLE",label:"",matcher:e=>e.type==="consumable"},{id:"EQUIPMENT",label:"",matcher:e=>["weapon","armor","accessory"].includes(e.type)},{id:"MANUAL",label:"",matcher:e=>e.type==="manual"},{id:"OTHER",label:"",matcher:e=>!["consumable","manual","weapon","armor","accessory"].includes(e.type)}],HC=({items:e=[],mode:t="VIEW",slot:n=null,childId:s=null,children:o=[],batchUseItems:i=[],onClose:a,onEquip:l,onUse:d,onBatchUse:u,onGiveToChild:p,onBatchGive:c,onSell:m,onDiscard:v,onAutoAssignManual:w,getMarketPrice:E})=>{const[S,g]=b.useState([]),[h,x]=b.useState(!1),[k,_]=b.useState("grid"),[y,R]=b.useState("ALL"),[C,I]=b.useState(!1),[T,L]=b.useState({}),[ee,$]=b.useState(!1),[O,H]=b.useState({}),F=t==="VIEW",se=e.some(z=>z.type==="manual");b.useEffect(()=>{t!=="VIEW"&&y!=="ALL"&&R("ALL")},[t,y]);const J=z=>z.type!=="manual"?null:r.jsxs("div",{style:He.manualInfo,children:[z.tier&&r.jsx("span",{style:{...He.manualBadge,background:z.tierColor||"#999",marginRight:"8px"},children:z.tier}),z.element&&r.jsxs("span",{style:{...He.manualBadge,background:"#e3f2fd",color:"#1976d2",marginRight:"8px"},children:[": ",z.element]}),z.baseBonus&&r.jsxs("span",{style:{...He.manualBadge,background:"#e8f5e9",color:"#2e7d32"},children:[": ",z.baseBonus]})]}),de=t==="SELECT"&&n?e.filter(z=>z.slot===n):t==="MANUAL_SELECT"?e.filter(z=>z.type==="manual"):e,$e=(z=>{if(!F||y==="ALL")return z;const he=eh.find(ye=>ye.id===y);return he?z.filter(he.matcher):z})(de),De={legendary:5,epic:4,rare:3,uncommon:2,common:1},Qe=[...$e].sort((z,he)=>{const ye=De[z.rarity]||0,ke=De[he.rarity]||0;return ke!==ye?ke-ye:(he.name||"")!==(z.name||"")?(z.name||"").localeCompare(he.name||""):(he.quantity||0)-(z.quantity||0)}),Y=z=>!z||!Array.isArray(z.usageTargets)||z.usageTargets.length===0?!0:z.usageTargets.includes(yt.CHILD),ue=z=>Y(z)?z.type==="manual"?{allowed:!1,reason:""}:z.type==="consumable"?{allowed:!0,reason:""}:z.type==="weapon"||z.type==="armor"||z.type==="accessory"?{allowed:!0,reason:""}:{allowed:!1,reason:""}:{allowed:!1,reason:""},ne=z=>{S.includes(z)?g(S.filter(he=>he!==z)):g([...S,z])},ce=()=>{if(S.length===0){window.showResult&&window.showResult("","",!1,null,!1);return}const z=S.filter(ye=>{const ke=e.find(ve=>ve.instanceId===ye);return ke&&ue(ke).allowed});if(z.length===0){window.showResult&&window.showResult("","",!1,null,!1);return}$(!0),x(!1);const he={};z.forEach(ye=>{e.find(ve=>ve.instanceId===ye)&&(he[ye]=1)}),H(he)},ae={consumable:"",weapon:"",armor:"",accessory:"",manual:""},je={consumable:"",weapon:"",armor:"",accessory:"",manual:""},X={weapon:"",armor:"",accessory:""},Me=z=>z.icon||z.emoji||je[z.type]||"",Ae=z=>{if(z.type==="consumable"&&z.effect){const ke=z.effect;if(ke.kind==="exp")return` +${ke.amount}`;if(ke.kind==="aptitude")return` +${ke.amount}`;if(ke.kind==="intelligence")return` +${ke.amount}`;if(ke.kind==="heal")return` +${ke.amount}`}if(z.type==="manual"&&z.manualIds)return` ${z.manualIds.length} `;const he=z.stats||{},ye=[];return he.atk&&ye.push(` +${he.atk}`),he.hp&&ye.push(` +${he.hp}`),he.mp&&ye.push(` +${he.mp}`),ye.join(" / ")},_e=z=>{if(h)return null;const he=[];return t==="SELECT"&&z.slot===n&&he.push(r.jsx("button",{style:He.btnPrimary,onClick:ye=>{ye.stopPropagation(),l&&l(z.instanceId)},children:""},"equip")),t==="MANUAL_SELECT"&&z.type==="manual"&&he.push(r.jsx("button",{style:He.btnPrimary,onClick:ye=>{ye.stopPropagation(),d&&d(z.instanceId)},children:""},"manual")),t==="VIEW"&&z.type==="consumable"&&he.push(r.jsx("button",{style:He.btnPrimary,onClick:ye=>{ye.stopPropagation(),d&&d(z.instanceId)},children:s?"":""},"use")),t==="VIEW"&&z.type==="manual"&&he.push(r.jsx("button",{style:He.btnPrimary,onClick:ye=>{ye.stopPropagation(),d&&d(z.instanceId)},children:s?"":""},"study")),t==="VIEW"&&!s&&he.push(r.jsx("button",{style:{...He.btnSecondary,background:"#e53935"},onClick:ye=>{ye.stopPropagation(),window.showConfirm?window.showConfirm(` ${z.name}${z.quantity&&z.quantity>1?" () ":""}`,()=>{v&&v(z.instanceId)}):v&&v(z.instanceId)},children:""},"discard")),t==="VIEW"&&!s&&o&&o.length>0&&he.push(r.jsx("button",{style:He.btnSecondary,onClick:ye=>{ye.stopPropagation(),p&&p(z.instanceId)},children:""},"give")),t==="SELL"&&he.push(r.jsx("button",{style:{...He.btnPrimary,background:"#f57c00"},onClick:ye=>{if(ye.stopPropagation(),!!m){if(z.quantity&&z.quantity>1&&window.showConfirm){window.showConfirm(`1-${z.quantity}`,ke=>{const ve=parseInt(ke||`${z.quantity}`,10);if(!ve||ve<=0){window.showResult&&window.showResult("","",!1,null,!1);return}m(z.instanceId,Math.min(ve,z.quantity||1))},{input:{type:"number",min:1,max:z.quantity||1,step:1,defaultValue:`${z.quantity}`}});return}m(z.instanceId,1)}},children:""},"sell")),he.length?he:null};return r.jsx("div",{style:He.overlay,children:r.jsxs("div",{style:He.modal,children:[r.jsxs("div",{style:He.header,children:[r.jsx("h3",{style:{margin:0},children:t==="SELECT"?"":""}),r.jsx("button",{style:He.close,onClick:a,children:""})]}),r.jsx("div",{style:He.tip,children:t==="SELECT"&&n?`${X[n]||n}`:t==="MANUAL_SELECT"?"":t==="SELL"?"":""}),r.jsxs("div",{style:He.toolbar,children:[r.jsxs("span",{style:He.toolbarMeta,children:[" ",Qe.length,"   ",k==="grid"?"":""]}),r.jsxs("div",{style:He.viewSwitch,children:[r.jsx("button",{type:"button",style:k==="grid"?{...He.viewBtn,...He.viewBtnActive}:He.viewBtn,onClick:()=>_("grid"),children:" "}),r.jsx("button",{type:"button",style:k==="list"?{...He.viewBtn,...He.viewBtnActive}:He.viewBtn,onClick:()=>_("list"),children:" "})]})]}),F&&r.jsxs("div",{style:He.categoryBar,children:[r.jsx("div",{style:He.categoryGroup,children:eh.map(z=>r.jsx("button",{type:"button",onClick:()=>R(z.id),style:y===z.id?{...He.categoryBtn,...He.categoryBtnActive}:He.categoryBtn,children:z.label},z.id))}),w&&r.jsx("button",{type:"button",onClick:w,disabled:!se||!(o&&o.length),style:{...He.autoAssignBtn,opacity:!se||!(o&&o.length)?.5:1,cursor:!se||!(o&&o.length)?"not-allowed":"pointer"},children:" "})]}),t==="VIEW"&&!s&&r.jsxs("div",{style:{padding:"10px 16px",borderBottom:"1px solid #eee",background:h?"#e3f2fd":"#f5f5f5",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[r.jsx("button",{onClick:()=>{x(!h),g([])},style:{padding:"6px 12px",border:"none",borderRadius:"6px",background:h?"#1976d2":"#757575",color:"#fff",cursor:"pointer",fontSize:"12px"},children:h?" ":" "}),h&&r.jsxs("div",{style:{display:"flex",gap:"8px",alignItems:"center"},children:[r.jsxs("span",{style:{fontSize:"12px",color:"#666"},children:[" ",S.length," "]}),!s&&r.jsx("button",{onClick:()=>{if(S.length===0){window.showResult&&window.showResult("","",!1,null,!1);return}I(!0),x(!1);const z={};S.forEach(he=>{const ye=e.find(ke=>ke.instanceId===he);ye&&ye.type==="consumable"&&(z[he]=1)}),L(z)},disabled:S.length===0,style:{padding:"6px 12px",border:"none",borderRadius:"6px",background:S.length>0?"#4caf50":"#ccc",color:"#fff",cursor:S.length>0?"pointer":"not-allowed",fontSize:"12px"},children:""}),o&&o.length>0&&r.jsx("button",{onClick:ce,disabled:S.length===0,style:{padding:"6px 12px",border:"none",borderRadius:"6px",background:S.length>0?"#7b1fa2":"#ccc",color:"#fff",cursor:S.length>0?"pointer":"not-allowed",fontSize:"12px"},children:""}),t==="SELL"&&r.jsx("button",{onClick:()=>{if(!m)return;if(S.length===0){window.showResult&&window.showResult("","",!1,null,!1);return}const z=S.map(ke=>{const ve=e.find(Ge=>Ge.instanceId===ke);return ve?{instanceId:ke,qty:ve.quantity||1}:null}).filter(Boolean);let he=0;const ye=()=>{if(he>=z.length){g([]),x(!1);return}const{instanceId:ke,qty:ve}=z[he];m(ke,ve),he++,setTimeout(ye,50)};ye()},disabled:S.length===0,style:{padding:"6px 12px",border:"none",borderRadius:"6px",background:S.length>0?"#f57c00":"#ccc",color:"#fff",cursor:S.length>0?"pointer":"not-allowed",fontSize:"12px"},children:""}),o&&o.length>0&&r.jsx("button",{onClick:()=>{const z=$e.filter(he=>ue(he).allowed).map(he=>he.instanceId);g(z)},style:{padding:"6px 12px",border:"none",borderRadius:"6px",background:"#00897b",color:"#fff",cursor:"pointer",fontSize:"12px"},children:""})]})]}),C&&r.jsxs("div",{style:{padding:"16px",background:"#e8f5e9",borderBottom:"1px solid #c8e6c9",borderRadius:"8px",margin:"8px"},children:[r.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"12px"},children:[r.jsx("h4",{style:{margin:0,color:"#2e7d32"},children:" "}),r.jsx("button",{onClick:()=>{I(!1),L({}),g([])},style:{padding:"4px 8px",border:"none",borderRadius:"4px",background:"#757575",color:"#fff",cursor:"pointer",fontSize:"11px"},children:""})]}),r.jsx("div",{style:{maxHeight:"200px",overflowY:"auto",marginBottom:"12px"},children:Object.keys(T).map(z=>{const he=e.find(ve=>ve.instanceId===z);if(!he)return null;const ye=he.quantity||1,ke=T[z]||1;return r.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",padding:"8px",background:"#fff",borderRadius:"6px",marginBottom:"8px",border:"1px solid #c8e6c9"},children:[r.jsxs("span",{style:{fontSize:"13px",flex:1},children:[Me(he)," ",he.name,r.jsxs("span",{style:{color:"#999",marginLeft:"8px"},children:["(: ",ye,")"]})]}),r.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[r.jsx("button",{onClick:()=>{const ve=Math.max(1,ke-1);L(Ge=>({...Ge,[z]:ve}))},disabled:ke<=1,style:{width:"24px",height:"24px",border:"none",borderRadius:"4px",background:ke<=1?"#e0e0e0":"#4caf50",color:"#fff",cursor:ke<=1?"not-allowed":"pointer",fontSize:"16px",lineHeight:"1"},children:"-"}),r.jsx("input",{type:"number",min:"1",max:ye,value:ke,onChange:ve=>{const Ge=parseInt(ve.target.value)||1,on=Math.max(1,Math.min(ye,Ge));L(pt=>({...pt,[z]:on}))},style:{width:"50px",padding:"4px",textAlign:"center",border:"1px solid #c8e6c9",borderRadius:"4px",fontSize:"13px"}}),r.jsx("button",{onClick:()=>{const ve=Math.min(ye,ke+1);L(Ge=>({...Ge,[z]:ve}))},disabled:ke>=ye,style:{width:"24px",height:"24px",border:"none",borderRadius:"4px",background:ke>=ye?"#e0e0e0":"#4caf50",color:"#fff",cursor:ke>=ye?"not-allowed":"pointer",fontSize:"16px",lineHeight:"1"},children:"+"}),r.jsx("button",{onClick:()=>{const ve={...T};delete ve[z],L(ve),g(Ge=>Ge.filter(on=>on!==z))},style:{padding:"4px 8px",border:"none",borderRadius:"4px",background:"#f44336",color:"#fff",cursor:"pointer",fontSize:"11px"},children:""})]})]},z)})}),r.jsx("div",{style:{display:"flex",gap:"8px",justifyContent:"flex-end"},children:r.jsx("button",{onClick:()=>{const z=Object.keys(T).map(he=>({instanceId:he,quantity:T[he]}));if(z.length===0){window.showResult&&window.showResult("","",!1,null,!1);return}u&&u(s||null,z),I(!1),L({}),g([])},style:{padding:"8px 16px",border:"none",borderRadius:"6px",background:"#4caf50",color:"#fff",cursor:"pointer",fontSize:"13px",fontWeight:"bold"},children:" "})})]}),ee&&r.jsxs("div",{style:{padding:"16px",background:"#f3e5f5",borderBottom:"1px solid #e1bee7",borderRadius:"8px",margin:"8px"},children:[r.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"12px"},children:[r.jsx("h4",{style:{margin:0,color:"#7b1fa2"},children:" "}),r.jsx("button",{onClick:()=>{$(!1),H({}),g([])},style:{padding:"4px 8px",border:"none",borderRadius:"4px",background:"#757575",color:"#fff",cursor:"pointer",fontSize:"11px"},children:""})]}),r.jsx("div",{style:{maxHeight:"200px",overflowY:"auto",marginBottom:"12px"},children:Object.keys(O).map(z=>{const he=e.find(ve=>ve.instanceId===z);if(!he)return null;const ye=he.quantity||1,ke=O[z]||1;return r.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",padding:"8px",background:"#fff",borderRadius:"6px",marginBottom:"8px",border:"1px solid #e1bee7"},children:[r.jsxs("span",{style:{fontSize:"13px",flex:1},children:[Me(he)," ",he.name,r.jsxs("span",{style:{color:"#999",marginLeft:"8px"},children:["(: ",ye,")"]})]}),r.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[r.jsx("button",{onClick:()=>{const ve=Math.max(1,ke-1);H(Ge=>({...Ge,[z]:ve}))},disabled:ke<=1,style:{width:"24px",height:"24px",border:"none",borderRadius:"4px",background:ke<=1?"#e0e0e0":"#7b1fa2",color:"#fff",cursor:ke<=1?"not-allowed":"pointer",fontSize:"16px",lineHeight:"1"},children:"-"}),r.jsx("input",{type:"number",min:"1",max:ye,value:ke,onChange:ve=>{const Ge=parseInt(ve.target.value)||1,on=Math.max(1,Math.min(ye,Ge));H(pt=>({...pt,[z]:on}))},style:{width:"50px",padding:"4px",textAlign:"center",border:"1px solid #e1bee7",borderRadius:"4px",fontSize:"13px"}}),r.jsx("button",{onClick:()=>{const ve=Math.min(ye,ke+1);H(Ge=>({...Ge,[z]:ve}))},disabled:ke>=ye,style:{width:"24px",height:"24px",border:"none",borderRadius:"4px",background:ke>=ye?"#e0e0e0":"#7b1fa2",color:"#fff",cursor:ke>=ye?"not-allowed":"pointer",fontSize:"16px",lineHeight:"1"},children:"+"}),r.jsx("button",{onClick:()=>{const ve={...O};delete ve[z],H(ve),g(Ge=>Ge.filter(on=>on!==z))},style:{padding:"4px 8px",border:"none",borderRadius:"4px",background:"#f44336",color:"#fff",cursor:"pointer",fontSize:"11px"},children:""})]})]},z)})}),r.jsx("div",{style:{display:"flex",gap:"8px",justifyContent:"flex-end"},children:r.jsx("button",{onClick:()=>{const z=Object.keys(O).map(ye=>({instanceId:ye,quantity:O[ye]}));if(z.length===0){window.showResult&&window.showResult("","",!1,null,!1);return}const he=z.map(({instanceId:ye,quantity:ke})=>({instanceId:ye,quantity:ke}));c&&c(he),$(!1),H({}),g([])},style:{padding:"8px 16px",border:"none",borderRadius:"6px",background:"#7b1fa2",color:"#fff",cursor:"pointer",fontSize:"13px",fontWeight:"bold"},children:" "})})]}),r.jsxs("div",{style:He.list,children:[Qe.length===0&&r.jsx("div",{style:He.empty,children:""}),Qe.length>0&&r.jsx("div",{style:k==="grid"?He.gridContainer:He.listContainer,children:Qe.map(z=>{const he=S.includes(z.instanceId),ye=ue(z),ke=_e(z),ve=t==="SELL"?Math.floor((E?E(z):z.sellPrice||z.price||0)*.7):null;return k==="grid"?r.jsxs("div",{style:{...He.gridCard,borderColor:he?"#1976d2":"rgba(0,0,0,0.05)",borderWidth:"2px",boxShadow:he?"0 0 0 1px #1976d2":"0 6px 16px rgba(0,0,0,0.08)",cursor:h?"pointer":"default"},onClick:()=>{h&&ne(z.instanceId)},children:[h&&r.jsx("input",{type:"checkbox",checked:he,onChange:Ge=>{Ge.stopPropagation(),ne(z.instanceId)},style:He.gridCheckbox}),r.jsxs("div",{style:He.gridMain,children:[r.jsx("div",{style:{...He.gridIcon,borderColor:ju[z.rarity]||"#d7ccc8",borderWidth:"2px",borderStyle:"solid"},children:r.jsx("span",{children:Me(z)})}),r.jsxs("div",{style:He.gridBody,children:[r.jsxs("div",{style:He.gridTitleRow,children:[r.jsx("span",{style:{color:ju[z.rarity]||"#333",fontWeight:"bold"},children:z.name}),z.quantity&&z.quantity>1&&r.jsxs("span",{style:He.gridQty,children:["x",z.quantity]})]}),r.jsxs("div",{style:He.gridMeta,children:[r.jsx("span",{style:He.gridTag,children:ae[z.type]||z.type}),r.jsx("span",{style:{fontSize:"11px",color:"#5d4037"},children:Ae(z)||""})]}),r.jsx("div",{style:He.gridDesc,children:z.desc}),J(z),ve!==null&&r.jsxs("div",{style:He.gridPrice,children:[": ",ve," "]}),h&&!ye.allowed&&r.jsxs("div",{style:He.gridWarning,children:[" ",ye.reason]})]})]}),ke&&r.jsx("div",{style:He.gridActions,children:ke})]},z.instanceId):r.jsxs("div",{style:{...He.card,borderColor:he?"#1976d2":"#eee",borderWidth:he?"2px":"1px",background:he?"#e3f2fd":"#fafafa",cursor:h?"pointer":"default"},onClick:()=>{h&&ne(z.instanceId)},children:[r.jsxs("div",{style:He.rowBetween,children:[r.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[h&&r.jsx("input",{type:"checkbox",checked:he,onChange:Ge=>{Ge.stopPropagation(),ne(z.instanceId)},style:{cursor:"pointer"}}),r.jsx("span",{style:{color:ju[z.rarity]||"#333",fontWeight:"bold"},children:z.name}),z.quantity&&z.quantity>1&&r.jsxs("span",{style:{fontSize:"12px",color:"#666",marginLeft:"6px"},children:["x",z.quantity]})]}),r.jsx("span",{style:He.tag,children:ae[z.type]||z.type})]}),J(z),r.jsx("div",{style:He.desc,children:z.desc}),r.jsx("div",{style:He.stats,children:Ae(z)||""}),ve!==null&&r.jsxs("div",{style:{fontSize:"12px",color:"#f57c00",marginTop:6},children:[": ",ve," "]}),h&&!ye.allowed&&r.jsxs("div",{style:{fontSize:"11px",color:"#f44336",marginTop:"4px",padding:"4px 8px",background:"rgba(244, 67, 54, 0.1)",borderRadius:"4px"},children:[" ",ye.reason]}),ke&&r.jsx("div",{style:He.actions,children:ke})]},z.instanceId)})})]})]})})},He={overlay:{position:"fixed",inset:0,background:"rgba(0,0,0,0.5)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:2e3},modal:{width:"520px",maxHeight:"80vh",background:"#fff",borderRadius:"12px",boxShadow:"0 10px 25px rgba(0,0,0,0.2)",display:"flex",flexDirection:"column"},header:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"12px 16px",borderBottom:"1px solid #eee"},close:{border:"none",background:"transparent",fontSize:"20px",cursor:"pointer",color:"#888"},tip:{padding:"8px 16px",fontSize:"12px",color:"#666",borderBottom:"1px dashed #eee"},toolbar:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"10px 16px",borderBottom:"1px solid #f0e0d6",background:"#fffbe6"},toolbarMeta:{fontSize:"12px",color:"#8d6e63"},viewSwitch:{display:"flex",gap:"6px"},viewBtn:{fontSize:"12px",padding:"4px 10px",borderRadius:"999px",border:"1px solid #d7ccc8",background:"#fff",cursor:"pointer",color:"#6d4c41"},viewBtnActive:{background:"#6d4c41",color:"#fff",borderColor:"#6d4c41"},categoryBar:{display:"flex",justifyContent:"space-between",alignItems:"center",gap:"12px",padding:"8px 16px",borderBottom:"1px solid #f0f0f0",background:"#fff"},categoryGroup:{display:"flex",flexWrap:"wrap",gap:"8px"},categoryBtn:{fontSize:"12px",padding:"4px 12px",borderRadius:"12px",border:"1px solid #d7ccc8",background:"#fff",color:"#6d4c41",cursor:"pointer",transition:"all 0.2s"},categoryBtnActive:{background:"#6d4c41",color:"#fff",borderColor:"#6d4c41",boxShadow:"0 2px 6px rgba(0,0,0,0.1)"},autoAssignBtn:{fontSize:"12px",padding:"6px 14px",borderRadius:"16px",border:"none",background:"linear-gradient(120deg, #ff9800, #ff5722)",color:"#fff",fontWeight:"bold"},list:{padding:"12px",overflowY:"auto"},listContainer:{display:"flex",flexDirection:"column",gap:"10px"},gridContainer:{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(180px, 1fr))",gap:"12px"},empty:{textAlign:"center",color:"#999",padding:"20px"},card:{borderWidth:"1px",borderStyle:"solid",borderColor:"#eee",borderRadius:"8px",padding:"10px",marginBottom:"10px",background:"#fafafa"},gridCard:{position:"relative",borderRadius:"12px",padding:"14px",background:"#fff",display:"flex",flexDirection:"column",gap:"10px",borderStyle:"solid",borderColor:"rgba(0,0,0,0.05)"},gridMain:{display:"flex",gap:"10px",alignItems:"flex-start"},rowBetween:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"6px"},tag:{fontSize:"10px",padding:"2px 6px",borderRadius:"6px",background:"#e0e0e0",color:"#555",textTransform:"uppercase"},desc:{fontSize:"12px",color:"#555",marginBottom:"6px"},stats:{fontSize:"12px",color:"#333",marginBottom:"8px"},actions:{display:"flex",gap:"8px",flexWrap:"wrap"},gridIcon:{width:"54px",height:"54px",borderRadius:"12px",borderWidth:"2px",borderStyle:"solid",borderColor:"#d7ccc8",display:"flex",alignItems:"center",justifyContent:"center",fontSize:"24px",color:"#4e342e"},gridBody:{display:"flex",flexDirection:"column",gap:"6px"},gridTitleRow:{display:"flex",justifyContent:"space-between",alignItems:"center"},gridQty:{fontSize:"12px",color:"#6d4c41"},gridMeta:{display:"flex",flexDirection:"column",alignItems:"flex-start",gap:"4px"},gridTag:{fontSize:"10px",padding:"2px 6px",borderRadius:"999px",background:"#f3e5f5",color:"#6a1b9a"},gridDesc:{fontSize:"11px",color:"#5d4037",lineHeight:1.4,minHeight:"32px"},gridActions:{display:"flex",flexWrap:"wrap",gap:"6px"},gridCheckbox:{position:"absolute",top:"10px",left:"10px",cursor:"pointer"},gridWarning:{fontSize:"11px",color:"#c62828",background:"rgba(198,40,40,0.08)",padding:"4px 8px",borderRadius:"6px"},gridPrice:{fontSize:"11px",color:"#f57c00",fontWeight:"bold"},btnPrimary:{padding:"6px 12px",border:"none",borderRadius:"6px",background:"#1976d2",color:"#fff",cursor:"pointer"},btnSecondary:{padding:"6px 12px",border:"none",borderRadius:"6px",background:"#7b1fa2",color:"#fff",cursor:"pointer",fontSize:"12px"},manualInfo:{display:"flex",flexWrap:"wrap",gap:"6px",marginTop:"8px",marginBottom:"8px"},manualBadge:{fontSize:"11px",padding:"3px 8px",borderRadius:"12px",color:"#fff",fontWeight:"bold",whiteSpace:"nowrap"}},WC=({child:e,onClose:t,onFinish:n})=>{const[s,o]=b.useState("INIT"),i=()=>{o("ANIMATING"),setTimeout(()=>{o("REVEAL")},2e3)},a=()=>{n(e),t()},l=d=>({:"#FFD700",:"#4CAF50",:"#2196F3",:"#F44336",:"#795548",:"#673AB7",:"#00BCD4",:"#009688"})[d]||"#ccc";return r.jsx("div",{style:br.overlay,children:r.jsxs("div",{style:br.card,children:[r.jsx("h2",{style:{color:"#3e2723"},children:" "}),s==="INIT"&&r.jsxs("div",{style:{textAlign:"center"},children:[r.jsx("h3",{style:{margin:"0 0 15px 0",color:"#3e2723"},children:e.name}),r.jsx("p",{children:""}),r.jsxs("p",{children:["",e.gender===""?"":"",""]}),r.jsx("div",{style:br.childIcon,children:e.gender===""?"":""}),r.jsx("button",{onClick:i,style:br.btn,children:" "})]}),s==="ANIMATING"&&r.jsxs("div",{style:{textAlign:"center"},children:[r.jsx("h3",{style:{margin:"0 0 15px 0",color:"#3e2723"},children:e.name}),r.jsx("div",{style:br.orb}),r.jsx("p",{children:"..."})]}),s==="REVEAL"&&r.jsxs("div",{style:{textAlign:"center",animation:"fadeIn 0.5s"},children:[r.jsx("h3",{style:{margin:"0 0 15px 0",color:"#3e2723"},children:e.name}),r.jsx("h3",{children:"  "}),r.jsxs("div",{style:br.resultBox,children:[r.jsx("div",{style:{color:e.spiritRoot.color,fontSize:"24px",fontWeight:"bold"},children:e.spiritRoot.type}),r.jsx("div",{style:br.elements,children:e.spiritRoot.elements.map(d=>r.jsx("span",{style:{...br.elBadge,background:l(d)},children:d},d))}),r.jsxs("div",{style:{marginTop:"15px"},children:[r.jsx("span",{style:{fontSize:"12px",color:"#666"},children:""}),r.jsxs("div",{style:{fontSize:"40px",fontWeight:"bold",color:"#333"},children:[e.stats.aptitude,r.jsx("span",{style:{fontSize:"14px",color:"#999"},children:"/100"})]})]}),r.jsx("p",{style:{fontSize:"12px",color:"#666",marginTop:"10px"},children:e.spiritRoot.desc})]}),r.jsxs("div",{style:br.stats,children:[r.jsxs("p",{children:[": ",r.jsx("strong",{children:e.stats.aptitude})]}),r.jsxs("p",{children:[": ",r.jsx("strong",{children:e.combatStats.mp})]})]}),r.jsx("button",{onClick:a,style:br.confirmBtn,children:""})]})]})})},br={overlay:{position:"fixed",top:0,left:0,right:0,bottom:0,background:"rgba(0,0,0,0.8)",display:"flex",justifyContent:"center",alignItems:"center",zIndex:400},card:{width:"320px",background:"#fff",borderRadius:"15px",padding:"30px",textAlign:"center",boxShadow:"0 0 20px rgba(255, 215, 0, 0.3)"},btn:{padding:"15px 30px",fontSize:"18px",background:"#3e2723",color:"white",border:"none",borderRadius:"25px",cursor:"pointer",marginTop:"20px"},confirmBtn:{padding:"10px 20px",background:"#4caf50",color:"white",border:"none",borderRadius:"5px",marginTop:"20px",cursor:"pointer"},orb:{width:"80px",height:"80px",borderRadius:"50%",background:"radial-gradient(circle, #fff, #2196f3, #000)",margin:"20px auto",animation:"pulse 1s infinite"},childIcon:{fontSize:"50px",margin:"20px 0"},resultBox:{background:"#f5f5f5",padding:"15px",borderRadius:"10px",margin:"20px 0"},elements:{display:"flex",justifyContent:"center",gap:"5px",marginBottom:"10px"},elBadge:{padding:"4px 8px",borderRadius:"50%",color:"white",fontWeight:"bold",width:"24px",height:"24px",lineHeight:"24px"},stats:{display:"flex",justifyContent:"space-around",fontSize:"14px",borderTop:"1px dashed #ccc",paddingTop:"15px"}},UC=["","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","",""],th=(e="")=>{if(!e)return 0;const t=UC.indexOf(e);return t>=0?t:0},Cu=8,GC=({children:e,item:t,items:n,isBatch:s=!1,onSelect:o,onClose:i})=>{const[a,l]=b.useState(null),[d,u]=b.useState("age"),[p,c]=b.useState(1),m=b.useMemo(()=>{const E=[...e];return E.sort((S,g)=>{var h,x;switch(d){case"age":return S.age-g.age;case"aptitude":return(((h=g.stats)==null?void 0:h.aptitude)||0)-(((x=S.stats)==null?void 0:x.aptitude)||0);case"cultivation":const k=th(S.tier||""),_=th(g.tier||"");if(k!==_)return _-k;const y=S.currentExp||0;return(g.currentExp||0)-y;case"name":return S.name.localeCompare(g.name,"zh-CN");default:return 0}}),E},[e,d]),v=Math.max(1,Math.ceil(m.length/Cu)),w=b.useMemo(()=>{const E=(p-1)*Cu;return m.slice(E,E+Cu)},[m,p]);return $c.useEffect(()=>{c(1)},[d]),r.jsx("div",{style:gt.overlay,children:r.jsxs("div",{style:gt.modal,children:[r.jsxs("div",{style:gt.header,children:[r.jsx("h3",{style:{margin:0},children:""}),r.jsx("button",{style:gt.close,onClick:i,children:""})]}),r.jsx("div",{style:gt.tip,children:s?r.jsxs(r.Fragment,{children:[" ",r.jsx("strong",{style:{color:"#1976d2"},children:(n==null?void 0:n.length)||0})," ",r.jsxs("div",{style:{marginTop:"6px",fontSize:"11px",color:"#666"},children:[n==null?void 0:n.slice(0,3).map((E,S)=>r.jsxs("span",{style:{marginRight:"8px"},children:[" ",E.name]},S)),(n==null?void 0:n.length)>3&&`...${n.length}`]})]}):r.jsxs(r.Fragment,{children:[" ",r.jsx("strong",{style:{color:"#1976d2"},children:t==null?void 0:t.name})," "]})}),r.jsx("div",{style:gt.controlBar,children:r.jsxs("div",{style:gt.sortButtons,children:[r.jsx("button",{style:{...gt.sortBtn,...d==="age"?gt.sortBtnActive:{}},onClick:()=>u("age"),children:""}),r.jsx("button",{style:{...gt.sortBtn,...d==="cultivation"?gt.sortBtnActive:{}},onClick:()=>u("cultivation"),children:""}),r.jsx("button",{style:{...gt.sortBtn,...d==="aptitude"?gt.sortBtnActive:{}},onClick:()=>u("aptitude"),children:""}),r.jsx("button",{style:{...gt.sortBtn,...d==="name"?gt.sortBtnActive:{}},onClick:()=>u("name"),children:""})]})}),r.jsxs("div",{style:gt.list,children:[e.length===0&&r.jsx("div",{style:gt.empty,children:""}),w.map((E,S)=>{var g;return r.jsxs("div",{style:{...gt.childCard,...a===E.id?gt.childCardHover:{}},onClick:()=>o(E),onMouseEnter:()=>l(E.id),onMouseLeave:()=>l(null),children:[r.jsxs("div",{style:gt.childInfo,children:[r.jsxs("div",{style:gt.childHeader,children:[r.jsx("span",{style:gt.childName,children:E.name}),r.jsx("span",{style:gt.childTier,children:E.tierTitle||""})]}),r.jsxs("div",{style:gt.childStats,children:[r.jsxs("span",{children:[" ",Math.floor(E.age),""]}),r.jsxs("span",{children:[" ",E.gender]}),r.jsxs("span",{children:["  ",((g=E.stats)==null?void 0:g.aptitude)||50]})]})]}),r.jsx("div",{style:gt.arrow,children:""})]},E.id)})]}),v>1&&r.jsxs("div",{style:gt.pagination,children:[r.jsx("button",{style:{...gt.pageBtn,opacity:p===1?.5:1},disabled:p===1,onClick:()=>c(Math.max(1,p-1)),children:""}),r.jsxs("span",{style:gt.pageInfo,children:[" ",p," / ",v," "]}),r.jsx("button",{style:{...gt.pageBtn,opacity:p>=v?.5:1},disabled:p>=v,onClick:()=>c(Math.min(v,p+1)),children:""})]})]})})},gt={overlay:{position:"fixed",inset:0,background:"rgba(0,0,0,0.5)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:2100},modal:{width:"450px",maxHeight:"70vh",background:"#fff",borderRadius:"12px",boxShadow:"0 10px 25px rgba(0,0,0,0.2)",display:"flex",flexDirection:"column"},header:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"12px 16px",borderBottom:"1px solid #eee"},close:{border:"none",background:"transparent",fontSize:"20px",cursor:"pointer",color:"#888"},tip:{padding:"12px 16px",fontSize:"13px",color:"#555",background:"#f5f5f5",borderBottom:"1px solid #eee"},controlBar:{padding:"12px 12px",borderBottom:"1px solid #eee",backgroundColor:"#fafafa"},sortButtons:{display:"flex",gap:"6px",flexWrap:"wrap"},sortBtn:{padding:"6px 12px",fontSize:"11px",backgroundColor:"#f0f0f0",color:"#666",border:"1px solid #ddd",borderRadius:"4px",cursor:"pointer",transition:"all 0.2s"},sortBtnActive:{backgroundColor:"#1976d2",color:"#fff",borderColor:"#1976d2"},list:{padding:"12px",overflowY:"auto",flex:1},empty:{textAlign:"center",color:"#999",padding:"20px"},childCard:{borderWidth:"1px",borderStyle:"solid",borderColor:"#e0e0e0",borderRadius:"8px",padding:"12px",marginBottom:"10px",background:"#fafafa",cursor:"pointer",display:"flex",justifyContent:"space-between",alignItems:"center",transition:"all 0.2s"},childCardHover:{background:"#e3f2fd",borderColor:"#1976d2",borderWidth:"1px",borderStyle:"solid"},childInfo:{flex:1},childHeader:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"6px"},childName:{fontSize:"15px",fontWeight:"bold",color:"#333"},childTier:{fontSize:"11px",padding:"2px 8px",borderRadius:"10px",background:"#3e2723",color:"#fff"},childStats:{display:"flex",gap:"12px",fontSize:"12px",color:"#666"},arrow:{fontSize:"20px",color:"#1976d2",marginLeft:"10px"},pagination:{display:"flex",justifyContent:"center",alignItems:"center",gap:"8px",padding:"12px 16px",borderTop:"1px solid #eee",backgroundColor:"#fafafa"},pageBtn:{padding:"6px 12px",fontSize:"11px",backgroundColor:"#f0f0f0",color:"#666",border:"1px solid #ddd",borderRadius:"4px",cursor:"pointer",transition:"all 0.2s"},pageInfo:{color:"#666",fontSize:"12px",minWidth:"70px",textAlign:"center"}},VC=({child:e,onChangeManual:t})=>{if(!e.spiritRoot||!e.spiritRoot.elements)return r.jsxs("div",{style:en.section,children:[r.jsx("h4",{style:en.secTitle,children:" "}),r.jsx("p",{style:{color:"#999",fontSize:"12px"},children:"(6)"})]});const n=e.cultivationMethod||"basic_breath",s=Nc(n,e.spiritRoot);if(!s.manual)return r.jsxs("div",{style:en.section,children:[r.jsx("h4",{style:en.secTitle,children:" "}),r.jsx("p",{style:{color:"#999",fontSize:"12px"},children:""})]});const{manual:o,compatibility:i,speedBonus:a}=s,l=i.color||"#999";return r.jsxs("div",{style:en.section,children:[r.jsx("h4",{style:en.secTitle,children:" "}),r.jsxs("div",{style:en.manualCard,children:[r.jsxs("div",{style:en.manualHeader,children:[r.jsxs("div",{style:en.manualName,children:[o.name,r.jsx("span",{style:{...en.tierBadge,background:o.tierColor,marginLeft:"8px"},children:o.tierName})]}),o.element!=="NONE"&&r.jsx("div",{style:en.elementBadge,children:o.element})]}),r.jsx("div",{style:en.manualDesc,children:o.desc}),r.jsxs("div",{style:{...en.compatibilityBox,borderColor:l},children:[r.jsxs("div",{style:en.compatibilityRow,children:[r.jsx("span",{children:""}),r.jsx("span",{style:{color:l,fontWeight:"bold"},children:i.desc})]}),r.jsxs("div",{style:en.compatibilityRow,children:[r.jsx("span",{children:""}),r.jsxs("span",{style:{color:"#2196F3",fontWeight:"bold"},children:["+",a]})]})]}),r.jsx("div",{style:en.actionRow,children:r.jsx("button",{style:en.changeBtn,onClick:()=>{t&&t(e)},children:" "})})]})]})},en={section:{marginBottom:"20px",paddingBottom:"15px",borderBottom:"1px dashed #e0e0e0"},secTitle:{fontSize:"14px",fontWeight:"bold",marginBottom:"10px",color:"#333"},manualCard:{background:"#f9f9f9",borderRadius:"8px",padding:"12px",border:"1px solid #e0e0e0"},manualHeader:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"8px"},manualName:{fontSize:"16px",fontWeight:"bold",color:"#333",display:"flex",alignItems:"center"},tierBadge:{display:"inline-block",padding:"2px 8px",borderRadius:"4px",fontSize:"11px",color:"white",fontWeight:"bold"},elementBadge:{padding:"4px 10px",background:"#FF6B6B",color:"white",borderRadius:"12px",fontSize:"12px",fontWeight:"bold"},manualDesc:{fontSize:"12px",color:"#666",marginBottom:"10px",lineHeight:"1.5"},compatibilityBox:{background:"white",borderLeft:"3px solid",padding:"8px 10px",marginBottom:"10px",borderRadius:"4px"},compatibilityRow:{display:"flex",justifyContent:"space-between",fontSize:"13px",marginBottom:"4px"},actionRow:{display:"flex",justifyContent:"flex-end"},changeBtn:{padding:"6px 16px",background:"#2196F3",color:"white",border:"none",borderRadius:"6px",cursor:"pointer",fontSize:"13px",fontWeight:"bold",transition:"background 0.2s"}},b1=({child:e,onClose:t,onAction:n,navigation:s,onNavigate:o,player:i,isTianjiMode:a=!1})=>{var $,O,H,F,se,J,de,Ee,$e,De,Qe,Y,ue,ne,ce,ae,je;const[l,d]=b.useState(!1),[u,p]=b.useState(e.name);b.useEffect(()=>{p(e.name),d(!1)},[e.id,e.name]),b.useEffect(()=>{if(typeof window>"u"||!o)return;const X=Me=>{Me.key==="ArrowLeft"&&(s!=null&&s.hasPrev)&&(Me.preventDefault(),o("PREV")),Me.key==="ArrowRight"&&(s!=null&&s.hasNext)&&(Me.preventDefault(),o("NEXT"))};return window.addEventListener("keydown",X),()=>window.removeEventListener("keydown",X)},[s,o]);const c=X=>({:"#FFD700",:"#4CAF50",:"#2196F3",:"#F44336",:"#795548",:"#673AB7",:"#00BCD4",:"#009688"})[X]||"#9e9e9e",m=X=>({WHITE:"#9e9e9e",GREEN:"#4caf50",BLUE:"#2196f3",PURPLE:"#9c27b0",ORANGE:"#ff9800",RED:"#f44336"})[X]||"#333",v=X=>X==="male"||X===""?"":X==="female"||X===""?"":X||"",w=X=>X?typeof X=="string"?X:typeof X=="object"&&X.name?X.name:"":"",E=(X,Me,Ae)=>{if(!X){if(Ae===!1)return"";if(typeof Me=="number"){const z=kp(Me);return(z==null?void 0:z.name)||""}return""}if(typeof X=="string")return X;const _e=X.rootType||X.type;return _e||(Array.isArray(X.elements)&&X.elements.length>0?X.elements.map(z=>typeof z=="object"?z.element:z).join("")+"":"")},S=X=>{var Ge;const Me=(X==null?void 0:X.name)||"",Ae=(X==null?void 0:X.tierTitle)||(X==null?void 0:X.tier)||"",_e=w(X==null?void 0:X.sect),z=X!=null&&X.rank?`${_e}${X.rank}`:_e,he=E(X==null?void 0:X.spiritRoot,(Ge=X==null?void 0:X.stats)==null?void 0:Ge.aptitude,X==null?void 0:X.isTested),ye=v(X==null?void 0:X.gender),ke=`${Me}${Ae}${z===""?"":`${z}`}${ye}${he}`,ve=`${Me}${z}${he}`;return{summary:ke,bio:ve}},{summary:g,bio:h}=S(e),x=()=>{n("RENAME",u),d(!1)},k=Math.floor(e.age*12),_=e.isTested&&k>=72&&!!e.spiritRoot,y=(($=e.stats)==null?void 0:$.aptitude)||0,R=kp(y),C=Math.min(100,y),I=Math.max(0,Math.floor(e.currentExp||0)),T=Math.max(1,Math.floor(e.maxExp||1)),L=Math.min(100,Math.round(I/T*100)),ee=(X,Me,Ae)=>r.jsxs("div",{style:le.fractionWrapper,"aria-label":`${Ae} ${X}/${Me}`,children:[r.jsx("span",{style:le.fractionCaption,children:Ae}),r.jsxs("div",{style:le.fractionBox,children:[r.jsx("span",{style:le.fractionNumerator,children:X}),r.jsx("span",{style:le.fractionDivider}),r.jsx("span",{style:le.fractionDenominator,children:Me})]})]});return r.jsx("div",{style:le.overlay,children:r.jsxs("div",{style:le.modalWrapper,children:[r.jsx("button",{onClick:t,style:le.closeBtn,"aria-label":"",children:""}),r.jsxs("div",{style:le.modal,children:[a&&r.jsxs("div",{style:le.tianjiContent,children:[r.jsxs("div",{style:le.tianjiHeader,children:[r.jsx("h2",{style:le.tianjiTitle,children:e.name}),r.jsxs("div",{style:le.tianjiSubtitle,children:[e.generation&&`${e.generation}  `,e.tierTitle||e.tier||""," ",typeof e.sect=="string"?e.sect:((O=e.sect)==null?void 0:O.name)||""]})]}),r.jsxs("div",{style:le.tianjiSection,children:[r.jsx("h3",{style:le.tianjiSectionTitle,children:" "}),r.jsxs("div",{style:le.tianjiInfoGrid,children:[r.jsxs("div",{style:le.tianjiInfoItem,children:[r.jsx("span",{style:le.tianjiInfoLabel,children:""}),r.jsx("span",{style:le.tianjiInfoValue,children:e.name})]}),r.jsxs("div",{style:le.tianjiInfoItem,children:[r.jsx("span",{style:le.tianjiInfoLabel,children:""}),r.jsx("span",{style:le.tianjiInfoValue,children:e.title||""})]}),r.jsxs("div",{style:le.tianjiInfoItem,children:[r.jsx("span",{style:le.tianjiInfoLabel,children:""}),r.jsx("span",{style:le.tianjiInfoValue,children:e.gender===""?"":""})]}),r.jsxs("div",{style:le.tianjiInfoItem,children:[r.jsx("span",{style:le.tianjiInfoLabel,children:""}),r.jsx("span",{style:le.tianjiInfoValue,children:e.tierTitle||e.tier||""})]}),r.jsxs("div",{style:le.tianjiInfoItem,children:[r.jsx("span",{style:le.tianjiInfoLabel,children:""}),r.jsx("span",{style:le.tianjiInfoValue,children:typeof e.sect=="string"?e.sect:((H=e.sect)==null?void 0:H.name)||""})]}),e.rank&&r.jsxs("div",{style:le.tianjiInfoItem,children:[r.jsx("span",{style:le.tianjiInfoLabel,children:""}),r.jsx("span",{style:le.tianjiInfoValue,children:e.rank})]}),r.jsxs("div",{style:le.tianjiInfoItem,children:[r.jsx("span",{style:le.tianjiInfoLabel,children:""}),r.jsx("span",{style:le.tianjiInfoValue,children:E(e.spiritRoot,(F=e.stats)==null?void 0:F.aptitude,e.isTested)})]})]})]}),r.jsxs("div",{style:le.tianjiSection,children:[r.jsx("h3",{style:le.tianjiSectionTitle,children:" "}),r.jsx("p",{style:le.tianjiDescription,children:g||""})]}),r.jsxs("div",{style:le.tianjiSection,children:[r.jsx("h3",{style:le.tianjiSectionTitle,children:" "}),r.jsx("p",{style:le.tianjiDescription,children:h||""})]}),r.jsx("button",{style:le.tianjiCloseBtn,onClick:t,children:""})]}),!a&&r.jsxs(r.Fragment,{children:[s&&r.jsxs("div",{style:le.navBar,children:[r.jsxs("button",{type:"button","aria-label":"",onClick:()=>s.hasPrev&&o&&o("PREV"),disabled:!s.hasPrev,style:{...le.navBtn,...s.hasPrev?{}:le.navBtnDisabled},children:[" ",s.prevName||""]}),r.jsx("span",{style:le.navLabel,children:s.label||"--/--"}),r.jsxs("button",{type:"button","aria-label":"",onClick:()=>s.hasNext&&o&&o("NEXT"),disabled:!s.hasNext,style:{...le.navBtn,...s.hasNext?{}:le.navBtnDisabled},children:[s.nextName||""," "]})]}),r.jsx("div",{style:le.content,children:r.jsxs("div",{style:le.singleCol,children:[r.jsxs("div",{style:{display:"flex",gap:"20px",alignItems:"center",marginBottom:"20px",paddingBottom:"15px",borderBottom:"1px dashed #e0e0e0"},children:[r.jsx("div",{style:{marginBottom:"15px"},children:e.age===0?r.jsx("div",{style:{fontSize:"48px"},children:""}):e.age<15?r.jsx("div",{style:{fontSize:"48px"},children:""}):r.jsx(Gr,{dna:e.avatar,gender:e.gender,size:100})}),r.jsxs("div",{style:le.nameBox,children:[l?r.jsxs("div",{style:{display:"flex",gap:"5px"},children:[r.jsx("input",{value:u,onChange:X=>p(X.target.value),style:le.input}),r.jsx("button",{onClick:x,style:le.smallBtn,children:""})]}):r.jsxs("h2",{style:{margin:0},children:[e.name,r.jsx("span",{onClick:()=>d(!0),style:le.editIcon,children:""})]}),r.jsx("div",{style:le.tierBadge,children:e.tierTitle||""}),(e.sect||e.rank)&&r.jsx("div",{style:{marginTop:"8px",fontSize:"13px",color:"#d7a574",fontWeight:"bold"},children:e.sect?r.jsxs(r.Fragment,{children:[e.sect.name,e.rank&&`  ${e.rank}`]}):e.rank&&e.rank}),r.jsxs("div",{style:{marginTop:"10px",fontSize:"13px",color:"#555"},children:[r.jsxs("div",{style:{display:"flex",gap:"15px",marginBottom:"5px",flexWrap:"wrap"},children:[r.jsxs("div",{children:[" ",Math.floor(e.age),"",Math.floor(e.age%1*12),""]}),r.jsxs("div",{children:[" ",e.fatherName]}),r.jsxs("div",{children:[" ",e.gender]}),((se=e.stats)==null?void 0:se.lifespan)&&r.jsxs("div",{children:["  ",Math.floor(Math.max(0,zr(e))),"/",Math.floor(e.stats.lifespan),""]})]}),e.trait&&r.jsxs("div",{style:{...le.traitBox,borderColor:m(e.trait.rarity),marginTop:"5px",display:"inline-block"},children:[r.jsx("span",{style:{color:m(e.trait.rarity),fontWeight:"bold"},children:e.trait.name}),r.jsx("p",{style:{margin:"5px 0 0",fontSize:"10px",color:"#666"},children:e.trait.desc})]}),e.influenceProfile&&r.jsxs("div",{style:le.influencePanel,children:[r.jsxs("div",{style:{...le.influenceHeader,color:e.influenceProfile.color},children:[e.influenceProfile.label,r.jsx("span",{style:le.influenceScore,children:e.influenceProfile.score})]}),r.jsx("p",{style:le.influenceTagline,children:e.influenceProfile.tagline}),r.jsx("div",{style:le.influenceProgress,children:r.jsx("div",{style:{...le.influenceProgressFill,width:`${Math.min(100,Math.round((e.influenceProfile.progress||0)*100))}%`,background:e.influenceProfile.color}})}),r.jsxs("div",{style:le.influenceFooter,children:["",e.influenceProfile.nextLabel]})]})]})]})]}),r.jsxs("div",{style:le.section,children:[r.jsx("h4",{style:le.secTitle,children:" "}),e.spouse?r.jsxs("div",{style:le.spouseCard,children:[r.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"10px"},children:[r.jsx("div",{style:le.miniAvatar,children:e.spouse.gender===""?"":""}),r.jsxs("div",{children:[r.jsx("div",{style:{fontWeight:"bold",color:"#e91e63"},children:e.spouse.name}),r.jsx("div",{style:{fontSize:"12px",color:"#666"},children:e.spouse.gender===""?" ":" "}),r.jsx("div",{style:{fontSize:"12px"},children:e.spouse.tierTitle||""})]})]}),r.jsxs("div",{style:{marginTop:"8px",fontSize:"13px",display:"grid",gridTemplateColumns:"1fr 1fr 1fr",gap:"8px"},children:[r.jsxs("div",{children:[": ",r.jsx("span",{style:{color:"purple"},children:((J=e.spouse.stats)==null?void 0:J.aptitude)||e.spouse.aptitude})]}),r.jsxs("div",{children:[": ",((de=e.spouse.stats)==null?void 0:de.looks)||e.spouse.looks]}),r.jsxs("div",{children:[": ",((Ee=e.spouse.stats)==null?void 0:Ee.intelligence)||e.spouse.intelligence]}),r.jsxs("div",{style:{gridColumn:"span 3",color:"#d81b60"},children:[($e=e.spouse.spiritRoot)==null?void 0:$e.type," ",(Qe=(De=e.spouse.spiritRoot)==null?void 0:De.elements)==null?void 0:Qe.join(", ")]})]})]}):r.jsxs("div",{style:{color:"#999",fontSize:"12px",textAlign:"center",padding:"15px",background:"#f5f5f5",borderRadius:"8px"},children:["",r.jsx("br",{}),r.jsx("button",{style:le.marryBtn,onClick:()=>{console.log("Marriage button clicked for child:",e.name,"id:",e.id),n("MARRY")},children:" "})]})]}),r.jsxs("div",{style:le.section,children:[r.jsx("h4",{style:le.secTitle,children:" "}),_?r.jsxs(r.Fragment,{children:[r.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"10px",marginBottom:"10px"},children:[r.jsx("strong",{style:{fontSize:"16px"},children:e.spiritRoot.type}),r.jsx("div",{style:{display:"flex",gap:"4px"},children:e.spiritRoot.elements.map(X=>r.jsx("span",{style:{...le.elBadge,background:c(X)},children:X},X))})]}),r.jsxs("div",{style:le.barContainer,children:[r.jsxs("span",{children:[" (",y,")"]}),r.jsx("div",{style:le.barBg,children:r.jsx("div",{style:{...le.barFill,width:`${C}%`,background:R.color}})})]}),r.jsx("p",{style:{fontSize:"12px",color:"#666",marginTop:"5px"},children:e.spiritRoot.desc})]}):r.jsx("p",{style:{color:"#999",fontStyle:"italic"},children:"6"})]}),r.jsxs("div",{style:le.section,children:[r.jsx("h4",{style:le.secTitle,children:" "}),r.jsx("div",{style:le.equipGrid,children:["weapon","armor","accessory"].map(X=>{var _e;const Me=(_e=e.equipment)==null?void 0:_e[X],Ae={weapon:"",armor:"",accessory:""};return r.jsxs("div",{style:le.equipSlot,children:[r.jsx("div",{style:{fontWeight:"bold"},children:Ae[X]}),r.jsx("div",{style:{fontSize:"12px",color:"#555",minHeight:"18px"},children:Me?Me.name:""}),r.jsxs("div",{style:{display:"flex",gap:"6px"},children:[r.jsx("button",{style:le.smallBtn,onClick:()=>n("OPEN_INVENTORY",{mode:"SELECT",slot:X}),children:""}),Me&&r.jsx("button",{style:le.smallBtn,onClick:()=>n("UNEQUIP",{slot:X}),children:""})]})]},X)})}),r.jsxs("div",{style:{marginTop:"8px",textAlign:"right"},children:[r.jsx("button",{style:le.smallBtn,onClick:()=>n("OPEN_INVENTORY",{mode:"VIEW"}),children:" "}),r.jsx(VC,{child:e,onChangeManual:X=>n("CHANGE_MANUAL",X)})]})]}),r.jsxs("div",{style:le.section,children:[r.jsx("h4",{style:le.secTitle,children:" "}),r.jsxs("div",{style:le.traitGrid,children:[r.jsxs("div",{style:le.traitRow,children:[r.jsx("span",{style:le.label,children:":"}),r.jsx(_c,{trait:Ic(((Y=e.stats)==null?void 0:Y.looks)||50,"LOOKS",e.gender),showValue:!0})]}),r.jsxs("div",{style:le.traitRow,children:[r.jsx("span",{style:le.label,children:":"}),r.jsx(_c,{trait:Ic(((ue=e.stats)==null?void 0:ue.intelligence)||50,"INT"),showValue:!0})]}),r.jsxs("div",{style:le.traitRow,children:[r.jsx("span",{style:le.label,children:":"}),r.jsx("div",{style:{flex:1,height:"8px",background:"#eee",borderRadius:"4px",overflow:"hidden"},children:r.jsx("div",{style:{height:"100%",width:`${y}%`,background:y>=90?"#d50000":y>=80?"#aa00ff":"#4caf50"}})}),r.jsx("span",{style:{fontSize:"12px",marginLeft:"5px"},children:y})]})]})]}),r.jsxs("div",{style:le.section,children:[r.jsx("h4",{style:le.secTitle,children:" "}),r.jsxs("div",{style:le.combatGrid,children:[r.jsxs("div",{style:le.statItem,children:[r.jsx("span",{style:{color:"#d32f2f"},children:""}),r.jsx("strong",{children:((ne=e.combatStats)==null?void 0:ne.hp)||100})]}),r.jsxs("div",{style:le.statItem,children:[r.jsx("span",{style:{color:"#1976d2"},children:""}),r.jsx("strong",{children:((ce=e.combatStats)==null?void 0:ce.mp)||0})]}),r.jsxs("div",{style:le.statItem,children:[r.jsx("span",{style:{color:"#f57c00"},children:""}),r.jsx("strong",{children:((ae=e.combatStats)==null?void 0:ae.atk)||5})]})]})]}),((je=e.stats)==null?void 0:je.lifespan)&&r.jsxs("div",{style:le.section,children:[r.jsx("h4",{style:le.secTitle,children:" "}),r.jsxs("div",{style:{fontSize:"12px",color:"#666",lineHeight:"1.6"},children:[r.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:"4px"},children:[r.jsx("span",{children:":"}),r.jsxs("span",{style:{fontWeight:"bold"},children:[Math.floor(e.age||0)," "]})]}),r.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:"4px"},children:[r.jsx("span",{children:":"}),r.jsxs("span",{style:{fontWeight:"bold"},children:[Math.floor(e.stats.lifespan)," "]})]}),r.jsxs("div",{style:{display:"flex",justifyContent:"space-between"},children:[r.jsx("span",{children:":"}),r.jsxs("span",{style:{fontWeight:"bold",color:(()=>{const X=zr(e);return X<10?"#f44336":X<30?"#ff9800":"#4caf50"})()},children:[Math.floor(zr(e))," "]})]}),zr(e)<10&&r.jsx("div",{style:{marginTop:"8px",padding:"8px",background:"rgba(244, 67, 54, 0.1)",borderRadius:"4px",color:"#f44336",fontSize:"11px"},children:" "})]})]}),e.tierTitle&&r.jsxs("div",{style:le.section,children:[r.jsx("h4",{style:le.secTitle,children:" "}),r.jsxs("div",{style:{fontSize:"12px",marginBottom:"8px"},children:[r.jsx("span",{style:{color:"#666"},children:": "}),r.jsx("span",{style:{fontWeight:"bold",color:"#9c27b0"},children:e.tierTitle||""})]}),e.currentExp!==void 0&&e.maxExp&&r.jsxs("div",{children:[r.jsxs("div",{style:{marginBottom:"4px"},children:[r.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",marginBottom:"4px"},children:[r.jsx("span",{style:{fontSize:"11px",color:"#666"},children:""}),r.jsxs("span",{style:{fontSize:"11px",color:"#666",fontWeight:"bold"},children:[L,"%"]})]}),r.jsx("div",{style:{width:"100%",height:"14px",background:"linear-gradient(to right, #f0f0f0, #e0e0e0)",borderRadius:"7px",overflow:"hidden",position:"relative",boxShadow:"inset 0 2px 4px rgba(0,0,0,0.1)"},children:r.jsx("div",{style:{width:`${L}%`,height:"100%",background:"linear-gradient(90deg, #9c27b0 0%, #d05ce3 100%)",borderRadius:"7px",transition:"width 0.3s ease",boxShadow:"0 0 10px rgba(156, 39, 176, 0.5)",position:"relative",overflow:"hidden"},children:r.jsx("div",{style:{position:"absolute",top:0,left:"-100%",width:"100%",height:"100%",background:"linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent)",animation:"shimmer 2s infinite"}})})})]}),ee(I,T,""),e.cultivationSpeed&&r.jsxs("div",{style:{marginTop:"8px",padding:"6px 10px",background:"rgba(156, 39, 176, 0.05)",borderRadius:"6px",border:"1px solid rgba(156, 39, 176, 0.1)"},children:[r.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"4px"},children:[r.jsx("span",{style:{fontSize:"11px",color:"#666"},children:":"}),r.jsxs("span",{style:{fontSize:"11px",fontWeight:"bold",color:"#9c27b0"},children:[Math.floor(e.cultivationSpeed)," /"]})]}),(()=>{const X=Math.max(0,T-I),Me=Math.ceil(X/e.cultivationSpeed);return r.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[r.jsx("span",{style:{fontSize:"11px",color:"#666"},children:":"}),r.jsx("span",{style:{fontSize:"11px",fontWeight:"bold",color:Me>12?"#ff9800":"#4caf50"},children:Me>12?`${Math.floor(Me/12)}`:`${Me}`})]})})()]})]})]}),r.jsxs("div",{style:le.section,children:[r.jsx("h4",{style:le.secTitle,children:" "}),e.sect?r.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[r.jsxs("div",{children:[r.jsx("div",{style:{fontWeight:"bold",color:"#00695c"},children:e.sect.name}),r.jsx("div",{style:{fontSize:"12px"},children:e.rank})]}),r.jsx("div",{style:{textAlign:"right",fontSize:"12px"},children:r.jsxs("div",{children:[": ",Math.floor(e.age*12)>=192?"":""]})})]}):r.jsxs("div",{children:[r.jsx("p",{style:{color:"#666",fontSize:"12px",marginBottom:"8px"},children:" / "}),Math.floor(e.age*12)>=144&&e.isTested&&r.jsxs("div",{style:{display:"flex",gap:"8px",alignItems:"center"},children:[r.jsx("button",{style:le.smallBtn,onClick:()=>n("SELECT_SECT"),children:" "}),r.jsxs("label",{style:{display:"flex",alignItems:"center",gap:8,fontSize:12,color:"#555"},children:[r.jsx("input",{type:"checkbox",checked:!!e.autoJoinBestSect,onChange:X=>n("TOGGLE_AUTO_JOIN_SECT",X.target.checked)}),""]})]})]})]}),r.jsxs("div",{style:{...le.actionArea,gridTemplateColumns:"1fr 1fr 1fr"},children:[r.jsxs("button",{onClick:()=>n("CHAT"),style:{...le.actionBtn,background:"#7e57c2"},children:[" ",r.jsx("br",{}),r.jsx("small",{style:{fontSize:"10px",opacity:.8},children:""})]}),r.jsxs("button",{onClick:()=>{window.showConfirm&&window.showConfirm(` ${e.name} `,()=>n("EXPEL"))},style:{...le.actionBtn,background:"#d32f2f"},children:[" ",r.jsx("br",{}),r.jsx("small",{style:{fontSize:"10px",opacity:.9},children:""})]})]})]})})]})]})]})})},le={tianjiContent:{padding:"24px",height:"100%",overflowY:"auto"},tianjiHeader:{marginBottom:"24px",borderBottom:"2px solid #d4a574",paddingBottom:"16px"},tianjiTitle:{fontSize:"28px",fontWeight:"bold",color:"#8b4513",margin:"0 0 8px 0",textShadow:"1px 1px 2px rgba(0, 0, 0, 0.2)"},tianjiSubtitle:{fontSize:"14px",color:"#666",fontStyle:"italic"},tianjiSection:{marginBottom:"24px"},tianjiSectionTitle:{fontSize:"16px",fontWeight:"bold",color:"#8b4513",marginBottom:"12px",borderLeft:"4px solid #d4a574",paddingLeft:"10px"},tianjiInfoGrid:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(150px, 1fr))",gap:"12px",marginBottom:"12px"},tianjiInfoItem:{display:"flex",flexDirection:"column",padding:"10px",background:"#f9f9f9",borderRadius:"6px",border:"1px solid #eee"},tianjiInfoLabel:{fontSize:"12px",color:"#999",fontWeight:"bold",marginBottom:"4px"},tianjiInfoValue:{fontSize:"14px",color:"#333",fontWeight:"bold"},tianjiDescription:{fontSize:"14px",lineHeight:"1.8",color:"#333",margin:"0",padding:"12px",background:"rgba(255, 255, 255, 0.6)",borderRadius:"8px",border:"1px solid rgba(139, 69, 19, 0.2)"},tianjiCloseBtn:{marginTop:"20px",padding:"12px 24px",background:"linear-gradient(135deg, #8b4513, #a0522d)",color:"white",border:"none",borderRadius:"8px",fontSize:"14px",fontWeight:"bold",cursor:"pointer",width:"100%",transition:"transform 0.2s"},overlay:{position:"fixed",top:0,left:0,right:0,bottom:0,background:"rgba(0,0,0,0.6)",display:"flex",justifyContent:"center",alignItems:"center",zIndex:1e3},modalWrapper:{position:"relative",width:"min(600px, calc(100vw - 32px))"},modal:{width:"100%",height:"600px",background:"#fff",borderRadius:"12px",overflow:"hidden",position:"relative",boxShadow:"0 10px 25px rgba(0,0,0,0.2)",display:"flex",flexDirection:"column"},closeBtn:{position:"absolute",top:"-18px",left:"-18px",border:"none",background:"#ffffff",fontSize:"22px",cursor:"pointer",color:"#888",width:"44px",height:"44px",display:"flex",alignItems:"center",justifyContent:"center",borderRadius:"22px",boxShadow:"0 12px 30px rgba(0,0,0,0.25)"},content:{flex:1,height:"100%",overflow:"hidden"},navBar:{flex:"0 0 auto",padding:"12px 20px",borderBottom:"1px solid #f0f0f0",background:"#fafafa",display:"flex",alignItems:"center",justifyContent:"space-between"},navBtn:{border:"none",background:"transparent",cursor:"pointer",color:"#333",fontSize:"13px",display:"flex",alignItems:"center",gap:"6px",padding:"6px 10px",borderRadius:"6px"},navBtnDisabled:{color:"#bbb",cursor:"not-allowed"},navLabel:{fontSize:"12px",color:"#666",fontWeight:"bold"},singleCol:{width:"100%",padding:"25px 25px 90px 25px",overflowY:"auto",height:"100%",boxSizing:"border-box"},nameBox:{textAlign:"left"},editIcon:{fontSize:"12px",cursor:"pointer",marginLeft:"5px",opacity:.5},input:{width:"120px",padding:"5px",borderRadius:"4px",border:"1px solid #ccc"},smallBtn:{padding:"5px 10px",cursor:"pointer",borderRadius:"4px",border:"1px solid #ccc",backgroundColor:"#f5f5f5"},tierBadge:{fontSize:"12px",background:"#3e2723",color:"#fff",padding:"2px 8px",borderRadius:"10px",marginTop:"5px",display:"inline-block"},traitBox:{padding:"10px",background:"#fff",border:"1px solid",borderRadius:"8px",textAlign:"center",display:"inline-block"},influencePanel:{marginTop:"10px",padding:"12px",borderRadius:"10px",background:"linear-gradient(135deg, rgba(255,255,255,0.8), rgba(240,240,240,0.9))",border:"1px solid #e0e0e0"},influenceHeader:{fontWeight:"bold",fontSize:"16px",display:"flex",justifyContent:"space-between",alignItems:"center"},influenceScore:{fontSize:"18px"},influenceTagline:{fontSize:"11px",margin:"4px 0",color:"#666"},influenceProgress:{height:"8px",borderRadius:"999px",background:"#e0e0e0",overflow:"hidden"},influenceProgressFill:{height:"100%"},influenceFooter:{marginTop:"4px",fontSize:"11px",color:"#888"},spouseCard:{background:"#fff8e1",padding:"15px",borderRadius:"8px",border:"1px solid #ffecb3",boxShadow:"0 2px 4px rgba(0,0,0,0.05)"},miniAvatar:{fontSize:"24px",width:"40px",height:"40px",borderRadius:"50%",background:"#fff",display:"flex",alignItems:"center",justifyContent:"center",boxShadow:"0 1px 3px rgba(0,0,0,0.1)"},marryBtn:{marginTop:"10px",padding:"5px 15px",fontSize:"12px",cursor:"pointer",borderRadius:"15px",border:"1px solid #e91e63",backgroundColor:"#fff",color:"#e91e63",transition:"all 0.2s",":hover":{backgroundColor:"#fce4ec",transform:"translateY(-1px)"}},section:{marginBottom:"25px"},secTitle:{margin:"0 0 15px 0",fontSize:"14px",color:"#333",borderBottom:"1px dashed #ccc",paddingBottom:"8px"},elBadge:{padding:"2px 6px",borderRadius:"4px",color:"#fff",fontSize:"10px",fontWeight:"bold"},barContainer:{display:"flex",alignItems:"center",gap:"10px",fontSize:"12px",marginBottom:"10px"},barBg:{flex:1,height:"8px",background:"#eee",borderRadius:"4px"},barFill:{height:"100%",borderRadius:"4px"},combatGrid:{display:"grid",gridTemplateColumns:"1fr 1fr 1fr",gap:"10px",textAlign:"center"},statItem:{background:"#fafafa",padding:"10px",borderRadius:"8px",display:"flex",flexDirection:"column",gap:"5px"},actionArea:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"10px",marginTop:"20px"},actionBtn:{padding:"12px",border:"none",borderRadius:"8px",background:"#ff9800",color:"white",cursor:"pointer",textAlign:"center",fontSize:"14px",transition:"all 0.2s",":hover":{transform:"translateY(-1px)",boxShadow:"0 4px 8px rgba(0,0,0,0.15)"}},traitGrid:{display:"flex",flexDirection:"column",gap:"15px"},traitRow:{display:"flex",alignItems:"center",gap:"10px"},label:{width:"60px",fontSize:"13px",color:"#555",fontWeight:"bold"},equipGrid:{display:"grid",gridTemplateColumns:"1fr 1fr 1fr",gap:"10px"},equipSlot:{border:"1px dashed #ccc",borderRadius:"8px",padding:"10px",background:"#fafafa",textAlign:"center"},fractionWrapper:{display:"flex",flexDirection:"column",alignItems:"flex-end",marginTop:"6px",color:"#4a148c"},fractionCaption:{fontSize:"11px",color:"#777",marginBottom:"2px"},fractionBox:{display:"flex",flexDirection:"column",alignItems:"center",minWidth:"60px",lineHeight:1.2},fractionNumerator:{fontWeight:"bold",fontSize:"15px"},fractionDivider:{width:"100%",borderBottom:"1px solid rgba(0,0,0,0.2)",margin:"2px 0"},fractionDenominator:{fontWeight:"bold",fontSize:"13px"}},YC=({child:e,candidates:t,onSelect:n,onClose:s})=>{if(!t||t.length===0)return null;const o=a=>{switch(a){case"talented":return" ";case"beautiful":return" ";case"wise":return" ";case"buddha":return" ";default:return" "}},i=a=>{switch(a){case"talented":return"";case"beautiful":return"";case"wise":return"";case"buddha":return"";default:return""}};return r.jsx("div",{style:rt.overlay,children:r.jsxs("div",{style:rt.modalWrapper,children:[r.jsx("button",{style:rt.closeBtn,onClick:s,"aria-label":"",children:""}),r.jsxs("div",{style:rt.modal,children:[r.jsx("div",{style:rt.header,children:r.jsxs("h2",{style:rt.title,children:["  ",e.name," "]})}),r.jsxs("div",{style:rt.subtitle,children:[" ",e.name," "]}),r.jsx("div",{style:rt.candidatesContainer,children:t.map((a,l)=>{var d,u,p;return r.jsxs("div",{style:rt.candidateCard,children:[r.jsx("div",{style:rt.cardHeader,children:r.jsx("div",{style:rt.archetypeBadge,children:o(a.archetype)})}),r.jsxs("div",{style:rt.avatarSection,children:[r.jsx(Gr,{avatar:a.avatar,gender:a.gender,size:80}),r.jsxs("div",{style:rt.nameSection,children:[r.jsx("div",{style:rt.candidateName,children:a.name}),r.jsx("div",{style:rt.candidateGender,children:a.gender===""?" ":" "}),a.identity&&r.jsx("div",{style:rt.identity,children:a.identity})]})]}),r.jsx("div",{style:rt.archetypeDesc,children:i(a.archetype)}),r.jsxs("div",{style:rt.statsSection,children:[r.jsxs("div",{style:rt.statRow,children:[r.jsx("span",{style:rt.statLabel,children:""}),r.jsx("span",{style:{...rt.statValue,color:a.stats.aptitude>=80?"#ff4081":a.stats.aptitude>=60?"#9c27b0":"#666"},children:a.stats.aptitude})]}),r.jsxs("div",{style:rt.statRow,children:[r.jsx("span",{style:rt.statLabel,children:""}),r.jsx("span",{style:{...rt.statValue,color:a.stats.looks>=80?"#ff4081":a.stats.looks>=60?"#9c27b0":"#666"},children:a.stats.looks})]}),r.jsxs("div",{style:rt.statRow,children:[r.jsx("span",{style:rt.statLabel,children:""}),r.jsx("span",{style:{...rt.statValue,color:a.stats.intelligence>=80?"#ff4081":a.stats.intelligence>=60?"#9c27b0":"#666"},children:a.stats.intelligence})]})]}),r.jsxs("div",{style:rt.spiritRootSection,children:[r.jsx("div",{style:rt.spiritRootLabel,children:""}),r.jsxs("div",{style:rt.spiritRootValue,children:[(d=a.spiritRoot)==null?void 0:d.type,((p=(u=a.spiritRoot)==null?void 0:u.elements)==null?void 0:p.length)>0&&` (${a.spiritRoot.elements.join("")})`]})]}),r.jsxs("div",{style:rt.cultivationSection,children:[r.jsx("div",{style:rt.tierLabel,children:a.tierTitle}),r.jsxs("div",{style:rt.cultivationValue,children:[": ",a.cultivation]})]}),r.jsxs("button",{style:rt.selectBtn,onClick:()=>n(a),onMouseEnter:c=>c.target.style.background="#d81b60",onMouseLeave:c=>c.target.style.background="#e91e63",children:[" ",a.name]})]},a.id)})}),r.jsxs("div",{style:rt.footer,children:[r.jsx("div",{style:rt.costInfo,children:" 500 "}),r.jsx("button",{style:rt.cancelBtn,onClick:s,children:""})]})]})]})})},rt={overlay:{position:"fixed",top:0,left:0,right:0,bottom:0,background:"rgba(0, 0, 0, 0.7)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:2e3,padding:"20px"},modalWrapper:{position:"relative",width:"min(1100px, calc(100vw - 40px))"},modal:{background:"linear-gradient(135deg, #fff8e1 0%, #ffe0b2 100%)",borderRadius:"16px",maxWidth:"1100px",width:"100%",maxHeight:"90vh",overflow:"auto",boxShadow:"0 8px 32px rgba(0,0,0,0.3)",border:"2px solid #ffb74d",position:"relative"},header:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"20px 24px",borderBottom:"2px solid #ffb74d",background:"linear-gradient(90deg, #ffe0b2, #ffcc80)"},title:{margin:0,fontSize:"24px",color:"#d84315",fontWeight:"bold"},closeBtn:{position:"absolute",top:"-18px",left:"-18px",background:"#fff",border:"2px solid rgba(0,0,0,0.08)",fontSize:"20px",cursor:"pointer",color:"#bf360c",width:"44px",height:"44px",display:"flex",alignItems:"center",justifyContent:"center",borderRadius:"50%",boxShadow:"0 10px 24px rgba(0,0,0,0.2)",zIndex:5},subtitle:{padding:"16px 24px",fontSize:"16px",color:"#5d4037",textAlign:"center",background:"#fff3e0"},candidatesContainer:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(300px, 1fr))",gap:"20px",padding:"24px"},candidateCard:{background:"white",borderRadius:"12px",padding:"20px",border:"2px solid #ffb74d",boxShadow:"0 4px 12px rgba(0,0,0,0.1)",display:"flex",flexDirection:"column",transition:"transform 0.2s, box-shadow 0.2s",cursor:"pointer"},cardHeader:{marginBottom:"12px",display:"flex",justifyContent:"center"},archetypeBadge:{background:"linear-gradient(135deg, #e91e63, #f06292)",color:"white",padding:"6px 16px",borderRadius:"20px",fontSize:"14px",fontWeight:"bold",textAlign:"center"},avatarSection:{display:"flex",alignItems:"center",gap:"16px",marginBottom:"12px",paddingBottom:"12px",borderBottom:"1px solid #ffe0b2"},nameSection:{flex:1},candidateName:{fontSize:"20px",fontWeight:"bold",color:"#d84315",marginBottom:"4px"},candidateGender:{fontSize:"14px",color:"#666",marginBottom:"4px"},identity:{fontSize:"12px",color:"#ff6f00",fontWeight:"bold",background:"#fff3e0",padding:"2px 8px",borderRadius:"4px",display:"inline-block"},archetypeDesc:{fontSize:"13px",color:"#795548",fontStyle:"italic",marginBottom:"16px",textAlign:"center",padding:"8px",background:"#fff8e1",borderRadius:"6px"},statsSection:{display:"flex",flexDirection:"column",gap:"8px",marginBottom:"12px",padding:"12px",background:"#fafafa",borderRadius:"8px"},statRow:{display:"flex",justifyContent:"space-between",alignItems:"center"},statLabel:{fontSize:"14px",color:"#666",fontWeight:"500"},statValue:{fontSize:"16px",fontWeight:"bold"},spiritRootSection:{marginBottom:"12px",padding:"10px",background:"#e3f2fd",borderRadius:"6px",border:"1px solid #90caf9"},spiritRootLabel:{fontSize:"12px",color:"#1565c0",marginBottom:"4px"},spiritRootValue:{fontSize:"14px",color:"#0d47a1",fontWeight:"bold"},cultivationSection:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"16px",padding:"10px",background:"#f3e5f5",borderRadius:"6px"},tierLabel:{fontSize:"14px",color:"#6a1b9a",fontWeight:"bold"},cultivationValue:{fontSize:"13px",color:"#4a148c"},selectBtn:{background:"#e91e63",color:"white",border:"none",padding:"12px",borderRadius:"8px",fontSize:"16px",fontWeight:"bold",cursor:"pointer",transition:"background 0.2s",boxShadow:"0 2px 8px rgba(233, 30, 99, 0.3)"},footer:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"16px 24px",borderTop:"2px solid #ffb74d",background:"#fff3e0"},costInfo:{fontSize:"16px",color:"#d84315",fontWeight:"bold"},cancelBtn:{background:"#9e9e9e",color:"white",border:"none",padding:"10px 24px",borderRadius:"6px",fontSize:"14px",cursor:"pointer",transition:"background 0.2s"}},qC=({giftEvents:e,onConfirm:t,onClose:n})=>{const[s,o]=b.useState(new Set),i=p=>{const c=new Set(s);c.has(p)?c.delete(p):c.add(p),o(c)},a=()=>{s.size===e.length?o(new Set):o(new Set(e.map(p=>p.npcId)))},l=()=>{const p=e.filter(c=>s.has(c.npcId));t(p)},d=p=>cs(p)||{name:"",rarity:"common"},u={common:"#9e9e9e",uncommon:"#4caf50",rare:"#2196f3",epic:"#9c27b0",legendary:"#ff9800"};return r.jsx("div",{style:Tt.overlay,children:r.jsxs("div",{style:Tt.modal,children:[r.jsxs("div",{style:Tt.header,children:[r.jsxs("h3",{style:Tt.title,children:[" ",e.length,""]}),r.jsx("button",{onClick:n,style:Tt.closeIcon,children:""})]}),r.jsx("div",{style:Tt.subtitle,children:""}),r.jsxs("div",{style:Tt.toolbar,children:[r.jsx("button",{onClick:a,style:Tt.selectAllBtn,children:s.size===e.length?" ":""}),r.jsxs("div",{style:Tt.selectionInfo,children:[" ",s.size," / ",e.length]})]}),r.jsx("div",{style:Tt.giftList,children:e.map((p,c)=>{const m=d(p.giftItemId),v=s.has(p.npcId);return r.jsxs("div",{style:{...Tt.giftCard,borderColor:v?"#4caf50":"#e0e0e0",background:v?"#f1f8f4":"#fff"},onClick:()=>i(p.npcId),children:[r.jsx("div",{style:Tt.checkbox,children:r.jsx("input",{type:"checkbox",checked:v,onChange:()=>i(p.npcId),style:Tt.checkboxInput})}),r.jsxs("div",{style:Tt.cardContent,children:[r.jsxs("div",{style:Tt.giftHeader,children:[r.jsx("span",{style:Tt.npcName,children:p.npcName}),r.jsx("span",{style:{...Tt.itemName,color:u[m.rarity]||"#666"},children:m.name})]}),r.jsx("div",{style:Tt.message,children:p.message}),m.desc&&r.jsxs("div",{style:Tt.itemDesc,children:[" ",m.desc]}),m.stats&&r.jsxs("div",{style:Tt.itemStats,children:[m.stats.atk&&r.jsxs("span",{children:["+",m.stats.atk]}),m.stats.hp&&r.jsxs("span",{children:["+",m.stats.hp]}),m.stats.def&&r.jsxs("span",{children:["+",m.stats.def]})]}),m.effect&&r.jsxs("div",{style:Tt.itemEffect,children:[" ",typeof m.effect=="object"?`${m.effect.kind==="heal"?"":m.effect.kind==="exp"?"":m.effect.kind==="aptitude"?"":""} +${m.effect.amount}`:m.effect]})]})]},p.npcId||c)})}),r.jsxs("div",{style:Tt.footer,children:[r.jsxs("button",{style:Tt.confirmBtn,onClick:l,disabled:s.size===0,children:[" (",s.size,")"]}),r.jsx("button",{style:Tt.cancelBtn,onClick:n,children:""})]})]})})},Tt={overlay:{position:"fixed",top:0,left:0,right:0,bottom:0,background:"rgba(0, 0, 0, 0.75)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:3e3,padding:"20px"},modal:{background:"linear-gradient(135deg, #fff 0%, #f5f5f5 100%)",borderRadius:"16px",width:"90%",maxWidth:"800px",maxHeight:"85vh",display:"flex",flexDirection:"column",boxShadow:"0 10px 40px rgba(0,0,0,0.3)",overflow:"hidden"},header:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"20px 24px",borderBottom:"2px solid #e91e63",background:"linear-gradient(90deg, #fce4ec, #f8bbd0)",flexShrink:0},title:{margin:0,fontSize:"22px",color:"#c2185b",fontWeight:"bold"},closeIcon:{background:"none",border:"none",fontSize:"28px",cursor:"pointer",color:"#c2185b",padding:"0",lineHeight:"1"},subtitle:{padding:"16px 24px",fontSize:"14px",color:"#666",borderBottom:"1px solid #e0e0e0",flexShrink:0},toolbar:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"12px 24px",background:"#fafafa",borderBottom:"1px solid #e0e0e0",flexShrink:0},selectAllBtn:{padding:"6px 16px",background:"#e0e0e0",border:"none",borderRadius:"6px",cursor:"pointer",fontSize:"13px",transition:"all 0.2s"},selectionInfo:{fontSize:"13px",color:"#666"},giftList:{flex:1,overflowY:"auto",padding:"16px 24px",display:"flex",flexDirection:"column",gap:"12px"},giftCard:{display:"flex",gap:"12px",padding:"16px",border:"2px solid #e0e0e0",borderRadius:"12px",cursor:"pointer",transition:"all 0.2s",background:"#fff"},checkbox:{flexShrink:0,display:"flex",alignItems:"flex-start",paddingTop:"2px"},checkboxInput:{width:"18px",height:"18px",cursor:"pointer"},cardContent:{flex:1,display:"flex",flexDirection:"column",gap:"8px"},giftHeader:{display:"flex",justifyContent:"space-between",alignItems:"center",gap:"12px"},npcName:{fontSize:"16px",fontWeight:"bold",color:"#e91e63"},itemName:{fontSize:"15px",fontWeight:"600"},message:{fontSize:"14px",color:"#444",lineHeight:"1.5",background:"#fff8e1",padding:"8px 12px",borderRadius:"8px",border:"1px solid #fff176"},itemDesc:{fontSize:"12px",color:"#666",fontStyle:"italic"},itemStats:{display:"flex",gap:"12px",fontSize:"12px",color:"#2196f3",fontWeight:"500"},itemEffect:{fontSize:"12px",color:"#4caf50",fontStyle:"italic"},footer:{display:"flex",gap:"12px",padding:"16px 24px",borderTop:"2px solid #e0e0e0",background:"#fafafa",flexShrink:0},confirmBtn:{flex:1,padding:"12px",background:"#4caf50",color:"#fff",border:"none",borderRadius:"8px",cursor:"pointer",fontSize:"15px",fontWeight:"bold",transition:"all 0.2s"},cancelBtn:{padding:"12px 24px",background:"#e0e0e0",border:"none",borderRadius:"8px",cursor:"pointer",fontSize:"15px"}},KC=({promotionEvents:e,onConfirm:t,onClose:n})=>{const[s,o]=b.useState(new Set(e.map(c=>c.child.id))),i=c=>{const m=new Set(s);m.has(c)?m.delete(c):m.add(c),o(m)},a=()=>{s.size===e.length?o(new Set):o(new Set(e.map(c=>c.child.id)))},l=()=>{const c=e.filter(m=>s.has(m.child.id));t(c)},d=c=>cs(c)||{name:"",rarity:"common"},u={common:"#9e9e9e",uncommon:"#4caf50",rare:"#2196f3",epic:"#9c27b0",legendary:"#ff9800"},p={:"#9e9e9e",:"#4caf50",:"#2196f3",:"#9c27b0",:"#ff9800"};return r.jsx("div",{style:Ze.overlay,children:r.jsxs("div",{style:Ze.modal,children:[r.jsxs("div",{style:Ze.header,children:[r.jsx("h3",{style:Ze.title,children:" "}),r.jsx("button",{onClick:n,style:Ze.closeIcon,children:""})]}),r.jsxs("div",{style:Ze.subtitle,children:["",e.length," "]}),r.jsxs("div",{style:Ze.toolbar,children:[r.jsx("button",{onClick:a,style:Ze.selectAllBtn,children:s.size===e.length?" ":""}),r.jsxs("div",{style:Ze.selectionInfo,children:[" ",s.size," / ",e.length]})]}),r.jsx("div",{style:Ze.eventList,children:e.map(c=>{var E;const m=c.child,v=d(c.giftItemId),w=s.has(m.id);return r.jsxs("div",{style:{...Ze.eventCard,borderColor:w?"#4caf50":"#e0e0e0",background:w?"#f1f8f4":"#fff"},onClick:()=>i(m.id),children:[r.jsx("div",{style:Ze.checkbox,children:r.jsx("input",{type:"checkbox",checked:w,onChange:()=>i(m.id),style:Ze.checkboxInput})}),r.jsxs("div",{style:Ze.cardContent,children:[r.jsxs("div",{style:Ze.promotionHeader,children:[r.jsxs("div",{style:Ze.childInfo,children:[r.jsx("span",{style:Ze.childName,children:m.name}),r.jsx("span",{style:Ze.childGender,children:m.gender===""?"":""})]}),r.jsxs("div",{style:Ze.promotionBadge,children:[r.jsx("span",{style:Ze.promotionLabel,children:""}),r.jsx("span",{style:{...Ze.rankBadge,background:p[c.rank]||"#666"},children:c.rank})]})]}),r.jsxs("div",{style:Ze.sectInfo,children:[r.jsx("span",{style:Ze.sectIcon,children:""}),r.jsx("span",{style:Ze.sectName,children:((E=c.sect)==null?void 0:E.name)||""})]}),r.jsxs("div",{style:Ze.giftSection,children:[r.jsxs("div",{style:Ze.giftHeader,children:[r.jsx("span",{style:Ze.giftLabel,children:""}),r.jsx("span",{style:{...Ze.giftName,color:u[v.rarity]||"#666"},children:v.name})]}),v.desc&&r.jsx("div",{style:Ze.giftDesc,children:v.desc}),v.stats&&r.jsxs("div",{style:Ze.giftStats,children:[v.stats.atk&&r.jsxs("span",{style:Ze.statBadge,children:[" +",v.stats.atk]}),v.stats.hp&&r.jsxs("span",{style:Ze.statBadge,children:[" +",v.stats.hp]}),v.stats.def&&r.jsxs("span",{style:Ze.statBadge,children:[" +",v.stats.def]})]}),v.effect&&r.jsxs("div",{style:Ze.giftEffect,children:[" ",typeof v.effect=="object"?`${v.effect.kind==="heal"?"":v.effect.kind==="exp"?"":v.effect.kind==="aptitude"?"":""} +${v.effect.amount}`:v.effect]})]}),r.jsx("div",{style:Ze.message,children:typeof c.message=="string"?c.message:JSON.stringify(c.message)})]})]},m.id)})}),r.jsxs("div",{style:Ze.footer,children:[r.jsxs("button",{style:Ze.confirmBtn,onClick:l,disabled:s.size===0,children:[" (",s.size,")"]}),r.jsx("button",{style:Ze.cancelBtn,onClick:n,children:""})]})]})})},Ze={overlay:{position:"fixed",top:0,left:0,right:0,bottom:0,background:"rgba(0, 0, 0, 0.75)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:3e3,padding:"20px"},modal:{background:"linear-gradient(135deg, #fff9c4 0%, #fff59d 100%)",borderRadius:"16px",width:"90%",maxWidth:"850px",maxHeight:"85vh",display:"flex",flexDirection:"column",boxShadow:"0 10px 40px rgba(0,0,0,0.3)",overflow:"hidden",border:"2px solid #fdd835"},header:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"20px 24px",borderBottom:"2px solid #fdd835",background:"linear-gradient(90deg, #fff9c4, #fff176)",flexShrink:0},title:{margin:0,fontSize:"22px",color:"#f57f17",fontWeight:"bold"},closeIcon:{background:"none",border:"none",fontSize:"28px",cursor:"pointer",color:"#f57f17",padding:"0",lineHeight:"1"},subtitle:{padding:"16px 24px",fontSize:"14px",color:"#666",borderBottom:"1px solid #fdd835",flexShrink:0},toolbar:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"12px 24px",background:"#fffde7",borderBottom:"1px solid #e0e0e0",flexShrink:0},selectAllBtn:{padding:"6px 16px",background:"#fdd835",color:"#333",border:"none",borderRadius:"6px",cursor:"pointer",fontSize:"13px",fontWeight:"500"},selectionInfo:{fontSize:"13px",color:"#666"},eventList:{flex:1,overflowY:"auto",padding:"16px 24px",display:"flex",flexDirection:"column",gap:"16px"},eventCard:{display:"flex",gap:"12px",padding:"16px",border:"2px solid #e0e0e0",borderRadius:"12px",cursor:"pointer",transition:"all 0.2s",background:"#fff"},checkbox:{flexShrink:0,display:"flex",alignItems:"flex-start",paddingTop:"4px"},checkboxInput:{width:"18px",height:"18px",cursor:"pointer"},cardContent:{flex:1,display:"flex",flexDirection:"column",gap:"12px"},promotionHeader:{display:"flex",justifyContent:"space-between",alignItems:"center",paddingBottom:"12px",borderBottom:"1px dashed #e0e0e0"},childInfo:{display:"flex",alignItems:"center",gap:"8px"},childName:{fontSize:"18px",fontWeight:"bold",color:"#333"},childGender:{fontSize:"14px",color:"#999"},promotionBadge:{display:"flex",alignItems:"center",gap:"8px"},promotionLabel:{fontSize:"12px",color:"#666"},rankBadge:{padding:"4px 12px",borderRadius:"12px",color:"#fff",fontSize:"13px",fontWeight:"bold"},sectInfo:{display:"flex",alignItems:"center",gap:"8px",padding:"8px 12px",background:"#e3f2fd",borderRadius:"8px"},sectIcon:{fontSize:"16px"},sectName:{fontSize:"14px",color:"#1976d2",fontWeight:"600"},giftSection:{display:"flex",flexDirection:"column",gap:"8px",padding:"12px",background:"#f3e5f5",borderRadius:"8px",border:"1px solid #ce93d8"},giftHeader:{display:"flex",alignItems:"center",gap:"8px"},giftLabel:{fontSize:"13px",color:"#666",fontWeight:"500"},giftName:{fontSize:"15px",fontWeight:"bold"},giftDesc:{fontSize:"12px",color:"#666",fontStyle:"italic"},giftStats:{display:"flex",gap:"8px",flexWrap:"wrap"},statBadge:{padding:"3px 8px",background:"#fff",borderRadius:"8px",fontSize:"11px",color:"#666",fontWeight:"500",border:"1px solid #e0e0e0"},giftEffect:{fontSize:"12px",color:"#4caf50",fontWeight:"500"},message:{fontSize:"13px",color:"#555",lineHeight:"1.5",padding:"8px 12px",background:"#fff8e1",borderRadius:"8px",border:"1px solid #fff176"},footer:{display:"flex",gap:"12px",padding:"16px 24px",borderTop:"2px solid #fdd835",background:"#fffde7",flexShrink:0},confirmBtn:{flex:1,padding:"12px",background:"#4caf50",color:"#fff",border:"none",borderRadius:"8px",cursor:"pointer",fontSize:"15px",fontWeight:"bold",transition:"all 0.2s"},cancelBtn:{padding:"12px 24px",background:"#e0e0e0",border:"none",borderRadius:"8px",cursor:"pointer",fontSize:"15px"}},QC=({marriagePlans:e,onConfirm:t,onClose:n,onModify:s})=>{const[o,i]=b.useState(new Set(e.map(c=>c.childId))),a=c=>{const m=new Set(o);m.has(c)?m.delete(c):m.add(c),i(m)},l=()=>{o.size===e.length?i(new Set):i(new Set(e.map(c=>c.childId)))},d=()=>{const c=e.filter(m=>o.has(m.childId));t(c)},u=o.size*500,p=c=>{switch(c){case"talented":return" ";case"beautiful":return" ";case"wise":return" ";case"buddha":return" ";default:return" "}};return r.jsx("div",{style:We.overlay,children:r.jsxs("div",{style:We.modal,children:[r.jsxs("div",{style:We.header,children:[r.jsx("h3",{style:We.title,children:" "}),r.jsx("button",{onClick:n,style:We.closeIcon,children:""})]}),r.jsxs("div",{style:We.summary,children:[r.jsxs("div",{style:We.summaryItem,children:[r.jsx("span",{style:We.summaryLabel,children:""}),r.jsxs("span",{style:We.summaryValue,children:[e.length," "]})]}),r.jsxs("div",{style:We.summaryItem,children:[r.jsx("span",{style:We.summaryLabel,children:""}),r.jsxs("span",{style:{...We.summaryValue,color:"#4caf50"},children:[o.size," "]})]}),r.jsxs("div",{style:We.summaryItem,children:[r.jsx("span",{style:We.summaryLabel,children:""}),r.jsxs("span",{style:{...We.summaryValue,color:"#ff9800"},children:[u," "]})]})]}),r.jsxs("div",{style:We.toolbar,children:[r.jsx("button",{onClick:l,style:We.selectAllBtn,children:o.size===e.length?" ":""}),r.jsx("div",{style:We.hint,children:""})]}),r.jsx("div",{style:We.planList,children:e.map(c=>{var E,S,g,h,x,k,_,y,R,C,I,T;const m=o.has(c.childId),v=c.childRef,w=c.spouse;return r.jsxs("div",{style:{...We.planCard,borderColor:m?"#4caf50":"#e0e0e0",background:m?"#f1f8f4":"#fff",opacity:m?1:.6},onClick:()=>a(c.childId),children:[r.jsx("div",{style:We.checkbox,children:r.jsx("input",{type:"checkbox",checked:m,onChange:()=>a(c.childId),style:We.checkboxInput})}),r.jsxs("div",{style:We.cardContent,children:[r.jsxs("div",{style:We.personSection,children:[r.jsx("div",{style:We.avatarWrapper,children:r.jsx(Gr,{avatar:v.avatar,gender:v.gender,size:60})}),r.jsxs("div",{style:We.personInfo,children:[r.jsx("div",{style:We.personName,children:v.name}),r.jsxs("div",{style:We.personDetail,children:[v.gender===""?"":""," | ",v.tierTitle||""]}),r.jsxs("div",{style:We.stats,children:[r.jsxs("span",{style:We.statItem,children:[" ",((E=v.stats)==null?void 0:E.aptitude)||0]}),r.jsxs("span",{style:We.statItem,children:[" ",((S=v.stats)==null?void 0:S.looks)||0]}),r.jsxs("span",{style:We.statItem,children:[" ",((g=v.stats)==null?void 0:g.intelligence)||0]})]})]})]}),r.jsxs("div",{style:We.arrow,children:[r.jsx("div",{style:We.arrowIcon,children:""}),r.jsx("div",{style:We.arrowLine})]}),r.jsxs("div",{style:We.personSection,children:[r.jsx("div",{style:We.avatarWrapper,children:r.jsx(Gr,{avatar:w.avatar,gender:w.gender,size:60})}),r.jsxs("div",{style:We.personInfo,children:[r.jsxs("div",{style:We.personName,children:[w.name,r.jsx("span",{style:We.archetypeBadge,children:p(w.archetype)})]}),r.jsxs("div",{style:We.personDetail,children:[w.gender===""?"":""," | ",w.tierTitle||""]}),r.jsxs("div",{style:We.stats,children:[r.jsxs("span",{style:{...We.statItem,color:((h=w.stats)==null?void 0:h.aptitude)>=80?"#e91e63":"#666"},children:[" ",((x=w.stats)==null?void 0:x.aptitude)||0]}),r.jsxs("span",{style:{...We.statItem,color:((k=w.stats)==null?void 0:k.looks)>=80?"#e91e63":"#666"},children:[" ",((_=w.stats)==null?void 0:_.looks)||0]}),r.jsxs("span",{style:{...We.statItem,color:((y=w.stats)==null?void 0:y.intelligence)>=80?"#e91e63":"#666"},children:[" ",((R=w.stats)==null?void 0:R.intelligence)||0]})]})]})]}),r.jsx("div",{style:We.spiritRootSection,children:r.jsxs("div",{style:We.spiritRoot,children:["",((C=w.spiritRoot)==null?void 0:C.type)||"",((T=(I=w.spiritRoot)==null?void 0:I.elements)==null?void 0:T.length)>0&&` (${w.spiritRoot.elements.join("")})`]})})]})]},c.childId)})}),r.jsxs("div",{style:We.footer,children:[r.jsxs("button",{style:We.confirmBtn,onClick:d,disabled:o.size===0,children:[" (",o.size,"   ",u," )"]}),r.jsx("button",{style:We.cancelBtn,onClick:n,children:""})]})]})})},We={overlay:{position:"fixed",top:0,left:0,right:0,bottom:0,background:"rgba(0, 0, 0, 0.75)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:3e3,padding:"20px"},modal:{background:"linear-gradient(135deg, #fff8e1 0%, #ffe0b2 100%)",borderRadius:"16px",width:"90%",maxWidth:"1000px",maxHeight:"85vh",display:"flex",flexDirection:"column",boxShadow:"0 10px 40px rgba(0,0,0,0.3)",overflow:"hidden",border:"2px solid #ffb74d"},header:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"20px 24px",borderBottom:"2px solid #ffb74d",background:"linear-gradient(90deg, #ffe0b2, #ffcc80)",flexShrink:0},title:{margin:0,fontSize:"22px",color:"#d84315",fontWeight:"bold"},closeIcon:{background:"none",border:"none",fontSize:"28px",cursor:"pointer",color:"#d84315",padding:"0",lineHeight:"1"},summary:{display:"flex",justifyContent:"space-around",padding:"16px 24px",background:"#fff8e1",borderBottom:"1px solid #ffb74d",flexShrink:0},summaryItem:{display:"flex",flexDirection:"column",alignItems:"center",gap:"4px"},summaryLabel:{fontSize:"12px",color:"#666"},summaryValue:{fontSize:"16px",fontWeight:"bold",color:"#d84315"},toolbar:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"12px 24px",background:"#fafafa",borderBottom:"1px solid #e0e0e0",flexShrink:0},selectAllBtn:{padding:"6px 16px",background:"#ff9800",color:"#fff",border:"none",borderRadius:"6px",cursor:"pointer",fontSize:"13px",fontWeight:"500"},hint:{fontSize:"12px",color:"#999",fontStyle:"italic"},planList:{flex:1,overflowY:"auto",padding:"16px 24px",display:"flex",flexDirection:"column",gap:"16px"},planCard:{display:"flex",gap:"12px",padding:"16px",border:"2px solid #e0e0e0",borderRadius:"16px",cursor:"pointer",transition:"all 0.2s",background:"#fff"},checkbox:{flexShrink:0,display:"flex",alignItems:"center"},checkboxInput:{width:"20px",height:"20px",cursor:"pointer"},cardContent:{flex:1,display:"flex",alignItems:"center",gap:"20px"},personSection:{flex:1,display:"flex",gap:"12px",alignItems:"center"},avatarWrapper:{flexShrink:0},personInfo:{flex:1,display:"flex",flexDirection:"column",gap:"6px"},personName:{fontSize:"16px",fontWeight:"bold",color:"#333",display:"flex",alignItems:"center",gap:"8px"},archetypeBadge:{fontSize:"11px",padding:"2px 8px",background:"#e91e63",color:"#fff",borderRadius:"10px",fontWeight:"500"},personDetail:{fontSize:"13px",color:"#666"},stats:{display:"flex",gap:"12px",fontSize:"12px"},statItem:{color:"#666"},arrow:{display:"flex",flexDirection:"column",alignItems:"center",gap:"4px",flexShrink:0},arrowIcon:{fontSize:"20px"},arrowLine:{width:"2px",height:"40px",background:"linear-gradient(to bottom, #e91e63, #f06292)",borderRadius:"1px"},spiritRootSection:{width:"100%",padding:"8px 12px",background:"#fff3e0",borderRadius:"8px",fontSize:"12px",color:"#e65100",marginTop:"8px"},spiritRoot:{fontWeight:"500"},footer:{display:"flex",gap:"12px",padding:"16px 24px",borderTop:"2px solid #ffb74d",background:"#fff8e1",flexShrink:0},confirmBtn:{flex:1,padding:"12px",background:"#4caf50",color:"#fff",border:"none",borderRadius:"8px",cursor:"pointer",fontSize:"15px",fontWeight:"bold",transition:"all 0.2s"},cancelBtn:{padding:"12px 24px",background:"#e0e0e0",border:"none",borderRadius:"8px",cursor:"pointer",fontSize:"15px"}},JC=({manualItems:e,children:t,onAssign:n,onClose:s})=>{const[o,i]=b.useState([]),[a,l]=b.useState("AUTO"),u=(()=>{const S=[];return e.forEach(g=>{(g.manualIds&&g.manualIds.length?g.manualIds:g.manualId?[g.manualId]:[]).forEach(x=>{const k=vn[x];k&&t.forEach(_=>{var I,T,L;if(!_||!_.spiritRoot||_.cultivationMethod===x)return;const y=Nc(x,_.spiritRoot);if(!(y!=null&&y.compatibility))return;const C=(y.compatibility.compatibility||0)+(((I=_.stats)==null?void 0:I.aptitude)||0)/200;S.push({manualId:x,manualName:k.name,childId:_.id,childName:_.name,childTier:_.tierTitle||"",childAptitude:((T=_.stats)==null?void 0:T.aptitude)||0,currentManual:_.cultivationMethod,currentManualName:((L=vn[_.cultivationMethod])==null?void 0:L.name)||"",compatibility:y.compatibility,score:C,itemInstanceId:g.instanceId})})})}),S.sort((g,h)=>h.score-g.score)})(),c=(()=>{const S=new Map;return u.forEach(g=>{const h=S.get(g.childId);(!h||g.score>h.score)&&S.set(g.childId,g)}),Array.from(S.values()).filter(g=>{var x,k,_;const h=((_=(k=Nc(g.currentManual,(x=t.find(y=>y.id===g.childId))==null?void 0:x.spiritRoot))==null?void 0:k.compatibility)==null?void 0:_.compatibility)||0;return g.compatibility.compatibility>h}).slice(0,10)})(),m=S=>{const g=`${S.childId}-${S.manualId}`,h=o.findIndex(x=>`${x.childId}-${x.manualId}`===g);h>=0?i(x=>x.filter((k,_)=>_!==h)):i(x=>[...x.filter(k=>k.childId!==S.childId),S])},v=()=>{i(c)},w=()=>{n(o)},E=S=>{switch(S){case"":return"#4caf50";case"":return"#8bc34a";case"":return"#ffc107";case"":return"#ff9800";case"":return"#f44336";default:return"#9e9e9e"}};return r.jsx("div",{style:Ue.overlay,children:r.jsxs("div",{style:Ue.modal,children:[r.jsxs("div",{style:Ue.header,children:[r.jsx("h3",{style:Ue.title,children:" "}),r.jsx("button",{onClick:s,style:Ue.closeIcon,children:""})]}),r.jsxs("div",{style:Ue.modeSwitch,children:[r.jsx("button",{style:{...Ue.modeBtn,...a==="AUTO"?Ue.modeBtnActive:{}},onClick:()=>l("AUTO"),children:" "}),r.jsx("button",{style:{...Ue.modeBtn,...a==="MANUAL"?Ue.modeBtnActive:{}},onClick:()=>l("MANUAL"),children:" "})]}),a==="AUTO"?r.jsxs("div",{style:Ue.content,children:[r.jsxs("div",{style:Ue.recommendHeader,children:[r.jsxs("div",{style:Ue.recommendTitle,children:[" ",c.length," "]}),c.length>0&&r.jsx("button",{onClick:v,style:Ue.quickSelectBtn,children:" "})]}),c.length===0?r.jsx("div",{style:Ue.empty,children:" "}):r.jsx("div",{style:Ue.optionList,children:c.map((S,g)=>{const h=o.some(x=>x.childId===S.childId&&x.manualId===S.manualId);return r.jsxs("div",{style:{...Ue.optionCard,borderColor:h?"#4caf50":"#e0e0e0",background:h?"#f1f8f4":"#fff"},onClick:()=>m(S),children:[r.jsxs("div",{style:Ue.optionHeader,children:[r.jsx("input",{type:"checkbox",checked:h,onChange:()=>m(S),style:Ue.checkbox}),r.jsxs("div",{style:Ue.optionInfo,children:[r.jsxs("div",{style:Ue.childInfo,children:[S.childName," (",S.childTier,")"]}),r.jsxs("div",{style:Ue.manualChange,children:[r.jsx("span",{style:Ue.oldManual,children:S.currentManualName}),r.jsx("span",{style:Ue.arrow,children:""}),r.jsx("span",{style:Ue.newManual,children:S.manualName})]})]})]}),r.jsxs("div",{style:Ue.compatibilityRow,children:[r.jsx("span",{style:Ue.compatibilityLabel,children:""}),r.jsxs("span",{style:{...Ue.compatibilityValue,color:E(S.compatibility.level)},children:[S.compatibility.level," (",S.compatibility.compatibility,"%)"]}),r.jsxs("span",{style:Ue.speedBonus,children:[" ",S.compatibility.speedMultiplier]})]}),S.compatibility.desc&&r.jsxs("div",{style:Ue.compatibilityDesc,children:[" ",S.compatibility.desc]})]},`${S.childId}-${S.manualId}`)})})]}):r.jsxs("div",{style:Ue.content,children:[r.jsxs("div",{style:Ue.allOptionsHeader,children:[" ",u.length," "]}),u.length===0?r.jsx("div",{style:Ue.empty,children:""}):r.jsx("div",{style:Ue.optionList,children:u.slice(0,50).map(S=>{const g=o.some(h=>h.childId===S.childId&&h.manualId===S.manualId);return r.jsxs("div",{style:{...Ue.optionCard,borderColor:g?"#4caf50":"#e0e0e0",background:g?"#f1f8f4":"#fff"},onClick:()=>m(S),children:[r.jsxs("div",{style:Ue.optionHeader,children:[r.jsx("input",{type:"checkbox",checked:g,onChange:()=>m(S),style:Ue.checkbox}),r.jsxs("div",{style:Ue.optionInfo,children:[r.jsxs("div",{style:Ue.childInfo,children:[S.childName," (",S.childTier,", ",S.childAptitude,")"]}),r.jsx("div",{style:Ue.manualName,children:S.manualName})]})]}),r.jsxs("div",{style:Ue.compatibilityRow,children:[r.jsx("span",{style:{...Ue.compatibilityBadge,background:E(S.compatibility.level)},children:S.compatibility.level}),r.jsxs("span",{style:Ue.speedBonus,children:["",S.compatibility.speedMultiplier]})]})]},`${S.childId}-${S.manualId}`)})})]}),r.jsxs("div",{style:Ue.footer,children:[r.jsxs("div",{style:Ue.selectionInfo,children:[" ",o.length," "]}),r.jsxs("div",{style:Ue.footerActions,children:[r.jsxs("button",{style:Ue.confirmBtn,onClick:w,disabled:o.length===0,children:[" (",o.length,")"]}),r.jsx("button",{style:Ue.cancelBtn,onClick:s,children:""})]})]})]})})},Ue={overlay:{position:"fixed",top:0,left:0,right:0,bottom:0,background:"rgba(0, 0, 0, 0.75)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:3e3,padding:"20px"},modal:{background:"#fff",borderRadius:"16px",width:"90%",maxWidth:"900px",maxHeight:"85vh",display:"flex",flexDirection:"column",boxShadow:"0 10px 40px rgba(0,0,0,0.3)",overflow:"hidden"},header:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"20px 24px",borderBottom:"2px solid #7e57c2",background:"linear-gradient(90deg, #ede7f6, #d1c4e9)",flexShrink:0},title:{margin:0,fontSize:"22px",color:"#5e35b1",fontWeight:"bold"},closeIcon:{background:"none",border:"none",fontSize:"28px",cursor:"pointer",color:"#5e35b1",padding:"0",lineHeight:"1"},modeSwitch:{display:"flex",gap:"8px",padding:"16px 24px",background:"#f5f5f5",borderBottom:"1px solid #e0e0e0",flexShrink:0},modeBtn:{flex:1,padding:"10px",background:"#fff",border:"2px solid #e0e0e0",borderRadius:"8px",cursor:"pointer",fontSize:"14px",fontWeight:"500",transition:"all 0.2s"},modeBtnActive:{background:"#7e57c2",color:"#fff",borderColor:"#7e57c2"},content:{flex:1,overflowY:"auto",display:"flex",flexDirection:"column"},recommendHeader:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"16px 24px",background:"#f5f5f5",borderBottom:"1px solid #e0e0e0"},recommendTitle:{fontSize:"14px",color:"#666",fontWeight:"500"},quickSelectBtn:{padding:"6px 16px",background:"#4caf50",color:"#fff",border:"none",borderRadius:"6px",cursor:"pointer",fontSize:"13px"},allOptionsHeader:{padding:"16px 24px",fontSize:"14px",color:"#666",background:"#f5f5f5",borderBottom:"1px solid #e0e0e0"},empty:{padding:"60px 24px",textAlign:"center",fontSize:"15px",color:"#999"},optionList:{padding:"16px 24px",display:"flex",flexDirection:"column",gap:"12px"},optionCard:{padding:"16px",border:"2px solid #e0e0e0",borderRadius:"12px",cursor:"pointer",transition:"all 0.2s",display:"flex",flexDirection:"column",gap:"12px"},optionHeader:{display:"flex",gap:"12px",alignItems:"flex-start"},checkbox:{width:"18px",height:"18px",cursor:"pointer",marginTop:"2px",flexShrink:0},optionInfo:{flex:1,display:"flex",flexDirection:"column",gap:"6px"},childInfo:{fontSize:"15px",fontWeight:"bold",color:"#333"},manualChange:{display:"flex",alignItems:"center",gap:"8px",fontSize:"14px"},oldManual:{color:"#999",textDecoration:"line-through"},arrow:{color:"#666"},newManual:{color:"#7e57c2",fontWeight:"600"},manualName:{fontSize:"14px",color:"#7e57c2",fontWeight:"600"},compatibilityRow:{display:"flex",gap:"12px",alignItems:"center",fontSize:"13px"},compatibilityLabel:{color:"#666"},compatibilityValue:{fontWeight:"600"},compatibilityBadge:{padding:"4px 10px",borderRadius:"12px",color:"#fff",fontSize:"12px",fontWeight:"bold"},speedBonus:{color:"#2196f3",fontWeight:"500"},compatibilityDesc:{fontSize:"12px",color:"#666",fontStyle:"italic",paddingLeft:"30px"},footer:{padding:"16px 24px",borderTop:"2px solid #e0e0e0",background:"#f5f5f5",display:"flex",justifyContent:"space-between",alignItems:"center",flexShrink:0},selectionInfo:{fontSize:"14px",color:"#666"},footerActions:{display:"flex",gap:"12px"},confirmBtn:{padding:"10px 24px",background:"#7e57c2",color:"#fff",border:"none",borderRadius:"8px",cursor:"pointer",fontSize:"15px",fontWeight:"bold",transition:"all 0.2s"},cancelBtn:{padding:"10px 24px",background:"#e0e0e0",border:"none",borderRadius:"8px",cursor:"pointer",fontSize:"15px"}},XC=({modalState:e,closeModal:t,player:n,inventory:s,handleGiftConfirm:o,handleNegotiateConfirm:i,handleShopPurchase:a,handleOptionSelect:l,handleShuraFieldSelect:d,handleBuyAuctionItem:u,handleShowAuctionPlot:p,modalMgr:c,allChildren:m,visibleChildren:v,handleEquipToChild:w,handleUseConsumable:E,handleBatchUseConsumables:S,handleDiscardFromInventory:g,handleGiveToChild:h,handleBatchGiveToChildren:x,handleSell:k,handleAutoAssignManualToChild:_,getMarketPrice:y,testQueue:R,handleTestFinish:C,handleTestQueueClose:I,childSelectorModal:T,handleChildSelectorSelect:L,closeChildSelectorModal:ee,selectedChild:$,childNavigationMeta:O,handleNavigateChild:H,handleChildAction:F,setSelectedChild:se,showSpouseSelection:J,marryingChild:de,spouseCandidates:Ee,handleSpouseSelect:$e,resetSpouseSelection:De,batchGiftEvents:Qe,handleBatchGiftConfirm:Y,handleBatchGiftClose:ue,batchPromotionEvents:ne,handleBatchPromotionConfirm:ce,handleBatchPromotionClose:ae,batchMarriagePlans:je,handleBatchMarriageConfirm:X,handleBatchMarriageClose:Me,handleBatchManualAssign:Ae})=>r.jsxs(r.Fragment,{children:[e.type==="GIFT"&&r.jsx(IC,{npc:e.data,inventory:s,onGift:o,onClose:t}),e.type==="NEGOTIATE"&&r.jsx(RC,{npc:e.data,onNegotiate:i,onClose:t}),e.type==="SHOP"&&r.jsx(MC,{items:e.data.items,playerSpiritStones:n.resources.spiritStones||0,onPurchase:a,onClose:t}),e.type==="RESULT"&&r.jsx(AC,{result:e.data,onClose:t}),e.type==="CONFIRM"&&r.jsx(NC,{message:e.data.message,input:e.data.input,onConfirm:_e=>{e.data.onConfirm(_e),t()},onCancel:t}),e.type==="EVENT"&&r.jsx(LC,{event:e.data.event,npc:e.data.npc,onClose:t,onOptionSelect:l}),e.type==="SHURA_FIELD"&&r.jsx($C,{event:e.data,player:n,onClose:t,onOptionSelect:d}),e.type==="JEALOUSY"&&r.jsx(OC,{event:e.data,onClose:t}),e.type==="AUCTION"&&r.jsx(DC,{auction:e.data,playerResources:n.resources,onClose:t,onBuy:u,onShowPlot:p,playerSoldAuctionItems:n.soldAuctionItems||[]}),c.inventoryModal.open&&r.jsx(HC,{items:s,mode:c.inventoryModal.mode,slot:c.inventoryModal.slot,childId:c.inventoryModal.childId,children:m,batchUseItems:c.inventoryModal.batchUseItems||[],onClose:()=>c.closeInventory(),onEquip:_e=>w(c.inventoryModal.childId,c.inventoryModal.slot,_e),onUse:_e=>E(c.inventoryModal.childId,_e),onBatchUse:(_e,z)=>S(_e,z),onDiscard:_e=>g(_e),onGiveToChild:h,onBatchGive:x,onSell:(_e,z)=>k(_e,z),onAutoAssignManual:_,getMarketPrice:y}),R.length>0&&r.jsx(WC,{child:R[0],onFinish:C,onClose:I}),T.open&&r.jsx(GC,{children:v,item:T.item,items:T.items,isBatch:T.isBatch,onSelect:L,onClose:ee}),$&&r.jsx(b1,{child:$,navigation:O,onNavigate:H,onClose:()=>se(null),onAction:(_e,z)=>F($.id,_e,z)}),J&&de&&r.jsx(YC,{child:de,candidates:Ee,onSelect:$e,onClose:De}),c.showBatchGiftModal&&Qe.length>0&&r.jsx(qC,{giftEvents:Qe,onConfirm:Y,onClose:ue}),c.showBatchPromotionModal&&ne.length>0&&r.jsx(KC,{promotionEvents:ne,onConfirm:ce,onClose:ae}),c.showBatchMarriageModal&&je.length>0&&r.jsx(QC,{marriagePlans:je,onConfirm:X,onClose:Me}),c.showBatchManualModal&&r.jsx(JC,{manualItems:s.filter(_e=>_e.type==="manual"&&(_e.manualIds&&_e.manualIds.length||_e.manualId)),children:v.length?v:m,onAssign:Ae,onClose:()=>c.closeBatchManualModal()})]});function ZC({npc:e,onClose:t,playerAffection:n=0}){var S,g;const[s,o]=b.useState("ALL"),[i,a]=b.useState(0),l=20;if(b.useEffect(()=>{const h=x=>{x.key==="Escape"&&t()};return window.addEventListener("keydown",h),()=>window.removeEventListener("keydown",h)},[t]),b.useEffect(()=>{a(0)},[s]),!e)return null;const d=Number(n)||0,u=Math.max(0,Math.min(100,d));if(d<30)return r.jsx("div",{className:"modal-overlay",onClick:t,children:r.jsxs("div",{className:"npc-log-modal",onClick:h=>h.stopPropagation(),children:[r.jsxs("div",{className:"log-modal-header",children:[r.jsx("div",{className:"log-modal-title",children:r.jsxs("h2",{children:[e.name," "]})}),r.jsx("button",{className:"close-btn",onClick:t,children:""})]}),r.jsxs("div",{className:"log-empty",style:{padding:"80px 20px"},children:[r.jsx("p",{style:{fontSize:"64px",margin:"0 0 20px 0"},children:""}),r.jsx("h3",{style:{color:"#ffd700",marginBottom:"12px"},children:""}),r.jsxs("p",{style:{color:"rgba(255,255,255,0.7)",fontSize:"16px"},children:[" ",e.name," ",r.jsx("br",{})," ",r.jsx("span",{style:{color:"#ffd700",fontWeight:"bold"},children:"30"})," ",e.gender===""?"":"",""]}),r.jsxs("p",{style:{color:"rgba(255,255,255,0.5)",fontSize:"14px",marginTop:"20px"},children:["",r.jsx("span",{style:{color:d<10?"#f44336":"#ff9800"},children:u})," / 30"]})]})]})});const p=VE(e,d),c=s==="ALL"?p:p.filter(h=>h.type===s),m=Math.max(1,Math.ceil(c.length/l)),v=c.slice(i*l,(i+1)*l),w={all:p.length,interaction:p.filter(h=>h.type===bt.INTERACTION).length,stateChange:p.filter(h=>h.type===bt.STATE_CHANGE).length,daily:p.filter(h=>h.type===bt.DAILY).length},E=h=>{switch(h){case bt.INTERACTION:return{icon:"",color:"#4CAF50",label:""};case bt.STATE_CHANGE:return{icon:"",color:"#FF5722",label:""};case bt.DAILY:return{icon:"",color:"#2196F3",label:""};default:return{icon:"",color:"#9E9E9E",label:""}}};return r.jsx("div",{className:"modal-overlay",onClick:t,children:r.jsxs("div",{className:"npc-log-modal",onClick:h=>h.stopPropagation(),children:[r.jsxs("div",{className:"log-modal-header",children:[r.jsxs("div",{className:"log-modal-title",children:[r.jsxs("h2",{children:[e.name," "]}),r.jsxs("p",{className:"log-modal-subtitle",children:[e.gender===""?"":"","..."]})]}),r.jsx("button",{className:"close-btn",onClick:t,children:""})]}),r.jsxs("div",{className:"log-filter-bar",children:[r.jsxs("button",{className:`filter-btn ${s==="ALL"?"active":""}`,onClick:()=>o("ALL"),children:["  (",w.all,")"]}),r.jsxs("button",{className:`filter-btn ${s===bt.INTERACTION?"active":""}`,onClick:()=>o(bt.INTERACTION),children:["  (",w.interaction,")"]}),r.jsxs("button",{className:`filter-btn ${s===bt.STATE_CHANGE?"active":""}`,onClick:()=>o(bt.STATE_CHANGE),children:["  (",w.stateChange,")"]}),r.jsxs("button",{className:`filter-btn ${s===bt.DAILY?"active":""}`,onClick:()=>o(bt.DAILY),children:["  (",w.daily,")"]})]}),r.jsx("div",{className:"log-content",children:c.length===0?r.jsxs("div",{className:"log-empty",children:[r.jsx("p",{children:""}),r.jsx("p",{children:""}),d<80&&p.length<((S=e.logs)==null?void 0:S.length)&&r.jsx("p",{className:"log-hint",children:" "})]}):r.jsx("div",{className:"log-list",children:v.map((h,x)=>{const k=E(h.type);return r.jsxs("div",{className:`log-entry ${h.isSecret?"secret":""}`,children:[r.jsxs("div",{className:"log-header",children:[r.jsxs("span",{className:"log-type-badge",style:{backgroundColor:k.color},children:[k.icon," ",k.label]}),r.jsxs("span",{className:"log-date",children:[" ",h.year,"  ",h.month," "]}),h.isSecret&&r.jsx("span",{className:"secret-badge",title:"",children:""})]}),r.jsx("div",{className:"log-text",children:h.content})]},`${h.timestamp}-${x}`)})})}),c.length>l&&r.jsxs("div",{className:"log-pagination",children:[r.jsx("button",{className:"page-btn",onClick:()=>a(h=>Math.max(0,h-1)),disabled:i<=0,children:""}),r.jsxs("span",{className:"page-info",children:[" ",i+1," / ",m," "]}),r.jsx("button",{className:"page-btn",onClick:()=>a(h=>Math.min(m-1,h+1)),disabled:i>=m-1,children:""})]}),r.jsxs("div",{className:"log-record-count",children:[" ",c.length," "]}),d<80&&((g=e.logs)==null?void 0:g.length)>p.length&&r.jsx("div",{className:"log-footer-hint",children:"  80+ "})]})})}const eT=({player:e,enemy:t,result:n,onClose:s})=>{var d,u;const o=b.useRef(null),[i,a]=b.useState(0),l=b.useMemo(()=>tT((n==null?void 0:n.logs)||[],e),[n==null?void 0:n.logs,e,t]);return b.useEffect(()=>{if(a(0),!l.length)return;const p=setInterval(()=>{a(c=>c>=l.length?(clearInterval(p),c):c+1)},300);return()=>clearInterval(p)},[l.length]),b.useEffect(()=>{o.current&&(o.current.scrollTop=o.current.scrollHeight)},[i]),r.jsx("div",{style:xn.overlay,children:r.jsxs("div",{style:xn.window,children:[r.jsx("div",{style:xn.header,children:" "}),r.jsxs("div",{style:xn.statusBar,children:[r.jsxs("div",{style:xn.fighter,children:[r.jsx("div",{style:xn.avatar,children:""}),r.jsx("div",{children:e.name}),r.jsxs("div",{style:{color:"#d32f2f"},children:["HP: ",((d=e.combatStats)==null?void 0:d.hp)||0]}),r.jsxs("div",{style:{marginTop:6,fontSize:12,color:"#666"},children:[": ",Pn(e).total]})]}),r.jsx("div",{style:xn.vs,children:"VS"}),r.jsxs("div",{style:xn.fighter,children:[r.jsx("div",{style:{...xn.avatar,background:"#d32f2f"},children:""}),r.jsx("div",{children:t.name}),r.jsxs("div",{style:{color:"#d32f2f"},children:["HP: ",((u=t.combatStats)==null?void 0:u.hp)||0]}),r.jsxs("div",{style:{marginTop:6,fontSize:12,color:"#666"},children:[": ",Pn(t).total]})]})]}),r.jsx("div",{style:{padding:"10px 15px",fontSize:12,color:"#444",background:"#fff8",borderBottom:"1px solid #eee"},children:""}),r.jsx("div",{style:xn.logBox,ref:o,children:l.slice(0,i).map((p,c)=>r.jsxs("div",{style:xn.entryRow,children:[r.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8},children:[r.jsx("div",{style:{fontSize:16},children:p.icon}),r.jsxs("div",{children:[r.jsx("div",{style:{fontSize:13,color:p.isDamage?p.byPlayer?"#2e7d32":"#d32f2f":"#444",fontWeight:600},children:p.text}),p.damage!=null&&r.jsxs("div",{style:{fontSize:12,color:"#666",marginTop:4},children:[": ",r.jsx("strong",{style:{color:p.byPlayer?"#2e7d32":"#d32f2f"},children:p.damage}),p.defended?"":""]})]})]}),p.maxHp!=null&&r.jsxs("div",{style:xn.hpBarWrap,children:[r.jsx("div",{style:xn.hpBarBg,children:r.jsx("div",{style:{...xn.hpBarFill,width:`${Math.max(0,Math.min(100,Math.floor(p.remaining/p.maxHp*100)))}%`,background:p.byPlayer?"#2e7d32":"#d32f2f"}})}),r.jsxs("div",{style:{fontSize:12,color:"#333",marginLeft:8},children:[p.remaining,"/",p.maxHp," HP"]})]})]},c))}),r.jsx("button",{onClick:s,style:{...xn.btn,background:n.success?"#4caf50":"#d32f2f"},children:n.success?"":""})]})})},xn={overlay:{position:"fixed",top:0,left:0,right:0,bottom:0,background:"rgba(0,0,0,0.85)",zIndex:2200,display:"flex",alignItems:"center",justifyContent:"center"},window:{width:"90%",maxWidth:"400px",background:"#fff",borderRadius:"8px",overflow:"hidden",display:"flex",flexDirection:"column",boxShadow:"0 0 20px rgba(255,0,0,0.5)"},header:{background:"#212121",color:"#fff",padding:"15px",textAlign:"center",fontSize:"18px",fontWeight:"bold"},statusBar:{display:"flex",justifyContent:"space-between",padding:"15px",background:"#f5f5f5",borderBottom:"1px solid #ddd"},fighter:{textAlign:"center",fontSize:"12px"},avatar:{width:"40px",height:"40px",borderRadius:"50%",background:"#333",color:"white",display:"flex",alignItems:"center",justifyContent:"center",margin:"0 auto 5px"},vs:{fontSize:"24px",fontStyle:"italic",fontWeight:"bold",color:"#999",alignSelf:"center"},logBox:{padding:"15px",height:"250px",overflowY:"auto",background:"#fff",fontSize:"13px",lineHeight:"1.6"},entryRow:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"8px 0",borderBottom:"1px dashed #eee"},hpBarWrap:{display:"flex",alignItems:"center",gap:8},hpBarBg:{width:140,height:10,background:"#eee",borderRadius:6,overflow:"hidden"},hpBarFill:{height:"100%",borderRadius:6,transition:"width 0.3s ease"},btn:{padding:"15px",border:"none",color:"#fff",fontSize:"16px",cursor:"pointer",fontWeight:"bold"}};function tT(e=[],t,n){const s=[],o=/(.+)  (.+)  (\d+) ()?/,i=/(.+)  (.+)  (\d+) ()?/,a=/(.+)  HP: (\d+)\/(\d+)/;for(let l=0;l<e.length;l++){const d=e[l];let u=d.match(o)||d.match(i);if(u){const p=u[1],c=u[2],m=Number(u[3]),v=!!u[4];let w=null,E=null;if(l+1<e.length){const g=e[l+1].match(a);g&&g[1]===c&&(w=Number(g[2]),E=Number(g[3]),l++)}const S=p===t.name;s.push({icon:S?"":"",text:`${p}  ${c}`,damage:m,remaining:w,maxHp:E,defended:v,isDamage:!0,byPlayer:S});continue}s.push({icon:"",text:d,isDamage:!1})}return s}const nT=({open:e,realmName:t,progress:n,total:s,event:o,log:i,optionContext:a,onSelectOption:l,onNext:d,onStartCombat:u,onClose:p})=>{const[c,m]=b.useState(null),[v,w]=b.useState(null),[E,S]=b.useState(!1),[g,h]=b.useState(!1),[x,k]=b.useState("");if(b.useEffect(()=>{e&&S(!0)},[e]),!e)return null;const _=()=>{if(!o)return"";switch(o.kind){case"COMBAT":return"";case"BOSS":return"";case"TREASURE":return"";case"MYSTERY":return"";default:return""}},y=()=>{if(!o)return"#4a5568";switch(o.kind){case"COMBAT":return"#d32f2f";case"BOSS":return"#7b1fa2";case"TREASURE":return"#f57c00";case"MYSTERY":return"#1976d2";default:return"#388e3c"}},R=(n/s*100).toFixed(0),C=L=>{k(L.label),h(!0),l(L)},I=()=>{h(!1),k(""),setTimeout(()=>{d()},300)},T=()=>{k(""),h(!0),u()};return r.jsxs("div",{style:st.overlay,children:[r.jsxs("div",{style:{...st.window,animation:E?"slideIn 0.3s ease-out":"none"},children:[r.jsxs("div",{style:{...st.header,background:`linear-gradient(135deg, ${y()}, ${y()}dd)`},children:[r.jsxs("div",{style:st.headerTop,children:[r.jsxs("span",{style:st.realmTitle,children:[_()," ",t]}),r.jsx("button",{style:st.closeIconBtn,onClick:p,onMouseEnter:()=>w("close"),onMouseLeave:()=>w(null),children:""})]}),r.jsxs("div",{style:st.progressContainer,children:[r.jsx("div",{style:{...st.progressBar,width:`${R}%`,background:"linear-gradient(90deg, #ffd54f, #ffb300)"}}),r.jsxs("span",{style:st.progressText,children:[n," / ",s]})]})]}),r.jsxs("div",{style:st.body,children:[r.jsxs("div",{style:{...st.eventCard,borderLeft:`4px solid ${y()}`},children:[r.jsxs("div",{style:st.eventHeader,children:[r.jsx("span",{style:{...st.eventBadge,background:y()},children:(o==null?void 0:o.kind)||""}),r.jsx("h3",{style:st.eventTitle,children:(o==null?void 0:o.title)||""})]}),r.jsx("p",{style:st.eventDesc,children:(o==null?void 0:o.desc)||""})]}),(o==null?void 0:o.options)&&o.options.length>0&&r.jsxs("div",{style:st.optionsContainer,children:[r.jsx("div",{style:st.optionsLabel,children:" "}),r.jsx("div",{style:st.options,children:o.options.map((L,ee)=>{const $=a||{},O=!L.condition||L.condition($);return r.jsxs("button",{style:{...st.optionBtn,...c===ee&&O?st.optionBtnHover:{},...O?{}:st.optionBtnDisabled},onMouseEnter:()=>m(ee),onMouseLeave:()=>m(null),onClick:()=>{O&&C(L)},disabled:!O,"aria-disabled":!O,children:[r.jsx("span",{style:st.optionIcon,children:""}),r.jsx("span",{style:st.optionLabel,children:L.label})]},ee)})})]}),((o==null?void 0:o.kind)==="COMBAT"||(o==null?void 0:o.kind)==="BOSS")&&r.jsxs("button",{style:{...st.fightBtn,...v==="fight"?st.fightBtnHover:{}},onMouseEnter:()=>w("fight"),onMouseLeave:()=>w(null),onClick:T,children:[r.jsx("span",{style:st.fightIcon,children:""}),r.jsx("span",{children:""})]})]}),r.jsx("div",{style:st.footer,children:r.jsx("button",{style:{...st.actionBtn,...st.exitBtn,...v==="exit"?st.exitBtnHover:{}},onMouseEnter:()=>w("exit"),onMouseLeave:()=>w(null),onClick:p,children:r.jsx("span",{children:""})})})]}),g&&r.jsx("div",{style:st.resultOverlay,children:r.jsxs("div",{style:st.resultBox,children:[r.jsx("div",{style:st.resultIcon,children:""}),r.jsx("div",{style:st.resultTitle,children:""}),r.jsx("div",{style:st.resultMessage,children:i&&i.length>0?i[i.length-1]:x}),r.jsx("button",{style:{...st.resultBtn,...v==="result"?st.resultBtnHover:{}},onMouseEnter:()=>w("result"),onMouseLeave:()=>w(null),onClick:I,children:""})]})}),r.jsx("style",{children:`
        @keyframes slideIn {
          from {
            opacity: 0;
            transform: translateY(-30px) scale(0.95);
          }
          to {
            opacity: 1;
            transform: translateY(0) scale(1);
          }
        }
        @keyframes fadeIn {
          from {
            opacity: 0;
            transform: translateX(-10px);
          }
          to {
            opacity: 1;
            transform: translateX(0);
          }
        }
        @keyframes popIn {
          0% {
            opacity: 0;
            transform: scale(0.8);
          }
          50% {
            transform: scale(1.05);
          }
          100% {
            opacity: 1;
            transform: scale(1);
          }
        }
        @keyframes bounce {
          0%, 100% {
            transform: translateY(0);
          }
          50% {
            transform: translateY(-10px);
          }
        }
      `})]})},st={overlay:{position:"fixed",top:0,left:0,right:0,bottom:0,background:"rgba(0, 0, 0, 0.75)",backdropFilter:"blur(4px)",zIndex:2100,display:"flex",alignItems:"center",justifyContent:"center",padding:"20px"},window:{width:"100%",maxWidth:"600px",background:"linear-gradient(to bottom, #ffffff, #f8f9fa)",borderRadius:"16px",boxShadow:"0 20px 60px rgba(0, 0, 0, 0.4)",overflow:"hidden",display:"flex",flexDirection:"column",maxHeight:"90vh"},header:{color:"#fff",padding:"16px 20px",position:"relative"},headerTop:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"12px"},realmTitle:{fontSize:"18px",fontWeight:"bold",textShadow:"0 2px 4px rgba(0,0,0,0.2)"},closeIconBtn:{background:"rgba(255,255,255,0.2)",border:"none",color:"#fff",width:"32px",height:"32px",borderRadius:"50%",cursor:"pointer",fontSize:"20px",display:"flex",alignItems:"center",justifyContent:"center",transition:"all 0.2s ease",":hover":{background:"rgba(255,255,255,0.3)"}},progressContainer:{position:"relative",background:"rgba(0,0,0,0.2)",height:"24px",borderRadius:"12px",overflow:"hidden"},progressBar:{height:"100%",transition:"width 0.5s ease",borderRadius:"12px",boxShadow:"inset 0 2px 4px rgba(0,0,0,0.1)"},progressText:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",fontSize:"13px",fontWeight:"bold",textShadow:"0 1px 2px rgba(0,0,0,0.3)"},body:{padding:"20px",flex:1,overflowY:"auto"},eventCard:{background:"#fff",borderRadius:"12px",padding:"16px",marginBottom:"16px",boxShadow:"0 2px 8px rgba(0,0,0,0.08)"},eventHeader:{display:"flex",alignItems:"center",gap:"10px",marginBottom:"10px"},eventBadge:{padding:"4px 12px",borderRadius:"12px",color:"#fff",fontSize:"11px",fontWeight:"bold",textTransform:"uppercase",letterSpacing:"0.5px"},eventTitle:{fontSize:"18px",fontWeight:"bold",color:"#1a202c",margin:0},eventDesc:{fontSize:"14px",color:"#4a5568",lineHeight:1.7,margin:0},optionsContainer:{marginBottom:"16px"},optionsLabel:{fontSize:"13px",fontWeight:"600",color:"#2d3748",marginBottom:"10px"},options:{display:"grid",gridTemplateColumns:"1fr",gap:"10px"},optionBtn:{display:"flex",alignItems:"center",gap:"10px",padding:"14px 16px",border:"2px solid #e2e8f0",borderRadius:"10px",background:"#fff",cursor:"pointer",fontSize:"14px",fontWeight:"500",color:"#2d3748",transition:"all 0.2s ease",textAlign:"left"},optionBtnHover:{border:"2px solid #4299e1",background:"#ebf8ff",transform:"translateX(4px)",boxShadow:"0 4px 12px rgba(66, 153, 225, 0.15)"},optionBtnDisabled:{borderColor:"#cbd5e1",background:"#f8fafc",color:"#94a3b8",cursor:"not-allowed",opacity:.7},optionIcon:{fontSize:"16px"},optionLabel:{flex:1},fightBtn:{width:"100%",display:"flex",alignItems:"center",justifyContent:"center",gap:"10px",padding:"16px",border:"none",borderRadius:"10px",background:"linear-gradient(135deg, #dc2626, #b91c1c)",color:"#fff",fontWeight:"bold",fontSize:"16px",cursor:"pointer",marginBottom:"16px",transition:"all 0.3s ease",boxShadow:"0 4px 12px rgba(220, 38, 38, 0.3)"},fightBtnHover:{transform:"translateY(-2px)",boxShadow:"0 6px 20px rgba(220, 38, 38, 0.4)"},fightIcon:{fontSize:"20px",animation:"pulse 1.5s ease-in-out infinite"},footer:{display:"flex",gap:"12px",padding:"16px 20px",background:"#fff",borderTop:"1px solid #e2e8f0"},actionBtn:{flex:1,display:"flex",alignItems:"center",justifyContent:"center",gap:"8px",padding:"14px 20px",border:"none",borderRadius:"10px",cursor:"pointer",fontWeight:"600",fontSize:"15px",transition:"all 0.2s ease"},exitBtn:{background:"#f1f5f9",color:"#475569",border:"1px solid #cbd5e1"},exitBtnHover:{background:"#e2e8f0",border:"1px solid #94a3b8"},resultOverlay:{position:"absolute",top:0,left:0,right:0,bottom:0,background:"rgba(0, 0, 0, 0.6)",backdropFilter:"blur(2px)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:10,borderRadius:"16px"},resultBox:{background:"linear-gradient(135deg, #ffffff, #f0f9ff)",borderRadius:"16px",padding:"32px",maxWidth:"400px",width:"90%",boxShadow:"0 20px 60px rgba(0, 0, 0, 0.3)",textAlign:"center",animation:"popIn 0.3s ease-out",border:"2px solid #3b82f6"},resultIcon:{fontSize:"48px",marginBottom:"16px",animation:"bounce 0.6s ease-in-out"},resultTitle:{fontSize:"20px",fontWeight:"bold",color:"#1e40af",marginBottom:"16px"},resultMessage:{fontSize:"15px",color:"#475569",lineHeight:1.8,marginBottom:"24px",padding:"16px",background:"rgba(59, 130, 246, 0.08)",borderRadius:"8px",border:"1px solid rgba(59, 130, 246, 0.2)"},resultBtn:{padding:"12px 32px",background:"linear-gradient(135deg, #3b82f6, #2563eb)",color:"#fff",border:"none",borderRadius:"8px",fontSize:"16px",fontWeight:"600",cursor:"pointer",transition:"all 0.2s ease",boxShadow:"0 4px 12px rgba(59, 130, 246, 0.3)"},resultBtnHover:{transform:"translateY(-2px)",boxShadow:"0 6px 20px rgba(59, 130, 246, 0.4)"}},rT=({event:e,onClose:t,onAssign:n})=>{var m,v,w,E;if(!e)return null;const{child:s,selectableSects:o=[],otherSectOptions:i=[],title:a,message:l}=e,[d,u]=b.useState(!1),p=S=>{if(typeof S.compatibility=="number")return S.compatibility;const g=S.sect||S;return My(s,g)},c=S=>{if(S.admission&&S.admission.qualified===!1)return;const g=S.sect||S,h=S.predictedRank||"";n(s.id,g.id,h)};return r.jsx("div",{style:Gn.overlay,children:r.jsxs("div",{style:Gn.card,children:[r.jsx("h2",{children:a||""}),r.jsx("p",{style:{color:"#444"},children:l}),r.jsxs("div",{style:Gn.content,children:[r.jsxs("div",{style:Gn.childBox,children:[r.jsxs("h3",{children:[s.name," (",s.gender,")"]}),r.jsxs("p",{children:[": ",((m=s.stats)==null?void 0:m.aptitude)||0]}),r.jsxs("p",{children:[": ",r.jsx("strong",{style:{color:((v=s.spiritRoot)==null?void 0:v.color)||"#666"},children:((w=s.spiritRoot)==null?void 0:w.type)||""})]}),r.jsx("div",{style:{display:"flex",gap:6},children:(((E=s.spiritRoot)==null?void 0:E.elements)||[]).map(S=>r.jsx("span",{style:{padding:"4px 8px",background:"#eee",borderRadius:6},children:S},S))})]}),r.jsx("div",{style:Gn.listBox,children:o.map(S=>{var C;const g=S.sect||S,h=S.predictedRank,x=S.resources||[],k=S.admission||{},_=k.qualified!==!1,y=k.summary||k.notes||"",R=_?k.notes||"":((C=k.reasons)==null?void 0:C.join(""))||"";return r.jsxs("div",{style:Gn.sectRow,children:[r.jsxs("div",{children:[r.jsx("div",{style:{fontWeight:"bold"},children:g.name}),r.jsx("div",{style:{fontSize:12,color:"#666"},children:g.desc}),r.jsxs("div",{style:{fontSize:12,color:"#444",marginTop:6},children:[": ",x.join(", ")||""]}),r.jsxs("div",{style:{fontSize:12,color:"#888",marginTop:4},children:[": ",y]}),r.jsx("div",{style:{fontSize:12,color:_?"#1b5e20":"#a00"},children:R})]}),r.jsxs("div",{style:{textAlign:"right"},children:[r.jsxs("div",{style:{marginBottom:6},children:[": ",p(S)]}),r.jsxs("div",{style:{fontSize:12,color:"#333",marginBottom:6},children:[": ",h||""]}),r.jsx("button",{disabled:!_,onClick:()=>c(S),style:{...Gn.btn,opacity:_?1:.4,cursor:_?"pointer":"not-allowed"},children:_?"":""})]})]},g.id)})}),i.length>0&&r.jsxs("div",{style:{marginTop:12},children:[r.jsx("button",{onClick:()=>u(S=>!S),style:Gn.secondaryBtn,children:d?"":""}),d&&r.jsx("div",{style:Gn.otherList,children:i.map(S=>{var _;const g=S.sect||S,h=S.admission||{},x=h.qualified!==!1,k=((_=h.reasons)==null?void 0:_.join(""))||"";return r.jsxs("div",{style:Gn.otherRow,children:[r.jsxs("div",{children:[r.jsx("div",{style:{fontWeight:"bold"},children:g.name}),r.jsx("div",{style:{fontSize:12,color:"#666"},children:h.summary||g.desc}),r.jsx("div",{style:{fontSize:12,color:x?"#1b5e20":"#a00"},children:x?` ${p(S)}  `:`${k}`})]}),r.jsx("button",{disabled:!x,onClick:()=>c(S),style:{...Gn.btn,opacity:x?1:.35,cursor:x?"pointer":"not-allowed"},children:x?"":""})]},g.id)})})]})]}),r.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginTop:12},children:[r.jsx("button",{onClick:t,style:Gn.cancel,children:""}),r.jsx("p",{style:{fontSize:"11px",color:"#999",marginTop:"6px",marginLeft:"10px"},children:""})]})]})})},Gn={overlay:{position:"fixed",inset:0,background:"rgba(0,0,0,0.7)",display:"flex",justifyContent:"center",alignItems:"center",zIndex:500,padding:"10px",overflowY:"auto"},card:{width:"100%",maxWidth:"640px",background:"#fff",borderRadius:12,padding:"16px",maxHeight:"90vh",overflowY:"auto",margin:"auto"},content:{display:"flex",gap:12,flexDirection:window.innerWidth<=768?"column":"row"},childBox:{width:window.innerWidth<=768?"100%":"220px",padding:12,background:"#fafafa",borderRadius:8},listBox:{flex:1,display:"flex",flexDirection:"column",gap:8},sectRow:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:10,borderRadius:8,background:"#fff",boxShadow:"0 1px 4px rgba(0,0,0,0.05)",flexDirection:window.innerWidth<=480?"column":"row",gap:window.innerWidth<=480?"10px":"0"},btn:{padding:"8px 12px",background:"#3e2723",color:"white",border:"none",borderRadius:6,cursor:"pointer",fontSize:"clamp(12px, 3vw, 14px)",whiteSpace:"nowrap"},cancel:{padding:"8px 12px",background:"#ddd",border:"none",borderRadius:6,cursor:"pointer",fontSize:"clamp(12px, 3vw, 14px)"},secondaryBtn:{marginTop:8,padding:"6px 10px",background:"#f5f5f5",border:"1px solid #ccc",borderRadius:6,cursor:"pointer",fontSize:"clamp(12px, 3vw, 13px)"},otherList:{marginTop:10,display:"flex",flexDirection:"column",gap:8},otherRow:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"8px 10px",borderRadius:8,background:"#fafafa"}},Hi=[{id:1,title:"",content:`
      <p> </p>
      <p><strong></strong><strong></strong></p>
      <p><strong></strong></p>
      <br/>
      <p> <strong></strong></p>
      <ul>
        <li> </li>
        <li> </li>
        <li> </li>
        <li> </li>
      </ul>
    `},{id:2,title:"",content:`
      <p> <strong></strong></p>
      <br/>
      <p> <strong></strong></p>
      <ul>
        <li><strong> </strong>NPC</li>
        <li><strong> </strong></li>
        <li><strong> </strong></li>
        <li><strong> </strong></li>
        <li><strong> </strong></li>
        <li><strong> </strong></li>
      </ul>
    `},{id:3,title:"",content:`
      <p> <strong></strong></p>
      <br/>
      <p><strong></strong></p>
      <p><strong></strong>10%</p>
      <br/>
      <p> <strong></strong></p>
      <ul>
        <li> /10% </li>
        <li> 50% </li>
        <li> 100% </li>
      </ul>
      <br/>
      <p> <strong></strong></p>
      <ul>
        <li>></li>
        <li></li>
        <li></li>
      </ul>
    `},{id:4,title:"",content:`
      <p> <strong></strong></p>
      <br/>
      <p><strong></strong></p>
      <ul>
        <li></li>
        <li> <strong>100</strong> </li>
        <li><strong>""</strong></li>
      </ul>
      <br/>
      <p> <strong></strong></p>
      <ul>
        <li> HP()  ATK()</li>
        <li></li>
      </ul>
    `},{id:5,title:"",content:`
      <p> <strong></strong></p>
      <br/>
      <p> <strong></strong></p>
      <p></p>
      <br/>
      <p> <strong></strong></p>
      <ul>
        <li>NPC</li>
        <li> </li>
        <li>6</li>
        <li></li>
      </ul>
      <br/>
      <p style="text-align:center; color:#d32f2f; font-weight:bold;">
        
      </p>
    `}],sT=({onClose:e,onComplete:t})=>{const[n,s]=b.useState(0),o=()=>{n<Hi.length-1?s(n+1):(t&&t(),e())},i=()=>{t&&t(),e()},a=Hi[n],l=(n+1)/Hi.length*100;return r.jsx("div",{style:kn.overlay,children:r.jsxs("div",{style:kn.modal,children:[r.jsxs("div",{style:kn.header,children:[r.jsxs("div",{style:kn.headerContent,children:[r.jsxs("span",{style:kn.stepIndicator,children:[" ",n+1," / ",Hi.length]}),r.jsx("h3",{style:kn.title,children:a.title})]}),r.jsx("button",{onClick:i,style:kn.skipBtn,children:""})]}),r.jsx("div",{style:kn.progressBar,children:r.jsx("div",{style:{...kn.progressFill,width:`${l}%`}})}),r.jsx("div",{style:kn.content,children:r.jsx("div",{style:kn.contentText,dangerouslySetInnerHTML:{__html:a.content}})}),r.jsxs("div",{style:kn.footer,children:[n>0&&r.jsx("button",{onClick:()=>s(n-1),style:kn.prevBtn,children:""}),r.jsx("div",{style:{flex:1}}),r.jsx("button",{onClick:o,style:kn.nextBtn,children:n===Hi.length-1?"":""})]})]})})},kn={overlay:{position:"fixed",top:0,left:0,right:0,bottom:0,background:"rgba(0, 0, 0, 0.85)",zIndex:9999,display:"flex",alignItems:"center",justifyContent:"center",animation:"fadeIn 0.3s ease-in"},modal:{width:"90%",maxWidth:"550px",maxHeight:"85vh",background:"linear-gradient(135deg, #ffffff 0%, #f5f5f5 100%)",borderRadius:"16px",boxShadow:"0 20px 60px rgba(0,0,0,0.5)",display:"flex",flexDirection:"column",overflow:"hidden",border:"2px solid #d4af37"},header:{padding:"20px",background:"linear-gradient(135deg, #5d4037 0%, #3e2723 100%)",color:"#fff",display:"flex",justifyContent:"space-between",alignItems:"flex-start"},headerContent:{flex:1},stepIndicator:{display:"inline-block",background:"rgba(255, 255, 255, 0.2)",padding:"4px 12px",borderRadius:"12px",fontSize:"12px",marginBottom:"8px"},title:{margin:0,fontSize:"20px",fontWeight:"bold"},skipBtn:{background:"transparent",border:"1px solid rgba(255, 255, 255, 0.5)",color:"#fff",padding:"6px 12px",borderRadius:"4px",cursor:"pointer",fontSize:"13px",transition:"all 0.3s"},progressBar:{width:"100%",height:"4px",background:"#e0e0e0"},progressFill:{height:"100%",background:"linear-gradient(90deg, #d4af37 0%, #f4e4a6 100%)",transition:"width 0.3s ease"},content:{flex:1,padding:"30px",overflowY:"auto",fontSize:"14px",lineHeight:"1.8"},contentText:{color:"#333"},footer:{padding:"15px 20px",borderTop:"1px solid #e0e0e0",background:"#fff",display:"flex",justifyContent:"space-between",gap:"10px"},prevBtn:{padding:"10px 20px",background:"#9e9e9e",color:"#fff",border:"none",borderRadius:"6px",cursor:"pointer",fontSize:"14px",fontWeight:"bold",transition:"all 0.3s"},nextBtn:{padding:"10px 24px",background:"linear-gradient(135deg, #d4af37 0%, #f4e4a6 100%)",color:"#3e2723",border:"none",borderRadius:"6px",cursor:"pointer",fontSize:"14px",fontWeight:"bold",transition:"all 0.3s",boxShadow:"0 2px 8px rgba(212, 175, 55, 0.4)"}},Ml=[{id:"INTRO",title:"  ()",content:`
      <p><strong></strong><strong></strong></p>
      <p><strong></strong></p>
      <ul>
        <li><strong></strong></li>
        <li><strong></strong></li>
        <li><strong></strong><strong></strong></li>
        <li><strong></strong></li>
      </ul>
    `},{id:"FEEDBACK",title:"  ()",content:`
      <p><strong></strong></p>
      <div style="background:#eee; padding:10px; border-radius:5px; margin:10px 0;">
        <strong></strong><br/>
            <strong></strong>  <strong></strong>
      </div>
      <p><strong></strong></p>
      <ul>
        <li> <strong>/</strong> (10%)</li>
        <li> <strong></strong> (50%)</li>
        <li> <strong></strong> (100%)</li>
      </ul>
      
      <p><strong style="color:#D32F2F;"> ()</strong></p>
      <div style="background:#fff3e0; padding:12px; border-radius:5px; margin:10px 0; border-left: 4px solid #FF9800;">
        <p style="margin:0 0 8px 0;"><strong></strong></p>
        <ul style="margin:5px 0; padding-left:20px;">
          <li> <strong></strong>1.0 ()</li>
          <li> <strong></strong>1.5 (+50%)</li>
          <li> <strong></strong>3.0 (+200%)</li>
          <li> <strong></strong>6.0 (+500%)</li>
          <li> <strong></strong>12.0 (+1100%)</li>
          <li> <strong></strong>25.0 (+2400%)</li>
          <li> <strong></strong>100.0 (<strong style="color:#D32F2F;">+9900%</strong>)</li>
        </ul>
      </div>
      
      <p><strong></strong>""""100</p>
      <ol style="background:#f5f5f5; padding:12px; border-radius:5px;">
        <li></li>
        <li></li>
        <li><strong></strong></li>
        <li>""</li>
      </ol>
    `},{id:"COMBAT",title:" ",content:`
      <p><strong></strong><strong></strong></p>
      <ul>
        <li><strong></strong></li>
        <li><strong></strong> <strong>100</strong> </li>
        <li><strong></strong> <strong>HP()</strong>  <strong>ATK()</strong></li>
      </ul>
      <p><strong></strong><br/>1. <strong></strong><br/>2. </p>
    `},{id:"COMBAT_RULES",title:" ",content:`
      <p><strong></strong></p>
      <ul>
        <li><strong></strong></li>
        <li><strong></strong> <strong></strong> </li>
        <li><strong></strong></li>
      </ul>
      <div style="background:#fff3e0; padding:12px; border-radius:6px; margin:10px 0; border-left:4px solid #FF9800;">
        <strong></strong>
        <ul style="margin:6px 0 0 16px;">
          <li></li>
          <li></li>
          <li> 10</li>
        </ul>
        <p style="margin:8px 0 0 0;"><strong></strong><strong></strong></p>
      </div>
    `},{id:"ROOTS",title:" ",content:`
      <p>6</p>
      <ul>
        <li><span style="color:#FFD700"> (90-100)</span></li>
        <li><span style="color:#00BCD4"> (80-89)</span>//</li>
        <li><span style="color:#9C27B0">/</span></li>
        <li><span style="color:#9E9E9E">/</span></li>
      </ul>
    `}],oT=({onClose:e,initialTab:t=0})=>{const[n,s]=b.useState(t);return r.jsx("div",{style:Vn.overlay,children:r.jsxs("div",{style:Vn.modalWrapper,children:[r.jsx("button",{onClick:e,style:Vn.closeBtn,"aria-label":"",children:""}),r.jsxs("div",{style:Vn.modal,children:[r.jsx("div",{style:Vn.header,children:r.jsx("h3",{children:" "})}),r.jsxs("div",{style:Vn.body,children:[r.jsx("div",{style:Vn.sidebar,children:Ml.map((o,i)=>r.jsx("div",{onClick:()=>s(i),style:{...Vn.menuItem,background:n===i?"#e0e0e0":"transparent",fontWeight:n===i?"bold":"normal",color:n===i?"#3e2723":"#666"},children:o.title},o.id))}),r.jsxs("div",{style:Vn.content,children:[r.jsx("h4",{style:{marginTop:0,borderBottom:"1px solid #eee",paddingBottom:"10px"},children:Ml[n].title}),r.jsx("div",{style:{lineHeight:"1.6",fontSize:"14px",color:"#444"},dangerouslySetInnerHTML:{__html:Ml[n].content}})]})]}),r.jsx("div",{style:Vn.footer,children:n<Ml.length-1?r.jsx("button",{onClick:()=>s(n+1),style:Vn.nextBtn,children:""}):r.jsx("button",{onClick:e,style:Vn.finishBtn,children:""})})]})]})})},Vn={overlay:{position:"fixed",top:0,left:0,right:0,bottom:0,background:"rgba(0,0,0,0.7)",zIndex:3e3,display:"flex",alignItems:"center",justifyContent:"center"},modalWrapper:{position:"relative",width:"min(600px, calc(100vw - 32px))"},modal:{width:"100%",height:"450px",background:"#fff",borderRadius:"12px",display:"flex",flexDirection:"column",overflow:"hidden",boxShadow:"0 10px 30px rgba(0,0,0,0.3)",position:"relative"},header:{padding:"15px 20px",background:"#3e2723",color:"#fff",display:"flex",justifyContent:"center",alignItems:"center"},closeBtn:{position:"absolute",top:"-18px",left:"-18px",background:"#3e2723",border:"none",color:"#fff",fontSize:"22px",cursor:"pointer",width:"44px",height:"44px",display:"flex",alignItems:"center",justifyContent:"center",borderRadius:"22px",boxShadow:"0 12px 30px rgba(0,0,0,0.25)"},body:{flex:1,display:"flex",overflow:"hidden"},sidebar:{width:"180px",background:"#f5f5f5",borderRight:"1px solid #ddd",overflowY:"auto"},menuItem:{padding:"15px",cursor:"pointer",borderBottom:"1px solid #eee",fontSize:"13px"},content:{flex:1,padding:"20px",overflowY:"auto"},footer:{padding:"10px 20px",borderTop:"1px solid #eee",display:"flex",justifyContent:"flex-end",background:"#fafafa"},nextBtn:{padding:"8px 20px",background:"#2196f3",color:"white",border:"none",borderRadius:"4px",cursor:"pointer"},finishBtn:{padding:"8px 20px",background:"#4caf50",color:"white",border:"none",borderRadius:"4px",cursor:"pointer"}},iT=({gazette:e,onClose:t,history:n=[],playerName:s="",onWorldNpcClick:o,onChildClick:i})=>{var w;const[a,l]=b.useState("current"),[d,u]=b.useState(null);console.log("GazetteModal props:",{gazette:e,history:n,hasGazette:!!e,historyLength:n.length});const p=E=>{if(!E||!s)return E;const S=new RegExp(`(${s})`,"g");return E.split(S).map((h,x)=>h===s?r.jsx("span",{style:{color:"#b33",fontWeight:"bold"},children:h},x):h)};b.useEffect(()=>{!e&&n.length>0&&l("history")},[e,n]);const c=a==="current"?e:d,m=c?{issue:c.issue||"-",year:c.year||0,month:c.month||"-",headlines:Array.isArray(c.headlines)?c.headlines:[],powerRanking:Array.isArray(c.powerRanking)?c.powerRanking:[],sectRanking:Array.isArray(c.sectRanking)?c.sectRanking:[],rumors:Array.isArray(c.rumors)?c.rumors:[]}:{issue:"-",year:0,month:"-",headlines:[],powerRanking:[],sectRanking:[],rumors:[]},v=!e&&n.length===0;return r.jsx("div",{style:Be.overlay,children:r.jsxs("div",{style:Be.modalWrapper,children:[r.jsx("button",{onClick:t,style:Be.closeBtn,"aria-label":"",children:""}),r.jsx("div",{style:Be.modal,children:v?r.jsxs("div",{style:Be.emptyState,children:[r.jsx("div",{style:Be.emptyIcon,children:""}),r.jsx("h3",{style:Be.emptyTitle,children:""}),r.jsx("p",{style:Be.emptyText,children:"36912"}),r.jsx("button",{onClick:t,style:Be.emptyBtn,children:""})]}):r.jsxs(r.Fragment,{children:[r.jsxs("div",{style:Be.tabBar,children:[r.jsx("button",{onClick:()=>l("current"),style:{...Be.tab,background:a==="current"?Ie.colors.primary:Ie.colors.parchment,color:a==="current"?"#fff":Ie.colors.ink,opacity:e?1:.5,cursor:e?"pointer":"not-allowed"},disabled:!e,children:" "}),r.jsxs("button",{onClick:()=>l("history"),style:{...Be.tab,background:a==="history"?Ie.colors.primary:Ie.colors.parchment,color:a==="history"?"#fff":Ie.colors.ink},children:["  (",n.length,")"]})]}),r.jsx("div",{style:Be.content,children:a==="current"?r.jsxs("div",{style:Be.newspaper,children:[r.jsxs("div",{style:Be.header,children:[r.jsx("h1",{style:Be.title,children:""}),r.jsxs("div",{style:Be.subtitle,children:["   ",m.issue," "]}),r.jsxs("div",{style:Be.date,children:[" ",m.year," ",m.month,""]})]}),m.powerRanking&&m.powerRanking.length>0&&r.jsxs("div",{style:Be.section,children:[r.jsx("h3",{style:Be.sectionTitle,children:" - "}),r.jsx("div",{style:Be.ranking,children:m.powerRanking.map((E,S)=>{const g=typeof E=="string"?E:(E==null?void 0:E.displayText)||"",h=typeof E=="object"&&(E==null?void 0:E.worldNpcData)&&!E.isPlayer,x=typeof E=="object"&&(E==null?void 0:E.childData)&&!E.isPlayer,k=h||x;return r.jsx("div",{style:{...Be.rankItem,...k?Be.clickableRankItem:{}},onClick:()=>{h&&o?o(E.worldNpcData):x&&i&&i(E.childData)},children:g},`rank-${S}-${String(g).substring(0,20)}`)})})]}),m.sectRanking&&m.sectRanking.length>0&&r.jsxs("div",{style:Be.section,children:[r.jsx("h3",{style:Be.sectionTitle,children:" - "}),r.jsx("div",{style:Be.ranking,children:m.sectRanking.map((E,S)=>{const g=typeof E=="string"?E:(E==null?void 0:E.displayText)||"",h=typeof E=="object"&&(E==null?void 0:E.worldNpcData);return r.jsxs("div",{style:{...Be.rankItem,...h?Be.clickableRankItem:{}},onClick:()=>{h&&o&&o(E.worldNpcData)},children:[r.jsx("div",{children:g}),h&&r.jsx("div",{style:Be.clickHint,children:""})]},`sect-${S}-${String(g).substring(0,20)}`)})})]}),r.jsxs("div",{style:Be.section,children:[r.jsx("h3",{style:Be.sectionTitle,children:""}),r.jsx("div",{style:Be.newsContent,children:m.headlines&&m.headlines.length>0?m.headlines.map((E,S)=>r.jsxs("p",{style:Be.newsItem,children:[" ",p(E)]},`headline-${S}-${String(E).substring(0,20)}`)):r.jsx("p",{style:Be.placeholder,children:""})})]}),m.rumors&&m.rumors.length>0&&r.jsxs("div",{style:Be.section,children:[r.jsx("h3",{style:Be.sectionTitle,children:""}),r.jsx("div",{style:Be.newsContent,children:m.rumors.map((E,S)=>r.jsxs("p",{style:Be.newsItem,children:[" ",p(E)]},`rumor-${S}-${String(E).substring(0,20)}`))})]}),r.jsxs("div",{style:Be.adSection,children:[r.jsx("div",{style:Be.ad,children:" "}),r.jsx("div",{style:Be.ad,children:" "})]})]}):r.jsx("div",{style:Be.historyView,children:n.length===0?r.jsx("div",{style:Be.emptyHistory,children:""}):d?r.jsxs("div",{children:[r.jsx("button",{onClick:()=>u(null),style:Be.backBtn,children:" "}),r.jsxs("div",{style:Be.newspaper,children:[r.jsxs("div",{style:Be.header,children:[r.jsx("h1",{style:Be.title,children:""}),r.jsxs("div",{style:Be.subtitle,children:[" ",d.issue," "]}),r.jsxs("div",{style:Be.date,children:[" ",d.year," ",d.month,""]})]}),d.powerRanking&&d.powerRanking.length>0&&r.jsxs("div",{style:Be.section,children:[r.jsx("h3",{style:Be.sectionTitle,children:" - "}),r.jsx("div",{style:Be.ranking,children:d.powerRanking.map((E,S)=>r.jsx("div",{style:Be.rankItem,children:typeof E=="string"?E:E.displayText},S))})]}),d.sectRanking&&d.sectRanking.length>0&&r.jsxs("div",{style:Be.section,children:[r.jsx("h3",{style:Be.sectionTitle,children:" - "}),r.jsx("div",{style:Be.ranking,children:d.sectRanking.map((E,S)=>r.jsx("div",{style:Be.rankItem,children:typeof E=="string"?E:E.displayText},S))})]}),r.jsxs("div",{style:Be.section,children:[r.jsx("h3",{style:Be.sectionTitle,children:""}),r.jsx("div",{style:Be.newsContent,children:(w=d.headlines)==null?void 0:w.map((E,S)=>r.jsxs("p",{style:Be.newsItem,children:[" ",E]},S))})]})]})]}):r.jsx("div",{style:Be.historyList,children:n.map((E,S)=>r.jsxs("div",{style:Be.historyItem,onClick:()=>u(E),children:[r.jsxs("div",{style:Be.historyTitle,children:[" ",E.issue," "]}),r.jsxs("div",{style:Be.historyDate,children:[Math.floor(E.year||0)," ",E.month||1,""]})]},`gazette-${E.issue||S}`))})})})]})})]})})},Be={overlay:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0, 0, 0, 0.7)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e3},modalWrapper:{position:"relative",width:"min(800px, calc(100vw - 32px))"},modal:{background:Ie.gradients.warm,borderRadius:"16px",maxWidth:"800px",width:"100%",maxHeight:"85vh",overflow:"hidden",position:"relative",boxShadow:"0 8px 32px rgba(0,0,0,0.3)",border:`3px solid ${Ie.colors.border}`},clickHint:{fontSize:"12px",color:"#8d6e63",marginTop:"4px"},closeBtn:{position:"absolute",top:"-20px",left:"-20px",width:"48px",height:"48px",borderRadius:"50%",border:"none",background:"#b33",color:"white",fontSize:"24px",cursor:"pointer",boxShadow:"0 12px 32px rgba(0,0,0,0.25)",fontWeight:"bold"},tabBar:{display:"flex",gap:"10px",padding:"15px 20px",borderBottom:`2px solid ${Ie.colors.border}`},tab:{padding:"10px 20px",border:"none",borderRadius:"8px",cursor:"pointer",fontWeight:"bold",fontSize:"14px",transition:"all 0.3s"},content:{padding:"20px",maxHeight:"calc(85vh - 100px)",overflowY:"auto"},newspaper:{background:Ie.colors.paper,padding:"30px",borderRadius:"8px",boxShadow:`inset 0 0 20px ${Ie.colors.shadow}`,fontFamily:'"Noto Serif SC", "KaiTi", serif'},header:{textAlign:"center",borderBottom:`3px double ${Ie.colors.border}`,paddingBottom:"20px",marginBottom:"25px"},title:{fontSize:"36px",color:Ie.colors.primary,margin:"0 0 10px 0",letterSpacing:"8px",textShadow:"2px 2px 4px rgba(0,0,0,0.1)"},subtitle:{fontSize:"14px",color:Ie.colors.primary,marginBottom:"5px"},date:{fontSize:"12px",color:Ie.colors.muted},section:{marginBottom:"25px",padding:"15px",background:Ie.gradients.subtle,borderRadius:"8px",border:`1px solid ${Ie.colors.border}`},sectionTitle:{fontSize:"20px",color:Ie.colors.primary,marginBottom:"15px",borderBottom:`2px solid ${Ie.colors.border}`,paddingBottom:"8px"},ranking:{display:"flex",flexDirection:"column",gap:"10px"},rankItem:{fontSize:"16px",padding:"8px",background:Ie.colors.paper,borderRadius:"4px",border:`1px solid ${Ie.colors.border}`},clickableRankItem:{cursor:"pointer",transition:"all 0.3s",":hover":{background:Ie.gradients.subtle,transform:"translateX(5px)",borderColor:Ie.colors.primary}},newsContent:{fontSize:"15px",lineHeight:"1.8",color:Ie.colors.ink},newsItem:{margin:"10px 0",paddingLeft:"15px",textIndent:"0"},placeholder:{color:"#999",fontStyle:"italic",textAlign:"center"},adSection:{marginTop:"30px",padding:"15px",background:Ie.gradients.subtle,borderRadius:"8px",border:`2px dashed ${Ie.colors.border}`},ad:{fontSize:"12px",color:Ie.colors.primary,marginBottom:"5px"},historyView:{minHeight:"400px"},historyList:{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(150px, 1fr))",gap:"15px"},historyItem:{padding:"20px",background:Ie.colors.paper,borderRadius:"8px",border:`2px solid ${Ie.colors.border}`,cursor:"pointer",textAlign:"center",transition:"all 0.3s",":hover":{transform:"translateY(-5px)",boxShadow:`0 4px 12px ${Ie.colors.shadow}`}},historyTitle:{fontSize:"16px",fontWeight:"bold",color:Ie.colors.primary,marginBottom:"8px"},historyDate:{fontSize:"12px",color:Ie.colors.primary},emptyHistory:{textAlign:"center",padding:"50px",color:"#999",fontSize:"16px"},backBtn:{marginBottom:"15px",padding:"8px 16px",background:"#8d6e63",color:"white",border:"none",borderRadius:"8px",cursor:"pointer",fontWeight:"bold"},emptyState:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",padding:"80px 40px",minHeight:"400px"},emptyIcon:{fontSize:"80px",marginBottom:"20px",opacity:.5},emptyTitle:{fontSize:"24px",color:Ie.colors.primary,marginBottom:"10px"},emptyText:{fontSize:"14px",color:Ie.colors.muted,textAlign:"center",lineHeight:"1.6",marginBottom:"30px"},emptyBtn:{padding:"10px 30px",background:Ie.colors.primary,color:"white",border:"none",borderRadius:"8px",cursor:"pointer",fontSize:"14px",fontWeight:"bold",transition:"all 0.3s"}},aT=({worldNpc:e,onClose:t,onInvite:n,onChallenge:s,player:o})=>{var S,g,h;if(!e)return null;const i=x=>x==="male"||x===""?"":x==="female"||x===""?"":x,a=x=>x?typeof x=="string"?x:typeof x=="object"&&x.name?x.name:"":"",l=()=>{var k;if((k=e.appearance)!=null&&k.description&&typeof e.appearance.description=="string")return e.appearance.description;if(e.gender==="female"||e.gender===""){const _=["","","","",""];return _[Math.floor(Math.random()*_.length)]}else{const _=["","","","",""];return _[Math.floor(Math.random()*_.length)]}},d=b.useMemo(()=>l(),[e==null?void 0:e.id]),u=x=>{if(!x)return"";if(typeof x=="string")return x;if(typeof x=="object"){if(x.label)return x.label;if(x.desc)return x.desc;const k=[x.temperament,x.alignment,x.attitude].filter(Boolean);return k.length>0?k[0]:""}return""},p=x=>{if(!x)return"";const k=x.rootType||x.type;return k||(Array.isArray(x.elements)&&x.elements.length>0?x.elements.map(_=>typeof _=="object"?_.element:_).join("")+"":"")},c=(x,k)=>{if(typeof x!="number")return"";const _=k==="female"||k==="";return x>=90?_?"":"":x>=80?_?"":"":x>=70?_?"":"":x>=60?"":""},m=()=>{var O;const x=e.name||"",k=e.title||"",_=e.tier||"",y=a(e.sect),R=e.sectRank?`${y}${e.sectRank}`:null,C=p(e.spiritRoot),I=u(e.personality);c((O=e.stats)==null?void 0:O.looks,e.gender);const T=d,L=y===""?"":R||`${y}`,ee=`${x}${_}${L}${k}${C}${T}${I}${e.signature||""}`,$=`${x}${k}${_}${L}${C}${y===""?"":y}${I}"${e.signature||""}"`;return{summary:ee,bio:$}},{summary:v,bio:w}=m();e.gender!==o.gender&&e.hasMetPlayer;const E=e.sectRank===""&&e.status!=="DEAD";return r.jsx("div",{style:qe.overlay,onClick:t,children:r.jsxs("div",{style:qe.modalWrapper,onClick:x=>x.stopPropagation(),children:[r.jsx("button",{onClick:t,style:qe.closeBtn,"aria-label":"",children:""}),r.jsxs("div",{style:qe.modal,children:[r.jsxs("div",{style:qe.header,children:[r.jsxs("h2",{style:qe.title,children:[e.title&&`${e.title}`,e.name]}),r.jsxs("div",{style:qe.subtitle,children:["  ",e.tier,"  ",i(e.gender)]})]}),r.jsxs("div",{style:qe.content,children:[r.jsxs("div",{style:qe.section,children:[r.jsx("h3",{style:qe.sectionTitle,children:" "}),r.jsxs("div",{style:qe.infoGrid,children:[r.jsx(Ps,{label:"",value:e.name}),r.jsx(Ps,{label:"",value:e.title||""}),r.jsx(Ps,{label:"",value:i(e.gender)}),r.jsx(Ps,{label:"",value:e.tier}),r.jsx(Ps,{label:"",value:a(e.sect)}),e.sectRank&&r.jsx(Ps,{label:"",value:e.sectRank}),r.jsx(Ps,{label:"",value:((S=e.spiritRoot)==null?void 0:S.rootType)||((g=e.spiritRoot)==null?void 0:g.type)||""})]})]}),r.jsxs("div",{style:qe.section,children:[r.jsx("h3",{style:qe.sectionTitle,children:" "}),r.jsx("div",{style:qe.statsGrid,children:e.stats&&Object.entries(e.stats).map(([x,k])=>r.jsxs("div",{style:qe.statItem,children:[r.jsx("span",{style:qe.statLabel,children:lT(x)}),r.jsx("span",{style:qe.statValue,children:Math.floor(k)})]},x))})]}),r.jsxs("div",{style:qe.section,children:[r.jsx("h3",{style:qe.sectionTitle,children:" "}),r.jsx("p",{style:qe.description,children:d})]}),r.jsxs("div",{style:qe.section,children:[r.jsx("h3",{style:qe.sectionTitle,children:" "}),r.jsx("p",{style:qe.description,children:v||""})]}),r.jsxs("div",{style:qe.section,children:[r.jsx("h3",{style:qe.sectionTitle,children:" "}),r.jsx("p",{style:qe.description,children:w||""}),r.jsx("p",{style:qe.hintText,children:"/"})]}),e.personality&&typeof e.personality=="string"&&r.jsxs("div",{style:qe.section,children:[r.jsx("h3",{style:qe.sectionTitle,children:" "}),r.jsx("p",{style:qe.description,children:e.personality})]}),((h=e.spiritRoot)==null?void 0:h.elements)&&Array.isArray(e.spiritRoot.elements)&&r.jsxs("div",{style:qe.section,children:[r.jsx("h3",{style:qe.sectionTitle,children:" "}),r.jsx("div",{style:qe.elementsGrid,children:e.spiritRoot.elements.map((x,k)=>r.jsx("div",{style:qe.elementTag,children:typeof x=="object"?`${x.element} ${x.value}`:x},k))})]}),e.gender!==o.gender&&!e.hasMetPlayer&&(e.gender==="male"||e.gender==="")&&r.jsxs("div",{style:qe.hintBox,children:[r.jsx("div",{style:qe.hintIcon,children:""}),r.jsx("p",{style:qe.hintText,children:""})]}),e.hasMetPlayer&&r.jsx("div",{style:qe.metHint,children:" "}),E&&r.jsxs("div",{style:qe.actionSection,children:[r.jsx("button",{style:qe.challengeBtn,onClick:()=>s&&s(e),children:" "}),r.jsx("div",{style:qe.hintText,children:""})]})]})]})]})})},Ps=({label:e,value:t})=>{const n=typeof t=="object"&&t!==null?JSON.stringify(t):t??"";return r.jsxs("div",{style:qe.infoItem,children:[r.jsxs("span",{style:qe.infoLabel,children:[e,""]}),r.jsx("span",{style:qe.infoValue,children:n})]})},lT=e=>({attack:"",defense:"",speed:"",hp:"",cultivation:"",atk:"",def:"",spd:"",maxHp:"",aptitude:"",looks:"",intelligence:"",health:""})[e]||e,qe={overlay:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0, 0, 0, 0.7)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:2e3},modalWrapper:{position:"relative",width:"min(600px, calc(100vw - 32px))",maxHeight:"85vh"},modal:{background:Ie.gradients.warm,borderRadius:"16px",width:"100%",maxHeight:"85vh",overflow:"hidden",boxShadow:"0 8px 32px rgba(0,0,0,0.3)",border:`3px solid ${Ie.colors.border}`},closeBtn:{position:"absolute",top:"-20px",right:"-20px",width:"48px",height:"48px",borderRadius:"50%",border:"none",background:"#b33",color:"white",fontSize:"24px",cursor:"pointer",boxShadow:"0 4px 12px rgba(0,0,0,0.3)",fontWeight:"bold",zIndex:1},header:{textAlign:"center",padding:"25px 20px",background:"linear-gradient(135deg, #8d6e63 0%, #6d4c41 100%)",color:"white",borderBottom:`3px solid ${Ie.colors.border}`},title:{fontSize:"24px",margin:"0 0 8px 0",fontWeight:"bold",textShadow:"2px 2px 4px rgba(0,0,0,0.3)"},subtitle:{fontSize:"14px",opacity:.9},content:{padding:"20px",maxHeight:"calc(85vh - 120px)",overflowY:"auto"},section:{marginBottom:"20px",padding:"15px",background:Ie.colors.paper,borderRadius:"8px",border:`1px solid ${Ie.colors.border}`},sectionTitle:{fontSize:"16px",color:Ie.colors.primary,marginBottom:"12px",paddingBottom:"8px",borderBottom:`2px solid ${Ie.colors.border}`},infoGrid:{display:"grid",gridTemplateColumns:"repeat(2, 1fr)",gap:"10px"},infoItem:{fontSize:"14px",padding:"5px"},infoLabel:{color:"#666",marginRight:"5px"},infoValue:{color:Ie.colors.ink,fontWeight:"bold"},statsGrid:{display:"grid",gridTemplateColumns:"repeat(3, 1fr)",gap:"10px"},statItem:{display:"flex",flexDirection:"column",alignItems:"center",padding:"10px",background:Ie.gradients.subtle,borderRadius:"6px"},statLabel:{fontSize:"12px",color:"#666",marginBottom:"5px"},statValue:{fontSize:"18px",fontWeight:"bold",color:Ie.colors.primary},description:{fontSize:"14px",lineHeight:"1.6",color:Ie.colors.ink},elementsGrid:{display:"flex",flexWrap:"wrap",gap:"8px"},elementTag:{padding:"6px 12px",background:"linear-gradient(135deg, #fff9e6 0%, #ffe5b4 100%)",border:"1px solid #d4a574",borderRadius:"12px",fontSize:"13px",fontWeight:"bold",color:"#8d6e63"},hintBox:{textAlign:"center",padding:"20px",background:"linear-gradient(135deg, #fff9e6 0%, #ffe5b4 100%)",borderRadius:"12px",border:"2px dashed #d4a574"},hintIcon:{fontSize:"32px",marginBottom:"10px"},hintText:{fontSize:"14px",color:"#8d6e63",lineHeight:"1.6",margin:0},metHint:{textAlign:"center",padding:"15px",background:"#e8f5e9",border:"1px solid #81c784",borderRadius:"8px",color:"#2e7d32",fontSize:"14px",fontWeight:"bold"},actionSection:{marginTop:"12px",display:"flex",flexDirection:"column",gap:"8px"},challengeBtn:{padding:"10px 14px",borderRadius:"10px",border:"none",background:"linear-gradient(135deg, #d84315, #ff7043)",color:"#fff",fontWeight:"bold",cursor:"pointer",boxShadow:"0 6px 14px rgba(216, 67, 21, 0.25)"}},cT=({selectedNpc:e,setSelectedNpc:t,handleOptionSelect:n,player:s,visibleChildren:o,visibleNpcs:i,activeNpcs:a,modalMgr:l,addLog:d,showResult:u,cutTiesWithNpc:p,handleToggleNpcLetterAcceptance:c,messages:m,messageManager:v,setMessages:w,handleSendMessageReply:E,combatData:S,handleCombatClose:g,isExploring:h,exploreRealmState:x,exploreProgress:k,currentExploreEvent:_,exploreLog:y,inventory:R,setExploreLog:C,handleExplorationOption:I,handleStartCombat:T,setExploreProgress:L,setCurrentExploreEvent:ee,setIsExploring:$,getBossEvent:O,getRandomExplorationEvent:H,pendingSectChoices:F,setPendingSectChoices:se,handleAssignSect:J,handleCloseTutorial:de,handleCompleteTutorial:Ee,handleCloseGuide:$e,currentGazette:De,setSelectedWorldNpc:Qe,selectedWorldNpc:Y,handleInviteWorldNpc:ue,handleChallengeWorldNpc:ne,selectedTianjiChild:ce,setSelectedTianjiChild:ae})=>{var je;return r.jsxs(r.Fragment,{children:[e&&r.jsx(dj,{npc:e,onClose:()=>t(null),onOptionSelect:n,player:s,children:o,npcs:i,onViewLog:X=>l.openNpcLog(X),onCutTies:X=>{const Me=a.find(Ae=>Ae.id===X);Me&&(p(X),t(null),d(`  ${Me.name} `),u("",` ${Me.name} `,!0))},onToggleLetterAcceptance:c}),l.npcLogModal.open&&l.npcLogModal.npc&&r.jsx(ZC,{npc:l.npcLogModal.npc,playerAffection:((je=l.npcLogModal.npc.relationship)==null?void 0:je.affection)||0,onClose:()=>l.closeNpcLog()}),r.jsx(w5,{isOpen:l.showMessageCenter,onClose:()=>l.closeMessageCenter(),messages:m,onMarkAsRead:X=>{v.markAsRead(X),w(v.getAllMessages())},onDeleteMessage:X=>{v.deleteMessage(X),w(v.getAllMessages())},onSendReply:E}),S&&r.jsx(eT,{player:s,enemy:S.enemy,result:S.result,onClose:g}),h&&r.jsx(nT,{open:h,realmName:x.name,progress:k,total:x.total,event:_,log:y,optionContext:{player:s,inventory:R,realmId:x.id,progress:k},onSelectOption:I,onStartCombat:T,onNext:()=>{if(k>=x.total){C(Ae=>[...Ae,""]),$(!1),u("","",!0,null,!1);return}const X=k+1;L(X);const Me=X===x.total?O(x.id):H({realmId:x.id,progress:X});ee(Me),C(Ae=>[...Ae,` (${X}/${x.total})`])},onClose:()=>{$(!1),C(X=>[...X,""])}}),F.length>0&&r.jsx(rT,{event:F[0],onClose:()=>se(X=>X.slice(1)),onAssign:J}),l.showTutorial&&r.jsx(sT,{onClose:de,onComplete:Ee}),l.showGuide&&r.jsx(oT,{onClose:$e}),l.showGazette&&r.jsx(iT,{gazette:De,history:s.gazetteHistory||[],playerName:s.name,onClose:()=>l.closeGazette(),onWorldNpcClick:X=>{Qe(X)},onChildClick:X=>{ae(X)}}),Y&&r.jsx(aT,{worldNpc:Y,player:s,onClose:()=>Qe(null),onInvite:ue,onChallenge:ne}),ce&&r.jsx(b1,{child:ce,player:s,onClose:()=>ae(null),isTianjiMode:!0})]})};class dT extends $c.Component{constructor(n){super(n);B0(this,"handleReset",()=>{this.setState({hasError:!1,error:null,errorInfo:null})});this.state={hasError:!1,error:null,errorInfo:null}}static getDerivedStateFromError(n){return{hasError:!0}}componentDidCatch(n,s){console.error("[] :",n),console.error("[] :",s),this.setState({error:n,errorInfo:s})}render(){var n;return this.state.hasError?r.jsxs("div",{style:{padding:"20px",margin:"20px",backgroundColor:"#ffebee",border:"2px solid #f44336",borderRadius:"8px",textAlign:"center",fontFamily:"Arial, sans-serif"},children:[r.jsx("h2",{style:{color:"#c62828",margin:"0 0 12px 0"},children:" "}),r.jsx("p",{style:{color:"#d32f2f",margin:"8px 0",fontSize:"14px"},children:((n=this.state.error)==null?void 0:n.message)||""}),!1,r.jsx("button",{onClick:this.handleReset,style:{marginTop:"12px",padding:"8px 16px",backgroundColor:"#2196f3",color:"#fff",border:"none",borderRadius:"4px",cursor:"pointer",fontSize:"14px",fontWeight:"bold"},children:" "})]}):this.props.children}}const uT=({options:e,currentSort:t,onSortChange:n})=>{const s=o=>{typeof n=="function"?n(o):console.warn("SortBar: onSortChange is not a function",{onSortChange:n,value:o})};return r.jsxs("div",{style:Wi.container,children:[r.jsx("span",{style:Wi.label,children:" :"}),r.jsx("div",{style:Wi.buttonGroup,children:e.map(o=>r.jsx("button",{type:"button",onClick:()=>s(o.value),style:{...Wi.button,...t===o.value?Wi.buttonActive:{}},children:o.label},o.value))})]})},Wi={container:{display:"flex",alignItems:"center",justifyContent:"flex-end",padding:"5px 10px",marginBottom:"10px",background:"#f5f5f5",borderRadius:"4px",fontSize:"12px"},label:{color:"#666",marginRight:"8px",fontWeight:"bold"},buttonGroup:{display:"flex",gap:"6px",flexWrap:"wrap"},button:{border:"1px solid #ccc",borderRadius:"999px",padding:"4px 10px",fontSize:"12px",cursor:"pointer",backgroundColor:"white",color:"#333",transition:"all 0.2s ease"},buttonActive:{backgroundColor:"#1976d2",color:"#fff",borderColor:"#1976d2",boxShadow:"0 2px 6px rgba(25,118,210,0.4)"}};function pT({player:e,inventory:t,children:n,exploreRealmState:s,exploreProgress:o,exploreTeamIds:i,setPlayer:a,setExploreLog:l,setCombatData:d,addNpc:u,addItemsToInventory:p,inventoryMgr:c,calculateDynamicCombatStats:m,simulateCombat:v,generateRealmEnemy:w}){const E=b.useCallback(()=>{var R,C;const y=Pf(e);if(!y.canExplore){if(((R=e.stats)==null?void 0:R.health)<20)return l(I=>[...I,` ${Math.floor(e.stats.health)}/100`]),!1;((C=e.stats)==null?void 0:C.health)<30&&l(I=>[...I,` 30${Math.floor(e.stats.health)}/100`])}return y.canExplore},[e,l]),S=b.useCallback(y=>{if(!E())return;const R={player:e,inventory:t,realmId:s.id,progress:o};if(y.condition&&!y.condition(R)){l(I=>[...I,""]);return}const C=y.action?y.action(R):{type:"LOG",msg:""};switch(typeof C.spiritStonesDelta=="number"&&C.spiritStonesDelta!==0&&a(I=>{var T;return{...I,resources:{...I.resources,spiritStones:Math.max(0,(((T=I.resources)==null?void 0:T.spiritStones)||0)+C.spiritStonesDelta)}}}),C.type){case"START_COMBAT":g();break;case"LOOT":h(C);break;case"NPC_JOIN":x(C);break;case"HP_CHANGE":k(C);break;case"EXP_GAIN":_(C);break;case"LOG":case"NONE":default:l(I=>[...I,C.msg||""]);break}},[e,t,s.id,o,l,a]),g=b.useCallback(()=>{const y=w(s.id,o),R={...e,combatStats:e.combatStats||{maxHp:100,maxMp:50,atk:10,def:5,hp:100,mp:50}},C=i.map(T=>n.find(L=>L.id===T)).filter(Boolean).map(T=>({...T,combatStats:T.combatStats||{maxHp:100,maxMp:50,atk:10,def:5,hp:100,mp:50}})),I=v(R,y,C);d({enemy:y,result:I,context:"exploration"})},[e,n,i,s.id,o,w,v,d]),h=b.useCallback(y=>{const C=p(y.items||[]).map(T=>T.name).filter(Boolean).join(", "),I=[];y.msg&&I.push(y.msg),C&&I.push(`${C}`),I.length>0&&l(T=>[...T,...I])},[p,l]),x=b.useCallback(y=>{if(u(y.npc,y.msg),y.removeItemId){const R=t.find(C=>C.id===y.removeItemId);R&&c.removeItemFromInventory(R.instanceId,R.stackable?1:void 0)}l(R=>[...R,y.msg||""])},[u,t,c,l]),k=b.useCallback(y=>{const R=y.hpDelta||0;if(R<0){const C=Math.abs(R),I=ri(e,C,"EXPLORATION");a(L=>({...L,stats:{...L.stats,health:I.newHealth}}));const T=[];T.push(I.message),y.msg&&y.msg!==""&&T.push(y.msg),l(L=>[...L,...T])}else a(C=>{var I,T;return{...C,stats:{...C.stats,health:Math.max(1,Math.min(100,(((I=C.stats)==null?void 0:I.health)||50)+Math.floor(R/(((T=C.combatStats)==null?void 0:T.maxHp)||100)*100)))}}}),l(C=>[...C,y.msg||(R<0?"":"")])},[e,a,l]),_=b.useCallback(y=>{a(R=>{const C={...R,currentExp:(R.currentExp||0)+(y.amount||0)};return{...C,combatStats:m(C)}}),l(R=>[...R,y.msg||""])},[a,m,l]);return{handleExplorationOption:S,handleStartCombat:g,checkExplorationHealth:E}}function fT({player:e,children:t,exploreRealmState:n,applyCombatResult:s,addLog:o,setCombatData:i,setExploreLog:a,batchUpdateChildren:l,archiveChildDeaths:d,addItemsToInventory:u,setIsExploring:p}){const c=b.useCallback(S=>{var k,_;if(!S)return;const{success:g,remainingHp:h}=S.result,x=S.context||"rival";if(typeof S.onVictory=="function"||typeof S.onDefeat=="function"){g?(k=S.onVictory)==null||k.call(S,S):(_=S.onDefeat)==null||_.call(S,S),i(null);return}if(x==="rival"){m(g,h),i(null);return}g?v(S):w(S),i(null)},[e,t,n,i]),m=b.useCallback((S,g)=>{var h;if(S){const x=Math.floor((1-g/(((h=e.combatStats)==null?void 0:h.maxHp)||100))*100),k=Math.max(5,Math.floor(x/5));s({won:!0,spiritStones:500,healthDamage:k,injurySource:"DUEL"}),o("  500 ")}else{const x=ri(e,40,"DUEL");s({won:!1,expGain:-e.currentExp,spiritStones:-Math.floor(e.resources.spiritStones*.5),health:x.newHealth}),o(` ...
`+x.message)}},[e,s,o]),v=b.useCallback(S=>{var y,R;const g=((y=S.enemy)==null?void 0:y.drops)||[],h=(R=S.enemy)==null?void 0:R.isBoss;let x=[];if(g.length){const C=h?2+Math.floor(Math.random()*2):1;for(let I=0;I<C&&I<g.length;I++){const T=g[Math.floor(Math.random()*g.length)];x.push(T)}}const k=x.length?u(x):[],_=k.length?`${k.map(C=>C.name).join(", ")}`:"";if(a(h?C=>[...C,` ${_}`]:C=>[...C,`${_}`]),S.result.party&&Array.isArray(S.result.party)){const C=[];S.result.party.forEach(I=>{I.currentHp<=0&&C.push({id:I.id,name:I.name,deathReason:`${n.name}`})}),C.length>0&&E(C)}},[u,a,n.name]),w=b.useCallback(S=>{const g=ri(e,35,"EXPLORATION");if(a(h=>[...h,"",g.message," ..."]),s({won:!1,expGain:-e.currentExp,spiritStones:-Math.floor(e.resources.spiritStones*.5),health:g.newHealth}),S.result.party&&Array.isArray(S.result.party)){const h=[];S.result.party.forEach(x=>{var _;const k=x.currentHp/(((_=x.combatStats)==null?void 0:_.maxHp)||100);(k<=0||k<.3&&Math.random()<.5)&&h.push({id:x.id,name:x.name,deathReason:`${n.name}`})}),h.length>0&&E(h)}p(!1)},[e,a,n.name,p,s,l]),E=b.useCallback(S=>{const g=S.map(x=>x.id);l(x=>g.includes(x.id)?null:x),S.forEach(x=>{const k=t.find(_=>_.id===x.id);k&&(d([{...k,deathReason:x.deathReason}],t),o(` ${x.name} ${x.deathReason} ${Math.floor(k.age||0)} `))});const h=S.map(x=>x.name).join("");a(x=>[...x,` ${h} `])},[t,l,d,o,a]);return{handleCombatClose:c}}function mT({player:e,inventory:t,activeNpcs:n,modalState:s,setModalState:o,removeItemFromInventory:i,updateNpc:a,setActiveNpcs:l,batchUpdateNpcsByMap:d,setSelectedNpc:u,showResult:p,addLog:c,handleWitnessCheck:m,pushToNewsBuffer:v,isUsageAllowedForTarget:w,RESOURCE_USAGE:E,formatUsageTargets:S}){const g=b.useCallback(_=>{var ae,je,X,Me,Ae;const y=s.data;if(!y){console.warn("No NPC found in modalState.data");return}const R=Array.isArray(_)?_:_?[{instanceId:_.instanceId,quantity:_.quantity||1}]:[];if(R.length===0){p("","",!1,null,!1,{category:"",type:"GIFT",title:"",message:"",details:"",forceManual:!0});return}const C={common:5,uncommon:10,rare:20,epic:35,legendary:50},I=y.identity==="",T=y.identity==="",L=y.identity==="";let ee=0,$=0,O=0,H=0;const F=[],se=[],J=[];if(R.forEach(({instanceId:_e,quantity:z})=>{const he=t.find(Ct=>Ct.instanceId===_e);if(!he||!w(he,E.NPC))return;const ye=he.quantity||1,ke=Math.max(1,Math.min(ye,parseInt(z,10)||1));i(he.instanceId,he.stackable?ke:void 0);const ve={...he};let Ge=C[ve.rarity]||5;ve.type==="consumable"&&(Ge+=5),(ve.type==="weapon"||ve.type==="armor")&&(Ge+=3),(I||T||L)&&(ve.rarity==="common"||ve.rarity==="uncommon")&&(Ge=0);const pt=Math.min(Ge,50)*ke;if(ee+=pt,F.push(`${ve.name} x${ke}`),se.push(` ${ve.name} x${ke} +${pt}`),ve.type==="consumable"&&ve.effect){const Ct=ve.effect||{},Qt=(Ct.amount||0)*ke;Ct.kind==="exp"&&($+=Qt),Ct.kind==="aptitude"&&(O+=Qt),Ct.kind,Ct.kind==="heal"&&(H+=Qt)}}),ee<=0){p("","",!1,null,!1,{category:"",type:"GIFT",title:"",message:"",details:"",forceManual:!0});return}const de=y.gender===""?"":"",Ee=ee>15?"":ee>8?"":"",$e=` ${F.join("")}  ${y.name}${de}${Ee}`,De=R.length===1&&F.length===1?((ae=Yj(y,t.find(_e=>_e.instanceId===R[0].instanceId)))==null?void 0:ae.description)||$e:`${$e}

${se.join(`
`)}`,Qe=y.relationship||{affection:0,trust:0};let Y={...y,relationship:{...Qe,affection:Math.min(100,(Qe.affection||0)+ee)}},ue=null;if($>0){const _e=An(Y.tier||""),z=Y.maxExp||(_e==null?void 0:_e.maxExp)||0;if(Y={...Y,currentExp:(Y.currentExp||0)+$,maxExp:z||Y.maxExp},Y.combatStats=Cn(Y),J.push(`${y.name} +${$}`),ue={...ue||{},:$},Y.maxExp&&Y.currentExp>=Y.maxExp){const he=Vy(Y,e,e.time.year,e.time.month);Y=he.npc,Y.combatStats=Cn(Y),he.events&&he.events.length>0&&J.push(he.events[0].message)}}if(O>0){try{Y=Ff(Y,Math.min(100,(((je=Y.stats)==null?void 0:je.aptitude)||50)+O))}catch{Y={...Y,stats:{...Y.stats,aptitude:Math.min(100,(((X=Y.stats)==null?void 0:X.aptitude)||50)+O)}}}Y.combatStats=Cn(Y),J.push(`${y.name} +${O}`),ue={...ue||{},:O}}if(H>0){const _e=Math.min(100,(((Me=Y.stats)==null?void 0:Me.health)||100)+H);Y={...Y,stats:{...Y.stats,health:_e}},J.push(`${y.name} +${H}`),ue={...ue||{},:H}}const ne=F.join("");Y=BE(Y,e,Math.floor(e.age),e.time.month,ne),Y=qi(Y),ss.onReceiveGift(Y,{name:ne},ee),a(y.id,Y);const ce=J.length>0?`${De}

${J.join("")}`:De;p("",ce,!0,{:ee,...ue||{}},!1,{category:"",type:"GIFT",title:`-${y.name}`,message:`${y.name}`,details:ce,forceManual:!0}),m(y,"GIFT"),((Ae=y.relationship)==null?void 0:Ae.affection)>=60&&Math.random()<.3&&v(e.newsBuffer,"NPC_PURSUIT",{actor:e.name,target:y.name}),o({type:null,data:null})},[s,t,e,i,a,p,m,v,o,w,E]),h=b.useCallback(_=>{var ee,$,O;const y=s.data;if(!y){console.warn("No NPC found in modalState.data");return}const R=y.identity==="",C=(y.dualCultivationCount||0)>0;if(R&&!C){const H=`${y.name}"..."`;p("",H,!1,null,!1);return}let I=((ee=y.relationship)==null?void 0:ee.affection)||0;_.strongAgainst.includes((($=y.personality)==null?void 0:$.label)||"")?I+=30:_.weakAgainst.includes(((O=y.personality)==null?void 0:O.label)||"")&&(I-=20);const T=Math.random()*100<I,L=a5(y,_,T);if(T){const H=DE(y,e,Math.floor(e.age),e.time.month);ss.onPregnancyStart(H),l(F=>F.map(se=>se.id===y.id?{...H,isPregnant:!0,pregnancyProgress:0}:se)),p("",L,!0,null,!1)}else p("",L,!1,null,!1)},[s,e,l,p]),x=b.useCallback((_,y)=>{let R=y;y.check&&(R=y.check(e)?y.success:y.fail);const C=(R==null?void 0:R.change)||{},I=(R==null?void 0:R.result)||y.result,T=n.find(ee=>ee.id===_);if(T){const ee=T.relationship||{affection:0,trust:0,jealousy:0,stage:0},$={...ee};C.affection!==void 0&&($.affection=Math.min(100,Math.max(0,($.affection||0)+C.affection))),C.trust!==void 0&&($.trust=Math.min(100,Math.max(0,($.trust||0)+C.trust))),C.jealousy!==void 0&&($.jealousy=Math.min(100,Math.max(0,($.jealousy||0)+C.jealousy)));let O=ee.stage||0;if(C.stageUp){const H=$.affection||0;H>=80?O=3:H>=50?O=2:H>=20?O=1:O=0}a(_,{relationship:{...$,stage:O}})}const L=(R==null?void 0:R.msg)||"";c(`${L}`),p("",L,I==="good",{:C.affection||0,:C.trust||0,:C.jealousy||0},!1),u(null)},[e,n,a,c,p,u]),k=b.useCallback(_=>{const y=s.data;if(!y)return;const R=h5(y,_,e),C=new Map;R.changes.forEach(I=>{var se,J,de;const T=n.find(Ee=>Ee.id===I.npcId);if(!T)return;const L=((se=T.relationship)==null?void 0:se.jealousy)||0,ee=((J=T.relationship)==null?void 0:J.affection)||0,$=Math.min(100,Math.max(0,L+I.jealousyChange)),O=Math.min(100,Math.max(0,ee+I.affectionChange)),H=(de=R.npcLogs)==null?void 0:de.find(Ee=>Ee.npcId===T.id);let F={...T,relationship:{...T.relationship,jealousy:$,affection:O}};if(H){const Ee=F.logs||[],$e={year:e.time.year,month:e.time.month,content:H.content,type:H.type||"DAILY",isSecret:H.isSecret||!1,timestamp:Date.now()};F={...F,logs:[$e,...Ee].slice(0,50)}}C.set(I.npcId,F)}),d(C),c(` ${R.message}`),p("",R.message,!0,{},!1),o({type:null,data:null})},[s,e,n,d,c,p,o]);return{handleGiftConfirm:g,handleNegotiateConfirm:h,handleOptionSelect:x,handleShuraFieldSelect:k}}function gT({player:e,onBreakthroughClick:t}){const n=Math.min(100,e.currentExp/e.maxExp*100),s=Math.min(100,(e.energy||0)/20*100),o=e.currentExp>=e.maxExp&&e.maxExp>0;return r.jsxs("div",{style:vr.cultivationSection,children:[r.jsxs("div",{style:vr.expContainer,children:[r.jsx("div",{style:vr.expLabel,children:""}),r.jsxs("div",{style:vr.expBar,children:[r.jsx("div",{style:{...vr.expBarFill,width:`${n}%`,background:o?"linear-gradient(90deg, #ff6f00 0%, #ff8f00 100%)":"linear-gradient(90deg, #76ff03 0%, #64dd17 100%)"}}),r.jsxs("span",{style:vr.expText,children:[e.currentExp," / ",e.maxExp]})]}),r.jsxs("div",{style:{marginTop:8},children:[r.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:6},children:[r.jsx("div",{style:{fontSize:12,color:"#666"},children:""}),r.jsxs("div",{style:vr.energyText,children:[e.energy||0," / 20"]})]}),r.jsx("div",{style:vr.energyBar,children:r.jsx("div",{style:{...vr.energyFill,width:`${s}%`}})})]})]}),o&&r.jsx("button",{onClick:t,style:vr.breakthroughBtn,children:" "})]})}const vr={cultivationSection:{display:"flex",alignItems:"center",gap:"15px",padding:"15px 20px",background:"linear-gradient(135deg, #ffffff 0%, #f5f5f5 100%)",borderBottom:"2px solid #e0e0e0",boxShadow:"0 2px 4px rgba(0,0,0,0.05)"},expContainer:{flex:1,minWidth:0},expLabel:{fontSize:"13px",fontWeight:"600",color:"#555",marginBottom:"6px"},expBar:{position:"relative",height:"24px",background:"#e0e0e0",borderRadius:"12px",overflow:"hidden",boxShadow:"inset 0 2px 4px rgba(0,0,0,0.1)"},expBarFill:{position:"absolute",top:0,left:0,height:"100%",transition:"width 0.3s ease, background 0.3s ease",boxShadow:"0 0 8px rgba(118, 255, 3, 0.4)"},expText:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",fontSize:"11px",fontWeight:"700",color:"#333",textShadow:"0 1px 2px rgba(255,255,255,0.8)",zIndex:1},energyBar:{position:"relative",height:"14px",background:"#e0e0e0",borderRadius:"7px",overflow:"hidden",boxShadow:"inset 0 1px 3px rgba(0,0,0,0.1)"},energyFill:{height:"100%",background:"linear-gradient(90deg, #29b6f6 0%, #0288d1 100%)",borderRadius:"7px",transition:"width 0.3s ease",boxShadow:"0 0 6px rgba(41, 182, 246, 0.3)"},energyText:{fontSize:"11px",color:"#666",fontWeight:"500"},breakthroughBtn:{padding:"10px 20px",background:"linear-gradient(135deg, #ff6f00 0%, #ff8f00 100%)",color:"white",border:"none",borderRadius:"8px",fontSize:"14px",fontWeight:"600",cursor:"pointer",boxShadow:"0 4px 8px rgba(255, 111, 0, 0.3)",transition:"all 0.2s",animation:"pulse 2s infinite",whiteSpace:"nowrap"}};function hT({player:e,visibleChildren:t,pregnantNpcs:n,fallenChildren:s,exiledChildren:o=[],onChildClick:i,onToggleFavorite:a,onMemorialClick:l,generation3Plus:d=[]}){return r.jsxs("div",{style:nh.tabContent,children:[r.jsx(yj,{player:e,children:t,pregnantNpcs:n,fallenChildren:s,exiledChildren:o,onChildClick:i,onToggleFavorite:a,onMemorialClick:l,generation3Plus:d}),r.jsxs("div",{style:nh.statsBar,children:[": ",t.length+1," | : ",t.filter(u=>u.generation>1).length]})]})}const nh={tabContent:{flex:1,overflow:"auto",background:"#fafafa"},statsBar:{padding:"15px",textAlign:"center",fontSize:"13px",color:"#555",borderTop:"1px dashed #e0e0e0",marginTop:"15px"}};function xT({isAuto:e,autoSpeed:t,player:n,messageUnreadCount:s,onToggleAuto:o,onSetAutoSpeed:i,onNextMonth:a,onOpenGazette:l,onOpenMessageCenter:d,onMarkGazetteRead:u}){return r.jsxs(r.Fragment,{children:[r.jsxs("div",{style:Yn.fabContainer,children:[e&&r.jsxs("div",{style:Yn.speedSelector,children:[r.jsx("button",{onClick:()=>i(.3),style:{...Yn.speedBtn,backgroundColor:t===.3?"#4CAF50":"#e0e0e0",color:t===.3?"white":"#666"},children:"0.3"}),r.jsx("button",{onClick:()=>i(1),style:{...Yn.speedBtn,backgroundColor:t===1?"#4CAF50":"#e0e0e0",color:t===1?"white":"#666"},children:"1"}),r.jsx("button",{onClick:()=>i(3),style:{...Yn.speedBtn,backgroundColor:t===3?"#4CAF50":"#e0e0e0",color:t===3?"white":"#666"},children:"3"})]}),r.jsx("button",{onClick:o,style:{...Yn.autoBtn,backgroundColor:e?"#76ff03":"#e0e0e0",color:e?"#33691e":"#757575"},children:e?" ":" "}),r.jsx("button",{onClick:()=>a(!1),style:{...Yn.fabBtn,transform:e?"scale(0.9)":"scale(1)",opacity:e?.8:1},disabled:e,children:e?r.jsx("div",{style:Yn.spinner,children:""}):r.jsxs(r.Fragment,{children:[r.jsx("span",{style:{fontSize:"18px"},children:""}),r.jsx("span",{style:{fontSize:"9px"},children:""})]})})]}),r.jsxs("button",{onClick:()=>{l(),u()},style:Yn.gazetteBtn,title:"",children:["",n.hasUnreadGazette&&r.jsx("span",{style:Yn.redDot})]}),r.jsxs("button",{onClick:d,style:Yn.messageCenterBtn,title:" - ",children:["",s>0&&r.jsx("span",{style:Yn.redDot,children:s})]})]})}const Yn={fabContainer:{position:"fixed",bottom:"76px",right:"20px",display:"flex",flexDirection:"column",alignItems:"flex-end",gap:"12px",zIndex:99},speedSelector:{display:"flex",gap:"6px",padding:"8px",background:"rgba(255,255,255,0.95)",borderRadius:"20px",boxShadow:"0 4px 12px rgba(0,0,0,0.15)"},speedBtn:{padding:"6px 12px",border:"none",borderRadius:"12px",fontSize:"12px",fontWeight:"600",cursor:"pointer",transition:"all 0.2s",minWidth:"45px"},autoBtn:{padding:"10px 18px",border:"none",borderRadius:"20px",fontSize:"13px",fontWeight:"600",cursor:"pointer",boxShadow:"0 4px 12px rgba(0,0,0,0.15)",transition:"all 0.2s"},fabBtn:{width:"60px",height:"60px",borderRadius:"50%",border:"none",background:"linear-gradient(135deg, #8b7355 0%, #a0826d 100%)",color:"#fff",fontSize:"14px",fontWeight:"600",cursor:"pointer",boxShadow:"0 6px 20px rgba(139, 115, 85, 0.3)",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",gap:"2px",transition:"all 0.2s"},spinner:{fontSize:"24px",animation:"spin 2s linear infinite"},gazetteBtn:{position:"fixed",bottom:"76px",left:"20px",width:"50px",height:"50px",borderRadius:"50%",border:"none",background:"linear-gradient(135deg, #8b6f47 0%, #a0916f 100%)",color:"#fff",fontSize:"24px",cursor:"pointer",boxShadow:"0 4px 12px rgba(139, 111, 71, 0.3)",zIndex:99,transition:"all 0.2s"},messageCenterBtn:{position:"fixed",bottom:"136px",left:"20px",width:"50px",height:"50px",borderRadius:"50%",border:"none",background:"linear-gradient(135deg, #c9b5a0 0%, #d4c9c1 100%)",color:"#4a3728",fontSize:"24px",cursor:"pointer",boxShadow:"0 4px 12px rgba(201, 181, 160, 0.3)",zIndex:99,transition:"all 0.2s"},redDot:{position:"absolute",top:"0",right:"0",width:"18px",height:"18px",background:"#f44336",color:"white",borderRadius:"50%",fontSize:"10px",fontWeight:"700",display:"flex",alignItems:"center",justifyContent:"center",border:"2px solid white",boxShadow:"0 2px 4px rgba(0,0,0,0.2)"}},yT=[{value:"DEFAULT",label:" ()"},{value:"AFFECTION_DESC",label:" ()"},{value:"APTITUDE_DESC",label:" ()"},{value:"TRUST_DESC",label:" ()"}],bT=({sortedNpcs:e,pagedNpcs:t,deadNpcs:n,npcSort:s,npcPage:o,npcPageCount:i,hasNpcPagination:a,showFollowedOnly:l,onExplore:d,onSortChange:u,onToggleFollowedOnly:p,onPrevPage:c,onNextPage:m,onNpcInteract:v,onNpcAction:w,isRomanceLimitReached:E=!1})=>r.jsxs("div",{style:{padding:"15px",maxWidth:"800px",margin:"0 auto",paddingBottom:"200px"},children:[r.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"15px"},children:[r.jsxs("h2",{style:{margin:0,color:"#5d4037"},children:[" ",e.length,""]}),r.jsx("button",{onClick:d,style:{padding:"8px 16px",backgroundColor:E?"#c0c0c0":"#8d6e63",color:"white",border:E?"2px solid #d32f2f":"none",borderRadius:"8px",cursor:E?"not-allowed":"pointer",fontSize:"14px",fontWeight:E?"bold":"normal",opacity:E?.7:1},children:" "})]}),E&&r.jsx("div",{style:{padding:"12px",marginBottom:"15px",backgroundColor:"#fff3e0",borderLeft:"4px solid #ff9800",borderRadius:"4px",color:"#e65100",fontSize:"13px",fontWeight:"500"},children:" "}),r.jsxs("div",{style:{marginBottom:"15px"},children:[r.jsx(uT,{options:yT,currentSort:s,onSortChange:u}),r.jsx("div",{style:{marginTop:"10px"},children:r.jsxs("label",{style:{fontSize:"14px",color:"#666",cursor:"pointer",userSelect:"none"},children:[r.jsx("input",{type:"checkbox",checked:l,onChange:S=>p(S.target.checked),style:{marginRight:"6px"}})," NPC"]})})]}),r.jsxs("div",{children:[t.length===0?r.jsx("div",{style:{textAlign:"center",padding:"40px",color:"#999",fontSize:"14px"},children:""}):r.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(280px, 1fr))",gap:"12px"},children:t.map(S=>r.jsx(Ng,{npc:S,onInteract:(g,h)=>{w?w(g,h):h==="DETAIL"&&v(S)}},S.id))}),a&&r.jsxs("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",gap:"15px",marginTop:"30px",paddingTop:"20px",paddingBottom:"20px",borderTop:"2px solid #e0e0e0"},children:[r.jsx("button",{onClick:c,disabled:o===0,style:{padding:"8px 16px",border:"1px solid #ccc",borderRadius:"8px",backgroundColor:o===0?"#f5f5f5":"white",cursor:o===0?"not-allowed":"pointer",fontSize:"14px"},children:""}),r.jsxs("span",{style:{fontSize:"14px",color:"#666"},children:[" ",o+1," / ",i," "]}),r.jsx("button",{onClick:m,disabled:o>=i-1,style:{padding:"8px 16px",border:"1px solid #ccc",borderRadius:"8px",backgroundColor:o>=i-1?"#f5f5f5":"white",cursor:o>=i-1?"not-allowed":"pointer",fontSize:"14px"},children:""})]})]}),n.length>0&&r.jsxs("div",{style:{marginTop:"30px"},children:[r.jsxs("h3",{style:{color:"#999",fontSize:"16px",marginBottom:"15px"},children:[" ",n.length,""]}),r.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(280px, 1fr))",gap:"12px",opacity:.6},children:n.map(S=>r.jsx(Ng,{npc:S,actions:r.jsx("button",{onClick:()=>v(S),style:{width:"100%",padding:"8px",border:"1px solid #ccc",borderRadius:"6px",backgroundColor:"#f5f5f5",color:"#999",cursor:"pointer",fontSize:"14px"},children:""})},S.id))})]})]}),vT=({player:e,children:t,showBizPanel:n,showChallengePanel:s,idleManagerOptions:o,onDailyAction:i,onShopping:a,onOpenInventory:l,onBuyBusiness:d,onExploreRealm:u,onOpenAuction:p,onCloseBizPanel:c,onCloseChallengePanel:m,onOpenBizPanel:v,onOpenChallengePanel:w,isRomanceLimitReached:E=!1})=>{const S=((e.time.year-3572)*12+e.time.month)%36===0;return r.jsx("div",{style:{padding:"15px",maxWidth:"800px",margin:"0 auto",paddingBottom:"80px"},children:n?r.jsxs("div",{children:[r.jsx("button",{onClick:c,style:{padding:"8px 16px",marginBottom:"15px",border:"1px solid #ccc",borderRadius:"8px",backgroundColor:"white",cursor:"pointer",fontSize:"14px"},children:" "}),r.jsx(B5,{player:e,children:t,managerOptions:o,onBuy:d})]}):s?r.jsxs("div",{children:[r.jsx("button",{onClick:m,style:{padding:"8px 16px",marginBottom:"15px",border:"1px solid #ccc",borderRadius:"8px",backgroundColor:"white",cursor:"pointer",fontSize:"14px"},children:" "}),r.jsx(O5,{player:e,children:t,onChallenge:u,isRomanceLimitReached:E})]}):r.jsxs("div",{children:[r.jsx("h2",{style:{margin:"0 0 20px 0",color:"#5d4037"},children:""}),r.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"10px",marginBottom:"30px"},children:[r.jsx("button",{onClick:()=>i("CULTIVATE"),style:{padding:"12px 20px",border:"none",borderRadius:"8px",backgroundColor:"#8d6e63",color:"white",cursor:"pointer",fontSize:"16px",fontWeight:"bold"},children:" (+10-15)"}),r.jsx("button",{onClick:()=>i("WORK"),style:{padding:"12px 20px",border:"none",borderRadius:"8px",backgroundColor:"#8d6e63",color:"white",cursor:"pointer",fontSize:"16px",fontWeight:"bold"},children:" (+15)"}),r.jsx("button",{onClick:a,style:{padding:"12px 20px",border:"none",borderRadius:"8px",backgroundColor:"#8d6e63",color:"white",cursor:"pointer",fontSize:"16px",fontWeight:"bold"},children:" (-10)"}),r.jsx("button",{onClick:()=>l("SELL"),style:{padding:"12px 20px",border:"none",borderRadius:"8px",backgroundColor:"#8d6e63",color:"white",cursor:"pointer",fontSize:"16px",fontWeight:"bold"},children:" ()"})]}),r.jsxs("div",{style:{marginTop:"30px",borderTop:"1px dashed #ccc",paddingTop:"20px"},children:[r.jsx("h3",{style:{margin:"0 0 15px 0",color:"#5d4037"},children:" "}),r.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(140px, 1fr))",gap:"15px"},children:[r.jsxs("button",{onClick:v,style:{padding:"20px",border:"2px solid #8d6e63",borderRadius:"12px",backgroundColor:"white",cursor:"pointer",display:"flex",flexDirection:"column",alignItems:"center",gap:"10px",transition:"all 0.2s"},children:[r.jsx("div",{style:{fontSize:"36px"},children:""}),r.jsx("div",{style:{fontSize:"14px",fontWeight:"bold",color:"#5d4037"},children:""})]}),r.jsxs("button",{onClick:w,style:{padding:"20px",border:"2px solid #8d6e63",borderRadius:"12px",backgroundColor:"white",cursor:"pointer",display:"flex",flexDirection:"column",alignItems:"center",gap:"10px",transition:"all 0.2s"},children:[r.jsx("div",{style:{fontSize:"36px"},children:""}),r.jsx("div",{style:{fontSize:"14px",fontWeight:"bold",color:"#5d4037"},children:""})]}),r.jsxs("button",{onClick:p,style:{padding:"20px",border:"2px solid #8d6e63",borderRadius:"12px",backgroundColor:"white",cursor:"pointer",display:"flex",flexDirection:"column",alignItems:"center",gap:"10px",transition:"all 0.2s",opacity:S?1:.6},children:[r.jsx("div",{style:{fontSize:"36px"},children:""}),r.jsx("div",{style:{fontSize:"14px",fontWeight:"bold",color:"#5d4037"},children:""}),r.jsx("div",{style:{fontSize:"10px",color:"#999"},children:""})]})]})]})]})})},rh=La.single,ST=[...qs.single,...qs.double],wT=[...Ks.single,...Ks.double],sh=Dy.prefixes,oh=Dy.suffixes;function v1(e){const t=rh[Math.floor(Math.random()*rh.length)],n=e==="male"?ST:wT;if(Math.random()>.3){const o=n[Math.floor(Math.random()*n.length)],i=n[Math.floor(Math.random()*n.length)];return t+o+i}else{const o=n[Math.floor(Math.random()*n.length)];return t+o}}function S1(e){const t=sh[Math.floor(Math.random()*sh.length)],n=oh[Math.floor(Math.random()*oh.length)];if(e.includes("")||e.includes("")){const s=["","","","",""];return s[Math.floor(Math.random()*s.length)]+n}else if(e.includes("")||e.includes("")){const s=["","","","",""];return s[Math.floor(Math.random()*s.length)]+n}return t+n}function w1(e,t={}){const{ensureAllSects:n=!1,preserveExisting:s=!0}=t,o=Er.filter(u=>u&&u.id&&u.id!=="SECT_NONE"),i=new Map,a=new Map,l=e.reduce((u,p)=>{const c=Number.isFinite(p==null?void 0:p.tierIndex)?p.tierIndex:-1;return c>u?c:u},-1);if(o.forEach(u=>i.set(u.id,[])),e.forEach(u=>{var c,m;const p=(c=u.sect)==null?void 0:c.id;p&&i.has(p)&&i.get(p).push(u),u.sectRank===""&&((m=u.sect)!=null&&m.id)&&u.status!=="DEAD"&&a.set(u.sect.id,u)}),n){const u=e.filter(c=>!c.sect),p=c=>!c||c.length===0?null:(c.sort((m,v)=>m.tierIndex!==v.tierIndex?m.tierIndex-v.tierIndex:(m.combatPower||0)-(v.combatPower||0)),c.shift());o.forEach(c=>{var w;if((i.get(c.id)||[]).length>0)return;let v=u.pop();if(!v){const E=[...i.entries()].filter(([,S])=>S.length>1).sort((S,g)=>g[1].length-S[1].length)[0];E&&(v=p(E[1]))}if(v){const E=(w=v.sect)==null?void 0:w.id;if(E&&i.has(E)){const S=i.get(E),g=S.indexOf(v);g>=0&&S.splice(g,1)}v.sect={id:c.id,name:c.name},i.get(c.id).push(v)}})}const d=u=>{if(!u||u.length===0)return null;const p=l>=0?u.filter(m=>m.tierIndex===l):[];return(p.length>0?p:u).reduce((m,v)=>m?v.tierIndex!==m.tierIndex?v.tierIndex>m.tierIndex?v:m:(v.combatPower||0)>(m.combatPower||0)?v:m:v,null)};o.forEach(u=>{const p=i.get(u.id)||[];if(p.length===0)return;const m=(s?a.get(u.id):null)||d(p);p.forEach(v=>{v===m?(v.sectRank="",v.isSectLeader=!0):v.sectRank===""&&(v.sectRank=void 0,v.isSectLeader=!1)})})}function ET(e=30){const t=[],n=new Set,s={:.22,:.16,:.14,:.14,:.12,:.1,:.06,:.04,:.02},o={};let i=0;Object.entries(s).forEach(([u,p])=>{const c=Math.floor(e*p);o[u]=c,i+=c});const a=Math.max(0,e-i);a>0&&(o.=(o.||0)+a);let l=1;return["","","","","","","","",""].forEach(u=>{const p=o[u]||1;for(let c=0;c<p;c++){const m=Math.random()>.7?"female":"male";let v,w=0;do v=v1(m),w++;while(n.has(v)&&w<100);n.has(v)&&(v=v+l),n.add(v);const E=S1(u);let S=null;if(Math.random()>.3){const T=Er.filter(L=>L.id!=="SECT_NONE");S=T[Math.floor(Math.random()*T.length)]}const g=Je.findIndex(T=>T.name===u);if(g===-1){console.error(`: ${u}`);return}const h=Je[g],k=h.maxExp*2*(.8+Math.random()*.4),y=Math.random()<.8?90+Math.floor(Math.random()*11):80+Math.floor(Math.random()*10),R=ai(y),C=50+Math.floor(Math.random()*50),I={id:`world_npc_${l}`,name:v,title:E,gender:m,tier:u,tierIndex:g,rank:E,sect:S?{id:S.id,name:S.name}:null,status:"ALIVE",location:"Unknown",hasMetPlayer:!1,firstMetYear:null,currentExp:Math.floor(Math.random()*h.maxExp*.8)+h.maxExp*.2,maxExp:h.maxExp,stats:{aptitude:y,looks:C,intelligence:60+Math.floor(Math.random()*40),health:80},spiritRoot:R,combatStats:Zc({stats:{aptitude:y,looks:C,intelligence:60+Math.floor(Math.random()*40),health:80},spiritRoot:R,constitution:null}),combatPower:Math.floor(k),age:30+(Je.length-g)*50+Math.floor(Math.random()*100),personality:E1(),signature:k1(u),appearance:{description:j1(m,u,C)},relationships:{allies:[],enemies:[],disciples:[]},majorEvents:[`${E}`],lastActiveYear:3572};t.push(I),l++}}),kT(t),w1(t,{ensureAllSects:!0,preserveExisting:!1}),t}function E1(){const e=[{label:"",desc:""},{label:"",desc:""},{label:"",desc:""},{label:"",desc:""},{label:"",desc:""},{label:"",desc:""},{label:"",desc:""},{label:"",desc:""},{label:"",desc:""},{label:"",desc:""},{label:"",desc:""},{label:"",desc:""},{label:"",desc:""},{label:"",desc:""},{label:"",desc:""}];return e[Math.floor(Math.random()*e.length)]}function k1(e){const t={:["","","",""],:["","","",""],:["","","",""],:["","","",""],:["","","",""],:["","","",""]},n=t[e]||t.;return n[Math.floor(Math.random()*n.length)]}function j1(e,t,n=60){const s=Number.isFinite(n)?n:60,o={high:["","",""],mid:["","",""],low:["","",""]},i={high:["","",""],mid:["","",""],low:["","",""]},a=s>=85?"high":s>=60?"mid":"low",l=e==="male"?o[a]:i[a];return l[Math.floor(Math.random()*l.length)]}function kT(e){const t=e.filter(s=>["","",""].includes(s.tier));e.filter(s=>["",""].includes(s.tier)).forEach(s=>{if(Math.random()>.5&&t.length>0){const o=t[Math.floor(Math.random()*t.length)];o.sect&&s.sect&&o.sect.id===s.sect.id&&(o.relationships.disciples.push(s.id),s.majorEvents.push(`${o.name}`))}});for(let s=0;s<Math.min(5,e.length/3);s++){const o=e[Math.floor(Math.random()*e.length)],i=e[Math.floor(Math.random()*e.length)];o.id!==i.id&&!o.relationships.enemies.includes(i.id)&&Math.abs(o.tierIndex-i.tierIndex)<=2&&(o.relationships.enemies.push(i.id),i.relationships.enemies.push(o.id),o.majorEvents.push(`${i.name}`),i.majorEvents.push(`${o.name}`))}}function ih(e,t){const n=e.map(a=>{if(a.status==="DEAD")return a;const l={...a};l.age=(a.age||100)+1;const d=Je.findIndex(E=>E.name===a.tier);if(d===-1)return console.warn(`: ${a.tier}`),a;const u=1/Math.max(1,d*.5),p=Math.floor(a.maxExp*.05*u*(.8+Math.random()*.4));l.currentExp=Math.min(a.maxExp,a.currentExp+p);const c=l.currentExp>=l.maxExp,m=Math.max(.02,.1-d*.01);if(c&&Math.random()<m&&d<Je.length-1){const E=d+1,S=Je[E].name;l.tier=S,l.tierIndex=E,l.currentExp=0,l.maxExp=Je[E].maxExp,l.combatPower=Math.floor(l.combatPower*1.5),l.majorEvents.push(`${t}${S}`)}const w=.005/Math.max(1,d*.3);if(Math.random()<w){l.status="DEAD",l.deathYear=t;const E=["","","","",""];l.deathReason=E[Math.floor(Math.random()*E.length)],l.majorEvents.push(`${t}${l.deathReason}`)}return l.lastActiveYear=t,l}),s=n.filter(a=>a.status==="DEAD"&&a.deathYear===t).length,o=[];for(let a=0;a<s;a++)if(Math.random()<.2){const l=Math.random()>.5?"male":"female",d=v1(l),u=S1(""),p=Je.findIndex(w=>w.name===""),c=Je[p],m=55+Math.floor(Math.random()*40),v={id:`world_npc_new_${t}_${a}`,name:d,title:u,gender:l,tier:"",tierIndex:p,sect:null,status:"ALIVE",location:"Unknown",hasMetPlayer:!1,firstMetYear:null,currentExp:Math.floor(c.maxExp*.5),maxExp:c.maxExp,combatPower:Math.floor(c.maxExp*1.5),age:50+Math.floor(Math.random()*50),stats:{aptitude:80+Math.floor(Math.random()*16),looks:m,intelligence:60+Math.floor(Math.random()*30),health:80},personality:E1(),signature:k1(""),appearance:{description:j1(l,"",m)},relationships:{allies:[],enemies:[],disciples:[]},majorEvents:[`${t}`],lastActiveYear:t};o.push(v)}const i=[...n,...o];return w1(i,{ensureAllSects:!1,preserveExisting:!0}),i}const qf=[{id:"dawn_breaker",name:"",epithet:"",element:"",basePrice:2600,desc:"",auctionFlavor:"",blessing:""},{id:"dusk_ember",name:"",epithet:"",element:"",basePrice:2750,desc:"",auctionFlavor:"",blessing:""},{id:"frost_pulse",name:"",epithet:"",element:"",basePrice:2900,desc:"",auctionFlavor:"",blessing:""},{id:"abyssal_flare",name:"",epithet:"",element:"",basePrice:3100,desc:"",auctionFlavor:"",blessing:""}],jT=[{key:"sword_saint",name:"",alias:"",gender:"",identity:"",tier:"",expRatio:.86,age:230,stats:{aptitude:98,looks:92,intelligence:90,health:95},baseAffection:45,baseTrust:25,spiritRoot:{type:"",elements:["",""],color:"#8ad3ff",desc:""},constitutionKey:"fumo_frost_thunder_body",inheritance:{bloodline:"",desc:""},cultivationMethod:"wanjian_heart",personality:{label:"",tag:"",desc:""},appearance:"",desc:"",title:"",trait:{name:"",desc:""},likes:["",""],dislikes:[""],world:{rankHint:"",combatPower:36e4,location:""}},{key:"demon_sage",name:"",alias:"",gender:"",identity:"",tier:"",expRatio:.78,age:210,stats:{aptitude:96,looks:95,intelligence:93,health:90},baseAffection:50,baseTrust:28,spiritRoot:{type:"",elements:["",""],color:"#ff7c8a",desc:""},constitutionKey:"fumo_abyssal_flame_core",inheritance:{bloodline:"",desc:""},cultivationMethod:"wanmo_heart",personality:{label:"",tag:"",desc:""},appearance:"",desc:"",title:"",trait:{name:"",desc:""},likes:["",""],dislikes:[""],world:{rankHint:"",combatPower:345e3,location:""}}],Tu=qf.length,Iu=jT,ah=e=>qf.find(t=>t.id===e),Lp=(e=[])=>{const t=new Set(e||[]);return qf.filter(n=>!t.has(n.id))},CT=e=>e?{id:`FUMO_${e.id}_${Date.now()}`,type:"FUMO_SWORD",swordId:e.id,name:e.name,basePrice:e.basePrice,description:`${e.epithet}  ${e.desc}`,rarity:"legendary",plot:e.auctionFlavor}:null,TT=e=>e?{instanceId:`fumo_sword_${e.id}_${Date.now()}`,name:e.name,type:"weapon",rarity:"legendary",desc:`${e.epithet}  ${e.desc}

${e.blessing}`,tags:["",""],bound:!0,effect:{kind:"artifact",stat:"atk",amount:800}}:null,IT=e=>{var i;if(!e)return null;const t=An(e.tier)||{maxExp:12e4},n=Math.floor((e.expRatio||.8)*t.maxExp),s=e.constitution?Yl(e.constitution):e.constitutionKey?ja(e.constitutionKey):null,o={id:`legend_${e.key}`,name:e.name,alias:e.alias,gender:e.gender,identity:e.identity,title:e.title,tier:e.tier,currentExp:n,maxExp:t.maxExp,stats:{...e.stats},spiritRoot:e.spiritRoot?{...e.spiritRoot}:null,cultivationMethod:e.cultivationMethod,constitution:s,personality:e.personality,appearance:e.appearance,desc:e.desc,trait:e.trait,likes:e.likes,dislikes:e.dislikes,relationship:{stage:0,affection:e.baseAffection??40,trust:e.baseTrust??20,jealousy:10},logs:[],status:"AVAILABLE",customFlags:{isFumoLegend:!0,legendKey:e.key,inheritanceTag:(i=e.inheritance)==null?void 0:i.bloodline}};return o.combatStats=Cn(o),o},_T=(e,t)=>{var o,i,a,l;if(!e)return null;const n=Je.findIndex(d=>d.name===e.tier),s=An(e.tier)||{maxExp:12e4};return{id:`world_${e.key}`,name:e.name,title:e.title||e.identity,gender:e.gender===""?"female":"male",tier:e.tier,tierIndex:n>=0?n:Je.length-1,status:"ALIVE",location:((o=e.world)==null?void 0:o.location)||"",hasMetPlayer:!0,firstMetYear:t,currentExp:Math.floor((e.expRatio||.8)*s.maxExp),maxExp:s.maxExp,combatPower:((i=e.world)==null?void 0:i.combatPower)||s.maxExp*2,age:e.age||200,personality:e.personality,appearance:{description:e.appearance},relationships:{allies:[],enemies:[],disciples:[]},majorEvents:[`${t}${e.name} `],lastActiveYear:t,customFlags:{isFumoLegend:!0,legendKey:e.key,rankHint:(a=e.world)==null?void 0:a.rankHint,inheritanceTag:(l=e.inheritance)==null?void 0:l.bloodline}}},RT=["","",""],MT=e=>e[Math.floor(Math.random()*e.length)],$p=Object.values(Q).reduce((e,t)=>(e[t.key]=t.order,e),{}),AT={common:80,uncommon:160,rare:420,epic:900,legendary:2200},NT=e=>{const t=$p[e.resourceLevel]||1,n=AT[e.rarity]||300;return Math.floor(n*(1+t*.55))},LT=Object.values(Jc).filter(e=>e.resourceLevel&&$p[e.resourceLevel]>=2).map(e=>{var t;return{itemId:e.id,name:e.name,description:e.desc,rarity:e.rarity,resourceLevel:e.resourceLevel,resourceOrder:$p[e.resourceLevel]||1,basePrice:NT(e),type:e.type,plot:`${e.source||""}${((t=Q[e.resourceLevel])==null?void 0:t.label)||""}`}}),lh=(e,t={})=>{const{ownedFumoSwords:n=[],soldAuctionItems:s=[]}=t,o=new Set(s||[]),i=S=>o.has(`ITEM:${S}`)||o.has(S),a=S=>o.has(`FUMO:${S}`)||o.has(S),l=LT.filter(S=>!i(S.itemId)),d=3+Math.floor(Math.random()*3),u=[],p=()=>{if(!l.length)return null;const S=l.map(x=>({entry:x,weight:Math.max(1,10-x.resourceOrder*2)})),g=S.reduce((x,{weight:k})=>x+k,0);let h=Math.random()*g;for(const{entry:x,weight:k}of S)if(h-=k,h<=0)return x;return S[S.length-1].entry},c=new Set;for(let S=0;S<d;S++){let g=0,h=null;for(;g<10&&(h=p(),!(!h||!c.has(h.itemId)));)g++;h&&!c.has(h.itemId)&&(c.add(h.itemId),u.push({id:`ITEM_${Date.now()}_${S}`,type:"ITEM",itemId:h.itemId,name:h.name,basePrice:h.basePrice,description:h.description||`${h.name}`,resourceLevel:h.resourceLevel,rarity:h.rarity,plot:h.plot}))}if(Math.random()<.5){const S=MT(RT)+Fw(),g=150+Math.floor(Math.random()*300);u.push({id:`SLAVE_${Date.now()}_${Math.floor(Math.random()*999)}`,type:"SLAVE",name:S,basePrice:g,description:"",plot:""})}const v=Lp(n).filter(S=>!a(S.id));if(v.length>0){const S=Math.random()<.25?2:1,g=[...v];for(let h=0;h<S&&g.length>0;h++){const x=Math.floor(Math.random()*g.length),k=g.splice(x,1)[0],_=CT(k);_&&u.push(_)}}const w=` ${e} `,E=` ${u.length} `;return{title:w,message:E,items:u}},Al=10,ts=60,ch=e=>e?typeof e=="string"?{contextMessage:e}:e:{},dh=(e=3572,t=1)=>{const n=Math.max(1,Math.min(12,t||1));return(e-3572)*12+n},$T={[yt.PLAYER]:"",[yt.CHILD]:"",[yt.NPC]:""},C1=e=>e&&Array.isArray(e.usageTargets)&&e.usageTargets.length>0?e.usageTargets:Iy,Co=e=>C1(e).map(n=>$T[n]||P2[n]||n).join(""),zs=(e,t)=>e?t===yt.NPC&&e.resourceCategory==="PILL"?!0:C1(e).includes(t):!1,BT=()=>`log-${Date.now()}-${Math.random().toString(16).slice(2)}`,OT=[{id:"init-log-2",turn:0,message:"",category:"",type:null,title:null,details:null},{id:"init-log-3",turn:0,message:"",category:"",type:null,title:null,details:null}],PT=Gs!=null&&Gs.avatar?{...Gs.avatar}:{base:0,skinColor:0,hair:1,hairColor:0,eye:0,eyeColor:1,mouth:0},uh=e=>!e||typeof e!="object"?!1:["hair","hairId","faceId","eye","tZoneId"].some(t=>typeof e[t]<"u"&&e[t]!==null),zT=250,_u="forcePortraitUI",ph=()=>typeof window>"u"?!0:window.innerHeight>=window.innerWidth,DT=e=>e?!!(e.status==="DEAD"||e.state==="DEAD"||e.isDeceased||e.deathYear||e.deathReason||typeof e.lifespan=="number"&&e.lifespan<=0||typeof e.health=="number"&&e.health<=0||typeof e.currentHp=="number"&&e.currentHp<=0):!1;function FT(){var p0,f0,m0,g0,h0,x0,y0,b0,v0,S0,w0,E0;const e=O2(),{modalState:t,setModalState:n,openModal:s,closeModal:o}=e,i=b.useCallback(f=>{f.type===null?o():s(f.type,f.data)},[s,o]),a=D2(),{inventory:l,addItemsToInventory:d,removeItemFromInventory:u}=a,p=$w(),{player:c,setPlayer:m,updatePlayer:v,addResources:w,consumeResources:E,consumeEnergy:S,purchaseBusiness:g,applyCombatResult:h,updateWorldNpc:x,updateWorldNpcs:k,clearNewsBuffer:_,addToSpecialCollection:y,applyDefeatPenalty:R}=p,C=Nk(),{activeNpcs:I,deadNpcs:T,selectedNpc:L,selectedWorldNpc:ee,visibleNpcs:$,setActiveNpcs:O,setDeadNpcs:H,setSelectedNpc:F,setSelectedWorldNpc:se,updateNpc:J,addNpc:de,toggleNpcFollow:Ee,batchUpdateNpcs:$e,replaceAllNpcs:De,batchUpdateNpcsByMap:Qe,cutTiesWithNpc:Y}=C,ue=Lk(),{children:ne,fallenChildren:ce,selectedChild:ae,enhancedChildren:je,setChildren:X,setFallenChildren:Me,setSelectedChild:Ae,updateChild:_e,removeChild:z,toggleChildFavorite:he,batchUpdateChildren:ye,replaceAllChildren:ke,batchUpdateChildrenIf:ve}=ue,[Ge,on]=b.useState(!0),[pt,Ct]=b.useState(!0),[Qt,Yr]=b.useState("PROLOGUE");b.useEffect(()=>{const f=n1();console.log(":",f?"":"")},[]),b.useMemo(()=>Oy.map(f=>{var j;const M=(j=f.stats)==null?void 0:j.aptitude;return typeof M=="number"?{...f,spiritRoot:ai(M)}:f}),[]);const[lo,ks]=b.useState(()=>ph()),[tr,js]=b.useState(()=>typeof window>"u"?!1:localStorage.getItem(_u)==="true"),an=b.useMemo(()=>{const f=((c==null?void 0:c.exiledChildren)||[]).map(M=>M.id);return je.filter(M=>!f.includes(M.id))},[je,c==null?void 0:c.exiledChildren]),Lt=b.useMemo(()=>[...an].sort((f,M)=>{var A,B;const j=f.age-M.age;if(j!==0)return j;const P=(((A=M.stats)==null?void 0:A.aptitude)||0)-(((B=f.stats)==null?void 0:B.aptitude)||0);return P!==0?P:f.name.localeCompare(M.name,"zh-CN")}),[an]),co=b.useMemo(()=>an.filter(f=>f.age>=16&&!f.job).map(f=>{var M;return{id:f.id,name:f.name,age:Math.max(16,Math.floor(f.age||0)),gender:f.gender,tierTitle:f.tierTitle||"",intelligence:((M=f.stats)==null?void 0:M.intelligence)??0}}).sort((f,M)=>(M.intelligence??0)-(f.intelligence??0)),[an]),fr=b.useMemo(()=>{var f;return[...((f=c.specialCollections)==null?void 0:f.fumoSwords)||[]]},[(p0=c.specialCollections)==null?void 0:p0.fumoSwords]),Ba=b.useMemo(()=>Lp(fr),[fr]),Oa=b.useMemo(()=>{var f,M;return(f=c.specialFlags)!=null&&f.fumoDuoMet?!1:(M=c.specialFlags)!=null&&M.fumoDuoUnlocked?!0:Tu>0&&Ba.length===0},[(f0=c.specialFlags)==null?void 0:f0.fumoDuoMet,(m0=c.specialFlags)==null?void 0:m0.fumoDuoUnlocked,Ba.length]);b.useEffect(()=>{if(typeof window>"u")return;const f=()=>{ks(ph())};return f(),window.addEventListener("resize",f),window.addEventListener("orientationchange",f),()=>{window.removeEventListener("resize",f),window.removeEventListener("orientationchange",f)}},[]),b.useEffect(()=>{typeof document<"u"&&document.body.classList.toggle("force-portrait-ui",tr),typeof window<"u"&&(tr?localStorage.setItem(_u,"true"):localStorage.removeItem(_u))},[tr]),b.useEffect(()=>()=>{typeof document<"u"&&document.body.classList.remove("force-portrait-ui")},[]),b.useEffect(()=>{var f;((f=c==null?void 0:c.childrenStrategy)==null?void 0:f.skipZhaozhou)!==void 0&&Ua(!!c.childrenStrategy.skipZhaozhou)},[(g0=c==null?void 0:c.childrenStrategy)==null?void 0:g0.skipZhaozhou]);const[Cs,di]=b.useState(OT),ze=b.useCallback((f,M="",j=null,P=null,A=null)=>{var D,oe;const B=((D=c==null?void 0:c.time)==null?void 0:D.year)??3572,N=((oe=c==null?void 0:c.time)==null?void 0:oe.month)??1,W=(B-3572)*12+N,q={id:BT(),turn:W,message:f,category:M,type:j,title:P,details:A};di(ie=>[q,...ie])},[(h0=c==null?void 0:c.time)==null?void 0:h0.year,(x0=c==null?void 0:c.time)==null?void 0:x0.month]),[nr,nd]=b.useState("FAMILY"),[ln,rr]=b.useState(!1),[Ts,rd]=b.useState(1),[Is,Pa]=b.useState(!1),[uo,sd]=b.useState("AGE_DESC"),[po,od]=b.useState("DEFAULT"),[ui,fo]=b.useState(0),qr=b.useMemo(()=>{const f=I.filter(M=>{var j;return!((j=M.relationship)!=null&&j.cutTies)&&(!Is||M.isFollowed)});switch(po){case"AFFECTION_DESC":return f.sort((M,j)=>{var B,N;const P=((B=M.relationship)==null?void 0:B.affection)||0;return(((N=j.relationship)==null?void 0:N.affection)||0)-P});case"TRUST_DESC":return f.sort((M,j)=>{var B,N;const P=((B=M.relationship)==null?void 0:B.trust)||0;return(((N=j.relationship)==null?void 0:N.trust)||0)-P});case"APTITUDE_DESC":return f.sort((M,j)=>{var B,N;const P=((B=M.stats)==null?void 0:B.aptitude)||0;return(((N=j.stats)==null?void 0:N.aptitude)||0)-P});default:return f}},[I,po,Is]),mo=b.useMemo(()=>Math.max(1,Math.ceil(qr.length/Al)),[qr.length]);b.useEffect(()=>{fo(0)},[po,Is]),b.useEffect(()=>{fo(f=>Math.min(f,Math.max(0,mo-1)))},[mo]);const id=b.useMemo(()=>{const f=ui*Al;return qr.slice(f,f+Al)},[qr,ui]),ad=qr.length>Al,ld=b.useMemo(()=>{if(!ae||Lt.length===0)return null;const f=Lt.findIndex(M=>M.id===ae.id);return f===-1?null:{hasPrev:f>0,hasNext:f<Lt.length-1,prevName:f>0?Lt[f-1].name:null,nextName:f<Lt.length-1?Lt[f+1].name:null,label:`${f+1}/${Lt.length}`}},[Lt,ae]),cd=b.useCallback(f=>{if(!ae)return;const M=Lt.findIndex(j=>j.id===ae.id);M!==-1&&(f==="PREV"&&M>0?Ae(Lt[M-1]):f==="NEXT"&&M<Lt.length-1&&Ae(Lt[M+1]))},[Lt,ae,Ae]),za=b.useCallback((f,M={})=>{var B,N,W,q,D;if(!f)return"";const j=[],P=f.gender===""?"":"",A=((B=f.stats)==null?void 0:B.aptitude)??"--";return j.push(`${P} ${A} ${f.tierTitle||""}`),(N=f.sect)!=null&&N.name&&j.push(` ${f.sect.name}${f.rank?`  ${f.rank}`:""}`),(W=f.spouse)!=null&&W.name&&j.push(` ${f.spouse.name} `),(q=f.trait)!=null&&q.name&&j.push(`${f.trait.name}`),(D=f.influenceProfile)!=null&&D.label&&j.push(`${f.influenceProfile.label}`),typeof M.descendantCount=="number"&&M.descendantCount>0&&j.push(` ${M.descendantCount} `),`${j.join("")}`},[]),pi=b.useCallback((f,M=[])=>{var A,B;if(!Array.isArray(f)||f.length===0)return;const j=((A=c==null?void 0:c.time)==null?void 0:A.year)??0,P=((B=c==null?void 0:c.time)==null?void 0:B.month)??1;Me(N=>{const W=new Set(N.map(D=>D.id)),q=[];return f.forEach(D=>{var re;if(!D||W.has(D.id))return;const oe=M.filter(Z=>Z.parentId===D.id).length,ie=D.deathReason||(typeof D.lifespan=="number"&&D.lifespan<=0?"":"");q.push({id:D.id,name:D.name,gender:D.gender,avatar:D.avatar,tierTitle:D.tierTitle,generation:D.generation||1,ageAtDeath:Math.max(0,Math.floor(D.age||0)),deathYear:j,deathMonth:P,deathReason:ie,sect:D.sect?{...D.sect}:null,rank:D.rank||null,trait:D.trait||null,influenceLabel:((re=D.influenceProfile)==null?void 0:re.label)||null,descendants:oe,epitaph:za(D,{descendantCount:oe})})}),q.length?[...q,...N]:N}),f.forEach(N=>{if(!N)return;const W=N.deathReason||(typeof N.lifespan=="number"&&N.lifespan<=0?"":"");ze(` ${N.name} ${W} ${Math.max(0,Math.floor(N.age||0))} `)})},[(y0=c==null?void 0:c.time)==null?void 0:y0.year,(b0=c==null?void 0:c.time)==null?void 0:b0.month,za,ze]),[fi,_s]=b.useState(null),[dd,mi]=b.useState(!1),[go,Cr]=b.useState({id:null,name:"",total:0}),[Rs,Kr]=b.useState(0),[ud,Ms]=b.useState([]),[pd,Da]=b.useState(null),[fd,Fa]=b.useState([]),ho=b.useRef(null),{handleExplorationOption:md,handleStartCombat:gd}=pT({player:c,inventory:l,children:ne,exploreRealmState:go,exploreProgress:Rs,exploreTeamIds:fd,setPlayer:m,setExploreLog:Ms,setCombatData:_s,addNpc:(f,M)=>{var j;return(j=ho.current)==null?void 0:j.call(ho,f,M)},addItemsToInventory:d,inventoryMgr:a,calculateDynamicCombatStats:Cn,simulateCombat:Qi,generateRealmEnemy:Ek}),{handleCombatClose:Ha}=fT({player:c,children:ne,exploreRealmState:go,applyCombatResult:h,addLog:ze,setCombatData:_s,setExploreLog:Ms,batchUpdateChildren:ye,archiveChildDeaths:pi,addItemsToInventory:d,setIsExploring:mi}),hd=b.useCallback(()=>{Ha(fi)},[Ha,fi]),[Wa,xd]=b.useState(null),[As,V]=b.useState(!1),[Fe,Wn]=b.useState(!1),[Ut,xo]=b.useState(!1),[Ns,Ua]=b.useState(!1),[gi,T1]=b.useState(!1),[Ga,I1]=b.useState(!1),[Va,_1]=b.useState(!1),[_t]=b.useState(()=>new x5),[R1,Ls]=b.useState([]),[hi,Kf]=b.useState({}),Ya=b.useCallback(()=>{const f=wi.current;f&&(f.type==="idle"&&typeof window<"u"&&typeof window.cancelIdleCallback=="function"?window.cancelIdleCallback(f.id):clearTimeout(f.id),wi.current=null,Qa.current=null)},[]),qa=b.useCallback((f,M)=>{try{const j=l1(f);j.success&&(Xf.current=M,console.log(` : ${j.gameTime}`),window.dispatchEvent(new CustomEvent("autoSaveCompleted",{detail:{gameTime:j.gameTime}})))}catch(j){console.error(":",j)}finally{Qa.current=null}},[]),Qf=b.useCallback((f,M)=>{if(typeof window<"u"){if(typeof window.requestIdleCallback=="function"){window.requestIdleCallback(()=>qa(f,M),{timeout:1e3});return}if(typeof window.requestAnimationFrame=="function"){window.requestAnimationFrame(()=>qa(f,M));return}}setTimeout(()=>qa(f,M),0)},[qa]),Jf=b.useCallback((f,M)=>{Ya();const j=()=>{wi.current=null,Qf(f,M)};if(typeof window<"u"&&typeof window.requestIdleCallback=="function"){const P=window.requestIdleCallback(j,{timeout:1500});wi.current={type:"idle",id:P}}else{const P=setTimeout(j,zT);wi.current={type:"timeout",id:P}}Qa.current=M},[Ya,Qf]);b.useEffect(()=>()=>{Ya()},[Ya]);const[$s,yd]=b.useState([]),[xi,yi]=b.useState([]),[M1,bd]=b.useState(!1),[A1,vd]=b.useState([]),[Ka,Sd]=b.useState(null),[N1,bi]=b.useState([]),[L1,vi]=b.useState([]),[$1,Si]=b.useState([]),wi=b.useRef(null),Xf=b.useRef(null),Qa=b.useRef(null),Zf=b.useMemo(()=>{if(typeof navigator>"u")return!1;const f=navigator.userAgent||"";return/Android|Adr|OPPO|VIVO|MIUI|HONOR|HUAWEI/i.test(f)},[]);b.useEffect(()=>{Array.isArray(c==null?void 0:c.newsBuffer)&&(c.newsBuffer.length<=Ta||m(f=>({...f,newsBuffer:vu(f.newsBuffer)})))},[c==null?void 0:c.newsBuffer,m]),b.useEffect(()=>{var P;const f=!c.specialCollections||!Array.isArray(c.specialCollections.fumoSwords),M=!c.specialFlags||typeof c.specialFlags.fumoDuoUnlocked>"u"||typeof c.specialFlags.fumoDuoMet>"u";if(f||M){m(A=>{var W,q,D;const B=!A.specialCollections||!Array.isArray(A.specialCollections.fumoSwords),N=!A.specialFlags||typeof A.specialFlags.fumoDuoUnlocked>"u"||typeof A.specialFlags.fumoDuoMet>"u";return!B&&!N?A:{...A,specialCollections:B?{...A.specialCollections||{},fumoSwords:[...((W=A.specialCollections)==null?void 0:W.fumoSwords)||[]]}:A.specialCollections,specialFlags:N?{...A.specialFlags||{},fumoDuoUnlocked:((q=A.specialFlags)==null?void 0:q.fumoDuoUnlocked)||!1,fumoDuoMet:((D=A.specialFlags)==null?void 0:D.fumoDuoMet)||!1}:A.specialFlags}});return}if(c&&!c.familyRating&&m(A=>A.familyRating?A:{...A,familyRating:{currentId:so[0].id,history:[]}}),c&&!c.combatStats){console.log("...");const A=c.stats||{aptitude:50,luck:50,lifespan:100},B=((P=c.spiritRoot)==null?void 0:P.type)||"",N=ni(c.tier||"",A.aptitude,B);m(W=>({...W,stats:W.stats||A,spiritRoot:W.spiritRoot||{type:"",elements:["","","","",""],color:"#9E9E9E",multiplier:.5},combatStats:N}))}if(c&&!uh(c.avatar)&&m(A=>uh(A.avatar)?A:{...A,avatar:{...PT,...A.gender?{gender:A.gender}:{}}}),I.some(A=>!A.relationship||A.currentExp===void 0)&&(console.log(" NPC ..."),$e(A=>{const B={...A};if(B.relationship||(B.relationship={stage:0,affection:0,trust:0,jealousy:0}),B.currentExp===void 0){const N=B.tier||"",W=An(N);B.tier=N,B.currentExp=Math.floor(Math.random()*W.maxExp*.3),B.maxExp=W.maxExp}return B})),I.some(A=>{var N;if(!A)return!1;const B=Tc(A);return!((N=A.stats)!=null&&N.lifespan)||A.stats.lifespan<B})&&$e(A=>{if(!A)return A;const B=A.stats||{},N=Tc(A);return B.lifespan&&B.lifespan>=N?A:{...A,stats:{...B,lifespan:N}}}),I.some(A=>!A.memories)){console.log(" NPC ...");const A=I.map(B=>{ss.initializeAllNpcs([B]);const N=ne.filter(W=>W.fatherName===B.name||W.motherName===B.name);return N.length>0&&ss.backfillChildrenMemories(B,N),B});De(A)}ne.some(A=>!A.equipment)&&ye(A=>Ir(A)),ne.some(A=>A.spiritRoot&&!A.spiritRoot.elements)&&(console.log("..."),ye(A=>A.spiritRoot&&!A.spiritRoot.elements?{...A,spiritRoot:{type:"",elements:["","","","",""],desc:"",color:"#9E9E9E",multiplier:.5}}:A))},[c,I,ne]),b.useEffect(()=>{if(!Array.isArray(c.worldNpcs)||c.worldNpcs.length===0){console.log("...");const f=ET(30);m(M=>({...M,worldNpcs:f}))}},[c.worldNpcs]),b.useEffect(()=>{const f=localStorage.getItem("has_read_tutorial_v2");Qt==="MAIN"&&!f&&setTimeout(()=>{e.openTutorial(),localStorage.setItem("has_read_tutorial_v2","true")},1e3)},[Qt,e]);const B1=()=>{e.closeTutorial(),localStorage.setItem("has_read_tutorial_v2","true")};b.useEffect(()=>{if(!As)return;const f=ne.filter(j=>Math.floor(j.age*12)>=144&&j.isTested&&!j.sect);if(f.length===0)return;let M=0;ye(j=>{if(!f.some(B=>B.id===j.id))return j;const A=Td(j);return A?(M++,{...j,sect:A,rank:ia(j,A)}):j}),M>0&&te("",` ${M} `,!0)},[ne,As]);const O1=()=>{localStorage.setItem("has_read_tutorial_v2","true")},P1=()=>{e.closeGuide()},e0=(v0=t.data)==null?void 0:v0.autoClose,[HT,WT]=b.useState(null),[UT,GT]=b.useState({}),[wd,Ei]=b.useState(null);b.useEffect(()=>{if(!wd)return;const f=setTimeout(()=>Ei(null),3200);return()=>clearTimeout(f)},[wd]);const[yo,ki]=b.useState([]),[Ja,Ed]=b.useState([]),[Bs,kd]=b.useState({open:!1,item:null}),z1=b.useCallback(({messageId:f,targetNpcId:M,relation:j,content:P,tone:A})=>{var q;const B=(P||"").trim();if(!B)return{success:!1,error:""};const N={year:c.time.year,month:c.time.month},W=_t.addReplyToMessage(f,{content:B,tone:A==null?void 0:A.id,toneLabel:A==null?void 0:A.label,sentiment:A==null?void 0:A.desc,timestamp:N,from:c.name,affectionDelta:(A==null?void 0:A.affectionDelta)||0});if(!W)return{success:!1,error:""};if(Ls(_t.getAllMessages()),ze(`${W.message.senderName}`,""),A!=null&&A.affectionDelta&&j!=="child"){const D=I.find(oe=>oe.id===M);if(D){const oe=((q=D.relationship)==null?void 0:q.affection)||0,ie=Math.max(0,Math.min(100,oe+A.affectionDelta));J(M,{relationship:{...D.relationship||{},affection:ie}})}}return{success:!0}},[_t,c.time.year,c.time.month,c.name,ze]),Xa=b.useMemo(()=>{var f;return yw((f=c==null?void 0:c.familyRating)==null?void 0:f.currentId)},[(S0=c==null?void 0:c.familyRating)==null?void 0:S0.currentId]),D1=b.useMemo(()=>{let f=0;return ne.forEach(M=>{f+=kc(M,{familyRatingMultiplier:Xa})}),f},[ne,Xa]),ji=b.useMemo(()=>Cw(ne,c),[ne,c]),F1=b.useCallback(()=>i({type:null,data:null}),[i]),te=b.useCallback((f,M,j=!0,P=null,A=!0,B=null)=>{const N=B||{},W=N.forceManual?!1:A;if(i({type:"RESULT",data:{title:f,msg:M,success:j,changes:P,autoClose:W}}),N.skipLog)return;const q=typeof M=="string"?M:"",D=f||"",oe=q.length>20,ie=N.message||(oe?`${D}`:q||D),re=N.details!==void 0?N.details:oe?q:null,Z=N.title??D,xe=N.category||"",U=N.type??null;ze(ie,xe,U,Z,re)},[ze]),Ci=b.useCallback((f,M,j=null)=>{i({type:"CONFIRM",data:{message:f,onConfirm:M,input:(j==null?void 0:j.input)||null}})},[]),jd=b.useRef(0);b.useEffect(()=>{jd.current=0},[$.length]);const mr=b.useCallback(()=>$.length+jd.current,[$.length]),t0=b.useCallback(f=>{const M=f?`${f}

`:"";te("",`${M}${ROMANCE_LIMIT_MESSAGE}`,!1),ze("","")},[te,ze]),Ti=b.useCallback(f=>{const M=ch(f);return mr()>=ts?(M.silent||t0(M.contextMessage),!1):!0},[mr,t0]),Tr=b.useCallback((f,M)=>{if(!f)return!1;const j=ch(M);return Ti(j)?(jd.current+=1,de(f),!0):!1},[de,Ti]);b.useEffect(()=>{ho.current=(f,M)=>Tr(f,M||"")},[Tr]);const n0=b.useCallback(()=>Math.max(0,ts-mr()),[mr]),H1={"XMZM-TEST-2026":{spiritStones:1e5},"XMZM-SKILL-5000-2026":{skillPoints:5e3},"XMZM-SPECIAL-MANUAL-2026":{items:["yin_yang_harmony_manual","blood_demon_manual","chaos_origin_manual","five_elements_supreme_manual","emperor_scripture_manual","deep_ocean_scripture_manual"]},"XMZM-POWER-1324845222862419919-2026":{combatPower:132484522286242e4}},r0=b.useCallback(()=>new Set((c==null?void 0:c.usedRedeemCodes)||[]),[c==null?void 0:c.usedRedeemCodes]),s0=b.useCallback(f=>{m(M=>({...M,usedRedeemCodes:[...f]}))},[m]),W1=b.useCallback(f=>{const M=(f||"").trim();if(!M)return{success:!1,message:""};const j=H1[M];if(!j)return{success:!1,message:""};const P=r0();if(P.has(M))return{success:!1,message:""};if(P.add(M),s0(P),j.spiritStones&&w({spiritStones:j.spiritStones}),j.skillPoints&&m(W=>({...W,skillPoints:(W.skillPoints||0)+j.skillPoints})),j.items&&j.items.length&&d(j.items),j.combatPower){const W=j.combatPower;m(q=>{var ie,re,Z;const D=Pn(q).total,oe=W-D;if(oe>0){const xe=Math.ceil(oe/45),U={...q.combatStats,atk:(((ie=q.combatStats)==null?void 0:ie.atk)||0)+xe,maxHp:(((re=q.combatStats)==null?void 0:re.maxHp)||0)+Math.ceil(oe/2),hp:(((Z=q.combatStats)==null?void 0:Z.hp)||0)+Math.ceil(oe/2)};return{...q,combatStats:U}}return q})}const A=[];if(j.spiritStones&&A.push(` ${j.spiritStones} `),j.skillPoints&&A.push(` ${j.skillPoints} `),j.combatPower&&A.push(`  ${j.combatPower}`),j.items&&j.items.length){const W=j.items.reduce((q,D)=>(q[D]=(q[D]||0)+1,q),{});Object.entries(W).forEach(([q,D])=>{var ie;const oe=((ie=cs(q))==null?void 0:ie.name)||q;A.push(` ${oe} ${D}`)})}const B=`
${A.join(`
`)}`,N={...j.spiritStones?{:j.spiritStones}:{},...j.skillPoints?{:j.skillPoints}:{},...j.combatPower?{:j.combatPower}:{},...j.items&&j.items.length?j.items.reduce((W,q)=>{var oe;const D=((oe=cs(q))==null?void 0:oe.name)||q;return W[D]=(W[D]||0)+1,W},{}):{}};return te("",B,!0,N),{success:!0,message:""}},[r0,s0,w,d,m,te]),U1=b.useCallback(async()=>{var M,j;let f=!1;if(typeof window<"u"&&((j=(M=window.screen)==null?void 0:M.orientation)!=null&&j.lock))try{await window.screen.orientation.lock("portrait"),f=!0}catch(P){console.warn(":",P)}js(!0),!f&&typeof window<"u"&&setTimeout(()=>window.dispatchEvent(new Event("resize")),80),te("",f?"":"",!0)},[te]),G1=b.useCallback(()=>{var f,M;if(typeof window<"u"&&((M=(f=window.screen)==null?void 0:f.orientation)!=null&&M.unlock))try{window.screen.orientation.unlock()}catch(j){console.warn(":",j)}js(!1),te("","",!0)},[te]),V1=b.useCallback(()=>{if(!ji.nextTier){te("","",!0);return}if(!ji.canUpgrade){te("","",!1);return}const f=ji.nextTier;m(j=>{var P;return{...j,familyRating:{currentId:f.id,history:[...((P=j.familyRating)==null?void 0:P.history)||[],{id:f.id,name:f.name,year:j.time.year,month:j.time.month}]}}});const M=`${f.name}`;ze(` ${M}`,""),te("",`${M}

${f.desc}`,!0)},[ji,m,ze,te]);b.useEffect(()=>{window.showResult=te,window.showConfirm=Ci},[te,Ci]),b.useEffect(()=>{if(!c.currentAuction||!c.auctionWindowStart||!c.auctionWindowEnd)return;dh(c.time.year,c.time.month)>=c.auctionWindowEnd&&v({currentAuction:null,auctionWindowStart:null,auctionWindowEnd:null})},[c.currentAuction,c.auctionWindowStart,c.auctionWindowEnd,c.time.year,c.time.month,v]);const Y1=(f,M)=>{if(!f)return{success:!1,title:"",message:""};const j=Math.max(0,M||f.basePrice||0);if((c.resources.spiritStones||0)<j)return{success:!1,title:"",message:""};if(f.type==="SLAVE"&&!Ti({contextMessage:"",silent:!0}))return{success:!1,title:"",message:ROMANCE_LIMIT_MESSAGE};E({spiritStones:j});let A="";if(f.type==="SLAVE"){const N=_p(c.tier);N.name=f.name,N.identity="",N.relationship=N.relationship||{},N.relationship.owner=c.name,N.relationship.affection=-20,N.relationship.trust=0,N.relationship.stage=0;const W=Q1(f,N);if(N.slavePlot=W,!Tr(N,{contextMessage:`${f.name}`,silent:!0}))return w({spiritStones:j}),{success:!1,title:"",message:ROMANCE_LIMIT_MESSAGE};A=` ${j}  ${f.name}Ta 

${W.intro}`,ze(" "+j+"  "+f.name)}else if(f.type==="ITEM"&&f.itemId){const N=or(f.itemId);if(!N)return{success:!1,title:"",message:""};f.description&&(N.desc=f.description),d([N]),A=` ${j}  ${f.name}`,ze(` ${j}  ${f.name}`)}else if(f.type==="FUMO_SWORD"){const N=ah(f.swordId)||{id:f.swordId,name:f.name},W=TT(N)||{instanceId:`fumo_${f.swordId||Date.now()}`,name:f.name,type:"weapon",rarity:"legendary",desc:f.description||f.plot||""};d([W]);const D=N.id&&fr.includes(N.id)?fr.length:fr.length+1,oe=Math.max(0,Tu-D),ie=N.blessing||"",re=oe===0?"":` ${oe} `;A=` ${j}  ${f.name}
${ie}

${re}`,ze(` ${f.name}`,""),Z1(N.id||f.swordId)}else{const N={instanceId:"auction_"+Date.now()+"_"+Math.floor(Math.random()*1e4),name:f.name,type:"consumable",rarity:f.rarity||"rare",desc:f.description||f.plot||"",effect:{kind:"exp",amount:3e3}};d([N]),A=` ${j}  ${f.name}`,ze(` ${j}  ${f.name}`)}const B=[];return f!=null&&f.id&&B.push(`INSTANCE:${f.id}`),(f==null?void 0:f.type)==="ITEM"&&f.itemId&&B.push(`ITEM:${f.itemId}`),(f==null?void 0:f.type)==="FUMO_SWORD"&&f.swordId&&B.push(`FUMO:${f.swordId}`),(f==null?void 0:f.type)==="SLAVE"&&f.id&&B.push(`SLAVE:${f.id}`),B.length===0&&(f!=null&&f.itemId||f!=null&&f.swordId||f!=null&&f.id)&&B.push(f.itemId||f.swordId||f.id),v({soldAuctionItems:[...c.soldAuctionItems||[],...B]}),{success:!0,title:"",message:A}},q1=f=>f.plot||f.description,K1=()=>{const f=dh(c.time.year,c.time.month),j=c.auctionWindowStart&&c.auctionWindowEnd&&f>=c.auctionWindowStart&&f<c.auctionWindowEnd;if(c.currentAuction){if(!j){v({currentAuction:null,auctionWindowStart:null,auctionWindowEnd:null}),Ei(null),te("","",!1);return}Ei(null),i({type:"AUCTION",data:c.currentAuction});return}if(f%36!==0){te("","",!1);return}const P=lh(c.time.year,{ownedFumoSwords:fr,soldAuctionItems:c.soldAuctionItems||[]});v({currentAuction:P,lastAuctionYear:c.time.year,auctionWindowStart:f,auctionWindowEnd:f+12}),Ei(null),i({type:"AUCTION",data:P})},Q1=(f,M)=>{const j=[{intro:`${M.name}Ta`,trauma:"",hope:""},{intro:`${M.name}Ta`,trauma:"",hope:""},{intro:`${M.name}Ta`,trauma:"",hope:""},{intro:`${M.name}Ta`,trauma:"",hope:""}];return{...j[Math.floor(Math.random()*j.length)],unlockStage:2}},Ir=f=>{const M=f.equipment||{weapon:null,armor:null,accessory:null};return{...f,equipment:M}},St=f=>{const M=Ir(f);return{...M,combatStats:Cn(M)}},J1={:30,:30,:30,:30,:50,:50,:50,:50,:200,:200,:200,:200,:300,:300,:300,:300,:500,:500,:500,:500},X1=(f=0)=>{for(let M=0;M<Je.length;M++)if(f<Je[M].maxExp)return Je[M];return Je[Je.length-1]},cn=(f,M=0)=>{var oe;const j=(f.cultivation||0)+M,P=f.tierTitle,A=X1(j),B=Je.findIndex(ie=>ie.name===A.name),N=B>0?Je[B-1].maxExp:0;let W={...f,cultivation:j,tierTitle:A.name,currentExp:j-N,maxExp:A.maxExp-N},q=0;const D=!!P&&P!==A.name;return D&&(q=J1[A.name]||50,W={...W,stats:{...W.stats,lifespan:(((oe=W.stats)==null?void 0:oe.lifespan)??100)+q}}),{updated:W,tierChanged:D,lifespanIncrease:q,newTier:A.name,prevTier:P}},Z1=b.useCallback(f=>{var N,W;if(!f)return;const M=Array.isArray((N=c.specialCollections)==null?void 0:N.fumoSwords)?c.specialCollections.fumoSwords:[];if(M.includes(f))return;y("fumoSwords",f);const j=[...M,f];Lp(j).length===0&&Tu>0&&!((W=c.specialFlags)!=null&&W.fumoDuoUnlocked)&&v({specialFlags:{...c.specialFlags||{},fumoDuoUnlocked:!0}});const B=ah(f);B&&ze(` ${B.name} `,"")},[c.specialCollections,c.specialFlags,y,v,ze]),o0=f=>{if(!f)return 0;const j={common:10,uncommon:50,rare:200,epic:800,legendary:3e3,mythic:8e3}[f.rarity]||10,P=f.type==="weapon"||f.type==="armor"||f.type==="accessory"?2:1;return Math.max(1,Math.floor(j*P))},eb=(f,M)=>{const j=l.find(D=>D.instanceId===f);if(!j){te("","",!1);return}const P=typeof M=="number"?Math.min(M,j.quantity||1):j.quantity||1,A=u(f,P);if(!A){te("","",!1);return}const B=o0(j),W=Math.floor(B*.7*(A.quantity||1)),q=A.quantity&&A.quantity>1?" x"+A.quantity:"";w({spiritStones:W}),te(""," "+W+"  "+A.name+q+"",!0,{:W}),ze(""+A.name+q+" "+W+" ")},tb=f=>{if(!l.find(P=>P.instanceId===f)){te("","",!1);return}const j=u(f);if(!j){te("","",!1);return}te("",` ${j.name}${j.quantity&&j.quantity>1?` x${j.quantity}`:""}`,!0),ze(`${j.name}${j.quantity&&j.quantity>1?` x${j.quantity}`:""}`)},i0=(f,M)=>{var P;const j=I.find(A=>A.id===f);if(M==="TOGGLE_FOLLOW"){Ee(f);return}if(M==="GIFT"){i({type:"GIFT",data:j});return}if(M==="PROPOSE"){const A=pu(j,"PERSUADE");if(!A.allowed){te("",A.reason,!1,null,!1,{category:"",type:"PERSUADE",title:"",message:"",details:A.reason,forceManual:!0});return}i({type:"NEGOTIATE",data:j});return}if(M==="SPAR"){const A=pu(j,"SPAR");if(!A.allowed){te("",A.reason,!1,null,!1,{category:"",type:"SPAR",title:"",message:"",details:A.reason,forceManual:!0});return}if((c.energy||0)<=0){te("","",!1,null,!1,{category:"",type:"SPAR",title:"",message:"",details:"",forceManual:!0});return}S(1);const B={...c,combatStats:c.combatStats||{maxHp:100,maxMp:50,atk:10,def:5,hp:100,mp:50}},N={...j,combatStats:j.combatStats||{maxHp:100,maxMp:50,atk:10,def:5,hp:100,mp:50}},q=Qi(B,N).winner==="player";let D=0;const oe=j.identity==="",ie=j.identity==="",re=j.identity==="";oe||ie||re||Math.random()<.3&&(D=q?2:3);const xe=I.find(Ne=>Ne.id===f);if(xe){const Ne=xe.relationship||{},Xe=Ne.affection||0;let ct={...xe,relationship:{...Ne,affection:Math.min(100,Xe+D)}};ct=OE(ct,c,Math.floor(c.age),c.time.month,!q),ct=qi(ct),J(f,ct)}m(Ne=>{const Xe={...Ne,currentExp:(Ne.currentExp||0)+(q?3:5)};return{...Xe,combatStats:Cn(Xe)}});const U=xu(j,c),me=(U==null?void 0:U.title)||(q?"":""),ge=(U==null?void 0:U.description)||(q?` ${j.name}${j.gender===""?"":""}`:` ${j.name}`);te(me,ge,!0,{:D,:q?3:5},!1,{category:"",type:"SPAR",title:me,message:`${me}`,details:ge,forceManual:!0}),Za(j,"SPAR");return}if(M==="DUAL_CULTIVATION"){const A=pu(j,"DUAL_CULTIVATION");if(!A.allowed){te("",A.reason,!1,null,!1,{category:"",type:"DUAL_CULTIVATION",title:"",message:"",details:A.reason,forceManual:!0});return}if((c.energy||0)<=0){te("","",!1,null,!1,{category:"",type:"DUAL_CULTIVATION",title:"",message:"",details:"",forceManual:!0});return}const B=A.requiresCheck;if(B&&!(Math.random()<A.checkRate)){te("",`${j.name}"..."${j.gender===""?"":""}`,!1,null,!1,{category:"",type:"DUAL_CULTIVATION",title:"",message:"",details:`${j.name}${j.gender===""?"":""}`,forceManual:!0});return}const N=50;if(c.resources.spiritStones<N){te("",` ${N} : ${c.resources.spiritStones}`,!1,null,!1,{category:"",type:"DUAL_CULTIVATION",title:"",message:"",details:` ${N}  ${c.resources.spiritStones??0}`,forceManual:!0});return}const W=((P=j.relationship)==null?void 0:P.affection)||0;let q=20,D=1;W>=80?(D=2,q=30):W>=60?(D=1.5,q=25):W>=40&&(D=1.2,q=22);const oe=Math.floor(q*D);m(U=>{const me={...U,resources:{...U.resources,spiritStones:Math.max(0,U.resources.spiritStones-N)},currentExp:(U.currentExp||0)+q,energy:Math.max(0,(U.energy||0)-1)};return{...me,combatStats:Cn(me)}});const ie=I.find(U=>U.id===f);if(ie){const U=ie.relationship||{},me=U.affection||0;let ge={...ie,currentExp:(ie.currentExp||0)+oe,relationship:{...U,affection:Math.min(100,me+5)},dualCultivationCount:(ie.dualCultivationCount||0)+1};ge=PE(ge,c,Math.floor(c.age),c.time.month),ge=qi(ge),J(f,ge)}let re;B?re=`${j.name}${j.gender===""?"":""}

${j.gender===""?"":""}

""${j.gender===""?"":""}""`:re=` ${j.name} ${W>=80?"":W>=60?"":""}`;const Z=B?"":"",xe=B?"BUDDHA_FIRST_DUAL":"DUAL_CULTIVATION";te(Z,re,!0,{:5,:q,[`${j.name}`]:oe,:-N,:-1},!1,{category:"",type:xe,title:Z,message:`${Z}`,details:re,forceManual:!0}),W>=70&&Math.random()<.3&&Yt(c.newsBuffer,"DUAL_CULTIVATION",{actor:c.name,target:j.name}),Za(j,"DUAL_CULTIVATION");return}if(M==="CHAT"){if((c.energy||0)<=0){te("","",!1,null,!1,{category:"",type:"CHAT",title:"",message:"",details:"",forceManual:!0});return}S(1);const A=j.identity==="",B=j.identity==="",N=j.identity==="",W=A||B||N,D=(W?Math.random()<.05:!0)?xu(j,c):null;if(D){const U=j.relationship||{},me=U.affection||0;J(f,{relationship:{...U,affection:Math.min(100,me+(D.affectionBonus||2))}});const ge=(D==null?void 0:D.title)||"",Ne=(D==null?void 0:D.text)||"";te(ge,Ne,!0,{:(D==null?void 0:D.affectionBonus)||2},!1,{category:"",type:"CHAT_EVENT",title:ge,message:`${ge}`,details:Ne,forceManual:!0});return}const oe=W?.05:.15;if(Math.random()<oe){const U=qk(j);if(U){i({type:"EVENT",data:{npc:j,event:U}});return}}const ie=Vj(j),Z=j.identity===""||A||B||N;if(Z){let U=Sg(j,c,Math.floor(c.age),c.time.month);U=qi(U),J(f,U)}else{const U=j.relationship||{},me=U.affection||0;let ge={...j,relationship:{...U,affection:me+2}};ge=Sg(ge,c,Math.floor(c.age),c.time.month),ge=qi(ge),J(f,ge)}const xe=` ${j.name} ${j.gender===""?"":""}
"${ie}"`;te("",xe,!0,Z?{}:{:2},!1,{category:"",type:"CHAT",title:`${j.name}`,message:`${j.name}`,details:xe,forceManual:!0}),Za(j,"CHAT")}M==="DETAIL"&&F(j)},Za=(f,M)=>{const j=p5(c,f,I,M);if(j.length>0){const P=new Set(j.map(W=>W.id)),A=[],B={CHAT:"",GIFT:"",SPAR:"",DUAL_CULTIVATION:""};if(O(W=>W.map(q=>{var xe,U;if(!P.has(q.id))return q;const D=u5(q,f,M);if(D===0)return q;const oe=((xe=q.relationship)==null?void 0:xe.jealousy)||0,ie=Math.min(100,oe+D),re=new Set([...((U=q.relationship)==null?void 0:U.rivalNpcs)||[],f.id]);let Z={...q,relationship:{...q.relationship||{},jealousy:ie,rivalNpcs:Array.from(re),lastInteraction:c.time.month}};return A.push({witnessName:q.name,targetName:f.name,increase:D,newJealousy:ie,level:d5(ie).label,actionLabel:B[M]||""}),Z=wg(Z,c,c.time.year,c.time.month,f,ie),ie>=41&&Math.random()<.3&&(Z=zE(Z,c,c.time.year,c.time.month)),ie>=60&&Math.random()<.25&&Yt(c.newsBuffer,"NPC_JEALOUSY",{actor:q.name,target:c.name,rival:f.name}),Z})),A.length>0){const W=A.map(q=>`${q.level}${q.witnessName}${q.targetName}${q.actionLabel} +${q.increase}  ${q.newJealousy}`).join(`

`);ze(`${A[0].witnessName} ${A[0].newJealousy}`,"","JEALOUSY","",W),Va||Ed(q=>[...q,{id:`${c.time.year}-${c.time.month}-${Date.now()}`,alerts:A,summary:W,actionLabel:B[M]||"",timestamp:{year:c.time.year,month:c.time.month},targetName:f.name}])}j.find(W=>{var D;return(((D=W.relationship)==null?void 0:D.jealousy)||0)>=60})&&ze("...")}},{handleGiftConfirm:nb,handleNegotiateConfirm:rb,handleOptionSelect:a0,handleShuraFieldSelect:sb}=mT({player:c,inventory:l,activeNpcs:I,modalState:t,setModalState:i,removeItemFromInventory:u,updateNpc:J,setActiveNpcs:O,batchUpdateNpcsByMap:Qe,setSelectedNpc:F,showResult:te,addLog:ze,handleWitnessCheck:Za,pushToNewsBuffer:Yt,isUsageAllowedForTarget:zs,RESOURCE_USAGE:yt,formatUsageTargets:Co}),ob=f=>{if(f==="CULTIVATE"){if((c.energy||0)<=0){te("","",!1);return}const M=10+Math.floor(Math.random()*5);m(j=>{const P={...j,currentExp:j.currentExp+M,energy:Math.max(0,(j.energy||0)-1)};return{...P,combatStats:Cn(P)}}),te("","",!0,{:M})}if(f==="WORK"){if((c.energy||0)<=0){te("","",!1);return}const M=15;w({spiritStones:M}),S(1),te("","",!0,{:M})}},ib=()=>{if(c.resources.spiritStones<10){te("",` 10 : ${c.resources.spiritStones}`,!1);return}E({spiritStones:10});const M=3+Math.floor(Math.random()*3),j=[],P={common:[{id:"herb_bandage",basePrice:15},{id:"rice_ball",basePrice:10}],uncommon:[{id:"beast_fang",basePrice:80},{id:"beast_core",basePrice:120},{id:"iron_sword",basePrice:100}],rare:[{id:"foundation_pill",basePrice:350},{id:"thunder_wood",basePrice:400},{id:"iron_armor",basePrice:450}],epic:[{id:"core_pill",basePrice:800},{id:"artifact_supreme",basePrice:1200},{id:"marrow_wash",basePrice:900}],legendary:[{id:"nascent_fruit",basePrice:2500},{id:"heaven_manual",basePrice:3e3}]},A=mw(c.tier);let B={common:60,uncommon:25,rare:10,epic:4,legendary:1};A>=6&&A<20?B={common:50,uncommon:27,rare:14,epic:7,legendary:2}:A>=20&&(B={common:45,uncommon:25,rare:18,epic:9,legendary:3});for(let N=0;N<M;N++){const W=lb(B),q=P[W];if(q&&q.length>0){const D=q[Math.floor(Math.random()*q.length)],oe=or(D.id);if(oe){const ie=.8+Math.random()*.4;oe.price=Math.floor(D.basePrice*ie),j.push(oe)}}}i({type:"SHOP",data:{items:j}})},ab=b.useCallback((f,M=1,j)=>{var W;if(!f)return;const P=Math.max(1,parseInt(M,10)||1),A=typeof j=="number"?j:(f.price||0)*P;if((((W=c==null?void 0:c.resources)==null?void 0:W.spiritStones)||0)<A)return;const N=[];if(f.stackable)N.push({...f,quantity:P,instanceId:`${f.id}_${Date.now()}_${Math.floor(Math.random()*1e4)}`});else for(let q=0;q<P;q++){const D=or(f.id);D&&N.push(D)}N.length!==0&&(E({spiritStones:A}),d(N))},[(w0=c==null?void 0:c.resources)==null?void 0:w0.spiritStones,E,d]),lb=f=>{const M=Object.values(f).reduce((P,A)=>P+A,0);let j=Math.random()*M;for(const[P,A]of Object.entries(f)){if(j<A)return P;j-=A}return"common"},cb=b.useCallback(()=>{const f=Iu.map(IT).filter(Boolean);if(f.length===0)return;const M=new Set(I.map(A=>A.id)),j=f.filter(A=>!M.has(A.id)).map(A=>vg(A,c,c.time.year,c.time.month));if(j.length>0){if(n0()<j.length){Ti({contextMessage:""});return}j.forEach(B=>Tr(B,""))}m(A=>{const B=new Set((A.worldNpcs||[]).map(W=>W.id)),N=Iu.map(W=>_T(W,c.time.year)).filter(W=>W&&!B.has(W.id));return{...A,specialFlags:{...A.specialFlags||{},fumoDuoUnlocked:!0,fumoDuoMet:!0},worldNpcs:[...A.worldNpcs||[],...N]}}),Iu.forEach(A=>{var B;ze(` ${((B=A.world)==null?void 0:B.rankHint)||""}${A.name}`,"")});const P="";te("",P,!0,null,!1,{category:"",type:"FUMO_LEGEND",title:"",message:P})},[ze,c,c.time.year,c.time.month,m,te,n0,Ti,Tr]),db=b.useCallback(f=>{if(I.some(P=>P.id===f.id)){ze(`${f.name}`,"");return}const j=l0(f);Tr(j,`${f.name} `)&&(x(f.id,{hasMetPlayer:!0}),ze(` ${f.name}`,""))},[I,ze,Tr,x]),ub=b.useCallback(f=>{var D;if(!f)return;if(f.status==="DEAD"){te("","",!1);return}if(c.tier===""){te("","",!1);return}const M=((D=f.sect)==null?void 0:D.name)||"",j={...c,combatStats:c.combatStats||{maxHp:100,maxMp:50,atk:10,def:5,hp:100,mp:50}},P=f.combatStats?f:{...f,combatStats:Cn(f)},A=Pn(j).total,B=Pn(P).total,{prob:N}=Py(j,P),W=Math.max(1,Math.min(99,Math.round(N*100))),q=`${M}${f.name}

${A}
${B}
${W}%

`;Ci(q,()=>{const oe=Qi(j,P);_s({enemy:P,result:oe,context:"sectLeader",worldNpc:P,onVictory:()=>{ze(` ${M}${f.name}`,"");const ie=`${M}${f.name}

`;Ci(ie,()=>{var Z;const re=((Z=c.time)==null?void 0:Z.year)??c.age??0;x(f.id,{status:"DEAD",deathYear:re,deathReason:""}),se(xe=>xe&&xe.id===f.id?{...xe,status:"DEAD",deathYear:re,deathReason:""}:xe),te("",`${M}${f.name}`,!0,null,!1,{category:"",title:"",message:`${M}${f.name}`})})},onDefeat:()=>{R(),te("",`${M}${f.name}`,!1,null,!1,{category:"",title:"",message:`${M}${f.name}`})}})})},[ze,c,Ci,te,x,se,R,Cn,_s]),l0=f=>{var j;return{id:f.id,name:f.name,gender:f.gender,identity:f.title||"",appearance:((j=f.appearance)==null?void 0:j.description)||"",desc:f.signature||"",tier:f.tier,currentExp:f.currentExp||0,maxExp:f.maxExp||500,stats:f.stats||{aptitude:85,looks:80,intelligence:85,health:90},spiritRoot:f.spiritRoot||{type:"",elements:[""],multiplier:1.8},relationship:{stage:0,affection:0,trust:0,jealousy:0},trait:{name:"",bonuses:{speedMultiplier:1.2}},sect:f.sect,sectId:f.sectId,sectRank:f.sectRank,sectStatus:f.sectStatus||"active",combatStats:f.combatStats||{hp:1e3,maxHp:1e3,atk:100,def:50,mp:500,maxMp:500},isTested:!0,isWorldElite:!0,isFollowed:!1,age:f.age||100,personality:f.personality,acceptsLetters:!0,isPregnant:!1,cultivationMethod:"basic_breath",constitution:f.constitution,avatar:f.avatar||{base:Math.floor(Math.random()*3),skinColor:Math.floor(Math.random()*5),eye:Math.floor(Math.random()*3),eyeColor:Math.floor(Math.random()*5),mouth:Math.floor(Math.random()*3),hair:Math.floor(Math.random()*3),hairColor:Math.floor(Math.random()*5)}}},pb=()=>{var P;if(c.resources.spiritStones<5){te("",` 5 : ${c.resources.spiritStones}`,!1);return}if(mr()>=ts){te("",`

(: ${mr()}/${ts})`,!1,null,!1,{skipLog:!0});return}if(E({spiritStones:5}),Oa){cb();return}const j=(c.worldNpcs||[]).filter(A=>A.status==="ALIVE"&&A.gender!==c.gender&&!A.hasMetPlayer);if(Math.random()<.05&&j.length>0){const A=j[Math.floor(Math.random()*j.length)],B=l0(A);if(!I.find(q=>q.id===B.id)&&!Tr(B,` ${A.name}

${A.gender===""?"":""}`))return;x(A.id,{hasMetPlayer:!0,firstMetYear:c.age});const W=`${A.gender===""?"":""}

${A.title} ${A.name}${A.gender===""?"":""}${A.tier}${A.gender===""?"":""}${((P=A.appearance)==null?void 0:P.description)||""}

${A.gender===""?"":""}...

 ${A.name}`;te(` ${A.name}`,W,!0,null,!1),ze(` ${A.title} ${A.name}`,"");return}if(Math.random()<.4){const A=_p(c.tier);let B="";if(A.identity===""?B=`${A.identity}${A.appearance}`:A.identity===""?B=`${A.identity}${A.appearance}`:A.identity===""?B=`${A.identity}${A.appearance}`:B=`${A.identity}${A.appearance}${A.desc.includes("")?"":""}`,!Tr(A,B))return;te(`${A.name}`,B,!0,null,!1)}else te("","",!1,{:-5})},fb=b.useCallback((f,M)=>{var P;J(f,{acceptsLetters:M}),F(A=>A&&A.id===f?{...A,acceptsLetters:M}:A);const j=((P=I.find(A=>A.id===f))==null?void 0:P.name)||"";ze(M?`  ${j} `:`  ${j} `,"")},[I,ze,J]),mb=()=>{ze("..."),$e(f=>f.id===1||f.id===2?vg(f,c,c.time.year,c.time.month):f),Yr("MAIN")},gb=(f=1,M=null)=>{let j;if(M)j=M;else{const A=vu(c.newsBuffer);j={player:c,children:ne,fallenChildren:ce,activeNpcs:I,deadNpcs:T,gameStage:Qt,logs:Cs,inventory:l,messages:_t.toJSON(),lastMessageCheck:hi,pendingSectChoices:xi,testQueue:$s,worldEvents:c.worldEvents||[],newsBuffer:A}}return i1(j,f)},c0=async(f=1,M=null)=>{try{let j;if(M)j=M;else try{j=await Uf(f)}catch(B){console.warn(":",B),j=Yo(f)}if(!j||!j.player)throw new Error("");j=M5(j);const P=L5(j.player);m(B=>{var N;return{...j.player,businesses:((N=j.player)==null?void 0:N.businesses)||[]}}),X(j.children||[]),O(j.activeNpcs||[]),H(j.deadNpcs||[]);const A=Array.isArray(j.inventory)?j.inventory:[];if(a&&a.setInventory(A),Yr(j.gameStage||"MAIN"),di(j.logs||[]),j.messages&&Ls(Array.isArray(j.messages)?j.messages:[]),Kf(j.lastMessageCheck||{}),j.pendingSectChoices&&yi(j.pendingSectChoices),j.testQueue&&yd(j.testQueue),Me(j.fallenChildren||[]),rr(!1),Ae(null),i({type:null,data:null}),M){let B=`
${j.gameTime||""}
${j.saveDate||""}`;P&&(B=P+`

`+B),te("",B,!0,null,!1)}else{let B=`
: ${f}
${j.saveDate||""}`;P&&(B=P+`

`+B),te("",B,!0,null,!1)}}catch(j){console.error(":",j),te("","",!1,null,!1)}},hb=()=>{B2(async()=>{const{clearAllSaves:f}=await Promise.resolve().then(()=>T5);return{clearAllSaves:f}},void 0,import.meta.url).then(({clearAllSaves:f})=>{f(),te("","",!0,null,!1)})},xb=(f,M)=>{var B;if(c.resources.spiritStones<f.cost){te("","",!1);return}if(c.resources.spiritStones<f.cost){te("",`${f.name} ${f.cost} : ${c.resources.spiritStones}`,!1);return}const j=ne.find(N=>N.id===M);if(!j){te("","",!1);return}const P=((B=j.stats)==null?void 0:B.intelligence)??j.intelligence??0,A=Math.floor(f.baseIncome*(1+P/100));g({id:`${f.id}-${Date.now()}`,name:f.name,managerId:M,baseIncome:f.baseIncome,income:A,type:f.id,cost:f.cost}),_e(M,{job:f.id}),te("",`${f.cost}${f.name}${j.name}: ${A}`,!0)},yb=(f,M,j={})=>{const{batchCount:P=1,isFastMode:A=!1}=j,B=f.cost*P,N=5*P;if(c.resources.spiritStones<B){te("",`${f.name} ${B} : ${c.resources.spiritStones}`,!1);return}if((c.energy||0)<N){te("",`${f.name} ${N} : ${c.energy||0}`,!1);return}if(!A&&mr()>=ts){te("",`

(: ${mr()}/${ts})

`,!1);return}if(A&&P>1){E({spiritStones:B}),S(N),M.map(me=>{var ge;return(ge=ne.find(Ne=>Ne.id===me))==null?void 0:ge.name}).filter(Boolean).join("");let oe=[],ie=[];for(let me=0;me<P;me++){const ge=(f.drops||["herb_bandage"]).filter(ct=>{const Rt=cs(ct);return Rt&&(!Rt.resourceLevel||Rt.resourceLevel===f.resourceLevel||Rt.resourceLevel==="MORTAL")}),Ne=ge.length>0?ge:["herb_bandage"],Xe=1+Math.floor(Math.random()*3);for(let ct=0;ct<Xe;ct++){const Rt=Ne[Math.floor(Math.random()*Ne.length)];ie.push(Rt)}}const re={};ie.forEach(me=>{re[me]=(re[me]||0)+1});const Z=Object.entries(re).flatMap(([me,ge])=>{const Ne=[];for(let Xe=0;Xe<ge;Xe++){const ct=or(me);ct&&Ne.push(ct)}return Ne});d(Z);const xe=Object.entries(re).map(([me,ge])=>{var Xe;const Ne=((Xe=cs(me))==null?void 0:Xe.name)||me;return ge>1?`${Ne}${ge}`:Ne}).join("");oe.push(` ${f.name}${P}`),oe.push(` ${xe}`);const U=`${f.name}${P}


${xe}

${B}
${N}`;te("",U,!0),oe.forEach(me=>ze(me,"exploration"));return}E({spiritStones:f.cost}),S(5),Cr({id:f.id,name:f.name,total:10}),Fa(M),Kr(1);const W=M.map(oe=>{var ie;return(ie=ne.find(re=>re.id===oe))==null?void 0:ie.name}).filter(Boolean).join(""),q=`${f.name}${W||""}`;Ms([q,`${f.name}`,`${f.difficulty}${f.recommendCP}`]);const D=Rg({realmId:f.id,progress:1});Da(D),mi(!0),ze(q,"exploration")},bb=b.useCallback(f=>{var j;if(!f)return;const M=[f.tierTitle?`${f.tierTitle}`:null,typeof f.ageAtDeath=="number"?`${f.ageAtDeath}`:null,f.deathYear?` ${f.deathYear} ${f.deathMonth||1}`:null,f.deathReason?`${f.deathReason}`:null,(j=f.sect)!=null&&j.name?`${f.sect.name}${f.rank?`  ${f.rank}`:""}`:null,typeof f.descendants=="number"?`${f.descendants}`:null,f.influenceLabel?`${f.influenceLabel}`:null].filter(Boolean).join(`
`);te(`  ${f.name}`,`${f.epitaph||""}

${M}`,!0,null,!1)},[te]),vb=f=>{ve(M=>M.id===f.id,M=>{const j={...M,isTested:!0,spiritRoot:f.spiritRoot};return St(j)})},Cd=b.useCallback((f=!1)=>{var I0,_0,R0,M0,A0,N0,L0,$0;let M=[];const j=G=>f?!G.includes(""):!0;let P=[],A=0;const B=I.map(G=>{if(G.isPregnant){const Se=G.pregnancyProgress+1;if(Se>=9){const fe=_k(c,G,Math.floor(c.age));P.push(fe),M.push(`${G.name}${fe.name}${fe.gender}${fe.tier}`),Yt(c.newsBuffer||[],"BIRTH",{actor:c.name,target:fe.name,detail:fe.gender}),A+=1;let Oe=HE(G,c,Math.floor(c.age),c.time.month,fe.name);const Ye=Math.random()>.7?"":"",Pe=Math.random()>.85;return ss.onChildBirth(Oe,fe,{difficulty:Ye,sacrifice:Pe}),{...Oe,isPregnant:!1,pregnancyProgress:0}}return{...G,pregnancyProgress:Se}}return G});De(B),B.some(G=>{var fe;return(((fe=G.customFlags)==null?void 0:fe.isFumoLegend)||G.identity===""||G.identity==="")&&G.isPregnant&&G.pregnancyProgress===8})&&console.log(" NPC8 - ");const W=((I0=c.stats)==null?void 0:I0.health)||50,q=Ht(W);v({energy:q});const D=((_0=c==null?void 0:c.time)==null?void 0:_0.year)??3572,{newChildren:oe,generation3Plus:ie,totalCost:re,logs:Z,events:xe}=Rk(ne||[],c.resources,{familyRatingMultiplier:Xa,playerStrategy:c,childrenStrategy:c==null?void 0:c.childrenStrategy,generation3Plus:(c==null?void 0:c.generation3Plus)||[],currentYear:D,worldNpcs:c.worldNpcs||[],activeNpcs:I||[]});m(G=>({...G,generation3Plus:ie}));let U=[...oe];const me=new Set(((c==null?void 0:c.exiledChildren)||[]).map(G=>G.id)),ge=U.filter(G=>{const Se=Math.floor(G.age*12);return Se>=72&&Se<78&&!G.isTested&&!me.has(G.id)});if(ge.length>0){const G=new Set(ge.map(fe=>fe.id));U=U.map(fe=>{var Oe,Ye,Pe;if(G.has(fe.id)){const et=((Oe=fe.stats)==null?void 0:Oe.aptitude)||50,at=I.find($t=>$t.name===fe.fatherName);let ut=null;if(at&&(((Ye=at.customFlags)==null?void 0:Ye.isFumoLegend)||at.identity===""||at.identity==="")&&(Pe=at.spiritRoot)!=null&&Pe.type){let hn=0;et>=75?hn=.85:et>=70?hn=.75:et>=65?hn=.6:et>=60?hn=.45:hn=.2,Math.random()<hn&&(ut={...at.spiritRoot,multiplier:(at.spiritRoot.multiplier||1)*.9})}ut||(ut=ir(et,fe.spiritRoot,null,{constitution:fe.constitution}));const wt={...fe,spiritRoot:ut,isTested:!0};if(Fe||(fe.generation||1)>1){const $t=St(wt);return M.push({message:` ${fe.name} ${ut.type}${et}`,category:""}),$t}return wt}return fe});const Se=Fe?[]:U.filter(fe=>ge.some(Oe=>Oe.id===fe.id)&&(fe.generation||1)===1);Se.length>0&&(yd(fe=>[...fe,...Se]),ln&&rr(!1))}P.length>0&&(U=[...U,...P]);const Ne=U.reduce((G,Se)=>(DT(Se)?G.casualties.push(Se):G.survivors.push(Se),G),{survivors:[],casualties:[]});Ne.casualties.length>0&&(pi(Ne.casualties,U),ae&&Ne.casualties.some(G=>G.id===ae.id)&&Ae(null));const Xe=Ne.survivors.filter(G=>{var Se;return G.rank===""&&((Se=G.sect)==null?void 0:Se.id)});if(Xe.length>0){const G=Xe.map(fe=>({id:fe.id,name:fe.name,gender:fe.gender,sect:fe.sect,sectRank:"",status:"ALIVE",age:fe.age,cultivation:fe.cultivation,tier:fe.tierTitle||fe.tier||"",tierTitle:fe.tierTitle||"",stats:fe.stats||{},children:[],source:"child"}));c.worldNpcs=c.worldNpcs?c.worldNpcs:[];const Se=c.worldNpcs.filter(fe=>fe.sectRank===""?!G.some(Ye=>{var Pe,et;return((Pe=Ye.sect)==null?void 0:Pe.id)===((et=fe.sect)==null?void 0:et.id)}):!0);c.worldNpcs=[...Se,...G],k(fe=>[...fe.filter(Ye=>Ye.sectRank===""?!G.some(et=>{var at,ut;return((at=et.sect)==null?void 0:at.id)===((ut=Ye.sect)==null?void 0:ut.id)}):!0),...G]),Xe.forEach(fe=>{M.push(` ${fe.name}  ${fe.sect.name}  `)})}ke(Ne.survivors);const ct=xe.filter(G=>G.type==="GRANDCHILD_BIRTH");if(A+=ct.length,A>0&&M.push(` ${A}${A}`),M=[...M,...Z],xe.length>0){xe.filter(fe=>fe.type==="ZHAOZHOU").forEach(fe=>{te(fe.title,fe.message,!0,null,!1)});const G=xe.filter(fe=>fe.type==="CHILD_PROMOTION_GIFT");if(G.length>0){const fe=G.map(Oe=>{const Ye=typeof Oe.message=="string"?Oe.message:String(Oe.message||"");return{...Oe,message:Ye}});fe.length>=2&&!Ut?(vi(fe),e.openBatchPromotionModal()):fe.forEach(Oe=>{const Ye=Oe.giftItemId?or(Oe.giftItemId):null;Ye&&d([Ye]);const Pe=Oe.title||"";Ut||te(Pe,Oe.message,!0,null,!1)})}const Se=xe.filter(fe=>{var Oe;return fe.type==="JOIN_SECT"&&!me.has((Oe=fe.child)==null?void 0:Oe.id)});if(Se.length>0)if(As){let fe=0;ye(Oe=>{if(!Se.find(at=>{var ut;return((ut=at.child)==null?void 0:ut.id)===Oe.id})||!(Math.floor(Oe.age*12)>=144)||!Oe.isTested||Oe.sect||me.has(Oe.id))return Oe;const et=Td(Oe);return et?(fe++,{...Oe,sect:et,rank:ia(Oe,et)}):Oe}),fe>0&&te("",` ${fe} `,!0)}else yi(fe=>{const Oe=[...fe,...Se];return Oe.sort((Ye,Pe)=>{var at,ut;return(((at=Ye.child)==null?void 0:at.name)||"").localeCompare(((ut=Pe.child)==null?void 0:ut.name)||"")}),Oe}),ln&&rr(!1)}if(c.businesses&&c.businesses.length>0&&U){const{income:G,logs:Se}=Ag(c.businesses,U);M=[...M,...Se],G>0&&M.push(` : ${G} `)}let Rt=0;if(U.forEach(G=>{try{const Se=kc(G,{familyRatingMultiplier:Xa});typeof Se=="number"&&!isNaN(Se)&&isFinite(Se)?Rt+=Se:console.warn("Invalid feedback for child:",G.name,Se)}catch(Se){console.error("Error calculating feedback for child:",G.name,Se)}}),c.rival&&!c.rival.isDead){const G=iC(c),Se=c.rival.threatLevel||0,fe=Math.min(100,Se+G);c.rival.threatLevel=fe,c.rival._threatChangeThisMonth={from:Se,to:fe,increased:G};const Oe=sC(c);if(Oe){const{survived:Ye,message:Pe,type:et,hpLoss:at}=Oe,ut=Ye?"":"";f&&rr(!1),M.push(`${ut}${Pe}`);let wt="";if(at&&at>0){const _r=Math.max(10,Math.floor(at*.2+Math.random()*at*.2)),$t=ri(c,_r,"ASSASSINATION");if(c.stats.health=$t.newHealth,$t.energyPenalty>0){const hn=Ht($t.newHealth);c.energy=Math.min(c.energy||20,hn)}wt=$t.message,$t.isSerious&&M.push(" ")}Yt(c.newsBuffer||[],et||(Ye?"ASSASSINATION_SURVIVED":"ASSASSINATION_INJURED"),{actor:c.name}),te("",wt?`${Pe}
${wt}`:Pe,Ye,null,!1)}if(c.time.month===12){const Ye=oC(c);Ye&&Yt(c.newsBuffer||[],Ye.type,Ye.data)}}if(!((R0=c.rival)!=null&&R0.isDead)){const G=(M0=c.rival)==null?void 0:M0._threatChangeThisMonth,Se=(G==null?void 0:G.from)||0,fe=((A0=c.rival)==null?void 0:A0.threatLevel)||0;if(Se<100&&fe>=100){f&&rr(!1),console.log("100%",{previousThreat:Se,currentThreat:fe});const Ye={currentExp:((N0=c.rival)==null?void 0:N0.currentExp)||300,stats:{aptitude:80}},Pe=Pn(Ye),et={name:"",combatStats:{hp:Math.floor(Pe*2.5),atk:Math.floor(Pe*.4),def:Math.floor(Pe*.2),mp:0,maxHp:Math.floor(Pe*2.5),maxMp:0}},at={...c,combatStats:c.combatStats||{maxHp:100,maxMp:50,atk:10,def:5,hp:100,mp:50}},ut=Qi(at,et);_s({enemy:et,result:ut,context:"rival"}),m(wt=>({...wt,rival:{...wt.rival,threatLevel:0}}))}}m(G=>{var Jr;const Se={...G.time};Se.month+=1,Se.month>12&&(Se.month=1,Se.year+=1);const fe=(G.age||16)+1/12,Oe=Aw(G);let Ye=((Jr=G.stats)==null?void 0:Jr.health)||50,Pe=G.energy||20;if(Oe&&Oe.recovered>0){Ye=Oe.newHealth,M.push(Oe.message);const nl=Ht(Ye);nl>Pe&&(Pe=nl)}const et={...G,energy:Pe,stats:{...G.stats,health:Ye},resources:G.resources||{spiritStones:0,spiritualAwareness:0}},at=An(et.tier),ut=Ca(et,!0),wt=typeof ut=="number"&&isFinite(ut)?ut:0,_r=typeof Rt=="number"&&isFinite(Rt)?Rt:0;let $t=et.currentExp+wt+_r;(!isFinite($t)||isNaN($t))&&(console.error("Invalid newExp calculation:",{currentExp:et.currentExp,playerSpeed:wt,totalFeedback:_r}),$t=et.currentExp),$t>=at.maxExp&&($t=at.maxExp);const{income:hn}=Ag(et.businesses||[],U),gr={...et,age:fe,skillPoints:(et.skillPoints||0)+A,time:Se,currentExp:$t,maxExp:(at==null?void 0:at.maxExp)||5e5,resources:{...et.resources,spiritStones:Math.max(0,et.resources.spiritStones-re+10+hn)}};try{return{...gr,combatStats:Cn(gr)}}catch(nl){return console.error("Error calculating combat stats:",nl),gr}}),M.length===0&&M.push("..."),M.forEach(G=>{j(G)&&ze(G)});const dt=c.time.month===12?1:c.time.month+1,$n=c.time.month===12?c.time.year+1:c.time.year;try{const Se=(c.time.year-3572)*12+c.time.month+1;if(Se%36===0){const fe=c.time.year+(dt===1?1:0),Oe=lh(fe,{ownedFumoSwords:fr,soldAuctionItems:c.soldAuctionItems||[]}),Ye=Se,Pe=Ye+12;m(et=>({...et,lastAuctionYear:fe,currentAuction:Oe,auctionWindowStart:Ye,auctionWindowEnd:Pe})),Ei({id:`${fe}-${Date.now()}`,message:""}),ze(" ")}}catch(G){console.warn("",G)}let Qr;try{Qr=ak(B,c,$n,dt)}catch(G){console.error("Error processing NPC lifecycles:",G),Qr={npcs:B,events:[]}}const k0=(Qr==null?void 0:Qr.npcs)||B,_d=(Qr==null?void 0:Qr.events)||[],j0=_d.filter(G=>G.type==="NPC_LIFESPAN_ALERT");if(j0.length>0){const G=j0.map(Se=>{const fe=Math.max(0,Math.floor(Se.remainingYears));return`${Se.npcName} ${fe} `});te("",G.join(`
`),!1,null,!1,{title:"",category:"",type:"WARNING"}),ln&&rr(!1)}const tl=_d.filter(G=>G.type==="NPC_GIFT");if(tl.length>0)if(tl.length>=2&&!Ga)bi(tl),e.openBatchGiftModal();else{const G=[];if(tl.forEach(Se=>{const fe=or(Se.giftItemId);if(fe){d([fe]);const Oe=`${Se.message}${fe.name}`;ze(Oe),G.push(`${Se.message}
${fe.name}`)}}),!Ga&&G.length>0){const Se=G.join(`

`);te("",Se,!0,null,!1,{category:"",type:"NPC_GIFT",title:"",message:Se,details:Se,forceManual:!0})}}const Ii=k0.filter(G=>!G.isDead),Rd=k0.filter(G=>G.isDead);Rd.length>0&&(H(G=>[...G,...Rd]),Rd.forEach(G=>{const Se=S5(G,c,{year:$n,month:dt});_t.addMessage(Se)}),Ls(_t.getAllMessages())),dt%3===0&&(Ii.forEach(G=>{var $t,hn;if(!(G.sect||G.status==="away"))return;const fe=localStorage.getItem("acceptChildLetters")!=="false",Oe=localStorage.getItem("acceptLoverLetters")!=="false",Ye=G.fatherName||G.motherName||G.generation||G.parent||G.parentId||(($t=c.children)==null?void 0:$t.some(gr=>gr.id===G.id)),Pe=G.id===((hn=c.spouse)==null?void 0:hn.id)||G.affection>60&&!Ye;if(Ye&&!fe||Pe&&!Oe)return;const et=hi[G.id]||0,at=$n*12+dt,ut=at-et,_r=_t.getAllMessages().find(gr=>gr.senderId===G.id&&gr.type===Ot.LETTER);if(v5(G,ut,_r)){const gr=_t.getRecentRepliesForNpc(G.id,3);Vg(G,c,{year:$n,month:dt},!0,{apiKey:localStorage.getItem("game_api_key")||"",apiUrl:localStorage.getItem("game_api_url")||"https://api.deepseek.com/chat/completions",apiModel:localStorage.getItem("game_api_model")||"deepseek-chat",useAIForLetter:localStorage.getItem("useAIForLetter")!=="false"},{children:ne,exiledChildren:c.exiledChildren||[],dualCultivationCount:G.dualCultivationCount||0,replyHistory:gr}).then(Jr=>{_t.addMessage(Jr),Ls(_t.getAllMessages())}).catch(Jr=>{console.error(":",Jr)}),Kf(Jr=>({...Jr,[G.id]:at}))}}),Ls(_t.getAllMessages())),_d.forEach(G=>{var Se;if(G.type==="NPC_DEATH")M.push(` ${G.message}`),Yt(c.newsBuffer||[],"DEATH",{actor:G.npcName,detail:G.age||0,location:""});else if(G.type==="NPC_BREAKTHROUGH"){M.push(` ${G.message}`),Yt(c.newsBuffer||[],"NPC_BREAKTHROUGH",{actor:G.npcName,detail:G.newTier});const fe=Ii.find(Oe=>Oe.name===G.npcName);fe&&((Se=fe.relationship)==null?void 0:Se.affection)>=70&&Math.random()<.4&&Yt(c.newsBuffer||[],"NPC_AFFECTION_HIGH",{actor:c.name,target:fe.name})}else G.type==="NPC_BREAKTHROUGH_FAIL"&&Yt(c.newsBuffer||[],"BREAKTHROUGH_FAIL",{actor:G.npcName,detail:G.tier})});const Md=GE(Ii,c,$n,dt),qb=$n*12+dt,Kb=Md.map(G=>{G.jealousy||(G.jealousy=0),G.lastInteraction||(G.lastInteraction={year:$n,month:dt});const Se=G.lastInteraction.year*12+G.lastInteraction.month,fe=qb-Se;if(fe<3){if(G.jealousy>0){const Pe=Hg(G);G.jealousy=Math.max(0,G.jealousy-Pe)}return G}const{jealousyGain:Oe,shouldLog:Ye}=f5(G,fe);if(Oe>0&&(G.jealousy=Math.min(100,(G.jealousy||0)+Oe),Ye)){const Pe=wg(G,G.jealousy,{year:$n,month:dt},c.name,"neglect");Pe&&(G.logs=[...G.logs||[],Pe])}if(G.jealousy>0){const Pe=Hg(G);G.jealousy=Math.max(0,G.jealousy-Pe)}return G});De(Kb);const C0=Rj($n,dt,c,Md),T0=Bj(c,U,$n,dt);T0&&C0.push(T0),C0.forEach(G=>{ze(G.message,G.category,G.type,G.title)});let _i=c.worldNpcs||[];if(dt%3===0&&_i.length>0&&(_i=ih(_i,$n),v({worldNpcs:_i})),dt%3===0)if(localStorage.getItem("enableGazette")!=="false"){const Se=c.newsBuffer||[],fe=Se.length>0?Se:[{type:"FILLER",data:{},timestamp:Date.now()}];localStorage.getItem("game_api_key"),localStorage.getItem("game_api_url"),localStorage.getItem("game_api_model"),localStorage.getItem("useAIForGazette");const Oe={},Ye={...c,worldNpcs:_i};v({newsBuffer:[],hasUnreadGazette:!1}),Promise.resolve(G5(fe,Ye,Md,(Ye.gazetteIssue||0)+1,Oe,ne)).then(Pe=>{Pe&&(v({gazetteHistory:[...Ye.gazetteHistory||[],Pe],gazetteIssue:Pe.issue,hasUnreadGazette:!0}),xd(Pe))}).catch(Pe=>{console.error(":",Pe),_()})}else v({newsBuffer:[]});if(dt===1&&dt!==3){const G=ih(c.worldNpcs||[],$n);v({worldNpcs:G}),G.forEach(Se=>{Se.status==="DEAD"&&Se.deathYear===$n&&(Yt(c.newsBuffer||[],"DEATH",{actor:`${Se.title} ${Se.name}`,detail:Se.age,location:Se.deathReason||""}),ze(` ${Se.rank?`${Se.rank}`:""}${Se.title} ${Se.name}${Se.deathReason}`))})}if(dt%3===0)if(gi)yo.length>0&&ki([]);else{const G=m5(Ii);if(G){const Se=g5(G.participants,c),fe=Se.participants.map(Pe=>Pe.name),Oe=fe[0]||"",Ye=fe[1]||"";Yt(c.newsBuffer,"SHURA_FIELD",{actor:c.name,dominant:Oe,rival:Ye,participants:fe.join(""),count:fe.length}),$e(Pe=>{if(!Se.participants.find(hn=>hn.id===Pe.id))return Pe;const at=typeof Pe.personality=="object"&&Pe.personality!==null&&"label"in Pe.personality?Pe.personality.label:Array.isArray(Pe.personality)?Pe.personality[0]:"",ut=c.gender===""?"":"";let wt="";switch(at){case"":wt=`...${c.name}${c.name}`;break;case"":wt=`...${c.name}${ut}${ut}`;break;case"":wt=`${c.name}...`;break;case"":wt=`${c.name}.........`;break;case"":wt=`${c.name}${ut}...`;break;case"":wt=`${c.name}...`;break;case"":wt=`...${c.name}""...`;break;case"":wt=`${c.name}......`;break;case"":wt=`${c.name}${ut}...`;break;default:wt=`...${c.name}${ut}...`}const _r=Pe.logs||[],$t={year:c.time.year,month:c.time.month,content:wt,type:"DAILY",isSecret:!0,timestamp:Date.now()};return{...Pe,logs:[$t,..._r].slice(0,50)}}),ki(Pe=>[...Pe,Se]),ln&&rr(!1),ze(" ...")}}const Qb=((L0=c==null?void 0:c.time)==null?void 0:L0.year)??0,Ad=(($0=c==null?void 0:c.time)==null?void 0:$0.month)??0,Nd=`${Qb}-${Ad}`,Jb=Xf.current===Nd,Xb=Qa.current===Nd,Zb=Zf&&Ad%2===0;if(!Jb&&!Xb&&Ad>0&&!Zb)try{const G=vu(c.newsBuffer),Se={player:c,children:ne,fallenChildren:ce,activeNpcs:Ii,deadNpcs:T,gameStage:Qt,logs:Cs,inventory:l,messages:_t.toJSON(),lastMessageCheck:hi,pendingSectChoices:xi,testQueue:$s,worldEvents:c.worldEvents||[],newsBuffer:G};Jf(Se,Nd)}catch(G){console.error(":",G)}},[ne,c,I,$s,Ut,gi,Ga,ln,yo,pi,ae,Ae,Qt,Cs,l,_t,hi,xi,Jf,Zf]);b.useEffect(()=>{I.some(M=>M.isPregnant&&M.pregnancyProgress===8)&&ln&&console.warn(" NPC8")},[I,ln]);const Sb=(f,M,j="")=>{var W,q;const P=Ry(M),A=ne.find(D=>D.id===f);if(!A)return;const B=Ay(A,P);if(!B.qualified){te("",((W=B.reasons)==null?void 0:W.join(""))||"",!1);return}ve(D=>D.id===f,D=>{const oe={...D,sect:P,rank:j},ie=I.find(xe=>xe.name===D.fatherName||xe.name===D.motherName);ie&&ss.onChildJoinSect(ie,D,P.name),localStorage.getItem("acceptChildLetters")!=="false"&&Vg({id:D.id,name:D.name,gender:D.gender,sect:P.name,tier:D.tierTitle,fatherName:D.fatherName,generation:D.generation,affection:100,relationship:{affection:100,stage:0}},c,{year:Math.floor(c.age),month:c.time.month},!0,{apiKey:localStorage.getItem("game_api_key")||"",apiUrl:localStorage.getItem("game_api_url")||"https://api.deepseek.com/chat/completions",apiModel:localStorage.getItem("game_api_model")||"deepseek-chat",useAIForLetter:localStorage.getItem("useAIForLetter")!=="false"},{children:ne,exiledChildren:c.exiledChildren||[],replyHistory:_t.getRecentRepliesForNpc(D.id,3)}).then(xe=>{_t.addMessage(xe),Ls(_t.getAllMessages())}).catch(xe=>{console.error(":",xe)}),Yt(c.newsBuffer||[],"JOIN_SECT",{actor:c.name,target:D.name,detail:P.name});const Z=kC(oe,P.name);return Z&&ze(Z,"cultivation"),St(oe)}),yi(D=>D.filter(oe=>oe.child.id!==f));const N=((q=ne.find(D=>D.id===f))==null?void 0:q.name)||"";ze(` ${N} ${P.name}`,"")};b.useEffect(()=>{let f;if(ln){const M=()=>{Cd(!0),f=setTimeout(M,1e3/Ts)};f=setTimeout(M,1e3/Ts)}return()=>clearTimeout(f)},[ln,Ts,Cd]),b.useEffect(()=>{if(Va){Ja.length>0&&Ed([]);return}if(Ja.length>0&&!t.type){const f=Ja[0];i({type:"JEALOUSY",data:f}),Ed(M=>M.slice(1))}},[Ja,t.type,Va]),b.useEffect(()=>{if(gi){yo.length>0&&ki([]);return}if(yo.length!==0){if(t.type==="RESULT"&&e0!==!1){i({type:null,data:null});return}if(!t.type){const f=yo[0];i({type:"SHURA_FIELD",data:f}),ki(M=>M.slice(1))}}},[yo,t.type,e0,gi]),b.useEffect(()=>{var M,j,P,A;if(!ae)return;const f=je.find(B=>B.id===ae.id);f&&(f.name!==ae.name||f.cultivation!==ae.cultivation||((M=f.stats)==null?void 0:M.aptitude)!==((j=ae.stats)==null?void 0:j.aptitude)||((P=f.influenceProfile)==null?void 0:P.tierId)!==((A=ae.influenceProfile)==null?void 0:A.tierId)||f.isFavorite!==ae.isFavorite)&&Ae(f)},[uo,je,ae,Ae]);const wb=f=>{const M=ne.find(P=>P.id===f);if(!M)return;if(Math.floor(M.age*12)<216){te("","18",!1,null,!1);return}if(c.resources.spiritStones<500){te("",` 500 : ${c.resources.spiritStones}`,!1);return}const j=Mg(M.tierTitle||"",M.gender);vd(j),Sd(M),bd(!0)},Eb=f=>{if(!Ka)return;ve(j=>j.id===Ka.id,j=>{const P=I.find(A=>A.name===j.fatherName||A.name===j.motherName);if(P){ss.onChildMarriage(P,j,f.name);const A=Eg(P,c,Math.floor(c.age),c.time.month,f.name);J(P.id,A)}return{...j,spouse:f}}),E({spiritStones:500}),ze(` 500 ${Ka.name}  ${f.name} `),bd(!1),vd([]),Sd(null)},kb=(f,M,j)=>{var P,A;if(M==="CHAT"){const B=ne.find(D=>D.id===f);if(!B)return;if((c.energy||0)<=0){te("","",!1);return}S(1);const N={...B,isChild:!0,relationship:{affection:100}},W=xu(N,c);if(W){te((W==null?void 0:W.title)||"",(W==null?void 0:W.text)||"",!0,null);return}const q=[`${B.name}`,`${B.name}`,`${B.name}${B.gender===""?"":""}`,`${B.name}"${c.gender===""?"":""}"`,`${B.name}`];te("",q[Math.floor(Math.random()*q.length)],!0,null);return}if(M==="MARRY"){wb(f);return}if(M==="RENAME"&&(_e(f,{name:j}),Ae(B=>B&&B.id===f?{...B,name:j}:B),te("","",!0)),M==="FEED_PILL"){if(c.resources.spiritStones<100){te("",` 100 : ${c.resources.spiritStones}`,!1);return}const N=ne.find(oe=>oe.id===f);if(!N)return;const W=500*(1+(((P=N.stats)==null?void 0:P.aptitude)||0)/100),q=cn(N,W);E({spiritStones:100}),ve(oe=>oe.id===f,oe=>{var Z;const ie=500*(1+(((Z=oe.stats)==null?void 0:Z.aptitude)||0)/100),re=cn(oe,ie);return St(re.updated)}),Ae(oe=>{var ie;if(oe&&oe.id===f){const re=500*(1+(((ie=oe.stats)==null?void 0:ie.aptitude)||0)/100),Z=cn(oe,re);return St(Z.updated)}return oe});const D=q.tierChanged?`

 ${N.name} ${q.newTier} ${q.lifespanIncrease} `:"";te("",`${D}`,!0)}if(M==="EDUCATE"){if(c.resources.spiritStones<50){te("",` 50 : ${c.resources.spiritStones}`,!1);return}E({spiritStones:50});const N=ne.find(D=>D.id===f),W=N?cn(N,Math.floor((((A=N.stats)==null?void 0:A.aptitude)||50)*5)):null;ve(D=>D.id===f,D=>{var re;const oe=Math.floor((((re=D.stats)==null?void 0:re.aptitude)||50)*5),ie=cn(D,oe);return St(ie.updated)}),Ae(D=>{var oe;if(D&&D.id===f){const ie=Math.floor((((oe=D.stats)==null?void 0:oe.aptitude)||50)*5),re=cn(D,ie);return St(re.updated)}return D});const q=W!=null&&W.tierChanged?`

 ${(N==null?void 0:N.name)||""} ${W.newTier} ${W.lifespanIncrease} `:"";te("",`${(ae==null?void 0:ae.name)||""} ${q}

 `,!0)}if(M==="OPEN_INVENTORY"&&e.openInventory((j==null?void 0:j.mode)||"VIEW",(j==null?void 0:j.slot)||null,f),M==="UNEQUIP"){const B=j==null?void 0:j.slot;if(!B)return;const N=ne.find(D=>D.id===f);if(!N)return;const W=Ir(N),q=W.equipment[B];if(!q)return;a.setInventory(D=>[q,...D]),ve(D=>D.id===f,D=>{const oe={...W,equipment:{...W.equipment,[B]:null}};return St(oe)}),Ae(D=>{if(D&&D.id===f){const oe={...W,equipment:{...W.equipment,[B]:null}};return St(oe)}return D})}if(M==="CHANGE_MANUAL"){if(!ne.find(W=>W.id===f))return;if(l.filter(W=>W.type==="manual").length===0){te("","",!1);return}e.openInventory("MANUAL_SELECT",null,f)}if(M==="SELECT_SECT"){const B=ne.find(q=>q.id===f);if(!B)return;if(Math.floor(B.age*12)<144){te("","12",!1);return}if(!B.isTested){te("","",!1);return}const{recommended:N,others:W}=Rp(B);if(!N.length&&!W.length){te("","",!1);return}yi([{type:"JOIN_SECT",title:"",message:`${B.name} `,child:B,selectableSects:N,otherSectOptions:W,showModal:!0}]),ln&&rr(!1)}if(M==="TOGGLE_AUTO_JOIN_SECT"){const B=!!j;_e(f,{autoJoinBestSect:B}),Ae(N=>N&&N.id===f?{...N,autoJoinBestSect:B}:N),te("",B?"":"",!0);return}if(M==="EXPEL"){const B=ne.find(N=>N.id===f);if(!B)return;z(f),v({exiledChildren:[...c.exiledChildren||[],B]}),Ae(null),ze(` ${B.name} `),te("",`${B.name} `,!0);return}},Td=f=>{const{recommended:M,others:j}=Rp(f),P=[...M,...j],A=P.filter(B=>{var N;return(N=B.admission)==null?void 0:N.qualified});return A.length?A[0].sect:P.length?P[0].sect:null},jb=f=>{if(V(!!f),!f){te("","",!0);return}let M=0;ye(j=>{if(!(Math.floor(j.age*12)>=144)||!j.isTested||j.sect)return j;const A=Td(j);return A?(M++,{...j,sect:A,rank:ia(j,A)}):j}),te("",` ${M} `,!0)},Cb=()=>{var N;const M=((N=c==null?void 0:c.resources)==null?void 0:N.spiritStones)||0,j=ne.filter(W=>!W.spouse&&Math.floor((W.age||0)*12)>=216).sort((W,q)=>{var D,oe;return(((D=q.stats)==null?void 0:D.aptitude)||0)-(((oe=W.stats)==null?void 0:oe.aptitude)||0)});if(!j.length){te("","18",!1);return}const P=Math.min(j.length,Math.floor(M/500));if(P<=0){te(""," 500 ",!1);return}const B=j.slice(0,P).map(W=>{const D=(Mg(W.tierTitle||"",W.gender)||[]).reduce((oe,ie)=>{var xe,U,me,ge;if(!oe)return ie;const re=((xe=ie.stats)==null?void 0:xe.aptitude)||0,Z=((U=oe.stats)==null?void 0:U.aptitude)||0;return re===Z?(((me=ie.stats)==null?void 0:me.intelligence)||0)>(((ge=oe.stats)==null?void 0:ge.intelligence)||0)?ie:oe:re>Z?ie:oe},null)||Mk(W.tierTitle||"",W.gender);return{childId:W.id,childName:W.name,spouse:D,childRef:W}});if(!B.length){te("","",!1);return}Si(B),e.openBatchMarriageModal()},Tb=f=>{var W;if(!f||f.length===0){e.closeBatchMarriageModal(),Si([]);return}const M=new Map(f.map(q=>[q.childId,q]));ye(q=>{const D=M.get(q.id);return D?{...q,spouse:D.spouse}:q}),Ae(q=>q&&M.has(q.id)?{...q,spouse:M.get(q.id).spouse}:q);const j=Math.floor((c==null?void 0:c.age)||0),P=((W=c==null?void 0:c.time)==null?void 0:W.month)??1,A=new Map;f.forEach(q=>{var ie,re;const D=q.childRef,oe=I.find(Z=>Z.name===D.fatherName||Z.name===D.motherName);if(oe&&!A.has(oe.id)){ss.onChildMarriage(oe,D,(ie=q.spouse)==null?void 0:ie.name);const Z=Eg(oe,c,j,P,(re=q.spouse)==null?void 0:re.name);A.set(oe.id,Z)}}),A.size&&Qe(A);const B=f.length*500;E({spiritStones:B});const N=f.map(q=>{var D,oe,ie;return` ${q.childName}  ${((D=q.spouse)==null?void 0:D.name)||""}${((ie=(oe=q.spouse)==null?void 0:oe.stats)==null?void 0:ie.aptitude)??"?"}`}).join(`
`);ze(`  ${f.length} 
${N}`),te("",` ${B}  ${f.length} 
${N}`,!0),e.closeBatchMarriageModal(),Si([])},Ib=f=>{Wn(!!f),te(f?"":"",f?"":"",!0)},_b=f=>{xo(!!f),te(f?"":"",f?"":"",!0)},Rb=f=>{Ua(!!f),v({childrenStrategy:{...c.childrenStrategy,skipZhaozhou:!!f}}),te(f?"":"",f?"":"",!0)},Mb=f=>{T1(!!f),f&&ki([]),te(f?"":"",f?"":"",!0)},Ab=f=>{I1(!!f),te(f?"":"",f?"":"",!0)},Nb=f=>{_1(!!f),te(f?"":"",f?"":"",!0)},d0=(f,M,j)=>{const P=l.find(D=>D.instanceId===j);if(!P)return te("","",!1);if(P.slot!==M)return te("","",!1);const B=(Number(P.quantity??1)||1)>1?{...P,quantity:1,instanceId:`${P.id||"item"}_${Date.now()}_${Math.floor(Math.random()*1e4)}`}:{...P,quantity:1},N=ne.find(D=>D.id===f);if(!N)return;const W=Ir(N),q=W.equipment[M];ve(D=>D.id===f,D=>{const oe={...W,equipment:{...W.equipment,[M]:B}};return St(oe)}),Ae(D=>{if(D&&D.id===f){const oe={...W,equipment:{...W.equipment,[M]:B}};return St(oe)}return D}),a.setInventory(D=>{const oe=[];return D.forEach(ie=>{if(ie.instanceId!==j){oe.push(ie);return}const re=Number(ie.quantity??1)||1;re>1&&oe.push({...ie,quantity:re-1})}),q?[q,...oe]:oe}),e.closeInventory(),te("",`${N.name}  ${P.name}`,!0)},Id=(f,M)=>{var oe;const j=l.find(ie=>ie.instanceId===M);if(!j)return te("","",!1);const P=!f,A=P?null:ne.find(ie=>ie.id===f);if(!P&&!A)return te("","",!1);const B=P?yt.PLAYER:yt.CHILD;if(!zs(j,B)){te("",`${j.name||""}  ${Co(j)} `,!1);return}if(j.type==="manual"){const ie=j.manualIds||[];if(ie.length===0)return te("","",!1);const re=ie[Math.floor(Math.random()*ie.length)],Z=vn[re];if(!Z)return te("","",!1);if(P){m(U=>{const me={...U,cultivationMethod:re};return St(me)}),e.closeInventory(),te("",` ${Z.name||re}`,!0);return}const xe=Qg(A,re);if(!xe.success)return te("",xe.message,!1);ve(U=>U.id===f,U=>{const me={...U,cultivationMethod:re};return St(me)}),Ae(U=>{if(U&&U.id===f){const me={...U,cultivationMethod:re};return St(me)}return U}),e.closeInventory(),ze(xe.message),te("",xe.message+"",!0,{:((oe=xe.compatibility)==null?void 0:oe.desc)||""});return}if(["weapon","armor","accessory"].includes(j.type)){if(P){const re=(Number(j.quantity??1)||1)>1?{...j,quantity:1,instanceId:`${j.id||"item"}_${Date.now()}_${Math.floor(Math.random()*1e4)}`}:{...j,quantity:1};m(Z=>{const xe=Ir(Z),U={...xe,equipment:{...xe.equipment,[j.slot]:re}};return St(U)}),a.setInventory(Z=>{const xe=[];return Z.forEach(U=>{if(U.instanceId!==M){xe.push(U);return}const me=Number(U.quantity??1)||1;me>1&&xe.push({...U,quantity:me-1})}),xe}),e.closeInventory(),te("",` ${j.name}`,!0);return}d0(f,j.slot,M);return}if(j.type!=="consumable")return te("","",!1);const N=j.effect||{};if(P){m(re=>{var xe,U,me,ge;let Z={...re};if(N.kind==="exp")Z.currentExp=(Z.currentExp||0)+(N.amount||0);else if(N.kind==="aptitude"){const Ne=Math.min(100,(((xe=Z.stats)==null?void 0:xe.aptitude)||50)+(N.amount||0));Z={...Z,stats:{...Z.stats,aptitude:Ne}};try{const Xe=ir(Ne,Z.spiritRoot,null,{constitution:Z.constitution});Z={...Z,spiritRoot:Xe}}catch{}}else if(N.kind==="intelligence"){const Ne=Math.min(100,(((U=Z.stats)==null?void 0:U.intelligence)||50)+(N.amount||0));Z={...Z,stats:{...Z.stats,intelligence:Ne}}}else if(N.kind==="looks"){const Ne=Math.min(100,(((me=Z.stats)==null?void 0:me.looks)||50)+(N.amount||0));Z={...Z,stats:{...Z.stats,looks:Ne}}}else if(N.kind==="lifespan"){const Ne=Z.lifespan||Z.maxLifespan||100;Z.lifespan=Ne+(N.amount||0),Z.maxLifespan&&(Z.maxLifespan=Math.max(Z.maxLifespan,Z.lifespan))}else if(N.kind==="heal"){const Ne=((ge=Z.stats)==null?void 0:ge.health)||100,Xe=Math.min(100,Ne+(N.amount||0));Z={...Z,stats:{...Z.stats,health:Xe}};const ct=Ht(Ne),Rt=Ht(Xe),dt=Rt-ct;dt>0&&(Z.energy=Math.min(Rt,(Z.energy||0)+dt))}return St(Z)}),u(M,j.stackable?1:void 0),e.closeInventory();let ie=`  ${j.name}`;N.kind==="exp"&&(ie+=` +${N.amount}`),N.kind==="aptitude"&&(ie+=` +${N.amount}`),N.kind==="intelligence"&&(ie+=` +${N.amount}`),N.kind==="looks"&&(ie+=` +${N.amount}`),N.kind==="lifespan"&&(ie+=` +${N.amount} `),N.kind==="heal"&&(ie+=""),te("",ie,!0);return}const W=N.kind==="exp"?N.amount||0:N.kind==="heal"?Math.floor((N.amount||0)*2):0,q=W>0?cn(A,W):null;ve(ie=>ie.id===f,ie=>{var Z,xe,U;let re={...ie};if(N.kind==="exp"||N.kind==="heal")re=cn(re,W).updated;else if(N.kind==="aptitude"){const me=Math.min(100,(((Z=re.stats)==null?void 0:Z.aptitude)||50)+(N.amount||0));if(re={...re,stats:{...re.stats,aptitude:me}},re.isTested||re.spiritRoot&&Array.isArray(re.spiritRoot.elements))try{const ge=ir(me,re.spiritRoot,null,{constitution:re.constitution});re={...re,spiritRoot:ge}}catch{}}else if(N.kind==="intelligence"){const me=Math.min(100,(((xe=re.stats)==null?void 0:xe.intelligence)||50)+(N.amount||0));re={...re,stats:{...re.stats,intelligence:me}}}else if(N.kind==="looks"){const me=Math.min(100,(((U=re.stats)==null?void 0:U.looks)||50)+(N.amount||0));re={...re,stats:{...re.stats,looks:me}}}else if(N.kind==="lifespan"){const me=re.lifespan||re.maxLifespan||100;re.lifespan=me+(N.amount||0),re.maxLifespan&&(re.maxLifespan=Math.max(re.maxLifespan,re.lifespan))}return St(re)}),Ae(ie=>{var re,Z,xe;if(ie&&ie.id===f){let U={...ie};if(N.kind==="exp"||N.kind==="heal")U=cn(U,W).updated;else if(N.kind==="aptitude"){const me=Math.min(100,(((re=U.stats)==null?void 0:re.aptitude)||50)+(N.amount||0));if(U={...U,stats:{...U.stats,aptitude:me}},U.isTested||U.spiritRoot&&Array.isArray(U.spiritRoot.elements))try{const ge=ir(me,U.spiritRoot,null,{constitution:U.constitution});U={...U,spiritRoot:ge}}catch{}}else if(N.kind==="intelligence"){const me=Math.min(100,(((Z=U.stats)==null?void 0:Z.intelligence)||50)+(N.amount||0));U={...U,stats:{...U.stats,intelligence:me}}}else if(N.kind==="looks"){const me=Math.min(100,(((xe=U.stats)==null?void 0:xe.looks)||50)+(N.amount||0));U={...U,stats:{...U.stats,looks:me}}}else if(N.kind==="lifespan"){const me=U.lifespan||U.maxLifespan||100;U.lifespan=me+(N.amount||0),U.maxLifespan&&(U.maxLifespan=Math.max(U.maxLifespan,U.lifespan))}return St(U)}return ie}),u(M,j.stackable?1:void 0),e.closeInventory();let D=`${A.name}  ${j.name}`;N.kind==="exp"&&(D+=`+${N.amount}`),N.kind==="aptitude"&&(D+=`+${N.amount}`),N.kind==="intelligence"&&(D+=`+${N.amount}`),N.kind==="looks"&&(D+=`+${N.amount}`),N.kind==="lifespan"&&(D+=`+${N.amount}`),N.kind==="heal"&&(D+=""),q!=null&&q.tierChanged&&(D+=`

 ${A.name} ${q.newTier} ${q.lifespanIncrease} `),te("",D,!0)},Lb=(f,M)=>{if(!M||M.length===0){te("","",!1);return}const j=!f,P=j?c:ne.find(re=>re.id===f);if(!j&&!P){te("","",!1);return}let A=0,B=0,N=0,W=0,q=[];M.forEach(re=>{const Z=l.find(Xe=>Xe.instanceId===re.instanceId);if(!Z||!Z.effect)return;const xe=Math.min(re.quantity||1,Z.quantity||1);if(xe<=0)return;const U=j?yt.PLAYER:yt.CHILD;if(!zs(Z,U))return;const me=Z.effect,Ne=(me.amount||0)*xe;me.kind==="exp"?A+=Ne:me.kind==="aptitude"?B+=Ne:me.kind==="intelligence"?N+=Ne:me.kind==="heal"&&(W+=Ne),q.push({name:Z.name,quantity:xe,effect:me.kind}),u(Z.instanceId,xe)});const D=j?0:A+Math.floor(W*2),oe=!j&&D>0?cn(P,D):null;j?m(re=>{var xe,U,me;let Z={...re};if(A>0&&(Z.currentExp=(Z.currentExp||0)+A),B>0){const ge=Math.min(100,(((xe=Z.stats)==null?void 0:xe.aptitude)||50)+B);Z={...Z,stats:{...Z.stats,aptitude:ge}};try{const Ne=ir(ge,Z.spiritRoot,null,{constitution:Z.constitution});Z={...Z,spiritRoot:Ne}}catch{}}if(N>0){const ge=Math.min(100,(((U=Z.stats)==null?void 0:U.intelligence)||50)+N);Z={...Z,stats:{...Z.stats,intelligence:ge}}}if(W>0){const ge=((me=Z.stats)==null?void 0:me.health)||100,Ne=Math.min(100,ge+W);Z={...Z,stats:{...Z.stats,health:Ne}};const Xe=Ht(ge),ct=Ht(Ne),Rt=ct-Xe;Rt>0&&(Z.energy=Math.min(ct,(Z.energy||0)+Rt))}return St(Z)}):(ve(re=>re.id===f,re=>{var xe,U;let Z={...re};if(D>0&&(Z=cn(Z,D).updated),B>0){const me=Math.min(100,(((xe=Z.stats)==null?void 0:xe.aptitude)||50)+B);if(Z={...Z,stats:{...Z.stats,aptitude:me}},Z.isTested||Z.spiritRoot&&Array.isArray(Z.spiritRoot.elements))try{const ge=ir(me,Z.spiritRoot,null,{constitution:Z.constitution});Z={...Z,spiritRoot:ge}}catch{}}if(N>0){const me=Math.min(100,(((U=Z.stats)==null?void 0:U.intelligence)||50)+N);Z={...Z,stats:{...Z.stats,intelligence:me}}}return St(Z)}),Ae(re=>{var Z,xe;if(re&&re.id===f){let U={...re};if(D>0&&(U=cn(U,D).updated),B>0){const me=Math.min(100,(((Z=U.stats)==null?void 0:Z.aptitude)||50)+B);if(U={...U,stats:{...U.stats,aptitude:me}},U.isTested||U.spiritRoot&&Array.isArray(U.spiritRoot.elements))try{const ge=ir(me,U.spiritRoot,null,{constitution:U.constitution});U={...U,spiritRoot:ge}}catch{}}if(N>0){const me=Math.min(100,(((xe=U.stats)==null?void 0:xe.intelligence)||50)+N);U={...U,stats:{...U.stats,intelligence:me}}}return St(U)}return re}));let ie=`${j?"":P.name}  ${q.length} 
`;q.forEach(re=>{ie+=`
 ${re.name} x${re.quantity}`}),A>0&&(ie+=`

+${A}`),B>0&&(ie+=`
+${B}`),N>0&&(ie+=`
+${N}`),W>0&&(ie+=`
+${W}`),oe!=null&&oe.tierChanged&&(ie+=`

 ${P.name} ${oe.newTier} ${oe.lifespanIncrease} `),te("",ie,!0),e.closeInventory()},el=b.useCallback(()=>{kd({open:!1,item:null,items:null,isBatch:!1})},[]),$b=b.useCallback(()=>{bd(!1),vd([]),Sd(null)},[]),Bb=b.useCallback(f=>{f.forEach(M=>{const j=or(M.giftItemId);j&&(d([j]),ze(`${M.message}${j.name}`))}),e.closeBatchGiftModal(),bi([]),te("",` ${f.length} `,!0)},[or,d,ze,e,bi,te]),Ob=b.useCallback(()=>{e.closeBatchGiftModal(),bi([])},[e,bi]),Pb=b.useCallback(f=>{f.forEach(M=>{const j=M.giftItemId?or(M.giftItemId):null;j&&d([j])}),e.closeBatchPromotionModal(),vi([]),te("",` ${f.length} `,!0)},[or,d,e,vi,te]),zb=b.useCallback(()=>{e.closeBatchPromotionModal(),vi([])},[e,vi]),Db=b.useCallback(()=>{e.closeBatchMarriageModal(),Si([])},[e,Si]),Fb=b.useCallback(f=>{if(Bs.isBatch&&Bs.items){let M=0,j=0,P=0,A=0,B=0,N=[],q={...Ir(f).equipment||{}},D=!1,oe=[],ie=[];Bs.items.forEach(xe=>{const U=typeof xe=="object"?xe.instanceId:xe,me=typeof xe=="object"&&xe.quantity?xe.quantity:1,ge=l.find(Xe=>Xe.instanceId===U);if(!ge){j++;return}if(["weapon","armor","accessory"].includes(ge.type)){const Xe=ge.slot||ge.type,Rt=(Number(ge.quantity??1)||1)>1?{...ge,quantity:1,instanceId:`${ge.id||"item"}_${Date.now()}_${Math.floor(Math.random()*1e4)}`}:{...ge,quantity:1},dt=q[Xe];q={...q,[Xe]:Rt},D=!0,oe.push(Rt.name||""),dt&&dt.instanceId!==ge.instanceId&&ie.push(dt),u(U,1),M++,j++;return}for(let Xe=0;Xe<me;Xe++){const ct=ge.effect||{};if(ct.kind==="exp"||ct.kind==="heal"){const Rt=ct.kind==="exp"?ct.amount||0:Math.floor((ct.amount||0)*2);P+=Rt;const dt=cn(f,Rt);dt!=null&&dt.tierChanged&&N.push({newTier:dt.newTier,lifespanIncrease:dt.lifespanIncrease})}else ct.kind==="aptitude"?A+=ct.amount||0:ct.kind==="intelligence"&&(B+=ct.amount||0);u(U,ge.stackable?1:void 0),M++}j++}),ie.length>0&&d(ie),ve(xe=>xe.id===f.id,xe=>{var me,ge;let U={...xe};if(D&&(U={...Ir(U),equipment:{...q}}),P>0&&(U=cn(U,P).updated),A>0){const Ne=Math.min(100,(((me=U.stats)==null?void 0:me.aptitude)||50)+A);if(U={...U,stats:{...U.stats,aptitude:Ne}},U.isTested||U.spiritRoot&&Array.isArray(U.spiritRoot.elements))try{const Xe=ir(Ne,U.spiritRoot,null,{constitution:U.constitution});U={...U,spiritRoot:Xe}}catch{}}if(B>0){const Ne=Math.min(100,(((ge=U.stats)==null?void 0:ge.intelligence)||50)+B);U={...U,stats:{...U.stats,intelligence:Ne}}}return St(U)}),Ae(xe=>{var U,me;if(xe&&xe.id===f.id){let ge={...xe};if(D&&(ge={...Ir(ge),equipment:{...q}}),P>0&&(ge=cn(ge,P).updated),A>0){const Ne=Math.min(100,(((U=ge.stats)==null?void 0:U.aptitude)||50)+A);if(ge={...ge,stats:{...ge.stats,aptitude:Ne}},ge.isTested||ge.spiritRoot&&Array.isArray(ge.spiritRoot.elements))try{const Xe=ir(Ne,ge.spiritRoot,null,{constitution:ge.constitution});ge={...ge,spiritRoot:Xe}}catch{}}if(B>0){const Ne=Math.min(100,(((me=ge.stats)==null?void 0:me.intelligence)||50)+B);ge={...ge,stats:{...ge.stats,intelligence:Ne}}}return St(ge)}return xe});let re=` ${j}  ${M}  ${f.name}`,Z={};if(P>0&&(re+=`
 +${P}`,Z.=`+${P}`),A>0&&(re+=`
 +${A}`,Z.=`+${A}`),B>0&&(re+=`
 +${B}`,Z.=`+${B}`),oe.length>0&&(re+=`
${oe.join("")}`,Z.=oe.join("")),N.length>0){const xe=N[N.length-1];re+=`

 ${f.name} ${xe.newTier} ${xe.lifespanIncrease} `}te("",re,!0,Object.keys(Z).length>0?Z:null),el(),e.closeInventory()}else Bs.item&&(Id(f.id,Bs.item.instanceId),el(),e.closeInventory())},[Bs,Id,te,el,e,l,u,ve,Ae,cn,St,ir,Ir,d]),Hb=b.useCallback(f=>{const M=l.find(j=>j.instanceId===f);if(M){if(!zs(M,yt.CHILD)){te("",`${M.name||""}  ${Co(M)} `,!1);return}kd({open:!0,item:M})}},[l,zs,yt,te,Co]),Wb=b.useCallback(f=>{if(f.length===0)return;const M=f.map(P=>{const A=typeof P=="object"?P.instanceId:P,B=typeof P=="object"&&P.quantity?P.quantity:1,N=l.find(W=>W.instanceId===A);return N?{...N,giveQuantity:B}:null}).filter(Boolean);if(M.length===0)return;const j=M.filter(P=>!zs(P,yt.CHILD));if(j.length>0){const P=j.slice(0,3).map(B=>B.name).join(""),A=j.length>3?" ":"";te("",`${P}${A}  ${Co(j[0])} `,!1);return}kd({open:!0,items:M.map(P=>({instanceId:P.instanceId,quantity:P.giveQuantity||1})),isBatch:!0})},[l,zs,yt,te,Co]),Ub=b.useCallback(()=>{const f=$s[0];f&&_e(f.id,{isTested:!0}),yd(M=>M.slice(1))},[$s,_e]),Gb=()=>{if(l.filter(j=>j.type==="manual"&&(j.manualIds&&j.manualIds.length||j.manualId)).length===0){te("","",!1);return}if(!(an.length?an:ne).length){te("","",!1);return}e.openBatchManualModal()},Vb=f=>{if(!f||f.length===0){e.closeBatchManualModal();return}let M=0;const j=[];f.forEach(P=>{const A=ne.find(W=>W.id===P.childId);if(!A)return;const B={...A},N=Qg(B,P.manualId);if(N.success){const W=St({...B});j.push(W),M++,ze(N.message)}}),j.length>0&&(ye(P=>j.find(B=>B.id===P.id)||P),Ae(P=>P&&(j.find(B=>B.id===P.id)||P))),te("",` ${M} `,!0),e.closeBatchManualModal()},u0=()=>{const f=Ak(c);f.success?(m(M=>{var B,N;const j=((B=M.stats)==null?void 0:B.aptitude)||50,P=((N=M.spiritRoot)==null?void 0:N.type)||"",A=ni(f.newTier,j,P,M.equipment);return{...M,tier:f.newTier,currentExp:0,maxExp:f.newMaxExp,breakthroughBonus:0,breakthroughFailCount:0,combatStats:A}}),Yt(c.newsBuffer||[],"LEVEL_UP",{actor:c.name,detail:f.newTier}),te("",f.msg,!0,{:""},!1)):(m(M=>{const j=(M.breakthroughFailCount||0)+1,P=(M.breakthroughBonus||0)+5;return{...M,currentExp:Math.max(0,M.currentExp-f.penalty),breakthroughFailCount:j,breakthroughBonus:P}}),te("",f.msg,!1,{:-f.penalty},!1))},Yb=f=>{if((c.skillPoints||0)<=0){ze(" ");return}m(M=>{const j={...M,skillPoints:M.skillPoints-1};if(f==="aptitude"){const P=Math.min(100,(j.stats.aptitude||20)+1),A=mk(j,P);return ze(` 1 ${A.stats.aptitude}`),A}else f==="combatPower"?(j.combatStats={...j.combatStats,maxHp:j.combatStats.maxHp+50,hp:j.combatStats.maxHp+50,atk:j.combatStats.atk+5,def:(j.combatStats.def||0)+3},ze(" 1+50+5+3")):f==="breakthrough"&&(j.breakthroughBonus=(j.breakthroughBonus||0)+5,ze(` 15%: ${j.breakthroughBonus}%`));return j})};return r.jsxs("div",{style:Ym.appContainer,children:[Ge&&r.jsx(R5,{onComplete:()=>on(!1)}),pt&&r.jsx(_5,{onConfirm:()=>Ct(!1),onExit:()=>{window.location.href="about:blank"}}),r.jsx(Wk,{player:c,isAuto:ln,onBreakthrough:u0,auctionBanner:wd}),Qt==="PROLOGUE"?r.jsx(I5,{onFinish:mb,onLoadGame:c0}):r.jsxs("div",{style:Ym.mainContent,children:[r.jsx(gT,{player:c,onBreakthroughClick:u0}),nr==="FAMILY"&&r.jsx(hT,{player:c,visibleChildren:an,pregnantNpcs:I.filter(f=>{var M;return f.isPregnant&&!((M=f.relationship)!=null&&M.cutTies)}),fallenChildren:ce,exiledChildren:(c==null?void 0:c.exiledChildren)||[],generation3Plus:(c==null?void 0:c.generation3Plus)||[],onChildClick:f=>{f.isEmbryo?te("",`${f.npc.name} ...

 

: ${f.npc.pregnancyProgress||0}/9`,!0,null,!1):Ae(f)},onToggleFavorite:he,onMemorialClick:bb}),nr==="NPC"&&r.jsx(bT,{sortedNpcs:qr,pagedNpcs:id,deadNpcs:T,npcSort:po,npcPage:ui,npcPageCount:mo,hasNpcPagination:ad,showFollowedOnly:Is,isRomanceLimitReached:mr()>=ts,onExplore:pb,onSortChange:od,onToggleFollowedOnly:Pa,onPrevPage:()=>fo(f=>Math.max(0,f-1)),onNextPage:()=>fo(f=>Math.min(Math.max(0,mo-1),f+1)),onNpcInteract:f=>i0(f.id,"DETAIL"),onNpcAction:i0}),nr==="ACTION"&&r.jsx(vT,{player:c,children:an,showBizPanel:e.showBizPanel,showChallengePanel:e.showChallengePanel,idleManagerOptions:co,onDailyAction:ob,onShopping:ib,onOpenInventory:e.openInventory,onBuyBusiness:xb,onExploreRealm:yb,onOpenAuction:K1,onCloseBizPanel:e.closeBizPanel,onCloseChallengePanel:e.closeChallengePanel,onOpenBizPanel:e.openBizPanel,onOpenChallengePanel:e.openChallengePanel,isRomanceLimitReached:mr()>=ts}),nr==="REVENGE"&&r.jsx(dT,{children:r.jsx(uC,{player:c,setPlayer:m,addLog:ze})}),nr==="SYSTEM"&&r.jsx(EC,{player:c,onSave:gb,onLoad:c0,onReset:hb,onRedeemCode:W1,onOpenGuide:()=>e.openGuide(),autoAssignEnabled:As,onToggleAutoAssign:jb,autoSkipSpiritTest:Fe,onToggleAutoSkip:Ib,skipChildGiftPopups:Ut,onToggleSkipChildGiftPopups:_b,skipZhaozhou:Ns,onToggleSkipZhaozhou:Rb,skipShuraFieldEvents:gi,onToggleSkipShuraFieldEvents:Mb,skipRomanceGiftPopups:Ga,onToggleSkipRomanceGiftPopups:Ab,skipJealousyPopups:Va,onToggleSkipJealousyPopups:Nb,isPortraitViewport:lo,isOrientationFixApplied:tr,onRequestPortraitFix:U1,onReleasePortraitFix:G1,onAutoAssignSpouses:Cb,gameState:{player:c,children:ne,fallenChildren:ce,activeNpcs:I,deadNpcs:T,gameStage:Qt,logs:Cs,inventory:l,messages:((E0=_t==null?void 0:_t.toJSON)==null?void 0:E0.call(_t))||{},lastMessageCheck:hi,pendingSectChoices:xi,testQueue:$s,worldEvents:(c==null?void 0:c.worldEvents)||[],newsBuffer:(c==null?void 0:c.newsBuffer)||[]}}),nr==="LOG"&&r.jsx(Gj,{logs:Cs,ratingSummary:ji,onUpgradeRating:V1}),nr==="PLAYER"&&r.jsx(jC,{player:c,childFeedback:D1,onOpenInventory:()=>e.openInventory("VIEW"),onAllocateSkillPoint:Yb})]}),r.jsx(XC,{modalState:t,closeModal:F1,player:c,inventory:l,handleGiftConfirm:nb,handleNegotiateConfirm:rb,handleShopPurchase:ab,handleOptionSelect:a0,handleShuraFieldSelect:sb,handleBuyAuctionItem:Y1,handleShowAuctionPlot:q1,modalMgr:e,allChildren:ne,visibleChildren:an,handleEquipToChild:d0,handleUseConsumable:Id,handleBatchUseConsumables:Lb,handleDiscardFromInventory:tb,handleGiveToChild:Hb,handleBatchGiveToChildren:Wb,handleSell:eb,handleAutoAssignManualToChild:Gb,getMarketPrice:o0,testQueue:$s,handleTestFinish:vb,handleTestQueueClose:Ub,childSelectorModal:Bs,handleChildSelectorSelect:Fb,closeChildSelectorModal:el,selectedChild:ae,childNavigationMeta:ld,handleNavigateChild:cd,handleChildAction:kb,setSelectedChild:Ae,showSpouseSelection:M1,marryingChild:Ka,spouseCandidates:A1,handleSpouseSelect:Eb,resetSpouseSelection:$b,batchGiftEvents:N1,handleBatchGiftConfirm:Bb,handleBatchGiftClose:Ob,batchPromotionEvents:L1,handleBatchPromotionConfirm:Pb,handleBatchPromotionClose:zb,batchMarriagePlans:$1,handleBatchMarriageConfirm:Tb,handleBatchMarriageClose:Db,handleBatchManualAssign:Vb}),r.jsx(Gk,{activeTab:nr,onTabChange:nd}),r.jsx(xT,{isAuto:ln,autoSpeed:Ts,player:c,messageUnreadCount:_t.getUnreadCount(),onToggleAuto:()=>rr(!ln),onSetAutoSpeed:rd,onNextMonth:Cd,onOpenGazette:()=>{console.log(":",{currentGazette:Wa,gazetteHistory:c.gazetteHistory,hasUnreadGazette:c.hasUnreadGazette}),e.openGazette()},onOpenMessageCenter:()=>e.openMessageCenter(),onMarkGazetteRead:()=>v({hasUnreadGazette:!1})}),r.jsx(cT,{selectedNpc:L,setSelectedNpc:F,handleOptionSelect:a0,player:c,visibleChildren:an,visibleNpcs:$,activeNpcs:I,modalMgr:e,addLog:ze,showResult:te,cutTiesWithNpc:Y,handleToggleNpcLetterAcceptance:fb,messages:R1,messageManager:_t,setMessages:Ls,handleSendMessageReply:z1,combatData:fi,handleCombatClose:hd,isExploring:dd,exploreRealmState:go,exploreProgress:Rs,currentExploreEvent:pd,exploreLog:ud,inventory:l,setExploreLog:Ms,handleExplorationOption:md,handleStartCombat:gd,setExploreProgress:Kr,setCurrentExploreEvent:Da,setIsExploring:mi,getBossEvent:Ck,getRandomExplorationEvent:Rg,pendingSectChoices:xi,setPendingSectChoices:yi,handleAssignSect:Sb,handleCloseTutorial:B1,handleCompleteTutorial:O1,handleCloseGuide:P1,currentGazette:Wa,setSelectedWorldNpc:se,selectedWorldNpc:ee,handleInviteWorldNpc:db,handleChallengeWorldNpc:ub})]})}Ru.createRoot(document.getElementById("root")).render(r.jsx($c.StrictMode,{children:r.jsx(FT,{})}));
