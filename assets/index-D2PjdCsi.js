var zb=Object.defineProperty;var Db=(e,t,n)=>t in e?zb(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n;var I0=(e,t,n)=>Db(e,typeof t!="symbol"?t+"":t,n);import{g as Gl,a as _p,i as Fb,c as oh,b as Hb,d as Wb,e as ih,f as Ub,h as Gb}from"./saveSystem-D2VifvcS.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))s(o);new MutationObserver(o=>{for(const i of o)if(i.type==="childList")for(const a of i.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&s(a)}).observe(document,{childList:!0,subtree:!0});function n(o){const i={};return o.integrity&&(i.integrity=o.integrity),o.referrerPolicy&&(i.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?i.credentials="include":o.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function s(o){if(o.ep)return;o.ep=!0;const i=n(o);fetch(o.href,i)}})();function Vb(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var ah={exports:{}},Tc={},lh={exports:{}},tt={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Sa=Symbol.for("react.element"),Yb=Symbol.for("react.portal"),qb=Symbol.for("react.fragment"),Kb=Symbol.for("react.strict_mode"),Qb=Symbol.for("react.profiler"),Jb=Symbol.for("react.provider"),Xb=Symbol.for("react.context"),Zb=Symbol.for("react.forward_ref"),ev=Symbol.for("react.suspense"),tv=Symbol.for("react.memo"),nv=Symbol.for("react.lazy"),_0=Symbol.iterator;function rv(e){return e===null||typeof e!="object"?null:(e=_0&&e[_0]||e["@@iterator"],typeof e=="function"?e:null)}var ch={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},dh=Object.assign,uh={};function Ko(e,t,n){this.props=e,this.context=t,this.refs=uh,this.updater=n||ch}Ko.prototype.isReactComponent={};Ko.prototype.setState=function(e,t){if(typeof e!="object"&&typeof e!="function"&&e!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,e,t,"setState")};Ko.prototype.forceUpdate=function(e){this.updater.enqueueForceUpdate(this,e,"forceUpdate")};function ph(){}ph.prototype=Ko.prototype;function Rp(e,t,n){this.props=e,this.context=t,this.refs=uh,this.updater=n||ch}var Mp=Rp.prototype=new ph;Mp.constructor=Rp;dh(Mp,Ko.prototype);Mp.isPureReactComponent=!0;var R0=Array.isArray,fh=Object.prototype.hasOwnProperty,Ap={current:null},mh={key:!0,ref:!0,__self:!0,__source:!0};function gh(e,t,n){var s,o={},i=null,a=null;if(t!=null)for(s in t.ref!==void 0&&(a=t.ref),t.key!==void 0&&(i=""+t.key),t)fh.call(t,s)&&!mh.hasOwnProperty(s)&&(o[s]=t[s]);var l=arguments.length-2;if(l===1)o.children=n;else if(1<l){for(var d=Array(l),u=0;u<l;u++)d[u]=arguments[u+2];o.children=d}if(e&&e.defaultProps)for(s in l=e.defaultProps,l)o[s]===void 0&&(o[s]=l[s]);return{$$typeof:Sa,type:e,key:i,ref:a,props:o,_owner:Ap.current}}function sv(e,t){return{$$typeof:Sa,type:e.type,key:t,ref:e.ref,props:e.props,_owner:e._owner}}function Np(e){return typeof e=="object"&&e!==null&&e.$$typeof===Sa}function ov(e){var t={"=":"=0",":":"=2"};return"$"+e.replace(/[=:]/g,function(n){return t[n]})}var M0=/\/+/g;function _d(e,t){return typeof e=="object"&&e!==null&&e.key!=null?ov(""+e.key):t.toString(36)}function Cl(e,t,n,s,o){var i=typeof e;(i==="undefined"||i==="boolean")&&(e=null);var a=!1;if(e===null)a=!0;else switch(i){case"string":case"number":a=!0;break;case"object":switch(e.$$typeof){case Sa:case Yb:a=!0}}if(a)return a=e,o=o(a),e=s===""?"."+_d(a,0):s,R0(o)?(n="",e!=null&&(n=e.replace(M0,"$&/")+"/"),Cl(o,t,n,"",function(u){return u})):o!=null&&(Np(o)&&(o=sv(o,n+(!o.key||a&&a.key===o.key?"":(""+o.key).replace(M0,"$&/")+"/")+e)),t.push(o)),1;if(a=0,s=s===""?".":s+":",R0(e))for(var l=0;l<e.length;l++){i=e[l];var d=s+_d(i,l);a+=Cl(i,t,n,d,o)}else if(d=rv(e),typeof d=="function")for(e=d.call(e),l=0;!(i=e.next()).done;)i=i.value,d=s+_d(i,l++),a+=Cl(i,t,n,d,o);else if(i==="object")throw t=String(e),Error("Objects are not valid as a React child (found: "+(t==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":t)+"). If you meant to render a collection of children, use an array instead.");return a}function Qa(e,t,n){if(e==null)return e;var s=[],o=0;return Cl(e,s,"","",function(i){return t.call(n,i,o++)}),s}function iv(e){if(e._status===-1){var t=e._result;t=t(),t.then(function(n){(e._status===0||e._status===-1)&&(e._status=1,e._result=n)},function(n){(e._status===0||e._status===-1)&&(e._status=2,e._result=n)}),e._status===-1&&(e._status=0,e._result=t)}if(e._status===1)return e._result.default;throw e._result}var gn={current:null},Tl={transition:null},av={ReactCurrentDispatcher:gn,ReactCurrentBatchConfig:Tl,ReactCurrentOwner:Ap};function hh(){throw Error("act(...) is not supported in production builds of React.")}tt.Children={map:Qa,forEach:function(e,t,n){Qa(e,function(){t.apply(this,arguments)},n)},count:function(e){var t=0;return Qa(e,function(){t++}),t},toArray:function(e){return Qa(e,function(t){return t})||[]},only:function(e){if(!Np(e))throw Error("React.Children.only expected to receive a single React element child.");return e}};tt.Component=Ko;tt.Fragment=qb;tt.Profiler=Qb;tt.PureComponent=Rp;tt.StrictMode=Kb;tt.Suspense=ev;tt.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=av;tt.act=hh;tt.cloneElement=function(e,t,n){if(e==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+e+".");var s=dh({},e.props),o=e.key,i=e.ref,a=e._owner;if(t!=null){if(t.ref!==void 0&&(i=t.ref,a=Ap.current),t.key!==void 0&&(o=""+t.key),e.type&&e.type.defaultProps)var l=e.type.defaultProps;for(d in t)fh.call(t,d)&&!mh.hasOwnProperty(d)&&(s[d]=t[d]===void 0&&l!==void 0?l[d]:t[d])}var d=arguments.length-2;if(d===1)s.children=n;else if(1<d){l=Array(d);for(var u=0;u<d;u++)l[u]=arguments[u+2];s.children=l}return{$$typeof:Sa,type:e.type,key:o,ref:i,props:s,_owner:a}};tt.createContext=function(e){return e={$$typeof:Xb,_currentValue:e,_currentValue2:e,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},e.Provider={$$typeof:Jb,_context:e},e.Consumer=e};tt.createElement=gh;tt.createFactory=function(e){var t=gh.bind(null,e);return t.type=e,t};tt.createRef=function(){return{current:null}};tt.forwardRef=function(e){return{$$typeof:Zb,render:e}};tt.isValidElement=Np;tt.lazy=function(e){return{$$typeof:nv,_payload:{_status:-1,_result:e},_init:iv}};tt.memo=function(e,t){return{$$typeof:tv,type:e,compare:t===void 0?null:t}};tt.startTransition=function(e){var t=Tl.transition;Tl.transition={};try{e()}finally{Tl.transition=t}};tt.unstable_act=hh;tt.useCallback=function(e,t){return gn.current.useCallback(e,t)};tt.useContext=function(e){return gn.current.useContext(e)};tt.useDebugValue=function(){};tt.useDeferredValue=function(e){return gn.current.useDeferredValue(e)};tt.useEffect=function(e,t){return gn.current.useEffect(e,t)};tt.useId=function(){return gn.current.useId()};tt.useImperativeHandle=function(e,t,n){return gn.current.useImperativeHandle(e,t,n)};tt.useInsertionEffect=function(e,t){return gn.current.useInsertionEffect(e,t)};tt.useLayoutEffect=function(e,t){return gn.current.useLayoutEffect(e,t)};tt.useMemo=function(e,t){return gn.current.useMemo(e,t)};tt.useReducer=function(e,t,n){return gn.current.useReducer(e,t,n)};tt.useRef=function(e){return gn.current.useRef(e)};tt.useState=function(e){return gn.current.useState(e)};tt.useSyncExternalStore=function(e,t,n){return gn.current.useSyncExternalStore(e,t,n)};tt.useTransition=function(){return gn.current.useTransition()};tt.version="18.3.1";lh.exports=tt;var b=lh.exports;const Ic=Vb(b);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var lv=b,cv=Symbol.for("react.element"),dv=Symbol.for("react.fragment"),uv=Object.prototype.hasOwnProperty,pv=lv.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,fv={key:!0,ref:!0,__self:!0,__source:!0};function xh(e,t,n){var s,o={},i=null,a=null;n!==void 0&&(i=""+n),t.key!==void 0&&(i=""+t.key),t.ref!==void 0&&(a=t.ref);for(s in t)uv.call(t,s)&&!fv.hasOwnProperty(s)&&(o[s]=t[s]);if(e&&e.defaultProps)for(s in t=e.defaultProps,t)o[s]===void 0&&(o[s]=t[s]);return{$$typeof:cv,type:e,key:i,ref:a,props:o,_owner:pv.current}}Tc.Fragment=dv;Tc.jsx=xh;Tc.jsxs=xh;ah.exports=Tc;var r=ah.exports,Eu={},yh={exports:{}},On={},bh={exports:{}},vh={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(e){function t(X,ee){var ae=X.length;X.push(ee);e:for(;0<ae;){var Te=ae-1>>>1,Be=X[Te];if(0<o(Be,ee))X[Te]=ee,X[ae]=Be,ae=Te;else break e}}function n(X){return X.length===0?null:X[0]}function s(X){if(X.length===0)return null;var ee=X[0],ae=X.pop();if(ae!==ee){X[0]=ae;e:for(var Te=0,Be=X.length,ze=Be>>>1;Te<ze;){var W=2*(Te+1)-1,J=X[W],fe=W+1,re=X[fe];if(0>o(J,ae))fe<Be&&0>o(re,J)?(X[Te]=re,X[fe]=ae,Te=fe):(X[Te]=J,X[W]=ae,Te=W);else if(fe<Be&&0>o(re,ae))X[Te]=re,X[fe]=ae,Te=fe;else break e}}return ee}function o(X,ee){var ae=X.sortIndex-ee.sortIndex;return ae!==0?ae:X.id-ee.id}if(typeof performance=="object"&&typeof performance.now=="function"){var i=performance;e.unstable_now=function(){return i.now()}}else{var a=Date,l=a.now();e.unstable_now=function(){return a.now()-l}}var d=[],u=[],p=1,c=null,m=3,y=!1,S=!1,E=!1,w=typeof setTimeout=="function"?setTimeout:null,g=typeof clearTimeout=="function"?clearTimeout:null,h=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function v(X){for(var ee=n(u);ee!==null;){if(ee.callback===null)s(u);else if(ee.startTime<=X)s(u),ee.sortIndex=ee.expirationTime,t(d,ee);else break;ee=n(u)}}function x(X){if(E=!1,v(X),!S)if(n(d)!==null)S=!0,Y(I);else{var ee=n(u);ee!==null&&ne(x,ee.startTime-X)}}function I(X,ee){S=!1,E&&(E=!1,g(C),C=-1),y=!0;var ae=m;try{for(v(ee),c=n(d);c!==null&&(!(c.expirationTime>ee)||X&&!A());){var Te=c.callback;if(typeof Te=="function"){c.callback=null,m=c.priorityLevel;var Be=Te(c.expirationTime<=ee);ee=e.unstable_now(),typeof Be=="function"?c.callback=Be:c===n(d)&&s(d),v(ee)}else s(d);c=n(d)}if(c!==null)var ze=!0;else{var W=n(u);W!==null&&ne(x,W.startTime-ee),ze=!1}return ze}finally{c=null,m=ae,y=!1}}var _=!1,N=null,C=-1,j=5,T=-1;function A(){return!(e.unstable_now()-T<j)}function V(){if(N!==null){var X=e.unstable_now();T=X;var ee=!0;try{ee=N(!0,X)}finally{ee?F():(_=!1,N=null)}}else _=!1}var F;if(typeof h=="function")F=function(){h(V)};else if(typeof MessageChannel<"u"){var B=new MessageChannel,$=B.port2;B.port1.onmessage=V,F=function(){$.postMessage(null)}}else F=function(){w(V,0)};function Y(X){N=X,_||(_=!0,F())}function ne(X,ee){C=w(function(){X(e.unstable_now())},ee)}e.unstable_IdlePriority=5,e.unstable_ImmediatePriority=1,e.unstable_LowPriority=4,e.unstable_NormalPriority=3,e.unstable_Profiling=null,e.unstable_UserBlockingPriority=2,e.unstable_cancelCallback=function(X){X.callback=null},e.unstable_continueExecution=function(){S||y||(S=!0,Y(I))},e.unstable_forceFrameRate=function(X){0>X||125<X?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):j=0<X?Math.floor(1e3/X):5},e.unstable_getCurrentPriorityLevel=function(){return m},e.unstable_getFirstCallbackNode=function(){return n(d)},e.unstable_next=function(X){switch(m){case 1:case 2:case 3:var ee=3;break;default:ee=m}var ae=m;m=ee;try{return X()}finally{m=ae}},e.unstable_pauseExecution=function(){},e.unstable_requestPaint=function(){},e.unstable_runWithPriority=function(X,ee){switch(X){case 1:case 2:case 3:case 4:case 5:break;default:X=3}var ae=m;m=X;try{return ee()}finally{m=ae}},e.unstable_scheduleCallback=function(X,ee,ae){var Te=e.unstable_now();switch(typeof ae=="object"&&ae!==null?(ae=ae.delay,ae=typeof ae=="number"&&0<ae?Te+ae:Te):ae=Te,X){case 1:var Be=-1;break;case 2:Be=250;break;case 5:Be=1073741823;break;case 4:Be=1e4;break;default:Be=5e3}return Be=ae+Be,X={id:p++,callback:ee,priorityLevel:X,startTime:ae,expirationTime:Be,sortIndex:-1},ae>Te?(X.sortIndex=ae,t(u,X),n(d)===null&&X===n(u)&&(E?(g(C),C=-1):E=!0,ne(x,ae-Te))):(X.sortIndex=Be,t(d,X),S||y||(S=!0,Y(I))),X},e.unstable_shouldYield=A,e.unstable_wrapCallback=function(X){var ee=m;return function(){var ae=m;m=ee;try{return X.apply(this,arguments)}finally{m=ae}}}})(vh);bh.exports=vh;var mv=bh.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var gv=b,Bn=mv;function me(e){for(var t="https://reactjs.org/docs/error-decoder.html?invariant="+e,n=1;n<arguments.length;n++)t+="&args[]="+encodeURIComponent(arguments[n]);return"Minified React error #"+e+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var Sh=new Set,ta={};function qs(e,t){zo(e,t),zo(e+"Capture",t)}function zo(e,t){for(ta[e]=t,e=0;e<t.length;e++)Sh.add(t[e])}var Wr=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),ju=Object.prototype.hasOwnProperty,hv=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,A0={},N0={};function xv(e){return ju.call(N0,e)?!0:ju.call(A0,e)?!1:hv.test(e)?N0[e]=!0:(A0[e]=!0,!1)}function yv(e,t,n,s){if(n!==null&&n.type===0)return!1;switch(typeof t){case"function":case"symbol":return!0;case"boolean":return s?!1:n!==null?!n.acceptsBooleans:(e=e.toLowerCase().slice(0,5),e!=="data-"&&e!=="aria-");default:return!1}}function bv(e,t,n,s){if(t===null||typeof t>"u"||yv(e,t,n,s))return!0;if(s)return!1;if(n!==null)switch(n.type){case 3:return!t;case 4:return t===!1;case 5:return isNaN(t);case 6:return isNaN(t)||1>t}return!1}function hn(e,t,n,s,o,i,a){this.acceptsBooleans=t===2||t===3||t===4,this.attributeName=s,this.attributeNamespace=o,this.mustUseProperty=n,this.propertyName=e,this.type=t,this.sanitizeURL=i,this.removeEmptyString=a}var Xt={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(e){Xt[e]=new hn(e,0,!1,e,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(e){var t=e[0];Xt[t]=new hn(t,1,!1,e[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(e){Xt[e]=new hn(e,2,!1,e.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(e){Xt[e]=new hn(e,2,!1,e,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(e){Xt[e]=new hn(e,3,!1,e.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(e){Xt[e]=new hn(e,3,!0,e,null,!1,!1)});["capture","download"].forEach(function(e){Xt[e]=new hn(e,4,!1,e,null,!1,!1)});["cols","rows","size","span"].forEach(function(e){Xt[e]=new hn(e,6,!1,e,null,!1,!1)});["rowSpan","start"].forEach(function(e){Xt[e]=new hn(e,5,!1,e.toLowerCase(),null,!1,!1)});var Lp=/[\-:]([a-z])/g;function $p(e){return e[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(e){var t=e.replace(Lp,$p);Xt[t]=new hn(t,1,!1,e,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(e){var t=e.replace(Lp,$p);Xt[t]=new hn(t,1,!1,e,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(e){var t=e.replace(Lp,$p);Xt[t]=new hn(t,1,!1,e,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(e){Xt[e]=new hn(e,1,!1,e.toLowerCase(),null,!1,!1)});Xt.xlinkHref=new hn("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(e){Xt[e]=new hn(e,1,!1,e.toLowerCase(),null,!0,!0)});function Bp(e,t,n,s){var o=Xt.hasOwnProperty(t)?Xt[t]:null;(o!==null?o.type!==0:s||!(2<t.length)||t[0]!=="o"&&t[0]!=="O"||t[1]!=="n"&&t[1]!=="N")&&(bv(t,n,o,s)&&(n=null),s||o===null?xv(t)&&(n===null?e.removeAttribute(t):e.setAttribute(t,""+n)):o.mustUseProperty?e[o.propertyName]=n===null?o.type===3?!1:"":n:(t=o.attributeName,s=o.attributeNamespace,n===null?e.removeAttribute(t):(o=o.type,n=o===3||o===4&&n===!0?"":""+n,s?e.setAttributeNS(s,t,n):e.setAttribute(t,n))))}var qr=gv.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,Ja=Symbol.for("react.element"),xo=Symbol.for("react.portal"),yo=Symbol.for("react.fragment"),Op=Symbol.for("react.strict_mode"),Cu=Symbol.for("react.profiler"),wh=Symbol.for("react.provider"),kh=Symbol.for("react.context"),Pp=Symbol.for("react.forward_ref"),Tu=Symbol.for("react.suspense"),Iu=Symbol.for("react.suspense_list"),zp=Symbol.for("react.memo"),rs=Symbol.for("react.lazy"),Eh=Symbol.for("react.offscreen"),L0=Symbol.iterator;function Ei(e){return e===null||typeof e!="object"?null:(e=L0&&e[L0]||e["@@iterator"],typeof e=="function"?e:null)}var _t=Object.assign,Rd;function Pi(e){if(Rd===void 0)try{throw Error()}catch(n){var t=n.stack.trim().match(/\n( *(at )?)/);Rd=t&&t[1]||""}return`
`+Rd+e}var Md=!1;function Ad(e,t){if(!e||Md)return"";Md=!0;var n=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(t)if(t=function(){throw Error()},Object.defineProperty(t.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(t,[])}catch(u){var s=u}Reflect.construct(e,[],t)}else{try{t.call()}catch(u){s=u}e.call(t.prototype)}else{try{throw Error()}catch(u){s=u}e()}}catch(u){if(u&&s&&typeof u.stack=="string"){for(var o=u.stack.split(`
`),i=s.stack.split(`
`),a=o.length-1,l=i.length-1;1<=a&&0<=l&&o[a]!==i[l];)l--;for(;1<=a&&0<=l;a--,l--)if(o[a]!==i[l]){if(a!==1||l!==1)do if(a--,l--,0>l||o[a]!==i[l]){var d=`
`+o[a].replace(" at new "," at ");return e.displayName&&d.includes("<anonymous>")&&(d=d.replace("<anonymous>",e.displayName)),d}while(1<=a&&0<=l);break}}}finally{Md=!1,Error.prepareStackTrace=n}return(e=e?e.displayName||e.name:"")?Pi(e):""}function vv(e){switch(e.tag){case 5:return Pi(e.type);case 16:return Pi("Lazy");case 13:return Pi("Suspense");case 19:return Pi("SuspenseList");case 0:case 2:case 15:return e=Ad(e.type,!1),e;case 11:return e=Ad(e.type.render,!1),e;case 1:return e=Ad(e.type,!0),e;default:return""}}function _u(e){if(e==null)return null;if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e;switch(e){case yo:return"Fragment";case xo:return"Portal";case Cu:return"Profiler";case Op:return"StrictMode";case Tu:return"Suspense";case Iu:return"SuspenseList"}if(typeof e=="object")switch(e.$$typeof){case kh:return(e.displayName||"Context")+".Consumer";case wh:return(e._context.displayName||"Context")+".Provider";case Pp:var t=e.render;return e=e.displayName,e||(e=t.displayName||t.name||"",e=e!==""?"ForwardRef("+e+")":"ForwardRef"),e;case zp:return t=e.displayName||null,t!==null?t:_u(e.type)||"Memo";case rs:t=e._payload,e=e._init;try{return _u(e(t))}catch{}}return null}function Sv(e){var t=e.type;switch(e.tag){case 24:return"Cache";case 9:return(t.displayName||"Context")+".Consumer";case 10:return(t._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return e=t.render,e=e.displayName||e.name||"",t.displayName||(e!==""?"ForwardRef("+e+")":"ForwardRef");case 7:return"Fragment";case 5:return t;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return _u(t);case 8:return t===Op?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof t=="function")return t.displayName||t.name||null;if(typeof t=="string")return t}return null}function bs(e){switch(typeof e){case"boolean":case"number":case"string":case"undefined":return e;case"object":return e;default:return""}}function jh(e){var t=e.type;return(e=e.nodeName)&&e.toLowerCase()==="input"&&(t==="checkbox"||t==="radio")}function wv(e){var t=jh(e)?"checked":"value",n=Object.getOwnPropertyDescriptor(e.constructor.prototype,t),s=""+e[t];if(!e.hasOwnProperty(t)&&typeof n<"u"&&typeof n.get=="function"&&typeof n.set=="function"){var o=n.get,i=n.set;return Object.defineProperty(e,t,{configurable:!0,get:function(){return o.call(this)},set:function(a){s=""+a,i.call(this,a)}}),Object.defineProperty(e,t,{enumerable:n.enumerable}),{getValue:function(){return s},setValue:function(a){s=""+a},stopTracking:function(){e._valueTracker=null,delete e[t]}}}}function Xa(e){e._valueTracker||(e._valueTracker=wv(e))}function Ch(e){if(!e)return!1;var t=e._valueTracker;if(!t)return!0;var n=t.getValue(),s="";return e&&(s=jh(e)?e.checked?"true":"false":e.value),e=s,e!==n?(t.setValue(e),!0):!1}function Vl(e){if(e=e||(typeof document<"u"?document:void 0),typeof e>"u")return null;try{return e.activeElement||e.body}catch{return e.body}}function Ru(e,t){var n=t.checked;return _t({},t,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:n??e._wrapperState.initialChecked})}function $0(e,t){var n=t.defaultValue==null?"":t.defaultValue,s=t.checked!=null?t.checked:t.defaultChecked;n=bs(t.value!=null?t.value:n),e._wrapperState={initialChecked:s,initialValue:n,controlled:t.type==="checkbox"||t.type==="radio"?t.checked!=null:t.value!=null}}function Th(e,t){t=t.checked,t!=null&&Bp(e,"checked",t,!1)}function Mu(e,t){Th(e,t);var n=bs(t.value),s=t.type;if(n!=null)s==="number"?(n===0&&e.value===""||e.value!=n)&&(e.value=""+n):e.value!==""+n&&(e.value=""+n);else if(s==="submit"||s==="reset"){e.removeAttribute("value");return}t.hasOwnProperty("value")?Au(e,t.type,n):t.hasOwnProperty("defaultValue")&&Au(e,t.type,bs(t.defaultValue)),t.checked==null&&t.defaultChecked!=null&&(e.defaultChecked=!!t.defaultChecked)}function B0(e,t,n){if(t.hasOwnProperty("value")||t.hasOwnProperty("defaultValue")){var s=t.type;if(!(s!=="submit"&&s!=="reset"||t.value!==void 0&&t.value!==null))return;t=""+e._wrapperState.initialValue,n||t===e.value||(e.value=t),e.defaultValue=t}n=e.name,n!==""&&(e.name=""),e.defaultChecked=!!e._wrapperState.initialChecked,n!==""&&(e.name=n)}function Au(e,t,n){(t!=="number"||Vl(e.ownerDocument)!==e)&&(n==null?e.defaultValue=""+e._wrapperState.initialValue:e.defaultValue!==""+n&&(e.defaultValue=""+n))}var zi=Array.isArray;function Ro(e,t,n,s){if(e=e.options,t){t={};for(var o=0;o<n.length;o++)t["$"+n[o]]=!0;for(n=0;n<e.length;n++)o=t.hasOwnProperty("$"+e[n].value),e[n].selected!==o&&(e[n].selected=o),o&&s&&(e[n].defaultSelected=!0)}else{for(n=""+bs(n),t=null,o=0;o<e.length;o++){if(e[o].value===n){e[o].selected=!0,s&&(e[o].defaultSelected=!0);return}t!==null||e[o].disabled||(t=e[o])}t!==null&&(t.selected=!0)}}function Nu(e,t){if(t.dangerouslySetInnerHTML!=null)throw Error(me(91));return _t({},t,{value:void 0,defaultValue:void 0,children:""+e._wrapperState.initialValue})}function O0(e,t){var n=t.value;if(n==null){if(n=t.children,t=t.defaultValue,n!=null){if(t!=null)throw Error(me(92));if(zi(n)){if(1<n.length)throw Error(me(93));n=n[0]}t=n}t==null&&(t=""),n=t}e._wrapperState={initialValue:bs(n)}}function Ih(e,t){var n=bs(t.value),s=bs(t.defaultValue);n!=null&&(n=""+n,n!==e.value&&(e.value=n),t.defaultValue==null&&e.defaultValue!==n&&(e.defaultValue=n)),s!=null&&(e.defaultValue=""+s)}function P0(e){var t=e.textContent;t===e._wrapperState.initialValue&&t!==""&&t!==null&&(e.value=t)}function _h(e){switch(e){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function Lu(e,t){return e==null||e==="http://www.w3.org/1999/xhtml"?_h(t):e==="http://www.w3.org/2000/svg"&&t==="foreignObject"?"http://www.w3.org/1999/xhtml":e}var Za,Rh=function(e){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(t,n,s,o){MSApp.execUnsafeLocalFunction(function(){return e(t,n,s,o)})}:e}(function(e,t){if(e.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in e)e.innerHTML=t;else{for(Za=Za||document.createElement("div"),Za.innerHTML="<svg>"+t.valueOf().toString()+"</svg>",t=Za.firstChild;e.firstChild;)e.removeChild(e.firstChild);for(;t.firstChild;)e.appendChild(t.firstChild)}});function na(e,t){if(t){var n=e.firstChild;if(n&&n===e.lastChild&&n.nodeType===3){n.nodeValue=t;return}}e.textContent=t}var Gi={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},kv=["Webkit","ms","Moz","O"];Object.keys(Gi).forEach(function(e){kv.forEach(function(t){t=t+e.charAt(0).toUpperCase()+e.substring(1),Gi[t]=Gi[e]})});function Mh(e,t,n){return t==null||typeof t=="boolean"||t===""?"":n||typeof t!="number"||t===0||Gi.hasOwnProperty(e)&&Gi[e]?(""+t).trim():t+"px"}function Ah(e,t){e=e.style;for(var n in t)if(t.hasOwnProperty(n)){var s=n.indexOf("--")===0,o=Mh(n,t[n],s);n==="float"&&(n="cssFloat"),s?e.setProperty(n,o):e[n]=o}}var Ev=_t({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function $u(e,t){if(t){if(Ev[e]&&(t.children!=null||t.dangerouslySetInnerHTML!=null))throw Error(me(137,e));if(t.dangerouslySetInnerHTML!=null){if(t.children!=null)throw Error(me(60));if(typeof t.dangerouslySetInnerHTML!="object"||!("__html"in t.dangerouslySetInnerHTML))throw Error(me(61))}if(t.style!=null&&typeof t.style!="object")throw Error(me(62))}}function Bu(e,t){if(e.indexOf("-")===-1)return typeof t.is=="string";switch(e){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var Ou=null;function Dp(e){return e=e.target||e.srcElement||window,e.correspondingUseElement&&(e=e.correspondingUseElement),e.nodeType===3?e.parentNode:e}var Pu=null,Mo=null,Ao=null;function z0(e){if(e=Ea(e)){if(typeof Pu!="function")throw Error(me(280));var t=e.stateNode;t&&(t=Nc(t),Pu(e.stateNode,e.type,t))}}function Nh(e){Mo?Ao?Ao.push(e):Ao=[e]:Mo=e}function Lh(){if(Mo){var e=Mo,t=Ao;if(Ao=Mo=null,z0(e),t)for(e=0;e<t.length;e++)z0(t[e])}}function $h(e,t){return e(t)}function Bh(){}var Nd=!1;function Oh(e,t,n){if(Nd)return e(t,n);Nd=!0;try{return $h(e,t,n)}finally{Nd=!1,(Mo!==null||Ao!==null)&&(Bh(),Lh())}}function ra(e,t){var n=e.stateNode;if(n===null)return null;var s=Nc(n);if(s===null)return null;n=s[t];e:switch(t){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(s=!s.disabled)||(e=e.type,s=!(e==="button"||e==="input"||e==="select"||e==="textarea")),e=!s;break e;default:e=!1}if(e)return null;if(n&&typeof n!="function")throw Error(me(231,t,typeof n));return n}var zu=!1;if(Wr)try{var ji={};Object.defineProperty(ji,"passive",{get:function(){zu=!0}}),window.addEventListener("test",ji,ji),window.removeEventListener("test",ji,ji)}catch{zu=!1}function jv(e,t,n,s,o,i,a,l,d){var u=Array.prototype.slice.call(arguments,3);try{t.apply(n,u)}catch(p){this.onError(p)}}var Vi=!1,Yl=null,ql=!1,Du=null,Cv={onError:function(e){Vi=!0,Yl=e}};function Tv(e,t,n,s,o,i,a,l,d){Vi=!1,Yl=null,jv.apply(Cv,arguments)}function Iv(e,t,n,s,o,i,a,l,d){if(Tv.apply(this,arguments),Vi){if(Vi){var u=Yl;Vi=!1,Yl=null}else throw Error(me(198));ql||(ql=!0,Du=u)}}function Ks(e){var t=e,n=e;if(e.alternate)for(;t.return;)t=t.return;else{e=t;do t=e,t.flags&4098&&(n=t.return),e=t.return;while(e)}return t.tag===3?n:null}function Ph(e){if(e.tag===13){var t=e.memoizedState;if(t===null&&(e=e.alternate,e!==null&&(t=e.memoizedState)),t!==null)return t.dehydrated}return null}function D0(e){if(Ks(e)!==e)throw Error(me(188))}function _v(e){var t=e.alternate;if(!t){if(t=Ks(e),t===null)throw Error(me(188));return t!==e?null:e}for(var n=e,s=t;;){var o=n.return;if(o===null)break;var i=o.alternate;if(i===null){if(s=o.return,s!==null){n=s;continue}break}if(o.child===i.child){for(i=o.child;i;){if(i===n)return D0(o),e;if(i===s)return D0(o),t;i=i.sibling}throw Error(me(188))}if(n.return!==s.return)n=o,s=i;else{for(var a=!1,l=o.child;l;){if(l===n){a=!0,n=o,s=i;break}if(l===s){a=!0,s=o,n=i;break}l=l.sibling}if(!a){for(l=i.child;l;){if(l===n){a=!0,n=i,s=o;break}if(l===s){a=!0,s=i,n=o;break}l=l.sibling}if(!a)throw Error(me(189))}}if(n.alternate!==s)throw Error(me(190))}if(n.tag!==3)throw Error(me(188));return n.stateNode.current===n?e:t}function zh(e){return e=_v(e),e!==null?Dh(e):null}function Dh(e){if(e.tag===5||e.tag===6)return e;for(e=e.child;e!==null;){var t=Dh(e);if(t!==null)return t;e=e.sibling}return null}var Fh=Bn.unstable_scheduleCallback,F0=Bn.unstable_cancelCallback,Rv=Bn.unstable_shouldYield,Mv=Bn.unstable_requestPaint,Nt=Bn.unstable_now,Av=Bn.unstable_getCurrentPriorityLevel,Fp=Bn.unstable_ImmediatePriority,Hh=Bn.unstable_UserBlockingPriority,Kl=Bn.unstable_NormalPriority,Nv=Bn.unstable_LowPriority,Wh=Bn.unstable_IdlePriority,_c=null,jr=null;function Lv(e){if(jr&&typeof jr.onCommitFiberRoot=="function")try{jr.onCommitFiberRoot(_c,e,void 0,(e.current.flags&128)===128)}catch{}}var or=Math.clz32?Math.clz32:Ov,$v=Math.log,Bv=Math.LN2;function Ov(e){return e>>>=0,e===0?32:31-($v(e)/Bv|0)|0}var el=64,tl=4194304;function Di(e){switch(e&-e){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return e&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return e}}function Ql(e,t){var n=e.pendingLanes;if(n===0)return 0;var s=0,o=e.suspendedLanes,i=e.pingedLanes,a=n&268435455;if(a!==0){var l=a&~o;l!==0?s=Di(l):(i&=a,i!==0&&(s=Di(i)))}else a=n&~o,a!==0?s=Di(a):i!==0&&(s=Di(i));if(s===0)return 0;if(t!==0&&t!==s&&!(t&o)&&(o=s&-s,i=t&-t,o>=i||o===16&&(i&4194240)!==0))return t;if(s&4&&(s|=n&16),t=e.entangledLanes,t!==0)for(e=e.entanglements,t&=s;0<t;)n=31-or(t),o=1<<n,s|=e[n],t&=~o;return s}function Pv(e,t){switch(e){case 1:case 2:case 4:return t+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function zv(e,t){for(var n=e.suspendedLanes,s=e.pingedLanes,o=e.expirationTimes,i=e.pendingLanes;0<i;){var a=31-or(i),l=1<<a,d=o[a];d===-1?(!(l&n)||l&s)&&(o[a]=Pv(l,t)):d<=t&&(e.expiredLanes|=l),i&=~l}}function Fu(e){return e=e.pendingLanes&-1073741825,e!==0?e:e&1073741824?1073741824:0}function Uh(){var e=el;return el<<=1,!(el&4194240)&&(el=64),e}function Ld(e){for(var t=[],n=0;31>n;n++)t.push(e);return t}function wa(e,t,n){e.pendingLanes|=t,t!==536870912&&(e.suspendedLanes=0,e.pingedLanes=0),e=e.eventTimes,t=31-or(t),e[t]=n}function Dv(e,t){var n=e.pendingLanes&~t;e.pendingLanes=t,e.suspendedLanes=0,e.pingedLanes=0,e.expiredLanes&=t,e.mutableReadLanes&=t,e.entangledLanes&=t,t=e.entanglements;var s=e.eventTimes;for(e=e.expirationTimes;0<n;){var o=31-or(n),i=1<<o;t[o]=0,s[o]=-1,e[o]=-1,n&=~i}}function Hp(e,t){var n=e.entangledLanes|=t;for(e=e.entanglements;n;){var s=31-or(n),o=1<<s;o&t|e[s]&t&&(e[s]|=t),n&=~o}}var pt=0;function Gh(e){return e&=-e,1<e?4<e?e&268435455?16:536870912:4:1}var Vh,Wp,Yh,qh,Kh,Hu=!1,nl=[],ds=null,us=null,ps=null,sa=new Map,oa=new Map,is=[],Fv="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function H0(e,t){switch(e){case"focusin":case"focusout":ds=null;break;case"dragenter":case"dragleave":us=null;break;case"mouseover":case"mouseout":ps=null;break;case"pointerover":case"pointerout":sa.delete(t.pointerId);break;case"gotpointercapture":case"lostpointercapture":oa.delete(t.pointerId)}}function Ci(e,t,n,s,o,i){return e===null||e.nativeEvent!==i?(e={blockedOn:t,domEventName:n,eventSystemFlags:s,nativeEvent:i,targetContainers:[o]},t!==null&&(t=Ea(t),t!==null&&Wp(t)),e):(e.eventSystemFlags|=s,t=e.targetContainers,o!==null&&t.indexOf(o)===-1&&t.push(o),e)}function Hv(e,t,n,s,o){switch(t){case"focusin":return ds=Ci(ds,e,t,n,s,o),!0;case"dragenter":return us=Ci(us,e,t,n,s,o),!0;case"mouseover":return ps=Ci(ps,e,t,n,s,o),!0;case"pointerover":var i=o.pointerId;return sa.set(i,Ci(sa.get(i)||null,e,t,n,s,o)),!0;case"gotpointercapture":return i=o.pointerId,oa.set(i,Ci(oa.get(i)||null,e,t,n,s,o)),!0}return!1}function Qh(e){var t=Ns(e.target);if(t!==null){var n=Ks(t);if(n!==null){if(t=n.tag,t===13){if(t=Ph(n),t!==null){e.blockedOn=t,Kh(e.priority,function(){Yh(n)});return}}else if(t===3&&n.stateNode.current.memoizedState.isDehydrated){e.blockedOn=n.tag===3?n.stateNode.containerInfo:null;return}}}e.blockedOn=null}function Il(e){if(e.blockedOn!==null)return!1;for(var t=e.targetContainers;0<t.length;){var n=Wu(e.domEventName,e.eventSystemFlags,t[0],e.nativeEvent);if(n===null){n=e.nativeEvent;var s=new n.constructor(n.type,n);Ou=s,n.target.dispatchEvent(s),Ou=null}else return t=Ea(n),t!==null&&Wp(t),e.blockedOn=n,!1;t.shift()}return!0}function W0(e,t,n){Il(e)&&n.delete(t)}function Wv(){Hu=!1,ds!==null&&Il(ds)&&(ds=null),us!==null&&Il(us)&&(us=null),ps!==null&&Il(ps)&&(ps=null),sa.forEach(W0),oa.forEach(W0)}function Ti(e,t){e.blockedOn===t&&(e.blockedOn=null,Hu||(Hu=!0,Bn.unstable_scheduleCallback(Bn.unstable_NormalPriority,Wv)))}function ia(e){function t(o){return Ti(o,e)}if(0<nl.length){Ti(nl[0],e);for(var n=1;n<nl.length;n++){var s=nl[n];s.blockedOn===e&&(s.blockedOn=null)}}for(ds!==null&&Ti(ds,e),us!==null&&Ti(us,e),ps!==null&&Ti(ps,e),sa.forEach(t),oa.forEach(t),n=0;n<is.length;n++)s=is[n],s.blockedOn===e&&(s.blockedOn=null);for(;0<is.length&&(n=is[0],n.blockedOn===null);)Qh(n),n.blockedOn===null&&is.shift()}var No=qr.ReactCurrentBatchConfig,Jl=!0;function Uv(e,t,n,s){var o=pt,i=No.transition;No.transition=null;try{pt=1,Up(e,t,n,s)}finally{pt=o,No.transition=i}}function Gv(e,t,n,s){var o=pt,i=No.transition;No.transition=null;try{pt=4,Up(e,t,n,s)}finally{pt=o,No.transition=i}}function Up(e,t,n,s){if(Jl){var o=Wu(e,t,n,s);if(o===null)Ud(e,t,s,Xl,n),H0(e,s);else if(Hv(o,e,t,n,s))s.stopPropagation();else if(H0(e,s),t&4&&-1<Fv.indexOf(e)){for(;o!==null;){var i=Ea(o);if(i!==null&&Vh(i),i=Wu(e,t,n,s),i===null&&Ud(e,t,s,Xl,n),i===o)break;o=i}o!==null&&s.stopPropagation()}else Ud(e,t,s,null,n)}}var Xl=null;function Wu(e,t,n,s){if(Xl=null,e=Dp(s),e=Ns(e),e!==null)if(t=Ks(e),t===null)e=null;else if(n=t.tag,n===13){if(e=Ph(t),e!==null)return e;e=null}else if(n===3){if(t.stateNode.current.memoizedState.isDehydrated)return t.tag===3?t.stateNode.containerInfo:null;e=null}else t!==e&&(e=null);return Xl=e,null}function Jh(e){switch(e){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(Av()){case Fp:return 1;case Hh:return 4;case Kl:case Nv:return 16;case Wh:return 536870912;default:return 16}default:return 16}}var ls=null,Gp=null,_l=null;function Xh(){if(_l)return _l;var e,t=Gp,n=t.length,s,o="value"in ls?ls.value:ls.textContent,i=o.length;for(e=0;e<n&&t[e]===o[e];e++);var a=n-e;for(s=1;s<=a&&t[n-s]===o[i-s];s++);return _l=o.slice(e,1<s?1-s:void 0)}function Rl(e){var t=e.keyCode;return"charCode"in e?(e=e.charCode,e===0&&t===13&&(e=13)):e=t,e===10&&(e=13),32<=e||e===13?e:0}function rl(){return!0}function U0(){return!1}function Pn(e){function t(n,s,o,i,a){this._reactName=n,this._targetInst=o,this.type=s,this.nativeEvent=i,this.target=a,this.currentTarget=null;for(var l in e)e.hasOwnProperty(l)&&(n=e[l],this[l]=n?n(i):i[l]);return this.isDefaultPrevented=(i.defaultPrevented!=null?i.defaultPrevented:i.returnValue===!1)?rl:U0,this.isPropagationStopped=U0,this}return _t(t.prototype,{preventDefault:function(){this.defaultPrevented=!0;var n=this.nativeEvent;n&&(n.preventDefault?n.preventDefault():typeof n.returnValue!="unknown"&&(n.returnValue=!1),this.isDefaultPrevented=rl)},stopPropagation:function(){var n=this.nativeEvent;n&&(n.stopPropagation?n.stopPropagation():typeof n.cancelBubble!="unknown"&&(n.cancelBubble=!0),this.isPropagationStopped=rl)},persist:function(){},isPersistent:rl}),t}var Qo={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(e){return e.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},Vp=Pn(Qo),ka=_t({},Qo,{view:0,detail:0}),Vv=Pn(ka),$d,Bd,Ii,Rc=_t({},ka,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Yp,button:0,buttons:0,relatedTarget:function(e){return e.relatedTarget===void 0?e.fromElement===e.srcElement?e.toElement:e.fromElement:e.relatedTarget},movementX:function(e){return"movementX"in e?e.movementX:(e!==Ii&&(Ii&&e.type==="mousemove"?($d=e.screenX-Ii.screenX,Bd=e.screenY-Ii.screenY):Bd=$d=0,Ii=e),$d)},movementY:function(e){return"movementY"in e?e.movementY:Bd}}),G0=Pn(Rc),Yv=_t({},Rc,{dataTransfer:0}),qv=Pn(Yv),Kv=_t({},ka,{relatedTarget:0}),Od=Pn(Kv),Qv=_t({},Qo,{animationName:0,elapsedTime:0,pseudoElement:0}),Jv=Pn(Qv),Xv=_t({},Qo,{clipboardData:function(e){return"clipboardData"in e?e.clipboardData:window.clipboardData}}),Zv=Pn(Xv),eS=_t({},Qo,{data:0}),V0=Pn(eS),tS={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},nS={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},rS={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function sS(e){var t=this.nativeEvent;return t.getModifierState?t.getModifierState(e):(e=rS[e])?!!t[e]:!1}function Yp(){return sS}var oS=_t({},ka,{key:function(e){if(e.key){var t=tS[e.key]||e.key;if(t!=="Unidentified")return t}return e.type==="keypress"?(e=Rl(e),e===13?"Enter":String.fromCharCode(e)):e.type==="keydown"||e.type==="keyup"?nS[e.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Yp,charCode:function(e){return e.type==="keypress"?Rl(e):0},keyCode:function(e){return e.type==="keydown"||e.type==="keyup"?e.keyCode:0},which:function(e){return e.type==="keypress"?Rl(e):e.type==="keydown"||e.type==="keyup"?e.keyCode:0}}),iS=Pn(oS),aS=_t({},Rc,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),Y0=Pn(aS),lS=_t({},ka,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Yp}),cS=Pn(lS),dS=_t({},Qo,{propertyName:0,elapsedTime:0,pseudoElement:0}),uS=Pn(dS),pS=_t({},Rc,{deltaX:function(e){return"deltaX"in e?e.deltaX:"wheelDeltaX"in e?-e.wheelDeltaX:0},deltaY:function(e){return"deltaY"in e?e.deltaY:"wheelDeltaY"in e?-e.wheelDeltaY:"wheelDelta"in e?-e.wheelDelta:0},deltaZ:0,deltaMode:0}),fS=Pn(pS),mS=[9,13,27,32],qp=Wr&&"CompositionEvent"in window,Yi=null;Wr&&"documentMode"in document&&(Yi=document.documentMode);var gS=Wr&&"TextEvent"in window&&!Yi,Zh=Wr&&(!qp||Yi&&8<Yi&&11>=Yi),q0=" ",K0=!1;function ex(e,t){switch(e){case"keyup":return mS.indexOf(t.keyCode)!==-1;case"keydown":return t.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function tx(e){return e=e.detail,typeof e=="object"&&"data"in e?e.data:null}var bo=!1;function hS(e,t){switch(e){case"compositionend":return tx(t);case"keypress":return t.which!==32?null:(K0=!0,q0);case"textInput":return e=t.data,e===q0&&K0?null:e;default:return null}}function xS(e,t){if(bo)return e==="compositionend"||!qp&&ex(e,t)?(e=Xh(),_l=Gp=ls=null,bo=!1,e):null;switch(e){case"paste":return null;case"keypress":if(!(t.ctrlKey||t.altKey||t.metaKey)||t.ctrlKey&&t.altKey){if(t.char&&1<t.char.length)return t.char;if(t.which)return String.fromCharCode(t.which)}return null;case"compositionend":return Zh&&t.locale!=="ko"?null:t.data;default:return null}}var yS={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Q0(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t==="input"?!!yS[e.type]:t==="textarea"}function nx(e,t,n,s){Nh(s),t=Zl(t,"onChange"),0<t.length&&(n=new Vp("onChange","change",null,n,s),e.push({event:n,listeners:t}))}var qi=null,aa=null;function bS(e){fx(e,0)}function Mc(e){var t=wo(e);if(Ch(t))return e}function vS(e,t){if(e==="change")return t}var rx=!1;if(Wr){var Pd;if(Wr){var zd="oninput"in document;if(!zd){var J0=document.createElement("div");J0.setAttribute("oninput","return;"),zd=typeof J0.oninput=="function"}Pd=zd}else Pd=!1;rx=Pd&&(!document.documentMode||9<document.documentMode)}function X0(){qi&&(qi.detachEvent("onpropertychange",sx),aa=qi=null)}function sx(e){if(e.propertyName==="value"&&Mc(aa)){var t=[];nx(t,aa,e,Dp(e)),Oh(bS,t)}}function SS(e,t,n){e==="focusin"?(X0(),qi=t,aa=n,qi.attachEvent("onpropertychange",sx)):e==="focusout"&&X0()}function wS(e){if(e==="selectionchange"||e==="keyup"||e==="keydown")return Mc(aa)}function kS(e,t){if(e==="click")return Mc(t)}function ES(e,t){if(e==="input"||e==="change")return Mc(t)}function jS(e,t){return e===t&&(e!==0||1/e===1/t)||e!==e&&t!==t}var ar=typeof Object.is=="function"?Object.is:jS;function la(e,t){if(ar(e,t))return!0;if(typeof e!="object"||e===null||typeof t!="object"||t===null)return!1;var n=Object.keys(e),s=Object.keys(t);if(n.length!==s.length)return!1;for(s=0;s<n.length;s++){var o=n[s];if(!ju.call(t,o)||!ar(e[o],t[o]))return!1}return!0}function Z0(e){for(;e&&e.firstChild;)e=e.firstChild;return e}function em(e,t){var n=Z0(e);e=0;for(var s;n;){if(n.nodeType===3){if(s=e+n.textContent.length,e<=t&&s>=t)return{node:n,offset:t-e};e=s}e:{for(;n;){if(n.nextSibling){n=n.nextSibling;break e}n=n.parentNode}n=void 0}n=Z0(n)}}function ox(e,t){return e&&t?e===t?!0:e&&e.nodeType===3?!1:t&&t.nodeType===3?ox(e,t.parentNode):"contains"in e?e.contains(t):e.compareDocumentPosition?!!(e.compareDocumentPosition(t)&16):!1:!1}function ix(){for(var e=window,t=Vl();t instanceof e.HTMLIFrameElement;){try{var n=typeof t.contentWindow.location.href=="string"}catch{n=!1}if(n)e=t.contentWindow;else break;t=Vl(e.document)}return t}function Kp(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t&&(t==="input"&&(e.type==="text"||e.type==="search"||e.type==="tel"||e.type==="url"||e.type==="password")||t==="textarea"||e.contentEditable==="true")}function CS(e){var t=ix(),n=e.focusedElem,s=e.selectionRange;if(t!==n&&n&&n.ownerDocument&&ox(n.ownerDocument.documentElement,n)){if(s!==null&&Kp(n)){if(t=s.start,e=s.end,e===void 0&&(e=t),"selectionStart"in n)n.selectionStart=t,n.selectionEnd=Math.min(e,n.value.length);else if(e=(t=n.ownerDocument||document)&&t.defaultView||window,e.getSelection){e=e.getSelection();var o=n.textContent.length,i=Math.min(s.start,o);s=s.end===void 0?i:Math.min(s.end,o),!e.extend&&i>s&&(o=s,s=i,i=o),o=em(n,i);var a=em(n,s);o&&a&&(e.rangeCount!==1||e.anchorNode!==o.node||e.anchorOffset!==o.offset||e.focusNode!==a.node||e.focusOffset!==a.offset)&&(t=t.createRange(),t.setStart(o.node,o.offset),e.removeAllRanges(),i>s?(e.addRange(t),e.extend(a.node,a.offset)):(t.setEnd(a.node,a.offset),e.addRange(t)))}}for(t=[],e=n;e=e.parentNode;)e.nodeType===1&&t.push({element:e,left:e.scrollLeft,top:e.scrollTop});for(typeof n.focus=="function"&&n.focus(),n=0;n<t.length;n++)e=t[n],e.element.scrollLeft=e.left,e.element.scrollTop=e.top}}var TS=Wr&&"documentMode"in document&&11>=document.documentMode,vo=null,Uu=null,Ki=null,Gu=!1;function tm(e,t,n){var s=n.window===n?n.document:n.nodeType===9?n:n.ownerDocument;Gu||vo==null||vo!==Vl(s)||(s=vo,"selectionStart"in s&&Kp(s)?s={start:s.selectionStart,end:s.selectionEnd}:(s=(s.ownerDocument&&s.ownerDocument.defaultView||window).getSelection(),s={anchorNode:s.anchorNode,anchorOffset:s.anchorOffset,focusNode:s.focusNode,focusOffset:s.focusOffset}),Ki&&la(Ki,s)||(Ki=s,s=Zl(Uu,"onSelect"),0<s.length&&(t=new Vp("onSelect","select",null,t,n),e.push({event:t,listeners:s}),t.target=vo)))}function sl(e,t){var n={};return n[e.toLowerCase()]=t.toLowerCase(),n["Webkit"+e]="webkit"+t,n["Moz"+e]="moz"+t,n}var So={animationend:sl("Animation","AnimationEnd"),animationiteration:sl("Animation","AnimationIteration"),animationstart:sl("Animation","AnimationStart"),transitionend:sl("Transition","TransitionEnd")},Dd={},ax={};Wr&&(ax=document.createElement("div").style,"AnimationEvent"in window||(delete So.animationend.animation,delete So.animationiteration.animation,delete So.animationstart.animation),"TransitionEvent"in window||delete So.transitionend.transition);function Ac(e){if(Dd[e])return Dd[e];if(!So[e])return e;var t=So[e],n;for(n in t)if(t.hasOwnProperty(n)&&n in ax)return Dd[e]=t[n];return e}var lx=Ac("animationend"),cx=Ac("animationiteration"),dx=Ac("animationstart"),ux=Ac("transitionend"),px=new Map,nm="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function Ss(e,t){px.set(e,t),qs(t,[e])}for(var Fd=0;Fd<nm.length;Fd++){var Hd=nm[Fd],IS=Hd.toLowerCase(),_S=Hd[0].toUpperCase()+Hd.slice(1);Ss(IS,"on"+_S)}Ss(lx,"onAnimationEnd");Ss(cx,"onAnimationIteration");Ss(dx,"onAnimationStart");Ss("dblclick","onDoubleClick");Ss("focusin","onFocus");Ss("focusout","onBlur");Ss(ux,"onTransitionEnd");zo("onMouseEnter",["mouseout","mouseover"]);zo("onMouseLeave",["mouseout","mouseover"]);zo("onPointerEnter",["pointerout","pointerover"]);zo("onPointerLeave",["pointerout","pointerover"]);qs("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));qs("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));qs("onBeforeInput",["compositionend","keypress","textInput","paste"]);qs("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));qs("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));qs("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Fi="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),RS=new Set("cancel close invalid load scroll toggle".split(" ").concat(Fi));function rm(e,t,n){var s=e.type||"unknown-event";e.currentTarget=n,Iv(s,t,void 0,e),e.currentTarget=null}function fx(e,t){t=(t&4)!==0;for(var n=0;n<e.length;n++){var s=e[n],o=s.event;s=s.listeners;e:{var i=void 0;if(t)for(var a=s.length-1;0<=a;a--){var l=s[a],d=l.instance,u=l.currentTarget;if(l=l.listener,d!==i&&o.isPropagationStopped())break e;rm(o,l,u),i=d}else for(a=0;a<s.length;a++){if(l=s[a],d=l.instance,u=l.currentTarget,l=l.listener,d!==i&&o.isPropagationStopped())break e;rm(o,l,u),i=d}}}if(ql)throw e=Du,ql=!1,Du=null,e}function vt(e,t){var n=t[Qu];n===void 0&&(n=t[Qu]=new Set);var s=e+"__bubble";n.has(s)||(mx(t,e,2,!1),n.add(s))}function Wd(e,t,n){var s=0;t&&(s|=4),mx(n,e,s,t)}var ol="_reactListening"+Math.random().toString(36).slice(2);function ca(e){if(!e[ol]){e[ol]=!0,Sh.forEach(function(n){n!=="selectionchange"&&(RS.has(n)||Wd(n,!1,e),Wd(n,!0,e))});var t=e.nodeType===9?e:e.ownerDocument;t===null||t[ol]||(t[ol]=!0,Wd("selectionchange",!1,t))}}function mx(e,t,n,s){switch(Jh(t)){case 1:var o=Uv;break;case 4:o=Gv;break;default:o=Up}n=o.bind(null,t,n,e),o=void 0,!zu||t!=="touchstart"&&t!=="touchmove"&&t!=="wheel"||(o=!0),s?o!==void 0?e.addEventListener(t,n,{capture:!0,passive:o}):e.addEventListener(t,n,!0):o!==void 0?e.addEventListener(t,n,{passive:o}):e.addEventListener(t,n,!1)}function Ud(e,t,n,s,o){var i=s;if(!(t&1)&&!(t&2)&&s!==null)e:for(;;){if(s===null)return;var a=s.tag;if(a===3||a===4){var l=s.stateNode.containerInfo;if(l===o||l.nodeType===8&&l.parentNode===o)break;if(a===4)for(a=s.return;a!==null;){var d=a.tag;if((d===3||d===4)&&(d=a.stateNode.containerInfo,d===o||d.nodeType===8&&d.parentNode===o))return;a=a.return}for(;l!==null;){if(a=Ns(l),a===null)return;if(d=a.tag,d===5||d===6){s=i=a;continue e}l=l.parentNode}}s=s.return}Oh(function(){var u=i,p=Dp(n),c=[];e:{var m=px.get(e);if(m!==void 0){var y=Vp,S=e;switch(e){case"keypress":if(Rl(n)===0)break e;case"keydown":case"keyup":y=iS;break;case"focusin":S="focus",y=Od;break;case"focusout":S="blur",y=Od;break;case"beforeblur":case"afterblur":y=Od;break;case"click":if(n.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":y=G0;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":y=qv;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":y=cS;break;case lx:case cx:case dx:y=Jv;break;case ux:y=uS;break;case"scroll":y=Vv;break;case"wheel":y=fS;break;case"copy":case"cut":case"paste":y=Zv;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":y=Y0}var E=(t&4)!==0,w=!E&&e==="scroll",g=E?m!==null?m+"Capture":null:m;E=[];for(var h=u,v;h!==null;){v=h;var x=v.stateNode;if(v.tag===5&&x!==null&&(v=x,g!==null&&(x=ra(h,g),x!=null&&E.push(da(h,x,v)))),w)break;h=h.return}0<E.length&&(m=new y(m,S,null,n,p),c.push({event:m,listeners:E}))}}if(!(t&7)){e:{if(m=e==="mouseover"||e==="pointerover",y=e==="mouseout"||e==="pointerout",m&&n!==Ou&&(S=n.relatedTarget||n.fromElement)&&(Ns(S)||S[Ur]))break e;if((y||m)&&(m=p.window===p?p:(m=p.ownerDocument)?m.defaultView||m.parentWindow:window,y?(S=n.relatedTarget||n.toElement,y=u,S=S?Ns(S):null,S!==null&&(w=Ks(S),S!==w||S.tag!==5&&S.tag!==6)&&(S=null)):(y=null,S=u),y!==S)){if(E=G0,x="onMouseLeave",g="onMouseEnter",h="mouse",(e==="pointerout"||e==="pointerover")&&(E=Y0,x="onPointerLeave",g="onPointerEnter",h="pointer"),w=y==null?m:wo(y),v=S==null?m:wo(S),m=new E(x,h+"leave",y,n,p),m.target=w,m.relatedTarget=v,x=null,Ns(p)===u&&(E=new E(g,h+"enter",S,n,p),E.target=v,E.relatedTarget=w,x=E),w=x,y&&S)t:{for(E=y,g=S,h=0,v=E;v;v=lo(v))h++;for(v=0,x=g;x;x=lo(x))v++;for(;0<h-v;)E=lo(E),h--;for(;0<v-h;)g=lo(g),v--;for(;h--;){if(E===g||g!==null&&E===g.alternate)break t;E=lo(E),g=lo(g)}E=null}else E=null;y!==null&&sm(c,m,y,E,!1),S!==null&&w!==null&&sm(c,w,S,E,!0)}}e:{if(m=u?wo(u):window,y=m.nodeName&&m.nodeName.toLowerCase(),y==="select"||y==="input"&&m.type==="file")var I=vS;else if(Q0(m))if(rx)I=ES;else{I=wS;var _=SS}else(y=m.nodeName)&&y.toLowerCase()==="input"&&(m.type==="checkbox"||m.type==="radio")&&(I=kS);if(I&&(I=I(e,u))){nx(c,I,n,p);break e}_&&_(e,m,u),e==="focusout"&&(_=m._wrapperState)&&_.controlled&&m.type==="number"&&Au(m,"number",m.value)}switch(_=u?wo(u):window,e){case"focusin":(Q0(_)||_.contentEditable==="true")&&(vo=_,Uu=u,Ki=null);break;case"focusout":Ki=Uu=vo=null;break;case"mousedown":Gu=!0;break;case"contextmenu":case"mouseup":case"dragend":Gu=!1,tm(c,n,p);break;case"selectionchange":if(TS)break;case"keydown":case"keyup":tm(c,n,p)}var N;if(qp)e:{switch(e){case"compositionstart":var C="onCompositionStart";break e;case"compositionend":C="onCompositionEnd";break e;case"compositionupdate":C="onCompositionUpdate";break e}C=void 0}else bo?ex(e,n)&&(C="onCompositionEnd"):e==="keydown"&&n.keyCode===229&&(C="onCompositionStart");C&&(Zh&&n.locale!=="ko"&&(bo||C!=="onCompositionStart"?C==="onCompositionEnd"&&bo&&(N=Xh()):(ls=p,Gp="value"in ls?ls.value:ls.textContent,bo=!0)),_=Zl(u,C),0<_.length&&(C=new V0(C,e,null,n,p),c.push({event:C,listeners:_}),N?C.data=N:(N=tx(n),N!==null&&(C.data=N)))),(N=gS?hS(e,n):xS(e,n))&&(u=Zl(u,"onBeforeInput"),0<u.length&&(p=new V0("onBeforeInput","beforeinput",null,n,p),c.push({event:p,listeners:u}),p.data=N))}fx(c,t)})}function da(e,t,n){return{instance:e,listener:t,currentTarget:n}}function Zl(e,t){for(var n=t+"Capture",s=[];e!==null;){var o=e,i=o.stateNode;o.tag===5&&i!==null&&(o=i,i=ra(e,n),i!=null&&s.unshift(da(e,i,o)),i=ra(e,t),i!=null&&s.push(da(e,i,o))),e=e.return}return s}function lo(e){if(e===null)return null;do e=e.return;while(e&&e.tag!==5);return e||null}function sm(e,t,n,s,o){for(var i=t._reactName,a=[];n!==null&&n!==s;){var l=n,d=l.alternate,u=l.stateNode;if(d!==null&&d===s)break;l.tag===5&&u!==null&&(l=u,o?(d=ra(n,i),d!=null&&a.unshift(da(n,d,l))):o||(d=ra(n,i),d!=null&&a.push(da(n,d,l)))),n=n.return}a.length!==0&&e.push({event:t,listeners:a})}var MS=/\r\n?/g,AS=/\u0000|\uFFFD/g;function om(e){return(typeof e=="string"?e:""+e).replace(MS,`
`).replace(AS,"")}function il(e,t,n){if(t=om(t),om(e)!==t&&n)throw Error(me(425))}function ec(){}var Vu=null,Yu=null;function qu(e,t){return e==="textarea"||e==="noscript"||typeof t.children=="string"||typeof t.children=="number"||typeof t.dangerouslySetInnerHTML=="object"&&t.dangerouslySetInnerHTML!==null&&t.dangerouslySetInnerHTML.__html!=null}var Ku=typeof setTimeout=="function"?setTimeout:void 0,NS=typeof clearTimeout=="function"?clearTimeout:void 0,im=typeof Promise=="function"?Promise:void 0,LS=typeof queueMicrotask=="function"?queueMicrotask:typeof im<"u"?function(e){return im.resolve(null).then(e).catch($S)}:Ku;function $S(e){setTimeout(function(){throw e})}function Gd(e,t){var n=t,s=0;do{var o=n.nextSibling;if(e.removeChild(n),o&&o.nodeType===8)if(n=o.data,n==="/$"){if(s===0){e.removeChild(o),ia(t);return}s--}else n!=="$"&&n!=="$?"&&n!=="$!"||s++;n=o}while(n);ia(t)}function fs(e){for(;e!=null;e=e.nextSibling){var t=e.nodeType;if(t===1||t===3)break;if(t===8){if(t=e.data,t==="$"||t==="$!"||t==="$?")break;if(t==="/$")return null}}return e}function am(e){e=e.previousSibling;for(var t=0;e;){if(e.nodeType===8){var n=e.data;if(n==="$"||n==="$!"||n==="$?"){if(t===0)return e;t--}else n==="/$"&&t++}e=e.previousSibling}return null}var Jo=Math.random().toString(36).slice(2),kr="__reactFiber$"+Jo,ua="__reactProps$"+Jo,Ur="__reactContainer$"+Jo,Qu="__reactEvents$"+Jo,BS="__reactListeners$"+Jo,OS="__reactHandles$"+Jo;function Ns(e){var t=e[kr];if(t)return t;for(var n=e.parentNode;n;){if(t=n[Ur]||n[kr]){if(n=t.alternate,t.child!==null||n!==null&&n.child!==null)for(e=am(e);e!==null;){if(n=e[kr])return n;e=am(e)}return t}e=n,n=e.parentNode}return null}function Ea(e){return e=e[kr]||e[Ur],!e||e.tag!==5&&e.tag!==6&&e.tag!==13&&e.tag!==3?null:e}function wo(e){if(e.tag===5||e.tag===6)return e.stateNode;throw Error(me(33))}function Nc(e){return e[ua]||null}var Ju=[],ko=-1;function ws(e){return{current:e}}function St(e){0>ko||(e.current=Ju[ko],Ju[ko]=null,ko--)}function ht(e,t){ko++,Ju[ko]=e.current,e.current=t}var vs={},an=ws(vs),En=ws(!1),Fs=vs;function Do(e,t){var n=e.type.contextTypes;if(!n)return vs;var s=e.stateNode;if(s&&s.__reactInternalMemoizedUnmaskedChildContext===t)return s.__reactInternalMemoizedMaskedChildContext;var o={},i;for(i in n)o[i]=t[i];return s&&(e=e.stateNode,e.__reactInternalMemoizedUnmaskedChildContext=t,e.__reactInternalMemoizedMaskedChildContext=o),o}function jn(e){return e=e.childContextTypes,e!=null}function tc(){St(En),St(an)}function lm(e,t,n){if(an.current!==vs)throw Error(me(168));ht(an,t),ht(En,n)}function gx(e,t,n){var s=e.stateNode;if(t=t.childContextTypes,typeof s.getChildContext!="function")return n;s=s.getChildContext();for(var o in s)if(!(o in t))throw Error(me(108,Sv(e)||"Unknown",o));return _t({},n,s)}function nc(e){return e=(e=e.stateNode)&&e.__reactInternalMemoizedMergedChildContext||vs,Fs=an.current,ht(an,e),ht(En,En.current),!0}function cm(e,t,n){var s=e.stateNode;if(!s)throw Error(me(169));n?(e=gx(e,t,Fs),s.__reactInternalMemoizedMergedChildContext=e,St(En),St(an),ht(an,e)):St(En),ht(En,n)}var Pr=null,Lc=!1,Vd=!1;function hx(e){Pr===null?Pr=[e]:Pr.push(e)}function PS(e){Lc=!0,hx(e)}function ks(){if(!Vd&&Pr!==null){Vd=!0;var e=0,t=pt;try{var n=Pr;for(pt=1;e<n.length;e++){var s=n[e];do s=s(!0);while(s!==null)}Pr=null,Lc=!1}catch(o){throw Pr!==null&&(Pr=Pr.slice(e+1)),Fh(Fp,ks),o}finally{pt=t,Vd=!1}}return null}var Eo=[],jo=0,rc=null,sc=0,Vn=[],Yn=0,Hs=null,zr=1,Dr="";function Ms(e,t){Eo[jo++]=sc,Eo[jo++]=rc,rc=e,sc=t}function xx(e,t,n){Vn[Yn++]=zr,Vn[Yn++]=Dr,Vn[Yn++]=Hs,Hs=e;var s=zr;e=Dr;var o=32-or(s)-1;s&=~(1<<o),n+=1;var i=32-or(t)+o;if(30<i){var a=o-o%5;i=(s&(1<<a)-1).toString(32),s>>=a,o-=a,zr=1<<32-or(t)+o|n<<o|s,Dr=i+e}else zr=1<<i|n<<o|s,Dr=e}function Qp(e){e.return!==null&&(Ms(e,1),xx(e,1,0))}function Jp(e){for(;e===rc;)rc=Eo[--jo],Eo[jo]=null,sc=Eo[--jo],Eo[jo]=null;for(;e===Hs;)Hs=Vn[--Yn],Vn[Yn]=null,Dr=Vn[--Yn],Vn[Yn]=null,zr=Vn[--Yn],Vn[Yn]=null}var $n=null,Ln=null,kt=!1,sr=null;function yx(e,t){var n=Kn(5,null,null,0);n.elementType="DELETED",n.stateNode=t,n.return=e,t=e.deletions,t===null?(e.deletions=[n],e.flags|=16):t.push(n)}function dm(e,t){switch(e.tag){case 5:var n=e.type;return t=t.nodeType!==1||n.toLowerCase()!==t.nodeName.toLowerCase()?null:t,t!==null?(e.stateNode=t,$n=e,Ln=fs(t.firstChild),!0):!1;case 6:return t=e.pendingProps===""||t.nodeType!==3?null:t,t!==null?(e.stateNode=t,$n=e,Ln=null,!0):!1;case 13:return t=t.nodeType!==8?null:t,t!==null?(n=Hs!==null?{id:zr,overflow:Dr}:null,e.memoizedState={dehydrated:t,treeContext:n,retryLane:1073741824},n=Kn(18,null,null,0),n.stateNode=t,n.return=e,e.child=n,$n=e,Ln=null,!0):!1;default:return!1}}function Xu(e){return(e.mode&1)!==0&&(e.flags&128)===0}function Zu(e){if(kt){var t=Ln;if(t){var n=t;if(!dm(e,t)){if(Xu(e))throw Error(me(418));t=fs(n.nextSibling);var s=$n;t&&dm(e,t)?yx(s,n):(e.flags=e.flags&-4097|2,kt=!1,$n=e)}}else{if(Xu(e))throw Error(me(418));e.flags=e.flags&-4097|2,kt=!1,$n=e}}}function um(e){for(e=e.return;e!==null&&e.tag!==5&&e.tag!==3&&e.tag!==13;)e=e.return;$n=e}function al(e){if(e!==$n)return!1;if(!kt)return um(e),kt=!0,!1;var t;if((t=e.tag!==3)&&!(t=e.tag!==5)&&(t=e.type,t=t!=="head"&&t!=="body"&&!qu(e.type,e.memoizedProps)),t&&(t=Ln)){if(Xu(e))throw bx(),Error(me(418));for(;t;)yx(e,t),t=fs(t.nextSibling)}if(um(e),e.tag===13){if(e=e.memoizedState,e=e!==null?e.dehydrated:null,!e)throw Error(me(317));e:{for(e=e.nextSibling,t=0;e;){if(e.nodeType===8){var n=e.data;if(n==="/$"){if(t===0){Ln=fs(e.nextSibling);break e}t--}else n!=="$"&&n!=="$!"&&n!=="$?"||t++}e=e.nextSibling}Ln=null}}else Ln=$n?fs(e.stateNode.nextSibling):null;return!0}function bx(){for(var e=Ln;e;)e=fs(e.nextSibling)}function Fo(){Ln=$n=null,kt=!1}function Xp(e){sr===null?sr=[e]:sr.push(e)}var zS=qr.ReactCurrentBatchConfig;function _i(e,t,n){if(e=n.ref,e!==null&&typeof e!="function"&&typeof e!="object"){if(n._owner){if(n=n._owner,n){if(n.tag!==1)throw Error(me(309));var s=n.stateNode}if(!s)throw Error(me(147,e));var o=s,i=""+e;return t!==null&&t.ref!==null&&typeof t.ref=="function"&&t.ref._stringRef===i?t.ref:(t=function(a){var l=o.refs;a===null?delete l[i]:l[i]=a},t._stringRef=i,t)}if(typeof e!="string")throw Error(me(284));if(!n._owner)throw Error(me(290,e))}return e}function ll(e,t){throw e=Object.prototype.toString.call(t),Error(me(31,e==="[object Object]"?"object with keys {"+Object.keys(t).join(", ")+"}":e))}function pm(e){var t=e._init;return t(e._payload)}function vx(e){function t(g,h){if(e){var v=g.deletions;v===null?(g.deletions=[h],g.flags|=16):v.push(h)}}function n(g,h){if(!e)return null;for(;h!==null;)t(g,h),h=h.sibling;return null}function s(g,h){for(g=new Map;h!==null;)h.key!==null?g.set(h.key,h):g.set(h.index,h),h=h.sibling;return g}function o(g,h){return g=xs(g,h),g.index=0,g.sibling=null,g}function i(g,h,v){return g.index=v,e?(v=g.alternate,v!==null?(v=v.index,v<h?(g.flags|=2,h):v):(g.flags|=2,h)):(g.flags|=1048576,h)}function a(g){return e&&g.alternate===null&&(g.flags|=2),g}function l(g,h,v,x){return h===null||h.tag!==6?(h=Zd(v,g.mode,x),h.return=g,h):(h=o(h,v),h.return=g,h)}function d(g,h,v,x){var I=v.type;return I===yo?p(g,h,v.props.children,x,v.key):h!==null&&(h.elementType===I||typeof I=="object"&&I!==null&&I.$$typeof===rs&&pm(I)===h.type)?(x=o(h,v.props),x.ref=_i(g,h,v),x.return=g,x):(x=Ol(v.type,v.key,v.props,null,g.mode,x),x.ref=_i(g,h,v),x.return=g,x)}function u(g,h,v,x){return h===null||h.tag!==4||h.stateNode.containerInfo!==v.containerInfo||h.stateNode.implementation!==v.implementation?(h=eu(v,g.mode,x),h.return=g,h):(h=o(h,v.children||[]),h.return=g,h)}function p(g,h,v,x,I){return h===null||h.tag!==7?(h=Os(v,g.mode,x,I),h.return=g,h):(h=o(h,v),h.return=g,h)}function c(g,h,v){if(typeof h=="string"&&h!==""||typeof h=="number")return h=Zd(""+h,g.mode,v),h.return=g,h;if(typeof h=="object"&&h!==null){switch(h.$$typeof){case Ja:return v=Ol(h.type,h.key,h.props,null,g.mode,v),v.ref=_i(g,null,h),v.return=g,v;case xo:return h=eu(h,g.mode,v),h.return=g,h;case rs:var x=h._init;return c(g,x(h._payload),v)}if(zi(h)||Ei(h))return h=Os(h,g.mode,v,null),h.return=g,h;ll(g,h)}return null}function m(g,h,v,x){var I=h!==null?h.key:null;if(typeof v=="string"&&v!==""||typeof v=="number")return I!==null?null:l(g,h,""+v,x);if(typeof v=="object"&&v!==null){switch(v.$$typeof){case Ja:return v.key===I?d(g,h,v,x):null;case xo:return v.key===I?u(g,h,v,x):null;case rs:return I=v._init,m(g,h,I(v._payload),x)}if(zi(v)||Ei(v))return I!==null?null:p(g,h,v,x,null);ll(g,v)}return null}function y(g,h,v,x,I){if(typeof x=="string"&&x!==""||typeof x=="number")return g=g.get(v)||null,l(h,g,""+x,I);if(typeof x=="object"&&x!==null){switch(x.$$typeof){case Ja:return g=g.get(x.key===null?v:x.key)||null,d(h,g,x,I);case xo:return g=g.get(x.key===null?v:x.key)||null,u(h,g,x,I);case rs:var _=x._init;return y(g,h,v,_(x._payload),I)}if(zi(x)||Ei(x))return g=g.get(v)||null,p(h,g,x,I,null);ll(h,x)}return null}function S(g,h,v,x){for(var I=null,_=null,N=h,C=h=0,j=null;N!==null&&C<v.length;C++){N.index>C?(j=N,N=null):j=N.sibling;var T=m(g,N,v[C],x);if(T===null){N===null&&(N=j);break}e&&N&&T.alternate===null&&t(g,N),h=i(T,h,C),_===null?I=T:_.sibling=T,_=T,N=j}if(C===v.length)return n(g,N),kt&&Ms(g,C),I;if(N===null){for(;C<v.length;C++)N=c(g,v[C],x),N!==null&&(h=i(N,h,C),_===null?I=N:_.sibling=N,_=N);return kt&&Ms(g,C),I}for(N=s(g,N);C<v.length;C++)j=y(N,g,C,v[C],x),j!==null&&(e&&j.alternate!==null&&N.delete(j.key===null?C:j.key),h=i(j,h,C),_===null?I=j:_.sibling=j,_=j);return e&&N.forEach(function(A){return t(g,A)}),kt&&Ms(g,C),I}function E(g,h,v,x){var I=Ei(v);if(typeof I!="function")throw Error(me(150));if(v=I.call(v),v==null)throw Error(me(151));for(var _=I=null,N=h,C=h=0,j=null,T=v.next();N!==null&&!T.done;C++,T=v.next()){N.index>C?(j=N,N=null):j=N.sibling;var A=m(g,N,T.value,x);if(A===null){N===null&&(N=j);break}e&&N&&A.alternate===null&&t(g,N),h=i(A,h,C),_===null?I=A:_.sibling=A,_=A,N=j}if(T.done)return n(g,N),kt&&Ms(g,C),I;if(N===null){for(;!T.done;C++,T=v.next())T=c(g,T.value,x),T!==null&&(h=i(T,h,C),_===null?I=T:_.sibling=T,_=T);return kt&&Ms(g,C),I}for(N=s(g,N);!T.done;C++,T=v.next())T=y(N,g,C,T.value,x),T!==null&&(e&&T.alternate!==null&&N.delete(T.key===null?C:T.key),h=i(T,h,C),_===null?I=T:_.sibling=T,_=T);return e&&N.forEach(function(V){return t(g,V)}),kt&&Ms(g,C),I}function w(g,h,v,x){if(typeof v=="object"&&v!==null&&v.type===yo&&v.key===null&&(v=v.props.children),typeof v=="object"&&v!==null){switch(v.$$typeof){case Ja:e:{for(var I=v.key,_=h;_!==null;){if(_.key===I){if(I=v.type,I===yo){if(_.tag===7){n(g,_.sibling),h=o(_,v.props.children),h.return=g,g=h;break e}}else if(_.elementType===I||typeof I=="object"&&I!==null&&I.$$typeof===rs&&pm(I)===_.type){n(g,_.sibling),h=o(_,v.props),h.ref=_i(g,_,v),h.return=g,g=h;break e}n(g,_);break}else t(g,_);_=_.sibling}v.type===yo?(h=Os(v.props.children,g.mode,x,v.key),h.return=g,g=h):(x=Ol(v.type,v.key,v.props,null,g.mode,x),x.ref=_i(g,h,v),x.return=g,g=x)}return a(g);case xo:e:{for(_=v.key;h!==null;){if(h.key===_)if(h.tag===4&&h.stateNode.containerInfo===v.containerInfo&&h.stateNode.implementation===v.implementation){n(g,h.sibling),h=o(h,v.children||[]),h.return=g,g=h;break e}else{n(g,h);break}else t(g,h);h=h.sibling}h=eu(v,g.mode,x),h.return=g,g=h}return a(g);case rs:return _=v._init,w(g,h,_(v._payload),x)}if(zi(v))return S(g,h,v,x);if(Ei(v))return E(g,h,v,x);ll(g,v)}return typeof v=="string"&&v!==""||typeof v=="number"?(v=""+v,h!==null&&h.tag===6?(n(g,h.sibling),h=o(h,v),h.return=g,g=h):(n(g,h),h=Zd(v,g.mode,x),h.return=g,g=h),a(g)):n(g,h)}return w}var Ho=vx(!0),Sx=vx(!1),oc=ws(null),ic=null,Co=null,Zp=null;function ef(){Zp=Co=ic=null}function tf(e){var t=oc.current;St(oc),e._currentValue=t}function ep(e,t,n){for(;e!==null;){var s=e.alternate;if((e.childLanes&t)!==t?(e.childLanes|=t,s!==null&&(s.childLanes|=t)):s!==null&&(s.childLanes&t)!==t&&(s.childLanes|=t),e===n)break;e=e.return}}function Lo(e,t){ic=e,Zp=Co=null,e=e.dependencies,e!==null&&e.firstContext!==null&&(e.lanes&t&&(kn=!0),e.firstContext=null)}function Xn(e){var t=e._currentValue;if(Zp!==e)if(e={context:e,memoizedValue:t,next:null},Co===null){if(ic===null)throw Error(me(308));Co=e,ic.dependencies={lanes:0,firstContext:e}}else Co=Co.next=e;return t}var Ls=null;function nf(e){Ls===null?Ls=[e]:Ls.push(e)}function wx(e,t,n,s){var o=t.interleaved;return o===null?(n.next=n,nf(t)):(n.next=o.next,o.next=n),t.interleaved=n,Gr(e,s)}function Gr(e,t){e.lanes|=t;var n=e.alternate;for(n!==null&&(n.lanes|=t),n=e,e=e.return;e!==null;)e.childLanes|=t,n=e.alternate,n!==null&&(n.childLanes|=t),n=e,e=e.return;return n.tag===3?n.stateNode:null}var ss=!1;function rf(e){e.updateQueue={baseState:e.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function kx(e,t){e=e.updateQueue,t.updateQueue===e&&(t.updateQueue={baseState:e.baseState,firstBaseUpdate:e.firstBaseUpdate,lastBaseUpdate:e.lastBaseUpdate,shared:e.shared,effects:e.effects})}function Hr(e,t){return{eventTime:e,lane:t,tag:0,payload:null,callback:null,next:null}}function ms(e,t,n){var s=e.updateQueue;if(s===null)return null;if(s=s.shared,ot&2){var o=s.pending;return o===null?t.next=t:(t.next=o.next,o.next=t),s.pending=t,Gr(e,n)}return o=s.interleaved,o===null?(t.next=t,nf(s)):(t.next=o.next,o.next=t),s.interleaved=t,Gr(e,n)}function Ml(e,t,n){if(t=t.updateQueue,t!==null&&(t=t.shared,(n&4194240)!==0)){var s=t.lanes;s&=e.pendingLanes,n|=s,t.lanes=n,Hp(e,n)}}function fm(e,t){var n=e.updateQueue,s=e.alternate;if(s!==null&&(s=s.updateQueue,n===s)){var o=null,i=null;if(n=n.firstBaseUpdate,n!==null){do{var a={eventTime:n.eventTime,lane:n.lane,tag:n.tag,payload:n.payload,callback:n.callback,next:null};i===null?o=i=a:i=i.next=a,n=n.next}while(n!==null);i===null?o=i=t:i=i.next=t}else o=i=t;n={baseState:s.baseState,firstBaseUpdate:o,lastBaseUpdate:i,shared:s.shared,effects:s.effects},e.updateQueue=n;return}e=n.lastBaseUpdate,e===null?n.firstBaseUpdate=t:e.next=t,n.lastBaseUpdate=t}function ac(e,t,n,s){var o=e.updateQueue;ss=!1;var i=o.firstBaseUpdate,a=o.lastBaseUpdate,l=o.shared.pending;if(l!==null){o.shared.pending=null;var d=l,u=d.next;d.next=null,a===null?i=u:a.next=u,a=d;var p=e.alternate;p!==null&&(p=p.updateQueue,l=p.lastBaseUpdate,l!==a&&(l===null?p.firstBaseUpdate=u:l.next=u,p.lastBaseUpdate=d))}if(i!==null){var c=o.baseState;a=0,p=u=d=null,l=i;do{var m=l.lane,y=l.eventTime;if((s&m)===m){p!==null&&(p=p.next={eventTime:y,lane:0,tag:l.tag,payload:l.payload,callback:l.callback,next:null});e:{var S=e,E=l;switch(m=t,y=n,E.tag){case 1:if(S=E.payload,typeof S=="function"){c=S.call(y,c,m);break e}c=S;break e;case 3:S.flags=S.flags&-65537|128;case 0:if(S=E.payload,m=typeof S=="function"?S.call(y,c,m):S,m==null)break e;c=_t({},c,m);break e;case 2:ss=!0}}l.callback!==null&&l.lane!==0&&(e.flags|=64,m=o.effects,m===null?o.effects=[l]:m.push(l))}else y={eventTime:y,lane:m,tag:l.tag,payload:l.payload,callback:l.callback,next:null},p===null?(u=p=y,d=c):p=p.next=y,a|=m;if(l=l.next,l===null){if(l=o.shared.pending,l===null)break;m=l,l=m.next,m.next=null,o.lastBaseUpdate=m,o.shared.pending=null}}while(!0);if(p===null&&(d=c),o.baseState=d,o.firstBaseUpdate=u,o.lastBaseUpdate=p,t=o.shared.interleaved,t!==null){o=t;do a|=o.lane,o=o.next;while(o!==t)}else i===null&&(o.shared.lanes=0);Us|=a,e.lanes=a,e.memoizedState=c}}function mm(e,t,n){if(e=t.effects,t.effects=null,e!==null)for(t=0;t<e.length;t++){var s=e[t],o=s.callback;if(o!==null){if(s.callback=null,s=n,typeof o!="function")throw Error(me(191,o));o.call(s)}}}var ja={},Cr=ws(ja),pa=ws(ja),fa=ws(ja);function $s(e){if(e===ja)throw Error(me(174));return e}function sf(e,t){switch(ht(fa,t),ht(pa,e),ht(Cr,ja),e=t.nodeType,e){case 9:case 11:t=(t=t.documentElement)?t.namespaceURI:Lu(null,"");break;default:e=e===8?t.parentNode:t,t=e.namespaceURI||null,e=e.tagName,t=Lu(t,e)}St(Cr),ht(Cr,t)}function Wo(){St(Cr),St(pa),St(fa)}function Ex(e){$s(fa.current);var t=$s(Cr.current),n=Lu(t,e.type);t!==n&&(ht(pa,e),ht(Cr,n))}function of(e){pa.current===e&&(St(Cr),St(pa))}var Tt=ws(0);function lc(e){for(var t=e;t!==null;){if(t.tag===13){var n=t.memoizedState;if(n!==null&&(n=n.dehydrated,n===null||n.data==="$?"||n.data==="$!"))return t}else if(t.tag===19&&t.memoizedProps.revealOrder!==void 0){if(t.flags&128)return t}else if(t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break;for(;t.sibling===null;){if(t.return===null||t.return===e)return null;t=t.return}t.sibling.return=t.return,t=t.sibling}return null}var Yd=[];function af(){for(var e=0;e<Yd.length;e++)Yd[e]._workInProgressVersionPrimary=null;Yd.length=0}var Al=qr.ReactCurrentDispatcher,qd=qr.ReactCurrentBatchConfig,Ws=0,It=null,$t=null,Ht=null,cc=!1,Qi=!1,ma=0,DS=0;function tn(){throw Error(me(321))}function lf(e,t){if(t===null)return!1;for(var n=0;n<t.length&&n<e.length;n++)if(!ar(e[n],t[n]))return!1;return!0}function cf(e,t,n,s,o,i){if(Ws=i,It=t,t.memoizedState=null,t.updateQueue=null,t.lanes=0,Al.current=e===null||e.memoizedState===null?US:GS,e=n(s,o),Qi){i=0;do{if(Qi=!1,ma=0,25<=i)throw Error(me(301));i+=1,Ht=$t=null,t.updateQueue=null,Al.current=VS,e=n(s,o)}while(Qi)}if(Al.current=dc,t=$t!==null&&$t.next!==null,Ws=0,Ht=$t=It=null,cc=!1,t)throw Error(me(300));return e}function df(){var e=ma!==0;return ma=0,e}function wr(){var e={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Ht===null?It.memoizedState=Ht=e:Ht=Ht.next=e,Ht}function Zn(){if($t===null){var e=It.alternate;e=e!==null?e.memoizedState:null}else e=$t.next;var t=Ht===null?It.memoizedState:Ht.next;if(t!==null)Ht=t,$t=e;else{if(e===null)throw Error(me(310));$t=e,e={memoizedState:$t.memoizedState,baseState:$t.baseState,baseQueue:$t.baseQueue,queue:$t.queue,next:null},Ht===null?It.memoizedState=Ht=e:Ht=Ht.next=e}return Ht}function ga(e,t){return typeof t=="function"?t(e):t}function Kd(e){var t=Zn(),n=t.queue;if(n===null)throw Error(me(311));n.lastRenderedReducer=e;var s=$t,o=s.baseQueue,i=n.pending;if(i!==null){if(o!==null){var a=o.next;o.next=i.next,i.next=a}s.baseQueue=o=i,n.pending=null}if(o!==null){i=o.next,s=s.baseState;var l=a=null,d=null,u=i;do{var p=u.lane;if((Ws&p)===p)d!==null&&(d=d.next={lane:0,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null}),s=u.hasEagerState?u.eagerState:e(s,u.action);else{var c={lane:p,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null};d===null?(l=d=c,a=s):d=d.next=c,It.lanes|=p,Us|=p}u=u.next}while(u!==null&&u!==i);d===null?a=s:d.next=l,ar(s,t.memoizedState)||(kn=!0),t.memoizedState=s,t.baseState=a,t.baseQueue=d,n.lastRenderedState=s}if(e=n.interleaved,e!==null){o=e;do i=o.lane,It.lanes|=i,Us|=i,o=o.next;while(o!==e)}else o===null&&(n.lanes=0);return[t.memoizedState,n.dispatch]}function Qd(e){var t=Zn(),n=t.queue;if(n===null)throw Error(me(311));n.lastRenderedReducer=e;var s=n.dispatch,o=n.pending,i=t.memoizedState;if(o!==null){n.pending=null;var a=o=o.next;do i=e(i,a.action),a=a.next;while(a!==o);ar(i,t.memoizedState)||(kn=!0),t.memoizedState=i,t.baseQueue===null&&(t.baseState=i),n.lastRenderedState=i}return[i,s]}function jx(){}function Cx(e,t){var n=It,s=Zn(),o=t(),i=!ar(s.memoizedState,o);if(i&&(s.memoizedState=o,kn=!0),s=s.queue,uf(_x.bind(null,n,s,e),[e]),s.getSnapshot!==t||i||Ht!==null&&Ht.memoizedState.tag&1){if(n.flags|=2048,ha(9,Ix.bind(null,n,s,o,t),void 0,null),Wt===null)throw Error(me(349));Ws&30||Tx(n,t,o)}return o}function Tx(e,t,n){e.flags|=16384,e={getSnapshot:t,value:n},t=It.updateQueue,t===null?(t={lastEffect:null,stores:null},It.updateQueue=t,t.stores=[e]):(n=t.stores,n===null?t.stores=[e]:n.push(e))}function Ix(e,t,n,s){t.value=n,t.getSnapshot=s,Rx(t)&&Mx(e)}function _x(e,t,n){return n(function(){Rx(t)&&Mx(e)})}function Rx(e){var t=e.getSnapshot;e=e.value;try{var n=t();return!ar(e,n)}catch{return!0}}function Mx(e){var t=Gr(e,1);t!==null&&ir(t,e,1,-1)}function gm(e){var t=wr();return typeof e=="function"&&(e=e()),t.memoizedState=t.baseState=e,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:ga,lastRenderedState:e},t.queue=e,e=e.dispatch=WS.bind(null,It,e),[t.memoizedState,e]}function ha(e,t,n,s){return e={tag:e,create:t,destroy:n,deps:s,next:null},t=It.updateQueue,t===null?(t={lastEffect:null,stores:null},It.updateQueue=t,t.lastEffect=e.next=e):(n=t.lastEffect,n===null?t.lastEffect=e.next=e:(s=n.next,n.next=e,e.next=s,t.lastEffect=e)),e}function Ax(){return Zn().memoizedState}function Nl(e,t,n,s){var o=wr();It.flags|=e,o.memoizedState=ha(1|t,n,void 0,s===void 0?null:s)}function $c(e,t,n,s){var o=Zn();s=s===void 0?null:s;var i=void 0;if($t!==null){var a=$t.memoizedState;if(i=a.destroy,s!==null&&lf(s,a.deps)){o.memoizedState=ha(t,n,i,s);return}}It.flags|=e,o.memoizedState=ha(1|t,n,i,s)}function hm(e,t){return Nl(8390656,8,e,t)}function uf(e,t){return $c(2048,8,e,t)}function Nx(e,t){return $c(4,2,e,t)}function Lx(e,t){return $c(4,4,e,t)}function $x(e,t){if(typeof t=="function")return e=e(),t(e),function(){t(null)};if(t!=null)return e=e(),t.current=e,function(){t.current=null}}function Bx(e,t,n){return n=n!=null?n.concat([e]):null,$c(4,4,$x.bind(null,t,e),n)}function pf(){}function Ox(e,t){var n=Zn();t=t===void 0?null:t;var s=n.memoizedState;return s!==null&&t!==null&&lf(t,s[1])?s[0]:(n.memoizedState=[e,t],e)}function Px(e,t){var n=Zn();t=t===void 0?null:t;var s=n.memoizedState;return s!==null&&t!==null&&lf(t,s[1])?s[0]:(e=e(),n.memoizedState=[e,t],e)}function zx(e,t,n){return Ws&21?(ar(n,t)||(n=Uh(),It.lanes|=n,Us|=n,e.baseState=!0),t):(e.baseState&&(e.baseState=!1,kn=!0),e.memoizedState=n)}function FS(e,t){var n=pt;pt=n!==0&&4>n?n:4,e(!0);var s=qd.transition;qd.transition={};try{e(!1),t()}finally{pt=n,qd.transition=s}}function Dx(){return Zn().memoizedState}function HS(e,t,n){var s=hs(e);if(n={lane:s,action:n,hasEagerState:!1,eagerState:null,next:null},Fx(e))Hx(t,n);else if(n=wx(e,t,n,s),n!==null){var o=fn();ir(n,e,s,o),Wx(n,t,s)}}function WS(e,t,n){var s=hs(e),o={lane:s,action:n,hasEagerState:!1,eagerState:null,next:null};if(Fx(e))Hx(t,o);else{var i=e.alternate;if(e.lanes===0&&(i===null||i.lanes===0)&&(i=t.lastRenderedReducer,i!==null))try{var a=t.lastRenderedState,l=i(a,n);if(o.hasEagerState=!0,o.eagerState=l,ar(l,a)){var d=t.interleaved;d===null?(o.next=o,nf(t)):(o.next=d.next,d.next=o),t.interleaved=o;return}}catch{}finally{}n=wx(e,t,o,s),n!==null&&(o=fn(),ir(n,e,s,o),Wx(n,t,s))}}function Fx(e){var t=e.alternate;return e===It||t!==null&&t===It}function Hx(e,t){Qi=cc=!0;var n=e.pending;n===null?t.next=t:(t.next=n.next,n.next=t),e.pending=t}function Wx(e,t,n){if(n&4194240){var s=t.lanes;s&=e.pendingLanes,n|=s,t.lanes=n,Hp(e,n)}}var dc={readContext:Xn,useCallback:tn,useContext:tn,useEffect:tn,useImperativeHandle:tn,useInsertionEffect:tn,useLayoutEffect:tn,useMemo:tn,useReducer:tn,useRef:tn,useState:tn,useDebugValue:tn,useDeferredValue:tn,useTransition:tn,useMutableSource:tn,useSyncExternalStore:tn,useId:tn,unstable_isNewReconciler:!1},US={readContext:Xn,useCallback:function(e,t){return wr().memoizedState=[e,t===void 0?null:t],e},useContext:Xn,useEffect:hm,useImperativeHandle:function(e,t,n){return n=n!=null?n.concat([e]):null,Nl(4194308,4,$x.bind(null,t,e),n)},useLayoutEffect:function(e,t){return Nl(4194308,4,e,t)},useInsertionEffect:function(e,t){return Nl(4,2,e,t)},useMemo:function(e,t){var n=wr();return t=t===void 0?null:t,e=e(),n.memoizedState=[e,t],e},useReducer:function(e,t,n){var s=wr();return t=n!==void 0?n(t):t,s.memoizedState=s.baseState=t,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:e,lastRenderedState:t},s.queue=e,e=e.dispatch=HS.bind(null,It,e),[s.memoizedState,e]},useRef:function(e){var t=wr();return e={current:e},t.memoizedState=e},useState:gm,useDebugValue:pf,useDeferredValue:function(e){return wr().memoizedState=e},useTransition:function(){var e=gm(!1),t=e[0];return e=FS.bind(null,e[1]),wr().memoizedState=e,[t,e]},useMutableSource:function(){},useSyncExternalStore:function(e,t,n){var s=It,o=wr();if(kt){if(n===void 0)throw Error(me(407));n=n()}else{if(n=t(),Wt===null)throw Error(me(349));Ws&30||Tx(s,t,n)}o.memoizedState=n;var i={value:n,getSnapshot:t};return o.queue=i,hm(_x.bind(null,s,i,e),[e]),s.flags|=2048,ha(9,Ix.bind(null,s,i,n,t),void 0,null),n},useId:function(){var e=wr(),t=Wt.identifierPrefix;if(kt){var n=Dr,s=zr;n=(s&~(1<<32-or(s)-1)).toString(32)+n,t=":"+t+"R"+n,n=ma++,0<n&&(t+="H"+n.toString(32)),t+=":"}else n=DS++,t=":"+t+"r"+n.toString(32)+":";return e.memoizedState=t},unstable_isNewReconciler:!1},GS={readContext:Xn,useCallback:Ox,useContext:Xn,useEffect:uf,useImperativeHandle:Bx,useInsertionEffect:Nx,useLayoutEffect:Lx,useMemo:Px,useReducer:Kd,useRef:Ax,useState:function(){return Kd(ga)},useDebugValue:pf,useDeferredValue:function(e){var t=Zn();return zx(t,$t.memoizedState,e)},useTransition:function(){var e=Kd(ga)[0],t=Zn().memoizedState;return[e,t]},useMutableSource:jx,useSyncExternalStore:Cx,useId:Dx,unstable_isNewReconciler:!1},VS={readContext:Xn,useCallback:Ox,useContext:Xn,useEffect:uf,useImperativeHandle:Bx,useInsertionEffect:Nx,useLayoutEffect:Lx,useMemo:Px,useReducer:Qd,useRef:Ax,useState:function(){return Qd(ga)},useDebugValue:pf,useDeferredValue:function(e){var t=Zn();return $t===null?t.memoizedState=e:zx(t,$t.memoizedState,e)},useTransition:function(){var e=Qd(ga)[0],t=Zn().memoizedState;return[e,t]},useMutableSource:jx,useSyncExternalStore:Cx,useId:Dx,unstable_isNewReconciler:!1};function nr(e,t){if(e&&e.defaultProps){t=_t({},t),e=e.defaultProps;for(var n in e)t[n]===void 0&&(t[n]=e[n]);return t}return t}function tp(e,t,n,s){t=e.memoizedState,n=n(s,t),n=n==null?t:_t({},t,n),e.memoizedState=n,e.lanes===0&&(e.updateQueue.baseState=n)}var Bc={isMounted:function(e){return(e=e._reactInternals)?Ks(e)===e:!1},enqueueSetState:function(e,t,n){e=e._reactInternals;var s=fn(),o=hs(e),i=Hr(s,o);i.payload=t,n!=null&&(i.callback=n),t=ms(e,i,o),t!==null&&(ir(t,e,o,s),Ml(t,e,o))},enqueueReplaceState:function(e,t,n){e=e._reactInternals;var s=fn(),o=hs(e),i=Hr(s,o);i.tag=1,i.payload=t,n!=null&&(i.callback=n),t=ms(e,i,o),t!==null&&(ir(t,e,o,s),Ml(t,e,o))},enqueueForceUpdate:function(e,t){e=e._reactInternals;var n=fn(),s=hs(e),o=Hr(n,s);o.tag=2,t!=null&&(o.callback=t),t=ms(e,o,s),t!==null&&(ir(t,e,s,n),Ml(t,e,s))}};function xm(e,t,n,s,o,i,a){return e=e.stateNode,typeof e.shouldComponentUpdate=="function"?e.shouldComponentUpdate(s,i,a):t.prototype&&t.prototype.isPureReactComponent?!la(n,s)||!la(o,i):!0}function Ux(e,t,n){var s=!1,o=vs,i=t.contextType;return typeof i=="object"&&i!==null?i=Xn(i):(o=jn(t)?Fs:an.current,s=t.contextTypes,i=(s=s!=null)?Do(e,o):vs),t=new t(n,i),e.memoizedState=t.state!==null&&t.state!==void 0?t.state:null,t.updater=Bc,e.stateNode=t,t._reactInternals=e,s&&(e=e.stateNode,e.__reactInternalMemoizedUnmaskedChildContext=o,e.__reactInternalMemoizedMaskedChildContext=i),t}function ym(e,t,n,s){e=t.state,typeof t.componentWillReceiveProps=="function"&&t.componentWillReceiveProps(n,s),typeof t.UNSAFE_componentWillReceiveProps=="function"&&t.UNSAFE_componentWillReceiveProps(n,s),t.state!==e&&Bc.enqueueReplaceState(t,t.state,null)}function np(e,t,n,s){var o=e.stateNode;o.props=n,o.state=e.memoizedState,o.refs={},rf(e);var i=t.contextType;typeof i=="object"&&i!==null?o.context=Xn(i):(i=jn(t)?Fs:an.current,o.context=Do(e,i)),o.state=e.memoizedState,i=t.getDerivedStateFromProps,typeof i=="function"&&(tp(e,t,i,n),o.state=e.memoizedState),typeof t.getDerivedStateFromProps=="function"||typeof o.getSnapshotBeforeUpdate=="function"||typeof o.UNSAFE_componentWillMount!="function"&&typeof o.componentWillMount!="function"||(t=o.state,typeof o.componentWillMount=="function"&&o.componentWillMount(),typeof o.UNSAFE_componentWillMount=="function"&&o.UNSAFE_componentWillMount(),t!==o.state&&Bc.enqueueReplaceState(o,o.state,null),ac(e,n,o,s),o.state=e.memoizedState),typeof o.componentDidMount=="function"&&(e.flags|=4194308)}function Uo(e,t){try{var n="",s=t;do n+=vv(s),s=s.return;while(s);var o=n}catch(i){o=`
Error generating stack: `+i.message+`
`+i.stack}return{value:e,source:t,stack:o,digest:null}}function Jd(e,t,n){return{value:e,source:null,stack:n??null,digest:t??null}}function rp(e,t){try{console.error(t.value)}catch(n){setTimeout(function(){throw n})}}var YS=typeof WeakMap=="function"?WeakMap:Map;function Gx(e,t,n){n=Hr(-1,n),n.tag=3,n.payload={element:null};var s=t.value;return n.callback=function(){pc||(pc=!0,fp=s),rp(e,t)},n}function Vx(e,t,n){n=Hr(-1,n),n.tag=3;var s=e.type.getDerivedStateFromError;if(typeof s=="function"){var o=t.value;n.payload=function(){return s(o)},n.callback=function(){rp(e,t)}}var i=e.stateNode;return i!==null&&typeof i.componentDidCatch=="function"&&(n.callback=function(){rp(e,t),typeof s!="function"&&(gs===null?gs=new Set([this]):gs.add(this));var a=t.stack;this.componentDidCatch(t.value,{componentStack:a!==null?a:""})}),n}function bm(e,t,n){var s=e.pingCache;if(s===null){s=e.pingCache=new YS;var o=new Set;s.set(t,o)}else o=s.get(t),o===void 0&&(o=new Set,s.set(t,o));o.has(n)||(o.add(n),e=a2.bind(null,e,t,n),t.then(e,e))}function vm(e){do{var t;if((t=e.tag===13)&&(t=e.memoizedState,t=t!==null?t.dehydrated!==null:!0),t)return e;e=e.return}while(e!==null);return null}function Sm(e,t,n,s,o){return e.mode&1?(e.flags|=65536,e.lanes=o,e):(e===t?e.flags|=65536:(e.flags|=128,n.flags|=131072,n.flags&=-52805,n.tag===1&&(n.alternate===null?n.tag=17:(t=Hr(-1,1),t.tag=2,ms(n,t,1))),n.lanes|=1),e)}var qS=qr.ReactCurrentOwner,kn=!1;function pn(e,t,n,s){t.child=e===null?Sx(t,null,n,s):Ho(t,e.child,n,s)}function wm(e,t,n,s,o){n=n.render;var i=t.ref;return Lo(t,o),s=cf(e,t,n,s,i,o),n=df(),e!==null&&!kn?(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~o,Vr(e,t,o)):(kt&&n&&Qp(t),t.flags|=1,pn(e,t,s,o),t.child)}function km(e,t,n,s,o){if(e===null){var i=n.type;return typeof i=="function"&&!vf(i)&&i.defaultProps===void 0&&n.compare===null&&n.defaultProps===void 0?(t.tag=15,t.type=i,Yx(e,t,i,s,o)):(e=Ol(n.type,null,s,t,t.mode,o),e.ref=t.ref,e.return=t,t.child=e)}if(i=e.child,!(e.lanes&o)){var a=i.memoizedProps;if(n=n.compare,n=n!==null?n:la,n(a,s)&&e.ref===t.ref)return Vr(e,t,o)}return t.flags|=1,e=xs(i,s),e.ref=t.ref,e.return=t,t.child=e}function Yx(e,t,n,s,o){if(e!==null){var i=e.memoizedProps;if(la(i,s)&&e.ref===t.ref)if(kn=!1,t.pendingProps=s=i,(e.lanes&o)!==0)e.flags&131072&&(kn=!0);else return t.lanes=e.lanes,Vr(e,t,o)}return sp(e,t,n,s,o)}function qx(e,t,n){var s=t.pendingProps,o=s.children,i=e!==null?e.memoizedState:null;if(s.mode==="hidden")if(!(t.mode&1))t.memoizedState={baseLanes:0,cachePool:null,transitions:null},ht(Io,Nn),Nn|=n;else{if(!(n&1073741824))return e=i!==null?i.baseLanes|n:n,t.lanes=t.childLanes=1073741824,t.memoizedState={baseLanes:e,cachePool:null,transitions:null},t.updateQueue=null,ht(Io,Nn),Nn|=e,null;t.memoizedState={baseLanes:0,cachePool:null,transitions:null},s=i!==null?i.baseLanes:n,ht(Io,Nn),Nn|=s}else i!==null?(s=i.baseLanes|n,t.memoizedState=null):s=n,ht(Io,Nn),Nn|=s;return pn(e,t,o,n),t.child}function Kx(e,t){var n=t.ref;(e===null&&n!==null||e!==null&&e.ref!==n)&&(t.flags|=512,t.flags|=2097152)}function sp(e,t,n,s,o){var i=jn(n)?Fs:an.current;return i=Do(t,i),Lo(t,o),n=cf(e,t,n,s,i,o),s=df(),e!==null&&!kn?(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~o,Vr(e,t,o)):(kt&&s&&Qp(t),t.flags|=1,pn(e,t,n,o),t.child)}function Em(e,t,n,s,o){if(jn(n)){var i=!0;nc(t)}else i=!1;if(Lo(t,o),t.stateNode===null)Ll(e,t),Ux(t,n,s),np(t,n,s,o),s=!0;else if(e===null){var a=t.stateNode,l=t.memoizedProps;a.props=l;var d=a.context,u=n.contextType;typeof u=="object"&&u!==null?u=Xn(u):(u=jn(n)?Fs:an.current,u=Do(t,u));var p=n.getDerivedStateFromProps,c=typeof p=="function"||typeof a.getSnapshotBeforeUpdate=="function";c||typeof a.UNSAFE_componentWillReceiveProps!="function"&&typeof a.componentWillReceiveProps!="function"||(l!==s||d!==u)&&ym(t,a,s,u),ss=!1;var m=t.memoizedState;a.state=m,ac(t,s,a,o),d=t.memoizedState,l!==s||m!==d||En.current||ss?(typeof p=="function"&&(tp(t,n,p,s),d=t.memoizedState),(l=ss||xm(t,n,l,s,m,d,u))?(c||typeof a.UNSAFE_componentWillMount!="function"&&typeof a.componentWillMount!="function"||(typeof a.componentWillMount=="function"&&a.componentWillMount(),typeof a.UNSAFE_componentWillMount=="function"&&a.UNSAFE_componentWillMount()),typeof a.componentDidMount=="function"&&(t.flags|=4194308)):(typeof a.componentDidMount=="function"&&(t.flags|=4194308),t.memoizedProps=s,t.memoizedState=d),a.props=s,a.state=d,a.context=u,s=l):(typeof a.componentDidMount=="function"&&(t.flags|=4194308),s=!1)}else{a=t.stateNode,kx(e,t),l=t.memoizedProps,u=t.type===t.elementType?l:nr(t.type,l),a.props=u,c=t.pendingProps,m=a.context,d=n.contextType,typeof d=="object"&&d!==null?d=Xn(d):(d=jn(n)?Fs:an.current,d=Do(t,d));var y=n.getDerivedStateFromProps;(p=typeof y=="function"||typeof a.getSnapshotBeforeUpdate=="function")||typeof a.UNSAFE_componentWillReceiveProps!="function"&&typeof a.componentWillReceiveProps!="function"||(l!==c||m!==d)&&ym(t,a,s,d),ss=!1,m=t.memoizedState,a.state=m,ac(t,s,a,o);var S=t.memoizedState;l!==c||m!==S||En.current||ss?(typeof y=="function"&&(tp(t,n,y,s),S=t.memoizedState),(u=ss||xm(t,n,u,s,m,S,d)||!1)?(p||typeof a.UNSAFE_componentWillUpdate!="function"&&typeof a.componentWillUpdate!="function"||(typeof a.componentWillUpdate=="function"&&a.componentWillUpdate(s,S,d),typeof a.UNSAFE_componentWillUpdate=="function"&&a.UNSAFE_componentWillUpdate(s,S,d)),typeof a.componentDidUpdate=="function"&&(t.flags|=4),typeof a.getSnapshotBeforeUpdate=="function"&&(t.flags|=1024)):(typeof a.componentDidUpdate!="function"||l===e.memoizedProps&&m===e.memoizedState||(t.flags|=4),typeof a.getSnapshotBeforeUpdate!="function"||l===e.memoizedProps&&m===e.memoizedState||(t.flags|=1024),t.memoizedProps=s,t.memoizedState=S),a.props=s,a.state=S,a.context=d,s=u):(typeof a.componentDidUpdate!="function"||l===e.memoizedProps&&m===e.memoizedState||(t.flags|=4),typeof a.getSnapshotBeforeUpdate!="function"||l===e.memoizedProps&&m===e.memoizedState||(t.flags|=1024),s=!1)}return op(e,t,n,s,i,o)}function op(e,t,n,s,o,i){Kx(e,t);var a=(t.flags&128)!==0;if(!s&&!a)return o&&cm(t,n,!1),Vr(e,t,i);s=t.stateNode,qS.current=t;var l=a&&typeof n.getDerivedStateFromError!="function"?null:s.render();return t.flags|=1,e!==null&&a?(t.child=Ho(t,e.child,null,i),t.child=Ho(t,null,l,i)):pn(e,t,l,i),t.memoizedState=s.state,o&&cm(t,n,!0),t.child}function Qx(e){var t=e.stateNode;t.pendingContext?lm(e,t.pendingContext,t.pendingContext!==t.context):t.context&&lm(e,t.context,!1),sf(e,t.containerInfo)}function jm(e,t,n,s,o){return Fo(),Xp(o),t.flags|=256,pn(e,t,n,s),t.child}var ip={dehydrated:null,treeContext:null,retryLane:0};function ap(e){return{baseLanes:e,cachePool:null,transitions:null}}function Jx(e,t,n){var s=t.pendingProps,o=Tt.current,i=!1,a=(t.flags&128)!==0,l;if((l=a)||(l=e!==null&&e.memoizedState===null?!1:(o&2)!==0),l?(i=!0,t.flags&=-129):(e===null||e.memoizedState!==null)&&(o|=1),ht(Tt,o&1),e===null)return Zu(t),e=t.memoizedState,e!==null&&(e=e.dehydrated,e!==null)?(t.mode&1?e.data==="$!"?t.lanes=8:t.lanes=1073741824:t.lanes=1,null):(a=s.children,e=s.fallback,i?(s=t.mode,i=t.child,a={mode:"hidden",children:a},!(s&1)&&i!==null?(i.childLanes=0,i.pendingProps=a):i=zc(a,s,0,null),e=Os(e,s,n,null),i.return=t,e.return=t,i.sibling=e,t.child=i,t.child.memoizedState=ap(n),t.memoizedState=ip,e):ff(t,a));if(o=e.memoizedState,o!==null&&(l=o.dehydrated,l!==null))return KS(e,t,a,s,l,o,n);if(i){i=s.fallback,a=t.mode,o=e.child,l=o.sibling;var d={mode:"hidden",children:s.children};return!(a&1)&&t.child!==o?(s=t.child,s.childLanes=0,s.pendingProps=d,t.deletions=null):(s=xs(o,d),s.subtreeFlags=o.subtreeFlags&14680064),l!==null?i=xs(l,i):(i=Os(i,a,n,null),i.flags|=2),i.return=t,s.return=t,s.sibling=i,t.child=s,s=i,i=t.child,a=e.child.memoizedState,a=a===null?ap(n):{baseLanes:a.baseLanes|n,cachePool:null,transitions:a.transitions},i.memoizedState=a,i.childLanes=e.childLanes&~n,t.memoizedState=ip,s}return i=e.child,e=i.sibling,s=xs(i,{mode:"visible",children:s.children}),!(t.mode&1)&&(s.lanes=n),s.return=t,s.sibling=null,e!==null&&(n=t.deletions,n===null?(t.deletions=[e],t.flags|=16):n.push(e)),t.child=s,t.memoizedState=null,s}function ff(e,t){return t=zc({mode:"visible",children:t},e.mode,0,null),t.return=e,e.child=t}function cl(e,t,n,s){return s!==null&&Xp(s),Ho(t,e.child,null,n),e=ff(t,t.pendingProps.children),e.flags|=2,t.memoizedState=null,e}function KS(e,t,n,s,o,i,a){if(n)return t.flags&256?(t.flags&=-257,s=Jd(Error(me(422))),cl(e,t,a,s)):t.memoizedState!==null?(t.child=e.child,t.flags|=128,null):(i=s.fallback,o=t.mode,s=zc({mode:"visible",children:s.children},o,0,null),i=Os(i,o,a,null),i.flags|=2,s.return=t,i.return=t,s.sibling=i,t.child=s,t.mode&1&&Ho(t,e.child,null,a),t.child.memoizedState=ap(a),t.memoizedState=ip,i);if(!(t.mode&1))return cl(e,t,a,null);if(o.data==="$!"){if(s=o.nextSibling&&o.nextSibling.dataset,s)var l=s.dgst;return s=l,i=Error(me(419)),s=Jd(i,s,void 0),cl(e,t,a,s)}if(l=(a&e.childLanes)!==0,kn||l){if(s=Wt,s!==null){switch(a&-a){case 4:o=2;break;case 16:o=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:o=32;break;case 536870912:o=268435456;break;default:o=0}o=o&(s.suspendedLanes|a)?0:o,o!==0&&o!==i.retryLane&&(i.retryLane=o,Gr(e,o),ir(s,e,o,-1))}return bf(),s=Jd(Error(me(421))),cl(e,t,a,s)}return o.data==="$?"?(t.flags|=128,t.child=e.child,t=l2.bind(null,e),o._reactRetry=t,null):(e=i.treeContext,Ln=fs(o.nextSibling),$n=t,kt=!0,sr=null,e!==null&&(Vn[Yn++]=zr,Vn[Yn++]=Dr,Vn[Yn++]=Hs,zr=e.id,Dr=e.overflow,Hs=t),t=ff(t,s.children),t.flags|=4096,t)}function Cm(e,t,n){e.lanes|=t;var s=e.alternate;s!==null&&(s.lanes|=t),ep(e.return,t,n)}function Xd(e,t,n,s,o){var i=e.memoizedState;i===null?e.memoizedState={isBackwards:t,rendering:null,renderingStartTime:0,last:s,tail:n,tailMode:o}:(i.isBackwards=t,i.rendering=null,i.renderingStartTime=0,i.last=s,i.tail=n,i.tailMode=o)}function Xx(e,t,n){var s=t.pendingProps,o=s.revealOrder,i=s.tail;if(pn(e,t,s.children,n),s=Tt.current,s&2)s=s&1|2,t.flags|=128;else{if(e!==null&&e.flags&128)e:for(e=t.child;e!==null;){if(e.tag===13)e.memoizedState!==null&&Cm(e,n,t);else if(e.tag===19)Cm(e,n,t);else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===t)break e;for(;e.sibling===null;){if(e.return===null||e.return===t)break e;e=e.return}e.sibling.return=e.return,e=e.sibling}s&=1}if(ht(Tt,s),!(t.mode&1))t.memoizedState=null;else switch(o){case"forwards":for(n=t.child,o=null;n!==null;)e=n.alternate,e!==null&&lc(e)===null&&(o=n),n=n.sibling;n=o,n===null?(o=t.child,t.child=null):(o=n.sibling,n.sibling=null),Xd(t,!1,o,n,i);break;case"backwards":for(n=null,o=t.child,t.child=null;o!==null;){if(e=o.alternate,e!==null&&lc(e)===null){t.child=o;break}e=o.sibling,o.sibling=n,n=o,o=e}Xd(t,!0,n,null,i);break;case"together":Xd(t,!1,null,null,void 0);break;default:t.memoizedState=null}return t.child}function Ll(e,t){!(t.mode&1)&&e!==null&&(e.alternate=null,t.alternate=null,t.flags|=2)}function Vr(e,t,n){if(e!==null&&(t.dependencies=e.dependencies),Us|=t.lanes,!(n&t.childLanes))return null;if(e!==null&&t.child!==e.child)throw Error(me(153));if(t.child!==null){for(e=t.child,n=xs(e,e.pendingProps),t.child=n,n.return=t;e.sibling!==null;)e=e.sibling,n=n.sibling=xs(e,e.pendingProps),n.return=t;n.sibling=null}return t.child}function QS(e,t,n){switch(t.tag){case 3:Qx(t),Fo();break;case 5:Ex(t);break;case 1:jn(t.type)&&nc(t);break;case 4:sf(t,t.stateNode.containerInfo);break;case 10:var s=t.type._context,o=t.memoizedProps.value;ht(oc,s._currentValue),s._currentValue=o;break;case 13:if(s=t.memoizedState,s!==null)return s.dehydrated!==null?(ht(Tt,Tt.current&1),t.flags|=128,null):n&t.child.childLanes?Jx(e,t,n):(ht(Tt,Tt.current&1),e=Vr(e,t,n),e!==null?e.sibling:null);ht(Tt,Tt.current&1);break;case 19:if(s=(n&t.childLanes)!==0,e.flags&128){if(s)return Xx(e,t,n);t.flags|=128}if(o=t.memoizedState,o!==null&&(o.rendering=null,o.tail=null,o.lastEffect=null),ht(Tt,Tt.current),s)break;return null;case 22:case 23:return t.lanes=0,qx(e,t,n)}return Vr(e,t,n)}var Zx,lp,ey,ty;Zx=function(e,t){for(var n=t.child;n!==null;){if(n.tag===5||n.tag===6)e.appendChild(n.stateNode);else if(n.tag!==4&&n.child!==null){n.child.return=n,n=n.child;continue}if(n===t)break;for(;n.sibling===null;){if(n.return===null||n.return===t)return;n=n.return}n.sibling.return=n.return,n=n.sibling}};lp=function(){};ey=function(e,t,n,s){var o=e.memoizedProps;if(o!==s){e=t.stateNode,$s(Cr.current);var i=null;switch(n){case"input":o=Ru(e,o),s=Ru(e,s),i=[];break;case"select":o=_t({},o,{value:void 0}),s=_t({},s,{value:void 0}),i=[];break;case"textarea":o=Nu(e,o),s=Nu(e,s),i=[];break;default:typeof o.onClick!="function"&&typeof s.onClick=="function"&&(e.onclick=ec)}$u(n,s);var a;n=null;for(u in o)if(!s.hasOwnProperty(u)&&o.hasOwnProperty(u)&&o[u]!=null)if(u==="style"){var l=o[u];for(a in l)l.hasOwnProperty(a)&&(n||(n={}),n[a]="")}else u!=="dangerouslySetInnerHTML"&&u!=="children"&&u!=="suppressContentEditableWarning"&&u!=="suppressHydrationWarning"&&u!=="autoFocus"&&(ta.hasOwnProperty(u)?i||(i=[]):(i=i||[]).push(u,null));for(u in s){var d=s[u];if(l=o!=null?o[u]:void 0,s.hasOwnProperty(u)&&d!==l&&(d!=null||l!=null))if(u==="style")if(l){for(a in l)!l.hasOwnProperty(a)||d&&d.hasOwnProperty(a)||(n||(n={}),n[a]="");for(a in d)d.hasOwnProperty(a)&&l[a]!==d[a]&&(n||(n={}),n[a]=d[a])}else n||(i||(i=[]),i.push(u,n)),n=d;else u==="dangerouslySetInnerHTML"?(d=d?d.__html:void 0,l=l?l.__html:void 0,d!=null&&l!==d&&(i=i||[]).push(u,d)):u==="children"?typeof d!="string"&&typeof d!="number"||(i=i||[]).push(u,""+d):u!=="suppressContentEditableWarning"&&u!=="suppressHydrationWarning"&&(ta.hasOwnProperty(u)?(d!=null&&u==="onScroll"&&vt("scroll",e),i||l===d||(i=[])):(i=i||[]).push(u,d))}n&&(i=i||[]).push("style",n);var u=i;(t.updateQueue=u)&&(t.flags|=4)}};ty=function(e,t,n,s){n!==s&&(t.flags|=4)};function Ri(e,t){if(!kt)switch(e.tailMode){case"hidden":t=e.tail;for(var n=null;t!==null;)t.alternate!==null&&(n=t),t=t.sibling;n===null?e.tail=null:n.sibling=null;break;case"collapsed":n=e.tail;for(var s=null;n!==null;)n.alternate!==null&&(s=n),n=n.sibling;s===null?t||e.tail===null?e.tail=null:e.tail.sibling=null:s.sibling=null}}function nn(e){var t=e.alternate!==null&&e.alternate.child===e.child,n=0,s=0;if(t)for(var o=e.child;o!==null;)n|=o.lanes|o.childLanes,s|=o.subtreeFlags&14680064,s|=o.flags&14680064,o.return=e,o=o.sibling;else for(o=e.child;o!==null;)n|=o.lanes|o.childLanes,s|=o.subtreeFlags,s|=o.flags,o.return=e,o=o.sibling;return e.subtreeFlags|=s,e.childLanes=n,t}function JS(e,t,n){var s=t.pendingProps;switch(Jp(t),t.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return nn(t),null;case 1:return jn(t.type)&&tc(),nn(t),null;case 3:return s=t.stateNode,Wo(),St(En),St(an),af(),s.pendingContext&&(s.context=s.pendingContext,s.pendingContext=null),(e===null||e.child===null)&&(al(t)?t.flags|=4:e===null||e.memoizedState.isDehydrated&&!(t.flags&256)||(t.flags|=1024,sr!==null&&(hp(sr),sr=null))),lp(e,t),nn(t),null;case 5:of(t);var o=$s(fa.current);if(n=t.type,e!==null&&t.stateNode!=null)ey(e,t,n,s,o),e.ref!==t.ref&&(t.flags|=512,t.flags|=2097152);else{if(!s){if(t.stateNode===null)throw Error(me(166));return nn(t),null}if(e=$s(Cr.current),al(t)){s=t.stateNode,n=t.type;var i=t.memoizedProps;switch(s[kr]=t,s[ua]=i,e=(t.mode&1)!==0,n){case"dialog":vt("cancel",s),vt("close",s);break;case"iframe":case"object":case"embed":vt("load",s);break;case"video":case"audio":for(o=0;o<Fi.length;o++)vt(Fi[o],s);break;case"source":vt("error",s);break;case"img":case"image":case"link":vt("error",s),vt("load",s);break;case"details":vt("toggle",s);break;case"input":$0(s,i),vt("invalid",s);break;case"select":s._wrapperState={wasMultiple:!!i.multiple},vt("invalid",s);break;case"textarea":O0(s,i),vt("invalid",s)}$u(n,i),o=null;for(var a in i)if(i.hasOwnProperty(a)){var l=i[a];a==="children"?typeof l=="string"?s.textContent!==l&&(i.suppressHydrationWarning!==!0&&il(s.textContent,l,e),o=["children",l]):typeof l=="number"&&s.textContent!==""+l&&(i.suppressHydrationWarning!==!0&&il(s.textContent,l,e),o=["children",""+l]):ta.hasOwnProperty(a)&&l!=null&&a==="onScroll"&&vt("scroll",s)}switch(n){case"input":Xa(s),B0(s,i,!0);break;case"textarea":Xa(s),P0(s);break;case"select":case"option":break;default:typeof i.onClick=="function"&&(s.onclick=ec)}s=o,t.updateQueue=s,s!==null&&(t.flags|=4)}else{a=o.nodeType===9?o:o.ownerDocument,e==="http://www.w3.org/1999/xhtml"&&(e=_h(n)),e==="http://www.w3.org/1999/xhtml"?n==="script"?(e=a.createElement("div"),e.innerHTML="<script><\/script>",e=e.removeChild(e.firstChild)):typeof s.is=="string"?e=a.createElement(n,{is:s.is}):(e=a.createElement(n),n==="select"&&(a=e,s.multiple?a.multiple=!0:s.size&&(a.size=s.size))):e=a.createElementNS(e,n),e[kr]=t,e[ua]=s,Zx(e,t,!1,!1),t.stateNode=e;e:{switch(a=Bu(n,s),n){case"dialog":vt("cancel",e),vt("close",e),o=s;break;case"iframe":case"object":case"embed":vt("load",e),o=s;break;case"video":case"audio":for(o=0;o<Fi.length;o++)vt(Fi[o],e);o=s;break;case"source":vt("error",e),o=s;break;case"img":case"image":case"link":vt("error",e),vt("load",e),o=s;break;case"details":vt("toggle",e),o=s;break;case"input":$0(e,s),o=Ru(e,s),vt("invalid",e);break;case"option":o=s;break;case"select":e._wrapperState={wasMultiple:!!s.multiple},o=_t({},s,{value:void 0}),vt("invalid",e);break;case"textarea":O0(e,s),o=Nu(e,s),vt("invalid",e);break;default:o=s}$u(n,o),l=o;for(i in l)if(l.hasOwnProperty(i)){var d=l[i];i==="style"?Ah(e,d):i==="dangerouslySetInnerHTML"?(d=d?d.__html:void 0,d!=null&&Rh(e,d)):i==="children"?typeof d=="string"?(n!=="textarea"||d!=="")&&na(e,d):typeof d=="number"&&na(e,""+d):i!=="suppressContentEditableWarning"&&i!=="suppressHydrationWarning"&&i!=="autoFocus"&&(ta.hasOwnProperty(i)?d!=null&&i==="onScroll"&&vt("scroll",e):d!=null&&Bp(e,i,d,a))}switch(n){case"input":Xa(e),B0(e,s,!1);break;case"textarea":Xa(e),P0(e);break;case"option":s.value!=null&&e.setAttribute("value",""+bs(s.value));break;case"select":e.multiple=!!s.multiple,i=s.value,i!=null?Ro(e,!!s.multiple,i,!1):s.defaultValue!=null&&Ro(e,!!s.multiple,s.defaultValue,!0);break;default:typeof o.onClick=="function"&&(e.onclick=ec)}switch(n){case"button":case"input":case"select":case"textarea":s=!!s.autoFocus;break e;case"img":s=!0;break e;default:s=!1}}s&&(t.flags|=4)}t.ref!==null&&(t.flags|=512,t.flags|=2097152)}return nn(t),null;case 6:if(e&&t.stateNode!=null)ty(e,t,e.memoizedProps,s);else{if(typeof s!="string"&&t.stateNode===null)throw Error(me(166));if(n=$s(fa.current),$s(Cr.current),al(t)){if(s=t.stateNode,n=t.memoizedProps,s[kr]=t,(i=s.nodeValue!==n)&&(e=$n,e!==null))switch(e.tag){case 3:il(s.nodeValue,n,(e.mode&1)!==0);break;case 5:e.memoizedProps.suppressHydrationWarning!==!0&&il(s.nodeValue,n,(e.mode&1)!==0)}i&&(t.flags|=4)}else s=(n.nodeType===9?n:n.ownerDocument).createTextNode(s),s[kr]=t,t.stateNode=s}return nn(t),null;case 13:if(St(Tt),s=t.memoizedState,e===null||e.memoizedState!==null&&e.memoizedState.dehydrated!==null){if(kt&&Ln!==null&&t.mode&1&&!(t.flags&128))bx(),Fo(),t.flags|=98560,i=!1;else if(i=al(t),s!==null&&s.dehydrated!==null){if(e===null){if(!i)throw Error(me(318));if(i=t.memoizedState,i=i!==null?i.dehydrated:null,!i)throw Error(me(317));i[kr]=t}else Fo(),!(t.flags&128)&&(t.memoizedState=null),t.flags|=4;nn(t),i=!1}else sr!==null&&(hp(sr),sr=null),i=!0;if(!i)return t.flags&65536?t:null}return t.flags&128?(t.lanes=n,t):(s=s!==null,s!==(e!==null&&e.memoizedState!==null)&&s&&(t.child.flags|=8192,t.mode&1&&(e===null||Tt.current&1?Ot===0&&(Ot=3):bf())),t.updateQueue!==null&&(t.flags|=4),nn(t),null);case 4:return Wo(),lp(e,t),e===null&&ca(t.stateNode.containerInfo),nn(t),null;case 10:return tf(t.type._context),nn(t),null;case 17:return jn(t.type)&&tc(),nn(t),null;case 19:if(St(Tt),i=t.memoizedState,i===null)return nn(t),null;if(s=(t.flags&128)!==0,a=i.rendering,a===null)if(s)Ri(i,!1);else{if(Ot!==0||e!==null&&e.flags&128)for(e=t.child;e!==null;){if(a=lc(e),a!==null){for(t.flags|=128,Ri(i,!1),s=a.updateQueue,s!==null&&(t.updateQueue=s,t.flags|=4),t.subtreeFlags=0,s=n,n=t.child;n!==null;)i=n,e=s,i.flags&=14680066,a=i.alternate,a===null?(i.childLanes=0,i.lanes=e,i.child=null,i.subtreeFlags=0,i.memoizedProps=null,i.memoizedState=null,i.updateQueue=null,i.dependencies=null,i.stateNode=null):(i.childLanes=a.childLanes,i.lanes=a.lanes,i.child=a.child,i.subtreeFlags=0,i.deletions=null,i.memoizedProps=a.memoizedProps,i.memoizedState=a.memoizedState,i.updateQueue=a.updateQueue,i.type=a.type,e=a.dependencies,i.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext}),n=n.sibling;return ht(Tt,Tt.current&1|2),t.child}e=e.sibling}i.tail!==null&&Nt()>Go&&(t.flags|=128,s=!0,Ri(i,!1),t.lanes=4194304)}else{if(!s)if(e=lc(a),e!==null){if(t.flags|=128,s=!0,n=e.updateQueue,n!==null&&(t.updateQueue=n,t.flags|=4),Ri(i,!0),i.tail===null&&i.tailMode==="hidden"&&!a.alternate&&!kt)return nn(t),null}else 2*Nt()-i.renderingStartTime>Go&&n!==1073741824&&(t.flags|=128,s=!0,Ri(i,!1),t.lanes=4194304);i.isBackwards?(a.sibling=t.child,t.child=a):(n=i.last,n!==null?n.sibling=a:t.child=a,i.last=a)}return i.tail!==null?(t=i.tail,i.rendering=t,i.tail=t.sibling,i.renderingStartTime=Nt(),t.sibling=null,n=Tt.current,ht(Tt,s?n&1|2:n&1),t):(nn(t),null);case 22:case 23:return yf(),s=t.memoizedState!==null,e!==null&&e.memoizedState!==null!==s&&(t.flags|=8192),s&&t.mode&1?Nn&1073741824&&(nn(t),t.subtreeFlags&6&&(t.flags|=8192)):nn(t),null;case 24:return null;case 25:return null}throw Error(me(156,t.tag))}function XS(e,t){switch(Jp(t),t.tag){case 1:return jn(t.type)&&tc(),e=t.flags,e&65536?(t.flags=e&-65537|128,t):null;case 3:return Wo(),St(En),St(an),af(),e=t.flags,e&65536&&!(e&128)?(t.flags=e&-65537|128,t):null;case 5:return of(t),null;case 13:if(St(Tt),e=t.memoizedState,e!==null&&e.dehydrated!==null){if(t.alternate===null)throw Error(me(340));Fo()}return e=t.flags,e&65536?(t.flags=e&-65537|128,t):null;case 19:return St(Tt),null;case 4:return Wo(),null;case 10:return tf(t.type._context),null;case 22:case 23:return yf(),null;case 24:return null;default:return null}}var dl=!1,on=!1,ZS=typeof WeakSet=="function"?WeakSet:Set,Ie=null;function To(e,t){var n=e.ref;if(n!==null)if(typeof n=="function")try{n(null)}catch(s){Mt(e,t,s)}else n.current=null}function cp(e,t,n){try{n()}catch(s){Mt(e,t,s)}}var Tm=!1;function e2(e,t){if(Vu=Jl,e=ix(),Kp(e)){if("selectionStart"in e)var n={start:e.selectionStart,end:e.selectionEnd};else e:{n=(n=e.ownerDocument)&&n.defaultView||window;var s=n.getSelection&&n.getSelection();if(s&&s.rangeCount!==0){n=s.anchorNode;var o=s.anchorOffset,i=s.focusNode;s=s.focusOffset;try{n.nodeType,i.nodeType}catch{n=null;break e}var a=0,l=-1,d=-1,u=0,p=0,c=e,m=null;t:for(;;){for(var y;c!==n||o!==0&&c.nodeType!==3||(l=a+o),c!==i||s!==0&&c.nodeType!==3||(d=a+s),c.nodeType===3&&(a+=c.nodeValue.length),(y=c.firstChild)!==null;)m=c,c=y;for(;;){if(c===e)break t;if(m===n&&++u===o&&(l=a),m===i&&++p===s&&(d=a),(y=c.nextSibling)!==null)break;c=m,m=c.parentNode}c=y}n=l===-1||d===-1?null:{start:l,end:d}}else n=null}n=n||{start:0,end:0}}else n=null;for(Yu={focusedElem:e,selectionRange:n},Jl=!1,Ie=t;Ie!==null;)if(t=Ie,e=t.child,(t.subtreeFlags&1028)!==0&&e!==null)e.return=t,Ie=e;else for(;Ie!==null;){t=Ie;try{var S=t.alternate;if(t.flags&1024)switch(t.tag){case 0:case 11:case 15:break;case 1:if(S!==null){var E=S.memoizedProps,w=S.memoizedState,g=t.stateNode,h=g.getSnapshotBeforeUpdate(t.elementType===t.type?E:nr(t.type,E),w);g.__reactInternalSnapshotBeforeUpdate=h}break;case 3:var v=t.stateNode.containerInfo;v.nodeType===1?v.textContent="":v.nodeType===9&&v.documentElement&&v.removeChild(v.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(me(163))}}catch(x){Mt(t,t.return,x)}if(e=t.sibling,e!==null){e.return=t.return,Ie=e;break}Ie=t.return}return S=Tm,Tm=!1,S}function Ji(e,t,n){var s=t.updateQueue;if(s=s!==null?s.lastEffect:null,s!==null){var o=s=s.next;do{if((o.tag&e)===e){var i=o.destroy;o.destroy=void 0,i!==void 0&&cp(t,n,i)}o=o.next}while(o!==s)}}function Oc(e,t){if(t=t.updateQueue,t=t!==null?t.lastEffect:null,t!==null){var n=t=t.next;do{if((n.tag&e)===e){var s=n.create;n.destroy=s()}n=n.next}while(n!==t)}}function dp(e){var t=e.ref;if(t!==null){var n=e.stateNode;switch(e.tag){case 5:e=n;break;default:e=n}typeof t=="function"?t(e):t.current=e}}function ny(e){var t=e.alternate;t!==null&&(e.alternate=null,ny(t)),e.child=null,e.deletions=null,e.sibling=null,e.tag===5&&(t=e.stateNode,t!==null&&(delete t[kr],delete t[ua],delete t[Qu],delete t[BS],delete t[OS])),e.stateNode=null,e.return=null,e.dependencies=null,e.memoizedProps=null,e.memoizedState=null,e.pendingProps=null,e.stateNode=null,e.updateQueue=null}function ry(e){return e.tag===5||e.tag===3||e.tag===4}function Im(e){e:for(;;){for(;e.sibling===null;){if(e.return===null||ry(e.return))return null;e=e.return}for(e.sibling.return=e.return,e=e.sibling;e.tag!==5&&e.tag!==6&&e.tag!==18;){if(e.flags&2||e.child===null||e.tag===4)continue e;e.child.return=e,e=e.child}if(!(e.flags&2))return e.stateNode}}function up(e,t,n){var s=e.tag;if(s===5||s===6)e=e.stateNode,t?n.nodeType===8?n.parentNode.insertBefore(e,t):n.insertBefore(e,t):(n.nodeType===8?(t=n.parentNode,t.insertBefore(e,n)):(t=n,t.appendChild(e)),n=n._reactRootContainer,n!=null||t.onclick!==null||(t.onclick=ec));else if(s!==4&&(e=e.child,e!==null))for(up(e,t,n),e=e.sibling;e!==null;)up(e,t,n),e=e.sibling}function pp(e,t,n){var s=e.tag;if(s===5||s===6)e=e.stateNode,t?n.insertBefore(e,t):n.appendChild(e);else if(s!==4&&(e=e.child,e!==null))for(pp(e,t,n),e=e.sibling;e!==null;)pp(e,t,n),e=e.sibling}var Kt=null,rr=!1;function Zr(e,t,n){for(n=n.child;n!==null;)sy(e,t,n),n=n.sibling}function sy(e,t,n){if(jr&&typeof jr.onCommitFiberUnmount=="function")try{jr.onCommitFiberUnmount(_c,n)}catch{}switch(n.tag){case 5:on||To(n,t);case 6:var s=Kt,o=rr;Kt=null,Zr(e,t,n),Kt=s,rr=o,Kt!==null&&(rr?(e=Kt,n=n.stateNode,e.nodeType===8?e.parentNode.removeChild(n):e.removeChild(n)):Kt.removeChild(n.stateNode));break;case 18:Kt!==null&&(rr?(e=Kt,n=n.stateNode,e.nodeType===8?Gd(e.parentNode,n):e.nodeType===1&&Gd(e,n),ia(e)):Gd(Kt,n.stateNode));break;case 4:s=Kt,o=rr,Kt=n.stateNode.containerInfo,rr=!0,Zr(e,t,n),Kt=s,rr=o;break;case 0:case 11:case 14:case 15:if(!on&&(s=n.updateQueue,s!==null&&(s=s.lastEffect,s!==null))){o=s=s.next;do{var i=o,a=i.destroy;i=i.tag,a!==void 0&&(i&2||i&4)&&cp(n,t,a),o=o.next}while(o!==s)}Zr(e,t,n);break;case 1:if(!on&&(To(n,t),s=n.stateNode,typeof s.componentWillUnmount=="function"))try{s.props=n.memoizedProps,s.state=n.memoizedState,s.componentWillUnmount()}catch(l){Mt(n,t,l)}Zr(e,t,n);break;case 21:Zr(e,t,n);break;case 22:n.mode&1?(on=(s=on)||n.memoizedState!==null,Zr(e,t,n),on=s):Zr(e,t,n);break;default:Zr(e,t,n)}}function _m(e){var t=e.updateQueue;if(t!==null){e.updateQueue=null;var n=e.stateNode;n===null&&(n=e.stateNode=new ZS),t.forEach(function(s){var o=c2.bind(null,e,s);n.has(s)||(n.add(s),s.then(o,o))})}}function er(e,t){var n=t.deletions;if(n!==null)for(var s=0;s<n.length;s++){var o=n[s];try{var i=e,a=t,l=a;e:for(;l!==null;){switch(l.tag){case 5:Kt=l.stateNode,rr=!1;break e;case 3:Kt=l.stateNode.containerInfo,rr=!0;break e;case 4:Kt=l.stateNode.containerInfo,rr=!0;break e}l=l.return}if(Kt===null)throw Error(me(160));sy(i,a,o),Kt=null,rr=!1;var d=o.alternate;d!==null&&(d.return=null),o.return=null}catch(u){Mt(o,t,u)}}if(t.subtreeFlags&12854)for(t=t.child;t!==null;)oy(t,e),t=t.sibling}function oy(e,t){var n=e.alternate,s=e.flags;switch(e.tag){case 0:case 11:case 14:case 15:if(er(t,e),hr(e),s&4){try{Ji(3,e,e.return),Oc(3,e)}catch(E){Mt(e,e.return,E)}try{Ji(5,e,e.return)}catch(E){Mt(e,e.return,E)}}break;case 1:er(t,e),hr(e),s&512&&n!==null&&To(n,n.return);break;case 5:if(er(t,e),hr(e),s&512&&n!==null&&To(n,n.return),e.flags&32){var o=e.stateNode;try{na(o,"")}catch(E){Mt(e,e.return,E)}}if(s&4&&(o=e.stateNode,o!=null)){var i=e.memoizedProps,a=n!==null?n.memoizedProps:i,l=e.type,d=e.updateQueue;if(e.updateQueue=null,d!==null)try{l==="input"&&i.type==="radio"&&i.name!=null&&Th(o,i),Bu(l,a);var u=Bu(l,i);for(a=0;a<d.length;a+=2){var p=d[a],c=d[a+1];p==="style"?Ah(o,c):p==="dangerouslySetInnerHTML"?Rh(o,c):p==="children"?na(o,c):Bp(o,p,c,u)}switch(l){case"input":Mu(o,i);break;case"textarea":Ih(o,i);break;case"select":var m=o._wrapperState.wasMultiple;o._wrapperState.wasMultiple=!!i.multiple;var y=i.value;y!=null?Ro(o,!!i.multiple,y,!1):m!==!!i.multiple&&(i.defaultValue!=null?Ro(o,!!i.multiple,i.defaultValue,!0):Ro(o,!!i.multiple,i.multiple?[]:"",!1))}o[ua]=i}catch(E){Mt(e,e.return,E)}}break;case 6:if(er(t,e),hr(e),s&4){if(e.stateNode===null)throw Error(me(162));o=e.stateNode,i=e.memoizedProps;try{o.nodeValue=i}catch(E){Mt(e,e.return,E)}}break;case 3:if(er(t,e),hr(e),s&4&&n!==null&&n.memoizedState.isDehydrated)try{ia(t.containerInfo)}catch(E){Mt(e,e.return,E)}break;case 4:er(t,e),hr(e);break;case 13:er(t,e),hr(e),o=e.child,o.flags&8192&&(i=o.memoizedState!==null,o.stateNode.isHidden=i,!i||o.alternate!==null&&o.alternate.memoizedState!==null||(hf=Nt())),s&4&&_m(e);break;case 22:if(p=n!==null&&n.memoizedState!==null,e.mode&1?(on=(u=on)||p,er(t,e),on=u):er(t,e),hr(e),s&8192){if(u=e.memoizedState!==null,(e.stateNode.isHidden=u)&&!p&&e.mode&1)for(Ie=e,p=e.child;p!==null;){for(c=Ie=p;Ie!==null;){switch(m=Ie,y=m.child,m.tag){case 0:case 11:case 14:case 15:Ji(4,m,m.return);break;case 1:To(m,m.return);var S=m.stateNode;if(typeof S.componentWillUnmount=="function"){s=m,n=m.return;try{t=s,S.props=t.memoizedProps,S.state=t.memoizedState,S.componentWillUnmount()}catch(E){Mt(s,n,E)}}break;case 5:To(m,m.return);break;case 22:if(m.memoizedState!==null){Mm(c);continue}}y!==null?(y.return=m,Ie=y):Mm(c)}p=p.sibling}e:for(p=null,c=e;;){if(c.tag===5){if(p===null){p=c;try{o=c.stateNode,u?(i=o.style,typeof i.setProperty=="function"?i.setProperty("display","none","important"):i.display="none"):(l=c.stateNode,d=c.memoizedProps.style,a=d!=null&&d.hasOwnProperty("display")?d.display:null,l.style.display=Mh("display",a))}catch(E){Mt(e,e.return,E)}}}else if(c.tag===6){if(p===null)try{c.stateNode.nodeValue=u?"":c.memoizedProps}catch(E){Mt(e,e.return,E)}}else if((c.tag!==22&&c.tag!==23||c.memoizedState===null||c===e)&&c.child!==null){c.child.return=c,c=c.child;continue}if(c===e)break e;for(;c.sibling===null;){if(c.return===null||c.return===e)break e;p===c&&(p=null),c=c.return}p===c&&(p=null),c.sibling.return=c.return,c=c.sibling}}break;case 19:er(t,e),hr(e),s&4&&_m(e);break;case 21:break;default:er(t,e),hr(e)}}function hr(e){var t=e.flags;if(t&2){try{e:{for(var n=e.return;n!==null;){if(ry(n)){var s=n;break e}n=n.return}throw Error(me(160))}switch(s.tag){case 5:var o=s.stateNode;s.flags&32&&(na(o,""),s.flags&=-33);var i=Im(e);pp(e,i,o);break;case 3:case 4:var a=s.stateNode.containerInfo,l=Im(e);up(e,l,a);break;default:throw Error(me(161))}}catch(d){Mt(e,e.return,d)}e.flags&=-3}t&4096&&(e.flags&=-4097)}function t2(e,t,n){Ie=e,iy(e)}function iy(e,t,n){for(var s=(e.mode&1)!==0;Ie!==null;){var o=Ie,i=o.child;if(o.tag===22&&s){var a=o.memoizedState!==null||dl;if(!a){var l=o.alternate,d=l!==null&&l.memoizedState!==null||on;l=dl;var u=on;if(dl=a,(on=d)&&!u)for(Ie=o;Ie!==null;)a=Ie,d=a.child,a.tag===22&&a.memoizedState!==null?Am(o):d!==null?(d.return=a,Ie=d):Am(o);for(;i!==null;)Ie=i,iy(i),i=i.sibling;Ie=o,dl=l,on=u}Rm(e)}else o.subtreeFlags&8772&&i!==null?(i.return=o,Ie=i):Rm(e)}}function Rm(e){for(;Ie!==null;){var t=Ie;if(t.flags&8772){var n=t.alternate;try{if(t.flags&8772)switch(t.tag){case 0:case 11:case 15:on||Oc(5,t);break;case 1:var s=t.stateNode;if(t.flags&4&&!on)if(n===null)s.componentDidMount();else{var o=t.elementType===t.type?n.memoizedProps:nr(t.type,n.memoizedProps);s.componentDidUpdate(o,n.memoizedState,s.__reactInternalSnapshotBeforeUpdate)}var i=t.updateQueue;i!==null&&mm(t,i,s);break;case 3:var a=t.updateQueue;if(a!==null){if(n=null,t.child!==null)switch(t.child.tag){case 5:n=t.child.stateNode;break;case 1:n=t.child.stateNode}mm(t,a,n)}break;case 5:var l=t.stateNode;if(n===null&&t.flags&4){n=l;var d=t.memoizedProps;switch(t.type){case"button":case"input":case"select":case"textarea":d.autoFocus&&n.focus();break;case"img":d.src&&(n.src=d.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(t.memoizedState===null){var u=t.alternate;if(u!==null){var p=u.memoizedState;if(p!==null){var c=p.dehydrated;c!==null&&ia(c)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(me(163))}on||t.flags&512&&dp(t)}catch(m){Mt(t,t.return,m)}}if(t===e){Ie=null;break}if(n=t.sibling,n!==null){n.return=t.return,Ie=n;break}Ie=t.return}}function Mm(e){for(;Ie!==null;){var t=Ie;if(t===e){Ie=null;break}var n=t.sibling;if(n!==null){n.return=t.return,Ie=n;break}Ie=t.return}}function Am(e){for(;Ie!==null;){var t=Ie;try{switch(t.tag){case 0:case 11:case 15:var n=t.return;try{Oc(4,t)}catch(d){Mt(t,n,d)}break;case 1:var s=t.stateNode;if(typeof s.componentDidMount=="function"){var o=t.return;try{s.componentDidMount()}catch(d){Mt(t,o,d)}}var i=t.return;try{dp(t)}catch(d){Mt(t,i,d)}break;case 5:var a=t.return;try{dp(t)}catch(d){Mt(t,a,d)}}}catch(d){Mt(t,t.return,d)}if(t===e){Ie=null;break}var l=t.sibling;if(l!==null){l.return=t.return,Ie=l;break}Ie=t.return}}var n2=Math.ceil,uc=qr.ReactCurrentDispatcher,mf=qr.ReactCurrentOwner,Qn=qr.ReactCurrentBatchConfig,ot=0,Wt=null,Lt=null,Jt=0,Nn=0,Io=ws(0),Ot=0,xa=null,Us=0,Pc=0,gf=0,Xi=null,wn=null,hf=0,Go=1/0,Or=null,pc=!1,fp=null,gs=null,ul=!1,cs=null,fc=0,Zi=0,mp=null,$l=-1,Bl=0;function fn(){return ot&6?Nt():$l!==-1?$l:$l=Nt()}function hs(e){return e.mode&1?ot&2&&Jt!==0?Jt&-Jt:zS.transition!==null?(Bl===0&&(Bl=Uh()),Bl):(e=pt,e!==0||(e=window.event,e=e===void 0?16:Jh(e.type)),e):1}function ir(e,t,n,s){if(50<Zi)throw Zi=0,mp=null,Error(me(185));wa(e,n,s),(!(ot&2)||e!==Wt)&&(e===Wt&&(!(ot&2)&&(Pc|=n),Ot===4&&as(e,Jt)),Cn(e,s),n===1&&ot===0&&!(t.mode&1)&&(Go=Nt()+500,Lc&&ks()))}function Cn(e,t){var n=e.callbackNode;zv(e,t);var s=Ql(e,e===Wt?Jt:0);if(s===0)n!==null&&F0(n),e.callbackNode=null,e.callbackPriority=0;else if(t=s&-s,e.callbackPriority!==t){if(n!=null&&F0(n),t===1)e.tag===0?PS(Nm.bind(null,e)):hx(Nm.bind(null,e)),LS(function(){!(ot&6)&&ks()}),n=null;else{switch(Gh(s)){case 1:n=Fp;break;case 4:n=Hh;break;case 16:n=Kl;break;case 536870912:n=Wh;break;default:n=Kl}n=my(n,ay.bind(null,e))}e.callbackPriority=t,e.callbackNode=n}}function ay(e,t){if($l=-1,Bl=0,ot&6)throw Error(me(327));var n=e.callbackNode;if($o()&&e.callbackNode!==n)return null;var s=Ql(e,e===Wt?Jt:0);if(s===0)return null;if(s&30||s&e.expiredLanes||t)t=mc(e,s);else{t=s;var o=ot;ot|=2;var i=cy();(Wt!==e||Jt!==t)&&(Or=null,Go=Nt()+500,Bs(e,t));do try{o2();break}catch(l){ly(e,l)}while(!0);ef(),uc.current=i,ot=o,Lt!==null?t=0:(Wt=null,Jt=0,t=Ot)}if(t!==0){if(t===2&&(o=Fu(e),o!==0&&(s=o,t=gp(e,o))),t===1)throw n=xa,Bs(e,0),as(e,s),Cn(e,Nt()),n;if(t===6)as(e,s);else{if(o=e.current.alternate,!(s&30)&&!r2(o)&&(t=mc(e,s),t===2&&(i=Fu(e),i!==0&&(s=i,t=gp(e,i))),t===1))throw n=xa,Bs(e,0),as(e,s),Cn(e,Nt()),n;switch(e.finishedWork=o,e.finishedLanes=s,t){case 0:case 1:throw Error(me(345));case 2:As(e,wn,Or);break;case 3:if(as(e,s),(s&130023424)===s&&(t=hf+500-Nt(),10<t)){if(Ql(e,0)!==0)break;if(o=e.suspendedLanes,(o&s)!==s){fn(),e.pingedLanes|=e.suspendedLanes&o;break}e.timeoutHandle=Ku(As.bind(null,e,wn,Or),t);break}As(e,wn,Or);break;case 4:if(as(e,s),(s&4194240)===s)break;for(t=e.eventTimes,o=-1;0<s;){var a=31-or(s);i=1<<a,a=t[a],a>o&&(o=a),s&=~i}if(s=o,s=Nt()-s,s=(120>s?120:480>s?480:1080>s?1080:1920>s?1920:3e3>s?3e3:4320>s?4320:1960*n2(s/1960))-s,10<s){e.timeoutHandle=Ku(As.bind(null,e,wn,Or),s);break}As(e,wn,Or);break;case 5:As(e,wn,Or);break;default:throw Error(me(329))}}}return Cn(e,Nt()),e.callbackNode===n?ay.bind(null,e):null}function gp(e,t){var n=Xi;return e.current.memoizedState.isDehydrated&&(Bs(e,t).flags|=256),e=mc(e,t),e!==2&&(t=wn,wn=n,t!==null&&hp(t)),e}function hp(e){wn===null?wn=e:wn.push.apply(wn,e)}function r2(e){for(var t=e;;){if(t.flags&16384){var n=t.updateQueue;if(n!==null&&(n=n.stores,n!==null))for(var s=0;s<n.length;s++){var o=n[s],i=o.getSnapshot;o=o.value;try{if(!ar(i(),o))return!1}catch{return!1}}}if(n=t.child,t.subtreeFlags&16384&&n!==null)n.return=t,t=n;else{if(t===e)break;for(;t.sibling===null;){if(t.return===null||t.return===e)return!0;t=t.return}t.sibling.return=t.return,t=t.sibling}}return!0}function as(e,t){for(t&=~gf,t&=~Pc,e.suspendedLanes|=t,e.pingedLanes&=~t,e=e.expirationTimes;0<t;){var n=31-or(t),s=1<<n;e[n]=-1,t&=~s}}function Nm(e){if(ot&6)throw Error(me(327));$o();var t=Ql(e,0);if(!(t&1))return Cn(e,Nt()),null;var n=mc(e,t);if(e.tag!==0&&n===2){var s=Fu(e);s!==0&&(t=s,n=gp(e,s))}if(n===1)throw n=xa,Bs(e,0),as(e,t),Cn(e,Nt()),n;if(n===6)throw Error(me(345));return e.finishedWork=e.current.alternate,e.finishedLanes=t,As(e,wn,Or),Cn(e,Nt()),null}function xf(e,t){var n=ot;ot|=1;try{return e(t)}finally{ot=n,ot===0&&(Go=Nt()+500,Lc&&ks())}}function Gs(e){cs!==null&&cs.tag===0&&!(ot&6)&&$o();var t=ot;ot|=1;var n=Qn.transition,s=pt;try{if(Qn.transition=null,pt=1,e)return e()}finally{pt=s,Qn.transition=n,ot=t,!(ot&6)&&ks()}}function yf(){Nn=Io.current,St(Io)}function Bs(e,t){e.finishedWork=null,e.finishedLanes=0;var n=e.timeoutHandle;if(n!==-1&&(e.timeoutHandle=-1,NS(n)),Lt!==null)for(n=Lt.return;n!==null;){var s=n;switch(Jp(s),s.tag){case 1:s=s.type.childContextTypes,s!=null&&tc();break;case 3:Wo(),St(En),St(an),af();break;case 5:of(s);break;case 4:Wo();break;case 13:St(Tt);break;case 19:St(Tt);break;case 10:tf(s.type._context);break;case 22:case 23:yf()}n=n.return}if(Wt=e,Lt=e=xs(e.current,null),Jt=Nn=t,Ot=0,xa=null,gf=Pc=Us=0,wn=Xi=null,Ls!==null){for(t=0;t<Ls.length;t++)if(n=Ls[t],s=n.interleaved,s!==null){n.interleaved=null;var o=s.next,i=n.pending;if(i!==null){var a=i.next;i.next=o,s.next=a}n.pending=s}Ls=null}return e}function ly(e,t){do{var n=Lt;try{if(ef(),Al.current=dc,cc){for(var s=It.memoizedState;s!==null;){var o=s.queue;o!==null&&(o.pending=null),s=s.next}cc=!1}if(Ws=0,Ht=$t=It=null,Qi=!1,ma=0,mf.current=null,n===null||n.return===null){Ot=1,xa=t,Lt=null;break}e:{var i=e,a=n.return,l=n,d=t;if(t=Jt,l.flags|=32768,d!==null&&typeof d=="object"&&typeof d.then=="function"){var u=d,p=l,c=p.tag;if(!(p.mode&1)&&(c===0||c===11||c===15)){var m=p.alternate;m?(p.updateQueue=m.updateQueue,p.memoizedState=m.memoizedState,p.lanes=m.lanes):(p.updateQueue=null,p.memoizedState=null)}var y=vm(a);if(y!==null){y.flags&=-257,Sm(y,a,l,i,t),y.mode&1&&bm(i,u,t),t=y,d=u;var S=t.updateQueue;if(S===null){var E=new Set;E.add(d),t.updateQueue=E}else S.add(d);break e}else{if(!(t&1)){bm(i,u,t),bf();break e}d=Error(me(426))}}else if(kt&&l.mode&1){var w=vm(a);if(w!==null){!(w.flags&65536)&&(w.flags|=256),Sm(w,a,l,i,t),Xp(Uo(d,l));break e}}i=d=Uo(d,l),Ot!==4&&(Ot=2),Xi===null?Xi=[i]:Xi.push(i),i=a;do{switch(i.tag){case 3:i.flags|=65536,t&=-t,i.lanes|=t;var g=Gx(i,d,t);fm(i,g);break e;case 1:l=d;var h=i.type,v=i.stateNode;if(!(i.flags&128)&&(typeof h.getDerivedStateFromError=="function"||v!==null&&typeof v.componentDidCatch=="function"&&(gs===null||!gs.has(v)))){i.flags|=65536,t&=-t,i.lanes|=t;var x=Vx(i,l,t);fm(i,x);break e}}i=i.return}while(i!==null)}uy(n)}catch(I){t=I,Lt===n&&n!==null&&(Lt=n=n.return);continue}break}while(!0)}function cy(){var e=uc.current;return uc.current=dc,e===null?dc:e}function bf(){(Ot===0||Ot===3||Ot===2)&&(Ot=4),Wt===null||!(Us&268435455)&&!(Pc&268435455)||as(Wt,Jt)}function mc(e,t){var n=ot;ot|=2;var s=cy();(Wt!==e||Jt!==t)&&(Or=null,Bs(e,t));do try{s2();break}catch(o){ly(e,o)}while(!0);if(ef(),ot=n,uc.current=s,Lt!==null)throw Error(me(261));return Wt=null,Jt=0,Ot}function s2(){for(;Lt!==null;)dy(Lt)}function o2(){for(;Lt!==null&&!Rv();)dy(Lt)}function dy(e){var t=fy(e.alternate,e,Nn);e.memoizedProps=e.pendingProps,t===null?uy(e):Lt=t,mf.current=null}function uy(e){var t=e;do{var n=t.alternate;if(e=t.return,t.flags&32768){if(n=XS(n,t),n!==null){n.flags&=32767,Lt=n;return}if(e!==null)e.flags|=32768,e.subtreeFlags=0,e.deletions=null;else{Ot=6,Lt=null;return}}else if(n=JS(n,t,Nn),n!==null){Lt=n;return}if(t=t.sibling,t!==null){Lt=t;return}Lt=t=e}while(t!==null);Ot===0&&(Ot=5)}function As(e,t,n){var s=pt,o=Qn.transition;try{Qn.transition=null,pt=1,i2(e,t,n,s)}finally{Qn.transition=o,pt=s}return null}function i2(e,t,n,s){do $o();while(cs!==null);if(ot&6)throw Error(me(327));n=e.finishedWork;var o=e.finishedLanes;if(n===null)return null;if(e.finishedWork=null,e.finishedLanes=0,n===e.current)throw Error(me(177));e.callbackNode=null,e.callbackPriority=0;var i=n.lanes|n.childLanes;if(Dv(e,i),e===Wt&&(Lt=Wt=null,Jt=0),!(n.subtreeFlags&2064)&&!(n.flags&2064)||ul||(ul=!0,my(Kl,function(){return $o(),null})),i=(n.flags&15990)!==0,n.subtreeFlags&15990||i){i=Qn.transition,Qn.transition=null;var a=pt;pt=1;var l=ot;ot|=4,mf.current=null,e2(e,n),oy(n,e),CS(Yu),Jl=!!Vu,Yu=Vu=null,e.current=n,t2(n),Mv(),ot=l,pt=a,Qn.transition=i}else e.current=n;if(ul&&(ul=!1,cs=e,fc=o),i=e.pendingLanes,i===0&&(gs=null),Lv(n.stateNode),Cn(e,Nt()),t!==null)for(s=e.onRecoverableError,n=0;n<t.length;n++)o=t[n],s(o.value,{componentStack:o.stack,digest:o.digest});if(pc)throw pc=!1,e=fp,fp=null,e;return fc&1&&e.tag!==0&&$o(),i=e.pendingLanes,i&1?e===mp?Zi++:(Zi=0,mp=e):Zi=0,ks(),null}function $o(){if(cs!==null){var e=Gh(fc),t=Qn.transition,n=pt;try{if(Qn.transition=null,pt=16>e?16:e,cs===null)var s=!1;else{if(e=cs,cs=null,fc=0,ot&6)throw Error(me(331));var o=ot;for(ot|=4,Ie=e.current;Ie!==null;){var i=Ie,a=i.child;if(Ie.flags&16){var l=i.deletions;if(l!==null){for(var d=0;d<l.length;d++){var u=l[d];for(Ie=u;Ie!==null;){var p=Ie;switch(p.tag){case 0:case 11:case 15:Ji(8,p,i)}var c=p.child;if(c!==null)c.return=p,Ie=c;else for(;Ie!==null;){p=Ie;var m=p.sibling,y=p.return;if(ny(p),p===u){Ie=null;break}if(m!==null){m.return=y,Ie=m;break}Ie=y}}}var S=i.alternate;if(S!==null){var E=S.child;if(E!==null){S.child=null;do{var w=E.sibling;E.sibling=null,E=w}while(E!==null)}}Ie=i}}if(i.subtreeFlags&2064&&a!==null)a.return=i,Ie=a;else e:for(;Ie!==null;){if(i=Ie,i.flags&2048)switch(i.tag){case 0:case 11:case 15:Ji(9,i,i.return)}var g=i.sibling;if(g!==null){g.return=i.return,Ie=g;break e}Ie=i.return}}var h=e.current;for(Ie=h;Ie!==null;){a=Ie;var v=a.child;if(a.subtreeFlags&2064&&v!==null)v.return=a,Ie=v;else e:for(a=h;Ie!==null;){if(l=Ie,l.flags&2048)try{switch(l.tag){case 0:case 11:case 15:Oc(9,l)}}catch(I){Mt(l,l.return,I)}if(l===a){Ie=null;break e}var x=l.sibling;if(x!==null){x.return=l.return,Ie=x;break e}Ie=l.return}}if(ot=o,ks(),jr&&typeof jr.onPostCommitFiberRoot=="function")try{jr.onPostCommitFiberRoot(_c,e)}catch{}s=!0}return s}finally{pt=n,Qn.transition=t}}return!1}function Lm(e,t,n){t=Uo(n,t),t=Gx(e,t,1),e=ms(e,t,1),t=fn(),e!==null&&(wa(e,1,t),Cn(e,t))}function Mt(e,t,n){if(e.tag===3)Lm(e,e,n);else for(;t!==null;){if(t.tag===3){Lm(t,e,n);break}else if(t.tag===1){var s=t.stateNode;if(typeof t.type.getDerivedStateFromError=="function"||typeof s.componentDidCatch=="function"&&(gs===null||!gs.has(s))){e=Uo(n,e),e=Vx(t,e,1),t=ms(t,e,1),e=fn(),t!==null&&(wa(t,1,e),Cn(t,e));break}}t=t.return}}function a2(e,t,n){var s=e.pingCache;s!==null&&s.delete(t),t=fn(),e.pingedLanes|=e.suspendedLanes&n,Wt===e&&(Jt&n)===n&&(Ot===4||Ot===3&&(Jt&130023424)===Jt&&500>Nt()-hf?Bs(e,0):gf|=n),Cn(e,t)}function py(e,t){t===0&&(e.mode&1?(t=tl,tl<<=1,!(tl&130023424)&&(tl=4194304)):t=1);var n=fn();e=Gr(e,t),e!==null&&(wa(e,t,n),Cn(e,n))}function l2(e){var t=e.memoizedState,n=0;t!==null&&(n=t.retryLane),py(e,n)}function c2(e,t){var n=0;switch(e.tag){case 13:var s=e.stateNode,o=e.memoizedState;o!==null&&(n=o.retryLane);break;case 19:s=e.stateNode;break;default:throw Error(me(314))}s!==null&&s.delete(t),py(e,n)}var fy;fy=function(e,t,n){if(e!==null)if(e.memoizedProps!==t.pendingProps||En.current)kn=!0;else{if(!(e.lanes&n)&&!(t.flags&128))return kn=!1,QS(e,t,n);kn=!!(e.flags&131072)}else kn=!1,kt&&t.flags&1048576&&xx(t,sc,t.index);switch(t.lanes=0,t.tag){case 2:var s=t.type;Ll(e,t),e=t.pendingProps;var o=Do(t,an.current);Lo(t,n),o=cf(null,t,s,e,o,n);var i=df();return t.flags|=1,typeof o=="object"&&o!==null&&typeof o.render=="function"&&o.$$typeof===void 0?(t.tag=1,t.memoizedState=null,t.updateQueue=null,jn(s)?(i=!0,nc(t)):i=!1,t.memoizedState=o.state!==null&&o.state!==void 0?o.state:null,rf(t),o.updater=Bc,t.stateNode=o,o._reactInternals=t,np(t,s,e,n),t=op(null,t,s,!0,i,n)):(t.tag=0,kt&&i&&Qp(t),pn(null,t,o,n),t=t.child),t;case 16:s=t.elementType;e:{switch(Ll(e,t),e=t.pendingProps,o=s._init,s=o(s._payload),t.type=s,o=t.tag=u2(s),e=nr(s,e),o){case 0:t=sp(null,t,s,e,n);break e;case 1:t=Em(null,t,s,e,n);break e;case 11:t=wm(null,t,s,e,n);break e;case 14:t=km(null,t,s,nr(s.type,e),n);break e}throw Error(me(306,s,""))}return t;case 0:return s=t.type,o=t.pendingProps,o=t.elementType===s?o:nr(s,o),sp(e,t,s,o,n);case 1:return s=t.type,o=t.pendingProps,o=t.elementType===s?o:nr(s,o),Em(e,t,s,o,n);case 3:e:{if(Qx(t),e===null)throw Error(me(387));s=t.pendingProps,i=t.memoizedState,o=i.element,kx(e,t),ac(t,s,null,n);var a=t.memoizedState;if(s=a.element,i.isDehydrated)if(i={element:s,isDehydrated:!1,cache:a.cache,pendingSuspenseBoundaries:a.pendingSuspenseBoundaries,transitions:a.transitions},t.updateQueue.baseState=i,t.memoizedState=i,t.flags&256){o=Uo(Error(me(423)),t),t=jm(e,t,s,n,o);break e}else if(s!==o){o=Uo(Error(me(424)),t),t=jm(e,t,s,n,o);break e}else for(Ln=fs(t.stateNode.containerInfo.firstChild),$n=t,kt=!0,sr=null,n=Sx(t,null,s,n),t.child=n;n;)n.flags=n.flags&-3|4096,n=n.sibling;else{if(Fo(),s===o){t=Vr(e,t,n);break e}pn(e,t,s,n)}t=t.child}return t;case 5:return Ex(t),e===null&&Zu(t),s=t.type,o=t.pendingProps,i=e!==null?e.memoizedProps:null,a=o.children,qu(s,o)?a=null:i!==null&&qu(s,i)&&(t.flags|=32),Kx(e,t),pn(e,t,a,n),t.child;case 6:return e===null&&Zu(t),null;case 13:return Jx(e,t,n);case 4:return sf(t,t.stateNode.containerInfo),s=t.pendingProps,e===null?t.child=Ho(t,null,s,n):pn(e,t,s,n),t.child;case 11:return s=t.type,o=t.pendingProps,o=t.elementType===s?o:nr(s,o),wm(e,t,s,o,n);case 7:return pn(e,t,t.pendingProps,n),t.child;case 8:return pn(e,t,t.pendingProps.children,n),t.child;case 12:return pn(e,t,t.pendingProps.children,n),t.child;case 10:e:{if(s=t.type._context,o=t.pendingProps,i=t.memoizedProps,a=o.value,ht(oc,s._currentValue),s._currentValue=a,i!==null)if(ar(i.value,a)){if(i.children===o.children&&!En.current){t=Vr(e,t,n);break e}}else for(i=t.child,i!==null&&(i.return=t);i!==null;){var l=i.dependencies;if(l!==null){a=i.child;for(var d=l.firstContext;d!==null;){if(d.context===s){if(i.tag===1){d=Hr(-1,n&-n),d.tag=2;var u=i.updateQueue;if(u!==null){u=u.shared;var p=u.pending;p===null?d.next=d:(d.next=p.next,p.next=d),u.pending=d}}i.lanes|=n,d=i.alternate,d!==null&&(d.lanes|=n),ep(i.return,n,t),l.lanes|=n;break}d=d.next}}else if(i.tag===10)a=i.type===t.type?null:i.child;else if(i.tag===18){if(a=i.return,a===null)throw Error(me(341));a.lanes|=n,l=a.alternate,l!==null&&(l.lanes|=n),ep(a,n,t),a=i.sibling}else a=i.child;if(a!==null)a.return=i;else for(a=i;a!==null;){if(a===t){a=null;break}if(i=a.sibling,i!==null){i.return=a.return,a=i;break}a=a.return}i=a}pn(e,t,o.children,n),t=t.child}return t;case 9:return o=t.type,s=t.pendingProps.children,Lo(t,n),o=Xn(o),s=s(o),t.flags|=1,pn(e,t,s,n),t.child;case 14:return s=t.type,o=nr(s,t.pendingProps),o=nr(s.type,o),km(e,t,s,o,n);case 15:return Yx(e,t,t.type,t.pendingProps,n);case 17:return s=t.type,o=t.pendingProps,o=t.elementType===s?o:nr(s,o),Ll(e,t),t.tag=1,jn(s)?(e=!0,nc(t)):e=!1,Lo(t,n),Ux(t,s,o),np(t,s,o,n),op(null,t,s,!0,e,n);case 19:return Xx(e,t,n);case 22:return qx(e,t,n)}throw Error(me(156,t.tag))};function my(e,t){return Fh(e,t)}function d2(e,t,n,s){this.tag=e,this.key=n,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=t,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=s,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Kn(e,t,n,s){return new d2(e,t,n,s)}function vf(e){return e=e.prototype,!(!e||!e.isReactComponent)}function u2(e){if(typeof e=="function")return vf(e)?1:0;if(e!=null){if(e=e.$$typeof,e===Pp)return 11;if(e===zp)return 14}return 2}function xs(e,t){var n=e.alternate;return n===null?(n=Kn(e.tag,t,e.key,e.mode),n.elementType=e.elementType,n.type=e.type,n.stateNode=e.stateNode,n.alternate=e,e.alternate=n):(n.pendingProps=t,n.type=e.type,n.flags=0,n.subtreeFlags=0,n.deletions=null),n.flags=e.flags&14680064,n.childLanes=e.childLanes,n.lanes=e.lanes,n.child=e.child,n.memoizedProps=e.memoizedProps,n.memoizedState=e.memoizedState,n.updateQueue=e.updateQueue,t=e.dependencies,n.dependencies=t===null?null:{lanes:t.lanes,firstContext:t.firstContext},n.sibling=e.sibling,n.index=e.index,n.ref=e.ref,n}function Ol(e,t,n,s,o,i){var a=2;if(s=e,typeof e=="function")vf(e)&&(a=1);else if(typeof e=="string")a=5;else e:switch(e){case yo:return Os(n.children,o,i,t);case Op:a=8,o|=8;break;case Cu:return e=Kn(12,n,t,o|2),e.elementType=Cu,e.lanes=i,e;case Tu:return e=Kn(13,n,t,o),e.elementType=Tu,e.lanes=i,e;case Iu:return e=Kn(19,n,t,o),e.elementType=Iu,e.lanes=i,e;case Eh:return zc(n,o,i,t);default:if(typeof e=="object"&&e!==null)switch(e.$$typeof){case wh:a=10;break e;case kh:a=9;break e;case Pp:a=11;break e;case zp:a=14;break e;case rs:a=16,s=null;break e}throw Error(me(130,e==null?e:typeof e,""))}return t=Kn(a,n,t,o),t.elementType=e,t.type=s,t.lanes=i,t}function Os(e,t,n,s){return e=Kn(7,e,s,t),e.lanes=n,e}function zc(e,t,n,s){return e=Kn(22,e,s,t),e.elementType=Eh,e.lanes=n,e.stateNode={isHidden:!1},e}function Zd(e,t,n){return e=Kn(6,e,null,t),e.lanes=n,e}function eu(e,t,n){return t=Kn(4,e.children!==null?e.children:[],e.key,t),t.lanes=n,t.stateNode={containerInfo:e.containerInfo,pendingChildren:null,implementation:e.implementation},t}function p2(e,t,n,s,o){this.tag=t,this.containerInfo=e,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=Ld(0),this.expirationTimes=Ld(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Ld(0),this.identifierPrefix=s,this.onRecoverableError=o,this.mutableSourceEagerHydrationData=null}function Sf(e,t,n,s,o,i,a,l,d){return e=new p2(e,t,n,l,d),t===1?(t=1,i===!0&&(t|=8)):t=0,i=Kn(3,null,null,t),e.current=i,i.stateNode=e,i.memoizedState={element:s,isDehydrated:n,cache:null,transitions:null,pendingSuspenseBoundaries:null},rf(i),e}function f2(e,t,n){var s=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:xo,key:s==null?null:""+s,children:e,containerInfo:t,implementation:n}}function gy(e){if(!e)return vs;e=e._reactInternals;e:{if(Ks(e)!==e||e.tag!==1)throw Error(me(170));var t=e;do{switch(t.tag){case 3:t=t.stateNode.context;break e;case 1:if(jn(t.type)){t=t.stateNode.__reactInternalMemoizedMergedChildContext;break e}}t=t.return}while(t!==null);throw Error(me(171))}if(e.tag===1){var n=e.type;if(jn(n))return gx(e,n,t)}return t}function hy(e,t,n,s,o,i,a,l,d){return e=Sf(n,s,!0,e,o,i,a,l,d),e.context=gy(null),n=e.current,s=fn(),o=hs(n),i=Hr(s,o),i.callback=t??null,ms(n,i,o),e.current.lanes=o,wa(e,o,s),Cn(e,s),e}function Dc(e,t,n,s){var o=t.current,i=fn(),a=hs(o);return n=gy(n),t.context===null?t.context=n:t.pendingContext=n,t=Hr(i,a),t.payload={element:e},s=s===void 0?null:s,s!==null&&(t.callback=s),e=ms(o,t,a),e!==null&&(ir(e,o,a,i),Ml(e,o,a)),a}function gc(e){if(e=e.current,!e.child)return null;switch(e.child.tag){case 5:return e.child.stateNode;default:return e.child.stateNode}}function $m(e,t){if(e=e.memoizedState,e!==null&&e.dehydrated!==null){var n=e.retryLane;e.retryLane=n!==0&&n<t?n:t}}function wf(e,t){$m(e,t),(e=e.alternate)&&$m(e,t)}function m2(){return null}var xy=typeof reportError=="function"?reportError:function(e){console.error(e)};function kf(e){this._internalRoot=e}Fc.prototype.render=kf.prototype.render=function(e){var t=this._internalRoot;if(t===null)throw Error(me(409));Dc(e,t,null,null)};Fc.prototype.unmount=kf.prototype.unmount=function(){var e=this._internalRoot;if(e!==null){this._internalRoot=null;var t=e.containerInfo;Gs(function(){Dc(null,e,null,null)}),t[Ur]=null}};function Fc(e){this._internalRoot=e}Fc.prototype.unstable_scheduleHydration=function(e){if(e){var t=qh();e={blockedOn:null,target:e,priority:t};for(var n=0;n<is.length&&t!==0&&t<is[n].priority;n++);is.splice(n,0,e),n===0&&Qh(e)}};function Ef(e){return!(!e||e.nodeType!==1&&e.nodeType!==9&&e.nodeType!==11)}function Hc(e){return!(!e||e.nodeType!==1&&e.nodeType!==9&&e.nodeType!==11&&(e.nodeType!==8||e.nodeValue!==" react-mount-point-unstable "))}function Bm(){}function g2(e,t,n,s,o){if(o){if(typeof s=="function"){var i=s;s=function(){var u=gc(a);i.call(u)}}var a=hy(t,s,e,0,null,!1,!1,"",Bm);return e._reactRootContainer=a,e[Ur]=a.current,ca(e.nodeType===8?e.parentNode:e),Gs(),a}for(;o=e.lastChild;)e.removeChild(o);if(typeof s=="function"){var l=s;s=function(){var u=gc(d);l.call(u)}}var d=Sf(e,0,!1,null,null,!1,!1,"",Bm);return e._reactRootContainer=d,e[Ur]=d.current,ca(e.nodeType===8?e.parentNode:e),Gs(function(){Dc(t,d,n,s)}),d}function Wc(e,t,n,s,o){var i=n._reactRootContainer;if(i){var a=i;if(typeof o=="function"){var l=o;o=function(){var d=gc(a);l.call(d)}}Dc(t,a,e,o)}else a=g2(n,t,e,o,s);return gc(a)}Vh=function(e){switch(e.tag){case 3:var t=e.stateNode;if(t.current.memoizedState.isDehydrated){var n=Di(t.pendingLanes);n!==0&&(Hp(t,n|1),Cn(t,Nt()),!(ot&6)&&(Go=Nt()+500,ks()))}break;case 13:Gs(function(){var s=Gr(e,1);if(s!==null){var o=fn();ir(s,e,1,o)}}),wf(e,1)}};Wp=function(e){if(e.tag===13){var t=Gr(e,134217728);if(t!==null){var n=fn();ir(t,e,134217728,n)}wf(e,134217728)}};Yh=function(e){if(e.tag===13){var t=hs(e),n=Gr(e,t);if(n!==null){var s=fn();ir(n,e,t,s)}wf(e,t)}};qh=function(){return pt};Kh=function(e,t){var n=pt;try{return pt=e,t()}finally{pt=n}};Pu=function(e,t,n){switch(t){case"input":if(Mu(e,n),t=n.name,n.type==="radio"&&t!=null){for(n=e;n.parentNode;)n=n.parentNode;for(n=n.querySelectorAll("input[name="+JSON.stringify(""+t)+'][type="radio"]'),t=0;t<n.length;t++){var s=n[t];if(s!==e&&s.form===e.form){var o=Nc(s);if(!o)throw Error(me(90));Ch(s),Mu(s,o)}}}break;case"textarea":Ih(e,n);break;case"select":t=n.value,t!=null&&Ro(e,!!n.multiple,t,!1)}};$h=xf;Bh=Gs;var h2={usingClientEntryPoint:!1,Events:[Ea,wo,Nc,Nh,Lh,xf]},Mi={findFiberByHostInstance:Ns,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},x2={bundleType:Mi.bundleType,version:Mi.version,rendererPackageName:Mi.rendererPackageName,rendererConfig:Mi.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:qr.ReactCurrentDispatcher,findHostInstanceByFiber:function(e){return e=zh(e),e===null?null:e.stateNode},findFiberByHostInstance:Mi.findFiberByHostInstance||m2,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var pl=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!pl.isDisabled&&pl.supportsFiber)try{_c=pl.inject(x2),jr=pl}catch{}}On.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=h2;On.createPortal=function(e,t){var n=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!Ef(t))throw Error(me(200));return f2(e,t,null,n)};On.createRoot=function(e,t){if(!Ef(e))throw Error(me(299));var n=!1,s="",o=xy;return t!=null&&(t.unstable_strictMode===!0&&(n=!0),t.identifierPrefix!==void 0&&(s=t.identifierPrefix),t.onRecoverableError!==void 0&&(o=t.onRecoverableError)),t=Sf(e,1,!1,null,null,n,!1,s,o),e[Ur]=t.current,ca(e.nodeType===8?e.parentNode:e),new kf(t)};On.findDOMNode=function(e){if(e==null)return null;if(e.nodeType===1)return e;var t=e._reactInternals;if(t===void 0)throw typeof e.render=="function"?Error(me(188)):(e=Object.keys(e).join(","),Error(me(268,e)));return e=zh(t),e=e===null?null:e.stateNode,e};On.flushSync=function(e){return Gs(e)};On.hydrate=function(e,t,n){if(!Hc(t))throw Error(me(200));return Wc(null,e,t,!0,n)};On.hydrateRoot=function(e,t,n){if(!Ef(e))throw Error(me(405));var s=n!=null&&n.hydratedSources||null,o=!1,i="",a=xy;if(n!=null&&(n.unstable_strictMode===!0&&(o=!0),n.identifierPrefix!==void 0&&(i=n.identifierPrefix),n.onRecoverableError!==void 0&&(a=n.onRecoverableError)),t=hy(t,null,e,1,n??null,o,!1,i,a),e[Ur]=t.current,ca(e),s)for(e=0;e<s.length;e++)n=s[e],o=n._getVersion,o=o(n._source),t.mutableSourceEagerHydrationData==null?t.mutableSourceEagerHydrationData=[n,o]:t.mutableSourceEagerHydrationData.push(n,o);return new Fc(t)};On.render=function(e,t,n){if(!Hc(t))throw Error(me(200));return Wc(null,e,t,!1,n)};On.unmountComponentAtNode=function(e){if(!Hc(e))throw Error(me(40));return e._reactRootContainer?(Gs(function(){Wc(null,null,e,!1,function(){e._reactRootContainer=null,e[Ur]=null})}),!0):!1};On.unstable_batchedUpdates=xf;On.unstable_renderSubtreeIntoContainer=function(e,t,n,s){if(!Hc(n))throw Error(me(200));if(e==null||e._reactInternals===void 0)throw Error(me(38));return Wc(e,t,n,!1,s)};On.version="18.3.1-next-f1338f8080-20240426";function yy(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(yy)}catch(e){console.error(e)}}yy(),yh.exports=On;var y2=yh.exports,Om=y2;Eu.createRoot=Om.createRoot,Eu.hydrateRoot=Om.hydrateRoot;const b2="modulepreload",v2=function(e,t){return new URL(e,t).href},Pm={},S2=function(t,n,s){let o=Promise.resolve();if(n&&n.length>0){const a=document.getElementsByTagName("link"),l=document.querySelector("meta[property=csp-nonce]"),d=(l==null?void 0:l.nonce)||(l==null?void 0:l.getAttribute("nonce"));o=Promise.allSettled(n.map(u=>{if(u=v2(u,s),u in Pm)return;Pm[u]=!0;const p=u.endsWith(".css"),c=p?'[rel="stylesheet"]':"";if(!!s)for(let S=a.length-1;S>=0;S--){const E=a[S];if(E.href===u&&(!p||E.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${u}"]${c}`))return;const y=document.createElement("link");if(y.rel=p?"stylesheet":b2,p||(y.as="script"),y.crossOrigin="",y.href=u,d&&y.setAttribute("nonce",d),document.head.appendChild(y),p)return new Promise((S,E)=>{y.addEventListener("load",S),y.addEventListener("error",()=>E(new Error(`Unable to preload CSS for ${u}`)))})}))}function i(a){const l=new Event("vite:preloadError",{cancelable:!0});if(l.payload=a,window.dispatchEvent(l),!l.defaultPrevented)throw a}return o.then(a=>{for(const l of a||[])l.status==="rejected"&&i(l.reason);return t().catch(i)})},we={colors:{background:"#F8F3EE",paper:"#F4EEE6",ink:"#2E2B26",primary:"#6B513A",accent:"#7AA893",muted:"#A59786",parchment:"#EDE3D6",border:"#B8A895",shadow:"rgba(34,28,22,0.12)"},gradients:{subtle:"linear-gradient(135deg, rgba(255,255,255,0.6), rgba(240,235,230,0.6))",warm:"linear-gradient(135deg, #EDE3D6 0%, #F4EEE6 100%)"},sizes:{navHeight:"56px"}},zm={appContainer:{display:"flex",flexDirection:"column",height:"100vh",fontFamily:"'Noto Serif SC', serif",backgroundColor:we.colors.background,backgroundImage:"linear-gradient(rgba(245, 240, 232, 0.6), rgba(245, 240, 232, 0.6))",backgroundSize:"100% 100%"},mainContent:{flex:1,padding:"15px",paddingBottom:"70px",overflowY:"auto"}};function w2(){const[e,t]=b.useState({type:null,data:null}),[n,s]=b.useState(!1),[o,i]=b.useState(!1),[a,l]=b.useState(!1),[d,u]=b.useState(!1),[p,c]=b.useState(!1),[m,y]=b.useState(!1),[S,E]=b.useState({open:!1,npc:null}),[w,g]=b.useState({open:!1,mode:"VIEW",slot:null,childId:null}),[h,v]=b.useState(!1),[x,I]=b.useState(!1),[_,N]=b.useState(!1),[C,j]=b.useState(!1),T=b.useCallback((ge,Ee=null)=>{t({type:ge,data:Ee})},[]),A=b.useCallback(()=>{t({type:null,data:null})},[]),V=b.useCallback(()=>s(!0),[]),F=b.useCallback(()=>s(!1),[]),B=b.useCallback(()=>i(!0),[]),$=b.useCallback(()=>i(!1),[]),Y=b.useCallback(()=>l(!0),[]),ne=b.useCallback(()=>l(!1),[]),X=b.useCallback(()=>u(!0),[]),ee=b.useCallback(()=>u(!1),[]),ae=b.useCallback(()=>c(!0),[]),Te=b.useCallback(()=>c(!1),[]),Be=b.useCallback(()=>y(!0),[]),ze=b.useCallback(()=>y(!1),[]),W=b.useCallback(ge=>{E({open:!0,npc:ge})},[]),J=b.useCallback(()=>{E({open:!1,npc:null})},[]),fe=b.useCallback((ge="VIEW",Ee=null,Ke=null)=>{g({open:!0,mode:ge,slot:Ee,childId:Ke})},[]),re=b.useCallback(()=>{g({open:!1,mode:"VIEW",slot:null,childId:null})},[]),ce=b.useCallback(()=>v(!0),[]),Ce=b.useCallback(()=>v(!1),[]),Ge=b.useCallback(()=>I(!0),[]),Ne=b.useCallback(()=>I(!1),[]),nt=b.useCallback(()=>N(!0),[]),Le=b.useCallback(()=>N(!1),[]),z=b.useCallback(()=>j(!0),[]),ue=b.useCallback(()=>j(!1),[]),ve=b.useCallback(()=>{A(),s(!1),i(!1),l(!1),u(!1),c(!1),y(!1),E({open:!1,npc:null}),g({open:!1,mode:"VIEW",slot:null,childId:null}),v(!1),I(!1),N(!1),j(!1)},[A]);return b.useMemo(()=>({modalState:e,openModal:T,closeModal:A,showGazette:n,setShowGazette:s,openGazette:V,closeGazette:F,showMessageCenter:o,setShowMessageCenter:i,openMessageCenter:B,closeMessageCenter:$,showGuide:a,setShowGuide:l,openGuide:Y,closeGuide:ne,showTutorial:d,setShowTutorial:u,openTutorial:X,closeTutorial:ee,showBizPanel:p,setShowBizPanel:c,openBizPanel:ae,closeBizPanel:Te,showChallengePanel:m,setShowChallengePanel:y,openChallengePanel:Be,closeChallengePanel:ze,npcLogModal:S,setNpcLogModal:E,openNpcLog:W,closeNpcLog:J,inventoryModal:w,showBatchGiftModal:h,setShowBatchGiftModal:v,openBatchGiftModal:ce,closeBatchGiftModal:Ce,showBatchPromotionModal:x,setShowBatchPromotionModal:I,openBatchPromotionModal:Ge,closeBatchPromotionModal:Ne,showBatchMarriageModal:_,setShowBatchMarriageModal:N,openBatchMarriageModal:nt,closeBatchMarriageModal:Le,showBatchManualModal:C,setShowBatchManualModal:j,openBatchManualModal:z,closeBatchManualModal:ue,openInventory:fe,closeInventory:re,closeAllModals:ve}),[e,n,o,a,d,p,m,S,w,h,x,_,C])}const ft={PLAYER:"player",CHILD:"child",NPC:"npc"},by=[ft.PLAYER,ft.CHILD,ft.NPC],Q={MORTAL:{key:"MORTAL",label:"",color:"#a1887f",order:1,desc:""},SPIRIT:{key:"SPIRIT",label:"",color:"#00897b",order:2,desc:""},EARTH:{key:"EARTH",label:"",color:"#7cb342",order:3,desc:""},HEAVEN:{key:"HEAVEN",label:"",color:"#5e35b1",order:4,desc:""},DIVINE:{key:"DIVINE",label:"",color:"#ffa000",order:5,desc:""}},Se={GENERAL:{id:"GENERAL"},ELEMENTAL:{id:"ELEMENTAL"},VARIANT:{id:"VARIANT"},DUAL:{id:"DUAL"},DEVIL:{id:"DEVIL"}},fl={SABER:{id:"SABER"},SPEAR:{id:"SPEAR"},RELIC:{id:"RELIC"}},it={BODY:{id:"BODY"},FOUNDATION:{id:"FOUNDATION"},CORE:{id:"CORE"},NASCENT:{id:"NASCENT"},ASCENSION:{id:"ASCENSION"}},k2={[ft.PLAYER]:"",[ft.CHILD]:"",[ft.NPC]:""},ml=()=>[...by],de=()=>[ft.PLAYER,ft.CHILD],E2=()=>[ft.CHILD],Uc={herb_bandage:{id:"herb_bandage",name:"",type:"consumable",rarity:"common",desc:"",effect:{kind:"heal",amount:100},resourceCategory:"PILL",resourceLevel:Q.MORTAL.key,pillTier:it.BODY.id,usageTargets:ml(),tags:["",""]},rice_ball:{id:"rice_ball",name:"",type:"consumable",rarity:"common",desc:"",effect:{kind:"heal",amount:60},resourceCategory:"PILL",resourceLevel:Q.MORTAL.key,pillTier:it.BODY.id,usageTargets:ml(),tags:["",""]},iron_sword:{id:"iron_sword",name:"",type:"weapon",slot:"weapon",rarity:"common",desc:"",stats:{atk:25},resourceCategory:"WEAPON",resourceLevel:Q.MORTAL.key,weaponClass:fl.SABER.id,usageTargets:de(),tags:["",""]},beast_fang:{id:"beast_fang",name:"",type:"accessory",slot:"accessory",rarity:"uncommon",desc:"",stats:{atk:35},resourceCategory:"ACCESSORY",resourceLevel:Q.SPIRIT.key,usageTargets:de(),tags:["",""]},beast_core:{id:"beast_core",name:"",type:"consumable",rarity:"uncommon",desc:"",effect:{kind:"exp",amount:1200},resourceCategory:"PILL",resourceLevel:Q.MORTAL.key,pillTier:it.BODY.id,usageTargets:ml(),tags:["",""]},foundation_pill:{id:"foundation_pill",name:"",type:"consumable",rarity:"rare",desc:"",effect:{kind:"exp",amount:4e3},resourceCategory:"PILL",resourceLevel:Q.SPIRIT.key,pillTier:it.FOUNDATION.id,usageTargets:de(),tags:["",""]},thunder_wood:{id:"thunder_wood",name:"",type:"accessory",slot:"accessory",rarity:"rare",desc:"",stats:{atk:60,mp:200},resourceCategory:"ACCESSORY",resourceLevel:Q.SPIRIT.key,usageTargets:de(),tags:["",""]},iron_armor:{id:"iron_armor",name:"",type:"armor",slot:"armor",rarity:"rare",desc:"",stats:{hp:600},resourceCategory:"ARMOR",resourceLevel:Q.SPIRIT.key,usageTargets:de(),tags:["",""]},core_pill:{id:"core_pill",name:"",type:"consumable",rarity:"epic",desc:"",effect:{kind:"exp",amount:9e3},resourceCategory:"PILL",resourceLevel:Q.EARTH.key,pillTier:it.CORE.id,usageTargets:de(),tags:["",""]},artifact_supreme:{id:"artifact_supreme",name:"",type:"weapon",slot:"weapon",rarity:"epic",desc:"",stats:{atk:180,hp:300},resourceCategory:"WEAPON",resourceLevel:Q.HEAVEN.key,weaponClass:fl.RELIC.id,usageTargets:de(),tags:["","",""]},milk_millennium:{id:"milk_millennium",name:"",type:"consumable",rarity:"epic",desc:"",effect:{kind:"heal",amount:500},resourceCategory:"PILL",resourceLevel:Q.EARTH.key,pillTier:it.FOUNDATION.id,usageTargets:ml(),tags:["",""]},marrow_wash:{id:"marrow_wash",name:"",type:"consumable",rarity:"epic",desc:"",effect:{kind:"aptitude",amount:2},resourceCategory:"PILL",resourceLevel:Q.EARTH.key,pillTier:it.FOUNDATION.id,usageTargets:de(),tags:["",""]},nascent_fruit:{id:"nascent_fruit",name:"",type:"consumable",rarity:"legendary",desc:"",effect:{kind:"exp",amount:2e4},resourceCategory:"PILL",resourceLevel:Q.HEAVEN.key,pillTier:it.NASCENT.id,usageTargets:de(),tags:["",""]},heaven_manual:{id:"heaven_manual",name:"",type:"accessory",slot:"accessory",rarity:"legendary",desc:"",stats:{mp:800,atk:120},resourceCategory:"ACCESSORY",resourceLevel:Q.HEAVEN.key,usageTargets:de(),tags:["","",""]},divine_egg:{id:"divine_egg",name:"",type:"armor",slot:"armor",rarity:"legendary",desc:"",stats:{hp:1200},resourceCategory:"ARMOR",resourceLevel:Q.HEAVEN.key,usageTargets:de(),tags:["",""]},moonshadow_saber:{id:"moonshadow_saber",name:"",type:"weapon",slot:"weapon",rarity:"epic",desc:"",stats:{atk:160,mp:60},resourceCategory:"WEAPON",resourceLevel:Q.EARTH.key,weaponClass:fl.SABER.id,usageTargets:de(),tags:["",""]},storm_piercer:{id:"storm_piercer",name:"",type:"weapon",slot:"weapon",rarity:"legendary",desc:"",stats:{atk:190,mp:120,hp:200},resourceCategory:"WEAPON",resourceLevel:Q.HEAVEN.key,weaponClass:fl.SPEAR.id,usageTargets:de(),tags:["",""]},meridian_pill:{id:"meridian_pill",name:"",type:"consumable",rarity:"uncommon",desc:"",effect:{kind:"exp",amount:1500},resourceCategory:"PILL",resourceLevel:Q.MORTAL.key,pillTier:it.BODY.id,usageTargets:E2(),tags:["",""]},dragon_heart_pill:{id:"dragon_heart_pill",name:"",type:"consumable",rarity:"epic",desc:"",effect:{kind:"exp",amount:12e3},resourceCategory:"PILL",resourceLevel:Q.EARTH.key,pillTier:it.CORE.id,usageTargets:de(),tags:["",""]},communication_pill:{id:"communication_pill",name:"",type:"consumable",rarity:"uncommon",desc:"",effect:{kind:"intelligence",amount:2},resourceCategory:"PILL",resourceLevel:Q.MORTAL.key,pillTier:it.FOUNDATION.id,usageTargets:de(),tags:["",""]},awakening_pill:{id:"awakening_pill",name:"",type:"consumable",rarity:"epic",desc:"",effect:{kind:"intelligence",amount:5},resourceCategory:"PILL",resourceLevel:Q.SPIRIT.key,pillTier:it.FOUNDATION.id,usageTargets:de(),tags:["",""]},wisdom_pill:{id:"wisdom_pill",name:"",type:"consumable",rarity:"legendary",desc:"",effect:{kind:"intelligence",amount:8},resourceCategory:"PILL",resourceLevel:Q.EARTH.key,pillTier:it.CORE.id,usageTargets:de(),tags:[""]},starlight_pill:{id:"starlight_pill",name:"",type:"consumable",rarity:"legendary",desc:"",effect:{kind:"intelligence",amount:18},resourceCategory:"PILL",resourceLevel:Q.HEAVEN.key,pillTier:it.ASCENSION.id,usageTargets:de(),tags:["","",""]},god_transformation_pill:{id:"god_transformation_pill",name:"",type:"consumable",rarity:"mythic",desc:"",effect:{kind:"exp",amount:3e5},resourceCategory:"PILL",resourceLevel:Q.DIVINE.key,pillTier:it.ASCENSION.id,usageTargets:de(),tags:["","",""]},divine_soul_pill:{id:"divine_soul_pill",name:"",type:"consumable",rarity:"mythic",desc:"",effect:{kind:"exp",amount:5e5},resourceCategory:"PILL",resourceLevel:Q.DIVINE.key,pillTier:it.ASCENSION.id,usageTargets:de(),tags:["","",""]},void_condensing_pill:{id:"void_condensing_pill",name:"",type:"consumable",rarity:"mythic",desc:"",effect:{kind:"exp",amount:8e5},resourceCategory:"PILL",resourceLevel:Q.DIVINE.key,pillTier:it.ASCENSION.id,usageTargets:de(),tags:["","",""]},immortal_marrow_pill:{id:"immortal_marrow_pill",name:"",type:"consumable",rarity:"mythic",desc:"",effect:{kind:"aptitude",amount:8},resourceCategory:"PILL",resourceLevel:Q.DIVINE.key,pillTier:it.ASCENSION.id,usageTargets:de(),tags:["","",""]},heaven_defying_pill:{id:"heaven_defying_pill",name:"",type:"consumable",rarity:"mythic",desc:"",effect:{kind:"exp",amount:1e6},resourceCategory:"PILL",resourceLevel:Q.DIVINE.key,pillTier:it.ASCENSION.id,usageTargets:de(),tags:["","",""]},void_refining_pill:{id:"void_refining_pill",name:"",type:"consumable",rarity:"mythic",desc:"",effect:{kind:"exp",amount:2e6},resourceCategory:"PILL",resourceLevel:Q.DIVINE.key,pillTier:it.ASCENSION.id,usageTargets:de(),tags:["","",""]},space_law_pill:{id:"space_law_pill",name:"",type:"consumable",rarity:"mythic",desc:"",effect:{kind:"exp",amount:3e6},resourceCategory:"PILL",resourceLevel:Q.DIVINE.key,pillTier:it.ASCENSION.id,usageTargets:de(),tags:["","",""]},void_stabilization_pill:{id:"void_stabilization_pill",name:"",type:"consumable",rarity:"mythic",desc:"",effect:{kind:"exp",amount:5e6},resourceCategory:"PILL",resourceLevel:Q.DIVINE.key,pillTier:it.ASCENSION.id,usageTargets:de(),tags:["","",""]},unity_pill:{id:"unity_pill",name:"",type:"consumable",rarity:"mythic",desc:"",effect:{kind:"exp",amount:8e6},resourceCategory:"PILL",resourceLevel:Q.DIVINE.key,pillTier:it.ASCENSION.id,usageTargets:de(),tags:["","",""]},dao_comprehension_pill:{id:"dao_comprehension_pill",name:"",type:"consumable",rarity:"mythic",desc:"",effect:{kind:"exp",amount:12e6},resourceCategory:"PILL",resourceLevel:Q.DIVINE.key,pillTier:it.ASCENSION.id,usageTargets:de(),tags:["","",""]},harmony_pill:{id:"harmony_pill",name:"",type:"consumable",rarity:"mythic",desc:"",effect:{kind:"exp",amount:18e6},resourceCategory:"PILL",resourceLevel:Q.DIVINE.key,pillTier:it.ASCENSION.id,usageTargets:de(),tags:["","",""]},mahayana_pill:{id:"mahayana_pill",name:"",type:"consumable",rarity:"mythic",desc:"",effect:{kind:"exp",amount:3e7},resourceCategory:"PILL",resourceLevel:Q.DIVINE.key,pillTier:it.ASCENSION.id,usageTargets:de(),tags:["","",""]},immortal_foundation_pill:{id:"immortal_foundation_pill",name:"",type:"consumable",rarity:"mythic",desc:"",effect:{kind:"exp",amount:5e7},resourceCategory:"PILL",resourceLevel:Q.DIVINE.key,pillTier:it.ASCENSION.id,usageTargets:de(),tags:["","",""]},semi_immortal_pill:{id:"semi_immortal_pill",name:"",type:"consumable",rarity:"mythic",desc:"",effect:{kind:"exp",amount:8e7},resourceCategory:"PILL",resourceLevel:Q.DIVINE.key,pillTier:it.ASCENSION.id,usageTargets:de(),tags:["","",""]},tribulation_pill:{id:"tribulation_pill",name:"",type:"consumable",rarity:"mythic",desc:"",effect:{kind:"exp",amount:1e8},resourceCategory:"PILL",resourceLevel:Q.DIVINE.key,pillTier:it.ASCENSION.id,usageTargets:de(),tags:["","",""]},anti_tribulation_pill:{id:"anti_tribulation_pill",name:"",type:"consumable",rarity:"mythic",desc:"",effect:{kind:"heal",amount:5e4},resourceCategory:"PILL",resourceLevel:Q.DIVINE.key,pillTier:it.ASCENSION.id,usageTargets:de(),tags:["","",""]},ascension_pill:{id:"ascension_pill",name:"",type:"consumable",rarity:"mythic",desc:"",effect:{kind:"exp",amount:2e8},resourceCategory:"PILL",resourceLevel:Q.DIVINE.key,pillTier:it.ASCENSION.id,usageTargets:de(),tags:["","",""]},basic_manual:{id:"basic_manual",name:"",type:"manual",rarity:"common",tier:"",tierColor:"#D4AF37",element:"",baseBonus:"+20%",desc:"",manualIds:["basic_breath","cloud_breath"],resourceCategory:"MANUAL",resourceLevel:Q.MORTAL.key,manualSchool:Se.GENERAL.id,usageTargets:de(),tags:["",""]},advanced_manual:{id:"advanced_manual",name:"",type:"manual",rarity:"rare",tier:"",tierColor:"#4A4A4A",element:"",baseBonus:"+50%",desc:"",manualIds:["azure_sword_art","water_flow","fire_control","mountain_body"],resourceCategory:"MANUAL",resourceLevel:Q.SPIRIT.key,manualSchool:Se.ELEMENTAL.id,usageTargets:de(),tags:["",""]},expert_manual:{id:"expert_manual",name:"",type:"manual",rarity:"epic",tier:"",tierColor:"#8B4513",element:"",baseBonus:"+100%",desc:"",manualIds:["yin_yang_harmony","five_elements_supreme"],resourceCategory:"MANUAL",resourceLevel:Q.EARTH.key,manualSchool:Se.DUAL.id,usageTargets:de(),tags:["",""]},yin_yang_harmony_manual:{id:"yin_yang_harmony_manual",name:"",type:"manual",rarity:"rare",tier:"",tierColor:"#4A4A4A",element:"",baseBonus:"+60%",desc:"",manualIds:["yin_yang_harmony"],resourceCategory:"MANUAL",resourceLevel:Q.SPIRIT.key,manualSchool:Se.DUAL.id,usageTargets:de(),tags:["",""]},blood_demon_manual:{id:"blood_demon_manual",name:"",type:"manual",rarity:"epic",tier:"",tierColor:"#8B4513",element:"",baseBonus:"+120%",desc:"",manualIds:["blood_demon"],resourceCategory:"MANUAL",resourceLevel:Q.EARTH.key,manualSchool:Se.DEVIL.id,usageTargets:de(),tags:["",""]},chaos_origin_manual:{id:"chaos_origin_manual",name:"",type:"manual",rarity:"legendary",tier:"",tierColor:"#6A5ACD",element:"",baseBonus:"+220%",desc:"",manualIds:["chaos_origin"],resourceCategory:"MANUAL",resourceLevel:Q.HEAVEN.key,manualSchool:Se.GENERAL.id,usageTargets:de(),tags:["",""]},five_elements_supreme_manual:{id:"five_elements_supreme_manual",name:"",type:"manual",rarity:"legendary",tier:"",tierColor:"#6A5ACD",element:"",baseBonus:"+220%",desc:"",manualIds:["five_elements_supreme"],resourceCategory:"MANUAL",resourceLevel:Q.HEAVEN.key,manualSchool:Se.ELEMENTAL.id,usageTargets:de(),tags:["",""]},emperor_scripture_manual:{id:"emperor_scripture_manual",name:"",type:"manual",rarity:"legendary",tier:"",tierColor:"#6A5ACD",element:"",baseBonus:"+240%",desc:"",manualIds:["emperor_scripture"],resourceCategory:"MANUAL",resourceLevel:Q.HEAVEN.key,manualSchool:Se.GENERAL.id,usageTargets:de(),tags:["",""]},deep_ocean_scripture_manual:{id:"deep_ocean_scripture_manual",name:"",type:"manual",rarity:"epic",tier:"",tierColor:"#8B4513",element:"",baseBonus:"+140%",desc:"",manualIds:["deep_ocean_scripture"],resourceCategory:"MANUAL",resourceLevel:Q.EARTH.key,manualSchool:Se.ELEMENTAL.id,usageTargets:de(),tags:["",""]},gold_manual_1:{id:"gold_manual_1",name:"",type:"manual",rarity:"common",tier:"",tierColor:"#FFD700",element:"",baseBonus:"+20%",desc:"",manualIds:["golden_light"],resourceCategory:"MANUAL",resourceLevel:Q.MORTAL.key,manualSchool:Se.ELEMENTAL.id,usageTargets:de(),tags:["",""]},gold_manual_2:{id:"gold_manual_2",name:"",type:"manual",rarity:"uncommon",tier:"",tierColor:"#FFD700",element:"",baseBonus:"+50%",desc:"",manualIds:["azure_sword_art"],resourceCategory:"MANUAL",resourceLevel:Q.SPIRIT.key,manualSchool:Se.ELEMENTAL.id,usageTargets:de(),tags:["",""]},gold_manual_3:{id:"gold_manual_3",name:"",type:"manual",rarity:"rare",tier:"",tierColor:"#FFD700",element:"",baseBonus:"+100%",desc:"",manualIds:["golden_light","azure_sword_art"],resourceCategory:"MANUAL",resourceLevel:Q.EARTH.key,manualSchool:Se.ELEMENTAL.id,usageTargets:de(),tags:["",""]},gold_manual_4:{id:"gold_manual_4",name:"",type:"manual",rarity:"epic",tier:"",tierColor:"#FFD700",element:"",baseBonus:"+100%",desc:"",manualIds:["azure_sword_art"],resourceCategory:"MANUAL",resourceLevel:Q.EARTH.key,manualSchool:Se.ELEMENTAL.id,usageTargets:de(),tags:["",""]},gold_manual_5:{id:"gold_manual_5",name:"",type:"manual",rarity:"legendary",tier:"",tierColor:"#FFD700",element:"",baseBonus:"+200%",desc:"",manualIds:["azure_sword_art"],resourceCategory:"MANUAL",resourceLevel:Q.HEAVEN.key,manualSchool:Se.ELEMENTAL.id,usageTargets:de(),tags:["",""]},wood_manual_1:{id:"wood_manual_1",name:"",type:"manual",rarity:"common",tier:"",tierColor:"#228B22",element:"",baseBonus:"+20%",desc:"",manualIds:["evergreen_art"],resourceCategory:"MANUAL",resourceLevel:Q.MORTAL.key,manualSchool:Se.ELEMENTAL.id,usageTargets:de(),tags:["",""]},wood_manual_2:{id:"wood_manual_2",name:"",type:"manual",rarity:"uncommon",tier:"",tierColor:"#228B22",element:"",baseBonus:"+50%",desc:"",manualIds:["spring_birth"],resourceCategory:"MANUAL",resourceLevel:Q.SPIRIT.key,manualSchool:Se.ELEMENTAL.id,usageTargets:de(),tags:["",""]},wood_manual_3:{id:"wood_manual_3",name:"",type:"manual",rarity:"rare",tier:"",tierColor:"#228B22",element:"",baseBonus:"+100%",desc:"",manualIds:["evergreen_art","spring_birth"],resourceCategory:"MANUAL",resourceLevel:Q.EARTH.key,manualSchool:Se.ELEMENTAL.id,usageTargets:de(),tags:["",""]},wood_manual_4:{id:"wood_manual_4",name:"",type:"manual",rarity:"epic",tier:"",tierColor:"#228B22",element:"",baseBonus:"+100%",desc:"",manualIds:["spring_birth"],resourceCategory:"MANUAL",resourceLevel:Q.EARTH.key,manualSchool:Se.ELEMENTAL.id,usageTargets:de(),tags:["",""]},wood_manual_5:{id:"wood_manual_5",name:"",type:"manual",rarity:"legendary",tier:"",tierColor:"#228B22",element:"",baseBonus:"+200%",desc:"",manualIds:["spring_birth"],resourceCategory:"MANUAL",resourceLevel:Q.HEAVEN.key,manualSchool:Se.ELEMENTAL.id,usageTargets:de(),tags:["",""]},water_manual_1:{id:"water_manual_1",name:"",type:"manual",rarity:"common",tier:"",tierColor:"#4169E1",element:"",baseBonus:"+20%",desc:"",manualIds:["water_flow"],resourceCategory:"MANUAL",resourceLevel:Q.MORTAL.key,manualSchool:Se.ELEMENTAL.id,usageTargets:de(),tags:["",""]},water_manual_2:{id:"water_manual_2",name:"",type:"manual",rarity:"uncommon",tier:"",tierColor:"#4169E1",element:"",baseBonus:"+50%",desc:"",manualIds:["ocean_heart"],resourceCategory:"MANUAL",resourceLevel:Q.SPIRIT.key,manualSchool:Se.ELEMENTAL.id,usageTargets:de(),tags:["",""]},water_manual_3:{id:"water_manual_3",name:"",type:"manual",rarity:"rare",tier:"",tierColor:"#4169E1",element:"",baseBonus:"+100%",desc:"",manualIds:["water_flow","ocean_heart"],resourceCategory:"MANUAL",resourceLevel:Q.EARTH.key,manualSchool:Se.ELEMENTAL.id,usageTargets:de(),tags:["",""]},water_manual_4:{id:"water_manual_4",name:"",type:"manual",rarity:"epic",tier:"",tierColor:"#4169E1",element:"",baseBonus:"+100%",desc:"",manualIds:["ocean_heart"],resourceCategory:"MANUAL",resourceLevel:Q.EARTH.key,manualSchool:Se.ELEMENTAL.id,usageTargets:de(),tags:["",""]},water_manual_5:{id:"water_manual_5",name:"",type:"manual",rarity:"legendary",tier:"",tierColor:"#4169E1",element:"",baseBonus:"+200%",desc:"",manualIds:["ocean_heart"],resourceCategory:"MANUAL",resourceLevel:Q.HEAVEN.key,manualSchool:Se.ELEMENTAL.id,usageTargets:de(),tags:["",""]},fire_manual_1:{id:"fire_manual_1",name:"",type:"manual",rarity:"common",tier:"",tierColor:"#FF6347",element:"",baseBonus:"+20%",desc:"",manualIds:["basic_breath"],resourceCategory:"MANUAL",resourceLevel:Q.MORTAL.key,manualSchool:Se.ELEMENTAL.id,usageTargets:de(),tags:["",""]},fire_manual_2:{id:"fire_manual_2",name:"",type:"manual",rarity:"uncommon",tier:"",tierColor:"#FF6347",element:"",baseBonus:"+50%",desc:"",manualIds:["fire_control"],resourceCategory:"MANUAL",resourceLevel:Q.SPIRIT.key,manualSchool:Se.ELEMENTAL.id,usageTargets:de(),tags:["",""]},fire_manual_3:{id:"fire_manual_3",name:"",type:"manual",rarity:"rare",tier:"",tierColor:"#FF6347",element:"",baseBonus:"+100%",desc:"",manualIds:["nine_turns_fire"],resourceCategory:"MANUAL",resourceLevel:Q.EARTH.key,manualSchool:Se.ELEMENTAL.id,usageTargets:de(),tags:["",""]},fire_manual_4:{id:"fire_manual_4",name:"",type:"manual",rarity:"epic",tier:"",tierColor:"#FF6347",element:"",baseBonus:"+100%",desc:"",manualIds:["vermillion_bird"],resourceCategory:"MANUAL",resourceLevel:Q.EARTH.key,manualSchool:Se.ELEMENTAL.id,usageTargets:de(),tags:["",""]},fire_manual_5:{id:"fire_manual_5",name:"",type:"manual",rarity:"legendary",tier:"",tierColor:"#FF6347",element:"",baseBonus:"+200%",desc:"",manualIds:["nine_turns_fire","vermillion_bird"],resourceCategory:"MANUAL",resourceLevel:Q.HEAVEN.key,manualSchool:Se.ELEMENTAL.id,usageTargets:de(),tags:["",""]},earth_manual_1:{id:"earth_manual_1",name:"",type:"manual",rarity:"common",tier:"",tierColor:"#8B4513",element:"",baseBonus:"+20%",desc:"",manualIds:["earth_shield"],resourceCategory:"MANUAL",resourceLevel:Q.MORTAL.key,manualSchool:Se.ELEMENTAL.id,usageTargets:de(),tags:["",""]},earth_manual_2:{id:"earth_manual_2",name:"",type:"manual",rarity:"uncommon",tier:"",tierColor:"#8B4513",element:"",baseBonus:"+50%",desc:"",manualIds:["mountain_body"],resourceCategory:"MANUAL",resourceLevel:Q.SPIRIT.key,manualSchool:Se.ELEMENTAL.id,usageTargets:de(),tags:["",""]},earth_manual_3:{id:"earth_manual_3",name:"",type:"manual",rarity:"rare",tier:"",tierColor:"#8B4513",element:"",baseBonus:"+100%",desc:"",manualIds:["earth_shield","mountain_body"],resourceCategory:"MANUAL",resourceLevel:Q.EARTH.key,manualSchool:Se.ELEMENTAL.id,usageTargets:de(),tags:["",""]},earth_manual_4:{id:"earth_manual_4",name:"",type:"manual",rarity:"epic",tier:"",tierColor:"#8B4513",element:"",baseBonus:"+100%",desc:"",manualIds:["mountain_body"],resourceCategory:"MANUAL",resourceLevel:Q.EARTH.key,manualSchool:Se.ELEMENTAL.id,usageTargets:de(),tags:["",""]},earth_manual_5:{id:"earth_manual_5",name:"",type:"manual",rarity:"legendary",tier:"",tierColor:"#8B4513",element:"",baseBonus:"+200%",desc:"",manualIds:["mountain_body"],resourceCategory:"MANUAL",resourceLevel:Q.HEAVEN.key,manualSchool:Se.ELEMENTAL.id,usageTargets:de(),tags:["",""]},thunder_manual_1:{id:"thunder_manual_1",name:"",type:"manual",rarity:"uncommon",tier:"",tierColor:"#9B30FF",element:"",baseBonus:"+50%",desc:"",manualIds:["basic_breath"],resourceCategory:"MANUAL",resourceLevel:Q.SPIRIT.key,manualSchool:Se.VARIANT.id,usageTargets:de(),tags:["",""]},thunder_manual_2:{id:"thunder_manual_2",name:"",type:"manual",rarity:"rare",tier:"",tierColor:"#9B30FF",element:"",baseBonus:"+100%",desc:"",manualIds:["basic_breath"],resourceCategory:"MANUAL",resourceLevel:Q.EARTH.key,manualSchool:Se.VARIANT.id,usageTargets:de(),tags:["",""]},thunder_manual_3:{id:"thunder_manual_3",name:"",type:"manual",rarity:"epic",tier:"",tierColor:"#9B30FF",element:"",baseBonus:"+100%",desc:"",manualIds:["basic_breath"],resourceCategory:"MANUAL",resourceLevel:Q.EARTH.key,manualSchool:Se.VARIANT.id,usageTargets:de(),tags:["",""]},thunder_manual_4:{id:"thunder_manual_4",name:"",type:"manual",rarity:"epic",tier:"",tierColor:"#9B30FF",element:"",baseBonus:"+200%",desc:"",manualIds:["thunder_guide"],resourceCategory:"MANUAL",resourceLevel:Q.EARTH.key,manualSchool:Se.VARIANT.id,usageTargets:de(),tags:["",""]},thunder_manual_5:{id:"thunder_manual_5",name:"",type:"manual",rarity:"legendary",tier:"",tierColor:"#9B30FF",element:"",baseBonus:"+200%",desc:"",manualIds:["thunder_guide","heavenly_demon"],resourceCategory:"MANUAL",resourceLevel:Q.HEAVEN.key,manualSchool:Se.VARIANT.id,usageTargets:de(),tags:["",""]},ice_manual_1:{id:"ice_manual_1",name:"",type:"manual",rarity:"uncommon",tier:"",tierColor:"#87CEEB",element:"",baseBonus:"+20%",desc:"",manualIds:["water_flow"],resourceCategory:"MANUAL",resourceLevel:Q.SPIRIT.key,manualSchool:Se.VARIANT.id,usageTargets:de(),tags:["",""]},ice_manual_2:{id:"ice_manual_2",name:"",type:"manual",rarity:"rare",tier:"",tierColor:"#87CEEB",element:"",baseBonus:"+50%",desc:"",manualIds:["ice_heart"],resourceCategory:"MANUAL",resourceLevel:Q.SPIRIT.key,manualSchool:Se.VARIANT.id,usageTargets:de(),tags:["",""]},ice_manual_3:{id:"ice_manual_3",name:"",type:"manual",rarity:"rare",tier:"",tierColor:"#87CEEB",element:"",baseBonus:"+100%",desc:"",manualIds:["ice_heart"],resourceCategory:"MANUAL",resourceLevel:Q.EARTH.key,manualSchool:Se.VARIANT.id,usageTargets:de(),tags:["",""]},ice_manual_4:{id:"ice_manual_4",name:"",type:"manual",rarity:"epic",tier:"",tierColor:"#87CEEB",element:"",baseBonus:"+100%",desc:"",manualIds:["ice_heart"],resourceCategory:"MANUAL",resourceLevel:Q.EARTH.key,manualSchool:Se.VARIANT.id,usageTargets:de(),tags:["",""]},ice_manual_5:{id:"ice_manual_5",name:"",type:"manual",rarity:"legendary",tier:"",tierColor:"#87CEEB",element:"",baseBonus:"+200%",desc:"",manualIds:["ice_heart"],resourceCategory:"MANUAL",resourceLevel:Q.HEAVEN.key,manualSchool:Se.VARIANT.id,usageTargets:de(),tags:["",""]},wind_manual_1:{id:"wind_manual_1",name:"",type:"manual",rarity:"uncommon",tier:"",tierColor:"#E0E0E0",element:"",baseBonus:"+20%",desc:"",manualIds:["cloud_breath"],resourceCategory:"MANUAL",resourceLevel:Q.SPIRIT.key,manualSchool:Se.VARIANT.id,usageTargets:de(),tags:["",""]},wind_manual_2:{id:"wind_manual_2",name:"",type:"manual",rarity:"rare",tier:"",tierColor:"#E0E0E0",element:"",baseBonus:"+50%",desc:"",manualIds:["wind_freedom"],resourceCategory:"MANUAL",resourceLevel:Q.SPIRIT.key,manualSchool:Se.VARIANT.id,usageTargets:de(),tags:["",""]},wind_manual_3:{id:"wind_manual_3",name:"",type:"manual",rarity:"rare",tier:"",tierColor:"#E0E0E0",element:"",baseBonus:"+100%",desc:"",manualIds:["wind_freedom"],resourceCategory:"MANUAL",resourceLevel:Q.EARTH.key,manualSchool:Se.VARIANT.id,usageTargets:de(),tags:["",""]},wind_manual_4:{id:"wind_manual_4",name:"",type:"manual",rarity:"epic",tier:"",tierColor:"#E0E0E0",element:"",baseBonus:"+100%",desc:"",manualIds:["wind_freedom"],resourceCategory:"MANUAL",resourceLevel:Q.EARTH.key,manualSchool:Se.VARIANT.id,usageTargets:de(),tags:["",""]},wind_manual_5:{id:"wind_manual_5",name:"",type:"manual",rarity:"legendary",tier:"",tierColor:"#E0E0E0",element:"",baseBonus:"+200%",desc:"",manualIds:["wind_freedom"],resourceCategory:"MANUAL",resourceLevel:Q.HEAVEN.key,manualSchool:Se.VARIANT.id,usageTargets:de(),tags:["",""]},cosmic_crystal:{id:"cosmic_crystal",name:"",type:"consumable",rarity:"legendary",desc:"",effect:{kind:"exp",amount:5e4},resourceCategory:"PILL",resourceLevel:Q.HEAVEN.key,usageTargets:de(),tags:["",""]},void_silk:{id:"void_silk",name:"",type:"consumable",rarity:"legendary",desc:"",effect:{kind:"exp",amount:4e4},resourceCategory:"PILL",resourceLevel:Q.HEAVEN.key,usageTargets:de(),tags:["",""]},heavenly_jade:{id:"heavenly_jade",name:"",type:"consumable",rarity:"mythic",desc:"",effect:{kind:"exp",amount:2e5},resourceCategory:"PILL",resourceLevel:Q.DIVINE.key,usageTargets:de(),tags:["",""]},soul_essence_crystal:{id:"soul_essence_crystal",name:"",type:"consumable",rarity:"mythic",desc:"",effect:{kind:"exp",amount:18e4},resourceCategory:"PILL",resourceLevel:Q.DIVINE.key,usageTargets:de(),tags:["",""]},star_core_fragment:{id:"star_core_fragment",name:"",type:"consumable",rarity:"mythic",desc:"",effect:{kind:"exp",amount:35e4},resourceCategory:"PILL",resourceLevel:Q.DIVINE.key,usageTargets:de(),tags:["",""]},celestial_silk_cloth:{id:"celestial_silk_cloth",name:"",type:"consumable",rarity:"mythic",desc:"",effect:{kind:"exp",amount:3e5},resourceCategory:"PILL",resourceLevel:Q.DIVINE.key,usageTargets:de(),tags:["",""]},abyss_stone:{id:"abyss_stone",name:"",type:"consumable",rarity:"mythic",desc:"",effect:{kind:"exp",amount:5e5},resourceCategory:"PILL",resourceLevel:Q.DIVINE.key,usageTargets:de(),tags:["",""]},abyssal_essence:{id:"abyssal_essence",name:"",type:"consumable",rarity:"mythic",desc:"",effect:{kind:"exp",amount:55e4},resourceCategory:"PILL",resourceLevel:Q.DIVINE.key,usageTargets:de(),tags:["",""]},divine_tribulation_stone:{id:"divine_tribulation_stone",name:"",type:"consumable",rarity:"mythic",desc:"",effect:{kind:"exp",amount:6e5},resourceCategory:"PILL",resourceLevel:Q.DIVINE.key,usageTargets:de(),tags:["",""]},god_marrow:{id:"god_marrow",name:"",type:"consumable",rarity:"mythic",desc:"",effect:{kind:"exp",amount:65e4},resourceCategory:"PILL",resourceLevel:Q.DIVINE.key,usageTargets:de(),tags:["",""]},divine_essence_core:{id:"divine_essence_core",name:"",type:"consumable",rarity:"mythic",desc:"",effect:{kind:"exp",amount:8e5},resourceCategory:"PILL",resourceLevel:Q.DIVINE.key,usageTargets:de(),tags:["",""]},soul_tempering_stone:{id:"soul_tempering_stone",name:"",type:"consumable",rarity:"mythic",desc:"",effect:{kind:"exp",amount:75e4},resourceCategory:"PILL",resourceLevel:Q.DIVINE.key,usageTargets:de(),tags:["",""]},void_manifold_crystal:{id:"void_manifold_crystal",name:"",type:"consumable",rarity:"mythic",desc:"",effect:{kind:"exp",amount:1e6},resourceCategory:"PILL",resourceLevel:Q.DIVINE.key,usageTargets:de(),tags:["",""]},condensed_void_essence:{id:"condensed_void_essence",name:"",type:"consumable",rarity:"mythic",desc:"",effect:{kind:"exp",amount:105e4},resourceCategory:"PILL",resourceLevel:Q.DIVINE.key,usageTargets:de(),tags:["",""]},celestial_ascension_token:{id:"celestial_ascension_token",name:"",type:"consumable",rarity:"mythic",desc:"",effect:{kind:"exp",amount:2e6},resourceCategory:"PILL",resourceLevel:Q.DIVINE.key,usageTargets:de(),tags:["",""]},immortal_transformation_essence:{id:"immortal_transformation_essence",name:"",type:"consumable",rarity:"mythic",desc:"",effect:{kind:"exp",amount:22e5},resourceCategory:"PILL",resourceLevel:Q.DIVINE.key,usageTargets:de(),tags:["",""]}},Sr=e=>{const t=Uc[e];if(!t)return null;const n=["weapon","armor","accessory"].includes(t.type),s=t.type==="consumable"||t.type==="manual"||n;return{...t,id:e,instanceId:`${e}_${Date.now()}_${Math.floor(Math.random()*1e4)}`,quantity:1,stackable:s,maxStack:s?99:1}},Vo=e=>Uc[e];function j2(){const[e,t]=b.useState([]),n=b.useRef(e);b.useEffect(()=>{n.current=e},[e]);const s=b.useCallback(p=>{if(typeof p=="function"){t(c=>{const m=p(c);return n.current=m,m});return}n.current=p,t(p)},[]),o=b.useCallback((p=[])=>{const c=p.map(g=>{if(!g)return null;if(typeof g=="string")return Sr(g);if(typeof g=="object"){const h=g.type==="weapon"||g.type==="armor"||g.type==="accessory",v=g.type==="consumable"||g.type==="manual"||h;return{...g,instanceId:g.instanceId||(g.id||"item")+"_"+Date.now()+"_"+Math.floor(Math.random()*1e4),quantity:g.quantity||g.quantity===0?g.quantity:1,stackable:g.stackable??v,maxStack:g.maxStack||(v?99:1)}}return null}).filter(Boolean);if(c.length===0)return[];const y=[...n.current||[]],S=g=>(g==null?void 0:g.stackable)===!0||(g==null?void 0:g.type)==="consumable"||(g==null?void 0:g.type)==="manual"||(g==null?void 0:g.type)==="weapon"||(g==null?void 0:g.type)==="armor"||(g==null?void 0:g.type)==="accessory",E=g=>{if(!g||typeof g!="object")return"";const h=Object.keys(g).sort(),v={};return h.forEach(x=>{v[x]=g[x]}),JSON.stringify(v)},w=g=>(g==null?void 0:g.type)==="weapon"||(g==null?void 0:g.type)==="armor"||(g==null?void 0:g.type)==="accessory";return c.forEach(g=>{if(S(g)){let h=Number(g.quantity??1)||0;const v=Math.max(1,Number(g.maxStack??99)||99);if(h<=0)return;const x=I=>I.id===g.id&&I.name===g.name&&I.rarity===g.rarity&&S(I)&&(!w(g)||I.slot===g.slot&&E(I.stats)===E(g.stats));for(let I=0;I<y.length&&h>0;I+=1){const _=y[I];if(!x(_))continue;const N=Number(_.quantity??1)||1;if(N>=v)continue;const C=v-N,j=Math.min(h,C);_.quantity=N+j,h-=j}for(;h>0;){const I=Math.min(h,v);y.unshift({...g,quantity:I,instanceId:(g.id||"item")+"_"+Date.now()+"_"+Math.floor(Math.random()*1e4)}),h-=I}return}y.unshift(g)}),n.current=y,t(y),c},[]),i=b.useCallback((p,c)=>{const m=n.current||[];let y=[],S=typeof c=="number"?c:void 0,E=[...m];for(let w=0;w<E.length;){const g=E[w];if(String(g.instanceId)!==String(p)){w++;continue}const h=g.quantity||1;if(S===void 0||S>=h){if(y.push({...g}),S=S===void 0?void 0:S-h,E.splice(w,1),S===0)break}else{y.push({...g,quantity:S}),E[w]={...g,quantity:h-S},S=0;break}}return y.length>0&&(n.current=E,t(E)),y.length===0?null:y.length===1?y[0]:y.reduce((w,g)=>w?{...w,quantity:(w.quantity||1)+(g.quantity||1)}:{...g},null)},[]),a=b.useCallback(()=>{n.current=[],t([])},[]),l=b.useCallback(p=>e.find(p),[e]),d=b.useCallback(p=>e.filter(p),[e]),u=b.useCallback(p=>e.filter(c=>c.templateId===p).length,[e]);return{inventory:e,setInventory:s,addItemsToInventory:o,removeItemFromInventory:i,clearInventory:a,findItem:l,filterItems:d,getItemCount:u}}const ya=[{id:"stage_chu_qingyao",name:"",title:"",role:"",tier:"",baseThreat:25,baseExp:7200,powerMultiplier:1,flavor:"",defeatLog:"",unlockNextLog:"",combatStats:{hp:800,maxHp:800,atk:85,def:40},storyBeats:[{delay:1,type:"RIVAL_RISE",tier:"",exp:9e3,detail:"",description:""},{delay:1,type:"RIVAL_ENGAGED",target:"",detail:"",description:""},{delay:1,type:"RIVAL_MARRIAGE",target:"",tier:"",exp:15e3,detail:"",description:""},{delay:1,type:"RIVAL_HEIR",target:"",tier:"",exp:2e4,detail:"",description:""},{delay:1,type:"RIVAL_STAGE_EVENT",tier:"",exp:23e3,detail:"",description:""},{delay:1,type:"RIVAL_STAGE_EVENT",tier:"",exp:25e3,detail:"",description:""}]},{id:"stage_fiance",name:"",title:"",role:"",tier:"",baseThreat:40,baseExp:2e5,powerMultiplier:2.2,flavor:"",defeatLog:"",unlockNextLog:"",combatStats:{hp:1e5,maxHp:1e5,atk:1e4,def:4e3},storyBeats:[{delay:1,type:"RIVAL_STAGE_EVENT",tier:"",exp:5e5,detail:"",description:""},{delay:1,type:"RIVAL_STAGE_EVENT",tier:"",exp:8e5,detail:"",description:""},{delay:1,type:"RIVAL_STAGE_EVENT",tier:"",exp:2e6,detail:"",description:""}]},{id:"stage_family_elder",name:"",title:"",role:"",tier:"",baseThreat:55,baseExp:2e6,powerMultiplier:3.5,flavor:"",defeatLog:"",unlockNextLog:"",combatStats:{hp:1e6,maxHp:1e6,atk:1e5,def:4e4},storyBeats:[{delay:1,type:"RIVAL_STAGE_EVENT",tier:"",exp:5e6,detail:"",description:""},{delay:1,type:"RIVAL_STAGE_EVENT",tier:"",exp:1e7,detail:"",description:""},{delay:1,type:"RIVAL_STAGE_EVENT",tier:"",exp:2e7,detail:"",description:""}]},{id:"stage_sect_elder",name:"",title:"",role:"",tier:"",baseThreat:70,baseExp:1e8,powerMultiplier:6,flavor:"",defeatLog:"",unlockNextLog:"",combatStats:{hp:4e7,maxHp:4e7,atk:4e6,def:16e5},storyBeats:[{delay:1,type:"RIVAL_STAGE_EVENT",tier:"",exp:2e8,detail:"",description:""},{delay:1,type:"RIVAL_STAGE_EVENT",tier:"",exp:5e8,detail:"",description:""},{delay:1,type:"RIVAL_STAGE_EVENT",tier:"",exp:2e9,detail:"",description:""}]}],Pl=ya.length-1,hc=(e=0)=>ya[Math.max(0,Math.min(e,Pl))],ut=[ft.PLAYER,ft.CHILD],Gc={YELLOW:{name:"",baseBuff:.2,color:"#D4AF37"},BLACK:{name:"",baseBuff:.5,color:"#4A4A4A"},EARTH:{name:"",baseBuff:1,color:"#8B4513"},HEAVEN:{name:"",baseBuff:2,color:"#9B30FF"}},Dm={:"",:"",:"",:"",:"",:"",:"",:"",ALL:"",NONE:"",OMNI:"","":""},C2=e=>!e||e==="NONE"?"OMNI":e,T2=(e,t)=>`${e}_${C2(t)}`,mn={basic_breath:{id:"basic_breath",name:"",tier:"YELLOW",element:"NONE",desc:"",rarity:"common",source:""},cloud_breath:{id:"cloud_breath",name:"",tier:"YELLOW",element:"NONE",desc:"",rarity:"common",source:""},golden_light:{id:"golden_light",name:"",tier:"YELLOW",element:"",desc:"",rarity:"common",source:""},azure_sword_art:{id:"azure_sword_art",name:"",tier:"BLACK",element:"",desc:"",rarity:"rare",source:""},evergreen_art:{id:"evergreen_art",name:"",tier:"YELLOW",element:"",desc:"",rarity:"common",source:""},spring_birth:{id:"spring_birth",name:"",tier:"BLACK",element:"",desc:"",rarity:"rare",source:""},water_flow:{id:"water_flow",name:"",tier:"YELLOW",element:"",desc:"",rarity:"common",source:""},ocean_heart:{id:"ocean_heart",name:"",tier:"BLACK",element:"",desc:"",rarity:"rare",source:""},fire_control:{id:"fire_control",name:"",tier:"BLACK",element:"",desc:"",rarity:"rare",source:""},nine_turns_fire:{id:"nine_turns_fire",name:"",tier:"EARTH",element:"",desc:"",rarity:"epic",source:""},vermillion_bird:{id:"vermillion_bird",name:"",tier:"EARTH",element:"",desc:"",rarity:"epic",source:""},earth_shield:{id:"earth_shield",name:"",tier:"YELLOW",element:"",desc:"",rarity:"common",source:""},mountain_body:{id:"mountain_body",name:"",tier:"BLACK",element:"",desc:"",rarity:"rare",source:""},thunder_guide:{id:"thunder_guide",name:"",tier:"HEAVEN",element:"",desc:"",rarity:"legendary",source:""},heavenly_demon:{id:"heavenly_demon",name:"",tier:"HEAVEN",element:"",desc:"",rarity:"legendary",source:""},ice_heart:{id:"ice_heart",name:"",tier:"BLACK",element:"",desc:"",rarity:"rare",source:""},wind_freedom:{id:"wind_freedom",name:"",tier:"BLACK",element:"",desc:"",rarity:"rare",source:""},yin_yang_harmony:{id:"yin_yang_harmony",name:"",tier:"BLACK",element:"NONE",desc:"",rarity:"rare",source:""},blood_demon:{id:"blood_demon",name:"",tier:"EARTH",element:"NONE",desc:"",rarity:"epic",source:""},chaos_origin:{id:"chaos_origin",name:"",tier:"HEAVEN",element:"NONE",desc:"",rarity:"legendary",source:""},five_elements_supreme:{id:"five_elements_supreme",name:"",tier:"HEAVEN",element:"ALL",desc:"",rarity:"legendary",source:""},emperor_scripture:{id:"emperor_scripture",name:"",tier:"HEAVEN",element:"NONE",desc:"",rarity:"legendary",source:""},deep_ocean_scripture:{id:"deep_ocean_scripture",name:"",tier:"EARTH",element:"",desc:"",rarity:"epic",source:""},nine_star_formation:{id:"nine_star_formation",name:"",tier:"BLACK",element:"",desc:"",rarity:"rare",source:""},grass_valley_healing:{id:"grass_valley_healing",name:"",tier:"YELLOW",element:"",desc:"",rarity:"common",source:""},stone_refining:{id:"stone_refining",name:"",tier:"YELLOW",element:"",desc:"",rarity:"common",source:""},ghost_cultivation:{id:"ghost_cultivation",name:"",tier:"EARTH",element:"",desc:"",rarity:"epic",source:""},blood_river:{id:"blood_river",name:"",tier:"BLACK",element:"NONE",desc:"",rarity:"rare",source:""}},I2={basic_breath:{resourceLevel:Q.MORTAL.key,school:Se.GENERAL.id,stage:"",focus:["",""],usageTargets:ut},cloud_breath:{resourceLevel:Q.MORTAL.key,school:Se.GENERAL.id,stage:"",focus:["",""],usageTargets:ut},golden_light:{resourceLevel:Q.MORTAL.key,school:Se.ELEMENTAL.id,stage:"",focus:["",""],usageTargets:ut},azure_sword_art:{resourceLevel:Q.SPIRIT.key,school:Se.ELEMENTAL.id,stage:"",focus:["",""],usageTargets:ut},evergreen_art:{resourceLevel:Q.MORTAL.key,school:Se.ELEMENTAL.id,stage:"",focus:["",""],usageTargets:ut},spring_birth:{resourceLevel:Q.SPIRIT.key,school:Se.ELEMENTAL.id,stage:"",focus:["",""],usageTargets:ut},water_flow:{resourceLevel:Q.MORTAL.key,school:Se.ELEMENTAL.id,stage:"",focus:["",""],usageTargets:ut},ocean_heart:{resourceLevel:Q.SPIRIT.key,school:Se.ELEMENTAL.id,stage:"",focus:["",""],usageTargets:ut},fire_control:{resourceLevel:Q.SPIRIT.key,school:Se.ELEMENTAL.id,stage:"",focus:["",""],usageTargets:ut},nine_turns_fire:{resourceLevel:Q.EARTH.key,school:Se.ELEMENTAL.id,stage:"",focus:["",""],usageTargets:ut},vermillion_bird:{resourceLevel:Q.HEAVEN.key,school:Se.ELEMENTAL.id,stage:"",focus:["",""],usageTargets:ut},earth_shield:{resourceLevel:Q.MORTAL.key,school:Se.ELEMENTAL.id,stage:"",focus:["",""],usageTargets:ut},mountain_body:{resourceLevel:Q.SPIRIT.key,school:Se.ELEMENTAL.id,stage:"",focus:["",""],usageTargets:ut},thunder_guide:{resourceLevel:Q.HEAVEN.key,school:Se.VARIANT.id,stage:"",focus:["",""],usageTargets:ut},heavenly_demon:{resourceLevel:Q.DIVINE.key,school:Se.VARIANT.id,stage:"",focus:["",""],usageTargets:ut},ice_heart:{resourceLevel:Q.SPIRIT.key,school:Se.VARIANT.id,stage:"",focus:["",""],usageTargets:ut},wind_freedom:{resourceLevel:Q.SPIRIT.key,school:Se.VARIANT.id,stage:"",focus:["",""],usageTargets:ut},yin_yang_harmony:{resourceLevel:Q.SPIRIT.key,school:Se.DUAL.id,stage:"",focus:["",""],usageTargets:ut},blood_demon:{resourceLevel:Q.EARTH.key,school:Se.DEVIL.id,stage:"",focus:["",""],usageTargets:ut},chaos_origin:{resourceLevel:Q.DIVINE.key,school:Se.GENERAL.id,stage:"",focus:["",""],usageTargets:ut},five_elements_supreme:{resourceLevel:Q.DIVINE.key,school:Se.ELEMENTAL.id,stage:"",focus:["",""],usageTargets:ut},emperor_scripture:{resourceLevel:Q.DIVINE.key,school:Se.GENERAL.id,stage:"",focus:["",""],usageTargets:ut},deep_ocean_scripture:{resourceLevel:Q.EARTH.key,school:Se.ELEMENTAL.id,stage:"",focus:["",""],usageTargets:ut},nine_star_formation:{resourceLevel:Q.SPIRIT.key,school:Se.ELEMENTAL.id,stage:"",focus:["",""],usageTargets:ut},grass_valley_healing:{resourceLevel:Q.MORTAL.key,school:Se.ELEMENTAL.id,stage:"",focus:["",""],usageTargets:ut},stone_refining:{resourceLevel:Q.MORTAL.key,school:Se.ELEMENTAL.id,stage:"",focus:["",""],usageTargets:ut},ghost_cultivation:{resourceLevel:Q.EARTH.key,school:Se.DEVIL.id,stage:"",focus:["",""],usageTargets:ut},blood_river:{resourceLevel:Q.SPIRIT.key,school:Se.DEVIL.id,stage:"",focus:["",""],usageTargets:ut}};Object.entries(I2).forEach(([e,t])=>{mn[e]&&(mn[e]={...mn[e],resourceCategory:"MANUAL",...t,usageTargets:t.usageTargets?[...t.usageTargets]:[...ut]})});const zl={};Object.entries(mn).forEach(([e,t])=>{var s;const n=T2(t.tier,t.element);if(!zl[n]){const o=((s=Gc[t.tier])==null?void 0:s.name)||t.tier,i=Dm[t.element]||t.element||Dm.NONE;zl[n]={key:n,tier:t.tier,element:t.element,label:`${o}${i}`,manualIds:[]}}zl[n].manualIds.push(e),mn[e].categoryKey=n});const _2=zl,Fm={:"azure_sword_art",:"emperor_scripture",:"fire_control",:"deep_ocean_scripture",:"thunder_guide",:"spring_birth",:"nine_star_formation",:"wind_freedom",:"yin_yang_harmony",:"mountain_body",:"grass_valley_healing",:"stone_refining",:"heavenly_demon",:"ghost_cultivation",:"blood_river"};function jf(e,t){const n=mn[e];if(!n)return{compatibility:.5,level:"poor",desc:""};if(!t||!t.elements)return{compatibility:.8,level:"neutral",desc:"",color:"#999"};const{element:s}=n,{elements:o,type:i}=t;return s==="NONE"?{compatibility:.8,level:"neutral",desc:"",color:"#FFFFFF"}:n.id==="five_elements_supreme"?o.length===5?{compatibility:1.5,level:"perfect",desc:"",color:"#FFD700"}:{compatibility:.1,level:"impossible",desc:"",color:"#FF0000"}:o.includes(s)?o.length===1&&o[0]===s?{compatibility:1.5,level:"perfect",desc:"",color:"#4CAF50"}:{compatibility:1,level:"good",desc:"",color:"#2196F3"}:{compatibility:.5,level:"poor",desc:"",color:"#FF6B6B"}}function Cf(e,t){const n=mn[e];if(!n)return 1;const s=Gc[n.tier],{compatibility:o}=jf(e,t);return 1+s.baseBuff*o}function R2(e){const t=mn[e];if(!t)return null;const n=Gc[t.tier];return{...t,tierName:n.name,tierColor:n.color,baseBuff:n.baseBuff}}const Tf=e=>e?JSON.parse(JSON.stringify(e)):null,xp=[{name:"",key:"pure_yang",rarity:"SR",desc:"",effects:{statBonus:{aptitude:5},speedMultiplier:1.1,feedbackBonus:.05,preferredRoots:["",""],sectAffinity:{ids:["HEAVEN_EMPEROR","THUNDER"],bonus:25}}},{name:"",key:"innate_dao",rarity:"SSR",desc:"",effects:{statBonus:{looks:12,intelligence:5},speedMultiplier:1.15,feedbackBonus:.08,sectAffinity:{levels:["TOP","HIGH"],bonus:20}}},{name:"",key:"ancient_sage",rarity:"UR",desc:"",effects:{statBonus:{aptitude:8,health:25},speedMultiplier:1.2,feedbackBonus:.1,sectAffinity:{ids:["SWORD","HEAVEN_EMPEROR"],bonus:30}}},{name:"",key:"lunar_meridian",rarity:"SSR",desc:"",effects:{statBonus:{aptitude:4,intelligence:4},speedMultiplier:1.08,preferredRoots:["",""],sectAffinity:{ids:["GHOST","FLOWER"],bonus:20}}},{name:"",key:"stellar_bone",rarity:"SSR",desc:"",effects:{statBonus:{aptitude:6},speedMultiplier:1.12,preferredRoots:["",""],feedbackBonus:.06,sectAffinity:{ids:["NINE_STAR","STONE"],bonus:22}}},{name:"",key:"wood_spirit",rarity:"SR",desc:"",effects:{statBonus:{intelligence:6},speedMultiplier:1.05,preferredRoots:["",""],businessBonus:.25,feedbackBonus:.04,sectAffinity:{ids:["GRASS","FLOWER","DAN"],bonus:18}}},{name:"",key:"dragon_blood",rarity:"SR",desc:"",effects:{statBonus:{aptitude:5,health:18},speedMultiplier:1.1,feedbackBonus:.06,sectAffinity:{ids:["SWORD","IRON","BLOOD"],bonus:20}}},{name:"",key:"nether_core",rarity:"UR",desc:"",effects:{statBonus:{aptitude:7},speedMultiplier:1.18,preferredRoots:["",""],feedbackBonus:.09,sectAffinity:{ids:["GHOST","BLOOD"],bonus:28}}},{name:"",key:"fumo_frost_thunder_body",rarity:"UR",desc:"",effects:{statBonus:{aptitude:9,health:12},speedMultiplier:1.22,feedbackBonus:.12,preferredRoots:["",""],sectAffinity:{ids:["SWORD","HEAVEN_EMPEROR"],bonus:35}}},{name:"",key:"fumo_abyssal_flame_core",rarity:"UR",desc:"",effects:{statBonus:{aptitude:7,looks:8},speedMultiplier:1.18,feedbackBonus:.11,preferredRoots:["",""],sectAffinity:{ids:["BLOOD","GHOST"],bonus:30}}}],M2=()=>{const e=xp[Math.floor(Math.random()*xp.length)];return Tf(e)},vy=e=>{if(!e)return null;const t=xp.find(n=>n.key===e);return Tf(t)},Dl=e=>Tf(e),If=(e={},t)=>{var a;if(!((a=t==null?void 0:t.effects)!=null&&a.statBonus))return e;const{aptitude:n=0,looks:s=0,intelligence:o=0,health:i=0}=t.effects.statBonus;return{...e,aptitude:Math.max(1,Math.min(100,(e.aptitude||0)+n)),looks:Math.max(1,Math.min(120,(e.looks||0)+s)),intelligence:Math.max(1,Math.min(100,(e.intelligence||0)+o)),health:Math.max(1,Math.min(150,(e.health||0)+i))}},A2=e=>{var t;return((t=e==null?void 0:e.effects)==null?void 0:t.speedMultiplier)||1},N2=e=>{var t;return((t=e==null?void 0:e.effects)==null?void 0:t.feedbackBonus)||0},L2=e=>{var t;return((t=e==null?void 0:e.effects)==null?void 0:t.businessBonus)||0},$2=e=>{var t;return((t=e==null?void 0:e.effects)==null?void 0:t.sectAffinity)||null},B2=e=>{var t;return((t=e==null?void 0:e.effects)==null?void 0:t.preferredRoots)||null},_f=[{id:0,name:"",level:"JUNIOR",isManagement:!1,description:"",powerScore:4,permissions:[]},{id:1,name:"",level:"JUNIOR",isManagement:!1,description:"",powerScore:8,permissions:[]},{id:2,name:"",level:"MID",isManagement:!1,description:"",powerScore:16,permissions:["access_advanced_techniques"]},{id:3,name:"",level:"HIGH",isManagement:!1,description:"",powerScore:28,permissions:["access_secret_techniques","participate_selection"]},{id:4,name:"",level:"MANAGEMENT",isManagement:!0,description:"",powerScore:36,permissions:["manage_disciples","resource_distribution"]},{id:5,name:"",level:"ELDER",isManagement:!0,description:"",powerScore:48,permissions:["manage_disciples","resource_distribution","recruitment","policy_making"]},{id:6,name:"",level:"SUPREME",isManagement:!0,description:"",powerScore:65,permissions:["manage_all","final_decision","sect_succession"]},{id:100,name:"",level:"SPECIAL",isManagement:!1,description:"",powerScore:32,permissions:["religious_authority"]},{id:101,name:"",level:"ROGUE",isManagement:!1,description:"",powerScore:12,permissions:[]},{id:102,name:"",level:"SOVEREIGN",isManagement:!0,description:"",powerScore:85,permissions:["manage_all","final_decision","sect_succession","declare_war"]}],O2=e=>_f.find(t=>t.name===e)||null,P2=e=>{const t=O2(e);return t?t.powerScore:0},z2={:["meridian_pill","herb_bandage","rice_ball"],:["meridian_pill","beast_core","iron_armor"],:["foundation_pill","thunder_wood","iron_armor","milk_millennium"],:["core_pill","artifact_supreme","marrow_wash","dragon_heart_pill"],:["dragon_heart_pill","moonshadow_saber","thunder_wood","nascent_fruit","core_pill"],:["nascent_fruit","god_transformation_pill","divine_soul_pill","dragon_heart_pill","core_pill"],:["divine_soul_pill","void_condensing_pill","immortal_marrow_pill","heaven_defying_pill","starlight_pill","nascent_fruit"],:["void_refining_pill","space_law_pill","immortal_marrow_pill","divine_soul_pill","void_condensing_pill","heaven_defying_pill"],:["unity_pill","dao_comprehension_pill","harmony_pill","void_stabilization_pill"],:["mahayana_pill","immortal_foundation_pill","semi_immortal_pill"],:["temple_relic","buddhist_scripture"],:["meridian_pill","herb_bandage"]},D2=e=>z2[e]||null,F2=e=>{const t=D2(e);return!t||t.length===0?null:t[Math.floor(Math.random()*t.length)]},H2=()=>_f.map(e=>e.name),An={HEAVEN:{id:"HEAVEN",name:"",color:"#FFD700",min:90,max:100,elementCount:1,multiplier:2.5,desc:""},MUTANT_HEAVEN:{id:"MUTANT_HEAVEN",name:"",color:"#FF00FF",min:100,max:100,elementCount:1,multiplier:2.8,desc:""},MUTANT:{id:"MUTANT",name:"",color:"#00BCD4",min:80,max:89,elementCount:1,multiplier:2,desc:"(//)"},SINGLE:{id:"SINGLE",name:"",color:"#9C27B0",min:80,max:89,elementCount:1,multiplier:1.8,desc:""},DOUBLE:{id:"DOUBLE",name:"",color:"#2196F3",min:60,max:79,elementCount:2,multiplier:1.5,desc:""},TRIPLE:{id:"TRIPLE",name:"",color:"#4CAF50",min:40,max:59,elementCount:3,multiplier:1,desc:""},QUAD:{id:"QUAD",name:"",color:"#FF9800",min:20,max:39,elementCount:4,multiplier:.8,desc:""},WASTE:{id:"WASTE",name:"",color:"#9E9E9E",min:1,max:19,elementCount:5,multiplier:.5,desc:""},NONE:{id:"NONE",name:"",color:"#000000",min:0,max:0,elementCount:0,multiplier:0,desc:""}},W2=["","","","",""],Hm=["","",""],Rf=e=>{if(e<=0)return An.NONE;if(e===100)return Math.random()<.01?An.MUTANT_HEAVEN:An.HEAVEN;if(e>=80&&e<90){const t=Math.random();return t<.01||t<.21?An.MUTANT:An.SINGLE}return e>=1&&e<80&&Math.random()<.01?An.MUTANT:Object.values(An).find(t=>e>=t.min&&e<=t.max)||An.WASTE},qe=[{name:"",maxExp:100,feedback:0,chance:1,desc:""},{name:"",maxExp:500,feedback:1,chance:.95,desc:""},{name:"",maxExp:1e3,feedback:2,chance:.9,desc:""},{name:"",maxExp:2e3,feedback:3,chance:.85,desc:""},{name:"",maxExp:5e3,feedback:5,chance:.8,desc:""},{name:"",maxExp:2e4,feedback:20,chance:.6,desc:""},{name:"",maxExp:5e4,feedback:30,chance:.5,desc:""},{name:"",maxExp:8e4,feedback:40,chance:.4,desc:""},{name:"",maxExp:2e5,feedback:100,chance:.3,desc:""},{name:"",maxExp:5e5,feedback:150,chance:.25,desc:""},{name:"",maxExp:1e6,feedback:200,chance:.2,desc:""},{name:"",maxExp:2e6,feedback:500,chance:.1,desc:""},{name:"",maxExp:5e6,feedback:800,chance:.08,desc:""},{name:"",maxExp:1e7,feedback:1200,chance:.06,desc:""},{name:"",maxExp:2e7,feedback:2e3,chance:.05,desc:""},{name:"",maxExp:5e7,feedback:3500,chance:.04,desc:""},{name:"",maxExp:1e8,feedback:5e3,chance:.03,desc:""},{name:"",maxExp:2e8,feedback:8e3,chance:.025,desc:""},{name:"",maxExp:5e8,feedback:12e3,chance:.02,desc:""},{name:"",maxExp:1e9,feedback:18e3,chance:.015,desc:""},{name:"",maxExp:2e9,feedback:25e3,chance:.012,desc:""},{name:"",maxExp:5e9,feedback:4e4,chance:.01,desc:""},{name:"",maxExp:1e10,feedback:6e4,chance:.008,desc:""},{name:"",maxExp:2e10,feedback:1e5,chance:.006,desc:""},{name:"",maxExp:5e10,feedback:15e4,chance:.005,desc:""},{name:"",maxExp:1e11,feedback:25e4,chance:.004,desc:""},{name:"",maxExp:2e11,feedback:4e5,chance:.003,desc:""},{name:"",maxExp:5e11,feedback:6e5,chance:.002,desc:""},{name:"",maxExp:1e12,feedback:1e6,chance:.001,desc:""}],U2={:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:""},tu=["","","","","","","","","",""],G2=e=>U2[e]||"",V2=e=>{const t=G2(e),n=tu.indexOf(t);return n===-1||n===tu.length-1?null:tu[n+1]},Mf=e=>{const t=qe.findIndex(n=>n.name===e);return t===-1||t===qe.length-1?null:qe[t+1]},Tn=e=>qe.find(t=>t.name===e)||qe[0],Y2=e=>{const t=qe.findIndex(n=>n.name===e);return t>=0?t:0},Yo=(e,t,n,s=null,o=0,i=1)=>{const a={:{hp:100,atk:5,mp:0,def:2},:{hp:500,atk:50,mp:200,def:20},:{hp:800,atk:80,mp:400,def:35},:{hp:1200,atk:120,mp:600,def:50},:{hp:2e3,atk:200,mp:1e3,def:80},:{hp:1e4,atk:1e3,mp:5e3,def:400},:{hp:15e3,atk:1500,mp:8e3,def:600},:{hp:2e4,atk:2e3,mp:12e3,def:800},:{hp:1e5,atk:1e4,mp:5e4,def:4e3},:{hp:2e5,atk:2e4,mp:1e5,def:8e3},:{hp:4e5,atk:4e4,mp:2e5,def:16e3},:{hp:1e6,atk:1e5,mp:5e5,def:4e4},:{hp:2e6,atk:2e5,mp:1e6,def:8e4},:{hp:4e6,atk:4e5,mp:2e6,def:16e4},:{hp:1e7,atk:1e6,mp:5e6,def:4e5},:{hp:2e7,atk:2e6,mp:1e7,def:8e5},:{hp:4e7,atk:4e6,mp:2e7,def:16e5},:{hp:1e8,atk:1e7,mp:5e7,def:4e6},:{hp:2e8,atk:2e7,mp:1e8,def:8e6},:{hp:4e8,atk:4e7,mp:2e8,def:16e6},:{hp:1e9,atk:1e8,mp:5e8,def:4e7},:{hp:2e9,atk:2e8,mp:1e9,def:8e7},:{hp:4e9,atk:4e8,mp:2e9,def:16e7},:{hp:1e10,atk:1e9,mp:5e9,def:4e8},:{hp:2e10,atk:2e9,mp:1e10,def:8e8},:{hp:4e10,atk:4e9,mp:2e10,def:16e8},:{hp:1e11,atk:1e10,mp:5e10,def:4e9},:{hp:2e11,atk:2e10,mp:1e11,def:8e9},:{hp:4e11,atk:4e10,mp:2e11,def:16e9}},l=a[e]||a.;let d=1;Object.values(An).forEach(g=>{g.name===n&&(d=g.multiplier)});const u=1+t/100,c=1+(i>0?Math.min(1,o/i):0)*.3;let m=Math.floor(l.hp*d*u*c),y=Math.floor(l.atk*d*u*c),S=Math.floor((l.def||0)*d*u*c),E=Math.floor(l.mp*d*u*c);return(s?Object.values(s).filter(Boolean):[]).forEach(g=>{const h=g.stats||{};m+=h.hp||0,y+=h.atk||0,S+=h.def||0,E+=h.mp||0}),{hp:m,maxHp:m,atk:y,def:S||Math.floor(y*.4),mp:E,maxMp:E}},Sn=e=>{var l,d;if(!e)return{hp:100,maxHp:100,atk:10,def:5,mp:50,maxMp:50};const t=e.tier||e.tierTitle||"",n=((l=e.stats)==null?void 0:l.aptitude)||50,s=((d=e.spiritRoot)==null?void 0:d.type)||"",o=e.equipment||null,i=e.currentExp||e.cultivation||0,a=e.maxExp||1;return Yo(t,n,s,o,i,a)},Wm=[{name:"",rarity:"RED",effect:3,desc:"+200%",cost:0,bonuses:{speedMultiplier:3,feedbackMultiplier:1.5,sectAffinity:{levels:["TOP"],bonus:35}}},{name:"",rarity:"RED",effect:2.5,desc:"",cost:0,bonuses:{speedMultiplier:2.5,feedbackMultiplier:1.3,flatFeedbackBonus:5}},{name:"",rarity:"RED",effect:2.2,desc:"",cost:0,bonuses:{speedMultiplier:2.2,feedbackMultiplier:1.2,sectAffinity:{ids:["NINE_STAR","HEAVEN_EMPEROR"],bonus:30}}},{name:"",rarity:"ORANGE",effect:2,desc:"+100%",cost:0,bonuses:{speedMultiplier:2,sectAffinity:{ids:["NINE_STAR"],bonus:18}}},{name:"",rarity:"ORANGE",effect:1.8,desc:"100%",cost:0,bonuses:{speedMultiplier:1.8,sectAffinity:{ids:["SWORD"],bonus:28}}},{name:"",rarity:"ORANGE",effect:1.4,desc:"+40%",cost:0,bonuses:{speedMultiplier:1.4,businessBonus:.4,feedbackMultiplier:1.15}},{name:"",rarity:"ORANGE",effect:1.6,desc:"",cost:0,bonuses:{speedMultiplier:1.6,feedbackMultiplier:1.1,sectAffinity:{ids:["HEAVEN_EMPEROR","THUNDER"],bonus:22}}},{name:"",rarity:"PURPLE",effect:1.5,desc:"+50%",cost:0,bonuses:{speedMultiplier:1.5,sectAffinity:{ids:["IRON","STONE"],bonus:15}}},{name:"",rarity:"PURPLE",effect:1.5,desc:"",cost:0,bonuses:{speedMultiplier:1.5,feedbackMultiplier:1.05}},{name:"",rarity:"PURPLE",effect:1.3,desc:"",cost:0,bonuses:{speedMultiplier:1.3,businessBonus:.25,sectAffinity:{ids:["GRASS","DAN"],bonus:16}}},{name:"",rarity:"PURPLE",effect:1.4,desc:"",cost:0,bonuses:{speedMultiplier:1.4,sectAffinity:{ids:["THUNDER","DEMON"],bonus:18}}},{name:"",rarity:"BLUE",effect:1.2,desc:"+20%",cost:0,bonuses:{speedMultiplier:1.2}},{name:"",rarity:"BLUE",effect:1.2,desc:"",cost:0,bonuses:{speedMultiplier:1.2,feedbackMultiplier:1.05}},{name:"",rarity:"BLUE",effect:1.15,desc:"",cost:0,bonuses:{speedMultiplier:1.15,sectAffinity:{ids:["IRON"],bonus:12}}},{name:"",rarity:"GREEN",effect:1.1,desc:"",cost:0,bonuses:{speedMultiplier:1.1}},{name:"",rarity:"GREEN",effect:1.1,desc:"",cost:0,bonuses:{speedMultiplier:1.1,sectAffinity:{levels:["MID"],bonus:8}}},{name:"",rarity:"GREEN",effect:1.08,desc:"",cost:0,bonuses:{speedMultiplier:1.08,feedbackMultiplier:1.05}},{name:"",rarity:"WHITE",effect:.9,desc:"",cost:5,bonuses:{speedMultiplier:.9,feedbackMultiplier:.9}},{name:"",rarity:"WHITE",effect:.8,desc:"-20%",cost:0,bonuses:{speedMultiplier:.8}},{name:"",rarity:"WHITE",effect:.85,desc:"",cost:0,bonuses:{speedMultiplier:.85,feedbackMultiplier:.9}}],Er=[{id:"SWORD",name:"",level:"TOP",minApt:80,tuition:500,prefElements:[""],buff:1.5,risk:.02,resourceTypes:["",""],initialRankProb:{:.15,:.35,:.5},desc:"",scale:"",promotionEase:.85,requirements:{minApt:80,requiredElements:[""],allowedRootTypes:["","",""],notes:""}},{id:"HEAVEN_EMPEROR",name:"",level:"TOP",minApt:85,tuition:600,prefElements:["",""],buff:1.6,risk:.03,resourceTypes:["",""],initialRankProb:{:.2,:.4,:.4},desc:"",scale:"",promotionEase:.75,requirements:{minApt:85,allowedRootTypes:["",""],notes:""}},{id:"STAR_PALACE",name:"",level:"TOP",minApt:82,tuition:520,prefElements:["",""],buff:1.55,risk:.025,resourceTypes:["",""],initialRankProb:{:.18,:.37,:.45},desc:"",scale:"",promotionEase:.82,requirements:{minApt:82,allowedRootTypes:["","",""],notes:""}},{id:"VOID_TEMPLE",name:"",level:"TOP",minApt:83,tuition:480,prefElements:["",""],buff:1.52,risk:.028,resourceTypes:["",""],initialRankProb:{:.17,:.33,:.5},desc:"",scale:"",promotionEase:.8,requirements:{minApt:83,requiredElements:["",""],allowedRootTypes:["","",""],notes:""}},{id:"DAN",name:"",level:"HIGH",minApt:60,tuition:300,prefElements:["",""],buff:1.25,risk:.03,resourceTypes:["",""],initialRankProb:{:.1,:.4,:.5},desc:"",scale:"",promotionEase:1,requirements:{minApt:60,requiredElements:["",""],notes:""}},{id:"OCEAN_PALACE",name:"",level:"HIGH",minApt:65,tuition:350,prefElements:[""],buff:1.3,risk:.02,resourceTypes:["",""],initialRankProb:{:.12,:.38,:.5},desc:"",scale:"",promotionEase:.95,requirements:{minApt:65,requiredElements:[""],notes:""}},{id:"THUNDER",name:"",level:"HIGH",minApt:70,tuition:400,prefElements:[""],buff:1.4,risk:.04,resourceTypes:["",""],initialRankProb:{:.15,:.35,:.5},desc:"",scale:"",promotionEase:.9,requirements:{minApt:70,requiredElements:[""],notes:""}},{id:"GLACIER",name:"",level:"HIGH",minApt:68,tuition:320,prefElements:["",""],buff:1.28,risk:.03,resourceTypes:["",""],initialRankProb:{:.13,:.34,:.53},desc:"",scale:"",promotionEase:.97,requirements:{minApt:68,requiredElements:["",""],notes:""}},{id:"FLOWER",name:"",level:"MID",minApt:40,tuition:100,prefElements:["",""],buff:1.15,risk:.01,resourceTypes:["",""],initialRankProb:{:.05,:.25,:.7},desc:"",scale:"",promotionEase:1.05,requirements:{minApt:40,minLooks:75,requiredElements:["",""],notes:""}},{id:"NINE_STAR",name:"",level:"MID",minApt:45,tuition:120,prefElements:["",""],buff:1.18,risk:.02,resourceTypes:["",""],initialRankProb:{:.06,:.24,:.7},desc:"",scale:"",promotionEase:1,requirements:{minApt:45,requiredElements:["",""],notes:""}},{id:"WIND",name:"",level:"MID",minApt:50,tuition:150,prefElements:[""],buff:1.2,risk:.015,resourceTypes:["",""],initialRankProb:{:.08,:.27,:.65},desc:"",scale:"",promotionEase:1.1,requirements:{minApt:50,requiredElements:[""],notes:""}},{id:"HARMONY",name:"",level:"MID",minApt:35,tuition:80,prefElements:["",""],buff:1.12,risk:.01,resourceTypes:["",""],initialRankProb:{:.04,:.21,:.75},desc:"",scale:"",promotionEase:1.08,requirements:{minApt:35,minLooks:70,notes:""}},{id:"IRON",name:"",level:"LOW",minApt:20,tuition:50,prefElements:[""],buff:1.1,risk:.005,resourceTypes:["",""],initialRankProb:{:.02,:.15,:.83},desc:"",scale:"",promotionEase:1.2,requirements:{minApt:20,notes:""}},{id:"GRASS",name:"",level:"LOW",minApt:25,tuition:60,prefElements:[""],buff:1.08,risk:.005,resourceTypes:["",""],initialRankProb:{:.03,:.17,:.8},desc:"",scale:"",promotionEase:1.25,requirements:{minApt:25,requiredElements:[""],notes:""}},{id:"STONE",name:"",level:"LOW",minApt:20,tuition:40,prefElements:["",""],buff:1.05,risk:.003,resourceTypes:["",""],initialRankProb:{:.01,:.12,:.87},desc:"",scale:"",promotionEase:1.18,requirements:{minApt:20,requiredElements:["",""],notes:""}},{id:"EMBER",name:"",level:"LOW",minApt:18,tuition:30,prefElements:[""],buff:1.02,risk:.004,resourceTypes:["",""],initialRankProb:{:.01,:.1,:.89},desc:"",scale:"",promotionEase:1.3,requirements:{minApt:18,requiredElements:["",""],notes:""}},{id:"DEMON",name:"",level:"RECKLESS",minApt:30,tuition:0,prefElements:["",""],buff:2,risk:.1,resourceTypes:["",""],initialRankProb:{:.08,:.22,:.7},desc:"",scale:"",promotionEase:1.2,requirements:{minApt:30,allowedRootTypes:["","",""],notes:""}},{id:"GHOST",name:"",level:"RECKLESS",minApt:35,tuition:0,prefElements:[""],buff:1.8,risk:.08,resourceTypes:["",""],initialRankProb:{:.1,:.25,:.65},desc:"",scale:"",promotionEase:1.1,requirements:{minApt:35,requiredElements:["",""],notes:""}},{id:"BLOOD",name:"",level:"RECKLESS",minApt:25,tuition:0,prefElements:["",""],buff:1.7,risk:.12,resourceTypes:["",""],initialRankProb:{:.05,:.2,:.75},desc:"",scale:"",promotionEase:1.15,requirements:{minApt:25,requiredElements:["",""],notes:""}},{id:"SHADOW_PAVILION",name:"",level:"RECKLESS",minApt:28,tuition:0,prefElements:["",""],buff:1.65,risk:.09,resourceTypes:["",""],initialRankProb:{:.07,:.23,:.7},desc:"",scale:"",promotionEase:1.18,requirements:{minApt:28,requiredElements:["",""],notes:""}},{id:"NONE",name:"",level:"NONE",minApt:0,tuition:0,prefElements:[],buff:.8,risk:0,resourceTypes:[""],initialRankProb:{:1},desc:"",scale:"",promotionEase:1,requirements:{minApt:0,notes:""}}],Sy=e=>Er.find(t=>t.id===e)||Er.find(t=>t.id==="NONE"),ea=(e,t)=>{var u,p;if(!t||!t.initialRankProb)return"";const n={...t.initialRankProb};if((((u=e.stats)==null?void 0:u.aptitude)||50)>=(t.minApt||0)+20&&n.!==void 0){const c=Math.min(n.,.3);n.-=c,n.=(n.||0)+c*.6,n.=(n.||0)+c*.4}Array.isArray((p=e.spiritRoot)==null?void 0:p.elements)&&Array.isArray(t.prefElements)&&e.spiritRoot.elements.forEach(c=>{t.prefElements.includes(c)&&(n.=(n.||0)+.05,n.=(n.||0)+.03,n.&&(n.=Math.max(0,n.-.08)))});const o=t.promotionEase??1;if(o!==1){const c=Math.max(.3,Math.min(2,o));n.&&(n.*=c),n.&&(n.*=c),n.&&(n./=c),n.&&(n./=c)}const i=Object.keys(n);let a=i.reduce((c,m)=>c+(n[m]||0),0);if(a<=0)return"";i.forEach(c=>n[c]=(n[c]||0)/a);const l=Math.random();let d=0;for(const c of i)if(d+=n[c],l<=d)return c;return i[i.length-1]},q2=e=>e?e.resourceTypes||[]:[];H2();const wy=(e,t)=>{var l,d,u,p,c;if(!e||!t)return 0;let n=0;Array.isArray((l=e.spiritRoot)==null?void 0:l.elements)&&(e.spiritRoot.elements.forEach(m=>{t.prefElements&&t.prefElements.includes(m)&&(n+=50,e.spiritRoot.elements.length===1&&(n+=30))}),e.spiritRoot.type===""&&t.level==="TOP"&&(n+=50),e.spiritRoot.type===""&&(t.id==="DEMON"&&(n+=60),t.id==="THUNDER"&&(n+=50),t.id==="GHOST"&&e.spiritRoot.elements.includes("")&&(n+=50),t.id==="WIND"&&e.spiritRoot.elements.includes("")&&(n+=50),t.id==="HEAVEN_EMPEROR"&&(n+=40)));const s=((d=e.stats)==null?void 0:d.aptitude)||0,o=(t.minApt||0)-s;if(o<=0){const m=s-(t.minApt||0);n+=Math.min(40,m),m>=20&&t.level==="TOP"&&(n+=20)}else n-=o*2;if(t.level==="TOP"?n-=5:t.level==="RECKLESS"?n+=15:t.level==="LOW"&&(n-=10),t.id==="FLOWER"||t.id==="HARMONY"){const m=((u=e.stats)==null?void 0:u.looks)||50;m>=80?n+=30:m>=60&&(n+=15)}const i=$2(e.constitution);if(i){const m=i.bonus||15;i.ids&&i.ids.includes(t.id)?n+=m:i.levels&&i.levels.includes(t.level)&&(n+=Math.max(8,m*.6))}const a=(c=(p=e.trait)==null?void 0:p.bonuses)==null?void 0:c.sectAffinity;if(a){const m=a.bonus||12;a.ids&&a.ids.includes(t.id)?n+=m:a.levels&&a.levels.includes(t.level)&&(n+=Math.max(6,m*.5))}return Math.round(n)},ky=(e,t)=>{var p,c,m,y,S,E,w,g;if(!e||!t)return{qualified:!1,reasons:[""],summary:"",notes:""};const n=t.requirements||{},s=((p=e.stats)==null?void 0:p.aptitude)??0,o=((c=e.stats)==null?void 0:c.looks)??0,i=(m=e.spiritRoot)==null?void 0:m.type,a=((y=e.spiritRoot)==null?void 0:y.elements)||[],l=n.minApt??t.minApt??0,d=[],u=[];return l>0&&d.push(`${l}`),(S=n.requiredElements)!=null&&S.length&&d.push(`${n.requiredElements.join("")}`),(E=n.allowedRootTypes)!=null&&E.length&&d.push(`${n.allowedRootTypes.join("")}`),n.minLooks&&d.push(`${n.minLooks}`),n.customText&&d.push(n.customText),s<l&&u.push(`${l}`),n.minLooks&&o<n.minLooks&&u.push(`${n.minLooks}`),(w=n.allowedRootTypes)!=null&&w.length&&i&&(n.allowedRootTypes.includes(i)||u.push(`${n.allowedRootTypes.join("")}`)),(g=n.requiredElements)!=null&&g.length&&(a.some(v=>n.requiredElements.includes(v))||u.push(`${n.requiredElements.join("")}`)),{qualified:u.length===0,reasons:u,summary:d.join(""),notes:n.notes||""}},Vc=(e,t=!1)=>{var n,s,o,i,a,l,d,u;try{let p=t?10:120;const c=((n=e.stats)==null?void 0:n.aptitude)||50,y=.5+Math.max(0,Math.min(100,c))/100*2.5;p*=y;const S=((s=e.stats)==null?void 0:s.intelligence)||50,w=.6+Math.max(0,Math.min(100,S))/100*1.4;p*=w;const g=qe.findIndex(x=>x.name===e.tier);if(g>=0){const x=1+g/qe.length*1.5;p*=x}if((o=e.spiritRoot)!=null&&o.multiplier){const x=e.spiritRoot.multiplier;typeof x=="number"&&isFinite(x)&&(p*=x)}if(e.cultivationMethod&&e.spiritRoot)try{const x=Cf(e.cultivationMethod,e.spiritRoot);typeof x=="number"&&isFinite(x)&&(p*=x)}catch(x){console.error("Error calculating manual multiplier:",x)}const h=((a=(i=e.trait)==null?void 0:i.bonuses)==null?void 0:a.speedMultiplier)??((l=e.trait)==null?void 0:l.effect)??1;typeof h=="number"&&isFinite(h)&&(p*=h),(u=(d=e.trait)==null?void 0:d.bonuses)!=null&&u.flatSpeedBonus&&typeof e.trait.bonuses.flatSpeedBonus=="number"&&(p+=e.trait.bonuses.flatSpeedBonus);const v=A2(e.constitution);return typeof v=="number"&&isFinite(v)&&(p*=v),e.sect&&e.sect.level!=="NONE"&&(p*=1.5),!isFinite(p)||isNaN(p)?(console.error("Invalid cultivation speed calculated:",p),t?10:120):Math.floor(p)}catch(p){return console.error("Error in calculateCultivationSpeed:",p),t?10:120}},xc=(e,t={})=>{var n,s,o,i,a;try{if(e.age<6)return 0;const l=e.tierTitle||e.tier||"";if(l==="")return 0;const d=Tn(l);if(!d)return 0;let u=d.feedback||0;if(u===0)return 0;let p=0;l.includes("")?p=e.age<16?1:2:l.includes("")?p=u*.7:l.includes("")||l.includes("")?p=u*1:p=u*.5,e.age<16&&!l.includes("")&&(p*=.5);const c=((s=(n=e.trait)==null?void 0:n.bonuses)==null?void 0:s.feedbackMultiplier)??1,m=((i=(o=e.trait)==null?void 0:o.bonuses)==null?void 0:i.flatFeedbackBonus)||0,y=1+N2(e.constitution);p=p*c*y+m;const S=((a=e.stats)==null?void 0:a.aptitude)||50,E=Math.max(.1,(S||50)/50);p*=E;let w=1;e.rank===""&&(w=1.2),e.rank===""&&(w=1.5),e.rank===""&&(w=2),p*=w;let g=1;if(e.cultivationMethod&&e.spiritRoot)try{g=Cf(e.cultivationMethod,e.spiritRoot),isFinite(g)||(g=1)}catch(x){console.error("Error calculating manual multiplier for child:",e.name,x),g=1}p*=g;const h=t.familyRatingMultiplier??1;p*=h;const v=Math.max(0,Math.floor(p));return isFinite(v)?v:0}catch(l){return console.error("Error in calculateChildFeedback:",l),0}},K2={:4,:8,:16,:28,:36,:48,:65,:85},Q2={TOP:32,HIGH:22,MID:14,LOW:9,RECKLESS:18,NONE:0},Ar=[{id:"SEED",label:"",minScore:0,color:"#9e9e9e",tagline:""},{id:"BACKBONE",label:"",minScore:80,color:"#4caf50",tagline:""},{id:"ELITE",label:"",minScore:140,color:"#2196f3",tagline:""},{id:"ELDER",label:"",minScore:200,color:"#ff9800",tagline:""},{id:"SOVEREIGN",label:"",minScore:280,color:"#e91e63",tagline:""}],Vs=[{id:"CLAN_SEED",name:"",desc:"",requirements:{minMembers:1,minPower:0,minStones:0},feedbackMultiplier:1,feedbackDesc:"1.0 ()"},{id:"LOCAL_CLAN",name:"",desc:"",requirements:{minMembers:5,minPower:100,minStones:500,minOuterDoor:2},feedbackMultiplier:1.5,feedbackDesc:"1.5 (+50%)"},{id:"CITY_NOBLE",name:"",desc:"",requirements:{minMembers:8,minPower:200,minStones:1500,minInnerDoor:2},feedbackMultiplier:3,feedbackDesc:"3.0 (+200%)"},{id:"REGION_PILLAR",name:"",desc:"",requirements:{minMembers:12,minPower:350,minStones:5e3,minDiscipleRank:2},feedbackMultiplier:6,feedbackDesc:"6.0 (+500%)"},{id:"SECT_ALLY",name:"",desc:"",requirements:{minMembers:18,minPower:600,minStones:1e4,minSteward:1},feedbackMultiplier:12,feedbackDesc:"12.0 (+1100%)"},{id:"IMMORTAL_DYNASTY",name:"",desc:"",requirements:{minMembers:22,minPower:900,minStones:2e4,minElders:1},feedbackMultiplier:25,feedbackDesc:"25.0 (+2400%)"},{id:"HEAVENLY_HEGEMONY",name:"",desc:"",requirements:{minMembers:28,minPower:1400,minStones:4e4,minElders:2,minSovereigns:1},feedbackMultiplier:100,feedbackDesc:"100.0 (+9900%)"}],J2=e=>{const t=Vs.find(n=>n.id===e);return(t==null?void 0:t.feedbackMultiplier)??1},X2=e=>{const t=qe.findIndex(n=>n.name===e);return Math.max(0,t)*8},Z2=(e,t)=>{if(!e)return t?6:0;const n=P2(e);return n>0?n:K2[e]??(t?6:0)},ew=e=>e?Q2[e.level]??10:0,tw=e=>e?e.includes("")?18:e===""?8:e===""?40:0:0,Ey=e=>Math.max(0,Math.min(1,e)),jy=(e={})=>{if(!e)return{score:0,tierId:Ar[0].id,label:Ar[0].label,color:Ar[0].color,progress:0,tagline:Ar[0].tagline,tierStart:0,nextThreshold:Ar[1].minScore,isElder:!1,isSovereign:!1};const t=e.tierTitle||e.tier||"",n=X2(t),s=Z2(e.rank,!!e.sect),o=ew(e.sect),i=tw(e.rank),a=e.cultivationManual?8:0,l=e.spouse?5:0,d=Math.round(n+s+o+i+a+l),u=[...Ar].reverse().find(w=>d>=w.minScore)||Ar[0],p=Ar.findIndex(w=>w.id===u.id),c=Ar[p+1]||null,m=c?Math.max(1,c.minScore-u.minScore):1,y=c?Ey((d-u.minScore)/m):1,S=e.rank&&(e.rank.includes("")||e.rank===""),E=e.rank==="";return{score:d,tierId:u.id,label:u.label,color:u.color,tagline:u.tagline,tierStart:u.minScore,nextThreshold:(c==null?void 0:c.minScore)??d,progress:y,nextLabel:(c==null?void 0:c.label)||"",isElder:S||u.id==="ELDER"||u.id==="SOVEREIGN",isSovereign:E||u.id==="SOVEREIGN"}},Cy=Vs[0],nw=e=>{const t=Vs.findIndex(n=>n.id===e);return t>=0?{tier:Vs[t],index:t}:{tier:Cy,index:0}},Nr=(e,t,n)=>({label:e,current:t,required:n,met:t>=n}),rw={:7,:6,:5,:4,:3,:2,:1,:0},sw=e=>e?rw[e]??-1:-1,gl=(e,t)=>e.filter(n=>sw(n.rank)>=t).length,ow=(e=[],t={})=>{var N,C,j,T;const n=((N=t.familyRating)==null?void 0:N.currentId)||Cy.id,{tier:s,index:o}=nw(n),i=Vs[o+1]||null,a=e.filter(A=>(A.generation||1)<=2),l=a.map(A=>({id:A.id,name:A.name,generation:A.generation,influence:jy(A)})),d=l.reduce((A,V)=>A+V.influence.score,0),u=l.filter(A=>A.influence.isElder).length,p=l.filter(A=>A.influence.isSovereign).length,c=gl(a,1),m=gl(a,2),y=gl(a,3),S=gl(a,4),E=e.length+1,w=((C=t.resources)==null?void 0:C.spiritStones)||0,g=Math.round(d+E*5+w/200),h=((j=s.requirements)==null?void 0:j.minPower)??0,v=((T=i==null?void 0:i.requirements)==null?void 0:T.minPower)??g,x=i?Ey((g-h)/Math.max(1,v-h)):1,I=[];if(i){const A=i.requirements||{};A.minMembers!==void 0&&I.push(Nr("",E,A.minMembers)),A.minPower!==void 0&&I.push(Nr("",g,A.minPower)),A.minStones!==void 0&&I.push(Nr("",w,A.minStones)),A.minOuterDoor!==void 0&&I.push(Nr("",c,A.minOuterDoor)),A.minInnerDoor!==void 0&&I.push(Nr("",m,A.minInnerDoor)),A.minDiscipleRank!==void 0&&I.push(Nr("",y,A.minDiscipleRank)),A.minSteward!==void 0&&I.push(Nr("",S,A.minSteward)),A.minElders!==void 0&&I.push(Nr("",u,A.minElders)),A.minSovereigns!==void 0&&I.push(Nr("",p,A.minSovereigns))}const _=i?I.every(A=>A.met):!1;return{enrichedChildren:l,childInfluenceMap:l.reduce((A,V)=>(A[V.id]=V.influence,A),{}),totals:{population:E,stones:w,totalPower:d,elderCount:u,sovereignCount:p,outerDoorCount:c,innerDoorCount:m,discipleRankCount:y,stewardCount:S,ratingScore:g,powerProgress:x},currentTier:s,currentIndex:o,nextTier:i,requirements:I,canUpgrade:_}},Lr=ya[0],Fl=Gl(),iw={...Fl.spiritRoot},_o={name:"",age:16,gender:"",avatar:{base:0,skinColor:0,hair:1,hairColor:0,eye:0,eyeColor:1,mouth:0},tier:Fl.tier,currentExp:Fl.currentExp,maxExp:Fl.maxExp,resources:{spiritStones:100,money:50},stats:{looks:80,cunning:60,aptitude:15,intelligence:60,health:80},familyRating:{currentId:Vs[0].id,history:[]},skillPoints:0,usedRedeemCodes:[],breakthroughBonus:0,breakthroughFailCount:0,newsBuffer:[],gazetteHistory:[],gazetteIssue:0,hasUnreadGazette:!1,worldNpcs:[],specialCollections:{fumoSwords:[]},specialFlags:{fumoDuoUnlocked:!1,fumoDuoMet:!1},rival:{name:Lr.name,stageId:Lr.id,state:"NORMAL",lifeStage:0,storyTimer:0,threatLevel:Lr.baseThreat??0,rumorCount:0,hiddenTurns:0,isDead:!1,relationValue:-100,tier:Lr.tier,currentExp:Lr.baseExp,stats:{aptitude:95,looks:80,intelligence:90,health:80},combatStats:{hp:Lr.combatStats.hp,maxHp:Lr.combatStats.maxHp,atk:Lr.combatStats.atk,def:Lr.combatStats.def}},revengeProgress:{currentStageIndex:0,completedStages:[],sagaComplete:!1},revengeActions:{lastRumorMonth:0,totalRumors:0,assassinationAttempts:0,hidingMonths:0},spiritRoot:iw,cultivationMethod:"basic_breath",combatStats:{hp:300,maxHp:300,atk:25,def:8,mp:120,maxMp:120},time:{year:3572,month:9,season:""},status:["",""],childrenStrategy:{skipZhaozhou:!1}},aw={aptitude:{name:"",desc:"",trainable:!0,howToIncrease:"",howToRestore:"",effect:""},luck:{name:"",desc:"",trainable:!0,howToIncrease:"NPC",howToRestore:"",effect:""},lifespan:{name:"",desc:"",trainable:!1,howToIncrease:"",effect:""},looks:{name:"",desc:"",trainable:!0,howToIncrease:"",howToRestore:"",effect:""},cunning:{name:"",desc:"",trainable:!0,howToIncrease:"",howToRestore:"/",effect:""},health:{name:"",desc:"0-100",trainable:!1,howToIncrease:"NPC",howToRestore:"5-10",effect:"4020",energyLimitFormula:"max(5, 20 - (100 - health) * 0.15)  // "},intelligence:{name:"",desc:"",trainable:!0,howToIncrease:"",howToRestore:"",effect:""}};function lw(e){return aw[e]||{name:e,desc:"",trainable:!1,howToIncrease:"",howToRestore:"",effect:""}}function Bt(e,t=20){if(e==null)return t;const s=(100-Math.max(0,Math.min(100,e)))*.15;return Math.max(5,t-s)}function cw(e,t){const n=Math.max(0,e-t),s=e-n;let o="";return s>30?o="":s>15&&(o=""),{newHealth:n,healthLost:s,severity:o,damageDisplay:`${o} ${s} ${e}  ${n}`}}const Um={EXPLORATION:{name:"",icon:"",minDamage:5,maxDamage:20,severity:""},ASSASSINATION:{name:"",icon:"",minDamage:15,maxDamage:40,severity:""},DUEL:{name:"",icon:"",minDamage:20,maxDamage:50,severity:""},ROMANCE:{name:"",icon:"",minDamage:3,maxDamage:10,severity:""},DISASTER:{name:"",icon:"",minDamage:10,maxDamage:30,severity:""}};function qo(e,t,n="EXPLORATION"){var p;const s=((p=e.stats)==null?void 0:p.health)||50,o=Um[n]||Um.EXPLORATION,i=cw(s,t),a=Bt(s),l=Bt(i.newHealth),d=a-l,u=`
${o.icon} ${o.name}
${i.damageDisplay}

${i.newHealth<20?" ":""}
${d>0?`  ${d.toFixed(1)}  ${a.toFixed(1)}  ${l.toFixed(1)}`:""}
  `.trim();return{newHealth:i.newHealth,healthLost:i.healthLost,severity:i.severity,message:u,energyPenalty:Math.max(0,d),isSerious:i.newHealth<20}}function dw(e,t,n="REST"){var m;const s=((m=e.stats)==null?void 0:m.health)||50,o=Bt(s),i=Math.min(100,s+t),a=i-s,l=Bt(i),d=l-o;let u="",p="";n==="MEDICINE"?(u="",p=""):n==="HEALER"&&(u="",p="");const c=`
${u} ${p}
 ${a} ${s}  ${i}

${d>0?`  ${d.toFixed(1)}  ${o.toFixed(1)}  ${l.toFixed(1)}`:""}
${i===100?" ":""}
  `.trim();return{newHealth:i,recovered:a,message:c,energyBonus:Math.max(0,d)}}function uw(e){var d;const t=((d=e.stats)==null?void 0:d.health)||50,n=5+Math.floor(Math.random()*6),s=e.currentExp||0,o=Math.floor(s/1e3*.5),i=n+o,a=Math.min(100,t+i),l=a-t;return{newHealth:a,recovered:l,message:l>0?` +${l}${t}  ${a}`:null}}function Af(e){var n;const t=((n=e.stats)==null?void 0:n.health)||50;return{canExplore:t>=20,canDuel:t>=30,canAssassinate:t>=25,health:t,reason:t<20?"":t<30?"":""}}const pw=10,Ty=e=>{var o;if(!e)return e;const t=pw,n=Bt(t),s=Math.floor((((o=e.resources)==null?void 0:o.spiritStones)||0)*.5);return{...e,currentExp:0,stats:{...e.stats,health:t},energy:Math.min(e.energy||20,n),resources:{...e.resources,spiritStones:s}}},fw=e=>{const t=Ty(e);return!t||t===e||Object.assign(e,t),e};function mw(){const[e,t]=b.useState({..._o,businesses:[],gazetteHistory:[],gazetteIssue:0,hasUnreadGazette:!1,newsBuffer:[],lastAuctionYear:null,currentAuction:null,auctionWindowStart:null,auctionWindowEnd:null,energy:_o.energy??20,soldAuctionItems:[]}),n=b.useCallback(C=>{t(j=>({...j,...C}))},[]),s=b.useCallback(C=>{t(j=>{const T={...j.stats,...C};let A=j.energy;if(typeof C.health=="number"){const V=Bt(C.health);A=Math.min(j.energy,V)}return{...j,stats:T,energy:A}})},[]),o=b.useCallback(C=>{t(j=>({...j,time:{...j.time,...C}}))},[]),i=b.useCallback(C=>{t(j=>({...j,cultivation:typeof C=="function"?C(j.cultivation):C}))},[]),a=b.useCallback(C=>{t(j=>{const T={...j.resources};return C.spirit&&(T.spirit=(j.resources.spirit||0)+C.spirit),C.spirit2&&(T.spirit2=(j.resources.spirit2||0)+C.spirit2),C.spiritStones!==void 0&&(T.spiritStones=(j.resources.spiritStones||0)+C.spiritStones),{...j,resources:T}})},[]),l=b.useCallback(C=>{t(j=>{const T={...j.resources};return C.spirit&&(T.spirit=Math.max(0,(j.resources.spirit||0)-C.spirit)),C.spirit2&&(T.spirit2=Math.max(0,(j.resources.spirit2||0)-C.spirit2)),C.spiritStones!==void 0&&(T.spiritStones=Math.max(0,(j.resources.spiritStones||0)-C.spiritStones)),{...j,resources:T}})},[]),d=b.useCallback(C=>{t(j=>({...j,energy:typeof C=="function"?C(j.energy||0):Math.max(0,(j.energy||0)+C)}))},[]),u=b.useCallback((C=1)=>{t(j=>({...j,energy:Math.max(0,(j.energy||0)-C)}))},[]),p=b.useCallback(C=>{t(j=>({...j,resources:{...j.resources,spiritStones:Math.max(0,j.resources.spiritStones-C.cost)},businesses:[...j.businesses,C]}))},[]),c=b.useCallback(({won:C,expGain:j=0,spiritStones:T=0,health:A,healthDamage:V,injurySource:F,onNotify:B})=>{t($=>{const Y={...$};if(j&&(Y.currentExp=($.currentExp||0)+j),T!==0&&(Y.resources={...$.resources,spiritStones:T>0?$.resources.spiritStones+T:Math.max(0,$.resources.spiritStones+T)}),A!==void 0){Y.stats={...$.stats,health:A};const ne=Bt(A);Y.energy=Math.min($.energy||20,ne)}else if(V&&V>0){const ne=qo($,V,F||"EXPLORATION");if(Y.stats={...$.stats,health:ne.newHealth},ne.energyPenalty>0){const X=Bt(ne.newHealth);Y.energy=Math.min($.energy||20,X)}B&&B({type:"health_damage",message:ne.message,severity:ne.severity,isSerious:ne.isSerious})}return Y})},[]),m=b.useCallback((C,j="EXPLORATION",T)=>{t(A=>{const V=qo(A,C,j);T&&T({type:"health_damage",message:V.message,severity:V.severity,isSerious:V.isSerious,energyPenalty:V.energyPenalty});let F=A.energy||20;if(V.energyPenalty>0){const B=Bt(V.newHealth);F=Math.min(F,B)}return{...A,stats:{...A.stats,health:V.newHealth},energy:F}})},[]),y=b.useCallback((C,j="REST",T)=>{t(A=>{const V=dw(A,C,j);return T&&V.message&&T({type:"health_recovery",message:V.message,energyBonus:V.energyBonus}),{...A,stats:{...A.stats,health:V.newHealth}}})},[]),S=b.useCallback((C="explore")=>Af(e),[e]),E=b.useCallback(()=>{var C;return Bt(((C=e.stats)==null?void 0:C.health)||50)},[e]),w=b.useCallback((C,j)=>{t(T=>({...T,worldNpcs:(T.worldNpcs||[]).map(A=>A.id===C?{...A,...j}:A)}))},[]),g=b.useCallback(C=>{t(j=>({...j,worldNpcs:C(j.worldNpcs||[])}))},[]),h=b.useCallback(C=>{t(j=>({...j,newsBuffer:[...j.newsBuffer||[],C]}))},[]),v=b.useCallback(()=>{t(C=>({...C,newsBuffer:[]}))},[]),x=b.useCallback((C,j)=>{t(T=>{var V;const A=Array.isArray((V=T.specialCollections)==null?void 0:V[C])?T.specialCollections[C]:[];return A.includes(j)?T:{...T,specialCollections:{...T.specialCollections||{},[C]:[...A,j]}}})},[]),I=b.useCallback(()=>{t(C=>Ty(C))},[]),_=b.useCallback(C=>{t(j=>({...j,inventory:[...j.inventory||[],C]}))},[]),N=b.useCallback(C=>{t(j=>({...j,inventory:(j.inventory||[]).filter(T=>T.id!==C)}))},[]);return{player:e,setPlayer:t,updatePlayer:n,updatePlayerStats:s,updatePlayerTime:o,updatePlayerCultivation:i,addResources:a,consumeResources:l,updateEnergy:d,consumeEnergy:u,purchaseBusiness:p,applyCombatResult:c,applyHealthDamageWithNotify:m,applyHealthRecovery:y,checkHealthStatus:S,getEnergyLimit:E,updateWorldNpc:w,updateWorldNpcs:g,addNewsToBuffer:h,clearNewsBuffer:v,addToSpecialCollection:x,applyDefeatPenalty:I,addInventoryItem:_,removeInventoryItem:N}}const gw={aptitude:85,looks:90,intelligence:80},Iy=[{id:1,name:"",gender:"",age:25,identity:"",desc:"",avatar:{base:0,skinColor:1,hair:0,hairColor:0,eye:0,eyeColor:0,mouth:1},...(()=>{const e=Gl();return{tier:e.tier,currentExp:e.currentExp,maxExp:e.maxExp,spiritRoot:e.spiritRoot}})(),stats:gw,combatStats:{hp:2e3,maxHp:2e3,atk:180,mp:800},sect:Sy("SWORD"),sectId:"SWORD",sectRank:"",sectStatus:"defected",appearance:"...",personality:{label:"",tag:"",desc:""},relationship:{stage:1,affection:10,trust:20,jealousy:0},likes:["",""],dislikes:[""],isPregnant:!1},{id:2,name:"",gender:"",age:38,identity:"",desc:"",avatar:{base:0,skinColor:2,hair:-1,hairColor:null,eye:0,eyeColor:0,mouth:1},...(()=>{const e=Gl();return{tier:e.tier,currentExp:e.currentExp,maxExp:e.maxExp,spiritRoot:e.spiritRoot}})(),stats:{aptitude:95,looks:40,intelligence:95},combatStats:{hp:1800,maxHp:1800,atk:200,mp:1200},sect:null,sectId:null,sectRank:"",sectStatus:"mysterious",personality:{label:"",tag:"",desc:""},relationship:{stage:1,affection:5,trust:10,jealousy:0},likes:[""],dislikes:[],isPregnant:!1}];function Jn(e={}){var g,h,v,x;const t=e.currentExp||e.cultivation||0,n=e.combatStats||{},s=n.atk||Math.floor((((g=e.stats)==null?void 0:g.aptitude)||50)*.8),o=n.def||Math.floor((((h=e.stats)==null?void 0:h.aptitude)||50)*.4),i=n.maxHp||Math.floor(t+(((v=e.stats)==null?void 0:v.health)||50)*10),a=45,l=1,d=22,u=.08,p=18,c=Math.floor(s*a),m=Math.floor(i*l),y=Math.floor(o*d),S=Math.floor(t*u),E=Math.floor((((x=e.stats)==null?void 0:x.aptitude)||50)*p);return{total:Math.max(1,c+m+y+S+E),breakdown:{atk:c,hp:m,def:y,exp:S,aptitude:E},details:{atk:s,def:o,maxHp:i}}}function _y(e={},t={}){var w,g,h,v,x,I;const n=e.combatStats||{},s=t.combatStats||{},o=n.atk||Math.max(1,Math.floor((((w=e.stats)==null?void 0:w.aptitude)||50)*.8)),i=n.def||Math.max(0,Math.floor((((g=e.stats)==null?void 0:g.aptitude)||50)*.4)),a=n.maxHp||Math.max(1,Math.floor((e.currentExp||e.cultivation||0)+(((h=e.stats)==null?void 0:h.health)||50)*10)),l=s.atk||Math.max(1,Math.floor((((v=t.stats)==null?void 0:v.aptitude)||50)*.8)),d=s.def||Math.max(0,Math.floor((((x=t.stats)==null?void 0:x.aptitude)||50)*.4)),u=s.maxHp||Math.max(1,Math.floor((t.currentExp||t.cultivation||0)+(((I=t.stats)==null?void 0:I.health)||50)*10)),p=Math.max(1,o-Math.floor(d/2)),c=Math.max(1,l-Math.floor(i/2)),m=Math.ceil(u/p),y=Math.ceil(a/c),S=y-m;let E;return S>=3?E=.98:S===2?E=.92:S===1?E=.78:S===0?E=.55:S===-1?E=.28:S===-2?E=.12:E=.03,{prob:E,roundsToKillEnemy:m,roundsToDie:y,pDpr:p,eDpr:c}}const hl=[{id:"farm",name:"",cost:500,baseIncome:50,desc:"",minTier:""},{id:"mine",name:"",cost:2e3,baseIncome:200,desc:"",minTier:""},{id:"auction",name:"",cost:1e4,baseIncome:1500,desc:"",minTier:""},{id:"sect_branch",name:"",cost:5e4,baseIncome:8e3,desc:"",minTier:""}],Ry=[{id:"peach_island",name:"",reqTier:"",recommendCP:300,cost:10,drops:["herb_bandage","iron_sword","rice_ball","beast_core"],risk:.05,desc:"",resourceLevel:"MORTAL",dropTable:[{item:"herb_bandage",weight:.25},{item:"iron_sword",weight:.25},{item:"rice_ball",weight:.3},{item:"beast_core",weight:.2}]},{id:"snake_valley",name:"",reqTier:"",recommendCP:5e3,cost:50,drops:["beast_core","beast_fang","herb_bandage"],risk:.15,desc:"",resourceLevel:"SPIRIT",dropTable:[{item:"beast_core",weight:.3},{item:"beast_fang",weight:.4},{item:"herb_bandage",weight:.3}]},{id:"thunder_peak",name:"",reqTier:"",recommendCP:8e4,cost:300,drops:["thunder_wood","iron_armor","foundation_pill","beast_fang"],risk:.25,desc:"",resourceLevel:"SPIRIT",dropTable:[{item:"thunder_wood",weight:.3},{item:"iron_armor",weight:.3},{item:"foundation_pill",weight:.2},{item:"beast_fang",weight:.2}]},{id:"ancient_tomb",name:"",reqTier:"",recommendCP:15e4,cost:500,drops:["core_pill","milk_millennium","marrow_wash","moonshadow_saber"],risk:.4,desc:"",resourceLevel:"EARTH",dropTable:[{item:"core_pill",weight:.25},{item:"milk_millennium",weight:.25},{item:"marrow_wash",weight:.25},{item:"moonshadow_saber",weight:.25}]},{id:"demon_domain",name:"",reqTier:"",recommendCP:8e5,cost:2e3,drops:["nascent_fruit","heaven_manual","divine_egg","storm_piercer","core_pill"],risk:.6,desc:"",resourceLevel:"HEAVEN",dropTable:[{item:"nascent_fruit",weight:.25},{item:"heaven_manual",weight:.25},{item:"divine_egg",weight:.25},{item:"storm_piercer",weight:.15},{item:"core_pill",weight:.1}]},{id:"star_sea_realm",name:"",reqTier:"",recommendCP:16e5,cost:5e3,drops:["starlight_pill","cosmic_crystal","void_silk","nascent_fruit"],risk:.7,desc:"",resourceLevel:"HEAVEN",dropTable:[{item:"starlight_pill",weight:.3},{item:"cosmic_crystal",weight:.3},{item:"void_silk",weight:.2},{item:"nascent_fruit",weight:.2}]},{id:"immortal_cave",name:"",reqTier:"",recommendCP:8e6,cost:2e4,drops:["primordial_spirit_pill","heavenly_jade","soul_essence_crystal"],risk:.75,desc:"",resourceLevel:"DIVINE",dropTable:[{item:"primordial_spirit_pill",weight:.3},{item:"heavenly_jade",weight:.35},{item:"soul_essence_crystal",weight:.35}]},{id:"celestial_pagoda",name:"",reqTier:"",recommendCP:16e6,cost:5e4,drops:["nine_heaven_pill","star_core_fragment","celestial_silk_cloth"],risk:.8,desc:"",resourceLevel:"DIVINE",dropTable:[{item:"nine_heaven_pill",weight:.25},{item:"star_core_fragment",weight:.35},{item:"celestial_silk_cloth",weight:.4}]},{id:"abyss_deeps",name:"",reqTier:"",recommendCP:32e6,cost:1e5,drops:["soul_splitting_pill","abyss_stone","abyssal_essence"],risk:.85,desc:"",resourceLevel:"DIVINE",dropTable:[{item:"soul_splitting_pill",weight:.2},{item:"abyss_stone",weight:.4},{item:"abyssal_essence",weight:.4}]},{id:"divine_transformation_realm",name:"",reqTier:"",recommendCP:8e7,cost:3e5,drops:["god_transformation_pill","divine_tribulation_stone","god_marrow"],risk:.8,desc:"",resourceLevel:"DIVINE",dropTable:[{item:"god_transformation_pill",weight:.2},{item:"divine_tribulation_stone",weight:.4},{item:"god_marrow",weight:.4}]},{id:"soul_refining_abyss",name:"",reqTier:"",recommendCP:16e7,cost:5e5,drops:["divine_soul_pill","divine_essence_core","soul_tempering_stone"],risk:.82,desc:"",resourceLevel:"DIVINE",dropTable:[{item:"divine_soul_pill",weight:.2},{item:"divine_essence_core",weight:.4},{item:"soul_tempering_stone",weight:.4}]},{id:"void_condensing_heaven",name:"",reqTier:"",recommendCP:32e7,cost:8e5,drops:["void_condensing_pill","void_manifold_crystal","condensed_void_essence"],risk:.85,desc:"",resourceLevel:"DIVINE",dropTable:[{item:"void_condensing_pill",weight:.15},{item:"void_manifold_crystal",weight:.42},{item:"condensed_void_essence",weight:.43}]},{id:"immortal_ascension_peak",name:"",reqTier:"",recommendCP:4e8,cost:15e5,drops:["heaven_defying_pill","celestial_ascension_token","immortal_transformation_essence"],risk:.9,desc:"",resourceLevel:"DIVINE",dropTable:[{item:"heaven_defying_pill",weight:.15},{item:"celestial_ascension_token",weight:.42},{item:"immortal_transformation_essence",weight:.43}]}],nu=e=>Jn(e).total||0,yc=(e=[])=>e[Math.floor(Math.random()*e.length)],My=["","","","","","","","","","","","","","","","",""],hw=["","","","","","","","","","","","","","","","","","","","","","","","","","","","","",""],ru={male:["","","","","","","","","","","","","","","","","","","",""],female:["","","","","","","","","","","","","","","","","","","",""],neutral:["","","","","","","","","","","","","","","","","","","",""]},xw=["","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","",""],yw=new Set(My);function bw(){return yc(xw)}function Gm(e=""){const t=(e||"").replace(/\s+/g,"");if(!t)return"";const n=t.slice(0,2);return yw.has(n)?n:t.charAt(0)}const vw=()=>Math.random()<.15?yc(My):yc(hw),Sw=(e="")=>{const t=e===""?ru.female:ru.male,n=[...ru.neutral,...t];return yc(n)};function Nf(e="",t={}){const{motherName:n="",fatherName:s="",preferSurname:o=""}=t,i=o||Gm(n)||Gm(s)||vw(),a=Sw(e);return`${i}${a}`}const ww=[{base:"#FFDFC4",shadow:"#F0D5B1"},{base:"#F0D5B1",shadow:"#E0B87E"},{base:"#E0B87E",shadow:"#C59D74"},{base:"#A16E4B",shadow:"#815336"}],yp=["#2C2C2C","#5C3A21","#A88B45","#8D2323","#F2F2F2"],kw=["#333333","#4A90E2","#50E3C2","#F5A623","#D0021B"],Ew=[{skinPixels:[[4,2],[5,2],[6,2],[7,2],[8,2],[9,2],[10,2],[11,2],[3,3],[4,3],[5,3],[6,3],[7,3],[8,3],[9,3],[10,3],[11,3],[12,3],[3,4],[4,4],[5,4],[6,4],[7,4],[8,4],[9,4],[10,4],[11,4],[12,4],[3,5],[4,5],[5,5],[6,5],[7,5],[8,5],[9,5],[10,5],[11,5],[12,5],[3,6],[4,6],[5,6],[6,6],[7,6],[8,6],[9,6],[10,6],[11,6],[12,6],[3,7],[4,7],[5,7],[6,7],[7,7],[8,7],[9,7],[10,7],[11,7],[12,7],[3,8],[4,8],[5,8],[6,8],[7,8],[8,8],[9,8],[10,8],[11,8],[12,8],[3,9],[4,9],[5,9],[6,9],[7,9],[8,9],[9,9],[10,9],[11,9],[12,9],[4,10],[5,10],[6,10],[7,10],[8,10],[9,10],[10,10],[11,10],[5,11],[6,11],[7,11],[8,11],[9,11],[10,11],[6,12],[7,12],[8,12],[9,12]],shadowPixels:[[3,4],[3,5],[3,6],[3,7],[3,8],[3,9],[12,4],[12,5],[12,6],[12,7],[12,8],[12,9],[4,10],[11,10],[5,11],[10,11],[6,12],[9,12],[7,9],[8,9]]}],jw=[{whitePixels:[[5,7],[6,7],[9,7],[10,7]],pupilPixels:[[6,7],[9,7]],browPixels:[[5,6],[6,6],[9,6],[10,6]]},{whitePixels:[[4,7],[5,7],[6,7],[9,7],[10,7],[11,7]],pupilPixels:[[5,7],[10,7]],browPixels:[[4,6],[5,6],[10,6],[11,6]]},{whitePixels:[[5,7],[6,7],[5,8],[9,7],[10,7],[10,8]],pupilPixels:[[6,7],[6,8],[9,7],[9,8]],browPixels:[[5,6],[6,6],[9,6],[10,6]]}],Cw=[[[6,11],[9,11],[7,12],[8,12]],[[6,11],[7,11],[8,11],[9,11]],[[7,11],[8,11],[9,11],[10,10]]],Tw=[[[6,0],[7,0],[8,0],[9,0],[5,1],[6,1],[7,1],[8,1],[9,1],[10,1],[4,2],[5,2],[6,2],[7,2],[8,2],[9,2],[10,2],[11,2],[3,3],[4,3],[11,3],[12,3],[3,4],[12,4],[2,5],[3,5],[12,5],[13,5],[2,6],[13,6],[2,7],[13,7],[1,8],[2,8],[13,8],[14,8],[7,3],[8,3],[7,4],[8,4]],[[5,1],[6,1],[7,1],[8,1],[9,1],[10,1],[4,2],[5,2],[6,2],[7,2],[8,2],[9,2],[10,2],[11,2],[3,3],[4,3],[5,3],[6,3],[7,3],[8,3],[9,3],[10,3],[11,3],[12,3],[2,4],[3,4],[4,4],[11,4],[12,4],[13,4],[2,5],[3,5],[12,5],[13,5],[1,6],[2,6],[3,6],[12,6],[13,6],[14,6],[1,7],[2,7],[13,7],[14,7],[1,8],[2,8],[13,8],[14,8],[2,9],[3,9],[12,9],[13,9],[2,10],[3,10],[12,10],[13,10]],[[6,0],[7,0],[8,0],[9,0],[5,1],[6,1],[9,1],[10,1],[6,2],[7,2],[8,2],[9,2],[5,3],[6,3],[7,3],[8,3],[9,3],[10,3],[4,4],[5,4],[10,4],[11,4],[4,5],[5,5],[10,5],[11,5],[3,6],[4,6],[11,6],[12,6],[7,1],[8,1]]],Ve=e=>!e||e.length===0?null:e[Math.floor(Math.random()*e.length)],Iw={low:["{playerName}","{playerName}","{playerName}{gender_ta}","{playerName}"],medium:["{playerName}{gender_ta}","{playerName}","{playerName}","{playerName}{gender_ta}"],high:["{playerName}","{playerName}{gender_ta}","{playerName}","{playerName}{gender_ta}{gender_ta}..."]},Vm={:{low:["{playerName}","{playerName}...","{playerName}"],medium:["{playerName}{gender_ta}","{playerName}","{playerName}{gender_ta}"],high:["{playerName}{gender_ta}","{playerName}...","{playerName}"]},:{low:["{playerName}","{playerName}{gender_ta}","{playerName}{gender_ta}"],medium:["{playerName}{gender_ta}","{playerName}{gender_ta}","{playerName}"],high:["{playerName}{gender_ta}{gender_ta}","{playerName}","{playerName}{gender_ta}{gender_ta}"]},:{low:["{playerName}{gender_ta}...","{playerName}{gender_ta}","{playerName}"],medium:["{playerName}......","{playerName}{gender_ta}","{playerName}"],high:["{playerName}.........{gender_ta}...","{playerName}{gender_ta}","{playerName}{gender_ta}"]},:{low:["{playerName}...{gender_ta}","{playerName}{gender_ta}...","{playerName}...{gender_ta}"],medium:["{playerName}{gender_ta}...","{playerName}...","{playerName}{gender_ta}..."],high:["{playerName}...{gender_ta}{gender_ta}...","{playerName}{gender_ta}...","{playerName}..."]},:{low:["{playerName}","{playerName}","{playerName}{gender_ta}"],medium:["{playerName}{gender_ta}","{playerName}","{playerName}{gender_ta}"],high:["{playerName}","{playerName}{gender_ta}","{playerName}{gender_ta}"]},:{low:["{playerName}","{playerName}","{playerName}{gender_ta}"],medium:["{playerName}{gender_ta}","{playerName}","{playerName}{gender_ta}"],high:["{playerName}","{playerName}{gender_ta}","{playerName}...~"]},:{low:["{playerName}{gender_ta}","{playerName}{gender_ta}","{playerName}"],medium:["{playerName}{gender_ta}","{playerName}{gender_ta}","{playerName}{gender_ta}"],high:["{playerName}{gender_ta}","{playerName}{gender_ta}","{playerName}{gender_ta}"]},:{low:["{playerName}","{playerName}","{playerName}"],medium:["{playerName}{gender_ta}","{playerName}{gender_ta}","{playerName}{gender_ta}"],high:["{playerName}","{playerName}","{playerName}{gender_ta}"]}},_w=["{playerName}{giftName}{gender_ta}","{playerName}{giftName}{gender_ta}","{playerName}{giftName}{gender_ta}","{giftName}{playerName}{gender_ta}"],Ym={:["{playerName}{giftName}......{gender_ta}","{giftName}{playerName}","{playerName}{giftName}...{gender_ta}"],:["{playerName}{giftName}...{gender_ta}","{playerName}{giftName}{gender_ta}","{giftName}{playerName}..."],:["{playerName}{giftName}......","{giftName}...{playerName}","{playerName}{giftName}{gender_ta}"],:["{playerName}{giftName}...{gender_ta}...","{playerName}{giftName}{gender_ta}...","{giftName}...{playerName}{gender_ta}..."],:["{playerName}{giftName}","{playerName}{giftName}{gender_ta}","{giftName}{playerName}"],:["{playerName}{giftName}{gender_ta}","{giftName}{playerName}","{playerName}{giftName}"],:["{playerName}{giftName}{gender_ta}","{playerName}{giftName}{gender_ta}","{giftName}...{playerName}"],:["{playerName}{giftName}","{playerName}{giftName}","{giftName}...{playerName}"]},Rw=["{playerName},{gender_ta},","{playerName},{gender_ta},,","{playerName},,",",{playerName}{gender_ta}"],qm={:["{playerName},","{playerName},,",",{playerName},"],:["{playerName},...{gender_ta},","{playerName},{gender_ta}","{playerName},{gender_ta}"],:["!{playerName}!!()","{playerName}~{gender_ta}!!()","~,{playerName}!{gender_ta}!"],:["{playerName}...{gender_ta},{gender_ta}...","{playerName}{gender_ta}?...{gender_ta},{gender_ta}...","{playerName},{gender_ta},..."],:["{playerName},!!","{playerName},!",",{playerName}!!"],:["!{playerName}!!!","!{playerName}!,{gender_ta}!","{playerName}!,!!"],:["{playerName},","{playerName},",",{playerName}"],:["{playerName},,","{playerName},,",",{playerName},,"]},Mw=["{playerName},...{gender_ta}!","{playerName},,...!{gender_ta},","{playerName},,{gender_ta}","{playerName},{gender_ta},..."],Km={:["{playerName}...,","{playerName}...,","{playerName},,"],:["{playerName}...{gender_ta},","{playerName},,{gender_ta}","{playerName},{gender_ta}{gender_ta}..."],:["{playerName}...!()","{playerName}!!!!()","!!{playerName}!!"],:["{playerName}...{gender_ta}{gender_ta}...,{gender_ta}...","{playerName},{gender_ta}...{gender_ta}...","...{playerName},{gender_ta}......"],:["{playerName},{gender_ta}!","{playerName},!!",",{playerName},,{gender_ta}!"],:["!{playerName}!!{gender_ta}!","!{playerName}!!!!","{playerName}!{gender_ta}!!"],:["{playerName},,","{playerName},","!{playerName},!"],:["{playerName},,","{playerName},",",{playerName},"]},Aw=["{playerName},,{gender_ta}...",",{playerName},","{playerName},{gender_ta},",",{playerName},..."],Qm={:["{playerName},,{gender_ta}",",{playerName}...{gender_ta}","{playerName},{gender_ta},"],:["{playerName},...{gender_ta},",",{playerName},,...","{playerName},{gender_ta}..."],:["{playerName}!{gender_ta}!!","!,!{playerName}...()","{playerName}!{gender_ta}!...(){gender_ta}..."],:["{playerName}...,{gender_ta},...",",{playerName}......","{playerName},{gender_ta},......"],:["{playerName},,{gender_ta},",",{playerName},","{playerName},,"],:["!{playerName}!!","{playerName}!{gender_ta}!!","{playerName}!!!"],:["{playerName},,{gender_ta}",",{playerName},","{playerName},"],:["{playerName},,",",{playerName},","{playerName},,,"]},Nw=["{playerName}...","{playerName}...","...{playerName}","{playerName}...","{playerName}"],su={early:["...","","{playerName}","...''",""],mid:["...{playerName}","...","{playerName}","","","..."],late:["...","{playerName}","...","...","{playerName}","''..."]},Lw=["...{childName}","{childName}","...{playerName}","{gender_ta}{childName}{playerName}","{childName}"],$w=["{newTier}","{newTier}","{newTier}","{newTier}","{newTier}"],Jm={:["{newTier}","{newTier}","{newTier}"],:["{newTier}...{playerName}","{newTier}","{newTier}"],:["{newTier}","{newTier}...","{newTier}{playerName}"],:["{newTier}...{playerName}...","{newTier}{playerName}...","...{playerName}{gender_ta}..."],:["{newTier}","{newTier}","{newTier}"],:["{newTier}","{newTier}","{newTier}"],:["...{newTier}","{newTier}","{newTier}"],:["{newTier}","{newTier}","{newTier}"]},Bw=["...","","...","{targetTier}"],Xm={:["...","",""],:["...","...","..."],:["","...","......"],:["...{playerName}...","...{playerName}...","...{playerName}..."],:["","...",""],:["","~","......"],:["...","...",""],:["","",""]},Ow=["{spouseName}","{spouseName}{gender_ta}","{spouseName}","{spouseName}{gender_ta}"],Pw=["...","","...","","{playerName}..."],ou={:["''","","",""],:["{playerName}","","",""],:["","",""],:["","",""],:["","","...",""],:["...","","","..."],:["","","",""],:["","","",""],:["","","",""],:["","","","{gender_ta}"]},zw={:["","","","''"],:["","","",""],:["","{playerName}...{gender_ta}","{playerName}{gender_ta}","{playerName}..."],:["{playerName}{gender_ta}...","{playerName}{gender_ta}{gender_ta}","{playerName}...","{playerName}...{gender_ta}"],:["","","",""],:["","...","","{gender_ta}"]},iu={stranger:["","","",""],crush:["{playerName}","{playerName}{gender_ta}","{playerName}...","{playerName}{gender_ta}{gender_ta}...","{playerName}{gender_ta}"],spouse:["{playerName}{gender_ta}...","{playerName}{gender_ta}","{playerName}","{playerName}{gender_ta}{gender_ta}"]},Dw=["","","",""],Fw=["","","...",""],Hw=["...","","",""],Ww=["","","{gender_ta}",""],Uw=["","","",""],Lf=["","","","",""],Zm={:["",""],:["",""],:["{playerName}{playerName}","",""],:["{playerName}","",""]},eg={:{low:["",""],medium:["","{gender_ta}"],high:["",""]},:{low:["",""],medium:["",""],high:["","{gender_ta}"]},:{low:["","",""],medium:["...","",""],high:["","",""]},:{low:["","",""],medium:["","",""],high:["","",""]}},tg={:["",""]},ng={:[""]},rg={:[""]},sg={:[""],:["{playerName}",""],:["",""]},og={:[""]},ig={:[""]},ag={:[""]},lg={:[""]};function Gw(e){if(!e)return null;const t=Object.keys(Zm).find(n=>e.includes(n));return t?Ve(Zm[t]):null}function Vw(e,t){if(!e)return null;const n=Object.keys(eg).find(i=>e.includes(i));if(!n)return null;let s="low";t<30?s="low":t<70?s="medium":s="high";const o=eg[n][s];return o?Ve(o):null}function Yw(e){if(!e)return null;const t=Object.keys(tg).find(n=>e.includes(n));return t?Ve(tg[t]):null}function qw(e){if(!e)return null;const t=Object.keys(ng).find(n=>e.includes(n));return t?Ve(ng[t]):null}function Kw(e){if(!e)return null;const t=Object.keys(rg).find(n=>e.includes(n));return t?Ve(rg[t]):null}function Qw(e){if(!e)return null;const t=Object.keys(sg).find(n=>e.includes(n));return t?Ve(sg[t]):null}function Jw(e){if(!e)return null;const t=Object.keys(og).find(n=>e.includes(n));return t?Ve(og[t]):null}function Xw(e){if(!e)return null;const t=Object.keys(ig).find(n=>e.includes(n));return t?Ve(ig[t]):null}function Zw(e){if(!e)return null;const t=Object.keys(ag).find(n=>e.includes(n));return t?Ve(ag[t]):null}function ek(e){if(!e)return null;const t=Object.keys(lg).find(n=>e.includes(n));return t?Ve(lg[t]):null}function tk(e,t=null){let n="low";if(e<30?n="low":e<70?n="medium":n="high",t&&Vm[t]){const s=Vm[t][n];if(s&&s.length>0)return Ve(s)}return Ve(Iw[n])}function nk(e=null){if(e&&Ym[e]){const t=Ym[e];if(t&&t.length>0)return Ve(t)}return Ve(_w)}function rk(e=null){if(e&&qm[e]){const t=qm[e];if(t&&t.length>0)return Ve(t)}return Ve(Rw)}function sk(e=null){if(e&&Km[e]){const t=Km[e];if(t&&t.length>0)return Ve(t)}return Ve(Mw)}function ok(e=null){if(e&&Qm[e]){const t=Qm[e];if(t&&t.length>0)return Ve(t)}return Ve(Aw)}function ik(e=null){if(e&&Jm[e]){const t=Jm[e];if(t&&t.length>0)return Ve(t)}return Ve($w)}function ak(e=null){if(e&&Xm[e]){const t=Xm[e];if(t&&t.length>0)return Ve(t)}return Ve(Bw)}function lk(e){let t=ou[e];return t||(e.includes("")||e.includes(""))&&(t=ou.||ou.),!t||t.length===0?Ve(Lf):Ve(t)}function ck(e){const t=zw[e];return Ve(t||Lf)}function dk(e,t,n){return n?Ve(iu.spouse):t<20?Ve(iu.stranger):t>=80?Ve(iu.crush):null}const cg={LOW:{:["{playerName}{targetName}...{playerName}{gender_ta}","{playerName}{targetName}...{gender_ta}{gender_ta}"],:["{playerName}{targetName}...{gender_ta}...","{targetName}{playerName}......"],:["{playerName}{targetName}","{playerName}{targetName}..."],:["{playerName}{targetName}...","{playerName}{targetName}...{gender_ta}"],:["{playerName}{targetName}",""],:["{targetName}{playerName}","{playerName}{targetName}"],:["{targetName}...","{targetName}..."],:["{playerName}{targetName}","{playerName}{targetName}"]},MEDIUM:{:["{playerName}{targetName}...{gender_ta}...","{playerName}{targetName}...","{targetName}...{playerName}{playerName}"],:["{playerName}{gender_ta}{targetName}","{playerName}{targetName}...","{playerName}...{gender_ta}"],:["{playerName}{targetName}...","{playerName}...{gender_ta}{targetName}"],:["{playerName}{targetName}...{gender_ta}...","{playerName}{targetName}...{playerName}","{playerName}{gender_ta}..."],:["{playerName}","{playerName}"],:["{playerName}{gender_ta}","{playerName}"],:["{targetName}''...","{targetName}...","..."],:["{playerName}{targetName}","{playerName}{gender_ta}..."]},HIGH:{:["...{playerName}{gender_ta}{targetName}.........","{targetName}{playerName}","...{targetName}{playerName}..."],:["{playerName}{gender_ta}.........","{playerName}{targetName}............","......{playerName}..."],:["{playerName}","{playerName}","..."],:["{playerName}{targetName}...{gender_ta}...","{playerName}......","......"],:["{playerName}{targetName}{gender_ta}","{playerName}{gender_ta}","{playerName}"],:["{playerName}{gender_ta}{gender_ta}","",""],:["...{targetName}.........","...","......"],:["{playerName}{targetName}{gender_ta}","{playerName}..."]},EXTREME:{:["{targetName}{playerName}...{playerName}......","{playerName}...{targetName}","{playerName}{gender_ta}..."],:["{playerName}{targetName}","{playerName}","{playerName}{gender_ta}{targetName}......{gender_ta}"],:["{playerName}{targetName}","{playerName}","{playerName}..."],:["{playerName}.........","{playerName}......","{playerName}{targetName}......{gender_ta}..."],:["{playerName}{gender_ta}{gender_ta}","{playerName}{gender_ta}"],:["{playerName}","{playerName}{targetName}{gender_ta}{gender_ta}"],:["......","...","{gender_ta}..."],:["{playerName}{targetName}","{playerName}"]}},dg={:["{playerName}{favoriteItem}{gender_ta}...","{playerName}{gender_ta}..."],:["{playerName}...{gender_ta}","{playerName}......{gender_ta}"],:["{playerName}...{gender_ta}","{playerName}..."],:["{playerName}{gender_ta}...","{playerName}{gender_ta}..."],:["...","{gender_ta}"],:["{playerName}{gender_ta}","{playerName}"]};class Ay{constructor(t=50){this.maxSize=t,this.cache=new Map}get(t){if(!this.cache.has(t))return null;const n=this.cache.get(t);return this.cache.delete(t),this.cache.set(t,n),n}set(t,n){if(this.cache.has(t)&&this.cache.delete(t),this.cache.set(t,n),this.cache.size>this.maxSize){const s=this.cache.keys().next().value;this.cache.delete(s)}}clear(){this.cache.clear()}has(t){return this.cache.has(t)}size(){return this.cache.size}}function uk(e,t={}){const{maxSize:n=100,keyGenerator:s=(...l)=>JSON.stringify(l),ttl:o=null}=t,i=new Ay(n),a=new Map;return function(...d){const u=s(...d);o&&a.has(u)&&Date.now()-a.get(u)>o&&(i.set(u,null),a.delete(u));const p=i.get(u);if(p!==null)return p;const c=e(...d);return i.set(u,c),o&&a.set(u,Date.now()),c}}class pk{constructor(){this.caches=new Map,this.stats={hits:0,misses:0,sets:0}}createCache(t,n=100){const s=new Ay(n);return this.caches.set(t,s),s}getCache(t){return this.caches.get(t)}get(t,n){const s=this.caches.get(t);if(!s)return this.stats.misses++,null;const o=s.get(n);return o!==null?this.stats.hits++:this.stats.misses++,o}set(t,n,s){const o=this.caches.get(t);if(!o){console.warn(` ${t} `);return}o.set(n,s),this.stats.sets++}clearCache(t){const n=this.caches.get(t);n&&n.clear()}clearAll(){this.caches.forEach(t=>t.clear()),this.stats={hits:0,misses:0,sets:0}}getStats(){const t=this.stats.hits+this.stats.misses>0?(this.stats.hits/(this.stats.hits+this.stats.misses)*100).toFixed(2):0;return{...this.stats,hitRate:`${t}%`,totalCaches:this.caches.size}}}const Ca=new pk;Ca.createCache("npcLifecycle",200);Ca.createCache("combatStats",200);Ca.createCache("cultivationProgress",100);Ca.createCache("monthlyLogs",50);Ca.createCache("sortedLists",20);const gt={INTERACTION:"INTERACTION",STATE_CHANGE:"STATE_CHANGE",DAILY:"DAILY"},fk=50;uk((e,t,n,s)=>null,{maxSize:200,ttl:6e4});function In(e,t,n,s,o=gt.DAILY,i=!1){if(!e)return e;const a=e.logs||[],u=[{year:t,month:n,content:s,type:o,isSecret:i,timestamp:Date.now()},...a].slice(0,fk);return{...e,logs:u}}function _n(e,t,n,s={}){if(!e)return"";let o=e;o=o.replace(/{playerName}/g,(n==null?void 0:n.name)||""),o=o.replace(/{npcName}/g,(t==null?void 0:t.name)||"");const i=(n==null?void 0:n.gender)||"";return t!=null&&t.gender,o=o.replace(/{gender_ta}/g,i===""?"":""),o=o.replace(/{gender_Ta}/g,i===""?"":""),Object.keys(s).forEach(a=>{const l=new RegExp(`{${a}}`,"g");o=o.replace(l,s[a])}),o}function ug(e,t,n,s){const o=e.identity||"",i=Gw(o);let a="";return i?a=_n(i,e,t):e.name===""?a=`${t.name}${t.gender===""?"":""}...`:e.name===""?a=`${t.name}`:a=`${t.name}${t.gender===""?"":""}`,In(e,n,s,a,gt.INTERACTION)}function pg(e,t,n,s){var p,c;const o=((p=e.relationship)==null?void 0:p.affection)||0,i=((c=e.personality)==null?void 0:c.label)||null,a=e.identity||"",d=Vw(a,o)||tk(o,i),u=_n(d,e,t);return In(e,n,s,u,gt.INTERACTION)}function mk(e,t,n,s,o,i){var p;const a=((p=e.personality)==null?void 0:p.label)||null,l=e.identity||"";let d=null;d=Yw(l)||nk(a);const u=_n(d,e,t,{giftName:o});return In(e,n,s,u,gt.INTERACTION)}function gk(e,t,n,s,o){var p;const i=((p=e.personality)==null?void 0:p.label)||null,a=e.identity||"",d=(o?qw(a):Kw(a))||(o?rk(i):sk(i)),u=_n(d,e,t);return In(e,n,s,u,gt.INTERACTION)}function hk(e,t,n,s){var u;const o=((u=e.personality)==null?void 0:u.label)||null,i=e.identity||"",l=Qw(i)||ok(o),d=_n(l,e,t);return In(e,n,s,d,gt.INTERACTION,!0)}function fg(e,t,n,s,o,i){var c,m;let a="LOW";if(i>=81)a="EXTREME";else if(i>=61)a="HIGH";else if(i>=41)a="MEDIUM";else if(i>=21)a="LOW";else return e;const l=typeof e.personality=="object"&&e.personality!==null&&"label"in e.personality?e.personality.label:Array.isArray(e.personality)?e.personality[0]:"",d=((c=cg[a])==null?void 0:c[l])||((m=cg[a])==null?void 0:m.);if(!d||d.length===0)return e;const u=Ve(d),p=_n(u,e,t,{targetName:(o==null?void 0:o.name)||""});return In(e,n,s,p,gt.DAILY,!0)}function xk(e,t,n,s){var u;const o=typeof e.personality=="object"&&e.personality!==null&&"label"in e.personality?e.personality.label:Array.isArray(e.personality)?e.personality[0]:"",i=dg[o]||dg.;if(!i||i.length===0)return e;const a=Ve(i),l=((u=e.likes)==null?void 0:u[0])||"",d=_n(a,e,t,{favoriteItem:l});return In(e,n,s,d,gt.DAILY,!0)}function yk(e,t,n,s){const o=Ve(Nw),i=_n(o,e,t);return In(e,n,s,i,gt.STATE_CHANGE,!0)}function bk(e,t,n,s,o){let i;o<=3?i=su.early:o<=6?i=su.mid:i=su.late;const a=Ve(i),l=_n(a,e,t);return In(e,n,s,l,gt.STATE_CHANGE,!0)}function vk(e,t,n,s,o){const i=Ve(Lw),a=_n(i,e,t,{childName:o});return In(e,n,s,a,gt.STATE_CHANGE,!0)}function bp(e,t,n,s,o,i){var c;const a=((c=e.personality)==null?void 0:c.label)||null,l=e.identity||"",u=(o?Jw(l):Xw(l))||(o?ik(a):ak(a)),p=_n(u,e,t,{newTier:i||"",targetTier:i||""});return In(e,n,s,p,gt.STATE_CHANGE)}function mg(e,t,n,s,o){const i=e.identity||"",l=Zw(i)||Ve(Ow),d=o===(t==null?void 0:t.name),u=_n(l,e,t,{spouseName:o||""});return In(e,n,s,u,gt.STATE_CHANGE,d)}function Sk(e,t,n,s){const o=e.identity||"",a=ek(o)||Ve(Pw),l=_n(a,e,t);return In(e,n,s,l,gt.STATE_CHANGE,!0)}function wk(e,t,n,s){var E,w,g,h;if(!e)return e;if(e.isPregnant&&e.pregnancyProgress>0)return bk(e,t,n,s,e.pregnancyProgress);const o=((E=e.relationship)==null?void 0:E.affection)||0,i=e.identity||"",a=((w=e.personality)==null?void 0:w.label)||"",l=((g=e.relationship)==null?void 0:g.stage)>=3,d={relationship:0,identity:20,personality:35,event:10,scenery:35};l?(d.relationship=60,d.scenery=10):o>=80?d.relationship=40:o>=50?d.relationship=20:o<20&&(d.relationship=0);const u=Math.random()*100;let p=0,c="scenery";for(const[v,x]of Object.entries(d))if(p+=x,u<=p){c=v;break}let m=null,y=!1;switch(c){case"relationship":m=dk((h=e.relationship)==null?void 0:h.stage,o,l),y=o>=80;break;case"identity":m=lk(i);break;case"personality":m=ck(a),y=a==="";break;case"event":m=Ve(Ve([Dw,Fw,Hw,Ww,Uw]));break;case"scenery":default:m=Ve(Lf);break}m||(m="");const S=_n(m,e,t);return In(e,n,s,S,gt.DAILY,y)}function kk(e,t,n,s){return!e||!Array.isArray(e)?e:e.map(o=>{if(o._hasLogThisMonth){const{_hasLogThisMonth:i,...a}=o;return a}return wk(o,t,n,s)})}function Hi(e){return{...e,_hasLogThisMonth:!0}}function Ek(e,t=0){return!e||!e.logs?[]:t<30?[]:e.logs.filter(n=>n.isSecret?t>=80:!0)}const jk={MORTAL:100,EXPONENTIAL_BASE:1.8},xr={WASTE:.8,FIVE:.95,FOUR:1,THREE:1.15,DOUBLE:1.35,SINGLE:1.6,MUTANT:1.75,HEAVEN:2},Ny=(e=50)=>1+Math.max(-.5,(e-50)*.012),Bo={longevity_body:1.3,immortal_marrow:1.5,void_spirit_body:1.25,ancient_bloodline:1.2,cursed_body:.75,demonic_enhancement:.85,phoenix_reborn:1.1,common_body:1},vp={BASE_PROBABILITY:.01,DIFFICULTY_MULTIPLIER:{:10,:5,:4,:3.5,:2.5,:2,:1.8,:1.5,:1.2,:.8,:.6,:.5,:.4,:.3,:.25,:.2,:.15,:.1,:.08,:.06,:.04,:.02,:.015,:.01,:.008,:.006,:.004,:.002,:.0015,:.001,:5e-4,:3e-4,:1e-4},FACTORS:{aptitudeBonus:e=>1+Math.max(-.5,(e-50)*.015),spiritRootBonus:e=>({WASTE:.5,FIVE:.7,FOUR:.85,THREE:1,DOUBLE:1.2,SINGLE:1.5,MUTANT:1.8,HEAVEN:2.2})[e]||1,ageBonus:(e,t)=>{if(!t)return 1;const n=Math.abs(e-t);return n<=10?1+(10-n)*.05:Math.max(.3,1-(n-10)/20)},expProgress:(e,t)=>.5+Math.max(0,Math.min(1,e/t))*1.5,healthBonus:e=>.8+e*.004},LIFESPAN_GAIN_MULTIPLIER:.7};function bc(e=0,t=1,n=1,s=1){const{MORTAL:o,EXPONENTIAL_BASE:i}=jk,a=Math.pow(i,e/5),d=o*a*t*n*s;return Math.floor(d)}function Ck(e,t=1){var d,u,p;const n=vp;let s=n.BASE_PROBABILITY/t;const o=n.FACTORS.aptitudeBonus(((d=e.stats)==null?void 0:d.aptitude)||50);s*=o;const i=n.FACTORS.spiritRootBonus(((u=e.spiritRoot)==null?void 0:u.id)||"FOUR");s*=i;const a=n.FACTORS.expProgress(e.currentExp||0,e.maxExp||100);s*=a;const l=n.FACTORS.healthBonus(((p=e.stats)==null?void 0:p.health)||50);return s*=l,Math.min(.5,s)}const Tk=Object.values(Q).reduce((e,t)=>(e[t.key]=t.order,e),{}),Ik=["","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","",""],_k=120,Rk=20,Mk=5,Ak=8,Nk=50,Sp=(e="")=>Tn(e)?qe.findIndex(n=>n.name===e):0,Lk=(e="")=>{if(!e)return 0;const t=Ik.indexOf(e);return t>=0?t:0},vc=(e,t=Rk)=>{var u,p,c;if(!e)return _k+t;const n=Sp(e.tier||"");let s=xr.FOUR;(u=e.spiritRoot)!=null&&u.id&&(s={HEAVEN:xr.HEAVEN,MUTANT:xr.MUTANT,SINGLE:xr.SINGLE,DOUBLE:xr.DOUBLE,THREE:xr.THREE,FOUR:xr.FOUR,FIVE:xr.FIVE,WASTE:xr.WASTE}[e.spiritRoot.id]||xr.FOUR);const o=Ny(((p=e.stats)==null?void 0:p.aptitude)||50);let i=Bo.common_body;(c=e.constitution)!=null&&c.key&&Bo[e.constitution.key]&&(i=Bo[e.constitution.key]);const a=bc(n,s,o,i),l=e.age||18,d=Math.max(a,l+t);return Math.round(d)},Ly=(e,t)=>{if(!t)return 0;const n=Sp(e.name||""),s=Sp(t.name||""),o=bc(n),a=bc(s)-o,l=Math.pow(t.maxExp,.2),d=a*(1+l/1e3);return Math.round(Math.max(50,d))},$y=e=>{if(!e)return e;const t=e.stats||{},n=vc(e);return t.lifespan&&t.lifespan>=n?e:{...e,stats:{...t,lifespan:n}}},$k=["herb_bandage","beast_fang","beast_core","foundation_pill","thunder_wood","core_pill","artifact_supreme","dragon_heart_pill","marrow_wash","milk_millennium","nascent_fruit","starlight_pill","heaven_manual","god_transformation_pill","divine_soul_pill","void_condensing_pill","immortal_marrow_pill","heaven_defying_pill","void_refining_pill","space_law_pill","void_stabilization_pill","unity_pill","dao_comprehension_pill","harmony_pill","mahayana_pill","immortal_foundation_pill","semi_immortal_pill","tribulation_pill","ascension_pill"].map(e=>{const t=Uc[e];if(!t)return null;const n=Tk[t.resourceLevel]||1,s=n>=5?80:55;return{itemId:e,affectionRequirement:s+n*5,tierRequirement:Math.max(0,n-1),rarity:t.rarity,resourceOrder:n}}).filter(Boolean);function Fr(e){if(!e||!e.stats)return 0;const t=e.stats.lifespan||100,n=e.age||18,s=t-n;return Math.max(0,s)}function Bk(e,t,n,s){if(!e)return e;const o=(e.age||18)+1;let i=$y({...e,age:o});const a=Fr(i);return a<=0?i={...i,isDead:!0,deathReason:""}:a<10&&!e._nearDeathLogged&&(i=Sk(i,t,n,s),i._nearDeathLogged=!0),i}function Ok(e,t,n,s){var w,g,h,v;if(!e||e.isDead)return{npc:e,events:[]};const o=[];let i={...e};i.currentExp||(i.currentExp=0),i.tier||(i.tier="");const a=Tn(i.tier);if(!a)return{npc:i,events:o};let l=10;const u=.5+(((w=i.stats)==null?void 0:w.aptitude)||50)/100*2.5;l*=u;const c=.6+(((g=i.stats)==null?void 0:g.intelligence)||50)/100*1.4;l*=c;const m=qe.findIndex(x=>x.name===i.tier);if(m>=0&&qe.length>0){const x=1+m/qe.length*1.5;l*=x}const y=((h=i.spiritRoot)==null?void 0:h.multiplier)||.5;l*=y,i.sect&&i.sect.level!=="NONE"&&i.sectStatus==="active"&&(l*=1.5);const S=((v=i.relationship)==null?void 0:v.affection)||0;S>=20&&(S<40?l*=1.1:S<60?l*=1.2:S<80?l*=1.3:l*=1.5),l=Math.max(2,l);const E=Math.floor(l);if(i.currentExp=(i.currentExp||0)+E,i.combatStats=Sn(i),i.cultivationSpeed=l,i.currentExp>=a.maxExp){const x=Pk(i,t,n,s);if(i=x.npc,o.push(...x.events),i.currentExp>=a.maxExp){const I=By(i,t,n,s);i=I.npc,o.push(...I.events)}}return{npc:i,events:o}}function By(e,t,n,s){var m,y;const o=[];let i={...e};const a=Tn(i.tier),l=Mf(i.tier);if(!a||!l)return{npc:i,events:o};const d=((m=i.stats)==null?void 0:m.aptitude)||50,u=((y=i.spiritRoot)==null?void 0:y.multiplier)||.5;let p=a.chance||.3;if(p+=d/10*.03,p+=u*.2,p=Math.max(.05,Math.min(.95,p)),Math.random()<p){if(i.tier=l.name,i.tierTitle=l.name,i.currentExp=0,i.maxExp=l.maxExp,i.stats){const S=Ly(a,l);i.stats={...i.stats,lifespan:(i.stats.lifespan||100)+S},i._lastBreakthroughLifespanGain=S,i._lastBreakthroughType="normal"}if(i.combatStats){const S=Math.floor(i.combatStats.maxHp*.5),E=Math.floor(i.combatStats.atk*.3),w=Math.floor((i.combatStats.def||0)*.2);i.combatStats={...i.combatStats,maxHp:i.combatStats.maxHp+S,hp:i.combatStats.maxHp+S,atk:i.combatStats.atk+E,def:(i.combatStats.def||0)+w}}i=bp(i,t,n,s,!0,l.name),o.push({type:"NPC_BREAKTHROUGH",npcName:i.name,newTier:l.name,message:`${i.name}  ${l.name} ${i._lastBreakthroughLifespanGain||0} `})}else i.currentExp=0,i=bp(i,t,n,s,!1,l.name),o.push({type:"NPC_BREAKTHROUGH_FAIL",npcName:i.name,tier:i.tier,message:`${i.name} `});return{npc:i,events:o}}function Pk(e,t,n,s){const o=[];let i={...e};if(!i.tier||!i.stats)return{npc:i,events:o};const a=i.currentExp/(i.maxExp||100);if(a<.75||a>=1)return{npc:i,events:o};const l=Tn(i.tier),d=vp.DIFFICULTY_MULTIPLIER[i.tier]||1,u=Ck(i,d);if(Math.random()<u){const c=Mf(i.tier);if(!c)return{npc:i,events:o};if(i.tier=c.name,i.tierTitle=c.name,i.currentExp=0,i.maxExp=c.maxExp,i.stats){const y=Ly(l,c),S=Math.floor(y*vp.LIFESPAN_GAIN_MULTIPLIER);i.stats={...i.stats,lifespan:(i.stats.lifespan||100)+S},i._lastBreakthroughLifespanGain=S,i._lastBreakthroughType="natural"}if(i.combatStats){const y=Math.floor(i.combatStats.maxHp*.4),S=Math.floor(i.combatStats.atk*.25);i.combatStats={...i.combatStats,maxHp:i.combatStats.maxHp+y,hp:i.combatStats.maxHp+y,atk:i.combatStats.atk+S}}i=bp(i,t,n,s,!0,c.name);const m=i._lastBreakthroughLifespanGain||0;o.push({type:"NPC_NATURAL_BREAKTHROUGH",npcName:i.name,newTier:c.name,message:`${i.name}  ${c.name} ${m} `})}return{npc:i,events:o}}function zk(e,t,n,s){if(!e||!Array.isArray(e))return{npcs:e||[],events:[]};const o=[],i=s===1;return{npcs:e.map(l=>{var d,u,p;try{let c=$y(l);if(c.isDead)return c;if(i&&(c=Bk(c,t,n,s),c.isDead))return o.push({type:"NPC_DEATH",npcName:c.name,reason:c.deathReason,message:`${c.name} ${c.deathReason}`}),c;if(!c.isDead){const y=Fr(c);(((d=c.relationship)==null?void 0:d.affection)||0)>=Nk&&y>0&&y<=Mk&&!c._lifespanAlerted?(c={...c,_lifespanAlerted:!0},o.push({type:"NPC_LIFESPAN_ALERT",npcId:c.id,npcName:c.name,remainingYears:y})):c._lifespanAlerted&&y>Ak&&(c={...c,_lifespanAlerted:!1})}if(s%6===0){const y=((u=c.relationship)==null?void 0:u.affection)||0,S=((p=c.relationship)==null?void 0:p.stage)||0;if(y>=60&&S>=1&&Math.random()<.2){const E=Dk(c,t);E&&o.push(E)}}const m=Ok(c,t,n,s);return c=(m==null?void 0:m.npc)||c,m!=null&&m.events&&Array.isArray(m.events)&&o.push(...m.events),c}catch(c){return console.error("Error processing NPC lifecycle for:",l==null?void 0:l.name,c),l}}),events:o}}const qn={HOSTILE:"HOSTILE",NEUTRAL:"NEUTRAL",FRIENDLY:"FRIENDLY",INTIMATE:"INTIMATE"};function Dk(e,t){var m,y,S;const n=((m=e.relationship)==null?void 0:m.affection)||0,s=e.tier||"",o=Lk(s);if((((y=e.relationship)==null?void 0:y.stage)||0)<1)return null;const a=$k.filter(E=>{const w=n>=E.affectionRequirement,g=o>=E.tierRequirement;return w&&g});if(!a.length)return null;const l=a.map(E=>({option:E,weight:Math.max(1,8-E.resourceOrder*2)})),d=l.reduce((E,w)=>E+w.weight,0);if(d===0||!l.length)return null;let u=Math.random()*d,p=(S=l[0])==null?void 0:S.option;if(!p)return null;for(const{option:E,weight:w}of l)if(u-=w,u<=0){p=E;break}if(!p||!p.itemId)return null;const c=[`${e.name}""`,`${e.name}`,`${e.name}""`,`${e.name}Ta`];return{type:"NPC_GIFT",npcName:e.name,npcId:e.id,giftItemId:p.itemId,message:c[Math.floor(Math.random()*c.length)]}}function Oy(e=0){return e<0?qn.HOSTILE:e<50?qn.NEUTRAL:e<80?qn.FRIENDLY:qn.INTIMATE}function Fk(e){const t={[qn.HOSTILE]:{text:"",color:"#f44336",icon:""},[qn.NEUTRAL]:{text:"",color:"#9e9e9e",icon:""},[qn.FRIENDLY]:{text:"",color:"#4caf50",icon:""},[qn.INTIMATE]:{text:"",color:"#e91e63",icon:""}};return t[e]||t[qn.NEUTRAL]}function au(e,t){var o;const n=((o=e.relationship)==null?void 0:o.affection)||0,s=Oy(n);switch(t){case"DUAL_CULTIVATION":if(s!==qn.INTIMATE)return{allowed:!1,reason:" >= 80"};if(e.identity===""&&(e.dualCultivationCount||0)===0)return{allowed:!0,requiresCheck:!0,checkRate:.05};break;case"GIFT":if(s===qn.HOSTILE)return{allowed:!1,reason:""};break;case"SPAR":if(s===qn.HOSTILE)return{allowed:!1,reason:""};break}return{allowed:!0}}const Hk=["","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","",""],Wk=["","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","",""],gg=["","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","",""],hg=["","","","","","","","","","","","","","","","","","","",""],xg=[{label:"",baseApt:20,desc:""},{label:"",baseApt:40,desc:""},{label:"",baseApt:80,desc:""},{label:"",baseApt:75,desc:""},{label:"",baseApt:70,desc:""},{label:"",baseApt:65,desc:""},{label:"",baseApt:60,desc:""},{label:"",baseApt:70,desc:""},{label:"",baseApt:70,desc:""},{label:"",baseApt:75,desc:""},{label:"",baseApt:65,desc:""},{label:"",baseApt:10,desc:""},{label:"",baseApt:80,desc:""},{label:"",baseApt:85,desc:""},{label:"",baseApt:70,desc:""},{label:"",baseApt:65,desc:""},{label:"",baseApt:60,desc:""},{label:"",baseApt:65,desc:""},{label:"",baseApt:55,desc:""}],yg=[{label:"",tag:"",desc:""},{label:"",tag:"",desc:""},{label:"",tag:"",desc:""},{label:"",tag:"",desc:""},{label:"",tag:"",desc:""},{label:"",tag:"",desc:""},{label:"",tag:"",desc:""},{label:"",tag:"",desc:""},{label:"",tag:"",desc:""},{label:"",tag:"",desc:""},{label:"",tag:"",desc:""},{label:"",tag:"",desc:""},{label:"",tag:"",desc:""},{label:"",tag:"",desc:""},{label:"",tag:"",desc:""},{label:"",tag:"",desc:""},{label:"",tag:"",desc:""}],Uk=e=>{const{stats:t,spiritRoot:n,identity:s}=e,o=(t==null?void 0:t.aptitude)||50,i=(n==null?void 0:n.elements)||[];let l={:["SWORD","HEAVEN_EMPEROR","THUNDER"],:["SWORD"],:["DAN"],:["NINE_STAR"],:["NINE_STAR","FLOWER"],:null,:["DEMON"],:["BLOOD"],:["DEMON","GHOST"],:["GHOST"],:["STONE"],:["GRASS"],:["GHOST","BLOOD"],:["FLOWER"],:null,:null,:"NONE",:Math.random()<.3?"random":"NONE",:"random",:null}[s.label];if(l==="random"&&(l=Er.filter(m=>!(m.id==="NONE"||o<m.minApt||m.prefElements&&m.prefElements.length>0&&!i.some(S=>m.prefElements.includes(S))&&o<m.minApt+10)).map(m=>m.id),l.length===0&&(l="NONE")),l===null)return{sect:null,sectId:null,rank:null,status:"mysterious"};if(l==="NONE")return{sect:Er.find(m=>m.id==="NONE"),sectId:"NONE",rank:"",status:"rogue"};const d=Array.isArray(l)?l[Math.floor(Math.random()*l.length)]:l,u=Er.find(m=>m.id===d);if(!u)return{sect:Er.find(m=>m.id==="NONE"),sectId:"NONE",rank:"",status:"rogue"};const p=ea(e,u);let c="active";return Math.random()<.1?c="defected":Math.random()<.05&&(u.level==="RECKLESS"||s.label.includes(""))&&(c="hidden"),{sect:u,sectId:u.id,rank:p,status:c}},Gk=()=>({base:Math.floor(Math.random()*Ew.length),skinColor:Math.floor(Math.random()*ww.length),eye:Math.floor(Math.random()*jw.length),eyeColor:Math.floor(Math.random()*kw.length),mouth:Math.floor(Math.random()*Cw.length),hair:Math.floor(Math.random()*Tw.length),hairColor:Math.floor(Math.random()*yp.length)}),wp=(e,t="")=>{const n=Date.now()+Math.random().toString().slice(2,6),s=Gl(),o=s.tier||e||"",i=qe.find(V=>V.name===o)||qe[1],a=s.maxExp??i.maxExp,l=Math.min(s.currentExp??0,a),d=18+Math.floor(Math.random()*100),p=Math.random()<.15?hg[Math.floor(Math.random()*hg.length)]:gg[Math.floor(Math.random()*gg.length)],c=t===""?Wk:Hk,m=c[Math.floor(Math.random()*c.length)];let y=Math.floor(Math.random()*80)+10;Math.random()<.05&&(y=90+Math.floor(Math.random()*10));let S={aptitude:y,looks:50+Math.floor(Math.random()*50),intelligence:40+Math.floor(Math.random()*60),health:80};const E=M2();S=If(S,E);const w=Gk();let g="";w.eye===1&&(g=""),w.eye===2&&(g="");const h=`${w.skin===0?"":""}${g}`,v=Xo(y,{constitution:E}),I=Sn({tier:o,currentExp:l,maxExp:a,stats:S,spiritRoot:v,equipment:null}),_=xg[Math.floor(Math.random()*xg.length)],C=Uk({stats:S,spiritRoot:v,identity:_});let j=_.desc;C.status==="mysterious"?j+=" ":C.status==="rogue"?j+=" ":C.status==="defected"?j+=` ${C.sect.name}${C.rank}`:C.status==="hidden"?j+=` ${C.rank}`:C.status==="active"&&C.sect&&(j+=` ${C.sect.name}${C.rank}`);const A=vc({age:d,stats:S,tier:o,spiritRoot:v});return S={...S,lifespan:A},{id:n,name:p+m,gender:t,age:d,identity:_.label,desc:j,avatar:w,appearance:h,tier:o,currentExp:l,maxExp:a,stats:S,constitution:E,spiritRoot:v,cultivationMethod:"basic_breath",combatStats:I,personality:yg[Math.floor(Math.random()*yg.length)],sect:C.sect,sectId:C.sectId,sectRank:C.rank,sectStatus:C.status,relationship:{stage:0,affection:0,trust:0,jealousy:0},acceptsLetters:!0,isPregnant:!1}};function $f(e,t){if(!e)return e;const n={...e,stats:{...e.stats||{},aptitude:t}};try{if(n.isTested||n.spiritRoot&&Array.isArray(n.spiritRoot.elements)){const s=tr(t,n.spiritRoot,null,{constitution:n.constitution});n.spiritRoot=s}}catch{}return n}function Vk(e,t){return $f(e,t)}const Yk=e=>{const t=e.reduce((s,o)=>s+(o.weight||1),0);let n=Math.random()*t;for(const s of e)if(n-=s.weight||1,n<=0)return s;return e[e.length-1]},qk=[ft.PLAYER,ft.CHILD],Kk={YELLOW:"common",BLACK:"uncommon",EARTH:"rare",HEAVEN:"epic",DIVINE:"legendary"},Qk={YELLOW:Q.MORTAL.key,BLACK:Q.SPIRIT.key,EARTH:Q.EARTH.key,HEAVEN:Q.HEAVEN.key,DIVINE:Q.DIVINE.key},Jk={basic:["YELLOW","BLACK"],advanced:["EARTH"],apex:["HEAVEN","DIVINE"]},bg={[Q.MORTAL.key]:1,[Q.SPIRIT.key]:2,[Q.EARTH.key]:3,[Q.HEAVEN.key]:4,[Q.DIVINE.key]:5},Xk=(e,t)=>{const n=bg[t]||1;return e.filter(s=>{const o=Vo(s);return o?(bg[o.resourceLevel]||1)<=n:!0})},Zk=(e=["YELLOW"],t)=>{var i,a;let n=Object.values(_2).filter(l=>e.includes(l.tier));if(!n.length)return null;const s=((a=(i=t==null?void 0:t.player)==null?void 0:i.spiritRoot)==null?void 0:a.elements)||[],o=n.filter(l=>s.includes(l.element));return o.length&&(n=o),n[Math.floor(Math.random()*n.length)]},eE=e=>{const t=mn[e];if(!t)return null;const n=Gc[t.tier]||{};return{id:`manual_scroll_${e}`,name:`${t.name}`,type:"manual",rarity:Kk[t.tier]||"rare",tier:n.name||t.tier,tierColor:n.color,element:t.element,baseBonus:`${Math.round((n.baseBuff||0)*100)}%`,desc:t.desc,manualIds:[e],resourceCategory:"MANUAL",resourceLevel:t.resourceLevel||Qk[t.tier]||Q.MORTAL.key,manualSchool:t.school,usageTargets:qk,tags:[t.element||"",t.tier]}},vg=(e,t)=>{const n=Jk[e]||["YELLOW"],s=Zk(n,t);if(!s)return null;const o=s.manualIds[Math.floor(Math.random()*s.manualIds.length)];return eE(o)},Sg=(e,t)=>{const n=Bf(e);if(!n)return vg("basic",t);const s=n.resourceLevel||"MORTAL";let o="basic";return s==="DIVINE"?o="apex":s==="HEAVEN"?o=Math.random()<.8?"advanced":"apex":s==="EARTH"&&(o=Math.random()<.6?"basic":"advanced"),vg(o,t)},Bf=e=>Ry.find(t=>t.id===e),tE=(e,t=1)=>{const n=Bf(e)||{recommendCP:300,drops:["herb_bandage"],resourceLevel:"MORTAL"},s=n.recommendCP||300,o=t>=10,i=o?1.5:.6+t*.06,a=Math.floor(s*i),l=o?"":"",d=o?.02:.012,u=Xk(n.drops||["herb_bandage"],n.resourceLevel||"MORTAL");return{name:l,combatStats:{hp:Math.floor(a*.3),atk:Math.floor(a*d),def:Math.floor(a*.0073),mp:0,maxHp:Math.floor(a*.3),maxMp:0},drops:u.length>0?u:["herb_bandage"],isBoss:o}},nE=(e,t)=>!!(e!=null&&e.find(n=>n.id===t)),rE=[{id:"combat_beast",kind:"COMBAT",realm:"ANY",weight:3,title:"",desc:"",options:[{label:"",action:e=>({type:"START_COMBAT"})},{label:"",action:()=>({type:"LOG",msg:""})}]},{id:"loot_array",kind:"LOOT",realm:"ANY",weight:2,title:"",desc:"",options:[{label:" ()",action:e=>{var n,s;return(((s=(n=e.player)==null?void 0:n.combatStats)==null?void 0:s.atk)||10)>80?{type:"LOOT",items:["beast_core"],msg:""}:{type:"HP_CHANGE",hpDelta:-150,msg:""}}},{label:" ()",action:e=>{var n,s;return(((s=(n=e.player)==null?void 0:n.stats)==null?void 0:s.intelligence)||40)>=70?{type:"LOOT",items:["foundation_pill"],msg:""}:{type:"LOG",msg:""}}}]},{id:"encounter_injured",kind:"ENCOUNTER",realm:"ANY",weight:1,title:"",desc:"",options:[{label:" (-1 )",condition:e=>nE(e.inventory,"herb_bandage"),action:e=>{let t=wp("");try{t=$f(t,Math.max(t.stats.aptitude||0,90))}catch{t.stats.aptitude=Math.max(t.stats.aptitude||0,90)}return{type:"NPC_JOIN",npc:t,removeItemId:"herb_bandage",msg:""}}},{label:"",action:()=>({type:"LOOT",items:["spirit_stones_500"],msg:""})},{label:"",action:()=>({type:"LOG",msg:""})}]},{id:"fruit_unknown",kind:"LOOT",realm:"ANY",weight:1,title:"",desc:"",options:[{label:"",action:()=>{const e=Math.random();return e<.4?{type:"EXP_GAIN",amount:1200,msg:""}:e<.8?{type:"HP_CHANGE",hpDelta:-120,msg:""}:{type:"LOG",msg:""}}},{label:"",action:()=>({type:"LOG",msg:""})}]},{id:"story_two_beasts",kind:"STORY",realm:"ANY",weight:1,title:"",desc:"",options:[{label:"",action:()=>({type:"LOOT",items:["beast_fang"],msg:""})},{label:"",action:()=>({type:"LOG",msg:""})}]},{id:"manual_cave",kind:"LOOT",realm:"ANY",weight:1,title:"",desc:"",options:[{label:"",action:e=>{const t=Sg(e.realmId,e);return t?{type:"LOOT",items:[t],msg:""}:{type:"LOG",msg:""}}},{label:"",action:()=>({type:"LOG",msg:""})}]},{id:"fortune_telling",kind:"ENCOUNTER",realm:"ANY",weight:1,title:"",desc:'""',options:[{label:" (100)",condition:e=>{var t,n;return(((n=(t=e.player)==null?void 0:t.resources)==null?void 0:n.spiritStones)||0)>=100},action:e=>{const t=[{type:"EXP_GAIN",amount:2e3,msg:""},{type:"LOG",msg:""},{type:"LOG",msg:""},{type:"LOOT",items:["spirit_stones_200"],msg:""}];return{...t[Math.floor(Math.random()*t.length)],spiritStonesDelta:-100}}},{label:"",action:()=>({type:"LOG",msg:'""'})}]},{id:"spirit_fruit_grove",kind:"LOOT",realm:"ANY",weight:1,title:"",desc:"",options:[{label:"",action:()=>{const e=[{items:["spirit_stones_300"],msg:""},{items:["foundation_pill"],msg:""},{type:"EXP_GAIN",amount:1500,msg:""}],t=e[Math.floor(Math.random()*e.length)];return{type:t.type||"LOOT",...t}}},{label:"",action:()=>({type:"LOG",msg:""})}]},{id:"ancient_script",kind:"LOOT",realm:"ANY",weight:1,title:"",desc:"",options:[{label:"",action:e=>{var s,o;const t=((o=(s=e.player)==null?void 0:s.stats)==null?void 0:o.intelligence)||40,n=[40,60,80][Math.floor(Math.random()*3)];return t>=n?{type:"LOOT",items:["wisdom_pill"],msg:""}:{type:"HP_CHANGE",hpDelta:-80,msg:""}}},{label:"",action:()=>({type:"LOG",msg:""})}]},{id:"spirit_pool",kind:"LOOT",realm:"ANY",weight:1,title:"",desc:"",options:[{label:"",action:()=>{const e=[{type:"EXP_GAIN",amount:3e3,msg:""},{type:"LOOT",items:["primordial_spirit_pill"],msg:""},{type:"LOG",msg:""}];return e[Math.floor(Math.random()*e.length)]}},{label:"",action:()=>({type:"LOG",msg:""})}]},{id:"treasure_chest",kind:"LOOT",realm:"ANY",weight:.8,title:"",desc:"",options:[{label:"",action:e=>{var n,s;const t=((s=(n=e.player)==null?void 0:n.combatStats)==null?void 0:s.atk)||30;return t>100?{type:"LOOT",items:["cosmic_crystal","spirit_stones_500"],msg:""}:t>50?{type:"LOOT",items:["spirit_stones_300"],msg:""}:{type:"HP_CHANGE",hpDelta:-50,msg:""}}},{label:"",action:()=>({type:"LOOT",items:["spirit_stones_200"],msg:""})},{label:"",action:()=>({type:"LOG",msg:""})}]},{id:"meditation_spot",kind:"ENCOUNTER",realm:"ANY",weight:1,title:"",desc:"",options:[{label:"",action:()=>{const e=[{type:"EXP_GAIN",amount:2500,msg:""},{type:"LOOT",items:["awakening_pill"],msg:""},{type:"LOG",msg:""}];return e[Math.floor(Math.random()*e.length)]}},{label:"",action:()=>({type:"LOG",msg:""})}]},{id:"rival_encounter",kind:"ENCOUNTER",realm:"ANY",weight:.8,title:"",desc:"",options:[{label:"",action:()=>({type:"LOG",msg:Math.random()<.5?" ":" "})},{label:"",action:()=>({type:"LOG",msg:""})},{label:"",action:()=>({type:"LOOT",items:["spirit_stones_250"],msg:""})}]},{id:"demonic_lair",kind:"ENCOUNTER",realm:"ANY",weight:.5,title:"",desc:"",options:[{label:"",action:e=>{const t=Math.random();return t<.3?{type:"LOOT",items:["void_silk"],msg:""}:t<.6?{type:"HP_CHANGE",hpDelta:-150,msg:""}:{type:"LOG",msg:""}}},{label:"",action:()=>({type:"LOG",msg:""})}]},{id:"celestial_lake",kind:"ENCOUNTER",realm:"ANY",weight:1,title:"",desc:"",options:[{label:"",action:()=>{const e=[{type:"LOOT",items:["spirit_stones_400"],msg:""},{type:"EXP_GAIN",amount:1e3,msg:""},{type:"LOG",msg:""}];return e[Math.floor(Math.random()*e.length)]}},{label:"",action:()=>({type:"LOG",msg:""})}]},{id:"manual_library",kind:"LOOT",realm:"ANY",weight:1,title:"",desc:"",options:[{label:"",action:e=>{const t=Sg(e.realmId,e);return t?{type:"LOOT",items:[t],msg:""}:{type:"LOG",msg:""}}},{label:"",action:()=>({type:"LOG",msg:""})}]}],sE=e=>{const t=Bf(e),n=t!=null&&t.name?`${t.name}  `:"";return{id:"boss_guard",kind:"BOSS",realm:e,weight:1,title:n,desc:"",options:[{label:"",action:()=>({type:"START_COMBAT"})},{label:"",action:()=>({type:"LOG",msg:""})}]}},wg=e=>{const{realmId:t,progress:n}=e,o=rE.filter(i=>i.realm==="ANY"||i.realm===t).map(i=>{let a=i.weight||1;return n<=3&&(i.kind==="LOOT"||i.kind==="ENCOUNTER")&&(a*=1.5),n>=7&&i.kind==="COMBAT"&&(a*=1.5),{...i,weight:a}});return Yk(o)},oE=e=>{const t=F2(e);if(!t)return null;const n=Vo(t);if(!n)return null;const s=typeof n.name=="string"?n.name:"";return{giftItemId:t,giftName:s}},co=(e,t)=>Math.random()>.5?e:t,iE=(e={},t=null)=>{const s=Ny(e.aptitude||50);let o=Bo.common_body;t!=null&&t.key&&Bo[t.key]&&(o=Bo[t.key]);const a=bc(0,1,s,o);return Math.floor(a)},Xo=(e,t={})=>{const n=Rf(e);let s=[],o=n.name,i=n.desc;if(n.id==="NONE")s=[];else if(n.id==="MUTANT"||n.id==="MUTANT_HEAVEN")s=[Hm[Math.floor(Math.random()*Hm.length)]];else{const l=[...W2];for(let d=l.length-1;d>0;d--){const u=Math.floor(Math.random()*(d+1));[l[d],l[u]]=[l[u],l[d]]}s=l.slice(0,n.elementCount)}const a=B2(t.constitution);if(a&&a.length>0){const l=a[Math.floor(Math.random()*a.length)];if(n.id==="MUTANT")s=[l];else if(s.length>0){const d=s.indexOf(l);d!==-1&&s.splice(d,1),s.unshift(l)}else s=[l]}return{type:o,elements:s,desc:i,color:n.color,multiplier:n.multiplier}},tr=(e,t,n,s={})=>Xo(e,s),kp=e=>{if(!e)return{recommended:[],others:[]};const t=Er.map(l=>({sect:l,score:wy(e,l),admission:ky(e,l)})),n=[...t].sort((l,d)=>d.score-l.score),s=[];if(n.forEach(l=>{l.sect.id!=="NONE"&&(s.length>=3||l.admission.qualified&&s.push(l))}),s.length<3&&n.forEach(l=>{l.sect.id!=="NONE"&&(s.includes(l)||s.length<3&&s.push(l))}),s.length===0&&n.length){const l=n.find(d=>d.sect.id!=="NONE")||n[0];l&&s.push(l)}const o=l=>({sect:l.sect,predictedRank:l.admission.qualified?ea(e,l.sect):null,resources:q2(l.sect),compatibility:l.score,admission:l.admission}),i=s.map(o),a=t.filter(l=>!s.includes(l)).sort((l,d)=>d.score-l.score).map(o);return{recommended:i,others:a}},aE=(e,t,n)=>{var _,N,C,j,T;const s=e.avatar||{base:0,skinColor:0,eye:2,eyeColor:0,mouth:0,hairColor:0},o=t.avatar,i=Math.random()>.5?"":"",a={base:co(s.base,o.base),skinColor:co(s.skinColor,o.skinColor),eye:co(s.eye,o.eye),eyeColor:co(s.eyeColor,o.eyeColor),mouth:co(s.mouth,o.mouth),hair:Math.floor(i===""?Math.random()*2:Math.random()*4),hairColor:co(s.hairColor,o.hairColor)};let l=((((_=e.stats)==null?void 0:_.aptitude)||50)+(((N=t.stats)==null?void 0:N.aptitude)||50))/2,d=Math.floor(Math.random()*31)-15;Math.random()<.05&&(d+=Math.random()>.5?20:-20),t.constitution&&(d+=5);const u=((C=e.spiritRoot)==null?void 0:C.type)==="",p=((j=t.spiritRoot)==null?void 0:j.type)==="";(u&&Math.random()<.2||p&&Math.random()<.2)&&(d+=30);const c=Math.max(1,Math.min(100,Math.floor(l+d))),m=Math.floor((e.stats.looks+t.stats.looks)/2+(Math.random()*10-5));let y=null;const S=Math.random(),E=e.constitution&&e.constitution.name,w=t.constitution&&t.constitution.name,g=((T=t.customFlags)==null?void 0:T.isFumoLegend)||t.identity===""||t.identity==="";if(E&&w){if(S<.8){const A=Math.random()>.5?t.constitution:e.constitution;y=Dl(A)}}else w?S<(g?1:.6)&&(y=Dl(t.constitution)):E&&S<.6&&(y=Dl(e.constitution));!y&&Math.random()<.01&&(y=vy("innate_dao")||{name:"",desc:"",rarity:"UR"});const h={weapon:null,armor:null,accessory:null};let v={aptitude:c,looks:m,intelligence:Math.floor((e.stats.cunning+t.stats.intelligence)/2)};v=If(v,y);const x=Yo("",v.aptitude,null,h),I=Nf(i,{motherName:e==null?void 0:e.name,fatherName:t==null?void 0:t.name,preferSurname:""});return _p({id:`child_${Date.now()}_${Math.floor(Math.random()*1e5)}`,name:I,fatherName:t.name,birthYear:n,generation:1,age:0,gender:i,stats:{...v,lifespan:iE(v,y)},constitution:y,cultivationMethod:"basic_breath",equipment:h,combatStats:x,avatar:a,isTested:!1,cultivation:0,isAdult:!1})},Py=e=>{for(let t=0;t<qe.length;t++)if(e<qe[t].maxExp)return qe[t];return qe[qe.length-1]},lE=(e,t,n={})=>{var h;let s=0,o=0,i=[],a=[];const l=n.familyRatingMultiplier??1,u=(((h=n.playerStrategy)==null?void 0:h.childrenStrategy)||n.childrenStrategy||{}).skipZhaozhou===!0,p=n.currentYear||0,c=[],m=[],y=[];e.forEach(v=>{(v.generation||1)<=2?m.push(v):y.push(v)});let S=n.generation3Plus||[];y.forEach(v=>{S.find(x=>x.id===v.id)||S.push({id:v.id,generation:v.generation||3,birthYear:p-(v.age||0),parentGeneration:(v.generation||3)-1})});const E=[];return S.forEach(v=>{const x=p-v.birthYear;Math.floor(x)===20&&v.generation<6&&E.push({id:`child_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,generation:v.generation+1,birthYear:p,parentGeneration:v.generation}),x>.5&&(s+=1),E.push(v)}),S=E,{newChildren:[...m.map(v=>{var _,N,C,j,T,A,V,F,B,$,Y,ne,X,ee,ae,Te,Be;let x={...v};x.age+=1/12;const I=x.generation||1;if(x.stats||(x.stats={}),!x.stats.lifespan){const ze=((_=x.spiritRoot)==null?void 0:_.multiplier)||1,W=100;x.stats.lifespan=Math.floor(W*(1+ze))}if(Math.floor(x.age*12)===12&&!x.trait){const ze=Math.random()*100;let W="WHITE";ze>99?W="RED":ze>95?W="ORANGE":ze>85?W="PURPLE":ze>65?W="BLUE":ze>35&&(W="GREEN");const J=Wm.filter(ce=>ce.rarity===W),fe=J[Math.floor(Math.random()*J.length)]||Wm[0];x.trait=fe;const re=` ${x.name} ${fe.name}(${fe.desc})`;i.push(re),u||a.push({type:"ZHAOZHOU",title:"",message:re,child:x,trait:fe,showModal:!0})}if(Math.floor(x.age*12)===144&&x.isTested&&!x.sect){const{recommended:ze,others:W}=kp(x),J=` ${x.name} 12`;i.push(J),a.push({type:"JOIN_SECT",title:"",message:J,child:x,selectableSects:ze,otherSectOptions:W,showModal:!0})}if(x.age>6){const ze=Vc(x,!0);x.cultivation=Math.floor(x.cultivation+ze);const W=Py(x.cultivation),J=x.tierTitle;x.tierTitle=W.name;const fe=qe.findIndex(ce=>ce.name===W.name),re=fe>0?qe[fe-1].maxExp:0;if(x.currentExp=x.cultivation-re,x.maxExp=W.maxExp-re,J&&J!==x.tierTitle){const Ce={:30,:30,:30,:30,:50,:50,:50,:50,:200,:200,:200,:200,:300,:300,:300,:300,:500,:500,:500,:500}[x.tierTitle]||50;x.stats||(x.stats={}),typeof x.stats.lifespan!="number"&&(x.stats.lifespan=100),x.stats.lifespan+=Ce,i.push(` ${x.name} ${x.tierTitle} ${Ce} `)}if((x.generation||1)>2)return s+=xc(x,{familyRatingMultiplier:l})/12,x;if(s+=xc(x,{familyRatingMultiplier:l})/12,Math.floor(x.age*12)%36===0&&x.sect&&x.sect.level!=="NONE"){const ce=["","","","","","","",""],Ce=ce.indexOf(x.rank),Ge=Math.max(.3,Math.min(2,((N=x.sect)==null?void 0:N.promotionEase)||1)),Ne=Le=>Le/Ge;let nt=0;if(x.cultivation>Ne(500)&&(nt=1),x.cultivation>Ne(2e3)&&(((C=x.stats)==null?void 0:C.aptitude)||0)>50&&(nt=2),x.cultivation>Ne(2e4)&&(((j=x.stats)==null?void 0:j.aptitude)||0)>80&&(nt=3),x.cultivation>Ne(1e5)&&(nt=5),x.cultivation>Ne(2e5)&&(((T=x.stats)==null?void 0:T.aptitude)||0)>90&&(nt=6),x.cultivation>Ne(35e4)&&(((A=x.stats)==null?void 0:A.aptitude)||0)>95&&(nt=7),nt===7&&Array.isArray(n.worldNpcs)&&((V=x.sect)!=null&&V.id)&&n.worldNpcs.some(z=>{var ue;return((ue=z==null?void 0:z.sect)==null?void 0:ue.id)===x.sect.id&&(z==null?void 0:z.sectRank)===""&&(z==null?void 0:z.status)!=="DEAD"})&&(nt=6),nt>Ce){x.rank=ce[nt];let Le=` ${x.name} ${x.sect.name}  ${x.rank}`;const z=oE(x.rank);z&&(Le+=` ${z.giftName}${x.name} `,a.push({type:"CHILD_PROMOTION_GIFT",title:"",message:Le,child:x,rank:x.rank,sect:x.sect,giftItemId:z.giftItemId,giftName:z.giftName,showModal:!0})),i.push(Le)}}}if(Math.floor(x.age*12)===216&&(i.push(` ${x.name} `),x.isAdult=!0),I<=2&&x.isAdult&&x.spouse&&x.age<60&&Math.random()<.1&&e.filter(W=>W.parentId===x.id).length<3){const W=((F=x.stats)==null?void 0:F.aptitude)||50,J=(($=(B=x.spouse)==null?void 0:B.stats)==null?void 0:$.aptitude)||((Y=x.spouse)==null?void 0:Y.aptitude)||50,fe=(W+J)/2;let re=Math.floor(Math.random()*31)-15;const ce=((ne=x.spiritRoot)==null?void 0:ne.type)==="",Ce=((ee=(X=x.spouse)==null?void 0:X.spiritRoot)==null?void 0:ee.type)==="";(ce&&Math.random()<.2||Ce&&Math.random()<.2)&&(re+=30);const Ge=Math.max(1,Math.min(100,Math.floor(fe+re))),Ne=x.stats.looks||50,nt=((ae=x.spouse.stats)==null?void 0:ae.looks)||x.spouse.looks||50,Le=Math.max(1,Math.min(100,Math.floor((Ne+nt)/2+(Math.random()*10-5)))),z=x.stats.intelligence||50,ue=((Te=x.spouse.stats)==null?void 0:Te.intelligence)||x.spouse.intelligence||50,ve=Math.max(1,Math.min(100,Math.floor((z+ue)/2+(Math.random()*10-5))));let ge=null;const Ee=Math.random(),Ke=x.constitution&&x.constitution.name,Ut=((Be=x.spouse)==null?void 0:Be.constitution)&&x.spouse.constitution.name;Ke&&Ut?Ee<.8&&(ge=Math.random()>.5?x.constitution:x.spouse.constitution):Ke?Ee<.6&&(ge=x.constitution):Ut&&Ee<.6&&(ge=x.spouse.constitution),!ge&&Math.random()<.01&&(ge={name:"",desc:"",rarity:"UR"});const xn={weapon:null,armor:null,accessory:null};let Et={aptitude:Ge,looks:Le,intelligence:ve};Et=If(Et,ge);const lr=Yo("",Et.aptitude,null,xn),Kr=Math.random()>.5?"":"",Qs=_p({id:Date.now()+Math.random().toString().slice(2,10),name:Nf(Kr,{preferSurname:""}),fatherName:x.name,motherName:x.spouse.name,parentId:x.id,birthYear:Math.floor(x.age*12/12),generation:(x.generation||1)+1,age:0,gender:Kr,stats:Et,constitution:ge,cultivationMethod:"basic_breath",equipment:xn,combatStats:lr,avatar:{base:Math.floor(Math.random()*3),skinColor:Math.floor(Math.random()*5),eye:Math.floor(Math.random()*3),eyeColor:Math.floor(Math.random()*5),mouth:Math.floor(Math.random()*3),hair:Math.floor(Kr===""?Math.random()*2:Math.random()*4),hairColor:Math.floor(Math.random()*5)},isTested:!1,cultivation:0,isAdult:!1});c.push(Qs);const cr=` ${x.name}  ${x.spouse.name} /${Qs.name}`;i.push(cr),a.push({type:"GRANDCHILD_BIRTH",title:"",message:cr,child:x,grandchildCount:1})}return x}),...c],generation3Plus:S,totalFeedback:s,totalCost:o,logs:i,events:a}},Hl=(e,t,n="random")=>{const s=t===""?"":"",o=Nf(s);let i,a,l,d=null;switch(n){case"talented":i=75+Math.floor(Math.random()*20),a=40+Math.floor(Math.random()*30),l=60+Math.floor(Math.random()*30);break;case"beautiful":i=50+Math.floor(Math.random()*30),a=80+Math.floor(Math.random()*20),l=50+Math.floor(Math.random()*30);break;case"wise":i=60+Math.floor(Math.random()*25),a=55+Math.floor(Math.random()*30),l=80+Math.floor(Math.random()*20);break;case"buddha":i=90+Math.floor(Math.random()*10),a=30+Math.floor(Math.random()*30),l=80+Math.floor(Math.random()*20),d="";break;default:i=40+Math.floor(Math.random()*50),a=50+Math.floor(Math.random()*40),l=40+Math.floor(Math.random()*40)}const u=Xo(i),p={weapon:null,armor:null,accessory:null},c=Yo("",i,u.type,p),m=500+Math.floor(Math.random()*1500),y=Py(m).name,S=n==="buddha"?{base:0,skinColor:2,hair:-1,hairColor:null,eye:0,eyeColor:0,mouth:1}:{base:Math.floor(Math.random()*3),skinColor:Math.floor(Math.random()*5),eye:Math.floor(Math.random()*3),eyeColor:Math.floor(Math.random()*5),mouth:Math.floor(Math.random()*3),hair:Math.floor(Math.random()*3),hairColor:Math.floor(Math.random()*5)},E=n==="buddha"?"":s;return{id:Date.now()+Math.random().toString().slice(2,8),name:o,gender:E,identity:d,aptitude:i,looks:a,intelligence:l,spiritRoot:u,cultivationMethod:"basic_breath",equipment:p,combatStats:c,cultivation:m,tierTitle:y,isTested:!0,isAdult:!0,avatar:S,stats:{aptitude:i,looks:a,intelligence:l},relationship:n==="buddha"?{stage:1,affection:0,trust:0}:void 0,likes:n==="buddha"?[""]:void 0,isSpouse:!0,archetype:n}},kg=(e,t)=>[Hl(e,t,"talented"),Hl(e,t,"beautiful"),Hl(e,t,"wise")],cE=(e,t)=>Hl(e,t,"random"),dE=e=>{const t=Tn(e.tier),n=Mf(e.tier);if(!n)return{success:!1,msg:""};const s=t.chance,o=(e.breakthroughBonus||0)/100,i=Math.min(.95,s+o);if(Math.random()<i)return{success:!0,newTier:n.name,newMaxExp:n.maxExp,baseChance:s,finalChance:i,resetFailCount:!0,msg:`${n.name}()`};{const d=Math.floor(t.maxExp*.2);return{success:!1,penalty:d,baseChance:s,finalChance:i,addFailBonus:!0,msg:` ${d} 5%`}}},Eg=(e,t)=>{let n=0,s=[];return e.forEach(o=>{var p,c;const i=t.find(m=>m.id===o.managerId);if(!i){s.push(` ${o.name}`);return}const a=Math.floor(o.baseIncome*(1+i.stats.intelligence/100)),l=((c=(p=i.trait)==null?void 0:p.bonuses)==null?void 0:c.businessBonus)||0,d=L2(i.constitution),u=Math.floor(a*(1+l+d));n+=u}),{income:n,logs:s}};function uE(){const e=b.useMemo(()=>Iy.map(x=>{var _;const I=(_=x.stats)==null?void 0:_.aptitude;return typeof I=="number"?{...x,spiritRoot:Xo(I)}:x}),[]),[t,n]=b.useState(e),[s,o]=b.useState([]),[i,a]=b.useState(null),[l,d]=b.useState(null),u=b.useMemo(()=>t.filter(x=>{var I;return!((I=x.relationship)!=null&&I.cutTies)}),[t]),p=b.useCallback((x,I)=>{n(_=>_.map(N=>N.id===x?{...N,relationship:{...N.relationship,...I}}:N))},[]),c=b.useCallback((x,I)=>{n(_=>_.map(N=>N.id===x?{...N,...I}:N))},[]),m=b.useCallback(x=>{n(I=>[...I,x])},[]),y=b.useCallback(x=>{n(I=>{const _=I.find(N=>N.id===x);return _&&o(N=>[...N,_]),I.filter(N=>N.id!==x)})},[]),S=b.useCallback(x=>{n(I=>I.map(_=>_.id===x?{..._,isFollowed:!_.isFollowed}:_))},[]),E=b.useCallback(x=>{n(I=>I.map(x))},[]),w=b.useCallback(x=>{n(x)},[]),g=b.useCallback(x=>{n(I=>I.map(_=>x.get(_.id)||_))},[]),h=b.useCallback(x=>{const I=t.find(_=>_.id===x);I&&(o(_=>[..._,I]),n(_=>_.filter(N=>N.id!==x)))},[t]),v=b.useCallback(x=>{n(I=>I.map(_=>_.id===x?{..._,relationship:{..._.relationship||{},affection:0,trust:0,cutTies:!0}}:_))},[]);return{activeNpcs:t,deadNpcs:s,selectedNpc:i,selectedWorldNpc:l,visibleNpcs:u,setActiveNpcs:n,setDeadNpcs:o,setSelectedNpc:a,setSelectedWorldNpc:d,updateNpcRelationship:p,updateNpc:c,addNpc:m,removeNpc:y,toggleNpcFollow:S,batchUpdateNpcs:E,replaceAllNpcs:w,batchUpdateNpcsByMap:g,killNpc:h,cutTiesWithNpc:v}}function pE(){const[e,t]=b.useState([]),[n,s]=b.useState([]),[o,i]=b.useState(null),a=b.useCallback(g=>g?{...g,influenceProfile:jy(g)}:null,[]),l=b.useMemo(()=>e.map(a),[e,a]),d=b.useCallback(g=>{const h=((g==null?void 0:g.exiledChildren)||[]).map(v=>v.id);return l.filter(v=>!h.includes(v.id))},[l]),u=b.useCallback(g=>{i(typeof g=="function"?h=>a(g(h)):a(g))},[a]),p=b.useCallback((g,h)=>{t(v=>v.map(x=>x.id===g?{...x,...h}:x)),i(v=>!v||v.id!==g?v:a({...v,...h}))},[a]),c=b.useCallback(g=>{t(h=>[...h,g])},[]),m=b.useCallback(g=>{t(h=>{const v=h.find(x=>x.id===g);return v&&s(x=>[...x,v]),h.filter(x=>x.id!==g)})},[]),y=b.useCallback(g=>{t(h=>h.map(v=>v.id===g?{...v,isFavorite:!v.isFavorite}:v)),i(h=>{if(!h||h.id!==g)return h;const v={...h,isFavorite:!h.isFavorite};return a(v)})},[a]),S=b.useCallback(g=>{t(h=>h.map(g).filter(v=>v!==null))},[]),E=b.useCallback(g=>{t(g)},[]),w=b.useCallback((g,h)=>{t(v=>v.map(x=>g(x)?h(x):x))},[]);return{children:e,fallenChildren:n,selectedChild:o,enhancedChildren:l,setChildren:t,setFallenChildren:s,setSelectedChild:u,enhanceChild:a,visibleChildren:d,updateChild:p,addChild:c,removeChild:m,toggleChildFavorite:y,batchUpdateChildren:S,replaceAllChildren:E,batchUpdateChildrenIf:w}}const fE={},xl="./",mE=-.04,gE=0,hE=e=>typeof e=="string"&&e.startsWith("#")?e:typeof e=="number"?yp[e]||yp[0]:"#2C2C2C",xE=e=>{const t=e.replace("#",""),n=parseInt(t.substring(0,2),16)/255,s=parseInt(t.substring(2,4),16)/255,o=parseInt(t.substring(4,6),16)/255,i=Math.max(n,s,o),a=Math.min(n,s,o);let l=0,d=0,u=(i+a)/2;if(i!==a){const p=i-a;switch(d=u>.5?p/(2-i-a):p/(i+a),i){case n:l=(s-o)/p+(s<o?6:0);break;case s:l=(o-n)/p+2;break;case o:l=(n-s)/p+4;break}l/=6}return d=Math.max(0,Math.min(1,d*.9)),u=Math.max(0,Math.min(1,u*1.05)),`hsl(${Math.round(l*360)} ${Math.round(d*100)}% ${Math.round(u*100)}%)`},yE=e=>new Promise((t,n)=>{if(!e){n(new Error("Missing asset source"));return}const s=new Image;s.crossOrigin="anonymous",s.onload=()=>t(s),s.onerror=o=>n(o),s.src=e}),bE=(e,t,n)=>{const s=Math.min(t/e.width,n/e.height);let o=e.width*s,i=e.height*s,a=(t-o)/2,l=(n-i)/2;return o=Math.round(o),i=Math.round(i),a=Math.round(a),l=Math.round(l),{offsetX:a,offsetY:l,drawWidth:o,drawHeight:i}},vE=(e,t,n,s)=>{const o=e.canvas.width,i=e.canvas.height,a=document.createElement("canvas");a.width=o,a.height=i;const l=a.getContext("2d");l.imageSmoothingEnabled=!0,l.imageSmoothingQuality="high",l.drawImage(t,n.offsetX,n.offsetY,n.drawWidth,n.drawHeight);const d=document.createElement("canvas");d.width=o,d.height=i;const u=d.getContext("2d");u.imageSmoothingEnabled=!0,u.imageSmoothingQuality="high",u.fillStyle=xE(s),u.fillRect(n.offsetX,n.offsetY,n.drawWidth,n.drawHeight),u.globalCompositeOperation="destination-in",u.drawImage(a,0,0),e.drawImage(a,0,0),e.globalCompositeOperation="multiply",e.drawImage(d,0,0),e.globalCompositeOperation="source-over"},Yr=({dna:e,size:t=64,gender:n})=>{const s=b.useRef(null),o=e||{eye:0,mouth:0,hair:0,hairColor:0},i=o.hair??o.hairId??0,a=o.tZoneId??o.eye??0,l=o.mouth??o.mouthId??0,d=n||o.gender,u=d==="female"||d===""||d==="F",p=hE(o.hairColor),c=typeof o.centerBiasX=="number"?o.centerBiasX:mE*t,m=typeof o.centerBiasY=="number"?o.centerBiasY:gE*t,y={width:t,height:t,borderRadius:"8px",border:"3px solid #3e2723",background:"#8d6e63",position:"relative",overflow:"hidden",boxSizing:"border-box"},S={width:"100%",height:"100%",display:"block"},E=(g,h)=>{if(g==="base")return`${xl}assets/male/base_face.png`;if(h==null||h<0)return null;const v=String((h||0)+1).padStart(2,"0");return`${xl}assets/male/${g}/${g}_${v}.png`},w=(g,h)=>{if(g==="base")return`${xl}assets/female/base_face.png`;if(h==null||h<0)return null;const v=String((h||0)+1).padStart(2,"0");return`${xl}assets/female/${g}/${g}${v}.png`};return b.useEffect(()=>{let g=!1;const h=s.current;if(!h)return()=>{g=!0};const v=h.getContext("2d");if(!v)return()=>{g=!0};const x=Math.round(t),I=typeof window<"u"&&window.devicePixelRatio?window.devicePixelRatio:1,_=Math.max(1,Math.round(x*I)),N=Math.round(c*I),C=Math.round(m*I);h.width=_,h.height=_,h.style.width=`${x}px`,h.style.height=`${x}px`,v.imageSmoothingEnabled=!0,v.imageSmoothingQuality="high",v.clearRect(0,0,h.width,h.height);const j=w("hair",i),T=E("hair",i),A=u?[{src:w("base")},{src:w("tzone",a)},{src:w("mouth",l)},j?{src:j,tint:p}:null].filter(Boolean):[{src:E("base")},{src:E("tzone",a)},{src:E("mouth",l)},T?{src:T,tint:p}:null].filter(Boolean);return(async()=>{for(const F of A)try{const B=await yE(F.src);if(g)return;const $=bE(B,h.width,h.height);$.offsetX+=N,$.offsetY+=C,F.tint?vE(v,B,$,F.tint):v.drawImage(B,$.offsetX,$.offsetY,$.drawWidth,$.drawHeight)}catch(B){console.warn("Avatar asset failed to load:",F.src,B)}})(),()=>{g=!0}},[t,u,i,l,a,p,c,m]),r.jsx("div",{style:y,children:r.jsx("canvas",{ref:s,style:S})})},SE=({player:e,isAuto:t,onBreakthrough:n,auctionBanner:s})=>{const[o,i]=b.useState(!1),a=Math.floor(e.currentExp||0),l=Math.max(1,Math.floor(e.maxExp||1)),d=a/l,u=Math.min(100,Math.round(d*100)),p=a>=l,c=(e==null?void 0:e.avatar)||{base:0,skinColor:0,hair:0,hairColor:0,eye:0,eyeColor:1,mouth:0};return r.jsxs("div",{style:Gt.container,children:[r.jsxs("div",{style:Gt.left,children:[r.jsx("div",{style:Gt.avatarColumn,children:r.jsx("div",{style:{...Gt.avatar,border:t?"2px solid #76ff03":"none",animation:t?"pulse 1.5s infinite":"none"},children:t?r.jsx("div",{style:{fontSize:"24px"},children:""}):r.jsx(Yr,{dna:c,gender:e.gender,size:44})})}),r.jsxs("div",{style:Gt.info,children:[r.jsx("div",{style:Gt.name,children:e.name}),r.jsx("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:r.jsxs("div",{style:Gt.tier,children:[e.tier,t&&r.jsx("span",{style:Gt.meditateStatus,children:" "})]})})]})]}),r.jsx("div",{style:Gt.expBarContainer,children:r.jsxs("div",{style:Gt.expBarWrapper,children:[r.jsx("div",{style:{...Gt.expBarFill,width:`${u}%`,background:p?"linear-gradient(90deg, #FFD700, #FFA500)":"linear-gradient(90deg, #4CAF50, #81C784)"}}),r.jsxs("div",{style:Gt.expText,children:[a,"/",l]})]})}),r.jsx("div",{style:{flex:1}}),r.jsx("div",{style:Gt.right,children:r.jsxs("div",{style:Gt.statusColumn,children:[r.jsx("div",{style:Gt.timeIcon,children:""}),r.jsxs("div",{style:Gt.timeValue,children:[" ",e.time.year," ",e.time.month,""]})]})}),s&&r.jsx("div",{style:Gt.auctionBanner,className:"auction-alert-chip",children:s.message})]})},Gt={container:{height:"calc(60px + env(safe-area-inset-top, 0px))",paddingTop:"env(safe-area-inset-top, 0px)",background:"linear-gradient(135deg, #3e2723 0%, #2c1810 100%)",color:"#fff",display:"flex",alignItems:"center",justifyContent:"space-between",padding:"0 10px",position:"relative",boxShadow:"0 4px 15px rgba(0,0,0,0.3)",borderRadius:"0 0 16px 16px",paddingBottom:"12px"},left:{display:"flex",alignItems:"center",gap:"12px"},avatarColumn:{display:"flex",flexDirection:"column",alignItems:"center",gap:"4px"},avatar:{width:"44px",height:"44px",borderRadius:"50%",background:"linear-gradient(135deg, #a1887f 0%, #8d6e63 100%)",display:"flex",alignItems:"center",justifyContent:"center",overflow:"hidden",imageRendering:"pixelated",boxShadow:"0 2px 8px rgba(0,0,0,0.2)"},info:{display:"flex",flexDirection:"column",justifyContent:"center"},name:{fontSize:"15px",fontWeight:"bold",textShadow:"1px 1px 2px rgba(0,0,0,0.3)"},tier:{fontSize:"12px",color:"#ffecb3",textShadow:"1px 1px 2px rgba(0,0,0,0.3)"},meditateStatus:{color:"#76ff03",marginLeft:"5px",fontSize:"10px"},right:{display:"flex",gap:"8px",alignItems:"center",flexShrink:0},timeIcon:{fontSize:"16px"},timeValue:{fontSize:"13px",fontWeight:"bold",color:"#fff"},expBarContainer:{flex:1,maxWidth:"300px",marginLeft:"20px",marginRight:"20px"},expBarWrapper:{position:"relative",height:"24px",backgroundColor:"rgba(0,0,0,0.3)",borderRadius:"12px",overflow:"hidden",border:"1px solid rgba(255,255,255,0.1)"},expBarFill:{position:"absolute",left:0,top:0,height:"100%",transition:"width 0.3s ease",borderRadius:"12px"},expText:{position:"absolute",left:"50%",top:"50%",transform:"translate(-50%, -50%)",fontSize:"11px",fontWeight:"bold",color:"#fff",textShadow:"1px 1px 2px rgba(0,0,0,0.5)",zIndex:1},statusColumn:{display:"flex",flexDirection:"column",alignItems:"center",gap:"2px",backgroundColor:"rgba(255,255,255,0.06)",padding:"4px 8px",borderRadius:"12px"},auctionBanner:{position:"absolute",left:"50%",bottom:"-14px",transform:"translateX(-50%)",background:"rgba(255, 255, 255, 0.16)",padding:"4px 16px",borderRadius:"20px",color:"#ff5252",fontWeight:"bold",fontSize:"12px",letterSpacing:"0.5px",boxShadow:"0 6px 18px rgba(0,0,0,0.35)",animation:"auctionFlash 0.8s ease-in-out 3"}},wE=()=>{if(typeof document>"u"||document.getElementById("top-status-animations"))return;const e=document.createElement("style");e.id="top-status-animations",e.innerHTML=`
    @keyframes pulse {
      0% { transform: scale(1); box-shadow: 0 0 0 0 rgba(118, 255, 3, 0.4); }
      70% { transform: scale(1.05); box-shadow: 0 0 0 8px rgba(118, 255, 3, 0); }
      100% { transform: scale(1); box-shadow: 0 0 0 0 rgba(118, 255, 3, 0); }
    }
    @keyframes auctionFlash {
      0% { opacity: 0; transform: translate(-50%, 8px) scale(0.95); }
      30% { opacity: 1; transform: translate(-50%, 0) scale(1); }
      70% { opacity: 1; }
      100% { opacity: 0; transform: translate(-50%, -6px) scale(0.96); }
    }
  `,document.head.appendChild(e)};typeof window<"u"&&typeof document<"u"&&wE();const kE=({activeTab:e,onTabChange:t})=>{const n=[{id:"FAMILY",label:"",icon:""},{id:"NPC",label:"",icon:""},{id:"ACTION",label:"",icon:""},{id:"REVENGE",label:"",icon:""},{id:"PLAYER",label:"",icon:""},{id:"SYSTEM",label:"",icon:""},{id:"LOG",label:"",icon:""}];return r.jsx("div",{style:yl.container,children:n.map(s=>r.jsxs("button",{onClick:()=>t(s.id),style:{...yl.btn,backgroundColor:e===s.id?"rgba(255,193,7,0.2)":"transparent",fontWeight:e===s.id?"bold":"normal"},children:[r.jsx("div",{style:yl.icon,children:s.icon}),r.jsx("div",{style:yl.label,children:s.label})]},s.id))})},yl={container:{height:we.sizes.navHeight,background:we.gradients.warm,borderTop:`2px solid ${we.colors.border}`,display:"flex",justifyContent:"space-around",alignItems:"center",position:"fixed",bottom:0,left:0,right:0,zIndex:100,boxShadow:`0 -6px 18px ${we.colors.shadow}`,borderRadius:"16px 16px 0 0"},btn:{background:"none",border:"none",display:"flex",flexDirection:"column",alignItems:"center",cursor:"pointer",padding:"6px 3px",borderRadius:"10px",transition:"all 0.2s ease"},icon:{fontSize:"16px",marginBottom:"2px",color:we.colors.ink},label:{fontSize:"10px",color:we.colors.muted,fontFamily:"Microsoft YaHei, SimSun, serif"}},EE=e=>Math.max(0,Math.min(100,Number(e)||0)),jg=({npc:e,onInteract:t,actions:n})=>{var l;const s=((l=e.relationship)==null?void 0:l.affection)??0,o=EE(s),a=(()=>{const d=o;return d>=80?"#b03a3a":d>=40?we.colors.accent:we.colors.muted})();return r.jsxs("div",{style:Vt.card,children:[t&&r.jsx("button",{onClick:()=>t(e.id,"TOGGLE_FOLLOW"),style:{...Vt.followBtn,background:e.isFollowed?"#ffd54f":Vt.followBtn.background},title:e.isFollowed?"":"",children:e.isFollowed?"":""}),r.jsxs("div",{style:Vt.header,children:[r.jsx(Yr,{dna:e.avatar,gender:e.gender,size:60}),r.jsxs("div",{style:{flex:1},children:[r.jsxs("h3",{style:{margin:0},children:[e.name,r.jsx("span",{style:Vt.tag,children:e.identity})]}),r.jsx("small",{style:{color:we.colors.muted},children:e.cultivation}),e.sect&&e.sectStatus!=="mysterious"&&e.sectStatus!=="rogue"&&r.jsx("div",{style:{marginTop:"2px"},children:r.jsx("span",{style:{fontSize:"9px",padding:"2px 6px",borderRadius:"8px",color:"white",background:e.sectStatus==="defected"?"#a65a5a":e.sectStatus==="hidden"?we.colors.primary:e.sect.level==="TOP"?"#c9a84a":e.sect.level==="HIGH"?we.colors.accent:e.sect.level==="RECKLESS"?"#a65a5a":we.colors.muted,fontWeight:"bold"},children:e.sect.name})}),e.sectStatus==="mysterious"&&r.jsx("div",{style:{marginTop:"2px"},children:r.jsx("span",{style:{fontSize:"9px",padding:"2px 6px",borderRadius:"8px",color:"white",background:we.colors.muted,fontWeight:"bold"},children:""})}),e.sectStatus==="rogue"&&r.jsx("div",{style:{marginTop:"2px"},children:r.jsx("span",{style:{fontSize:"9px",padding:"2px 6px",borderRadius:"8px",color:"white",background:we.colors.primary,fontWeight:"bold"},children:""})})]})]}),r.jsxs("p",{style:Vt.desc,children:["",e.desc,""]}),r.jsxs("div",{style:Vt.statRow,children:[r.jsx("span",{children:":"}),r.jsx("div",{style:Vt.progressBar,children:r.jsx("div",{style:{...Vt.progressFill,width:`${o}%`,backgroundColor:a}})}),r.jsxs("span",{style:{color:a},children:[" ",o]})]}),n?r.jsx("div",{style:Vt.actions,children:n}):t?r.jsxs("div",{style:Vt.actions,children:[r.jsx("button",{onClick:()=>t(e.id,"DETAIL"),style:Vt.btn,children:" "}),r.jsx("button",{onClick:()=>t(e.id,"CHAT"),style:Vt.btn,children:" "}),r.jsx("button",{onClick:()=>t(e.id,"GIFT"),style:Vt.btn,children:" "}),r.jsx("button",{onClick:()=>t(e.id,"SPAR"),disabled:s<0,style:{...Vt.btn,opacity:s<0?.5:1,backgroundColor:we.colors.primary,color:"white"},title:"",children:" "}),!e.isChild&&r.jsx("button",{onClick:()=>t(e.id,"DUAL_CULTIVATION"),style:{...Vt.btn,opacity:s<80?.5:1,backgroundColor:we.colors.accent,color:"white"},title:"80+",children:" "}),!e.isChild&&r.jsx("button",{onClick:()=>t(e.id,"PROPOSE"),disabled:s<80,style:{...Vt.btn,opacity:s<80?.5:1,backgroundColor:we.colors.primary,color:"white",cursor:s<80?"not-allowed":"pointer"},title:"80+",children:" "})]}):null]})},Vt={card:{border:`1px solid ${we.colors.border}`,borderRadius:"8px",padding:"15px",backgroundColor:we.colors.paper,boxShadow:`0 2px 6px ${we.colors.shadow}`,marginBottom:"10px",position:"relative"},header:{display:"flex",gap:"10px",alignItems:"center",marginBottom:"10px"},tag:{fontSize:"12px",background:we.colors.parchment,padding:"2px 6px",borderRadius:"4px",color:we.colors.ink},desc:{fontStyle:"italic",color:we.colors.ink,fontSize:"14px",margin:"5px 0 15px 0"},statRow:{display:"flex",alignItems:"center",gap:"10px",marginBottom:"15px",fontSize:"14px"},progressBar:{flex:1,height:"10px",background:we.colors.parchment,borderRadius:"5px",overflow:"hidden"},progressFill:{height:"100%",transition:"width 0.3s ease"},actions:{display:"grid",gridTemplateColumns:"1fr 1fr 1fr",gap:"8px"},btn:{padding:"8px",border:`1px solid ${we.colors.border}`,borderRadius:"4px",background:we.colors.parchment,cursor:"pointer",fontSize:"12px",color:we.colors.ink},followBtn:{position:"absolute",top:8,right:8,padding:"6px 8px",borderRadius:"6px",border:`1px solid ${we.colors.border}`,background:we.colors.parchment,cursor:"pointer",fontSize:"13px",lineHeight:"1"}},jE=[{id:"meet_normal_1",stage:0,text:"{name} ",options:[{label:"",result:"neutral",msg:"(+5)",change:{affection:5}},{label:"",result:"neutral",msg:"",change:{}}]},{id:"meet_normal_2",stage:0,text:"{name} ",options:[{label:"",check:e=>e.stats.intelligence>60,success:{msg:"(+8)",change:{affection:8}},fail:{msg:"(+2)",change:{affection:2}}},{label:"",result:"neutral",msg:"",change:{}}]},{id:"meet_normal_3",stage:0,text:"{name} ",options:[{label:"",check:e=>e.combatStats.atk>50,success:{msg:"(+10)",change:{affection:10}},fail:{msg:"(+3)",change:{affection:3}}},{label:"",result:"neutral",msg:"",change:{}}]},{id:"meet_normal_4",stage:0,text:"{name} ",options:[{label:"",result:"neutral",msg:"(+6)",change:{affection:6}},{label:"",result:"neutral",msg:"",change:{}}]},{id:"meet_normal_5",stage:0,text:"{name} ",options:[{label:"",result:"neutral",msg:"(+7)",change:{affection:7}},{label:"",result:"neutral",msg:"",change:{}}]},{id:"meet_normal_6",stage:0,text:"{name} ",options:[{label:"",result:"neutral",msg:"(+4)",change:{affection:4}},{label:"",result:"neutral",msg:"",change:{}}]},{id:"meet_cold_1",stage:0,reqTrait:"",text:"{name} ",options:[{label:"",result:"neutral",msg:"(+1)",change:{affection:1}},{label:"",result:"neutral",msg:"",change:{}}]},{id:"meet_cold_2",stage:0,reqTrait:"",text:"{name} ",options:[{label:"",check:e=>e.stats.luck>50,success:{msg:"(+5)",change:{affection:5}},fail:{msg:"",change:{}}},{label:"",result:"neutral",msg:"",change:{}}]},{id:"meet_cold_3",stage:0,reqTrait:"",text:"{name} ",options:[{label:"",result:"neutral",msg:"(+3)",change:{affection:3}},{label:"",result:"neutral",msg:"",change:{}}]},{id:"meet_cold_4",stage:0,reqTrait:"",text:"{name} ",options:[{label:"",result:"neutral",msg:"(+2)",change:{affection:2}},{label:"",result:"neutral",msg:"",change:{}}]},{id:"meet_cold_5",stage:0,reqTrait:"",text:"{name} ",options:[{label:"",check:e=>e.combatStats.atk>60,success:{msg:"(+7)",change:{affection:7}},fail:{msg:"(+1)",change:{affection:1}}},{label:"",result:"neutral",msg:"",change:{}}]},{id:"meet_cold_6",stage:0,reqTrait:"",text:"{name} ",options:[{label:"",check:e=>e.stats.intelligence>70,success:{msg:"(+8)",change:{affection:8}},fail:{msg:"(+0)",change:{affection:0}}},{label:"",result:"neutral",msg:"",change:{}}]},{id:"meet_gentle_1",stage:0,reqTrait:"",text:"{name} ",options:[{label:"",result:"neutral",msg:"(+7)",change:{affection:7}},{label:"",result:"neutral",msg:"(+3)",change:{affection:3}}]},{id:"meet_gentle_2",stage:0,reqTrait:"",text:"{name} ",options:[{label:"",result:"neutral",msg:"(+6)",change:{affection:6}},{label:"",result:"neutral",msg:"",change:{}}]},{id:"meet_gentle_3",stage:0,reqTrait:"",text:"{name} ",options:[{label:"",result:"neutral",msg:"(+9)",change:{affection:9}},{label:"",result:"neutral",msg:"(+2)",change:{affection:2}}]},{id:"meet_gentle_4",stage:0,reqTrait:"",text:"{name} ",options:[{label:"",result:"neutral",msg:"(+5)",change:{affection:5}},{label:"",result:"neutral",msg:"",change:{}}]},{id:"meet_gentle_5",stage:0,reqTrait:"",text:"{name} ",options:[{label:"",result:"neutral",msg:"(+8)",change:{affection:8}},{label:"",result:"neutral",msg:"",change:{}}]},{id:"meet_gentle_6",stage:0,reqTrait:"",text:"{name} ",options:[{label:"",result:"neutral",msg:"(+6)",change:{affection:6}},{label:"",result:"neutral",msg:"(+3)",change:{affection:3}}]},{id:"phase1_normal_1",stage:1,text:"{name} ",options:[{label:"",result:"good",msg:"(+10+5)",change:{affection:10,trust:5}},{label:"",result:"neutral",msg:"(+2)",change:{affection:2}}]},{id:"phase1_normal_2",stage:1,text:"{name} ",options:[{label:"",check:e=>e.stats.intelligence>65,success:{msg:"(+8+8)",change:{affection:8,trust:8}},fail:{msg:"(+4+3)",change:{affection:4,trust:3}}},{label:"",result:"neutral",msg:"(+1)",change:{affection:1}}]},{id:"phase1_normal_3",stage:1,text:"{name} ",options:[{label:"",result:"good",msg:"(+12+10)",change:{affection:12,trust:10}},{label:"",result:"neutral",msg:"(-1)",change:{affection:-1}}]},{id:"phase1_normal_4",stage:1,text:"{name} ",options:[{label:"",result:"good",msg:"(+7+4)",change:{affection:7,trust:4}},{label:"",result:"neutral",msg:"(+1)",change:{affection:1}}]},{id:"phase1_normal_5",stage:1,text:"{name} ",options:[{label:"",check:e=>e.combatStats.atk>70,success:{msg:"(+15+12)",change:{affection:15,trust:12}},fail:{msg:"(+8+6)",change:{affection:8,trust:6}}},{label:"",result:"bad",msg:"(-2)",change:{affection:-2}}]},{id:"phase1_normal_6",stage:1,text:"{name} ",options:[{label:"",result:"good",msg:"(+9+7)",change:{affection:9,trust:7}},{label:"",result:"neutral",msg:"(+0)",change:{affection:0}}]},{id:"phase1_tsundere_1",stage:1,reqTrait:"",text:'{name} ""',options:[{label:"",result:"good",msg:"(+10+5)",change:{affection:10,trust:5}},{label:"",result:"neutral",msg:"(+8)",change:{affection:8}}]},{id:"phase1_tsundere_2",stage:1,reqTrait:"",text:"{name} ",options:[{label:"",result:"good",msg:"(+9+4)",change:{affection:9,trust:4}},{label:"",result:"neutral",msg:"(+5)",change:{affection:5}}]},{id:"phase1_tsundere_3",stage:1,reqTrait:"",text:"{name} ",options:[{label:"",result:"good",msg:"(+12+6)",change:{affection:12,trust:6}},{label:"",result:"neutral",msg:"(+7)",change:{affection:7}}]},{id:"phase1_tsundere_4",stage:1,reqTrait:"",text:"{name} ",options:[{label:"",result:"good",msg:"(+11+8)",change:{affection:11,trust:8}},{label:"",result:"neutral",msg:"(+6)",change:{affection:6}}]},{id:"phase1_tsundere_5",stage:1,reqTrait:"",text:"{name} ",options:[{label:"",check:e=>e.combatStats.atk>75,success:{msg:"(+15+10)",change:{affection:15,trust:10}},fail:{msg:"(+8+5)",change:{affection:8,trust:5}}},{label:"",result:"bad",msg:"(-3)",change:{affection:-3}}]},{id:"phase1_tsundere_6",stage:1,reqTrait:"",text:"{name} ",options:[{label:"",result:"good",msg:"(+10+7)",change:{affection:10,trust:7}},{label:"",result:"neutral",msg:"(+9)",change:{affection:9}}]},{id:"phase1_greedy_1",stage:1,reqTrait:"",text:"{name} ",options:[{label:"",result:"good",msg:"(+12+3)",change:{affection:12,trust:3}},{label:"",result:"neutral",msg:"(+2)",change:{affection:2}}]},{id:"phase1_greedy_2",stage:1,reqTrait:"",text:"{name} ",options:[{label:"",check:e=>e.resources.spiritStones>500,success:{msg:"(+15+5)",change:{affection:15,trust:5}},fail:{msg:"(+1)",change:{affection:1}}},{label:"",result:"neutral",msg:"(+0)",change:{affection:0}}]},{id:"phase1_greedy_3",stage:1,reqTrait:"",text:"{name} ",options:[{label:"",check:e=>e.resources.spiritStones>300,success:{msg:"(+10+8)",change:{affection:10,trust:8}},fail:{msg:"(+1)",change:{affection:1}}},{label:"",result:"bad",msg:"(-2)",change:{affection:-2}}]},{id:"phase1_greedy_4",stage:1,reqTrait:"",text:"{name} ",options:[{label:"",result:"good",msg:"(+12+6)",change:{affection:12,trust:6}},{label:"",result:"neutral",msg:"(+5)",change:{affection:5}}]},{id:"phase1_greedy_5",stage:1,reqTrait:"",text:"{name} ",options:[{label:"",result:"good",msg:"(+15+4)",change:{affection:15,trust:4}},{label:"",result:"neutral",msg:"(+2)",change:{affection:2}}]},{id:"phase1_greedy_6",stage:1,reqTrait:"",text:"{name} ",options:[{label:"",result:"good",msg:"(+10+5)",change:{affection:10,trust:5}},{label:"",result:"neutral",msg:"(+0)",change:{affection:0}}]},{id:"phase2_normal_1",stage:2,text:"{name} ",options:[{label:"",result:"good",msg:"(+15+10)",change:{affection:15,trust:10}},{label:"",result:"neutral",msg:"(+8)",change:{affection:8}}]},{id:"phase2_normal_2",stage:2,text:"{name} ",options:[{label:"",result:"good",msg:"(+20+15)",change:{affection:20,trust:15}},{label:"",result:"neutral",msg:"(+10+5)",change:{affection:10,trust:5}}]},{id:"phase2_normal_3",stage:2,text:"{name} ",options:[{label:"",result:"good",msg:"(+25+20)",change:{affection:25,trust:20}},{label:"",result:"neutral",msg:"(+10)",change:{affection:10}}]},{id:"phase2_normal_4",stage:2,text:"{name} ",options:[{label:"",result:"good",msg:"(+30+25)",change:{affection:30,trust:25}},{label:"",result:"neutral",msg:"(+15+10)",change:{affection:15,trust:10}}]},{id:"phase2_normal_5",stage:2,text:"{name} ",options:[{label:"",result:"good",msg:"(+20+15)",change:{affection:20,trust:15}},{label:"",result:"neutral",msg:"(+5)",change:{affection:5}}]},{id:"phase2_normal_6",stage:2,text:"{name} ",options:[{label:"",result:"good",msg:"(+18+12)",change:{affection:18,trust:12}},{label:"",result:"bad",msg:"(-5)",change:{affection:-5}}]},{id:"phase2_yandere_1",stage:2,reqTrait:"",text:'{name} ""',options:[{label:"",result:"good",msg:"(+20+15)",change:{affection:20,trust:15}},{label:"",result:"bad",msg:"(-10-5)",change:{affection:-10,trust:-5}}]},{id:"phase2_yandere_2",stage:2,reqTrait:"",text:'{name} ""',options:[{label:"",result:"good",msg:"(+25+20)",change:{affection:25,trust:20}},{label:"",result:"neutral",msg:"(+10+5)",change:{affection:10,trust:5}}]},{id:"phase2_yandere_3",stage:2,reqTrait:"",text:'{name} ""',options:[{label:"",result:"good",msg:"(+15+10)",change:{affection:15,trust:10}},{label:"",result:"bad",msg:"(-15-10)",change:{affection:-15,trust:-10}}]},{id:"phase2_yandere_4",stage:2,reqTrait:"",text:'{name} ""',options:[{label:"",result:"good",msg:"(+30+25)",change:{affection:30,trust:25}},{label:"",result:"bad",msg:"(-5+10)",change:{affection:-5,trust:10}}]},{id:"phase2_yandere_5",stage:2,reqTrait:"",text:"{name} ",options:[{label:"",result:"good",msg:"(+35+30)",change:{affection:35,trust:30}},{label:"",result:"neutral",msg:"(+10+5)",change:{affection:10,trust:5}}]},{id:"phase2_yandere_6",stage:2,reqTrait:"",text:'{name} ""',options:[{label:"",result:"good",msg:"(+25+20)",change:{affection:25,trust:20}},{label:"",result:"neutral",msg:"(+15+10)",change:{affection:15,trust:10}}]},{id:"phase2_justice_1",stage:2,reqTrait:"",text:"{name} ",options:[{label:"",result:"good",msg:"(+25+20)",change:{affection:25,trust:20}},{label:"",result:"neutral",msg:"(+15+15)",change:{affection:15,trust:15}}]},{id:"phase2_justice_2",stage:2,reqTrait:"",text:"{name} ",options:[{label:"",result:"good",msg:"(+30+25)",change:{affection:30,trust:25}},{label:"",result:"neutral",msg:"(+10+5)",change:{affection:10,trust:5}}]},{id:"phase2_justice_3",stage:2,reqTrait:"",text:"{name} ",options:[{label:"",result:"good",msg:"(+20+18)",change:{affection:20,trust:18}},{label:"",result:"neutral",msg:"(+12+10)",change:{affection:12,trust:10}}]},{id:"phase2_justice_4",stage:2,reqTrait:"",text:"{name} ",options:[{label:"",result:"good",msg:"(+22+20)",change:{affection:22,trust:20}},{label:"",result:"neutral",msg:"(+15+15)",change:{affection:15,trust:15}}]},{id:"phase2_justice_5",stage:2,reqTrait:"",text:"{name} ",options:[{label:"",result:"good",msg:"(+28+25)",change:{affection:28,trust:25}},{label:"",result:"neutral",msg:"(+10+8)",change:{affection:10,trust:8}}]},{id:"phase2_justice_6",stage:2,reqTrait:"",text:"{name} ",options:[{label:"",result:"good",msg:"(+30+30)",change:{affection:30,trust:30}},{label:"",result:"neutral",msg:"(+15+12)",change:{affection:15,trust:12}}]}],CE=(e,t)=>{const n=jE.filter(o=>{var l;let i=0;const a=((l=e.relationship)==null?void 0:l.affection)||0;return a>=20&&(i=1),a>=60&&(i=2),!(o.stage!==i||o.reqTrait&&!(typeof e.personality=="object"&&e.personality!==null&&"label"in e.personality?[e.personality.label]:Array.isArray(e.personality)?e.personality:[]).includes(o.reqTrait)||o.condition&&!o.condition(e))});if(n.length===0)return null;const s=n[Math.floor(Math.random()*n.length)];return{...s,text:s.text.replace(/{name}/g,e.name)}},TE={GRAY:{color:"#9e9e9e",bg:"#eeeeee",border:"#bdbdbd",label:""},WHITE:{color:"#616161",bg:"#f5f5f5",border:"#e0e0e0",label:""},GREEN:{color:"#2e7d32",bg:"#e8f5e9",border:"#a5d6a7",label:""},BLUE:{color:"#1565c0",bg:"#e3f2fd",border:"#90caf9",label:""},PURPLE:{color:"#7b1fa2",bg:"#f3e5f5",border:"#ce93d8",label:""},ORANGE:{color:"#ef6c00",bg:"#fff3e0",border:"#ffcc80",label:""},RED:{color:"#c62828",bg:"#ffebee",border:"#ef9a9a",label:"",shadow:"0 0 5px rgba(198, 40, 40, 0.5)"}},IE=[{min:0,max:20,text:"",rarity:"GRAY"},{min:21,max:40,text:"",rarity:"WHITE"},{min:41,max:60,text:"",rarity:"GREEN"},{min:61,max:79,text:"",rarity:"BLUE"},{min:80,max:89,text:"",rarity:"PURPLE"},{min:90,max:99,text:"",rarity:"ORANGE"},{min:100,max:999,text:"",rarity:"RED"}],_E=[{min:0,max:20,text:"",rarity:"GRAY"},{min:21,max:40,text:"",rarity:"WHITE"},{min:41,max:60,text:"",rarity:"GREEN"},{min:61,max:79,text:"",rarity:"BLUE"},{min:80,max:89,text:"",rarity:"PURPLE"},{min:90,max:99,text:"",rarity:"ORANGE"},{min:100,max:999,text:"",rarity:"RED"}],Sc=(e,t,n="")=>{let s=t==="INT"?_E:IE,o=s.find(a=>e>=a.min&&e<=a.max)||s[0],i=o.text;return t==="LOOKS"&&n===""&&(i===""&&(i=""),i===""&&(i="")),{text:i,rarity:o.rarity,value:e,style:TE[o.rarity]}},wc=({trait:e,showValue:t=!1})=>{const{style:n,text:s,value:o}=e;return r.jsxs("div",{style:{display:"inline-flex",alignItems:"center",padding:"2px 8px",borderRadius:"12px",backgroundColor:n.bg,border:`1px solid ${n.border}`,color:n.color,fontSize:"12px",fontWeight:"bold",boxShadow:n.shadow||"none",marginRight:"5px"},children:[r.jsx("span",{children:s}),t&&r.jsx("span",{style:{marginLeft:"5px",fontSize:"10px",opacity:.7,borderLeft:`1px solid ${n.color}`,paddingLeft:"5px"},children:o})]})},RE=e=>{if(!e)return e;try{const t=new URL(e),n=t.pathname.replace(/\/+$|^\/+/g,"");return!n||n==="v1"?(t.pathname="/v1/chat/completions",t.toString()):n.includes("v1/chat")||n.includes("v1/completions")?t.toString():e}catch{return e}},Yc=async(e,t,n,s={})=>{var d;if(!t)throw new Error(" API Key");if(!n)throw new Error(" API URL");const{model:o="deepseek-chat",temperature:i=.85,maxTokens:a=200}=s,l=RE(n);l!==n&&console.info(`[AI]  API URL : ${l}`);try{const u=await fetch(l,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${t}`},body:JSON.stringify({model:o,messages:e,temperature:i,max_tokens:a,stream:!1})});if(!u.ok){const c=await u.text().catch(()=>"");let m={};try{m=c?JSON.parse(c):{}}catch{m={raw:c}}const y=((d=m.error)==null?void 0:d.message)||m.message||m.raw||u.statusText;throw u.status===401?new Error("API  (401):  API Key Key"):u.status===404?new Error(`API  (404): Invalid URL (POST ${l}) API URL  https://api.gemai.cc/v1/chat/completions`):u.status===503?new Error(`API  (503): ${y||""}`):new Error(`API  (${u.status}): ${y}`)}const p=await u.json().catch(()=>null);if(!p||!p.choices||!p.choices[0]||!p.choices[0].message)throw new Error("API ");return p.choices[0].message.content}catch(u){throw console.error("AI :",u),u.message&&u.message.includes("Failed to fetch")?new Error(" API URL  CORS "):u}},ME=async(e,t)=>{try{return await Yc([{role:"system",content:""},{role:"user",content:""}],e,t,{maxTokens:10}),!0}catch(n){return console.error("API :",n),!1}},Ps={UNFORGETTABLE:"",PROFOUND:"",SIGNIFICANT:""},vn=e=>{var t;return e.memories||(e.memories={profile:{name:e.name,personality:((t=e.personality)==null?void 0:t.label)||"",identity:e.identity||"",firstMeet:new Date().toISOString()},milestones:[],recentEvents:[],longTermSummary:"",meta:{totalEvents:0,lastSummaryTime:null,needsSummary:!1}}),e},Oo=(e,t)=>{vn(e);const n={id:Date.now(),event:t.event,time:t.time||NE(),detail:t.detail,emotionalImpact:t.emotionalImpact||Ps.SIGNIFICANT,category:t.category||"other",tags:t.tags||[],createdAt:new Date().toISOString()};return e.memories.milestones.push(n),console.log(`[] ${e.name} : ${t.event}`),n},uo=(e,t)=>{vn(e);const n={id:Date.now(),description:t.description,time:new Date().toISOString(),affectionChange:t.affectionChange||0,context:t.context||""};return e.memories.recentEvents.push(n),e.memories.meta.totalEvents++,e.memories.recentEvents.length>20&&e.memories.recentEvents.shift(),e.memories.meta.totalEvents%50===0&&(e.memories.meta.needsSummary=!0),n},zy=(e,t={})=>{const{includeMilestones:n=!0,includeRecent:s=!0,maxRecent:o=5,contextKeywords:i=[]}=t;vn(e);let a="";if(n&&e.memories.milestones.length>0&&(a+=`


`,[...e.memories.milestones].sort((d,u)=>{const p={:4,:3,:2,:1};return(p[u.emotionalImpact]||0)-(p[d.emotionalImpact]||0)}).forEach((d,u)=>{a+=`${u+1}. **${d.event}**${d.time}
   ${d.detail}
   ${d.emotionalImpact}
`})),s&&e.memories.recentEvents.length>0&&(a+=`

`,e.memories.recentEvents.slice(-o).forEach(d=>{const u=$E(d.time);a+=`- ${u}: ${d.description}`,d.affectionChange!==0&&(a+=` (${d.affectionChange>0?"+":""}${d.affectionChange})`),a+=`
`})),i.length>0){const l=e.memories.milestones.filter(d=>i.some(u=>d.event.includes(u)||d.detail.includes(u)||d.tags.includes(u)));l.length>0&&(a+=`

`,l.forEach(d=>{a+=`${d.time}${d.event}...${d.detail}
`}))}return e.memories.longTermSummary&&(a+=`

${e.memories.longTermSummary}
`),a},AE=e=>{const t={family:["","","","","","","","","","",""],relationship:["","","","","","","",""],cultivation:["","","","","","",""],combat:["","","","","","",""],emotion:["","","","","","","",""]},n=[];for(const[s,o]of Object.entries(t))o.some(i=>e.includes(i))&&n.push(...o.filter(i=>e.includes(i)));return[...new Set(n)]},NE=()=>`5${["","","",""][Math.floor(Math.random()*4)]}`,LE=e=>new Date(e).toLocaleDateString("zh-CN",{year:"numeric",month:"long",day:"numeric"}),$E=e=>{const t=new Date,n=new Date(e),s=t-n,o=Math.floor(s/6e4),i=Math.floor(s/36e5),a=Math.floor(s/864e5);return o<1?"":o<60?`${o}`:i<24?`${i}`:a<7?`${a}`:LE(e)},Cg=(e,t,n={})=>{const{difficulty:s="",sacrifice:o=!1}=n;let i=`${t.name}`;return s===""?(i+="",o&&(i+="")):i+="",i+=`${o?"":""}`,Oo(e,{event:"",detail:i,emotionalImpact:Ps.UNFORGETTABLE,category:"family",tags:["","",t.name,o?"":""]})},BE=(e,t="")=>Oo(e,{event:"",detail:`${t}`,emotionalImpact:Ps.UNFORGETTABLE,category:"relationship",tags:["","","",""]}),OE=(e,t)=>Oo(e,{event:"",detail:t,emotionalImpact:Ps.UNFORGETTABLE,category:"combat",tags:["","",""]}),Tg=(e,t,n={},s="")=>{var h,v,x,I,_,N,C;const o=((h=e.relationship)==null?void 0:h.affection)||0;let i="";o>=80?i="":o>=60?i="":o>=40?i="":o>=20&&(i="");const a=((v=e.relationship)==null?void 0:v.jealousy)||e.jealousy||0;let l="",d="";a>=81?(l="",d=""):a>=61?(l="",d=""):a>=41?(l="",d=""):a>=21&&(l="",d="");const u=((x=e.personality)==null?void 0:x.label)||"",p=((I=e.personality)==null?void 0:I.desc)||e.desc||"",c=e.identity||"",m=e.tierTitle||"";let y="";(((_=n.npcs)==null?void 0:_.some(j=>{var T;return j.id===e.id&&((T=j.relationship)==null?void 0:T.stage)>=3}))||o>=90)&&(y+=`
`);const E=((N=n.children)==null?void 0:N.filter(j=>j.parentId===e.id||j.fatherId===e.id||j.motherId===e.id||j.fatherName===e.name||j.motherName===e.name))||[];if(E.length>0){const j=E.map(A=>`${A.name}${A.age}${A.tierTitle||""}`).join("");e.gender===""?y+=`
${E.length}${j}
${e.name}`:y+=`
${E.length}${j}
${t.name}`;const T=E.map(A=>{let V=`${A.name}`;return A.sect&&(V+=`${A.sect.name}`),A.spouse&&(V+=`${A.spouse.name}`),A.trait&&(V+=`${A.trait.name}`),V}).join("");T&&(y+=`
${T}`)}const w=((C=e.relationship)==null?void 0:C.stage)||1;if(w>=2&&w<3&&(y+=`
`),e.isPregnant){const j=e.pregnancyProgress||0;y+=`
${j}`}if(n.eventHistory&&n.eventHistory.length>0){const j=n.eventHistory.filter(T=>T.npcId===e.id).slice(-3).map(T=>T.description).join("");j&&(y+=`


${j}`)}let g="";if(e.memories){const j=s?AE(s):[];g=zy(e,{includeMilestones:!0,includeRecent:!0,maxRecent:5,contextKeywords:j}),j.some(T=>["","","",""].includes(T))&&(g+=`

 `),j.some(T=>["","","",""].includes(T))&&(g+=`

 `),j.some(T=>["",""].includes(T))&&(g+=`

 `)}return`
  

  /

  
  ${e.name}
  ${c}
  ${e.gender||""}
  ${m}
  ${e.age||""}
  ${u}${p}

  
  ${t.name}
  ${t.gender||""}
  ${t.tierTitle||""}
  ${i}${o}/100
  ${a>0?`${l}${a}/100- ${d}`:""}
  ${y?`
`+y:""}
  ${g?`
`+g:""}

  
  1. "${u}"
    - 
    - 
    - 
    - 
    - 

  2. /
    - 
    - 
    - 

  3. 
    - 30-50
    - 80
    - 

  4. 
    - <30
    - 30-60
    - 60-80
    - >80
    ${E.length>0?"- ":""}
    ${a>=21?`
    ${l}${d.replace("","").replace("","").replace("","")}`:""}

  5. 
    - 
    - "AI"""
    - 
    - 

  
  ${E.length>0?"":""}`},PE=({npc:e,player:t,apiKey:n,apiUrl:s,gameState:o={}})=>{const[i,a]=b.useState([]),[l,d]=b.useState(""),[u,p]=b.useState(!1),[c,m]=b.useState(null),y=b.useRef(null),[S,E]=b.useState(typeof window<"u"?window.innerHeight:600);b.useEffect(()=>{const x={role:"system",content:Tg(e,t,o)},I=DE(e.id);I&&I.length>0?a([x,...I.filter(_=>_.role!=="system")]):a([x])},[e.id,e,t,o]),b.useEffect(()=>{y.current&&(y.current.scrollTop=y.current.scrollHeight)},[i]),b.useEffect(()=>{const x=()=>{typeof window<"u"&&window.innerHeight&&E(window.innerHeight)};return x(),window.addEventListener("resize",x),window.addEventListener("orientationchange",x),()=>{window.removeEventListener("resize",x),window.removeEventListener("orientationchange",x)}},[]),b.useEffect(()=>{i.length>1&&zE(e.id,i.filter(x=>x.role!=="system"))},[i,e.id]);const w=async()=>{if(!l.trim()||u)return;const x={role:"user",content:l.trim()},I=l.trim(),_={role:"system",content:Tg(e,t,o,I)},N=i.filter(j=>j.role!=="system"),C=[_,...N,x];a(C),d(""),p(!0),m(null);try{const T={role:"assistant",content:await Yc(C,n,s)};a(A=>[...A,T])}catch(j){m(j.message);const T={role:"system",content:`${j.message}`};a(A=>[...A,T])}finally{p(!1)}},g=()=>{const x=i[0];a([x]),FE(e.id)},h=S?Math.max(360,S-120):null,v={...yn.container,height:"100%",minHeight:"320px",maxHeight:h?`${h}px`:"100%"};return r.jsxs("div",{style:v,children:[r.jsxs("div",{style:yn.toolbar,children:[r.jsxs("div",{style:yn.npcName,children:[" ",e.name," "]}),r.jsx("button",{onClick:g,style:yn.clearBtn,title:"",children:""})]}),r.jsxs("div",{style:yn.chatBox,ref:y,children:[i.filter(x=>x.role!=="system").map((x,I)=>{const _=x.role==="user";return x.role==="system"?r.jsx("div",{style:yn.systemMsg,children:x.content},I):r.jsxs("div",{style:{...yn.bubbleRow,justifyContent:_?"flex-end":"flex-start"},children:[!_&&r.jsx("div",{style:yn.avatar,title:e.name,children:e.name[0]}),r.jsx("div",{style:{...yn.bubble,background:_?"linear-gradient(135deg, #d4af37 0%, #c5a028 100%)":"#fff",color:_?"#fff":"#333",border:_?"none":"2px solid #d4af37",boxShadow:_?"0 2px 8px rgba(212, 175, 55, 0.3)":"0 2px 8px rgba(0, 0, 0, 0.1)"},children:x.content}),_&&r.jsx("div",{style:{...yn.avatar,background:"#4e6a5d"},title:"",children:t.name[0]})]},I)}),u&&r.jsx("div",{style:yn.loading,children:r.jsx("span",{className:"loading-dots",children:""})})]}),r.jsxs("div",{style:yn.inputArea,children:[r.jsx("input",{style:yn.input,value:l,onChange:x=>d(x.target.value),onKeyDown:x=>{x.key==="Enter"&&!x.shiftKey&&(x.preventDefault(),w())},placeholder:" Enter ...",disabled:u}),r.jsx("button",{onClick:w,style:{...yn.sendBtn,opacity:u||!l.trim()?.5:1,cursor:u||!l.trim()?"not-allowed":"pointer"},disabled:u||!l.trim(),children:u?"...":""})]})]})},kc="npc_chat_history_",lu=50,zE=(e,t)=>{try{const n=t.slice(-lu);localStorage.setItem(`${kc}${e}`,JSON.stringify(n)),t.length>lu&&console.log(`${t.length} -> ${lu} `)}catch(n){if(console.error(":",n),n.name==="QuotaExceededError"){console.warn("...");try{const s=t.slice(-20);localStorage.setItem(`${kc}${e}`,JSON.stringify(s))}catch(s){console.error(":",s)}}}},DE=e=>{try{const t=localStorage.getItem(`${kc}${e}`);return t?JSON.parse(t):[]}catch(t){return console.error(":",t),[]}},FE=e=>{try{localStorage.removeItem(`${kc}${e}`)}catch(t){console.error(":",t)}},yn={container:{display:"flex",flexDirection:"column",background:"rgba(255, 250, 240, 0.95)",borderRadius:"12px",border:"2px solid #d4af37",overflow:"hidden",boxShadow:"0 4px 12px rgba(0, 0, 0, 0.15)",position:"relative"},toolbar:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"12px 16px",background:"linear-gradient(135deg, #4e6a5d 0%, #3d5549 100%)",borderBottom:"2px solid #d4af37"},npcName:{fontSize:"16px",fontWeight:"bold",color:"#d4af37",textShadow:"0 1px 2px rgba(0, 0, 0, 0.3)"},clearBtn:{padding:"6px 12px",background:"rgba(255, 255, 255, 0.1)",border:"1px solid rgba(255, 255, 255, 0.3)",borderRadius:"6px",color:"#fff",fontSize:"12px",cursor:"pointer",transition:"all 0.2s"},chatBox:{flex:1,overflowY:"auto",padding:"20px",paddingBottom:"28px",display:"flex",flexDirection:"column",gap:"16px",background:`url("data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none' fill-rule='evenodd'%3E%3Cg fill='%23d4af37' fill-opacity='0.05'%3E%3Cpath d='M36 34v-4h-2v4h-4v2h4v4h2v-4h4v-2h-4zm0-30V0h-2v4h-4v2h4v4h2V6h4V4h-4zM6 34v-4H4v4H0v2h4v4h2v-4h4v-2H6zM6 4V0H4v4H0v2h4v4h2V6h4V4H6z'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E")`},bubbleRow:{display:"flex",gap:"10px",alignItems:"flex-start",animation:"fadeIn 0.3s ease-in"},avatar:{minWidth:"36px",width:"36px",height:"36px",borderRadius:"50%",background:"linear-gradient(135deg, #d4af37 0%, #c5a028 100%)",color:"#fff",display:"flex",alignItems:"center",justifyContent:"center",fontSize:"14px",fontWeight:"bold",boxShadow:"0 2px 6px rgba(0, 0, 0, 0.2)",border:"2px solid rgba(255, 255, 255, 0.5)"},bubble:{maxWidth:"70%",padding:"12px 16px",borderRadius:"16px",fontSize:"14px",lineHeight:"1.6",wordWrap:"break-word",whiteSpace:"pre-wrap"},systemMsg:{textAlign:"center",fontSize:"12px",color:"#999",padding:"8px 16px",background:"rgba(0, 0, 0, 0.05)",borderRadius:"8px",fontStyle:"italic"},loading:{fontSize:"13px",color:"#666",textAlign:"center",padding:"12px",fontStyle:"italic"},inputArea:{padding:"16px",paddingBottom:"calc(16px + env(safe-area-inset-bottom, 0px))",borderTop:"2px solid #d4af37",display:"flex",gap:"12px",background:"linear-gradient(180deg, rgba(255, 250, 240, 0.95) 0%, rgba(245, 240, 230, 0.95) 100%)",flexShrink:0},input:{flex:1,padding:"12px 16px",borderRadius:"24px",border:"2px solid #d4af37",outline:"none",fontSize:"14px",background:"#fff",transition:"all 0.2s"},sendBtn:{padding:"10px 24px",borderRadius:"24px",background:"linear-gradient(135deg, #4e6a5d 0%, #3d5549 100%)",color:"#fff",border:"none",fontWeight:"bold",fontSize:"14px",transition:"all 0.2s",boxShadow:"0 2px 6px rgba(0, 0, 0, 0.2)"}},HE=({npc:e,onClose:t,onOptionSelect:n,player:s,children:o=[],npcs:i=[],onViewLog:a,onCutTies:l,onToggleLetterAcceptance:d})=>{var w,g,h,v,x;const[u,p]=b.useState(null),[c,m]=b.useState("INFO"),y=e.acceptsLetters!==!1;b.useEffect(()=>{const I=_=>{_.key==="Escape"&&t&&t()};return window.addEventListener("keydown",I),()=>window.removeEventListener("keydown",I)},[t]);const S={children:o,npcs:i},E=({label:I,value:_,max:N=100,color:C})=>{const j=Number(N)||100,T=Number(_)||0,A=Math.max(0,Math.min(j,T)),V=j===0?0:Math.min(100,Math.round(A/j*100));return r.jsxs("div",{style:{display:"flex",alignItems:"center",marginBottom:"5px",fontSize:"12px"},children:[r.jsx("span",{style:{width:"30px",color:"#666"},children:I}),r.jsx("div",{style:{flex:1,height:"6px",background:"#eee",borderRadius:"3px",margin:"0 8px"},children:r.jsx("div",{style:{width:`${V}%`,background:C,height:"100%",borderRadius:"3px"}})}),r.jsx("span",{style:{width:"25px",textAlign:"right",fontWeight:"bold"},children:Math.floor(A)})]})};return r.jsx("div",{style:lt.overlay,children:r.jsxs("div",{style:lt.modalWrapper,children:[r.jsx("button",{onClick:t,style:lt.closeBtn,"aria-label":"",children:""}),r.jsxs("div",{style:lt.modal,children:[r.jsxs("div",{style:lt.tabBar,children:[r.jsx("button",{onClick:()=>m("INFO"),style:{...lt.tab,background:c==="INFO"?"linear-gradient(135deg, #4e6a5d 0%, #3d5549 100%)":"#f5f5f5",color:c==="INFO"?"#fff":"#333",fontWeight:c==="INFO"?"bold":"normal"},children:" "}),r.jsx("button",{onClick:()=>m("CHAT"),style:{...lt.tab,background:c==="CHAT"?"linear-gradient(135deg, #4e6a5d 0%, #3d5549 100%)":"#f5f5f5",color:c==="CHAT"?"#fff":"#333",fontWeight:c==="CHAT"?"bold":"normal"},children:" "})]}),r.jsx("div",{style:lt.content,children:c==="INFO"?r.jsxs("div",{style:lt.leftCol,children:[r.jsx("div",{style:{marginBottom:"15px"},children:r.jsx(Yr,{dna:e.avatar,gender:e.gender,size:120})}),r.jsxs("div",{style:lt.nameBlock,children:[r.jsx("h2",{style:{margin:"10px 0 5px"},children:e.name}),r.jsx("span",{style:lt.identityTag,children:e.identity}),e.constitution&&r.jsx("span",{style:lt.rareTag,children:e.constitution.name}),e.sect&&e.sectStatus!=="mysterious"&&e.sectStatus!=="rogue"&&r.jsx("div",{style:{marginTop:"8px",display:"flex",flexDirection:"column",gap:"4px"},children:r.jsxs("span",{style:{...lt.identityTag,background:e.sectStatus==="defected"?"linear-gradient(135deg, #e53935 0%, #c62828 100%)":e.sectStatus==="hidden"?"linear-gradient(135deg, #9c27b0 0%, #7b1fa2 100%)":e.sect.level==="TOP"?"linear-gradient(135deg, #ffd700 0%, #ffb300 100%)":e.sect.level==="HIGH"?"linear-gradient(135deg, #00bcd4 0%, #0097a7 100%)":e.sect.level==="RECKLESS"?"linear-gradient(135deg, #d32f2f 0%, #b71c1c 100%)":"linear-gradient(135deg, #66bb6a 0%, #43a047 100%)",fontSize:"11px"},children:[e.sectStatus==="defected"?" ":e.sectStatus==="hidden"?" ":"","",e.sect.name,"",e.sectRank]})}),e.sectStatus==="mysterious"&&r.jsx("span",{style:{...lt.identityTag,background:"linear-gradient(135deg, #616161 0%, #424242 100%)",fontSize:"11px"},children:" "}),e.sectStatus==="rogue"&&r.jsx("span",{style:{...lt.identityTag,background:"linear-gradient(135deg, #8d6e63 0%, #6d4c41 100%)",fontSize:"11px"},children:" "})]}),r.jsxs("p",{style:lt.desc,children:['"',e.desc||e.appearance||"",'"']}),r.jsxs("div",{style:lt.attrBox,children:[r.jsx("h4",{children:" "}),r.jsxs("div",{style:{marginBottom:"8px",display:"flex",alignItems:"center"},children:[r.jsx("span",{style:{fontSize:"12px",width:"40px"},children:":"}),r.jsx(wc,{trait:Sc(e.stats.looks,"LOOKS","")})]}),r.jsxs("div",{style:{marginBottom:"8px",display:"flex",alignItems:"center"},children:[r.jsx("span",{style:{fontSize:"12px",width:"40px"},children:":"}),r.jsx(wc,{trait:Sc(e.stats.intelligence,"INT")})]}),e.spiritRoot&&r.jsxs("div",{style:{marginBottom:"8px"},children:[r.jsxs("div",{style:{display:"flex",alignItems:"center",marginBottom:"4px"},children:[r.jsx("span",{style:{fontSize:"12px",width:"40px"},children:":"}),r.jsx("span",{style:{fontSize:"12px",fontWeight:"bold",color:e.spiritRoot.color||"#d81b60"},children:e.spiritRoot.type})]}),e.spiritRoot.elements&&r.jsx("div",{style:{display:"flex",alignItems:"center",marginLeft:"40px"},children:r.jsx("div",{style:{display:"flex",gap:"4px"},children:e.spiritRoot.elements.map(I=>{const _=N=>({:"#FFD700",:"#4CAF50",:"#2196F3",:"#F44336",:"#795548",:"#673AB7",:"#00BCD4",:"#009688"})[N]||"#ccc";return r.jsx("span",{style:{padding:"2px 6px",borderRadius:"10px",color:"white",fontWeight:"bold",fontSize:"10px",background:_(I)},children:I},I)})})}),r.jsx("div",{style:{display:"flex",alignItems:"center",marginLeft:"40px",marginTop:"4px"},children:r.jsxs("span",{style:{fontSize:"11px",color:"#666"},children:[": ",(w=e.stats)==null?void 0:w.aptitude," (",((g=e.stats)==null?void 0:g.aptitude)>=80?"":"",")"]})}),e.spiritRoot.desc&&r.jsx("div",{style:{marginLeft:"40px",marginTop:"2px"},children:r.jsx("span",{style:{fontSize:"11px",color:"#666"},children:e.spiritRoot.desc})})]})]}),r.jsxs("div",{style:lt.attrBox,children:[r.jsx("h4",{children:" "}),r.jsx(E,{label:"",value:((h=e.relationship)==null?void 0:h.affection)||0,max:100,color:"#f50057"}),r.jsx(E,{label:"",value:((v=e.relationship)==null?void 0:v.trust)||0,max:100,color:"#00e5ff"}),(()=>{var C;const I=((C=e.relationship)==null?void 0:C.affection)||0,_=Oy(I),N=Fk(_);return r.jsxs("div",{style:{marginTop:"8px",display:"flex",alignItems:"center",gap:"8px"},children:[r.jsx("span",{style:{fontSize:"12px",color:"#666"},children:":"}),r.jsxs("span",{style:{padding:"4px 12px",borderRadius:"12px",fontSize:"12px",fontWeight:"bold",color:"white",backgroundColor:N.color},children:[N.icon," ",N.text]})]})})(),(()=>{var C;const I=((C=e.relationship)==null?void 0:C.jealousy)??e.jealousy??0,_=j=>j>=81?"#d32f2f":j>=61?"#f44336":j>=41?"#ff9800":j>=21?"#ffc107":"#4caf50",N=j=>j>=81?"":j>=61?"":j>=41?"":j>=21?"":"";return r.jsxs("div",{style:{marginTop:"8px"},children:[r.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",marginBottom:"4px"},children:[r.jsx("span",{style:{fontSize:"12px",color:"#666"},children:":"}),r.jsxs("span",{style:{fontSize:"11px",fontWeight:"bold",color:_(I)},children:[N(I)," (",I,")"]})]}),r.jsx("div",{style:{width:"100%",height:"8px",background:"#e0e0e0",borderRadius:"4px",overflow:"hidden"},children:r.jsx("div",{style:{width:`${I}%`,height:"100%",background:`linear-gradient(90deg, ${_(I)}, ${_(I)}dd)`,borderRadius:"4px",transition:"width 0.3s ease, background 0.3s ease"}})})]})})(),r.jsxs("div",{style:lt.letterToggleRow,children:[r.jsxs("div",{children:[r.jsx("span",{style:{fontSize:"12px",color:"#666"},children:""}),r.jsx("span",{style:{fontSize:"12px",fontWeight:"bold",color:y?"#2e7d32":"#b71c1c"},children:y?"":""})]}),r.jsx("button",{type:"button",style:{...lt.letterToggleBtn,background:y?"linear-gradient(135deg, #4caf50 0%, #2e7d32 100%)":"linear-gradient(135deg, #b0bec5 0%, #90a4ae 100%)"},onClick:()=>d&&d(e.id,!y),children:y?"":""})]}),r.jsx("p",{style:lt.letterToggleHint,children:y?"Ta":"Ta"})]}),r.jsxs("div",{style:lt.attrBox,children:[r.jsx("h4",{children:" "}),r.jsxs("div",{style:{fontSize:"12px",color:"#666",lineHeight:"1.6"},children:[r.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:"4px"},children:[r.jsx("span",{children:":"}),r.jsxs("span",{style:{fontWeight:"bold"},children:[Math.floor(e.age||18)," "]})]}),r.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:"4px"},children:[r.jsx("span",{children:":"}),r.jsxs("span",{style:{fontWeight:"bold"},children:[((x=e.stats)==null?void 0:x.lifespan)||100," "]})]}),r.jsxs("div",{style:{display:"flex",justifyContent:"space-between"},children:[r.jsx("span",{children:":"}),r.jsxs("span",{style:{fontWeight:"bold",color:(()=>{const I=Fr(e);return I<10?"#f44336":I<30?"#ff9800":"#4caf50"})()},children:[Fr(e)," "]})]}),Fr(e)<10&&r.jsx("div",{style:{marginTop:"8px",padding:"8px",background:"rgba(244, 67, 54, 0.1)",borderRadius:"4px",color:"#f44336",fontSize:"11px"},children:" "})]})]}),e.tier&&r.jsxs("div",{style:lt.attrBox,children:[r.jsx("h4",{children:" "}),r.jsxs("div",{style:{fontSize:"12px",marginBottom:"8px"},children:[r.jsx("span",{style:{color:"#666"},children:": "}),r.jsx("span",{style:{fontWeight:"bold",color:"#9c27b0"},children:e.tier||""})]}),e.currentExp!==void 0&&e.maxExp&&r.jsxs("div",{children:[r.jsxs("div",{style:{marginBottom:"4px"},children:[r.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",marginBottom:"4px"},children:[r.jsx("span",{style:{fontSize:"11px",color:"#666"},children:""}),r.jsxs("span",{style:{fontSize:"11px",color:"#666",fontWeight:"bold"},children:[Math.round(Math.floor(e.currentExp||0)/Math.max(1,Math.floor(e.maxExp||1))*100),"%"]})]}),r.jsx("div",{style:{width:"100%",height:"14px",background:"linear-gradient(to right, #f0f0f0, #e0e0e0)",borderRadius:"7px",overflow:"hidden",position:"relative",boxShadow:"inset 0 2px 4px rgba(0,0,0,0.1)"},children:r.jsx("div",{style:{width:`${Math.min(100,Math.round(Math.floor(e.currentExp||0)/Math.max(1,Math.floor(e.maxExp||1))*100))}%`,height:"100%",background:"linear-gradient(90deg, #9c27b0 0%, #d05ce3 100%)",borderRadius:"7px",transition:"width 0.3s ease",boxShadow:"0 0 10px rgba(156, 39, 176, 0.5)",position:"relative",overflow:"hidden"},children:r.jsx("div",{style:{position:"absolute",top:0,left:"-100%",width:"100%",height:"100%",background:"linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent)",animation:"shimmer 2s infinite"}})})})]}),r.jsxs("div",{style:{fontSize:"11px",color:"#666",textAlign:"right",marginTop:"2px"},children:[Math.floor(e.currentExp||0)," / ",Math.floor(e.maxExp||100)]}),e.cultivationSpeed&&r.jsxs("div",{style:{marginTop:"8px",padding:"6px 10px",background:"rgba(156, 39, 176, 0.05)",borderRadius:"6px",border:"1px solid rgba(156, 39, 176, 0.1)"},children:[r.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"4px"},children:[r.jsx("span",{style:{fontSize:"11px",color:"#666"},children:":"}),r.jsxs("span",{style:{fontSize:"11px",fontWeight:"bold",color:"#9c27b0"},children:[Math.floor(e.cultivationSpeed)," /"]})]}),(()=>{const I=e.maxExp-e.currentExp,_=Math.ceil(I/e.cultivationSpeed);return r.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[r.jsx("span",{style:{fontSize:"11px",color:"#666"},children:":"}),r.jsx("span",{style:{fontSize:"11px",fontWeight:"bold",color:_>12?"#ff9800":"#4caf50"},children:_>12?`${Math.floor(_/12)}`:`${_}`})]})})()]}),(()=>{var C;const I=((C=e.relationship)==null?void 0:C.affection)||0;let _=0,N="";return I>=80?(_=50,N=""):I>=60?(_=30,N=""):I>=40?(_=20,N=""):I>=20&&(_=10,N=""),_>0?r.jsxs("div",{style:{marginTop:"8px",padding:"6px 10px",background:"linear-gradient(135deg, rgba(244, 81, 108, 0.1), rgba(240, 98, 146, 0.1))",borderRadius:"6px",border:"1px solid rgba(244, 81, 108, 0.2)",fontSize:"11px",color:"#f4516c",display:"flex",alignItems:"center",justifyContent:"space-between"},children:[r.jsxs("span",{children:[" ",N,""]}),r.jsxs("span",{style:{fontWeight:"bold"},children:["+",_,"% "]})]}):null})()]})]}),r.jsxs("div",{style:lt.personalityBox,children:[r.jsx("span",{children:""}),typeof e.personality=="object"&&e.personality!==null&&"label"in e.personality?r.jsxs("span",{style:lt.tag,children:[e.personality.label," (",e.personality.desc,")"]}):Array.isArray(e.personality)?r.jsx("div",{style:{display:"flex",gap:"5px",marginTop:"5px"},children:e.personality.map((I,_)=>r.jsx("span",{style:lt.tag,children:I},_))}):r.jsx("span",{style:lt.tag,children:""})]}),a&&r.jsxs("button",{onClick:()=>a(e),style:{width:"100%",padding:"12px",marginTop:"15px",background:"linear-gradient(135deg, #667eea 0%, #764ba2 100%)",color:"white",border:"none",borderRadius:"8px",fontSize:"14px",fontWeight:"bold",cursor:"pointer",transition:"all 0.3s",boxShadow:"0 4px 12px rgba(102, 126, 234, 0.3)"},onMouseOver:I=>{I.currentTarget.style.transform="translateY(-2px)",I.currentTarget.style.boxShadow="0 6px 16px rgba(102, 126, 234, 0.4)"},onMouseOut:I=>{I.currentTarget.style.transform="translateY(0)",I.currentTarget.style.boxShadow="0 4px 12px rgba(102, 126, 234, 0.3)"},children:[" ",e.name,""]}),r.jsx("div",{style:{marginTop:"10px"},children:r.jsx("button",{onClick:()=>{l&&window.showConfirm&&window.showConfirm(` ${e.name} `,()=>l(e.id))},style:{width:"100%",padding:"12px",marginTop:"10px",background:"linear-gradient(135deg, #e53935 0%, #c62828 100%)",color:"white",border:"none",borderRadius:"8px",fontSize:"14px",cursor:"pointer"},children:" "})})]}):c==="CHAT"?r.jsx("div",{style:lt.chatWrapper,children:(()=>{const I=localStorage.getItem("game_api_key"),_=localStorage.getItem("game_api_url");return!I||!_?r.jsxs("div",{style:lt.noApiHint,children:[r.jsx("div",{style:{fontSize:"48px",marginBottom:"20px"},children:""}),r.jsx("h3",{children:""}),r.jsxs("p",{children:[" AI API  ",e.name," "]}),r.jsxs("div",{style:{marginTop:"20px",padding:"15px",background:"rgba(255, 255, 255, 0.7)",borderRadius:"8px",fontSize:"13px",lineHeight:"1.6"},children:[r.jsx("strong",{children:""}),r.jsx("br",{}),"1. ",r.jsx("br",{}),"2. AI  API Key  URL",r.jsx("br",{}),"3.  DeepSeek",r.jsx("br",{}),"4. ",r.jsx("br",{}),"5.  NPC "]})]}):r.jsx(PE,{npc:e,player:s,apiKey:I,apiUrl:_,gameState:S})})()}):null})]})]})})},lt={overlay:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0,0,0,0.5)",display:"flex",justifyContent:"center",alignItems:"center",zIndex:1e3,backdropFilter:"blur(2px)"},modalWrapper:{position:"relative",width:"min(600px, calc(100vw - 32px))"},modal:{width:"100%",maxWidth:"600px",height:"80vh",backgroundColor:"#f5f0e8",borderRadius:"16px",overflow:"hidden",display:"flex",flexDirection:"column",position:"relative",boxShadow:"0 8px 30px rgba(0,0,0,0.2)",border:"2px solid #d7ccc8"},closeBtn:{position:"absolute",top:"-18px",left:"-18px",border:"none",background:"#ffffff",fontSize:"24px",cursor:"pointer",color:"#8d6e63",width:"44px",height:"44px",borderRadius:"50%",display:"flex",alignItems:"center",justifyContent:"center",boxShadow:"0 12px 30px rgba(0,0,0,0.25)",zIndex:5},content:{display:"flex",flex:1,height:"calc(100% - 40px)",overflow:"hidden"},leftCol:{width:"100%",backgroundColor:"#faf8f5",padding:"25px",display:"flex",flexDirection:"column",overflowY:"auto"},desc:{fontSize:"14px",color:"#5d4037",fontStyle:"italic",marginBottom:"20px",lineHeight:"1.8",padding:"15px",background:"#f5f0e8",borderRadius:"10px",border:"1px solid #e0e0e0",fontFamily:"Microsoft YaHei, SimSun, serif"},tag:{fontSize:"13px",background:"linear-gradient(135deg, #d7ccc8 0%, #bcaaa4 100%)",padding:"4px 12px",borderRadius:"15px",color:"#3e2723",boxShadow:"0 2px 4px rgba(0,0,0,0.05)"},identityTag:{background:"linear-gradient(135deg, #795548 0%, #5d4037 100%)",color:"white",padding:"4px 10px",borderRadius:"8px",fontSize:"11px",marginRight:"8px",boxShadow:"0 2px 4px rgba(0,0,0,0.1)"},rareTag:{background:"linear-gradient(45deg, #FFD700, #FFA500)",color:"white",padding:"4px 10px",borderRadius:"8px",fontSize:"11px",marginLeft:"5px",fontWeight:"bold",boxShadow:"0 2px 4px rgba(0,0,0,0.1)"},attrBox:{background:"linear-gradient(135deg, #ffffff 0%, #f5f0e8 100%)",padding:"18px",borderRadius:"12px",marginBottom:"20px",border:"1px solid #e0e0e0",boxShadow:"0 2px 8px rgba(0,0,0,0.05)"},letterToggleRow:{marginTop:"14px",padding:"10px 0",borderTop:"1px dashed rgba(0,0,0,0.08)",display:"flex",alignItems:"center",justifyContent:"space-between",gap:"12px"},letterToggleBtn:{border:"none",color:"#fff",padding:"6px 14px",borderRadius:"999px",fontSize:"12px",fontWeight:"bold",cursor:"pointer",transition:"transform 0.2s ease",boxShadow:"0 2px 6px rgba(0,0,0,0.15)"},letterToggleHint:{fontSize:"11px",color:"#8d6e63",marginTop:"4px"},personalityBox:{marginTop:"auto",padding:"15px",background:"linear-gradient(135deg, #ffffff 0%, #f5f0e8 100%)",borderRadius:"12px",fontSize:"13px",border:"1px solid #e0e0e0",boxShadow:"0 2px 8px rgba(0,0,0,0.05)"},tabBar:{display:"flex",borderBottom:"2px solid #d7ccc8",background:"linear-gradient(180deg, #f5f0e8 0%, #ebe6dd 100%)"},tab:{flex:1,padding:"15px",border:"none",cursor:"pointer",fontSize:"14px",transition:"all 0.3s",borderRadius:"0"},chatWrapper:{width:"100%",height:"100%",display:"flex",flexDirection:"column",padding:"20px",boxSizing:"border-box"},noApiHint:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",height:"100%",textAlign:"center",padding:"40px",color:"#5d4037"}},WE=e=>e>=90?"#FFD700":e>=80?"#9C27B0":e>=60?"#2196F3":"#4CAF50",UE=e=>({:"#FFD700",:"#9C27B0",:"#2196F3",:"#4CAF50",:"#9E9E9E",:"#00BCD4"})[e]||"#9E9E9E",Dy=(e,t,n={})=>e==="PLAYER"?0:n[e]==="PLAYER"||!t.find(o=>o.id===n[e])?1:1+Dy(n[e],t,n),Fy=({node:e,allChildren:t,onNodeClick:n,generation:s=0,parentMap:o={}})=>{var d;const i=t.filter(u=>u.parentId===e.id),a=s+1,l=a<=2;return r.jsxs("div",{style:Qt.nodeWrapper,children:[r.jsxs("div",{style:{...Qt.card,borderColor:e.id==="PLAYER"||((d=e.stats)==null?void 0:d.aptitude)>=80?"#d4af37":"#dcd6cc",cursor:e.isPregnant?"default":"pointer"},onClick:()=>{e.isPregnant||n(e)},children:[r.jsx("div",{style:Qt.avatar,children:e.gender===""?"":""}),r.jsx("div",{style:Qt.name,children:e.name}),e.id!=="PLAYER"&&r.jsxs(r.Fragment,{children:[r.jsx("div",{style:Qt.tier,children:e.tierTitle||""}),e.spouse&&r.jsx("div",{style:Qt.spouseTag,children:" "}),e.isPregnant&&r.jsxs("div",{style:Qt.pregnantTag,children:[" ",e.gender===""&&r.jsx("span",{style:{fontSize:"9px"},children:"()"})]})]})]}),i.length>0&&r.jsx("div",{style:Qt.lineDown}),i.length>0&&r.jsx("div",{style:Qt.childrenContainer,children:l?i.map((u,p)=>r.jsxs("div",{style:Qt.childWrapper,children:[r.jsx("div",{style:{...Qt.lineTop,left:p===0?"50%":"0",width:p===0||p===i.length-1?"50%":"100%",display:i.length===1?"none":"block"}}),r.jsx(Fy,{node:u,allChildren:t,onNodeClick:n,generation:a,parentMap:o})]},u.id)):r.jsxs("div",{style:Qt.generationCounter,children:[" ",i.length,""]})})]})},GE=({player:e,children:t,pregnantNpcs:n=[],onChildClick:s,generation3Plus:o=[]})=>{const[i,a]=b.useState(1),[l,d]=b.useState({x:0,y:0}),[u,p]=b.useState(!1),[c,m]=b.useState({x:0,y:0}),[y,S]=b.useState(null),[E,w]=b.useState(null),g=b.useRef(null),h=$=>{$.cancelable&&$.preventDefault();const Y=$.deltaY*-.001,ne=Math.min(Math.max(.2,i+Y),3);a(ne)},v=$=>{p(!0),m({x:$.clientX-l.x,y:$.clientY-l.y})},x=$=>{u&&d({x:$.clientX-c.x,y:$.clientY-c.y})},I=()=>{p(!1)},_=$=>{const Y=$[0].clientX-$[1].clientX,ne=$[0].clientY-$[1].clientY;return Math.sqrt(Y*Y+ne*ne)},N=$=>{$.touches.length===1?(p(!0),S({x:$.touches[0].clientX-l.x,y:$.touches[0].clientY-l.y})):$.touches.length===2&&w(_($.touches))},C=$=>{if($.cancelable&&$.preventDefault(),$.touches.length===1&&u&&y)d({x:$.touches[0].clientX-y.x,y:$.touches[0].clientY-y.y});else if($.touches.length===2&&E){const Y=_($.touches),ne=Y/E,X=Math.min(Math.max(.2,i*ne),3);a(X),w(Y)}},j=()=>{p(!1),S(null),w(null)},T={id:"PLAYER",name:e.name+" ()",gender:e.gender,parentId:null},A=n.map(($,Y)=>({id:`embryo-${$.id||Y}`,name:`${$.name}`,gender:$.gender||"",parentId:"PLAYER",generation:1,tierTitle:"",isPregnant:!0})),V=[...t,...A].map($=>({...$,parentId:$.parentId||"PLAYER"})),F={};V.forEach($=>{$.id&&(F[$.id]=$.parentId)});const B={};return V.forEach($=>{if(!$.isPregnant){const Y=Dy($.id,V,F);B[Y]=(B[Y]||0)+1}}),o.forEach($=>{const Y=$.generation;B[Y]=(B[Y]||0)+1}),r.jsxs("div",{ref:g,style:Qt.viewport,onWheel:h,onMouseDown:v,onMouseMove:x,onMouseUp:I,onMouseLeave:I,onTouchStart:N,onTouchMove:C,onTouchEnd:j,onTouchCancel:j,children:[Object.keys(B).length>0&&r.jsx("div",{style:Qt.statsPanel,children:Object.keys(B).sort(($,Y)=>$-Y).map($=>r.jsxs("span",{style:Qt.statItem,children:["",$,": ",r.jsx("strong",{children:B[$]}),""]},$))}),r.jsxs("div",{style:Qt.controls,children:[r.jsx("button",{onClick:()=>a(Math.min(3,i+.1)),children:""}),r.jsx("button",{onClick:()=>a(Math.max(.2,i-.1)),children:""}),r.jsx("button",{onClick:()=>{a(1),d({x:0,y:0})},children:""})]}),r.jsx("div",{style:{transform:`translate(${l.x}px, ${l.y}px) scale(${i})`,transformOrigin:"top center",transition:u?"none":"transform 0.1s ease-out",...Qt.treeCanvas},children:r.jsx(Fy,{node:T,allChildren:V,onNodeClick:$=>$.id!=="PLAYER"&&s($),generation:0,parentMap:F})})]})},Qt={viewport:{width:"100%",height:"650px",overflow:"hidden",background:"#f0f4f8",position:"relative",border:"3px double #dcd6cc",borderRadius:"12px",cursor:"grab"},controls:{position:"absolute",top:10,right:10,zIndex:10,display:"flex",gap:"5px"},statsPanel:{position:"absolute",top:10,left:10,zIndex:10,background:"rgba(255,255,255,0.95)",padding:"8px 12px",borderRadius:"8px",border:"2px solid #dcd6cc",boxShadow:"0 2px 6px rgba(0,0,0,0.1)",display:"flex",flexDirection:"column",gap:"4px",fontSize:"14px",maxHeight:"200px",overflowY:"auto"},statItem:{display:"block",color:"#333",lineHeight:"1.4"},treeCanvas:{display:"flex",justifyContent:"center",paddingTop:"50px",width:"max-content",minWidth:"100%"},nodeWrapper:{display:"flex",flexDirection:"column",alignItems:"center"},card:{width:"100px",padding:"8px",background:"#fff",border:"2px solid #ccc",borderRadius:"8px",textAlign:"center",cursor:"pointer",boxShadow:"0 2px 5px rgba(0,0,0,0.1)",position:"relative",zIndex:2},childrenContainer:{display:"flex",paddingTop:"20px"},childWrapper:{display:"flex",flexDirection:"column",alignItems:"center",position:"relative",padding:"0 10px"},lineDown:{width:"2px",height:"20px",background:"#ccc"},lineTop:{position:"absolute",top:0,height:"20px",borderTop:"2px solid #ccc",zIndex:1},avatar:{fontSize:"24px"},name:{fontSize:"12px",fontWeight:"bold",margin:"2px 0"},tier:{fontSize:"10px",color:"#666"},spouseTag:{fontSize:"10px",color:"#e91e63",marginTop:"2px"},pregnantTag:{fontSize:"10px",color:"#ff9800",marginTop:"2px"},generationCounter:{fontSize:"14px",fontWeight:"bold",color:"#2e7d32",padding:"10px 15px",backgroundColor:"#e8f5e9",borderRadius:"8px",marginTop:"10px",border:"2px dashed #2e7d32",display:"flex",alignItems:"center",justifyContent:"center"}},VE=[{value:"age",label:""},{value:"aptitude",label:""},{value:"cultivation",label:""},{value:"rank",label:""},{value:"name",label:""}],bl=10,YE=["","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","",""],Ig=(e="")=>{if(!e)return 0;const t=YE.indexOf(e);return t>=0?t:0},_g=e=>{if(!e)return 999;const t=_f.find(n=>n.name===e);return t?t.id:999},qE=({children:e,pregnantNpcs:t=[],onChildClick:n,onToggleFavorite:s})=>{const[o,i]=b.useState("age"),[a,l]=b.useState("all"),[d,u]=b.useState("all"),[p,c]=b.useState("all"),[m,y]=b.useState(!1),[S,E]=b.useState(1),[w,g]=b.useTransition(),h=b.useCallback(T=>{g(()=>i(T))},[g]);b.useEffect(()=>{E(1)},[o,a,d,p,m,e.length]);const v=b.useMemo(()=>new Set(t.map(T=>T.id)),[t]),x=b.useMemo(()=>{const T=new Map,A=new Map(e.map(F=>[F.id,F])),V=F=>{if(!F)return 1;if(T.has(F.id))return T.get(F.id);if(!F.parentId||F.parentId==="PLAYER")return T.set(F.id,1),1;const B=A.get(F.parentId),$=B?V(B):0,Y=Math.max(1,$+1);return T.set(F.id,Y),Y};return e.forEach(F=>V(F)),T},[e]),I=b.useCallback(T=>T&&x.get(T.id)||1,[x]),_=b.useMemo(()=>{let T=[...e];return m&&(T=T.filter(A=>A.isFavorite)),a!=="all"&&(T=T.filter(A=>A.gender===a)),d!=="all"&&(T=T.filter(A=>{const V=I(A);return d==="3+"?V>=3:V===parseInt(d)})),p!=="all"&&(T=T.filter(A=>p==="married"?A.spouse:p==="single"?!A.spouse:p==="pregnant"?v.has(A.id):p==="cultivating"?A.sect:!0)),T.sort((A,V)=>{var F,B;switch(o){case"age":return A.age-V.age;case"aptitude":return(((F=V.stats)==null?void 0:F.aptitude)||0)-(((B=A.stats)==null?void 0:B.aptitude)||0);case"cultivation":const $=Ig(A.tier||""),Y=Ig(V.tier||"");if($!==Y)return Y-$;const ne=A.currentExp||0;return(V.currentExp||0)-ne;case"rank":const ee=_g(A.rank),ae=_g(V.rank);return ee===999&&ae===999?0:ee===999?1:ae===999?-1:ae-ee;case"name":return A.name.localeCompare(V.name,"zh-CN");default:return 0}}),T},[e,o,a,d,p,v,m,x]),N=b.useMemo(()=>Math.max(1,Math.ceil(_.length/bl)),[_.length]);b.useEffect(()=>{E(T=>Math.min(T,N))},[N]);const C=b.useMemo(()=>{const T=(S-1)*bl;return _.filter(V=>I(V)<=2).slice(T,T+bl)},[_,S]),j=b.useMemo(()=>({total:e.length,male:e.filter(T=>T.gender==="").length,female:e.filter(T=>T.gender==="").length,married:e.filter(T=>T.spouse).length,pregnant:v.size,cultivating:e.filter(T=>T.sect).length,genius:e.filter(T=>{var A;return(((A=T.stats)==null?void 0:A.aptitude)||0)>=80}).length,favorite:e.filter(T=>T.isFavorite).length}),[e,v]);return r.jsxs("div",{style:be.container,children:[r.jsxs("div",{style:be.header,children:[r.jsxs("h3",{style:be.title,children:[" (1-2: ",_.filter(T=>I(T)<=2).length," / : ",j.total,")"]}),r.jsx("div",{style:be.statsBar,children:r.jsxs("span",{style:be.statItem,children:[": ",_.filter(T=>I(T)>2).length]})}),r.jsxs("div",{style:be.statsBar,children:[r.jsxs("span",{style:be.statItem,children:[" ",j.male]}),r.jsxs("span",{style:be.statItem,children:[" ",j.female]}),r.jsxs("span",{style:be.statItem,children:[" ",j.married]}),r.jsxs("span",{style:be.statItem,children:[" ",j.pregnant]}),r.jsxs("span",{style:be.statItem,children:[" ",j.cultivating]}),r.jsxs("span",{style:be.statItem,children:[" ",j.genius]}),r.jsxs("span",{style:be.statItem,children:[" ",j.favorite]})]})]}),r.jsxs("div",{style:be.controls,children:[r.jsxs("div",{style:be.sortRow,children:[r.jsx("span",{style:be.label,children:":"}),r.jsx("div",{style:be.segmentedRow,children:VE.map(T=>r.jsx("button",{type:"button",onClick:()=>h(T.value),style:{...be.segmentButton,...o===T.value?be.segmentButtonActive:{}},children:T.label},T.value))}),w&&r.jsx("span",{style:be.pendingHint,children:"..."}),r.jsx("button",{type:"button",onClick:()=>y(T=>!T),style:{...be.favoriteToggle,...m?be.favoriteToggleActive:{}},children:m?" ":" "})]}),r.jsxs("div",{style:be.filterRow,children:[r.jsxs("div",{style:be.controlGroup,children:[r.jsx("label",{style:be.label,children:":"}),r.jsxs("select",{value:a,onChange:T=>l(T.target.value),style:be.select,children:[r.jsx("option",{value:"all",children:""}),r.jsx("option",{value:"",children:""}),r.jsx("option",{value:"",children:""})]})]}),r.jsxs("div",{style:be.controlGroup,children:[r.jsx("label",{style:be.label,children:":"}),r.jsxs("select",{value:d,onChange:T=>u(T.target.value),style:be.select,children:[r.jsx("option",{value:"all",children:""}),r.jsx("option",{value:"1",children:""}),r.jsx("option",{value:"2",children:""}),r.jsx("option",{value:"3+",children:"+"})]})]}),r.jsxs("div",{style:be.controlGroup,children:[r.jsx("label",{style:be.label,children:":"}),r.jsxs("select",{value:p,onChange:T=>c(T.target.value),style:be.select,children:[r.jsx("option",{value:"all",children:""}),r.jsx("option",{value:"married",children:""}),r.jsx("option",{value:"single",children:""}),r.jsx("option",{value:"pregnant",children:""}),r.jsx("option",{value:"cultivating",children:""})]})]})]})]}),t.length>0&&p!=="single"&&p!=="cultivating"&&r.jsxs("div",{style:be.section,children:[r.jsxs("h4",{style:be.sectionTitle,children:["  (",t.length,")"]}),r.jsx("div",{style:be.embryoList,children:t.map(T=>r.jsxs("div",{style:be.embryoCard,children:[r.jsx("div",{style:be.embryoIcon,children:""}),r.jsxs("div",{style:be.embryoInfo,children:[r.jsx("div",{style:be.embryoName,children:"..."}),r.jsxs("div",{style:be.embryoDetail,children:[": ",T.name," ",T.gender===""&&r.jsx("span",{style:{fontSize:"10px",color:"#ff6b6b"},children:"()"})]}),r.jsx("div",{style:be.progressBar,children:r.jsx("div",{style:{...be.progressFill,width:`${(T.pregnancyProgress||0)*10}%`}})}),r.jsxs("div",{style:be.embryoProgress,children:[T.pregnancyProgress||0,"/9"]})]})]},`embryo-${T.id}`))})]}),r.jsx("div",{style:be.listContainer,children:_.length===0?r.jsxs("div",{style:be.emptyState,children:[r.jsx("div",{style:be.emptyIcon,children:""}),r.jsx("div",{style:be.emptyText,children:""})]}):C.map(T=>{var B,$,Y;const A=I(T),V=v.has(T.id),F=T.influenceProfile;return r.jsxs("div",{style:be.childCard,onClick:()=>n(T),children:[s&&r.jsx("button",{type:"button",title:T.isFavorite?"":"",style:{...be.favoriteButton,...T.isFavorite?be.favoriteButtonActive:{}},onClick:ne=>{ne.stopPropagation(),s(T.id)},children:T.isFavorite?"":""}),r.jsxs("div",{style:be.avatarSection,children:[T.age===0?r.jsx("div",{style:be.babyIcon,children:""}):T.age<15?r.jsx("div",{style:be.babyIcon,children:""}):r.jsx(Yr,{dna:T.avatar,gender:T.gender,size:60}),r.jsx("div",{style:be.genderBadge,"data-gender":T.gender,children:T.gender===""?"":""})]}),r.jsxs("div",{style:be.infoSection,children:[r.jsxs("div",{style:be.childName,children:[r.jsx("span",{style:{color:WE(((B=T.stats)==null?void 0:B.aptitude)||0)},children:T.name}),r.jsxs("span",{style:be.generationBadge,children:["",A,""]}),((($=T.stats)==null?void 0:$.aptitude)||0)>=80&&r.jsx("span",{style:be.geniusBadge,children:""}),T.isFavorite&&r.jsx("span",{style:be.favoriteBadge,children:" "})]}),r.jsxs("div",{style:be.infoRow,children:[r.jsxs("span",{style:be.infoItem,children:[": ",Math.floor(T.age),""]}),r.jsx("span",{style:be.infoItem,children:T.tierTitle||""}),T.isTested&&T.spiritRoot&&r.jsx("span",{style:{...be.infoItem,color:UE(T.spiritRoot.type)},children:T.spiritRoot.type})]}),r.jsxs("div",{style:be.infoRow,children:[r.jsxs("span",{style:be.infoItem,children:[": ",Math.floor(((Y=T.stats)==null?void 0:Y.aptitude)||0)]}),T.rank&&r.jsxs("span",{style:be.rankBadge,children:[" ",T.rank]}),T.sect&&r.jsxs("span",{style:be.sectBadge,children:[" ",T.sect.name]}),T.spouse&&r.jsxs("span",{style:be.spouseBadge,children:[" ",T.spouse.name]}),V&&r.jsx("span",{style:be.pregnantBadge,children:" "})]}),F&&r.jsxs("div",{style:be.influenceRow,children:[r.jsx("span",{style:{...be.influenceBadge,borderColor:F.color},children:F.label}),r.jsx("div",{style:be.influenceMeter,children:r.jsx("div",{style:{...be.influenceMeterFill,width:`${Math.min(100,Math.round((F.progress||0)*100))}%`,background:F.color}})}),r.jsx("span",{style:be.influenceScore,children:Math.floor(F.score)})]}),T.cultivationManual&&r.jsxs("div",{style:be.manualInfo,children:[" ",T.cultivationManual.name]})]}),r.jsx("div",{style:be.arrowSection,children:""})]},T.id)})}),_.length>bl&&r.jsxs("div",{style:be.pagination,children:[r.jsx("button",{style:{...be.pageBtn,opacity:S===1?.6:1},onClick:()=>E(T=>Math.max(1,T-1)),disabled:S===1,children:""}),r.jsxs("span",{style:be.pageInfo,children:[" ",S," / ",N," "]}),r.jsx("button",{style:{...be.pageBtn,opacity:S>=N?.6:1},onClick:()=>E(T=>Math.min(N,T+1)),disabled:S>=N,children:""})]})]})},be={container:{padding:"15px",backgroundColor:"#f5f0e8",borderRadius:"12px",border:"2px solid #8d6e63",maxHeight:"800px",height:"100%",display:"flex",flexDirection:"column",overflow:"hidden"},header:{marginBottom:"15px"},title:{margin:"0 0 10px 0",fontSize:"18px",fontWeight:"bold",color:"#5d4037"},statsBar:{display:"flex",gap:"12px",flexWrap:"wrap"},controls:{display:"flex",flexDirection:"column",gap:"12px",marginBottom:"15px",padding:"10px",backgroundColor:"rgba(255,255,255,0.5)",borderRadius:"8px"},sortRow:{display:"flex",flexWrap:"wrap",alignItems:"center",gap:"10px"},segmentedRow:{display:"flex",flexWrap:"wrap",gap:"6px"},pendingHint:{fontSize:"11px",color:"#5d4037",fontStyle:"italic"},segmentButton:{border:"1px solid #8d6e63",borderRadius:"16px",padding:"4px 10px",fontSize:"12px",backgroundColor:"white",color:"#5d4037",cursor:"pointer",transition:"all 0.2s ease"},segmentButtonActive:{backgroundColor:"#8d6e63",color:"white",boxShadow:"0 2px 6px rgba(0,0,0,0.2)"},favoriteToggle:{border:"1px dashed #c2185b",borderRadius:"16px",padding:"4px 12px",fontSize:"12px",cursor:"pointer",backgroundColor:"white",color:"#c2185b",fontWeight:"bold"},favoriteToggleActive:{backgroundColor:"#c2185b",color:"white"},filterRow:{display:"flex",flexWrap:"wrap",gap:"10px"},controlGroup:{display:"flex",alignItems:"center",gap:"5px"},label:{fontSize:"12px",fontWeight:"bold",color:"#5d4037"},select:{padding:"4px 8px",borderRadius:"4px",border:"1px solid #8d6e63",backgroundColor:"white",fontSize:"12px",cursor:"pointer"},influenceRow:{display:"flex",alignItems:"center",gap:"8px",marginTop:"6px"},influenceBadge:{borderRadius:"999px",border:"1px solid #ccc",padding:"2px 8px",fontSize:"11px",fontWeight:600},influenceMeter:{flex:1,height:"6px",backgroundColor:"#e0e0e0",borderRadius:"999px",overflow:"hidden"},influenceMeterFill:{height:"100%"},influenceScore:{fontSize:"12px",fontWeight:700,color:"#37474f"},section:{marginBottom:"15px"},sectionTitle:{margin:"0 0 10px 0",fontSize:"14px",fontWeight:"bold",color:"#d81b60"},embryoList:{display:"flex",gap:"10px",flexWrap:"wrap",marginBottom:"10px"},embryoCard:{display:"flex",alignItems:"center",gap:"10px",padding:"10px",backgroundColor:"white",borderRadius:"8px",border:"2px dashed #d81b60",minWidth:"200px"},embryoIcon:{fontSize:"32px"},embryoInfo:{flex:1},embryoName:{fontWeight:"bold",color:"#d81b60",marginBottom:"4px"},embryoDetail:{fontSize:"11px",color:"#666",marginBottom:"4px"},progressBar:{height:"6px",backgroundColor:"#e0e0e0",borderRadius:"3px",overflow:"hidden",marginBottom:"4px"},progressFill:{height:"100%",backgroundColor:"#d81b60",transition:"width 0.3s ease"},embryoProgress:{fontSize:"10px",color:"#666"},listContainer:{flex:1,overflowY:"auto",WebkitOverflowScrolling:"touch",display:"flex",flexDirection:"column",gap:"10px",minHeight:0},childCard:{display:"flex",gap:"12px",padding:"12px",backgroundColor:"white",borderRadius:"10px",border:"2px solid #e0e0e0",cursor:"pointer",transition:"all 0.2s ease",boxShadow:"0 2px 4px rgba(0,0,0,0.05)",position:"relative"},favoriteButton:{position:"absolute",top:"10px",right:"10px",border:"none",background:"transparent",fontSize:"18px",cursor:"pointer",color:"#d7ccc8",transition:"transform 0.2s ease, color 0.2s ease"},favoriteButtonActive:{color:"#ffb300",textShadow:"0 0 6px rgba(255,179,0,0.6)"},avatarSection:{position:"relative",flexShrink:0},babyIcon:{width:"60px",height:"60px",display:"flex",alignItems:"center",justifyContent:"center",fontSize:"40px",backgroundColor:"#f5f5f5",borderRadius:"50%"},genderBadge:{position:"absolute",bottom:"-4px",right:"-4px",width:"20px",height:"20px",borderRadius:"50%",display:"flex",alignItems:"center",justifyContent:"center",fontSize:"12px",fontWeight:"bold",color:"white",backgroundColor:"#4285F4",border:"2px solid white"},infoSection:{flex:1,display:"flex",flexDirection:"column",gap:"6px",minWidth:0},childName:{display:"flex",alignItems:"center",gap:"6px",fontSize:"14px",fontWeight:"bold",flexWrap:"wrap"},generationBadge:{fontSize:"10px",padding:"2px 6px",backgroundColor:"#e3f2fd",color:"#1976d2",borderRadius:"10px",fontWeight:"normal"},geniusBadge:{fontSize:"10px",padding:"2px 6px",backgroundColor:"#fff3e0",color:"#f57c00",borderRadius:"10px",fontWeight:"normal"},favoriteBadge:{fontSize:"10px",padding:"2px 6px",backgroundColor:"#fff8e1",color:"#ff8f00",borderRadius:"10px",fontWeight:"bold"},infoRow:{display:"flex",gap:"8px",flexWrap:"wrap",alignItems:"center"},infoItem:{fontSize:"11px",color:"#666"},sectBadge:{fontSize:"10px",padding:"2px 6px",backgroundColor:"#e8f5e9",color:"#2e7d32",borderRadius:"10px",fontWeight:"bold"},rankBadge:{fontSize:"10px",padding:"2px 6px",backgroundColor:"#f3e5f5",color:"#6a1b9a",borderRadius:"10px",fontWeight:"bold"},spouseBadge:{fontSize:"10px",padding:"2px 6px",backgroundColor:"#fce4ec",color:"#c2185b",borderRadius:"10px",fontWeight:"bold"},pregnantBadge:{fontSize:"10px",padding:"2px 6px",backgroundColor:"#fff3e0",color:"#f57c00",borderRadius:"10px",fontWeight:"bold"},manualInfo:{fontSize:"11px",color:"#7b1fa2",fontWeight:"bold"},arrowSection:{display:"flex",alignItems:"center",fontSize:"20px",color:"#bbb",flexShrink:0},emptyState:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",padding:"40px",color:"#999"},emptyIcon:{fontSize:"48px",marginBottom:"10px"},emptyText:{fontSize:"14px"}},Hy=document.createElement("style");Hy.textContent=`
  [data-gender=""] {
    background-color: #4285F4 !important;
  }
  [data-gender=""] {
    background-color: #EA4335 !important;
  }
  .childCard:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(0,0,0,0.15);
    border-color: #8d6e63;
  }
  
  /*  */
  @media (max-width: 768px) {
    /*  */
    .listContainer {
      max-height: calc(100vh - 300px) !important;
      -webkit-overflow-scrolling: touch;
    }
  }
`;document.head.appendChild(Hy);const KE=({records:e=[],onMemorialClick:t})=>{const n=b.useMemo(()=>{if(!e.length)return{avgAge:0,maxGeneration:0};const s=e.reduce((i,a)=>i+(a.ageAtDeath||0),0),o=Math.max(...e.map(i=>i.generation||1));return{avgAge:Math.round(s/e.length*10)/10,maxGeneration:o}},[e]);return r.jsxs("div",{style:rn.container,children:[r.jsxs("div",{style:rn.banner,children:[r.jsxs("div",{children:["   ",e.length," "]}),e.length>0&&r.jsxs("div",{style:rn.bannerStats,children:[r.jsxs("span",{children:[" ",n.avgAge||""," "]}),r.jsxs("span",{children:[" ",n.maxGeneration||1,""]})]})]}),e.length===0?r.jsx("div",{style:rn.empty,children:""}):r.jsx("div",{style:rn.grid,children:e.map(s=>{var o;return r.jsxs("button",{type:"button",style:{...rn.tomb,...s.isExiled?rn.tombExiled:{}},onClick:()=>t&&t(s),children:[r.jsxs("div",{style:rn.tombHeader,children:[r.jsx("span",{style:rn.icon,children:s.isExiled?"":""}),r.jsxs("div",{children:[r.jsx("div",{style:rn.name,children:s.name}),r.jsxs("div",{style:rn.meta,children:[s.isExiled?"":`${s.generation||1}`,"  ",s.tierTitle||""]})]})]}),!s.isExiled&&r.jsxs("div",{style:rn.detail,children:[" ",s.deathYear||""," ",s.deathMonth||1,"   ",s.ageAtDeath??""," "]}),s.deathReason&&r.jsxs("div",{style:rn.detail,children:[s.isExiled?"":"",s.deathReason]}),((o=s.sect)==null?void 0:o.name)&&!s.isExiled&&r.jsxs("div",{style:rn.detail,children:[s.sect.name,s.rank?`  ${s.rank}`:""]}),r.jsx("p",{style:rn.epitaph,children:s.epitaph||""}),typeof s.descendants=="number"&&!s.isExiled&&r.jsxs("div",{style:rn.descendants,children:["",s.descendants]})]},s.id)})})]})},rn={container:{width:"100%",height:"100%",background:"#fdf7f2",borderRadius:"12px",border:"2px solid #8d6e63",padding:"15px",display:"flex",flexDirection:"column",gap:"12px"},banner:{background:"linear-gradient(90deg, #efebe9, #f5f0e8)",borderRadius:"10px",padding:"12px 16px",fontWeight:"bold",display:"flex",justifyContent:"space-between",alignItems:"center",color:"#5d4037"},bannerStats:{display:"flex",gap:"16px",fontSize:"12px",color:"#6d4c41"},empty:{flex:1,display:"flex",alignItems:"center",justifyContent:"center",color:"#9e9e9e",fontStyle:"italic"},grid:{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(220px, 1fr))",gap:"12px",overflowY:"auto"},tomb:{display:"flex",flexDirection:"column",alignItems:"stretch",padding:"12px",borderRadius:"10px",border:"1px solid #d7ccc8",background:"#fffefd",textAlign:"left",cursor:"pointer",transition:"transform 0.2s ease, box-shadow 0.2s ease",outline:"none"},tombExiled:{background:"#f5f5f5",border:"1px solid #ccc",opacity:.8},tombHeader:{display:"flex",alignItems:"center",gap:"10px",marginBottom:"8px"},icon:{fontSize:"24px"},name:{fontWeight:"bold",color:"#4e342e"},meta:{fontSize:"12px",color:"#8d6e63"},detail:{fontSize:"12px",color:"#5d4037",marginTop:"4px"},epitaph:{marginTop:"10px",fontSize:"12px",color:"#4e342e",lineHeight:1.5},descendants:{marginTop:"8px",fontSize:"11px",color:"#6d4c41"}},QE=({player:e,children:t,fallenChildren:n=[],exiledChildren:s=[],pregnantNpcs:o=[],onChildClick:i,onToggleFavorite:a,onMemorialClick:l,generation3Plus:d=[]})=>{const[u,p]=b.useState("tree"),c=[...n,...s.map(m=>({...m,isExiled:!0,deathReason:"",epitaph:""}))];return r.jsxs("div",{style:Hn.container,children:[r.jsxs("div",{style:Hn.viewSwitcher,children:[r.jsx("button",{style:{...Hn.viewButton,...u==="tree"?Hn.viewButtonActive:{}},onClick:()=>p("tree"),children:" "}),r.jsx("button",{style:{...Hn.viewButton,...u==="list"?Hn.viewButtonActive:{}},onClick:()=>p("list"),children:" "}),r.jsx("button",{style:{...Hn.viewButton,...u==="cemetery"?Hn.viewButtonActive:{}},onClick:()=>p("cemetery"),children:" "})]}),r.jsxs("div",{style:{...Hn.viewContent,position:"relative"},children:[u==="tree"&&r.jsx(GE,{player:e,children:t,pregnantNpcs:o,onChildClick:i,generation3Plus:d}),u==="list"&&r.jsx(qE,{children:t,pregnantNpcs:o,onChildClick:i,onToggleFavorite:a}),u==="cemetery"&&r.jsx(KE,{records:c,onMemorialClick:l})]}),u==="tree"&&r.jsx("div",{style:Hn.hint,children:" : ,/,/"}),u==="list"&&r.jsx("div",{style:Hn.hint,children:" : "}),u==="cemetery"&&r.jsx("div",{style:Hn.hint,children:" : "})]})},Hn={container:{display:"flex",flexDirection:"column",gap:"15px"},viewSwitcher:{display:"flex",gap:"10px",justifyContent:"center",padding:"10px",backgroundColor:"rgba(255,255,255,0.5)",borderRadius:"12px",border:"2px solid #8d6e63"},viewButton:{padding:"10px 20px",fontSize:"14px",fontWeight:"bold",border:"2px solid #8d6e63",borderRadius:"20px",backgroundColor:"white",color:"#5d4037",cursor:"pointer",transition:"all 0.3s ease",outline:"none",boxShadow:"0 2px 4px rgba(0,0,0,0.1)"},viewButtonActive:{backgroundColor:"#8d6e63",color:"white",transform:"scale(1.05)",boxShadow:"0 4px 8px rgba(0,0,0,0.2)"},viewContent:{flex:1},hint:{textAlign:"center",fontSize:"12px",color:"#666",padding:"8px",backgroundColor:"rgba(255,255,255,0.7)",borderRadius:"8px",border:"1px solid #e0e0e0"}},Ep=document.createElement("style");Ep.textContent=`
  button:hover {
    transform: translateY(-2px);
  }
  button:active {
    transform: translateY(0);
  }
`;document.querySelector("#family-view-wrapper-styles")||(Ep.id="family-view-wrapper-styles",document.head.appendChild(Ep));const JE=e=>{if(!e||!e.sect||!e.sectId||e.sectId==="NONE")return null;const t=e.sect.name,n=e.name,s=e.sectRank||"",o=e.sectStatus||"active",i=[];return o==="active"?(i.push(`${t}${s}${n}`,`${t}${n}`,`${t}${n}`,`${t}${n}`,`${t}${n}`,`${t}${n}`,`${t}${n}`,`${t}${n}`,`${t}${n}`,`${t}${n}`),(s===""||s==="")&&i.push(`${t}${n}`,`${t}${n}`,`${t}${n}`,`${t}${n}`),(t.includes("")||t.includes("")||t.includes(""))&&i.push(`${t}${n}`,`${t}${n}`,`${n}(${t})`)):o==="defected"?i.push(`${t}${n}`,`${t}${s}${n}`,`${t}${n}`,`${n}`,`${t}${n}`,`${n}${t}`):o==="hidden"&&i.push(`${t}${n}`,`${t}${n}`),i.length>0?i[Math.floor(Math.random()*i.length)]:null},XE=e=>{if(!e||e.length<2)return null;const t=e.filter(a=>a.sect&&a.sectId&&a.sectId!=="NONE"&&a.sectStatus==="active");if(t.length<2)return null;const n=t[Math.floor(Math.random()*t.length)];let s=t[Math.floor(Math.random()*t.length)],o=0;for(;s.sectId===n.sectId&&o<10;)s=t[Math.floor(Math.random()*t.length)],o++;if(n.sectId===s.sectId)return null;const i=[`${n.sect.name}${n.name}${s.sect.name}${s.name}`,`${n.name}(${n.sect.name})${s.name}(${s.sect.name})`,`${n.sect.name}${n.name}${s.sect.name}${s.name}`];return i[Math.floor(Math.random()*i.length)]},ZE=[{type:"SECT",title:"",templates:["","","","","","","","","",""],probability:.15},{type:"SECT",title:"",templates:["","","","","","","",""],probability:.1},{type:"SECT",title:"",templates:["","","","","","","",""],probability:.12},{type:"SECT",title:"",templates:["","","","","","",""],probability:.08}],ej=[{type:"GENIUS",title:"",templates:["''","''","","''","","","''"],probability:.1},{type:"GENIUS",title:"",templates:["''","","","","",""],probability:.08},{type:"GENIUS",title:"",templates:["''''","''","","","",""],probability:.07},{type:"GENIUS",title:"",templates:["''","","","''","''",""],probability:.05}],tj=[{type:"TREASURE",title:"",templates:["","","","","","","","",""],probability:.12}],nj=[{type:"REALM",title:"",templates:["","","","","","","",""],probability:.1}],rj=[{type:"DISASTER",title:"",templates:["","","","","","","","",""],probability:.08}],sj=[{type:"POLITICS",title:"",templates:["","","","","","","",""],probability:.07}],oj=[{type:"DAILY",title:"",templates:["","","","","","",""],probability:.15}],ij=[{type:"FAMOUS",title:"",templates:["''","","","","''","","",""],probability:.06}],aj=()=>[...ZE,...ej,...tj,...nj,...rj,...sj,...oj,...ij],lj=(e,t,n=null,s=[])=>{const o=[],i=pj(e,t);for(let a=0;a<i;a++){const l=dj(e,t);l&&o.push(l)}if(s&&s.length>0&&Math.random()<.3){const a=cj(e,t,s);a&&o.push(a)}return o},cj=(e,t,n)=>{const s=Math.random();let o=null,i=null;if(s<.7){const a=n[Math.floor(Math.random()*n.length)];o=JE(a),i=[a.id]}else o=XE(n);return o?{type:"NPC_RELATED",category:"",title:"",message:o,year:e,month:t,importance:"MEDIUM",timestamp:Date.now(),npcIds:i}:null},dj=(e,t,n)=>{const s=aj(),o=uj(s);if(!o||!o.templates||o.templates.length===0)return null;const i=Ve(o.templates);return i?{type:o.type,category:"",title:o.title,message:i,year:e,month:t,importance:fj(o.type),timestamp:Date.now()}:null},uj=e=>{const t=e.reduce((s,o)=>s+(o.probability||0),0);let n=Math.random()*t;for(const s of e)if(n-=s.probability||0,n<=0)return s;return e[0]},pj=(e,t)=>{if(t===1||t===7){const s=Math.random();return s<.3?3:s<.7?2:1}const n=Math.random();return n<.5?1:n<.8?2:0},fj=e=>({DISASTER:5,POLITICS:4,GENIUS:4,SECT:3,REALM:3,TREASURE:3,FAMOUS:2,DAILY:1})[e]||2,mj=(e,t,n,s)=>{const o=t.filter(i=>i.sect&&["TOP","HIGH"].includes(i.sect.level));if(o.length>0&&Math.random()<.2){const i=Ve(o),a=i.sect.name,l=[`${a}${i.name}`,`${a}${i.name}`,`${a}${i.name}`];return{type:"SECT",category:"",title:"",message:Ve(l),year:n,month:s,importance:3,relatedChild:i.id,timestamp:Date.now()}}return null},gj=e=>({SECT:"",GENIUS:"",TREASURE:"",REALM:"",DISASTER:"",POLITICS:"",DAILY:"",FAMOUS:""})[e]||"",hj=e=>({SECT:"#4A90E2",GENIUS:"#E74C3C",TREASURE:"#F39C12",REALM:"#9B59B6",DISASTER:"#E67E22",POLITICS:"#16A085",DAILY:"#95A5A6",FAMOUS:"#D4AF37"})[e]||"#7F8C8D",Rg={ready:"#43a047",pending:"#fb8c00"},xj=({summary:e,onUpgrade:t})=>{if(!e)return null;const{currentTier:n,nextTier:s,requirements:o,totals:i,canUpgrade:a,enrichedChildren:l}=e,d=Math.round((i.powerProgress||0)*100),u=[...l].filter(p=>(p.generation||1)<=2).sort((p,c)=>{var m,y;return(((m=c.influence)==null?void 0:m.score)||0)-(((y=p.influence)==null?void 0:y.score)||0)}).slice(0,3);return r.jsxs("div",{style:Je.wrapper,children:[r.jsxs("div",{style:Je.headerRow,children:[r.jsxs("div",{children:[r.jsx("div",{style:Je.label,children:""}),r.jsx("div",{style:Je.currentTier,children:(n==null?void 0:n.name)||""}),r.jsx("div",{style:Je.desc,children:n==null?void 0:n.desc})]}),r.jsxs("div",{style:Je.metricsBox,children:[r.jsxs("div",{style:Je.metricItem,children:[r.jsx("span",{style:Je.metricLabel,children:""}),r.jsx("strong",{style:Je.metricValue,children:i.population})]}),r.jsxs("div",{style:Je.metricItem,children:[r.jsx("span",{style:Je.metricLabel,children:""}),r.jsx("strong",{style:Je.metricValue,children:i.ratingScore})]}),r.jsxs("div",{style:Je.metricItem,children:[r.jsx("span",{style:Je.metricLabel,children:""}),r.jsx("strong",{style:Je.metricValue,children:i.sovereignCount})]}),r.jsxs("div",{style:Je.metricItem,children:[r.jsx("span",{style:Je.metricLabel,children:""}),r.jsx("strong",{style:Je.metricValue,children:i.population-l.length})]})]})]}),s?r.jsxs("div",{style:Je.progressSection,children:[r.jsxs("div",{style:Je.progressHeader,children:[r.jsxs("div",{children:[r.jsxs("div",{style:Je.nextLabel,children:["",s.name]}),r.jsx("small",{style:{color:"#cfd8dc"},children:s.desc})]}),r.jsxs("span",{style:{fontWeight:"bold",color:"#fff"},children:[d,"%"]})]}),r.jsx("div",{style:Je.progressBarBg,children:r.jsx("div",{style:{...Je.progressBarFill,width:`${Math.min(100,d)}%`}})})]}):r.jsx("div",{style:Je.progressSection,children:r.jsx("div",{style:Je.nextLabel,children:""})}),(o==null?void 0:o.length)>0&&r.jsx("div",{style:Je.requirementsGrid,children:o.map(p=>{const c=p.met;return r.jsxs("div",{style:Je.requirementCard,children:[r.jsx("div",{style:{...Je.requirementBadge,backgroundColor:c?Rg.ready:Rg.pending},children:c?"":""}),r.jsxs("div",{children:[r.jsx("div",{style:Je.requirementLabel,children:p.label}),r.jsxs("div",{style:Je.requirementValue,children:[p.current," / ",p.required]})]})]},p.label)})}),u.length>0&&r.jsxs("div",{children:[r.jsx("div",{style:Je.label,children:""}),r.jsx("div",{style:Je.contributorRow,children:u.map(p=>{var c,m,y;return r.jsxs("div",{style:Je.contributorCard,children:[r.jsx("div",{style:{...Je.contributorBadge,color:((c=p.influence)==null?void 0:c.color)||"#fff"},children:(m=p.influence)==null?void 0:m.label}),r.jsx("div",{style:Je.contributorName,children:p.name}),r.jsx("div",{style:Je.contributorScore,children:((y=p.influence)==null?void 0:y.score)||0})]},p.id)})})]}),r.jsx("button",{onClick:t,disabled:!a,style:{...Je.actionBtn,background:a?"linear-gradient(120deg, #ffb300, #ff7043)":"#455a64"},children:s?a?` ${s.name}`:"":""})]})},Je={wrapper:{background:"linear-gradient(135deg, #1f1f2b 0%, #2f2f44 100%)",borderRadius:16,padding:20,color:"#eceff1",marginBottom:20,border:"1px solid rgba(255,255,255,0.1)"},headerRow:{display:"flex",justifyContent:"space-between",gap:20,flexWrap:"wrap"},label:{fontSize:12,letterSpacing:1,textTransform:"uppercase",color:"#90a4ae"},currentTier:{fontSize:24,fontWeight:700},desc:{marginTop:4,fontSize:13,color:"#b0bec5"},metricsBox:{display:"flex",gap:12,flexWrap:"wrap",justifyContent:"flex-end"},metricItem:{minWidth:90,padding:"8px 12px",borderRadius:10,background:"rgba(255,255,255,0.08)",textAlign:"center",fontSize:12,display:"flex",flexDirection:"column",gap:4},metricLabel:{color:"#cfd8dc",fontSize:11,letterSpacing:1},metricValue:{fontSize:20,fontWeight:700,color:"#fff"},progressSection:{marginTop:16},nextLabel:{fontSize:14,fontWeight:600},progressHeader:{display:"flex",justifyContent:"space-between",marginBottom:6},progressBarBg:{width:"100%",height:10,borderRadius:999,background:"rgba(255,255,255,0.15)",overflow:"hidden"},progressBarFill:{height:"100%",background:"linear-gradient(90deg, #42a5f5, #7e57c2)"},requirementsGrid:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(150px, 1fr))",gap:12,marginTop:16},requirementCard:{display:"flex",gap:10,alignItems:"center",padding:"10px 12px",borderRadius:12,background:"rgba(255,255,255,0.08)"},requirementBadge:{width:32,height:32,borderRadius:10,display:"flex",alignItems:"center",justifyContent:"center",fontWeight:700,color:"#fff"},requirementLabel:{fontSize:12,color:"#cfd8dc"},requirementValue:{fontSize:14,fontWeight:600},contributorRow:{display:"flex",gap:12,marginTop:8,flexWrap:"wrap"},contributorCard:{flex:"1 1 120px",minWidth:120,background:"rgba(0,0,0,0.25)",borderRadius:12,padding:12},contributorBadge:{fontSize:12,fontWeight:700},contributorName:{marginTop:4,fontSize:16,fontWeight:600},contributorScore:{fontSize:13,color:"#b0bec5"},actionBtn:{width:"100%",marginTop:16,border:"none",borderRadius:999,padding:"12px 0",fontSize:14,fontWeight:600,color:"#1f1f2b",cursor:"pointer"}},yj=["","","",""],bj=["","","","","","","","","","","","","",""],vj=["","","","","","","","","","","","","","","",""],Sj=["","","","","",""],wj="init-log",vl=10,Sl=(e="",t=[])=>{if(!e)return!1;const n=String(e);return t.some(s=>s&&n.includes(s))},cu=e=>{if(!e)return"DAILY";const t=e.category||"",n=`${e.title||""}${e.message||""}`;return Sl(t,yj)?"WORLD":e.type==="DAILY"||Sl(n,Sj)?"DAILY":e.id&&e.id.startsWith(wj)||e.turn===0||Sl(t,bj)||Sl(n,vj)||e.type&&e.type!=="DAILY"?"MAJOR":"DAILY"},kj=({logs:e,ratingSummary:t,onUpgradeRating:n})=>{const[s,o]=b.useState("ALL"),[i,a]=b.useState(()=>new Set),[l,d]=b.useState(0),u=b.useMemo(()=>s==="ALL"?e:e.filter(y=>cu(y)===s),[e,s]),p=b.useMemo(()=>Math.max(1,Math.ceil(u.length/vl)),[u.length]),c=b.useMemo(()=>{const y=l*vl;return u.slice(y,y+vl)},[u,l]),m=b.useMemo(()=>{const y={all:e.length,daily:0,major:0,world:0};return e.forEach(S=>{const E=cu(S);E==="WORLD"?y.world+=1:E==="MAJOR"?y.major+=1:y.daily+=1}),y},[e]);return b.useEffect(()=>{d(0)},[s,e.length]),r.jsxs("div",{style:ct.container,children:[t&&r.jsx("div",{style:ct.ratingSection,children:r.jsx(xj,{summary:t,onUpgrade:n})}),r.jsx("h3",{style:ct.title,children:" "}),r.jsxs("div",{style:ct.filterBar,children:[r.jsxs("button",{style:{...ct.filterBtn,...s==="ALL"?ct.filterBtnActive:{}},onClick:()=>o("ALL"),children:["  (",m.all,")"]}),r.jsxs("button",{style:{...ct.filterBtn,...s==="DAILY"?ct.filterBtnActive:{}},onClick:()=>o("DAILY"),children:["  (",m.daily,")"]}),r.jsxs("button",{style:{...ct.filterBtn,...s==="MAJOR"?ct.filterBtnActive:{}},onClick:()=>o("MAJOR"),children:["  (",m.major,")"]}),r.jsxs("button",{style:{...ct.filterBtn,...s==="WORLD"?ct.filterBtnActive:{}},onClick:()=>o("WORLD"),children:["  (",m.world,")"]})]}),r.jsxs("div",{style:ct.logWindow,children:[u.length===0?r.jsx("p",{style:{color:"#999"},children:"..."}):null,c.map((y,S)=>{const E=cu(y),w=E==="WORLD",g=E==="MAJOR";let h="",v="#8B4513";w?(h=gj(y.type),v=hj(y.type)):g&&(h="",v="#b45309");const x=y.id||`${y.turn}-${S+l*vl}`,I=!!y.details,_=I&&i.has(x),N=y.title||y.message||"",C=()=>{I&&a(F=>{const B=new Set(F);return B.has(x)?B.delete(x):B.add(x),B})},j=3572,T=y.turn||0,A=j+Math.floor(T/12),V=T%12||12;return r.jsxs("div",{style:ct.logItem,children:[r.jsxs("div",{style:ct.logHeader,children:[r.jsxs("span",{style:{...ct.turn,color:v},children:[h," [ ",A," ",V,"]"]}),(w||g)&&y.title&&r.jsx("span",{style:ct.eventTag,children:y.title})]}),I?r.jsxs(r.Fragment,{children:[r.jsxs("div",{style:ct.summaryRow,children:[r.jsx("span",{style:ct.summaryText,children:N}),r.jsx("button",{style:ct.toggleBtn,onClick:C,children:_?"":""})]}),_&&r.jsx("div",{style:ct.detailContent,children:y.details})]}):r.jsx("div",{style:ct.logContent,children:y.message})]},x)})]}),r.jsxs("div",{style:ct.footer,children:[r.jsxs("div",{style:ct.paginationBar,children:[r.jsx("button",{style:{...ct.pageBtn,...l<=0?ct.pageBtnDisabled:{}},onClick:()=>d(y=>Math.max(0,y-1)),disabled:l<=0,children:""}),r.jsxs("span",{style:ct.pageInfo,children:[" ",l+1," / ",p," "]}),r.jsx("button",{style:{...ct.pageBtn,...l>=p-1?ct.pageBtnDisabled:{}},onClick:()=>d(y=>Math.min(p-1,y+1)),disabled:l>=p-1,children:""})]}),r.jsxs("span",{style:{fontSize:"11px",color:"#666"},children:[" ",u.length," "]})]})]})},ct={container:{width:"calc(100% - 30px)",maxWidth:"800px",margin:"20px auto 150px auto",border:"1px solid #ccc",borderRadius:"8px",backgroundColor:"#fff",fontFamily:'"KaiTi", serif',display:"flex",flexDirection:"column",minHeight:"500px",pointerEvents:"auto"},ratingSection:{padding:"12px",borderBottom:"1px solid rgba(0,0,0,0.05)"},title:{margin:"0",padding:"10px",backgroundColor:"#f5f5f5",borderBottom:"1px solid #eee",fontSize:"16px"},filterBar:{display:"flex",gap:"5px",padding:"8px",backgroundColor:"#fafafa",borderBottom:"1px solid #eee",pointerEvents:"auto"},filterBtn:{flex:1,padding:"6px 8px",fontSize:"12px",border:"1px solid #ddd",borderRadius:"4px",backgroundColor:"#fff",cursor:"pointer",transition:"all 0.2s",fontFamily:"inherit",pointerEvents:"auto"},filterBtnActive:{backgroundColor:"#4A90E2",color:"#fff",border:"1px solid #4A90E2",fontWeight:"bold"},logWindow:{flex:1,minHeight:"300px",maxHeight:"500px",overflowY:"auto",padding:"10px",fontSize:"13px",pointerEvents:"auto"},logItem:{marginBottom:"10px",borderBottom:"1px dashed #eee",paddingBottom:"6px",pointerEvents:"auto"},logHeader:{display:"flex",alignItems:"center",gap:"6px",marginBottom:"3px",pointerEvents:"auto"},turn:{fontWeight:"bold",fontSize:"12px"},eventTag:{fontSize:"10px",padding:"2px 6px",backgroundColor:"#f0f0f0",borderRadius:"3px",color:"#666"},logContent:{lineHeight:"1.5",color:"#333",whiteSpace:"pre-wrap"},summaryRow:{display:"flex",justifyContent:"space-between",alignItems:"center",gap:"8px",padding:"4px 0",pointerEvents:"auto"},summaryText:{fontWeight:600,fontSize:"13px",flex:1,color:"#333",pointerEvents:"auto"},toggleBtn:{border:"1px solid #ccc",borderRadius:"999px",padding:"2px 10px",backgroundColor:"#fff",fontSize:"11px",cursor:"pointer",pointerEvents:"auto"},detailContent:{lineHeight:"1.6",color:"#444",backgroundColor:"#fafafa",borderRadius:"6px",padding:"8px 10px",border:"1px solid rgba(0,0,0,0.05)",whiteSpace:"pre-wrap",pointerEvents:"auto"},footer:{padding:"12px 10px",backgroundColor:"#f5f5f5",borderTop:"2px solid #d32f2f",textAlign:"center",pointerEvents:"auto",flexShrink:0,minHeight:"60px",display:"flex",flexDirection:"column",justifyContent:"center",gap:"6px"},paginationBar:{display:"flex",justifyContent:"center",alignItems:"center",gap:"10px",marginBottom:"6px"},pageBtn:{padding:"6px 14px",border:"2px solid #d32f2f",borderRadius:"6px",backgroundColor:"#fff",cursor:"pointer",fontSize:"13px",fontWeight:"bold",color:"#d32f2f",transition:"all 0.2s",pointerEvents:"auto"},pageBtnDisabled:{backgroundColor:"#f0f0f0",cursor:"not-allowed",color:"#999",borderColor:"#ccc"},pageInfo:{fontSize:"12px",color:"#666"}};class os{static onChildBirth(t,n,s={}){vn(t);const o=Cg(t,n,s);return uo(t,{description:`${n.name}`,affectionChange:0,context:`${s.difficulty===""?"":""}`}),console.log(`[] ${t.name} : ${n.name}`),o}static onMarriage(t,n=""){vn(t);const s=BE(t,n);return uo(t,{description:"",affectionChange:30,context:""}),console.log(`[] ${t.name} `),s}static onReceiveGift(t,n,s){vn(t);const o=uo(t,{description:`${n.name}`,affectionChange:s,context:n.tier>=3?"":""});return Math.abs(s)>=20&&Oo(t,{event:`${n.name}`,detail:`${n.name}`,emotionalImpact:Ps.SIGNIFICANT,category:"relationship",tags:["",n.name,""]}),o}static onCombatTogether(t,n,s=!1){return vn(t),s?OE(t,`${n}`):uo(t,{description:`${n}`,affectionChange:5,context:""})}static onBreakthrough(t,n){return vn(t),Oo(t,{event:`${n}`,detail:`${n}`,emotionalImpact:Ps.PROFOUND,category:"cultivation",tags:["","",n]})}static onPregnancyStart(t){return vn(t),uo(t,{description:"",affectionChange:15,context:""})}static onChildJoinSect(t,n,s){return vn(t),uo(t,{description:`${n.name}${s}`,affectionChange:0,context:""})}static onChildMarriage(t,n,s){return vn(t),Oo(t,{event:`${n.name}`,detail:`${n.name}${s}`,emotionalImpact:Ps.SIGNIFICANT,category:"family",tags:["","",n.name]})}static initializeAllNpcs(t){t.forEach(n=>{vn(n)}),console.log(`[]  ${t.length}  NPC `)}static backfillChildrenMemories(t,n){vn(t),n.forEach(s=>{t.memories.milestones.some(i=>i.tags.includes(s.name))||(Cg(t,s,{difficulty:"",sacrifice:!1}),console.log(`[]  ${t.name}  ${s.name} `))})}static getMemorySummary(t){return t.memories||vn(t),{milestoneCount:t.memories.milestones.length,milestones:t.memories.milestones,recentEventCount:t.memories.recentEvents.length,recentEvents:t.memories.recentEvents,longTermSummary:t.memories.longTermSummary,totalEvents:t.memories.meta.totalEvents}}static clearAllMemories(t){t.memories&&(t.memories.milestones=[],t.memories.recentEvents=[],t.memories.longTermSummary="",t.memories.meta.totalEvents=0,console.log(`[]  ${t.name} `))}}const Ej=e=>{const{identity:t,personality:n,stats:s,relationship:o}=e,i=typeof n=="object"&&n!==null&&"label"in n?n.label:Array.isArray(n)?n[0]:"",a=s.aptitude&&s.aptitude>=90,l=(o==null?void 0:o.jealousy)||0;if(l>=60)return pu(e,l,i);if(l>=40&&Math.random()<.5)return pu(e,l,i);if(l>=20&&Math.random()<.2)return pu(e,l,i);if(a){const p=["","",""];return p[Math.floor(Math.random()*p.length)]}const d={:["","","",""],:["","","",""],:["","","",""],:["","","",""],:["","","",""],:["","","",""],:["","","",""],:["","","",""],:["","","",""],:["","","",""],:["","","",""],:["","","",""],:["","","",""],:["","","",""],:["","","",""],:["","","",""],:["","","",""],:["","","",""],:["","","",""],:["","","",""]};if(Math.random()>.5||!d[t])switch(i){case"":return"";case"":return"";case"":return"";case"":return"";case"":return"";case"":return"";default:return""}const u=d[t]||[""];return u[Math.floor(Math.random()*u.length)]},jj=(e,t)=>{const n=typeof e.personality=="object"&&e.personality!==null&&"label"in e.personality?e.personality.label:Array.isArray(e.personality)?e.personality[0]:"",s=e.likes&&e.likes.includes(t.name);let o=t.value,i="";if(e.identity==="")return t.name&&/|||/i.test(t.name)||t.tags&&t.tags.includes("scripture")?(o=Math.floor(t.value*3),i=`${e.name} `,{msg:i,change:o}):{msg:`${e.name} `,change:0};if(t.value<10&&(["","",""].includes(n)||[""].includes(e.identity)))return{msg:`${e.name} ${t.name}`,change:-5};if(s)o*=2,i=`${e.name} ${t.name}`;else if(n===""&&t.cost>=300)o*=1.5,i=`${e.name} ${t.name}`;else switch(n){case"":i=`${e.name} `;break;case"":i=`${e.name} `;break;case"":i=`${e.name} `;break;default:i=`${e.name} ${t.name}`}return{msg:i,change:Math.floor(o)}},Cj=[{title:"",text:e=>`${e}${e}""`,affectionBonus:5},{title:"",text:e=>`${e}${e}""`,affectionBonus:5},{title:"",text:e=>`${e}${e}""`,affectionBonus:8},{title:"",text:e=>`${e}${e}""`,affectionBonus:6},{title:"",text:e=>`${e}${e}${e}""`,affectionBonus:10},{title:"",text:e=>`${e}"......"${e}""`,affectionBonus:12,requirePregnant:!0},{title:"",text:e=>`${e}${e}"..."${e}"..."`,affectionBonus:13,requirePregnant:!0}],Tj=[{title:"",text:e=>`${e}${e}""`,affectionBonus:6},{title:"",text:e=>`${e}${e}${e}""`,affectionBonus:7},{title:"",text:e=>`""${e}""`,affectionBonus:8},{title:"",text:e=>`${e}${e}""`,affectionBonus:7},{title:"",text:e=>`${e}""${e}""`,affectionBonus:5},{title:"",text:e=>`${e}"......"`,affectionBonus:10,requirePregnant:!0},{title:"",text:e=>`${e}"..."${e}"..."`,affectionBonus:11,requirePregnant:!0}],Mg=[{title:"",text:e=>`${e}${e}""`,affectionBonus:6},{title:"",text:e=>`${e}""`,affectionBonus:7},{title:"",text:e=>`${e}""`,affectionBonus:8},{title:"",text:e=>`${e}""`,affectionBonus:5},{title:"",text:e=>`${e}${e}""`,affectionBonus:9},{title:"",text:e=>`${e}"..."`,affectionBonus:12,requirePregnant:!0},{title:"",text:e=>`${e}"..."${e}"..."`,affectionBonus:14,requirePregnant:!0}],Ij=[{title:"",text:e=>`${e}${e}""`,affectionBonus:6},{title:"",text:e=>`${e}""`,affectionBonus:7},{title:"",text:e=>`${e}""${e}`,affectionBonus:6},{title:"",text:e=>`${e}${e}""`,affectionBonus:5},{title:"",text:e=>`${e}${e}""`,affectionBonus:8},{title:"",text:e=>`${e}"......"`,affectionBonus:13,requirePregnant:!0},{title:"",text:e=>`${e}"...""..."`,affectionBonus:12,requirePregnant:!0}],Ag=[{title:"",text:(e,t)=>`${e}""`,affectionBonus:8},{title:"",text:(e,t)=>`${e}""`,affectionBonus:10},{title:"",text:(e,t)=>`${e}${e}""`,affectionBonus:7},{title:"",text:(e,t)=>`${e}""`,affectionBonus:6},{title:"",text:(e,t)=>`${e}${e}""`,affectionBonus:9}],_j=[{title:"",text:(e,t)=>`${e}${e}""`,affectionBonus:8},{title:"",text:(e,t)=>`${e}${e}"${t===""?"":""}"`,affectionBonus:6},{title:"",text:(e,t)=>`${e}""`,affectionBonus:10},{title:"",text:(e,t)=>`${e}""${e}`,affectionBonus:4},{title:"",text:(e,t)=>`${e}""`,affectionBonus:9}],Rj=[{title:"",text:(e,t)=>`${e}${e}""`,affectionBonus:10},{title:"",text:(e,t)=>`${e}""`,affectionBonus:12},{title:"",text:(e,t)=>`${e}${e}${e}""`,affectionBonus:15},{title:"",text:(e,t)=>`${e}""`,affectionBonus:11},{title:"",text:(e,t)=>`${e}""`,affectionBonus:10}],Ng=(e,t)=>{let n=Mg;switch(e){case"COLD":n=Cj;break;case"YANDERE":n=Tj;break;case"GENTLE":n=Mg;break;case"FLIRTY":n=Ij;break}const s=n.filter(i=>!(i.requirePregnant&&!t.isPregnant));if(s.length===0)return null;const o=s[Math.floor(Math.random()*s.length)];return{title:o.title,text:o.text(t.name),affectionBonus:o.affectionBonus}},Mj=(e,t,n="")=>{let s=Ag;switch(e){case"TODDLER":s=Ag;break;case"TEEN":s=_j;break;case"ADULT":s=Rj;break}const o=s[Math.floor(Math.random()*s.length)];return{title:o.title,text:o.text(t.name,n),affectionBonus:o.affectionBonus}},Aj=[{title:"",text:e=>`${e}""`,affectionBonus:5},{title:"",text:e=>`${e}""`,affectionBonus:7},{title:"",text:e=>`${e}${e}${e}""`,affectionBonus:10}],Nj=[{title:"",text:e=>`${e}${e}""`,affectionBonus:4},{title:"",text:e=>`${e}""`,affectionBonus:8},{title:"",text:e=>`${e}${e}${e}""`,affectionBonus:9}],Lj=[{title:"",text:e=>`${e}${e}${e}""`,affectionBonus:10},{title:"",text:e=>`${e}""`,affectionBonus:12},{title:"",text:e=>`${e}${e}""`,affectionBonus:8}],$j=[{title:"",text:e=>`${e}${e}""`,affectionBonus:6},{title:"",text:e=>`${e}${e}"..."`,affectionBonus:5,minAffection:40},{title:"",text:e=>`${e}""`,affectionBonus:10,minAffection:60},{title:"",text:e=>`${e}${e}"..."`,affectionBonus:8,minAffection:70},{title:"",text:e=>`${e}""${e}""`,affectionBonus:15,minAffection:80},{title:"",text:e=>`${e}"..."${e}`,affectionBonus:12,minAffection:85},{title:"",text:e=>`${e}${e}"......"${e}`,affectionBonus:20,minAffection:90},{title:"",text:e=>`${e}"..."${e}`,affectionBonus:15,minAffection:95}],Bj=[{title:"",text:e=>`${e}${e}${e}""`,affectionBonus:10},{title:"",text:e=>`${e}${e}${e}${e}""`,affectionBonus:8},{title:"",text:e=>`${e}""${e}`,affectionBonus:15}],Oj=[{title:"",text:e=>`${e}${e}""`,affectionBonus:5},{title:"",text:e=>`${e}${e}${e}""`,affectionBonus:9},{title:"",text:e=>`${e}${e}""`,affectionBonus:11}],Pj=[{title:"",text:e=>`${e}${e}""`,affectionBonus:12},{title:"",text:e=>`${e}${e}""`,affectionBonus:10},{title:"",text:e=>`${e}${e}${e}${e}""`,affectionBonus:8}],du=(e,t)=>{var a;let n=[];switch(e){case"":n=Aj;break;case"":n=Nj;break;case"":case"":n=Lj;break;case"":n=$j;break;case"":n=Bj;break;case"":n=Oj;break;case"":n=Pj;break;default:return null}if(n.length===0)return null;const s=((a=t.relationship)==null?void 0:a.affection)||0,o=n.filter(l=>!(l.minAffection&&s<l.minAffection));if(o.length===0)return null;const i=o[Math.floor(Math.random()*o.length)];return{title:i.title,text:i.text(t.name),affectionBonus:i.affectionBonus}},uu=(e,t)=>{var a;if(e.isChild){if(Math.random()<.25){let l="TODDLER";return e.age>=18?l="ADULT":e.age>=11&&(l="TEEN"),Mj(l,e,(t==null?void 0:t.gender)||"")}return null}if(Math.random()>=.3)return null;const s=((a=e.relationship)==null?void 0:a.affection)||0,o=typeof e.personality=="object"&&e.personality!==null&&"label"in e.personality?e.personality.label:Array.isArray(e.personality)?e.personality[0]:"";if(s>=80){if(Math.random()<.7){let d="GENTLE";return["","","",""].includes(o)?d="COLD":["","","",""].includes(o)?d="YANDERE":["","","",""].includes(o)?d="FLIRTY":["","","","",""].includes(o)&&(d="GENTLE"),Ng(d,e)}const l=du(e.identity,e);return l||null}if(s>=60){if(Math.random()<.5){let d="GENTLE";return["","","",""].includes(o)?d="COLD":["","","",""].includes(o)?d="YANDERE":["","","",""].includes(o)?d="FLIRTY":["","","","",""].includes(o)&&(d="GENTLE"),Ng(d,e)}const l=du(e.identity,e);return l||null}const i=du(e.identity,e);return i||null};function pu(e,t,n){if(e.name,t>=61){const i={:["...","...","..."],:["","...",""],:["...","",""],:["......","...","......"],:["...","...","..."],:["...","","..."]},a=i[n]||i.;return a[Math.floor(Math.random()*a.length)]}if(t>=41){const i={:["...","...","..."],:["","","..."],:["...","","..."],:["...","","......"],:["...","...","..."],:["","...","..."]},a=i[n]||i.;return a[Math.floor(Math.random()*a.length)]}const s={:["...","...","..."],:["","","..."],:["...","","..."],:["...","......","..."],:["","","..."],:["","","..."]},o=s[n]||s.;return o[Math.floor(Math.random()*o.length)]}const zj=(e,t,n)=>{const s=typeof e.personality=="object"&&e.personality!==null&&"label"in e.personality?e.personality.label:Array.isArray(e.personality)?e.personality[0]:"",o=e.identity||"",i=e.name;return n?Dj(i,s,o,t):Fj(i,s,o,t)};function Dj(e,t,n,s){var d;const o=`${t}_${n}_${s.id}`,i=po[o];if(i)return i(e);const a=po[`${t}_${s.id}`];if(a)return a(e);const l=po[`${n}_${s.id}`];return l?l(e):((d=po[`default_${s.id}`])==null?void 0:d.call(po,e))||`${e} ""`}const po={_PROFIT:e=>`${e} ""`,__PROFIT:e=>`${e} ""`,__PROFIT:e=>`${e} ""`,__PROFIT:e=>`${e} ""`,_PROFIT:e=>`${e} ""`,__PROFIT:e=>`${e} ""`,__PROFIT:e=>`${e} ""`,__PROFIT:e=>`${e} ""`,_PROFIT:e=>`${e} ""`,__PROFIT:e=>`${e} ""`,__PROFIT:e=>`${e} ""`,_PROFIT:e=>`${e} ""`,__PROFIT:e=>`${e} ""`,_PROFIT:e=>`${e} ""`,__PROFIT:e=>`${e} "~"`,_PROFIT:e=>`${e} ""`,__PROFIT:e=>`${e} ""`,_PROFIT:e=>`${e} ""`,__PROFIT:e=>`${e} ""`,_PROFIT:e=>`${e} "''"`,__PROFIT:e=>`${e} ""`,_PROFIT:e=>`${e} ""`,__PROFIT:e=>`${e} ""`,_PROFIT:e=>`${e} ""`,_PROFIT:e=>`${e} "~"`,_PROFIT:e=>`${e} ""`,_PROFIT:e=>`${e} "~"`,_PROFIT:e=>`${e} ""`,_PROFIT:e=>`${e} ""`,_PROFIT:e=>`${e} ""`,_PROFIT:e=>`${e} "~"`,_EMOTION:e=>`${e} """"`,__EMOTION:e=>`${e} ""`,__EMOTION:e=>`${e} ""`,_EMOTION:e=>`${e} ""`,__EMOTION:e=>`${e} ""`,__EMOTION:e=>`${e} ""`,_EMOTION:e=>`${e} ""`,__EMOTION:e=>`${e} ""`,_EMOTION:e=>`${e} ""`,__EMOTION:e=>`${e} ""`,_EMOTION:e=>`${e} ""`,__EMOTION:e=>`${e} ""`,_EMOTION:e=>`${e} ""`,__EMOTION:e=>`${e} ""`,_EMOTION:e=>`${e} ""`,__EMOTION:e=>`${e} ""`,_EMOTION:e=>`${e} ""`,_EMOTION:e=>`${e} ""`,_EMOTION:e=>`${e} ""`,_EMOTION:e=>`${e} "~"`,_EMOTION:e=>`${e} ""`,_EMOTION:e=>`${e} "~"`,_EMOTION:e=>`${e} ""`,_EMOTION:e=>`${e} ""`,_EMOTION:e=>`${e} ""`,_REASON:e=>`${e} ""`,__REASON:e=>`${e} ""`,_REASON:e=>`${e} ""`,__REASON:e=>`${e} ""`,__REASON:e=>`${e} ""`,_REASON:e=>`${e} ""`,__REASON:e=>`${e} ""`,_REASON:e=>`${e} ""`,_REASON:e=>`${e} ""`,_REASON:e=>`${e} ""`,_REASON:e=>`${e} "~"`,_REASON:e=>`${e} ""`,_REASON:e=>`${e} ""`,_REASON:e=>`${e} ""`,_REASON:e=>`${e} "~"`,_REASON:e=>`${e} ""`,_REASON:e=>`${e} ""`,_REASON:e=>`${e} ""`,_REASON:e=>`${e} ""`,_EMOTION:e=>`${e} ""`,_REASON:e=>`${e} ""`,_EMOTION:e=>`${e} ""`,_REASON:e=>`${e} ""`,_EMOTION:e=>`${e} ""`,_REASON:e=>`${e} ""`,_EMOTION:e=>`${e} ""`,_REASON:e=>`${e} ""`,_EMOTION:e=>`${e} ""`,_PROFIT:e=>`${e} ""`,_EMOTION:e=>`${e} ""`,_REASON:e=>`${e} ""`,_EMOTION:e=>`${e} ""`,_REASON:e=>`${e} ""`,_EMOTION:e=>`${e} ""`,_EMOTION:e=>`${e} ""`,_REASON:e=>`${e} ""`,_REASON:e=>`${e} ""`,_EMOTION:e=>`${e} ""`,default_PROFIT:e=>`${e} ""`,default_EMOTION:e=>`${e} ""`,default_REASON:e=>`${e} ""`};function Fj(e,t,n,s){var d;const o=`${t}_${n}_${s.id}`,i=fo[o];if(i)return i(e);const a=fo[`${t}_${s.id}`];if(a)return a(e);const l=fo[`${n}_${s.id}`];return l?l(e):((d=fo[`default_${s.id}`])==null?void 0:d.call(fo,e))||`${e} ""`}const fo={_PROFIT:e=>`${e} ""`,__PROFIT:e=>`${e} ""`,__PROFIT:e=>`${e} ""`,_PROFIT:e=>`${e} ""`,__PROFIT:e=>`${e} ""`,_PROFIT:e=>`${e} ""`,__PROFIT:e=>`${e} ""`,_PROFIT:e=>`${e} ""`,__PROFIT:e=>`${e} ""`,_PROFIT:e=>`${e} ""`,_REASON:e=>`${e} ""`,_PROFIT:e=>`${e} ""`,_PROFIT:e=>`${e} ""`,_PROFIT:e=>`${e} ""`,_PROFIT:e=>`${e} "~~"`,_PROFIT:e=>`${e} ""`,_PROFIT:e=>`${e} ""`,_PROFIT:e=>`${e} ""`,_PROFIT:e=>`${e} ""`,_PROFIT:e=>`${e} ""`,_PROFIT:e=>`${e} :""`,_PROFIT:e=>`${e} :""`,_PROFIT:e=>`${e} :"~"`,_EMOTION:e=>`${e} ""`,__EMOTION:e=>`${e} ""`,__EMOTION:e=>`${e} ""`,_EMOTION:e=>`${e} ""`,__EMOTION:e=>`${e} ""`,_EMOTION:e=>`${e} ""`,__EMOTION:e=>`${e} ""`,_EMOTION:e=>`${e} ""`,__EMOTION:e=>`${e} ""`,_EMOTION:e=>`${e} ""`,__EMOTION:e=>`${e} ""`,_EMOTION:e=>`${e} ""`,__EMOTION:e=>`${e} ""`,_EMOTION:e=>`${e} ""`,_EMOTION:e=>`${e} ""`,_EMOTION:e=>`${e} ""`,_EMOTION:e=>`${e} "~"`,_EMOTION:e=>`${e} ""`,_EMOTION:e=>`${e} ""`,_EMOTION:e=>`${e} ""`,_EMOTION:e=>`${e} ""`,_EMOTION:e=>`${e} ""`,_EMOTION:e=>`${e} ""`,_EMOTION:e=>`${e} "~"`,_REASON:e=>`${e} ""`,__REASON:e=>`${e} ""`,_REASON:e=>`${e} ""`,__REASON:e=>`${e} ""`,_REASON:e=>`${e} ""`,_REASON:e=>`${e} ""`,_REASON:e=>`${e} ""`,_REASON:e=>`${e} ""`,_REASON:e=>`${e} ""`,_EMOTION:e=>`${e} ""`,_REASON:e=>`${e} ""`,_REASON:e=>`${e} "~"`,_REASON:e=>`${e} ""`,_REASON:e=>`${e} ""`,_REASON:e=>`${e} ""`,_REASON:e=>`${e} ""`,_REASON:e=>`${e} ""`,_REASON:e=>`${e} :""`,_REASON:e=>`${e} "~"`,_PROFIT:e=>`${e} ""`,_REASON:e=>`${e} ""`,_PROFIT:e=>`${e} ""`,_REASON:e=>`${e} ""`,_EMOTION:e=>`${e} ""`,_REASON:e=>`${e} ""`,_PROFIT:e=>`${e} ""`,_EMOTION:e=>`${e} ""`,_EMOTION:e=>`${e} ""`,_PROFIT:e=>`${e} ""`,default_PROFIT:e=>`${e} ""`,default_EMOTION:e=>`${e} ""`,default_REASON:e=>`${e} ""`},Ai={NONE:{min:0,max:20,label:"",color:"#4caf50"},LOW:{min:21,max:40,label:"",color:"#8bc34a"},MEDIUM:{min:41,max:60,label:"",color:"#ff9800"},HIGH:{min:61,max:80,label:"",color:"#ff5722"},EXTREME:{min:81,max:100,label:"",color:"#f44336"}};function Hj(e=0){return e<=20?Ai.NONE:e<=40?Ai.LOW:e<=60?Ai.MEDIUM:e<=80?Ai.HIGH:Ai.EXTREME}function Wj(e,t,n){var u,p;const s=((u=e.relationship)==null?void 0:u.affection)||0;if(s<50)return 0;let i={CHAT:5,GIFT:10,SPAR:8,DUAL_CULTIVATION:30}[n]||5;s>=80?i*=2:s>=70?i*=1.5:s>=60&&(i*=1.2);const a=typeof e.personality=="object"&&e.personality!==null&&"label"in e.personality?e.personality.label:Array.isArray(e.personality)?e.personality[0]:"";return i*={:1.8,:1.6,:1.3,:.8,:1.1,:1.2}[a]||1,(((p=e.relationship)==null?void 0:p.jealousy)||0)>=60&&(i*=1.3),Math.floor(i)}function Uj(e,t,n,s){const o=[],a={CHAT:.12,GIFT:.18,SPAR:.15,DUAL_CULTIVATION:.08}[s]||.05;return n.forEach(l=>{var c;if(l.id===t.id||l.isDead)return;const d=((c=l.relationship)==null?void 0:c.affection)||0;if(d<50)return;let u=a;d>=80?u*=2:d>=70?u*=1.6:d>=60&&(u*=1.3);const p=typeof l.personality=="object"&&l.personality!==null&&"label"in l.personality?l.personality.label:Array.isArray(l.personality)?l.personality[0]:"";(p===""||p==="")&&(u*=1.3),Math.random()<u&&o.push(l)}),o}function Gj(e,t){var i,a;const n=((i=e.relationship)==null?void 0:i.affection)||0;if(n<70)return 0;const s=((a=e.relationship)==null?void 0:a.lastInteraction)||0;if(t-s>=3){let l=5;return n>=90?l=10:n>=80&&(l=8),l}return 0}function Vj(e,t){var l;const n=((l=e.relationship)==null?void 0:l.jealousy)||0;if(n===0)return 0;const s=2,o=typeof e.personality=="object"&&e.personality!==null&&"label"in e.personality?e.personality.label:Array.isArray(e.personality)?e.personality[0]:"",a=Math.floor(s*({:.5,:.6,:1.2,:1.5,:.8}[o]||1));return Math.min(a,n)}function Yj(e){const t=e.filter(a=>{var u,p;if(a.isDead)return!1;const l=((u=a.relationship)==null?void 0:u.jealousy)||0,d=((p=a.relationship)==null?void 0:p.affection)||0;return l>=60&&d>=70});if(t.length<2)return null;const i=Math.min(.2,.05+t.length*.05);return Math.random()<i?{type:"SHURA_FIELD",participants:t,triggerChance:i}:null}function qj(e,t){const n=t.name;t.gender;const s=[...e].sort((m,y)=>{var w,g;const S=((w=m.relationship)==null?void 0:w.jealousy)||0;return(((g=y.relationship)==null?void 0:g.jealousy)||0)-S}),o=s[0],i=s[1],a=s.slice(2),l=typeof o.personality=="object"&&o.personality!==null&&"label"in o.personality?o.personality.label:Array.isArray(o.personality)?o.personality[0]:"",d=typeof i.personality=="object"&&i.personality!==null&&"label"in i.personality?i.personality.label:Array.isArray(i.personality)?i.personality[0]:"";let u="";e.length===2?u=`

${o.name}${i.name}...`:u=`

${o.name}${i.name}${a.length>0?""+a.map(m=>m.name).join(""):""}...`;const p=[];l===""?p.push({speaker:o.name,text:`${n}...`}):l===""?p.push({speaker:o.name,text:`${n}`}):l===""?p.push({speaker:o.name,text:`${n}`}):p.push({speaker:o.name,text:`${n}${i.name}...`}),d===""?p.push({speaker:i.name,text:`${o.name}${n}...`}):d===""?p.push({speaker:i.name,text:`${o.name}${n}`}):d===""?p.push({speaker:i.name,text:`.........${n}...`}):p.push({speaker:i.name,text:`${n}`}),a.length>0&&p.push({speaker:a[0].name,text:`${n}`});const c=[{label:`${o.name}`,hint:`${o.name}`,effect:"FAVOR_NPC1"},{label:`${i.name}`,hint:`${i.name}`,effect:"FAVOR_NPC2"},{label:"",hint:"",effect:"MEDIATE"},{label:"",hint:"",effect:"HONEST"},{label:"",hint:"",effect:"AVOID"}];return{type:"SHURA_FIELD",participants:s,description:u,dialogues:p,options:c}}function $r(e,t,n,s={}){const o=typeof e.personality=="object"&&e.personality!==null&&"label"in e.personality?e.personality.label:Array.isArray(e.personality)?e.personality[0]:"";e.identity;const i=t.name,a=t.gender===""?"":"",l={:`...${i}${i}`,:`...${i}${a}${a}`,:`${i}...`,:`${i}.........`,:`${i}${a}...`,:`${i}...`,:`...${i}""...`,:`${i}......`,:`${i}${a}...`,:`...${i}${a}...`},d={:`${i}...${a}`,:`...${i}...`,:`${i}...${a}`,:`${i}.........`,:`${i}${a}${a}`,:`${i}...`,:`${i}...`,:`${i}...${a}`,:`...${i}...`},u={:`${i}${s.favoredName}...${a}...`,:`${i}${s.favoredName}`,:`${i}${a}...${a}`,:`${i}${s.favoredName}......`,:`${i}${s.favoredName}`,:`${i}......`,:`${i}${s.favoredName}...`,:`${i}...${a}${a}...`,:`${i}${a}${a}`,:`...${i}${s.favoredName}${a}${s.favoredGender===""?"":""}`},p={:`${i}...${a}`,:`${i}...${a}`,:`${i}...`,:`${i}...${a}...`,:`${i}${a}`,:`${i}...`,:`${i}...${a}...`,:`${i}...`},c={:`${i}${a}...${a}`,:`${i}...${a}`,:`${i}...${a}`,:`${i}${a}`,:`${i}${a}...${a}`},m={:`${i}${a}${a}...`,:`${i}${a}`,:`${i}...${a}`,:`${i}${a}${a}`,:`${i}...`,:`${i}...${a}${a}...`},y={:`${i}${a}...${a}`,:`${i}...`,:`${i}...${a}`,:`${i}...${a}...`,:`${i}${a}`,:`${i}......`,:`${i}...${a}...`,:`${i}...${a}...`,:`${i}${a}`,:`${i}...${a}`,:`${i}...${a}${a}...`};let S="";switch(n){case"trigger":S=l[o]||l.;break;case"favored":S=d[o]||d.;break;case"neglected":S=u[o]||u.;break;case"mediate":S=p[o]||p.;break;case"honest_understand":S=c[o]||c.;break;case"honest_angry":S=m[o]||m.;break;case"avoid":S=y[o]||y.;break}return S}function Kj(e,t,n){const s={changes:[],message:"",npcLogs:[]};switch(t.effect){case"FAVOR_NPC1":s.changes.push({npcId:e.participants[0].id,jealousyChange:-20,affectionChange:5}),s.changes.push({npcId:e.participants[1].id,jealousyChange:10,affectionChange:-5}),e.participants.slice(2).forEach(o=>{s.changes.push({npcId:o.id,jealousyChange:10,affectionChange:-3})}),s.message=`${e.participants[0].name}${e.participants[0].gender===""?"":""}...`,s.npcLogs.push({npcId:e.participants[0].id,content:$r(e.participants[0],n,"favored"),type:"DAILY",isSecret:!0}),s.npcLogs.push({npcId:e.participants[1].id,content:$r(e.participants[1],n,"neglected",{favoredName:e.participants[0].name,favoredGender:e.participants[0].gender}),type:"DAILY",isSecret:!0}),e.participants.slice(2).forEach(o=>{s.npcLogs.push({npcId:o.id,content:$r(o,n,"neglected",{favoredName:e.participants[0].name,favoredGender:e.participants[0].gender}),type:"DAILY",isSecret:!0})});break;case"FAVOR_NPC2":s.changes.push({npcId:e.participants[1].id,jealousyChange:-20,affectionChange:5}),s.changes.push({npcId:e.participants[0].id,jealousyChange:10,affectionChange:-5}),e.participants.slice(2).forEach(o=>{s.changes.push({npcId:o.id,jealousyChange:10,affectionChange:-3})}),s.message=`${e.participants[1].name}${e.participants[1].gender===""?"":""}...`,s.npcLogs.push({npcId:e.participants[1].id,content:$r(e.participants[1],n,"favored"),type:"DAILY",isSecret:!0}),s.npcLogs.push({npcId:e.participants[0].id,content:$r(e.participants[0],n,"neglected",{favoredName:e.participants[1].name,favoredGender:e.participants[1].gender}),type:"DAILY",isSecret:!0}),e.participants.slice(2).forEach(o=>{s.npcLogs.push({npcId:o.id,content:$r(o,n,"neglected",{favoredName:e.participants[1].name,favoredGender:e.participants[1].gender}),type:"DAILY",isSecret:!0})});break;case"MEDIATE":e.participants.forEach(o=>{s.changes.push({npcId:o.id,jealousyChange:-10,affectionChange:0})}),s.message="...",e.participants.forEach(o=>{s.npcLogs.push({npcId:o.id,content:$r(o,n,"mediate"),type:"DAILY",isSecret:!0})});break;case"HONEST":e.participants.forEach(o=>{var a;(((a=o.relationship)==null?void 0:a.jealousy)||0)>=80?s.changes.push({npcId:o.id,jealousyChange:5,affectionChange:-3}):s.changes.push({npcId:o.id,jealousyChange:-15,affectionChange:3})}),s.message="...",e.participants.forEach(o=>{var l;const a=(((l=o.relationship)==null?void 0:l.jealousy)||0)>=80?"honest_angry":"honest_understand";s.npcLogs.push({npcId:o.id,content:$r(o,n,a),type:"DAILY",isSecret:!0})});break;case"AVOID":e.participants.forEach(o=>{s.changes.push({npcId:o.id,jealousyChange:5,affectionChange:-8})}),s.message="...",e.participants.forEach(o=>{s.npcLogs.push({npcId:o.id,content:$r(o,n,"avoid"),type:"DAILY",isSecret:!0})});break}return s}const Lg={1:{relation:"",address:""},2:{relation:"",address:""},3:{relation:"",address:""},default:{relation:"",address:""}},Wy=(e={},t={})=>{const n=Math.max(1,(e==null?void 0:e.generation)||1);return{...Lg[n]||Lg.default,gender:"female",generation:n}},At={LETTER:"LETTER",OBITUARY:"OBITUARY",DEPARTURE:"DEPARTURE",ACHIEVEMENT:"ACHIEVEMENT"},Ys={PENDING:"PENDING",READY:"READY",READ:"READ"};function Uy({type:e,senderId:t,senderName:n,title:s,content:o="",timestamp:i,extras:a={},status:l=Ys.READY,replies:d=[]}){return{id:`msg_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,type:e,senderId:t,senderName:n,title:s,content:o,isRead:l===Ys.READ,status:l,timestamp:i,extras:a,createdAt:Date.now(),replies:d,lastRepliedAt:null}}class Qj{constructor(t=100,n=50){this.messages=[],this.maxMessages=t,this.maxLetters=n,this.recentContents=new Map}addMessage(t){if(t.type===At.LETTER&&t.senderId){if(this.recentContents.get(t.senderId)===t.content)return console.log(`[MessageManager] : ${t.senderName}`),!1;this.recentContents.set(t.senderId,t.content)}return this.messages.unshift(t),this.cleanup(),!0}addReplyToMessage(t,n){const s=this.messages.find(i=>i.id===t);if(!s)return null;const o={id:`reply_${Date.now()}_${Math.random().toString(36).substr(2,6)}`,content:n.content,tone:n.tone||"warm",toneLabel:n.toneLabel||"",sentiment:n.sentiment||"",timestamp:n.timestamp,from:n.from||"",affectionDelta:n.affectionDelta||0,createdAt:Date.now()};return Array.isArray(s.replies)||(s.replies=[]),s.replies.push(o),s.lastRepliedAt=o.timestamp,s.extras&&(s.extras.hasNpcRespondedToReply=!1),{message:s,reply:o}}markAsRead(t){const n=this.messages.find(s=>s.id===t);n&&(n.isRead=!0,n.status=Ys.READ)}getUnreadCount(){return this.messages.filter(t=>!t.isRead&&t.status===Ys.READY).length}getRecentRepliesForNpc(t,n=3){if(!t)return[];const s=[];return this.messages.forEach(o=>{o.senderId===t&&(!Array.isArray(o.replies)||o.replies.length===0||o.replies.forEach(i=>{s.push({messageId:o.id,messageTitle:o.title,content:i.content||"",tone:i.tone,toneLabel:i.toneLabel,timestamp:i.timestamp,createdAt:i.createdAt||0})}))}),s.sort((o,i)=>(i.createdAt||0)-(o.createdAt||0)),s.slice(0,n)}getMessagesByType(t){return this.messages.filter(n=>n.type===t)}getAllMessages(){return[...this.messages]}cleanup(){const t=this.messages.filter(s=>s.type===At.OBITUARY),n=this.messages.filter(s=>s.type!==At.OBITUARY);if(n.length>this.maxLetters){const s=n.slice(0,this.maxLetters);this.messages=[...t,...s]}this.messages.length>this.maxMessages&&(this.messages=this.messages.slice(0,this.maxMessages))}deleteMessage(t){this.messages=this.messages.filter(n=>n.id!==t)}loadFromData(t){this.messages=t||[]}toJSON(){return this.messages}}const $g={child:(e,t,n)=>{const s=e.age||0,o=Math.floor(s*12),i=e.sect&&e.sect.name,a=e.spouse!==null&&e.spouse!==void 0,l=e.tierTitle||"",{address:d}=Wy(e,t),u=d||t.name||"";let p="";if(o<216)i?p=`${e.sect.name}${l}`:p=`${l}`;else if(a&&i){const m=e.sect.name,y=e.spouse.name;p=`${m}${y}${l}`}else if(a){const m=e.spouse.name;p=`${m}${m}`}else i?p=`${e.sect.name}${l}`:p=`${l}`;const c=o<216?"":"";return`${u}

${p}

${e.name} ${c}
 ${n.year} ${n.month}`},spouse:(e,t,n)=>{var u,p,c,m,y;const s=((u=e.relationship)==null?void 0:u.affection)||60,o=((p=e.relationship)==null?void 0:p.jealousy)||0,i=((c=e.trait)==null?void 0:c.name)||"";let a=e.gender==="male"?"":"",l="";o>=60?i.includes("")||i.includes("")?l="...":i.includes("")?l="......":l="":s>=80?i.includes("")||i.includes("")?l="":i.includes("")||i.includes("")?l="...":i.includes("")?l="":l=`${e.tier||""}`:s>=50?l="":l="",(m=e.identity)!=null&&m.includes("")?l+=`

`:(y=e.identity)!=null&&y.includes("")&&(l+=`

`);const d=s>=70?"":"";return`${a}

${l}

${e.name} ${d}
 ${n.year} ${n.month}`},friend:(e,t,n)=>{var l,d;const s=((l=e.relationship)==null?void 0:l.affection)||50,o=((d=e.trait)==null?void 0:d.name)||"";let i="";s>=70?o.includes("")||o.includes("")?i="":o.includes("")||o.includes("")?i="":i="":i="";const a=s>=60?"":"";return`${t.name}

${i}

${e.name} ${a}
 ${n.year} ${n.month}`},default:(e,t,n)=>{var T,A,V,F,B;const s=typeof((T=e.relationship)==null?void 0:T.affection)=="number"?e.relationship.affection:typeof e.affection=="number"?e.affection:50,o=((A=e.trait)==null?void 0:A.name)||"",i=e.identity||"",a=e.tier||"",l=((V=e.sect)==null?void 0:V.name)||e.sect||"",d=(t==null?void 0:t.name)||"",u=((F=e.travelLog)==null?void 0:F.currentPlace)||((B=e.activity)==null?void 0:B.location)||e.currentResidence||l||"",p=s>=60?d:`${d}`,c=s>=85?"":s>=65?"":s>=45?"":"",y=`${u===""?"":`${u}`}${a}`,S=(()=>{const Y=[{keywords:[""],text:""},{keywords:["",""],text:""},{keywords:[""],text:""},{keywords:["",""],text:""},{keywords:[""],text:""},{keywords:[""],text:""},{keywords:["",""],text:""},{keywords:[""],text:""}].find(ne=>ne.keywords.some(X=>i.includes(X)));return Y?Y.text:""})(),E=(()=>{var ne;const $=(ne=e.memories)==null?void 0:ne.recentEvents;if(!Array.isArray($)||$.length===0)return"";const Y=$.slice(-2).map(X=>((X==null?void 0:X.description)||"").trim()).filter(Boolean);return Y.length===0?"":`${Y.join("")}`})(),w=(()=>{var ne;const $=(ne=e.memories)==null?void 0:ne.milestones;if(!Array.isArray($)||$.length===0)return"";const Y=$[$.length-1];return Y!=null&&Y.event?`${Y.event}`:""})(),g=s>=85?"":s>=65?"":s>=45?"":"",h=o.includes("")?"":o.includes("")||o.includes("")?"":o.includes("")||o.includes("")?"":o.includes("")?"":o.includes("")?"":o.includes("")||o.includes("")?"":o.includes("")?"":"",v=s>=70?"":s>=50?"":"",x=[c,y,S,E,w].filter(Boolean).join(""),I=[g,h,v].filter(Boolean).join(""),_=[x,I].filter($=>$&&$.trim().length>0).join(`

`),N=s>=80?"":s>=60?"":s>=45?"":"",C=(n==null?void 0:n.year)??"",j=(n==null?void 0:n.month)??"";return`${p}

${_}

${e.name} ${N}
 ${C} ${j}`}},Bg={child:(e,t,n)=>{const s=e.age||0,o=Math.floor(s*12),i=e.sect&&e.sect.name,a=e.spouse!==null&&e.spouse!==void 0,l=e.gender===""?e.motherName?"":"":e.fatherName?"":"";let d="";return o<216?d="......":a?d=`${e.spouse.name}/...`:i?d=`${e.sect.name}...`:d="...",`${l}

${d}

${e.name} 
 ${n.year} ${n.month}`},spouse:(e,t,n)=>{var l,d;const s=((l=e.trait)==null?void 0:l.name)||"",o=((d=e.relationship)==null?void 0:d.affection)||80,i=e.gender==="male"?"":"";let a="";return o>=90?s.includes("")||s.includes("")?a="......":s.includes("")||s.includes("")?a=".........":s.includes("")?a="......":a="...":o>=60?a="...":a="",`${i}

${a}

${e.name} 
 ${n.year} ${n.month}`},friend:(e,t,n)=>{var a,l;const s=((a=e.trait)==null?void 0:a.name)||"",o=((l=e.relationship)==null?void 0:l.affection)||60;let i="";return o>=70?s.includes("")||s.includes("")?i="":s.includes("")||s.includes("")?i="":i="":o>=40?i="":i="",`${t.name}

${i}

${e.name} 
 ${n.year} ${n.month}`},default:(e,t,n)=>{var i;const s=e.affection||((i=e.relationship)==null?void 0:i.affection)||50;let o="";return s>=60?o="":o="",`${t.name}

${o}

${e.name} 
 ${n.year} ${n.month}`}};async function Jj(e,t,n,s="default",o,i={}){var a,l,d,u,p,c,m,y,S,E;try{console.log(" []",{:e.name,ID:e.id,:s,:{fatherName:e.fatherName||"",motherName:e.motherName||"",generation:e.generation||""},children:((a=i.children)==null?void 0:a.some(re=>re.id===e.id))||!1,:t.name});let w="",g="",h="";const v=e.relationship||{},x=v.affection||0,I=v.jealousy||0,_=v.stage||0,N=v.cutTies||!1,C=((l=i.exiledChildren)==null?void 0:l.some(re=>re.id===e.id))||!1;let j="";if((u=(d=e.memories)==null?void 0:d.profile)!=null&&u.firstMeet){const re=new Date(e.memories.profile.firstMeet),Ce=Math.floor((new Date-re)/(365.25*24*60*60*1e3));Ce>0?j=`
${Ce}`:j=`
`}let T="",A="";x>=90?(T="",A=""):x>=70?(T="",A=""):x>=50?(T="",A=""):x>=30?(T="",A=""):(T="",A="");let V="";if(s!=="child"&&e.memories)try{const re=zy(e,{includeMilestones:!0,includeRecent:!0,maxRecent:5});re&&re.trim().length>0&&(V=`
`+re)}catch(re){console.warn(":",re)}let F="";const B=Array.isArray(i.replyHistory)?i.replyHistory:[];B.length>0&&(F=`

${B.map((ce,Ce)=>{const Ge=ce.timestamp,Ne=Ge&&Ge.year?` ${Ge.year} ${Ge.month}`:"",nt=ce.toneLabel||"",Le=(ce.content||"").replace(/\s+/g," ").trim(),z=Le.length>60?`${Le.slice(0,60)}`:Le||"";return`${Ce+1}. ${Ne}  ${nt}${z}`}).join(`
`)}
`);let $="";const Y=((p=e.trait)==null?void 0:p.name)||"";Y.includes("")?$="":Y.includes("")?$="":Y.includes("")?$="":Y.includes("")?$="":Y.includes("")?$="":Y.includes("")?$="":Y.includes("")?$="":Y.includes("")?$="":Y.includes("")?$="":Y.includes("")?$="":Y.includes("")?$="":Y.includes("")?$="":Y.includes("")?$="":Y.includes("")?$="":Y.includes("")?$="":Y.includes("")?$="":Y.includes("")?$="":Y.includes("")?$="":Y.includes("")?$="":Y.includes("")||Y.includes("")?$="":Y.includes("")?$="":$="";let ne="";const X=e.identity||"";X.includes("")?ne=`
`:X.includes("")?ne=`
`:X.includes("")||X.includes("")?ne=`
`:X.includes("")?ne=`
`:X.includes("")?ne=`
`:X.includes("")?ne=`
`:X.includes("")?ne=`
`:X.includes("")?ne=`
`:X.includes("")?ne=`
`:X.includes("")?ne=`
`:X.includes("")||X.includes("")?ne=`
`:X.includes("")?ne=`
`:X.includes("")||X.includes("")?ne=`
`:X.includes("")?ne=`
`:X.includes("")?ne=`
`:X.includes("")?ne=`
`:X.includes("")?ne=`
`:X.includes("")?ne=`
`:X.includes("")?ne=`
`:X.includes("")&&(ne=`
`);let ee="normal",ae="";switch(N||C?(ee="farewell",h=`

`,N&&(h+=`${t.name}`),C&&(h+="")):I>=80&&s!=="child"?(ee="jealous",h=`

${I}${t.name}

""""""""`):I>=60&&s!=="child"?(ee="normal",ae="slight_jealous",h=`

${I}`):x>=70&&s==="spouse"?(ee="missing",ae="longing",h=`

${x>=90?"":""}`):s==="spouse"&&Be?(ee="normal",ae="family"):s==="friend"?(ee="normal",ae="sharing"):(ee="normal",ae="general"),s){case"child":const re=Math.floor((e.age||0)*12),ce=((c=e.sect)==null?void 0:c.name)||e.sect||"",Ce=e.tierTitle||e.tier||"",Ge=e.spouse!==null&&e.spouse!==void 0,Ne=((m=e.spouse)==null?void 0:m.name)||"",nt=Math.max(1,e.generation||1),{relation:Le}=Wy(e,t),z=e.fatherName||e.motherName||"",ue=!!e.fatherName;let ve=`${e.name}${Math.floor(e.age||0)}${Ce}
${t.name}${Le}`;z&&z!==""&&(ve+=`
${z}${ue?"":""}`),ce&&(ve+=`
${ce}`),Ge&&(ve+=`
${Ne}`),w=ve,C?g=`${Le}`:re<216?g=`${Le}`:g=`${Le}`;break;case"spouse":w=`${t.name}${e.name}${e.tier||""}`,N?g="":ee==="jealous"?g="":g="";break;case"friend":if(e.fatherName||e.motherName||e.generation||e.parent||e.parentId||((y=t.children)==null?void 0:y.some(Ee=>Ee.id===e.id))){const Ee=(n.year-(e.birthYear||0))*12+(n.month-(e.birthMonth||1)),Ke=t.gender===""?"":"";w=`${t.name}${Math.floor(Ee/12)}`,Ee<216?g=""+Ke+"":g=""}else w=`${t.name}${e.name}${e.tier||""}`,N?g="":g="";break;default:w=`${e.name}${e.tier||""}${t.name}`,g=""}let Te="",Be=!1,ze="";if(_>=3&&s==="spouse"&&(Te+=`
`),i.dualCultivationCount>0&&s==="spouse"&&(Te+=`
${i.dualCultivationCount}`),i.children&&i.children.length>0){const re=i.children.filter(ce=>ce.fatherName===e.name||ce.motherName===e.name||s==="child"&&ce.parentId===e.id);if(re.length>0){Be=!0;const ce=re.map(Ce=>Ce.name).join("");if(s==="spouse")ze=`
${re.length}${ce}`,e.gender===""&&(ze+=`
${x>=80?"":x>=60?"":""}`);else if(s==="child"){const Ce=re.filter(Ge=>Ge.id!==e.id);Ce.length>0&&(ze=`
${Ce.length}${Ce.map(Ge=>Ge.name).join("")}`)}Te+=ze}}let W="";if(s==="child")W=`${e.name}${t.name}${ee==="farewell"?"":""}


${w}

${g?`
${g}`:""}

${F?`${F}
`:""}


- 
- ${e.name}
- ${t.name}${playerRelation}
- ${generation===1?"":generation===2?"":""}
- ${ee==="farewell"?"":""}
- 250
- """"""""""
- ${e.name} ${childAge<216?"":""}
 ${n.year} ${n.month}`;else{let re="";Be&&e.gender===""&&(re=""),W=`${e.name}${t.name}${ee==="farewell"?"":""}


${re}${t.name}


${w}
${e.identity||""}
${e.tier||""}
${e.sect?`${e.sect}`:""}


${((S=e.trait)==null?void 0:S.name)||""}${((E=e.trait)==null?void 0:E.description)||""}
${$}


${ne||""}


${x}${T}
${j}${Te}

${F}${V}${h}


1. 1-2""""
2. ${A}${g}
3. 120-180
4. 
   ${ee==="farewell"?"- //":ee==="jealous"?'- """"':ee==="missing"?"- ":ae==="slight_jealous"?`- 
   - `:ae==="family"?"- ":ae==="sharing"?"- ":`- 
   - `}
   ${Be&&ee!=="jealous"?"- ":""}
   ${ee!=="jealous"&&ee!=="farewell"?`- 
   - `:""}
5. 
6. "${e.name}\\n ${n.year} ${n.month}"`}const J=[{role:"system",content:W},{role:"user",content:s==="child"?`${e.name}${t.name}${ee==="farewell"?"":""} ${n.year} ${n.month}
          

1. """"""""
2. 
3. `:`${e.name}${t.name}${ee==="farewell"?"":ee==="jealous"?"":ee==="missing"?"":""} ${n.year} ${n.month}`}];return await Yc(J,o.apiKey,o.apiUrl||"https://api.deepseek.com/chat/completions",{model:o.apiModel||"deepseek-chat",temperature:.9,maxTokens:350})}catch(w){return console.error("AI:",w),jp(e,t,n,s)}}function jp(e,t,n,s="default"){var i;return s==="friend"&&(e.fatherName||e.motherName||e.generation||e.parent||e.parentId||(i=t.children)!=null&&i.some(l=>l.id===e.id))&&(s="child"),($g[s]||$g.default)(e,t,n)}function Xj(e,t,n,s="default"){var i;return s==="friend"&&(e.fatherName||e.motherName||e.generation||e.parent||e.parentId||(i=t.children)!=null&&i.some(l=>l.id===e.id))&&(s="child"),(Bg[s]||Bg.default)(e,t,n)}function Zj(e,t=3,n=null){var l,d,u,p,c,m;if(!e||e.acceptsLetters===!1)return!1;const s=typeof((l=e.relationship)==null?void 0:l.affection)=="number"?e.relationship.affection:void 0,o=typeof e.affection=="number"?e.affection:s;if(!e.isChild&&typeof o=="number"&&o<100||n&&((d=n.extras)==null?void 0:d.hasNpcRespondedToReply)===!0&&(!(n.replies&&n.replies.length>0)||n.extras.hasNpcRespondedToReply===!0)||t<3)return!1;let i=.3;const a=typeof o=="number"?o:0;return a>80?i+=.3:a>60?i+=.2:a>40&&(i+=.1),((u=e.traits)!=null&&u.includes("")||(p=e.traits)!=null&&p.includes(""))&&(i+=.2),((c=e.traits)!=null&&c.includes("")||(m=e.traits)!=null&&m.includes(""))&&(i-=.2),Math.random()<Math.max(.1,Math.min(.9,i))}function Gy(e,t){var n,s;return e.id===((n=t.spouse)==null?void 0:n.id)?"spouse":(s=t.children)!=null&&s.some(o=>o.id===e.id)||e.isChild===!0||e.fatherName||e.motherName||e.generation||e.parent||e.parentId?"child":e.affection>60?"friend":"default"}function e5(e,t,n){const s=Gy(e,t),o=Xj(e,t,n,s);let i="";return s==="child"?i=`${e.name}`:s==="spouse"?i=`${e.name}`:s==="friend"&&(i=`${e.name}`),Uy({type:At.OBITUARY,senderId:e.id,senderName:e.name,title:i,content:o,timestamp:{...n},extras:{npcId:e.id,relation:s,deathCause:e.deathCause||""},status:Ys.READY})}async function Og(e,t,n,s=!0,o={},i={}){const a=Gy(e,t),l=Array.isArray(i.replyHistory)?i.replyHistory:[],d=l[0],u=l.length>0,p=u&&((d==null?void 0:d.content)||"").replace(/\s+/g," ").trim().slice(0,40)||"";let c="";a==="child"?c="":a==="spouse"?c="":a==="friend"&&(c="");let m="";if(s)if(o.useAIForLetter&&o.apiKey&&o.apiKey.trim().length>0)try{m=await Jj(e,t,n,a,o,i)}catch(E){console.error("AI:",E),m=jp(e,t,n,a)}else m=jp(e,t,n,a);return Uy({type:At.LETTER,senderId:e.id,senderName:e.name,title:`${e.name}${c}`,content:m,timestamp:{...n},extras:{npcId:e.id,relation:a,...u?{isReplyToPlayer:!0,replySourceCount:l.length,replySourceTone:(d==null?void 0:d.toneLabel)||"",replySourceSnippet:p,replySourceTimestamp:(d==null?void 0:d.timestamp)||null,hasNpcRespondedToReply:!0}:{}},status:s?Ys.READY:Ys.PENDING})}const Ni=[{id:"warm",label:"",desc:"",affectionDelta:5},{id:"calm",label:"",desc:"",affectionDelta:3},{id:"firm",label:"",desc:"",affectionDelta:-2}],t5=({isOpen:e,onClose:t,messages:n,onMarkAsRead:s,onDeleteMessage:o,onSendReply:i})=>{var A,V,F;const[a,l]=b.useState(null),[d,u]=b.useState("all"),[p,c]=b.useState(""),[m,y]=b.useState(Ni[0].id),[S,E]=b.useState(!1),[w,g]=b.useState(null),h=b.useMemo(()=>{const B=Array.isArray(n)?n:[];return d==="all"?B:d==="letter"?B.filter($=>$.type===At.LETTER||$.type===At.DEPARTURE||$.type===At.ACHIEVEMENT):d==="obituary"?B.filter($=>$.type===At.OBITUARY):B},[n,d]),v=b.useMemo(()=>h.find(B=>B.id===a),[h,a]);b.useEffect(()=>{c(""),y(Ni[0].id),g(null)},[a]);const x=B=>{l(B.id),B.isRead||s(B.id)},I=()=>{l(null),t()};b.useEffect(()=>{const B=$=>{$.key==="Escape"&&I()};return window.addEventListener("keydown",B),()=>window.removeEventListener("keydown",B)},[I]);const _=B=>{if(!B)return"";if(typeof B=="object"&&B.year)return` ${Math.floor(B.year)}${B.month}`;const $=new Date(B);return Number.isNaN($.getTime())?"":`${$.getFullYear()}${$.getMonth()+1}${$.getDate()}`},N=v&&v.type!==At.OBITUARY&&typeof i=="function",C=async()=>{var Y;if(!N)return;const B=p.trim();if(!B){g("");return}const $=Ni.find(ne=>ne.id===m)||Ni[0];E(!0);try{const ne=await Promise.resolve(i({messageId:v.id,targetNpcId:v.senderId,relation:(Y=v.extras)==null?void 0:Y.relation,content:B,tone:$}));ne&&ne.success?(c(""),g(""),setTimeout(()=>g(null),1800)):g((ne==null?void 0:ne.error)||"")}finally{E(!1)}},j=B=>{switch(B){case At.OBITUARY:return"";case At.LETTER:return"";case At.DEPARTURE:return"";case At.ACHIEVEMENT:return"";default:return""}},T=B=>B===At.OBITUARY?"message-background-obituary":"message-background-letter";return e?r.jsx("div",{className:"message-center-overlay",onClick:I,children:r.jsxs("div",{className:"message-center-modal",onClick:B=>B.stopPropagation(),children:[r.jsxs("div",{className:"message-center-header",children:[r.jsx("h2",{children:" "}),r.jsx("button",{className:"close-btn",onClick:I,children:""})]}),r.jsxs("div",{className:"message-filters",children:[r.jsxs("button",{className:`filter-btn ${d==="all"?"active":""}`,onClick:()=>u("all"),children:[" (",n.length,")"]}),r.jsxs("button",{className:`filter-btn ${d==="letter"?"active":""}`,onClick:()=>u("letter"),children:[" (",n.filter(B=>B.type!==At.OBITUARY).length,")"]}),r.jsxs("button",{className:`filter-btn ${d==="obituary"?"active":""}`,onClick:()=>u("obituary"),children:[" (",n.filter(B=>B.type===At.OBITUARY).length,")"]}),n.some(B=>!B.isRead)&&r.jsx("button",{className:"filter-btn mark-all-read-btn",onClick:()=>{n.forEach(B=>{B.isRead||s(B.id)})},style:{marginLeft:"auto",background:"#7AA893",color:"white"},children:" "})]}),r.jsxs("div",{className:"message-center-content",children:[r.jsx("div",{className:"message-list",children:h.length===0?r.jsxs("div",{className:"empty-message",children:[r.jsx("p",{children:""}),r.jsx("p",{children:""})]}):h.map(B=>{var $,Y;return r.jsxs("div",{className:`message-item ${a===B.id?"selected":""} ${B.isRead?"":"unread"} ${B.type===At.OBITUARY?"obituary":""}`,onClick:()=>x(B),children:[!B.isRead&&r.jsx("span",{className:"unread-dot"}),r.jsx("div",{className:"message-avatar",children:B.type===At.OBITUARY?"":""}),r.jsxs("div",{className:"message-info",children:[r.jsxs("div",{className:"message-sender",children:[B.senderName,r.jsx("span",{className:"message-type-label",children:j(B.type)}),(($=B.extras)==null?void 0:$.isReplyToPlayer)&&r.jsx("span",{className:"message-reply-badge",children:""}),((Y=B.replies)==null?void 0:Y.length)>0&&r.jsxs("span",{className:"message-replied-flag",children:["",B.replies.length]})]}),r.jsx("div",{className:"message-title",children:B.title}),r.jsxs("div",{className:"message-time",children:[" ",B.timestamp.year," ",B.timestamp.month,""]})]})]},B.id)})}),r.jsx("div",{className:`message-reader ${v?T(v.type):""}`,children:v?r.jsxs("div",{className:"reader-content",children:[r.jsxs("div",{className:"reader-header",children:[r.jsx("h3",{children:v.title}),r.jsxs("div",{className:"reader-meta",children:[r.jsx("span",{children:v.senderName}),r.jsx("span",{children:""}),r.jsxs("span",{children:[" ",v.timestamp.year," ",v.timestamp.month,""]})]})]}),r.jsx("div",{className:"reader-body",children:v.content?r.jsx("pre",{className:"message-content",children:v.content}):r.jsx("p",{className:"content-loading",children:"..."})}),((A=v.extras)==null?void 0:A.isReplyToPlayer)&&r.jsxs("div",{className:"reply-context-banner",children:[r.jsxs("div",{children:[" ",((V=v.extras)==null?void 0:V.replySourceTimestamp)&&r.jsx("span",{className:"reply-context-time",children:_(v.extras.replySourceTimestamp)})]}),((F=v.extras)==null?void 0:F.replySourceSnippet)&&r.jsxs("div",{className:"reply-context-snippet",children:["",v.extras.replySourceSnippet,""]})]}),v.replies&&v.replies.length>0&&r.jsxs("div",{className:"reply-thread",children:[r.jsx("h4",{children:" "}),r.jsx("div",{className:"reply-list",children:v.replies.map(B=>r.jsxs("div",{className:"reply-entry",children:[r.jsxs("div",{className:"reply-meta",children:[r.jsx("span",{children:B.from||""}),B.toneLabel&&r.jsx("span",{className:"reply-tone-label",children:B.toneLabel}),r.jsx("span",{children:_(B.timestamp)})]}),r.jsx("pre",{className:"reply-content",children:B.content})]},B.id))})]}),r.jsx("div",{className:"reader-actions",children:v.type===At.OBITUARY?r.jsxs(r.Fragment,{children:[r.jsx("button",{className:"action-btn secondary",children:" "}),r.jsx("button",{className:"action-btn danger",onClick:()=>{window.showConfirm&&window.showConfirm("",()=>{o(v.id),l(null)})},children:""})]}):r.jsx(r.Fragment,{children:r.jsx("button",{className:"action-btn",onClick:()=>{o(v.id),l(null)},children:""})})}),N&&r.jsxs("div",{className:"reply-composer",children:[r.jsxs("h4",{children:["  ",v.senderName]}),r.jsx("div",{className:"reply-tone-options",children:Ni.map(B=>r.jsxs("button",{type:"button",className:`tone-btn ${m===B.id?"active":""}`,onClick:()=>y(B.id),children:[r.jsx("div",{className:"tone-header",children:r.jsx("span",{children:B.label})}),r.jsx("p",{children:B.desc})]},B.id))}),r.jsx("textarea",{className:"reply-input",placeholder:"120",maxLength:120,value:p,onChange:B=>c(B.target.value)}),r.jsxs("div",{className:"reply-actions",children:[w&&r.jsx("span",{className:"reply-feedback",children:w}),r.jsx("button",{type:"button",className:"action-btn primary",onClick:C,disabled:S,children:S?"...":""})]})]})]}):r.jsxs("div",{className:"reader-placeholder",children:[r.jsx("p",{children:""}),r.jsx("p",{children:""})]})})]})]})}):null},n5="cultivation_save_v1_slot_",r5="cultivation_autosave_",Wl=5,qc=3,fu=100,Pg=20;let ys=!1,Wi=!1;const Kc=()=>{try{const e="__localStorage_test__";return localStorage.setItem(e,"test"),localStorage.removeItem(e),!0}catch(e){return console.error("localStorage :",e),!1}},Vy=()=>(ys=Fb(),console.log(ys?" TapTap ":"  TapTap "),ys),zs=e=>`${r5}${e}`,Zo=(e=1)=>`${n5}${e}`,Yy=e=>new Blob([JSON.stringify(e)]).size/1024,qy=()=>{let e=0;for(let t in localStorage)localStorage.hasOwnProperty(t)&&(e+=localStorage[t].length+t.length);return{used:(e/1024).toFixed(2),usedMB:(e/1024/1024).toFixed(2)}},Cp=e=>!e||typeof e!="object"?e:_p(e),Ul=e=>Array.isArray(e)?e.map(t=>Cp(t)):e,s5=e=>{if(!e||typeof e!="object")return e;const t=Cp(e);return Array.isArray(e.worldNpcs)&&(t.worldNpcs=Ul(e.worldNpcs)),e.rival&&(t.rival=Cp(e.rival)),Array.isArray(e.spouses)&&(t.spouses=Ul(e.spouses)),Array.isArray(e.followers)&&(t.followers=Ul(e.followers)),Array.isArray(e.generation3Plus)?t.generation3Plus=e.generation3Plus:t.generation3Plus=[],t},Ec=e=>{if(!e||typeof e!="object")return e;const t={...e};return t.player=s5(e.player),["activeNpcs","children","deadNpcs","worldNpcs"].forEach(n=>{Array.isArray(e[n])&&(t[n]=Ul(e[n]))}),Array.isArray(t.inventory)||(console.warn(" "),t.inventory=[]),t},Ky=e=>{let t={...e};return t=oh(t),t.logs&&t.logs.length>fu&&(console.log(` ${t.logs.length} -> ${fu}`),t.logs=t.logs.slice(0,fu)),t.activeNpcs&&(t.activeNpcs=t.activeNpcs.map(n=>n.logs&&n.logs.length>Pg?{...n,logs:n.logs.slice(-Pg)}:n)),t.deadNpcs&&(t.deadNpcs=t.deadNpcs.map(n=>({id:n.id,name:n.name,deathYear:n.deathYear,deathReason:n.deathReason}))),t.messages&&Object.keys(t.messages).forEach(n=>{const s=t.messages[n];s&&s.length>30&&(t.messages[n]=s.slice(-30))}),t.player&&Array.isArray(t.player.generation3Plus)&&(t.player.generation3Plus=t.player.generation3Plus.map(n=>({id:n.id,generation:n.generation,birthYear:n.birthYear,parentGeneration:n.parentGeneration}))),t},Qy=(e,t=1)=>{var n,s,o,i,a,l;if(!Kc())return{success:!1,error:"STORAGE_UNAVAILABLE",message:"localStorage "};try{const d=Ky(e),u=((s=(n=d.player)==null?void 0:n.time)==null?void 0:s.year)||((o=d.player)==null?void 0:o.age)||3572,p=((a=(i=d.player)==null?void 0:i.time)==null?void 0:a.month)||((l=d.player)==null?void 0:l.month)||1,c={...d,timestamp:Date.now(),saveDate:new Date().toLocaleString(),slotNumber:t,gameTime:` ${u} ${p}`,year:u,month:p},m=JSON.stringify(c),y=Yy(c);return console.log(`: ${y.toFixed(2)} KB`),y>5120?(console.warn(""),{success:!1,error:"STORAGE_TOO_LARGE",size:y.toFixed(2)}):(localStorage.setItem(Zo(t),m),ys&&!Wi&&(Wi=!0,ih(t,c).then(S=>{console.log(`  [${t}]:`,S.action),Wi=!1}).catch(S=>{console.warn(`  [${t}]:`,S.message),Wi=!1})),{success:!0,time:c.saveDate,slot:t,size:y.toFixed(2)})}catch(d){return console.error("Save failed:",d),d.name==="QuotaExceededError"||d.code===22?{success:!1,error:"QUOTA_EXCEEDED",message:""}:{success:!1,error:d.name||"UNKNOWN_ERROR",message:d.message}}},Po=(e=1)=>{try{const t=localStorage.getItem(Zo(e));if(!t)return null;const n=JSON.parse(t);return Ec(n)}catch(t){return console.error("Load failed:",t),null}},Of=async(e=1)=>{if(!ys)return console.log(""),Po(e);try{const t=Po(e),n=(t==null?void 0:t.timestamp)||0,s=await Hb(e,n);if(!s)return console.log(` [${e}]`),t;console.log(` [${e}]...`);const o=await Wb(s.uuid,s.fileId,e);if(o){const i=Ec(o);return localStorage.setItem(Zo(e),JSON.stringify(i)),console.log(`  [${e}]`),i}return Ec(o)}catch(t){return console.error(` [${e}]:`,t),console.log(""),Po(e)}},Pf=()=>{var t,n;const e=[];if(!Kc()){console.warn("localStorage ");for(let s=1;s<=Wl;s++)e.push({slot:s,exists:!1,error:"localStorage"});return e}try{for(let s=1;s<=Wl;s++){const o=Zo(s),i=localStorage.getItem(o);if(i)try{const a=JSON.parse(i);e.push({slot:s,exists:!0,saveDate:a.saveDate||"",playerName:((t=a.player)==null?void 0:t.name)||"",cultivation:((n=a.player)==null?void 0:n.cultivation)||0,timestamp:a.timestamp||0})}catch(a){console.error(` ${s} :`,a),e.push({slot:s,exists:!1})}else e.push({slot:s,exists:!1})}}catch(s){console.error(":",s);for(let o=1;o<=Wl;o++)e.push({slot:o,exists:!1})}return e},Jy=(e=1)=>{localStorage.removeItem(Zo(e))},o5=()=>{for(let e=1;e<=Wl;e++)localStorage.removeItem(Zo(e));for(let e=1;e<=qc;e++)localStorage.removeItem(zs(e))},Xy=e=>{var t,n,s,o,i,a;if(!Kc())return console.warn("localStorage "),{success:!1,error:"STORAGE_UNAVAILABLE"};try{const l=Ky(e),d=((n=(t=l.player)==null?void 0:t.time)==null?void 0:n.year)||Math.floor(((s=l.player)==null?void 0:s.age)||0)||3572,u=((i=(o=l.player)==null?void 0:o.time)==null?void 0:i.month)||1,p=Math.floor(((a=l.player)==null?void 0:a.age)||0),c={...l,player:{...l.player,age:p},timestamp:Date.now(),saveDate:new Date().toLocaleString(),isAutoSave:!0,gameTime:` ${d} ${u}`,year:d,month:u},m=JSON.stringify(c),y=Yy(c);if(y>4096)return console.warn(""),{success:!1,error:"STORAGE_TOO_LARGE"};for(let S=qc;S>1;S--){const E=zs(S-1),w=localStorage.getItem(E);w&&localStorage.setItem(zs(S),w)}return localStorage.setItem(zs(1),m),console.log(`  [ ${d} ${u}] : ${y.toFixed(2)} KB`),l.logs&&console.log(` :  ${l.logs.length||0} `),{success:!0,time:c.saveDate,gameTime:c.gameTime,size:y.toFixed(2)}}catch(l){return console.error(":",l),{success:!1,error:l.message}}},Zy=()=>{var t,n,s,o;const e=[];if(!Kc())return console.warn("localStorage "),e;try{for(let i=1;i<=qc;i++){const a=zs(i),l=localStorage.getItem(a);if(l)try{const d=JSON.parse(l);e.push({slot:i,exists:!0,saveDate:d.saveDate||"",gameTime:d.gameTime||"",year:d.year||0,month:d.month||0,playerName:((t=d.player)==null?void 0:t.name)||"",cultivation:((n=d.player)==null?void 0:n.cultivation)||0,age:Math.floor(((s=d.player)==null?void 0:s.age)||0),tier:((o=d.player)==null?void 0:o.tierTitle)||""})}catch(d){console.error(` ${i} :`,d),e.push({slot:i,exists:!1,error:""})}else e.push({slot:i,exists:!1})}}catch(i){console.error(":",i)}return e},e1=(e=1)=>{try{const t=localStorage.getItem(zs(e));if(!t)return null;const n=JSON.parse(t);return console.log(` [${e}]: ${n.gameTime}`),Ec(n)}catch(t){return console.error(` ${e} :`,t),null}},t1=()=>{for(let e=1;e<=qc;e++)localStorage.removeItem(zs(e));console.log("")},n1=async(e=1)=>{if(!ys)throw new Error("");const t=Po(e);if(!t)throw new Error(` ${e} `);return await ih(e,t)},r1=async(e=1)=>{if(!ys)throw new Error("");const t=await Of(e);if(!t)throw new Error("");return t},s1=()=>({enabled:ys,syncing:Wi}),i5=Object.freeze(Object.defineProperty({__proto__:null,autoSaveGame:Xy,clearAllAutoSaves:t1,clearAllSaves:o5,clearSave:Jy,getAllAutoSaves:Zy,getAllSaveSlots:Pf,getCloudSaveStatus:s1,getStorageInfo:qy,initCloudSaveSystem:Vy,loadAutoSave:e1,loadGameFromCloud:Of,loadGameFromStorage:Po,manualDownloadFromCloud:r1,manualUploadToCloud:n1,saveGameToStorage:Qy},Symbol.toStringTag,{value:"Module"})),a5=({onFinish:e,onLoadGame:t})=>{const[n,s]=b.useState(0),[o,i]=b.useState([]),[a,l]=b.useState(!1);b.useEffect(()=>{const p=Pf();i(p)},[]);const d=[{text:"",sub:""},{text:"",sub:""},{text:"",sub:""},{text:"",sub:"..."},{text:"",sub:`

`}],u=o.some(p=>p.exists);return a?r.jsxs(r.Fragment,{children:[r.jsx("div",{style:zt.overlay}),r.jsxs("div",{style:zt.container,children:[r.jsx("h2",{style:{color:"#d4af37",marginBottom:"clamp(15px, 4vw, 30px)",fontSize:"clamp(18px, 5vw, 24px)"},children:""}),r.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"clamp(10px, 2vw, 15px)",width:"100%",maxWidth:"500px",marginBottom:"10px"},children:o.map(p=>r.jsxs("div",{style:{...zt.slotCard,opacity:p.exists?1:.5,cursor:p.exists?"pointer":"not-allowed"},onClick:()=>{p.exists&&t(p.slot)},children:[r.jsxs("div",{style:zt.slotHeader,children:[r.jsxs("span",{style:zt.slotTitle,children:[" ",p.slot]}),p.exists&&r.jsx("span",{style:zt.slotBadge,children:""})]}),p.exists?r.jsxs("div",{style:{fontSize:"clamp(11px, 2.8vw, 13px)",color:"#ccc",marginTop:"8px",lineHeight:"1.5"},children:[r.jsxs("div",{children:[": ",p.playerName]}),p.cultivation>0&&r.jsxs("div",{children:[": ",p.cultivation," "]}),r.jsxs("div",{style:{fontSize:"clamp(10px, 2.5vw, 12px)",marginTop:"4px",opacity:.8},children:[": ",p.saveDate]})]}):r.jsx("div",{style:{fontSize:"clamp(12px, 3vw, 13px)",color:"#999",marginTop:"8px"},children:""})]},p.slot))}),r.jsx("button",{onClick:()=>l(!1),style:{...zt.btn,background:"#666",marginTop:"clamp(10px, 2vw, 20px)",width:"clamp(150px, 40vw, 200px)",padding:"clamp(10px, 2.5vw, 12px)",minHeight:"auto"},children:" "})]})]}):n<d.length?r.jsxs(r.Fragment,{children:[r.jsx("div",{style:zt.overlay,onClick:()=>s(n+1)}),r.jsxs("div",{style:zt.container,children:[r.jsx("h1",{style:zt.title,children:d[n].text}),r.jsx("p",{style:zt.sub,children:d[n].sub}),u&&n===0&&r.jsx("button",{onClick:p=>{p.stopPropagation(),l(!0)},style:{...zt.btn,background:"#4caf50",marginBottom:"clamp(15px, 3vw, 20px)",width:"clamp(160px, 45vw, 200px)",textAlign:"center",border:"2px solid #45a049",minHeight:"auto",padding:"clamp(10px, 2.5vw, 12px)"},children:" "}),r.jsx("div",{style:zt.tip,children:"[  ]"}),r.jsx("button",{onClick:()=>s(n+1),style:zt.continueBtn,children:" "})]})]}):r.jsxs(r.Fragment,{children:[r.jsx("div",{style:zt.overlay}),r.jsxs("div",{style:zt.container,children:[r.jsx("h2",{style:{color:"#d4af37",marginBottom:"clamp(20px, 5vw, 30px)",fontSize:"clamp(20px, 5vw, 28px)"},children:""}),r.jsx("p",{style:zt.sub,children:"..."}),r.jsx("button",{style:{...zt.continueBtn,background:"#d4af37",fontSize:"clamp(15px, 4vw, 18px)",padding:"clamp(12px, 3vw, 15px) clamp(30px, 8vw, 40px)",marginTop:"clamp(15px, 4vw, 25px)"},onClick:()=>e(),children:" "})]})]})},zt={overlay:{position:"fixed",top:0,left:0,width:"100%",height:"100%",background:"rgba(0, 0, 0, 0.85)",zIndex:2499,backdropFilter:"blur(8px)"},container:{position:"fixed",top:"50%",left:"50%",transform:"translate(-50%, -50%)",width:"90%",maxWidth:"600px",maxHeight:"90vh",background:"linear-gradient(135deg, #1a1a1a 0%, #2d2d2d 100%)",color:"white",display:"flex",flexDirection:"column",justifyContent:"flex-start",alignItems:"center",zIndex:2500,padding:"clamp(15px, 4vw, 30px)",textAlign:"center",overflowY:"auto",overflowX:"hidden",borderRadius:"clamp(8px, 2vw, 16px)",boxShadow:"0 20px 60px rgba(0, 0, 0, 0.8)",border:"2px solid rgba(211, 47, 47, 0.5)",WebkitOverflowScrolling:"touch"},title:{fontSize:"clamp(18px, 5vw, 32px)",marginBottom:"clamp(12px, 3vw, 20px)",animation:"fadeIn 1s",lineHeight:"1.3",wordBreak:"break-word"},sub:{fontSize:"clamp(13px, 3.5vw, 16px)",color:"#ccc",lineHeight:"1.6",maxWidth:"100%",animation:"slideUp 1s",padding:"0 5px",wordBreak:"break-word",marginBottom:"clamp(10px, 2vw, 15px)"},tip:{fontSize:"clamp(10px, 2.5vw, 12px)",color:"#888",marginTop:"clamp(8px, 2vw, 10px)",marginBottom:"5px"},continueBtn:{padding:"clamp(8px, 2vw, 10px) clamp(20px, 5vw, 30px)",background:"#d32f2f",border:"none",color:"#fff",borderRadius:"clamp(6px, 1.5vw, 8px)",cursor:"pointer",fontSize:"clamp(13px, 3vw, 14px)",fontWeight:"bold",transition:"all 0.3s",marginTop:"clamp(10px, 2vw, 15px)",minHeight:"40px",width:"auto"},btn:{padding:"clamp(12px, 3vw, 15px) clamp(10px, 2vw, 12px)",background:"#1a1a1a",border:"2px solid #666",color:"#fff",borderRadius:"clamp(8px, 2vw, 12px)",cursor:"pointer",textAlign:"center",transition:"all 0.3s",fontSize:"clamp(12px, 3vw, 15px)",lineHeight:"1.5",whiteSpace:"normal",wordWrap:"break-word",minHeight:"clamp(50px, 12vw, 70px)",display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",gap:"6px",width:"100%"},slotCard:{background:"rgba(255, 255, 255, 0.05)",padding:"clamp(12px, 3vw, 15px)",borderRadius:"clamp(6px, 1.5vw, 8px)",border:"2px solid rgba(255, 255, 255, 0.1)",transition:"all 0.3s",marginBottom:"8px"},slotHeader:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"8px",flexWrap:"wrap",gap:"5px"},slotTitle:{fontSize:"clamp(14px, 3.5vw, 16px)",fontWeight:"bold",color:"#d4af37"},slotBadge:{fontSize:"clamp(16px, 4vw, 18px)",color:"#4caf50"}},l5=({onConfirm:e,onExit:t})=>{const[n,s]=b.useState("warning"),[o,i]=b.useState(!1),a=()=>{const d=` 


 bug


 
/

 
1. ""
2. " "
3. " "
4. 

 
1. ""
2. " "
3. 
   -  
   -  
   -  
4. 

 
- 
- 50000 10 10 

 
1. 
2. Base64
3. 
4. 

`;navigator.clipboard.writeText(d).then(()=>{i(!0),setTimeout(()=>i(!1),2e3)}).catch(()=>{const u=document.createElement("textarea");u.value=d,document.body.appendChild(u),u.select(),document.execCommand("copy"),document.body.removeChild(u),i(!0),setTimeout(()=>i(!1),2e3)})},l={overlay:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0, 0, 0, 0.7)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:9999,padding:"20px"},container:{background:"linear-gradient(135deg, #f5ecd5 0%, #e0c9a6 100%)",borderRadius:"28px 28px 22px 22px/36px 36px 18px 18px",border:"2.5px solid #bfa76a",color:"#5b4322",boxShadow:"0 12px 48px rgba(191, 167, 106, 0.18)",maxWidth:"600px",width:"100%",maxHeight:"80vh",display:"flex",flexDirection:"column",overflow:"hidden"},header:{padding:"20px",borderBottom:"1px solid #d4af37",background:"linear-gradient(90deg, #f5ecd5 60%, #e0c9a6 100%)",textAlign:"center"},warningBanner:{backgroundColor:"#ff6b6b",color:"#fff",padding:"8px 16px",borderRadius:"12px",marginBottom:"12px",fontSize:"13px",fontWeight:"bold",display:"inline-block",letterSpacing:"0.5px",boxShadow:"0 4px 12px rgba(255, 107, 107, 0.3)"},title:{fontSize:"24px",fontWeight:"bold",color:"#a67c2d",margin:0,marginBottom:"5px"},subtitle:{fontSize:"14px",color:"#8c6b3b",margin:0},tabs:{display:"flex",borderBottom:"1px solid #d4af37",padding:"0 20px",gap:"20px",backgroundColor:"#f5ecd5",justifyContent:"center"},tab:{padding:"10px 28px",cursor:"pointer",fontSize:"15px",color:"#8c6b3b",border:"none",borderRadius:"18px 18px 0 0/22px 22px 0 0",background:"linear-gradient(90deg, #f5ecd5 60%, #e0c9a6 100%)",marginBottom:"-1px",boxShadow:"0 2px 8px rgba(191,167,106,0.08)",transition:"all 0.3s",outline:"none",fontWeight:500,borderBottom:"2.5px solid transparent"},tabActive:{color:"#a67c2d",background:"linear-gradient(90deg, #f9f5e6 60%, #f3e2c2 100%)",borderBottom:"2.5px solid #a67c2d",boxShadow:"0 4px 16px rgba(191,167,106,0.13)",fontWeight:700},content:{flex:1,overflowY:"auto",padding:"28px 24px",fontSize:"15px",lineHeight:"1.7",background:"linear-gradient(135deg, #fffbe9 0%, #f5ecd5 100%)",color:"#181818",borderRadius:"18px",boxShadow:"0 2px 12px rgba(191,167,106,0.10)",border:"1.5px solid #e0c9a6",margin:"18px 0 0 0"},section:{marginBottom:"15px"},sectionTitle:{color:"#d4af37",fontWeight:"bold",marginBottom:"8px",fontSize:"16px"},warningBox:{backgroundColor:"rgba(191, 167, 106, 0.13)",borderLeft:"4px solid #bfa76a",padding:"14px",borderRadius:"10px",marginBottom:"14px",color:"#7c5c2a",fontWeight:500},infoBox:{backgroundColor:"rgba(191, 167, 106, 0.09)",borderLeft:"4px solid #a67c2d",padding:"14px",borderRadius:"10px",marginBottom:"14px",color:"#5b4322",fontWeight:500},list:{marginLeft:"20px",marginTop:"8px"},listItem:{marginBottom:"6px",color:"#181818"},guide:{backgroundColor:"#fffbe9",border:"1px solid #e0c9a6",borderRadius:"10px",padding:"14px",fontSize:"14px",lineHeight:"1.7",color:"#181818",maxHeight:"300px",overflowY:"auto",marginBottom:"14px",whiteSpace:"pre-wrap",wordBreak:"break-word"},footer:{display:"flex",gap:"12px",padding:"20px",borderTop:"1px solid #333",justifyContent:"flex-end"},button:{padding:"10px 20px",borderRadius:"4px",border:"none",fontSize:"14px",fontWeight:"bold",cursor:"pointer",transition:"all 0.3s"},buttonPrimary:{backgroundColor:"#a67c2d",color:"#fff",minWidth:"120px"},buttonSecondary:{backgroundColor:"#e0c9a6",color:"#7c5c2a",border:"1px solid #d4af37"},buttonWarning:{backgroundColor:"#bfa76a",color:"#fff"},buttonCopy:{backgroundColor:o?"#bfa76a":"#e0c9a6",color:o?"#fff":"#7c5c2a",border:`1.5px solid ${o?"#bfa76a":"#a67c2d"}`,width:"100%"}};return r.jsx("div",{style:l.overlay,children:r.jsxs("div",{style:l.container,children:[r.jsxs("div",{style:l.header,children:[r.jsx("div",{style:l.warningBanner,children:" "}),r.jsx("h1",{style:l.title,children:" "}),r.jsx("p",{style:l.subtitle,children:""})]}),r.jsxs("div",{style:l.tabs,children:[r.jsx("button",{style:{...l.tab,...n==="warning"?l.tabActive:{}},onClick:()=>s("warning"),children:""}),r.jsx("button",{style:{...l.tab,...n==="guide"?l.tabActive:{}},onClick:()=>s("guide"),children:""})]}),r.jsxs("div",{style:l.content,children:[n==="warning"&&r.jsxs(r.Fragment,{children:[r.jsxs("div",{style:l.warningBox,children:[r.jsx("div",{style:l.sectionTitle,children:" "}),r.jsxs("p",{children:["",r.jsx("strong",{children:""})," "]})]}),r.jsxs("div",{style:l.section,children:[r.jsx("div",{style:l.sectionTitle,children:" "}),r.jsxs("ul",{style:l.list,children:[r.jsx("li",{style:l.listItem,children:""}),r.jsx("li",{style:l.listItem,children:""}),r.jsx("li",{style:l.listItem,children:""}),r.jsx("li",{style:l.listItem,children:""}),r.jsx("li",{style:l.listItem,children:""})]})]}),r.jsxs("div",{style:l.section,children:[r.jsx("div",{style:l.sectionTitle,children:" "}),r.jsxs("p",{children:["",r.jsx("strong",{children:'""'}),""]}),r.jsxs("p",{children:["",r.jsx("strong",{children:'""'}),""]})]}),r.jsxs("div",{style:l.infoBox,children:[r.jsx("div",{style:l.sectionTitle,children:" "}),r.jsxs("p",{children:["",r.jsx("strong",{children:""}),""]}),r.jsx("p",{children:'""'}),r.jsxs("p",{children:["  ",r.jsx("b",{children:"100000 "}),""]}),r.jsx("p",{style:{color:"#a67c2d",fontWeight:"bold"},children:""})]})]}),n==="guide"&&r.jsxs(r.Fragment,{children:[r.jsxs("div",{style:l.section,children:[r.jsx("div",{style:l.sectionTitle,children:" "}),r.jsx("p",{children:""})]}),r.jsx("div",{style:l.guide,children:'    bug    ""   1. "" 2. " " 3. " " 4.    1. "" 2. " " 3.  -   -   -   4.    -  - 100000    1.  2. Base64 3.  4.  '}),r.jsx("button",{style:{...l.button,...l.buttonCopy},onClick:a,children:o?" ":" "}),r.jsxs("div",{style:{...l.infoBox,marginTop:"15px"},children:[r.jsxs("p",{children:[" ",r.jsx("strong",{children:""})]}),r.jsxs("ul",{style:l.list,children:[r.jsx("li",{style:l.listItem,children:""}),r.jsx("li",{style:l.listItem,children:""}),r.jsx("li",{style:l.listItem,children:""}),r.jsx("li",{style:l.listItem,children:""})]})]})]})]}),r.jsxs("div",{style:l.footer,children:[r.jsx("button",{style:{...l.button,...l.buttonSecondary,...l.buttonWarning},onClick:t,children:""}),r.jsx("button",{style:{...l.button,...l.buttonPrimary},onClick:e,children:""})]})]})})},c5=({onComplete:e})=>{const[t,n]=b.useState(0),[s,o]=b.useState(!1);b.useEffect(()=>{const a=setInterval(()=>{n(l=>l>=100?(clearInterval(a),setTimeout(()=>{o(!0)},300),100):l+2)},30);return()=>clearInterval(a)},[]);const i=()=>{e()};return s?r.jsx("div",{style:Dt.overlay,children:r.jsxs("div",{style:Dt.warningContainer,children:[r.jsx("h2",{style:Dt.warningTitle,children:""}),r.jsxs("div",{style:Dt.warningContent,children:[r.jsx("p",{style:Dt.warningText,children:""}),r.jsx("p",{style:Dt.warningText,children:""}),r.jsx("p",{style:Dt.warningText,children:""}),r.jsx("p",{style:Dt.warningText,children:""})]}),r.jsx("button",{onClick:i,style:Dt.continueBtn,children:" "})]})}):r.jsx("div",{style:Dt.overlay,children:r.jsxs("div",{style:Dt.container,children:[r.jsx("h1",{style:Dt.title,children:""}),r.jsx("p",{style:Dt.subtitle,children:""}),r.jsxs("div",{style:Dt.progressContainer,children:[r.jsx("div",{style:Dt.progressBar,children:r.jsx("div",{style:{...Dt.progressFill,width:`${t}%`}})}),r.jsxs("p",{style:Dt.progressText,children:[t,"%"]})]}),r.jsx("p",{style:Dt.loadingText,children:"..."})]})})},Dt={overlay:{position:"fixed",top:0,left:0,width:"100%",height:"100%",background:"linear-gradient(135deg, #1a1a2e 0%, #16213e 100%)",zIndex:9999,display:"flex",justifyContent:"center",alignItems:"center"},container:{textAlign:"center",color:"white",padding:"40px",maxWidth:"600px",width:"90%"},title:{fontSize:"clamp(32px, 8vw, 48px)",marginBottom:"10px",color:"#d4af37",textShadow:"0 0 20px rgba(212, 175, 55, 0.5)",fontWeight:"bold",letterSpacing:"4px"},subtitle:{fontSize:"clamp(14px, 3vw, 18px)",color:"#ccc",marginBottom:"60px",letterSpacing:"2px"},progressContainer:{marginBottom:"30px"},progressBar:{width:"100%",height:"8px",background:"rgba(255, 255, 255, 0.1)",borderRadius:"4px",overflow:"hidden",marginBottom:"10px"},progressFill:{height:"100%",background:"linear-gradient(90deg, #d4af37 0%, #ffd700 100%)",transition:"width 0.3s ease",boxShadow:"0 0 10px rgba(212, 175, 55, 0.5)"},progressText:{fontSize:"14px",color:"#d4af37",fontWeight:"bold"},loadingText:{fontSize:"14px",color:"#888",animation:"pulse 1.5s ease-in-out infinite"},warningContainer:{background:"linear-gradient(135deg, #2d2d2d 0%, #1a1a1a 100%)",padding:"clamp(30px, 6vw, 50px)",borderRadius:"16px",maxWidth:"600px",width:"90%",border:"2px solid #d4af37",boxShadow:"0 20px 60px rgba(0, 0, 0, 0.8)"},warningTitle:{fontSize:"clamp(24px, 5vw, 32px)",color:"#d4af37",marginBottom:"30px",textAlign:"center",fontWeight:"bold"},warningContent:{marginBottom:"30px"},warningText:{fontSize:"clamp(14px, 3vw, 16px)",color:"#fff",lineHeight:"2",marginBottom:"10px",textAlign:"center"},continueBtn:{width:"100%",padding:"clamp(12px, 3vw, 15px)",background:"#d4af37",border:"none",borderRadius:"8px",color:"#1a1a1a",fontSize:"clamp(14px, 3vw, 16px)",fontWeight:"bold",cursor:"pointer",transition:"all 0.3s",boxShadow:"0 4px 15px rgba(212, 175, 55, 0.3)"}},d5=e=>{if(!e||!e.player)return e;const{player:t,children:n=[],activeNpcs:s=[],deadNpcs:o=[]}=e;return u5(t)?(console.warn(" ..."),p5(e)):e};function u5(e){const t=[];(!e.combatStats||typeof e.combatStats!="object")&&t.push("combatStats"),e.rival||t.push("rival"),e.time||t.push("time"),e.manuals!==void 0&&typeof e.manuals!="object"&&t.push("manuals");const n=t.length>=4;return n&&console.warn(" ",t),n}function p5(e){var S,E;const{player:t,children:n=[],activeNpcs:s=[],deadNpcs:o=[]}=e,i={name:t.name,age:t.age,gender:t.gender,avatar:t.avatar,tier:t.tier,currentExp:t.currentExp,maxExp:t.maxExp,time:t.time,cultivation:t.cultivation||0},a={spiritStones:((S=t.resources)==null?void 0:S.spiritStones)||0,money:((E=t.resources)==null?void 0:E.money)||0},l=t.affectionRecords||{},d=t.cultivationMethod||null,u=t.manuals||{},p=t.familyRating||{currentId:"CLAN_SEED",history:[]},c=t.skillPoints||0,m={...i,resources:a,affectionRecords:l,cultivationMethod:d,manuals:u,familyRating:p,skillPoints:c,compensationApplied:!0,compensationTime:new Date().toISOString()};let y=[];return m.resources.spiritStones=(m.resources.spiritStones||0)+1e5,console.log(" "),console.log(" 100000 "),console.log(" ",{cultivationMethod:d,manualsCount:Object.keys(u).length}),console.log(" ",{currentRating:p.currentId,historyCount:p.history.length}),console.log(" ",{skillPoints:c}),console.log(" ",{cultivation:i.cultivation}),{...e,player:m,children:n||[],activeNpcs:zg(s),deadNpcs:zg(o),inventory:y,logs:[]}}function zg(e){return Array.isArray(e)?e.map(t=>({id:t.id,name:t.name,personality:t.personality,identity:t.identity,affection:t.affection||0,favorabilityLevel:t.favorabilityLevel||0,...t})):[]}const f5=e=>e.compensationApplied?`

 100000 `:null,m5=({player:e,children:t,managerOptions:n=[],onBuy:s,onAssign:o})=>{var N;const[i,a]=b.useState({}),[l,d]=b.useState(new Set),[u,p]=b.useState(1),[c,m]=b.useState(1),y=5,S=5,E=[...n].sort((C,j)=>{var V,F;const T=((V=C.stats)==null?void 0:V.intelligence)||C.intelligence||0;return(((F=j.stats)==null?void 0:F.intelligence)||j.intelligence||0)-T}),w=b.useCallback((C,j)=>{const T=Math.max(0,parseInt(j)||0);a(A=>{const V={...A};return T===0?delete V[C]:V[C]=T,V})},[]),g=b.useCallback(()=>{var V,F,B,$;const C=Object.entries(i).filter(([Y,ne])=>ne>0).map(([Y,ne])=>({biz:hl.find(ee=>ee.id===Y),quantity:ne}));if(C.length===0){(V=window.showResult)==null||V.call(window,"","",!1,null,!1);return}if(l.size===0){(F=window.showResult)==null||F.call(window,"","",!1,null,!1);return}const j=C.reduce((Y,ne)=>Y+ne.quantity,0);if(j>l.size){(B=window.showResult)==null||B.call(window,"",` ${j}  ${l.size} `,!1,null,!1);return}const T=Array.from(l).map(Y=>E.find(ne=>ne.id===Y));let A=0;C.forEach(({biz:Y,quantity:ne})=>{var X;for(let ee=0;ee<ne;ee++){if(T.length===0){(X=window.showResult)==null||X.call(window,"","",!1,null,!1);break}const ae=Math.floor(Math.random()*T.length),Te=T[ae];s(Y,Te.id),A++,T.splice(ae,1)}}),($=window.showResult)==null||$.call(window,"",` ${A} `,!0,null,!0),a({})},[i,l,E,s]),h=b.useCallback(()=>{const C={};hl.forEach(j=>{C[j.id]=1}),a(C)},[]),v=b.useCallback(()=>{a({})},[]),x=b.useCallback(C=>{d(j=>{const T=new Set(j);return T.has(C)?T.delete(C):T.add(C),T})},[]),I=b.useCallback(()=>{d(new Set(E.map(C=>C.id)))},[E]),_=b.useCallback(()=>{d(new Set)},[]);return r.jsxs("div",{style:{padding:"10px"},children:[r.jsx("h3",{children:" "}),r.jsxs("p",{style:{fontSize:"12px",color:"#666"},children:["",r.jsx("br",{}),": ",((N=e.businesses)==null?void 0:N.reduce((C,j)=>C+j.income,0))||0," "]}),r.jsx("h4",{children:" "}),r.jsx("div",{style:sn.grid,children:hl.map(C=>r.jsxs("div",{style:sn.card,children:[r.jsx("div",{style:{fontWeight:"bold"},children:C.name}),r.jsx("div",{style:{fontSize:"10px",color:"#555",height:"30px"},children:C.desc}),r.jsxs("div",{style:{fontSize:"12px",margin:"5px 0"},children:[": ",C.minTier," | : ",C.cost]}),r.jsxs("div",{style:{marginTop:"8px",display:"flex",alignItems:"center",gap:"6px"},children:[r.jsx("label",{style:{fontSize:"12px",fontWeight:"bold",color:"#666"},children:":"}),r.jsx("input",{type:"number",min:"0",max:"10",value:i[C.id]||0,onChange:j=>w(C.id,j.target.value),style:{width:"50px",padding:"4px",borderRadius:"4px",border:"1px solid #ccc",textAlign:"center",fontSize:"12px"}})]})]},C.id))}),r.jsx("hr",{style:{margin:"15px 0",borderColor:"#ddd"}}),r.jsx("h4",{children:" "}),r.jsxs("div",{style:sn.batchBuyContainer,children:[r.jsxs("div",{style:sn.batchControlRow,children:[r.jsx("button",{onClick:h,style:sn.controlBtn,children:" (1)"}),r.jsx("button",{onClick:v,style:sn.controlBtn,children:" "}),r.jsxs("span",{style:{fontSize:"13px",fontWeight:"bold",color:"#d32f2f"},children:[": ",Object.values(i).reduce((C,j)=>C+j,0)," "]})]}),r.jsxs("div",{style:sn.purchaseInfo,children:[r.jsxs("div",{style:{fontSize:"12px",color:"#666",marginBottom:"8px"},children:[" : ",Object.keys(i).length," "]}),Object.keys(i).length>0&&r.jsx("div",{style:{maxHeight:"100px",overflowY:"auto",fontSize:"12px",background:"white",padding:"6px",borderRadius:"4px",border:"1px solid #e0e0e0"},children:Object.entries(i).filter(([C,j])=>j>0).map(([C,j])=>{const T=hl.find(A=>A.id===C);return r.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:"4px"},children:[r.jsx("span",{children:T==null?void 0:T.name}),r.jsxs("span",{style:{fontWeight:"bold",color:"#ff9800"},children:["",j]})]},C)})})]}),r.jsxs("div",{style:{...sn.managerSelectContainer,marginBottom:"12px",marginTop:"12px"},children:[r.jsx("div",{style:{fontSize:"13px",fontWeight:"bold",marginBottom:"8px",color:"#333"},children:"  ()"}),r.jsxs("div",{style:sn.batchControlRow,children:[r.jsx("button",{onClick:I,style:sn.controlBtn,children:" "}),r.jsx("button",{onClick:_,style:sn.controlBtn,children:" "}),r.jsxs("span",{style:{fontSize:"13px",fontWeight:"bold",color:"#1976d2"},children:[": ",l.size," / ",E.length]})]}),E.length===0?r.jsx("div",{style:{fontSize:"12px",color:"#999",padding:"10px"},children:""}):r.jsxs(r.Fragment,{children:[r.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(120px, 1fr))",gap:"8px",marginBottom:"10px"},children:E.slice((u-1)*y,u*y).map(C=>{var A;const j=l.has(C.id),T=((A=C.stats)==null?void 0:A.intelligence)||C.intelligence||0;return r.jsxs("label",{style:{...sn.managerCheckbox,...j?sn.managerCheckboxSelected:{}},children:[r.jsx("input",{type:"checkbox",checked:j,onChange:()=>x(C.id),style:{marginRight:"6px"}}),r.jsxs("div",{style:{flex:1},children:[r.jsx("div",{style:{fontSize:"12px",fontWeight:"bold",color:"#333"},children:C.name}),r.jsxs("div",{style:{fontSize:"11px",color:"#666"},children:[": ",T]})]})]},C.id)})}),Math.ceil(E.length/y)>1&&r.jsxs("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",gap:"8px",fontSize:"12px"},children:[r.jsx("button",{onClick:()=>p(Math.max(1,u-1)),disabled:u===1,style:{padding:"4px 8px",borderRadius:"4px",border:"1px solid #ccc",background:u===1?"#f0f0f0":"#fff",cursor:u===1?"not-allowed":"pointer",opacity:u===1?.6:1},children:""}),r.jsxs("span",{style:{color:"#666"},children:[u," / ",Math.ceil(E.length/y)]}),r.jsx("button",{onClick:()=>p(Math.min(Math.ceil(E.length/y),u+1)),disabled:u===Math.ceil(E.length/y),style:{padding:"4px 8px",borderRadius:"4px",border:"1px solid #ccc",background:u===Math.ceil(E.length/y)?"#f0f0f0":"#fff",cursor:u===Math.ceil(E.length/y)?"not-allowed":"pointer",opacity:u===Math.ceil(E.length/y)?.6:1},children:""})]})]})]}),r.jsx("button",{onClick:g,disabled:Object.values(i).reduce((C,j)=>C+j,0)===0,style:{...sn.batchPurchaseBtn,...Object.values(i).reduce((C,j)=>C+j,0)===0?sn.batchPurchaseBtnDisabled:{}},children:" "}),l.size>0&&r.jsxs("div",{style:{fontSize:"12px",color:"#666",marginTop:"8px",padding:"8px",background:"white",borderRadius:"4px",border:"1px solid #e0e0e0"},children:["  ",l.size," "]})]}),r.jsx("hr",{style:{margin:"15px 0",borderColor:"#ddd"}}),r.jsx("h4",{children:" "}),r.jsx("div",{style:{marginBottom:"20px"},children:!e.businesses||e.businesses.length===0?r.jsx("div",{style:{fontSize:"12px",color:"#999",padding:"10px"},children:""}):r.jsx(r.Fragment,{children:r.jsx("div",{style:{marginBottom:"10px"},children:(()=>{const C=e.businesses.length,j=Math.ceil(C/S),T=(c-1)*S,A=Math.min(T+S,C),V=e.businesses.slice(T,A);return r.jsxs(r.Fragment,{children:[V.map((F,B)=>{const $=t.find(Y=>Y.id===F.managerId);return r.jsxs("div",{style:sn.bizCard,children:[r.jsx("div",{style:{fontWeight:"bold"},children:F.name}),r.jsxs("div",{style:{fontSize:"12px"},children:[": ",$?$.name:r.jsx("span",{style:{color:"red"},children:""}),$&&` (:${$.stats.intelligence})`]}),r.jsxs("div",{style:{color:"#2e7d32"},children:[": ",F.income]})]},B)}),j>1&&r.jsxs("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",gap:"8px",marginTop:"10px",fontSize:"12px"},children:[r.jsx("button",{onClick:()=>m(Math.max(1,c-1)),disabled:c===1,style:{padding:"4px 8px",borderRadius:"4px",border:"1px solid #ccc",background:c===1?"#f0f0f0":"#fff",cursor:c===1?"not-allowed":"pointer",opacity:c===1?.6:1},children:""}),r.jsxs("span",{style:{color:"#666"},children:[c," / ",j]}),r.jsx("button",{onClick:()=>m(Math.min(j,c+1)),disabled:c===j,style:{padding:"4px 8px",borderRadius:"4px",border:"1px solid #ccc",background:c===j?"#f0f0f0":"#fff",cursor:c===j?"not-allowed":"pointer",opacity:c===j?.6:1},children:""}),r.jsxs("span",{style:{color:"#999",marginLeft:"8px"},children:[" ",C," "]})]})]})})()})})})]})},sn={grid:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"10px"},card:{border:"1px solid #ddd",padding:"10px",borderRadius:"8px",background:"white"},bizCard:{border:"1px solid #81c784",background:"#e8f5e9",padding:"10px",borderRadius:"8px",marginBottom:"5px"},batchBuyContainer:{background:"#f5f5f5",padding:"12px",borderRadius:"8px",border:"1px solid #e0e0e0",marginBottom:"15px"},batchControlRow:{display:"flex",gap:"8px",alignItems:"center",marginBottom:"12px",flexWrap:"wrap"},controlBtn:{padding:"6px 12px",fontSize:"12px",border:"1px solid #999",borderRadius:"4px",background:"#fff",cursor:"pointer",fontWeight:"bold"},purchaseInfo:{background:"white",padding:"8px",borderRadius:"4px",border:"1px solid #e0e0e0",marginBottom:"10px"},batchPurchaseBtn:{width:"100%",padding:"10px",background:"#2196f3",color:"white",border:"none",borderRadius:"4px",fontWeight:"bold",cursor:"pointer",fontSize:"14px"},batchPurchaseBtnDisabled:{background:"#ccc",cursor:"not-allowed"},managerSelectContainer:{background:"#e3f2fd",padding:"12px",borderRadius:"8px",border:"1px solid #90caf9"},managerCheckbox:{display:"flex",alignItems:"center",gap:"6px",padding:"8px",backgroundColor:"white",borderRadius:"6px",border:"1px solid #ddd",cursor:"pointer",transition:"all 0.2s",fontSize:"12px"},managerCheckboxSelected:{borderColor:"#1976d2",background:"#e3f2fd",boxShadow:"0 0 4px rgba(25, 118, 210, 0.3)"}},g5=Ic.memo(m5),h5=({player:e,children:t,onChallenge:n,isRomanceLimitReached:s=!1})=>{const[o,i]=b.useState(null),[a,l]=b.useState([]),d=t.filter(c=>c.age>=16),u=c=>{if(a.includes(c))l(m=>m.filter(y=>y!==c));else{if(a.length>=3){window.showResult&&window.showResult("","3",!1,null,!1);return}l(m=>[...m,c])}},p=nu(e)+a.reduce((c,m)=>{const y=d.find(S=>S.id===m);return c+(y?nu(y):0)},0);return r.jsx("div",{style:{padding:"10px"},children:o?r.jsxs("div",{children:[r.jsx("button",{onClick:()=>i(null),children:" "}),r.jsxs("h3",{children:[" ",o.name]}),r.jsx("p",{children:o.desc}),r.jsxs("div",{style:mo.statBox,children:[r.jsxs("div",{children:[": ",o.recommendCP]}),r.jsxs("div",{children:[": ",r.jsx("span",{style:{color:p>=o.recommendCP?"green":"red"},children:p})]}),r.jsxs("div",{children:[": ",(o.risk*100).toFixed(0),"%"]})]}),r.jsx("h4",{children:" (3)"}),r.jsx("div",{style:mo.list,children:d.map(c=>r.jsxs("div",{onClick:()=>u(c.id),style:{...mo.fighterRow,background:a.includes(c.id)?"#ffe0b2":"white"},children:[r.jsxs("span",{children:[c.name," (",c.tierTitle,")"]}),r.jsxs("span",{children:["CP: ",nu(c)]})]},c.id))}),r.jsxs("button",{style:mo.startBtn,onClick:()=>n(o,a),children:[" ( ",o.cost," )"]})]}):r.jsxs("div",{children:[r.jsx("h3",{children:" "}),r.jsx("p",{style:{fontSize:"12px",color:"#666"},children:""}),s&&r.jsx("div",{style:{padding:"12px",marginBottom:"15px",backgroundColor:"#fff3e0",borderLeft:"4px solid #ff9800",borderRadius:"4px",color:"#e65100",fontSize:"13px",fontWeight:"500"},children:" "}),r.jsx("div",{style:mo.list,children:Ry.map(c=>r.jsxs("div",{onClick:()=>i(c),style:mo.realmCard,children:[r.jsx("div",{style:{fontWeight:"bold"},children:c.name}),r.jsxs("div",{style:{fontSize:"12px",color:"#d81b60"},children:[": ",c.reqTier]}),r.jsxs("div",{style:{fontSize:"12px"},children:[": ",c.cost]})]},c.id))})]})})},mo={list:{display:"flex",flexDirection:"column",gap:"8px",maxHeight:"300px",overflowY:"auto"},realmCard:{border:"1px solid #ddd",padding:"15px",borderRadius:"8px",cursor:"pointer",background:"white",display:"flex",justifyContent:"space-between",alignItems:"center"},fighterRow:{padding:"10px",borderBottom:"1px solid #eee",display:"flex",justifyContent:"space-between",cursor:"pointer"},statBox:{background:"#eee",padding:"10px",borderRadius:"5px",margin:"10px 0",fontSize:"14px"},startBtn:{width:"100%",padding:"15px",background:"#d32f2f",color:"white",border:"none",borderRadius:"8px",fontSize:"16px",marginTop:"20px",cursor:"pointer"}},x5={LEVEL_UP:[" {actor} {detail}","{actor} {detail}","{actor} {detail}","{actor} {detail}"],NPC_BREAKTHROUGH:[" {actor} {detail}"," {actor} {detail}","{actor} {detail}"],BREAKTHROUGH_FAIL:["{actor} {detail}","{actor} {detail}","{actor} {detail}"],MARRIAGE:["{actor}  {target} ","{actor}  {target} ","{actor}  {target} ","{actor}  {target} ","{actor}{target}/","{target}{actor}","{actor}{target}","{actor}{target}"],BIRTH:["{actor}  {target}","{actor}  {target}","{actor}  {target} "],DEATH:["{actor}  {location} ","{actor}  {detail} ","{actor} "],COMBAT:["{actor}  {location}  {target}","{actor}  {target}  {actor} "," {actor}  {location}  {target}","{location}{actor}{target}{actor}","{actor}{target}","{actor}{target}{location}"],JOIN_SECT:["{actor}  {target}  {detail} ","{target}  {detail}","{target}  {detail} "],GRANDCHILD:["{actor} ","{actor} {detail}"],EXPLORATION:["{actor}  {location}  {detail}"," {actor}  {location}"],FILLER:["","","","","","","","","","","","30%","","","","''","''","","","''","","","",""],RIVAL_RISE:["{actor}","{actor}{detail}''"],RIVAL_BREAKTHROUGH:["{actor}{tier}","{actor}{tier}","{actor}{tier}"],RIVAL_ENGAGED:["{actor}{target}","{target}{actor}"],RIVAL_MARRIAGE:["{target}{actor}","{actor}{target}{target}"],RIVAL_HEIR:["{actor}{target}","{actor}"],RIVAL_STAGE_EVENT:["{actor}{stageTitle}{description}","{actor}{stageTier}{description}","{actor}{stageRole}{description}"],REVENGE_STAGE_ADVANCE:["{actor}{clearedStage}{nextStage}","{actor}{clearedStage}","{actor}{clearedStage}"],REVENGE_SAGA_COMPLETE:["{actor}{finalTarget}","{actor}{finalTarget}","{actor}{finalTarget}"],REVENGE_DUEL_FAILED:["{actor}{rival}","{actor}{rival}","{stageTitle}{actor}"],RIVAL_LIGHT_RUMOR:["{actor}","{actor}''","{actor}"],RIVAL_HEAVY_RUMOR:["{actor}","{actor}","{actor}"],RIVAL_THREAT_MEDIUM:["{playerName}","{actor}..."],RIVAL_THREAT_HIGH:["{actor}''","{actor}"],RIVAL_THREAT_CRITICAL:["","{actor}","..."],RIVAL_HIDE_SUCCESS:["{actor}","{actor}{months}","{actor}"],ASSASSINATION_SURVIVED:["{actor}","{actor}","{actor}"],ASSASSINATION_INJURED:["{actor}","{actor}","{actor}"],RIVAL_DEFEATED:["{target}{actor}","{actor}{target}","{target}...{actor}"],RIVAL_VICTORY:["{target}{actor}","{target}{actor}"],NPC_AFFECTION_HIGH:["{actor}{target}","{target}{actor}","{actor}{target}"],NPC_JEALOUSY:["{actor}{target}{rival}","{actor}{target}","{actor}{target}'{rival}'","{actor}{rival}{target}"],SHURA_FIELD:["{actor}{participants}","{dominant}{rival}{actor}","{actor}{count}"],DUAL_CULTIVATION:["{actor}{target}","{actor}{target}","{actor}{target}"],NPC_PURSUIT:["{actor}{target}{target}","{actor}{target}","{target}{actor}","{actor}{target}"],NPC_ANGRY:["{actor}{target}{target}''","{actor}{target}","{target}{actor}''{actor}"],CHILD_TALENT:["{actor}{target}","{target}{actor}","{actor}{target}"],SECT_PROMOTION:["{actor}","{actor}{detail}","{actor}"],TREASURE_FIND:["{actor}{detail}","{actor}","{actor}{detail}"],RETREAT:["{actor}{detail}","{actor}","{actor}"],TOURNAMENT:["{actor}","{actor}''","{target}{actor}"],INJURED:["{actor}{target}","{actor}{target}","{actor}"],APPRENTICE:["{actor}{target}","{target}{actor}","{actor}{detail}"]};function go(e,t){const n=x5[e];if(!n||n.length===0)return null;let o=n[Math.floor(Math.random()*n.length)];return Object.keys(t).forEach(i=>{const a=`{${i}}`;o=o.replace(new RegExp(a,"g"),t[i])}),o}function y5(e,t){const n=[],s=new Set,o=i=>i?typeof i.status=="string"?i.status!=="DEAD":typeof i.isDead=="boolean"?!i.isDead:!0:!1;return n.push({name:t.name,cultivation:t.currentExp||0,tier:t.tier||"",isPlayer:!0}),s.add(t.name),t.worldNpcs&&t.worldNpcs.length>0&&t.worldNpcs.filter(o).forEach(i=>{s.has(i.name)||(n.push({name:i.name,title:i.title,cultivation:i.currentExp||0,tier:i.tier||"",isPlayer:!1,worldNpcData:i}),s.add(i.name))}),e&&e.length>0&&e.filter(o).forEach(i=>{s.has(i.name)||(n.push({name:i.name,cultivation:i.currentExp||0,tier:i.tier||"",isPlayer:!1}),s.add(i.name))}),n.sort((i,a)=>{if(a.cultivation!==i.cultivation)return a.cultivation-i.cultivation;const l=["","","","","","","","","",""];return l.indexOf(i.tier)-l.indexOf(a.tier)}),n.slice(0,3).map((i,a)=>{var m,y,S;const l=["","",""],d=i.isPlayer?"":"",u=!i.isPlayer&&((m=i.worldNpcData)==null?void 0:m.sectRank)===""&&((S=(y=i.worldNpcData)==null?void 0:y.sect)!=null&&S.name)?`${i.worldNpcData.sect.name}`:"",p=i.title?`${i.title}`:"";return{displayText:`${l[a]} ${d}${u}${p}${i.name} - ${i.tier}`,name:i.name,title:i.title,tier:i.tier,isPlayer:i.isPlayer,worldNpcData:i.worldNpcData}})}const ba=50,mu=(e=[])=>Array.isArray(e)?e.length<=ba?e:e.slice(-ba):[];function b5(e){if(!Array.isArray(e)||e.length===0)return e;const t=e.filter(o=>o.type==="MARRIAGE"||o.type==="RIVAL_MARRIAGE"),n=e.filter(o=>o.type==="BIRTH"||o.type==="GRANDCHILD"||o.type==="RIVAL_HEIR");return t.length===0||n.length===0?e:e.filter(o=>{var i;if(o.type==="BIRTH"||o.type==="GRANDCHILD"||o.type==="RIVAL_HEIR"){const a=(i=o.data)==null?void 0:i.actor,l=o.timestamp||Date.now();if(a){const d=t.filter(u=>{var p,c;return((p=u.data)==null?void 0:p.actor)===a||((c=u.data)==null?void 0:c.target)===a});for(const u of d){const p=u.timestamp||Date.now(),c=(l-p)/(1e3*60*60*24*30);if(c>=0&&c<12)return!1}}}return!0})}function v5(e){const n=((e==null?void 0:e.worldNpcs)||[]).filter(o=>{var i;return(o==null?void 0:o.status)!=="DEAD"&&(o==null?void 0:o.sectRank)===""&&((i=o==null?void 0:o.sect)==null?void 0:i.id)}),s=new Map;return n.forEach(o=>{s.has(o.sect.id)||s.set(o.sect.id,o)}),Er.filter(o=>o&&o.id&&o.id!=="SECT_NONE").map(o=>{const i=s.get(o.id),a=i!=null&&i.title?`${i.title}`:"";return{displayText:i?`${o.name}${a}${i.name} - ${i.tier}`:`${o.name}`,sectId:o.id,sectName:o.name,worldNpcData:i||null}}).slice(0,10)}function S5(e,t,n,s){var v,x;const o=[],i=[];if(t.rival){const I=P5(t.rival);if(I){const _=go(I.type,I.data);_&&o.unshift(_)}}e.filter(I=>I.type==="RIVAL_BREAKTHROUGH").forEach(I=>{const _=go(I.type,I.data);_&&o.unshift(_)});const l=[];let d=[];e.forEach(I=>{I.type.startsWith("RIVAL_")?l.push(I):d.push(I)}),d=b5(d),l.forEach(I=>{const _=go(I.type,I.data);_&&o.push(_)});const u=[],p=[];d.forEach(I=>{I.data.actor===t.name||I.data.target===t.name||I.type==="LEVEL_UP"||I.type==="MARRIAGE"||I.type==="BIRTH"||I.type==="COMBAT"?u.push(I):p.push(I)});const c=8,m=Math.ceil(c*.25),y=Math.ceil(c*.75);let S=0;u.forEach(I=>{if(S<m){const _=go(I.type,I.data);_&&(o.push(_),S++)}}),p.forEach(I=>{const _=go(I.type,I.data);_&&(o.length<5?o.push(_):i.push(_))});const E=o.length+i.length,w=Math.max(0,y-(E-S));for(let I=0;I<w;I++){const _=go("FILLER",{});o.length<5?o.push(_):i.push(_)}const g=y5(n,t),h=v5(t);return{issue:s,year:((v=t.time)==null?void 0:v.year)||t.age||0,month:((x=t.time)==null?void 0:x.month)||t.month||1,headlines:o,rumors:i,powerRanking:g,sectRanking:h,timestamp:Date.now()}}function w5(e,t,n,s,o){return S5(e,t,n,s)}function Ft(e,t,n){Array.isArray(e)&&(e.push({type:t,data:n,timestamp:Date.now()}),e.length>ba&&e.splice(0,e.length-ba))}const k5=(e,t,n=[])=>{const s=t.combatStats||{maxHp:100,maxMp:50},o=a=>{const l=a.combatStats||{maxHp:100,maxMp:50,atk:10,def:5};return{...a,combatStats:l,currentHp:l.maxHp,currentMp:l.maxMp,isDefending:!1}},i=[o(e),...n.map(o)];return{player:i[0],party:i,enemy:{...t,currentHp:s.maxHp,currentMp:s.maxMp,combatStats:s},turn:0,logs:[],result:null}},E5=(e,t,n=null)=>{const{party:s,enemy:o}=e,i=[...e.logs];let a=s.map(S=>({...S})),l={...o},d=null;const u=e.turn+1;i.push(`===  ${u}  ===`);for(let S=0;S<a.length;S++){const E=a[S];if(E.currentHp<=0)continue;const w=j5(E,l,t);if(a[S]=w.player,l=w.enemy,i.push(...w.logs),l.currentHp<=0)return i.push(`${l.name} `),d="win",{party:a,player:a[0],enemy:l,turn:u,logs:i,result:d}}if(a.filter(S=>S.currentHp>0).length===0)return i.push(""),d="lose",{party:a,player:a[0],enemy:l,turn:u,logs:i,result:d};const c=a.findIndex(S=>S.currentHp>0),m=C5(l,a[c]);return l=m.enemy,a[c]=m.player,i.push(...m.logs),a.some(S=>S.currentHp>0)?{party:a,player:a[0],enemy:l,turn:u,logs:i,result:d}:(i.push(""),d="lose",{party:a,player:a[0],enemy:l,turn:u,logs:i,result:d})},j5=(e,t,n,s)=>{var i,a,l;const o=[];switch(n){case"attack":const d=gu(e,t);t.currentHp-=d,t.currentHp=Math.max(0,Math.floor(t.currentHp)),o.push(`${e.name}  ${t.name}  ${d} `),o.push(`${t.name}  HP: ${t.currentHp}/${((i=t.combatStats)==null?void 0:i.maxHp)||0}`);break;case"defend":e.isDefending=!0,o.push(`${e.name} `);break;case"skill":const u=Math.floor(gu(e,t)*1.5);t.currentHp-=u,t.currentHp=Math.max(0,Math.floor(t.currentHp)),e.currentMp-=50,o.push(`${e.name}  ${t.name}  ${u} `),o.push(`${t.name}  HP: ${t.currentHp}/${((a=t.combatStats)==null?void 0:a.maxHp)||0}`);break;default:const p=gu(e,t);t.currentHp-=p,t.currentHp=Math.max(0,Math.floor(t.currentHp)),o.push(`${e.name}  ${t.name}  ${p} `),o.push(`${t.name}  HP: ${t.currentHp}/${((l=t.combatStats)==null?void 0:l.maxHp)||0}`)}return{player:e,enemy:t,logs:o}},C5=(e,t)=>{var c,m,y;const n=[],s=((c=e.combatStats)==null?void 0:c.atk)||10,o=((m=t.combatStats)==null?void 0:m.def)||5,i=s-Math.floor(o/2),a=Math.max(1,i),l=t.isDefending?Math.floor(a*.5):a,d=i<=0,u=t.isDefending&&l<a,p=d||u?"":"";return t.currentHp-=l,t.isDefending=!1,t.currentHp=Math.max(0,Math.floor(t.currentHp)),n.push(`${e.name}  ${t.name}  ${l} ${p}`),n.push(`${t.name}  HP: ${t.currentHp}/${((y=t.combatStats)==null?void 0:y.maxHp)||0}`),{enemy:e,player:t,logs:n}},gu=(e,t)=>{var a,l;const n=((a=e.combatStats)==null?void 0:a.atk)||10,s=((l=t.combatStats)==null?void 0:l.def)||5,o=n-Math.floor(s/2);return Math.max(1,o)},Ui=(e,t,n=[])=>{let s=k5(e,t,n);for(;!s.result;)s=E5(s,"attack");return{success:s.result==="win",logs:s.logs,remainingHp:s.player.currentHp,party:s.party}};let Ds=1.3;const o1={aptitude:92,looks:95,intelligence:90,health:85,cunning:88};var sh;const hu={type:"",name:"",multiplier:((sh=An==null?void 0:An.SINGLE)==null?void 0:sh.multiplier)||1.8,elements:[""]},T5={id:"CHU_CLAN",name:"",level:"HIGH"},I5={name:"",bonuses:{speedMultiplier:1.15}},zf=e=>{if(!e)return e;e.stats={...o1,...e.stats||{}};const t=e.spiritRoot||hu;e.spiritRoot={...hu,...t,elements:Array.isArray(t.elements)?[...t.elements]:[...hu.elements]},e.sect=e.sect?{...e.sect}:{...T5};const n=e.trait||I5;return e.trait={...n,bonuses:n.bonuses?{...n.bonuses}:void 0},e},jc=(e,t=e==null?void 0:e.tier)=>{if(!e)return;const n=Tn(t||(e==null?void 0:e.tier));n!=null&&n.maxExp&&(e.maxExp=n.maxExp)},_5=e=>{const t=Math.min(.8,((e==null?void 0:e.baseThreat)||0)/100),n=(e==null?void 0:e.powerMultiplier)||1;return 1+t+(n-1)*.5},R5=(e,t,n=!1)=>{if(!e)return 0;zf(e),jc(e);const s=Vc({...e,stats:e.stats,spiritRoot:e.spiritRoot,trait:e.trait,sect:e.sect},n)||0,o=n?1.8:1,i=_5(t),a=Math.max(n?10:120,Math.floor(s*i*o*Ds));return e.currentExp=Math.max(0,(e.currentExp||0)+a),a},Df=e=>(e.revengeProgress||(e.revengeProgress={currentStageIndex:0,completedStages:[],sagaComplete:!1}),Array.isArray(e.revengeProgress.completedStages)||(e.revengeProgress.completedStages=[]),e.revengeProgress),M5=e=>(Array.isArray(e.newsBuffer)||(e.newsBuffer=[]),e.newsBuffer),i1=(e,t,{resetProgress:n=!0}={})=>{const s=e.rival||{},o=typeof t.baseThreat=="number"?t.baseThreat:0,i=Tn(t.tier);return e.rival={...s,name:t.name,stageId:t.id,tier:t.tier,maxExp:(i==null?void 0:i.maxExp)||s.maxExp||t.baseExp,state:n?"NORMAL":s.state||"NORMAL",lifeStage:n?0:s.lifeStage||0,storyTimer:n?0:s.storyTimer||0,isDead:n?!1:s.isDead||!1,rumorCount:n?0:s.rumorCount||0,threatLevel:n?o:s.threatLevel??o,hiddenTurns:0,currentExp:t.baseExp,stats:{...o1,...s.stats||{}},combatStats:{...s.combatStats||{},hp:t.combatStats.hp,maxHp:t.combatStats.maxHp,atk:t.combatStats.atk,def:t.combatStats.def}},zf(e.rival),jc(e.rival,t.tier),e.rival},ei=e=>{const t=Df(e),n=hc(t.currentStageIndex||0);return!e.rival||e.rival.stageId!==n.id?i1(e,n,{resetProgress:!0}):e.rival};function A5(e,t=50){const n=ei(e);if(e.resources.spiritStones<t)return{success:!1,message:""};const s=e.time.year*12+e.time.month;if(e.revengeActions.lastRumorMonth===s)return{success:!1,message:""};e.resources.spiritStones=Math.max(0,e.resources.spiritStones-t);const o=Math.min(.9,.6+t/200);if(!(Math.random()<o))return n.threatLevel=Math.min(100,n.threatLevel+15),e.revengeActions.lastRumorMonth=s,{success:!0,effectType:"FAILED",message:`${n.name}...`,threatIncrease:15};let a="",l=0;return t>=100?(a="HEAVY",l=200,n.state="FURIOUS",n.threatLevel=Math.min(100,n.threatLevel+25),n.currentExp=Math.max(0,n.currentExp-l),n.rumorCount+=2):(a="LIGHT",l=100,n.state="ANXIOUS",n.threatLevel=Math.min(100,n.threatLevel+10),n.currentExp=Math.max(0,n.currentExp-l),n.rumorCount+=1),e.revengeActions.lastRumorMonth=s,e.revengeActions.totalRumors+=1,{success:!0,effectType:a,message:a==="HEAVY"?`${n.name}`:`${n.name}...`,damage:l,threatIncrease:a==="HEAVY"?25:10,newsEvent:{type:a==="HEAVY"?"RIVAL_HEAVY_RUMOR":"RIVAL_LIGHT_RUMOR",data:{actor:n.name,rumorCount:n.rumorCount}}}}function N5(e,t=1,n=30){const s=ei(e),o=t*n;if(e.resources.spiritStones<o)return{success:!1,message:`${t}${o}`};e.resources.spiritStones=Math.max(0,e.resources.spiritStones-o);const i=40*t;return s.threatLevel=Math.max(0,s.threatLevel-i),s.threatLevel<30&&(s.state="NORMAL"),s.hiddenTurns=t,e.revengeActions.hidingMonths+=t,{success:!0,message:`${t}${s.name}`,threatReduction:i,months:t,newsEvent:{type:"RIVAL_HIDE_SUCCESS",data:{actor:s.name,months:t}}}}function L5(e){const t=ei(e),n=Df(e),s=hc(n.currentStageIndex||0),o=M5(e);if(e.tier==="")return{success:!1,message:`${t.name}`};const a=Jn(e).total,l=(s==null?void 0:s.powerMultiplier)??1,d=1-t.rumorCount*.05,u=Math.max(.5,Ds*l*Math.max(.5,d)),p=(g={})=>{const h=Math.max(1,Math.floor((g.maxHp||100)*u)),v=Math.max(1,Math.floor((g.maxMp||50)*u));return{...g,maxHp:h,maxMp:v,hp:Math.max(1,Math.floor((g.hp||g.maxHp||100)*u)),mp:Math.max(1,Math.floor((g.mp||g.maxMp||50)*u)),atk:Math.max(1,Math.floor((g.atk||10)*u)),def:Math.max(0,Math.floor((g.def||5)*u))}},c={...e,combatStats:e.combatStats||{maxHp:100,maxMp:50,atk:10,def:5,hp:100,mp:50}},m={...t,combatStats:p(t.combatStats||{maxHp:120,maxMp:60,atk:12,def:6,hp:120,mp:60})},S=Ui(c,m).success,E=Jn(m).total,w=a/(a+E);if(console.log(":",{:s==null?void 0:s.name,:a,:Jn(t).total,:Math.floor(E),:l,:`${t.rumorCount} (-${t.rumorCount*5}%)`,:`${(w*100).toFixed(1)}%`,:S?"":""}),S){const g=n.currentStageIndex>=Pl;if(t.isDead=!0,t.state="DEAD",t.threatLevel=0,n.completedStages.includes(s.id)||n.completedStages.push(s.id),g)return n.sagaComplete=!0,n.currentStageIndex=Pl,console.log("[] REVENGE_SAGA_COMPLETE"),Ft(o,"REVENGE_SAGA_COMPLETE",{actor:e.name,finalTarget:t.name}),{success:!0,victory:!0,sagaComplete:!0,message:(s==null?void 0:s.defeatLog)||`${t.name}...`,playerPower:a,rivalPower:Math.floor(E),newsEvent:{type:"RIVAL_DEFEATED",data:{actor:e.name,target:t.name}}};const h=Math.min(n.currentStageIndex+1,Pl);n.currentStageIndex=h;const v=hc(h);return i1(e,v,{resetProgress:!0}),console.log("[] REVENGE_STAGE_ADVANCERIVAL_DEFEATED"),Ft(o,"REVENGE_STAGE_ADVANCE",{actor:e.name,clearedStage:s.name,nextStage:v.name}),Ft(o,"RIVAL_DEFEATED",{actor:e.name,target:t.name}),{success:!0,victory:!0,stageCleared:s.id,nextStageUnlocked:!0,nextStage:v,message:(s==null?void 0:s.defeatLog)||`${t.name}`,transitionLog:s==null?void 0:s.unlockNextLog,playerPower:a,rivalPower:Math.floor(E),newsEvent:{type:"RIVAL_DEFEATED",data:{actor:e.name,target:t.name}}}}else return fw(e),Ft(o,"REVENGE_DUEL_FAILED",{actor:e.name,rival:t.name,stageTitle:s==null?void 0:s.title}),{success:!0,victory:!1,message:`${t.name}...`,playerPower:a,rivalPower:Math.floor(E),newsEvent:{type:"RIVAL_VICTORY",data:{actor:t.name,target:e.name}}}}function $5(e){const t=ei(e);if(t.hiddenTurns>0)return t.hiddenTurns-=1,null;if(t.threatLevel>=100){const n="",s=e.combatStats=e.combatStats||{},o=s.hp??s.maxHp??100,i=s.maxHp||Math.max(100,o),a=.3+e.stats.cunning/200,l=Math.random()<a,d=Math.floor(i*.4),u=Math.floor(i*.75);return e.revengeActions=e.revengeActions||{},e.revengeActions.assassinationAttempts=(e.revengeActions.assassinationAttempts||0)+1,l?(e.combatStats.hp=Math.max(10,o-d),t.threatLevel=Math.max(35,t.threatLevel-35),{type:"ASSASSINATION_SURVIVED",survived:!0,message:`${n}`,hpLoss:d}):(e.combatStats.hp=Math.max(5,o-u),e.currentExp=Math.max(0,Math.floor(e.currentExp*.6)),t.threatLevel=Math.max(40,t.threatLevel-45),{type:"ASSASSINATION_INJURED",survived:!1,message:`${n}`,hpLoss:u})}return null}function B5(e){const t=ei(e),n=Df(e),s=hc(n.currentStageIndex||0);if(zf(t),jc(t),t.isDead)return null;R5(t,s),t.storyTimer=(t.storyTimer||0)+1;const o=(s==null?void 0:s.storyBeats)||[],i=t.lifeStage||0,a=o[i];if(!a)return null;const l=Math.max(1,a.delay||1);if(t.storyTimer<l||!(!(typeof a.exp=="number")||(t.currentExp||0)>=a.exp*.95))return null;if(t.lifeStage=i+1,t.storyTimer=0,a.tier&&(t.tier=a.tier,jc(t,a.tier)),typeof a.exp=="number"){const c=Math.floor(a.exp*Ds);t.currentExp=Math.max(t.currentExp,c)}const p={actor:t.name,detail:a.detail||a.tier||(s==null?void 0:s.title),target:a.target,stageTitle:s==null?void 0:s.title,stageRole:s==null?void 0:s.role,stageTier:a.tier||(s==null?void 0:s.tier),description:a.description};return Object.keys(p).forEach(c=>{(p[c]===void 0||p[c]===null)&&delete p[c]}),{type:a.type||"RIVAL_STAGE_EVENT",data:p}}function O5(e){const t=ei(e);if(t.isDead||t.hiddenTurns>0)return 0;const n=Math.ceil(2*Ds);let s=1;return t.threatLevel>=60?s=1.5*Ds:t.threatLevel>=30&&(s=1.2*Ds),Math.ceil(n*s)}function P5(e){return e.isDead?null:e.threatLevel>=80?{type:"RIVAL_THREAT_CRITICAL",data:{actor:e.name}}:e.threatLevel>=60?{type:"RIVAL_THREAT_HIGH",data:{actor:e.name}}:e.threatLevel>=30?{type:"RIVAL_THREAT_MEDIUM",data:{actor:e.name,playerName:""}}:null}const z5={currentStageIndex:0,completedStages:[],sagaComplete:!1},D5={lastRumorMonth:0,totalRumors:0,assassinationAttempts:0,hidingMonths:0},F5=e=>e&&{...e,resources:{...e.resources||{}},rival:e.rival?{...e.rival,stats:{...e.rival.stats||{}},combatStats:{...e.rival.combatStats||{}},revengeProgress:e.rival.revengeProgress?{...e.rival.revengeProgress}:void 0}:e.rival,revengeActions:{...D5,...e.revengeActions||{}},revengeProgress:e.revengeProgress?{...e.revengeProgress,completedStages:Array.isArray(e.revengeProgress.completedStages)?[...e.revengeProgress.completedStages]:[]}:{...z5},newsBuffer:Array.isArray(e.newsBuffer)?[...e.newsBuffer]:[],combatStats:e.combatStats?{...e.combatStats}:e.combatStats},H5=({player:e,setPlayer:t,addLog:n})=>{var Te,Be,ze,W;const[s,o]=b.useState(50),[i,a]=b.useState(1),[l,d]=b.useState(null),[u,p]=b.useState(null),[c,m]=b.useState(!1),y=i*30,S=b.useMemo(()=>c?"":e!=null&&e.resources?e.resources.spiritStones<y?`${i}${y}`:"":"",[c,e==null?void 0:e.resources,(Te=e==null?void 0:e.resources)==null?void 0:Te.spiritStones,y,i]),E=!S,w=b.useCallback((J,...fe)=>{const re=F5(e),ce=J(re,...fe);return console.log(" [executeRevengeAction] :",ce),ce!=null&&ce.success&&t(re),ce},[e,t]),g=b.useCallback((J,fe=5e3)=>{J&&(d(J),setTimeout(()=>d(null),fe))},[]),h=e.rival||{name:"",state:"NORMAL",lifeStage:0,threatLevel:0,rumorCount:0,isDead:!1,tier:"",currentExp:300},v=e.revengeProgress||{currentStageIndex:0,sagaComplete:!1},x=Math.min(v.currentStageIndex||0,ya.length-1),I=ya[x],_=!!v.sagaComplete,N=_?"":"",C=Jn(e).total,j=Jn(h).total,T=Math.max(.5,1-h.rumorCount*.05),A=Ds*((I==null?void 0:I.powerMultiplier)||1),V=Math.floor(j*A*T),F=(J,fe=50)=>Math.floor((J??fe)*T*A),B=J=>J>=80?"#ff4444":J>=60?"#ff8800":J>=30?"#ffbb00":"#44ff44",$=J=>J>=80?"":J>=60?"":J>=30?"":"",Y=J=>({NORMAL:"",ANXIOUS:"",FURIOUS:"",DEAD:""})[J]||"",ne=b.useCallback(()=>{if(c)return;m(!0);const J=Math.floor(j*A*T),fe=w(A5,s);if(fe!=null&&fe.success&&fe.effectType!=="FAILED"){const re=Math.max(.5,1-(h.rumorCount+(s>=100?2:1))*.05),ce=Math.floor(j*A*re),Ce=J-ce;fe.actualPowerLoss=Ce}g(fe),m(!1)},[w,g,c,s,j,A,T,h.rumorCount]),X=b.useCallback(()=>{if(!E){g({success:!1,message:S});return}m(!0);const J=w(N5,i,30);g(J),m(!1)},[E,w,S,i,g]),ee=()=>{var fe,re;if(console.log("handleDuel:",e.tier),console.log(":",e),!Af(e).canDuel){if(((fe=e.stats)==null?void 0:fe.health)<20){window.showResult?window.showResult(" ",`${Math.floor(e.stats.health)}/100`,!1,null,!1):p({title:" ",message:`${Math.floor(e.stats.health)}/100`});return}else if(((re=e.stats)==null?void 0:re.health)<30&&window.showConfirm){window.showConfirm(` 30${Math.floor(e.stats.health)}/100`,()=>{ae()});return}}ae()},ae=()=>{const J=h.name,fe=(I==null?void 0:I.title)||"";window.showConfirm&&window.showConfirm(`${fe}${J}`,()=>{const re=w(L5);if(console.log(" [RevengePanel] :",re),re!=null&&re.success)if(console.log("  - :",re.victory),re.victory){const ce=re.sagaComplete?" ":` ${J}`,Ce=re.message||`${J}`;if(console.log(" :",ce),g({success:!0,message:Ce,transitionLog:re.transitionLog,nextStage:re.nextStage,sagaComplete:re.sagaComplete},re.sagaComplete?8e3:6e3),p({title:ce,message:Ce,type:"victory"}),window.showResult&&typeof window.showResult=="function"?window.showResult(ce,Ce,!0,null,!1):(console.warn(" window.showResult "),p({title:ce,message:Ce,type:"victory"})),n){const Ge=re.sagaComplete?` ${J}`:` ${J}${I==null?void 0:I.title}`;n(Ge,"","")}}else{const ce=re.message||`${J}...`;if(console.log(" :"," ",ce),console.log(" window.showResult :",{exists:!!window.showResult,isFunction:typeof window.showResult=="function"}),g({success:!1,message:ce,damage:"",newsEvent:re.newsEvent},6e3),p({title:" ",message:ce,type:"defeat"}),window.showResult&&typeof window.showResult=="function")try{console.log("  window.showResult"),window.showResult(" ",ce,!1,null,!1)}catch(Ce){console.error(" window.showResult :",Ce),p({title:" ",message:ce,type:"defeat"})}else console.warn(" window.showResult "+typeof window.showResult+""),p({title:" ",message:ce,type:"defeat"});n&&n(` ${J}`,"","")}else{console.error(" :",re);const ce=re&&re.message||`${J}`;window.showResult&&typeof window.showResult=="function"?window.showResult(" ",ce,!1,null,!1):p({title:" ",message:ce})}})};return h.isDead&&_?r.jsx("div",{style:je.panel,children:r.jsxs("div",{style:je.completed,children:[r.jsx("h2",{children:"  "}),r.jsxs("p",{children:[h.name,""]}),r.jsx("p",{children:"..."})]})}):r.jsxs("div",{style:je.panel,children:[r.jsxs("div",{style:je.header,children:[r.jsx("h2",{style:je.title,children:" "}),r.jsxs("p",{style:je.subtitle,children:["",h.name]})]}),r.jsxs("div",{style:je.stageNarrative,children:[r.jsxs("div",{style:je.stageFocusHeader,children:[r.jsxs("span",{style:je.stageBadge,children:["",x+1,""]}),r.jsx("span",{style:je.stageStatus,children:N})]}),r.jsx("div",{style:je.stageFocusName,children:h.name}),r.jsx("div",{style:je.stageFocusTitle,children:(I==null?void 0:I.title)||""}),r.jsx("p",{style:je.stageNarrativeText,children:(I==null?void 0:I.flavor)||""}),_&&r.jsx("p",{style:je.stageNarrativeNext,children:""})]}),r.jsxs("div",{style:je.rivalStatus,children:[r.jsx("h3",{style:je.sectionTitle,children:""}),r.jsxs("div",{style:je.statusGrid,children:[r.jsxs("div",{style:je.statusItem,children:[r.jsx("span",{style:je.statusLabel,children:""}),r.jsx("span",{style:je.statusValue,children:h.tier})]}),r.jsxs("div",{style:je.statusItem,children:[r.jsx("span",{style:je.statusLabel,children:""}),r.jsx("span",{style:je.statusValue,children:Y(h.state)})]}),r.jsxs("div",{style:je.statusItem,children:[r.jsx("span",{style:je.statusLabel,children:""}),r.jsxs("span",{style:{...je.statusValue,color:B(h.threatLevel)},children:[$(h.threatLevel)," ",h.threatLevel,"%"]})]}),r.jsxs("div",{style:je.statusItem,children:[r.jsx("span",{style:je.statusLabel,children:""}),r.jsxs("span",{style:je.statusValue,children:[" ",h.rumorCount*5,"%"]})]})]}),r.jsx("div",{style:je.threatBar,children:r.jsx("div",{style:{...je.threatFill,width:`${h.threatLevel}%`,backgroundColor:B(h.threatLevel)}})}),h.threatLevel>=80&&r.jsx("div",{style:je.dangerWarning,children:" "})]}),r.jsxs("div",{style:je.actions,children:[r.jsx("h3",{style:je.sectionTitle,children:""}),r.jsxs("div",{style:je.actionCard,children:[r.jsxs("div",{style:je.actionHeader,children:[r.jsx("h4",{style:je.actionTitle,children:" "}),r.jsxs("span",{style:je.actionCost,children:["",i*30," "]})]}),r.jsxs("p",{style:je.actionDesc,children:["",h.name,"80%"]}),r.jsxs("div",{style:je.actionControlsVertical,children:[r.jsxs("select",{value:i,onChange:J=>a(Number(J.target.value)),style:je.select,children:[r.jsx("option",{value:"1",children:"1-40%"}),r.jsx("option",{value:"2",children:"2-80%"}),r.jsx("option",{value:"3",children:"3-100%"})]}),r.jsxs("button",{style:{...je.hideBtn,...E?{}:{opacity:.6,cursor:"not-allowed"}},onClick:X,"aria-disabled":!E,title:E?"":S,children:[" (",i*30,")"]})]})]}),r.jsxs("div",{style:je.actionCard,children:[r.jsxs("div",{style:je.actionHeader,children:[r.jsx("h4",{style:je.actionTitle,children:" "}),r.jsxs("span",{style:je.actionCost,children:["",s," "]})]}),r.jsxs("p",{style:je.actionDesc,children:["",h.name,"",r.jsx("br",{}),""]}),r.jsx("div",{style:je.actionControls,children:r.jsx("input",{type:"range",min:"50",max:"150",step:"10",value:s,onChange:J=>o(Number(J.target.value)),style:je.slider})}),r.jsxs("button",{style:je.rumorBtn,onClick:ne,disabled:c||!(e!=null&&e.resources)||e.resources.spiritStones<s,children:[" (",s,")"]}),r.jsxs("div",{style:je.actionInfo,children:["",Math.min(90,60+s/2),"% | +",s>=100?25:10]})]}),r.jsxs("div",{style:{...je.actionCard,...je.finalDuelCard},children:[r.jsxs("div",{style:je.actionHeader,children:[r.jsx("h4",{style:je.actionTitle,children:" "}),r.jsx("span",{style:je.actionWarning,children:""})]}),r.jsxs("p",{style:je.actionDesc,children:["",h.name,"",r.jsx("br",{}),r.jsx("strong",{children:""}),""]}),r.jsxs("div",{style:je.powerComparison,children:[r.jsxs("div",{style:je.powerItem,children:[r.jsx("span",{children:""}),r.jsx("span",{children:C})]}),r.jsxs("div",{style:je.powerItem,children:[r.jsx("span",{children:""}),r.jsx("span",{children:V})]})]}),r.jsx("div",{style:{fontSize:"12px",color:"#666",marginTop:"8px"},children:""}),r.jsx("button",{style:je.duelBtn,onClick:ee,disabled:e.tier==="",children:""}),r.jsxs("div",{style:{fontSize:"16px",fontWeight:"bold",color:"#d4af37",marginTop:12,textAlign:"center",backgroundColor:"rgba(212, 175, 55, 0.1)",padding:"8px",borderRadius:"4px"},children:[" ",Math.round(_y(e,{...h,combatStats:{...h.combatStats||{},atk:F((Be=h.combatStats)==null?void 0:Be.atk,50),def:F((ze=h.combatStats)==null?void 0:ze.def,20),maxHp:F((W=h.combatStats)==null?void 0:W.maxHp,500)}}).prob*100),"%"]}),e.tier===""&&r.jsx("div",{style:je.actionWarningText,children:" "})]})]}),l&&r.jsxs("div",{style:{...je.resultToast,backgroundColor:l.success?"#4caf50":"#f44336"},children:[r.jsx("p",{children:l.message}),l.damage&&r.jsxs("p",{children:["",l.damage]}),l.actualPowerLoss&&r.jsxs("p",{children:["-",l.actualPowerLoss," (-",Math.round(l.actualPowerLoss/V*100),"%)"]}),l.threatIncrease&&r.jsxs("p",{children:["+",l.threatIncrease,"%"]}),l.threatReduction&&r.jsxs("p",{children:["-",l.threatReduction,"%"]}),l.transitionLog&&r.jsx("p",{children:l.transitionLog}),l.nextStage&&r.jsxs("p",{children:["",l.nextStage.name,"",l.nextStage.title,""]})]}),u&&r.jsx("div",{style:je.modalOverlay,children:r.jsxs("div",{style:je.modalCard,children:[r.jsx("div",{style:je.modalIcon,children:u.type==="victory"?"":u.type==="defeat"?"":""}),r.jsx("h3",{style:{marginBottom:10},children:u.title}),r.jsx("p",{style:je.modalText,children:u.message}),r.jsx("button",{style:je.modalButton,onClick:()=>p(null),children:u.type==="victory"?"":""})]})})]})},je={panel:{padding:"20px",maxWidth:"900px",margin:"0 auto",color:"#e0d5c7"},header:{textAlign:"center",marginBottom:"30px",borderBottom:"2px solid #8b4513",paddingBottom:"15px"},stageFocusHeader:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"10px"},stageBadge:{fontSize:"12px",letterSpacing:"2px",padding:"4px 10px",borderRadius:"999px",border:"1px solid #ffd700",color:"#ffd700"},stageStatus:{fontSize:"12px",padding:"4px 12px",borderRadius:"999px",background:"rgba(255,255,255,0.08)",color:"#fff"},stageFocusName:{fontSize:"22px",fontWeight:"bold",color:"#ffe4c4"},stageFocusTitle:{fontSize:"14px",color:"#ffcc80",marginTop:"4px"},stageNarrative:{border:"1px solid rgba(255,255,255,0.1)",borderRadius:"10px",padding:"16px",marginBottom:"20px",background:"rgba(0,0,0,0.25)"},stageNarrativeText:{fontSize:"14px",color:"#f0e1c3",marginTop:"6px"},stageNarrativeNext:{fontSize:"13px",color:"#ffd700",marginTop:"8px"},title:{color:"#ff6b6b",fontSize:"28px",marginBottom:"8px",textShadow:"2px 2px 4px rgba(0,0,0,0.5)"},subtitle:{color:"#ffd700",fontSize:"18px",fontStyle:"italic"},rivalStatus:{background:"linear-gradient(135deg, rgba(40, 20, 20, 0.8), rgba(60, 30, 30, 0.8))",border:"2px solid #8b4513",borderRadius:"12px",padding:"20px",marginBottom:"25px",boxShadow:"0 4px 12px rgba(0,0,0,0.4)"},sectionTitle:{color:"#ffd700",marginBottom:"15px",fontSize:"20px"},statusGrid:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(140px, 1fr))",gap:"12px",marginBottom:"15px"},statusItem:{display:"flex",justifyContent:"space-between",padding:"8px 12px",background:"rgba(0,0,0,0.3)",borderRadius:"6px"},statusLabel:{color:"#bbb",fontWeight:"500"},statusValue:{color:"#fff",fontWeight:"bold"},threatBar:{width:"100%",height:"30px",background:"rgba(0,0,0,0.5)",borderRadius:"15px",overflow:"hidden",border:"2px solid #666",marginTop:"15px",position:"relative"},threatFill:{height:"100%",transition:"width 0.5s ease, background-color 0.5s ease",display:"flex",alignItems:"center",justifyContent:"center",fontWeight:"bold",color:"white",textShadow:"1px 1px 2px rgba(0,0,0,0.8)"},dangerWarning:{marginTop:"15px",padding:"12px",background:"linear-gradient(90deg, #ff4444, #ff6b6b)",border:"2px solid #ff0000",borderRadius:"8px",color:"white",fontWeight:"bold",textAlign:"center",boxShadow:"0 0 20px rgba(255, 68, 68, 0.6)"},actions:{marginTop:"30px"},actionCard:{background:"linear-gradient(135deg, rgba(30, 30, 40, 0.9), rgba(50, 40, 60, 0.9))",border:"2px solid #8b4513",borderRadius:"12px",padding:"20px",marginBottom:"20px",boxShadow:"0 4px 12px rgba(0,0,0,0.4)"},finalDuelCard:{background:"linear-gradient(135deg, rgba(60, 20, 20, 0.9), rgba(80, 30, 30, 0.9))",borderColor:"#ff4444"},actionHeader:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"12px",borderBottom:"1px solid rgba(255, 255, 255, 0.2)",paddingBottom:"10px"},actionTitle:{color:"#ffd700",fontSize:"18px",margin:0},actionCost:{color:"#66ff66",fontWeight:"bold",fontSize:"14px"},actionWarning:{color:"#ff6b6b",fontWeight:"bold",fontSize:"14px"},actionDesc:{color:"#ccc",lineHeight:"1.6",marginBottom:"15px",fontSize:"14px"},actionControls:{display:"flex",flexDirection:"column",gap:"12px",marginBottom:"12px"},actionControlsVertical:{display:"flex",flexDirection:"column",gap:"12px"},slider:{width:"100%",height:"8px"},select:{width:"100%",padding:"12px",background:"rgba(0, 0, 0, 0.5)",color:"#fff",border:"2px solid #8b4513",borderRadius:"6px",fontSize:"14px",cursor:"pointer"},rumorBtn:{width:"100%",padding:"14px 24px",border:"none",borderRadius:"8px",background:"linear-gradient(135deg, #6a5acd, #8b7ad8)",color:"white",fontWeight:"bold",fontSize:"15px",cursor:"pointer",boxShadow:"0 4px 8px rgba(0,0,0,0.3)",transition:"transform 0.2s"},hideBtn:{width:"100%",padding:"14px 24px",border:"none",borderRadius:"8px",background:"linear-gradient(135deg, #4a90e2, #5ba3f5)",color:"white",fontWeight:"bold",fontSize:"15px",cursor:"pointer",boxShadow:"0 4px 8px rgba(0,0,0,0.3)",transition:"transform 0.2s"},duelBtn:{width:"100%",background:"linear-gradient(135deg, #ff4444, #ff6b6b)",color:"white",fontSize:"16px",padding:"14px",border:"none",borderRadius:"8px",fontWeight:"bold",cursor:"pointer",boxShadow:"0 4px 8px rgba(0,0,0,0.3)"},actionInfo:{color:"#aaa",fontSize:"12px",marginTop:"5px"},actionWarningText:{color:"#ff6b6b",fontSize:"13px",textAlign:"center",marginTop:"10px",fontWeight:"bold"},powerComparison:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"15px",margin:"15px 0",padding:"15px",background:"rgba(0, 0, 0, 0.3)",borderRadius:"8px"},powerItem:{display:"flex",flexDirection:"column",alignItems:"center",gap:"5px",color:"#bbb",fontSize:"13px"},completed:{textAlign:"center",padding:"60px 40px",background:"linear-gradient(135deg, rgba(40, 80, 40, 0.8), rgba(60, 100, 60, 0.8))",border:"3px solid #4caf50",borderRadius:"16px",boxShadow:"0 8px 24px rgba(0,0,0,0.5)"},resultToast:{position:"fixed",bottom:"30px",left:"50%",transform:"translateX(-50%)",padding:"20px 30px",borderRadius:"12px",boxShadow:"0 8px 24px rgba(0,0,0,0.5)",zIndex:9999,minWidth:"300px",maxWidth:"500px",color:"white"},modalOverlay:{position:"fixed",inset:0,background:"rgba(0,0,0,0.65)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:99999},modalCard:{width:"90%",maxWidth:420,background:"rgba(24,17,13,0.95)",border:"1px solid rgba(255,255,255,0.2)",borderRadius:18,padding:"24px 24px 28px",textAlign:"center",boxShadow:"0 20px 45px rgba(0,0,0,0.45)"},modalIcon:{fontSize:42,marginBottom:12},modalText:{lineHeight:1.7,fontSize:15,color:"#f7d8b4",marginBottom:18},modalButton:{padding:"10px 20px",borderRadius:999,border:"none",background:"linear-gradient(120deg, #f06292, #f7b733)",color:"#fff",fontWeight:"bold",cursor:"pointer",boxShadow:"0 6px 18px rgba(240,98,146,0.45)"}},va=(e="")=>({base:0,skinColor:0,hair:1,hairColor:0,eye:0,eyeColor:1,mouth:0,gender:e}),W5=(e,t)=>!e||!t?!1:e.base===t.base&&e.skinColor===t.skinColor&&e.hair===t.hair&&e.hairColor===t.hairColor&&e.eye===t.eye&&e.eyeColor===t.eyeColor&&e.mouth===t.mouth&&e.gender===t.gender,a1=(e,t)=>{const n=e?{...e,gender:e.gender??t}:va(t);return W5(n,va(t))?null:n},l1=(e,t)=>e?{...va(t),...e,gender:e.gender??t}:va(t),wl=e=>{if(!e)return e;const t=e.gender;return{...e,avatar:a1(e.avatar,t),currentExp:Math.max(0,Math.floor((e==null?void 0:e.currentExp)||0)),maxExp:Math.max(1,Math.floor((e==null?void 0:e.maxExp)||1))}},kl=e=>{if(!e)return e;const t=e.gender;return{...e,avatar:l1(e.avatar,t),currentExp:Math.max(0,Math.floor(Number(e.currentExp)||0)),maxExp:Math.max(1,Math.floor(Number(e.maxExp)||1))}},xu=2e6,yu=(e,t)=>!Array.isArray(e)||e.length<=t?e:e.slice(-t),U5=(e,t=200,n=30)=>{if(!e||typeof e!="object")return e;const o=Object.keys(e).slice(-t),i={};for(const a of o){const l=e[a];i[a]=Array.isArray(l)?l.slice(-n):l}return i},G5=(e=[])=>{if(!Array.isArray(e))return e;const t=new Map,n=[];return e.forEach(s=>{if(!s)return;const o=s.id||s.itemId;if(!(s.stackable===!0&&o)){n.push(s);return}const a=o;if(!t.has(a)){const d={...s};d.quantity=0,d.instanceId=`${o}_stack`,t.set(a,d)}const l=t.get(a);l.quantity+=Number(s.quantity||1)}),[...n,...t.values()]},V5=(e=[])=>{const t=[],n={};let s=0;e.forEach(a=>{if(!a)return;if((a.generation||1)<=2){t.push(a);return}s+=1;const d=a.tierTitle||a.tier||"";n[d]=(n[d]||0)+1});const o=Object.entries(n).map(([a,l])=>({t:a,c:l})),i=s>0?{c:s,t:o}:void 0;return{mainlineChildren:t,descendantsSummary:i}},Y5=e=>{if(!e||!e.c)return[];const t=Array.isArray(e.t)?e.t:[{t:"",c:e.c}],n=[];let s=0;return t.forEach(({t:o,c:i})=>{const a=Number(i||0);for(let l=0;l<a;l+=1){s+=1;const d=s%2===0?"":"";n.push({id:`desc_${s}`,name:`${s}`,generation:3,age:20,gender:d,avatar:va(d),stats:{aptitude:50,looks:50,intelligence:50,lifespan:100},isTested:!0,isAdult:!0,cultivation:0,tierTitle:o||"",currentExp:0,maxExp:1})}}),n},Dg=(e,t={})=>{const{aggressive:n=!1}=t,s=e.player||{},o=s.rival,i=s.revengeProgress,a=s.revengeActions,{mainlineChildren:l,descendantsSummary:d}=V5(e.children||[]),u=n?void 0:yu(s.worldEvents,200),p=n?void 0:yu(s.newsBuffer,200),c=n?[]:Array.isArray(e.messages)?yu(e.messages,200):U5(e.messages,200,30),m=n?{}:e.lastMessageCheck||{},y=G5(e.inventory||[]),S=Array.isArray(e.logs)?e.logs.filter(E=>E&&E.category===""):[];return{v:2,p:{n:s.name,a:s.age,hp:s.hp,mhp:s.maxHp,cv:s.cultivation,ce:Math.max(0,Math.floor(s.currentExp||0)),me:Math.max(1,Math.floor(s.maxExp||1)),t:s.tier,tt:s.tierTitle,w:s.wealth,m:s.mood,tm:s.time,av:a1(s.avatar,s.gender),g:s.gender,ps:s.personality,ap:s.appearance,we:u,nb:p,fr:s.familyRatingSummary,frc:s.familyRating,bs:s.businesses||[],rs:s.resources||{spiritStones:0,money:0},sp:s.skillPoints||0,st:s.stats||{},cs:s.combatStats||{},pcs:s.childrenStrategy||{skipZhaozhou:!1},rv:o?{n:o.name,sid:o.stageId,t:o.tier,st:o.state,ls:o.lifeStage||0,tl:o.threatLevel||0,d:o.isDead||!1,rc:o.rumorCount||0,ht:o.hiddenTurns||0,ce:o.currentExp||0,stt:o.stats||{},cst:o.combatStats||{}}:void 0,rp:i?{si:i.currentStageIndex||0,cs:i.completedStages||[],sc:i.sagaComplete||!1}:void 0,ra:a?{lr:a.lastRumorMonth||0,tr:a.totalRumors||0,aa:a.assassinationAttempts||0,hm:a.hidingMonths||0}:void 0},ch:l.map(wl),d3:d,fc:(e.fallenChildren||[]).map(wl),an:(e.activeNpcs||[]).map(wl),dn:(e.deadNpcs||[]).map(wl),inv:y,lg:S,gs:e.gameStage,msg:c,lmc:m,psc:e.pendingSectChoices,tq:e.testQueue}},q5=e=>{const t=e.p||{},n=t.rv,s=t.rp,o=t.ra,i=(e.ch||[]).map(kl),a=Y5(e.d3);return{player:{name:t.n,age:t.a,hp:t.hp,maxHp:t.mhp,cultivation:t.cv,currentExp:Math.max(0,Math.floor(Number(t.ce)||0)),maxExp:Math.max(1,Math.floor(Number(t.me)||1)),tier:t.t,tierTitle:t.tt,wealth:t.w,mood:t.m,time:t.tm,avatar:l1(t.av,t.g),gender:t.g,personality:t.ps,appearance:t.ap,worldEvents:t.we,newsBuffer:t.nb,familyRatingSummary:t.fr,familyRating:t.frc,businesses:t.bs||[],resources:t.rs||{spiritStones:0,money:0},skillPoints:t.sp||0,stats:t.st||{},combatStats:t.cs||{},childrenStrategy:t.pcs||{skipZhaozhou:!1},rival:n?{name:n.n,stageId:n.sid,tier:n.t,state:n.st,lifeStage:n.ls||0,threatLevel:n.tl||0,isDead:n.d||!1,rumorCount:n.rc||0,hiddenTurns:n.ht||0,currentExp:n.ce||0,stats:n.stt||{},combatStats:n.cst||{}}:void 0,revengeProgress:s?{currentStageIndex:s.si||0,completedStages:s.cs||[],sagaComplete:s.sc||!1}:void 0,revengeActions:o?{lastRumorMonth:o.lr||0,totalRumors:o.tr||0,assassinationAttempts:o.aa||0,hidingMonths:o.hm||0}:void 0},children:[...i,...a],fallenChildren:(e.fc||[]).map(kl),activeNpcs:(e.an||[]).map(kl),deadNpcs:(e.dn||[]).map(kl),inventory:e.inv||[],logs:e.lg||[],gameStage:e.gs,messages:Array.isArray(e.msg)?e.msg:[],lastMessageCheck:e.lmc||{},pendingSectChoices:e.psc,testQueue:e.tq}},K5=(e,t="")=>{try{let n=Dg(e),s=JSON.stringify(n),o=btoa(unescape(encodeURIComponent(s)));if(o.length>xu&&(n=Dg(e,{aggressive:!0}),s=JSON.stringify(n),o=btoa(unescape(encodeURIComponent(s))),console.warn(" //")),o.length>xu)return console.error(` ${xu.toLocaleString()} `),null;const i=(o.length/1024).toFixed(2);return console.log(` : ${i} KB (C)`),o}catch(n){return console.error(" :",n),null}},es=(e="")=>{const t=e===""?[0,1,2]:[0,1,2,3],n=[0,1,2,3,4,5],s=[0,1,2,3,4,5,6,7],o=[0,1,2,3,4,5,6],i=[0,1,2,3,4,5],a=[0,1,2,3,4,5],l=[0,1,2,3,4],d=u=>u[Math.floor(Math.random()*u.length)];return{base:d(t),skinColor:d(n),hair:d(s),hairColor:d(o),eye:d(i),eyeColor:d(a),mouth:d(l)}},Li=(e,t="")=>{if(!e||typeof e!="object"||Object.keys(e).length===0)return console.log(" ..."),es(t);const n={...e};return!n.base&&n.base!==0&&(n.base=es(t).base),!n.skinColor&&n.skinColor!==0&&(n.skinColor=es(t).skinColor),!n.hair&&n.hair!==0&&(n.hair=es(t).hair),!n.hairColor&&n.hairColor!==0&&(n.hairColor=es(t).hairColor),!n.eye&&n.eye!==0&&(n.eye=es(t).eye),!n.eyeColor&&n.eyeColor!==0&&(n.eyeColor=es(t).eyeColor),!n.mouth&&n.mouth!==0&&(n.mouth=es(t).mouth),n},Q5=e=>{var t;try{const n=e.trim();if(!n)return console.error(" "),null;let s;try{s=decodeURIComponent(escape(atob(n)))}catch(l){return console.error(" Base64 :",l.message),null}let o;try{o=JSON.parse(s)}catch(l){return console.error(" JSON :",l.message),null}let i=o;if(o&&o.v===2&&o.p&&(i=q5(o)),!i.player)return console.error("  player "),null;!i.player.rival&&(o!=null&&o.rival)&&(i.player.rival=o.rival),!i.player.revengeProgress&&(o!=null&&o.revengeProgress)&&(i.player.revengeProgress=o.revengeProgress),!i.player.revengeActions&&(o!=null&&o.revengeActions)&&(i.player.revengeActions=o.revengeActions);const a=i.player;if(a){if(a.cultivation!==void 0){const l=Number(a.cultivation);a.cultivation=isNaN(l)?0:l}else a.cultivation=0;a.currentExp=Math.max(0,Math.floor(Number(a.currentExp)||0)),a.maxExp=Math.max(1,Math.floor(Number(a.maxExp)||1)),a.avatar=Li(a.avatar,a.gender),a.childrenStrategy?a.childrenStrategy.skipZhaozhou=a.childrenStrategy.skipZhaozhou??!1:a.childrenStrategy={skipZhaozhou:!1}}return Array.isArray(i.children)&&(i.children=i.children.map(l=>l&&(l.currentExp=Math.max(0,Math.floor(Number(l.currentExp)||0)),l.maxExp=Math.max(1,Math.floor(Number(l.maxExp)||1)),l.avatar=Li(l.avatar,l.gender),l))),Array.isArray(i.activeNpcs)&&(i.activeNpcs=i.activeNpcs.map(l=>l&&(l.currentExp=Math.max(0,Math.floor(Number(l.currentExp)||0)),l.maxExp=Math.max(1,Math.floor(Number(l.maxExp)||1)),l.avatar=Li(l.avatar,l.gender),l))),Array.isArray(i.deadNpcs)&&(i.deadNpcs=i.deadNpcs.map(l=>l&&(l.avatar=Li(l.avatar,l.gender),l))),Array.isArray(i.fallenChildren)&&(i.fallenChildren=i.fallenChildren.map(l=>l&&(l.avatar=Li(l.avatar,l.gender),l))),i.player.revengeProgress||(i.player.revengeProgress={currentStageIndex:0,completedStages:[],sagaComplete:!1}),i.player.revengeActions||(i.player.revengeActions={lastRumorMonth:0,totalRumors:0,assassinationAttempts:0,hidingMonths:0}),i.player.rival&&(i.player.rival.threatLevel=Math.max(0,Math.min(100,i.player.rival.threatLevel||0)),i.player.rival.isDead=i.player.rival.isDead||!1),console.log(" "),console.log(` : ${i.player.name}, : ${i.player.cultivation}`),console.log(` : ${i.player.currentExp}/${i.player.maxExp}`),console.log(` : ${(i.activeNpcs||[]).length}, : ${(i.children||[]).length}`),i.player.rival&&console.log(` :  ${(((t=i.player.revengeProgress)==null?void 0:t.currentStageIndex)||0)+1} , : ${i.player.rival.name}, : ${i.player.rival.threatLevel||0}`),i}catch(n){return console.error(" :",n),null}},J5=(e,t="save.txt")=>{try{const n=new Blob([e],{type:"text/plain;charset=utf-8"}),s=URL.createObjectURL(n),o=document.createElement("a");o.href=s,o.download=t,document.body.appendChild(o),o.click(),document.body.removeChild(o),URL.revokeObjectURL(s)}catch(n){console.error(":",n)}},X5=e=>new Promise((t,n)=>{const s=new FileReader;s.onload=o=>t(o.target.result),s.onerror=o=>n(o),s.readAsText(e)}),Z5=({gameState:e,onLoadGame:t,playerName:n=""})=>{const[s,o]=b.useState("export"),[i,a]=b.useState(""),[l,d]=b.useState(""),[u,p]=b.useState(""),[c,m]=b.useState("info"),y=3e3,[S,E]=b.useState("whole"),[w,g]=b.useState(1),[h,v]=b.useState(1),x=(F,B="info")=>{p(F),m(B),setTimeout(()=>p(""),5e3)},I=()=>{if(!e){x("","error");return}try{const F=K5(e,n);if(!F){x("","error");return}a(F);const B=Math.ceil(F.length/y);v(B),g(1),E(B>1?"paginated":"whole");const $=(F.length/1024).toFixed(2),Y=B>1?`${B}`:"";x(` : ${$} KB${Y}`,"success")}catch(F){console.error(":",F),x(": "+F.message,"error")}},_=()=>{if(!i){x("","error");return}let F=i;if(S==="paginated"&&h>1){const B=(w-1)*y,$=Math.min(B+y,i.length);F=i.substring(B,$)}navigator.clipboard.writeText(F).then(()=>{S==="paginated"&&h>1?x(`  ${w}/${h} `,"success"):x(" ","success")}).catch(()=>{x("","error")})},N=()=>{if(!i){x("","error");return}const F=new Date().toISOString().replace(/[:.]/g,"-"),B=`save_${n}_${F}.txt`;J5(i,B),x(" ","success")},C=async F=>{var $;const B=($=F.target.files)==null?void 0:$[0];if(B)try{const Y=await X5(B);d(Y),x(" ","success")}catch(Y){console.error(":",Y),x("","error")}},j=async()=>{try{const F=await navigator.clipboard.readText();d(F),x(" ","success")}catch(F){console.error(":",F),x("","error")}},T=()=>{var F,B;if(!l.trim()){x("","error");return}try{console.log(" ..."),console.log(":",l.trim().length),console.log(":",l.trim().substring(0,30));const $=Q5(l.trim());if(!$){console.error(" "),x(` 

 
  (F12) 
 
 `,"error");return}const Y=`
${((F=$.player)==null?void 0:F.name)||""}
${((B=$.player)==null?void 0:B.cultivation)||0}`;window.showConfirm&&window.showConfirm(Y,()=>{t&&t(null,$),x(" ","success"),d("")})}catch($){console.error(":",$),x(" : "+$.message,"error")}},A={container:{padding:"20px",background:"linear-gradient(135deg, rgba(76, 175, 80, 0.1) 0%, rgba(76, 175, 80, 0.05) 100%)",borderRadius:"8px",border:"1px solid rgba(76, 175, 80, 0.3)"},tabButtons:{display:"flex",gap:"10px",marginBottom:"20px"},tabButton:F=>({padding:"8px 16px",border:"none",borderRadius:"4px",background:F?"#4caf50":"#ddd",color:F?"white":"#333",cursor:"pointer",fontWeight:"bold",fontSize:"14px",transition:"all 0.3s"}),section:{marginBottom:"20px"},label:{display:"block",marginBottom:"8px",fontWeight:"bold",color:"#333"},input:{width:"100%",padding:"8px 12px",border:"1px solid #ccc",borderRadius:"4px",fontSize:"14px",fontFamily:"monospace",boxSizing:"border-box"},textarea:{width:"100%",minHeight:"150px",padding:"12px",border:"1px solid #ccc",borderRadius:"4px",fontSize:"12px",fontFamily:"monospace",boxSizing:"border-box",background:"#f9f9f9",color:"#333"},button:{padding:"8px 16px",margin:"5px 5px 5px 0",border:"none",borderRadius:"4px",background:"#4caf50",color:"white",cursor:"pointer",fontSize:"14px",fontWeight:"bold",transition:"background 0.3s"},buttonSecondary:{background:"#2196F3"},buttonDanger:{background:"#ff9800"},buttonDisabled:{background:"#ccc",cursor:"not-allowed"},message:{padding:"12px",borderRadius:"4px",marginBottom:"15px",fontSize:"14px",fontWeight:"bold"},messageSuccess:{background:"#c8e6c9",color:"#2e7d32",border:"1px solid #81c784"},messageError:{background:"#ffcdd2",color:"#c62828",border:"1px solid #ef5350"},messageInfo:{background:"#bbdefb",color:"#1565c0",border:"1px solid #64b5f6"},passwordContainer:{display:"flex",gap:"10px",alignItems:"center"},passwordInput:{flex:1},checkbox:{width:"18px",height:"18px",cursor:"pointer"},info:{fontSize:"12px",color:"#666",marginTop:"8px",padding:"8px",background:"#f0f0f0",borderRadius:"4px",borderLeft:"3px solid #2196F3"},fileInput:{display:"none"},fileInputLabel:{padding:"8px 16px",background:"#2196F3",color:"white",borderRadius:"4px",cursor:"pointer",fontSize:"14px",fontWeight:"bold",display:"inline-block",transition:"background 0.3s"}},V=()=>{const F=A.message;return c==="success"?{...F,...A.messageSuccess}:c==="error"?{...F,...A.messageError}:{...F,...A.messageInfo}};return r.jsxs("div",{style:A.container,children:[r.jsx("h3",{style:{marginTop:0,color:"#2e7d32"},children:" /"}),r.jsxs("div",{style:A.tabButtons,children:[r.jsx("button",{style:A.tabButton(s==="export"),onClick:()=>o("export"),children:" "}),r.jsx("button",{style:A.tabButton(s==="import"),onClick:()=>o("import"),children:" "})]}),u&&r.jsx("div",{style:V(),children:u}),s==="export"&&r.jsxs("div",{children:[r.jsx("div",{style:A.section,children:r.jsx("button",{style:A.button,onClick:I,children:" "})}),i&&r.jsxs("div",{style:A.section,children:[r.jsxs("label",{style:A.label,children:[" ",r.jsxs("span",{style:{marginLeft:"10px",color:"#2196F3",fontSize:"13px",fontWeight:"normal"},children:[": ",i.length.toLocaleString()]})]}),r.jsxs("div",{style:{marginBottom:"12px",padding:"10px",background:h>1?"#fff3e0":"#f5f5f5",borderRadius:"4px",border:h>1?"1px solid #ffe0b2":"1px solid #ddd"},children:[r.jsx("div",{style:{marginBottom:"8px",fontWeight:"bold",color:h>1?"#e65100":"#666"},children:h>1?" ":"  ("+i.length+")"}),r.jsxs("div",{style:{display:"flex",gap:"10px",alignItems:"center",flexWrap:"wrap"},children:[r.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"5px",cursor:"pointer"},children:[r.jsx("input",{type:"radio",name:"copyMode",value:"whole",checked:S==="whole",onChange:F=>E(F.target.value),style:{cursor:"pointer"}}),r.jsxs("span",{children:[" ",h===1?"()":"()"]})]}),r.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"5px",cursor:"pointer"},children:[r.jsx("input",{type:"radio",name:"copyMode",value:"paginated",checked:S==="paginated",onChange:F=>E(F.target.value),style:{cursor:"pointer"}}),r.jsxs("span",{children:[" ",h>1?"()":"()"]})]})]})]}),S==="paginated"&&h>1&&r.jsxs("div",{style:{marginBottom:"12px",padding:"10px",background:"#e3f2fd",borderRadius:"4px",border:"1px solid #bbdefb"},children:[r.jsxs("div",{style:{marginBottom:"8px",fontWeight:"bold",color:"#1565c0"},children:["  ",w,"/",h]}),r.jsxs("div",{style:{display:"flex",gap:"8px",alignItems:"center",flexWrap:"wrap"},children:[r.jsx("button",{style:{...A.button,...A.buttonSecondary,opacity:w===1?.5:1,cursor:w===1?"not-allowed":"pointer"},onClick:()=>g(Math.max(1,w-1)),disabled:w===1,children:" "}),r.jsx("select",{value:w,onChange:F=>g(parseInt(F.target.value)),style:{padding:"6px 10px",border:"1px solid #ccc",borderRadius:"4px",fontSize:"14px",cursor:"pointer"},children:Array.from({length:h},(F,B)=>r.jsxs("option",{value:B+1,children:[" ",B+1," "]},B+1))}),r.jsx("button",{style:{...A.button,...A.buttonSecondary,opacity:w===h?.5:1,cursor:w===h?"not-allowed":"pointer"},onClick:()=>g(Math.min(h,w+1)),disabled:w===h,children:" "})]}),r.jsx("div",{style:{fontSize:"12px",color:"#666",marginTop:"8px"},children:" "})]}),r.jsx("textarea",{value:S==="paginated"&&h>1?i.substring((w-1)*y,Math.min(w*y,i.length)):i,readOnly:!0,style:A.textarea}),r.jsxs("div",{style:{marginTop:"10px"},children:[r.jsxs("button",{style:A.button,onClick:_,children:[" ",S==="paginated"&&h>1?` ${w} `:""]}),r.jsx("button",{style:{...A.button,...A.buttonSecondary},onClick:N,children:" "})]}),r.jsxs("div",{style:A.info,children:[" ",h>1&&r.jsxs(r.Fragment,{children:[r.jsx("br",{}),"  ",h,' ""']})]})]})]}),s==="import"&&r.jsxs("div",{children:[r.jsxs("div",{style:A.section,children:[r.jsx("label",{style:A.label,children:" "}),r.jsx("input",{type:"file",accept:".txt,.json",onChange:C,style:A.fileInput,id:"saveFileInput"}),r.jsx("label",{htmlFor:"saveFileInput",style:A.fileInputLabel,children:" "}),r.jsx("button",{style:{...A.button,...A.buttonSecondary,marginLeft:"10px"},onClick:j,children:" "})]}),r.jsxs("div",{style:A.section,children:[r.jsx("label",{style:A.label,children:" "}),r.jsx("textarea",{value:l,onChange:F=>d(F.target.value),placeholder:"...",style:A.textarea})]}),r.jsxs("div",{style:A.section,children:[r.jsx("button",{style:A.button,onClick:T,children:" "}),r.jsx("button",{style:{...A.button,...A.buttonDanger},onClick:()=>{d("")},children:" "})]}),r.jsx("div",{style:A.info,children:" "})]})]})},eC=({player:e,onSave:t,onLoad:n,onReset:s,onOpenGuide:o,autoAssignEnabled:i=!1,onToggleAutoAssign:a,autoSkipSpiritTest:l=!1,onToggleAutoSkip:d,skipChildGiftPopups:u=!1,onToggleSkipChildGiftPopups:p,skipShuraFieldEvents:c=!1,onToggleSkipShuraFieldEvents:m,skipRomanceGiftPopups:y=!1,onToggleSkipRomanceGiftPopups:S,skipJealousyPopups:E=!1,onToggleSkipJealousyPopups:w,skipZhaozhou:g=!1,onToggleSkipZhaozhou:h,isPortraitViewport:v=!0,isOrientationFixApplied:x=!1,onRequestPortraitFix:I=()=>{},onReleasePortraitFix:_=()=>{},onAutoAssignSpouses:N=()=>{},onRedeemCode:C=null,gameState:j=null})=>{const[T,A]=b.useState([]),[V,F]=b.useState([]),[B,$]=b.useState({used:"0",usedMB:"0"}),[Y,ne]=b.useState({enabled:!1,syncing:!1}),[X,ee]=b.useState([]),[ae,Te]=b.useState(!1),[Be,ze]=b.useState(""),[W,J]=b.useState(""),[fe,re]=b.useState(""),[ce,Ce]=b.useState(!1),[Ge,Ne]=b.useState(null),[nt,Le]=b.useState(!0),[z,ue]=b.useState(!0),[ve,ge]=b.useState(!0),[Ee,Ke]=b.useState(!0),[Ut,xn]=b.useState(!0),[Et,lr]=b.useState(!1),[Kr,Qs]=b.useState(null),[cr,Ta]=b.useState(!1),[Rn,ln]=b.useState(!1),[Ia,Tr]=b.useState(!1),[ti,Qc]=b.useState(!1),[dr,_a]=b.useState(!1),[Ae,ur]=b.useState(!1),[Ra,cn]=b.useState(!1),[zn,Js]=b.useState(!1),[Ma,Xs]=b.useState(!1),[Aa,Jc]=b.useState(!1),[Xc,Zs]=b.useState(null),[Na,eo]=b.useState(""),[Ir,_r]=b.useState(null),to=[{key:"autoAssign",label:"",brief:"12",detail:["","1)  12 ","2) ","3) "].join(`
`),checked:!!i,onChange:a},{key:"autoSpirit",label:"",brief:"",detail:["","1) ","2) ","3) "].join(`
`),checked:!!l,onChange:d},{key:"skipGiftModal",label:"",brief:"",detail:["","1) ","2) ","3) "].join(`
`),checked:!!u,onChange:p},{key:"skipZhaozhou",label:"",brief:"",detail:["","1) ",'2) ""',"3) "].join(`
`),checked:!!g,onChange:h}],Zc=[i?"":"",l?"":"",u?"":"",g?"":""].join("  "),ed=[{key:"skipShura",label:"",brief:"",detail:["","1) ","2) ","3) "].join(`
`),checked:!!c,onChange:m},{key:"skipRomanceGift",label:"",brief:"NPC ",detail:["","1) ","2) ","3) "].join(`
`),checked:!!y,onChange:S},{key:"skipJealousy",label:"",brief:"",detail:["","1) ","2) ","3) "].join(`
`),checked:!!E,onChange:w}],td=[c?"":"",y?"":"",E?"":""].join("  "),nd=U=>{Qs($e=>$e===U?null:U)},La=U=>{Zs($e=>$e===U?null:U)},ni=()=>{if(typeof C!="function"){_r({success:!1,message:""});return}const U=C(Na);U!=null&&U.success&&eo(""),_r(U||{success:!1,message:""})},ri=T.filter(U=>U.exists).length,Es=V.filter(U=>U.exists).length,rd=`${Be?"API Key ":"API Key "}   ${fe||""}`,si=nt?"":"",oi=`${z?"AI":""}  ${ve?"":""}  ${Ee?"":""}`,sd=Ut?"AI ":"",$a=` ${ri}    ${Es}   ${B.usedMB} MB`,Ba="",od=`${v?"":""}  ${x?"":""}`;b.useEffect(()=>{pr(),ro(),id(),so(),js(),no();const U=$e=>{console.log(""),ro(),js()};window.addEventListener("autoSaveCompleted",U);try{const $e="__test__";localStorage.setItem($e,"test"),localStorage.removeItem($e)}catch($e){console.error("localStorage :",$e),window.showResult&&window.showResult("",` 


1. 
2. 
3. 

`,!1,null,!1)}return()=>{window.removeEventListener("autoSaveCompleted",U)}},[]),b.useEffect(()=>{dr&&(console.log(""),pr(),ro(),js())},[dr]);const no=()=>{const U=s1();ne(U),U.enabled&&Oa()},Oa=async()=>{try{Te(!0);const U=await Ub();ee(U)}catch(U){console.error(":",U)}finally{Te(!1)}},pr=()=>{try{const U=Pf();console.log(":",U),A(U),js()}catch(U){console.error(":",U),A([{slot:1,exists:!1},{slot:2,exists:!1},{slot:3,exists:!1}])}},ro=()=>{try{const U=Zy();console.log(":",U),F(U)}catch(U){console.error(":",U),F([])}},js=()=>{const U=qy();$(U)},so=()=>{const U=localStorage.getItem("enableGazette"),$e=localStorage.getItem("useAIForLetter"),Dn=localStorage.getItem("useAIForTianjiProfile"),Pt=localStorage.getItem("acceptChildLetters"),Qr=localStorage.getItem("acceptLoverLetters");Le(U!=="false"),ue($e!=="false"),xn(Dn!=="false"),ge(Pt!=="false"),Ke(Qr!=="false")},ii=()=>{localStorage.setItem("enableGazette",nt.toString()),localStorage.setItem("useAIForLetter",z.toString()),localStorage.setItem("useAIForTianjiProfile",Ut.toString()),localStorage.setItem("acceptChildLetters",ve.toString()),localStorage.setItem("acceptLoverLetters",Ee.toString()),window.showResult&&window.showResult("","",!0,null,!1)},id=()=>{const U=localStorage.getItem("game_api_key")||"",$e=localStorage.getItem("game_api_url")||"https://api.deepseek.com/chat/completions",Dn=localStorage.getItem("game_api_model")||"deepseek-chat";ze(U),J($e),re(Dn)},Pa=()=>{localStorage.setItem("game_api_key",Be),localStorage.setItem("game_api_url",W),localStorage.setItem("game_api_model",fe),window.showResult&&window.showResult("AI ","AI ",!0,null,!1),Ne(null)},ad=async()=>{if(!Be||!W){window.showResult&&window.showResult(""," API Key  URL",!1,null,!1);return}Ce(!0),Ne(null);try{const U=await ME(Be,W);Ne(U?{success:!0,message:" API "}:{success:!1,message:" "})}catch(U){Ne({success:!1,message:` : ${U.message}`})}finally{Ce(!1)}},ai=U=>{const $e=t(U);window.showResult&&($e.success?(window.showResult("",` : ${U}
: ${$e.time}
: ${$e.size} KB`,!0,null,!1),pr()):$e.error==="QUOTA_EXCEEDED"?window.showResult("",` 


1. 
2. 
3. 

: ${$e.size||""} KB`,!1,null,!1):$e.error==="STORAGE_TOO_LARGE"?window.showResult("",` ${$e.size} KB



`,!1,null,!1):window.showResult("",` 

: ${$e.error||""}
: ${$e.message||""}


1. 
2. 
3. `,!1,null,!1))},ld=U=>{window.showConfirm&&window.showConfirm(` ${U} `,()=>n(U))},oo=U=>{window.showConfirm&&window.showConfirm(` ${U} `,()=>{Jy(U),pr(),window.showResult&&window.showResult("",` ${U} `,!0,null,!1)})},cd=(U=1)=>{try{if(!j){window.showResult&&window.showResult(""," ",!1,null,!1);return}const $e=JSON.stringify(j).length/1024,Dn=oh(j),Pt=Gb(j,Dn),Qr=JSON.stringify(Dn).length/1024;console.log(" :",Pt),console.log(` : ${$e.toFixed(2)} KB -> ${Qr.toFixed(2)} KB ( ${($e-Qr).toFixed(2)} KB)`);const fr=t(U,Dn);if(fr&&fr.success){const pd=` 

:
- :  ${Pt.mainLogsRemoved}  ${Pt.mainLogsKept} 
- NPC:  ${Pt.npcLogsRemoved}  ${Pt.npcLogsKept} 
- : ${Pt.totalRemoved} 

: ${Qr.toFixed(2)} KB
: ${($e-Qr).toFixed(2)} KB`;window.showResult&&window.showResult("",pd,!0,null,!1),pr(),js()}else window.showResult&&window.showResult("",` 
${(fr==null?void 0:fr.message)||""}`,!1,null,!1)}catch($e){console.error(":",$e),window.showResult&&window.showResult("",` : ${$e.message}`,!1,null,!1)}},li=U=>{window.showConfirm&&window.showConfirm(` ${U} `,()=>{try{const $e=e1(U);$e?(n(null,$e),window.showResult&&window.showResult("",`  ${U} 
: ${$e.gameTime||""}`,!0,null,!1)):window.showResult&&window.showResult(""," ",!1,null,!1)}catch($e){console.error(":",$e),window.showResult&&window.showResult(""," "+$e.message,!1,null,!1)}})},dd=()=>{window.showConfirm&&window.showConfirm(`

`,()=>{t1(),ro(),window.showResult&&window.showResult(""," ",!0,null,!1)})},io=()=>{window.showConfirm&&window.showConfirm(" ",()=>{s(),pr()})},ud=async U=>{if(!Y.enabled){window.showResult&&window.showResult("",` 
 TapTap `,!1,null,!1);return}window.showConfirm&&window.showConfirm(` ${U} `,async()=>{try{Te(!0);const $e=await n1(U);window.showResult&&window.showResult("",` 

: ${$e.action==="create"?"":""}
UUID: ${$e.uuid}`,!0,null,!1),await Oa()}catch($e){window.showResult&&window.showResult("",` 

${$e.message}


 65
 
 5MB`,!1,null,!1)}finally{Te(!1)}})},za=async U=>{if(!Y.enabled){window.showResult&&window.showResult("",` 
 TapTap `,!1,null,!1);return}window.showConfirm&&window.showConfirm(` ${U} `,async()=>{var $e,Dn;try{Te(!0);const Pt=await r1(U);window.showResult&&window.showResult("",` 

: ${(($e=Pt.player)==null?void 0:$e.name)||""}
: ${((Dn=Pt.player)==null?void 0:Dn.cultivation)||0} `,!0,null,!1),pr()}catch(Pt){window.showResult&&window.showResult("",` 

${Pt.message}`,!1,null,!1)}finally{Te(!1)}})};return r.jsxs("div",{style:{padding:"20px"},children:[r.jsx("h3",{style:{borderBottom:"1px solid #ccc",paddingBottom:"10px"},children:" "}),r.jsxs("div",{style:G.collapsibleCard,children:[r.jsxs("button",{type:"button",style:G.collapsibleHeader,onClick:()=>lr(U=>!U),children:[r.jsxs("div",{style:G.collapsibleTitleRow,children:[r.jsx("span",{children:" "}),r.jsx("span",{style:G.collapsibleHint,children:Et?"":""})]}),r.jsxs("div",{style:G.collapsibleSummary,children:["",Zc]})]}),Et&&r.jsxs("div",{style:G.collapseBody,children:[r.jsx("p",{style:{...G.info,marginBottom:"10px"},children:""}),r.jsx("div",{style:G.optionGroup,children:to.map(U=>r.jsxs("div",{style:G.optionCard,children:[r.jsxs("div",{style:G.optionRow,children:[r.jsxs("label",{style:G.optionToggle,children:[r.jsx("input",{type:"checkbox",checked:U.checked,onChange:$e=>U.onChange&&U.onChange($e.target.checked)}),r.jsx("span",{children:U.checked?"":""})]}),r.jsxs("button",{type:"button",style:G.optionText,onClick:()=>nd(U.key),children:[r.jsxs("div",{style:G.optionTitleRow,children:[r.jsx("span",{children:U.label}),r.jsx("span",{style:G.detailHint,children:Kr===U.key?"":""})]}),r.jsx("div",{style:G.optionBrief,children:U.brief})]})]}),Kr===U.key&&r.jsx("div",{style:G.optionDetail,children:U.detail})]},U.key))}),r.jsxs("div",{style:G.familyActionCard,children:[r.jsxs("div",{style:G.familyActionHeader,children:[r.jsx("span",{children:" "}),r.jsx("span",{style:{fontSize:"11px",color:"#8d6e63"},children:""})]}),r.jsx("p",{style:G.familyActionDesc,children:" 500 "}),r.jsx("button",{type:"button",style:G.familyActionBtn,onClick:()=>N&&N(),children:" "}),r.jsx("small",{style:G.hint,children:""})]})]})]}),r.jsxs("div",{style:G.collapsibleCard,children:[r.jsxs("button",{type:"button",style:G.collapsibleHeader,onClick:()=>Jc(U=>!U),children:[r.jsxs("div",{style:G.collapsibleTitleRow,children:[r.jsx("span",{children:" "}),r.jsx("span",{style:G.collapsibleHint,children:Aa?"":""})]}),r.jsxs("div",{style:G.collapsibleSummary,children:["",td]})]}),Aa&&r.jsxs("div",{style:G.collapseBody,children:[r.jsx("p",{style:{...G.info,marginBottom:"10px"},children:""}),r.jsx("div",{style:G.optionGroup,children:ed.map(U=>r.jsxs("div",{style:G.optionCard,children:[r.jsxs("div",{style:G.optionRow,children:[r.jsxs("label",{style:G.optionToggle,children:[r.jsx("input",{type:"checkbox",checked:U.checked,onChange:$e=>U.onChange&&U.onChange($e.target.checked)}),r.jsx("span",{children:U.checked?"":""})]}),r.jsxs("button",{type:"button",style:G.optionText,onClick:()=>La(U.key),children:[r.jsxs("div",{style:G.optionTitleRow,children:[r.jsx("span",{children:U.label}),r.jsx("span",{style:G.detailHint,children:Xc===U.key?"":""})]}),r.jsx("div",{style:G.optionBrief,children:U.brief})]})]}),Xc===U.key&&r.jsx("div",{style:G.optionDetail,children:U.detail})]},U.key))})]})]}),r.jsxs("div",{style:G.collapsibleCard,children:[r.jsxs("button",{type:"button",style:G.collapsibleHeader,onClick:()=>Xs(U=>!U),children:[r.jsxs("div",{style:G.collapsibleTitleRow,children:[r.jsx("span",{children:" "}),r.jsx("span",{style:G.collapsibleHint,children:Ma?"":""})]}),r.jsx("div",{style:G.collapsibleSummary,children:od})]}),Ma&&r.jsxs("div",{style:G.collapseBody,children:[r.jsx("p",{style:G.info,children:" UI "}),r.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"10px"},children:[r.jsx("button",{onClick:I,style:{...G.saveBtn,width:"100%"},children:" "}),r.jsx("button",{onClick:_,style:{...G.btn,width:"100%",border:"1px solid #d32f2f",color:"#d32f2f"},disabled:!x,children:" "})]}),r.jsx("small",{style:G.hint,children:""})]})]}),r.jsxs("div",{style:G.collapsibleCard,children:[r.jsxs("button",{type:"button",style:G.collapsibleHeader,onClick:()=>Ta(U=>!U),children:[r.jsxs("div",{style:G.collapsibleTitleRow,children:[r.jsx("span",{children:" AI "}),r.jsx("span",{style:G.collapsibleHint,children:cr?"":""})]}),r.jsx("div",{style:G.collapsibleSummary,children:rd})]}),cr&&r.jsxs("div",{style:G.collapseBody,children:[r.jsxs("p",{style:G.info,children:[" API NPC ",r.jsx("br",{}),r.jsx("small",{style:{color:"#999"},children:" DeepSeek "})]}),r.jsxs("div",{style:G.formGroup,children:[r.jsx("label",{style:G.label,children:":"}),r.jsxs("select",{onChange:U=>{U.target.value==="deepseek"&&(J("https://api.deepseek.com/chat/completions"),re("deepseek-chat")),U.target.value=""},style:G.select,children:[r.jsx("option",{value:"",children:"..."}),r.jsx("option",{value:"deepseek",children:" DeepSeek"})]}),r.jsx("small",{style:G.hint,children:" URL  API Key"})]}),r.jsxs("div",{style:G.formGroup,children:[r.jsx("label",{style:G.label,children:"API Key:"}),r.jsx("input",{type:"password",value:Be,onChange:U=>ze(U.target.value),placeholder:"sk-xxxxxxxxxxxxxxxx",style:G.input}),r.jsxs("small",{style:G.hint,children:[" Key:",r.jsx("a",{href:"https://platform.deepseek.com/",target:"_blank",rel:"noopener",children:" DeepSeek"})]})]}),r.jsxs("div",{style:G.formGroup,children:[r.jsx("label",{style:G.label,children:"API URL:"}),r.jsx("input",{type:"text",value:W,onChange:U=>J(U.target.value),placeholder:"https://api.deepseek.com/chat/completions",style:G.input}),r.jsx("small",{style:G.hint,children:"DeepSeek: https://api.deepseek.com/chat/completions"})]}),r.jsxs("div",{style:G.formGroup,children:[r.jsx("label",{style:G.label,children:":"}),r.jsx("input",{type:"text",value:fe,onChange:U=>re(U.target.value),placeholder:"deepseek-chat",style:G.input}),r.jsx("small",{style:G.hint,children:"DeepSeek: deepseek-chat"})]}),Ge&&r.jsx("div",{style:{...G.statusBox,background:Ge.success?"#e8f5e9":"#ffebee",color:Ge.success?"#2e7d32":"#c62828"},children:Ge.message}),r.jsxs("div",{style:G.btnGroup,children:[r.jsx("button",{onClick:Pa,style:G.saveBtn,children:" "}),r.jsx("button",{onClick:ad,style:{...G.btn,background:"#2196f3",color:"white",border:"none"},disabled:ce,children:ce?"...":" "})]})]})]}),r.jsxs("div",{style:G.collapsibleCard,children:[r.jsxs("button",{type:"button",style:G.collapsibleHeader,onClick:()=>ln(U=>!U),children:[r.jsxs("div",{style:G.collapsibleTitleRow,children:[r.jsx("span",{children:" "}),r.jsx("span",{style:G.collapsibleHint,children:Rn?"":""})]}),r.jsx("div",{style:G.collapsibleSummary,children:si})]}),Rn&&r.jsxs("div",{style:G.collapseBody,children:[r.jsxs("p",{style:G.info,children:["NPC",r.jsx("br",{}),r.jsx("small",{style:{color:"#999"},children:""})]}),r.jsxs("div",{style:G.formGroup,children:[r.jsxs("label",{style:G.checkboxLabel,children:[r.jsx("input",{type:"checkbox",checked:nt,onChange:U=>Le(U.target.checked),style:G.checkbox}),r.jsx("span",{children:""})]}),r.jsx("small",{style:G.hint,children:""})]}),r.jsx("button",{onClick:ii,style:G.saveBtn,children:" "})]})]}),r.jsxs("div",{style:G.collapsibleCard,children:[r.jsxs("button",{type:"button",style:G.collapsibleHeader,onClick:()=>Tr(U=>!U),children:[r.jsxs("div",{style:G.collapsibleTitleRow,children:[r.jsx("span",{children:" "}),r.jsx("span",{style:G.collapsibleHint,children:Ia?"":""})]}),r.jsx("div",{style:G.collapsibleSummary,children:oi})]}),Ia&&r.jsxs("div",{style:G.collapseBody,children:[r.jsxs("p",{style:G.info,children:["NPC",r.jsx("br",{}),r.jsx("small",{style:{color:"#999"},children:"AI"})]}),r.jsxs("div",{style:G.formGroup,children:[r.jsxs("label",{style:G.checkboxLabel,children:[r.jsx("input",{type:"checkbox",checked:z,onChange:U=>ue(U.target.checked),style:G.checkbox}),r.jsx("span",{children:"AI"})]}),r.jsx("small",{style:G.hint,children:"API Key"})]}),r.jsxs("div",{style:G.formGroup,children:[r.jsxs("label",{style:G.checkboxLabel,children:[r.jsx("input",{type:"checkbox",checked:ve,onChange:U=>ge(U.target.checked),style:G.checkbox}),r.jsx("span",{children:""})]}),r.jsx("small",{style:G.hint,children:""})]}),r.jsxs("div",{style:G.formGroup,children:[r.jsxs("label",{style:G.checkboxLabel,children:[r.jsx("input",{type:"checkbox",checked:Ee,onChange:U=>Ke(U.target.checked),style:G.checkbox}),r.jsx("span",{children:""})]}),r.jsx("small",{style:G.hint,children:""})]}),r.jsx("button",{onClick:ii,style:G.saveBtn,children:" "})]})]}),r.jsxs("div",{style:G.collapsibleCard,children:[r.jsxs("button",{type:"button",style:G.collapsibleHeader,onClick:()=>Qc(U=>!U),children:[r.jsxs("div",{style:G.collapsibleTitleRow,children:[r.jsx("span",{children:" "}),r.jsx("span",{style:G.collapsibleHint,children:ti?"":""})]}),r.jsx("div",{style:G.collapsibleSummary,children:sd})]}),ti&&r.jsxs("div",{style:G.collapseBody,children:[r.jsxs("p",{style:G.info,children:[" AI ",r.jsx("br",{}),r.jsx("small",{style:{color:"#999"},children:""}),r.jsx("br",{}),r.jsx("small",{style:{color:"#999"},children:"/ AI "})]}),r.jsxs("div",{style:G.formGroup,children:[r.jsxs("label",{style:G.checkboxLabel,children:[r.jsx("input",{type:"checkbox",checked:Ut,onChange:U=>xn(U.target.checked),style:G.checkbox}),r.jsx("span",{children:" AI "})]}),r.jsx("small",{style:G.hint,children:" API Key"})]}),r.jsx("button",{onClick:ii,style:G.saveBtn,children:" "})]})]}),r.jsxs("div",{style:G.collapsibleCard,children:[r.jsxs("button",{type:"button",style:G.collapsibleHeader,onClick:()=>_a(U=>!U),children:[r.jsxs("div",{style:G.collapsibleTitleRow,children:[r.jsx("span",{children:" "}),r.jsx("span",{style:G.collapsibleHint,children:dr?"":""})]}),r.jsx("div",{style:G.collapsibleSummary,children:$a})]}),dr&&r.jsxs("div",{style:G.collapseBody,children:[r.jsxs("p",{style:G.info,children:["",Y.enabled&&r.jsx("span",{style:{color:"#4caf50",fontWeight:"bold"},children:"  "})]}),r.jsxs("div",{style:{background:"linear-gradient(135deg, #667eea 0%, #764ba2 100%)",borderRadius:"8px",padding:"15px",marginBottom:"20px",color:"white"},children:[r.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"10px"},children:[r.jsx("h5",{style:{margin:0,fontSize:"16px"},children:" 3"}),V.some(U=>U.exists)&&r.jsx("button",{onClick:dd,style:{background:"rgba(255,255,255,0.2)",border:"1px solid rgba(255,255,255,0.3)",color:"white",padding:"4px 10px",borderRadius:"4px",fontSize:"11px",cursor:"pointer"},children:" "})]}),r.jsx("p",{style:{fontSize:"12px",margin:"0 0 15px 0",opacity:.9},children:" 3"}),V.length===0?r.jsx("div",{style:{background:"rgba(255,255,255,0.1)",borderRadius:"5px",padding:"15px",textAlign:"center",fontSize:"13px"},children:""}):r.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"10px"},children:[V.filter(U=>U.exists).map(U=>r.jsxs("div",{style:{background:"rgba(255,255,255,0.15)",borderRadius:"6px",padding:"12px",backdropFilter:"blur(10px)"},children:[r.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"8px"},children:[r.jsxs("div",{style:{fontSize:"13px",fontWeight:"bold"},children:["#",U.slot," - ",U.gameTime||""]}),r.jsx("div",{style:{background:"rgba(76, 175, 80, 0.8)",padding:"2px 8px",borderRadius:"10px",fontSize:"11px"},children:U.tier||""})]}),r.jsxs("div",{style:{fontSize:"11px",opacity:.9,marginBottom:"8px"},children:[r.jsxs("div",{children:[": ",U.playerName||""," | : ",U.cultivation||0," | : ",U.age||0,""]}),r.jsxs("div",{children:[": ",U.saveDate||""]})]}),r.jsx("button",{onClick:()=>li(U.slot),style:{background:"rgba(33, 150, 243, 0.9)",border:"none",color:"white",padding:"6px 15px",borderRadius:"4px",fontSize:"12px",cursor:"pointer",width:"100%",fontWeight:"bold"},children:" "})]},U.slot)),V.filter(U=>U.exists).length===0&&r.jsx("div",{style:{background:"rgba(255,255,255,0.1)",borderRadius:"5px",padding:"15px",textAlign:"center",fontSize:"13px"},children:""})]})]}),r.jsxs("div",{style:{background:"#fff3cd",border:"1px solid #ffc107",borderRadius:"8px",padding:"12px",marginBottom:"15px"},children:[r.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"10px"},children:[r.jsx("div",{style:{fontSize:"14px",fontWeight:"bold",color:"#856404"},children:" "}),r.jsx("span",{style:{fontSize:"11px",color:"#856404",opacity:.8},children:"3+"})]}),r.jsxs("div",{style:{fontSize:"12px",color:"#856404",marginBottom:"10px",lineHeight:"1.5"},children:[" 3",r.jsx("br",{}),' ""',r.jsx("br",{})," ",r.jsx("br",{})," NPC"]}),r.jsx("button",{onClick:()=>{window.showConfirm&&window.showConfirm(`

- 3
- 
- 

""`,()=>{cd()})},style:{background:"#ffc107",border:"none",color:"#000",padding:"8px 16px",borderRadius:"4px",fontSize:"13px",fontWeight:"bold",cursor:"pointer",width:"100%"},children:" "})]}),Y.enabled&&r.jsxs("div",{style:{background:"#e8f5e9",border:"1px solid #4caf50",borderRadius:"5px",padding:"10px",marginBottom:"15px",fontSize:"12px"},children:[r.jsx("div",{style:{fontWeight:"bold",marginBottom:"5px",color:"#2e7d32"},children:" TapTap "}),r.jsxs("div",{style:{color:"#555"},children:[" ",r.jsx("br",{})," ",r.jsx("br",{})," ",r.jsx("br",{})," 1/"]}),Y.syncing&&r.jsx("div",{style:{marginTop:"8px",color:"#ff9800"},children:" ..."})]}),r.jsxs("div",{style:{background:"#f5f5f5",padding:"10px",borderRadius:"5px",marginBottom:"15px",fontSize:"12px"},children:[r.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:"5px"},children:[r.jsx("span",{children:" :"}),r.jsxs("span",{children:[r.jsxs("strong",{children:[B.usedMB," MB"]})," / 100 MB"]})]}),r.jsx("div",{style:{height:"8px",background:"#ddd",borderRadius:"4px",overflow:"hidden"},children:r.jsx("div",{style:{height:"100%",background:B.usedMB>80?"#f44336":B.usedMB>60?"#ff9800":"#4caf50",width:`${Math.min(B.usedMB/100*100,100)}%`,transition:"width 0.3s"}})}),B.usedMB>80&&r.jsx("div",{style:{color:"#f44336",marginTop:"5px",fontSize:"11px"},children:" "})]}),r.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"15px"},children:T.length===0?r.jsx("div",{style:{padding:"20px",textAlign:"center",color:"#999",background:"#f5f5f5",borderRadius:"5px"},children:"..."}):T.map(U=>r.jsxs("div",{style:G.slotCard,children:[r.jsxs("div",{style:G.slotHeader,children:[r.jsxs("span",{style:G.slotTitle,children:[" ",U.slot]}),U.exists&&r.jsx("span",{style:G.slotBadge,children:""})]}),U.exists?r.jsxs("div",{style:G.slotInfo,children:[r.jsxs("div",{style:{fontSize:"12px",color:"#666",marginBottom:"8px"},children:[r.jsxs("div",{children:[": ",U.playerName]}),U.cultivation>0&&r.jsxs("div",{children:[": ",U.cultivation," "]}),r.jsxs("div",{children:[": ",U.saveDate]})]}),r.jsxs("div",{style:{...G.btnGroup,gap:"8px",flexWrap:"wrap"},children:[r.jsx("button",{onClick:()=>ai(U.slot),style:{...G.slotBtn,background:"#4caf50",color:"white"},children:" "}),r.jsx("button",{onClick:()=>ld(U.slot),style:{...G.slotBtn,background:"#2196f3",color:"white"},children:" "}),r.jsx("button",{onClick:()=>oo(U.slot),style:{...G.slotBtn,background:"#f44336",color:"white"},children:" "}),Y.enabled&&r.jsxs(r.Fragment,{children:[r.jsx("button",{onClick:()=>ud(U.slot),style:{...G.slotBtn,background:"#ff9800",color:"white"},disabled:ae,children:" "}),r.jsx("button",{onClick:()=>za(U.slot),style:{...G.slotBtn,background:"#9c27b0",color:"white"},disabled:ae,children:" "})]})]})]}):r.jsxs("div",{style:G.slotInfo,children:[r.jsx("div",{style:{fontSize:"13px",color:"#999",marginBottom:"10px"},children:""}),r.jsxs("div",{style:{...G.btnGroup,gap:"8px"},children:[r.jsx("button",{onClick:()=>ai(U.slot),style:{...G.slotBtn,background:"#4caf50",color:"white",flex:1},children:" "}),Y.enabled&&r.jsx("button",{onClick:()=>za(U.slot),style:{...G.slotBtn,background:"#9c27b0",color:"white",flex:1},disabled:ae,children:" "})]})]})]},U.slot))})]})]}),r.jsxs("div",{style:G.collapsibleCard,children:[r.jsxs("button",{type:"button",style:G.collapsibleHeader,onClick:()=>ur(U=>!U),children:[r.jsxs("div",{style:G.collapsibleTitleRow,children:[r.jsx("span",{children:" /"}),r.jsx("span",{style:G.collapsibleHint,children:Ae?"":""})]}),r.jsx("div",{style:G.collapsibleSummary,children:""})]}),Ae&&r.jsx("div",{style:G.collapseBody,children:r.jsx(Z5,{gameState:j||{player:e,children:[],fallenChildren:[],activeNpcs:[],deadNpcs:[],inventory:[],logs:[],messages:{},lastMessageCheck:{},gameStage:"MAIN",pendingSectChoices:null,testQueue:[],worldEvents:[],newsBuffer:[]},onLoadGame:n,playerName:(e==null?void 0:e.name)||""})})]}),r.jsxs("div",{style:G.collapsibleCard,children:[r.jsxs("button",{type:"button",style:G.collapsibleHeader,onClick:()=>cn(U=>!U),children:[r.jsxs("div",{style:G.collapsibleTitleRow,children:[r.jsx("span",{children:" "}),r.jsx("span",{style:G.collapsibleHint,children:Ra?"":""})]}),r.jsx("div",{style:G.collapsibleSummary,children:""})]}),Ra&&r.jsxs("div",{style:G.collapseBody,children:[r.jsxs("div",{style:G.formGroup,children:[r.jsx("label",{style:G.label,children:""}),r.jsx("input",{type:"text",value:Na,onChange:U=>eo(U.target.value),placeholder:"",style:G.input}),r.jsx("span",{style:G.hint,children:""})]}),r.jsx("button",{onClick:ni,style:{...G.btn,background:"#ffb74d",color:"#4e342e",border:"none",width:"100%"},children:" "}),Ir&&r.jsx("div",{style:{...G.statusBox,background:Ir.success?"#e8f5e9":"#ffebee",color:Ir.success?"#2e7d32":"#c62828",marginTop:"12px"},children:Ir.message})]})]}),r.jsxs("div",{style:G.collapsibleCard,children:[r.jsxs("button",{type:"button",style:G.collapsibleHeader,onClick:()=>Js(U=>!U),children:[r.jsxs("div",{style:G.collapsibleTitleRow,children:[r.jsx("span",{children:" "}),r.jsx("span",{style:G.collapsibleHint,children:zn?"":""})]}),r.jsx("div",{style:G.collapsibleSummary,children:Ba})]}),zn&&r.jsxs("div",{style:G.collapseBody,children:[r.jsx("p",{style:G.info,children:""}),r.jsx("button",{onClick:o,style:{...G.btn,background:"#2196f3",color:"white",border:"none",width:"100%"},children:" "})]})]}),r.jsxs("div",{style:{...G.card,borderColor:"#d32f2f",background:"#ffebee"},children:[r.jsx("h4",{style:{color:"#d32f2f"},children:" "}),r.jsx("p",{style:{fontSize:"12px",color:"#666"},children:"Bug"}),r.jsx("button",{onClick:io,style:G.resetBtn,children:" "})]}),r.jsxs("div",{style:{textAlign:"center",marginTop:"30px",color:"#999",fontSize:"12px"},children:[r.jsx("p",{children:": v1.2.0 Alpha"}),r.jsxs("p",{children:["5MB",r.jsx("br",{}),Y.enabled?" ":"  TapTap "]}),r.jsxs("p",{style:{marginTop:"8px",fontSize:"11px"},children:[" ",r.jsx("br",{}),"100"]})]})]})},G={card:{background:"white",padding:"15px",borderRadius:"8px",border:"1px solid #ddd",marginBottom:"20px"},info:{marginBottom:"15px",fontSize:"14px",color:"#555"},btnGroup:{display:"flex",gap:"10px"},btn:{flex:1,padding:"10px",cursor:"pointer",borderRadius:"5px",border:"1px solid #ccc",background:"#f5f5f5"},saveBtn:{flex:1,padding:"10px",cursor:"pointer",borderRadius:"5px",border:"none",background:"#4caf50",color:"white",fontWeight:"bold"},resetBtn:{width:"100%",padding:"10px",cursor:"pointer",borderRadius:"5px",border:"none",background:"#d32f2f",color:"white"},formGroup:{marginBottom:"15px"},label:{display:"block",marginBottom:"5px",fontSize:"13px",fontWeight:"bold",color:"#333"},checkboxLabel:{display:"flex",alignItems:"center",gap:"8px",fontSize:"14px",color:"#333",cursor:"pointer"},checkbox:{width:"18px",height:"18px",cursor:"pointer"},input:{width:"100%",padding:"10px",borderRadius:"5px",border:"1px solid #ddd",fontSize:"14px",boxSizing:"border-box"},select:{width:"100%",padding:"10px",borderRadius:"5px",border:"1px solid #ddd",fontSize:"14px",boxSizing:"border-box",cursor:"pointer",background:"white"},hint:{display:"block",marginTop:"5px",fontSize:"11px",color:"#999",lineHeight:"1.4"},statusBox:{padding:"10px",borderRadius:"5px",marginBottom:"15px",fontSize:"13px",fontWeight:"bold"},slotCard:{background:"#f9f9f9",padding:"12px",borderRadius:"6px",border:"1px solid #e0e0e0"},slotHeader:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"10px"},slotTitle:{fontSize:"14px",fontWeight:"bold",color:"#333"},slotBadge:{fontSize:"11px",padding:"3px 8px",borderRadius:"10px",background:"#4caf50",color:"white"},slotInfo:{marginTop:"8px"},slotBtn:{flex:1,padding:"8px",cursor:"pointer",borderRadius:"4px",border:"none",fontSize:"12px",fontWeight:"bold"},collapsibleCard:{background:"white",border:"1px solid #ddd",borderRadius:"10px",marginBottom:"20px",overflow:"hidden",boxShadow:"0 4px 12px rgba(0,0,0,0.04)"},collapsibleHeader:{width:"100%",background:"linear-gradient(120deg, #f5efe6, #fff)",border:"none",padding:"14px",textAlign:"left",cursor:"pointer"},collapsibleTitleRow:{display:"flex",justifyContent:"space-between",alignItems:"center",fontWeight:"bold",color:"#4e342e"},collapsibleHint:{fontSize:"12px",color:"#8d6e63"},collapsibleSummary:{marginTop:"6px",fontSize:"12px",color:"#6d4c41"},collapseBody:{padding:"14px",borderTop:"1px solid #f0e0d6",background:"#fff"},optionGroup:{display:"flex",flexDirection:"column",gap:"8px"},optionCard:{background:"rgba(249, 246, 243, 0.9)",borderRadius:"8px",border:"1px solid #efe0d4",padding:"8px"},optionRow:{display:"flex",gap:"10px",alignItems:"center"},optionToggle:{display:"flex",alignItems:"center",gap:"6px",fontSize:"12px",color:"#5d4037"},optionText:{flex:1,border:"none",background:"transparent",textAlign:"left",padding:0,cursor:"pointer",color:"#4e342e"},optionTitleRow:{display:"flex",justifyContent:"space-between",alignItems:"center",fontSize:"13px",fontWeight:600},detailHint:{fontSize:"12px",color:"#8d6e63"},optionBrief:{fontSize:"11px",color:"#6d4c41",marginTop:"2px"},optionDetail:{marginTop:"6px",padding:"8px",borderRadius:"6px",background:"#fff",border:"1px dashed #e0c5b4",fontSize:"11px",color:"#5d4037",lineHeight:1.5,whiteSpace:"pre-line"},familyActionCard:{marginTop:"12px",padding:"14px",borderRadius:"10px",border:"1px solid #e0c5b4",background:"linear-gradient(135deg, #fff7ec 0%, #fde2cf 100%)"},familyActionHeader:{display:"flex",justifyContent:"space-between",alignItems:"center",fontSize:"13px",fontWeight:600,color:"#4e342e",marginBottom:"6px"},familyActionDesc:{fontSize:"12px",color:"#6d4c41",lineHeight:1.5,margin:"8px 0 12px 0"},familyActionBtn:{width:"100%",padding:"10px",border:"none",borderRadius:"999px",cursor:"pointer",background:"linear-gradient(120deg, #ff9a62, #ff6f3c)",color:"#fff",fontWeight:"bold",fontSize:"14px",boxShadow:"0 4px 10px rgba(255, 111, 60, 0.3)"}},tC=(e,t)=>{var n;if(Fm[t]){const s=Fm[t];e.cultivationMethod=s;const o=((n=mn[s])==null?void 0:n.name)||s;return`${e.name}  ${t}${o}`}return null},Fg=(e,t)=>{const n=mn[t];if(!n)return{success:!1,message:""};const s=e.cultivationMethod,o=mn[s];e.cultivationMethod=t;const i=jf(t,e.spiritRoot);return{success:!0,message:`${e.name} ${(o==null?void 0:o.name)||""}${n.name}`,compatibility:i}},Cc=(e,t)=>{const n=R2(e);if(!n)return{manual:null,compatibility:null};const s=jf(e,t);return{manual:n,compatibility:s,speedBonus:`${(s.compatibility*n.baseBuff*100).toFixed(0)}%`}},nC=({player:e,childFeedback:t=0,onOpenInventory:n,onAllocateSkillPoint:s})=>{var j,T,A,V;const[o,i]=b.useState(!1);if(!e||!e.stats||!e.resources)return r.jsx("div",{style:{padding:"20px",textAlign:"center",color:"#999"},children:"..."});const a=Rf(e.stats.aptitude),l=Vc(e,!0),d=l+t,u=Tn(e.tier),p=(u==null?void 0:u.chance)??0,c=(e.breakthroughBonus||0)/100,m=Math.min(.95,p+c);e.currentExp>=e.maxExp&&!u&&console.warn(` "${e.tier}" `);const S=((e.stats.aptitude||50)/50).toFixed(2),E=((j=e.spiritRoot)==null?void 0:j.multiplier)||1,w=((A=(T=e.trait)==null?void 0:T.bonuses)==null?void 0:A.speedMultiplier)??((V=e.trait)==null?void 0:V.effect)??1,g=e.sect&&e.sect.level!=="NONE"?1.5:1,h=e.cultivationMethod&&e.spiritRoot?Cf(e.cultivationMethod,e.spiritRoot):1,v=e.cultivationMethod||"basic_breath",x=e.spiritRoot?Cc(v,e.spiritRoot):null,I=Jn(e||{}),_=Math.floor(e.currentExp||0),N=Math.max(1,Math.floor(e.maxExp||1)),C=Math.min(100,Math.round(_/N*100));return r.jsxs("div",{style:he.container,children:[r.jsx("h3",{style:he.title,children:" "}),r.jsxs("div",{style:he.content,children:[r.jsxs("div",{style:he.topSection,children:[r.jsx("div",{style:he.avatarContainer,children:r.jsx(Yr,{dna:e.avatar,gender:e.gender,size:80})}),r.jsxs("div",{style:he.basicInfo,children:[r.jsx("h2",{style:he.playerName,children:e.name}),r.jsx("div",{style:he.tierBadge,children:e.tier}),r.jsx("div",{style:{display:"flex",gap:"8px",alignItems:"center"},children:r.jsxs("div",{style:he.ageText,children:[Math.floor(e.age),""]})}),(()=>{const F=V2(e.tier);return F?r.jsxs("div",{style:{marginTop:"6px",fontSize:"12px",color:"#ffffff"},children:[r.jsx("span",{style:{fontWeight:"bold"},children:" :"})," ",F]}):null})()]})]}),r.jsxs("div",{style:he.resourceStatsBox,children:[r.jsxs("div",{style:he.resourceRow,children:[r.jsxs("div",{style:he.resourceStatItem,children:[r.jsx("span",{style:he.resourceIcon,children:""}),r.jsxs("div",{style:he.resourceInfo,children:[r.jsx("div",{style:he.resourceLabel,children:""}),r.jsx("div",{style:he.resourceValue,children:e.resources.spiritStones})]})]}),r.jsxs("div",{style:he.resourceStatItem,children:[r.jsx("span",{style:he.resourceIcon,children:""}),r.jsxs("div",{style:he.resourceInfo,children:[r.jsx("div",{style:he.resourceLabel,children:""}),r.jsx("div",{style:he.resourceValue,children:I.total})]})]})]}),r.jsxs("div",{style:he.expSection,children:[r.jsx("div",{style:he.expLabel,children:""}),r.jsxs("div",{style:he.expBarWrapper,children:[r.jsx("div",{style:{...he.expBarFill,width:`${C}%`}}),r.jsxs("div",{style:he.expText,children:[_,"/",N]})]})]})]}),r.jsxs("div",{style:he.mainSection,children:[r.jsxs("div",{style:he.section,children:[r.jsx("h4",{children:" "}),e.spiritRoot?r.jsxs(r.Fragment,{children:[r.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"10px",marginBottom:"10px"},children:[r.jsx("strong",{style:{color:a.color,fontSize:"16px"},children:e.spiritRoot.type}),r.jsx("div",{style:{display:"flex",gap:"4px"},children:e.spiritRoot.elements.map(F=>{const B=$=>({:"#FFD700",:"#4CAF50",:"#2196F3",:"#F44336",:"#795548",:"#673AB7",:"#00BCD4",:"#009688"})[$]||"#9e9e9e";return r.jsx("span",{style:{padding:"2px 6px",borderRadius:"10px",color:"white",fontWeight:"bold",fontSize:"10px",background:B(F)},children:F},F)})})]}),r.jsxs("div",{style:he.barContainer,children:[r.jsxs("span",{children:[" (",e.stats.aptitude,")"]}),r.jsx("div",{style:he.barBg,children:r.jsx("div",{style:{...he.barFill,width:`${e.stats.aptitude}%`,background:a.color}})})]}),r.jsx("p",{style:{fontSize:"12px",color:"#666",marginTop:"5px"},children:e.spiritRoot.desc})]}):r.jsx("div",{style:{padding:"10px",background:"rgba(0,0,0,0.2)",borderRadius:"8px",fontSize:"13px",color:"rgba(255,255,255,0.75)"},children:""})]}),r.jsxs("div",{style:he.section,children:[r.jsx("h4",{children:" "}),e.spiritRoot?x!=null&&x.manual?r.jsxs("div",{style:he.manualCard,children:[r.jsxs("div",{style:he.manualHeader,children:[r.jsxs("div",{style:he.manualName,children:[x.manual.name,r.jsx("span",{style:{...he.manualTierBadge,background:x.manual.tierColor},children:x.manual.tierName})]}),x.manual.element!=="NONE"&&r.jsx("span",{style:he.manualElementBadge,children:x.manual.element})]}),r.jsx("p",{style:he.manualDesc,children:x.manual.desc}),x.compatibility&&r.jsxs("div",{style:he.manualMetaRow,children:[r.jsxs("span",{children:["",r.jsx("strong",{style:{color:x.compatibility.color},children:x.compatibility.desc})]}),r.jsxs("span",{children:["",r.jsxs("strong",{style:{color:"#64ffda"},children:["+",x.speedBonus]})]})]}),r.jsxs("div",{style:he.manualMetaRow,children:[r.jsxs("span",{children:["",x.manual.source||""]}),r.jsxs("span",{children:["",x.manual.element==="NONE"?"":x.manual.element]})]})]}):r.jsx("div",{style:he.manualPlaceholder,children:""}):r.jsx("div",{style:he.manualPlaceholder,children:""})]}),r.jsxs("div",{style:he.section,children:[r.jsx("h4",{children:" "}),r.jsxs("div",{style:he.barContainer,children:[r.jsxs("span",{children:[" (",_,"/",N,")"]}),r.jsx("div",{style:he.barBg,children:r.jsx("div",{style:{...he.barFill,width:`${C}%`,background:"#4CAF50"}})})]}),e.currentExp>=e.maxExp&&r.jsx("div",{style:{marginTop:"10px",padding:"10px",background:"rgba(255,193,7,0.15)",borderRadius:"8px",border:"1px solid #FFC107"},children:u?r.jsxs(r.Fragment,{children:[r.jsxs("div",{style:{fontSize:"13px",color:"#F57C00",fontWeight:"bold",marginBottom:"4px"},children:[" : ",(m*100).toFixed(1),"%"]}),r.jsxs("div",{style:{fontSize:"11px",color:"rgba(245,124,0,0.8)"},children:[": ",(p*100).toFixed(1),"%",c>0&&` | : +${(c*100).toFixed(1)}%`]})]}):r.jsx("div",{style:{fontSize:"12px",color:"#f44336"},children:" "})}),r.jsxs("div",{style:he.speedInfo,children:[r.jsxs("div",{style:he.speedHeader,children:[r.jsxs("span",{style:{fontWeight:"bold",color:"#4CAF50"},children:[" : ",d,"/"]}),t>0&&r.jsxs("span",{style:{fontSize:"12px",color:"#666",marginLeft:"8px"},children:["( ",l," +  ",t,")"]})]}),r.jsxs("div",{style:he.speedFormula,children:[r.jsx("div",{style:{fontSize:"11px",color:"#666",marginBottom:"4px"},children:": (10/)          "}),r.jsxs("div",{style:he.speedBreakdown,children:[r.jsxs("span",{style:he.speedItem,children:[r.jsx("span",{style:{color:"#888"},children:":"})," ",S]}),r.jsxs("span",{style:he.speedItem,children:[r.jsx("span",{style:{color:"#888"},children:":"})," ",E]}),r.jsxs("span",{style:he.speedItem,children:[r.jsx("span",{style:{color:"#888"},children:":"})," ",h.toFixed(2)]}),r.jsxs("span",{style:he.speedItem,children:[r.jsx("span",{style:{color:"#888"},children:":"})," ",w]}),r.jsxs("span",{style:he.speedItem,children:[r.jsx("span",{style:{color:"#888"},children:":"})," ",g]})]}),r.jsxs("div",{style:{fontSize:"10px",color:"#999",marginTop:"4px",fontStyle:"italic"},children:["= 10  ",S,"  ",E,"  ",h.toFixed(2),"  ",w,"  ",g," = ",l]}),t>0&&r.jsxs("div",{style:{fontSize:"11px",color:"#4CAF50",marginTop:"6px",paddingTop:"6px",borderTop:"1px dashed #ddd"},children:[" : +",t,"/"]})]})]})]}),r.jsxs("div",{style:he.section,children:[r.jsx("h4",{children:" "}),r.jsxs("div",{style:he.statsGrid,children:[r.jsxs("div",{style:he.statItem,children:[r.jsx("div",{style:he.statLabel,children:""}),r.jsx("div",{style:he.statValue,children:e.stats.looks}),r.jsx("div",{style:he.statBar,children:r.jsx("div",{style:{...he.statBarFill,width:`${e.stats.looks}%`,background:"#FF6B6B"}})})]}),r.jsxs("div",{style:he.statItem,children:[r.jsx("div",{style:he.statLabel,children:""}),r.jsx("div",{style:he.statValue,children:e.stats.cunning}),r.jsx("div",{style:he.statBar,children:r.jsx("div",{style:{...he.statBarFill,width:`${e.stats.cunning}%`,background:"#4ECDC4"}})})]}),r.jsxs("div",{style:he.statItem,children:[r.jsx("div",{style:he.statLabel,children:""}),r.jsx("div",{style:he.statValue,children:e.stats.health}),r.jsx("div",{style:he.statBar,children:r.jsx("div",{style:{...he.statBarFill,width:`${e.stats.health}%`,background:e.stats.health<30?"#F44336":e.stats.health<60?"#FFC107":"#45B7D1"}})}),r.jsxs("div",{style:{fontSize:"10px",color:"#ccc",marginTop:"4px",opacity:.8},children:[": ",Bt(e.stats.health).toFixed(1),"/20"]})]}),r.jsxs("div",{style:he.statItem,children:[r.jsx("div",{style:he.statLabel,children:""}),r.jsx("div",{style:he.statValue,children:e.stats.intelligence}),r.jsx("div",{style:he.statBar,children:r.jsx("div",{style:{...he.statBarFill,width:`${e.stats.intelligence}%`,background:"#96CEB4"}})})]})]}),r.jsx("div",{style:{display:"flex",justifyContent:"center",marginTop:"12px"},children:r.jsx("button",{onClick:()=>i(F=>!F),style:he.detailsBtn,children:o?" ":" "})}),o&&r.jsx("div",{style:{marginTop:"15px",padding:"12px",background:"rgba(0,0,0,0.3)",borderRadius:"8px",border:"1px solid rgba(255,255,255,0.1)"},children:r.jsxs("div",{style:{fontSize:"12px",color:"#eee",lineHeight:1.8},children:[["looks","cunning","health","intelligence"].map(F=>{const B=lw(F),$=e.stats[F];let Y=`${B.desc}`;if(F==="health"){const ne=Bt($);Y+=` (: ${ne.toFixed(1)}/20)`}return r.jsxs("div",{style:{marginBottom:"8px",padding:"8px",background:"rgba(255,255,255,0.05)",borderRadius:"6px"},children:[r.jsxs("div",{style:{fontWeight:"bold",color:"#64ffda",marginBottom:"4px"},children:[B.name," (",$,"/100)"]}),r.jsx("div",{style:{opacity:.85,fontSize:"11px"},children:Y}),B.trainable&&r.jsxs("div",{style:{opacity:.7,fontSize:"10px",marginTop:"4px",color:"#4CAF50"},children:[" ",B.howToIncrease]})]},F)}),r.jsx("div",{style:{marginTop:"12px",paddingTop:"12px",borderTop:"1px dashed rgba(255,255,255,0.2)",opacity:.75,fontSize:"11px"},children:r.jsxs("div",{style:{marginBottom:"4px"},children:["  ",e.stats.aptitude," ",e.stats.luck," ",e.stats.lifespan]})})]})})]}),r.jsxs("div",{style:he.section,children:[r.jsx("h4",{children:" "}),r.jsxs("div",{style:he.resourcesGrid,children:[r.jsxs("div",{style:he.resourceItem,children:[r.jsx("span",{children:":"})," ",r.jsx("span",{style:{fontWeight:"bold"},children:e.resources.spiritStones})]}),r.jsxs("div",{style:he.resourceItem,children:[r.jsx("span",{children:":"}),r.jsx("span",{style:{fontWeight:"bold",color:"#FF9800"},children:e.skillPoints||0})]})]}),(e.skillPoints||0)>0&&r.jsxs("div",{style:{marginTop:"10px",padding:"10px",background:"#FFF3E0",borderRadius:"8px",border:"1px solid #FFB74D"},children:[r.jsxs("div",{style:{fontSize:"12px",color:"#E65100",marginBottom:"8px"},children:[" : ",e.skillPoints]}),r.jsxs("div",{style:{display:"flex",gap:"8px"},children:[r.jsx("button",{onClick:()=>s&&s("aptitude"),style:{...he.allocateBtn,background:"#9C27B0"},children:"+"}),r.jsx("button",{onClick:()=>s&&s("combatPower"),style:{...he.allocateBtn,background:"#F44336"},children:"+"}),r.jsx("button",{onClick:()=>s&&s("breakthrough"),style:{...he.allocateBtn,background:"#FF9800"},children:"+"})]})]}),e.breakthroughBonus>0&&r.jsx("div",{style:{marginTop:"10px",padding:"8px",background:"rgba(255,152,0,0.1)",borderRadius:"8px",border:"1px solid #FF9800"},children:r.jsxs("div",{style:{fontSize:"12px",color:"#F57C00"},children:[" : +",e.breakthroughBonus,"%",e.breakthroughFailCount>0&&r.jsxs("span",{style:{marginLeft:"8px",opacity:.8},children:["(: ",e.breakthroughFailCount,")"]})]})})]}),r.jsxs("div",{style:he.section,children:[r.jsx("h4",{children:" "}),r.jsx("button",{onClick:n,style:he.inventoryBtn,children:""})]})]})]})]})},he={container:{background:"linear-gradient(135deg, #667eea 0%, #764ba2 100%)",borderRadius:"16px",padding:"20px",color:"white",boxShadow:"0 8px 32px rgba(0,0,0,0.3)",marginBottom:"20px"},title:{margin:"0 0 20px 0",fontSize:"24px",textAlign:"center",textShadow:"2px 2px 4px rgba(0,0,0,0.3)"},content:{display:"flex",flexDirection:"column",gap:"16px"},topSection:{display:"flex",alignItems:"center",gap:"16px",padding:"16px",background:"rgba(255,255,255,0.1)",borderRadius:"12px",backdropFilter:"blur(10px)"},mainSection:{display:"flex",flexDirection:"column",gap:"15px"},avatarContainer:{background:"rgba(255,255,255,0.15)",borderRadius:"50%",padding:"8px",boxShadow:"0 4px 12px rgba(0,0,0,0.3)",flexShrink:0},basicInfo:{flex:1,display:"flex",flexDirection:"column",gap:"6px"},playerName:{margin:0,fontSize:"20px",fontWeight:"bold"},tierBadge:{background:"rgba(255,255,255,0.25)",padding:"4px 12px",borderRadius:"16px",fontSize:"13px",display:"inline-block",border:"1px solid rgba(255,255,255,0.3)",fontWeight:"600"},ageText:{fontSize:"14px",opacity:.9},section:{background:"rgba(255,255,255,0.1)",borderRadius:"12px",padding:"15px",backdropFilter:"blur(10px)"},barContainer:{marginBottom:"10px"},barBg:{background:"rgba(0,0,0,0.3)",borderRadius:"10px",height:"20px",marginTop:"5px",overflow:"hidden",position:"relative"},barFill:{height:"100%",borderRadius:"10px",transition:"width 0.5s ease",position:"relative",overflow:"hidden"},speedInfo:{marginTop:"10px",padding:"10px",background:"rgba(255,255,255,0.1)",borderRadius:"8px",fontSize:"12px"},speedHeader:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"8px"},statsGrid:{display:"grid",gridTemplateColumns:"1fr",gap:"12px"},statItem:{display:"grid",gridTemplateColumns:"60px 40px 1fr",gap:"8px",alignItems:"center"},statLabel:{fontSize:"14px"},statValue:{fontWeight:"bold",fontSize:"14px"},statBar:{background:"rgba(0,0,0,0.3)",borderRadius:"10px",height:"16px",overflow:"hidden"},statBarFill:{height:"100%",borderRadius:"10px",transition:"width 0.5s ease"},resourcesGrid:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"10px"},resourceItem:{display:"flex",justifyContent:"space-between",padding:"8px",background:"rgba(255,255,255,0.1)",borderRadius:"8px"},allocateBtn:{flex:1,padding:"8px 16px",border:"none",borderRadius:"8px",color:"white",fontWeight:"bold",cursor:"pointer",fontSize:"14px",transition:"transform 0.2s, box-shadow 0.2s",boxShadow:"0 2px 8px rgba(0,0,0,0.2)"},inventoryBtn:{width:"100%",padding:"10px",background:"rgba(255,255,255,0.2)",border:"1px solid rgba(255,255,255,0.3)",borderRadius:"8px",color:"white",cursor:"pointer",fontWeight:"bold",transition:"all 0.3s"},speedFormula:{fontSize:"12px"},speedBreakdown:{display:"flex",flexWrap:"wrap",gap:"8px",marginTop:"6px",marginBottom:"4px"},speedItem:{fontSize:"11px",padding:"2px 6px",backgroundColor:"rgba(255,255,255,0.1)",borderRadius:"3px",border:"1px solid rgba(255,255,255,0.2)"},detailsBtn:{padding:"8px 16px",borderRadius:"8px",border:"1px solid rgba(255,255,255,0.3)",background:"rgba(100,255,218,0.1)",color:"#64ffda",cursor:"pointer",fontSize:"13px",fontWeight:"500",transition:"all 0.3s ease",hover:{background:"rgba(100,255,218,0.2)"}},resourceStatsBox:{background:"linear-gradient(135deg, rgba(76,175,80,0.15) 0%, rgba(129,199,132,0.1) 100%)",borderRadius:"12px",padding:"15px",marginBottom:"15px",border:"1px solid rgba(255,255,255,0.2)",backdropFilter:"blur(10px)"},resourceRow:{display:"flex",gap:"15px",marginBottom:"12px"},resourceStatItem:{flex:1,display:"flex",alignItems:"center",padding:"10px",background:"rgba(255,255,255,0.1)",borderRadius:"8px"},resourceInfo:{display:"flex",flexDirection:"column",gap:"2px"},resourceLabel:{fontSize:"11px",color:"rgba(255,255,255,0.7)",fontWeight:"500"},resourceIcon:{fontSize:"24px",marginRight:"8px"},expSection:{marginTop:"8px"},expLabel:{fontSize:"12px",color:"rgba(255,255,255,0.8)",marginBottom:"6px",fontWeight:"500"},expBarWrapper:{position:"relative",height:"24px",backgroundColor:"rgba(0,0,0,0.3)",borderRadius:"12px",overflow:"hidden",border:"1px solid rgba(255,255,255,0.1)"},expBarFill:{position:"absolute",left:0,top:0,height:"100%",background:"linear-gradient(90deg, #4CAF50, #81C784)",transition:"width 0.3s ease",borderRadius:"12px"},expText:{position:"absolute",left:"50%",top:"50%",transform:"translate(-50%, -50%)",fontSize:"11px",fontWeight:"bold",color:"#fff",textShadow:"1px 1px 2px rgba(0,0,0,0.5)",zIndex:1},manualCard:{background:"rgba(255,255,255,0.08)",borderRadius:"12px",padding:"12px 14px",border:"1px solid rgba(255,255,255,0.2)",display:"flex",flexDirection:"column",gap:"8px"},manualHeader:{display:"flex",justifyContent:"space-between",alignItems:"center",gap:"16px"},manualName:{fontSize:"18px",fontWeight:"bold",display:"flex",alignItems:"center",gap:"8px"},manualTierBadge:{padding:"2px 8px",borderRadius:"999px",fontSize:"11px",color:"#fff",fontWeight:"bold"},manualElementBadge:{padding:"4px 12px",background:"rgba(255,255,255,0.2)",borderRadius:"999px",fontSize:"12px",fontWeight:"bold"},manualDesc:{fontSize:"13px",color:"rgba(255,255,255,0.85)",lineHeight:1.6},manualMetaRow:{display:"flex",justifyContent:"space-between",fontSize:"13px",color:"rgba(255,255,255,0.9)"},manualPlaceholder:{padding:"10px 14px",borderRadius:"10px",background:"rgba(0,0,0,0.2)",fontSize:"13px",color:"rgba(255,255,255,0.75)"}},rC={common:"#9e9e9e",uncommon:"#4caf50",rare:"#2196f3",epic:"#9c27b0",legendary:"#ff9800"},sC=e=>!e||!Array.isArray(e.usageTargets)||e.usageTargets.length===0?!0:e.usageTargets.includes(ft.NPC),oC=({npc:e,inventory:t=[],onClose:n,onGift:s})=>{const o=t.filter(u=>["consumable","weapon","armor","accessory"].includes(u.type)&&sC(u)),[i,a]=b.useState({}),l=b.useMemo(()=>{const u=Object.entries(i).filter(([,m])=>m>0),p=u.length,c=u.reduce((m,[,y])=>m+y,0);return{totalKinds:p,totalCount:c}},[i]),d={consumable:"",weapon:"",armor:"",accessory:""};return r.jsx("div",{style:bt.overlay,children:r.jsxs("div",{style:bt.modal,children:[r.jsxs("div",{style:bt.header,children:[r.jsxs("h3",{children:["  ",e.name," "]}),r.jsx("button",{onClick:n,style:bt.closeIcon,children:""})]}),r.jsx("p",{style:{fontSize:"12px",color:"#666",marginBottom:"10px",padding:"0 10px"},children:""}),r.jsx("div",{style:bt.itemList,children:o.length===0?r.jsx("div",{style:bt.empty,children:""}):o.map(u=>r.jsxs("div",{style:bt.itemCard,children:[r.jsxs("div",{style:bt.itemHeader,children:[r.jsxs("label",{style:bt.itemSelect,children:[r.jsx("input",{type:"checkbox",checked:!!i[u.instanceId],onChange:p=>{const c=p.target.checked;a(m=>({...m,[u.instanceId]:c?1:0}))}}),r.jsx("span",{children:""})]}),r.jsx("span",{style:{...bt.itemName,color:rC[u.rarity]||"#333"},children:u.name}),r.jsx("span",{style:bt.itemType,children:d[u.type]||u.type})]}),r.jsx("div",{style:bt.itemDesc,children:u.desc}),r.jsxs("div",{style:bt.itemMetaRow,children:[r.jsxs("span",{style:bt.itemStock,children:[": ",u.quantity||1]}),r.jsxs("div",{style:bt.qtyControls,children:[r.jsx("button",{type:"button",onClick:()=>{const p=i[u.instanceId]||0;if(p<=1){a(c=>({...c,[u.instanceId]:0}));return}a(c=>({...c,[u.instanceId]:p-1}))},disabled:!i[u.instanceId],style:bt.qtyBtn,children:"-"}),r.jsx("input",{type:"number",min:"1",max:u.quantity||1,value:i[u.instanceId]||"",onChange:p=>{const c=parseInt(p.target.value,10);if(Number.isNaN(c)){a(y=>({...y,[u.instanceId]:0}));return}const m=Math.max(1,Math.min(u.quantity||1,c));a(y=>({...y,[u.instanceId]:m}))},placeholder:"",style:bt.qtyInput}),r.jsx("button",{type:"button",onClick:()=>{const p=i[u.instanceId]||0,c=u.quantity||1,m=Math.min(c,p>0?p+1:1);a(y=>({...y,[u.instanceId]:m}))},style:bt.qtyBtn,children:"+"})]})]}),u.stats&&r.jsxs("div",{style:bt.itemStats,children:[u.stats.atk&&r.jsxs("span",{children:["+",u.stats.atk]}),u.stats.hp&&r.jsxs("span",{children:["+",u.stats.hp]}),u.stats.def&&r.jsxs("span",{children:["+",u.stats.def]}),u.stats.mp&&r.jsxs("span",{children:["+",u.stats.mp]})]}),u.effect&&r.jsxs("div",{style:bt.itemEffect,children:[u.effect.kind==="heal"&&`${u.effect.amount}`,u.effect.kind==="exp"&&`+${u.effect.amount}`,u.effect.kind==="aptitude"&&`+${u.effect.amount}`]})]},u.instanceId))}),r.jsxs("div",{style:bt.footer,children:[r.jsxs("div",{style:bt.summary,children:[" ",l.totalKinds,"  /  ",l.totalCount," "]}),r.jsxs("div",{style:bt.footerActions,children:[r.jsx("button",{onClick:n,style:bt.closeBtn,children:""}),r.jsx("button",{onClick:()=>{const u=Object.entries(i).filter(([,p])=>p>0).map(([p,c])=>({instanceId:p,quantity:c}));u.length!==0&&s&&s(u)},disabled:l.totalKinds===0,style:{...bt.primaryBtn,opacity:l.totalKinds===0?.5:1,cursor:l.totalKinds===0?"not-allowed":"pointer"},children:""})]})]})]})})},bt={overlay:{position:"fixed",top:0,left:0,right:0,bottom:0,background:"rgba(0,0,0,0.6)",display:"flex",justifyContent:"center",alignItems:"center",zIndex:200},modal:{width:"450px",maxHeight:"80vh",background:"#fff",borderRadius:"12px",padding:"20px",boxShadow:"0 8px 30px rgba(0,0,0,0.3)",display:"flex",flexDirection:"column"},header:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"15px"},closeIcon:{border:"none",background:"transparent",fontSize:"24px",cursor:"pointer",color:"#666",lineHeight:1},itemList:{flex:1,overflowY:"auto",maxHeight:"400px",marginBottom:"15px"},empty:{textAlign:"center",padding:"40px 20px",color:"#999",fontSize:"14px"},itemCard:{padding:"12px",marginBottom:"8px",background:"#fafafa",borderRadius:"8px",cursor:"pointer",border:"1px solid #eee",transition:"all 0.2s",":hover":{background:"#f5f5f5",borderColor:"#8d6e63"}},itemHeader:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"6px"},itemName:{fontWeight:"bold",fontSize:"14px"},itemType:{fontSize:"11px",padding:"2px 8px",background:"#e0e0e0",borderRadius:"10px",color:"#666"},itemDesc:{fontSize:"12px",color:"#666",marginBottom:"6px"},itemStats:{fontSize:"11px",color:"#1976d2",display:"flex",gap:"8px",flexWrap:"wrap"},itemEffect:{fontSize:"11px",color:"#388e3c",marginTop:"4px"},itemSelect:{display:"flex",alignItems:"center",gap:"6px",fontSize:"11px",color:"#666"},itemMetaRow:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"6px"},itemStock:{fontSize:"11px",color:"#999"},qtyControls:{display:"flex",alignItems:"center",gap:"6px"},qtyBtn:{width:"24px",height:"24px",border:"none",borderRadius:"4px",background:"#e0e0e0",cursor:"pointer",fontSize:"14px"},qtyInput:{width:"56px",padding:"4px",textAlign:"center",border:"1px solid #ddd",borderRadius:"4px",fontSize:"12px"},footer:{display:"flex",justifyContent:"space-between",alignItems:"center",gap:"12px"},summary:{fontSize:"12px",color:"#666"},footerActions:{display:"flex",gap:"8px"},closeBtn:{padding:"10px 16px",background:"#e0e0e0",border:"none",borderRadius:"8px",cursor:"pointer",fontSize:"14px"},primaryBtn:{padding:"10px 16px",background:"#ff9800",border:"none",borderRadius:"8px",color:"#fff",fontSize:"14px"}},iC=[{id:"EMOTION",label:"",desc:"",strongAgainst:["",""],weakAgainst:["",""]},{id:"PROFIT",label:"",desc:"",strongAgainst:["",""],weakAgainst:["",""]},{id:"REASON",label:"",desc:"",strongAgainst:["",""],weakAgainst:["",""]}],aC=({npc:e,onClose:t,onNegotiate:n})=>{var s;return r.jsx("div",{style:$i.overlay,children:r.jsxs("div",{style:$i.modal,children:[r.jsx("h3",{children:" "}),r.jsxs("p",{style:{color:"#555",fontSize:"14px"},children:[" ",r.jsx("strong",{style:{color:"#d81b60"},children:(s=e.personality)==null?void 0:s.label}),"  ",e.name,"",r.jsx("br",{}),""]}),r.jsx("div",{style:$i.list,children:iC.map(o=>r.jsxs("button",{onClick:()=>n(o),style:$i.btn,children:[r.jsx("div",{style:{fontWeight:"bold"},children:o.label}),r.jsx("small",{style:{color:"#666"},children:o.desc})]},o.id))}),r.jsx("button",{onClick:t,style:$i.cancel,children:""})]})})},$i={overlay:{position:"fixed",top:0,left:0,right:0,bottom:0,background:"rgba(0,0,0,0.7)",display:"flex",justifyContent:"center",alignItems:"center",zIndex:200},modal:{width:"300px",background:"#fff8e1",borderRadius:"12px",padding:"20px",border:"2px solid #8d6e63"},list:{display:"flex",flexDirection:"column",gap:"10px",margin:"20px 0"},btn:{padding:"15px",background:"#fff",border:"1px solid #d7ccc8",borderRadius:"8px",cursor:"pointer",textAlign:"left",":hover":{background:"#efebe9"}},cancel:{width:"100%",padding:"10px",background:"transparent",border:"none",color:"#888",cursor:"pointer"}},lC=({items:e,playerSpiritStones:t,onPurchase:n,onClose:s})=>{const[o,i]=b.useState({}),[a,l]=b.useState(null),d=(p,c)=>{const m=p.price*c;if(t<m){l(` ${p.name} x${c}  ${m}  ${t} `),setTimeout(()=>l(null),3e3);return}n(p,c,m),l(` ${p.name} x${c} ${m} `),setTimeout(()=>l(null),2e3)},u={common:"#9e9e9e",uncommon:"#4caf50",rare:"#2196f3",epic:"#9c27b0",legendary:"#ff9800"};return r.jsx("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0,0,0,0.5)",display:"flex",justifyContent:"center",alignItems:"center",zIndex:1e3},children:r.jsxs("div",{style:{backgroundColor:"#fff",padding:"25px",borderRadius:"16px",maxWidth:"600px",maxHeight:"80vh",width:"90%",boxShadow:"0 8px 30px rgba(0,0,0,0.3)",border:"2px solid #8d6e63",display:"flex",flexDirection:"column"},children:[r.jsx("h2",{style:{marginTop:0,color:"#5d4037",textAlign:"center",marginBottom:"10px"},children:" "}),r.jsx("p",{style:{color:"#666",textAlign:"center",fontSize:"13px",marginBottom:"15px"},children:""}),r.jsx("div",{style:{flex:1,overflowY:"auto",marginBottom:"15px"},children:e.length===0?r.jsx("div",{style:{textAlign:"center",padding:"40px",color:"#999"},children:""}):r.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"10px"},children:e.map(p=>{const c=o[p.instanceId]||1,m=p.price*c,y=t>=m;return r.jsxs("div",{style:{padding:"12px",border:`2px solid ${u[p.rarity]||"#ddd"}`,borderRadius:"10px",backgroundColor:y?"#fafafa":"#f5f5f5",opacity:y?1:.6,transition:"all 0.2s"},children:[r.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"6px"},children:[r.jsx("span",{style:{fontSize:"15px",fontWeight:"bold",color:u[p.rarity]},children:p.name}),r.jsxs("span",{style:{fontSize:"14px",color:"#f57c00",fontWeight:"bold"},children:[" ",p.price," "]})]}),r.jsx("div",{style:{fontSize:"12px",color:"#666",marginBottom:"8px"},children:p.desc}),p.stats&&r.jsxs("div",{style:{fontSize:"11px",color:"#1976d2",display:"flex",gap:"8px",flexWrap:"wrap",marginBottom:"8px"},children:[p.stats.atk&&r.jsxs("span",{children:["+",p.stats.atk]}),p.stats.hp&&r.jsxs("span",{children:["+",p.stats.hp]}),p.stats.def&&r.jsxs("span",{children:["+",p.stats.def]}),p.stats.mp&&r.jsxs("span",{children:["+",p.stats.mp]})]}),p.effect&&r.jsxs("div",{style:{fontSize:"11px",color:"#388e3c",marginBottom:"8px"},children:[p.effect.kind==="heal"&&`${p.effect.amount}`,p.effect.kind==="exp"&&`+${p.effect.amount}`,p.effect.kind==="aptitude"&&`+${p.effect.amount}`]}),r.jsxs("div",{style:{display:"flex",gap:"8px",alignItems:"center",marginBottom:"8px"},children:[r.jsxs("div",{style:{display:"flex",alignItems:"center",gap:6},children:[r.jsx("label",{style:{fontSize:12,color:"#555"},children:""}),r.jsx("input",{type:"number",min:1,value:c,onChange:S=>{const E=Math.max(1,parseInt(S.target.value||"1",10));i(w=>({...w,[p.instanceId]:E}))},style:{width:60,padding:6,borderRadius:6,border:"1px solid #ddd"}})]}),r.jsx("div",{style:{flex:1}})]}),r.jsxs("button",{onClick:()=>d(p,c),disabled:!y,style:{width:"100%",padding:"8px",border:"none",borderRadius:"6px",backgroundColor:y?"#8d6e63":"#ccc",color:"white",cursor:y?"pointer":"not-allowed",fontSize:"13px",fontWeight:"bold"},children:[" x",c,"  ",m,""]})]},p.instanceId)})})}),a&&r.jsx("div",{style:{marginBottom:15,padding:"10px 15px",textAlign:"center",backgroundColor:a.includes("")?"#ffebee":"#e8f5e9",color:a.includes("")?"#c62828":"#2e7d32",fontWeight:"bold",borderRadius:"8px",border:`2px solid ${a.includes("")?"#ef5350":"#66bb6a"}`},children:a}),r.jsxs("div",{style:{marginTop:"10px",padding:"10px",backgroundColor:"#fff3e0",borderRadius:"8px",fontSize:"12px",color:"#666",textAlign:"center"},children:[" "," ",r.jsx("span",{style:{fontWeight:"bold",color:"#f57c00"},children:t})," ",""]}),r.jsx("button",{onClick:s,style:{marginTop:"15px",padding:"10px",border:"1px solid #ccc",borderRadius:"8px",backgroundColor:"white",cursor:"pointer",fontSize:"14px"},children:""})]})})},cC=({result:e,onClose:t})=>{if(b.useEffect(()=>{if(e&&e.autoClose!==!1){const s=setTimeout(t,3e3);return()=>clearTimeout(s)}},[t,e]),!e)return null;const n=()=>{e.autoClose!==!1&&t()};return r.jsx("div",{style:ts.overlay,onClick:n,children:r.jsxs("div",{style:ts.card,onClick:s=>s.stopPropagation(),children:[r.jsx("div",{style:ts.icon,children:e.success?"":""}),r.jsx("h3",{style:{margin:"10px 0"},children:e.title}),r.jsx("div",{style:ts.scrollText,children:e.msg}),e.changes&&r.jsx("div",{style:ts.changes,children:Object.entries(e.changes).map(([s,o])=>r.jsxs("span",{style:ts.badge,children:[s,": ",o>0?"+":"",o]},s))}),e.autoClose===!1?r.jsx("button",{onClick:t,style:ts.confirmBtn,children:""}):r.jsx("div",{style:ts.tip,children:"[  ]"})]})})},ts={overlay:{position:"fixed",top:0,left:0,right:0,bottom:0,background:"rgba(0,0,0,0.5)",display:"flex",justifyContent:"center",alignItems:"center",zIndex:2200,animation:"fadeIn 0.2s",backdropFilter:"blur(2px)"},card:{width:"85%",maxWidth:"500px",background:"#f5f0e8",padding:"25px",borderRadius:"16px",textAlign:"center",boxShadow:"0 8px 30px rgba(0,0,0,0.2)",animation:"fadeIn 0.3s ease-out",maxHeight:"80vh",display:"flex",flexDirection:"column",border:"2px solid #d7ccc8"},scrollText:{maxHeight:"250px",overflowY:"auto",lineHeight:"1.8",color:"#5d4037",textAlign:"left",background:"#faf8f5",padding:"20px",borderRadius:"12px",margin:"15px 0",border:"1px solid #e0e0e0",boxShadow:"0 2px 8px rgba(0,0,0,0.05)",fontFamily:"Microsoft YaHei, SimSun, serif"},confirmBtn:{marginTop:"20px",padding:"12px 25px",background:"linear-gradient(135deg, #8d6e63 0%, #6d4c41 100%)",color:"white",border:"none",borderRadius:"25px",cursor:"pointer",fontSize:"15px",transition:"all 0.3s ease",boxShadow:"0 2px 8px rgba(0,0,0,0.15)",":hover":{background:"linear-gradient(135deg, #6d4c41 0%, #5d4037 100%)",transform:"translateY(-2px)",boxShadow:"0 4px 12px rgba(0,0,0,0.2)"}},icon:{fontSize:"48px",marginBottom:"15px"},changes:{marginTop:"20px",display:"flex",gap:"8px",justifyContent:"center",flexWrap:"wrap"},badge:{background:"linear-gradient(135deg, #f1f8e9 0%, #e8f5e8 100%)",color:"#5d4037",padding:"4px 12px",borderRadius:"15px",fontSize:"13px",border:"1px solid #d7ccc8",boxShadow:"0 2px 4px rgba(0,0,0,0.05)"},tip:{marginTop:"15px",fontSize:"12px",color:"#8d6e63",fontStyle:"italic"}},dC=({message:e,onConfirm:t,onCancel:n,input:s})=>{const[o,i]=b.useState((s==null?void 0:s.defaultValue)??"");return r.jsx("div",{style:yr.overlay,onClick:n,children:r.jsxs("div",{style:yr.card,onClick:a=>a.stopPropagation(),children:[r.jsx("div",{style:yr.icon,children:""}),r.jsx("h3",{style:{margin:"10px 0"},children:""}),r.jsx("div",{style:yr.message,children:e}),s&&r.jsxs("div",{style:yr.inputWrap,children:[s.label&&r.jsx("div",{style:yr.inputLabel,children:s.label}),r.jsx("input",{type:s.type||"text",value:o,min:s.min,max:s.max,step:s.step,placeholder:s.placeholder,onChange:a=>i(a.target.value),style:yr.input})]}),r.jsxs("div",{style:yr.buttons,children:[r.jsx("button",{onClick:n,style:yr.cancelBtn,children:""}),r.jsx("button",{onClick:()=>t(s?o:void 0),style:yr.confirmBtn,children:""})]})]})})},yr={overlay:{position:"fixed",top:0,left:0,right:0,bottom:0,background:"rgba(0, 0, 0, 0.5)",display:"flex",justifyContent:"center",alignItems:"center",zIndex:2200,animation:"fadeIn 0.2s",backdropFilter:"blur(2px)"},card:{width:"85%",maxWidth:"400px",background:"linear-gradient(135deg, #F4EEE6 0%, #EFE6D8 100%)",borderRadius:"12px",padding:"30px",textAlign:"center",boxShadow:"0 20px 60px rgba(0, 0, 0, 0.3)",border:"2px solid #D4AF37"},icon:{fontSize:"48px",marginBottom:"10px"},message:{margin:"20px 0",lineHeight:"1.6",whiteSpace:"pre-wrap"},inputWrap:{marginTop:"10px"},inputLabel:{fontSize:"12px",color:"#555",marginBottom:"6px"},input:{width:"100%",padding:"8px 10px",border:"1px solid #ccc",borderRadius:"6px",fontSize:"14px"},buttons:{display:"flex",gap:"15px",justifyContent:"center",marginTop:"20px"},cancelBtn:{padding:"10px 20px",background:"#666",color:"white",border:"none",borderRadius:"8px",cursor:"pointer",fontSize:"16px"},confirmBtn:{padding:"10px 20px",background:"#4CAF50",color:"white",border:"none",borderRadius:"8px",cursor:"pointer",fontSize:"16px"}},uC=({event:e,npc:t,onClose:n,onOptionSelect:s})=>{const o=l=>{try{s((t==null?void 0:t.id)||null,l)}catch(d){console.error("EventModal option select error",d)}},i=(e==null?void 0:e.title)||(t?`${t.name} - `:""),a=(e==null?void 0:e.text)||(e==null?void 0:e.desc)||(e==null?void 0:e.description)||"";return r.jsx("div",{style:Br.overlay,children:r.jsxs("div",{style:Br.modalWrapper,children:[r.jsx("button",{onClick:n,style:Br.closeBtn,"aria-label":"",children:""}),r.jsxs("div",{style:Br.modal,children:[r.jsx("h2",{style:Br.title,children:i}),r.jsxs("div",{style:Br.content,children:[r.jsx("p",{style:Br.eventText,children:a}),r.jsx("div",{style:Br.options,children:((e==null?void 0:e.options)||[]).map((l,d)=>r.jsx("button",{style:Br.optionBtn,onClick:()=>o(l),children:l.label},d))})]})]})]})})},Br={overlay:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0, 0, 0, 0.5)",display:"flex",justifyContent:"center",alignItems:"center",zIndex:1e3,backdropFilter:"blur(2px)"},modalWrapper:{position:"relative",width:"min(600px, calc(100vw - 32px))"},modal:{width:"90%",maxWidth:"600px",backgroundColor:"#f5f0e8",borderRadius:"16px",padding:"25px",position:"relative",boxShadow:"0 8px 30px rgba(0, 0, 0, 0.2)",border:"2px solid #d7ccc8",animation:"fadeIn 0.3s ease-out"},closeBtn:{position:"absolute",top:"-18px",left:"-18px",border:"none",background:"#fff",fontSize:"22px",cursor:"pointer",color:"#8d6e63",width:"42px",height:"42px",borderRadius:"50%",display:"flex",alignItems:"center",justifyContent:"center",boxShadow:"0 10px 24px rgba(0,0,0,0.2)"},title:{fontSize:"20px",marginBottom:"25px",color:"#5d4037",textAlign:"center",fontWeight:"bold",paddingBottom:"15px",borderBottom:"2px solid #d7ccc8",fontFamily:"Microsoft YaHei, SimSun, serif"},content:{maxHeight:"70vh",overflowY:"auto",paddingRight:"10px"},eventText:{fontSize:"16px",lineHeight:"1.8",marginBottom:"35px",color:"#5d4037",padding:"20px",background:"#faf8f5",borderRadius:"12px",border:"1px solid #e0e0e0",boxShadow:"0 2px 8px rgba(0, 0, 0, 0.05)",fontFamily:"Microsoft YaHei, SimSun, serif"},options:{display:"flex",flexDirection:"column",gap:"12px"},optionBtn:{padding:"18px",border:"2px solid #d7ccc8",borderRadius:"12px",background:"linear-gradient(135deg, #ffffff 0%, #f5f0e8 100%)",cursor:"pointer",textAlign:"left",transition:"all 0.3s ease",fontSize:"15px",color:"#5d4037",boxShadow:"0 2px 8px rgba(0, 0, 0, 0.05)",":hover":{background:"linear-gradient(135deg, #f5f0e8 0%, #e8e0d8 100%)",transform:"translateY(-2px)",boxShadow:"0 4px 12px rgba(0, 0, 0, 0.1)",borderColor:"#bcaaa4"},":active":{transform:"translateY(0)",boxShadow:"0 2px 6px rgba(0, 0, 0, 0.05)"}}},Hg=e=>Math.max(0,Math.min(100,Number(e)||0)),pC=({event:e,player:t,onClose:n,onOptionSelect:s})=>{const[o,i]=b.useState(null),a=d=>{i(d),setTimeout(()=>{s(d),n()},300)},l=()=>e.participants.map((d,u)=>{var S,E;const p=((S=d.relationship)==null?void 0:S.jealousy)||0,c=((E=d.relationship)==null?void 0:E.affection)||0,m=Hg(c),y=Hg(p);return r.jsxs("div",{style:Xe.npcCard,children:[r.jsxs("div",{style:Xe.npcHeader,children:[r.jsx("span",{style:Xe.npcName,children:d.name}),r.jsx("span",{style:Xe.npcRealm,children:d.tierTitle||""})]}),r.jsxs("div",{style:Xe.npcStats,children:[r.jsxs("div",{style:Xe.statBar,children:[r.jsx("span",{style:Xe.statLabel,children:""}),r.jsx("div",{style:Xe.barContainer,children:r.jsx("div",{style:{...Xe.barFill,width:`${m}%`,background:"#ff6b9d"}})}),r.jsx("span",{style:Xe.statValue,children:m})]}),r.jsxs("div",{style:Xe.statBar,children:[r.jsx("span",{style:Xe.statLabel,children:""}),r.jsx("div",{style:Xe.barContainer,children:r.jsx("div",{style:{...Xe.barFill,width:`${y}%`,background:y>=80?"#d32f2f":y>=60?"#f44336":"#ff9800"}})}),r.jsx("span",{style:Xe.statValue,children:y})]})]})]},d.id)});return r.jsx("div",{style:Xe.overlay,children:r.jsxs("div",{style:Xe.modalWrapper,children:[r.jsx("button",{onClick:n,style:Xe.closeBtn,"aria-label":"",children:""}),r.jsxs("div",{style:Xe.modal,children:[r.jsxs("h2",{style:Xe.title,children:[r.jsx("span",{style:Xe.titleIcon,children:""}),"",r.jsx("span",{style:Xe.titleIcon,children:""})]}),r.jsxs("div",{style:Xe.content,children:[r.jsx("div",{style:Xe.sceneDescription,children:r.jsx("p",{style:Xe.mainText,children:e.description})}),r.jsxs("div",{style:Xe.participants,children:[r.jsx("h3",{style:Xe.sectionTitle,children:""}),r.jsx("div",{style:Xe.npcList,children:l()})]}),e.dialogues&&e.dialogues.length>0&&r.jsx("div",{style:Xe.dialogues,children:e.dialogues.map((d,u)=>r.jsxs("div",{style:Xe.dialogueItem,children:[r.jsxs("span",{style:Xe.dialogueSpeaker,children:[d.speaker,""]}),r.jsxs("span",{style:Xe.dialogueText,children:['"',d.text,'"']})]},u))}),r.jsx("div",{style:Xe.options,children:e.options.map((d,u)=>r.jsxs("button",{style:{...Xe.optionBtn,...o===d?Xe.optionBtnSelected:{}},onClick:()=>a(d),children:[r.jsx("div",{style:Xe.optionLabel,children:d.label}),d.hint&&r.jsx("div",{style:Xe.optionHint,children:d.hint})]},u))})]})]})]})})},Xe={overlay:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0, 0, 0, 0.7)",display:"flex",justifyContent:"center",alignItems:"center",zIndex:1100,backdropFilter:"blur(3px)",animation:"fadeIn 0.3s ease-out"},modalWrapper:{position:"relative",width:"min(700px, calc(100vw - 32px))"},modal:{width:"90%",maxWidth:"700px",maxHeight:"90vh",backgroundColor:"#fff5f5",borderRadius:"20px",padding:"30px",position:"relative",boxShadow:"0 10px 40px rgba(211, 47, 47, 0.3)",border:"3px solid #ffcdd2",overflowY:"auto",animation:"slideIn 0.4s ease-out"},closeBtn:{position:"absolute",top:"-20px",left:"-20px",border:"none",background:"#fff5f5",fontSize:"26px",cursor:"pointer",color:"#d32f2f",width:"48px",height:"48px",borderRadius:"50%",display:"flex",alignItems:"center",justifyContent:"center",boxShadow:"0 12px 30px rgba(211,47,47,0.25)"},title:{fontSize:"28px",marginBottom:"25px",color:"#d32f2f",textAlign:"center",fontWeight:"bold",paddingBottom:"15px",borderBottom:"3px solid #ffcdd2",fontFamily:"Microsoft YaHei, serif",textShadow:"2px 2px 4px rgba(211, 47, 47, 0.2)",display:"flex",alignItems:"center",justifyContent:"center",gap:"15px"},titleIcon:{fontSize:"24px",animation:"pulse 2s infinite"},content:{maxHeight:"calc(90vh - 120px)",overflowY:"auto",paddingRight:"10px"},sceneDescription:{marginBottom:"25px",padding:"20px",background:"linear-gradient(135deg, #fff 0%, #ffebee 100%)",borderRadius:"15px",border:"2px solid #ffcdd2",boxShadow:"0 4px 12px rgba(211, 47, 47, 0.1)"},mainText:{fontSize:"17px",lineHeight:"1.9",color:"#5d4037",margin:0,fontFamily:"Microsoft YaHei, serif",textAlign:"justify"},participants:{marginBottom:"25px"},sectionTitle:{fontSize:"18px",color:"#d32f2f",marginBottom:"15px",fontWeight:"bold",paddingLeft:"10px",borderLeft:"4px solid #d32f2f"},npcList:{display:"flex",flexDirection:"column",gap:"12px"},npcCard:{padding:"15px",background:"#fff",borderRadius:"12px",border:"2px solid #ffcdd2",boxShadow:"0 2px 8px rgba(211, 47, 47, 0.1)"},npcHeader:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"10px"},npcName:{fontSize:"16px",fontWeight:"bold",color:"#d32f2f"},npcRealm:{fontSize:"13px",color:"#666",background:"#f5f5f5",padding:"4px 10px",borderRadius:"8px"},npcStats:{display:"flex",flexDirection:"column",gap:"8px"},statBar:{display:"flex",alignItems:"center",gap:"10px"},statLabel:{fontSize:"13px",color:"#666",minWidth:"40px"},barContainer:{flex:1,height:"8px",background:"#e0e0e0",borderRadius:"4px",overflow:"hidden"},barFill:{height:"100%",transition:"width 0.5s ease"},statValue:{fontSize:"13px",color:"#666",minWidth:"30px",textAlign:"right"},dialogues:{marginBottom:"25px",padding:"20px",background:"#fafafa",borderRadius:"12px",border:"1px solid #e0e0e0"},dialogueItem:{marginBottom:"12px",fontSize:"15px",lineHeight:"1.8",color:"#5d4037"},dialogueSpeaker:{fontWeight:"bold",color:"#d32f2f"},dialogueText:{color:"#5d4037",fontStyle:"italic"},options:{display:"flex",flexDirection:"column",gap:"12px",marginTop:"20px"},optionBtn:{padding:"18px 20px",border:"2px solid #ffcdd2",borderRadius:"12px",background:"linear-gradient(135deg, #ffffff 0%, #fff5f5 100%)",cursor:"pointer",textAlign:"left",transition:"all 0.3s ease",fontSize:"15px",color:"#5d4037",boxShadow:"0 2px 8px rgba(211, 47, 47, 0.1)"},optionBtnSelected:{background:"linear-gradient(135deg, #ffebee 0%, #ffcdd2 100%)",borderColor:"#d32f2f",transform:"translateY(-2px)",boxShadow:"0 4px 12px rgba(211, 47, 47, 0.2)"},optionLabel:{fontSize:"15px",fontWeight:"bold",marginBottom:"5px"},optionHint:{fontSize:"13px",color:"#999",marginTop:"5px"}},fC=(e="")=>{switch(e){case"":return"#c62828";case"":return"#ef6c00";case"":return"#fb8c00";case"":return"#fdd835";default:return"#8d6e63"}},mC=({event:e,onClose:t})=>{if(!e)return null;const{alerts:n=[],summary:s,actionLabel:o,timestamp:i={},targetName:a}=e,l=`${i.year||"???"}${i.month||"??"}  ${o||""}`;return r.jsx("div",{style:Yt.overlay,children:r.jsxs("div",{style:Yt.modal,children:[r.jsx("button",{type:"button","aria-label":"",onClick:t,style:Yt.closeBtn,children:""}),r.jsx("h2",{style:Yt.title,children:" "}),r.jsx("p",{style:Yt.subtitle,children:l}),r.jsx("div",{style:Yt.summaryBox,children:r.jsx("p",{style:Yt.summaryText,children:s})}),r.jsx("div",{style:Yt.alertList,children:n.map(d=>r.jsxs("div",{style:Yt.alertCard,children:[r.jsxs("div",{style:Yt.alertHeader,children:[r.jsxs("div",{style:Yt.alertNameRow,children:[r.jsx("span",{style:Yt.alertName,children:d.witnessName}),r.jsx("span",{style:{...Yt.levelBadge,backgroundColor:fC(d.level)},children:d.level})]}),r.jsxs("span",{style:Yt.targetTip,children:["",d.targetName||a]})]}),r.jsxs("div",{style:Yt.alertMeta,children:["",o]}),r.jsxs("div",{style:Yt.alertMeta,children:["+",d.increase,"  ",d.newJealousy]})]},`${d.witnessName}-${d.targetName}-${d.newJealousy}`))}),r.jsx("button",{type:"button",onClick:t,style:Yt.primaryBtn,children:""})]})})},Yt={overlay:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0,0,0,0.65)",display:"flex",justifyContent:"center",alignItems:"center",zIndex:2300,padding:"16px"},modal:{width:"min(640px, 100%)",background:"#fffdf7",borderRadius:"18px",padding:"28px 26px 32px",position:"relative",boxShadow:"0 18px 40px rgba(93,64,55,0.3)",border:"2px solid #ffe0b2",maxHeight:"92vh",overflowY:"auto"},closeBtn:{position:"absolute",top:"14px",right:"14px",border:"none",background:"transparent",fontSize:"26px",cursor:"pointer",color:"#8d6e63"},title:{margin:0,fontSize:"26px",color:"#c62828",textAlign:"center"},subtitle:{textAlign:"center",margin:"6px 0 18px",color:"#795548",fontSize:"14px"},summaryBox:{background:"#fff8e1",borderRadius:"12px",border:"1px solid #ffe0b2",padding:"16px",marginBottom:"18px"},summaryText:{margin:0,fontSize:"15px",lineHeight:1.7,color:"#5d4037",whiteSpace:"pre-line"},alertList:{display:"flex",flexDirection:"column",gap:"12px",marginBottom:"24px"},alertCard:{border:"1px solid #ffe0b2",borderRadius:"12px",padding:"14px 16px",background:"#fff"},alertHeader:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"8px"},alertNameRow:{display:"flex",alignItems:"center",gap:"8px"},alertName:{fontWeight:"bold",fontSize:"16px",color:"#5d4037"},levelBadge:{padding:"2px 10px",borderRadius:"999px",color:"#fff",fontSize:"12px"},targetTip:{fontSize:"13px",color:"#8d6e63"},alertMeta:{fontSize:"14px",color:"#6d4c41"},primaryBtn:{width:"100%",padding:"12px",borderRadius:"10px",border:"none",background:"linear-gradient(120deg, #ffb300, #ff7043)",color:"#fff",fontSize:"16px",fontWeight:"bold",cursor:"pointer"}},gC=["","","","","",""],Wg={COMMON:"",UNCOMMON:"",RARE:"",EPIC:"",LEGENDARY:"",MYTHIC:"",UNIQUE:"",SPECIAL:""},hC=e=>{var n;if(!e)return"";const t=e.toString().trim().toUpperCase();return(n=Q[t])!=null&&n.label?Q[t].label:Wg[t]?Wg[t]:/^[A-Z]+$/.test(t)?"":e},Ug=(e=[])=>{const t={};return e.forEach(n=>{n!=null&&n.id&&(t[n.id]=[{bidder:"",amount:Math.max(1,n.basePrice||0),time:Date.now()}])}),t},xC=({auction:e,playerResources:t,onClose:n,onBuy:s,onShowPlot:o,playerSoldAuctionItems:i=[]})=>{if(!e)return null;const a=b.useMemo(()=>e.items||[],[e]),l=()=>typeof window>"u"?!1:window.innerWidth<=768,[d,u]=b.useState(l),[p,c]=b.useState(()=>Ug(a)),[m,y]=b.useState(null),[S,E]=b.useState(a[0]||null),[w,g]=b.useState({}),[h,v]=b.useState(null),[x,I]=b.useState({}),_=b.useRef(p),N=(W,J)=>d?J:W;b.useEffect(()=>{_.current=p},[p]),b.useEffect(()=>{if(typeof window>"u")return;const W=()=>u(l());return window.addEventListener("resize",W),()=>window.removeEventListener("resize",W)},[]),b.useEffect(()=>{const W=Ug(a);c(W),_.current=W,y(null),E(a[0]||null),g({}),v(null),I({})},[a]);const C=W=>{W&&v({...W,id:Date.now()})},j=W=>_.current[W]||[],T=W=>{const J=j(W);return J.length===0?0:J[J.length-1].amount},A=W=>{const J=j(W);return J.length===0?null:J[J.length-1].bidder},V=(W,J,fe)=>{c(re=>{const ce=re[W]?[...re[W]]:[];ce.push({bidder:J,amount:fe,time:Date.now()});const Ce={...re,[W]:ce};return _.current=Ce,Ce})},F=(W,J)=>{c(fe=>{const re=[...fe[W]||[]];for(let Ce=re.length-1;Ce>=0;Ce-=1)if(re[Ce].bidder===""&&(!J||re[Ce].amount===J)){re.splice(Ce,1);break}const ce={...fe,[W]:re};return _.current=ce,ce})},B=W=>Math.max(1,Math.floor(((W==null?void 0:W.basePrice)||0)*.05)),$=W=>Math.max(1,Math.floor((W==null?void 0:W.basePrice)||0))*2,Y=(W,J)=>{I(fe=>({...fe,[W]:{enabled:!1,ceiling:"",...fe[W]||{},...J}}))},ne=W=>{const J=x[W.id];if(!(J!=null&&J.enabled))return;const fe=Number(J.ceiling)||0,re=T(W.id);if(A(W.id)===""||fe<=0||re>=fe)return;const Ce=Math.min(fe,re+B(W));if(((t==null?void 0:t.spiritStones)||0)<Ce){C({type:"error",title:"",message:`${W.name} `}),Y(W.id,{enabled:!1});return}V(W.id,"",Ce)},X=W=>{for(let J=0;J<2;J+=1)gC.forEach(fe=>{if(Math.random()<.35){const re=T(W.id),ce=(W==null?void 0:W.basePrice)||0,Ce=Math.max(1,Math.floor(ce*(.02+Math.random()*.12))||1),Ge=$(W),Ne=Math.min(re+Ce,Ge);Ne>re&&(V(W.id,fe,Ne),ne(W))}})},ee=(W,J,fe)=>{fe!=null&&fe.success?(g(re=>({...re,[W.id]:{status:"won",price:J,bidder:""}})),Y(W.id,{enabled:!1}),C({type:"success",title:fe.title||"",message:fe.message||`${W.name} `})):(F(W.id,J),C({type:"error",title:(fe==null?void 0:fe.title)||"",message:(fe==null?void 0:fe.message)||""}))},ae=W=>{const J=`INSTANCE:${W.id}`,fe=!!w[W.id]||i.includes(J)||i.includes(W.id);if(!W||fe)return;const re=T(W.id);try{const ce=s(W,re);ce&&typeof ce.then=="function"?ce.then(Ce=>ee(W,re,Ce)).catch(()=>{ee(W,re,{success:!1,title:"",message:""})}):ee(W,re,ce)}catch{ee(W,re,{success:!1,title:"",message:""})}},Te=(W,J,fe)=>{const re=`INSTANCE:${W.id}`,ce=!!w[W.id]||i.includes(re)||i.includes(W.id);if(!W||ce){C({type:"error",title:"",message:""});return}const Ce=T(W.id)+B(W),Ge=Math.max(Number(J)||0,Ce);if(((t==null?void 0:t.spiritStones)||0)<Ge){C({type:"error",title:"",message:""});return}V(W.id,"",Ge),fe(""),X(W),setTimeout(()=>{A(W.id)===""&&ae(W)},60)},Be=W=>{y(W)},ze=()=>v(null);return r.jsxs("div",{style:{...He.overlay,alignItems:d?"flex-start":"center",padding:d?"12px":"20px"},children:[r.jsx("div",{style:{...He.modalWrapper,width:d?"100%":He.modalWrapper.width,maxHeight:d?"none":He.modalWrapper.maxHeight},children:r.jsxs("div",{style:{...He.modalShell,borderRadius:d?16:He.modalShell.borderRadius,padding:d?"18px":He.modalShell.padding,maxHeight:d?"none":He.modalShell.maxHeight},children:[r.jsxs("header",{style:{...He.header,paddingTop:d?"40px":"30px"},children:[r.jsx("button",{onClick:n,style:{...He.closeBtn,fontSize:N("14px","12px"),padding:N("6px 16px","4px 12px"),position:"absolute",top:d?"12px":"16px",left:d?"12px":"16px"},"aria-label":"",children:""}),r.jsxs("div",{style:{flex:1},children:[r.jsx("h2",{style:{...He.title,fontSize:N("24px","18px")},children:e.title}),r.jsx("p",{style:{...He.message,fontSize:N("14px","12px")},children:e.message})]}),r.jsx("div",{style:He.headerActions,children:r.jsxs("div",{style:{...He.resourceChip,fontSize:N("14px","12px"),padding:N("6px 14px","4px 10px")},children:["  ",(t==null?void 0:t.spiritStones)||0]})})]}),r.jsx("div",{style:{...He.body,flexDirection:"column",gap:"16px"},children:m?r.jsxs("div",{style:{...He.plotCard,padding:N("20px","16px")},children:[r.jsx("h3",{style:{...He.plotTitle,fontSize:N("18px","16px")},children:m.name}),r.jsx("div",{style:{...He.plotContent,fontSize:N("14px","13px")},children:o(m)}),r.jsx("button",{style:{...He.backBtn,fontSize:N("13px","12px"),padding:N("10px","8px")},onClick:()=>y(null),children:""})]}):r.jsx("section",{style:{...He.catalogPanel,gridTemplateColumns:d?"1fr":He.catalogPanel.gridTemplateColumns,maxHeight:d?"none":He.catalogPanel.maxHeight,paddingRight:d?0:He.catalogPanel.paddingRight,gap:N(He.catalogPanel.gap,"12px")},children:a.map(W=>{const J=`INSTANCE:${W.id}`,fe=!!w[W.id]||i.includes(J)||i.includes(W.id);return r.jsx(yC,{item:W,bids:j(W.id),currentHighest:T(W.id),highestBidder:A(W.id),onPlayerBid:Te,onShowPlot:()=>Be(W),sold:fe,autoBidConfig:x[W.id],onAutoBidConfigChange:Y,isMobile:d},W.id)})})})]})}),h&&r.jsx("div",{style:He.feedbackOverlay,children:r.jsxs("div",{style:{...He.feedbackCard,borderColor:h.type==="success"?"#66bb6a":"#ef5350"},children:[r.jsx("h3",{style:{marginTop:0,color:h.type==="success"?"#1b5e20":"#b71c1c"},children:h.title}),r.jsx("p",{style:{whiteSpace:"pre-wrap",color:"#333"},children:h.message}),r.jsx("button",{style:He.feedbackBtn,onClick:ze,children:""})]})})]})},yC=({item:e,bids:t,currentHighest:n,highestBidder:s,onPlayerBid:o,onShowPlot:i,sold:a,autoBidConfig:l,onAutoBidConfigChange:d,isMobile:u})=>{const[p,c]=b.useState("");b.useEffect(()=>c(""),[e.id]);const m=(_,N)=>u?N:_,y=b.useMemo(()=>hC(e.rarity),[e.rarity]),S=b.useMemo(()=>[{label:"+5%",value:Math.max(1,Math.floor((e.basePrice||0)*.05))},{label:"+10%",value:Math.max(1,Math.floor((e.basePrice||0)*.1))},{label:"+50",value:50}],[e.basePrice]),E=n+Math.max(1,Math.floor((e.basePrice||0)*.05)),w=l||{enabled:!1,ceiling:""},g=_=>{const N=Number(p)||n;c(String(N+_))},h=()=>{o(e,p,c)},v=()=>{d(e.id,{enabled:!w.enabled})},x=_=>{const N=Number(_.replace(/[^0-9]/g,""));d(e.id,{ceiling:Number.isNaN(N)?"":N})},I=t.slice(-3).reverse();return r.jsxs("div",{style:{...He.item,borderColor:a?"#66bb6a":"#f5deb3",opacity:a?.6:1,padding:m("14px","12px"),gap:m("8px","6px")},children:[r.jsxs("div",{style:{...He.itemHeader,flexDirection:u?"column":"row",gap:u?"4px":"0"},children:[r.jsx("div",{style:{fontWeight:"bold",color:"#4e342e",fontSize:m("14px","13px")},children:e.name}),r.jsxs("div",{style:{color:"#ffb300",fontWeight:"bold",fontSize:m("14px","13px")},children:[n," "]})]}),r.jsx("div",{style:{...He.desc,fontSize:m("13px","12px")},children:e.description}),r.jsxs("div",{style:{...He.chipRow,gap:m("6px","4px")},children:[r.jsx("span",{style:{...He.chip,fontSize:m("11px","10px")},children:y}),r.jsxs("span",{style:{...He.chip,fontSize:m("11px","10px")},children:[" ",Math.max(1,Math.floor((e.basePrice||0)*.05))]}),a&&r.jsx("span",{style:{...He.chip,background:"#ef5350",color:"#fff",fontSize:m("11px","10px"),fontWeight:"bold"},children:""})]}),r.jsxs("div",{style:{...He.bidRow,flexDirection:u?"column":"row",gap:u?"4px":"0"},children:[r.jsxs("div",{style:{...He.bidMeta,fontSize:m("12px","11px")},children:["",s||""]}),r.jsxs("div",{style:{...He.bidMeta,fontSize:m("12px","11px")},children:["",E]})]}),r.jsxs("div",{style:{...He.inputRow,flexDirection:u?"column":"row"},children:[r.jsx("input",{value:p,onChange:_=>c(_.target.value),placeholder:` ${E}`,style:{...He.input,fontSize:m("13px","12px"),padding:m("8px","6px")},disabled:!!a}),r.jsx("button",{style:{...He.bidBtn,fontSize:m("13px","12px"),padding:m("8px 14px","6px 12px")},onClick:h,disabled:!!a,children:""}),r.jsx("button",{style:{...He.plotBtn,fontSize:m("13px","12px"),padding:m("8px 12px","6px 10px")},onClick:i,children:""})]}),r.jsx("div",{style:{...He.quickRow,flexWrap:u?"wrap":"nowrap"},children:S.map(_=>r.jsx("button",{style:{...He.quickBtn,flex:u?"1 1 30%":"1",fontSize:m("12px","11px")},disabled:!!a,onClick:()=>g(_.value),children:_.label},_.label))}),r.jsxs("div",{style:{...He.autoBidRow,flexDirection:u?"column":"row",alignItems:u?"flex-start":"center"},children:[r.jsxs("label",{style:{display:"flex",alignItems:"center",gap:8,fontSize:m("12px","11px")},children:[r.jsx("input",{type:"checkbox",checked:!!w.enabled,onChange:v,disabled:!!a}),r.jsx("span",{children:""})]}),r.jsx("input",{value:w.ceiling,onChange:_=>x(_.target.value),placeholder:"",style:{...He.input,width:m("120px","100%"),fontSize:m("13px","12px"),padding:m("8px","6px")},disabled:!w.enabled||a})]}),r.jsx("div",{style:{...He.history,fontSize:m("12px","11px")},children:I.map((_,N)=>r.jsxs("div",{style:{...He.historyRow,fontSize:m("12px","11px")},children:[r.jsx("span",{children:_.bidder}),r.jsxs("span",{children:[_.amount," "]})]},`${_.bidder}-${N}`))})]})},He={overlay:{position:"fixed",inset:0,backgroundColor:"rgba(0,0,0,0.7)",display:"flex",justifyContent:"center",alignItems:"center",zIndex:1200,padding:"20px",overflowY:"auto"},modalWrapper:{position:"relative",width:"min(1080px, 96vw)",maxHeight:"92vh"},modalShell:{position:"relative",background:"linear-gradient(160deg, rgba(29,24,18,0.95), rgba(36,28,22,0.92))",borderRadius:"24px",border:"1px solid rgba(255,255,255,0.08)",boxShadow:"0 25px 80px rgba(0,0,0,0.55)",padding:"24px",color:"#fcefdc",maxHeight:"92vh",overflow:"hidden",display:"flex",flexDirection:"column"},header:{position:"relative",display:"flex",justifyContent:"space-between",gap:"16px",borderBottom:"1px solid rgba(255,255,255,0.08)",paddingBottom:"16px"},headerActions:{display:"flex",alignItems:"center",gap:"12px"},title:{margin:0,fontSize:"24px",letterSpacing:"1px"},message:{margin:"6px 0 0",color:"#f5d7a0"},resourceChip:{background:"rgba(0,0,0,0.35)",padding:"6px 14px",borderRadius:"999px",fontWeight:"bold",border:"1px solid rgba(255,255,255,0.15)"},closeBtn:{border:"1px solid rgba(255,255,255,0.35)",background:"transparent",color:"#fff",borderRadius:"999px",padding:"6px 16px",cursor:"pointer"},body:{marginTop:"20px",overflow:"hidden"},catalogPanel:{flex:1,maxHeight:"60vh",overflowY:"auto",display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(260px, 1fr))",gap:"14px",paddingRight:"6px"},plotCard:{borderRadius:"18px",padding:"20px",background:"rgba(0,0,0,0.35)",border:"1px solid rgba(255,255,255,0.06)",flex:1,display:"flex",flexDirection:"column"},plotTitle:{margin:0,color:"#ffe0b2"},plotContent:{marginTop:"12px",whiteSpace:"pre-wrap",lineHeight:1.6,color:"#f8f0dd",overflowY:"auto"},backBtn:{marginTop:"auto",border:"1px solid rgba(255,255,255,0.4)",borderRadius:"12px",padding:"10px",background:"transparent",color:"#fff",cursor:"pointer"},item:{borderRadius:"16px",border:"1px solid #f5deb3",background:"rgba(255,252,247,0.9)",padding:"14px",display:"flex",flexDirection:"column",gap:"8px"},itemHeader:{display:"flex",justifyContent:"space-between"},desc:{fontSize:"13px",color:"#654321"},chipRow:{display:"flex",gap:"6px",flexWrap:"wrap"},chip:{padding:"2px 10px",borderRadius:"999px",background:"rgba(255,193,7,0.15)",border:"1px solid rgba(255,193,7,0.3)",fontSize:"11px",color:"#a15c00"},bidRow:{display:"flex",justifyContent:"space-between",fontSize:"12px",color:"#775c44"},bidMeta:{fontSize:"12px"},inputRow:{display:"flex",gap:"8px"},input:{flex:1,borderRadius:"10px",border:"1px solid #d7ccc8",padding:"8px"},bidBtn:{padding:"8px 14px",borderRadius:"10px",border:"none",background:"#8d6e63",color:"#fff",cursor:"pointer"},plotBtn:{padding:"8px 12px",borderRadius:"10px",border:"1px solid #d7ccc8",background:"transparent",cursor:"pointer"},quickRow:{display:"flex",gap:"8px"},quickBtn:{flex:1,padding:"6px 0",borderRadius:"8px",border:"1px dashed #c7b8a3",background:"transparent",cursor:"pointer"},autoBidRow:{display:"flex",alignItems:"center",justifyContent:"space-between",gap:"10px"},history:{marginTop:"8px",borderTop:"1px dashed #d7ccc8",paddingTop:"8px"},historyRow:{display:"flex",justifyContent:"space-between",fontSize:"12px"},feedbackOverlay:{position:"fixed",inset:0,background:"rgba(0,0,0,0.55)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1300,padding:"20px"},feedbackCard:{background:"#fffef8",borderRadius:"18px",padding:"24px",maxWidth:"420px",width:"100%",border:"2px solid",boxShadow:"0 18px 45px rgba(0,0,0,0.3)"},feedbackBtn:{marginTop:"16px",width:"100%",padding:"10px 12px",borderRadius:"12px",border:"none",background:"#6d4c41",color:"#fff",cursor:"pointer"}},bu={common:"#9e9e9e",uncommon:"#4caf50",rare:"#2196f3",epic:"#9c27b0",legendary:"#ff9800"},Gg=[{id:"ALL",label:"",matcher:()=>!0},{id:"CONSUMABLE",label:"",matcher:e=>e.type==="consumable"},{id:"EQUIPMENT",label:"",matcher:e=>["weapon","armor","accessory"].includes(e.type)},{id:"MANUAL",label:"",matcher:e=>e.type==="manual"},{id:"OTHER",label:"",matcher:e=>!["consumable","manual","weapon","armor","accessory"].includes(e.type)}],bC=({items:e=[],mode:t="VIEW",slot:n=null,childId:s=null,children:o=[],batchUseItems:i=[],onClose:a,onEquip:l,onUse:d,onBatchUse:u,onGiveToChild:p,onBatchGive:c,onSell:m,onDiscard:y,onAutoAssignManual:S,getMarketPrice:E})=>{const[w,g]=b.useState([]),[h,v]=b.useState(!1),[x,I]=b.useState("grid"),[_,N]=b.useState("ALL"),[C,j]=b.useState(!1),[T,A]=b.useState({}),[V,F]=b.useState(!1),[B,$]=b.useState({}),Y=t==="VIEW",ne=e.some(z=>z.type==="manual");b.useEffect(()=>{t!=="VIEW"&&_!=="ALL"&&N("ALL")},[t,_]);const X=z=>z.type!=="manual"?null:r.jsxs("div",{style:Oe.manualInfo,children:[z.tier&&r.jsx("span",{style:{...Oe.manualBadge,background:z.tierColor||"#999",marginRight:"8px"},children:z.tier}),z.element&&r.jsxs("span",{style:{...Oe.manualBadge,background:"#e3f2fd",color:"#1976d2",marginRight:"8px"},children:[": ",z.element]}),z.baseBonus&&r.jsxs("span",{style:{...Oe.manualBadge,background:"#e8f5e9",color:"#2e7d32"},children:[": ",z.baseBonus]})]}),ee=t==="SELECT"&&n?e.filter(z=>z.slot===n):t==="MANUAL_SELECT"?e.filter(z=>z.type==="manual"):e,Te=(z=>{if(!Y||_==="ALL")return z;const ue=Gg.find(ve=>ve.id===_);return ue?z.filter(ue.matcher):z})(ee),Be={legendary:5,epic:4,rare:3,uncommon:2,common:1},ze=[...Te].sort((z,ue)=>{const ve=Be[z.rarity]||0,ge=Be[ue.rarity]||0;return ge!==ve?ge-ve:(ue.name||"")!==(z.name||"")?(z.name||"").localeCompare(ue.name||""):(ue.quantity||0)-(z.quantity||0)}),W=z=>!z||!Array.isArray(z.usageTargets)||z.usageTargets.length===0?!0:z.usageTargets.includes(ft.CHILD),J=z=>W(z)?z.type==="manual"?{allowed:!1,reason:""}:z.type==="consumable"?{allowed:!0,reason:""}:z.type==="weapon"||z.type==="armor"||z.type==="accessory"?{allowed:!0,reason:""}:{allowed:!1,reason:""}:{allowed:!1,reason:""},fe=z=>{w.includes(z)?g(w.filter(ue=>ue!==z)):g([...w,z])},re=()=>{if(w.length===0){window.showResult&&window.showResult("","",!1,null,!1);return}const z=w.filter(ve=>{const ge=e.find(Ee=>Ee.instanceId===ve);return ge&&J(ge).allowed});if(z.length===0){window.showResult&&window.showResult("","",!1,null,!1);return}F(!0),v(!1);const ue={};z.forEach(ve=>{e.find(Ee=>Ee.instanceId===ve)&&(ue[ve]=1)}),$(ue)},ce={consumable:"",weapon:"",armor:"",accessory:"",manual:""},Ce={consumable:"",weapon:"",armor:"",accessory:"",manual:""},Ge={weapon:"",armor:"",accessory:""},Ne=z=>z.icon||z.emoji||Ce[z.type]||"",nt=z=>{if(z.type==="consumable"&&z.effect){const ge=z.effect;if(ge.kind==="exp")return` +${ge.amount}`;if(ge.kind==="aptitude")return` +${ge.amount}`;if(ge.kind==="intelligence")return` +${ge.amount}`;if(ge.kind==="heal")return` +${ge.amount}`}if(z.type==="manual"&&z.manualIds)return` ${z.manualIds.length} `;const ue=z.stats||{},ve=[];return ue.atk&&ve.push(` +${ue.atk}`),ue.hp&&ve.push(` +${ue.hp}`),ue.mp&&ve.push(` +${ue.mp}`),ve.join(" / ")},Le=z=>{if(h)return null;const ue=[];return t==="SELECT"&&z.slot===n&&ue.push(r.jsx("button",{style:Oe.btnPrimary,onClick:ve=>{ve.stopPropagation(),l&&l(z.instanceId)},children:""},"equip")),t==="MANUAL_SELECT"&&z.type==="manual"&&ue.push(r.jsx("button",{style:Oe.btnPrimary,onClick:ve=>{ve.stopPropagation(),d&&d(z.instanceId)},children:""},"manual")),t==="VIEW"&&z.type==="consumable"&&ue.push(r.jsx("button",{style:Oe.btnPrimary,onClick:ve=>{ve.stopPropagation(),d&&d(z.instanceId)},children:s?"":""},"use")),t==="VIEW"&&z.type==="manual"&&ue.push(r.jsx("button",{style:Oe.btnPrimary,onClick:ve=>{ve.stopPropagation(),d&&d(z.instanceId)},children:s?"":""},"study")),t==="VIEW"&&!s&&ue.push(r.jsx("button",{style:{...Oe.btnSecondary,background:"#e53935"},onClick:ve=>{ve.stopPropagation(),window.showConfirm?window.showConfirm(` ${z.name}${z.quantity&&z.quantity>1?" () ":""}`,()=>{y&&y(z.instanceId)}):y&&y(z.instanceId)},children:""},"discard")),t==="VIEW"&&!s&&o&&o.length>0&&ue.push(r.jsx("button",{style:Oe.btnSecondary,onClick:ve=>{ve.stopPropagation(),p&&p(z.instanceId)},children:""},"give")),t==="SELL"&&ue.push(r.jsx("button",{style:{...Oe.btnPrimary,background:"#f57c00"},onClick:ve=>{if(ve.stopPropagation(),!!m){if(z.quantity&&z.quantity>1&&window.showConfirm){window.showConfirm(`1-${z.quantity}`,ge=>{const Ee=parseInt(ge||`${z.quantity}`,10);if(!Ee||Ee<=0){window.showResult&&window.showResult("","",!1,null,!1);return}m(z.instanceId,Math.min(Ee,z.quantity||1))},{input:{type:"number",min:1,max:z.quantity||1,step:1,defaultValue:`${z.quantity}`}});return}m(z.instanceId,1)}},children:""},"sell")),ue.length?ue:null};return r.jsx("div",{style:Oe.overlay,children:r.jsxs("div",{style:Oe.modal,children:[r.jsxs("div",{style:Oe.header,children:[r.jsx("h3",{style:{margin:0},children:t==="SELECT"?"":""}),r.jsx("button",{style:Oe.close,onClick:a,children:""})]}),r.jsx("div",{style:Oe.tip,children:t==="SELECT"&&n?`${Ge[n]||n}`:t==="MANUAL_SELECT"?"":t==="SELL"?"":""}),r.jsxs("div",{style:Oe.toolbar,children:[r.jsxs("span",{style:Oe.toolbarMeta,children:[" ",ze.length,"   ",x==="grid"?"":""]}),r.jsxs("div",{style:Oe.viewSwitch,children:[r.jsx("button",{type:"button",style:x==="grid"?{...Oe.viewBtn,...Oe.viewBtnActive}:Oe.viewBtn,onClick:()=>I("grid"),children:" "}),r.jsx("button",{type:"button",style:x==="list"?{...Oe.viewBtn,...Oe.viewBtnActive}:Oe.viewBtn,onClick:()=>I("list"),children:" "})]})]}),Y&&r.jsxs("div",{style:Oe.categoryBar,children:[r.jsx("div",{style:Oe.categoryGroup,children:Gg.map(z=>r.jsx("button",{type:"button",onClick:()=>N(z.id),style:_===z.id?{...Oe.categoryBtn,...Oe.categoryBtnActive}:Oe.categoryBtn,children:z.label},z.id))}),S&&r.jsx("button",{type:"button",onClick:S,disabled:!ne||!(o&&o.length),style:{...Oe.autoAssignBtn,opacity:!ne||!(o&&o.length)?.5:1,cursor:!ne||!(o&&o.length)?"not-allowed":"pointer"},children:" "})]}),t==="VIEW"&&!s&&r.jsxs("div",{style:{padding:"10px 16px",borderBottom:"1px solid #eee",background:h?"#e3f2fd":"#f5f5f5",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[r.jsx("button",{onClick:()=>{v(!h),g([])},style:{padding:"6px 12px",border:"none",borderRadius:"6px",background:h?"#1976d2":"#757575",color:"#fff",cursor:"pointer",fontSize:"12px"},children:h?" ":" "}),h&&r.jsxs("div",{style:{display:"flex",gap:"8px",alignItems:"center"},children:[r.jsxs("span",{style:{fontSize:"12px",color:"#666"},children:[" ",w.length," "]}),!s&&r.jsx("button",{onClick:()=>{if(w.length===0){window.showResult&&window.showResult("","",!1,null,!1);return}j(!0),v(!1);const z={};w.forEach(ue=>{const ve=e.find(ge=>ge.instanceId===ue);ve&&ve.type==="consumable"&&(z[ue]=1)}),A(z)},disabled:w.length===0,style:{padding:"6px 12px",border:"none",borderRadius:"6px",background:w.length>0?"#4caf50":"#ccc",color:"#fff",cursor:w.length>0?"pointer":"not-allowed",fontSize:"12px"},children:""}),o&&o.length>0&&r.jsx("button",{onClick:re,disabled:w.length===0,style:{padding:"6px 12px",border:"none",borderRadius:"6px",background:w.length>0?"#7b1fa2":"#ccc",color:"#fff",cursor:w.length>0?"pointer":"not-allowed",fontSize:"12px"},children:""}),t==="SELL"&&r.jsx("button",{onClick:()=>{if(!m)return;if(w.length===0){window.showResult&&window.showResult("","",!1,null,!1);return}const z=w.map(ge=>{const Ee=e.find(Ke=>Ke.instanceId===ge);return Ee?{instanceId:ge,qty:Ee.quantity||1}:null}).filter(Boolean);let ue=0;const ve=()=>{if(ue>=z.length){g([]),v(!1);return}const{instanceId:ge,qty:Ee}=z[ue];m(ge,Ee),ue++,setTimeout(ve,50)};ve()},disabled:w.length===0,style:{padding:"6px 12px",border:"none",borderRadius:"6px",background:w.length>0?"#f57c00":"#ccc",color:"#fff",cursor:w.length>0?"pointer":"not-allowed",fontSize:"12px"},children:""}),o&&o.length>0&&r.jsx("button",{onClick:()=>{const z=Te.filter(ue=>J(ue).allowed).map(ue=>ue.instanceId);g(z)},style:{padding:"6px 12px",border:"none",borderRadius:"6px",background:"#00897b",color:"#fff",cursor:"pointer",fontSize:"12px"},children:""})]})]}),C&&r.jsxs("div",{style:{padding:"16px",background:"#e8f5e9",borderBottom:"1px solid #c8e6c9",borderRadius:"8px",margin:"8px"},children:[r.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"12px"},children:[r.jsx("h4",{style:{margin:0,color:"#2e7d32"},children:" "}),r.jsx("button",{onClick:()=>{j(!1),A({}),g([])},style:{padding:"4px 8px",border:"none",borderRadius:"4px",background:"#757575",color:"#fff",cursor:"pointer",fontSize:"11px"},children:""})]}),r.jsx("div",{style:{maxHeight:"200px",overflowY:"auto",marginBottom:"12px"},children:Object.keys(T).map(z=>{const ue=e.find(Ee=>Ee.instanceId===z);if(!ue)return null;const ve=ue.quantity||1,ge=T[z]||1;return r.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",padding:"8px",background:"#fff",borderRadius:"6px",marginBottom:"8px",border:"1px solid #c8e6c9"},children:[r.jsxs("span",{style:{fontSize:"13px",flex:1},children:[Ne(ue)," ",ue.name,r.jsxs("span",{style:{color:"#999",marginLeft:"8px"},children:["(: ",ve,")"]})]}),r.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[r.jsx("button",{onClick:()=>{const Ee=Math.max(1,ge-1);A(Ke=>({...Ke,[z]:Ee}))},disabled:ge<=1,style:{width:"24px",height:"24px",border:"none",borderRadius:"4px",background:ge<=1?"#e0e0e0":"#4caf50",color:"#fff",cursor:ge<=1?"not-allowed":"pointer",fontSize:"16px",lineHeight:"1"},children:"-"}),r.jsx("input",{type:"number",min:"1",max:ve,value:ge,onChange:Ee=>{const Ke=parseInt(Ee.target.value)||1,Ut=Math.max(1,Math.min(ve,Ke));A(xn=>({...xn,[z]:Ut}))},style:{width:"50px",padding:"4px",textAlign:"center",border:"1px solid #c8e6c9",borderRadius:"4px",fontSize:"13px"}}),r.jsx("button",{onClick:()=>{const Ee=Math.min(ve,ge+1);A(Ke=>({...Ke,[z]:Ee}))},disabled:ge>=ve,style:{width:"24px",height:"24px",border:"none",borderRadius:"4px",background:ge>=ve?"#e0e0e0":"#4caf50",color:"#fff",cursor:ge>=ve?"not-allowed":"pointer",fontSize:"16px",lineHeight:"1"},children:"+"}),r.jsx("button",{onClick:()=>{const Ee={...T};delete Ee[z],A(Ee),g(Ke=>Ke.filter(Ut=>Ut!==z))},style:{padding:"4px 8px",border:"none",borderRadius:"4px",background:"#f44336",color:"#fff",cursor:"pointer",fontSize:"11px"},children:""})]})]},z)})}),r.jsx("div",{style:{display:"flex",gap:"8px",justifyContent:"flex-end"},children:r.jsx("button",{onClick:()=>{const z=Object.keys(T).map(ue=>({instanceId:ue,quantity:T[ue]}));if(z.length===0){window.showResult&&window.showResult("","",!1,null,!1);return}u&&u(s||null,z),j(!1),A({}),g([])},style:{padding:"8px 16px",border:"none",borderRadius:"6px",background:"#4caf50",color:"#fff",cursor:"pointer",fontSize:"13px",fontWeight:"bold"},children:" "})})]}),V&&r.jsxs("div",{style:{padding:"16px",background:"#f3e5f5",borderBottom:"1px solid #e1bee7",borderRadius:"8px",margin:"8px"},children:[r.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"12px"},children:[r.jsx("h4",{style:{margin:0,color:"#7b1fa2"},children:" "}),r.jsx("button",{onClick:()=>{F(!1),$({}),g([])},style:{padding:"4px 8px",border:"none",borderRadius:"4px",background:"#757575",color:"#fff",cursor:"pointer",fontSize:"11px"},children:""})]}),r.jsx("div",{style:{maxHeight:"200px",overflowY:"auto",marginBottom:"12px"},children:Object.keys(B).map(z=>{const ue=e.find(Ee=>Ee.instanceId===z);if(!ue)return null;const ve=ue.quantity||1,ge=B[z]||1;return r.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",padding:"8px",background:"#fff",borderRadius:"6px",marginBottom:"8px",border:"1px solid #e1bee7"},children:[r.jsxs("span",{style:{fontSize:"13px",flex:1},children:[Ne(ue)," ",ue.name,r.jsxs("span",{style:{color:"#999",marginLeft:"8px"},children:["(: ",ve,")"]})]}),r.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[r.jsx("button",{onClick:()=>{const Ee=Math.max(1,ge-1);$(Ke=>({...Ke,[z]:Ee}))},disabled:ge<=1,style:{width:"24px",height:"24px",border:"none",borderRadius:"4px",background:ge<=1?"#e0e0e0":"#7b1fa2",color:"#fff",cursor:ge<=1?"not-allowed":"pointer",fontSize:"16px",lineHeight:"1"},children:"-"}),r.jsx("input",{type:"number",min:"1",max:ve,value:ge,onChange:Ee=>{const Ke=parseInt(Ee.target.value)||1,Ut=Math.max(1,Math.min(ve,Ke));$(xn=>({...xn,[z]:Ut}))},style:{width:"50px",padding:"4px",textAlign:"center",border:"1px solid #e1bee7",borderRadius:"4px",fontSize:"13px"}}),r.jsx("button",{onClick:()=>{const Ee=Math.min(ve,ge+1);$(Ke=>({...Ke,[z]:Ee}))},disabled:ge>=ve,style:{width:"24px",height:"24px",border:"none",borderRadius:"4px",background:ge>=ve?"#e0e0e0":"#7b1fa2",color:"#fff",cursor:ge>=ve?"not-allowed":"pointer",fontSize:"16px",lineHeight:"1"},children:"+"}),r.jsx("button",{onClick:()=>{const Ee={...B};delete Ee[z],$(Ee),g(Ke=>Ke.filter(Ut=>Ut!==z))},style:{padding:"4px 8px",border:"none",borderRadius:"4px",background:"#f44336",color:"#fff",cursor:"pointer",fontSize:"11px"},children:""})]})]},z)})}),r.jsx("div",{style:{display:"flex",gap:"8px",justifyContent:"flex-end"},children:r.jsx("button",{onClick:()=>{const z=Object.keys(B).map(ve=>({instanceId:ve,quantity:B[ve]}));if(z.length===0){window.showResult&&window.showResult("","",!1,null,!1);return}const ue=z.map(({instanceId:ve,quantity:ge})=>({instanceId:ve,quantity:ge}));c&&c(ue),F(!1),$({}),g([])},style:{padding:"8px 16px",border:"none",borderRadius:"6px",background:"#7b1fa2",color:"#fff",cursor:"pointer",fontSize:"13px",fontWeight:"bold"},children:" "})})]}),r.jsxs("div",{style:Oe.list,children:[ze.length===0&&r.jsx("div",{style:Oe.empty,children:""}),ze.length>0&&r.jsx("div",{style:x==="grid"?Oe.gridContainer:Oe.listContainer,children:ze.map(z=>{const ue=w.includes(z.instanceId),ve=J(z),ge=Le(z),Ee=t==="SELL"?Math.floor((E?E(z):z.sellPrice||z.price||0)*.7):null;return x==="grid"?r.jsxs("div",{style:{...Oe.gridCard,borderColor:ue?"#1976d2":"rgba(0,0,0,0.05)",borderWidth:"2px",boxShadow:ue?"0 0 0 1px #1976d2":"0 6px 16px rgba(0,0,0,0.08)",cursor:h?"pointer":"default"},onClick:()=>{h&&fe(z.instanceId)},children:[h&&r.jsx("input",{type:"checkbox",checked:ue,onChange:Ke=>{Ke.stopPropagation(),fe(z.instanceId)},style:Oe.gridCheckbox}),r.jsxs("div",{style:Oe.gridMain,children:[r.jsx("div",{style:{...Oe.gridIcon,borderColor:bu[z.rarity]||"#d7ccc8",borderWidth:"2px",borderStyle:"solid"},children:r.jsx("span",{children:Ne(z)})}),r.jsxs("div",{style:Oe.gridBody,children:[r.jsxs("div",{style:Oe.gridTitleRow,children:[r.jsx("span",{style:{color:bu[z.rarity]||"#333",fontWeight:"bold"},children:z.name}),z.quantity&&z.quantity>1&&r.jsxs("span",{style:Oe.gridQty,children:["x",z.quantity]})]}),r.jsxs("div",{style:Oe.gridMeta,children:[r.jsx("span",{style:Oe.gridTag,children:ce[z.type]||z.type}),r.jsx("span",{style:{fontSize:"11px",color:"#5d4037"},children:nt(z)||""})]}),r.jsx("div",{style:Oe.gridDesc,children:z.desc}),X(z),Ee!==null&&r.jsxs("div",{style:Oe.gridPrice,children:[": ",Ee," "]}),h&&!ve.allowed&&r.jsxs("div",{style:Oe.gridWarning,children:[" ",ve.reason]})]})]}),ge&&r.jsx("div",{style:Oe.gridActions,children:ge})]},z.instanceId):r.jsxs("div",{style:{...Oe.card,borderColor:ue?"#1976d2":"#eee",borderWidth:ue?"2px":"1px",background:ue?"#e3f2fd":"#fafafa",cursor:h?"pointer":"default"},onClick:()=>{h&&fe(z.instanceId)},children:[r.jsxs("div",{style:Oe.rowBetween,children:[r.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[h&&r.jsx("input",{type:"checkbox",checked:ue,onChange:Ke=>{Ke.stopPropagation(),fe(z.instanceId)},style:{cursor:"pointer"}}),r.jsx("span",{style:{color:bu[z.rarity]||"#333",fontWeight:"bold"},children:z.name}),z.quantity&&z.quantity>1&&r.jsxs("span",{style:{fontSize:"12px",color:"#666",marginLeft:"6px"},children:["x",z.quantity]})]}),r.jsx("span",{style:Oe.tag,children:ce[z.type]||z.type})]}),X(z),r.jsx("div",{style:Oe.desc,children:z.desc}),r.jsx("div",{style:Oe.stats,children:nt(z)||""}),Ee!==null&&r.jsxs("div",{style:{fontSize:"12px",color:"#f57c00",marginTop:6},children:[": ",Ee," "]}),h&&!ve.allowed&&r.jsxs("div",{style:{fontSize:"11px",color:"#f44336",marginTop:"4px",padding:"4px 8px",background:"rgba(244, 67, 54, 0.1)",borderRadius:"4px"},children:[" ",ve.reason]}),ge&&r.jsx("div",{style:Oe.actions,children:ge})]},z.instanceId)})})]})]})})},Oe={overlay:{position:"fixed",inset:0,background:"rgba(0,0,0,0.5)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:2e3},modal:{width:"520px",maxHeight:"80vh",background:"#fff",borderRadius:"12px",boxShadow:"0 10px 25px rgba(0,0,0,0.2)",display:"flex",flexDirection:"column"},header:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"12px 16px",borderBottom:"1px solid #eee"},close:{border:"none",background:"transparent",fontSize:"20px",cursor:"pointer",color:"#888"},tip:{padding:"8px 16px",fontSize:"12px",color:"#666",borderBottom:"1px dashed #eee"},toolbar:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"10px 16px",borderBottom:"1px solid #f0e0d6",background:"#fffbe6"},toolbarMeta:{fontSize:"12px",color:"#8d6e63"},viewSwitch:{display:"flex",gap:"6px"},viewBtn:{fontSize:"12px",padding:"4px 10px",borderRadius:"999px",border:"1px solid #d7ccc8",background:"#fff",cursor:"pointer",color:"#6d4c41"},viewBtnActive:{background:"#6d4c41",color:"#fff",borderColor:"#6d4c41"},categoryBar:{display:"flex",justifyContent:"space-between",alignItems:"center",gap:"12px",padding:"8px 16px",borderBottom:"1px solid #f0f0f0",background:"#fff"},categoryGroup:{display:"flex",flexWrap:"wrap",gap:"8px"},categoryBtn:{fontSize:"12px",padding:"4px 12px",borderRadius:"12px",border:"1px solid #d7ccc8",background:"#fff",color:"#6d4c41",cursor:"pointer",transition:"all 0.2s"},categoryBtnActive:{background:"#6d4c41",color:"#fff",borderColor:"#6d4c41",boxShadow:"0 2px 6px rgba(0,0,0,0.1)"},autoAssignBtn:{fontSize:"12px",padding:"6px 14px",borderRadius:"16px",border:"none",background:"linear-gradient(120deg, #ff9800, #ff5722)",color:"#fff",fontWeight:"bold"},list:{padding:"12px",overflowY:"auto"},listContainer:{display:"flex",flexDirection:"column",gap:"10px"},gridContainer:{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(180px, 1fr))",gap:"12px"},empty:{textAlign:"center",color:"#999",padding:"20px"},card:{borderWidth:"1px",borderStyle:"solid",borderColor:"#eee",borderRadius:"8px",padding:"10px",marginBottom:"10px",background:"#fafafa"},gridCard:{position:"relative",borderRadius:"12px",padding:"14px",background:"#fff",display:"flex",flexDirection:"column",gap:"10px",borderStyle:"solid",borderColor:"rgba(0,0,0,0.05)"},gridMain:{display:"flex",gap:"10px",alignItems:"flex-start"},rowBetween:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"6px"},tag:{fontSize:"10px",padding:"2px 6px",borderRadius:"6px",background:"#e0e0e0",color:"#555",textTransform:"uppercase"},desc:{fontSize:"12px",color:"#555",marginBottom:"6px"},stats:{fontSize:"12px",color:"#333",marginBottom:"8px"},actions:{display:"flex",gap:"8px",flexWrap:"wrap"},gridIcon:{width:"54px",height:"54px",borderRadius:"12px",borderWidth:"2px",borderStyle:"solid",borderColor:"#d7ccc8",display:"flex",alignItems:"center",justifyContent:"center",fontSize:"24px",color:"#4e342e"},gridBody:{display:"flex",flexDirection:"column",gap:"6px"},gridTitleRow:{display:"flex",justifyContent:"space-between",alignItems:"center"},gridQty:{fontSize:"12px",color:"#6d4c41"},gridMeta:{display:"flex",flexDirection:"column",alignItems:"flex-start",gap:"4px"},gridTag:{fontSize:"10px",padding:"2px 6px",borderRadius:"999px",background:"#f3e5f5",color:"#6a1b9a"},gridDesc:{fontSize:"11px",color:"#5d4037",lineHeight:1.4,minHeight:"32px"},gridActions:{display:"flex",flexWrap:"wrap",gap:"6px"},gridCheckbox:{position:"absolute",top:"10px",left:"10px",cursor:"pointer"},gridWarning:{fontSize:"11px",color:"#c62828",background:"rgba(198,40,40,0.08)",padding:"4px 8px",borderRadius:"6px"},gridPrice:{fontSize:"11px",color:"#f57c00",fontWeight:"bold"},btnPrimary:{padding:"6px 12px",border:"none",borderRadius:"6px",background:"#1976d2",color:"#fff",cursor:"pointer"},btnSecondary:{padding:"6px 12px",border:"none",borderRadius:"6px",background:"#7b1fa2",color:"#fff",cursor:"pointer",fontSize:"12px"},manualInfo:{display:"flex",flexWrap:"wrap",gap:"6px",marginTop:"8px",marginBottom:"8px"},manualBadge:{fontSize:"11px",padding:"3px 8px",borderRadius:"12px",color:"#fff",fontWeight:"bold",whiteSpace:"nowrap"}},vC=({child:e,onClose:t,onFinish:n})=>{const[s,o]=b.useState("INIT"),i=()=>{o("ANIMATING"),setTimeout(()=>{o("REVEAL")},2e3)},a=()=>{n(e),t()},l=d=>({:"#FFD700",:"#4CAF50",:"#2196F3",:"#F44336",:"#795548",:"#673AB7",:"#00BCD4",:"#009688"})[d]||"#ccc";return r.jsx("div",{style:br.overlay,children:r.jsxs("div",{style:br.card,children:[r.jsx("h2",{style:{color:"#3e2723"},children:" "}),s==="INIT"&&r.jsxs("div",{style:{textAlign:"center"},children:[r.jsx("h3",{style:{margin:"0 0 15px 0",color:"#3e2723"},children:e.name}),r.jsx("p",{children:""}),r.jsxs("p",{children:["",e.gender===""?"":"",""]}),r.jsx("div",{style:br.childIcon,children:e.gender===""?"":""}),r.jsx("button",{onClick:i,style:br.btn,children:" "})]}),s==="ANIMATING"&&r.jsxs("div",{style:{textAlign:"center"},children:[r.jsx("h3",{style:{margin:"0 0 15px 0",color:"#3e2723"},children:e.name}),r.jsx("div",{style:br.orb}),r.jsx("p",{children:"..."})]}),s==="REVEAL"&&r.jsxs("div",{style:{textAlign:"center",animation:"fadeIn 0.5s"},children:[r.jsx("h3",{style:{margin:"0 0 15px 0",color:"#3e2723"},children:e.name}),r.jsx("h3",{children:"  "}),r.jsxs("div",{style:br.resultBox,children:[r.jsx("div",{style:{color:e.spiritRoot.color,fontSize:"24px",fontWeight:"bold"},children:e.spiritRoot.type}),r.jsx("div",{style:br.elements,children:e.spiritRoot.elements.map(d=>r.jsx("span",{style:{...br.elBadge,background:l(d)},children:d},d))}),r.jsxs("div",{style:{marginTop:"15px"},children:[r.jsx("span",{style:{fontSize:"12px",color:"#666"},children:""}),r.jsxs("div",{style:{fontSize:"40px",fontWeight:"bold",color:"#333"},children:[e.stats.aptitude,r.jsx("span",{style:{fontSize:"14px",color:"#999"},children:"/100"})]})]}),r.jsx("p",{style:{fontSize:"12px",color:"#666",marginTop:"10px"},children:e.spiritRoot.desc})]}),r.jsxs("div",{style:br.stats,children:[r.jsxs("p",{children:[": ",r.jsx("strong",{children:e.stats.aptitude})]}),r.jsxs("p",{children:[": ",r.jsx("strong",{children:e.combatStats.mp})]})]}),r.jsx("button",{onClick:a,style:br.confirmBtn,children:""})]})]})})},br={overlay:{position:"fixed",top:0,left:0,right:0,bottom:0,background:"rgba(0,0,0,0.8)",display:"flex",justifyContent:"center",alignItems:"center",zIndex:400},card:{width:"320px",background:"#fff",borderRadius:"15px",padding:"30px",textAlign:"center",boxShadow:"0 0 20px rgba(255, 215, 0, 0.3)"},btn:{padding:"15px 30px",fontSize:"18px",background:"#3e2723",color:"white",border:"none",borderRadius:"25px",cursor:"pointer",marginTop:"20px"},confirmBtn:{padding:"10px 20px",background:"#4caf50",color:"white",border:"none",borderRadius:"5px",marginTop:"20px",cursor:"pointer"},orb:{width:"80px",height:"80px",borderRadius:"50%",background:"radial-gradient(circle, #fff, #2196f3, #000)",margin:"20px auto",animation:"pulse 1s infinite"},childIcon:{fontSize:"50px",margin:"20px 0"},resultBox:{background:"#f5f5f5",padding:"15px",borderRadius:"10px",margin:"20px 0"},elements:{display:"flex",justifyContent:"center",gap:"5px",marginBottom:"10px"},elBadge:{padding:"4px 8px",borderRadius:"50%",color:"white",fontWeight:"bold",width:"24px",height:"24px",lineHeight:"24px"},stats:{display:"flex",justifyContent:"space-around",fontSize:"14px",borderTop:"1px dashed #ccc",paddingTop:"15px"}},SC=["","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","",""],Vg=(e="")=>{if(!e)return 0;const t=SC.indexOf(e);return t>=0?t:0},vu=8,wC=({children:e,item:t,items:n,isBatch:s=!1,onSelect:o,onClose:i})=>{const[a,l]=b.useState(null),[d,u]=b.useState("age"),[p,c]=b.useState(1),m=b.useMemo(()=>{const E=[...e];return E.sort((w,g)=>{var h,v;switch(d){case"age":return w.age-g.age;case"aptitude":return(((h=g.stats)==null?void 0:h.aptitude)||0)-(((v=w.stats)==null?void 0:v.aptitude)||0);case"cultivation":const x=Vg(w.tier||""),I=Vg(g.tier||"");if(x!==I)return I-x;const _=w.currentExp||0;return(g.currentExp||0)-_;case"name":return w.name.localeCompare(g.name,"zh-CN");default:return 0}}),E},[e,d]),y=Math.max(1,Math.ceil(m.length/vu)),S=b.useMemo(()=>{const E=(p-1)*vu;return m.slice(E,E+vu)},[m,p]);return Ic.useEffect(()=>{c(1)},[d]),r.jsx("div",{style:dt.overlay,children:r.jsxs("div",{style:dt.modal,children:[r.jsxs("div",{style:dt.header,children:[r.jsx("h3",{style:{margin:0},children:""}),r.jsx("button",{style:dt.close,onClick:i,children:""})]}),r.jsx("div",{style:dt.tip,children:s?r.jsxs(r.Fragment,{children:[" ",r.jsx("strong",{style:{color:"#1976d2"},children:(n==null?void 0:n.length)||0})," ",r.jsxs("div",{style:{marginTop:"6px",fontSize:"11px",color:"#666"},children:[n==null?void 0:n.slice(0,3).map((E,w)=>r.jsxs("span",{style:{marginRight:"8px"},children:[" ",E.name]},w)),(n==null?void 0:n.length)>3&&`...${n.length}`]})]}):r.jsxs(r.Fragment,{children:[" ",r.jsx("strong",{style:{color:"#1976d2"},children:t==null?void 0:t.name})," "]})}),r.jsx("div",{style:dt.controlBar,children:r.jsxs("div",{style:dt.sortButtons,children:[r.jsx("button",{style:{...dt.sortBtn,...d==="age"?dt.sortBtnActive:{}},onClick:()=>u("age"),children:""}),r.jsx("button",{style:{...dt.sortBtn,...d==="cultivation"?dt.sortBtnActive:{}},onClick:()=>u("cultivation"),children:""}),r.jsx("button",{style:{...dt.sortBtn,...d==="aptitude"?dt.sortBtnActive:{}},onClick:()=>u("aptitude"),children:""}),r.jsx("button",{style:{...dt.sortBtn,...d==="name"?dt.sortBtnActive:{}},onClick:()=>u("name"),children:""})]})}),r.jsxs("div",{style:dt.list,children:[e.length===0&&r.jsx("div",{style:dt.empty,children:""}),S.map((E,w)=>{var g;return r.jsxs("div",{style:{...dt.childCard,...a===E.id?dt.childCardHover:{}},onClick:()=>o(E),onMouseEnter:()=>l(E.id),onMouseLeave:()=>l(null),children:[r.jsxs("div",{style:dt.childInfo,children:[r.jsxs("div",{style:dt.childHeader,children:[r.jsx("span",{style:dt.childName,children:E.name}),r.jsx("span",{style:dt.childTier,children:E.tierTitle||""})]}),r.jsxs("div",{style:dt.childStats,children:[r.jsxs("span",{children:[" ",Math.floor(E.age),""]}),r.jsxs("span",{children:[" ",E.gender]}),r.jsxs("span",{children:["  ",((g=E.stats)==null?void 0:g.aptitude)||50]})]})]}),r.jsx("div",{style:dt.arrow,children:""})]},E.id)})]}),y>1&&r.jsxs("div",{style:dt.pagination,children:[r.jsx("button",{style:{...dt.pageBtn,opacity:p===1?.5:1},disabled:p===1,onClick:()=>c(Math.max(1,p-1)),children:""}),r.jsxs("span",{style:dt.pageInfo,children:[" ",p," / ",y," "]}),r.jsx("button",{style:{...dt.pageBtn,opacity:p>=y?.5:1},disabled:p>=y,onClick:()=>c(Math.min(y,p+1)),children:""})]})]})})},dt={overlay:{position:"fixed",inset:0,background:"rgba(0,0,0,0.5)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:2100},modal:{width:"450px",maxHeight:"70vh",background:"#fff",borderRadius:"12px",boxShadow:"0 10px 25px rgba(0,0,0,0.2)",display:"flex",flexDirection:"column"},header:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"12px 16px",borderBottom:"1px solid #eee"},close:{border:"none",background:"transparent",fontSize:"20px",cursor:"pointer",color:"#888"},tip:{padding:"12px 16px",fontSize:"13px",color:"#555",background:"#f5f5f5",borderBottom:"1px solid #eee"},controlBar:{padding:"12px 12px",borderBottom:"1px solid #eee",backgroundColor:"#fafafa"},sortButtons:{display:"flex",gap:"6px",flexWrap:"wrap"},sortBtn:{padding:"6px 12px",fontSize:"11px",backgroundColor:"#f0f0f0",color:"#666",border:"1px solid #ddd",borderRadius:"4px",cursor:"pointer",transition:"all 0.2s"},sortBtnActive:{backgroundColor:"#1976d2",color:"#fff",borderColor:"#1976d2"},list:{padding:"12px",overflowY:"auto",flex:1},empty:{textAlign:"center",color:"#999",padding:"20px"},childCard:{borderWidth:"1px",borderStyle:"solid",borderColor:"#e0e0e0",borderRadius:"8px",padding:"12px",marginBottom:"10px",background:"#fafafa",cursor:"pointer",display:"flex",justifyContent:"space-between",alignItems:"center",transition:"all 0.2s"},childCardHover:{background:"#e3f2fd",borderColor:"#1976d2",borderWidth:"1px",borderStyle:"solid"},childInfo:{flex:1},childHeader:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"6px"},childName:{fontSize:"15px",fontWeight:"bold",color:"#333"},childTier:{fontSize:"11px",padding:"2px 8px",borderRadius:"10px",background:"#3e2723",color:"#fff"},childStats:{display:"flex",gap:"12px",fontSize:"12px",color:"#666"},arrow:{fontSize:"20px",color:"#1976d2",marginLeft:"10px"},pagination:{display:"flex",justifyContent:"center",alignItems:"center",gap:"8px",padding:"12px 16px",borderTop:"1px solid #eee",backgroundColor:"#fafafa"},pageBtn:{padding:"6px 12px",fontSize:"11px",backgroundColor:"#f0f0f0",color:"#666",border:"1px solid #ddd",borderRadius:"4px",cursor:"pointer",transition:"all 0.2s"},pageInfo:{color:"#666",fontSize:"12px",minWidth:"70px",textAlign:"center"}},kC=({child:e,onChangeManual:t})=>{if(!e.spiritRoot||!e.spiritRoot.elements)return r.jsxs("div",{style:qt.section,children:[r.jsx("h4",{style:qt.secTitle,children:" "}),r.jsx("p",{style:{color:"#999",fontSize:"12px"},children:"(6)"})]});const n=e.cultivationMethod||"basic_breath",s=Cc(n,e.spiritRoot);if(!s.manual)return r.jsxs("div",{style:qt.section,children:[r.jsx("h4",{style:qt.secTitle,children:" "}),r.jsx("p",{style:{color:"#999",fontSize:"12px"},children:""})]});const{manual:o,compatibility:i,speedBonus:a}=s,l=i.color||"#999";return r.jsxs("div",{style:qt.section,children:[r.jsx("h4",{style:qt.secTitle,children:" "}),r.jsxs("div",{style:qt.manualCard,children:[r.jsxs("div",{style:qt.manualHeader,children:[r.jsxs("div",{style:qt.manualName,children:[o.name,r.jsx("span",{style:{...qt.tierBadge,background:o.tierColor,marginLeft:"8px"},children:o.tierName})]}),o.element!=="NONE"&&r.jsx("div",{style:qt.elementBadge,children:o.element})]}),r.jsx("div",{style:qt.manualDesc,children:o.desc}),r.jsxs("div",{style:{...qt.compatibilityBox,borderColor:l},children:[r.jsxs("div",{style:qt.compatibilityRow,children:[r.jsx("span",{children:""}),r.jsx("span",{style:{color:l,fontWeight:"bold"},children:i.desc})]}),r.jsxs("div",{style:qt.compatibilityRow,children:[r.jsx("span",{children:""}),r.jsxs("span",{style:{color:"#2196F3",fontWeight:"bold"},children:["+",a]})]})]}),r.jsx("div",{style:qt.actionRow,children:r.jsx("button",{style:qt.changeBtn,onClick:()=>{t&&t(e)},children:" "})})]})]})},qt={section:{marginBottom:"20px",paddingBottom:"15px",borderBottom:"1px dashed #e0e0e0"},secTitle:{fontSize:"14px",fontWeight:"bold",marginBottom:"10px",color:"#333"},manualCard:{background:"#f9f9f9",borderRadius:"8px",padding:"12px",border:"1px solid #e0e0e0"},manualHeader:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"8px"},manualName:{fontSize:"16px",fontWeight:"bold",color:"#333",display:"flex",alignItems:"center"},tierBadge:{display:"inline-block",padding:"2px 8px",borderRadius:"4px",fontSize:"11px",color:"white",fontWeight:"bold"},elementBadge:{padding:"4px 10px",background:"#FF6B6B",color:"white",borderRadius:"12px",fontSize:"12px",fontWeight:"bold"},manualDesc:{fontSize:"12px",color:"#666",marginBottom:"10px",lineHeight:"1.5"},compatibilityBox:{background:"white",borderLeft:"3px solid",padding:"8px 10px",marginBottom:"10px",borderRadius:"4px"},compatibilityRow:{display:"flex",justifyContent:"space-between",fontSize:"13px",marginBottom:"4px"},actionRow:{display:"flex",justifyContent:"flex-end"},changeBtn:{padding:"6px 16px",background:"#2196F3",color:"white",border:"none",borderRadius:"6px",cursor:"pointer",fontSize:"13px",fontWeight:"bold",transition:"background 0.2s"}},EC=({child:e,onClose:t,onAction:n,navigation:s,onNavigate:o})=>{var I,_,N,C,j,T,A,V,F,B,$,Y,ne,X;const[i,a]=b.useState(!1),[l,d]=b.useState(e.name);b.useEffect(()=>{d(e.name),a(!1)},[e.id,e.name]),b.useEffect(()=>{if(typeof window>"u"||!o)return;const ee=ae=>{ae.key==="ArrowLeft"&&(s!=null&&s.hasPrev)&&(ae.preventDefault(),o("PREV")),ae.key==="ArrowRight"&&(s!=null&&s.hasNext)&&(ae.preventDefault(),o("NEXT"))};return window.addEventListener("keydown",ee),()=>window.removeEventListener("keydown",ee)},[s,o]);const u=ee=>({:"#FFD700",:"#4CAF50",:"#2196F3",:"#F44336",:"#795548",:"#673AB7",:"#00BCD4",:"#009688"})[ee]||"#9e9e9e",p=ee=>({WHITE:"#9e9e9e",GREEN:"#4caf50",BLUE:"#2196f3",PURPLE:"#9c27b0",ORANGE:"#ff9800",RED:"#f44336"})[ee]||"#333",c=()=>{n("RENAME",l),a(!1)},m=Math.floor(e.age*12),y=e.isTested&&m>=72&&!!e.spiritRoot,S=((I=e.stats)==null?void 0:I.aptitude)||0,E=Rf(S),w=Math.min(100,S),g=Math.max(0,Math.floor(e.currentExp||0)),h=Math.max(1,Math.floor(e.maxExp||1)),v=Math.min(100,Math.round(g/h*100)),x=(ee,ae,Te)=>r.jsxs("div",{style:ke.fractionWrapper,"aria-label":`${Te} ${ee}/${ae}`,children:[r.jsx("span",{style:ke.fractionCaption,children:Te}),r.jsxs("div",{style:ke.fractionBox,children:[r.jsx("span",{style:ke.fractionNumerator,children:ee}),r.jsx("span",{style:ke.fractionDivider}),r.jsx("span",{style:ke.fractionDenominator,children:ae})]})]});return r.jsx("div",{style:ke.overlay,children:r.jsxs("div",{style:ke.modalWrapper,children:[r.jsx("button",{onClick:t,style:ke.closeBtn,"aria-label":"",children:""}),r.jsxs("div",{style:ke.modal,children:[s&&r.jsxs("div",{style:ke.navBar,children:[r.jsxs("button",{type:"button","aria-label":"",onClick:()=>s.hasPrev&&o&&o("PREV"),disabled:!s.hasPrev,style:{...ke.navBtn,...s.hasPrev?{}:ke.navBtnDisabled},children:[" ",s.prevName||""]}),r.jsx("span",{style:ke.navLabel,children:s.label||"--/--"}),r.jsxs("button",{type:"button","aria-label":"",onClick:()=>s.hasNext&&o&&o("NEXT"),disabled:!s.hasNext,style:{...ke.navBtn,...s.hasNext?{}:ke.navBtnDisabled},children:[s.nextName||""," "]})]}),r.jsx("div",{style:ke.content,children:r.jsxs("div",{style:ke.singleCol,children:[r.jsxs("div",{style:{display:"flex",gap:"20px",alignItems:"center",marginBottom:"20px",paddingBottom:"15px",borderBottom:"1px dashed #e0e0e0"},children:[r.jsx("div",{style:{marginBottom:"15px"},children:e.age===0?r.jsx("div",{style:{fontSize:"48px"},children:""}):e.age<15?r.jsx("div",{style:{fontSize:"48px"},children:""}):r.jsx(Yr,{dna:e.avatar,gender:e.gender,size:100})}),r.jsxs("div",{style:ke.nameBox,children:[i?r.jsxs("div",{style:{display:"flex",gap:"5px"},children:[r.jsx("input",{value:l,onChange:ee=>d(ee.target.value),style:ke.input}),r.jsx("button",{onClick:c,style:ke.smallBtn,children:""})]}):r.jsxs("h2",{style:{margin:0},children:[e.name,r.jsx("span",{onClick:()=>a(!0),style:ke.editIcon,children:""})]}),r.jsx("div",{style:ke.tierBadge,children:e.tierTitle||""}),(e.sect||e.rank)&&r.jsx("div",{style:{marginTop:"8px",fontSize:"13px",color:"#d7a574",fontWeight:"bold"},children:e.sect?r.jsxs(r.Fragment,{children:[e.sect.name,e.rank&&`  ${e.rank}`]}):e.rank&&e.rank}),r.jsxs("div",{style:{marginTop:"10px",fontSize:"13px",color:"#555"},children:[r.jsxs("div",{style:{display:"flex",gap:"15px",marginBottom:"5px",flexWrap:"wrap"},children:[r.jsxs("div",{children:[" ",Math.floor(e.age),"",Math.floor(e.age%1*12),""]}),r.jsxs("div",{children:[" ",e.fatherName]}),r.jsxs("div",{children:[" ",e.gender]}),((_=e.stats)==null?void 0:_.lifespan)&&r.jsxs("div",{children:["  ",Math.floor(Math.max(0,Fr(e))),"/",Math.floor(e.stats.lifespan),""]})]}),e.trait&&r.jsxs("div",{style:{...ke.traitBox,borderColor:p(e.trait.rarity),marginTop:"5px",display:"inline-block"},children:[r.jsx("span",{style:{color:p(e.trait.rarity),fontWeight:"bold"},children:e.trait.name}),r.jsx("p",{style:{margin:"5px 0 0",fontSize:"10px",color:"#666"},children:e.trait.desc})]}),e.influenceProfile&&r.jsxs("div",{style:ke.influencePanel,children:[r.jsxs("div",{style:{...ke.influenceHeader,color:e.influenceProfile.color},children:[e.influenceProfile.label,r.jsx("span",{style:ke.influenceScore,children:e.influenceProfile.score})]}),r.jsx("p",{style:ke.influenceTagline,children:e.influenceProfile.tagline}),r.jsx("div",{style:ke.influenceProgress,children:r.jsx("div",{style:{...ke.influenceProgressFill,width:`${Math.min(100,Math.round((e.influenceProfile.progress||0)*100))}%`,background:e.influenceProfile.color}})}),r.jsxs("div",{style:ke.influenceFooter,children:["",e.influenceProfile.nextLabel]})]})]})]})]}),r.jsxs("div",{style:ke.section,children:[r.jsx("h4",{style:ke.secTitle,children:" "}),e.spouse?r.jsxs("div",{style:ke.spouseCard,children:[r.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"10px"},children:[r.jsx("div",{style:ke.miniAvatar,children:e.spouse.gender===""?"":""}),r.jsxs("div",{children:[r.jsx("div",{style:{fontWeight:"bold",color:"#e91e63"},children:e.spouse.name}),r.jsx("div",{style:{fontSize:"12px",color:"#666"},children:e.spouse.gender===""?" ":" "}),r.jsx("div",{style:{fontSize:"12px"},children:e.spouse.tierTitle||""})]})]}),r.jsxs("div",{style:{marginTop:"8px",fontSize:"13px",display:"grid",gridTemplateColumns:"1fr 1fr 1fr",gap:"8px"},children:[r.jsxs("div",{children:[": ",r.jsx("span",{style:{color:"purple"},children:((N=e.spouse.stats)==null?void 0:N.aptitude)||e.spouse.aptitude})]}),r.jsxs("div",{children:[": ",((C=e.spouse.stats)==null?void 0:C.looks)||e.spouse.looks]}),r.jsxs("div",{children:[": ",((j=e.spouse.stats)==null?void 0:j.intelligence)||e.spouse.intelligence]}),r.jsxs("div",{style:{gridColumn:"span 3",color:"#d81b60"},children:[(T=e.spouse.spiritRoot)==null?void 0:T.type," ",(V=(A=e.spouse.spiritRoot)==null?void 0:A.elements)==null?void 0:V.join(", ")]})]})]}):r.jsxs("div",{style:{color:"#999",fontSize:"12px",textAlign:"center",padding:"15px",background:"#f5f5f5",borderRadius:"8px"},children:["",r.jsx("br",{}),r.jsx("button",{style:ke.marryBtn,onClick:()=>{console.log("Marriage button clicked for child:",e.name,"id:",e.id),n("MARRY")},children:" "})]})]}),r.jsxs("div",{style:ke.section,children:[r.jsx("h4",{style:ke.secTitle,children:" "}),y?r.jsxs(r.Fragment,{children:[r.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"10px",marginBottom:"10px"},children:[r.jsx("strong",{style:{fontSize:"16px"},children:e.spiritRoot.type}),r.jsx("div",{style:{display:"flex",gap:"4px"},children:e.spiritRoot.elements.map(ee=>r.jsx("span",{style:{...ke.elBadge,background:u(ee)},children:ee},ee))})]}),r.jsxs("div",{style:ke.barContainer,children:[r.jsxs("span",{children:[" (",S,")"]}),r.jsx("div",{style:ke.barBg,children:r.jsx("div",{style:{...ke.barFill,width:`${w}%`,background:E.color}})})]}),r.jsx("p",{style:{fontSize:"12px",color:"#666",marginTop:"5px"},children:e.spiritRoot.desc})]}):r.jsx("p",{style:{color:"#999",fontStyle:"italic"},children:"6"})]}),r.jsxs("div",{style:ke.section,children:[r.jsx("h4",{style:ke.secTitle,children:" "}),r.jsx("div",{style:ke.equipGrid,children:["weapon","armor","accessory"].map(ee=>{var Be;const ae=(Be=e.equipment)==null?void 0:Be[ee],Te={weapon:"",armor:"",accessory:""};return r.jsxs("div",{style:ke.equipSlot,children:[r.jsx("div",{style:{fontWeight:"bold"},children:Te[ee]}),r.jsx("div",{style:{fontSize:"12px",color:"#555",minHeight:"18px"},children:ae?ae.name:""}),r.jsxs("div",{style:{display:"flex",gap:"6px"},children:[r.jsx("button",{style:ke.smallBtn,onClick:()=>n("OPEN_INVENTORY",{mode:"SELECT",slot:ee}),children:""}),ae&&r.jsx("button",{style:ke.smallBtn,onClick:()=>n("UNEQUIP",{slot:ee}),children:""})]})]},ee)})}),r.jsxs("div",{style:{marginTop:"8px",textAlign:"right"},children:[r.jsx("button",{style:ke.smallBtn,onClick:()=>n("OPEN_INVENTORY",{mode:"VIEW"}),children:" "}),r.jsx(kC,{child:e,onChangeManual:ee=>n("CHANGE_MANUAL",ee)})]})]}),r.jsxs("div",{style:ke.section,children:[r.jsx("h4",{style:ke.secTitle,children:" "}),r.jsxs("div",{style:ke.traitGrid,children:[r.jsxs("div",{style:ke.traitRow,children:[r.jsx("span",{style:ke.label,children:":"}),r.jsx(wc,{trait:Sc(((F=e.stats)==null?void 0:F.looks)||50,"LOOKS",e.gender),showValue:!0})]}),r.jsxs("div",{style:ke.traitRow,children:[r.jsx("span",{style:ke.label,children:":"}),r.jsx(wc,{trait:Sc(((B=e.stats)==null?void 0:B.intelligence)||50,"INT"),showValue:!0})]}),r.jsxs("div",{style:ke.traitRow,children:[r.jsx("span",{style:ke.label,children:":"}),r.jsx("div",{style:{flex:1,height:"8px",background:"#eee",borderRadius:"4px",overflow:"hidden"},children:r.jsx("div",{style:{height:"100%",width:`${S}%`,background:S>=90?"#d50000":S>=80?"#aa00ff":"#4caf50"}})}),r.jsx("span",{style:{fontSize:"12px",marginLeft:"5px"},children:S})]})]})]}),r.jsxs("div",{style:ke.section,children:[r.jsx("h4",{style:ke.secTitle,children:" "}),r.jsxs("div",{style:ke.combatGrid,children:[r.jsxs("div",{style:ke.statItem,children:[r.jsx("span",{style:{color:"#d32f2f"},children:""}),r.jsx("strong",{children:(($=e.combatStats)==null?void 0:$.hp)||100})]}),r.jsxs("div",{style:ke.statItem,children:[r.jsx("span",{style:{color:"#1976d2"},children:""}),r.jsx("strong",{children:((Y=e.combatStats)==null?void 0:Y.mp)||0})]}),r.jsxs("div",{style:ke.statItem,children:[r.jsx("span",{style:{color:"#f57c00"},children:""}),r.jsx("strong",{children:((ne=e.combatStats)==null?void 0:ne.atk)||5})]})]})]}),((X=e.stats)==null?void 0:X.lifespan)&&r.jsxs("div",{style:ke.section,children:[r.jsx("h4",{style:ke.secTitle,children:" "}),r.jsxs("div",{style:{fontSize:"12px",color:"#666",lineHeight:"1.6"},children:[r.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:"4px"},children:[r.jsx("span",{children:":"}),r.jsxs("span",{style:{fontWeight:"bold"},children:[Math.floor(e.age||0)," "]})]}),r.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:"4px"},children:[r.jsx("span",{children:":"}),r.jsxs("span",{style:{fontWeight:"bold"},children:[Math.floor(e.stats.lifespan)," "]})]}),r.jsxs("div",{style:{display:"flex",justifyContent:"space-between"},children:[r.jsx("span",{children:":"}),r.jsxs("span",{style:{fontWeight:"bold",color:(()=>{const ee=Fr(e);return ee<10?"#f44336":ee<30?"#ff9800":"#4caf50"})()},children:[Math.floor(Fr(e))," "]})]}),Fr(e)<10&&r.jsx("div",{style:{marginTop:"8px",padding:"8px",background:"rgba(244, 67, 54, 0.1)",borderRadius:"4px",color:"#f44336",fontSize:"11px"},children:" "})]})]}),e.tierTitle&&r.jsxs("div",{style:ke.section,children:[r.jsx("h4",{style:ke.secTitle,children:" "}),r.jsxs("div",{style:{fontSize:"12px",marginBottom:"8px"},children:[r.jsx("span",{style:{color:"#666"},children:": "}),r.jsx("span",{style:{fontWeight:"bold",color:"#9c27b0"},children:e.tierTitle||""})]}),e.currentExp!==void 0&&e.maxExp&&r.jsxs("div",{children:[r.jsxs("div",{style:{marginBottom:"4px"},children:[r.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",marginBottom:"4px"},children:[r.jsx("span",{style:{fontSize:"11px",color:"#666"},children:""}),r.jsxs("span",{style:{fontSize:"11px",color:"#666",fontWeight:"bold"},children:[v,"%"]})]}),r.jsx("div",{style:{width:"100%",height:"14px",background:"linear-gradient(to right, #f0f0f0, #e0e0e0)",borderRadius:"7px",overflow:"hidden",position:"relative",boxShadow:"inset 0 2px 4px rgba(0,0,0,0.1)"},children:r.jsx("div",{style:{width:`${v}%`,height:"100%",background:"linear-gradient(90deg, #9c27b0 0%, #d05ce3 100%)",borderRadius:"7px",transition:"width 0.3s ease",boxShadow:"0 0 10px rgba(156, 39, 176, 0.5)",position:"relative",overflow:"hidden"},children:r.jsx("div",{style:{position:"absolute",top:0,left:"-100%",width:"100%",height:"100%",background:"linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent)",animation:"shimmer 2s infinite"}})})})]}),x(g,h,""),e.cultivationSpeed&&r.jsxs("div",{style:{marginTop:"8px",padding:"6px 10px",background:"rgba(156, 39, 176, 0.05)",borderRadius:"6px",border:"1px solid rgba(156, 39, 176, 0.1)"},children:[r.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"4px"},children:[r.jsx("span",{style:{fontSize:"11px",color:"#666"},children:":"}),r.jsxs("span",{style:{fontSize:"11px",fontWeight:"bold",color:"#9c27b0"},children:[Math.floor(e.cultivationSpeed)," /"]})]}),(()=>{const ee=Math.max(0,h-g),ae=Math.ceil(ee/e.cultivationSpeed);return r.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[r.jsx("span",{style:{fontSize:"11px",color:"#666"},children:":"}),r.jsx("span",{style:{fontSize:"11px",fontWeight:"bold",color:ae>12?"#ff9800":"#4caf50"},children:ae>12?`${Math.floor(ae/12)}`:`${ae}`})]})})()]})]})]}),r.jsxs("div",{style:ke.section,children:[r.jsx("h4",{style:ke.secTitle,children:" "}),e.sect?r.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[r.jsxs("div",{children:[r.jsx("div",{style:{fontWeight:"bold",color:"#00695c"},children:e.sect.name}),r.jsx("div",{style:{fontSize:"12px"},children:e.rank})]}),r.jsx("div",{style:{textAlign:"right",fontSize:"12px"},children:r.jsxs("div",{children:[": ",Math.floor(e.age*12)>=192?"":""]})})]}):r.jsxs("div",{children:[r.jsx("p",{style:{color:"#666",fontSize:"12px",marginBottom:"8px"},children:" / "}),Math.floor(e.age*12)>=144&&e.isTested&&r.jsxs("div",{style:{display:"flex",gap:"8px",alignItems:"center"},children:[r.jsx("button",{style:ke.smallBtn,onClick:()=>n("SELECT_SECT"),children:" "}),r.jsxs("label",{style:{display:"flex",alignItems:"center",gap:8,fontSize:12,color:"#555"},children:[r.jsx("input",{type:"checkbox",checked:!!e.autoJoinBestSect,onChange:ee=>n("TOGGLE_AUTO_JOIN_SECT",ee.target.checked)}),""]})]})]})]}),r.jsxs("div",{style:{...ke.actionArea,gridTemplateColumns:"1fr 1fr 1fr"},children:[r.jsxs("button",{onClick:()=>n("CHAT"),style:{...ke.actionBtn,background:"#7e57c2"},children:[" ",r.jsx("br",{}),r.jsx("small",{style:{fontSize:"10px",opacity:.8},children:""})]}),r.jsxs("button",{onClick:()=>{window.showConfirm&&window.showConfirm(` ${e.name} `,()=>n("EXPEL"))},style:{...ke.actionBtn,background:"#d32f2f"},children:[" ",r.jsx("br",{}),r.jsx("small",{style:{fontSize:"10px",opacity:.9},children:""})]})]})]})})]})]})})},ke={overlay:{position:"fixed",top:0,left:0,right:0,bottom:0,background:"rgba(0,0,0,0.6)",display:"flex",justifyContent:"center",alignItems:"center",zIndex:1e3},modalWrapper:{position:"relative",width:"min(600px, calc(100vw - 32px))"},modal:{width:"100%",height:"600px",background:"#fff",borderRadius:"12px",overflow:"hidden",position:"relative",boxShadow:"0 10px 25px rgba(0,0,0,0.2)",display:"flex",flexDirection:"column"},closeBtn:{position:"absolute",top:"-18px",left:"-18px",border:"none",background:"#ffffff",fontSize:"22px",cursor:"pointer",color:"#888",width:"44px",height:"44px",display:"flex",alignItems:"center",justifyContent:"center",borderRadius:"22px",boxShadow:"0 12px 30px rgba(0,0,0,0.25)"},content:{flex:1,height:"100%",overflow:"hidden"},navBar:{flex:"0 0 auto",padding:"12px 20px",borderBottom:"1px solid #f0f0f0",background:"#fafafa",display:"flex",alignItems:"center",justifyContent:"space-between"},navBtn:{border:"none",background:"transparent",cursor:"pointer",color:"#333",fontSize:"13px",display:"flex",alignItems:"center",gap:"6px",padding:"6px 10px",borderRadius:"6px"},navBtnDisabled:{color:"#bbb",cursor:"not-allowed"},navLabel:{fontSize:"12px",color:"#666",fontWeight:"bold"},singleCol:{width:"100%",padding:"25px 25px 90px 25px",overflowY:"auto",height:"100%",boxSizing:"border-box"},nameBox:{textAlign:"left"},editIcon:{fontSize:"12px",cursor:"pointer",marginLeft:"5px",opacity:.5},input:{width:"120px",padding:"5px",borderRadius:"4px",border:"1px solid #ccc"},smallBtn:{padding:"5px 10px",cursor:"pointer",borderRadius:"4px",border:"1px solid #ccc",backgroundColor:"#f5f5f5"},tierBadge:{fontSize:"12px",background:"#3e2723",color:"#fff",padding:"2px 8px",borderRadius:"10px",marginTop:"5px",display:"inline-block"},traitBox:{padding:"10px",background:"#fff",border:"1px solid",borderRadius:"8px",textAlign:"center",display:"inline-block"},influencePanel:{marginTop:"10px",padding:"12px",borderRadius:"10px",background:"linear-gradient(135deg, rgba(255,255,255,0.8), rgba(240,240,240,0.9))",border:"1px solid #e0e0e0"},influenceHeader:{fontWeight:"bold",fontSize:"16px",display:"flex",justifyContent:"space-between",alignItems:"center"},influenceScore:{fontSize:"18px"},influenceTagline:{fontSize:"11px",margin:"4px 0",color:"#666"},influenceProgress:{height:"8px",borderRadius:"999px",background:"#e0e0e0",overflow:"hidden"},influenceProgressFill:{height:"100%"},influenceFooter:{marginTop:"4px",fontSize:"11px",color:"#888"},spouseCard:{background:"#fff8e1",padding:"15px",borderRadius:"8px",border:"1px solid #ffecb3",boxShadow:"0 2px 4px rgba(0,0,0,0.05)"},miniAvatar:{fontSize:"24px",width:"40px",height:"40px",borderRadius:"50%",background:"#fff",display:"flex",alignItems:"center",justifyContent:"center",boxShadow:"0 1px 3px rgba(0,0,0,0.1)"},marryBtn:{marginTop:"10px",padding:"5px 15px",fontSize:"12px",cursor:"pointer",borderRadius:"15px",border:"1px solid #e91e63",backgroundColor:"#fff",color:"#e91e63",transition:"all 0.2s",":hover":{backgroundColor:"#fce4ec",transform:"translateY(-1px)"}},section:{marginBottom:"25px"},secTitle:{margin:"0 0 15px 0",fontSize:"14px",color:"#333",borderBottom:"1px dashed #ccc",paddingBottom:"8px"},elBadge:{padding:"2px 6px",borderRadius:"4px",color:"#fff",fontSize:"10px",fontWeight:"bold"},barContainer:{display:"flex",alignItems:"center",gap:"10px",fontSize:"12px",marginBottom:"10px"},barBg:{flex:1,height:"8px",background:"#eee",borderRadius:"4px"},barFill:{height:"100%",borderRadius:"4px"},combatGrid:{display:"grid",gridTemplateColumns:"1fr 1fr 1fr",gap:"10px",textAlign:"center"},statItem:{background:"#fafafa",padding:"10px",borderRadius:"8px",display:"flex",flexDirection:"column",gap:"5px"},actionArea:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"10px",marginTop:"20px"},actionBtn:{padding:"12px",border:"none",borderRadius:"8px",background:"#ff9800",color:"white",cursor:"pointer",textAlign:"center",fontSize:"14px",transition:"all 0.2s",":hover":{transform:"translateY(-1px)",boxShadow:"0 4px 8px rgba(0,0,0,0.15)"}},traitGrid:{display:"flex",flexDirection:"column",gap:"15px"},traitRow:{display:"flex",alignItems:"center",gap:"10px"},label:{width:"60px",fontSize:"13px",color:"#555",fontWeight:"bold"},equipGrid:{display:"grid",gridTemplateColumns:"1fr 1fr 1fr",gap:"10px"},equipSlot:{border:"1px dashed #ccc",borderRadius:"8px",padding:"10px",background:"#fafafa",textAlign:"center"},fractionWrapper:{display:"flex",flexDirection:"column",alignItems:"flex-end",marginTop:"6px",color:"#4a148c"},fractionCaption:{fontSize:"11px",color:"#777",marginBottom:"2px"},fractionBox:{display:"flex",flexDirection:"column",alignItems:"center",minWidth:"60px",lineHeight:1.2},fractionNumerator:{fontWeight:"bold",fontSize:"15px"},fractionDivider:{width:"100%",borderBottom:"1px solid rgba(0,0,0,0.2)",margin:"2px 0"},fractionDenominator:{fontWeight:"bold",fontSize:"13px"}},jC=({child:e,candidates:t,onSelect:n,onClose:s})=>{if(!t||t.length===0)return null;const o=a=>{switch(a){case"talented":return" ";case"beautiful":return" ";case"wise":return" ";case"buddha":return" ";default:return" "}},i=a=>{switch(a){case"talented":return"";case"beautiful":return"";case"wise":return"";case"buddha":return"";default:return""}};return r.jsx("div",{style:Ze.overlay,children:r.jsxs("div",{style:Ze.modalWrapper,children:[r.jsx("button",{style:Ze.closeBtn,onClick:s,"aria-label":"",children:""}),r.jsxs("div",{style:Ze.modal,children:[r.jsx("div",{style:Ze.header,children:r.jsxs("h2",{style:Ze.title,children:["  ",e.name," "]})}),r.jsxs("div",{style:Ze.subtitle,children:[" ",e.name," "]}),r.jsx("div",{style:Ze.candidatesContainer,children:t.map((a,l)=>{var d,u,p;return r.jsxs("div",{style:Ze.candidateCard,children:[r.jsx("div",{style:Ze.cardHeader,children:r.jsx("div",{style:Ze.archetypeBadge,children:o(a.archetype)})}),r.jsxs("div",{style:Ze.avatarSection,children:[r.jsx(Yr,{avatar:a.avatar,gender:a.gender,size:80}),r.jsxs("div",{style:Ze.nameSection,children:[r.jsx("div",{style:Ze.candidateName,children:a.name}),r.jsx("div",{style:Ze.candidateGender,children:a.gender===""?" ":" "}),a.identity&&r.jsx("div",{style:Ze.identity,children:a.identity})]})]}),r.jsx("div",{style:Ze.archetypeDesc,children:i(a.archetype)}),r.jsxs("div",{style:Ze.statsSection,children:[r.jsxs("div",{style:Ze.statRow,children:[r.jsx("span",{style:Ze.statLabel,children:""}),r.jsx("span",{style:{...Ze.statValue,color:a.stats.aptitude>=80?"#ff4081":a.stats.aptitude>=60?"#9c27b0":"#666"},children:a.stats.aptitude})]}),r.jsxs("div",{style:Ze.statRow,children:[r.jsx("span",{style:Ze.statLabel,children:""}),r.jsx("span",{style:{...Ze.statValue,color:a.stats.looks>=80?"#ff4081":a.stats.looks>=60?"#9c27b0":"#666"},children:a.stats.looks})]}),r.jsxs("div",{style:Ze.statRow,children:[r.jsx("span",{style:Ze.statLabel,children:""}),r.jsx("span",{style:{...Ze.statValue,color:a.stats.intelligence>=80?"#ff4081":a.stats.intelligence>=60?"#9c27b0":"#666"},children:a.stats.intelligence})]})]}),r.jsxs("div",{style:Ze.spiritRootSection,children:[r.jsx("div",{style:Ze.spiritRootLabel,children:""}),r.jsxs("div",{style:Ze.spiritRootValue,children:[(d=a.spiritRoot)==null?void 0:d.type,((p=(u=a.spiritRoot)==null?void 0:u.elements)==null?void 0:p.length)>0&&` (${a.spiritRoot.elements.join("")})`]})]}),r.jsxs("div",{style:Ze.cultivationSection,children:[r.jsx("div",{style:Ze.tierLabel,children:a.tierTitle}),r.jsxs("div",{style:Ze.cultivationValue,children:[": ",a.cultivation]})]}),r.jsxs("button",{style:Ze.selectBtn,onClick:()=>n(a),onMouseEnter:c=>c.target.style.background="#d81b60",onMouseLeave:c=>c.target.style.background="#e91e63",children:[" ",a.name]})]},a.id)})}),r.jsxs("div",{style:Ze.footer,children:[r.jsx("div",{style:Ze.costInfo,children:" 500 "}),r.jsx("button",{style:Ze.cancelBtn,onClick:s,children:""})]})]})]})})},Ze={overlay:{position:"fixed",top:0,left:0,right:0,bottom:0,background:"rgba(0, 0, 0, 0.7)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:2e3,padding:"20px"},modalWrapper:{position:"relative",width:"min(1100px, calc(100vw - 40px))"},modal:{background:"linear-gradient(135deg, #fff8e1 0%, #ffe0b2 100%)",borderRadius:"16px",maxWidth:"1100px",width:"100%",maxHeight:"90vh",overflow:"auto",boxShadow:"0 8px 32px rgba(0,0,0,0.3)",border:"2px solid #ffb74d",position:"relative"},header:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"20px 24px",borderBottom:"2px solid #ffb74d",background:"linear-gradient(90deg, #ffe0b2, #ffcc80)"},title:{margin:0,fontSize:"24px",color:"#d84315",fontWeight:"bold"},closeBtn:{position:"absolute",top:"-18px",left:"-18px",background:"#fff",border:"2px solid rgba(0,0,0,0.08)",fontSize:"20px",cursor:"pointer",color:"#bf360c",width:"44px",height:"44px",display:"flex",alignItems:"center",justifyContent:"center",borderRadius:"50%",boxShadow:"0 10px 24px rgba(0,0,0,0.2)",zIndex:5},subtitle:{padding:"16px 24px",fontSize:"16px",color:"#5d4037",textAlign:"center",background:"#fff3e0"},candidatesContainer:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(300px, 1fr))",gap:"20px",padding:"24px"},candidateCard:{background:"white",borderRadius:"12px",padding:"20px",border:"2px solid #ffb74d",boxShadow:"0 4px 12px rgba(0,0,0,0.1)",display:"flex",flexDirection:"column",transition:"transform 0.2s, box-shadow 0.2s",cursor:"pointer"},cardHeader:{marginBottom:"12px",display:"flex",justifyContent:"center"},archetypeBadge:{background:"linear-gradient(135deg, #e91e63, #f06292)",color:"white",padding:"6px 16px",borderRadius:"20px",fontSize:"14px",fontWeight:"bold",textAlign:"center"},avatarSection:{display:"flex",alignItems:"center",gap:"16px",marginBottom:"12px",paddingBottom:"12px",borderBottom:"1px solid #ffe0b2"},nameSection:{flex:1},candidateName:{fontSize:"20px",fontWeight:"bold",color:"#d84315",marginBottom:"4px"},candidateGender:{fontSize:"14px",color:"#666",marginBottom:"4px"},identity:{fontSize:"12px",color:"#ff6f00",fontWeight:"bold",background:"#fff3e0",padding:"2px 8px",borderRadius:"4px",display:"inline-block"},archetypeDesc:{fontSize:"13px",color:"#795548",fontStyle:"italic",marginBottom:"16px",textAlign:"center",padding:"8px",background:"#fff8e1",borderRadius:"6px"},statsSection:{display:"flex",flexDirection:"column",gap:"8px",marginBottom:"12px",padding:"12px",background:"#fafafa",borderRadius:"8px"},statRow:{display:"flex",justifyContent:"space-between",alignItems:"center"},statLabel:{fontSize:"14px",color:"#666",fontWeight:"500"},statValue:{fontSize:"16px",fontWeight:"bold"},spiritRootSection:{marginBottom:"12px",padding:"10px",background:"#e3f2fd",borderRadius:"6px",border:"1px solid #90caf9"},spiritRootLabel:{fontSize:"12px",color:"#1565c0",marginBottom:"4px"},spiritRootValue:{fontSize:"14px",color:"#0d47a1",fontWeight:"bold"},cultivationSection:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"16px",padding:"10px",background:"#f3e5f5",borderRadius:"6px"},tierLabel:{fontSize:"14px",color:"#6a1b9a",fontWeight:"bold"},cultivationValue:{fontSize:"13px",color:"#4a148c"},selectBtn:{background:"#e91e63",color:"white",border:"none",padding:"12px",borderRadius:"8px",fontSize:"16px",fontWeight:"bold",cursor:"pointer",transition:"background 0.2s",boxShadow:"0 2px 8px rgba(233, 30, 99, 0.3)"},footer:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"16px 24px",borderTop:"2px solid #ffb74d",background:"#fff3e0"},costInfo:{fontSize:"16px",color:"#d84315",fontWeight:"bold"},cancelBtn:{background:"#9e9e9e",color:"white",border:"none",padding:"10px 24px",borderRadius:"6px",fontSize:"14px",cursor:"pointer",transition:"background 0.2s"}},CC=({giftEvents:e,onConfirm:t,onClose:n})=>{const[s,o]=b.useState(new Set),i=p=>{const c=new Set(s);c.has(p)?c.delete(p):c.add(p),o(c)},a=()=>{s.size===e.length?o(new Set):o(new Set(e.map(p=>p.npcId)))},l=()=>{const p=e.filter(c=>s.has(c.npcId));t(p)},d=p=>Vo(p)||{name:"",rarity:"common"},u={common:"#9e9e9e",uncommon:"#4caf50",rare:"#2196f3",epic:"#9c27b0",legendary:"#ff9800"};return r.jsx("div",{style:wt.overlay,children:r.jsxs("div",{style:wt.modal,children:[r.jsxs("div",{style:wt.header,children:[r.jsxs("h3",{style:wt.title,children:[" ",e.length,""]}),r.jsx("button",{onClick:n,style:wt.closeIcon,children:""})]}),r.jsx("div",{style:wt.subtitle,children:""}),r.jsxs("div",{style:wt.toolbar,children:[r.jsx("button",{onClick:a,style:wt.selectAllBtn,children:s.size===e.length?" ":""}),r.jsxs("div",{style:wt.selectionInfo,children:[" ",s.size," / ",e.length]})]}),r.jsx("div",{style:wt.giftList,children:e.map((p,c)=>{const m=d(p.giftItemId),y=s.has(p.npcId);return r.jsxs("div",{style:{...wt.giftCard,borderColor:y?"#4caf50":"#e0e0e0",background:y?"#f1f8f4":"#fff"},onClick:()=>i(p.npcId),children:[r.jsx("div",{style:wt.checkbox,children:r.jsx("input",{type:"checkbox",checked:y,onChange:()=>i(p.npcId),style:wt.checkboxInput})}),r.jsxs("div",{style:wt.cardContent,children:[r.jsxs("div",{style:wt.giftHeader,children:[r.jsx("span",{style:wt.npcName,children:p.npcName}),r.jsx("span",{style:{...wt.itemName,color:u[m.rarity]||"#666"},children:m.name})]}),r.jsx("div",{style:wt.message,children:p.message}),m.desc&&r.jsxs("div",{style:wt.itemDesc,children:[" ",m.desc]}),m.stats&&r.jsxs("div",{style:wt.itemStats,children:[m.stats.atk&&r.jsxs("span",{children:["+",m.stats.atk]}),m.stats.hp&&r.jsxs("span",{children:["+",m.stats.hp]}),m.stats.def&&r.jsxs("span",{children:["+",m.stats.def]})]}),m.effect&&r.jsxs("div",{style:wt.itemEffect,children:[" ",typeof m.effect=="object"?`${m.effect.kind==="heal"?"":m.effect.kind==="exp"?"":m.effect.kind==="aptitude"?"":""} +${m.effect.amount}`:m.effect]})]})]},p.npcId||c)})}),r.jsxs("div",{style:wt.footer,children:[r.jsxs("button",{style:wt.confirmBtn,onClick:l,disabled:s.size===0,children:[" (",s.size,")"]}),r.jsx("button",{style:wt.cancelBtn,onClick:n,children:""})]})]})})},wt={overlay:{position:"fixed",top:0,left:0,right:0,bottom:0,background:"rgba(0, 0, 0, 0.75)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:3e3,padding:"20px"},modal:{background:"linear-gradient(135deg, #fff 0%, #f5f5f5 100%)",borderRadius:"16px",width:"90%",maxWidth:"800px",maxHeight:"85vh",display:"flex",flexDirection:"column",boxShadow:"0 10px 40px rgba(0,0,0,0.3)",overflow:"hidden"},header:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"20px 24px",borderBottom:"2px solid #e91e63",background:"linear-gradient(90deg, #fce4ec, #f8bbd0)",flexShrink:0},title:{margin:0,fontSize:"22px",color:"#c2185b",fontWeight:"bold"},closeIcon:{background:"none",border:"none",fontSize:"28px",cursor:"pointer",color:"#c2185b",padding:"0",lineHeight:"1"},subtitle:{padding:"16px 24px",fontSize:"14px",color:"#666",borderBottom:"1px solid #e0e0e0",flexShrink:0},toolbar:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"12px 24px",background:"#fafafa",borderBottom:"1px solid #e0e0e0",flexShrink:0},selectAllBtn:{padding:"6px 16px",background:"#e0e0e0",border:"none",borderRadius:"6px",cursor:"pointer",fontSize:"13px",transition:"all 0.2s"},selectionInfo:{fontSize:"13px",color:"#666"},giftList:{flex:1,overflowY:"auto",padding:"16px 24px",display:"flex",flexDirection:"column",gap:"12px"},giftCard:{display:"flex",gap:"12px",padding:"16px",border:"2px solid #e0e0e0",borderRadius:"12px",cursor:"pointer",transition:"all 0.2s",background:"#fff"},checkbox:{flexShrink:0,display:"flex",alignItems:"flex-start",paddingTop:"2px"},checkboxInput:{width:"18px",height:"18px",cursor:"pointer"},cardContent:{flex:1,display:"flex",flexDirection:"column",gap:"8px"},giftHeader:{display:"flex",justifyContent:"space-between",alignItems:"center",gap:"12px"},npcName:{fontSize:"16px",fontWeight:"bold",color:"#e91e63"},itemName:{fontSize:"15px",fontWeight:"600"},message:{fontSize:"14px",color:"#444",lineHeight:"1.5",background:"#fff8e1",padding:"8px 12px",borderRadius:"8px",border:"1px solid #fff176"},itemDesc:{fontSize:"12px",color:"#666",fontStyle:"italic"},itemStats:{display:"flex",gap:"12px",fontSize:"12px",color:"#2196f3",fontWeight:"500"},itemEffect:{fontSize:"12px",color:"#4caf50",fontStyle:"italic"},footer:{display:"flex",gap:"12px",padding:"16px 24px",borderTop:"2px solid #e0e0e0",background:"#fafafa",flexShrink:0},confirmBtn:{flex:1,padding:"12px",background:"#4caf50",color:"#fff",border:"none",borderRadius:"8px",cursor:"pointer",fontSize:"15px",fontWeight:"bold",transition:"all 0.2s"},cancelBtn:{padding:"12px 24px",background:"#e0e0e0",border:"none",borderRadius:"8px",cursor:"pointer",fontSize:"15px"}},TC=({promotionEvents:e,onConfirm:t,onClose:n})=>{const[s,o]=b.useState(new Set(e.map(c=>c.child.id))),i=c=>{const m=new Set(s);m.has(c)?m.delete(c):m.add(c),o(m)},a=()=>{s.size===e.length?o(new Set):o(new Set(e.map(c=>c.child.id)))},l=()=>{const c=e.filter(m=>s.has(m.child.id));t(c)},d=c=>Vo(c)||{name:"",rarity:"common"},u={common:"#9e9e9e",uncommon:"#4caf50",rare:"#2196f3",epic:"#9c27b0",legendary:"#ff9800"},p={:"#9e9e9e",:"#4caf50",:"#2196f3",:"#9c27b0",:"#ff9800"};return r.jsx("div",{style:Qe.overlay,children:r.jsxs("div",{style:Qe.modal,children:[r.jsxs("div",{style:Qe.header,children:[r.jsx("h3",{style:Qe.title,children:" "}),r.jsx("button",{onClick:n,style:Qe.closeIcon,children:""})]}),r.jsxs("div",{style:Qe.subtitle,children:["",e.length," "]}),r.jsxs("div",{style:Qe.toolbar,children:[r.jsx("button",{onClick:a,style:Qe.selectAllBtn,children:s.size===e.length?" ":""}),r.jsxs("div",{style:Qe.selectionInfo,children:[" ",s.size," / ",e.length]})]}),r.jsx("div",{style:Qe.eventList,children:e.map(c=>{var E;const m=c.child,y=d(c.giftItemId),S=s.has(m.id);return r.jsxs("div",{style:{...Qe.eventCard,borderColor:S?"#4caf50":"#e0e0e0",background:S?"#f1f8f4":"#fff"},onClick:()=>i(m.id),children:[r.jsx("div",{style:Qe.checkbox,children:r.jsx("input",{type:"checkbox",checked:S,onChange:()=>i(m.id),style:Qe.checkboxInput})}),r.jsxs("div",{style:Qe.cardContent,children:[r.jsxs("div",{style:Qe.promotionHeader,children:[r.jsxs("div",{style:Qe.childInfo,children:[r.jsx("span",{style:Qe.childName,children:m.name}),r.jsx("span",{style:Qe.childGender,children:m.gender===""?"":""})]}),r.jsxs("div",{style:Qe.promotionBadge,children:[r.jsx("span",{style:Qe.promotionLabel,children:""}),r.jsx("span",{style:{...Qe.rankBadge,background:p[c.rank]||"#666"},children:c.rank})]})]}),r.jsxs("div",{style:Qe.sectInfo,children:[r.jsx("span",{style:Qe.sectIcon,children:""}),r.jsx("span",{style:Qe.sectName,children:((E=c.sect)==null?void 0:E.name)||""})]}),r.jsxs("div",{style:Qe.giftSection,children:[r.jsxs("div",{style:Qe.giftHeader,children:[r.jsx("span",{style:Qe.giftLabel,children:""}),r.jsx("span",{style:{...Qe.giftName,color:u[y.rarity]||"#666"},children:y.name})]}),y.desc&&r.jsx("div",{style:Qe.giftDesc,children:y.desc}),y.stats&&r.jsxs("div",{style:Qe.giftStats,children:[y.stats.atk&&r.jsxs("span",{style:Qe.statBadge,children:[" +",y.stats.atk]}),y.stats.hp&&r.jsxs("span",{style:Qe.statBadge,children:[" +",y.stats.hp]}),y.stats.def&&r.jsxs("span",{style:Qe.statBadge,children:[" +",y.stats.def]})]}),y.effect&&r.jsxs("div",{style:Qe.giftEffect,children:[" ",typeof y.effect=="object"?`${y.effect.kind==="heal"?"":y.effect.kind==="exp"?"":y.effect.kind==="aptitude"?"":""} +${y.effect.amount}`:y.effect]})]}),r.jsx("div",{style:Qe.message,children:typeof c.message=="string"?c.message:JSON.stringify(c.message)})]})]},m.id)})}),r.jsxs("div",{style:Qe.footer,children:[r.jsxs("button",{style:Qe.confirmBtn,onClick:l,disabled:s.size===0,children:[" (",s.size,")"]}),r.jsx("button",{style:Qe.cancelBtn,onClick:n,children:""})]})]})})},Qe={overlay:{position:"fixed",top:0,left:0,right:0,bottom:0,background:"rgba(0, 0, 0, 0.75)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:3e3,padding:"20px"},modal:{background:"linear-gradient(135deg, #fff9c4 0%, #fff59d 100%)",borderRadius:"16px",width:"90%",maxWidth:"850px",maxHeight:"85vh",display:"flex",flexDirection:"column",boxShadow:"0 10px 40px rgba(0,0,0,0.3)",overflow:"hidden",border:"2px solid #fdd835"},header:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"20px 24px",borderBottom:"2px solid #fdd835",background:"linear-gradient(90deg, #fff9c4, #fff176)",flexShrink:0},title:{margin:0,fontSize:"22px",color:"#f57f17",fontWeight:"bold"},closeIcon:{background:"none",border:"none",fontSize:"28px",cursor:"pointer",color:"#f57f17",padding:"0",lineHeight:"1"},subtitle:{padding:"16px 24px",fontSize:"14px",color:"#666",borderBottom:"1px solid #fdd835",flexShrink:0},toolbar:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"12px 24px",background:"#fffde7",borderBottom:"1px solid #e0e0e0",flexShrink:0},selectAllBtn:{padding:"6px 16px",background:"#fdd835",color:"#333",border:"none",borderRadius:"6px",cursor:"pointer",fontSize:"13px",fontWeight:"500"},selectionInfo:{fontSize:"13px",color:"#666"},eventList:{flex:1,overflowY:"auto",padding:"16px 24px",display:"flex",flexDirection:"column",gap:"16px"},eventCard:{display:"flex",gap:"12px",padding:"16px",border:"2px solid #e0e0e0",borderRadius:"12px",cursor:"pointer",transition:"all 0.2s",background:"#fff"},checkbox:{flexShrink:0,display:"flex",alignItems:"flex-start",paddingTop:"4px"},checkboxInput:{width:"18px",height:"18px",cursor:"pointer"},cardContent:{flex:1,display:"flex",flexDirection:"column",gap:"12px"},promotionHeader:{display:"flex",justifyContent:"space-between",alignItems:"center",paddingBottom:"12px",borderBottom:"1px dashed #e0e0e0"},childInfo:{display:"flex",alignItems:"center",gap:"8px"},childName:{fontSize:"18px",fontWeight:"bold",color:"#333"},childGender:{fontSize:"14px",color:"#999"},promotionBadge:{display:"flex",alignItems:"center",gap:"8px"},promotionLabel:{fontSize:"12px",color:"#666"},rankBadge:{padding:"4px 12px",borderRadius:"12px",color:"#fff",fontSize:"13px",fontWeight:"bold"},sectInfo:{display:"flex",alignItems:"center",gap:"8px",padding:"8px 12px",background:"#e3f2fd",borderRadius:"8px"},sectIcon:{fontSize:"16px"},sectName:{fontSize:"14px",color:"#1976d2",fontWeight:"600"},giftSection:{display:"flex",flexDirection:"column",gap:"8px",padding:"12px",background:"#f3e5f5",borderRadius:"8px",border:"1px solid #ce93d8"},giftHeader:{display:"flex",alignItems:"center",gap:"8px"},giftLabel:{fontSize:"13px",color:"#666",fontWeight:"500"},giftName:{fontSize:"15px",fontWeight:"bold"},giftDesc:{fontSize:"12px",color:"#666",fontStyle:"italic"},giftStats:{display:"flex",gap:"8px",flexWrap:"wrap"},statBadge:{padding:"3px 8px",background:"#fff",borderRadius:"8px",fontSize:"11px",color:"#666",fontWeight:"500",border:"1px solid #e0e0e0"},giftEffect:{fontSize:"12px",color:"#4caf50",fontWeight:"500"},message:{fontSize:"13px",color:"#555",lineHeight:"1.5",padding:"8px 12px",background:"#fff8e1",borderRadius:"8px",border:"1px solid #fff176"},footer:{display:"flex",gap:"12px",padding:"16px 24px",borderTop:"2px solid #fdd835",background:"#fffde7",flexShrink:0},confirmBtn:{flex:1,padding:"12px",background:"#4caf50",color:"#fff",border:"none",borderRadius:"8px",cursor:"pointer",fontSize:"15px",fontWeight:"bold",transition:"all 0.2s"},cancelBtn:{padding:"12px 24px",background:"#e0e0e0",border:"none",borderRadius:"8px",cursor:"pointer",fontSize:"15px"}},IC=({marriagePlans:e,onConfirm:t,onClose:n,onModify:s})=>{const[o,i]=b.useState(new Set(e.map(c=>c.childId))),a=c=>{const m=new Set(o);m.has(c)?m.delete(c):m.add(c),i(m)},l=()=>{o.size===e.length?i(new Set):i(new Set(e.map(c=>c.childId)))},d=()=>{const c=e.filter(m=>o.has(m.childId));t(c)},u=o.size*500,p=c=>{switch(c){case"talented":return" ";case"beautiful":return" ";case"wise":return" ";case"buddha":return" ";default:return" "}};return r.jsx("div",{style:Pe.overlay,children:r.jsxs("div",{style:Pe.modal,children:[r.jsxs("div",{style:Pe.header,children:[r.jsx("h3",{style:Pe.title,children:" "}),r.jsx("button",{onClick:n,style:Pe.closeIcon,children:""})]}),r.jsxs("div",{style:Pe.summary,children:[r.jsxs("div",{style:Pe.summaryItem,children:[r.jsx("span",{style:Pe.summaryLabel,children:""}),r.jsxs("span",{style:Pe.summaryValue,children:[e.length," "]})]}),r.jsxs("div",{style:Pe.summaryItem,children:[r.jsx("span",{style:Pe.summaryLabel,children:""}),r.jsxs("span",{style:{...Pe.summaryValue,color:"#4caf50"},children:[o.size," "]})]}),r.jsxs("div",{style:Pe.summaryItem,children:[r.jsx("span",{style:Pe.summaryLabel,children:""}),r.jsxs("span",{style:{...Pe.summaryValue,color:"#ff9800"},children:[u," "]})]})]}),r.jsxs("div",{style:Pe.toolbar,children:[r.jsx("button",{onClick:l,style:Pe.selectAllBtn,children:o.size===e.length?" ":""}),r.jsx("div",{style:Pe.hint,children:""})]}),r.jsx("div",{style:Pe.planList,children:e.map(c=>{var E,w,g,h,v,x,I,_,N,C,j,T;const m=o.has(c.childId),y=c.childRef,S=c.spouse;return r.jsxs("div",{style:{...Pe.planCard,borderColor:m?"#4caf50":"#e0e0e0",background:m?"#f1f8f4":"#fff",opacity:m?1:.6},onClick:()=>a(c.childId),children:[r.jsx("div",{style:Pe.checkbox,children:r.jsx("input",{type:"checkbox",checked:m,onChange:()=>a(c.childId),style:Pe.checkboxInput})}),r.jsxs("div",{style:Pe.cardContent,children:[r.jsxs("div",{style:Pe.personSection,children:[r.jsx("div",{style:Pe.avatarWrapper,children:r.jsx(Yr,{avatar:y.avatar,gender:y.gender,size:60})}),r.jsxs("div",{style:Pe.personInfo,children:[r.jsx("div",{style:Pe.personName,children:y.name}),r.jsxs("div",{style:Pe.personDetail,children:[y.gender===""?"":""," | ",y.tierTitle||""]}),r.jsxs("div",{style:Pe.stats,children:[r.jsxs("span",{style:Pe.statItem,children:[" ",((E=y.stats)==null?void 0:E.aptitude)||0]}),r.jsxs("span",{style:Pe.statItem,children:[" ",((w=y.stats)==null?void 0:w.looks)||0]}),r.jsxs("span",{style:Pe.statItem,children:[" ",((g=y.stats)==null?void 0:g.intelligence)||0]})]})]})]}),r.jsxs("div",{style:Pe.arrow,children:[r.jsx("div",{style:Pe.arrowIcon,children:""}),r.jsx("div",{style:Pe.arrowLine})]}),r.jsxs("div",{style:Pe.personSection,children:[r.jsx("div",{style:Pe.avatarWrapper,children:r.jsx(Yr,{avatar:S.avatar,gender:S.gender,size:60})}),r.jsxs("div",{style:Pe.personInfo,children:[r.jsxs("div",{style:Pe.personName,children:[S.name,r.jsx("span",{style:Pe.archetypeBadge,children:p(S.archetype)})]}),r.jsxs("div",{style:Pe.personDetail,children:[S.gender===""?"":""," | ",S.tierTitle||""]}),r.jsxs("div",{style:Pe.stats,children:[r.jsxs("span",{style:{...Pe.statItem,color:((h=S.stats)==null?void 0:h.aptitude)>=80?"#e91e63":"#666"},children:[" ",((v=S.stats)==null?void 0:v.aptitude)||0]}),r.jsxs("span",{style:{...Pe.statItem,color:((x=S.stats)==null?void 0:x.looks)>=80?"#e91e63":"#666"},children:[" ",((I=S.stats)==null?void 0:I.looks)||0]}),r.jsxs("span",{style:{...Pe.statItem,color:((_=S.stats)==null?void 0:_.intelligence)>=80?"#e91e63":"#666"},children:[" ",((N=S.stats)==null?void 0:N.intelligence)||0]})]})]})]}),r.jsx("div",{style:Pe.spiritRootSection,children:r.jsxs("div",{style:Pe.spiritRoot,children:["",((C=S.spiritRoot)==null?void 0:C.type)||"",((T=(j=S.spiritRoot)==null?void 0:j.elements)==null?void 0:T.length)>0&&` (${S.spiritRoot.elements.join("")})`]})})]})]},c.childId)})}),r.jsxs("div",{style:Pe.footer,children:[r.jsxs("button",{style:Pe.confirmBtn,onClick:d,disabled:o.size===0,children:[" (",o.size,"   ",u," )"]}),r.jsx("button",{style:Pe.cancelBtn,onClick:n,children:""})]})]})})},Pe={overlay:{position:"fixed",top:0,left:0,right:0,bottom:0,background:"rgba(0, 0, 0, 0.75)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:3e3,padding:"20px"},modal:{background:"linear-gradient(135deg, #fff8e1 0%, #ffe0b2 100%)",borderRadius:"16px",width:"90%",maxWidth:"1000px",maxHeight:"85vh",display:"flex",flexDirection:"column",boxShadow:"0 10px 40px rgba(0,0,0,0.3)",overflow:"hidden",border:"2px solid #ffb74d"},header:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"20px 24px",borderBottom:"2px solid #ffb74d",background:"linear-gradient(90deg, #ffe0b2, #ffcc80)",flexShrink:0},title:{margin:0,fontSize:"22px",color:"#d84315",fontWeight:"bold"},closeIcon:{background:"none",border:"none",fontSize:"28px",cursor:"pointer",color:"#d84315",padding:"0",lineHeight:"1"},summary:{display:"flex",justifyContent:"space-around",padding:"16px 24px",background:"#fff8e1",borderBottom:"1px solid #ffb74d",flexShrink:0},summaryItem:{display:"flex",flexDirection:"column",alignItems:"center",gap:"4px"},summaryLabel:{fontSize:"12px",color:"#666"},summaryValue:{fontSize:"16px",fontWeight:"bold",color:"#d84315"},toolbar:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"12px 24px",background:"#fafafa",borderBottom:"1px solid #e0e0e0",flexShrink:0},selectAllBtn:{padding:"6px 16px",background:"#ff9800",color:"#fff",border:"none",borderRadius:"6px",cursor:"pointer",fontSize:"13px",fontWeight:"500"},hint:{fontSize:"12px",color:"#999",fontStyle:"italic"},planList:{flex:1,overflowY:"auto",padding:"16px 24px",display:"flex",flexDirection:"column",gap:"16px"},planCard:{display:"flex",gap:"12px",padding:"16px",border:"2px solid #e0e0e0",borderRadius:"16px",cursor:"pointer",transition:"all 0.2s",background:"#fff"},checkbox:{flexShrink:0,display:"flex",alignItems:"center"},checkboxInput:{width:"20px",height:"20px",cursor:"pointer"},cardContent:{flex:1,display:"flex",alignItems:"center",gap:"20px"},personSection:{flex:1,display:"flex",gap:"12px",alignItems:"center"},avatarWrapper:{flexShrink:0},personInfo:{flex:1,display:"flex",flexDirection:"column",gap:"6px"},personName:{fontSize:"16px",fontWeight:"bold",color:"#333",display:"flex",alignItems:"center",gap:"8px"},archetypeBadge:{fontSize:"11px",padding:"2px 8px",background:"#e91e63",color:"#fff",borderRadius:"10px",fontWeight:"500"},personDetail:{fontSize:"13px",color:"#666"},stats:{display:"flex",gap:"12px",fontSize:"12px"},statItem:{color:"#666"},arrow:{display:"flex",flexDirection:"column",alignItems:"center",gap:"4px",flexShrink:0},arrowIcon:{fontSize:"20px"},arrowLine:{width:"2px",height:"40px",background:"linear-gradient(to bottom, #e91e63, #f06292)",borderRadius:"1px"},spiritRootSection:{width:"100%",padding:"8px 12px",background:"#fff3e0",borderRadius:"8px",fontSize:"12px",color:"#e65100",marginTop:"8px"},spiritRoot:{fontWeight:"500"},footer:{display:"flex",gap:"12px",padding:"16px 24px",borderTop:"2px solid #ffb74d",background:"#fff8e1",flexShrink:0},confirmBtn:{flex:1,padding:"12px",background:"#4caf50",color:"#fff",border:"none",borderRadius:"8px",cursor:"pointer",fontSize:"15px",fontWeight:"bold",transition:"all 0.2s"},cancelBtn:{padding:"12px 24px",background:"#e0e0e0",border:"none",borderRadius:"8px",cursor:"pointer",fontSize:"15px"}},_C=({manualItems:e,children:t,onAssign:n,onClose:s})=>{const[o,i]=b.useState([]),[a,l]=b.useState("AUTO"),u=(()=>{const w=[];return e.forEach(g=>{(g.manualIds&&g.manualIds.length?g.manualIds:g.manualId?[g.manualId]:[]).forEach(v=>{const x=mn[v];x&&t.forEach(I=>{var j,T,A;if(!I||!I.spiritRoot||I.cultivationMethod===v)return;const _=Cc(v,I.spiritRoot);if(!(_!=null&&_.compatibility))return;const C=(_.compatibility.compatibility||0)+(((j=I.stats)==null?void 0:j.aptitude)||0)/200;w.push({manualId:v,manualName:x.name,childId:I.id,childName:I.name,childTier:I.tierTitle||"",childAptitude:((T=I.stats)==null?void 0:T.aptitude)||0,currentManual:I.cultivationMethod,currentManualName:((A=mn[I.cultivationMethod])==null?void 0:A.name)||"",compatibility:_.compatibility,score:C,itemInstanceId:g.instanceId})})})}),w.sort((g,h)=>h.score-g.score)})(),c=(()=>{const w=new Map;return u.forEach(g=>{const h=w.get(g.childId);(!h||g.score>h.score)&&w.set(g.childId,g)}),Array.from(w.values()).filter(g=>{var v,x,I;const h=((I=(x=Cc(g.currentManual,(v=t.find(_=>_.id===g.childId))==null?void 0:v.spiritRoot))==null?void 0:x.compatibility)==null?void 0:I.compatibility)||0;return g.compatibility.compatibility>h}).slice(0,10)})(),m=w=>{const g=`${w.childId}-${w.manualId}`,h=o.findIndex(v=>`${v.childId}-${v.manualId}`===g);h>=0?i(v=>v.filter((x,I)=>I!==h)):i(v=>[...v.filter(x=>x.childId!==w.childId),w])},y=()=>{i(c)},S=()=>{n(o)},E=w=>{switch(w){case"":return"#4caf50";case"":return"#8bc34a";case"":return"#ffc107";case"":return"#ff9800";case"":return"#f44336";default:return"#9e9e9e"}};return r.jsx("div",{style:Fe.overlay,children:r.jsxs("div",{style:Fe.modal,children:[r.jsxs("div",{style:Fe.header,children:[r.jsx("h3",{style:Fe.title,children:" "}),r.jsx("button",{onClick:s,style:Fe.closeIcon,children:""})]}),r.jsxs("div",{style:Fe.modeSwitch,children:[r.jsx("button",{style:{...Fe.modeBtn,...a==="AUTO"?Fe.modeBtnActive:{}},onClick:()=>l("AUTO"),children:" "}),r.jsx("button",{style:{...Fe.modeBtn,...a==="MANUAL"?Fe.modeBtnActive:{}},onClick:()=>l("MANUAL"),children:" "})]}),a==="AUTO"?r.jsxs("div",{style:Fe.content,children:[r.jsxs("div",{style:Fe.recommendHeader,children:[r.jsxs("div",{style:Fe.recommendTitle,children:[" ",c.length," "]}),c.length>0&&r.jsx("button",{onClick:y,style:Fe.quickSelectBtn,children:" "})]}),c.length===0?r.jsx("div",{style:Fe.empty,children:" "}):r.jsx("div",{style:Fe.optionList,children:c.map((w,g)=>{const h=o.some(v=>v.childId===w.childId&&v.manualId===w.manualId);return r.jsxs("div",{style:{...Fe.optionCard,borderColor:h?"#4caf50":"#e0e0e0",background:h?"#f1f8f4":"#fff"},onClick:()=>m(w),children:[r.jsxs("div",{style:Fe.optionHeader,children:[r.jsx("input",{type:"checkbox",checked:h,onChange:()=>m(w),style:Fe.checkbox}),r.jsxs("div",{style:Fe.optionInfo,children:[r.jsxs("div",{style:Fe.childInfo,children:[w.childName," (",w.childTier,")"]}),r.jsxs("div",{style:Fe.manualChange,children:[r.jsx("span",{style:Fe.oldManual,children:w.currentManualName}),r.jsx("span",{style:Fe.arrow,children:""}),r.jsx("span",{style:Fe.newManual,children:w.manualName})]})]})]}),r.jsxs("div",{style:Fe.compatibilityRow,children:[r.jsx("span",{style:Fe.compatibilityLabel,children:""}),r.jsxs("span",{style:{...Fe.compatibilityValue,color:E(w.compatibility.level)},children:[w.compatibility.level," (",w.compatibility.compatibility,"%)"]}),r.jsxs("span",{style:Fe.speedBonus,children:[" ",w.compatibility.speedMultiplier]})]}),w.compatibility.desc&&r.jsxs("div",{style:Fe.compatibilityDesc,children:[" ",w.compatibility.desc]})]},`${w.childId}-${w.manualId}`)})})]}):r.jsxs("div",{style:Fe.content,children:[r.jsxs("div",{style:Fe.allOptionsHeader,children:[" ",u.length," "]}),u.length===0?r.jsx("div",{style:Fe.empty,children:""}):r.jsx("div",{style:Fe.optionList,children:u.slice(0,50).map(w=>{const g=o.some(h=>h.childId===w.childId&&h.manualId===w.manualId);return r.jsxs("div",{style:{...Fe.optionCard,borderColor:g?"#4caf50":"#e0e0e0",background:g?"#f1f8f4":"#fff"},onClick:()=>m(w),children:[r.jsxs("div",{style:Fe.optionHeader,children:[r.jsx("input",{type:"checkbox",checked:g,onChange:()=>m(w),style:Fe.checkbox}),r.jsxs("div",{style:Fe.optionInfo,children:[r.jsxs("div",{style:Fe.childInfo,children:[w.childName," (",w.childTier,", ",w.childAptitude,")"]}),r.jsx("div",{style:Fe.manualName,children:w.manualName})]})]}),r.jsxs("div",{style:Fe.compatibilityRow,children:[r.jsx("span",{style:{...Fe.compatibilityBadge,background:E(w.compatibility.level)},children:w.compatibility.level}),r.jsxs("span",{style:Fe.speedBonus,children:["",w.compatibility.speedMultiplier]})]})]},`${w.childId}-${w.manualId}`)})})]}),r.jsxs("div",{style:Fe.footer,children:[r.jsxs("div",{style:Fe.selectionInfo,children:[" ",o.length," "]}),r.jsxs("div",{style:Fe.footerActions,children:[r.jsxs("button",{style:Fe.confirmBtn,onClick:S,disabled:o.length===0,children:[" (",o.length,")"]}),r.jsx("button",{style:Fe.cancelBtn,onClick:s,children:""})]})]})]})})},Fe={overlay:{position:"fixed",top:0,left:0,right:0,bottom:0,background:"rgba(0, 0, 0, 0.75)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:3e3,padding:"20px"},modal:{background:"#fff",borderRadius:"16px",width:"90%",maxWidth:"900px",maxHeight:"85vh",display:"flex",flexDirection:"column",boxShadow:"0 10px 40px rgba(0,0,0,0.3)",overflow:"hidden"},header:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"20px 24px",borderBottom:"2px solid #7e57c2",background:"linear-gradient(90deg, #ede7f6, #d1c4e9)",flexShrink:0},title:{margin:0,fontSize:"22px",color:"#5e35b1",fontWeight:"bold"},closeIcon:{background:"none",border:"none",fontSize:"28px",cursor:"pointer",color:"#5e35b1",padding:"0",lineHeight:"1"},modeSwitch:{display:"flex",gap:"8px",padding:"16px 24px",background:"#f5f5f5",borderBottom:"1px solid #e0e0e0",flexShrink:0},modeBtn:{flex:1,padding:"10px",background:"#fff",border:"2px solid #e0e0e0",borderRadius:"8px",cursor:"pointer",fontSize:"14px",fontWeight:"500",transition:"all 0.2s"},modeBtnActive:{background:"#7e57c2",color:"#fff",borderColor:"#7e57c2"},content:{flex:1,overflowY:"auto",display:"flex",flexDirection:"column"},recommendHeader:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"16px 24px",background:"#f5f5f5",borderBottom:"1px solid #e0e0e0"},recommendTitle:{fontSize:"14px",color:"#666",fontWeight:"500"},quickSelectBtn:{padding:"6px 16px",background:"#4caf50",color:"#fff",border:"none",borderRadius:"6px",cursor:"pointer",fontSize:"13px"},allOptionsHeader:{padding:"16px 24px",fontSize:"14px",color:"#666",background:"#f5f5f5",borderBottom:"1px solid #e0e0e0"},empty:{padding:"60px 24px",textAlign:"center",fontSize:"15px",color:"#999"},optionList:{padding:"16px 24px",display:"flex",flexDirection:"column",gap:"12px"},optionCard:{padding:"16px",border:"2px solid #e0e0e0",borderRadius:"12px",cursor:"pointer",transition:"all 0.2s",display:"flex",flexDirection:"column",gap:"12px"},optionHeader:{display:"flex",gap:"12px",alignItems:"flex-start"},checkbox:{width:"18px",height:"18px",cursor:"pointer",marginTop:"2px",flexShrink:0},optionInfo:{flex:1,display:"flex",flexDirection:"column",gap:"6px"},childInfo:{fontSize:"15px",fontWeight:"bold",color:"#333"},manualChange:{display:"flex",alignItems:"center",gap:"8px",fontSize:"14px"},oldManual:{color:"#999",textDecoration:"line-through"},arrow:{color:"#666"},newManual:{color:"#7e57c2",fontWeight:"600"},manualName:{fontSize:"14px",color:"#7e57c2",fontWeight:"600"},compatibilityRow:{display:"flex",gap:"12px",alignItems:"center",fontSize:"13px"},compatibilityLabel:{color:"#666"},compatibilityValue:{fontWeight:"600"},compatibilityBadge:{padding:"4px 10px",borderRadius:"12px",color:"#fff",fontSize:"12px",fontWeight:"bold"},speedBonus:{color:"#2196f3",fontWeight:"500"},compatibilityDesc:{fontSize:"12px",color:"#666",fontStyle:"italic",paddingLeft:"30px"},footer:{padding:"16px 24px",borderTop:"2px solid #e0e0e0",background:"#f5f5f5",display:"flex",justifyContent:"space-between",alignItems:"center",flexShrink:0},selectionInfo:{fontSize:"14px",color:"#666"},footerActions:{display:"flex",gap:"12px"},confirmBtn:{padding:"10px 24px",background:"#7e57c2",color:"#fff",border:"none",borderRadius:"8px",cursor:"pointer",fontSize:"15px",fontWeight:"bold",transition:"all 0.2s"},cancelBtn:{padding:"10px 24px",background:"#e0e0e0",border:"none",borderRadius:"8px",cursor:"pointer",fontSize:"15px"}},RC=({modalState:e,closeModal:t,player:n,inventory:s,handleGiftConfirm:o,handleNegotiateConfirm:i,handleShopPurchase:a,handleOptionSelect:l,handleShuraFieldSelect:d,handleBuyAuctionItem:u,handleShowAuctionPlot:p,modalMgr:c,allChildren:m,visibleChildren:y,handleEquipToChild:S,handleUseConsumable:E,handleBatchUseConsumables:w,handleDiscardFromInventory:g,handleGiveToChild:h,handleBatchGiveToChildren:v,handleSell:x,handleAutoAssignManualToChild:I,getMarketPrice:_,testQueue:N,handleTestFinish:C,handleTestQueueClose:j,childSelectorModal:T,handleChildSelectorSelect:A,closeChildSelectorModal:V,selectedChild:F,childNavigationMeta:B,handleNavigateChild:$,handleChildAction:Y,setSelectedChild:ne,showSpouseSelection:X,marryingChild:ee,spouseCandidates:ae,handleSpouseSelect:Te,resetSpouseSelection:Be,batchGiftEvents:ze,handleBatchGiftConfirm:W,handleBatchGiftClose:J,batchPromotionEvents:fe,handleBatchPromotionConfirm:re,handleBatchPromotionClose:ce,batchMarriagePlans:Ce,handleBatchMarriageConfirm:Ge,handleBatchMarriageClose:Ne,handleBatchManualAssign:nt})=>r.jsxs(r.Fragment,{children:[e.type==="GIFT"&&r.jsx(oC,{npc:e.data,inventory:s,onGift:o,onClose:t}),e.type==="NEGOTIATE"&&r.jsx(aC,{npc:e.data,onNegotiate:i,onClose:t}),e.type==="SHOP"&&r.jsx(lC,{items:e.data.items,playerSpiritStones:n.resources.spiritStones||0,onPurchase:a,onClose:t}),e.type==="RESULT"&&r.jsx(cC,{result:e.data,onClose:t}),e.type==="CONFIRM"&&r.jsx(dC,{message:e.data.message,input:e.data.input,onConfirm:Le=>{e.data.onConfirm(Le),t()},onCancel:t}),e.type==="EVENT"&&r.jsx(uC,{event:e.data.event,npc:e.data.npc,onClose:t,onOptionSelect:l}),e.type==="SHURA_FIELD"&&r.jsx(pC,{event:e.data,player:n,onClose:t,onOptionSelect:d}),e.type==="JEALOUSY"&&r.jsx(mC,{event:e.data,onClose:t}),e.type==="AUCTION"&&r.jsx(xC,{auction:e.data,playerResources:n.resources,onClose:t,onBuy:u,onShowPlot:p,playerSoldAuctionItems:n.soldAuctionItems||[]}),c.inventoryModal.open&&r.jsx(bC,{items:s,mode:c.inventoryModal.mode,slot:c.inventoryModal.slot,childId:c.inventoryModal.childId,children:m,batchUseItems:c.inventoryModal.batchUseItems||[],onClose:()=>c.closeInventory(),onEquip:Le=>S(c.inventoryModal.childId,c.inventoryModal.slot,Le),onUse:Le=>E(c.inventoryModal.childId,Le),onBatchUse:(Le,z)=>w(Le,z),onDiscard:Le=>g(Le),onGiveToChild:h,onBatchGive:v,onSell:(Le,z)=>x(Le,z),onAutoAssignManual:I,getMarketPrice:_}),N.length>0&&r.jsx(vC,{child:N[0],onFinish:C,onClose:j}),T.open&&r.jsx(wC,{children:y,item:T.item,items:T.items,isBatch:T.isBatch,onSelect:A,onClose:V}),F&&r.jsx(EC,{child:F,navigation:B,onNavigate:$,onClose:()=>ne(null),onAction:(Le,z)=>Y(F.id,Le,z)}),X&&ee&&r.jsx(jC,{child:ee,candidates:ae,onSelect:Te,onClose:Be}),c.showBatchGiftModal&&ze.length>0&&r.jsx(CC,{giftEvents:ze,onConfirm:W,onClose:J}),c.showBatchPromotionModal&&fe.length>0&&r.jsx(TC,{promotionEvents:fe,onConfirm:re,onClose:ce}),c.showBatchMarriageModal&&Ce.length>0&&r.jsx(IC,{marriagePlans:Ce,onConfirm:Ge,onClose:Ne}),c.showBatchManualModal&&r.jsx(_C,{manualItems:s.filter(Le=>Le.type==="manual"&&(Le.manualIds&&Le.manualIds.length||Le.manualId)),children:y.length?y:m,onAssign:nt,onClose:()=>c.closeBatchManualModal()})]});function MC({npc:e,onClose:t,playerAffection:n=0}){var w,g;const[s,o]=b.useState("ALL"),[i,a]=b.useState(0),l=20;if(b.useEffect(()=>{const h=v=>{v.key==="Escape"&&t()};return window.addEventListener("keydown",h),()=>window.removeEventListener("keydown",h)},[t]),b.useEffect(()=>{a(0)},[s]),!e)return null;const d=Number(n)||0,u=Math.max(0,Math.min(100,d));if(d<30)return r.jsx("div",{className:"modal-overlay",onClick:t,children:r.jsxs("div",{className:"npc-log-modal",onClick:h=>h.stopPropagation(),children:[r.jsxs("div",{className:"log-modal-header",children:[r.jsx("div",{className:"log-modal-title",children:r.jsxs("h2",{children:[e.name," "]})}),r.jsx("button",{className:"close-btn",onClick:t,children:""})]}),r.jsxs("div",{className:"log-empty",style:{padding:"80px 20px"},children:[r.jsx("p",{style:{fontSize:"64px",margin:"0 0 20px 0"},children:""}),r.jsx("h3",{style:{color:"#ffd700",marginBottom:"12px"},children:""}),r.jsxs("p",{style:{color:"rgba(255,255,255,0.7)",fontSize:"16px"},children:[" ",e.name," ",r.jsx("br",{})," ",r.jsx("span",{style:{color:"#ffd700",fontWeight:"bold"},children:"30"})," ",e.gender===""?"":"",""]}),r.jsxs("p",{style:{color:"rgba(255,255,255,0.5)",fontSize:"14px",marginTop:"20px"},children:["",r.jsx("span",{style:{color:d<10?"#f44336":"#ff9800"},children:u})," / 30"]})]})]})});const p=Ek(e,d),c=s==="ALL"?p:p.filter(h=>h.type===s),m=Math.max(1,Math.ceil(c.length/l)),y=c.slice(i*l,(i+1)*l),S={all:p.length,interaction:p.filter(h=>h.type===gt.INTERACTION).length,stateChange:p.filter(h=>h.type===gt.STATE_CHANGE).length,daily:p.filter(h=>h.type===gt.DAILY).length},E=h=>{switch(h){case gt.INTERACTION:return{icon:"",color:"#4CAF50",label:""};case gt.STATE_CHANGE:return{icon:"",color:"#FF5722",label:""};case gt.DAILY:return{icon:"",color:"#2196F3",label:""};default:return{icon:"",color:"#9E9E9E",label:""}}};return r.jsx("div",{className:"modal-overlay",onClick:t,children:r.jsxs("div",{className:"npc-log-modal",onClick:h=>h.stopPropagation(),children:[r.jsxs("div",{className:"log-modal-header",children:[r.jsxs("div",{className:"log-modal-title",children:[r.jsxs("h2",{children:[e.name," "]}),r.jsxs("p",{className:"log-modal-subtitle",children:[e.gender===""?"":"","..."]})]}),r.jsx("button",{className:"close-btn",onClick:t,children:""})]}),r.jsxs("div",{className:"log-filter-bar",children:[r.jsxs("button",{className:`filter-btn ${s==="ALL"?"active":""}`,onClick:()=>o("ALL"),children:["  (",S.all,")"]}),r.jsxs("button",{className:`filter-btn ${s===gt.INTERACTION?"active":""}`,onClick:()=>o(gt.INTERACTION),children:["  (",S.interaction,")"]}),r.jsxs("button",{className:`filter-btn ${s===gt.STATE_CHANGE?"active":""}`,onClick:()=>o(gt.STATE_CHANGE),children:["  (",S.stateChange,")"]}),r.jsxs("button",{className:`filter-btn ${s===gt.DAILY?"active":""}`,onClick:()=>o(gt.DAILY),children:["  (",S.daily,")"]})]}),r.jsx("div",{className:"log-content",children:c.length===0?r.jsxs("div",{className:"log-empty",children:[r.jsx("p",{children:""}),r.jsx("p",{children:""}),d<80&&p.length<((w=e.logs)==null?void 0:w.length)&&r.jsx("p",{className:"log-hint",children:" "})]}):r.jsx("div",{className:"log-list",children:y.map((h,v)=>{const x=E(h.type);return r.jsxs("div",{className:`log-entry ${h.isSecret?"secret":""}`,children:[r.jsxs("div",{className:"log-header",children:[r.jsxs("span",{className:"log-type-badge",style:{backgroundColor:x.color},children:[x.icon," ",x.label]}),r.jsxs("span",{className:"log-date",children:[" ",h.year,"  ",h.month," "]}),h.isSecret&&r.jsx("span",{className:"secret-badge",title:"",children:""})]}),r.jsx("div",{className:"log-text",children:h.content})]},`${h.timestamp}-${v}`)})})}),c.length>l&&r.jsxs("div",{className:"log-pagination",children:[r.jsx("button",{className:"page-btn",onClick:()=>a(h=>Math.max(0,h-1)),disabled:i<=0,children:""}),r.jsxs("span",{className:"page-info",children:[" ",i+1," / ",m," "]}),r.jsx("button",{className:"page-btn",onClick:()=>a(h=>Math.min(m-1,h+1)),disabled:i>=m-1,children:""})]}),r.jsxs("div",{className:"log-record-count",children:[" ",c.length," "]}),d<80&&((g=e.logs)==null?void 0:g.length)>p.length&&r.jsx("div",{className:"log-footer-hint",children:"  80+ "})]})})}const AC=({player:e,enemy:t,result:n,onClose:s})=>{var d,u;const o=b.useRef(null),[i,a]=b.useState(0),l=b.useMemo(()=>NC((n==null?void 0:n.logs)||[],e),[n==null?void 0:n.logs,e,t]);return b.useEffect(()=>{if(a(0),!l.length)return;const p=setInterval(()=>{a(c=>c>=l.length?(clearInterval(p),c):c+1)},300);return()=>clearInterval(p)},[l.length]),b.useEffect(()=>{o.current&&(o.current.scrollTop=o.current.scrollHeight)},[i]),r.jsx("div",{style:un.overlay,children:r.jsxs("div",{style:un.window,children:[r.jsx("div",{style:un.header,children:" "}),r.jsxs("div",{style:un.statusBar,children:[r.jsxs("div",{style:un.fighter,children:[r.jsx("div",{style:un.avatar,children:""}),r.jsx("div",{children:e.name}),r.jsxs("div",{style:{color:"#d32f2f"},children:["HP: ",((d=e.combatStats)==null?void 0:d.hp)||0]}),r.jsxs("div",{style:{marginTop:6,fontSize:12,color:"#666"},children:[": ",Jn(e).total]})]}),r.jsx("div",{style:un.vs,children:"VS"}),r.jsxs("div",{style:un.fighter,children:[r.jsx("div",{style:{...un.avatar,background:"#d32f2f"},children:""}),r.jsx("div",{children:t.name}),r.jsxs("div",{style:{color:"#d32f2f"},children:["HP: ",((u=t.combatStats)==null?void 0:u.hp)||0]}),r.jsxs("div",{style:{marginTop:6,fontSize:12,color:"#666"},children:[": ",Jn(t).total]})]})]}),r.jsx("div",{style:{padding:"10px 15px",fontSize:12,color:"#444",background:"#fff8",borderBottom:"1px solid #eee"},children:""}),r.jsx("div",{style:un.logBox,ref:o,children:l.slice(0,i).map((p,c)=>r.jsxs("div",{style:un.entryRow,children:[r.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8},children:[r.jsx("div",{style:{fontSize:16},children:p.icon}),r.jsxs("div",{children:[r.jsx("div",{style:{fontSize:13,color:p.isDamage?p.byPlayer?"#2e7d32":"#d32f2f":"#444",fontWeight:600},children:p.text}),p.damage!=null&&r.jsxs("div",{style:{fontSize:12,color:"#666",marginTop:4},children:[": ",r.jsx("strong",{style:{color:p.byPlayer?"#2e7d32":"#d32f2f"},children:p.damage}),p.defended?"":""]})]})]}),p.maxHp!=null&&r.jsxs("div",{style:un.hpBarWrap,children:[r.jsx("div",{style:un.hpBarBg,children:r.jsx("div",{style:{...un.hpBarFill,width:`${Math.max(0,Math.min(100,Math.floor(p.remaining/p.maxHp*100)))}%`,background:p.byPlayer?"#2e7d32":"#d32f2f"}})}),r.jsxs("div",{style:{fontSize:12,color:"#333",marginLeft:8},children:[p.remaining,"/",p.maxHp," HP"]})]})]},c))}),r.jsx("button",{onClick:s,style:{...un.btn,background:n.success?"#4caf50":"#d32f2f"},children:n.success?"":""})]})})},un={overlay:{position:"fixed",top:0,left:0,right:0,bottom:0,background:"rgba(0,0,0,0.85)",zIndex:2200,display:"flex",alignItems:"center",justifyContent:"center"},window:{width:"90%",maxWidth:"400px",background:"#fff",borderRadius:"8px",overflow:"hidden",display:"flex",flexDirection:"column",boxShadow:"0 0 20px rgba(255,0,0,0.5)"},header:{background:"#212121",color:"#fff",padding:"15px",textAlign:"center",fontSize:"18px",fontWeight:"bold"},statusBar:{display:"flex",justifyContent:"space-between",padding:"15px",background:"#f5f5f5",borderBottom:"1px solid #ddd"},fighter:{textAlign:"center",fontSize:"12px"},avatar:{width:"40px",height:"40px",borderRadius:"50%",background:"#333",color:"white",display:"flex",alignItems:"center",justifyContent:"center",margin:"0 auto 5px"},vs:{fontSize:"24px",fontStyle:"italic",fontWeight:"bold",color:"#999",alignSelf:"center"},logBox:{padding:"15px",height:"250px",overflowY:"auto",background:"#fff",fontSize:"13px",lineHeight:"1.6"},entryRow:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"8px 0",borderBottom:"1px dashed #eee"},hpBarWrap:{display:"flex",alignItems:"center",gap:8},hpBarBg:{width:140,height:10,background:"#eee",borderRadius:6,overflow:"hidden"},hpBarFill:{height:"100%",borderRadius:6,transition:"width 0.3s ease"},btn:{padding:"15px",border:"none",color:"#fff",fontSize:"16px",cursor:"pointer",fontWeight:"bold"}};function NC(e=[],t,n){const s=[],o=/(.+)  (.+)  (\d+) ()?/,i=/(.+)  (.+)  (\d+) ()?/,a=/(.+)  HP: (\d+)\/(\d+)/;for(let l=0;l<e.length;l++){const d=e[l];let u=d.match(o)||d.match(i);if(u){const p=u[1],c=u[2],m=Number(u[3]),y=!!u[4];let S=null,E=null;if(l+1<e.length){const g=e[l+1].match(a);g&&g[1]===c&&(S=Number(g[2]),E=Number(g[3]),l++)}const w=p===t.name;s.push({icon:w?"":"",text:`${p}  ${c}`,damage:m,remaining:S,maxHp:E,defended:y,isDamage:!0,byPlayer:w});continue}s.push({icon:"",text:d,isDamage:!1})}return s}const LC=({open:e,realmName:t,progress:n,total:s,event:o,log:i,optionContext:a,onSelectOption:l,onNext:d,onStartCombat:u,onClose:p})=>{const[c,m]=b.useState(null),[y,S]=b.useState(null),[E,w]=b.useState(!1),[g,h]=b.useState(!1),[v,x]=b.useState("");if(b.useEffect(()=>{e&&w(!0)},[e]),!e)return null;const I=()=>{if(!o)return"";switch(o.kind){case"COMBAT":return"";case"BOSS":return"";case"TREASURE":return"";case"MYSTERY":return"";default:return""}},_=()=>{if(!o)return"#4a5568";switch(o.kind){case"COMBAT":return"#d32f2f";case"BOSS":return"#7b1fa2";case"TREASURE":return"#f57c00";case"MYSTERY":return"#1976d2";default:return"#388e3c"}},N=(n/s*100).toFixed(0),C=A=>{x(A.label),h(!0),l(A)},j=()=>{h(!1),x(""),setTimeout(()=>{d()},300)},T=()=>{x(""),h(!0),u()};return r.jsxs("div",{style:et.overlay,children:[r.jsxs("div",{style:{...et.window,animation:E?"slideIn 0.3s ease-out":"none"},children:[r.jsxs("div",{style:{...et.header,background:`linear-gradient(135deg, ${_()}, ${_()}dd)`},children:[r.jsxs("div",{style:et.headerTop,children:[r.jsxs("span",{style:et.realmTitle,children:[I()," ",t]}),r.jsx("button",{style:et.closeIconBtn,onClick:p,onMouseEnter:()=>S("close"),onMouseLeave:()=>S(null),children:""})]}),r.jsxs("div",{style:et.progressContainer,children:[r.jsx("div",{style:{...et.progressBar,width:`${N}%`,background:"linear-gradient(90deg, #ffd54f, #ffb300)"}}),r.jsxs("span",{style:et.progressText,children:[n," / ",s]})]})]}),r.jsxs("div",{style:et.body,children:[r.jsxs("div",{style:{...et.eventCard,borderLeft:`4px solid ${_()}`},children:[r.jsxs("div",{style:et.eventHeader,children:[r.jsx("span",{style:{...et.eventBadge,background:_()},children:(o==null?void 0:o.kind)||""}),r.jsx("h3",{style:et.eventTitle,children:(o==null?void 0:o.title)||""})]}),r.jsx("p",{style:et.eventDesc,children:(o==null?void 0:o.desc)||""})]}),(o==null?void 0:o.options)&&o.options.length>0&&r.jsxs("div",{style:et.optionsContainer,children:[r.jsx("div",{style:et.optionsLabel,children:" "}),r.jsx("div",{style:et.options,children:o.options.map((A,V)=>{const F=a||{},B=!A.condition||A.condition(F);return r.jsxs("button",{style:{...et.optionBtn,...c===V&&B?et.optionBtnHover:{},...B?{}:et.optionBtnDisabled},onMouseEnter:()=>m(V),onMouseLeave:()=>m(null),onClick:()=>{B&&C(A)},disabled:!B,"aria-disabled":!B,children:[r.jsx("span",{style:et.optionIcon,children:""}),r.jsx("span",{style:et.optionLabel,children:A.label})]},V)})})]}),((o==null?void 0:o.kind)==="COMBAT"||(o==null?void 0:o.kind)==="BOSS")&&r.jsxs("button",{style:{...et.fightBtn,...y==="fight"?et.fightBtnHover:{}},onMouseEnter:()=>S("fight"),onMouseLeave:()=>S(null),onClick:T,children:[r.jsx("span",{style:et.fightIcon,children:""}),r.jsx("span",{children:""})]})]}),r.jsx("div",{style:et.footer,children:r.jsx("button",{style:{...et.actionBtn,...et.exitBtn,...y==="exit"?et.exitBtnHover:{}},onMouseEnter:()=>S("exit"),onMouseLeave:()=>S(null),onClick:p,children:r.jsx("span",{children:""})})})]}),g&&r.jsx("div",{style:et.resultOverlay,children:r.jsxs("div",{style:et.resultBox,children:[r.jsx("div",{style:et.resultIcon,children:""}),r.jsx("div",{style:et.resultTitle,children:""}),r.jsx("div",{style:et.resultMessage,children:i&&i.length>0?i[i.length-1]:v}),r.jsx("button",{style:{...et.resultBtn,...y==="result"?et.resultBtnHover:{}},onMouseEnter:()=>S("result"),onMouseLeave:()=>S(null),onClick:j,children:""})]})}),r.jsx("style",{children:`
        @keyframes slideIn {
          from {
            opacity: 0;
            transform: translateY(-30px) scale(0.95);
          }
          to {
            opacity: 1;
            transform: translateY(0) scale(1);
          }
        }
        @keyframes fadeIn {
          from {
            opacity: 0;
            transform: translateX(-10px);
          }
          to {
            opacity: 1;
            transform: translateX(0);
          }
        }
        @keyframes popIn {
          0% {
            opacity: 0;
            transform: scale(0.8);
          }
          50% {
            transform: scale(1.05);
          }
          100% {
            opacity: 1;
            transform: scale(1);
          }
        }
        @keyframes bounce {
          0%, 100% {
            transform: translateY(0);
          }
          50% {
            transform: translateY(-10px);
          }
        }
      `})]})},et={overlay:{position:"fixed",top:0,left:0,right:0,bottom:0,background:"rgba(0, 0, 0, 0.75)",backdropFilter:"blur(4px)",zIndex:2100,display:"flex",alignItems:"center",justifyContent:"center",padding:"20px"},window:{width:"100%",maxWidth:"600px",background:"linear-gradient(to bottom, #ffffff, #f8f9fa)",borderRadius:"16px",boxShadow:"0 20px 60px rgba(0, 0, 0, 0.4)",overflow:"hidden",display:"flex",flexDirection:"column",maxHeight:"90vh"},header:{color:"#fff",padding:"16px 20px",position:"relative"},headerTop:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"12px"},realmTitle:{fontSize:"18px",fontWeight:"bold",textShadow:"0 2px 4px rgba(0,0,0,0.2)"},closeIconBtn:{background:"rgba(255,255,255,0.2)",border:"none",color:"#fff",width:"32px",height:"32px",borderRadius:"50%",cursor:"pointer",fontSize:"20px",display:"flex",alignItems:"center",justifyContent:"center",transition:"all 0.2s ease",":hover":{background:"rgba(255,255,255,0.3)"}},progressContainer:{position:"relative",background:"rgba(0,0,0,0.2)",height:"24px",borderRadius:"12px",overflow:"hidden"},progressBar:{height:"100%",transition:"width 0.5s ease",borderRadius:"12px",boxShadow:"inset 0 2px 4px rgba(0,0,0,0.1)"},progressText:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",fontSize:"13px",fontWeight:"bold",textShadow:"0 1px 2px rgba(0,0,0,0.3)"},body:{padding:"20px",flex:1,overflowY:"auto"},eventCard:{background:"#fff",borderRadius:"12px",padding:"16px",marginBottom:"16px",boxShadow:"0 2px 8px rgba(0,0,0,0.08)"},eventHeader:{display:"flex",alignItems:"center",gap:"10px",marginBottom:"10px"},eventBadge:{padding:"4px 12px",borderRadius:"12px",color:"#fff",fontSize:"11px",fontWeight:"bold",textTransform:"uppercase",letterSpacing:"0.5px"},eventTitle:{fontSize:"18px",fontWeight:"bold",color:"#1a202c",margin:0},eventDesc:{fontSize:"14px",color:"#4a5568",lineHeight:1.7,margin:0},optionsContainer:{marginBottom:"16px"},optionsLabel:{fontSize:"13px",fontWeight:"600",color:"#2d3748",marginBottom:"10px"},options:{display:"grid",gridTemplateColumns:"1fr",gap:"10px"},optionBtn:{display:"flex",alignItems:"center",gap:"10px",padding:"14px 16px",border:"2px solid #e2e8f0",borderRadius:"10px",background:"#fff",cursor:"pointer",fontSize:"14px",fontWeight:"500",color:"#2d3748",transition:"all 0.2s ease",textAlign:"left"},optionBtnHover:{border:"2px solid #4299e1",background:"#ebf8ff",transform:"translateX(4px)",boxShadow:"0 4px 12px rgba(66, 153, 225, 0.15)"},optionBtnDisabled:{borderColor:"#cbd5e1",background:"#f8fafc",color:"#94a3b8",cursor:"not-allowed",opacity:.7},optionIcon:{fontSize:"16px"},optionLabel:{flex:1},fightBtn:{width:"100%",display:"flex",alignItems:"center",justifyContent:"center",gap:"10px",padding:"16px",border:"none",borderRadius:"10px",background:"linear-gradient(135deg, #dc2626, #b91c1c)",color:"#fff",fontWeight:"bold",fontSize:"16px",cursor:"pointer",marginBottom:"16px",transition:"all 0.3s ease",boxShadow:"0 4px 12px rgba(220, 38, 38, 0.3)"},fightBtnHover:{transform:"translateY(-2px)",boxShadow:"0 6px 20px rgba(220, 38, 38, 0.4)"},fightIcon:{fontSize:"20px",animation:"pulse 1.5s ease-in-out infinite"},footer:{display:"flex",gap:"12px",padding:"16px 20px",background:"#fff",borderTop:"1px solid #e2e8f0"},actionBtn:{flex:1,display:"flex",alignItems:"center",justifyContent:"center",gap:"8px",padding:"14px 20px",border:"none",borderRadius:"10px",cursor:"pointer",fontWeight:"600",fontSize:"15px",transition:"all 0.2s ease"},exitBtn:{background:"#f1f5f9",color:"#475569",border:"1px solid #cbd5e1"},exitBtnHover:{background:"#e2e8f0",border:"1px solid #94a3b8"},resultOverlay:{position:"absolute",top:0,left:0,right:0,bottom:0,background:"rgba(0, 0, 0, 0.6)",backdropFilter:"blur(2px)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:10,borderRadius:"16px"},resultBox:{background:"linear-gradient(135deg, #ffffff, #f0f9ff)",borderRadius:"16px",padding:"32px",maxWidth:"400px",width:"90%",boxShadow:"0 20px 60px rgba(0, 0, 0, 0.3)",textAlign:"center",animation:"popIn 0.3s ease-out",border:"2px solid #3b82f6"},resultIcon:{fontSize:"48px",marginBottom:"16px",animation:"bounce 0.6s ease-in-out"},resultTitle:{fontSize:"20px",fontWeight:"bold",color:"#1e40af",marginBottom:"16px"},resultMessage:{fontSize:"15px",color:"#475569",lineHeight:1.8,marginBottom:"24px",padding:"16px",background:"rgba(59, 130, 246, 0.08)",borderRadius:"8px",border:"1px solid rgba(59, 130, 246, 0.2)"},resultBtn:{padding:"12px 32px",background:"linear-gradient(135deg, #3b82f6, #2563eb)",color:"#fff",border:"none",borderRadius:"8px",fontSize:"16px",fontWeight:"600",cursor:"pointer",transition:"all 0.2s ease",boxShadow:"0 4px 12px rgba(59, 130, 246, 0.3)"},resultBtnHover:{transform:"translateY(-2px)",boxShadow:"0 6px 20px rgba(59, 130, 246, 0.4)"}},$C=({event:e,onClose:t,onAssign:n})=>{var m,y,S,E;if(!e)return null;const{child:s,selectableSects:o=[],otherSectOptions:i=[],title:a,message:l}=e,[d,u]=b.useState(!1),p=w=>{if(typeof w.compatibility=="number")return w.compatibility;const g=w.sect||w;return wy(s,g)},c=w=>{if(w.admission&&w.admission.qualified===!1)return;const g=w.sect||w,h=w.predictedRank||"";n(s.id,g.id,h)};return r.jsx("div",{style:Wn.overlay,children:r.jsxs("div",{style:Wn.card,children:[r.jsx("h2",{children:a||""}),r.jsx("p",{style:{color:"#444"},children:l}),r.jsxs("div",{style:Wn.content,children:[r.jsxs("div",{style:Wn.childBox,children:[r.jsxs("h3",{children:[s.name," (",s.gender,")"]}),r.jsxs("p",{children:[": ",((m=s.stats)==null?void 0:m.aptitude)||0]}),r.jsxs("p",{children:[": ",r.jsx("strong",{style:{color:((y=s.spiritRoot)==null?void 0:y.color)||"#666"},children:((S=s.spiritRoot)==null?void 0:S.type)||""})]}),r.jsx("div",{style:{display:"flex",gap:6},children:(((E=s.spiritRoot)==null?void 0:E.elements)||[]).map(w=>r.jsx("span",{style:{padding:"4px 8px",background:"#eee",borderRadius:6},children:w},w))})]}),r.jsx("div",{style:Wn.listBox,children:o.map(w=>{var C;const g=w.sect||w,h=w.predictedRank,v=w.resources||[],x=w.admission||{},I=x.qualified!==!1,_=x.summary||x.notes||"",N=I?x.notes||"":((C=x.reasons)==null?void 0:C.join(""))||"";return r.jsxs("div",{style:Wn.sectRow,children:[r.jsxs("div",{children:[r.jsx("div",{style:{fontWeight:"bold"},children:g.name}),r.jsx("div",{style:{fontSize:12,color:"#666"},children:g.desc}),r.jsxs("div",{style:{fontSize:12,color:"#444",marginTop:6},children:[": ",v.join(", ")||""]}),r.jsxs("div",{style:{fontSize:12,color:"#888",marginTop:4},children:[": ",_]}),r.jsx("div",{style:{fontSize:12,color:I?"#1b5e20":"#a00"},children:N})]}),r.jsxs("div",{style:{textAlign:"right"},children:[r.jsxs("div",{style:{marginBottom:6},children:[": ",p(w)]}),r.jsxs("div",{style:{fontSize:12,color:"#333",marginBottom:6},children:[": ",h||""]}),r.jsx("button",{disabled:!I,onClick:()=>c(w),style:{...Wn.btn,opacity:I?1:.4,cursor:I?"pointer":"not-allowed"},children:I?"":""})]})]},g.id)})}),i.length>0&&r.jsxs("div",{style:{marginTop:12},children:[r.jsx("button",{onClick:()=>u(w=>!w),style:Wn.secondaryBtn,children:d?"":""}),d&&r.jsx("div",{style:Wn.otherList,children:i.map(w=>{var I;const g=w.sect||w,h=w.admission||{},v=h.qualified!==!1,x=((I=h.reasons)==null?void 0:I.join(""))||"";return r.jsxs("div",{style:Wn.otherRow,children:[r.jsxs("div",{children:[r.jsx("div",{style:{fontWeight:"bold"},children:g.name}),r.jsx("div",{style:{fontSize:12,color:"#666"},children:h.summary||g.desc}),r.jsx("div",{style:{fontSize:12,color:v?"#1b5e20":"#a00"},children:v?` ${p(w)}  `:`${x}`})]}),r.jsx("button",{disabled:!v,onClick:()=>c(w),style:{...Wn.btn,opacity:v?1:.35,cursor:v?"pointer":"not-allowed"},children:v?"":""})]},g.id)})})]})]}),r.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginTop:12},children:[r.jsx("button",{onClick:t,style:Wn.cancel,children:""}),r.jsx("p",{style:{fontSize:"11px",color:"#999",marginTop:"6px",marginLeft:"10px"},children:""})]})]})})},Wn={overlay:{position:"fixed",inset:0,background:"rgba(0,0,0,0.7)",display:"flex",justifyContent:"center",alignItems:"center",zIndex:500,padding:"10px",overflowY:"auto"},card:{width:"100%",maxWidth:"640px",background:"#fff",borderRadius:12,padding:"16px",maxHeight:"90vh",overflowY:"auto",margin:"auto"},content:{display:"flex",gap:12,flexDirection:window.innerWidth<=768?"column":"row"},childBox:{width:window.innerWidth<=768?"100%":"220px",padding:12,background:"#fafafa",borderRadius:8},listBox:{flex:1,display:"flex",flexDirection:"column",gap:8},sectRow:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:10,borderRadius:8,background:"#fff",boxShadow:"0 1px 4px rgba(0,0,0,0.05)",flexDirection:window.innerWidth<=480?"column":"row",gap:window.innerWidth<=480?"10px":"0"},btn:{padding:"8px 12px",background:"#3e2723",color:"white",border:"none",borderRadius:6,cursor:"pointer",fontSize:"clamp(12px, 3vw, 14px)",whiteSpace:"nowrap"},cancel:{padding:"8px 12px",background:"#ddd",border:"none",borderRadius:6,cursor:"pointer",fontSize:"clamp(12px, 3vw, 14px)"},secondaryBtn:{marginTop:8,padding:"6px 10px",background:"#f5f5f5",border:"1px solid #ccc",borderRadius:6,cursor:"pointer",fontSize:"clamp(12px, 3vw, 13px)"},otherList:{marginTop:10,display:"flex",flexDirection:"column",gap:8},otherRow:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"8px 10px",borderRadius:8,background:"#fafafa"}},Bi=[{id:1,title:"",content:`
      <p> </p>
      <p><strong></strong><strong></strong></p>
      <p><strong></strong></p>
      <br/>
      <p> <strong></strong></p>
      <ul>
        <li> </li>
        <li> </li>
        <li> </li>
        <li> </li>
      </ul>
    `},{id:2,title:"",content:`
      <p> <strong></strong></p>
      <br/>
      <p> <strong></strong></p>
      <ul>
        <li><strong> </strong>NPC</li>
        <li><strong> </strong></li>
        <li><strong> </strong></li>
        <li><strong> </strong></li>
        <li><strong> </strong></li>
        <li><strong> </strong></li>
      </ul>
    `},{id:3,title:"",content:`
      <p> <strong></strong></p>
      <br/>
      <p><strong></strong></p>
      <p><strong></strong>10%</p>
      <br/>
      <p> <strong></strong></p>
      <ul>
        <li> /10% </li>
        <li> 50% </li>
        <li> 100% </li>
      </ul>
      <br/>
      <p> <strong></strong></p>
      <ul>
        <li>></li>
        <li></li>
        <li></li>
      </ul>
    `},{id:4,title:"",content:`
      <p> <strong></strong></p>
      <br/>
      <p><strong></strong></p>
      <ul>
        <li></li>
        <li> <strong>100</strong> </li>
        <li><strong>""</strong></li>
      </ul>
      <br/>
      <p> <strong></strong></p>
      <ul>
        <li> HP()  ATK()</li>
        <li></li>
      </ul>
    `},{id:5,title:"",content:`
      <p> <strong></strong></p>
      <br/>
      <p> <strong></strong></p>
      <p></p>
      <br/>
      <p> <strong></strong></p>
      <ul>
        <li>NPC</li>
        <li> </li>
        <li>6</li>
        <li></li>
      </ul>
      <br/>
      <p style="text-align:center; color:#d32f2f; font-weight:bold;">
        
      </p>
    `}],BC=({onClose:e,onComplete:t})=>{const[n,s]=b.useState(0),o=()=>{n<Bi.length-1?s(n+1):(t&&t(),e())},i=()=>{t&&t(),e()},a=Bi[n],l=(n+1)/Bi.length*100;return r.jsx("div",{style:bn.overlay,children:r.jsxs("div",{style:bn.modal,children:[r.jsxs("div",{style:bn.header,children:[r.jsxs("div",{style:bn.headerContent,children:[r.jsxs("span",{style:bn.stepIndicator,children:[" ",n+1," / ",Bi.length]}),r.jsx("h3",{style:bn.title,children:a.title})]}),r.jsx("button",{onClick:i,style:bn.skipBtn,children:""})]}),r.jsx("div",{style:bn.progressBar,children:r.jsx("div",{style:{...bn.progressFill,width:`${l}%`}})}),r.jsx("div",{style:bn.content,children:r.jsx("div",{style:bn.contentText,dangerouslySetInnerHTML:{__html:a.content}})}),r.jsxs("div",{style:bn.footer,children:[n>0&&r.jsx("button",{onClick:()=>s(n-1),style:bn.prevBtn,children:""}),r.jsx("div",{style:{flex:1}}),r.jsx("button",{onClick:o,style:bn.nextBtn,children:n===Bi.length-1?"":""})]})]})})},bn={overlay:{position:"fixed",top:0,left:0,right:0,bottom:0,background:"rgba(0, 0, 0, 0.85)",zIndex:9999,display:"flex",alignItems:"center",justifyContent:"center",animation:"fadeIn 0.3s ease-in"},modal:{width:"90%",maxWidth:"550px",maxHeight:"85vh",background:"linear-gradient(135deg, #ffffff 0%, #f5f5f5 100%)",borderRadius:"16px",boxShadow:"0 20px 60px rgba(0,0,0,0.5)",display:"flex",flexDirection:"column",overflow:"hidden",border:"2px solid #d4af37"},header:{padding:"20px",background:"linear-gradient(135deg, #5d4037 0%, #3e2723 100%)",color:"#fff",display:"flex",justifyContent:"space-between",alignItems:"flex-start"},headerContent:{flex:1},stepIndicator:{display:"inline-block",background:"rgba(255, 255, 255, 0.2)",padding:"4px 12px",borderRadius:"12px",fontSize:"12px",marginBottom:"8px"},title:{margin:0,fontSize:"20px",fontWeight:"bold"},skipBtn:{background:"transparent",border:"1px solid rgba(255, 255, 255, 0.5)",color:"#fff",padding:"6px 12px",borderRadius:"4px",cursor:"pointer",fontSize:"13px",transition:"all 0.3s"},progressBar:{width:"100%",height:"4px",background:"#e0e0e0"},progressFill:{height:"100%",background:"linear-gradient(90deg, #d4af37 0%, #f4e4a6 100%)",transition:"width 0.3s ease"},content:{flex:1,padding:"30px",overflowY:"auto",fontSize:"14px",lineHeight:"1.8"},contentText:{color:"#333"},footer:{padding:"15px 20px",borderTop:"1px solid #e0e0e0",background:"#fff",display:"flex",justifyContent:"space-between",gap:"10px"},prevBtn:{padding:"10px 20px",background:"#9e9e9e",color:"#fff",border:"none",borderRadius:"6px",cursor:"pointer",fontSize:"14px",fontWeight:"bold",transition:"all 0.3s"},nextBtn:{padding:"10px 24px",background:"linear-gradient(135deg, #d4af37 0%, #f4e4a6 100%)",color:"#3e2723",border:"none",borderRadius:"6px",cursor:"pointer",fontSize:"14px",fontWeight:"bold",transition:"all 0.3s",boxShadow:"0 2px 8px rgba(212, 175, 55, 0.4)"}},El=[{id:"INTRO",title:"  ()",content:`
      <p><strong></strong><strong></strong></p>
      <p><strong></strong></p>
      <ul>
        <li><strong></strong></li>
        <li><strong></strong></li>
        <li><strong></strong><strong></strong></li>
        <li><strong></strong></li>
      </ul>
    `},{id:"FEEDBACK",title:"  ()",content:`
      <p><strong></strong></p>
      <div style="background:#eee; padding:10px; border-radius:5px; margin:10px 0;">
        <strong></strong><br/>
            <strong></strong>  <strong></strong>
      </div>
      <p><strong></strong></p>
      <ul>
        <li> <strong>/</strong> (10%)</li>
        <li> <strong></strong> (50%)</li>
        <li> <strong></strong> (100%)</li>
      </ul>
      
      <p><strong style="color:#D32F2F;"> ()</strong></p>
      <div style="background:#fff3e0; padding:12px; border-radius:5px; margin:10px 0; border-left: 4px solid #FF9800;">
        <p style="margin:0 0 8px 0;"><strong></strong></p>
        <ul style="margin:5px 0; padding-left:20px;">
          <li> <strong></strong>1.0 ()</li>
          <li> <strong></strong>1.5 (+50%)</li>
          <li> <strong></strong>3.0 (+200%)</li>
          <li> <strong></strong>6.0 (+500%)</li>
          <li> <strong></strong>12.0 (+1100%)</li>
          <li> <strong></strong>25.0 (+2400%)</li>
          <li> <strong></strong>100.0 (<strong style="color:#D32F2F;">+9900%</strong>)</li>
        </ul>
      </div>
      
      <p><strong></strong>""""100</p>
      <ol style="background:#f5f5f5; padding:12px; border-radius:5px;">
        <li></li>
        <li></li>
        <li><strong></strong></li>
        <li>""</li>
      </ol>
    `},{id:"COMBAT",title:" ",content:`
      <p><strong></strong><strong></strong></p>
      <ul>
        <li><strong></strong></li>
        <li><strong></strong> <strong>100</strong> </li>
        <li><strong></strong> <strong>HP()</strong>  <strong>ATK()</strong></li>
      </ul>
      <p><strong></strong><br/>1. <strong></strong><br/>2. </p>
    `},{id:"COMBAT_RULES",title:" ",content:`
      <p><strong></strong></p>
      <ul>
        <li><strong></strong></li>
        <li><strong></strong> <strong></strong> </li>
        <li><strong></strong></li>
      </ul>
      <div style="background:#fff3e0; padding:12px; border-radius:6px; margin:10px 0; border-left:4px solid #FF9800;">
        <strong></strong>
        <ul style="margin:6px 0 0 16px;">
          <li></li>
          <li></li>
          <li> 10</li>
        </ul>
        <p style="margin:8px 0 0 0;"><strong></strong><strong></strong></p>
      </div>
    `},{id:"ROOTS",title:" ",content:`
      <p>6</p>
      <ul>
        <li><span style="color:#FFD700"> (90-100)</span></li>
        <li><span style="color:#00BCD4"> (80-89)</span>//</li>
        <li><span style="color:#9C27B0">/</span></li>
        <li><span style="color:#9E9E9E">/</span></li>
      </ul>
    `}],OC=({onClose:e,initialTab:t=0})=>{const[n,s]=b.useState(t);return r.jsx("div",{style:Un.overlay,children:r.jsxs("div",{style:Un.modalWrapper,children:[r.jsx("button",{onClick:e,style:Un.closeBtn,"aria-label":"",children:""}),r.jsxs("div",{style:Un.modal,children:[r.jsx("div",{style:Un.header,children:r.jsx("h3",{children:" "})}),r.jsxs("div",{style:Un.body,children:[r.jsx("div",{style:Un.sidebar,children:El.map((o,i)=>r.jsx("div",{onClick:()=>s(i),style:{...Un.menuItem,background:n===i?"#e0e0e0":"transparent",fontWeight:n===i?"bold":"normal",color:n===i?"#3e2723":"#666"},children:o.title},o.id))}),r.jsxs("div",{style:Un.content,children:[r.jsx("h4",{style:{marginTop:0,borderBottom:"1px solid #eee",paddingBottom:"10px"},children:El[n].title}),r.jsx("div",{style:{lineHeight:"1.6",fontSize:"14px",color:"#444"},dangerouslySetInnerHTML:{__html:El[n].content}})]})]}),r.jsx("div",{style:Un.footer,children:n<El.length-1?r.jsx("button",{onClick:()=>s(n+1),style:Un.nextBtn,children:""}):r.jsx("button",{onClick:e,style:Un.finishBtn,children:""})})]})]})})},Un={overlay:{position:"fixed",top:0,left:0,right:0,bottom:0,background:"rgba(0,0,0,0.7)",zIndex:3e3,display:"flex",alignItems:"center",justifyContent:"center"},modalWrapper:{position:"relative",width:"min(600px, calc(100vw - 32px))"},modal:{width:"100%",height:"450px",background:"#fff",borderRadius:"12px",display:"flex",flexDirection:"column",overflow:"hidden",boxShadow:"0 10px 30px rgba(0,0,0,0.3)",position:"relative"},header:{padding:"15px 20px",background:"#3e2723",color:"#fff",display:"flex",justifyContent:"center",alignItems:"center"},closeBtn:{position:"absolute",top:"-18px",left:"-18px",background:"#3e2723",border:"none",color:"#fff",fontSize:"22px",cursor:"pointer",width:"44px",height:"44px",display:"flex",alignItems:"center",justifyContent:"center",borderRadius:"22px",boxShadow:"0 12px 30px rgba(0,0,0,0.25)"},body:{flex:1,display:"flex",overflow:"hidden"},sidebar:{width:"180px",background:"#f5f5f5",borderRight:"1px solid #ddd",overflowY:"auto"},menuItem:{padding:"15px",cursor:"pointer",borderBottom:"1px solid #eee",fontSize:"13px"},content:{flex:1,padding:"20px",overflowY:"auto"},footer:{padding:"10px 20px",borderTop:"1px solid #eee",display:"flex",justifyContent:"flex-end",background:"#fafafa"},nextBtn:{padding:"8px 20px",background:"#2196f3",color:"white",border:"none",borderRadius:"4px",cursor:"pointer"},finishBtn:{padding:"8px 20px",background:"#4caf50",color:"white",border:"none",borderRadius:"4px",cursor:"pointer"}},PC=({gazette:e,onClose:t,history:n=[],playerName:s="",onWorldNpcClick:o})=>{var y;const[i,a]=b.useState("current"),[l,d]=b.useState(null);console.log("GazetteModal props:",{gazette:e,history:n,hasGazette:!!e,historyLength:n.length});const u=S=>{if(!S||!s)return S;const E=new RegExp(`(${s})`,"g");return S.split(E).map((g,h)=>g===s?r.jsx("span",{style:{color:"#b33",fontWeight:"bold"},children:g},h):g)};b.useEffect(()=>{!e&&n.length>0&&a("history")},[e,n]);const c=(i==="current"?e:l)||{issue:"-",year:0,month:"-",headlines:[],powerRanking:[],sectRanking:[],rumors:[]},m=!e&&n.length===0;return r.jsx("div",{style:_e.overlay,children:r.jsxs("div",{style:_e.modalWrapper,children:[r.jsx("button",{onClick:t,style:_e.closeBtn,"aria-label":"",children:""}),r.jsx("div",{style:_e.modal,children:m?r.jsxs("div",{style:_e.emptyState,children:[r.jsx("div",{style:_e.emptyIcon,children:""}),r.jsx("h3",{style:_e.emptyTitle,children:""}),r.jsx("p",{style:_e.emptyText,children:"36912"}),r.jsx("button",{onClick:t,style:_e.emptyBtn,children:""})]}):r.jsxs(r.Fragment,{children:[r.jsxs("div",{style:_e.tabBar,children:[r.jsx("button",{onClick:()=>a("current"),style:{..._e.tab,background:i==="current"?we.colors.primary:we.colors.parchment,color:i==="current"?"#fff":we.colors.ink,opacity:e?1:.5,cursor:e?"pointer":"not-allowed"},disabled:!e,children:" "}),r.jsxs("button",{onClick:()=>a("history"),style:{..._e.tab,background:i==="history"?we.colors.primary:we.colors.parchment,color:i==="history"?"#fff":we.colors.ink},children:["  (",n.length,")"]})]}),r.jsx("div",{style:_e.content,children:i==="current"?r.jsxs("div",{style:_e.newspaper,children:[r.jsxs("div",{style:_e.header,children:[r.jsx("h1",{style:_e.title,children:""}),r.jsxs("div",{style:_e.subtitle,children:["   ",c.issue," "]}),r.jsxs("div",{style:_e.date,children:[" ",c.year," ",c.month,""]})]}),c.powerRanking&&c.powerRanking.length>0&&r.jsxs("div",{style:_e.section,children:[r.jsx("h3",{style:_e.sectionTitle,children:" - "}),r.jsx("div",{style:_e.ranking,children:c.powerRanking.map((S,E)=>{const w=typeof S=="string"?S:S.displayText,g=typeof S=="object"&&S.worldNpcData&&!S.isPlayer;return r.jsx("div",{style:{..._e.rankItem,...g?_e.clickableRankItem:{}},onClick:()=>{g&&o&&o(S.worldNpcData)},children:w},E)})})]}),c.sectRanking&&c.sectRanking.length>0&&r.jsxs("div",{style:_e.section,children:[r.jsx("h3",{style:_e.sectionTitle,children:" - "}),r.jsx("div",{style:_e.ranking,children:c.sectRanking.map((S,E)=>{const w=typeof S=="string"?S:S.displayText,g=typeof S=="object"&&S.worldNpcData;return r.jsxs("div",{style:{..._e.rankItem,...g?_e.clickableRankItem:{}},onClick:()=>{g&&o&&o(S.worldNpcData)},children:[r.jsx("div",{children:w}),g&&r.jsx("div",{style:_e.clickHint,children:""})]},E)})})]}),r.jsxs("div",{style:_e.section,children:[r.jsx("h3",{style:_e.sectionTitle,children:""}),r.jsx("div",{style:_e.newsContent,children:c.headlines&&c.headlines.length>0?c.headlines.map((S,E)=>r.jsxs("p",{style:_e.newsItem,children:[" ",u(S)]},E)):r.jsx("p",{style:_e.placeholder,children:""})})]}),c.rumors&&c.rumors.length>0&&r.jsxs("div",{style:_e.section,children:[r.jsx("h3",{style:_e.sectionTitle,children:""}),r.jsx("div",{style:_e.newsContent,children:c.rumors.map((S,E)=>r.jsxs("p",{style:_e.newsItem,children:[" ",u(S)]},E))})]}),r.jsxs("div",{style:_e.adSection,children:[r.jsx("div",{style:_e.ad,children:" "}),r.jsx("div",{style:_e.ad,children:" "})]})]}):r.jsx("div",{style:_e.historyView,children:n.length===0?r.jsx("div",{style:_e.emptyHistory,children:""}):l?r.jsxs("div",{children:[r.jsx("button",{onClick:()=>d(null),style:_e.backBtn,children:" "}),r.jsxs("div",{style:_e.newspaper,children:[r.jsxs("div",{style:_e.header,children:[r.jsx("h1",{style:_e.title,children:""}),r.jsxs("div",{style:_e.subtitle,children:[" ",l.issue," "]}),r.jsxs("div",{style:_e.date,children:[" ",l.year," ",l.month,""]})]}),l.powerRanking&&l.powerRanking.length>0&&r.jsxs("div",{style:_e.section,children:[r.jsx("h3",{style:_e.sectionTitle,children:" - "}),r.jsx("div",{style:_e.ranking,children:l.powerRanking.map((S,E)=>r.jsx("div",{style:_e.rankItem,children:typeof S=="string"?S:S.displayText},E))})]}),l.sectRanking&&l.sectRanking.length>0&&r.jsxs("div",{style:_e.section,children:[r.jsx("h3",{style:_e.sectionTitle,children:" - "}),r.jsx("div",{style:_e.ranking,children:l.sectRanking.map((S,E)=>r.jsx("div",{style:_e.rankItem,children:typeof S=="string"?S:S.displayText},E))})]}),r.jsxs("div",{style:_e.section,children:[r.jsx("h3",{style:_e.sectionTitle,children:""}),r.jsx("div",{style:_e.newsContent,children:(y=l.headlines)==null?void 0:y.map((S,E)=>r.jsxs("p",{style:_e.newsItem,children:[" ",S]},E))})]})]})]}):r.jsx("div",{style:_e.historyList,children:n.map((S,E)=>r.jsxs("div",{style:_e.historyItem,onClick:()=>d(S),children:[r.jsxs("div",{style:_e.historyTitle,children:[" ",S.issue," "]}),r.jsxs("div",{style:_e.historyDate,children:[Math.floor(S.year)," ",S.month,""]})]},E))})})})]})})]})})},_e={overlay:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0, 0, 0, 0.7)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e3},modalWrapper:{position:"relative",width:"min(800px, calc(100vw - 32px))"},modal:{background:we.gradients.warm,borderRadius:"16px",maxWidth:"800px",width:"100%",maxHeight:"85vh",overflow:"hidden",position:"relative",boxShadow:"0 8px 32px rgba(0,0,0,0.3)",border:`3px solid ${we.colors.border}`},clickHint:{fontSize:"12px",color:"#8d6e63",marginTop:"4px"},closeBtn:{position:"absolute",top:"-20px",left:"-20px",width:"48px",height:"48px",borderRadius:"50%",border:"none",background:"#b33",color:"white",fontSize:"24px",cursor:"pointer",boxShadow:"0 12px 32px rgba(0,0,0,0.25)",fontWeight:"bold"},tabBar:{display:"flex",gap:"10px",padding:"15px 20px",borderBottom:`2px solid ${we.colors.border}`},tab:{padding:"10px 20px",border:"none",borderRadius:"8px",cursor:"pointer",fontWeight:"bold",fontSize:"14px",transition:"all 0.3s"},content:{padding:"20px",maxHeight:"calc(85vh - 100px)",overflowY:"auto"},newspaper:{background:we.colors.paper,padding:"30px",borderRadius:"8px",boxShadow:`inset 0 0 20px ${we.colors.shadow}`,fontFamily:'"Noto Serif SC", "KaiTi", serif'},header:{textAlign:"center",borderBottom:`3px double ${we.colors.border}`,paddingBottom:"20px",marginBottom:"25px"},title:{fontSize:"36px",color:we.colors.primary,margin:"0 0 10px 0",letterSpacing:"8px",textShadow:"2px 2px 4px rgba(0,0,0,0.1)"},subtitle:{fontSize:"14px",color:we.colors.primary,marginBottom:"5px"},date:{fontSize:"12px",color:we.colors.muted},section:{marginBottom:"25px",padding:"15px",background:we.gradients.subtle,borderRadius:"8px",border:`1px solid ${we.colors.border}`},sectionTitle:{fontSize:"20px",color:we.colors.primary,marginBottom:"15px",borderBottom:`2px solid ${we.colors.border}`,paddingBottom:"8px"},ranking:{display:"flex",flexDirection:"column",gap:"10px"},rankItem:{fontSize:"16px",padding:"8px",background:we.colors.paper,borderRadius:"4px",border:`1px solid ${we.colors.border}`},clickableRankItem:{cursor:"pointer",transition:"all 0.3s",":hover":{background:we.gradients.subtle,transform:"translateX(5px)",borderColor:we.colors.primary}},newsContent:{fontSize:"15px",lineHeight:"1.8",color:we.colors.ink},newsItem:{margin:"10px 0",paddingLeft:"15px",textIndent:"0"},placeholder:{color:"#999",fontStyle:"italic",textAlign:"center"},adSection:{marginTop:"30px",padding:"15px",background:we.gradients.subtle,borderRadius:"8px",border:`2px dashed ${we.colors.border}`},ad:{fontSize:"12px",color:we.colors.primary,marginBottom:"5px"},historyView:{minHeight:"400px"},historyList:{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(150px, 1fr))",gap:"15px"},historyItem:{padding:"20px",background:we.colors.paper,borderRadius:"8px",border:`2px solid ${we.colors.border}`,cursor:"pointer",textAlign:"center",transition:"all 0.3s",":hover":{transform:"translateY(-5px)",boxShadow:`0 4px 12px ${we.colors.shadow}`}},historyTitle:{fontSize:"16px",fontWeight:"bold",color:we.colors.primary,marginBottom:"8px"},historyDate:{fontSize:"12px",color:we.colors.primary},emptyHistory:{textAlign:"center",padding:"50px",color:"#999",fontSize:"16px"},backBtn:{marginBottom:"15px",padding:"8px 16px",background:"#8d6e63",color:"white",border:"none",borderRadius:"8px",cursor:"pointer",fontWeight:"bold"},emptyState:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",padding:"80px 40px",minHeight:"400px"},emptyIcon:{fontSize:"80px",marginBottom:"20px",opacity:.5},emptyTitle:{fontSize:"24px",color:we.colors.primary,marginBottom:"10px"},emptyText:{fontSize:"14px",color:we.colors.muted,textAlign:"center",lineHeight:"1.6",marginBottom:"30px"},emptyBtn:{padding:"10px 30px",background:we.colors.primary,color:"white",border:"none",borderRadius:"8px",cursor:"pointer",fontSize:"14px",fontWeight:"bold",transition:"all 0.3s"}},zC=({worldNpc:e,onClose:t,onInvite:n,onChallenge:s,player:o})=>{var _,N,C;if(!e)return null;const[i,a]=b.useState(""),[l,d]=b.useState(""),[u,p]=b.useState(!1),c=j=>j==="male"||j===""?"":j==="female"||j===""?"":j,m=j=>j?typeof j=="string"?j:typeof j=="object"&&j.name?j.name:"":"",y=()=>{var T;if((T=e.appearance)!=null&&T.description&&typeof e.appearance.description=="string")return e.appearance.description;if(e.gender==="female"||e.gender===""){const A=["","","","",""];return A[Math.floor(Math.random()*A.length)]}else{const A=["","","","",""];return A[Math.floor(Math.random()*A.length)]}},S=b.useMemo(()=>y(),[e==null?void 0:e.id]),E=j=>{if(!j)return"";if(typeof j=="string")return j;if(typeof j=="object"){if(j.label)return j.label;if(j.desc)return j.desc;const T=[j.temperament,j.alignment,j.attitude].filter(Boolean);return T.length>0?T[0]:""}return""},w=j=>{if(!j)return"";const T=j.rootType||j.type;return T||(Array.isArray(j.elements)&&j.elements.length>0?j.elements.map(A=>typeof A=="object"?A.element:A).join("")+"":"")},g=(j,T)=>{if(typeof j!="number")return"";const A=T==="female"||T==="";return j>=90?A?"":"":j>=80?A?"":"":j>=70?A?"":"":j>=60?"":""},h=b.useMemo(()=>e!=null&&e.id?`tianji_profile_${e.id}`:"",[e==null?void 0:e.id]),v=()=>{var ae;const j=e.name||"",T=e.title||"",A=e.tier||"",V=m(e.sect),F=e.sectRank?`${V}${e.sectRank}`:null,B=w(e.spiritRoot),$=E(e.personality);g((ae=e.stats)==null?void 0:ae.looks,e.gender);const Y=S,ne=V===""?"":F||`${V}`,X=`${j}${A}${ne}${T}${B}${Y}${$}${e.signature||""}`,ee=`${j}${T}${A}${ne}${B}${V===""?"":V}${$}"${e.signature||""}"`;return{summary:X,bio:ee}},x=(j,T)=>{if(!j)return T;const A=j.match(/\{[\s\S]*\}/);if(A)try{const F=JSON.parse(A[0]);if(F&&(F.summary||F.bio))return{summary:F.summary||T.summary,bio:F.bio||T.bio}}catch{}const V=j.split(`
`).map(F=>F.trim()).filter(Boolean);if(V.length>=2){const F=V[0].replace(/^[:]\s*/,""),B=V.slice(1).join(`
`).replace(/^[:]\s*/,"");return{summary:F||T.summary,bio:B||T.bio}}return{summary:j.trim().slice(0,80)||T.summary,bio:T.bio}};b.useEffect(()=>{var $;if(!e)return;const j=v();try{if(h){const Y=localStorage.getItem(h);if(Y){const ne=JSON.parse(Y);if(ne!=null&&ne.summary&&ne.summary.includes(e.name)){a(ne.summary||j.summary),d(ne.bio||j.bio);return}}}}catch{}if(a(j.summary),d(j.bio),!(localStorage.getItem("useAIForTianjiProfile")!=="false")){try{h&&localStorage.setItem(h,JSON.stringify(j))}catch{}return}const A=localStorage.getItem("game_api_key")||"",V=localStorage.getItem("game_api_url")||"",F=localStorage.getItem("game_api_model")||"deepseek-chat";if(!A||!V)return;const B={name:e.name,title:e.title||"",tier:e.tier,sect:m(e.sect),spiritRoot:w(e.spiritRoot),personality:E(e.personality),appearance:S,looks:(($=e.stats)==null?void 0:$.looks)||0,signature:e.signature||""};p(!0),Yc([{role:"system",content:`""""JSON{"summary":"...","bio":"..."}80160


1. nametitletier
2. name
3. """"
4. 
5. 
6. `},{role:"user",content:`
${B.name}
${B.title}
${B.tier}
${B.sect}
${B.spiritRoot}
${B.personality}
${B.appearance}
${B.signature}


1. "${B.name}${B.tier}""${B.title}"
2. 
3. 
4. `}],A,V,{model:F,temperature:.7,maxTokens:260}).then(Y=>{const ne=x(Y,j),X=ne.summary.includes(e.name)?ne.summary:j.summary,ee=ne.bio.includes(e.name)?ne.bio:j.bio;a(X),d(ee);try{h&&localStorage.setItem(h,JSON.stringify({summary:X,bio:ee}))}catch{}}).catch(()=>{a(j.summary),d(j.bio)}).finally(()=>p(!1))},[e,h]),e.gender!==o.gender&&e.hasMetPlayer;const I=e.sectRank===""&&e.status!=="DEAD";return r.jsx("div",{style:Ue.overlay,onClick:t,children:r.jsxs("div",{style:Ue.modalWrapper,onClick:j=>j.stopPropagation(),children:[r.jsx("button",{onClick:t,style:Ue.closeBtn,"aria-label":"",children:""}),r.jsxs("div",{style:Ue.modal,children:[r.jsxs("div",{style:Ue.header,children:[r.jsxs("h2",{style:Ue.title,children:[e.title&&`${e.title}`,e.name]}),r.jsxs("div",{style:Ue.subtitle,children:["  ",e.tier,"  ",c(e.gender)]})]}),r.jsxs("div",{style:Ue.content,children:[r.jsxs("div",{style:Ue.section,children:[r.jsx("h3",{style:Ue.sectionTitle,children:" "}),r.jsxs("div",{style:Ue.infoGrid,children:[r.jsx(_s,{label:"",value:e.name}),r.jsx(_s,{label:"",value:e.title||""}),r.jsx(_s,{label:"",value:c(e.gender)}),r.jsx(_s,{label:"",value:e.tier}),r.jsx(_s,{label:"",value:m(e.sect)}),e.sectRank&&r.jsx(_s,{label:"",value:e.sectRank}),r.jsx(_s,{label:"",value:((_=e.spiritRoot)==null?void 0:_.rootType)||((N=e.spiritRoot)==null?void 0:N.type)||""})]})]}),r.jsxs("div",{style:Ue.section,children:[r.jsx("h3",{style:Ue.sectionTitle,children:" "}),r.jsx("div",{style:Ue.statsGrid,children:e.stats&&Object.entries(e.stats).map(([j,T])=>r.jsxs("div",{style:Ue.statItem,children:[r.jsx("span",{style:Ue.statLabel,children:DC(j)}),r.jsx("span",{style:Ue.statValue,children:Math.floor(T)})]},j))})]}),r.jsxs("div",{style:Ue.section,children:[r.jsx("h3",{style:Ue.sectionTitle,children:" "}),r.jsx("p",{style:Ue.description,children:S})]}),r.jsxs("div",{style:Ue.section,children:[r.jsx("h3",{style:Ue.sectionTitle,children:" "}),r.jsx("p",{style:Ue.description,children:i||""}),u&&r.jsx("div",{style:Ue.hintText,children:"AI "})]}),r.jsxs("div",{style:Ue.section,children:[r.jsx("h3",{style:Ue.sectionTitle,children:" "}),r.jsx("p",{style:Ue.description,children:l||""}),r.jsx("p",{style:Ue.hintText,children:"/ AI "})]}),e.personality&&typeof e.personality=="string"&&r.jsxs("div",{style:Ue.section,children:[r.jsx("h3",{style:Ue.sectionTitle,children:" "}),r.jsx("p",{style:Ue.description,children:e.personality})]}),((C=e.spiritRoot)==null?void 0:C.elements)&&Array.isArray(e.spiritRoot.elements)&&r.jsxs("div",{style:Ue.section,children:[r.jsx("h3",{style:Ue.sectionTitle,children:" "}),r.jsx("div",{style:Ue.elementsGrid,children:e.spiritRoot.elements.map((j,T)=>r.jsx("div",{style:Ue.elementTag,children:typeof j=="object"?`${j.element} ${j.value}`:j},T))})]}),e.gender!==o.gender&&!e.hasMetPlayer&&(e.gender==="male"||e.gender==="")&&r.jsxs("div",{style:Ue.hintBox,children:[r.jsx("div",{style:Ue.hintIcon,children:""}),r.jsx("p",{style:Ue.hintText,children:""})]}),e.hasMetPlayer&&r.jsx("div",{style:Ue.metHint,children:" "}),I&&r.jsxs("div",{style:Ue.actionSection,children:[r.jsx("button",{style:Ue.challengeBtn,onClick:()=>s&&s(e),children:" "}),r.jsx("div",{style:Ue.hintText,children:""})]})]})]})]})})},_s=({label:e,value:t})=>{const n=typeof t=="object"&&t!==null?JSON.stringify(t):t??"";return r.jsxs("div",{style:Ue.infoItem,children:[r.jsxs("span",{style:Ue.infoLabel,children:[e,""]}),r.jsx("span",{style:Ue.infoValue,children:n})]})},DC=e=>({attack:"",defense:"",speed:"",hp:"",cultivation:"",atk:"",def:"",spd:"",maxHp:"",aptitude:"",looks:"",intelligence:"",health:""})[e]||e,Ue={overlay:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0, 0, 0, 0.7)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:2e3},modalWrapper:{position:"relative",width:"min(600px, calc(100vw - 32px))",maxHeight:"85vh"},modal:{background:we.gradients.warm,borderRadius:"16px",width:"100%",maxHeight:"85vh",overflow:"hidden",boxShadow:"0 8px 32px rgba(0,0,0,0.3)",border:`3px solid ${we.colors.border}`},closeBtn:{position:"absolute",top:"-20px",right:"-20px",width:"48px",height:"48px",borderRadius:"50%",border:"none",background:"#b33",color:"white",fontSize:"24px",cursor:"pointer",boxShadow:"0 4px 12px rgba(0,0,0,0.3)",fontWeight:"bold",zIndex:1},header:{textAlign:"center",padding:"25px 20px",background:"linear-gradient(135deg, #8d6e63 0%, #6d4c41 100%)",color:"white",borderBottom:`3px solid ${we.colors.border}`},title:{fontSize:"24px",margin:"0 0 8px 0",fontWeight:"bold",textShadow:"2px 2px 4px rgba(0,0,0,0.3)"},subtitle:{fontSize:"14px",opacity:.9},content:{padding:"20px",maxHeight:"calc(85vh - 120px)",overflowY:"auto"},section:{marginBottom:"20px",padding:"15px",background:we.colors.paper,borderRadius:"8px",border:`1px solid ${we.colors.border}`},sectionTitle:{fontSize:"16px",color:we.colors.primary,marginBottom:"12px",paddingBottom:"8px",borderBottom:`2px solid ${we.colors.border}`},infoGrid:{display:"grid",gridTemplateColumns:"repeat(2, 1fr)",gap:"10px"},infoItem:{fontSize:"14px",padding:"5px"},infoLabel:{color:"#666",marginRight:"5px"},infoValue:{color:we.colors.ink,fontWeight:"bold"},statsGrid:{display:"grid",gridTemplateColumns:"repeat(3, 1fr)",gap:"10px"},statItem:{display:"flex",flexDirection:"column",alignItems:"center",padding:"10px",background:we.gradients.subtle,borderRadius:"6px"},statLabel:{fontSize:"12px",color:"#666",marginBottom:"5px"},statValue:{fontSize:"18px",fontWeight:"bold",color:we.colors.primary},description:{fontSize:"14px",lineHeight:"1.6",color:we.colors.ink},elementsGrid:{display:"flex",flexWrap:"wrap",gap:"8px"},elementTag:{padding:"6px 12px",background:"linear-gradient(135deg, #fff9e6 0%, #ffe5b4 100%)",border:"1px solid #d4a574",borderRadius:"12px",fontSize:"13px",fontWeight:"bold",color:"#8d6e63"},hintBox:{textAlign:"center",padding:"20px",background:"linear-gradient(135deg, #fff9e6 0%, #ffe5b4 100%)",borderRadius:"12px",border:"2px dashed #d4a574"},hintIcon:{fontSize:"32px",marginBottom:"10px"},hintText:{fontSize:"14px",color:"#8d6e63",lineHeight:"1.6",margin:0},metHint:{textAlign:"center",padding:"15px",background:"#e8f5e9",border:"1px solid #81c784",borderRadius:"8px",color:"#2e7d32",fontSize:"14px",fontWeight:"bold"},actionSection:{marginTop:"12px",display:"flex",flexDirection:"column",gap:"8px"},challengeBtn:{padding:"10px 14px",borderRadius:"10px",border:"none",background:"linear-gradient(135deg, #d84315, #ff7043)",color:"#fff",fontWeight:"bold",cursor:"pointer",boxShadow:"0 6px 14px rgba(216, 67, 21, 0.25)"}},FC=({selectedNpc:e,setSelectedNpc:t,handleOptionSelect:n,player:s,visibleChildren:o,visibleNpcs:i,activeNpcs:a,modalMgr:l,addLog:d,showResult:u,cutTiesWithNpc:p,handleToggleNpcLetterAcceptance:c,messages:m,messageManager:y,setMessages:S,handleSendMessageReply:E,combatData:w,handleCombatClose:g,isExploring:h,exploreRealmState:v,exploreProgress:x,currentExploreEvent:I,exploreLog:_,inventory:N,setExploreLog:C,handleExplorationOption:j,handleStartCombat:T,setExploreProgress:A,setCurrentExploreEvent:V,setIsExploring:F,getBossEvent:B,getRandomExplorationEvent:$,pendingSectChoices:Y,setPendingSectChoices:ne,handleAssignSect:X,handleCloseTutorial:ee,handleCompleteTutorial:ae,handleCloseGuide:Te,currentGazette:Be,setSelectedWorldNpc:ze,selectedWorldNpc:W,handleInviteWorldNpc:J,handleChallengeWorldNpc:fe})=>{var re;return r.jsxs(r.Fragment,{children:[e&&r.jsx(HE,{npc:e,onClose:()=>t(null),onOptionSelect:n,player:s,children:o,npcs:i,onViewLog:ce=>l.openNpcLog(ce),onCutTies:ce=>{const Ce=a.find(Ge=>Ge.id===ce);Ce&&(p(ce),t(null),d(`  ${Ce.name} `),u("",` ${Ce.name} `,!0))},onToggleLetterAcceptance:c}),l.npcLogModal.open&&l.npcLogModal.npc&&r.jsx(MC,{npc:l.npcLogModal.npc,playerAffection:((re=l.npcLogModal.npc.relationship)==null?void 0:re.affection)||0,onClose:()=>l.closeNpcLog()}),r.jsx(t5,{isOpen:l.showMessageCenter,onClose:()=>l.closeMessageCenter(),messages:m,onMarkAsRead:ce=>{y.markAsRead(ce),S(y.getAllMessages())},onDeleteMessage:ce=>{y.deleteMessage(ce),S(y.getAllMessages())},onSendReply:E}),w&&r.jsx(AC,{player:s,enemy:w.enemy,result:w.result,onClose:g}),h&&r.jsx(LC,{open:h,realmName:v.name,progress:x,total:v.total,event:I,log:_,optionContext:{player:s,inventory:N,realmId:v.id,progress:x},onSelectOption:j,onStartCombat:T,onNext:()=>{if(x>=v.total){C(Ge=>[...Ge,""]),F(!1),u("","",!0,null,!1);return}const ce=x+1;A(ce);const Ce=ce===v.total?B(v.id):$({realmId:v.id,progress:ce});V(Ce),C(Ge=>[...Ge,` (${ce}/${v.total})`])},onClose:()=>{F(!1),C(ce=>[...ce,""])}}),Y.length>0&&r.jsx($C,{event:Y[0],onClose:()=>ne(ce=>ce.slice(1)),onAssign:X}),l.showTutorial&&r.jsx(BC,{onClose:ee,onComplete:ae}),l.showGuide&&r.jsx(OC,{onClose:Te}),l.showGazette&&r.jsx(PC,{gazette:Be,history:s.gazetteHistory||[],playerName:s.name,onClose:()=>l.closeGazette(),onWorldNpcClick:ce=>{ze(ce)}}),W&&r.jsx(zC,{worldNpc:W,player:s,onClose:()=>ze(null),onInvite:J,onChallenge:fe})]})};class HC extends Ic.Component{constructor(n){super(n);I0(this,"handleReset",()=>{this.setState({hasError:!1,error:null,errorInfo:null})});this.state={hasError:!1,error:null,errorInfo:null}}static getDerivedStateFromError(n){return{hasError:!0}}componentDidCatch(n,s){console.error("[] :",n),console.error("[] :",s),this.setState({error:n,errorInfo:s})}render(){var n;return this.state.hasError?r.jsxs("div",{style:{padding:"20px",margin:"20px",backgroundColor:"#ffebee",border:"2px solid #f44336",borderRadius:"8px",textAlign:"center",fontFamily:"Arial, sans-serif"},children:[r.jsx("h2",{style:{color:"#c62828",margin:"0 0 12px 0"},children:" "}),r.jsx("p",{style:{color:"#d32f2f",margin:"8px 0",fontSize:"14px"},children:((n=this.state.error)==null?void 0:n.message)||""}),!1,r.jsx("button",{onClick:this.handleReset,style:{marginTop:"12px",padding:"8px 16px",backgroundColor:"#2196f3",color:"#fff",border:"none",borderRadius:"4px",cursor:"pointer",fontSize:"14px",fontWeight:"bold"},children:" "})]}):this.props.children}}const WC=({options:e,currentSort:t,onSortChange:n})=>{const s=o=>{typeof n=="function"?n(o):console.warn("SortBar: onSortChange is not a function",{onSortChange:n,value:o})};return r.jsxs("div",{style:Oi.container,children:[r.jsx("span",{style:Oi.label,children:" :"}),r.jsx("div",{style:Oi.buttonGroup,children:e.map(o=>r.jsx("button",{type:"button",onClick:()=>s(o.value),style:{...Oi.button,...t===o.value?Oi.buttonActive:{}},children:o.label},o.value))})]})},Oi={container:{display:"flex",alignItems:"center",justifyContent:"flex-end",padding:"5px 10px",marginBottom:"10px",background:"#f5f5f5",borderRadius:"4px",fontSize:"12px"},label:{color:"#666",marginRight:"8px",fontWeight:"bold"},buttonGroup:{display:"flex",gap:"6px",flexWrap:"wrap"},button:{border:"1px solid #ccc",borderRadius:"999px",padding:"4px 10px",fontSize:"12px",cursor:"pointer",backgroundColor:"white",color:"#333",transition:"all 0.2s ease"},buttonActive:{backgroundColor:"#1976d2",color:"#fff",borderColor:"#1976d2",boxShadow:"0 2px 6px rgba(25,118,210,0.4)"}};function UC({player:e,inventory:t,children:n,exploreRealmState:s,exploreProgress:o,exploreTeamIds:i,setPlayer:a,setExploreLog:l,setCombatData:d,addNpc:u,addItemsToInventory:p,inventoryMgr:c,calculateDynamicCombatStats:m,simulateCombat:y,generateRealmEnemy:S}){const E=b.useCallback(()=>{var N,C;const _=Af(e);if(!_.canExplore){if(((N=e.stats)==null?void 0:N.health)<20)return l(j=>[...j,` ${Math.floor(e.stats.health)}/100`]),!1;((C=e.stats)==null?void 0:C.health)<30&&l(j=>[...j,` 30${Math.floor(e.stats.health)}/100`])}return _.canExplore},[e,l]),w=b.useCallback(_=>{if(!E())return;const N={player:e,inventory:t,realmId:s.id,progress:o};if(_.condition&&!_.condition(N)){l(j=>[...j,""]);return}const C=_.action?_.action(N):{type:"LOG",msg:""};switch(typeof C.spiritStonesDelta=="number"&&C.spiritStonesDelta!==0&&a(j=>{var T;return{...j,resources:{...j.resources,spiritStones:Math.max(0,(((T=j.resources)==null?void 0:T.spiritStones)||0)+C.spiritStonesDelta)}}}),C.type){case"START_COMBAT":g();break;case"LOOT":h(C);break;case"NPC_JOIN":v(C);break;case"HP_CHANGE":x(C);break;case"EXP_GAIN":I(C);break;case"LOG":case"NONE":default:l(j=>[...j,C.msg||""]);break}},[e,t,s.id,o,l,a]),g=b.useCallback(()=>{const _=S(s.id,o),N={...e,combatStats:e.combatStats||{maxHp:100,maxMp:50,atk:10,def:5,hp:100,mp:50}},C=i.map(T=>n.find(A=>A.id===T)).filter(Boolean).map(T=>({...T,combatStats:T.combatStats||{maxHp:100,maxMp:50,atk:10,def:5,hp:100,mp:50}})),j=y(N,_,C);d({enemy:_,result:j,context:"exploration"})},[e,n,i,s.id,o,S,y,d]),h=b.useCallback(_=>{const C=p(_.items||[]).map(T=>T.name).filter(Boolean).join(", "),j=[];_.msg&&j.push(_.msg),C&&j.push(`${C}`),j.length>0&&l(T=>[...T,...j])},[p,l]),v=b.useCallback(_=>{if(u(_.npc,_.msg),_.removeItemId){const N=t.find(C=>C.id===_.removeItemId);N&&c.removeItemFromInventory(N.instanceId,N.stackable?1:void 0)}l(N=>[...N,_.msg||""])},[u,t,c,l]),x=b.useCallback(_=>{const N=_.hpDelta||0;if(N<0){const C=Math.abs(N),j=qo(e,C,"EXPLORATION");a(A=>({...A,stats:{...A.stats,health:j.newHealth}}));const T=[];T.push(j.message),_.msg&&_.msg!==""&&T.push(_.msg),l(A=>[...A,...T])}else a(C=>{var j,T;return{...C,stats:{...C.stats,health:Math.max(1,Math.min(100,(((j=C.stats)==null?void 0:j.health)||50)+Math.floor(N/(((T=C.combatStats)==null?void 0:T.maxHp)||100)*100)))}}}),l(C=>[...C,_.msg||(N<0?"":"")])},[e,a,l]),I=b.useCallback(_=>{a(N=>{const C={...N,currentExp:(N.currentExp||0)+(_.amount||0)};return{...C,combatStats:m(C)}}),l(N=>[...N,_.msg||""])},[a,m,l]);return{handleExplorationOption:w,handleStartCombat:g,checkExplorationHealth:E}}function GC({player:e,children:t,exploreRealmState:n,applyCombatResult:s,addLog:o,setCombatData:i,setExploreLog:a,batchUpdateChildren:l,archiveChildDeaths:d,addItemsToInventory:u,setIsExploring:p}){const c=b.useCallback(w=>{var x,I;if(!w)return;const{success:g,remainingHp:h}=w.result,v=w.context||"rival";if(typeof w.onVictory=="function"||typeof w.onDefeat=="function"){g?(x=w.onVictory)==null||x.call(w,w):(I=w.onDefeat)==null||I.call(w,w),i(null);return}if(v==="rival"){m(g,h),i(null);return}g?y(w):S(w),i(null)},[e,t,n,i]),m=b.useCallback((w,g)=>{var h;if(w){const v=Math.floor((1-g/(((h=e.combatStats)==null?void 0:h.maxHp)||100))*100),x=Math.max(5,Math.floor(v/5));s({won:!0,spiritStones:500,healthDamage:x,injurySource:"DUEL"}),o("  500 ")}else{const v=qo(e,40,"DUEL");s({won:!1,expGain:-e.currentExp,spiritStones:-Math.floor(e.resources.spiritStones*.5),health:v.newHealth}),o(` ...
`+v.message)}},[e,s,o]),y=b.useCallback(w=>{var _,N;const g=((_=w.enemy)==null?void 0:_.drops)||[],h=(N=w.enemy)==null?void 0:N.isBoss;let v=[];if(g.length){const C=h?2+Math.floor(Math.random()*2):1;for(let j=0;j<C&&j<g.length;j++){const T=g[Math.floor(Math.random()*g.length)];v.push(T)}}const x=v.length?u(v):[],I=x.length?`${x.map(C=>C.name).join(", ")}`:"";if(a(h?C=>[...C,` ${I}`]:C=>[...C,`${I}`]),w.result.party&&Array.isArray(w.result.party)){const C=[];w.result.party.forEach(j=>{j.currentHp<=0&&C.push({id:j.id,name:j.name,deathReason:`${n.name}`})}),C.length>0&&E(C)}},[u,a,n.name]),S=b.useCallback(w=>{const g=qo(e,35,"EXPLORATION");if(a(h=>[...h,"",g.message," ..."]),s({won:!1,expGain:-e.currentExp,spiritStones:-Math.floor(e.resources.spiritStones*.5),health:g.newHealth}),w.result.party&&Array.isArray(w.result.party)){const h=[];w.result.party.forEach(v=>{var I;const x=v.currentHp/(((I=v.combatStats)==null?void 0:I.maxHp)||100);(x<=0||x<.3&&Math.random()<.5)&&h.push({id:v.id,name:v.name,deathReason:`${n.name}`})}),h.length>0&&E(h)}p(!1)},[e,a,n.name,p,s,l]),E=b.useCallback(w=>{const g=w.map(v=>v.id);l(v=>g.includes(v.id)?null:v),w.forEach(v=>{const x=t.find(I=>I.id===v.id);x&&(d([{...x,deathReason:v.deathReason}],t),o(` ${v.name} ${v.deathReason} ${Math.floor(x.age||0)} `))});const h=w.map(v=>v.name).join("");a(v=>[...v,` ${h} `])},[t,l,d,o,a]);return{handleCombatClose:c}}function VC({player:e,inventory:t,activeNpcs:n,modalState:s,setModalState:o,removeItemFromInventory:i,updateNpc:a,setActiveNpcs:l,batchUpdateNpcsByMap:d,setSelectedNpc:u,showResult:p,addLog:c,handleWitnessCheck:m,pushToNewsBuffer:y,isUsageAllowedForTarget:S,RESOURCE_USAGE:E,formatUsageTargets:w}){const g=b.useCallback(I=>{var ce,Ce,Ge,Ne,nt;const _=s.data;if(!_){console.warn("No NPC found in modalState.data");return}const N=Array.isArray(I)?I:I?[{instanceId:I.instanceId,quantity:I.quantity||1}]:[];if(N.length===0){p("","",!1,null,!1,{category:"",type:"GIFT",title:"",message:"",details:"",forceManual:!0});return}const C={common:5,uncommon:10,rare:20,epic:35,legendary:50},j=_.identity==="",T=_.identity==="",A=_.identity==="";let V=0,F=0,B=0,$=0;const Y=[],ne=[],X=[];if(N.forEach(({instanceId:Le,quantity:z})=>{const ue=t.find(Et=>Et.instanceId===Le);if(!ue||!S(ue,E.NPC))return;const ve=ue.quantity||1,ge=Math.max(1,Math.min(ve,parseInt(z,10)||1));i(ue.instanceId,ue.stackable?ge:void 0);const Ee={...ue};let Ke=C[Ee.rarity]||5;Ee.type==="consumable"&&(Ke+=5),(Ee.type==="weapon"||Ee.type==="armor")&&(Ke+=3),(j||T||A)&&(Ee.rarity==="common"||Ee.rarity==="uncommon")&&(Ke=0);const xn=Math.min(Ke,50)*ge;if(V+=xn,Y.push(`${Ee.name} x${ge}`),ne.push(` ${Ee.name} x${ge} +${xn}`),Ee.type==="consumable"&&Ee.effect){const Et=Ee.effect||{},lr=(Et.amount||0)*ge;Et.kind==="exp"&&(F+=lr),Et.kind==="aptitude"&&(B+=lr),Et.kind,Et.kind==="heal"&&($+=lr)}}),V<=0){p("","",!1,null,!1,{category:"",type:"GIFT",title:"",message:"",details:"",forceManual:!0});return}const ee=_.gender===""?"":"",ae=V>15?"":V>8?"":"",Te=` ${Y.join("")}  ${_.name}${ee}${ae}`,Be=N.length===1&&Y.length===1?((ce=jj(_,t.find(Le=>Le.instanceId===N[0].instanceId)))==null?void 0:ce.description)||Te:`${Te}

${ne.join(`
`)}`,ze=_.relationship||{affection:0,trust:0};let W={..._,relationship:{...ze,affection:Math.min(100,(ze.affection||0)+V)}},J=null;if(F>0){const Le=Tn(W.tier||""),z=W.maxExp||(Le==null?void 0:Le.maxExp)||0;if(W={...W,currentExp:(W.currentExp||0)+F,maxExp:z||W.maxExp},W.combatStats=Sn(W),X.push(`${_.name} +${F}`),J={...J||{},:F},W.maxExp&&W.currentExp>=W.maxExp){const ue=By(W,e,e.time.year,e.time.month);W=ue.npc,W.combatStats=Sn(W),ue.events&&ue.events.length>0&&X.push(ue.events[0].message)}}if(B>0){try{W=$f(W,Math.min(100,(((Ce=W.stats)==null?void 0:Ce.aptitude)||50)+B))}catch{W={...W,stats:{...W.stats,aptitude:Math.min(100,(((Ge=W.stats)==null?void 0:Ge.aptitude)||50)+B)}}}W.combatStats=Sn(W),X.push(`${_.name} +${B}`),J={...J||{},:B}}if($>0){const Le=Math.min(100,(((Ne=W.stats)==null?void 0:Ne.health)||100)+$);W={...W,stats:{...W.stats,health:Le}},X.push(`${_.name} +${$}`),J={...J||{},:$}}const fe=Y.join("");W=mk(W,e,Math.floor(e.age),e.time.month,fe),W=Hi(W),os.onReceiveGift(W,{name:fe},V),a(_.id,W);const re=X.length>0?`${Be}

${X.join("")}`:Be;p("",re,!0,{:V,...J||{}},!1,{category:"",type:"GIFT",title:`-${_.name}`,message:`${_.name}`,details:re,forceManual:!0}),m(_,"GIFT"),((nt=_.relationship)==null?void 0:nt.affection)>=60&&Math.random()<.3&&y(e.newsBuffer,"NPC_PURSUIT",{actor:e.name,target:_.name}),o({type:null,data:null})},[s,t,e,i,a,p,m,y,o,S,E]),h=b.useCallback(I=>{var V,F,B;const _=s.data;if(!_){console.warn("No NPC found in modalState.data");return}const N=_.identity==="",C=(_.dualCultivationCount||0)>0;if(N&&!C){const $=`${_.name}"..."`;p("",$,!1,null,!1);return}let j=((V=_.relationship)==null?void 0:V.affection)||0;I.strongAgainst.includes(((F=_.personality)==null?void 0:F.label)||"")?j+=30:I.weakAgainst.includes(((B=_.personality)==null?void 0:B.label)||"")&&(j-=20);const T=Math.random()*100<j,A=zj(_,I,T);if(T){const $=yk(_,e,Math.floor(e.age),e.time.month);os.onPregnancyStart($),l(Y=>Y.map(ne=>ne.id===_.id?{...$,isPregnant:!0,pregnancyProgress:0}:ne)),p("",A,!0,null,!1)}else p("",A,!1,null,!1)},[s,e,l,p]),v=b.useCallback((I,_)=>{let N=_;_.check&&(N=_.check(e)?_.success:_.fail);const C=(N==null?void 0:N.change)||{},j=(N==null?void 0:N.result)||_.result,T=n.find(V=>V.id===I);if(T){const V=T.relationship||{affection:0,trust:0,jealousy:0,stage:0},F={...V};C.affection!==void 0&&(F.affection=Math.min(100,Math.max(0,(F.affection||0)+C.affection))),C.trust!==void 0&&(F.trust=Math.min(100,Math.max(0,(F.trust||0)+C.trust))),C.jealousy!==void 0&&(F.jealousy=Math.min(100,Math.max(0,(F.jealousy||0)+C.jealousy)));let B=V.stage||0;if(C.stageUp){const $=F.affection||0;$>=80?B=3:$>=50?B=2:$>=20?B=1:B=0}a(I,{relationship:{...F,stage:B}})}const A=(N==null?void 0:N.msg)||"";c(`${A}`),p("",A,j==="good",{:C.affection||0,:C.trust||0,:C.jealousy||0},!1),u(null)},[e,n,a,c,p,u]),x=b.useCallback(I=>{const _=s.data;if(!_)return;const N=Kj(_,I,e),C=new Map;N.changes.forEach(j=>{var ne,X,ee;const T=n.find(ae=>ae.id===j.npcId);if(!T)return;const A=((ne=T.relationship)==null?void 0:ne.jealousy)||0,V=((X=T.relationship)==null?void 0:X.affection)||0,F=Math.min(100,Math.max(0,A+j.jealousyChange)),B=Math.min(100,Math.max(0,V+j.affectionChange)),$=(ee=N.npcLogs)==null?void 0:ee.find(ae=>ae.npcId===T.id);let Y={...T,relationship:{...T.relationship,jealousy:F,affection:B}};if($){const ae=Y.logs||[],Te={year:e.time.year,month:e.time.month,content:$.content,type:$.type||"DAILY",isSecret:$.isSecret||!1,timestamp:Date.now()};Y={...Y,logs:[Te,...ae].slice(0,50)}}C.set(j.npcId,Y)}),d(C),c(` ${N.message}`),p("",N.message,!0,{},!1),o({type:null,data:null})},[s,e,n,d,c,p,o]);return{handleGiftConfirm:g,handleNegotiateConfirm:h,handleOptionSelect:v,handleShuraFieldSelect:x}}function YC({player:e,onBreakthroughClick:t}){const n=Math.min(100,e.currentExp/e.maxExp*100),s=Math.min(100,(e.energy||0)/20*100),o=e.currentExp>=e.maxExp&&e.maxExp>0;return r.jsxs("div",{style:vr.cultivationSection,children:[r.jsxs("div",{style:vr.expContainer,children:[r.jsx("div",{style:vr.expLabel,children:""}),r.jsxs("div",{style:vr.expBar,children:[r.jsx("div",{style:{...vr.expBarFill,width:`${n}%`,background:o?"linear-gradient(90deg, #ff6f00 0%, #ff8f00 100%)":"linear-gradient(90deg, #76ff03 0%, #64dd17 100%)"}}),r.jsxs("span",{style:vr.expText,children:[e.currentExp," / ",e.maxExp]})]}),r.jsxs("div",{style:{marginTop:8},children:[r.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:6},children:[r.jsx("div",{style:{fontSize:12,color:"#666"},children:""}),r.jsxs("div",{style:vr.energyText,children:[e.energy||0," / 20"]})]}),r.jsx("div",{style:vr.energyBar,children:r.jsx("div",{style:{...vr.energyFill,width:`${s}%`}})})]})]}),o&&r.jsx("button",{onClick:t,style:vr.breakthroughBtn,children:" "})]})}const vr={cultivationSection:{display:"flex",alignItems:"center",gap:"15px",padding:"15px 20px",background:"linear-gradient(135deg, #ffffff 0%, #f5f5f5 100%)",borderBottom:"2px solid #e0e0e0",boxShadow:"0 2px 4px rgba(0,0,0,0.05)"},expContainer:{flex:1,minWidth:0},expLabel:{fontSize:"13px",fontWeight:"600",color:"#555",marginBottom:"6px"},expBar:{position:"relative",height:"24px",background:"#e0e0e0",borderRadius:"12px",overflow:"hidden",boxShadow:"inset 0 2px 4px rgba(0,0,0,0.1)"},expBarFill:{position:"absolute",top:0,left:0,height:"100%",transition:"width 0.3s ease, background 0.3s ease",boxShadow:"0 0 8px rgba(118, 255, 3, 0.4)"},expText:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",fontSize:"11px",fontWeight:"700",color:"#333",textShadow:"0 1px 2px rgba(255,255,255,0.8)",zIndex:1},energyBar:{position:"relative",height:"14px",background:"#e0e0e0",borderRadius:"7px",overflow:"hidden",boxShadow:"inset 0 1px 3px rgba(0,0,0,0.1)"},energyFill:{height:"100%",background:"linear-gradient(90deg, #29b6f6 0%, #0288d1 100%)",borderRadius:"7px",transition:"width 0.3s ease",boxShadow:"0 0 6px rgba(41, 182, 246, 0.3)"},energyText:{fontSize:"11px",color:"#666",fontWeight:"500"},breakthroughBtn:{padding:"10px 20px",background:"linear-gradient(135deg, #ff6f00 0%, #ff8f00 100%)",color:"white",border:"none",borderRadius:"8px",fontSize:"14px",fontWeight:"600",cursor:"pointer",boxShadow:"0 4px 8px rgba(255, 111, 0, 0.3)",transition:"all 0.2s",animation:"pulse 2s infinite",whiteSpace:"nowrap"}};function qC({player:e,visibleChildren:t,pregnantNpcs:n,fallenChildren:s,exiledChildren:o=[],onChildClick:i,onToggleFavorite:a,onMemorialClick:l,generation3Plus:d=[]}){return r.jsxs("div",{style:Yg.tabContent,children:[r.jsx(QE,{player:e,children:t,pregnantNpcs:n,fallenChildren:s,exiledChildren:o,onChildClick:i,onToggleFavorite:a,onMemorialClick:l,generation3Plus:d}),r.jsxs("div",{style:Yg.statsBar,children:[": ",t.length+1," | : ",t.filter(u=>u.generation>1).length]})]})}const Yg={tabContent:{flex:1,overflow:"auto",background:"#fafafa"},statsBar:{padding:"15px",textAlign:"center",fontSize:"13px",color:"#555",borderTop:"1px dashed #e0e0e0",marginTop:"15px"}};function KC({isAuto:e,autoSpeed:t,player:n,messageUnreadCount:s,onToggleAuto:o,onSetAutoSpeed:i,onNextMonth:a,onOpenGazette:l,onOpenMessageCenter:d,onMarkGazetteRead:u}){return r.jsxs(r.Fragment,{children:[r.jsxs("div",{style:Gn.fabContainer,children:[e&&r.jsxs("div",{style:Gn.speedSelector,children:[r.jsx("button",{onClick:()=>i(.3),style:{...Gn.speedBtn,backgroundColor:t===.3?"#4CAF50":"#e0e0e0",color:t===.3?"white":"#666"},children:"0.3"}),r.jsx("button",{onClick:()=>i(1),style:{...Gn.speedBtn,backgroundColor:t===1?"#4CAF50":"#e0e0e0",color:t===1?"white":"#666"},children:"1"}),r.jsx("button",{onClick:()=>i(3),style:{...Gn.speedBtn,backgroundColor:t===3?"#4CAF50":"#e0e0e0",color:t===3?"white":"#666"},children:"3"})]}),r.jsx("button",{onClick:o,style:{...Gn.autoBtn,backgroundColor:e?"#76ff03":"#e0e0e0",color:e?"#33691e":"#757575"},children:e?" ":" "}),r.jsx("button",{onClick:()=>a(!1),style:{...Gn.fabBtn,transform:e?"scale(0.9)":"scale(1)",opacity:e?.8:1},disabled:e,children:e?r.jsx("div",{style:Gn.spinner,children:""}):r.jsxs(r.Fragment,{children:[r.jsx("span",{style:{fontSize:"18px"},children:""}),r.jsx("span",{style:{fontSize:"9px"},children:""})]})})]}),r.jsxs("button",{onClick:()=>{l(),u()},style:Gn.gazetteBtn,title:"",children:["",n.hasUnreadGazette&&r.jsx("span",{style:Gn.redDot})]}),r.jsxs("button",{onClick:d,style:Gn.messageCenterBtn,title:" - ",children:["",s>0&&r.jsx("span",{style:Gn.redDot,children:s})]})]})}const Gn={fabContainer:{position:"fixed",bottom:"76px",right:"20px",display:"flex",flexDirection:"column",alignItems:"flex-end",gap:"12px",zIndex:99},speedSelector:{display:"flex",gap:"6px",padding:"8px",background:"rgba(255,255,255,0.95)",borderRadius:"20px",boxShadow:"0 4px 12px rgba(0,0,0,0.15)"},speedBtn:{padding:"6px 12px",border:"none",borderRadius:"12px",fontSize:"12px",fontWeight:"600",cursor:"pointer",transition:"all 0.2s",minWidth:"45px"},autoBtn:{padding:"10px 18px",border:"none",borderRadius:"20px",fontSize:"13px",fontWeight:"600",cursor:"pointer",boxShadow:"0 4px 12px rgba(0,0,0,0.15)",transition:"all 0.2s"},fabBtn:{width:"60px",height:"60px",borderRadius:"50%",border:"none",background:"linear-gradient(135deg, #8b7355 0%, #a0826d 100%)",color:"#fff",fontSize:"14px",fontWeight:"600",cursor:"pointer",boxShadow:"0 6px 20px rgba(139, 115, 85, 0.3)",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",gap:"2px",transition:"all 0.2s"},spinner:{fontSize:"24px",animation:"spin 2s linear infinite"},gazetteBtn:{position:"fixed",bottom:"76px",left:"20px",width:"50px",height:"50px",borderRadius:"50%",border:"none",background:"linear-gradient(135deg, #8b6f47 0%, #a0916f 100%)",color:"#fff",fontSize:"24px",cursor:"pointer",boxShadow:"0 4px 12px rgba(139, 111, 71, 0.3)",zIndex:99,transition:"all 0.2s"},messageCenterBtn:{position:"fixed",bottom:"136px",left:"20px",width:"50px",height:"50px",borderRadius:"50%",border:"none",background:"linear-gradient(135deg, #c9b5a0 0%, #d4c9c1 100%)",color:"#4a3728",fontSize:"24px",cursor:"pointer",boxShadow:"0 4px 12px rgba(201, 181, 160, 0.3)",zIndex:99,transition:"all 0.2s"},redDot:{position:"absolute",top:"0",right:"0",width:"18px",height:"18px",background:"#f44336",color:"white",borderRadius:"50%",fontSize:"10px",fontWeight:"700",display:"flex",alignItems:"center",justifyContent:"center",border:"2px solid white",boxShadow:"0 2px 4px rgba(0,0,0,0.2)"}},QC=[{value:"DEFAULT",label:" ()"},{value:"AFFECTION_DESC",label:" ()"},{value:"APTITUDE_DESC",label:" ()"},{value:"TRUST_DESC",label:" ()"}],JC=({sortedNpcs:e,pagedNpcs:t,deadNpcs:n,npcSort:s,npcPage:o,npcPageCount:i,hasNpcPagination:a,showFollowedOnly:l,onExplore:d,onSortChange:u,onToggleFollowedOnly:p,onPrevPage:c,onNextPage:m,onNpcInteract:y,onNpcAction:S,isRomanceLimitReached:E=!1})=>r.jsxs("div",{style:{padding:"15px",maxWidth:"800px",margin:"0 auto",paddingBottom:"80px"},children:[r.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"15px"},children:[r.jsxs("h2",{style:{margin:0,color:"#5d4037"},children:[" ",e.length,""]}),r.jsx("button",{onClick:d,style:{padding:"8px 16px",backgroundColor:E?"#c0c0c0":"#8d6e63",color:"white",border:E?"2px solid #d32f2f":"none",borderRadius:"8px",cursor:E?"not-allowed":"pointer",fontSize:"14px",fontWeight:E?"bold":"normal",opacity:E?.7:1},children:" "})]}),E&&r.jsx("div",{style:{padding:"12px",marginBottom:"15px",backgroundColor:"#fff3e0",borderLeft:"4px solid #ff9800",borderRadius:"4px",color:"#e65100",fontSize:"13px",fontWeight:"500"},children:" "}),r.jsxs("div",{style:{marginBottom:"15px"},children:[r.jsx(WC,{options:QC,currentSort:s,onSortChange:u}),r.jsx("div",{style:{marginTop:"10px"},children:r.jsxs("label",{style:{fontSize:"14px",color:"#666",cursor:"pointer",userSelect:"none"},children:[r.jsx("input",{type:"checkbox",checked:l,onChange:w=>p(w.target.checked),style:{marginRight:"6px"}})," NPC"]})})]}),r.jsxs("div",{children:[t.length===0?r.jsx("div",{style:{textAlign:"center",padding:"40px",color:"#999",fontSize:"14px"},children:""}):r.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(280px, 1fr))",gap:"12px"},children:t.map(w=>r.jsx(jg,{npc:w,onInteract:(g,h)=>{S?S(g,h):h==="DETAIL"&&y(w)}},w.id))}),a&&r.jsxs("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",gap:"15px",marginTop:"20px"},children:[r.jsx("button",{onClick:c,disabled:o===0,style:{padding:"8px 16px",border:"1px solid #ccc",borderRadius:"8px",backgroundColor:o===0?"#f5f5f5":"white",cursor:o===0?"not-allowed":"pointer",fontSize:"14px"},children:""}),r.jsxs("span",{style:{fontSize:"14px",color:"#666"},children:[" ",o+1," / ",i," "]}),r.jsx("button",{onClick:m,disabled:o>=i-1,style:{padding:"8px 16px",border:"1px solid #ccc",borderRadius:"8px",backgroundColor:o>=i-1?"#f5f5f5":"white",cursor:o>=i-1?"not-allowed":"pointer",fontSize:"14px"},children:""})]})]}),n.length>0&&r.jsxs("div",{style:{marginTop:"30px"},children:[r.jsxs("h3",{style:{color:"#999",fontSize:"16px",marginBottom:"15px"},children:[" ",n.length,""]}),r.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(280px, 1fr))",gap:"12px",opacity:.6},children:n.map(w=>r.jsx(jg,{npc:w,actions:r.jsx("button",{onClick:()=>y(w),style:{width:"100%",padding:"8px",border:"1px solid #ccc",borderRadius:"6px",backgroundColor:"#f5f5f5",color:"#999",cursor:"pointer",fontSize:"14px"},children:""})},w.id))})]})]}),XC=({player:e,children:t,showBizPanel:n,showChallengePanel:s,idleManagerOptions:o,onDailyAction:i,onShopping:a,onOpenInventory:l,onBuyBusiness:d,onExploreRealm:u,onOpenAuction:p,onCloseBizPanel:c,onCloseChallengePanel:m,onOpenBizPanel:y,onOpenChallengePanel:S,isRomanceLimitReached:E=!1})=>{const w=((e.time.year-3572)*12+e.time.month)%36===0;return r.jsx("div",{style:{padding:"15px",maxWidth:"800px",margin:"0 auto",paddingBottom:"80px"},children:n?r.jsxs("div",{children:[r.jsx("button",{onClick:c,style:{padding:"8px 16px",marginBottom:"15px",border:"1px solid #ccc",borderRadius:"8px",backgroundColor:"white",cursor:"pointer",fontSize:"14px"},children:" "}),r.jsx(g5,{player:e,children:t,managerOptions:o,onBuy:d})]}):s?r.jsxs("div",{children:[r.jsx("button",{onClick:m,style:{padding:"8px 16px",marginBottom:"15px",border:"1px solid #ccc",borderRadius:"8px",backgroundColor:"white",cursor:"pointer",fontSize:"14px"},children:" "}),r.jsx(h5,{player:e,children:t,onChallenge:u,isRomanceLimitReached:E})]}):r.jsxs("div",{children:[r.jsx("h2",{style:{margin:"0 0 20px 0",color:"#5d4037"},children:""}),r.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"10px",marginBottom:"30px"},children:[r.jsx("button",{onClick:()=>i("CULTIVATE"),style:{padding:"12px 20px",border:"none",borderRadius:"8px",backgroundColor:"#8d6e63",color:"white",cursor:"pointer",fontSize:"16px",fontWeight:"bold"},children:" (+10-15)"}),r.jsx("button",{onClick:()=>i("WORK"),style:{padding:"12px 20px",border:"none",borderRadius:"8px",backgroundColor:"#8d6e63",color:"white",cursor:"pointer",fontSize:"16px",fontWeight:"bold"},children:" (+15)"}),r.jsx("button",{onClick:a,style:{padding:"12px 20px",border:"none",borderRadius:"8px",backgroundColor:"#8d6e63",color:"white",cursor:"pointer",fontSize:"16px",fontWeight:"bold"},children:" (-10)"}),r.jsx("button",{onClick:()=>l("SELL"),style:{padding:"12px 20px",border:"none",borderRadius:"8px",backgroundColor:"#8d6e63",color:"white",cursor:"pointer",fontSize:"16px",fontWeight:"bold"},children:" ()"})]}),r.jsxs("div",{style:{marginTop:"30px",borderTop:"1px dashed #ccc",paddingTop:"20px"},children:[r.jsx("h3",{style:{margin:"0 0 15px 0",color:"#5d4037"},children:" "}),r.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(140px, 1fr))",gap:"15px"},children:[r.jsxs("button",{onClick:y,style:{padding:"20px",border:"2px solid #8d6e63",borderRadius:"12px",backgroundColor:"white",cursor:"pointer",display:"flex",flexDirection:"column",alignItems:"center",gap:"10px",transition:"all 0.2s"},children:[r.jsx("div",{style:{fontSize:"36px"},children:""}),r.jsx("div",{style:{fontSize:"14px",fontWeight:"bold",color:"#5d4037"},children:""})]}),r.jsxs("button",{onClick:S,style:{padding:"20px",border:"2px solid #8d6e63",borderRadius:"12px",backgroundColor:"white",cursor:"pointer",display:"flex",flexDirection:"column",alignItems:"center",gap:"10px",transition:"all 0.2s"},children:[r.jsx("div",{style:{fontSize:"36px"},children:""}),r.jsx("div",{style:{fontSize:"14px",fontWeight:"bold",color:"#5d4037"},children:""})]}),r.jsxs("button",{onClick:p,style:{padding:"20px",border:"2px solid #8d6e63",borderRadius:"12px",backgroundColor:"white",cursor:"pointer",display:"flex",flexDirection:"column",alignItems:"center",gap:"10px",transition:"all 0.2s",opacity:w?1:.6},children:[r.jsx("div",{style:{fontSize:"36px"},children:""}),r.jsx("div",{style:{fontSize:"14px",fontWeight:"bold",color:"#5d4037"},children:""}),r.jsx("div",{style:{fontSize:"10px",color:"#999"},children:""})]})]})]})]})})},qg=["","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","",""],ZC=["","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","",""],eT=["","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","",""],Kg=["","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","",""],Qg=["","","","","","","","","","","","","","","","","","","",""];function c1(e){const t=qg[Math.floor(Math.random()*qg.length)],n=e==="male"?ZC:eT;if(Math.random()>.3){const o=n[Math.floor(Math.random()*n.length)],i=n[Math.floor(Math.random()*n.length)];return t+o+i}else{const o=n[Math.floor(Math.random()*n.length)];return t+o}}function d1(e){const t=Kg[Math.floor(Math.random()*Kg.length)],n=Qg[Math.floor(Math.random()*Qg.length)];if(e.includes("")||e.includes("")){const s=["","","","",""];return s[Math.floor(Math.random()*s.length)]+n}else if(e.includes("")||e.includes("")){const s=["","","","",""];return s[Math.floor(Math.random()*s.length)]+n}return t+n}function u1(e,t={}){const{ensureAllSects:n=!1,preserveExisting:s=!0}=t,o=Er.filter(u=>u&&u.id&&u.id!=="SECT_NONE"),i=new Map,a=new Map,l=e.reduce((u,p)=>{const c=Number.isFinite(p==null?void 0:p.tierIndex)?p.tierIndex:-1;return c>u?c:u},-1);if(o.forEach(u=>i.set(u.id,[])),e.forEach(u=>{var c,m;const p=(c=u.sect)==null?void 0:c.id;p&&i.has(p)&&i.get(p).push(u),u.sectRank===""&&((m=u.sect)!=null&&m.id)&&u.status!=="DEAD"&&a.set(u.sect.id,u)}),n){const u=e.filter(c=>!c.sect),p=c=>!c||c.length===0?null:(c.sort((m,y)=>m.tierIndex!==y.tierIndex?m.tierIndex-y.tierIndex:(m.combatPower||0)-(y.combatPower||0)),c.shift());o.forEach(c=>{var S;if((i.get(c.id)||[]).length>0)return;let y=u.pop();if(!y){const E=[...i.entries()].filter(([,w])=>w.length>1).sort((w,g)=>g[1].length-w[1].length)[0];E&&(y=p(E[1]))}if(y){const E=(S=y.sect)==null?void 0:S.id;if(E&&i.has(E)){const w=i.get(E),g=w.indexOf(y);g>=0&&w.splice(g,1)}y.sect={id:c.id,name:c.name},i.get(c.id).push(y)}})}const d=u=>{if(!u||u.length===0)return null;const p=l>=0?u.filter(m=>m.tierIndex===l):[];return(p.length>0?p:u).reduce((m,y)=>m?y.tierIndex!==m.tierIndex?y.tierIndex>m.tierIndex?y:m:(y.combatPower||0)>(m.combatPower||0)?y:m:y,null)};o.forEach(u=>{const p=i.get(u.id)||[];if(p.length===0)return;const m=(s?a.get(u.id):null)||d(p);p.forEach(y=>{y===m?(y.sectRank="",y.isSectLeader=!0):y.sectRank===""&&(y.sectRank=void 0,y.isSectLeader=!1)})})}function tT(e=30){const t=[],n=new Set,s={:.22,:.16,:.14,:.14,:.12,:.1,:.06,:.04,:.02},o={};let i=0;Object.entries(s).forEach(([u,p])=>{const c=Math.floor(e*p);o[u]=c,i+=c});const a=Math.max(0,e-i);a>0&&(o.=(o.||0)+a);let l=1;return["","","","","","","","",""].forEach(u=>{const p=o[u]||1;for(let c=0;c<p;c++){const m=Math.random()>.7?"female":"male";let y,S=0;do y=c1(m),S++;while(n.has(y)&&S<100);n.has(y)&&(y=y+l),n.add(y);const E=d1(u);let w=null;if(Math.random()>.3){const T=Er.filter(A=>A.id!=="SECT_NONE");w=T[Math.floor(Math.random()*T.length)]}const g=qe.findIndex(T=>T.name===u);if(g===-1){console.error(`: ${u}`);return}const h=qe[g],x=h.maxExp*2*(.8+Math.random()*.4),_=Math.random()<.8?90+Math.floor(Math.random()*11):80+Math.floor(Math.random()*10),N=Xo(_),C=50+Math.floor(Math.random()*50),j={id:`world_npc_${l}`,name:y,title:E,gender:m,tier:u,tierIndex:g,sect:w?{id:w.id,name:w.name}:null,status:"ALIVE",location:"Unknown",hasMetPlayer:!1,firstMetYear:null,currentExp:Math.floor(Math.random()*h.maxExp*.8)+h.maxExp*.2,maxExp:h.maxExp,stats:{aptitude:_,looks:C,intelligence:60+Math.floor(Math.random()*40),health:80},spiritRoot:N,combatPower:Math.floor(x),age:30+(qe.length-g)*50+Math.floor(Math.random()*100),personality:p1(),signature:f1(u),appearance:{description:m1(m,u,C)},relationships:{allies:[],enemies:[],disciples:[]},majorEvents:[`${E}`],lastActiveYear:3572};t.push(j),l++}}),nT(t),u1(t,{ensureAllSects:!0,preserveExisting:!1}),t}function p1(){const e=[{label:"",desc:""},{label:"",desc:""},{label:"",desc:""},{label:"",desc:""},{label:"",desc:""},{label:"",desc:""},{label:"",desc:""},{label:"",desc:""},{label:"",desc:""},{label:"",desc:""},{label:"",desc:""},{label:"",desc:""},{label:"",desc:""},{label:"",desc:""},{label:"",desc:""}];return e[Math.floor(Math.random()*e.length)]}function f1(e){const t={:["","","",""],:["","","",""],:["","","",""],:["","","",""],:["","","",""],:["","","",""]},n=t[e]||t.;return n[Math.floor(Math.random()*n.length)]}function m1(e,t,n=60){const s=Number.isFinite(n)?n:60,o={high:["","",""],mid:["","",""],low:["","",""]},i={high:["","",""],mid:["","",""],low:["","",""]},a=s>=85?"high":s>=60?"mid":"low",l=e==="male"?o[a]:i[a];return l[Math.floor(Math.random()*l.length)]}function nT(e){const t=e.filter(s=>["","",""].includes(s.tier));e.filter(s=>["",""].includes(s.tier)).forEach(s=>{if(Math.random()>.5&&t.length>0){const o=t[Math.floor(Math.random()*t.length)];o.sect&&s.sect&&o.sect.id===s.sect.id&&(o.relationships.disciples.push(s.id),s.majorEvents.push(`${o.name}`))}});for(let s=0;s<Math.min(5,e.length/3);s++){const o=e[Math.floor(Math.random()*e.length)],i=e[Math.floor(Math.random()*e.length)];o.id!==i.id&&!o.relationships.enemies.includes(i.id)&&Math.abs(o.tierIndex-i.tierIndex)<=2&&(o.relationships.enemies.push(i.id),i.relationships.enemies.push(o.id),o.majorEvents.push(`${i.name}`),i.majorEvents.push(`${o.name}`))}}function Jg(e,t){const n=e.map(a=>{if(a.status==="DEAD")return a;const l={...a};l.age=(a.age||100)+1;const d=qe.findIndex(E=>E.name===a.tier);if(d===-1)return console.warn(`: ${a.tier}`),a;const u=1/Math.max(1,d*.5),p=Math.floor(a.maxExp*.05*u*(.8+Math.random()*.4));l.currentExp=Math.min(a.maxExp,a.currentExp+p);const c=l.currentExp>=l.maxExp,m=Math.max(.02,.1-d*.01);if(c&&Math.random()<m&&d<qe.length-1){const E=d+1,w=qe[E].name;l.tier=w,l.tierIndex=E,l.currentExp=0,l.maxExp=qe[E].maxExp,l.combatPower=Math.floor(l.combatPower*1.5),l.majorEvents.push(`${t}${w}`)}const S=.005/Math.max(1,d*.3);if(Math.random()<S){l.status="DEAD",l.deathYear=t;const E=["","","","",""];l.deathReason=E[Math.floor(Math.random()*E.length)],l.majorEvents.push(`${t}${l.deathReason}`)}return l.lastActiveYear=t,l}),s=n.filter(a=>a.status==="DEAD"&&a.deathYear===t).length,o=[];for(let a=0;a<s;a++)if(Math.random()<.2){const l=Math.random()>.5?"male":"female",d=c1(l),u=d1(""),p=qe.findIndex(S=>S.name===""),c=qe[p],m=55+Math.floor(Math.random()*40),y={id:`world_npc_new_${t}_${a}`,name:d,title:u,gender:l,tier:"",tierIndex:p,sect:null,status:"ALIVE",location:"Unknown",hasMetPlayer:!1,firstMetYear:null,currentExp:Math.floor(c.maxExp*.5),maxExp:c.maxExp,combatPower:Math.floor(c.maxExp*1.5),age:50+Math.floor(Math.random()*50),stats:{aptitude:80+Math.floor(Math.random()*16),looks:m,intelligence:60+Math.floor(Math.random()*30),health:80},personality:p1(),signature:f1(""),appearance:{description:m1(l,"",m)},relationships:{allies:[],enemies:[],disciples:[]},majorEvents:[`${t}`],lastActiveYear:t};o.push(y)}const i=[...n,...o];return u1(i,{ensureAllSects:!1,preserveExisting:!0}),i}const Ff=[{id:"dawn_breaker",name:"",epithet:"",element:"",basePrice:2600,desc:"",auctionFlavor:"",blessing:""},{id:"dusk_ember",name:"",epithet:"",element:"",basePrice:2750,desc:"",auctionFlavor:"",blessing:""},{id:"frost_pulse",name:"",epithet:"",element:"",basePrice:2900,desc:"",auctionFlavor:"",blessing:""},{id:"abyssal_flare",name:"",epithet:"",element:"",basePrice:3100,desc:"",auctionFlavor:"",blessing:""}],rT=[{key:"sword_saint",name:"",alias:"",gender:"",identity:"",tier:"",expRatio:.86,age:230,stats:{aptitude:98,looks:92,intelligence:90,health:95},baseAffection:45,baseTrust:25,spiritRoot:{type:"",elements:["",""],color:"#8ad3ff",desc:""},constitutionKey:"fumo_frost_thunder_body",inheritance:{bloodline:"",desc:""},cultivationMethod:"wanjian_heart",personality:{label:"",tag:"",desc:""},appearance:"",desc:"",title:"",trait:{name:"",desc:""},likes:["",""],dislikes:[""],world:{rankHint:"",combatPower:36e4,location:""}},{key:"demon_sage",name:"",alias:"",gender:"",identity:"",tier:"",expRatio:.78,age:210,stats:{aptitude:96,looks:95,intelligence:93,health:90},baseAffection:50,baseTrust:28,spiritRoot:{type:"",elements:["",""],color:"#ff7c8a",desc:""},constitutionKey:"fumo_abyssal_flame_core",inheritance:{bloodline:"",desc:""},cultivationMethod:"wanmo_heart",personality:{label:"",tag:"",desc:""},appearance:"",desc:"",title:"",trait:{name:"",desc:""},likes:["",""],dislikes:[""],world:{rankHint:"",combatPower:345e3,location:""}}],Su=Ff.length,wu=rT,Xg=e=>Ff.find(t=>t.id===e),Tp=(e=[])=>{const t=new Set(e||[]);return Ff.filter(n=>!t.has(n.id))},sT=e=>e?{id:`FUMO_${e.id}_${Date.now()}`,type:"FUMO_SWORD",swordId:e.id,name:e.name,basePrice:e.basePrice,description:`${e.epithet}  ${e.desc}`,rarity:"legendary",plot:e.auctionFlavor}:null,oT=e=>e?{instanceId:`fumo_sword_${e.id}_${Date.now()}`,name:e.name,type:"weapon",rarity:"legendary",desc:`${e.epithet}  ${e.desc}

${e.blessing}`,tags:["",""],bound:!0,effect:{kind:"artifact",stat:"atk",amount:800}}:null,iT=e=>{var i;if(!e)return null;const t=Tn(e.tier)||{maxExp:12e4},n=Math.floor((e.expRatio||.8)*t.maxExp),s=e.constitution?Dl(e.constitution):e.constitutionKey?vy(e.constitutionKey):null,o={id:`legend_${e.key}`,name:e.name,alias:e.alias,gender:e.gender,identity:e.identity,title:e.title,tier:e.tier,currentExp:n,maxExp:t.maxExp,stats:{...e.stats},spiritRoot:e.spiritRoot?{...e.spiritRoot}:null,cultivationMethod:e.cultivationMethod,constitution:s,personality:e.personality,appearance:e.appearance,desc:e.desc,trait:e.trait,likes:e.likes,dislikes:e.dislikes,relationship:{stage:0,affection:e.baseAffection??40,trust:e.baseTrust??20,jealousy:10},logs:[],status:"AVAILABLE",customFlags:{isFumoLegend:!0,legendKey:e.key,inheritanceTag:(i=e.inheritance)==null?void 0:i.bloodline}};return o.combatStats=Sn(o),o},aT=(e,t)=>{var o,i,a,l;if(!e)return null;const n=qe.findIndex(d=>d.name===e.tier),s=Tn(e.tier)||{maxExp:12e4};return{id:`world_${e.key}`,name:e.name,title:e.title||e.identity,gender:e.gender===""?"female":"male",tier:e.tier,tierIndex:n>=0?n:qe.length-1,status:"ALIVE",location:((o=e.world)==null?void 0:o.location)||"",hasMetPlayer:!0,firstMetYear:t,currentExp:Math.floor((e.expRatio||.8)*s.maxExp),maxExp:s.maxExp,combatPower:((i=e.world)==null?void 0:i.combatPower)||s.maxExp*2,age:e.age||200,personality:e.personality,appearance:{description:e.appearance},relationships:{allies:[],enemies:[],disciples:[]},majorEvents:[`${t}${e.name} `],lastActiveYear:t,customFlags:{isFumoLegend:!0,legendKey:e.key,rankHint:(a=e.world)==null?void 0:a.rankHint,inheritanceTag:(l=e.inheritance)==null?void 0:l.bloodline}}},lT=["","",""],cT=e=>e[Math.floor(Math.random()*e.length)],Ip=Object.values(Q).reduce((e,t)=>(e[t.key]=t.order,e),{}),dT={common:80,uncommon:160,rare:420,epic:900,legendary:2200},uT=e=>{const t=Ip[e.resourceLevel]||1,n=dT[e.rarity]||300;return Math.floor(n*(1+t*.55))},pT=Object.values(Uc).filter(e=>e.resourceLevel&&Ip[e.resourceLevel]>=2).map(e=>{var t;return{itemId:e.id,name:e.name,description:e.desc,rarity:e.rarity,resourceLevel:e.resourceLevel,resourceOrder:Ip[e.resourceLevel]||1,basePrice:uT(e),type:e.type,plot:`${e.source||""}${((t=Q[e.resourceLevel])==null?void 0:t.label)||""}`}}),Zg=(e,t={})=>{const{ownedFumoSwords:n=[],soldAuctionItems:s=[]}=t,o=new Set(s||[]),i=w=>o.has(`ITEM:${w}`)||o.has(w),a=w=>o.has(`FUMO:${w}`)||o.has(w),l=pT.filter(w=>!i(w.itemId)),d=3+Math.floor(Math.random()*3),u=[],p=()=>{if(!l.length)return null;const w=l.map(v=>({entry:v,weight:Math.max(1,10-v.resourceOrder*2)})),g=w.reduce((v,{weight:x})=>v+x,0);let h=Math.random()*g;for(const{entry:v,weight:x}of w)if(h-=x,h<=0)return v;return w[w.length-1].entry},c=new Set;for(let w=0;w<d;w++){let g=0,h=null;for(;g<10&&(h=p(),!(!h||!c.has(h.itemId)));)g++;h&&!c.has(h.itemId)&&(c.add(h.itemId),u.push({id:`ITEM_${Date.now()}_${w}`,type:"ITEM",itemId:h.itemId,name:h.name,basePrice:h.basePrice,description:h.description||`${h.name}`,resourceLevel:h.resourceLevel,rarity:h.rarity,plot:h.plot}))}if(Math.random()<.5){const w=cT(lT)+bw(),g=150+Math.floor(Math.random()*300);u.push({id:`SLAVE_${Date.now()}_${Math.floor(Math.random()*999)}`,type:"SLAVE",name:w,basePrice:g,description:"",plot:""})}const y=Tp(n).filter(w=>!a(w.id));if(y.length>0){const w=Math.random()<.25?2:1,g=[...y];for(let h=0;h<w&&g.length>0;h++){const v=Math.floor(Math.random()*g.length),x=g.splice(v,1)[0],I=sT(x);I&&u.push(I)}}const S=` ${e} `,E=` ${u.length} `;return{title:S,message:E,items:u}},jl=10,ns=60,eh=e=>e?typeof e=="string"?{contextMessage:e}:e:{},th=(e=3572,t=1)=>{const n=Math.max(1,Math.min(12,t||1));return(e-3572)*12+n},fT={[ft.PLAYER]:"",[ft.CHILD]:"",[ft.NPC]:""},g1=e=>e&&Array.isArray(e.usageTargets)&&e.usageTargets.length>0?e.usageTargets:by,ho=e=>g1(e).map(n=>fT[n]||k2[n]||n).join(""),Rs=(e,t)=>e?t===ft.NPC&&e.resourceCategory==="PILL"?!0:g1(e).includes(t):!1,mT=()=>`log-${Date.now()}-${Math.random().toString(16).slice(2)}`,gT=[{id:"init-log-1",turn:0,message:"",category:"",type:null,title:null,details:null},{id:"init-log-2",turn:0,message:"",category:"",type:null,title:null,details:null},{id:"init-log-3",turn:0,message:"",category:"",type:null,title:null,details:null}],hT=_o!=null&&_o.avatar?{..._o.avatar}:{base:0,skinColor:0,hair:1,hairColor:0,eye:0,eyeColor:1,mouth:0},nh=e=>!e||typeof e!="object"?!1:["hair","hairId","faceId","eye","tZoneId"].some(t=>typeof e[t]<"u"&&e[t]!==null),xT=250,ku="forcePortraitUI",rh=()=>typeof window>"u"?!0:window.innerHeight>=window.innerWidth,yT=e=>e?!!(e.status==="DEAD"||e.state==="DEAD"||e.isDeceased||e.deathYear||e.deathReason||typeof e.lifespan=="number"&&e.lifespan<=0||typeof e.health=="number"&&e.health<=0||typeof e.currentHp=="number"&&e.currentHp<=0):!1;function bT(){var o0,i0,a0,l0,c0,d0,u0,p0,f0,m0,g0;const e=w2(),{modalState:t,setModalState:n,openModal:s,closeModal:o}=e,i=b.useCallback(f=>{f.type===null?o():s(f.type,f.data)},[s,o]),a=j2(),{inventory:l,addItemsToInventory:d,removeItemFromInventory:u}=a,p=mw(),{player:c,setPlayer:m,updatePlayer:y,addResources:S,consumeResources:E,consumeEnergy:w,purchaseBusiness:g,applyCombatResult:h,updateWorldNpc:v,clearNewsBuffer:x,addToSpecialCollection:I,applyDefeatPenalty:_}=p,N=uE(),{activeNpcs:C,deadNpcs:j,selectedNpc:T,selectedWorldNpc:A,visibleNpcs:V,setActiveNpcs:F,setDeadNpcs:B,setSelectedNpc:$,setSelectedWorldNpc:Y,updateNpc:ne,addNpc:X,toggleNpcFollow:ee,batchUpdateNpcs:ae,replaceAllNpcs:Te,batchUpdateNpcsByMap:Be,cutTiesWithNpc:ze}=N,W=pE(),{children:J,fallenChildren:fe,selectedChild:re,enhancedChildren:ce,setChildren:Ce,setFallenChildren:Ge,setSelectedChild:Ne,updateChild:nt,removeChild:Le,toggleChildFavorite:z,batchUpdateChildren:ue,replaceAllChildren:ve,batchUpdateChildrenIf:ge}=W,[Ee,Ke]=b.useState(!0),[Ut,xn]=b.useState(!0),[Et,lr]=b.useState("PROLOGUE");b.useEffect(()=>{const f=Vy();console.log(":",f?"":"")},[]),b.useMemo(()=>Iy.map(f=>{var k;const R=(k=f.stats)==null?void 0:k.aptitude;return typeof R=="number"?{...f,spiritRoot:Xo(R)}:f}),[]);const[Kr,Qs]=b.useState(()=>rh()),[cr,Ta]=b.useState(()=>typeof window>"u"?!1:localStorage.getItem(ku)==="true"),Rn=b.useMemo(()=>{const f=((c==null?void 0:c.exiledChildren)||[]).map(R=>R.id);return ce.filter(R=>!f.includes(R.id))},[ce,c==null?void 0:c.exiledChildren]),ln=b.useMemo(()=>[...Rn].sort((f,R)=>{var M,O;const k=f.age-R.age;if(k!==0)return k;const P=(((M=R.stats)==null?void 0:M.aptitude)||0)-(((O=f.stats)==null?void 0:O.aptitude)||0);return P!==0?P:f.name.localeCompare(R.name,"zh-CN")}),[Rn]),Ia=b.useMemo(()=>Rn.filter(f=>f.age>=16&&!f.job).map(f=>{var R;return{id:f.id,name:f.name,age:Math.max(16,Math.floor(f.age||0)),gender:f.gender,tierTitle:f.tierTitle||"",intelligence:((R=f.stats)==null?void 0:R.intelligence)??0}}).sort((f,R)=>(R.intelligence??0)-(f.intelligence??0)),[Rn]),Tr=b.useMemo(()=>{var f;return[...((f=c.specialCollections)==null?void 0:f.fumoSwords)||[]]},[(o0=c.specialCollections)==null?void 0:o0.fumoSwords]),ti=b.useMemo(()=>Tp(Tr),[Tr]),Qc=b.useMemo(()=>{var f,R;return(f=c.specialFlags)!=null&&f.fumoDuoMet?!1:(R=c.specialFlags)!=null&&R.fumoDuoUnlocked?!0:Su>0&&ti.length===0},[(i0=c.specialFlags)==null?void 0:i0.fumoDuoMet,(a0=c.specialFlags)==null?void 0:a0.fumoDuoUnlocked,ti.length]);b.useEffect(()=>{if(typeof window>"u")return;const f=()=>{Qs(rh())};return f(),window.addEventListener("resize",f),window.addEventListener("orientationchange",f),()=>{window.removeEventListener("resize",f),window.removeEventListener("orientationchange",f)}},[]),b.useEffect(()=>{typeof document<"u"&&document.body.classList.toggle("force-portrait-ui",cr),typeof window<"u"&&(cr?localStorage.setItem(ku,"true"):localStorage.removeItem(ku))},[cr]),b.useEffect(()=>()=>{typeof document<"u"&&document.body.classList.remove("force-portrait-ui")},[]);const[dr,_a]=b.useState(gT),Ae=b.useCallback((f,R="",k=null,P=null,M=null)=>{var D,se;const O=((D=c==null?void 0:c.time)==null?void 0:D.year)??3572,L=((se=c==null?void 0:c.time)==null?void 0:se.month)??1,H=(O-3572)*12+L,q={id:mT(),turn:H,message:f,category:R,type:k,title:P,details:M};_a(le=>[q,...le])},[(l0=c==null?void 0:c.time)==null?void 0:l0.year,(c0=c==null?void 0:c.time)==null?void 0:c0.month]),[ur,Ra]=b.useState("FAMILY"),[cn,zn]=b.useState(!1),[Js,Ma]=b.useState(1),[Xs,Aa]=b.useState(!1),[Jc,Xc]=b.useState("AGE_DESC"),[Zs,Na]=b.useState("DEFAULT"),[eo,Ir]=b.useState(0),_r=b.useMemo(()=>{const f=C.filter(R=>{var k;return!((k=R.relationship)!=null&&k.cutTies)&&(!Xs||R.isFollowed)});switch(Zs){case"AFFECTION_DESC":return f.sort((R,k)=>{var O,L;const P=((O=R.relationship)==null?void 0:O.affection)||0;return(((L=k.relationship)==null?void 0:L.affection)||0)-P});case"TRUST_DESC":return f.sort((R,k)=>{var O,L;const P=((O=R.relationship)==null?void 0:O.trust)||0;return(((L=k.relationship)==null?void 0:L.trust)||0)-P});case"APTITUDE_DESC":return f.sort((R,k)=>{var O,L;const P=((O=R.stats)==null?void 0:O.aptitude)||0;return(((L=k.stats)==null?void 0:L.aptitude)||0)-P});default:return f}},[C,Zs,Xs]),to=b.useMemo(()=>Math.max(1,Math.ceil(_r.length/jl)),[_r.length]);b.useEffect(()=>{Ir(0)},[Zs,Xs]),b.useEffect(()=>{Ir(f=>Math.min(f,Math.max(0,to-1)))},[to]);const Zc=b.useMemo(()=>{const f=eo*jl;return _r.slice(f,f+jl)},[_r,eo]),ed=_r.length>jl,td=b.useMemo(()=>{if(!re||ln.length===0)return null;const f=ln.findIndex(R=>R.id===re.id);return f===-1?null:{hasPrev:f>0,hasNext:f<ln.length-1,prevName:f>0?ln[f-1].name:null,nextName:f<ln.length-1?ln[f+1].name:null,label:`${f+1}/${ln.length}`}},[ln,re]),nd=b.useCallback(f=>{if(!re)return;const R=ln.findIndex(k=>k.id===re.id);R!==-1&&(f==="PREV"&&R>0?Ne(ln[R-1]):f==="NEXT"&&R<ln.length-1&&Ne(ln[R+1]))},[ln,re,Ne]),La=b.useCallback((f,R={})=>{var O,L,H,q,D;if(!f)return"";const k=[],P=f.gender===""?"":"",M=((O=f.stats)==null?void 0:O.aptitude)??"--";return k.push(`${P} ${M} ${f.tierTitle||""}`),(L=f.sect)!=null&&L.name&&k.push(` ${f.sect.name}${f.rank?`  ${f.rank}`:""}`),(H=f.spouse)!=null&&H.name&&k.push(` ${f.spouse.name} `),(q=f.trait)!=null&&q.name&&k.push(`${f.trait.name}`),(D=f.influenceProfile)!=null&&D.label&&k.push(`${f.influenceProfile.label}`),typeof R.descendantCount=="number"&&R.descendantCount>0&&k.push(` ${R.descendantCount} `),`${k.join("")}`},[]),ni=b.useCallback((f,R=[])=>{var M,O;if(!Array.isArray(f)||f.length===0)return;const k=((M=c==null?void 0:c.time)==null?void 0:M.year)??0,P=((O=c==null?void 0:c.time)==null?void 0:O.month)??1;Ge(L=>{const H=new Set(L.map(D=>D.id)),q=[];return f.forEach(D=>{var oe;if(!D||H.has(D.id))return;const se=R.filter(Z=>Z.parentId===D.id).length,le=D.deathReason||(typeof D.lifespan=="number"&&D.lifespan<=0?"":"");q.push({id:D.id,name:D.name,gender:D.gender,avatar:D.avatar,tierTitle:D.tierTitle,generation:D.generation||1,ageAtDeath:Math.max(0,Math.floor(D.age||0)),deathYear:k,deathMonth:P,deathReason:le,sect:D.sect?{...D.sect}:null,rank:D.rank||null,trait:D.trait||null,influenceLabel:((oe=D.influenceProfile)==null?void 0:oe.label)||null,descendants:se,epitaph:La(D,{descendantCount:se})})}),q.length?[...q,...L]:L}),f.forEach(L=>{if(!L)return;const H=L.deathReason||(typeof L.lifespan=="number"&&L.lifespan<=0?"":"");Ae(` ${L.name} ${H} ${Math.max(0,Math.floor(L.age||0))} `)})},[(d0=c==null?void 0:c.time)==null?void 0:d0.year,(u0=c==null?void 0:c.time)==null?void 0:u0.month,La,Ae]),[ri,Es]=b.useState(null),[rd,si]=b.useState(!1),[oi,sd]=b.useState({id:null,name:"",total:0}),[$a,Ba]=b.useState(0),[od,no]=b.useState([]),[Oa,pr]=b.useState(null),[ro,js]=b.useState([]),so=b.useRef(null),{handleExplorationOption:ii,handleStartCombat:id}=UC({player:c,inventory:l,children:J,exploreRealmState:oi,exploreProgress:$a,exploreTeamIds:ro,setPlayer:m,setExploreLog:no,setCombatData:Es,addNpc:(f,R)=>{var k;return(k=so.current)==null?void 0:k.call(so,f,R)},addItemsToInventory:d,inventoryMgr:a,calculateDynamicCombatStats:Sn,simulateCombat:Ui,generateRealmEnemy:tE}),{handleCombatClose:Pa}=GC({player:c,children:J,exploreRealmState:oi,applyCombatResult:h,addLog:Ae,setCombatData:Es,setExploreLog:no,batchUpdateChildren:ue,archiveChildDeaths:ni,addItemsToInventory:d,setIsExploring:si}),ad=b.useCallback(()=>{Pa(ri)},[Pa,ri]),[ai,ld]=b.useState(null),[oo,cd]=b.useState(!1),[li,dd]=b.useState(!1),[io,ud]=b.useState(!1),[za,U]=b.useState(!1),[$e,Dn]=b.useState(!1),[Pt,Qr]=b.useState(!1),[fr,pd]=b.useState(!1),[jt]=b.useState(()=>new Qj),[h1,Cs]=b.useState([]),[ci,Hf]=b.useState({}),Da=b.useCallback(()=>{const f=gi.current;f&&(f.type==="idle"&&typeof window<"u"&&typeof window.cancelIdleCallback=="function"?window.cancelIdleCallback(f.id):clearTimeout(f.id),gi.current=null,Wa.current=null)},[]),Fa=b.useCallback((f,R)=>{try{const k=Xy(f);k.success&&(Gf.current=R,console.log(` : ${k.gameTime}`),window.dispatchEvent(new CustomEvent("autoSaveCompleted",{detail:{gameTime:k.gameTime}})))}catch(k){console.error(":",k)}finally{Wa.current=null}},[]),Wf=b.useCallback((f,R)=>{if(typeof window<"u"){if(typeof window.requestIdleCallback=="function"){window.requestIdleCallback(()=>Fa(f,R),{timeout:1e3});return}if(typeof window.requestAnimationFrame=="function"){window.requestAnimationFrame(()=>Fa(f,R));return}}setTimeout(()=>Fa(f,R),0)},[Fa]),Uf=b.useCallback((f,R)=>{Da();const k=()=>{gi.current=null,Wf(f,R)};if(typeof window<"u"&&typeof window.requestIdleCallback=="function"){const P=window.requestIdleCallback(k,{timeout:1500});gi.current={type:"idle",id:P}}else{const P=setTimeout(k,xT);gi.current={type:"timeout",id:P}}Wa.current=R},[Da,Wf]);b.useEffect(()=>()=>{Da()},[Da]);const[Ts,fd]=b.useState([]),[di,ui]=b.useState([]),[x1,md]=b.useState(!1),[y1,gd]=b.useState([]),[Ha,hd]=b.useState(null),[b1,pi]=b.useState([]),[v1,fi]=b.useState([]),[S1,mi]=b.useState([]),gi=b.useRef(null),Gf=b.useRef(null),Wa=b.useRef(null),Vf=b.useMemo(()=>{if(typeof navigator>"u")return!1;const f=navigator.userAgent||"";return/Android|Adr|OPPO|VIVO|MIUI|HONOR|HUAWEI/i.test(f)},[]);b.useEffect(()=>{Array.isArray(c==null?void 0:c.newsBuffer)&&(c.newsBuffer.length<=ba||m(f=>({...f,newsBuffer:mu(f.newsBuffer)})))},[c==null?void 0:c.newsBuffer,m]),b.useEffect(()=>{var P;const f=!c.specialCollections||!Array.isArray(c.specialCollections.fumoSwords),R=!c.specialFlags||typeof c.specialFlags.fumoDuoUnlocked>"u"||typeof c.specialFlags.fumoDuoMet>"u";if(f||R){m(M=>{var H,q,D;const O=!M.specialCollections||!Array.isArray(M.specialCollections.fumoSwords),L=!M.specialFlags||typeof M.specialFlags.fumoDuoUnlocked>"u"||typeof M.specialFlags.fumoDuoMet>"u";return!O&&!L?M:{...M,specialCollections:O?{...M.specialCollections||{},fumoSwords:[...((H=M.specialCollections)==null?void 0:H.fumoSwords)||[]]}:M.specialCollections,specialFlags:L?{...M.specialFlags||{},fumoDuoUnlocked:((q=M.specialFlags)==null?void 0:q.fumoDuoUnlocked)||!1,fumoDuoMet:((D=M.specialFlags)==null?void 0:D.fumoDuoMet)||!1}:M.specialFlags}});return}if(c&&!c.familyRating&&m(M=>M.familyRating?M:{...M,familyRating:{currentId:Vs[0].id,history:[]}}),c&&!c.combatStats){console.log("...");const M=c.stats||{aptitude:50,luck:50,lifespan:100},O=((P=c.spiritRoot)==null?void 0:P.type)||"",L=Yo(c.tier||"",M.aptitude,O);m(H=>({...H,stats:H.stats||M,spiritRoot:H.spiritRoot||{type:"",elements:["","","","",""],color:"#9E9E9E",multiplier:.5},combatStats:L}))}if(c&&!nh(c.avatar)&&m(M=>nh(M.avatar)?M:{...M,avatar:{...hT,...M.gender?{gender:M.gender}:{}}}),C.some(M=>!M.relationship||M.currentExp===void 0)&&(console.log(" NPC ..."),ae(M=>{const O={...M};if(O.relationship||(O.relationship={stage:0,affection:0,trust:0,jealousy:0}),O.currentExp===void 0){const L=O.tier||"",H=Tn(L);O.tier=L,O.currentExp=Math.floor(Math.random()*H.maxExp*.3),O.maxExp=H.maxExp}return O})),C.some(M=>{var L;if(!M)return!1;const O=vc(M);return!((L=M.stats)!=null&&L.lifespan)||M.stats.lifespan<O})&&ae(M=>{if(!M)return M;const O=M.stats||{},L=vc(M);return O.lifespan&&O.lifespan>=L?M:{...M,stats:{...O,lifespan:L}}}),C.some(M=>!M.memories)){console.log(" NPC ...");const M=C.map(O=>{os.initializeAllNpcs([O]);const L=J.filter(H=>H.fatherName===O.name||H.motherName===O.name);return L.length>0&&os.backfillChildrenMemories(O,L),O});Te(M)}J.some(M=>!M.equipment)&&ue(M=>Si(M)),J.some(M=>M.spiritRoot&&!M.spiritRoot.elements)&&(console.log("..."),ue(M=>M.spiritRoot&&!M.spiritRoot.elements?{...M,spiritRoot:{type:"",elements:["","","","",""],desc:"",color:"#9E9E9E",multiplier:.5}}:M))},[c,C,J]),b.useEffect(()=>{if(!Array.isArray(c.worldNpcs)||c.worldNpcs.length===0){console.log("...");const f=tT(30);m(R=>({...R,worldNpcs:f}))}},[c.worldNpcs]),b.useEffect(()=>{const f=localStorage.getItem("has_read_tutorial_v2");Et==="MAIN"&&!f&&setTimeout(()=>{e.openTutorial()},1e3)},[Et,e]);const w1=()=>{var f;e.closeTutorial(),localStorage.setItem("has_read_tutorial_v2","true"),b.useEffect(()=>{var R;((R=c==null?void 0:c.childrenStrategy)==null?void 0:R.skipZhaozhou)!==void 0&&U(!!c.childrenStrategy.skipZhaozhou)},[(f=c==null?void 0:c.childrenStrategy)==null?void 0:f.skipZhaozhou])};b.useEffect(()=>{if(!oo)return;const f=J.filter(k=>Math.floor(k.age*12)>=144&&k.isTested&&!k.sect);if(f.length===0)return;let R=0;ue(k=>{if(!f.some(O=>O.id===k.id))return k;const M=wd(k);return M?(R++,{...k,sect:M,rank:ea(k,M)}):k}),R>0&&te("",` ${R} `,!0)},[J,oo]);const k1=()=>{localStorage.setItem("has_read_tutorial_v2","true")},E1=()=>{e.closeGuide()},Yf=(p0=t.data)==null?void 0:p0.autoClose,[vT,ST]=b.useState(null),[wT,kT]=b.useState({}),[xd,hi]=b.useState(null);b.useEffect(()=>{if(!xd)return;const f=setTimeout(()=>hi(null),3200);return()=>clearTimeout(f)},[xd]);const[ao,xi]=b.useState([]),[Ua,yd]=b.useState([]),[Is,bd]=b.useState({open:!1,item:null}),j1=b.useCallback(({messageId:f,targetNpcId:R,relation:k,content:P,tone:M})=>{var q;const O=(P||"").trim();if(!O)return{success:!1,error:""};const L={year:c.time.year,month:c.time.month},H=jt.addReplyToMessage(f,{content:O,tone:M==null?void 0:M.id,toneLabel:M==null?void 0:M.label,sentiment:M==null?void 0:M.desc,timestamp:L,from:c.name,affectionDelta:(M==null?void 0:M.affectionDelta)||0});if(!H)return{success:!1,error:""};if(Cs(jt.getAllMessages()),Ae(`${H.message.senderName}`,""),M!=null&&M.affectionDelta&&k!=="child"){const D=C.find(se=>se.id===R);if(D){const se=((q=D.relationship)==null?void 0:q.affection)||0,le=Math.max(0,Math.min(100,se+M.affectionDelta));ne(R,{relationship:{...D.relationship||{},affection:le}})}}return{success:!0}},[jt,c.time.year,c.time.month,c.name,Ae]),Ga=b.useMemo(()=>{var f;return J2((f=c==null?void 0:c.familyRating)==null?void 0:f.currentId)},[(f0=c==null?void 0:c.familyRating)==null?void 0:f0.currentId]),C1=b.useMemo(()=>{let f=0;return J.forEach(R=>{f+=xc(R,{familyRatingMultiplier:Ga})}),f},[J,Ga]),yi=b.useMemo(()=>ow(J,c),[J,c]),T1=b.useCallback(()=>i({type:null,data:null}),[i]),te=b.useCallback((f,R,k=!0,P=null,M=!0,O=null)=>{const L=O||{},H=L.forceManual?!1:M;if(i({type:"RESULT",data:{title:f,msg:R,success:k,changes:P,autoClose:H}}),L.skipLog)return;const q=typeof R=="string"?R:"",D=f||"",se=q.length>20,le=L.message||(se?`${D}`:q||D),oe=L.details!==void 0?L.details:se?q:null,Z=L.title??D,pe=L.category||"",ie=L.type??null;Ae(le,pe,ie,Z,oe)},[Ae]),bi=b.useCallback((f,R,k=null)=>{i({type:"CONFIRM",data:{message:f,onConfirm:R,input:(k==null?void 0:k.input)||null}})},[]),vd=b.useRef(0);b.useEffect(()=>{vd.current=0},[V.length]);const mr=b.useCallback(()=>V.length+vd.current,[V.length]),qf=b.useCallback(f=>{const R=f?`${f}

`:"";te("",`${R}${ROMANCE_LIMIT_MESSAGE}`,!1),Ae("","")},[te,Ae]),vi=b.useCallback(f=>{const R=eh(f);return mr()>=ns?(R.silent||qf(R.contextMessage),!1):!0},[mr,qf]),Rr=b.useCallback((f,R)=>{if(!f)return!1;const k=eh(R);return vi(k)?(vd.current+=1,X(f),!0):!1},[X,vi]);b.useEffect(()=>{so.current=(f,R)=>Rr(f,R||"")},[Rr]);const Kf=b.useCallback(()=>Math.max(0,ns-mr()),[mr]),I1={"XMZM-TEST-2026":{spiritStones:1e5},"XMZM-SKILL-5000-2026":{skillPoints:5e3},"XMZM-SPECIAL-MANUAL-2026":{items:["yin_yang_harmony_manual","blood_demon_manual","chaos_origin_manual","five_elements_supreme_manual","emperor_scripture_manual","deep_ocean_scripture_manual"]}},Qf=b.useCallback(()=>new Set((c==null?void 0:c.usedRedeemCodes)||[]),[c==null?void 0:c.usedRedeemCodes]),Jf=b.useCallback(f=>{m(R=>({...R,usedRedeemCodes:[...f]}))},[m]),_1=b.useCallback(f=>{const R=(f||"").trim();if(!R)return{success:!1,message:""};const k=I1[R];if(!k)return{success:!1,message:""};const P=Qf();if(P.has(R))return{success:!1,message:""};P.add(R),Jf(P),k.spiritStones&&S({spiritStones:k.spiritStones}),k.skillPoints&&m(H=>({...H,skillPoints:(H.skillPoints||0)+k.skillPoints})),k.items&&k.items.length&&d(k.items);const M=[];if(k.spiritStones&&M.push(` ${k.spiritStones} `),k.skillPoints&&M.push(` ${k.skillPoints} `),k.items&&k.items.length){const H=k.items.reduce((q,D)=>(q[D]=(q[D]||0)+1,q),{});Object.entries(H).forEach(([q,D])=>{var le;const se=((le=Vo(q))==null?void 0:le.name)||q;M.push(` ${se} ${D}`)})}const O=`
${M.join(`
`)}`,L={...k.spiritStones?{:k.spiritStones}:{},...k.skillPoints?{:k.skillPoints}:{},...k.items&&k.items.length?k.items.reduce((H,q)=>{var se;const D=((se=Vo(q))==null?void 0:se.name)||q;return H[D]=(H[D]||0)+1,H},{}):{}};return te("",O,!0,L),{success:!0,message:""}},[Qf,Jf,S,d,m,te]),R1=b.useCallback(async()=>{var R,k;let f=!1;if(typeof window<"u"&&((k=(R=window.screen)==null?void 0:R.orientation)!=null&&k.lock))try{await window.screen.orientation.lock("portrait"),f=!0}catch(P){console.warn(":",P)}Ta(!0),!f&&typeof window<"u"&&setTimeout(()=>window.dispatchEvent(new Event("resize")),80),te("",f?"":"",!0)},[te]),M1=b.useCallback(()=>{var f,R;if(typeof window<"u"&&((R=(f=window.screen)==null?void 0:f.orientation)!=null&&R.unlock))try{window.screen.orientation.unlock()}catch(k){console.warn(":",k)}Ta(!1),te("","",!0)},[te]),A1=b.useCallback(()=>{if(!yi.nextTier){te("","",!0);return}if(!yi.canUpgrade){te("","",!1);return}const f=yi.nextTier;m(k=>{var P;return{...k,familyRating:{currentId:f.id,history:[...((P=k.familyRating)==null?void 0:P.history)||[],{id:f.id,name:f.name,year:k.time.year,month:k.time.month}]}}});const R=`${f.name}`;Ae(` ${R}`,""),te("",`${R}

${f.desc}`,!0)},[yi,m,Ae,te]);b.useEffect(()=>{window.showResult=te,window.showConfirm=bi},[te,bi]),b.useEffect(()=>{if(!c.currentAuction||!c.auctionWindowStart||!c.auctionWindowEnd)return;th(c.time.year,c.time.month)>=c.auctionWindowEnd&&y({currentAuction:null,auctionWindowStart:null,auctionWindowEnd:null})},[c.currentAuction,c.auctionWindowStart,c.auctionWindowEnd,c.time.year,c.time.month,y]);const N1=(f,R)=>{if(!f)return{success:!1,title:"",message:""};const k=Math.max(0,R||f.basePrice||0);if((c.resources.spiritStones||0)<k)return{success:!1,title:"",message:""};if(f.type==="SLAVE"&&!vi({contextMessage:"",silent:!0}))return{success:!1,title:"",message:ROMANCE_LIMIT_MESSAGE};E({spiritStones:k});let M="";if(f.type==="SLAVE"){const L=wp(c.tier);L.name=f.name,L.identity="",L.relationship=L.relationship||{},L.relationship.owner=c.name,L.relationship.affection=-20,L.relationship.trust=0,L.relationship.stage=0;const H=B1(f,L);if(L.slavePlot=H,!Rr(L,{contextMessage:`${f.name}`,silent:!0}))return S({spiritStones:k}),{success:!1,title:"",message:ROMANCE_LIMIT_MESSAGE};M=` ${k}  ${f.name}Ta 

${H.intro}`,Ae(" "+k+"  "+f.name)}else if(f.type==="ITEM"&&f.itemId){const L=Sr(f.itemId);if(!L)return{success:!1,title:"",message:""};f.description&&(L.desc=f.description),d([L]),M=` ${k}  ${f.name}`,Ae(` ${k}  ${f.name}`)}else if(f.type==="FUMO_SWORD"){const L=Xg(f.swordId)||{id:f.swordId,name:f.name},H=oT(L)||{instanceId:`fumo_${f.swordId||Date.now()}`,name:f.name,type:"weapon",rarity:"legendary",desc:f.description||f.plot||""};d([H]);const D=L.id&&Tr.includes(L.id)?Tr.length:Tr.length+1,se=Math.max(0,Su-D),le=L.blessing||"",oe=se===0?"":` ${se} `;M=` ${k}  ${f.name}
${le}

${oe}`,Ae(` ${f.name}`,""),z1(L.id||f.swordId)}else{const L={instanceId:"auction_"+Date.now()+"_"+Math.floor(Math.random()*1e4),name:f.name,type:"consumable",rarity:f.rarity||"rare",desc:f.description||f.plot||"",effect:{kind:"exp",amount:3e3}};d([L]),M=` ${k}  ${f.name}`,Ae(` ${k}  ${f.name}`)}const O=[];return f!=null&&f.id&&O.push(`INSTANCE:${f.id}`),(f==null?void 0:f.type)==="ITEM"&&f.itemId&&O.push(`ITEM:${f.itemId}`),(f==null?void 0:f.type)==="FUMO_SWORD"&&f.swordId&&O.push(`FUMO:${f.swordId}`),(f==null?void 0:f.type)==="SLAVE"&&f.id&&O.push(`SLAVE:${f.id}`),O.length===0&&(f!=null&&f.itemId||f!=null&&f.swordId||f!=null&&f.id)&&O.push(f.itemId||f.swordId||f.id),y({soldAuctionItems:[...c.soldAuctionItems||[],...O]}),{success:!0,title:"",message:M}},L1=f=>f.plot||f.description,$1=()=>{const f=th(c.time.year,c.time.month),k=c.auctionWindowStart&&c.auctionWindowEnd&&f>=c.auctionWindowStart&&f<c.auctionWindowEnd;if(c.currentAuction){if(!k){y({currentAuction:null,auctionWindowStart:null,auctionWindowEnd:null}),hi(null),te("","",!1);return}hi(null),i({type:"AUCTION",data:c.currentAuction});return}if(f%36!==0){te("","",!1);return}const P=Zg(c.time.year,{ownedFumoSwords:Tr,soldAuctionItems:c.soldAuctionItems||[]});y({currentAuction:P,lastAuctionYear:c.time.year,auctionWindowStart:f,auctionWindowEnd:f+12}),hi(null),i({type:"AUCTION",data:P})},B1=(f,R)=>{const k=[{intro:`${R.name}Ta`,trauma:"",hope:""},{intro:`${R.name}Ta`,trauma:"",hope:""},{intro:`${R.name}Ta`,trauma:"",hope:""},{intro:`${R.name}Ta`,trauma:"",hope:""}];return{...k[Math.floor(Math.random()*k.length)],unlockStage:2}},Si=f=>{const R=f.equipment||{weapon:null,armor:null,accessory:null};return{...f,equipment:R}},xt=f=>{const R=Si(f);return{...R,combatStats:Sn(R)}},O1={:30,:30,:30,:30,:50,:50,:50,:50,:200,:200,:200,:200,:300,:300,:300,:300,:500,:500,:500,:500},P1=(f=0)=>{for(let R=0;R<qe.length;R++)if(f<qe[R].maxExp)return qe[R];return qe[qe.length-1]},Zt=(f,R=0)=>{var se;const k=(f.cultivation||0)+R,P=f.tierTitle,M=P1(k),O=qe.findIndex(le=>le.name===M.name),L=O>0?qe[O-1].maxExp:0;let H={...f,cultivation:k,tierTitle:M.name,currentExp:k-L,maxExp:M.maxExp-L},q=0;const D=!!P&&P!==M.name;return D&&(q=O1[M.name]||50,H={...H,stats:{...H.stats,lifespan:(((se=H.stats)==null?void 0:se.lifespan)??100)+q}}),{updated:H,tierChanged:D,lifespanIncrease:q,newTier:M.name,prevTier:P}},z1=b.useCallback(f=>{var L,H;if(!f)return;const R=Array.isArray((L=c.specialCollections)==null?void 0:L.fumoSwords)?c.specialCollections.fumoSwords:[];if(R.includes(f))return;I("fumoSwords",f);const k=[...R,f];Tp(k).length===0&&Su>0&&!((H=c.specialFlags)!=null&&H.fumoDuoUnlocked)&&y({specialFlags:{...c.specialFlags||{},fumoDuoUnlocked:!0}});const O=Xg(f);O&&Ae(` ${O.name} `,"")},[c.specialCollections,c.specialFlags,I,y,Ae]),Xf=f=>{if(!f)return 0;const k={common:10,uncommon:50,rare:200,epic:800,legendary:3e3,mythic:8e3}[f.rarity]||10,P=f.type==="weapon"||f.type==="armor"||f.type==="accessory"?2:1;return Math.max(1,Math.floor(k*P))},D1=(f,R)=>{const k=l.find(D=>D.instanceId===f);if(!k){te("","",!1);return}const P=typeof R=="number"?Math.min(R,k.quantity||1):k.quantity||1,M=u(f,P);if(!M){te("","",!1);return}const O=Xf(k),H=Math.floor(O*.7*(M.quantity||1)),q=M.quantity&&M.quantity>1?" x"+M.quantity:"";S({spiritStones:H}),te(""," "+H+"  "+M.name+q+"",!0,{:H}),Ae(""+M.name+q+" "+H+" ")},F1=f=>{if(!l.find(P=>P.instanceId===f)){te("","",!1);return}const k=u(f);if(!k){te("","",!1);return}te("",` ${k.name}${k.quantity&&k.quantity>1?` x${k.quantity}`:""}`,!0),Ae(`${k.name}${k.quantity&&k.quantity>1?` x${k.quantity}`:""}`)},Zf=(f,R)=>{var P;const k=C.find(M=>M.id===f);if(R==="TOGGLE_FOLLOW"){ee(f);return}if(R==="GIFT"){i({type:"GIFT",data:k});return}if(R==="PROPOSE"){const M=au(k,"PERSUADE");if(!M.allowed){te("",M.reason,!1,null,!1,{category:"",type:"PERSUADE",title:"",message:"",details:M.reason,forceManual:!0});return}i({type:"NEGOTIATE",data:k});return}if(R==="SPAR"){const M=au(k,"SPAR");if(!M.allowed){te("",M.reason,!1,null,!1,{category:"",type:"SPAR",title:"",message:"",details:M.reason,forceManual:!0});return}if((c.energy||0)<=0){te("","",!1,null,!1,{category:"",type:"SPAR",title:"",message:"",details:"",forceManual:!0});return}w(1);const O={...c,combatStats:c.combatStats||{maxHp:100,maxMp:50,atk:10,def:5,hp:100,mp:50}},L={...k,combatStats:k.combatStats||{maxHp:100,maxMp:50,atk:10,def:5,hp:100,mp:50}},q=Ui(O,L).winner==="player";let D=0;const se=k.identity==="",le=k.identity==="",oe=k.identity==="";se||le||oe||Math.random()<.3&&(D=q?2:3);const pe=C.find(st=>st.id===f);if(pe){const st=pe.relationship||{},Fn=st.affection||0;let en={...pe,relationship:{...st,affection:Math.min(100,Fn+D)}};en=gk(en,c,Math.floor(c.age),c.time.month,!q),en=Hi(en),ne(f,en)}m(st=>{const Fn={...st,currentExp:(st.currentExp||0)+(q?3:5)};return{...Fn,combatStats:Sn(Fn)}});const ie=uu(k,c),Re=(ie==null?void 0:ie.title)||(q?"":""),De=(ie==null?void 0:ie.description)||(q?` ${k.name}${k.gender===""?"":""}`:` ${k.name}`);te(Re,De,!0,{:D,:q?3:5},!1,{category:"",type:"SPAR",title:Re,message:`${Re}`,details:De,forceManual:!0}),Va(k,"SPAR");return}if(R==="DUAL_CULTIVATION"){const M=au(k,"DUAL_CULTIVATION");if(!M.allowed){te("",M.reason,!1,null,!1,{category:"",type:"DUAL_CULTIVATION",title:"",message:"",details:M.reason,forceManual:!0});return}if((c.energy||0)<=0){te("","",!1,null,!1,{category:"",type:"DUAL_CULTIVATION",title:"",message:"",details:"",forceManual:!0});return}const O=M.requiresCheck;if(O&&!(Math.random()<M.checkRate)){te("",`${k.name}"..."${k.gender===""?"":""}`,!1,null,!1,{category:"",type:"DUAL_CULTIVATION",title:"",message:"",details:`${k.name}${k.gender===""?"":""}`,forceManual:!0});return}const L=50;if(c.resources.spiritStones<L){te("",` ${L} : ${c.resources.spiritStones}`,!1,null,!1,{category:"",type:"DUAL_CULTIVATION",title:"",message:"",details:` ${L}  ${c.resources.spiritStones??0}`,forceManual:!0});return}const H=((P=k.relationship)==null?void 0:P.affection)||0;let q=20,D=1;H>=80?(D=2,q=30):H>=60?(D=1.5,q=25):H>=40&&(D=1.2,q=22);const se=Math.floor(q*D);m(ie=>{const Re={...ie,resources:{...ie.resources,spiritStones:Math.max(0,ie.resources.spiritStones-L)},currentExp:(ie.currentExp||0)+q,energy:Math.max(0,(ie.energy||0)-1)};return{...Re,combatStats:Sn(Re)}});const le=C.find(ie=>ie.id===f);if(le){const ie=le.relationship||{},Re=ie.affection||0;let De={...le,currentExp:(le.currentExp||0)+se,relationship:{...ie,affection:Math.min(100,Re+5)},dualCultivationCount:(le.dualCultivationCount||0)+1};De=hk(De,c,Math.floor(c.age),c.time.month),De=Hi(De),ne(f,De)}let oe;O?oe=`${k.name}${k.gender===""?"":""}

${k.gender===""?"":""}

""${k.gender===""?"":""}""`:oe=` ${k.name} ${H>=80?"":H>=60?"":""}`;const Z=O?"":"",pe=O?"BUDDHA_FIRST_DUAL":"DUAL_CULTIVATION";te(Z,oe,!0,{:5,:q,[`${k.name}`]:se,:-L,:-1},!1,{category:"",type:pe,title:Z,message:`${Z}`,details:oe,forceManual:!0}),H>=70&&Math.random()<.3&&Ft(c.newsBuffer,"DUAL_CULTIVATION",{actor:c.name,target:k.name}),Va(k,"DUAL_CULTIVATION");return}if(R==="CHAT"){if((c.energy||0)<=0){te("","",!1,null,!1,{category:"",type:"CHAT",title:"",message:"",details:"",forceManual:!0});return}w(1);const M=k.identity==="",O=k.identity==="",L=k.identity==="",H=M||O||L,D=(H?Math.random()<.05:!0)?uu(k,c):null;if(D){const ie=k.relationship||{},Re=ie.affection||0;ne(f,{relationship:{...ie,affection:Math.min(100,Re+(D.affectionBonus||2))}});const De=(D==null?void 0:D.title)||"",st=(D==null?void 0:D.text)||"";te(De,st,!0,{:(D==null?void 0:D.affectionBonus)||2},!1,{category:"",type:"CHAT_EVENT",title:De,message:`${De}`,details:st,forceManual:!0});return}const se=H?.05:.15;if(Math.random()<se){const ie=CE(k);if(ie){i({type:"EVENT",data:{npc:k,event:ie}});return}}const le=Ej(k),Z=k.identity===""||M||O||L;if(Z){let ie=pg(k,c,Math.floor(c.age),c.time.month);ie=Hi(ie),ne(f,ie)}else{const ie=k.relationship||{},Re=ie.affection||0;let De={...k,relationship:{...ie,affection:Re+2}};De=pg(De,c,Math.floor(c.age),c.time.month),De=Hi(De),ne(f,De)}const pe=` ${k.name} ${k.gender===""?"":""}
"${le}"`;te("",pe,!0,Z?{}:{:2},!1,{category:"",type:"CHAT",title:`${k.name}`,message:`${k.name}`,details:pe,forceManual:!0}),Va(k,"CHAT")}R==="DETAIL"&&$(k)},Va=(f,R)=>{const k=Uj(c,f,C,R);if(k.length>0){const P=new Set(k.map(H=>H.id)),M=[],O={CHAT:"",GIFT:"",SPAR:"",DUAL_CULTIVATION:""};if(F(H=>H.map(q=>{var pe,ie;if(!P.has(q.id))return q;const D=Wj(q,f,R);if(D===0)return q;const se=((pe=q.relationship)==null?void 0:pe.jealousy)||0,le=Math.min(100,se+D),oe=new Set([...((ie=q.relationship)==null?void 0:ie.rivalNpcs)||[],f.id]);let Z={...q,relationship:{...q.relationship||{},jealousy:le,rivalNpcs:Array.from(oe),lastInteraction:c.time.month}};return M.push({witnessName:q.name,targetName:f.name,increase:D,newJealousy:le,level:Hj(le).label,actionLabel:O[R]||""}),Z=fg(Z,c,c.time.year,c.time.month,f,le),le>=41&&Math.random()<.3&&(Z=xk(Z,c,c.time.year,c.time.month)),le>=60&&Math.random()<.25&&Ft(c.newsBuffer,"NPC_JEALOUSY",{actor:q.name,target:c.name,rival:f.name}),Z})),M.length>0){const H=M.map(q=>`${q.level}${q.witnessName}${q.targetName}${q.actionLabel} +${q.increase}  ${q.newJealousy}`).join(`

`);Ae(`${M[0].witnessName} ${M[0].newJealousy}`,"","JEALOUSY","",H),fr||yd(q=>[...q,{id:`${c.time.year}-${c.time.month}-${Date.now()}`,alerts:M,summary:H,actionLabel:O[R]||"",timestamp:{year:c.time.year,month:c.time.month},targetName:f.name}])}k.find(H=>{var D;return(((D=H.relationship)==null?void 0:D.jealousy)||0)>=60})&&Ae("...")}},{handleGiftConfirm:H1,handleNegotiateConfirm:W1,handleOptionSelect:e0,handleShuraFieldSelect:U1}=VC({player:c,inventory:l,activeNpcs:C,modalState:t,setModalState:i,removeItemFromInventory:u,updateNpc:ne,setActiveNpcs:F,batchUpdateNpcsByMap:Be,setSelectedNpc:$,showResult:te,addLog:Ae,handleWitnessCheck:Va,pushToNewsBuffer:Ft,isUsageAllowedForTarget:Rs,RESOURCE_USAGE:ft,formatUsageTargets:ho}),G1=f=>{if(f==="CULTIVATE"){if((c.energy||0)<=0){te("","",!1);return}const R=10+Math.floor(Math.random()*5);m(k=>{const P={...k,currentExp:k.currentExp+R,energy:Math.max(0,(k.energy||0)-1)};return{...P,combatStats:Sn(P)}}),te("","",!0,{:R})}if(f==="WORK"){if((c.energy||0)<=0){te("","",!1);return}const R=15;S({spiritStones:R}),w(1),te("","",!0,{:R})}},V1=()=>{if(c.resources.spiritStones<10){te("",` 10 : ${c.resources.spiritStones}`,!1);return}E({spiritStones:10});const R=3+Math.floor(Math.random()*3),k=[],P={common:[{id:"herb_bandage",basePrice:15},{id:"rice_ball",basePrice:10}],uncommon:[{id:"beast_fang",basePrice:80},{id:"beast_core",basePrice:120},{id:"iron_sword",basePrice:100}],rare:[{id:"foundation_pill",basePrice:350},{id:"thunder_wood",basePrice:400},{id:"iron_armor",basePrice:450}],epic:[{id:"core_pill",basePrice:800},{id:"artifact_supreme",basePrice:1200},{id:"marrow_wash",basePrice:900}],legendary:[{id:"nascent_fruit",basePrice:2500},{id:"heaven_manual",basePrice:3e3}]},M=Y2(c.tier);let O={common:60,uncommon:25,rare:10,epic:4,legendary:1};M>=6&&M<20?O={common:50,uncommon:27,rare:14,epic:7,legendary:2}:M>=20&&(O={common:45,uncommon:25,rare:18,epic:9,legendary:3});for(let L=0;L<R;L++){const H=q1(O),q=P[H];if(q&&q.length>0){const D=q[Math.floor(Math.random()*q.length)],se=Sr(D.id);if(se){const le=.8+Math.random()*.4;se.price=Math.floor(D.basePrice*le),k.push(se)}}}i({type:"SHOP",data:{items:k}})},Y1=b.useCallback((f,R=1,k)=>{var H;if(!f)return;const P=Math.max(1,parseInt(R,10)||1),M=typeof k=="number"?k:(f.price||0)*P;if((((H=c==null?void 0:c.resources)==null?void 0:H.spiritStones)||0)<M)return;const L=[];if(f.stackable)L.push({...f,quantity:P,instanceId:`${f.id}_${Date.now()}_${Math.floor(Math.random()*1e4)}`});else for(let q=0;q<P;q++){const D=Sr(f.id);D&&L.push(D)}L.length!==0&&(E({spiritStones:M}),d(L))},[(m0=c==null?void 0:c.resources)==null?void 0:m0.spiritStones,E,d]),q1=f=>{const R=Object.values(f).reduce((P,M)=>P+M,0);let k=Math.random()*R;for(const[P,M]of Object.entries(f)){if(k<M)return P;k-=M}return"common"},K1=b.useCallback(()=>{const f=wu.map(iT).filter(Boolean);if(f.length===0)return;const R=new Set(C.map(M=>M.id)),k=f.filter(M=>!R.has(M.id)).map(M=>ug(M,c,c.time.year,c.time.month));if(k.length>0){if(Kf()<k.length){vi({contextMessage:""});return}k.forEach(O=>Rr(O,""))}m(M=>{const O=new Set((M.worldNpcs||[]).map(H=>H.id)),L=wu.map(H=>aT(H,c.time.year)).filter(H=>H&&!O.has(H.id));return{...M,specialFlags:{...M.specialFlags||{},fumoDuoUnlocked:!0,fumoDuoMet:!0},worldNpcs:[...M.worldNpcs||[],...L]}}),wu.forEach(M=>{var O;Ae(` ${((O=M.world)==null?void 0:O.rankHint)||""}${M.name}`,"")});const P="";te("",P,!0,null,!1,{category:"",type:"FUMO_LEGEND",title:"",message:P})},[Ae,c,c.time.year,c.time.month,m,te,Kf,vi,Rr]),Q1=b.useCallback(f=>{if(C.some(P=>P.id===f.id)){Ae(`${f.name}`,"");return}const k=t0(f);Rr(k,`${f.name} `)&&(v(f.id,{hasMetPlayer:!0}),Ae(` ${f.name}`,""))},[C,Ae,Rr,v]),J1=b.useCallback(f=>{var D;if(!f)return;if(f.status==="DEAD"){te("","",!1);return}if(c.tier===""){te("","",!1);return}const R=((D=f.sect)==null?void 0:D.name)||"",k={...c,combatStats:c.combatStats||{maxHp:100,maxMp:50,atk:10,def:5,hp:100,mp:50}},P=f.combatStats?f:{...f,combatStats:Sn(f)},M=Jn(k).total,O=Jn(P).total,{prob:L}=_y(k,P),H=Math.max(1,Math.min(99,Math.round(L*100))),q=`${R}${f.name}

${M}
${O}
${H}%

`;bi(q,()=>{const se=Ui(k,P);Es({enemy:P,result:se,context:"sectLeader",worldNpc:P,onVictory:()=>{Ae(` ${R}${f.name}`,"");const le=`${R}${f.name}

`;bi(le,()=>{var Z;const oe=((Z=c.time)==null?void 0:Z.year)??c.age??0;v(f.id,{status:"DEAD",deathYear:oe,deathReason:""}),Y(pe=>pe&&pe.id===f.id?{...pe,status:"DEAD",deathYear:oe,deathReason:""}:pe),te("",`${R}${f.name}`,!0,null,!1,{category:"",title:"",message:`${R}${f.name}`})})},onDefeat:()=>{_(),te("",`${R}${f.name}`,!1,null,!1,{category:"",title:"",message:`${R}${f.name}`})}})})},[Ae,c,bi,te,v,Y,_,Sn,Es]),t0=f=>{var k;return{id:f.id,name:f.name,gender:f.gender,identity:f.title||"",appearance:((k=f.appearance)==null?void 0:k.description)||"",desc:f.signature||"",tier:f.tier,currentExp:f.currentExp||0,maxExp:f.maxExp||500,stats:f.stats||{aptitude:85,looks:80,intelligence:85,health:90},spiritRoot:f.spiritRoot||{type:"",elements:[""],multiplier:1.8},relationship:{stage:0,affection:0,trust:0,jealousy:0},trait:{name:"",bonuses:{speedMultiplier:1.2}},sect:f.sect,sectId:f.sectId,sectRank:f.sectRank,sectStatus:f.sectStatus||"active",combatStats:f.combatStats||{hp:1e3,maxHp:1e3,atk:100,def:50,mp:500,maxMp:500},isTested:!0,isWorldElite:!0,isFollowed:!1,age:f.age||100,personality:f.personality,acceptsLetters:!0,isPregnant:!1,cultivationMethod:"basic_breath",constitution:f.constitution,avatar:f.avatar||{base:Math.floor(Math.random()*3),skinColor:Math.floor(Math.random()*5),eye:Math.floor(Math.random()*3),eyeColor:Math.floor(Math.random()*5),mouth:Math.floor(Math.random()*3),hair:Math.floor(Math.random()*3),hairColor:Math.floor(Math.random()*5)}}},X1=()=>{var P;if(c.resources.spiritStones<5){te("",` 5 : ${c.resources.spiritStones}`,!1);return}if(mr()>=ns){te("",`

(: ${mr()}/${ns})`,!1,null,!1,{skipLog:!0});return}if(E({spiritStones:5}),Qc){K1();return}const k=(c.worldNpcs||[]).filter(M=>M.status==="ALIVE"&&M.gender!==c.gender&&!M.hasMetPlayer);if(Math.random()<.05&&k.length>0){const M=k[Math.floor(Math.random()*k.length)],O=t0(M);if(!C.find(q=>q.id===O.id)&&!Rr(O,` ${M.name}

${M.gender===""?"":""}`))return;v(M.id,{hasMetPlayer:!0,firstMetYear:c.age});const H=`${M.gender===""?"":""}

${M.title} ${M.name}${M.gender===""?"":""}${M.tier}${M.gender===""?"":""}${((P=M.appearance)==null?void 0:P.description)||""}

${M.gender===""?"":""}...

 ${M.name}`;te(` ${M.name}`,H,!0,null,!1),Ae(` ${M.title} ${M.name}`,"");return}if(Math.random()<.4){const M=wp(c.tier);let O="";if(M.identity===""?O=`${M.identity}${M.appearance}`:M.identity===""?O=`${M.identity}${M.appearance}`:M.identity===""?O=`${M.identity}${M.appearance}`:O=`${M.identity}${M.appearance}${M.desc.includes("")?"":""}`,!Rr(M,O))return;te(`${M.name}`,O,!0,null,!1)}else te("","",!1,{:-5})},Z1=b.useCallback((f,R)=>{var P;ne(f,{acceptsLetters:R}),$(M=>M&&M.id===f?{...M,acceptsLetters:R}:M);const k=((P=C.find(M=>M.id===f))==null?void 0:P.name)||"";Ae(R?`  ${k} `:`  ${k} `,"")},[C,Ae,ne]),eb=()=>{Ae("..."),ae(f=>f.id===1||f.id===2?ug(f,c,c.time.year,c.time.month):f),lr("MAIN")},tb=(f=1,R=null)=>{let k;if(R)k=R;else{const M=mu(c.newsBuffer);k={player:c,children:J,fallenChildren:fe,activeNpcs:C,deadNpcs:j,gameStage:Et,logs:dr,inventory:l,messages:jt.toJSON(),lastMessageCheck:ci,pendingSectChoices:di,testQueue:Ts,worldEvents:c.worldEvents||[],newsBuffer:M}}return Qy(k,f)},n0=async(f=1,R=null)=>{try{let k;if(R)k=R;else try{k=await Of(f)}catch(O){console.warn(":",O),k=Po(f)}if(!k||!k.player)throw new Error("");k=d5(k);const P=f5(k.player);m(O=>{var L;return{...k.player,businesses:((L=k.player)==null?void 0:L.businesses)||[]}}),Ce(k.children||[]),F(k.activeNpcs||[]),B(k.deadNpcs||[]);const M=Array.isArray(k.inventory)?k.inventory:[];if(a&&a.setInventory(M),lr(k.gameStage||"MAIN"),_a(k.logs||[]),k.messages&&Cs(Array.isArray(k.messages)?k.messages:[]),Hf(k.lastMessageCheck||{}),k.pendingSectChoices&&ui(k.pendingSectChoices),k.testQueue&&fd(k.testQueue),Ge(k.fallenChildren||[]),zn(!1),Ne(null),i({type:null,data:null}),R){let O=`
${k.gameTime||""}
${k.saveDate||""}`;P&&(O=P+`

`+O),te("",O,!0,null,!1)}else{let O=`
: ${f}
${k.saveDate||""}`;P&&(O=P+`

`+O),te("",O,!0,null,!1)}}catch(k){console.error(":",k),te("","",!1,null,!1)}},nb=()=>{S2(async()=>{const{clearAllSaves:f}=await Promise.resolve().then(()=>i5);return{clearAllSaves:f}},void 0,import.meta.url).then(({clearAllSaves:f})=>{f(),te("","",!0,null,!1)})},rb=(f,R)=>{if(c.resources.spiritStones<f.cost){te("","",!1);return}if(c.resources.spiritStones<f.cost){te("",`${f.name} ${f.cost} : ${c.resources.spiritStones}`,!1);return}const k=J.find(M=>M.id===R),P=Math.floor(f.baseIncome*(1+k.stats.intelligence/100));g({id:`${f.id}-${Date.now()}`,name:f.name,managerId:R,baseIncome:f.baseIncome,income:P,type:f.id,cost:f.cost}),nt(R,{job:f.id}),te("",`${f.cost}${f.name}${k.name}: ${P}`,!0)},sb=(f,R)=>{if(c.resources.spiritStones<f.cost){te("",`${f.name} ${f.cost} : ${c.resources.spiritStones}`,!1);return}if((c.energy||0)<5){te("",`${f.name} 5 : ${c.energy||0}`,!1);return}if(mr()>=ns){te("",`

(: ${mr()}/${ns})

`,!1);return}E({spiritStones:f.cost}),w(5),sd({id:f.id,name:f.name,total:10}),js(R),Ba(1);const k=R.map(O=>{var L;return(L=J.find(H=>H.id===O))==null?void 0:L.name}).filter(Boolean).join(""),P=`${f.name}${k||""}`;no([P,`${f.name}`,`${f.difficulty}${f.recommendCP}`]);const M=wg({realmId:f.id,progress:1});pr(M),si(!0),Ae(P,"exploration")},ob=b.useCallback(f=>{var k;if(!f)return;const R=[f.tierTitle?`${f.tierTitle}`:null,typeof f.ageAtDeath=="number"?`${f.ageAtDeath}`:null,f.deathYear?` ${f.deathYear} ${f.deathMonth||1}`:null,f.deathReason?`${f.deathReason}`:null,(k=f.sect)!=null&&k.name?`${f.sect.name}${f.rank?`  ${f.rank}`:""}`:null,typeof f.descendants=="number"?`${f.descendants}`:null,f.influenceLabel?`${f.influenceLabel}`:null].filter(Boolean).join(`
`);te(`  ${f.name}`,`${f.epitaph||""}

${R}`,!0,null,!1)},[te]),ib=f=>{ge(R=>R.id===f.id,R=>{const k={...R,isTested:!0,spiritRoot:f.spiritRoot};return xt(k)})},Sd=b.useCallback((f=!1)=>{var v0,S0,w0,k0,E0,j0,C0,T0;let R=[];const k=K=>f?!K.includes(""):!0;let P=[],M=0;const O=C.map(K=>{if(K.isPregnant){const xe=K.pregnancyProgress+1;if(xe>=9){const ye=aE(c,K,Math.floor(c.age));P.push(ye),R.push(`${K.name}${ye.name}${ye.gender}${ye.tier}`),Ft(c.newsBuffer||[],"BIRTH",{actor:c.name,target:ye.name,detail:ye.gender}),M+=1;let Me=vk(K,c,Math.floor(c.age),c.time.month,ye.name);const We=Math.random()>.7?"":"",Ye=Math.random()>.85;return os.onChildBirth(Me,ye,{difficulty:We,sacrifice:Ye}),{...Me,isPregnant:!1,pregnancyProgress:0}}return{...K,pregnancyProgress:xe}}return K});Te(O),O.some(K=>{var ye;return(((ye=K.customFlags)==null?void 0:ye.isFumoLegend)||K.identity===""||K.identity==="")&&K.isPregnant&&K.pregnancyProgress===8})&&console.log(" NPC8 - ");const H=((v0=c.stats)==null?void 0:v0.health)||50,q=Bt(H);y({energy:q});const D=((S0=c==null?void 0:c.time)==null?void 0:S0.year)??3572,{newChildren:se,generation3Plus:le,totalCost:oe,logs:Z,events:pe}=lE(J||[],c.resources,{familyRatingMultiplier:Ga,playerStrategy:c,childrenStrategy:c==null?void 0:c.childrenStrategy,generation3Plus:(c==null?void 0:c.generation3Plus)||[],currentYear:D,worldNpcs:c.worldNpcs||[]});m(K=>({...K,generation3Plus:le}));let ie=[...se];const Re=new Set(((c==null?void 0:c.exiledChildren)||[]).map(K=>K.id)),De=ie.filter(K=>{const xe=Math.floor(K.age*12);return xe>=72&&xe<78&&!K.isTested&&!Re.has(K.id)});if(De.length>0){const K=new Set(De.map(ye=>ye.id));ie=ie.map(ye=>{var Me,We,Ye;if(K.has(ye.id)){const rt=((Me=ye.stats)==null?void 0:Me.aptitude)||50,at=C.find(Rt=>Rt.name===ye.fatherName);let mt=null;if(at&&(((We=at.customFlags)==null?void 0:We.isFumoLegend)||at.identity===""||at.identity==="")&&(Ye=at.spiritRoot)!=null&&Ye.type){let dn=0;rt>=75?dn=.85:rt>=70?dn=.75:rt>=65?dn=.6:rt>=60?dn=.45:dn=.2,Math.random()<dn&&(mt={...at.spiritRoot,multiplier:(at.spiritRoot.multiplier||1)*.9})}mt||(mt=tr(rt,ye.spiritRoot,null,{constitution:ye.constitution}));const yt={...ye,spiritRoot:mt,isTested:!0};if(li||(ye.generation||1)>1){const Rt=xt(yt);return R.push({message:` ${ye.name} ${mt.type}${rt}`,category:""}),Rt}return yt}return ye});const xe=li?[]:ie.filter(ye=>De.some(Me=>Me.id===ye.id)&&(ye.generation||1)===1);xe.length>0&&(fd(ye=>[...ye,...xe]),cn&&zn(!1))}P.length>0&&(ie=[...ie,...P]);const st=ie.reduce((K,xe)=>(yT(xe)?K.casualties.push(xe):K.survivors.push(xe),K),{survivors:[],casualties:[]});st.casualties.length>0&&(ni(st.casualties,ie),re&&st.casualties.some(K=>K.id===re.id)&&Ne(null)),ve(st.survivors);const Fn=pe.filter(K=>K.type==="GRANDCHILD_BIRTH");if(M+=Fn.length,M>0&&R.push(` ${M}${M}`),R=[...R,...Z],pe.length>0){pe.filter(ye=>ye.type==="ZHAOZHOU").forEach(ye=>{te(ye.title,ye.message,!0,null,!1)});const K=pe.filter(ye=>ye.type==="CHILD_PROMOTION_GIFT");if(K.length>0){const ye=K.map(Me=>{const We=typeof Me.message=="string"?Me.message:String(Me.message||"");return{...Me,message:We}});ye.length>=2&&!io?(fi(ye),e.openBatchPromotionModal()):ye.forEach(Me=>{const We=Me.giftItemId?Sr(Me.giftItemId):null;We&&d([We]);const Ye=Me.title||"";io||te(Ye,Me.message,!0,null,!1)})}const xe=pe.filter(ye=>{var Me;return ye.type==="JOIN_SECT"&&!Re.has((Me=ye.child)==null?void 0:Me.id)});if(xe.length>0)if(oo){let ye=0;ue(Me=>{if(!xe.find(at=>{var mt;return((mt=at.child)==null?void 0:mt.id)===Me.id})||!(Math.floor(Me.age*12)>=144)||!Me.isTested||Me.sect||Re.has(Me.id))return Me;const rt=wd(Me);return rt?(ye++,{...Me,sect:rt,rank:ea(Me,rt)}):Me}),ye>0&&te("",` ${ye} `,!0)}else ui(ye=>{const Me=[...ye,...xe];return Me.sort((We,Ye)=>{var at,mt;return(((at=We.child)==null?void 0:at.name)||"").localeCompare(((mt=Ye.child)==null?void 0:mt.name)||"")}),Me}),cn&&zn(!1)}if(c.businesses&&c.businesses.length>0&&ie){const{income:K,logs:xe}=Eg(c.businesses,ie);R=[...R,...xe],K>0&&R.push(` : ${K} `)}let en=0;if(ie.forEach(K=>{try{const xe=xc(K,{familyRatingMultiplier:Ga});typeof xe=="number"&&!isNaN(xe)&&isFinite(xe)?en+=xe:console.warn("Invalid feedback for child:",K.name,xe)}catch(xe){console.error("Error calculating feedback for child:",K.name,xe)}}),c.rival&&!c.rival.isDead){const K=O5(c),xe=c.rival.threatLevel||0,ye=Math.min(100,xe+K);c.rival.threatLevel=ye,c.rival._threatChangeThisMonth={from:xe,to:ye,increased:K};const Me=$5(c);if(Me){const{survived:We,message:Ye,type:rt,hpLoss:at}=Me,mt=We?"":"";f&&zn(!1),R.push(`${mt}${Ye}`);let yt="";if(at&&at>0){const Mr=Math.max(10,Math.floor(at*.2+Math.random()*at*.2)),Rt=qo(c,Mr,"ASSASSINATION");if(c.stats.health=Rt.newHealth,Rt.energyPenalty>0){const dn=Bt(Rt.newHealth);c.energy=Math.min(c.energy||20,dn)}yt=Rt.message,Rt.isSerious&&R.push(" ")}Ft(c.newsBuffer||[],rt||(We?"ASSASSINATION_SURVIVED":"ASSASSINATION_INJURED"),{actor:c.name}),te("",yt?`${Ye}
${yt}`:Ye,We,null,!1)}if(c.time.month===12){const We=B5(c);We&&Ft(c.newsBuffer||[],We.type,We.data)}}if(!((w0=c.rival)!=null&&w0.isDead)){const K=(k0=c.rival)==null?void 0:k0._threatChangeThisMonth,xe=(K==null?void 0:K.from)||0,ye=((E0=c.rival)==null?void 0:E0.threatLevel)||0;if(xe<100&&ye>=100){f&&zn(!1),console.log("100%",{previousThreat:xe,currentThreat:ye});const We={currentExp:((j0=c.rival)==null?void 0:j0.currentExp)||300,stats:{aptitude:80}},Ye=Jn(We),rt={name:"",combatStats:{hp:Math.floor(Ye*2.5),atk:Math.floor(Ye*.4),def:Math.floor(Ye*.2),mp:0,maxHp:Math.floor(Ye*2.5),maxMp:0}},at={...c,combatStats:c.combatStats||{maxHp:100,maxMp:50,atk:10,def:5,hp:100,mp:50}},mt=Ui(at,rt);Es({enemy:rt,result:mt,context:"rival"}),m(yt=>({...yt,rival:{...yt.rival,threatLevel:0}}))}}m(K=>{var Xr;const xe={...K.time};xe.month+=1,xe.month>12&&(xe.month=1,xe.year+=1);const ye=(K.age||16)+1/12,Me=uw(K);let We=((Xr=K.stats)==null?void 0:Xr.health)||50,Ye=K.energy||20;if(Me&&Me.recovered>0){We=Me.newHealth,R.push(Me.message);const Ka=Bt(We);Ka>Ye&&(Ye=Ka)}const rt={...K,energy:Ye,stats:{...K.stats,health:We},resources:K.resources||{spiritStones:0,spiritualAwareness:0}},at=Tn(rt.tier),mt=Vc(rt,!0),yt=typeof mt=="number"&&isFinite(mt)?mt:0,Mr=typeof en=="number"&&isFinite(en)?en:0;let Rt=rt.currentExp+yt+Mr;(!isFinite(Rt)||isNaN(Rt))&&(console.error("Invalid newExp calculation:",{currentExp:rt.currentExp,playerSpeed:yt,totalFeedback:Mr}),Rt=rt.currentExp),Rt>=at.maxExp&&(Rt=at.maxExp);const{income:dn}=Eg(rt.businesses||[],ie),gr={...rt,age:ye,skillPoints:(rt.skillPoints||0)+M,time:xe,currentExp:Rt,maxExp:(at==null?void 0:at.maxExp)||5e5,resources:{...rt.resources,spiritStones:Math.max(0,rt.resources.spiritStones-oe+10+dn)}};try{return{...gr,combatStats:Sn(gr)}}catch(Ka){return console.error("Error calculating combat stats:",Ka),gr}}),R.length===0&&R.push("..."),R.forEach(K=>{k(K)&&Ae(K)});const Ct=c.time.month===12?1:c.time.month+1,Mn=c.time.month===12?c.time.year+1:c.time.year;try{const xe=(c.time.year-3572)*12+c.time.month+1;if(xe%36===0){const ye=c.time.year+(Ct===1?1:0),Me=Zg(ye,{ownedFumoSwords:Tr,soldAuctionItems:c.soldAuctionItems||[]}),We=xe,Ye=We+12;m(rt=>({...rt,lastAuctionYear:ye,currentAuction:Me,auctionWindowStart:We,auctionWindowEnd:Ye})),hi({id:`${ye}-${Date.now()}`,message:""}),Ae(" ")}}catch(K){console.warn("",K)}let Jr;try{Jr=zk(O,c,Mn,Ct)}catch(K){console.error("Error processing NPC lifecycles:",K),Jr={npcs:O,events:[]}}const h0=(Jr==null?void 0:Jr.npcs)||O,Ed=(Jr==null?void 0:Jr.events)||[],x0=Ed.filter(K=>K.type==="NPC_LIFESPAN_ALERT");if(x0.length>0){const K=x0.map(xe=>{const ye=Math.max(0,Math.floor(xe.remainingYears));return`${xe.npcName} ${ye} `});te("",K.join(`
`),!1,null,!1,{title:"",category:"",type:"WARNING"}),cn&&zn(!1)}const qa=Ed.filter(K=>K.type==="NPC_GIFT");if(qa.length>0)if(qa.length>=2&&!Pt)pi(qa),e.openBatchGiftModal();else{const K=[];if(qa.forEach(xe=>{const ye=Sr(xe.giftItemId);if(ye){d([ye]);const Me=`${xe.message}${ye.name}`;Ae(Me),K.push(`${xe.message}
${ye.name}`)}}),!Pt&&K.length>0){const xe=K.join(`

`);te("",xe,!0,null,!1,{category:"",type:"NPC_GIFT",title:"",message:xe,details:xe,forceManual:!0})}}const wi=h0.filter(K=>!K.isDead),jd=h0.filter(K=>K.isDead);jd.length>0&&(B(K=>[...K,...jd]),jd.forEach(K=>{const xe=e5(K,c,{year:Mn,month:Ct});jt.addMessage(xe)}),Cs(jt.getAllMessages())),Ct%3===0&&(wi.forEach(K=>{var Rt,dn;if(!(K.sect||K.status==="away"))return;const ye=localStorage.getItem("acceptChildLetters")!=="false",Me=localStorage.getItem("acceptLoverLetters")!=="false",We=K.fatherName||K.motherName||K.generation||K.parent||K.parentId||((Rt=c.children)==null?void 0:Rt.some(gr=>gr.id===K.id)),Ye=K.id===((dn=c.spouse)==null?void 0:dn.id)||K.affection>60&&!We;if(We&&!ye||Ye&&!Me)return;const rt=ci[K.id]||0,at=Mn*12+Ct,mt=at-rt,Mr=jt.getAllMessages().find(gr=>gr.senderId===K.id&&gr.type===At.LETTER);if(Zj(K,mt,Mr)){const gr=jt.getRecentRepliesForNpc(K.id,3);Og(K,c,{year:Mn,month:Ct},!0,{apiKey:localStorage.getItem("game_api_key")||"",apiUrl:localStorage.getItem("game_api_url")||"https://api.deepseek.com/chat/completions",apiModel:localStorage.getItem("game_api_model")||"deepseek-chat",useAIForLetter:localStorage.getItem("useAIForLetter")!=="false"},{children:J,exiledChildren:c.exiledChildren||[],dualCultivationCount:K.dualCultivationCount||0,replyHistory:gr}).then(Xr=>{jt.addMessage(Xr),Cs(jt.getAllMessages())}).catch(Xr=>{console.error(":",Xr)}),Hf(Xr=>({...Xr,[K.id]:at}))}}),Cs(jt.getAllMessages())),Ed.forEach(K=>{var xe;if(K.type==="NPC_DEATH")R.push(` ${K.message}`),Ft(c.newsBuffer||[],"DEATH",{actor:K.npcName,detail:K.age||0,location:""});else if(K.type==="NPC_BREAKTHROUGH"){R.push(` ${K.message}`),Ft(c.newsBuffer||[],"NPC_BREAKTHROUGH",{actor:K.npcName,detail:K.newTier});const ye=wi.find(Me=>Me.name===K.npcName);ye&&((xe=ye.relationship)==null?void 0:xe.affection)>=70&&Math.random()<.4&&Ft(c.newsBuffer||[],"NPC_AFFECTION_HIGH",{actor:c.name,target:ye.name})}else K.type==="NPC_BREAKTHROUGH_FAIL"&&Ft(c.newsBuffer||[],"BREAKTHROUGH_FAIL",{actor:K.npcName,detail:K.tier})});const Cd=kk(wi,c,Mn,Ct),Lb=Cd.map(K=>{K.jealousy||(K.jealousy=0),K.lastInteraction||(K.lastInteraction={year:Mn,month:Ct});const xe=Mn*12+Ct,ye=K.lastInteraction.year*12+K.lastInteraction.month,Me=xe-ye;if(Me>=3){const{jealousyGain:We,shouldLog:Ye}=Gj(K,Me);if(We>0&&(K.jealousy=Math.min(100,(K.jealousy||0)+We),Ye)){const rt=fg(K,K.jealousy,{year:Mn,month:Ct},c.name,"neglect");rt&&(K.logs=[...K.logs||[],rt])}}if(K.jealousy>0){const We=Vj(K);K.jealousy=Math.max(0,K.jealousy-We)}return K});Te(Lb);const y0=lj(Mn,Ct,c,Cd),b0=mj(c,ie,Mn,Ct);b0&&y0.push(b0),y0.forEach(K=>{Ae(K.message,K.category,K.type,K.title)});let ki=c.worldNpcs||[];if(Ct%3===0&&ki.length>0&&(ki=Jg(ki,Mn),y({worldNpcs:ki})),Ct%3===0)if(localStorage.getItem("enableGazette")!=="false"){const xe=c.newsBuffer||[],ye=xe.length>0?xe:[{type:"FILLER",data:{},timestamp:Date.now()}];localStorage.getItem("game_api_key"),localStorage.getItem("game_api_url"),localStorage.getItem("game_api_model"),localStorage.getItem("useAIForGazette");const Me={...c,worldNpcs:ki};y({newsBuffer:[],hasUnreadGazette:!1}),Promise.resolve(w5(ye,Me,Cd,(Me.gazetteIssue||0)+1)).then(We=>{We&&(y({gazetteHistory:[...Me.gazetteHistory||[],We],gazetteIssue:We.issue,hasUnreadGazette:!0}),ld(We))}).catch(We=>{console.error(":",We),x()})}else y({newsBuffer:[]});if(Ct===1&&Ct!==3){const K=Jg(c.worldNpcs||[],Mn);y({worldNpcs:K}),K.forEach(xe=>{xe.status==="DEAD"&&xe.deathYear===Mn&&(Ft(c.newsBuffer||[],"DEATH",{actor:`${xe.title} ${xe.name}`,detail:xe.age,location:xe.deathReason||""}),Ae(` ${xe.rank?`${xe.rank}`:""}${xe.title} ${xe.name}${xe.deathReason}`))})}if(Ct%3===0)if($e)ao.length>0&&xi([]);else{const K=Yj(wi);if(K){const xe=qj(K.participants,c),ye=xe.participants.map(Ye=>Ye.name),Me=ye[0]||"",We=ye[1]||"";Ft(c.newsBuffer,"SHURA_FIELD",{actor:c.name,dominant:Me,rival:We,participants:ye.join(""),count:ye.length}),ae(Ye=>{if(!xe.participants.find(dn=>dn.id===Ye.id))return Ye;const at=typeof Ye.personality=="object"&&Ye.personality!==null&&"label"in Ye.personality?Ye.personality.label:Array.isArray(Ye.personality)?Ye.personality[0]:"",mt=c.gender===""?"":"";let yt="";switch(at){case"":yt=`...${c.name}${c.name}`;break;case"":yt=`...${c.name}${mt}${mt}`;break;case"":yt=`${c.name}...`;break;case"":yt=`${c.name}.........`;break;case"":yt=`${c.name}${mt}...`;break;case"":yt=`${c.name}...`;break;case"":yt=`...${c.name}""...`;break;case"":yt=`${c.name}......`;break;case"":yt=`${c.name}${mt}...`;break;default:yt=`...${c.name}${mt}...`}const Mr=Ye.logs||[],Rt={year:c.time.year,month:c.time.month,content:yt,type:"DAILY",isSecret:!0,timestamp:Date.now()};return{...Ye,logs:[Rt,...Mr].slice(0,50)}}),xi(Ye=>[...Ye,xe]),cn&&zn(!1),Ae(" ...")}}const $b=((C0=c==null?void 0:c.time)==null?void 0:C0.year)??0,Td=((T0=c==null?void 0:c.time)==null?void 0:T0.month)??0,Id=`${$b}-${Td}`,Bb=Gf.current===Id,Ob=Wa.current===Id,Pb=Vf&&Td%2===0;if(!Bb&&!Ob&&Td>0&&!Pb)try{const K=mu(c.newsBuffer),xe={player:c,children:J,fallenChildren:fe,activeNpcs:wi,deadNpcs:j,gameStage:Et,logs:dr,inventory:l,messages:jt.toJSON(),lastMessageCheck:ci,pendingSectChoices:di,testQueue:Ts,worldEvents:c.worldEvents||[],newsBuffer:K};Uf(xe,Id)}catch(K){console.error(":",K)}},[J,c,C,Ts,io,$e,Pt,cn,ao,ni,re,Ne,Et,dr,l,jt,ci,di,Uf,Vf]);b.useEffect(()=>{C.some(R=>R.isPregnant&&R.pregnancyProgress===8)&&cn&&console.warn(" NPC8")},[C,cn]);const ab=(f,R,k="")=>{var H,q;const P=Sy(R),M=J.find(D=>D.id===f);if(!M)return;const O=ky(M,P);if(!O.qualified){te("",((H=O.reasons)==null?void 0:H.join(""))||"",!1);return}ge(D=>D.id===f,D=>{const se={...D,sect:P,rank:k},le=C.find(pe=>pe.name===D.fatherName||pe.name===D.motherName);le&&os.onChildJoinSect(le,D,P.name),localStorage.getItem("acceptChildLetters")!=="false"&&Og({id:D.id,name:D.name,gender:D.gender,sect:P.name,tier:D.tierTitle,fatherName:D.fatherName,generation:D.generation,affection:100,relationship:{affection:100,stage:0}},c,{year:Math.floor(c.age),month:c.time.month},!0,{apiKey:localStorage.getItem("game_api_key")||"",apiUrl:localStorage.getItem("game_api_url")||"https://api.deepseek.com/chat/completions",apiModel:localStorage.getItem("game_api_model")||"deepseek-chat",useAIForLetter:localStorage.getItem("useAIForLetter")!=="false"},{children:J,exiledChildren:c.exiledChildren||[],replyHistory:jt.getRecentRepliesForNpc(D.id,3)}).then(pe=>{jt.addMessage(pe),Cs(jt.getAllMessages())}).catch(pe=>{console.error(":",pe)}),Ft(c.newsBuffer||[],"JOIN_SECT",{actor:c.name,target:D.name,detail:P.name});const Z=tC(se,P.name);return Z&&Ae(Z,"cultivation"),xt(se)}),ui(D=>D.filter(se=>se.child.id!==f));const L=((q=J.find(D=>D.id===f))==null?void 0:q.name)||"";Ae(` ${L} ${P.name}`,"")};b.useEffect(()=>{let f;if(cn){const R=()=>{Sd(!0),f=setTimeout(R,1e3/Js)};f=setTimeout(R,1e3/Js)}return()=>clearTimeout(f)},[cn,Js,Sd]),b.useEffect(()=>{if(fr){Ua.length>0&&yd([]);return}if(Ua.length>0&&!t.type){const f=Ua[0];i({type:"JEALOUSY",data:f}),yd(R=>R.slice(1))}},[Ua,t.type,fr]),b.useEffect(()=>{if($e){ao.length>0&&xi([]);return}if(ao.length!==0){if(t.type==="RESULT"&&Yf!==!1){i({type:null,data:null});return}if(!t.type){const f=ao[0];i({type:"SHURA_FIELD",data:f}),xi(R=>R.slice(1))}}},[ao,t.type,Yf,$e]),b.useEffect(()=>{var R,k,P,M;if(!re)return;const f=ce.find(O=>O.id===re.id);f&&(f.name!==re.name||f.cultivation!==re.cultivation||((R=f.stats)==null?void 0:R.aptitude)!==((k=re.stats)==null?void 0:k.aptitude)||((P=f.influenceProfile)==null?void 0:P.tierId)!==((M=re.influenceProfile)==null?void 0:M.tierId)||f.isFavorite!==re.isFavorite)&&Ne(f)},[Jc,ce,re,Ne]);const lb=f=>{const R=J.find(P=>P.id===f);if(!R)return;if(Math.floor(R.age*12)<216){te("","18",!1,null,!1);return}if(c.resources.spiritStones<500){te("",` 500 : ${c.resources.spiritStones}`,!1);return}const k=kg(R.tierTitle||"",R.gender);gd(k),hd(R),md(!0)},cb=f=>{if(!Ha)return;ge(k=>k.id===Ha.id,k=>{const P=C.find(M=>M.name===k.fatherName||M.name===k.motherName);if(P){os.onChildMarriage(P,k,f.name);const M=mg(P,c,Math.floor(c.age),c.time.month,f.name);ne(P.id,M)}return{...k,spouse:f}}),E({spiritStones:500}),Ae(` 500 ${Ha.name}  ${f.name} `),md(!1),gd([]),hd(null)},db=(f,R,k)=>{var P,M;if(R==="CHAT"){const O=J.find(D=>D.id===f);if(!O)return;if((c.energy||0)<=0){te("","",!1);return}w(1);const L={...O,isChild:!0,relationship:{affection:100}},H=uu(L,c);if(H){te((H==null?void 0:H.title)||"",(H==null?void 0:H.text)||"",!0,null);return}const q=[`${O.name}`,`${O.name}`,`${O.name}${O.gender===""?"":""}`,`${O.name}"${c.gender===""?"":""}"`,`${O.name}`];te("",q[Math.floor(Math.random()*q.length)],!0,null);return}if(R==="MARRY"){lb(f);return}if(R==="RENAME"&&(nt(f,{name:k}),Ne(O=>O&&O.id===f?{...O,name:k}:O),te("","",!0)),R==="FEED_PILL"){if(c.resources.spiritStones<100){te("",` 100 : ${c.resources.spiritStones}`,!1);return}const L=J.find(se=>se.id===f);if(!L)return;const H=500*(1+(((P=L.stats)==null?void 0:P.aptitude)||0)/100),q=Zt(L,H);E({spiritStones:100}),ge(se=>se.id===f,se=>{var Z;const le=500*(1+(((Z=se.stats)==null?void 0:Z.aptitude)||0)/100),oe=Zt(se,le);return xt(oe.updated)}),Ne(se=>{var le;if(se&&se.id===f){const oe=500*(1+(((le=se.stats)==null?void 0:le.aptitude)||0)/100),Z=Zt(se,oe);return xt(Z.updated)}return se});const D=q.tierChanged?`

 ${L.name} ${q.newTier} ${q.lifespanIncrease} `:"";te("",`${D}`,!0)}if(R==="EDUCATE"){if(c.resources.spiritStones<50){te("",` 50 : ${c.resources.spiritStones}`,!1);return}E({spiritStones:50});const L=J.find(D=>D.id===f),H=L?Zt(L,Math.floor((((M=L.stats)==null?void 0:M.aptitude)||50)*5)):null;ge(D=>D.id===f,D=>{var oe;const se=Math.floor((((oe=D.stats)==null?void 0:oe.aptitude)||50)*5),le=Zt(D,se);return xt(le.updated)}),Ne(D=>{var se;if(D&&D.id===f){const le=Math.floor((((se=D.stats)==null?void 0:se.aptitude)||50)*5),oe=Zt(D,le);return xt(oe.updated)}return D});const q=H!=null&&H.tierChanged?`

 ${(L==null?void 0:L.name)||""} ${H.newTier} ${H.lifespanIncrease} `:"";te("",`${(re==null?void 0:re.name)||""} ${q}

 `,!0)}if(R==="OPEN_INVENTORY"&&e.openInventory((k==null?void 0:k.mode)||"VIEW",(k==null?void 0:k.slot)||null,f),R==="UNEQUIP"){const O=k==null?void 0:k.slot;if(!O)return;const L=J.find(D=>D.id===f);if(!L)return;const H=Si(L),q=H.equipment[O];if(!q)return;a.setInventory(D=>[q,...D]),ge(D=>D.id===f,D=>{const se={...H,equipment:{...H.equipment,[O]:null}};return xt(se)}),Ne(D=>{if(D&&D.id===f){const se={...H,equipment:{...H.equipment,[O]:null}};return xt(se)}return D})}if(R==="CHANGE_MANUAL"){if(!J.find(H=>H.id===f))return;if(l.filter(H=>H.type==="manual").length===0){te("","",!1);return}e.openInventory("MANUAL_SELECT",null,f)}if(R==="SELECT_SECT"){const O=J.find(q=>q.id===f);if(!O)return;if(Math.floor(O.age*12)<144){te("","12",!1);return}if(!O.isTested){te("","",!1);return}const{recommended:L,others:H}=kp(O);if(!L.length&&!H.length){te("","",!1);return}ui([{type:"JOIN_SECT",title:"",message:`${O.name} `,child:O,selectableSects:L,otherSectOptions:H,showModal:!0}]),cn&&zn(!1)}if(R==="TOGGLE_AUTO_JOIN_SECT"){const O=!!k;nt(f,{autoJoinBestSect:O}),Ne(L=>L&&L.id===f?{...L,autoJoinBestSect:O}:L),te("",O?"":"",!0);return}if(R==="EXPEL"){const O=J.find(L=>L.id===f);if(!O)return;Le(f),y({exiledChildren:[...c.exiledChildren||[],O]}),Ne(null),Ae(` ${O.name} `),te("",`${O.name} `,!0);return}},wd=f=>{const{recommended:R,others:k}=kp(f),P=[...R,...k],M=P.filter(O=>{var L;return(L=O.admission)==null?void 0:L.qualified});return M.length?M[0].sect:P.length?P[0].sect:null},ub=f=>{if(cd(!!f),!f){te("","",!0);return}let R=0;ue(k=>{if(!(Math.floor(k.age*12)>=144)||!k.isTested||k.sect)return k;const M=wd(k);return M?(R++,{...k,sect:M,rank:ea(k,M)}):k}),te("",` ${R} `,!0)},pb=()=>{var L;const R=((L=c==null?void 0:c.resources)==null?void 0:L.spiritStones)||0,k=J.filter(H=>!H.spouse&&Math.floor((H.age||0)*12)>=216).sort((H,q)=>{var D,se;return(((D=q.stats)==null?void 0:D.aptitude)||0)-(((se=H.stats)==null?void 0:se.aptitude)||0)});if(!k.length){te("","18",!1);return}const P=Math.min(k.length,Math.floor(R/500));if(P<=0){te(""," 500 ",!1);return}const O=k.slice(0,P).map(H=>{const D=(kg(H.tierTitle||"",H.gender)||[]).reduce((se,le)=>{var pe,ie,Re,De;if(!se)return le;const oe=((pe=le.stats)==null?void 0:pe.aptitude)||0,Z=((ie=se.stats)==null?void 0:ie.aptitude)||0;return oe===Z?(((Re=le.stats)==null?void 0:Re.intelligence)||0)>(((De=se.stats)==null?void 0:De.intelligence)||0)?le:se:oe>Z?le:se},null)||cE(H.tierTitle||"",H.gender);return{childId:H.id,childName:H.name,spouse:D,childRef:H}});if(!O.length){te("","",!1);return}mi(O),e.openBatchMarriageModal()},fb=f=>{var H;if(!f||f.length===0){e.closeBatchMarriageModal(),mi([]);return}const R=new Map(f.map(q=>[q.childId,q]));ue(q=>{const D=R.get(q.id);return D?{...q,spouse:D.spouse}:q}),Ne(q=>q&&R.has(q.id)?{...q,spouse:R.get(q.id).spouse}:q);const k=Math.floor((c==null?void 0:c.age)||0),P=((H=c==null?void 0:c.time)==null?void 0:H.month)??1,M=new Map;f.forEach(q=>{var le,oe;const D=q.childRef,se=C.find(Z=>Z.name===D.fatherName||Z.name===D.motherName);if(se&&!M.has(se.id)){os.onChildMarriage(se,D,(le=q.spouse)==null?void 0:le.name);const Z=mg(se,c,k,P,(oe=q.spouse)==null?void 0:oe.name);M.set(se.id,Z)}}),M.size&&Be(M);const O=f.length*500;E({spiritStones:O});const L=f.map(q=>{var D,se,le;return` ${q.childName}  ${((D=q.spouse)==null?void 0:D.name)||""}${((le=(se=q.spouse)==null?void 0:se.stats)==null?void 0:le.aptitude)??"?"}`}).join(`
`);Ae(`  ${f.length} 
${L}`),te("",` ${O}  ${f.length} 
${L}`,!0),e.closeBatchMarriageModal(),mi([])},mb=f=>{dd(!!f),te(f?"":"",f?"":"",!0)},gb=f=>{ud(!!f),te(f?"":"",f?"":"",!0)},hb=f=>{U(!!f),y({childrenStrategy:{...c.childrenStrategy,skipZhaozhou:!!f}}),te(f?"":"",f?"":"",!0)},xb=f=>{Dn(!!f),f&&xi([]),te(f?"":"",f?"":"",!0)},yb=f=>{Qr(!!f),te(f?"":"",f?"":"",!0)},bb=f=>{pd(!!f),te(f?"":"",f?"":"",!0)},r0=(f,R,k)=>{const P=l.find(H=>H.instanceId===k);if(!P)return te("","",!1);if(P.slot!==R)return te("","",!1);const M=J.find(H=>H.id===f);if(!M)return;const O=Si(M),L=O.equipment[R];ge(H=>H.id===f,H=>{const q={...O,equipment:{...O.equipment,[R]:P}};return xt(q)}),Ne(H=>{if(H&&H.id===f){const q={...O,equipment:{...O.equipment,[R]:P}};return xt(q)}return H}),a.setInventory(H=>{const q=H.filter(D=>D.instanceId!==k);return L?[L,...q]:q}),e.closeInventory(),te("",`${M.name}  ${P.name}`,!0)},kd=(f,R)=>{var se;const k=l.find(le=>le.instanceId===R);if(!k)return te("","",!1);const P=!f,M=P?null:J.find(le=>le.id===f);if(!P&&!M)return te("","",!1);const O=P?ft.PLAYER:ft.CHILD;if(!Rs(k,O)){te("",`${k.name||""}  ${ho(k)} `,!1);return}if(k.type==="manual"){const le=k.manualIds||[];if(le.length===0)return te("","",!1);const oe=le[Math.floor(Math.random()*le.length)],Z=mn[oe];if(!Z)return te("","",!1);if(P){m(ie=>{const Re={...ie,cultivationMethod:oe};return xt(Re)}),e.closeInventory(),te("",` ${Z.name||oe}`,!0);return}const pe=Fg(M,oe);if(!pe.success)return te("",pe.message,!1);ge(ie=>ie.id===f,ie=>{const Re={...ie,cultivationMethod:oe};return xt(Re)}),Ne(ie=>{if(ie&&ie.id===f){const Re={...ie,cultivationMethod:oe};return xt(Re)}return ie}),e.closeInventory(),Ae(pe.message),te("",pe.message+"",!0,{:((se=pe.compatibility)==null?void 0:se.desc)||""});return}if(["weapon","armor","accessory"].includes(k.type)){if(P){m(le=>{const oe=Si(le),Z={...oe,equipment:{...oe.equipment,[k.slot]:k}};return xt(Z)}),a.setInventory(le=>le.filter(oe=>oe.instanceId!==R)),e.closeInventory(),te("",` ${k.name}`,!0);return}r0(f,k.slot,R);return}if(k.type!=="consumable")return te("","",!1);const L=k.effect||{};if(P){m(oe=>{var pe,ie,Re;let Z={...oe};if(L.kind==="exp")Z.currentExp=(Z.currentExp||0)+(L.amount||0);else if(L.kind==="aptitude"){const De=Math.min(100,(((pe=Z.stats)==null?void 0:pe.aptitude)||50)+(L.amount||0));Z={...Z,stats:{...Z.stats,aptitude:De}};try{const st=tr(De,Z.spiritRoot,null,{constitution:Z.constitution});Z={...Z,spiritRoot:st}}catch{}}else if(L.kind==="intelligence"){const De=Math.min(100,(((ie=Z.stats)==null?void 0:ie.intelligence)||50)+(L.amount||0));Z={...Z,stats:{...Z.stats,intelligence:De}}}else if(L.kind==="heal"){const De=((Re=Z.stats)==null?void 0:Re.health)||100,st=Math.min(100,De+(L.amount||0));Z={...Z,stats:{...Z.stats,health:st}};const Fn=Bt(De),en=Bt(st),Ct=en-Fn;Ct>0&&(Z.energy=Math.min(en,(Z.energy||0)+Ct))}return xt(Z)}),u(R,k.stackable?1:void 0),e.closeInventory();let le=`  ${k.name}`;L.kind==="exp"&&(le+=` +${L.amount}`),L.kind==="aptitude"&&(le+=` +${L.amount}`),L.kind==="intelligence"&&(le+=` +${L.amount}`),L.kind==="heal"&&(le+=""),te("",le,!0);return}const H=L.kind==="exp"?L.amount||0:L.kind==="heal"?Math.floor((L.amount||0)*2):0,q=H>0?Zt(M,H):null;ge(le=>le.id===f,le=>{var Z,pe;let oe={...le};if(L.kind==="exp"||L.kind==="heal")oe=Zt(oe,H).updated;else if(L.kind==="aptitude"){const ie=Math.min(100,(((Z=oe.stats)==null?void 0:Z.aptitude)||50)+(L.amount||0));if(oe={...oe,stats:{...oe.stats,aptitude:ie}},oe.isTested||oe.spiritRoot&&Array.isArray(oe.spiritRoot.elements))try{const Re=tr(ie,oe.spiritRoot,null,{constitution:oe.constitution});oe={...oe,spiritRoot:Re}}catch{}}else if(L.kind==="intelligence"){const ie=Math.min(100,(((pe=oe.stats)==null?void 0:pe.intelligence)||50)+(L.amount||0));oe={...oe,stats:{...oe.stats,intelligence:ie}}}return xt(oe)}),Ne(le=>{var oe,Z;if(le&&le.id===f){let pe={...le};if(L.kind==="exp"||L.kind==="heal")pe=Zt(pe,H).updated;else if(L.kind==="aptitude"){const ie=Math.min(100,(((oe=pe.stats)==null?void 0:oe.aptitude)||50)+(L.amount||0));if(pe={...pe,stats:{...pe.stats,aptitude:ie}},pe.isTested||pe.spiritRoot&&Array.isArray(pe.spiritRoot.elements))try{const Re=tr(ie,pe.spiritRoot,null,{constitution:pe.constitution});pe={...pe,spiritRoot:Re}}catch{}}else if(L.kind==="intelligence"){const ie=Math.min(100,(((Z=pe.stats)==null?void 0:Z.intelligence)||50)+(L.amount||0));pe={...pe,stats:{...pe.stats,intelligence:ie}}}return xt(pe)}return le}),u(R,k.stackable?1:void 0),e.closeInventory();let D=`${M.name}  ${k.name}`;L.kind==="exp"&&(D+=`+${L.amount}`),L.kind==="aptitude"&&(D+=`+${L.amount}`),L.kind==="intelligence"&&(D+=`+${L.amount}`),L.kind==="heal"&&(D+=""),q!=null&&q.tierChanged&&(D+=`

 ${M.name} ${q.newTier} ${q.lifespanIncrease} `),te("",D,!0)},vb=(f,R)=>{if(!R||R.length===0){te("","",!1);return}const k=!f,P=k?c:J.find(oe=>oe.id===f);if(!k&&!P){te("","",!1);return}let M=0,O=0,L=0,H=0,q=[];R.forEach(oe=>{const Z=l.find(Fn=>Fn.instanceId===oe.instanceId);if(!Z||!Z.effect)return;const pe=Math.min(oe.quantity||1,Z.quantity||1);if(pe<=0)return;const ie=k?ft.PLAYER:ft.CHILD;if(!Rs(Z,ie))return;const Re=Z.effect,st=(Re.amount||0)*pe;Re.kind==="exp"?M+=st:Re.kind==="aptitude"?O+=st:Re.kind==="intelligence"?L+=st:Re.kind==="heal"&&(H+=st),q.push({name:Z.name,quantity:pe,effect:Re.kind}),u(Z.instanceId,pe)});const D=k?0:M+Math.floor(H*2),se=!k&&D>0?Zt(P,D):null;k?m(oe=>{var pe,ie,Re;let Z={...oe};if(M>0&&(Z.currentExp=(Z.currentExp||0)+M),O>0){const De=Math.min(100,(((pe=Z.stats)==null?void 0:pe.aptitude)||50)+O);Z={...Z,stats:{...Z.stats,aptitude:De}};try{const st=tr(De,Z.spiritRoot,null,{constitution:Z.constitution});Z={...Z,spiritRoot:st}}catch{}}if(L>0){const De=Math.min(100,(((ie=Z.stats)==null?void 0:ie.intelligence)||50)+L);Z={...Z,stats:{...Z.stats,intelligence:De}}}if(H>0){const De=((Re=Z.stats)==null?void 0:Re.health)||100,st=Math.min(100,De+H);Z={...Z,stats:{...Z.stats,health:st}};const Fn=Bt(De),en=Bt(st),Ct=en-Fn;Ct>0&&(Z.energy=Math.min(en,(Z.energy||0)+Ct))}return xt(Z)}):(ge(oe=>oe.id===f,oe=>{var pe,ie;let Z={...oe};if(D>0&&(Z=Zt(Z,D).updated),O>0){const Re=Math.min(100,(((pe=Z.stats)==null?void 0:pe.aptitude)||50)+O);if(Z={...Z,stats:{...Z.stats,aptitude:Re}},Z.isTested||Z.spiritRoot&&Array.isArray(Z.spiritRoot.elements))try{const De=tr(Re,Z.spiritRoot,null,{constitution:Z.constitution});Z={...Z,spiritRoot:De}}catch{}}if(L>0){const Re=Math.min(100,(((ie=Z.stats)==null?void 0:ie.intelligence)||50)+L);Z={...Z,stats:{...Z.stats,intelligence:Re}}}return xt(Z)}),Ne(oe=>{var Z,pe;if(oe&&oe.id===f){let ie={...oe};if(D>0&&(ie=Zt(ie,D).updated),O>0){const Re=Math.min(100,(((Z=ie.stats)==null?void 0:Z.aptitude)||50)+O);if(ie={...ie,stats:{...ie.stats,aptitude:Re}},ie.isTested||ie.spiritRoot&&Array.isArray(ie.spiritRoot.elements))try{const De=tr(Re,ie.spiritRoot,null,{constitution:ie.constitution});ie={...ie,spiritRoot:De}}catch{}}if(L>0){const Re=Math.min(100,(((pe=ie.stats)==null?void 0:pe.intelligence)||50)+L);ie={...ie,stats:{...ie.stats,intelligence:Re}}}return xt(ie)}return oe}));let le=`${k?"":P.name}  ${q.length} 
`;q.forEach(oe=>{le+=`
 ${oe.name} x${oe.quantity}`}),M>0&&(le+=`

+${M}`),O>0&&(le+=`
+${O}`),L>0&&(le+=`
+${L}`),H>0&&(le+=`
+${H}`),se!=null&&se.tierChanged&&(le+=`

 ${P.name} ${se.newTier} ${se.lifespanIncrease} `),te("",le,!0),e.closeInventory()},Ya=b.useCallback(()=>{bd({open:!1,item:null,items:null,isBatch:!1})},[]),Sb=b.useCallback(()=>{md(!1),gd([]),hd(null)},[]),wb=b.useCallback(f=>{f.forEach(R=>{const k=Sr(R.giftItemId);k&&(d([k]),Ae(`${R.message}${k.name}`))}),e.closeBatchGiftModal(),pi([]),te("",` ${f.length} `,!0)},[Sr,d,Ae,e,pi,te]),kb=b.useCallback(()=>{e.closeBatchGiftModal(),pi([])},[e,pi]),Eb=b.useCallback(f=>{f.forEach(R=>{const k=R.giftItemId?Sr(R.giftItemId):null;k&&d([k])}),e.closeBatchPromotionModal(),fi([]),te("",` ${f.length} `,!0)},[Sr,d,e,fi,te]),jb=b.useCallback(()=>{e.closeBatchPromotionModal(),fi([])},[e,fi]),Cb=b.useCallback(()=>{e.closeBatchMarriageModal(),mi([])},[e,mi]),Tb=b.useCallback(f=>{if(Is.isBatch&&Is.items){let R=0,k=0,P=0,M=0,O=0,L=[];Is.items.forEach(D=>{const se=typeof D=="object"?D.instanceId:D,le=typeof D=="object"&&D.quantity?D.quantity:1;for(let oe=0;oe<le;oe++){const Z=l.find(ie=>ie.instanceId===se);if(!Z)continue;const pe=Z.effect||{};if(pe.kind==="exp"||pe.kind==="heal"){const ie=pe.kind==="exp"?pe.amount||0:Math.floor((pe.amount||0)*2);P+=ie;const Re=Zt(f,ie);Re!=null&&Re.tierChanged&&L.push({newTier:Re.newTier,lifespanIncrease:Re.lifespanIncrease})}else pe.kind==="aptitude"?M+=pe.amount||0:pe.kind==="intelligence"&&(O+=pe.amount||0);u(se,Z.stackable?1:void 0),R++}k++}),ge(D=>D.id===f.id,D=>{var le,oe;let se={...D};if(P>0&&(se=Zt(se,P).updated),M>0){const Z=Math.min(100,(((le=se.stats)==null?void 0:le.aptitude)||50)+M);if(se={...se,stats:{...se.stats,aptitude:Z}},se.isTested||se.spiritRoot&&Array.isArray(se.spiritRoot.elements))try{const pe=tr(Z,se.spiritRoot,null,{constitution:se.constitution});se={...se,spiritRoot:pe}}catch{}}if(O>0){const Z=Math.min(100,(((oe=se.stats)==null?void 0:oe.intelligence)||50)+O);se={...se,stats:{...se.stats,intelligence:Z}}}return xt(se)}),Ne(D=>{var se,le;if(D&&D.id===f.id){let oe={...D};if(P>0&&(oe=Zt(oe,P).updated),M>0){const Z=Math.min(100,(((se=oe.stats)==null?void 0:se.aptitude)||50)+M);if(oe={...oe,stats:{...oe.stats,aptitude:Z}},oe.isTested||oe.spiritRoot&&Array.isArray(oe.spiritRoot.elements))try{const pe=tr(Z,oe.spiritRoot,null,{constitution:oe.constitution});oe={...oe,spiritRoot:pe}}catch{}}if(O>0){const Z=Math.min(100,(((le=oe.stats)==null?void 0:le.intelligence)||50)+O);oe={...oe,stats:{...oe.stats,intelligence:Z}}}return xt(oe)}return D});let H=` ${k}  ${R}  ${f.name}`,q={};if(P>0&&(H+=`
 +${P}`,q.=`+${P}`),M>0&&(H+=`
 +${M}`,q.=`+${M}`),O>0&&(H+=`
 +${O}`,q.=`+${O}`),L.length>0){const D=L[L.length-1];H+=`

 ${f.name} ${D.newTier} ${D.lifespanIncrease} `}te("",H,!0,Object.keys(q).length>0?q:null),Ya(),e.closeInventory()}else Is.item&&(kd(f.id,Is.item.instanceId),Ya(),e.closeInventory())},[Is,kd,te,Ya,e,l,u,ge,Ne,Zt,xt,tr]),Ib=b.useCallback(f=>{const R=l.find(k=>k.instanceId===f);if(R){if(!Rs(R,ft.CHILD)){te("",`${R.name||""}  ${ho(R)} `,!1);return}bd({open:!0,item:R})}},[l,Rs,ft,te,ho]),_b=b.useCallback(f=>{if(f.length===0)return;const R=f.map(P=>{const M=typeof P=="object"?P.instanceId:P,O=typeof P=="object"&&P.quantity?P.quantity:1,L=l.find(H=>H.instanceId===M);return L?{...L,giveQuantity:O}:null}).filter(Boolean);if(R.length===0)return;const k=R.filter(P=>!Rs(P,ft.CHILD));if(k.length>0){const P=k.slice(0,3).map(O=>O.name).join(""),M=k.length>3?" ":"";te("",`${P}${M}  ${ho(k[0])} `,!1);return}bd({open:!0,items:R.map(P=>({instanceId:P.instanceId,quantity:P.giveQuantity||1})),isBatch:!0})},[l,Rs,ft,te,ho]),Rb=b.useCallback(()=>{const f=Ts[0];f&&nt(f.id,{isTested:!0}),fd(R=>R.slice(1))},[Ts,nt]),Mb=()=>{if(l.filter(k=>k.type==="manual"&&(k.manualIds&&k.manualIds.length||k.manualId)).length===0){te("","",!1);return}if(!(Rn.length?Rn:J).length){te("","",!1);return}e.openBatchManualModal()},Ab=f=>{if(!f||f.length===0){e.closeBatchManualModal();return}let R=0;const k=[];f.forEach(P=>{const M=J.find(H=>H.id===P.childId);if(!M)return;const O={...M},L=Fg(O,P.manualId);if(L.success){const H=xt({...O});k.push(H),R++,Ae(L.message)}}),k.length>0&&(ue(P=>k.find(O=>O.id===P.id)||P),Ne(P=>P&&(k.find(O=>O.id===P.id)||P))),te("",` ${R} `,!0),e.closeBatchManualModal()},s0=()=>{const f=dE(c);f.success?(m(R=>{var O,L;const k=((O=R.stats)==null?void 0:O.aptitude)||50,P=((L=R.spiritRoot)==null?void 0:L.type)||"",M=Yo(f.newTier,k,P,R.equipment);return{...R,tier:f.newTier,currentExp:0,maxExp:f.newMaxExp,breakthroughBonus:0,breakthroughFailCount:0,combatStats:M}}),Ft(c.newsBuffer||[],"LEVEL_UP",{actor:c.name,detail:f.newTier}),te("",f.msg,!0,{:""},!1)):(m(R=>{const k=(R.breakthroughFailCount||0)+1,P=(R.breakthroughBonus||0)+5;return{...R,currentExp:Math.max(0,R.currentExp-f.penalty),breakthroughFailCount:k,breakthroughBonus:P}}),te("",f.msg,!1,{:-f.penalty},!1))},Nb=f=>{if((c.skillPoints||0)<=0){Ae(" ");return}m(R=>{const k={...R,skillPoints:R.skillPoints-1};if(f==="aptitude"){const P=Math.min(100,(k.stats.aptitude||20)+1),M=Vk(k,P);return Ae(` 1 ${M.stats.aptitude}`),M}else f==="combatPower"?(k.combatStats={...k.combatStats,maxHp:k.combatStats.maxHp+50,hp:k.combatStats.maxHp+50,atk:k.combatStats.atk+5,def:(k.combatStats.def||0)+3},Ae(" 1+50+5+3")):f==="breakthrough"&&(k.breakthroughBonus=(k.breakthroughBonus||0)+5,Ae(` 15%: ${k.breakthroughBonus}%`));return k})};return r.jsxs("div",{style:zm.appContainer,children:[Ee&&r.jsx(c5,{onComplete:()=>Ke(!1)}),Ut&&r.jsx(l5,{onConfirm:()=>xn(!1),onExit:()=>{window.location.href="about:blank"}}),r.jsx(SE,{player:c,isAuto:cn,onBreakthrough:s0,auctionBanner:xd}),Et==="PROLOGUE"?r.jsx(a5,{onFinish:eb,onLoadGame:n0}):r.jsxs("div",{style:zm.mainContent,children:[r.jsx(YC,{player:c,onBreakthroughClick:s0}),ur==="FAMILY"&&r.jsx(qC,{player:c,visibleChildren:Rn,pregnantNpcs:C.filter(f=>{var R;return f.isPregnant&&!((R=f.relationship)!=null&&R.cutTies)}),fallenChildren:fe,exiledChildren:(c==null?void 0:c.exiledChildren)||[],generation3Plus:(c==null?void 0:c.generation3Plus)||[],onChildClick:f=>{f.isEmbryo?te("",`${f.npc.name} ...

 

: ${f.npc.pregnancyProgress||0}/9`,!0,null,!1):Ne(f)},onToggleFavorite:z,onMemorialClick:ob}),ur==="NPC"&&r.jsx(JC,{sortedNpcs:_r,pagedNpcs:Zc,deadNpcs:j,npcSort:Zs,npcPage:eo,npcPageCount:to,hasNpcPagination:ed,showFollowedOnly:Xs,isRomanceLimitReached:mr()>=ns,onExplore:X1,onSortChange:Na,onToggleFollowedOnly:Aa,onPrevPage:()=>Ir(f=>Math.max(0,f-1)),onNextPage:()=>Ir(f=>Math.min(Math.max(0,to-1),f+1)),onNpcInteract:f=>Zf(f.id,"DETAIL"),onNpcAction:Zf}),ur==="ACTION"&&r.jsx(XC,{player:c,children:Rn,showBizPanel:e.showBizPanel,showChallengePanel:e.showChallengePanel,idleManagerOptions:Ia,onDailyAction:G1,onShopping:V1,onOpenInventory:e.openInventory,onBuyBusiness:rb,onExploreRealm:sb,onOpenAuction:$1,onCloseBizPanel:e.closeBizPanel,onCloseChallengePanel:e.closeChallengePanel,onOpenBizPanel:e.openBizPanel,onOpenChallengePanel:e.openChallengePanel,isRomanceLimitReached:mr()>=ns}),ur==="REVENGE"&&r.jsx(HC,{children:r.jsx(H5,{player:c,setPlayer:m,addLog:Ae})}),ur==="SYSTEM"&&r.jsx(eC,{player:c,onSave:tb,onLoad:n0,onReset:nb,onRedeemCode:_1,onOpenGuide:()=>e.openGuide(),autoAssignEnabled:oo,onToggleAutoAssign:ub,autoSkipSpiritTest:li,onToggleAutoSkip:mb,skipChildGiftPopups:io,onToggleSkipChildGiftPopups:gb,skipZhaozhou:za,onToggleSkipZhaozhou:hb,skipShuraFieldEvents:$e,onToggleSkipShuraFieldEvents:xb,skipRomanceGiftPopups:Pt,onToggleSkipRomanceGiftPopups:yb,skipJealousyPopups:fr,onToggleSkipJealousyPopups:bb,isPortraitViewport:Kr,isOrientationFixApplied:cr,onRequestPortraitFix:R1,onReleasePortraitFix:M1,onAutoAssignSpouses:pb,gameState:{player:c,children:J,fallenChildren:fe,activeNpcs:C,deadNpcs:j,gameStage:Et,logs:dr,inventory:l,messages:((g0=jt==null?void 0:jt.toJSON)==null?void 0:g0.call(jt))||{},lastMessageCheck:ci,pendingSectChoices:di,testQueue:Ts,worldEvents:(c==null?void 0:c.worldEvents)||[],newsBuffer:(c==null?void 0:c.newsBuffer)||[]}}),ur==="LOG"&&r.jsx(kj,{logs:dr,ratingSummary:yi,onUpgradeRating:A1}),ur==="PLAYER"&&r.jsx(nC,{player:c,childFeedback:C1,onOpenInventory:()=>e.openInventory("VIEW"),onAllocateSkillPoint:Nb})]}),r.jsx(RC,{modalState:t,closeModal:T1,player:c,inventory:l,handleGiftConfirm:H1,handleNegotiateConfirm:W1,handleShopPurchase:Y1,handleOptionSelect:e0,handleShuraFieldSelect:U1,handleBuyAuctionItem:N1,handleShowAuctionPlot:L1,modalMgr:e,allChildren:J,visibleChildren:Rn,handleEquipToChild:r0,handleUseConsumable:kd,handleBatchUseConsumables:vb,handleDiscardFromInventory:F1,handleGiveToChild:Ib,handleBatchGiveToChildren:_b,handleSell:D1,handleAutoAssignManualToChild:Mb,getMarketPrice:Xf,testQueue:Ts,handleTestFinish:ib,handleTestQueueClose:Rb,childSelectorModal:Is,handleChildSelectorSelect:Tb,closeChildSelectorModal:Ya,selectedChild:re,childNavigationMeta:td,handleNavigateChild:nd,handleChildAction:db,setSelectedChild:Ne,showSpouseSelection:x1,marryingChild:Ha,spouseCandidates:y1,handleSpouseSelect:cb,resetSpouseSelection:Sb,batchGiftEvents:b1,handleBatchGiftConfirm:wb,handleBatchGiftClose:kb,batchPromotionEvents:v1,handleBatchPromotionConfirm:Eb,handleBatchPromotionClose:jb,batchMarriagePlans:S1,handleBatchMarriageConfirm:fb,handleBatchMarriageClose:Cb,handleBatchManualAssign:Ab}),r.jsx(kE,{activeTab:ur,onTabChange:Ra}),r.jsx(KC,{isAuto:cn,autoSpeed:Js,player:c,messageUnreadCount:jt.getUnreadCount(),onToggleAuto:()=>zn(!cn),onSetAutoSpeed:Ma,onNextMonth:Sd,onOpenGazette:()=>{console.log(":",{currentGazette:ai,gazetteHistory:c.gazetteHistory,hasUnreadGazette:c.hasUnreadGazette}),e.openGazette()},onOpenMessageCenter:()=>e.openMessageCenter(),onMarkGazetteRead:()=>y({hasUnreadGazette:!1})}),r.jsx(FC,{selectedNpc:T,setSelectedNpc:$,handleOptionSelect:e0,player:c,visibleChildren:Rn,visibleNpcs:V,activeNpcs:C,modalMgr:e,addLog:Ae,showResult:te,cutTiesWithNpc:ze,handleToggleNpcLetterAcceptance:Z1,messages:h1,messageManager:jt,setMessages:Cs,handleSendMessageReply:j1,combatData:ri,handleCombatClose:ad,isExploring:rd,exploreRealmState:oi,exploreProgress:$a,currentExploreEvent:Oa,exploreLog:od,inventory:l,setExploreLog:no,handleExplorationOption:ii,handleStartCombat:id,setExploreProgress:Ba,setCurrentExploreEvent:pr,setIsExploring:si,getBossEvent:sE,getRandomExplorationEvent:wg,pendingSectChoices:di,setPendingSectChoices:ui,handleAssignSect:ab,handleCloseTutorial:w1,handleCompleteTutorial:k1,handleCloseGuide:E1,currentGazette:ai,setSelectedWorldNpc:Y,selectedWorldNpc:A,handleInviteWorldNpc:Q1,handleChallengeWorldNpc:J1})]})}Eu.createRoot(document.getElementById("root")).render(r.jsx(Ic.StrictMode,{children:r.jsx(bT,{})}));
